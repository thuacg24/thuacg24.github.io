(function(){const er=document.createElement("link").relList;if(er&&er.supports&&er.supports("modulepreload"))return;for(const nr of document.querySelectorAll('link[rel="modulepreload"]'))ir(nr);new MutationObserver(nr=>{for(const sr of nr)if(sr.type==="childList")for(const ar of sr.addedNodes)ar.tagName==="LINK"&&ar.rel==="modulepreload"&&ir(ar)}).observe(document,{childList:!0,subtree:!0});function tr(nr){const sr={};return nr.integrity&&(sr.integrity=nr.integrity),nr.referrerPolicy&&(sr.referrerPolicy=nr.referrerPolicy),nr.crossOrigin==="use-credentials"?sr.credentials="include":nr.crossOrigin==="anonymous"?sr.credentials="omit":sr.credentials="same-origin",sr}function ir(nr){if(nr.ep)return;nr.ep=!0;const sr=tr(nr);fetch(nr.href,sr)}})();const index_html_htmlProxy_inlineCss_index_0="",index_html_htmlProxy_inlineCss_styleAttr_index_1="",index_html_htmlProxy_inlineCss_styleAttr_index_2="";await Ammo().then(function(rr){Ammo=rr});/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const REVISION="170",MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,CullFaceFrontBack=3,BasicShadowMap=0,PCFShadowMap=1,PCFSoftShadowMap=2,VSMShadowMap=3,FrontSide=0,BackSide=1,DoubleSide=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,ConstantColorFactor=211,OneMinusConstantColorFactor=212,ConstantAlphaFactor=213,OneMinusConstantAlphaFactor=214,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,CineonToneMapping=3,ACESFilmicToneMapping=4,CustomToneMapping=5,AgXToneMapping=6,NeutralToneMapping=7,AttachedBindMode="attached",DetachedBindMode="detached",UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,CubeUVReflectionMapping=306,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipmapNearestFilter=1004,NearestMipMapNearestFilter=1004,NearestMipmapLinearFilter=1005,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipmapNearestFilter=1007,LinearMipMapNearestFilter=1007,LinearMipmapLinearFilter=1008,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedInt248Type=1020,UnsignedInt5999Type=35902,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RedFormat=1028,RedIntegerFormat=1029,RGFormat=1030,RGIntegerFormat=1031,RGBIntegerFormat=1032,RGBAIntegerFormat=1033,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGB_ETC2_Format=37492,RGBA_ETC2_EAC_Format=37496,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,RGBA_BPTC_Format=36492,RGB_BPTC_SIGNED_Format=36494,RGB_BPTC_UNSIGNED_Format=36495,RED_RGTC1_Format=36283,SIGNED_RED_RGTC1_Format=36284,RED_GREEN_RGTC2_Format=36285,SIGNED_RED_GREEN_RGTC2_Format=36286,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,NormalAnimationBlendMode=2500,AdditiveAnimationBlendMode=2501,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,BasicDepthPacking=3200,RGBADepthPacking=3201,RGBDepthPacking=3202,RGDepthPacking=3203,TangentSpaceNormalMap=0,ObjectSpaceNormalMap=1,NoColorSpace="",SRGBColorSpace="srgb",LinearSRGBColorSpace="srgb-linear",LinearTransfer="linear",SRGBTransfer="srgb",ZeroStencilOp=0,KeepStencilOp=7680,ReplaceStencilOp=7681,IncrementStencilOp=7682,DecrementStencilOp=7683,IncrementWrapStencilOp=34055,DecrementWrapStencilOp=34056,InvertStencilOp=5386,NeverStencilFunc=512,LessStencilFunc=513,EqualStencilFunc=514,LessEqualStencilFunc=515,GreaterStencilFunc=516,NotEqualStencilFunc=517,GreaterEqualStencilFunc=518,AlwaysStencilFunc=519,NeverCompare=512,LessCompare=513,EqualCompare=514,LessEqualCompare=515,GreaterCompare=516,NotEqualCompare=517,GreaterEqualCompare=518,AlwaysCompare=519,StaticDrawUsage=35044,DynamicDrawUsage=35048,StreamDrawUsage=35040,StaticReadUsage=35045,DynamicReadUsage=35049,StreamReadUsage=35041,StaticCopyUsage=35046,DynamicCopyUsage=35050,StreamCopyUsage=35042,GLSL1="100",GLSL3="300 es",WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class EventDispatcher{addEventListener(er,tr){this._listeners===void 0&&(this._listeners={});const ir=this._listeners;ir[er]===void 0&&(ir[er]=[]),ir[er].indexOf(tr)===-1&&ir[er].push(tr)}hasEventListener(er,tr){if(this._listeners===void 0)return!1;const ir=this._listeners;return ir[er]!==void 0&&ir[er].indexOf(tr)!==-1}removeEventListener(er,tr){if(this._listeners===void 0)return;const nr=this._listeners[er];if(nr!==void 0){const sr=nr.indexOf(tr);sr!==-1&&nr.splice(sr,1)}}dispatchEvent(er){if(this._listeners===void 0)return;const ir=this._listeners[er.type];if(ir!==void 0){er.target=this;const nr=ir.slice(0);for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].call(this,er);er.target=null}}}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const rr=Math.random()*4294967295|0,er=Math.random()*4294967295|0,tr=Math.random()*4294967295|0,ir=Math.random()*4294967295|0;return(_lut[rr&255]+_lut[rr>>8&255]+_lut[rr>>16&255]+_lut[rr>>24&255]+"-"+_lut[er&255]+_lut[er>>8&255]+"-"+_lut[er>>16&15|64]+_lut[er>>24&255]+"-"+_lut[tr&63|128]+_lut[tr>>8&255]+"-"+_lut[tr>>16&255]+_lut[tr>>24&255]+_lut[ir&255]+_lut[ir>>8&255]+_lut[ir>>16&255]+_lut[ir>>24&255]).toLowerCase()}function clamp(rr,er,tr){return Math.max(er,Math.min(tr,rr))}function euclideanModulo(rr,er){return(rr%er+er)%er}function mapLinear(rr,er,tr,ir,nr){return ir+(rr-er)*(nr-ir)/(tr-er)}function inverseLerp(rr,er,tr){return rr!==er?(tr-rr)/(er-rr):0}function lerp$2(rr,er,tr){return(1-tr)*rr+tr*er}function damp(rr,er,tr,ir){return lerp$2(rr,er,1-Math.exp(-tr*ir))}function pingpong(rr,er=1){return er-Math.abs(euclideanModulo(rr,er*2)-er)}function smoothstep(rr,er,tr){return rr<=er?0:rr>=tr?1:(rr=(rr-er)/(tr-er),rr*rr*(3-2*rr))}function smootherstep(rr,er,tr){return rr<=er?0:rr>=tr?1:(rr=(rr-er)/(tr-er),rr*rr*rr*(rr*(rr*6-15)+10))}function randInt(rr,er){return rr+Math.floor(Math.random()*(er-rr+1))}function randFloat(rr,er){return rr+Math.random()*(er-rr)}function randFloatSpread(rr){return rr*(.5-Math.random())}function seededRandom(rr){rr!==void 0&&(_seed=rr);let er=_seed+=1831565813;return er=Math.imul(er^er>>>15,er|1),er^=er+Math.imul(er^er>>>7,er|61),((er^er>>>14)>>>0)/4294967296}function degToRad(rr){return rr*DEG2RAD}function radToDeg(rr){return rr*RAD2DEG}function isPowerOfTwo(rr){return(rr&rr-1)===0&&rr!==0}function ceilPowerOfTwo(rr){return Math.pow(2,Math.ceil(Math.log(rr)/Math.LN2))}function floorPowerOfTwo(rr){return Math.pow(2,Math.floor(Math.log(rr)/Math.LN2))}function setQuaternionFromProperEuler(rr,er,tr,ir,nr){const sr=Math.cos,ar=Math.sin,or=sr(tr/2),lr=ar(tr/2),cr=sr((er+ir)/2),ur=ar((er+ir)/2),dr=sr((er-ir)/2),hr=ar((er-ir)/2),pr=sr((ir-er)/2),gr=ar((ir-er)/2);switch(nr){case"XYX":rr.set(or*ur,lr*dr,lr*hr,or*cr);break;case"YZY":rr.set(lr*hr,or*ur,lr*dr,or*cr);break;case"ZXZ":rr.set(lr*dr,lr*hr,or*ur,or*cr);break;case"XZX":rr.set(or*ur,lr*gr,lr*pr,or*cr);break;case"YXY":rr.set(lr*pr,or*ur,lr*gr,or*cr);break;case"ZYZ":rr.set(lr*gr,lr*pr,or*ur,or*cr);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+nr)}}function denormalize(rr,er){switch(er.constructor){case Float32Array:return rr;case Uint32Array:return rr/4294967295;case Uint16Array:return rr/65535;case Uint8Array:return rr/255;case Int32Array:return Math.max(rr/2147483647,-1);case Int16Array:return Math.max(rr/32767,-1);case Int8Array:return Math.max(rr/127,-1);default:throw new Error("Invalid component type.")}}function normalize(rr,er){switch(er.constructor){case Float32Array:return rr;case Uint32Array:return Math.round(rr*4294967295);case Uint16Array:return Math.round(rr*65535);case Uint8Array:return Math.round(rr*255);case Int32Array:return Math.round(rr*2147483647);case Int16Array:return Math.round(rr*32767);case Int8Array:return Math.round(rr*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp:lerp$2,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Vector2{constructor(er=0,tr=0){Vector2.prototype.isVector2=!0,this.x=er,this.y=tr}get width(){return this.x}set width(er){this.x=er}get height(){return this.y}set height(er){this.y=er}set(er,tr){return this.x=er,this.y=tr,this}setScalar(er){return this.x=er,this.y=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y)}copy(er){return this.x=er.x,this.y=er.y,this}add(er){return this.x+=er.x,this.y+=er.y,this}addScalar(er){return this.x+=er,this.y+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this}subScalar(er){return this.x-=er,this.y-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this}multiply(er){return this.x*=er.x,this.y*=er.y,this}multiplyScalar(er){return this.x*=er,this.y*=er,this}divide(er){return this.x/=er.x,this.y/=er.y,this}divideScalar(er){return this.multiplyScalar(1/er)}applyMatrix3(er){const tr=this.x,ir=this.y,nr=er.elements;return this.x=nr[0]*tr+nr[3]*ir+nr[6],this.y=nr[1]*tr+nr[4]*ir+nr[7],this}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this}clamp(er,tr){return this.x=Math.max(er.x,Math.min(tr.x,this.x)),this.y=Math.max(er.y,Math.min(tr.y,this.y)),this}clampScalar(er,tr){return this.x=Math.max(er,Math.min(tr,this.x)),this.y=Math.max(er,Math.min(tr,this.y)),this}clampLength(er,tr){const ir=this.length();return this.divideScalar(ir||1).multiplyScalar(Math.max(er,Math.min(tr,ir)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(er){return this.x*er.x+this.y*er.y}cross(er){return this.x*er.y-this.y*er.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(er){const tr=Math.sqrt(this.lengthSq()*er.lengthSq());if(tr===0)return Math.PI/2;const ir=this.dot(er)/tr;return Math.acos(clamp(ir,-1,1))}distanceTo(er){return Math.sqrt(this.distanceToSquared(er))}distanceToSquared(er){const tr=this.x-er.x,ir=this.y-er.y;return tr*tr+ir*ir}manhattanDistanceTo(er){return Math.abs(this.x-er.x)+Math.abs(this.y-er.y)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this}lerpVectors(er,tr,ir){return this.x=er.x+(tr.x-er.x)*ir,this.y=er.y+(tr.y-er.y)*ir,this}equals(er){return er.x===this.x&&er.y===this.y}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this}rotateAround(er,tr){const ir=Math.cos(tr),nr=Math.sin(tr),sr=this.x-er.x,ar=this.y-er.y;return this.x=sr*ir-ar*nr+er.x,this.y=sr*nr+ar*ir+er.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Matrix3{constructor(er,tr,ir,nr,sr,ar,or,lr,cr){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],er!==void 0&&this.set(er,tr,ir,nr,sr,ar,or,lr,cr)}set(er,tr,ir,nr,sr,ar,or,lr,cr){const ur=this.elements;return ur[0]=er,ur[1]=nr,ur[2]=or,ur[3]=tr,ur[4]=sr,ur[5]=lr,ur[6]=ir,ur[7]=ar,ur[8]=cr,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(er){const tr=this.elements,ir=er.elements;return tr[0]=ir[0],tr[1]=ir[1],tr[2]=ir[2],tr[3]=ir[3],tr[4]=ir[4],tr[5]=ir[5],tr[6]=ir[6],tr[7]=ir[7],tr[8]=ir[8],this}extractBasis(er,tr,ir){return er.setFromMatrix3Column(this,0),tr.setFromMatrix3Column(this,1),ir.setFromMatrix3Column(this,2),this}setFromMatrix4(er){const tr=er.elements;return this.set(tr[0],tr[4],tr[8],tr[1],tr[5],tr[9],tr[2],tr[6],tr[10]),this}multiply(er){return this.multiplyMatrices(this,er)}premultiply(er){return this.multiplyMatrices(er,this)}multiplyMatrices(er,tr){const ir=er.elements,nr=tr.elements,sr=this.elements,ar=ir[0],or=ir[3],lr=ir[6],cr=ir[1],ur=ir[4],dr=ir[7],hr=ir[2],pr=ir[5],gr=ir[8],vr=nr[0],mr=nr[3],fr=nr[6],_r=nr[1],Ar=nr[4],yr=nr[7],wr=nr[2],xr=nr[5],Sr=nr[8];return sr[0]=ar*vr+or*_r+lr*wr,sr[3]=ar*mr+or*Ar+lr*xr,sr[6]=ar*fr+or*yr+lr*Sr,sr[1]=cr*vr+ur*_r+dr*wr,sr[4]=cr*mr+ur*Ar+dr*xr,sr[7]=cr*fr+ur*yr+dr*Sr,sr[2]=hr*vr+pr*_r+gr*wr,sr[5]=hr*mr+pr*Ar+gr*xr,sr[8]=hr*fr+pr*yr+gr*Sr,this}multiplyScalar(er){const tr=this.elements;return tr[0]*=er,tr[3]*=er,tr[6]*=er,tr[1]*=er,tr[4]*=er,tr[7]*=er,tr[2]*=er,tr[5]*=er,tr[8]*=er,this}determinant(){const er=this.elements,tr=er[0],ir=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],ur=er[8];return tr*ar*ur-tr*or*cr-ir*sr*ur+ir*or*lr+nr*sr*cr-nr*ar*lr}invert(){const er=this.elements,tr=er[0],ir=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],ur=er[8],dr=ur*ar-or*cr,hr=or*lr-ur*sr,pr=cr*sr-ar*lr,gr=tr*dr+ir*hr+nr*pr;if(gr===0)return this.set(0,0,0,0,0,0,0,0,0);const vr=1/gr;return er[0]=dr*vr,er[1]=(nr*cr-ur*ir)*vr,er[2]=(or*ir-nr*ar)*vr,er[3]=hr*vr,er[4]=(ur*tr-nr*lr)*vr,er[5]=(nr*sr-or*tr)*vr,er[6]=pr*vr,er[7]=(ir*lr-cr*tr)*vr,er[8]=(ar*tr-ir*sr)*vr,this}transpose(){let er;const tr=this.elements;return er=tr[1],tr[1]=tr[3],tr[3]=er,er=tr[2],tr[2]=tr[6],tr[6]=er,er=tr[5],tr[5]=tr[7],tr[7]=er,this}getNormalMatrix(er){return this.setFromMatrix4(er).invert().transpose()}transposeIntoArray(er){const tr=this.elements;return er[0]=tr[0],er[1]=tr[3],er[2]=tr[6],er[3]=tr[1],er[4]=tr[4],er[5]=tr[7],er[6]=tr[2],er[7]=tr[5],er[8]=tr[8],this}setUvTransform(er,tr,ir,nr,sr,ar,or){const lr=Math.cos(sr),cr=Math.sin(sr);return this.set(ir*lr,ir*cr,-ir*(lr*ar+cr*or)+ar+er,-nr*cr,nr*lr,-nr*(-cr*ar+lr*or)+or+tr,0,0,1),this}scale(er,tr){return this.premultiply(_m3.makeScale(er,tr)),this}rotate(er){return this.premultiply(_m3.makeRotation(-er)),this}translate(er,tr){return this.premultiply(_m3.makeTranslation(er,tr)),this}makeTranslation(er,tr){return er.isVector2?this.set(1,0,er.x,0,1,er.y,0,0,1):this.set(1,0,er,0,1,tr,0,0,1),this}makeRotation(er){const tr=Math.cos(er),ir=Math.sin(er);return this.set(tr,-ir,0,ir,tr,0,0,0,1),this}makeScale(er,tr){return this.set(er,0,0,0,tr,0,0,0,1),this}equals(er){const tr=this.elements,ir=er.elements;for(let nr=0;nr<9;nr++)if(tr[nr]!==ir[nr])return!1;return!0}fromArray(er,tr=0){for(let ir=0;ir<9;ir++)this.elements[ir]=er[ir+tr];return this}toArray(er=[],tr=0){const ir=this.elements;return er[tr]=ir[0],er[tr+1]=ir[1],er[tr+2]=ir[2],er[tr+3]=ir[3],er[tr+4]=ir[4],er[tr+5]=ir[5],er[tr+6]=ir[6],er[tr+7]=ir[7],er[tr+8]=ir[8],er}clone(){return new this.constructor().fromArray(this.elements)}}const _m3=new Matrix3;function arrayNeedsUint32(rr){for(let er=rr.length-1;er>=0;--er)if(rr[er]>=65535)return!0;return!1}const TYPED_ARRAYS={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function getTypedArray(rr,er){return new TYPED_ARRAYS[rr](er)}function createElementNS(rr){return document.createElementNS("http://www.w3.org/1999/xhtml",rr)}function createCanvasElement(){const rr=createElementNS("canvas");return rr.style.display="block",rr}const _cache={};function warnOnce(rr){rr in _cache||(_cache[rr]=!0,console.warn(rr))}function probeAsync(rr,er,tr){return new Promise(function(ir,nr){function sr(){switch(rr.clientWaitSync(er,rr.SYNC_FLUSH_COMMANDS_BIT,0)){case rr.WAIT_FAILED:nr();break;case rr.TIMEOUT_EXPIRED:setTimeout(sr,tr);break;default:ir()}}setTimeout(sr,tr)})}function toNormalizedProjectionMatrix(rr){const er=rr.elements;er[2]=.5*er[2]+.5*er[3],er[6]=.5*er[6]+.5*er[7],er[10]=.5*er[10]+.5*er[11],er[14]=.5*er[14]+.5*er[15]}function toReversedProjectionMatrix(rr){const er=rr.elements;er[11]===-1?(er[10]=-er[10]-1,er[14]=-er[14]):(er[10]=-er[10],er[14]=-er[14]+1)}const ColorManagement={enabled:!0,workingColorSpace:LinearSRGBColorSpace,spaces:{},convert:function(rr,er,tr){return this.enabled===!1||er===tr||!er||!tr||(this.spaces[er].transfer===SRGBTransfer&&(rr.r=SRGBToLinear(rr.r),rr.g=SRGBToLinear(rr.g),rr.b=SRGBToLinear(rr.b)),this.spaces[er].primaries!==this.spaces[tr].primaries&&(rr.applyMatrix3(this.spaces[er].toXYZ),rr.applyMatrix3(this.spaces[tr].fromXYZ)),this.spaces[tr].transfer===SRGBTransfer&&(rr.r=LinearToSRGB(rr.r),rr.g=LinearToSRGB(rr.g),rr.b=LinearToSRGB(rr.b))),rr},fromWorkingColorSpace:function(rr,er){return this.convert(rr,this.workingColorSpace,er)},toWorkingColorSpace:function(rr,er){return this.convert(rr,er,this.workingColorSpace)},getPrimaries:function(rr){return this.spaces[rr].primaries},getTransfer:function(rr){return rr===NoColorSpace?LinearTransfer:this.spaces[rr].transfer},getLuminanceCoefficients:function(rr,er=this.workingColorSpace){return rr.fromArray(this.spaces[er].luminanceCoefficients)},define:function(rr){Object.assign(this.spaces,rr)},_getMatrix:function(rr,er,tr){return rr.copy(this.spaces[er].toXYZ).multiply(this.spaces[tr].fromXYZ)},_getDrawingBufferColorSpace:function(rr){return this.spaces[rr].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(rr=this.workingColorSpace){return this.spaces[rr].workingColorSpaceConfig.unpackColorSpace}};function SRGBToLinear(rr){return rr<.04045?rr*.0773993808:Math.pow(rr*.9478672986+.0521327014,2.4)}function LinearToSRGB(rr){return rr<.0031308?rr*12.92:1.055*Math.pow(rr,.41666)-.055}const REC709_PRIMARIES=[.64,.33,.3,.6,.15,.06],REC709_LUMINANCE_COEFFICIENTS=[.2126,.7152,.0722],D65$1=[.3127,.329],LINEAR_REC709_TO_XYZ=new Matrix3().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),XYZ_TO_LINEAR_REC709=new Matrix3().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);ColorManagement.define({[LinearSRGBColorSpace]:{primaries:REC709_PRIMARIES,whitePoint:D65$1,transfer:LinearTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:REC709_LUMINANCE_COEFFICIENTS,workingColorSpaceConfig:{unpackColorSpace:SRGBColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}},[SRGBColorSpace]:{primaries:REC709_PRIMARIES,whitePoint:D65$1,transfer:SRGBTransfer,toXYZ:LINEAR_REC709_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC709,luminanceCoefficients:REC709_LUMINANCE_COEFFICIENTS,outputColorSpaceConfig:{drawingBufferColorSpace:SRGBColorSpace}}});let _canvas;class ImageUtils{static getDataURL(er){if(/^data:/i.test(er.src)||typeof HTMLCanvasElement>"u")return er.src;let tr;if(er instanceof HTMLCanvasElement)tr=er;else{_canvas===void 0&&(_canvas=createElementNS("canvas")),_canvas.width=er.width,_canvas.height=er.height;const ir=_canvas.getContext("2d");er instanceof ImageData?ir.putImageData(er,0,0):ir.drawImage(er,0,0,er.width,er.height),tr=_canvas}return tr.width>2048||tr.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",er),tr.toDataURL("image/jpeg",.6)):tr.toDataURL("image/png")}static sRGBToLinear(er){if(typeof HTMLImageElement<"u"&&er instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&er instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&er instanceof ImageBitmap){const tr=createElementNS("canvas");tr.width=er.width,tr.height=er.height;const ir=tr.getContext("2d");ir.drawImage(er,0,0,er.width,er.height);const nr=ir.getImageData(0,0,er.width,er.height),sr=nr.data;for(let ar=0;ar<sr.length;ar++)sr[ar]=SRGBToLinear(sr[ar]/255)*255;return ir.putImageData(nr,0,0),tr}else if(er.data){const tr=er.data.slice(0);for(let ir=0;ir<tr.length;ir++)tr instanceof Uint8Array||tr instanceof Uint8ClampedArray?tr[ir]=Math.floor(SRGBToLinear(tr[ir]/255)*255):tr[ir]=SRGBToLinear(tr[ir]);return{data:tr,width:er.width,height:er.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),er}}let _sourceId=0;class Source{constructor(er=null){this.isSource=!0,Object.defineProperty(this,"id",{value:_sourceId++}),this.uuid=generateUUID(),this.data=er,this.dataReady=!0,this.version=0}set needsUpdate(er){er===!0&&this.version++}toJSON(er){const tr=er===void 0||typeof er=="string";if(!tr&&er.images[this.uuid]!==void 0)return er.images[this.uuid];const ir={uuid:this.uuid,url:""},nr=this.data;if(nr!==null){let sr;if(Array.isArray(nr)){sr=[];for(let ar=0,or=nr.length;ar<or;ar++)nr[ar].isDataTexture?sr.push(serializeImage(nr[ar].image)):sr.push(serializeImage(nr[ar]))}else sr=serializeImage(nr);ir.url=sr}return tr||(er.images[this.uuid]=ir),ir}}function serializeImage(rr){return typeof HTMLImageElement<"u"&&rr instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&rr instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&rr instanceof ImageBitmap?ImageUtils.getDataURL(rr):rr.data?{data:Array.from(rr.data),width:rr.width,height:rr.height,type:rr.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let _textureId=0;class Texture extends EventDispatcher{constructor(er=Texture.DEFAULT_IMAGE,tr=Texture.DEFAULT_MAPPING,ir=ClampToEdgeWrapping,nr=ClampToEdgeWrapping,sr=LinearFilter,ar=LinearMipmapLinearFilter,or=RGBAFormat,lr=UnsignedByteType,cr=Texture.DEFAULT_ANISOTROPY,ur=NoColorSpace){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_textureId++}),this.uuid=generateUUID(),this.name="",this.source=new Source(er),this.mipmaps=[],this.mapping=tr,this.channel=0,this.wrapS=ir,this.wrapT=nr,this.magFilter=sr,this.minFilter=ar,this.anisotropy=cr,this.format=or,this.internalFormat=null,this.type=lr,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=ur,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(er=null){this.source.data=er}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(er){return this.name=er.name,this.source=er.source,this.mipmaps=er.mipmaps.slice(0),this.mapping=er.mapping,this.channel=er.channel,this.wrapS=er.wrapS,this.wrapT=er.wrapT,this.magFilter=er.magFilter,this.minFilter=er.minFilter,this.anisotropy=er.anisotropy,this.format=er.format,this.internalFormat=er.internalFormat,this.type=er.type,this.offset.copy(er.offset),this.repeat.copy(er.repeat),this.center.copy(er.center),this.rotation=er.rotation,this.matrixAutoUpdate=er.matrixAutoUpdate,this.matrix.copy(er.matrix),this.generateMipmaps=er.generateMipmaps,this.premultiplyAlpha=er.premultiplyAlpha,this.flipY=er.flipY,this.unpackAlignment=er.unpackAlignment,this.colorSpace=er.colorSpace,this.userData=JSON.parse(JSON.stringify(er.userData)),this.needsUpdate=!0,this}toJSON(er){const tr=er===void 0||typeof er=="string";if(!tr&&er.textures[this.uuid]!==void 0)return er.textures[this.uuid];const ir={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(er).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(ir.userData=this.userData),tr||(er.textures[this.uuid]=ir),ir}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(er){if(this.mapping!==UVMapping)return er;if(er.applyMatrix3(this.matrix),er.x<0||er.x>1)switch(this.wrapS){case RepeatWrapping:er.x=er.x-Math.floor(er.x);break;case ClampToEdgeWrapping:er.x=er.x<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(er.x)%2)===1?er.x=Math.ceil(er.x)-er.x:er.x=er.x-Math.floor(er.x);break}if(er.y<0||er.y>1)switch(this.wrapT){case RepeatWrapping:er.y=er.y-Math.floor(er.y);break;case ClampToEdgeWrapping:er.y=er.y<0?0:1;break;case MirroredRepeatWrapping:Math.abs(Math.floor(er.y)%2)===1?er.y=Math.ceil(er.y)-er.y:er.y=er.y-Math.floor(er.y);break}return this.flipY&&(er.y=1-er.y),er}set needsUpdate(er){er===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(er){er===!0&&this.pmremVersion++}}Texture.DEFAULT_IMAGE=null;Texture.DEFAULT_MAPPING=UVMapping;Texture.DEFAULT_ANISOTROPY=1;class Vector4{constructor(er=0,tr=0,ir=0,nr=1){Vector4.prototype.isVector4=!0,this.x=er,this.y=tr,this.z=ir,this.w=nr}get width(){return this.z}set width(er){this.z=er}get height(){return this.w}set height(er){this.w=er}set(er,tr,ir,nr){return this.x=er,this.y=tr,this.z=ir,this.w=nr,this}setScalar(er){return this.x=er,this.y=er,this.z=er,this.w=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setZ(er){return this.z=er,this}setW(er){return this.w=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;case 2:this.z=tr;break;case 3:this.w=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(er){return this.x=er.x,this.y=er.y,this.z=er.z,this.w=er.w!==void 0?er.w:1,this}add(er){return this.x+=er.x,this.y+=er.y,this.z+=er.z,this.w+=er.w,this}addScalar(er){return this.x+=er,this.y+=er,this.z+=er,this.w+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this.z=er.z+tr.z,this.w=er.w+tr.w,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this.z+=er.z*tr,this.w+=er.w*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this.z-=er.z,this.w-=er.w,this}subScalar(er){return this.x-=er,this.y-=er,this.z-=er,this.w-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this.z=er.z-tr.z,this.w=er.w-tr.w,this}multiply(er){return this.x*=er.x,this.y*=er.y,this.z*=er.z,this.w*=er.w,this}multiplyScalar(er){return this.x*=er,this.y*=er,this.z*=er,this.w*=er,this}applyMatrix4(er){const tr=this.x,ir=this.y,nr=this.z,sr=this.w,ar=er.elements;return this.x=ar[0]*tr+ar[4]*ir+ar[8]*nr+ar[12]*sr,this.y=ar[1]*tr+ar[5]*ir+ar[9]*nr+ar[13]*sr,this.z=ar[2]*tr+ar[6]*ir+ar[10]*nr+ar[14]*sr,this.w=ar[3]*tr+ar[7]*ir+ar[11]*nr+ar[15]*sr,this}divide(er){return this.x/=er.x,this.y/=er.y,this.z/=er.z,this.w/=er.w,this}divideScalar(er){return this.multiplyScalar(1/er)}setAxisAngleFromQuaternion(er){this.w=2*Math.acos(er.w);const tr=Math.sqrt(1-er.w*er.w);return tr<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=er.x/tr,this.y=er.y/tr,this.z=er.z/tr),this}setAxisAngleFromRotationMatrix(er){let tr,ir,nr,sr;const lr=er.elements,cr=lr[0],ur=lr[4],dr=lr[8],hr=lr[1],pr=lr[5],gr=lr[9],vr=lr[2],mr=lr[6],fr=lr[10];if(Math.abs(ur-hr)<.01&&Math.abs(dr-vr)<.01&&Math.abs(gr-mr)<.01){if(Math.abs(ur+hr)<.1&&Math.abs(dr+vr)<.1&&Math.abs(gr+mr)<.1&&Math.abs(cr+pr+fr-3)<.1)return this.set(1,0,0,0),this;tr=Math.PI;const Ar=(cr+1)/2,yr=(pr+1)/2,wr=(fr+1)/2,xr=(ur+hr)/4,Sr=(dr+vr)/4,br=(gr+mr)/4;return Ar>yr&&Ar>wr?Ar<.01?(ir=0,nr=.707106781,sr=.707106781):(ir=Math.sqrt(Ar),nr=xr/ir,sr=Sr/ir):yr>wr?yr<.01?(ir=.707106781,nr=0,sr=.707106781):(nr=Math.sqrt(yr),ir=xr/nr,sr=br/nr):wr<.01?(ir=.707106781,nr=.707106781,sr=0):(sr=Math.sqrt(wr),ir=Sr/sr,nr=br/sr),this.set(ir,nr,sr,tr),this}let _r=Math.sqrt((mr-gr)*(mr-gr)+(dr-vr)*(dr-vr)+(hr-ur)*(hr-ur));return Math.abs(_r)<.001&&(_r=1),this.x=(mr-gr)/_r,this.y=(dr-vr)/_r,this.z=(hr-ur)/_r,this.w=Math.acos((cr+pr+fr-1)/2),this}setFromMatrixPosition(er){const tr=er.elements;return this.x=tr[12],this.y=tr[13],this.z=tr[14],this.w=tr[15],this}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this.z=Math.min(this.z,er.z),this.w=Math.min(this.w,er.w),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this.z=Math.max(this.z,er.z),this.w=Math.max(this.w,er.w),this}clamp(er,tr){return this.x=Math.max(er.x,Math.min(tr.x,this.x)),this.y=Math.max(er.y,Math.min(tr.y,this.y)),this.z=Math.max(er.z,Math.min(tr.z,this.z)),this.w=Math.max(er.w,Math.min(tr.w,this.w)),this}clampScalar(er,tr){return this.x=Math.max(er,Math.min(tr,this.x)),this.y=Math.max(er,Math.min(tr,this.y)),this.z=Math.max(er,Math.min(tr,this.z)),this.w=Math.max(er,Math.min(tr,this.w)),this}clampLength(er,tr){const ir=this.length();return this.divideScalar(ir||1).multiplyScalar(Math.max(er,Math.min(tr,ir)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(er){return this.x*er.x+this.y*er.y+this.z*er.z+this.w*er.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this.z+=(er.z-this.z)*tr,this.w+=(er.w-this.w)*tr,this}lerpVectors(er,tr,ir){return this.x=er.x+(tr.x-er.x)*ir,this.y=er.y+(tr.y-er.y)*ir,this.z=er.z+(tr.z-er.z)*ir,this.w=er.w+(tr.w-er.w)*ir,this}equals(er){return er.x===this.x&&er.y===this.y&&er.z===this.z&&er.w===this.w}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this.z=er[tr+2],this.w=er[tr+3],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er[tr+2]=this.z,er[tr+3]=this.w,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this.z=er.getZ(tr),this.w=er.getW(tr),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class RenderTarget extends EventDispatcher{constructor(er=1,tr=1,ir={}){super(),this.isRenderTarget=!0,this.width=er,this.height=tr,this.depth=1,this.scissor=new Vector4(0,0,er,tr),this.scissorTest=!1,this.viewport=new Vector4(0,0,er,tr);const nr={width:er,height:tr,depth:1};ir=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:LinearFilter,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},ir);const sr=new Texture(nr,ir.mapping,ir.wrapS,ir.wrapT,ir.magFilter,ir.minFilter,ir.format,ir.type,ir.anisotropy,ir.colorSpace);sr.flipY=!1,sr.generateMipmaps=ir.generateMipmaps,sr.internalFormat=ir.internalFormat,this.textures=[];const ar=ir.count;for(let or=0;or<ar;or++)this.textures[or]=sr.clone(),this.textures[or].isRenderTargetTexture=!0;this.depthBuffer=ir.depthBuffer,this.stencilBuffer=ir.stencilBuffer,this.resolveDepthBuffer=ir.resolveDepthBuffer,this.resolveStencilBuffer=ir.resolveStencilBuffer,this.depthTexture=ir.depthTexture,this.samples=ir.samples}get texture(){return this.textures[0]}set texture(er){this.textures[0]=er}setSize(er,tr,ir=1){if(this.width!==er||this.height!==tr||this.depth!==ir){this.width=er,this.height=tr,this.depth=ir;for(let nr=0,sr=this.textures.length;nr<sr;nr++)this.textures[nr].image.width=er,this.textures[nr].image.height=tr,this.textures[nr].image.depth=ir;this.dispose()}this.viewport.set(0,0,er,tr),this.scissor.set(0,0,er,tr)}clone(){return new this.constructor().copy(this)}copy(er){this.width=er.width,this.height=er.height,this.depth=er.depth,this.scissor.copy(er.scissor),this.scissorTest=er.scissorTest,this.viewport.copy(er.viewport),this.textures.length=0;for(let ir=0,nr=er.textures.length;ir<nr;ir++)this.textures[ir]=er.textures[ir].clone(),this.textures[ir].isRenderTargetTexture=!0;const tr=Object.assign({},er.texture.image);return this.texture.source=new Source(tr),this.depthBuffer=er.depthBuffer,this.stencilBuffer=er.stencilBuffer,this.resolveDepthBuffer=er.resolveDepthBuffer,this.resolveStencilBuffer=er.resolveStencilBuffer,er.depthTexture!==null&&(this.depthTexture=er.depthTexture.clone()),this.samples=er.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class WebGLRenderTarget extends RenderTarget{constructor(er=1,tr=1,ir={}){super(er,tr,ir),this.isWebGLRenderTarget=!0}}class DataArrayTexture extends Texture{constructor(er=null,tr=1,ir=1,nr=1){super(null),this.isDataArrayTexture=!0,this.image={data:er,width:tr,height:ir,depth:nr},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(er){this.layerUpdates.add(er)}clearLayerUpdates(){this.layerUpdates.clear()}}class WebGLArrayRenderTarget extends WebGLRenderTarget{constructor(er=1,tr=1,ir=1,nr={}){super(er,tr,nr),this.isWebGLArrayRenderTarget=!0,this.depth=ir,this.texture=new DataArrayTexture(null,er,tr,ir),this.texture.isRenderTargetTexture=!0}}class Data3DTexture extends Texture{constructor(er=null,tr=1,ir=1,nr=1){super(null),this.isData3DTexture=!0,this.image={data:er,width:tr,height:ir,depth:nr},this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.wrapR=ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class WebGL3DRenderTarget extends WebGLRenderTarget{constructor(er=1,tr=1,ir=1,nr={}){super(er,tr,nr),this.isWebGL3DRenderTarget=!0,this.depth=ir,this.texture=new Data3DTexture(null,er,tr,ir),this.texture.isRenderTargetTexture=!0}}let Quaternion$1=class{constructor(er=0,tr=0,ir=0,nr=1){this.isQuaternion=!0,this._x=er,this._y=tr,this._z=ir,this._w=nr}static slerpFlat(er,tr,ir,nr,sr,ar,or){let lr=ir[nr+0],cr=ir[nr+1],ur=ir[nr+2],dr=ir[nr+3];const hr=sr[ar+0],pr=sr[ar+1],gr=sr[ar+2],vr=sr[ar+3];if(or===0){er[tr+0]=lr,er[tr+1]=cr,er[tr+2]=ur,er[tr+3]=dr;return}if(or===1){er[tr+0]=hr,er[tr+1]=pr,er[tr+2]=gr,er[tr+3]=vr;return}if(dr!==vr||lr!==hr||cr!==pr||ur!==gr){let mr=1-or;const fr=lr*hr+cr*pr+ur*gr+dr*vr,_r=fr>=0?1:-1,Ar=1-fr*fr;if(Ar>Number.EPSILON){const wr=Math.sqrt(Ar),xr=Math.atan2(wr,fr*_r);mr=Math.sin(mr*xr)/wr,or=Math.sin(or*xr)/wr}const yr=or*_r;if(lr=lr*mr+hr*yr,cr=cr*mr+pr*yr,ur=ur*mr+gr*yr,dr=dr*mr+vr*yr,mr===1-or){const wr=1/Math.sqrt(lr*lr+cr*cr+ur*ur+dr*dr);lr*=wr,cr*=wr,ur*=wr,dr*=wr}}er[tr]=lr,er[tr+1]=cr,er[tr+2]=ur,er[tr+3]=dr}static multiplyQuaternionsFlat(er,tr,ir,nr,sr,ar){const or=ir[nr],lr=ir[nr+1],cr=ir[nr+2],ur=ir[nr+3],dr=sr[ar],hr=sr[ar+1],pr=sr[ar+2],gr=sr[ar+3];return er[tr]=or*gr+ur*dr+lr*pr-cr*hr,er[tr+1]=lr*gr+ur*hr+cr*dr-or*pr,er[tr+2]=cr*gr+ur*pr+or*hr-lr*dr,er[tr+3]=ur*gr-or*dr-lr*hr-cr*pr,er}get x(){return this._x}set x(er){this._x=er,this._onChangeCallback()}get y(){return this._y}set y(er){this._y=er,this._onChangeCallback()}get z(){return this._z}set z(er){this._z=er,this._onChangeCallback()}get w(){return this._w}set w(er){this._w=er,this._onChangeCallback()}set(er,tr,ir,nr){return this._x=er,this._y=tr,this._z=ir,this._w=nr,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(er){return this._x=er.x,this._y=er.y,this._z=er.z,this._w=er.w,this._onChangeCallback(),this}setFromEuler(er,tr=!0){const ir=er._x,nr=er._y,sr=er._z,ar=er._order,or=Math.cos,lr=Math.sin,cr=or(ir/2),ur=or(nr/2),dr=or(sr/2),hr=lr(ir/2),pr=lr(nr/2),gr=lr(sr/2);switch(ar){case"XYZ":this._x=hr*ur*dr+cr*pr*gr,this._y=cr*pr*dr-hr*ur*gr,this._z=cr*ur*gr+hr*pr*dr,this._w=cr*ur*dr-hr*pr*gr;break;case"YXZ":this._x=hr*ur*dr+cr*pr*gr,this._y=cr*pr*dr-hr*ur*gr,this._z=cr*ur*gr-hr*pr*dr,this._w=cr*ur*dr+hr*pr*gr;break;case"ZXY":this._x=hr*ur*dr-cr*pr*gr,this._y=cr*pr*dr+hr*ur*gr,this._z=cr*ur*gr+hr*pr*dr,this._w=cr*ur*dr-hr*pr*gr;break;case"ZYX":this._x=hr*ur*dr-cr*pr*gr,this._y=cr*pr*dr+hr*ur*gr,this._z=cr*ur*gr-hr*pr*dr,this._w=cr*ur*dr+hr*pr*gr;break;case"YZX":this._x=hr*ur*dr+cr*pr*gr,this._y=cr*pr*dr+hr*ur*gr,this._z=cr*ur*gr-hr*pr*dr,this._w=cr*ur*dr-hr*pr*gr;break;case"XZY":this._x=hr*ur*dr-cr*pr*gr,this._y=cr*pr*dr-hr*ur*gr,this._z=cr*ur*gr+hr*pr*dr,this._w=cr*ur*dr+hr*pr*gr;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+ar)}return tr===!0&&this._onChangeCallback(),this}setFromAxisAngle(er,tr){const ir=tr/2,nr=Math.sin(ir);return this._x=er.x*nr,this._y=er.y*nr,this._z=er.z*nr,this._w=Math.cos(ir),this._onChangeCallback(),this}setFromRotationMatrix(er){const tr=er.elements,ir=tr[0],nr=tr[4],sr=tr[8],ar=tr[1],or=tr[5],lr=tr[9],cr=tr[2],ur=tr[6],dr=tr[10],hr=ir+or+dr;if(hr>0){const pr=.5/Math.sqrt(hr+1);this._w=.25/pr,this._x=(ur-lr)*pr,this._y=(sr-cr)*pr,this._z=(ar-nr)*pr}else if(ir>or&&ir>dr){const pr=2*Math.sqrt(1+ir-or-dr);this._w=(ur-lr)/pr,this._x=.25*pr,this._y=(nr+ar)/pr,this._z=(sr+cr)/pr}else if(or>dr){const pr=2*Math.sqrt(1+or-ir-dr);this._w=(sr-cr)/pr,this._x=(nr+ar)/pr,this._y=.25*pr,this._z=(lr+ur)/pr}else{const pr=2*Math.sqrt(1+dr-ir-or);this._w=(ar-nr)/pr,this._x=(sr+cr)/pr,this._y=(lr+ur)/pr,this._z=.25*pr}return this._onChangeCallback(),this}setFromUnitVectors(er,tr){let ir=er.dot(tr)+1;return ir<Number.EPSILON?(ir=0,Math.abs(er.x)>Math.abs(er.z)?(this._x=-er.y,this._y=er.x,this._z=0,this._w=ir):(this._x=0,this._y=-er.z,this._z=er.y,this._w=ir)):(this._x=er.y*tr.z-er.z*tr.y,this._y=er.z*tr.x-er.x*tr.z,this._z=er.x*tr.y-er.y*tr.x,this._w=ir),this.normalize()}angleTo(er){return 2*Math.acos(Math.abs(clamp(this.dot(er),-1,1)))}rotateTowards(er,tr){const ir=this.angleTo(er);if(ir===0)return this;const nr=Math.min(1,tr/ir);return this.slerp(er,nr),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(er){return this._x*er._x+this._y*er._y+this._z*er._z+this._w*er._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let er=this.length();return er===0?(this._x=0,this._y=0,this._z=0,this._w=1):(er=1/er,this._x=this._x*er,this._y=this._y*er,this._z=this._z*er,this._w=this._w*er),this._onChangeCallback(),this}multiply(er){return this.multiplyQuaternions(this,er)}premultiply(er){return this.multiplyQuaternions(er,this)}multiplyQuaternions(er,tr){const ir=er._x,nr=er._y,sr=er._z,ar=er._w,or=tr._x,lr=tr._y,cr=tr._z,ur=tr._w;return this._x=ir*ur+ar*or+nr*cr-sr*lr,this._y=nr*ur+ar*lr+sr*or-ir*cr,this._z=sr*ur+ar*cr+ir*lr-nr*or,this._w=ar*ur-ir*or-nr*lr-sr*cr,this._onChangeCallback(),this}slerp(er,tr){if(tr===0)return this;if(tr===1)return this.copy(er);const ir=this._x,nr=this._y,sr=this._z,ar=this._w;let or=ar*er._w+ir*er._x+nr*er._y+sr*er._z;if(or<0?(this._w=-er._w,this._x=-er._x,this._y=-er._y,this._z=-er._z,or=-or):this.copy(er),or>=1)return this._w=ar,this._x=ir,this._y=nr,this._z=sr,this;const lr=1-or*or;if(lr<=Number.EPSILON){const pr=1-tr;return this._w=pr*ar+tr*this._w,this._x=pr*ir+tr*this._x,this._y=pr*nr+tr*this._y,this._z=pr*sr+tr*this._z,this.normalize(),this}const cr=Math.sqrt(lr),ur=Math.atan2(cr,or),dr=Math.sin((1-tr)*ur)/cr,hr=Math.sin(tr*ur)/cr;return this._w=ar*dr+this._w*hr,this._x=ir*dr+this._x*hr,this._y=nr*dr+this._y*hr,this._z=sr*dr+this._z*hr,this._onChangeCallback(),this}slerpQuaternions(er,tr,ir){return this.copy(er).slerp(tr,ir)}random(){const er=2*Math.PI*Math.random(),tr=2*Math.PI*Math.random(),ir=Math.random(),nr=Math.sqrt(1-ir),sr=Math.sqrt(ir);return this.set(nr*Math.sin(er),nr*Math.cos(er),sr*Math.sin(tr),sr*Math.cos(tr))}equals(er){return er._x===this._x&&er._y===this._y&&er._z===this._z&&er._w===this._w}fromArray(er,tr=0){return this._x=er[tr],this._y=er[tr+1],this._z=er[tr+2],this._w=er[tr+3],this._onChangeCallback(),this}toArray(er=[],tr=0){return er[tr]=this._x,er[tr+1]=this._y,er[tr+2]=this._z,er[tr+3]=this._w,er}fromBufferAttribute(er,tr){return this._x=er.getX(tr),this._y=er.getY(tr),this._z=er.getZ(tr),this._w=er.getW(tr),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(er){return this._onChangeCallback=er,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Vector3$1=class uo{constructor(er=0,tr=0,ir=0){uo.prototype.isVector3=!0,this.x=er,this.y=tr,this.z=ir}set(er,tr,ir){return ir===void 0&&(ir=this.z),this.x=er,this.y=tr,this.z=ir,this}setScalar(er){return this.x=er,this.y=er,this.z=er,this}setX(er){return this.x=er,this}setY(er){return this.y=er,this}setZ(er){return this.z=er,this}setComponent(er,tr){switch(er){case 0:this.x=tr;break;case 1:this.y=tr;break;case 2:this.z=tr;break;default:throw new Error("index is out of range: "+er)}return this}getComponent(er){switch(er){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+er)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(er){return this.x=er.x,this.y=er.y,this.z=er.z,this}add(er){return this.x+=er.x,this.y+=er.y,this.z+=er.z,this}addScalar(er){return this.x+=er,this.y+=er,this.z+=er,this}addVectors(er,tr){return this.x=er.x+tr.x,this.y=er.y+tr.y,this.z=er.z+tr.z,this}addScaledVector(er,tr){return this.x+=er.x*tr,this.y+=er.y*tr,this.z+=er.z*tr,this}sub(er){return this.x-=er.x,this.y-=er.y,this.z-=er.z,this}subScalar(er){return this.x-=er,this.y-=er,this.z-=er,this}subVectors(er,tr){return this.x=er.x-tr.x,this.y=er.y-tr.y,this.z=er.z-tr.z,this}multiply(er){return this.x*=er.x,this.y*=er.y,this.z*=er.z,this}multiplyScalar(er){return this.x*=er,this.y*=er,this.z*=er,this}multiplyVectors(er,tr){return this.x=er.x*tr.x,this.y=er.y*tr.y,this.z=er.z*tr.z,this}applyEuler(er){return this.applyQuaternion(_quaternion$4.setFromEuler(er))}applyAxisAngle(er,tr){return this.applyQuaternion(_quaternion$4.setFromAxisAngle(er,tr))}applyMatrix3(er){const tr=this.x,ir=this.y,nr=this.z,sr=er.elements;return this.x=sr[0]*tr+sr[3]*ir+sr[6]*nr,this.y=sr[1]*tr+sr[4]*ir+sr[7]*nr,this.z=sr[2]*tr+sr[5]*ir+sr[8]*nr,this}applyNormalMatrix(er){return this.applyMatrix3(er).normalize()}applyMatrix4(er){const tr=this.x,ir=this.y,nr=this.z,sr=er.elements,ar=1/(sr[3]*tr+sr[7]*ir+sr[11]*nr+sr[15]);return this.x=(sr[0]*tr+sr[4]*ir+sr[8]*nr+sr[12])*ar,this.y=(sr[1]*tr+sr[5]*ir+sr[9]*nr+sr[13])*ar,this.z=(sr[2]*tr+sr[6]*ir+sr[10]*nr+sr[14])*ar,this}applyQuaternion(er){const tr=this.x,ir=this.y,nr=this.z,sr=er.x,ar=er.y,or=er.z,lr=er.w,cr=2*(ar*nr-or*ir),ur=2*(or*tr-sr*nr),dr=2*(sr*ir-ar*tr);return this.x=tr+lr*cr+ar*dr-or*ur,this.y=ir+lr*ur+or*cr-sr*dr,this.z=nr+lr*dr+sr*ur-ar*cr,this}project(er){return this.applyMatrix4(er.matrixWorldInverse).applyMatrix4(er.projectionMatrix)}unproject(er){return this.applyMatrix4(er.projectionMatrixInverse).applyMatrix4(er.matrixWorld)}transformDirection(er){const tr=this.x,ir=this.y,nr=this.z,sr=er.elements;return this.x=sr[0]*tr+sr[4]*ir+sr[8]*nr,this.y=sr[1]*tr+sr[5]*ir+sr[9]*nr,this.z=sr[2]*tr+sr[6]*ir+sr[10]*nr,this.normalize()}divide(er){return this.x/=er.x,this.y/=er.y,this.z/=er.z,this}divideScalar(er){return this.multiplyScalar(1/er)}min(er){return this.x=Math.min(this.x,er.x),this.y=Math.min(this.y,er.y),this.z=Math.min(this.z,er.z),this}max(er){return this.x=Math.max(this.x,er.x),this.y=Math.max(this.y,er.y),this.z=Math.max(this.z,er.z),this}clamp(er,tr){return this.x=Math.max(er.x,Math.min(tr.x,this.x)),this.y=Math.max(er.y,Math.min(tr.y,this.y)),this.z=Math.max(er.z,Math.min(tr.z,this.z)),this}clampScalar(er,tr){return this.x=Math.max(er,Math.min(tr,this.x)),this.y=Math.max(er,Math.min(tr,this.y)),this.z=Math.max(er,Math.min(tr,this.z)),this}clampLength(er,tr){const ir=this.length();return this.divideScalar(ir||1).multiplyScalar(Math.max(er,Math.min(tr,ir)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(er){return this.x*er.x+this.y*er.y+this.z*er.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(er){return this.normalize().multiplyScalar(er)}lerp(er,tr){return this.x+=(er.x-this.x)*tr,this.y+=(er.y-this.y)*tr,this.z+=(er.z-this.z)*tr,this}lerpVectors(er,tr,ir){return this.x=er.x+(tr.x-er.x)*ir,this.y=er.y+(tr.y-er.y)*ir,this.z=er.z+(tr.z-er.z)*ir,this}cross(er){return this.crossVectors(this,er)}crossVectors(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=tr.x,or=tr.y,lr=tr.z;return this.x=nr*lr-sr*or,this.y=sr*ar-ir*lr,this.z=ir*or-nr*ar,this}projectOnVector(er){const tr=er.lengthSq();if(tr===0)return this.set(0,0,0);const ir=er.dot(this)/tr;return this.copy(er).multiplyScalar(ir)}projectOnPlane(er){return _vector$c.copy(this).projectOnVector(er),this.sub(_vector$c)}reflect(er){return this.sub(_vector$c.copy(er).multiplyScalar(2*this.dot(er)))}angleTo(er){const tr=Math.sqrt(this.lengthSq()*er.lengthSq());if(tr===0)return Math.PI/2;const ir=this.dot(er)/tr;return Math.acos(clamp(ir,-1,1))}distanceTo(er){return Math.sqrt(this.distanceToSquared(er))}distanceToSquared(er){const tr=this.x-er.x,ir=this.y-er.y,nr=this.z-er.z;return tr*tr+ir*ir+nr*nr}manhattanDistanceTo(er){return Math.abs(this.x-er.x)+Math.abs(this.y-er.y)+Math.abs(this.z-er.z)}setFromSpherical(er){return this.setFromSphericalCoords(er.radius,er.phi,er.theta)}setFromSphericalCoords(er,tr,ir){const nr=Math.sin(tr)*er;return this.x=nr*Math.sin(ir),this.y=Math.cos(tr)*er,this.z=nr*Math.cos(ir),this}setFromCylindrical(er){return this.setFromCylindricalCoords(er.radius,er.theta,er.y)}setFromCylindricalCoords(er,tr,ir){return this.x=er*Math.sin(tr),this.y=ir,this.z=er*Math.cos(tr),this}setFromMatrixPosition(er){const tr=er.elements;return this.x=tr[12],this.y=tr[13],this.z=tr[14],this}setFromMatrixScale(er){const tr=this.setFromMatrixColumn(er,0).length(),ir=this.setFromMatrixColumn(er,1).length(),nr=this.setFromMatrixColumn(er,2).length();return this.x=tr,this.y=ir,this.z=nr,this}setFromMatrixColumn(er,tr){return this.fromArray(er.elements,tr*4)}setFromMatrix3Column(er,tr){return this.fromArray(er.elements,tr*3)}setFromEuler(er){return this.x=er._x,this.y=er._y,this.z=er._z,this}setFromColor(er){return this.x=er.r,this.y=er.g,this.z=er.b,this}equals(er){return er.x===this.x&&er.y===this.y&&er.z===this.z}fromArray(er,tr=0){return this.x=er[tr],this.y=er[tr+1],this.z=er[tr+2],this}toArray(er=[],tr=0){return er[tr]=this.x,er[tr+1]=this.y,er[tr+2]=this.z,er}fromBufferAttribute(er,tr){return this.x=er.getX(tr),this.y=er.getY(tr),this.z=er.getZ(tr),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const er=Math.random()*Math.PI*2,tr=Math.random()*2-1,ir=Math.sqrt(1-tr*tr);return this.x=ir*Math.cos(er),this.y=tr,this.z=ir*Math.sin(er),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const _vector$c=new Vector3$1,_quaternion$4=new Quaternion$1;class Box3{constructor(er=new Vector3$1(1/0,1/0,1/0),tr=new Vector3$1(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=er,this.max=tr}set(er,tr){return this.min.copy(er),this.max.copy(tr),this}setFromArray(er){this.makeEmpty();for(let tr=0,ir=er.length;tr<ir;tr+=3)this.expandByPoint(_vector$b.fromArray(er,tr));return this}setFromBufferAttribute(er){this.makeEmpty();for(let tr=0,ir=er.count;tr<ir;tr++)this.expandByPoint(_vector$b.fromBufferAttribute(er,tr));return this}setFromPoints(er){this.makeEmpty();for(let tr=0,ir=er.length;tr<ir;tr++)this.expandByPoint(er[tr]);return this}setFromCenterAndSize(er,tr){const ir=_vector$b.copy(tr).multiplyScalar(.5);return this.min.copy(er).sub(ir),this.max.copy(er).add(ir),this}setFromObject(er,tr=!1){return this.makeEmpty(),this.expandByObject(er,tr)}clone(){return new this.constructor().copy(this)}copy(er){return this.min.copy(er.min),this.max.copy(er.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(er){return this.isEmpty()?er.set(0,0,0):er.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(er){return this.isEmpty()?er.set(0,0,0):er.subVectors(this.max,this.min)}expandByPoint(er){return this.min.min(er),this.max.max(er),this}expandByVector(er){return this.min.sub(er),this.max.add(er),this}expandByScalar(er){return this.min.addScalar(-er),this.max.addScalar(er),this}expandByObject(er,tr=!1){er.updateWorldMatrix(!1,!1);const ir=er.geometry;if(ir!==void 0){const sr=ir.getAttribute("position");if(tr===!0&&sr!==void 0&&er.isInstancedMesh!==!0)for(let ar=0,or=sr.count;ar<or;ar++)er.isMesh===!0?er.getVertexPosition(ar,_vector$b):_vector$b.fromBufferAttribute(sr,ar),_vector$b.applyMatrix4(er.matrixWorld),this.expandByPoint(_vector$b);else er.boundingBox!==void 0?(er.boundingBox===null&&er.computeBoundingBox(),_box$4.copy(er.boundingBox)):(ir.boundingBox===null&&ir.computeBoundingBox(),_box$4.copy(ir.boundingBox)),_box$4.applyMatrix4(er.matrixWorld),this.union(_box$4)}const nr=er.children;for(let sr=0,ar=nr.length;sr<ar;sr++)this.expandByObject(nr[sr],tr);return this}containsPoint(er){return er.x>=this.min.x&&er.x<=this.max.x&&er.y>=this.min.y&&er.y<=this.max.y&&er.z>=this.min.z&&er.z<=this.max.z}containsBox(er){return this.min.x<=er.min.x&&er.max.x<=this.max.x&&this.min.y<=er.min.y&&er.max.y<=this.max.y&&this.min.z<=er.min.z&&er.max.z<=this.max.z}getParameter(er,tr){return tr.set((er.x-this.min.x)/(this.max.x-this.min.x),(er.y-this.min.y)/(this.max.y-this.min.y),(er.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(er){return er.max.x>=this.min.x&&er.min.x<=this.max.x&&er.max.y>=this.min.y&&er.min.y<=this.max.y&&er.max.z>=this.min.z&&er.min.z<=this.max.z}intersectsSphere(er){return this.clampPoint(er.center,_vector$b),_vector$b.distanceToSquared(er.center)<=er.radius*er.radius}intersectsPlane(er){let tr,ir;return er.normal.x>0?(tr=er.normal.x*this.min.x,ir=er.normal.x*this.max.x):(tr=er.normal.x*this.max.x,ir=er.normal.x*this.min.x),er.normal.y>0?(tr+=er.normal.y*this.min.y,ir+=er.normal.y*this.max.y):(tr+=er.normal.y*this.max.y,ir+=er.normal.y*this.min.y),er.normal.z>0?(tr+=er.normal.z*this.min.z,ir+=er.normal.z*this.max.z):(tr+=er.normal.z*this.max.z,ir+=er.normal.z*this.min.z),tr<=-er.constant&&ir>=-er.constant}intersectsTriangle(er){if(this.isEmpty())return!1;this.getCenter(_center$3),_extents.subVectors(this.max,_center$3),_v0$3.subVectors(er.a,_center$3),_v1$7.subVectors(er.b,_center$3),_v2$4$1.subVectors(er.c,_center$3),_f0.subVectors(_v1$7,_v0$3),_f1.subVectors(_v2$4$1,_v1$7),_f2.subVectors(_v0$3,_v2$4$1);let tr=[0,-_f0.z,_f0.y,0,-_f1.z,_f1.y,0,-_f2.z,_f2.y,_f0.z,0,-_f0.x,_f1.z,0,-_f1.x,_f2.z,0,-_f2.x,-_f0.y,_f0.x,0,-_f1.y,_f1.x,0,-_f2.y,_f2.x,0];return!satForAxes(tr,_v0$3,_v1$7,_v2$4$1,_extents)||(tr=[1,0,0,0,1,0,0,0,1],!satForAxes(tr,_v0$3,_v1$7,_v2$4$1,_extents))?!1:(_triangleNormal.crossVectors(_f0,_f1),tr=[_triangleNormal.x,_triangleNormal.y,_triangleNormal.z],satForAxes(tr,_v0$3,_v1$7,_v2$4$1,_extents))}clampPoint(er,tr){return tr.copy(er).clamp(this.min,this.max)}distanceToPoint(er){return this.clampPoint(er,_vector$b).distanceTo(er)}getBoundingSphere(er){return this.isEmpty()?er.makeEmpty():(this.getCenter(er.center),er.radius=this.getSize(_vector$b).length()*.5),er}intersect(er){return this.min.max(er.min),this.max.min(er.max),this.isEmpty()&&this.makeEmpty(),this}union(er){return this.min.min(er.min),this.max.max(er.max),this}applyMatrix4(er){return this.isEmpty()?this:(_points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(er),_points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(er),_points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(er),_points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(er),_points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(er),_points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(er),_points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(er),_points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(er),this.setFromPoints(_points),this)}translate(er){return this.min.add(er),this.max.add(er),this}equals(er){return er.min.equals(this.min)&&er.max.equals(this.max)}}const _points=[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],_vector$b=new Vector3$1,_box$4=new Box3,_v0$3=new Vector3$1,_v1$7=new Vector3$1,_v2$4$1=new Vector3$1,_f0=new Vector3$1,_f1=new Vector3$1,_f2=new Vector3$1,_center$3=new Vector3$1,_extents=new Vector3$1,_triangleNormal=new Vector3$1,_testAxis=new Vector3$1;function satForAxes(rr,er,tr,ir,nr){for(let sr=0,ar=rr.length-3;sr<=ar;sr+=3){_testAxis.fromArray(rr,sr);const or=nr.x*Math.abs(_testAxis.x)+nr.y*Math.abs(_testAxis.y)+nr.z*Math.abs(_testAxis.z),lr=er.dot(_testAxis),cr=tr.dot(_testAxis),ur=ir.dot(_testAxis);if(Math.max(-Math.max(lr,cr,ur),Math.min(lr,cr,ur))>or)return!1}return!0}const _box$3=new Box3,_v1$6=new Vector3$1,_v2$3$1=new Vector3$1;class Sphere{constructor(er=new Vector3$1,tr=-1){this.isSphere=!0,this.center=er,this.radius=tr}set(er,tr){return this.center.copy(er),this.radius=tr,this}setFromPoints(er,tr){const ir=this.center;tr!==void 0?ir.copy(tr):_box$3.setFromPoints(er).getCenter(ir);let nr=0;for(let sr=0,ar=er.length;sr<ar;sr++)nr=Math.max(nr,ir.distanceToSquared(er[sr]));return this.radius=Math.sqrt(nr),this}copy(er){return this.center.copy(er.center),this.radius=er.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(er){return er.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(er){return er.distanceTo(this.center)-this.radius}intersectsSphere(er){const tr=this.radius+er.radius;return er.center.distanceToSquared(this.center)<=tr*tr}intersectsBox(er){return er.intersectsSphere(this)}intersectsPlane(er){return Math.abs(er.distanceToPoint(this.center))<=this.radius}clampPoint(er,tr){const ir=this.center.distanceToSquared(er);return tr.copy(er),ir>this.radius*this.radius&&(tr.sub(this.center).normalize(),tr.multiplyScalar(this.radius).add(this.center)),tr}getBoundingBox(er){return this.isEmpty()?(er.makeEmpty(),er):(er.set(this.center,this.center),er.expandByScalar(this.radius),er)}applyMatrix4(er){return this.center.applyMatrix4(er),this.radius=this.radius*er.getMaxScaleOnAxis(),this}translate(er){return this.center.add(er),this}expandByPoint(er){if(this.isEmpty())return this.center.copy(er),this.radius=0,this;_v1$6.subVectors(er,this.center);const tr=_v1$6.lengthSq();if(tr>this.radius*this.radius){const ir=Math.sqrt(tr),nr=(ir-this.radius)*.5;this.center.addScaledVector(_v1$6,nr/ir),this.radius+=nr}return this}union(er){return er.isEmpty()?this:this.isEmpty()?(this.copy(er),this):(this.center.equals(er.center)===!0?this.radius=Math.max(this.radius,er.radius):(_v2$3$1.subVectors(er.center,this.center).setLength(er.radius),this.expandByPoint(_v1$6.copy(er.center).add(_v2$3$1)),this.expandByPoint(_v1$6.copy(er.center).sub(_v2$3$1))),this)}equals(er){return er.center.equals(this.center)&&er.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _vector$a=new Vector3$1,_segCenter=new Vector3$1,_segDir=new Vector3$1,_diff$1=new Vector3$1,_edge1=new Vector3$1,_edge2=new Vector3$1,_normal$1=new Vector3$1;let Ray$1=class{constructor(er=new Vector3$1,tr=new Vector3$1(0,0,-1)){this.origin=er,this.direction=tr}set(er,tr){return this.origin.copy(er),this.direction.copy(tr),this}copy(er){return this.origin.copy(er.origin),this.direction.copy(er.direction),this}at(er,tr){return tr.copy(this.origin).addScaledVector(this.direction,er)}lookAt(er){return this.direction.copy(er).sub(this.origin).normalize(),this}recast(er){return this.origin.copy(this.at(er,_vector$a)),this}closestPointToPoint(er,tr){tr.subVectors(er,this.origin);const ir=tr.dot(this.direction);return ir<0?tr.copy(this.origin):tr.copy(this.origin).addScaledVector(this.direction,ir)}distanceToPoint(er){return Math.sqrt(this.distanceSqToPoint(er))}distanceSqToPoint(er){const tr=_vector$a.subVectors(er,this.origin).dot(this.direction);return tr<0?this.origin.distanceToSquared(er):(_vector$a.copy(this.origin).addScaledVector(this.direction,tr),_vector$a.distanceToSquared(er))}distanceSqToSegment(er,tr,ir,nr){_segCenter.copy(er).add(tr).multiplyScalar(.5),_segDir.copy(tr).sub(er).normalize(),_diff$1.copy(this.origin).sub(_segCenter);const sr=er.distanceTo(tr)*.5,ar=-this.direction.dot(_segDir),or=_diff$1.dot(this.direction),lr=-_diff$1.dot(_segDir),cr=_diff$1.lengthSq(),ur=Math.abs(1-ar*ar);let dr,hr,pr,gr;if(ur>0)if(dr=ar*lr-or,hr=ar*or-lr,gr=sr*ur,dr>=0)if(hr>=-gr)if(hr<=gr){const vr=1/ur;dr*=vr,hr*=vr,pr=dr*(dr+ar*hr+2*or)+hr*(ar*dr+hr+2*lr)+cr}else hr=sr,dr=Math.max(0,-(ar*hr+or)),pr=-dr*dr+hr*(hr+2*lr)+cr;else hr=-sr,dr=Math.max(0,-(ar*hr+or)),pr=-dr*dr+hr*(hr+2*lr)+cr;else hr<=-gr?(dr=Math.max(0,-(-ar*sr+or)),hr=dr>0?-sr:Math.min(Math.max(-sr,-lr),sr),pr=-dr*dr+hr*(hr+2*lr)+cr):hr<=gr?(dr=0,hr=Math.min(Math.max(-sr,-lr),sr),pr=hr*(hr+2*lr)+cr):(dr=Math.max(0,-(ar*sr+or)),hr=dr>0?sr:Math.min(Math.max(-sr,-lr),sr),pr=-dr*dr+hr*(hr+2*lr)+cr);else hr=ar>0?-sr:sr,dr=Math.max(0,-(ar*hr+or)),pr=-dr*dr+hr*(hr+2*lr)+cr;return ir&&ir.copy(this.origin).addScaledVector(this.direction,dr),nr&&nr.copy(_segCenter).addScaledVector(_segDir,hr),pr}intersectSphere(er,tr){_vector$a.subVectors(er.center,this.origin);const ir=_vector$a.dot(this.direction),nr=_vector$a.dot(_vector$a)-ir*ir,sr=er.radius*er.radius;if(nr>sr)return null;const ar=Math.sqrt(sr-nr),or=ir-ar,lr=ir+ar;return lr<0?null:or<0?this.at(lr,tr):this.at(or,tr)}intersectsSphere(er){return this.distanceSqToPoint(er.center)<=er.radius*er.radius}distanceToPlane(er){const tr=er.normal.dot(this.direction);if(tr===0)return er.distanceToPoint(this.origin)===0?0:null;const ir=-(this.origin.dot(er.normal)+er.constant)/tr;return ir>=0?ir:null}intersectPlane(er,tr){const ir=this.distanceToPlane(er);return ir===null?null:this.at(ir,tr)}intersectsPlane(er){const tr=er.distanceToPoint(this.origin);return tr===0||er.normal.dot(this.direction)*tr<0}intersectBox(er,tr){let ir,nr,sr,ar,or,lr;const cr=1/this.direction.x,ur=1/this.direction.y,dr=1/this.direction.z,hr=this.origin;return cr>=0?(ir=(er.min.x-hr.x)*cr,nr=(er.max.x-hr.x)*cr):(ir=(er.max.x-hr.x)*cr,nr=(er.min.x-hr.x)*cr),ur>=0?(sr=(er.min.y-hr.y)*ur,ar=(er.max.y-hr.y)*ur):(sr=(er.max.y-hr.y)*ur,ar=(er.min.y-hr.y)*ur),ir>ar||sr>nr||((sr>ir||isNaN(ir))&&(ir=sr),(ar<nr||isNaN(nr))&&(nr=ar),dr>=0?(or=(er.min.z-hr.z)*dr,lr=(er.max.z-hr.z)*dr):(or=(er.max.z-hr.z)*dr,lr=(er.min.z-hr.z)*dr),ir>lr||or>nr)||((or>ir||ir!==ir)&&(ir=or),(lr<nr||nr!==nr)&&(nr=lr),nr<0)?null:this.at(ir>=0?ir:nr,tr)}intersectsBox(er){return this.intersectBox(er,_vector$a)!==null}intersectTriangle(er,tr,ir,nr,sr){_edge1.subVectors(tr,er),_edge2.subVectors(ir,er),_normal$1.crossVectors(_edge1,_edge2);let ar=this.direction.dot(_normal$1),or;if(ar>0){if(nr)return null;or=1}else if(ar<0)or=-1,ar=-ar;else return null;_diff$1.subVectors(this.origin,er);const lr=or*this.direction.dot(_edge2.crossVectors(_diff$1,_edge2));if(lr<0)return null;const cr=or*this.direction.dot(_edge1.cross(_diff$1));if(cr<0||lr+cr>ar)return null;const ur=-or*_diff$1.dot(_normal$1);return ur<0?null:this.at(ur/ar,sr)}applyMatrix4(er){return this.origin.applyMatrix4(er),this.direction.transformDirection(er),this}equals(er){return er.origin.equals(this.origin)&&er.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class Matrix4{constructor(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr,vr,mr){Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],er!==void 0&&this.set(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr,vr,mr)}set(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr,vr,mr){const fr=this.elements;return fr[0]=er,fr[4]=tr,fr[8]=ir,fr[12]=nr,fr[1]=sr,fr[5]=ar,fr[9]=or,fr[13]=lr,fr[2]=cr,fr[6]=ur,fr[10]=dr,fr[14]=hr,fr[3]=pr,fr[7]=gr,fr[11]=vr,fr[15]=mr,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(er){const tr=this.elements,ir=er.elements;return tr[0]=ir[0],tr[1]=ir[1],tr[2]=ir[2],tr[3]=ir[3],tr[4]=ir[4],tr[5]=ir[5],tr[6]=ir[6],tr[7]=ir[7],tr[8]=ir[8],tr[9]=ir[9],tr[10]=ir[10],tr[11]=ir[11],tr[12]=ir[12],tr[13]=ir[13],tr[14]=ir[14],tr[15]=ir[15],this}copyPosition(er){const tr=this.elements,ir=er.elements;return tr[12]=ir[12],tr[13]=ir[13],tr[14]=ir[14],this}setFromMatrix3(er){const tr=er.elements;return this.set(tr[0],tr[3],tr[6],0,tr[1],tr[4],tr[7],0,tr[2],tr[5],tr[8],0,0,0,0,1),this}extractBasis(er,tr,ir){return er.setFromMatrixColumn(this,0),tr.setFromMatrixColumn(this,1),ir.setFromMatrixColumn(this,2),this}makeBasis(er,tr,ir){return this.set(er.x,tr.x,ir.x,0,er.y,tr.y,ir.y,0,er.z,tr.z,ir.z,0,0,0,0,1),this}extractRotation(er){const tr=this.elements,ir=er.elements,nr=1/_v1$5$1.setFromMatrixColumn(er,0).length(),sr=1/_v1$5$1.setFromMatrixColumn(er,1).length(),ar=1/_v1$5$1.setFromMatrixColumn(er,2).length();return tr[0]=ir[0]*nr,tr[1]=ir[1]*nr,tr[2]=ir[2]*nr,tr[3]=0,tr[4]=ir[4]*sr,tr[5]=ir[5]*sr,tr[6]=ir[6]*sr,tr[7]=0,tr[8]=ir[8]*ar,tr[9]=ir[9]*ar,tr[10]=ir[10]*ar,tr[11]=0,tr[12]=0,tr[13]=0,tr[14]=0,tr[15]=1,this}makeRotationFromEuler(er){const tr=this.elements,ir=er.x,nr=er.y,sr=er.z,ar=Math.cos(ir),or=Math.sin(ir),lr=Math.cos(nr),cr=Math.sin(nr),ur=Math.cos(sr),dr=Math.sin(sr);if(er.order==="XYZ"){const hr=ar*ur,pr=ar*dr,gr=or*ur,vr=or*dr;tr[0]=lr*ur,tr[4]=-lr*dr,tr[8]=cr,tr[1]=pr+gr*cr,tr[5]=hr-vr*cr,tr[9]=-or*lr,tr[2]=vr-hr*cr,tr[6]=gr+pr*cr,tr[10]=ar*lr}else if(er.order==="YXZ"){const hr=lr*ur,pr=lr*dr,gr=cr*ur,vr=cr*dr;tr[0]=hr+vr*or,tr[4]=gr*or-pr,tr[8]=ar*cr,tr[1]=ar*dr,tr[5]=ar*ur,tr[9]=-or,tr[2]=pr*or-gr,tr[6]=vr+hr*or,tr[10]=ar*lr}else if(er.order==="ZXY"){const hr=lr*ur,pr=lr*dr,gr=cr*ur,vr=cr*dr;tr[0]=hr-vr*or,tr[4]=-ar*dr,tr[8]=gr+pr*or,tr[1]=pr+gr*or,tr[5]=ar*ur,tr[9]=vr-hr*or,tr[2]=-ar*cr,tr[6]=or,tr[10]=ar*lr}else if(er.order==="ZYX"){const hr=ar*ur,pr=ar*dr,gr=or*ur,vr=or*dr;tr[0]=lr*ur,tr[4]=gr*cr-pr,tr[8]=hr*cr+vr,tr[1]=lr*dr,tr[5]=vr*cr+hr,tr[9]=pr*cr-gr,tr[2]=-cr,tr[6]=or*lr,tr[10]=ar*lr}else if(er.order==="YZX"){const hr=ar*lr,pr=ar*cr,gr=or*lr,vr=or*cr;tr[0]=lr*ur,tr[4]=vr-hr*dr,tr[8]=gr*dr+pr,tr[1]=dr,tr[5]=ar*ur,tr[9]=-or*ur,tr[2]=-cr*ur,tr[6]=pr*dr+gr,tr[10]=hr-vr*dr}else if(er.order==="XZY"){const hr=ar*lr,pr=ar*cr,gr=or*lr,vr=or*cr;tr[0]=lr*ur,tr[4]=-dr,tr[8]=cr*ur,tr[1]=hr*dr+vr,tr[5]=ar*ur,tr[9]=pr*dr-gr,tr[2]=gr*dr-pr,tr[6]=or*ur,tr[10]=vr*dr+hr}return tr[3]=0,tr[7]=0,tr[11]=0,tr[12]=0,tr[13]=0,tr[14]=0,tr[15]=1,this}makeRotationFromQuaternion(er){return this.compose(_zero,er,_one)}lookAt(er,tr,ir){const nr=this.elements;return _z.subVectors(er,tr),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(ir,_z),_x.lengthSq()===0&&(Math.abs(ir.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(ir,_z)),_x.normalize(),_y.crossVectors(_z,_x),nr[0]=_x.x,nr[4]=_y.x,nr[8]=_z.x,nr[1]=_x.y,nr[5]=_y.y,nr[9]=_z.y,nr[2]=_x.z,nr[6]=_y.z,nr[10]=_z.z,this}multiply(er){return this.multiplyMatrices(this,er)}premultiply(er){return this.multiplyMatrices(er,this)}multiplyMatrices(er,tr){const ir=er.elements,nr=tr.elements,sr=this.elements,ar=ir[0],or=ir[4],lr=ir[8],cr=ir[12],ur=ir[1],dr=ir[5],hr=ir[9],pr=ir[13],gr=ir[2],vr=ir[6],mr=ir[10],fr=ir[14],_r=ir[3],Ar=ir[7],yr=ir[11],wr=ir[15],xr=nr[0],Sr=nr[4],br=nr[8],Cr=nr[12],Ir=nr[1],Rr=nr[5],Pr=nr[9],Dr=nr[13],Fr=nr[2],Or=nr[6],Nr=nr[10],Ur=nr[14],Br=nr[3],Wr=nr[7],Xr=nr[11],Yr=nr[15];return sr[0]=ar*xr+or*Ir+lr*Fr+cr*Br,sr[4]=ar*Sr+or*Rr+lr*Or+cr*Wr,sr[8]=ar*br+or*Pr+lr*Nr+cr*Xr,sr[12]=ar*Cr+or*Dr+lr*Ur+cr*Yr,sr[1]=ur*xr+dr*Ir+hr*Fr+pr*Br,sr[5]=ur*Sr+dr*Rr+hr*Or+pr*Wr,sr[9]=ur*br+dr*Pr+hr*Nr+pr*Xr,sr[13]=ur*Cr+dr*Dr+hr*Ur+pr*Yr,sr[2]=gr*xr+vr*Ir+mr*Fr+fr*Br,sr[6]=gr*Sr+vr*Rr+mr*Or+fr*Wr,sr[10]=gr*br+vr*Pr+mr*Nr+fr*Xr,sr[14]=gr*Cr+vr*Dr+mr*Ur+fr*Yr,sr[3]=_r*xr+Ar*Ir+yr*Fr+wr*Br,sr[7]=_r*Sr+Ar*Rr+yr*Or+wr*Wr,sr[11]=_r*br+Ar*Pr+yr*Nr+wr*Xr,sr[15]=_r*Cr+Ar*Dr+yr*Ur+wr*Yr,this}multiplyScalar(er){const tr=this.elements;return tr[0]*=er,tr[4]*=er,tr[8]*=er,tr[12]*=er,tr[1]*=er,tr[5]*=er,tr[9]*=er,tr[13]*=er,tr[2]*=er,tr[6]*=er,tr[10]*=er,tr[14]*=er,tr[3]*=er,tr[7]*=er,tr[11]*=er,tr[15]*=er,this}determinant(){const er=this.elements,tr=er[0],ir=er[4],nr=er[8],sr=er[12],ar=er[1],or=er[5],lr=er[9],cr=er[13],ur=er[2],dr=er[6],hr=er[10],pr=er[14],gr=er[3],vr=er[7],mr=er[11],fr=er[15];return gr*(+sr*lr*dr-nr*cr*dr-sr*or*hr+ir*cr*hr+nr*or*pr-ir*lr*pr)+vr*(+tr*lr*pr-tr*cr*hr+sr*ar*hr-nr*ar*pr+nr*cr*ur-sr*lr*ur)+mr*(+tr*cr*dr-tr*or*pr-sr*ar*dr+ir*ar*pr+sr*or*ur-ir*cr*ur)+fr*(-nr*or*ur-tr*lr*dr+tr*or*hr+nr*ar*dr-ir*ar*hr+ir*lr*ur)}transpose(){const er=this.elements;let tr;return tr=er[1],er[1]=er[4],er[4]=tr,tr=er[2],er[2]=er[8],er[8]=tr,tr=er[6],er[6]=er[9],er[9]=tr,tr=er[3],er[3]=er[12],er[12]=tr,tr=er[7],er[7]=er[13],er[13]=tr,tr=er[11],er[11]=er[14],er[14]=tr,this}setPosition(er,tr,ir){const nr=this.elements;return er.isVector3?(nr[12]=er.x,nr[13]=er.y,nr[14]=er.z):(nr[12]=er,nr[13]=tr,nr[14]=ir),this}invert(){const er=this.elements,tr=er[0],ir=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[5],lr=er[6],cr=er[7],ur=er[8],dr=er[9],hr=er[10],pr=er[11],gr=er[12],vr=er[13],mr=er[14],fr=er[15],_r=dr*mr*cr-vr*hr*cr+vr*lr*pr-or*mr*pr-dr*lr*fr+or*hr*fr,Ar=gr*hr*cr-ur*mr*cr-gr*lr*pr+ar*mr*pr+ur*lr*fr-ar*hr*fr,yr=ur*vr*cr-gr*dr*cr+gr*or*pr-ar*vr*pr-ur*or*fr+ar*dr*fr,wr=gr*dr*lr-ur*vr*lr-gr*or*hr+ar*vr*hr+ur*or*mr-ar*dr*mr,xr=tr*_r+ir*Ar+nr*yr+sr*wr;if(xr===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Sr=1/xr;return er[0]=_r*Sr,er[1]=(vr*hr*sr-dr*mr*sr-vr*nr*pr+ir*mr*pr+dr*nr*fr-ir*hr*fr)*Sr,er[2]=(or*mr*sr-vr*lr*sr+vr*nr*cr-ir*mr*cr-or*nr*fr+ir*lr*fr)*Sr,er[3]=(dr*lr*sr-or*hr*sr-dr*nr*cr+ir*hr*cr+or*nr*pr-ir*lr*pr)*Sr,er[4]=Ar*Sr,er[5]=(ur*mr*sr-gr*hr*sr+gr*nr*pr-tr*mr*pr-ur*nr*fr+tr*hr*fr)*Sr,er[6]=(gr*lr*sr-ar*mr*sr-gr*nr*cr+tr*mr*cr+ar*nr*fr-tr*lr*fr)*Sr,er[7]=(ar*hr*sr-ur*lr*sr+ur*nr*cr-tr*hr*cr-ar*nr*pr+tr*lr*pr)*Sr,er[8]=yr*Sr,er[9]=(gr*dr*sr-ur*vr*sr-gr*ir*pr+tr*vr*pr+ur*ir*fr-tr*dr*fr)*Sr,er[10]=(ar*vr*sr-gr*or*sr+gr*ir*cr-tr*vr*cr-ar*ir*fr+tr*or*fr)*Sr,er[11]=(ur*or*sr-ar*dr*sr-ur*ir*cr+tr*dr*cr+ar*ir*pr-tr*or*pr)*Sr,er[12]=wr*Sr,er[13]=(ur*vr*nr-gr*dr*nr+gr*ir*hr-tr*vr*hr-ur*ir*mr+tr*dr*mr)*Sr,er[14]=(gr*or*nr-ar*vr*nr-gr*ir*lr+tr*vr*lr+ar*ir*mr-tr*or*mr)*Sr,er[15]=(ar*dr*nr-ur*or*nr+ur*ir*lr-tr*dr*lr-ar*ir*hr+tr*or*hr)*Sr,this}scale(er){const tr=this.elements,ir=er.x,nr=er.y,sr=er.z;return tr[0]*=ir,tr[4]*=nr,tr[8]*=sr,tr[1]*=ir,tr[5]*=nr,tr[9]*=sr,tr[2]*=ir,tr[6]*=nr,tr[10]*=sr,tr[3]*=ir,tr[7]*=nr,tr[11]*=sr,this}getMaxScaleOnAxis(){const er=this.elements,tr=er[0]*er[0]+er[1]*er[1]+er[2]*er[2],ir=er[4]*er[4]+er[5]*er[5]+er[6]*er[6],nr=er[8]*er[8]+er[9]*er[9]+er[10]*er[10];return Math.sqrt(Math.max(tr,ir,nr))}makeTranslation(er,tr,ir){return er.isVector3?this.set(1,0,0,er.x,0,1,0,er.y,0,0,1,er.z,0,0,0,1):this.set(1,0,0,er,0,1,0,tr,0,0,1,ir,0,0,0,1),this}makeRotationX(er){const tr=Math.cos(er),ir=Math.sin(er);return this.set(1,0,0,0,0,tr,-ir,0,0,ir,tr,0,0,0,0,1),this}makeRotationY(er){const tr=Math.cos(er),ir=Math.sin(er);return this.set(tr,0,ir,0,0,1,0,0,-ir,0,tr,0,0,0,0,1),this}makeRotationZ(er){const tr=Math.cos(er),ir=Math.sin(er);return this.set(tr,-ir,0,0,ir,tr,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(er,tr){const ir=Math.cos(tr),nr=Math.sin(tr),sr=1-ir,ar=er.x,or=er.y,lr=er.z,cr=sr*ar,ur=sr*or;return this.set(cr*ar+ir,cr*or-nr*lr,cr*lr+nr*or,0,cr*or+nr*lr,ur*or+ir,ur*lr-nr*ar,0,cr*lr-nr*or,ur*lr+nr*ar,sr*lr*lr+ir,0,0,0,0,1),this}makeScale(er,tr,ir){return this.set(er,0,0,0,0,tr,0,0,0,0,ir,0,0,0,0,1),this}makeShear(er,tr,ir,nr,sr,ar){return this.set(1,ir,sr,0,er,1,ar,0,tr,nr,1,0,0,0,0,1),this}compose(er,tr,ir){const nr=this.elements,sr=tr._x,ar=tr._y,or=tr._z,lr=tr._w,cr=sr+sr,ur=ar+ar,dr=or+or,hr=sr*cr,pr=sr*ur,gr=sr*dr,vr=ar*ur,mr=ar*dr,fr=or*dr,_r=lr*cr,Ar=lr*ur,yr=lr*dr,wr=ir.x,xr=ir.y,Sr=ir.z;return nr[0]=(1-(vr+fr))*wr,nr[1]=(pr+yr)*wr,nr[2]=(gr-Ar)*wr,nr[3]=0,nr[4]=(pr-yr)*xr,nr[5]=(1-(hr+fr))*xr,nr[6]=(mr+_r)*xr,nr[7]=0,nr[8]=(gr+Ar)*Sr,nr[9]=(mr-_r)*Sr,nr[10]=(1-(hr+vr))*Sr,nr[11]=0,nr[12]=er.x,nr[13]=er.y,nr[14]=er.z,nr[15]=1,this}decompose(er,tr,ir){const nr=this.elements;let sr=_v1$5$1.set(nr[0],nr[1],nr[2]).length();const ar=_v1$5$1.set(nr[4],nr[5],nr[6]).length(),or=_v1$5$1.set(nr[8],nr[9],nr[10]).length();this.determinant()<0&&(sr=-sr),er.x=nr[12],er.y=nr[13],er.z=nr[14],_m1$4.copy(this);const cr=1/sr,ur=1/ar,dr=1/or;return _m1$4.elements[0]*=cr,_m1$4.elements[1]*=cr,_m1$4.elements[2]*=cr,_m1$4.elements[4]*=ur,_m1$4.elements[5]*=ur,_m1$4.elements[6]*=ur,_m1$4.elements[8]*=dr,_m1$4.elements[9]*=dr,_m1$4.elements[10]*=dr,tr.setFromRotationMatrix(_m1$4),ir.x=sr,ir.y=ar,ir.z=or,this}makePerspective(er,tr,ir,nr,sr,ar,or=WebGLCoordinateSystem){const lr=this.elements,cr=2*sr/(tr-er),ur=2*sr/(ir-nr),dr=(tr+er)/(tr-er),hr=(ir+nr)/(ir-nr);let pr,gr;if(or===WebGLCoordinateSystem)pr=-(ar+sr)/(ar-sr),gr=-2*ar*sr/(ar-sr);else if(or===WebGPUCoordinateSystem)pr=-ar/(ar-sr),gr=-ar*sr/(ar-sr);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+or);return lr[0]=cr,lr[4]=0,lr[8]=dr,lr[12]=0,lr[1]=0,lr[5]=ur,lr[9]=hr,lr[13]=0,lr[2]=0,lr[6]=0,lr[10]=pr,lr[14]=gr,lr[3]=0,lr[7]=0,lr[11]=-1,lr[15]=0,this}makeOrthographic(er,tr,ir,nr,sr,ar,or=WebGLCoordinateSystem){const lr=this.elements,cr=1/(tr-er),ur=1/(ir-nr),dr=1/(ar-sr),hr=(tr+er)*cr,pr=(ir+nr)*ur;let gr,vr;if(or===WebGLCoordinateSystem)gr=(ar+sr)*dr,vr=-2*dr;else if(or===WebGPUCoordinateSystem)gr=sr*dr,vr=-1*dr;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+or);return lr[0]=2*cr,lr[4]=0,lr[8]=0,lr[12]=-hr,lr[1]=0,lr[5]=2*ur,lr[9]=0,lr[13]=-pr,lr[2]=0,lr[6]=0,lr[10]=vr,lr[14]=-gr,lr[3]=0,lr[7]=0,lr[11]=0,lr[15]=1,this}equals(er){const tr=this.elements,ir=er.elements;for(let nr=0;nr<16;nr++)if(tr[nr]!==ir[nr])return!1;return!0}fromArray(er,tr=0){for(let ir=0;ir<16;ir++)this.elements[ir]=er[ir+tr];return this}toArray(er=[],tr=0){const ir=this.elements;return er[tr]=ir[0],er[tr+1]=ir[1],er[tr+2]=ir[2],er[tr+3]=ir[3],er[tr+4]=ir[4],er[tr+5]=ir[5],er[tr+6]=ir[6],er[tr+7]=ir[7],er[tr+8]=ir[8],er[tr+9]=ir[9],er[tr+10]=ir[10],er[tr+11]=ir[11],er[tr+12]=ir[12],er[tr+13]=ir[13],er[tr+14]=ir[14],er[tr+15]=ir[15],er}}const _v1$5$1=new Vector3$1,_m1$4=new Matrix4,_zero=new Vector3$1(0,0,0),_one=new Vector3$1(1,1,1),_x=new Vector3$1,_y=new Vector3$1,_z=new Vector3$1,_matrix$2$1=new Matrix4,_quaternion$3$1=new Quaternion$1;class Euler{constructor(er=0,tr=0,ir=0,nr=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=er,this._y=tr,this._z=ir,this._order=nr}get x(){return this._x}set x(er){this._x=er,this._onChangeCallback()}get y(){return this._y}set y(er){this._y=er,this._onChangeCallback()}get z(){return this._z}set z(er){this._z=er,this._onChangeCallback()}get order(){return this._order}set order(er){this._order=er,this._onChangeCallback()}set(er,tr,ir,nr=this._order){return this._x=er,this._y=tr,this._z=ir,this._order=nr,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(er){return this._x=er._x,this._y=er._y,this._z=er._z,this._order=er._order,this._onChangeCallback(),this}setFromRotationMatrix(er,tr=this._order,ir=!0){const nr=er.elements,sr=nr[0],ar=nr[4],or=nr[8],lr=nr[1],cr=nr[5],ur=nr[9],dr=nr[2],hr=nr[6],pr=nr[10];switch(tr){case"XYZ":this._y=Math.asin(clamp(or,-1,1)),Math.abs(or)<.9999999?(this._x=Math.atan2(-ur,pr),this._z=Math.atan2(-ar,sr)):(this._x=Math.atan2(hr,cr),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(ur,-1,1)),Math.abs(ur)<.9999999?(this._y=Math.atan2(or,pr),this._z=Math.atan2(lr,cr)):(this._y=Math.atan2(-dr,sr),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(hr,-1,1)),Math.abs(hr)<.9999999?(this._y=Math.atan2(-dr,pr),this._z=Math.atan2(-ar,cr)):(this._y=0,this._z=Math.atan2(lr,sr));break;case"ZYX":this._y=Math.asin(-clamp(dr,-1,1)),Math.abs(dr)<.9999999?(this._x=Math.atan2(hr,pr),this._z=Math.atan2(lr,sr)):(this._x=0,this._z=Math.atan2(-ar,cr));break;case"YZX":this._z=Math.asin(clamp(lr,-1,1)),Math.abs(lr)<.9999999?(this._x=Math.atan2(-ur,cr),this._y=Math.atan2(-dr,sr)):(this._x=0,this._y=Math.atan2(or,pr));break;case"XZY":this._z=Math.asin(-clamp(ar,-1,1)),Math.abs(ar)<.9999999?(this._x=Math.atan2(hr,cr),this._y=Math.atan2(or,sr)):(this._x=Math.atan2(-ur,pr),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+tr)}return this._order=tr,ir===!0&&this._onChangeCallback(),this}setFromQuaternion(er,tr,ir){return _matrix$2$1.makeRotationFromQuaternion(er),this.setFromRotationMatrix(_matrix$2$1,tr,ir)}setFromVector3(er,tr=this._order){return this.set(er.x,er.y,er.z,tr)}reorder(er){return _quaternion$3$1.setFromEuler(this),this.setFromQuaternion(_quaternion$3$1,er)}equals(er){return er._x===this._x&&er._y===this._y&&er._z===this._z&&er._order===this._order}fromArray(er){return this._x=er[0],this._y=er[1],this._z=er[2],er[3]!==void 0&&(this._order=er[3]),this._onChangeCallback(),this}toArray(er=[],tr=0){return er[tr]=this._x,er[tr+1]=this._y,er[tr+2]=this._z,er[tr+3]=this._order,er}_onChange(er){return this._onChangeCallback=er,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Layers{constructor(){this.mask=1}set(er){this.mask=(1<<er|0)>>>0}enable(er){this.mask|=1<<er|0}enableAll(){this.mask=-1}toggle(er){this.mask^=1<<er|0}disable(er){this.mask&=~(1<<er|0)}disableAll(){this.mask=0}test(er){return(this.mask&er.mask)!==0}isEnabled(er){return(this.mask&(1<<er|0))!==0}}let _object3DId=0;const _v1$4$1=new Vector3$1,_q1=new Quaternion$1,_m1$3=new Matrix4,_target$1=new Vector3$1,_position$3=new Vector3$1,_scale$2$1=new Vector3$1,_quaternion$2$1=new Quaternion$1,_xAxis=new Vector3$1(1,0,0),_yAxis=new Vector3$1(0,1,0),_zAxis=new Vector3$1(0,0,1),_addedEvent={type:"added"},_removedEvent={type:"removed"},_childaddedEvent={type:"childadded",child:null},_childremovedEvent={type:"childremoved",child:null};class Object3D extends EventDispatcher{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_object3DId++}),this.uuid=generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DEFAULT_UP.clone();const er=new Vector3$1,tr=new Euler,ir=new Quaternion$1,nr=new Vector3$1(1,1,1);function sr(){ir.setFromEuler(tr,!1)}function ar(){tr.setFromQuaternion(ir,void 0,!1)}tr._onChange(sr),ir._onChange(ar),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:er},rotation:{configurable:!0,enumerable:!0,value:tr},quaternion:{configurable:!0,enumerable:!0,value:ir},scale:{configurable:!0,enumerable:!0,value:nr},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(er){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(er),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(er){return this.quaternion.premultiply(er),this}setRotationFromAxisAngle(er,tr){this.quaternion.setFromAxisAngle(er,tr)}setRotationFromEuler(er){this.quaternion.setFromEuler(er,!0)}setRotationFromMatrix(er){this.quaternion.setFromRotationMatrix(er)}setRotationFromQuaternion(er){this.quaternion.copy(er)}rotateOnAxis(er,tr){return _q1.setFromAxisAngle(er,tr),this.quaternion.multiply(_q1),this}rotateOnWorldAxis(er,tr){return _q1.setFromAxisAngle(er,tr),this.quaternion.premultiply(_q1),this}rotateX(er){return this.rotateOnAxis(_xAxis,er)}rotateY(er){return this.rotateOnAxis(_yAxis,er)}rotateZ(er){return this.rotateOnAxis(_zAxis,er)}translateOnAxis(er,tr){return _v1$4$1.copy(er).applyQuaternion(this.quaternion),this.position.add(_v1$4$1.multiplyScalar(tr)),this}translateX(er){return this.translateOnAxis(_xAxis,er)}translateY(er){return this.translateOnAxis(_yAxis,er)}translateZ(er){return this.translateOnAxis(_zAxis,er)}localToWorld(er){return this.updateWorldMatrix(!0,!1),er.applyMatrix4(this.matrixWorld)}worldToLocal(er){return this.updateWorldMatrix(!0,!1),er.applyMatrix4(_m1$3.copy(this.matrixWorld).invert())}lookAt(er,tr,ir){er.isVector3?_target$1.copy(er):_target$1.set(er,tr,ir);const nr=this.parent;this.updateWorldMatrix(!0,!1),_position$3.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?_m1$3.lookAt(_position$3,_target$1,this.up):_m1$3.lookAt(_target$1,_position$3,this.up),this.quaternion.setFromRotationMatrix(_m1$3),nr&&(_m1$3.extractRotation(nr.matrixWorld),_q1.setFromRotationMatrix(_m1$3),this.quaternion.premultiply(_q1.invert()))}add(er){if(arguments.length>1){for(let tr=0;tr<arguments.length;tr++)this.add(arguments[tr]);return this}return er===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",er),this):(er&&er.isObject3D?(er.removeFromParent(),er.parent=this,this.children.push(er),er.dispatchEvent(_addedEvent),_childaddedEvent.child=er,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",er),this)}remove(er){if(arguments.length>1){for(let ir=0;ir<arguments.length;ir++)this.remove(arguments[ir]);return this}const tr=this.children.indexOf(er);return tr!==-1&&(er.parent=null,this.children.splice(tr,1),er.dispatchEvent(_removedEvent),_childremovedEvent.child=er,this.dispatchEvent(_childremovedEvent),_childremovedEvent.child=null),this}removeFromParent(){const er=this.parent;return er!==null&&er.remove(this),this}clear(){return this.remove(...this.children)}attach(er){return this.updateWorldMatrix(!0,!1),_m1$3.copy(this.matrixWorld).invert(),er.parent!==null&&(er.parent.updateWorldMatrix(!0,!1),_m1$3.multiply(er.parent.matrixWorld)),er.applyMatrix4(_m1$3),er.removeFromParent(),er.parent=this,this.children.push(er),er.updateWorldMatrix(!1,!0),er.dispatchEvent(_addedEvent),_childaddedEvent.child=er,this.dispatchEvent(_childaddedEvent),_childaddedEvent.child=null,this}getObjectById(er){return this.getObjectByProperty("id",er)}getObjectByName(er){return this.getObjectByProperty("name",er)}getObjectByProperty(er,tr){if(this[er]===tr)return this;for(let ir=0,nr=this.children.length;ir<nr;ir++){const ar=this.children[ir].getObjectByProperty(er,tr);if(ar!==void 0)return ar}}getObjectsByProperty(er,tr,ir=[]){this[er]===tr&&ir.push(this);const nr=this.children;for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].getObjectsByProperty(er,tr,ir);return ir}getWorldPosition(er){return this.updateWorldMatrix(!0,!1),er.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(er){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,er,_scale$2$1),er}getWorldScale(er){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(_position$3,_quaternion$2$1,er),er}getWorldDirection(er){this.updateWorldMatrix(!0,!1);const tr=this.matrixWorld.elements;return er.set(tr[8],tr[9],tr[10]).normalize()}raycast(){}traverse(er){er(this);const tr=this.children;for(let ir=0,nr=tr.length;ir<nr;ir++)tr[ir].traverse(er)}traverseVisible(er){if(this.visible===!1)return;er(this);const tr=this.children;for(let ir=0,nr=tr.length;ir<nr;ir++)tr[ir].traverseVisible(er)}traverseAncestors(er){const tr=this.parent;tr!==null&&(er(tr),tr.traverseAncestors(er))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(er){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||er)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,er=!0);const tr=this.children;for(let ir=0,nr=tr.length;ir<nr;ir++)tr[ir].updateMatrixWorld(er)}updateWorldMatrix(er,tr){const ir=this.parent;if(er===!0&&ir!==null&&ir.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),tr===!0){const nr=this.children;for(let sr=0,ar=nr.length;sr<ar;sr++)nr[sr].updateWorldMatrix(!1,!0)}}toJSON(er){const tr=er===void 0||typeof er=="string",ir={};tr&&(er={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},ir.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const nr={};nr.uuid=this.uuid,nr.type=this.type,this.name!==""&&(nr.name=this.name),this.castShadow===!0&&(nr.castShadow=!0),this.receiveShadow===!0&&(nr.receiveShadow=!0),this.visible===!1&&(nr.visible=!1),this.frustumCulled===!1&&(nr.frustumCulled=!1),this.renderOrder!==0&&(nr.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(nr.userData=this.userData),nr.layers=this.layers.mask,nr.matrix=this.matrix.toArray(),nr.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(nr.matrixAutoUpdate=!1),this.isInstancedMesh&&(nr.type="InstancedMesh",nr.count=this.count,nr.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(nr.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(nr.type="BatchedMesh",nr.perObjectFrustumCulled=this.perObjectFrustumCulled,nr.sortObjects=this.sortObjects,nr.drawRanges=this._drawRanges,nr.reservedRanges=this._reservedRanges,nr.visibility=this._visibility,nr.active=this._active,nr.bounds=this._bounds.map(or=>({boxInitialized:or.boxInitialized,boxMin:or.box.min.toArray(),boxMax:or.box.max.toArray(),sphereInitialized:or.sphereInitialized,sphereRadius:or.sphere.radius,sphereCenter:or.sphere.center.toArray()})),nr.maxInstanceCount=this._maxInstanceCount,nr.maxVertexCount=this._maxVertexCount,nr.maxIndexCount=this._maxIndexCount,nr.geometryInitialized=this._geometryInitialized,nr.geometryCount=this._geometryCount,nr.matricesTexture=this._matricesTexture.toJSON(er),this._colorsTexture!==null&&(nr.colorsTexture=this._colorsTexture.toJSON(er)),this.boundingSphere!==null&&(nr.boundingSphere={center:nr.boundingSphere.center.toArray(),radius:nr.boundingSphere.radius}),this.boundingBox!==null&&(nr.boundingBox={min:nr.boundingBox.min.toArray(),max:nr.boundingBox.max.toArray()}));function sr(or,lr){return or[lr.uuid]===void 0&&(or[lr.uuid]=lr.toJSON(er)),lr.uuid}if(this.isScene)this.background&&(this.background.isColor?nr.background=this.background.toJSON():this.background.isTexture&&(nr.background=this.background.toJSON(er).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(nr.environment=this.environment.toJSON(er).uuid);else if(this.isMesh||this.isLine||this.isPoints){nr.geometry=sr(er.geometries,this.geometry);const or=this.geometry.parameters;if(or!==void 0&&or.shapes!==void 0){const lr=or.shapes;if(Array.isArray(lr))for(let cr=0,ur=lr.length;cr<ur;cr++){const dr=lr[cr];sr(er.shapes,dr)}else sr(er.shapes,lr)}}if(this.isSkinnedMesh&&(nr.bindMode=this.bindMode,nr.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(sr(er.skeletons,this.skeleton),nr.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const or=[];for(let lr=0,cr=this.material.length;lr<cr;lr++)or.push(sr(er.materials,this.material[lr]));nr.material=or}else nr.material=sr(er.materials,this.material);if(this.children.length>0){nr.children=[];for(let or=0;or<this.children.length;or++)nr.children.push(this.children[or].toJSON(er).object)}if(this.animations.length>0){nr.animations=[];for(let or=0;or<this.animations.length;or++){const lr=this.animations[or];nr.animations.push(sr(er.animations,lr))}}if(tr){const or=ar(er.geometries),lr=ar(er.materials),cr=ar(er.textures),ur=ar(er.images),dr=ar(er.shapes),hr=ar(er.skeletons),pr=ar(er.animations),gr=ar(er.nodes);or.length>0&&(ir.geometries=or),lr.length>0&&(ir.materials=lr),cr.length>0&&(ir.textures=cr),ur.length>0&&(ir.images=ur),dr.length>0&&(ir.shapes=dr),hr.length>0&&(ir.skeletons=hr),pr.length>0&&(ir.animations=pr),gr.length>0&&(ir.nodes=gr)}return ir.object=nr,ir;function ar(or){const lr=[];for(const cr in or){const ur=or[cr];delete ur.metadata,lr.push(ur)}return lr}}clone(er){return new this.constructor().copy(this,er)}copy(er,tr=!0){if(this.name=er.name,this.up.copy(er.up),this.position.copy(er.position),this.rotation.order=er.rotation.order,this.quaternion.copy(er.quaternion),this.scale.copy(er.scale),this.matrix.copy(er.matrix),this.matrixWorld.copy(er.matrixWorld),this.matrixAutoUpdate=er.matrixAutoUpdate,this.matrixWorldAutoUpdate=er.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=er.matrixWorldNeedsUpdate,this.layers.mask=er.layers.mask,this.visible=er.visible,this.castShadow=er.castShadow,this.receiveShadow=er.receiveShadow,this.frustumCulled=er.frustumCulled,this.renderOrder=er.renderOrder,this.animations=er.animations.slice(),this.userData=JSON.parse(JSON.stringify(er.userData)),tr===!0)for(let ir=0;ir<er.children.length;ir++){const nr=er.children[ir];this.add(nr.clone())}return this}}Object3D.DEFAULT_UP=new Vector3$1(0,1,0);Object3D.DEFAULT_MATRIX_AUTO_UPDATE=!0;Object3D.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const _v0$2=new Vector3$1,_v1$3$1=new Vector3$1,_v2$2$1=new Vector3$1,_v3$2=new Vector3$1,_vab=new Vector3$1,_vac=new Vector3$1,_vbc=new Vector3$1,_vap=new Vector3$1,_vbp=new Vector3$1,_vcp=new Vector3$1,_v40=new Vector4,_v41=new Vector4,_v42=new Vector4;let Triangle$2=class io{constructor(er=new Vector3$1,tr=new Vector3$1,ir=new Vector3$1){this.a=er,this.b=tr,this.c=ir}static getNormal(er,tr,ir,nr){nr.subVectors(ir,tr),_v0$2.subVectors(er,tr),nr.cross(_v0$2);const sr=nr.lengthSq();return sr>0?nr.multiplyScalar(1/Math.sqrt(sr)):nr.set(0,0,0)}static getBarycoord(er,tr,ir,nr,sr){_v0$2.subVectors(nr,tr),_v1$3$1.subVectors(ir,tr),_v2$2$1.subVectors(er,tr);const ar=_v0$2.dot(_v0$2),or=_v0$2.dot(_v1$3$1),lr=_v0$2.dot(_v2$2$1),cr=_v1$3$1.dot(_v1$3$1),ur=_v1$3$1.dot(_v2$2$1),dr=ar*cr-or*or;if(dr===0)return sr.set(0,0,0),null;const hr=1/dr,pr=(cr*lr-or*ur)*hr,gr=(ar*ur-or*lr)*hr;return sr.set(1-pr-gr,gr,pr)}static containsPoint(er,tr,ir,nr){return this.getBarycoord(er,tr,ir,nr,_v3$2)===null?!1:_v3$2.x>=0&&_v3$2.y>=0&&_v3$2.x+_v3$2.y<=1}static getInterpolation(er,tr,ir,nr,sr,ar,or,lr){return this.getBarycoord(er,tr,ir,nr,_v3$2)===null?(lr.x=0,lr.y=0,"z"in lr&&(lr.z=0),"w"in lr&&(lr.w=0),null):(lr.setScalar(0),lr.addScaledVector(sr,_v3$2.x),lr.addScaledVector(ar,_v3$2.y),lr.addScaledVector(or,_v3$2.z),lr)}static getInterpolatedAttribute(er,tr,ir,nr,sr,ar){return _v40.setScalar(0),_v41.setScalar(0),_v42.setScalar(0),_v40.fromBufferAttribute(er,tr),_v41.fromBufferAttribute(er,ir),_v42.fromBufferAttribute(er,nr),ar.setScalar(0),ar.addScaledVector(_v40,sr.x),ar.addScaledVector(_v41,sr.y),ar.addScaledVector(_v42,sr.z),ar}static isFrontFacing(er,tr,ir,nr){return _v0$2.subVectors(ir,tr),_v1$3$1.subVectors(er,tr),_v0$2.cross(_v1$3$1).dot(nr)<0}set(er,tr,ir){return this.a.copy(er),this.b.copy(tr),this.c.copy(ir),this}setFromPointsAndIndices(er,tr,ir,nr){return this.a.copy(er[tr]),this.b.copy(er[ir]),this.c.copy(er[nr]),this}setFromAttributeAndIndices(er,tr,ir,nr){return this.a.fromBufferAttribute(er,tr),this.b.fromBufferAttribute(er,ir),this.c.fromBufferAttribute(er,nr),this}clone(){return new this.constructor().copy(this)}copy(er){return this.a.copy(er.a),this.b.copy(er.b),this.c.copy(er.c),this}getArea(){return _v0$2.subVectors(this.c,this.b),_v1$3$1.subVectors(this.a,this.b),_v0$2.cross(_v1$3$1).length()*.5}getMidpoint(er){return er.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(er){return io.getNormal(this.a,this.b,this.c,er)}getPlane(er){return er.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(er,tr){return io.getBarycoord(er,this.a,this.b,this.c,tr)}getInterpolation(er,tr,ir,nr,sr){return io.getInterpolation(er,this.a,this.b,this.c,tr,ir,nr,sr)}containsPoint(er){return io.containsPoint(er,this.a,this.b,this.c)}isFrontFacing(er){return io.isFrontFacing(this.a,this.b,this.c,er)}intersectsBox(er){return er.intersectsTriangle(this)}closestPointToPoint(er,tr){const ir=this.a,nr=this.b,sr=this.c;let ar,or;_vab.subVectors(nr,ir),_vac.subVectors(sr,ir),_vap.subVectors(er,ir);const lr=_vab.dot(_vap),cr=_vac.dot(_vap);if(lr<=0&&cr<=0)return tr.copy(ir);_vbp.subVectors(er,nr);const ur=_vab.dot(_vbp),dr=_vac.dot(_vbp);if(ur>=0&&dr<=ur)return tr.copy(nr);const hr=lr*dr-ur*cr;if(hr<=0&&lr>=0&&ur<=0)return ar=lr/(lr-ur),tr.copy(ir).addScaledVector(_vab,ar);_vcp.subVectors(er,sr);const pr=_vab.dot(_vcp),gr=_vac.dot(_vcp);if(gr>=0&&pr<=gr)return tr.copy(sr);const vr=pr*cr-lr*gr;if(vr<=0&&cr>=0&&gr<=0)return or=cr/(cr-gr),tr.copy(ir).addScaledVector(_vac,or);const mr=ur*gr-pr*dr;if(mr<=0&&dr-ur>=0&&pr-gr>=0)return _vbc.subVectors(sr,nr),or=(dr-ur)/(dr-ur+(pr-gr)),tr.copy(nr).addScaledVector(_vbc,or);const fr=1/(mr+vr+hr);return ar=vr*fr,or=hr*fr,tr.copy(ir).addScaledVector(_vab,ar).addScaledVector(_vac,or)}equals(er){return er.a.equals(this.a)&&er.b.equals(this.b)&&er.c.equals(this.c)}};const _colorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_hslA={h:0,s:0,l:0},_hslB={h:0,s:0,l:0};function hue2rgb(rr,er,tr){return tr<0&&(tr+=1),tr>1&&(tr-=1),tr<1/6?rr+(er-rr)*6*tr:tr<1/2?er:tr<2/3?rr+(er-rr)*6*(2/3-tr):rr}class Color{constructor(er,tr,ir){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(er,tr,ir)}set(er,tr,ir){if(tr===void 0&&ir===void 0){const nr=er;nr&&nr.isColor?this.copy(nr):typeof nr=="number"?this.setHex(nr):typeof nr=="string"&&this.setStyle(nr)}else this.setRGB(er,tr,ir);return this}setScalar(er){return this.r=er,this.g=er,this.b=er,this}setHex(er,tr=SRGBColorSpace){return er=Math.floor(er),this.r=(er>>16&255)/255,this.g=(er>>8&255)/255,this.b=(er&255)/255,ColorManagement.toWorkingColorSpace(this,tr),this}setRGB(er,tr,ir,nr=ColorManagement.workingColorSpace){return this.r=er,this.g=tr,this.b=ir,ColorManagement.toWorkingColorSpace(this,nr),this}setHSL(er,tr,ir,nr=ColorManagement.workingColorSpace){if(er=euclideanModulo(er,1),tr=clamp(tr,0,1),ir=clamp(ir,0,1),tr===0)this.r=this.g=this.b=ir;else{const sr=ir<=.5?ir*(1+tr):ir+tr-ir*tr,ar=2*ir-sr;this.r=hue2rgb(ar,sr,er+1/3),this.g=hue2rgb(ar,sr,er),this.b=hue2rgb(ar,sr,er-1/3)}return ColorManagement.toWorkingColorSpace(this,nr),this}setStyle(er,tr=SRGBColorSpace){function ir(sr){sr!==void 0&&parseFloat(sr)<1&&console.warn("THREE.Color: Alpha component of "+er+" will be ignored.")}let nr;if(nr=/^(\w+)\(([^\)]*)\)/.exec(er)){let sr;const ar=nr[1],or=nr[2];switch(ar){case"rgb":case"rgba":if(sr=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return ir(sr[4]),this.setRGB(Math.min(255,parseInt(sr[1],10))/255,Math.min(255,parseInt(sr[2],10))/255,Math.min(255,parseInt(sr[3],10))/255,tr);if(sr=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return ir(sr[4]),this.setRGB(Math.min(100,parseInt(sr[1],10))/100,Math.min(100,parseInt(sr[2],10))/100,Math.min(100,parseInt(sr[3],10))/100,tr);break;case"hsl":case"hsla":if(sr=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(or))return ir(sr[4]),this.setHSL(parseFloat(sr[1])/360,parseFloat(sr[2])/100,parseFloat(sr[3])/100,tr);break;default:console.warn("THREE.Color: Unknown color model "+er)}}else if(nr=/^\#([A-Fa-f\d]+)$/.exec(er)){const sr=nr[1],ar=sr.length;if(ar===3)return this.setRGB(parseInt(sr.charAt(0),16)/15,parseInt(sr.charAt(1),16)/15,parseInt(sr.charAt(2),16)/15,tr);if(ar===6)return this.setHex(parseInt(sr,16),tr);console.warn("THREE.Color: Invalid hex color "+er)}else if(er&&er.length>0)return this.setColorName(er,tr);return this}setColorName(er,tr=SRGBColorSpace){const ir=_colorKeywords[er.toLowerCase()];return ir!==void 0?this.setHex(ir,tr):console.warn("THREE.Color: Unknown color "+er),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(er){return this.r=er.r,this.g=er.g,this.b=er.b,this}copySRGBToLinear(er){return this.r=SRGBToLinear(er.r),this.g=SRGBToLinear(er.g),this.b=SRGBToLinear(er.b),this}copyLinearToSRGB(er){return this.r=LinearToSRGB(er.r),this.g=LinearToSRGB(er.g),this.b=LinearToSRGB(er.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(er=SRGBColorSpace){return ColorManagement.fromWorkingColorSpace(_color$5.copy(this),er),Math.round(clamp(_color$5.r*255,0,255))*65536+Math.round(clamp(_color$5.g*255,0,255))*256+Math.round(clamp(_color$5.b*255,0,255))}getHexString(er=SRGBColorSpace){return("000000"+this.getHex(er).toString(16)).slice(-6)}getHSL(er,tr=ColorManagement.workingColorSpace){ColorManagement.fromWorkingColorSpace(_color$5.copy(this),tr);const ir=_color$5.r,nr=_color$5.g,sr=_color$5.b,ar=Math.max(ir,nr,sr),or=Math.min(ir,nr,sr);let lr,cr;const ur=(or+ar)/2;if(or===ar)lr=0,cr=0;else{const dr=ar-or;switch(cr=ur<=.5?dr/(ar+or):dr/(2-ar-or),ar){case ir:lr=(nr-sr)/dr+(nr<sr?6:0);break;case nr:lr=(sr-ir)/dr+2;break;case sr:lr=(ir-nr)/dr+4;break}lr/=6}return er.h=lr,er.s=cr,er.l=ur,er}getRGB(er,tr=ColorManagement.workingColorSpace){return ColorManagement.fromWorkingColorSpace(_color$5.copy(this),tr),er.r=_color$5.r,er.g=_color$5.g,er.b=_color$5.b,er}getStyle(er=SRGBColorSpace){ColorManagement.fromWorkingColorSpace(_color$5.copy(this),er);const tr=_color$5.r,ir=_color$5.g,nr=_color$5.b;return er!==SRGBColorSpace?`color(${er} ${tr.toFixed(3)} ${ir.toFixed(3)} ${nr.toFixed(3)})`:`rgb(${Math.round(tr*255)},${Math.round(ir*255)},${Math.round(nr*255)})`}offsetHSL(er,tr,ir){return this.getHSL(_hslA),this.setHSL(_hslA.h+er,_hslA.s+tr,_hslA.l+ir)}add(er){return this.r+=er.r,this.g+=er.g,this.b+=er.b,this}addColors(er,tr){return this.r=er.r+tr.r,this.g=er.g+tr.g,this.b=er.b+tr.b,this}addScalar(er){return this.r+=er,this.g+=er,this.b+=er,this}sub(er){return this.r=Math.max(0,this.r-er.r),this.g=Math.max(0,this.g-er.g),this.b=Math.max(0,this.b-er.b),this}multiply(er){return this.r*=er.r,this.g*=er.g,this.b*=er.b,this}multiplyScalar(er){return this.r*=er,this.g*=er,this.b*=er,this}lerp(er,tr){return this.r+=(er.r-this.r)*tr,this.g+=(er.g-this.g)*tr,this.b+=(er.b-this.b)*tr,this}lerpColors(er,tr,ir){return this.r=er.r+(tr.r-er.r)*ir,this.g=er.g+(tr.g-er.g)*ir,this.b=er.b+(tr.b-er.b)*ir,this}lerpHSL(er,tr){this.getHSL(_hslA),er.getHSL(_hslB);const ir=lerp$2(_hslA.h,_hslB.h,tr),nr=lerp$2(_hslA.s,_hslB.s,tr),sr=lerp$2(_hslA.l,_hslB.l,tr);return this.setHSL(ir,nr,sr),this}setFromVector3(er){return this.r=er.x,this.g=er.y,this.b=er.z,this}applyMatrix3(er){const tr=this.r,ir=this.g,nr=this.b,sr=er.elements;return this.r=sr[0]*tr+sr[3]*ir+sr[6]*nr,this.g=sr[1]*tr+sr[4]*ir+sr[7]*nr,this.b=sr[2]*tr+sr[5]*ir+sr[8]*nr,this}equals(er){return er.r===this.r&&er.g===this.g&&er.b===this.b}fromArray(er,tr=0){return this.r=er[tr],this.g=er[tr+1],this.b=er[tr+2],this}toArray(er=[],tr=0){return er[tr]=this.r,er[tr+1]=this.g,er[tr+2]=this.b,er}fromBufferAttribute(er,tr){return this.r=er.getX(tr),this.g=er.getY(tr),this.b=er.getZ(tr),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const _color$5=new Color;Color.NAMES=_colorKeywords;let _materialId=0;class Material extends EventDispatcher{static get type(){return"Material"}get type(){return this.constructor.type}set type(er){}constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:_materialId++}),this.uuid=generateUUID(),this.name="",this.blending=NormalBlending,this.side=FrontSide,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=SrcAlphaFactor,this.blendDst=OneMinusSrcAlphaFactor,this.blendEquation=AddEquation,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Color(0,0,0),this.blendAlpha=0,this.depthFunc=LessEqualDepth,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=AlwaysStencilFunc,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=KeepStencilOp,this.stencilZFail=KeepStencilOp,this.stencilZPass=KeepStencilOp,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(er){this._alphaTest>0!=er>0&&this.version++,this._alphaTest=er}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(er){if(er!==void 0)for(const tr in er){const ir=er[tr];if(ir===void 0){console.warn(`THREE.Material: parameter '${tr}' has value of undefined.`);continue}const nr=this[tr];if(nr===void 0){console.warn(`THREE.Material: '${tr}' is not a property of THREE.${this.type}.`);continue}nr&&nr.isColor?nr.set(ir):nr&&nr.isVector3&&ir&&ir.isVector3?nr.copy(ir):this[tr]=ir}}toJSON(er){const tr=er===void 0||typeof er=="string";tr&&(er={textures:{},images:{}});const ir={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};ir.uuid=this.uuid,ir.type=this.type,this.name!==""&&(ir.name=this.name),this.color&&this.color.isColor&&(ir.color=this.color.getHex()),this.roughness!==void 0&&(ir.roughness=this.roughness),this.metalness!==void 0&&(ir.metalness=this.metalness),this.sheen!==void 0&&(ir.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(ir.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(ir.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(ir.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(ir.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(ir.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(ir.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(ir.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(ir.shininess=this.shininess),this.clearcoat!==void 0&&(ir.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(ir.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(ir.clearcoatMap=this.clearcoatMap.toJSON(er).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(ir.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(er).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(ir.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(er).uuid,ir.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(ir.dispersion=this.dispersion),this.iridescence!==void 0&&(ir.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(ir.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(ir.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(ir.iridescenceMap=this.iridescenceMap.toJSON(er).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(ir.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(er).uuid),this.anisotropy!==void 0&&(ir.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(ir.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(ir.anisotropyMap=this.anisotropyMap.toJSON(er).uuid),this.map&&this.map.isTexture&&(ir.map=this.map.toJSON(er).uuid),this.matcap&&this.matcap.isTexture&&(ir.matcap=this.matcap.toJSON(er).uuid),this.alphaMap&&this.alphaMap.isTexture&&(ir.alphaMap=this.alphaMap.toJSON(er).uuid),this.lightMap&&this.lightMap.isTexture&&(ir.lightMap=this.lightMap.toJSON(er).uuid,ir.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(ir.aoMap=this.aoMap.toJSON(er).uuid,ir.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(ir.bumpMap=this.bumpMap.toJSON(er).uuid,ir.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(ir.normalMap=this.normalMap.toJSON(er).uuid,ir.normalMapType=this.normalMapType,ir.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(ir.displacementMap=this.displacementMap.toJSON(er).uuid,ir.displacementScale=this.displacementScale,ir.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(ir.roughnessMap=this.roughnessMap.toJSON(er).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(ir.metalnessMap=this.metalnessMap.toJSON(er).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(ir.emissiveMap=this.emissiveMap.toJSON(er).uuid),this.specularMap&&this.specularMap.isTexture&&(ir.specularMap=this.specularMap.toJSON(er).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(ir.specularIntensityMap=this.specularIntensityMap.toJSON(er).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(ir.specularColorMap=this.specularColorMap.toJSON(er).uuid),this.envMap&&this.envMap.isTexture&&(ir.envMap=this.envMap.toJSON(er).uuid,this.combine!==void 0&&(ir.combine=this.combine)),this.envMapRotation!==void 0&&(ir.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(ir.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(ir.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(ir.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(ir.gradientMap=this.gradientMap.toJSON(er).uuid),this.transmission!==void 0&&(ir.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(ir.transmissionMap=this.transmissionMap.toJSON(er).uuid),this.thickness!==void 0&&(ir.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(ir.thicknessMap=this.thicknessMap.toJSON(er).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(ir.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(ir.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(ir.size=this.size),this.shadowSide!==null&&(ir.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(ir.sizeAttenuation=this.sizeAttenuation),this.blending!==NormalBlending&&(ir.blending=this.blending),this.side!==FrontSide&&(ir.side=this.side),this.vertexColors===!0&&(ir.vertexColors=!0),this.opacity<1&&(ir.opacity=this.opacity),this.transparent===!0&&(ir.transparent=!0),this.blendSrc!==SrcAlphaFactor&&(ir.blendSrc=this.blendSrc),this.blendDst!==OneMinusSrcAlphaFactor&&(ir.blendDst=this.blendDst),this.blendEquation!==AddEquation&&(ir.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(ir.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(ir.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(ir.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(ir.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(ir.blendAlpha=this.blendAlpha),this.depthFunc!==LessEqualDepth&&(ir.depthFunc=this.depthFunc),this.depthTest===!1&&(ir.depthTest=this.depthTest),this.depthWrite===!1&&(ir.depthWrite=this.depthWrite),this.colorWrite===!1&&(ir.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(ir.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==AlwaysStencilFunc&&(ir.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(ir.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(ir.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==KeepStencilOp&&(ir.stencilFail=this.stencilFail),this.stencilZFail!==KeepStencilOp&&(ir.stencilZFail=this.stencilZFail),this.stencilZPass!==KeepStencilOp&&(ir.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(ir.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(ir.rotation=this.rotation),this.polygonOffset===!0&&(ir.polygonOffset=!0),this.polygonOffsetFactor!==0&&(ir.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(ir.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(ir.linewidth=this.linewidth),this.dashSize!==void 0&&(ir.dashSize=this.dashSize),this.gapSize!==void 0&&(ir.gapSize=this.gapSize),this.scale!==void 0&&(ir.scale=this.scale),this.dithering===!0&&(ir.dithering=!0),this.alphaTest>0&&(ir.alphaTest=this.alphaTest),this.alphaHash===!0&&(ir.alphaHash=!0),this.alphaToCoverage===!0&&(ir.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(ir.premultipliedAlpha=!0),this.forceSinglePass===!0&&(ir.forceSinglePass=!0),this.wireframe===!0&&(ir.wireframe=!0),this.wireframeLinewidth>1&&(ir.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(ir.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(ir.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(ir.flatShading=!0),this.visible===!1&&(ir.visible=!1),this.toneMapped===!1&&(ir.toneMapped=!1),this.fog===!1&&(ir.fog=!1),Object.keys(this.userData).length>0&&(ir.userData=this.userData);function nr(sr){const ar=[];for(const or in sr){const lr=sr[or];delete lr.metadata,ar.push(lr)}return ar}if(tr){const sr=nr(er.textures),ar=nr(er.images);sr.length>0&&(ir.textures=sr),ar.length>0&&(ir.images=ar)}return ir}clone(){return new this.constructor().copy(this)}copy(er){this.name=er.name,this.blending=er.blending,this.side=er.side,this.vertexColors=er.vertexColors,this.opacity=er.opacity,this.transparent=er.transparent,this.blendSrc=er.blendSrc,this.blendDst=er.blendDst,this.blendEquation=er.blendEquation,this.blendSrcAlpha=er.blendSrcAlpha,this.blendDstAlpha=er.blendDstAlpha,this.blendEquationAlpha=er.blendEquationAlpha,this.blendColor.copy(er.blendColor),this.blendAlpha=er.blendAlpha,this.depthFunc=er.depthFunc,this.depthTest=er.depthTest,this.depthWrite=er.depthWrite,this.stencilWriteMask=er.stencilWriteMask,this.stencilFunc=er.stencilFunc,this.stencilRef=er.stencilRef,this.stencilFuncMask=er.stencilFuncMask,this.stencilFail=er.stencilFail,this.stencilZFail=er.stencilZFail,this.stencilZPass=er.stencilZPass,this.stencilWrite=er.stencilWrite;const tr=er.clippingPlanes;let ir=null;if(tr!==null){const nr=tr.length;ir=new Array(nr);for(let sr=0;sr!==nr;++sr)ir[sr]=tr[sr].clone()}return this.clippingPlanes=ir,this.clipIntersection=er.clipIntersection,this.clipShadows=er.clipShadows,this.shadowSide=er.shadowSide,this.colorWrite=er.colorWrite,this.precision=er.precision,this.polygonOffset=er.polygonOffset,this.polygonOffsetFactor=er.polygonOffsetFactor,this.polygonOffsetUnits=er.polygonOffsetUnits,this.dithering=er.dithering,this.alphaTest=er.alphaTest,this.alphaHash=er.alphaHash,this.alphaToCoverage=er.alphaToCoverage,this.premultipliedAlpha=er.premultipliedAlpha,this.forceSinglePass=er.forceSinglePass,this.visible=er.visible,this.toneMapped=er.toneMapped,this.userData=JSON.parse(JSON.stringify(er.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(er){er===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class MeshBasicMaterial extends Material{static get type(){return"MeshBasicMaterial"}constructor(er){super(),this.isMeshBasicMaterial=!0,this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}const _tables=_generateTables();function _generateTables(){const rr=new ArrayBuffer(4),er=new Float32Array(rr),tr=new Uint32Array(rr),ir=new Uint32Array(512),nr=new Uint32Array(512);for(let lr=0;lr<256;++lr){const cr=lr-127;cr<-27?(ir[lr]=0,ir[lr|256]=32768,nr[lr]=24,nr[lr|256]=24):cr<-14?(ir[lr]=1024>>-cr-14,ir[lr|256]=1024>>-cr-14|32768,nr[lr]=-cr-1,nr[lr|256]=-cr-1):cr<=15?(ir[lr]=cr+15<<10,ir[lr|256]=cr+15<<10|32768,nr[lr]=13,nr[lr|256]=13):cr<128?(ir[lr]=31744,ir[lr|256]=64512,nr[lr]=24,nr[lr|256]=24):(ir[lr]=31744,ir[lr|256]=64512,nr[lr]=13,nr[lr|256]=13)}const sr=new Uint32Array(2048),ar=new Uint32Array(64),or=new Uint32Array(64);for(let lr=1;lr<1024;++lr){let cr=lr<<13,ur=0;for(;!(cr&8388608);)cr<<=1,ur-=8388608;cr&=-8388609,ur+=947912704,sr[lr]=cr|ur}for(let lr=1024;lr<2048;++lr)sr[lr]=939524096+(lr-1024<<13);for(let lr=1;lr<31;++lr)ar[lr]=lr<<23;ar[31]=1199570944,ar[32]=2147483648;for(let lr=33;lr<63;++lr)ar[lr]=2147483648+(lr-32<<23);ar[63]=3347054592;for(let lr=1;lr<64;++lr)lr!==32&&(or[lr]=1024);return{floatView:er,uint32View:tr,baseTable:ir,shiftTable:nr,mantissaTable:sr,exponentTable:ar,offsetTable:or}}function toHalfFloat(rr){Math.abs(rr)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),rr=clamp(rr,-65504,65504),_tables.floatView[0]=rr;const er=_tables.uint32View[0],tr=er>>23&511;return _tables.baseTable[tr]+((er&8388607)>>_tables.shiftTable[tr])}function fromHalfFloat(rr){const er=rr>>10;return _tables.uint32View[0]=_tables.mantissaTable[_tables.offsetTable[er]+(rr&1023)]+_tables.exponentTable[er],_tables.floatView[0]}const DataUtils={toHalfFloat,fromHalfFloat},_vector$9=new Vector3$1,_vector2$1=new Vector2;class BufferAttribute{constructor(er,tr,ir=!1){if(Array.isArray(er))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=er,this.itemSize=tr,this.count=er!==void 0?er.length/tr:0,this.normalized=ir,this.usage=StaticDrawUsage,this.updateRanges=[],this.gpuType=FloatType,this.version=0}onUploadCallback(){}set needsUpdate(er){er===!0&&this.version++}setUsage(er){return this.usage=er,this}addUpdateRange(er,tr){this.updateRanges.push({start:er,count:tr})}clearUpdateRanges(){this.updateRanges.length=0}copy(er){return this.name=er.name,this.array=new er.array.constructor(er.array),this.itemSize=er.itemSize,this.count=er.count,this.normalized=er.normalized,this.usage=er.usage,this.gpuType=er.gpuType,this}copyAt(er,tr,ir){er*=this.itemSize,ir*=tr.itemSize;for(let nr=0,sr=this.itemSize;nr<sr;nr++)this.array[er+nr]=tr.array[ir+nr];return this}copyArray(er){return this.array.set(er),this}applyMatrix3(er){if(this.itemSize===2)for(let tr=0,ir=this.count;tr<ir;tr++)_vector2$1.fromBufferAttribute(this,tr),_vector2$1.applyMatrix3(er),this.setXY(tr,_vector2$1.x,_vector2$1.y);else if(this.itemSize===3)for(let tr=0,ir=this.count;tr<ir;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyMatrix3(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyMatrix4(er){for(let tr=0,ir=this.count;tr<ir;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyMatrix4(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}applyNormalMatrix(er){for(let tr=0,ir=this.count;tr<ir;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.applyNormalMatrix(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}transformDirection(er){for(let tr=0,ir=this.count;tr<ir;tr++)_vector$9.fromBufferAttribute(this,tr),_vector$9.transformDirection(er),this.setXYZ(tr,_vector$9.x,_vector$9.y,_vector$9.z);return this}set(er,tr=0){return this.array.set(er,tr),this}getComponent(er,tr){let ir=this.array[er*this.itemSize+tr];return this.normalized&&(ir=denormalize(ir,this.array)),ir}setComponent(er,tr,ir){return this.normalized&&(ir=normalize(ir,this.array)),this.array[er*this.itemSize+tr]=ir,this}getX(er){let tr=this.array[er*this.itemSize];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize]=tr,this}getY(er){let tr=this.array[er*this.itemSize+1];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+1]=tr,this}getZ(er){let tr=this.array[er*this.itemSize+2];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+2]=tr,this}getW(er){let tr=this.array[er*this.itemSize+3];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+3]=tr,this}setXY(er,tr,ir){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array)),this.array[er+0]=tr,this.array[er+1]=ir,this}setXYZ(er,tr,ir,nr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array)),this.array[er+0]=tr,this.array[er+1]=ir,this.array[er+2]=nr,this}setXYZW(er,tr,ir,nr,sr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.array[er+0]=tr,this.array[er+1]=ir,this.array[er+2]=nr,this.array[er+3]=sr,this}onUpload(er){return this.onUploadCallback=er,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const er={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(er.name=this.name),this.usage!==StaticDrawUsage&&(er.usage=this.usage),er}}class Int8BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Int8Array(er),tr,ir)}}class Uint8BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Uint8Array(er),tr,ir)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Uint8ClampedArray(er),tr,ir)}}class Int16BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Int16Array(er),tr,ir)}}class Uint16BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Uint16Array(er),tr,ir)}}class Int32BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Int32Array(er),tr,ir)}}class Uint32BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Uint32Array(er),tr,ir)}}class Float16BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Uint16Array(er),tr,ir),this.isFloat16BufferAttribute=!0}getX(er){let tr=fromHalfFloat(this.array[er*this.itemSize]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize]=toHalfFloat(tr),this}getY(er){let tr=fromHalfFloat(this.array[er*this.itemSize+1]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+1]=toHalfFloat(tr),this}getZ(er){let tr=fromHalfFloat(this.array[er*this.itemSize+2]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+2]=toHalfFloat(tr),this}getW(er){let tr=fromHalfFloat(this.array[er*this.itemSize+3]);return this.normalized&&(tr=denormalize(tr,this.array)),tr}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.array[er*this.itemSize+3]=toHalfFloat(tr),this}setXY(er,tr,ir){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(ir),this}setXYZ(er,tr,ir,nr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(ir),this.array[er+2]=toHalfFloat(nr),this}setXYZW(er,tr,ir,nr,sr){return er*=this.itemSize,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.array[er+0]=toHalfFloat(tr),this.array[er+1]=toHalfFloat(ir),this.array[er+2]=toHalfFloat(nr),this.array[er+3]=toHalfFloat(sr),this}}class Float32BufferAttribute extends BufferAttribute{constructor(er,tr,ir){super(new Float32Array(er),tr,ir)}}let _id$2=0;const _m1$2=new Matrix4,_obj=new Object3D,_offset$2=new Vector3$1,_box$2=new Box3,_boxMorphTargets=new Box3,_vector$8=new Vector3$1;class BufferGeometry extends EventDispatcher{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:_id$2++}),this.uuid=generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(er){return Array.isArray(er)?this.index=new(arrayNeedsUint32(er)?Uint32BufferAttribute:Uint16BufferAttribute)(er,1):this.index=er,this}setIndirect(er){return this.indirect=er,this}getIndirect(){return this.indirect}getAttribute(er){return this.attributes[er]}setAttribute(er,tr){return this.attributes[er]=tr,this}deleteAttribute(er){return delete this.attributes[er],this}hasAttribute(er){return this.attributes[er]!==void 0}addGroup(er,tr,ir=0){this.groups.push({start:er,count:tr,materialIndex:ir})}clearGroups(){this.groups=[]}setDrawRange(er,tr){this.drawRange.start=er,this.drawRange.count=tr}applyMatrix4(er){const tr=this.attributes.position;tr!==void 0&&(tr.applyMatrix4(er),tr.needsUpdate=!0);const ir=this.attributes.normal;if(ir!==void 0){const sr=new Matrix3().getNormalMatrix(er);ir.applyNormalMatrix(sr),ir.needsUpdate=!0}const nr=this.attributes.tangent;return nr!==void 0&&(nr.transformDirection(er),nr.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(er){return _m1$2.makeRotationFromQuaternion(er),this.applyMatrix4(_m1$2),this}rotateX(er){return _m1$2.makeRotationX(er),this.applyMatrix4(_m1$2),this}rotateY(er){return _m1$2.makeRotationY(er),this.applyMatrix4(_m1$2),this}rotateZ(er){return _m1$2.makeRotationZ(er),this.applyMatrix4(_m1$2),this}translate(er,tr,ir){return _m1$2.makeTranslation(er,tr,ir),this.applyMatrix4(_m1$2),this}scale(er,tr,ir){return _m1$2.makeScale(er,tr,ir),this.applyMatrix4(_m1$2),this}lookAt(er){return _obj.lookAt(er),_obj.updateMatrix(),this.applyMatrix4(_obj.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(_offset$2).negate(),this.translate(_offset$2.x,_offset$2.y,_offset$2.z),this}setFromPoints(er){const tr=this.getAttribute("position");if(tr===void 0){const ir=[];for(let nr=0,sr=er.length;nr<sr;nr++){const ar=er[nr];ir.push(ar.x,ar.y,ar.z||0)}this.setAttribute("position",new Float32BufferAttribute(ir,3))}else{for(let ir=0,nr=tr.count;ir<nr;ir++){const sr=er[ir];tr.setXYZ(ir,sr.x,sr.y,sr.z||0)}er.length>tr.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),tr.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.attributes.position,tr=this.morphAttributes.position;if(er&&er.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Vector3$1(-1/0,-1/0,-1/0),new Vector3$1(1/0,1/0,1/0));return}if(er!==void 0){if(this.boundingBox.setFromBufferAttribute(er),tr)for(let ir=0,nr=tr.length;ir<nr;ir++){const sr=tr[ir];_box$2.setFromBufferAttribute(sr),this.morphTargetsRelative?(_vector$8.addVectors(this.boundingBox.min,_box$2.min),this.boundingBox.expandByPoint(_vector$8),_vector$8.addVectors(this.boundingBox.max,_box$2.max),this.boundingBox.expandByPoint(_vector$8)):(this.boundingBox.expandByPoint(_box$2.min),this.boundingBox.expandByPoint(_box$2.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const er=this.attributes.position,tr=this.morphAttributes.position;if(er&&er.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Vector3$1,1/0);return}if(er){const ir=this.boundingSphere.center;if(_box$2.setFromBufferAttribute(er),tr)for(let sr=0,ar=tr.length;sr<ar;sr++){const or=tr[sr];_boxMorphTargets.setFromBufferAttribute(or),this.morphTargetsRelative?(_vector$8.addVectors(_box$2.min,_boxMorphTargets.min),_box$2.expandByPoint(_vector$8),_vector$8.addVectors(_box$2.max,_boxMorphTargets.max),_box$2.expandByPoint(_vector$8)):(_box$2.expandByPoint(_boxMorphTargets.min),_box$2.expandByPoint(_boxMorphTargets.max))}_box$2.getCenter(ir);let nr=0;for(let sr=0,ar=er.count;sr<ar;sr++)_vector$8.fromBufferAttribute(er,sr),nr=Math.max(nr,ir.distanceToSquared(_vector$8));if(tr)for(let sr=0,ar=tr.length;sr<ar;sr++){const or=tr[sr],lr=this.morphTargetsRelative;for(let cr=0,ur=or.count;cr<ur;cr++)_vector$8.fromBufferAttribute(or,cr),lr&&(_offset$2.fromBufferAttribute(er,cr),_vector$8.add(_offset$2)),nr=Math.max(nr,ir.distanceToSquared(_vector$8))}this.boundingSphere.radius=Math.sqrt(nr),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const er=this.index,tr=this.attributes;if(er===null||tr.position===void 0||tr.normal===void 0||tr.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const ir=tr.position,nr=tr.normal,sr=tr.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*ir.count),4));const ar=this.getAttribute("tangent"),or=[],lr=[];for(let br=0;br<ir.count;br++)or[br]=new Vector3$1,lr[br]=new Vector3$1;const cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1,hr=new Vector2,pr=new Vector2,gr=new Vector2,vr=new Vector3$1,mr=new Vector3$1;function fr(br,Cr,Ir){cr.fromBufferAttribute(ir,br),ur.fromBufferAttribute(ir,Cr),dr.fromBufferAttribute(ir,Ir),hr.fromBufferAttribute(sr,br),pr.fromBufferAttribute(sr,Cr),gr.fromBufferAttribute(sr,Ir),ur.sub(cr),dr.sub(cr),pr.sub(hr),gr.sub(hr);const Rr=1/(pr.x*gr.y-gr.x*pr.y);isFinite(Rr)&&(vr.copy(ur).multiplyScalar(gr.y).addScaledVector(dr,-pr.y).multiplyScalar(Rr),mr.copy(dr).multiplyScalar(pr.x).addScaledVector(ur,-gr.x).multiplyScalar(Rr),or[br].add(vr),or[Cr].add(vr),or[Ir].add(vr),lr[br].add(mr),lr[Cr].add(mr),lr[Ir].add(mr))}let _r=this.groups;_r.length===0&&(_r=[{start:0,count:er.count}]);for(let br=0,Cr=_r.length;br<Cr;++br){const Ir=_r[br],Rr=Ir.start,Pr=Ir.count;for(let Dr=Rr,Fr=Rr+Pr;Dr<Fr;Dr+=3)fr(er.getX(Dr+0),er.getX(Dr+1),er.getX(Dr+2))}const Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1,xr=new Vector3$1;function Sr(br){wr.fromBufferAttribute(nr,br),xr.copy(wr);const Cr=or[br];Ar.copy(Cr),Ar.sub(wr.multiplyScalar(wr.dot(Cr))).normalize(),yr.crossVectors(xr,Cr);const Rr=yr.dot(lr[br])<0?-1:1;ar.setXYZW(br,Ar.x,Ar.y,Ar.z,Rr)}for(let br=0,Cr=_r.length;br<Cr;++br){const Ir=_r[br],Rr=Ir.start,Pr=Ir.count;for(let Dr=Rr,Fr=Rr+Pr;Dr<Fr;Dr+=3)Sr(er.getX(Dr+0)),Sr(er.getX(Dr+1)),Sr(er.getX(Dr+2))}}computeVertexNormals(){const er=this.index,tr=this.getAttribute("position");if(tr!==void 0){let ir=this.getAttribute("normal");if(ir===void 0)ir=new BufferAttribute(new Float32Array(tr.count*3),3),this.setAttribute("normal",ir);else for(let hr=0,pr=ir.count;hr<pr;hr++)ir.setXYZ(hr,0,0,0);const nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1;if(er)for(let hr=0,pr=er.count;hr<pr;hr+=3){const gr=er.getX(hr+0),vr=er.getX(hr+1),mr=er.getX(hr+2);nr.fromBufferAttribute(tr,gr),sr.fromBufferAttribute(tr,vr),ar.fromBufferAttribute(tr,mr),ur.subVectors(ar,sr),dr.subVectors(nr,sr),ur.cross(dr),or.fromBufferAttribute(ir,gr),lr.fromBufferAttribute(ir,vr),cr.fromBufferAttribute(ir,mr),or.add(ur),lr.add(ur),cr.add(ur),ir.setXYZ(gr,or.x,or.y,or.z),ir.setXYZ(vr,lr.x,lr.y,lr.z),ir.setXYZ(mr,cr.x,cr.y,cr.z)}else for(let hr=0,pr=tr.count;hr<pr;hr+=3)nr.fromBufferAttribute(tr,hr+0),sr.fromBufferAttribute(tr,hr+1),ar.fromBufferAttribute(tr,hr+2),ur.subVectors(ar,sr),dr.subVectors(nr,sr),ur.cross(dr),ir.setXYZ(hr+0,ur.x,ur.y,ur.z),ir.setXYZ(hr+1,ur.x,ur.y,ur.z),ir.setXYZ(hr+2,ur.x,ur.y,ur.z);this.normalizeNormals(),ir.needsUpdate=!0}}normalizeNormals(){const er=this.attributes.normal;for(let tr=0,ir=er.count;tr<ir;tr++)_vector$8.fromBufferAttribute(er,tr),_vector$8.normalize(),er.setXYZ(tr,_vector$8.x,_vector$8.y,_vector$8.z)}toNonIndexed(){function er(or,lr){const cr=or.array,ur=or.itemSize,dr=or.normalized,hr=new cr.constructor(lr.length*ur);let pr=0,gr=0;for(let vr=0,mr=lr.length;vr<mr;vr++){or.isInterleavedBufferAttribute?pr=lr[vr]*or.data.stride+or.offset:pr=lr[vr]*ur;for(let fr=0;fr<ur;fr++)hr[gr++]=cr[pr++]}return new BufferAttribute(hr,ur,dr)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const tr=new BufferGeometry,ir=this.index.array,nr=this.attributes;for(const or in nr){const lr=nr[or],cr=er(lr,ir);tr.setAttribute(or,cr)}const sr=this.morphAttributes;for(const or in sr){const lr=[],cr=sr[or];for(let ur=0,dr=cr.length;ur<dr;ur++){const hr=cr[ur],pr=er(hr,ir);lr.push(pr)}tr.morphAttributes[or]=lr}tr.morphTargetsRelative=this.morphTargetsRelative;const ar=this.groups;for(let or=0,lr=ar.length;or<lr;or++){const cr=ar[or];tr.addGroup(cr.start,cr.count,cr.materialIndex)}return tr}toJSON(){const er={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(er.uuid=this.uuid,er.type=this.type,this.name!==""&&(er.name=this.name),Object.keys(this.userData).length>0&&(er.userData=this.userData),this.parameters!==void 0){const lr=this.parameters;for(const cr in lr)lr[cr]!==void 0&&(er[cr]=lr[cr]);return er}er.data={attributes:{}};const tr=this.index;tr!==null&&(er.data.index={type:tr.array.constructor.name,array:Array.prototype.slice.call(tr.array)});const ir=this.attributes;for(const lr in ir){const cr=ir[lr];er.data.attributes[lr]=cr.toJSON(er.data)}const nr={};let sr=!1;for(const lr in this.morphAttributes){const cr=this.morphAttributes[lr],ur=[];for(let dr=0,hr=cr.length;dr<hr;dr++){const pr=cr[dr];ur.push(pr.toJSON(er.data))}ur.length>0&&(nr[lr]=ur,sr=!0)}sr&&(er.data.morphAttributes=nr,er.data.morphTargetsRelative=this.morphTargetsRelative);const ar=this.groups;ar.length>0&&(er.data.groups=JSON.parse(JSON.stringify(ar)));const or=this.boundingSphere;return or!==null&&(er.data.boundingSphere={center:or.center.toArray(),radius:or.radius}),er}clone(){return new this.constructor().copy(this)}copy(er){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const tr={};this.name=er.name;const ir=er.index;ir!==null&&this.setIndex(ir.clone(tr));const nr=er.attributes;for(const cr in nr){const ur=nr[cr];this.setAttribute(cr,ur.clone(tr))}const sr=er.morphAttributes;for(const cr in sr){const ur=[],dr=sr[cr];for(let hr=0,pr=dr.length;hr<pr;hr++)ur.push(dr[hr].clone(tr));this.morphAttributes[cr]=ur}this.morphTargetsRelative=er.morphTargetsRelative;const ar=er.groups;for(let cr=0,ur=ar.length;cr<ur;cr++){const dr=ar[cr];this.addGroup(dr.start,dr.count,dr.materialIndex)}const or=er.boundingBox;or!==null&&(this.boundingBox=or.clone());const lr=er.boundingSphere;return lr!==null&&(this.boundingSphere=lr.clone()),this.drawRange.start=er.drawRange.start,this.drawRange.count=er.drawRange.count,this.userData=er.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const _inverseMatrix$3=new Matrix4,_ray$3=new Ray$1,_sphere$6=new Sphere,_sphereHitAt=new Vector3$1,_vA$1$1=new Vector3$1,_vB$1$1=new Vector3$1,_vC$1$1=new Vector3$1,_tempA=new Vector3$1,_morphA=new Vector3$1,_intersectionPoint$1=new Vector3$1,_intersectionPointWorld=new Vector3$1;class Mesh extends Object3D{constructor(er=new BufferGeometry,tr=new MeshBasicMaterial){super(),this.isMesh=!0,this.type="Mesh",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),er.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=er.morphTargetInfluences.slice()),er.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},er.morphTargetDictionary)),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}updateMorphTargets(){const tr=this.geometry.morphAttributes,ir=Object.keys(tr);if(ir.length>0){const nr=tr[ir[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}getVertexPosition(er,tr){const ir=this.geometry,nr=ir.attributes.position,sr=ir.morphAttributes.position,ar=ir.morphTargetsRelative;tr.fromBufferAttribute(nr,er);const or=this.morphTargetInfluences;if(sr&&or){_morphA.set(0,0,0);for(let lr=0,cr=sr.length;lr<cr;lr++){const ur=or[lr],dr=sr[lr];ur!==0&&(_tempA.fromBufferAttribute(dr,er),ar?_morphA.addScaledVector(_tempA,ur):_morphA.addScaledVector(_tempA.sub(tr),ur))}tr.add(_morphA)}return tr}raycast(er,tr){const ir=this.geometry,nr=this.material,sr=this.matrixWorld;nr!==void 0&&(ir.boundingSphere===null&&ir.computeBoundingSphere(),_sphere$6.copy(ir.boundingSphere),_sphere$6.applyMatrix4(sr),_ray$3.copy(er.ray).recast(er.near),!(_sphere$6.containsPoint(_ray$3.origin)===!1&&(_ray$3.intersectSphere(_sphere$6,_sphereHitAt)===null||_ray$3.origin.distanceToSquared(_sphereHitAt)>(er.far-er.near)**2))&&(_inverseMatrix$3.copy(sr).invert(),_ray$3.copy(er.ray).applyMatrix4(_inverseMatrix$3),!(ir.boundingBox!==null&&_ray$3.intersectsBox(ir.boundingBox)===!1)&&this._computeIntersections(er,tr,_ray$3)))}_computeIntersections(er,tr,ir){let nr;const sr=this.geometry,ar=this.material,or=sr.index,lr=sr.attributes.position,cr=sr.attributes.uv,ur=sr.attributes.uv1,dr=sr.attributes.normal,hr=sr.groups,pr=sr.drawRange;if(or!==null)if(Array.isArray(ar))for(let gr=0,vr=hr.length;gr<vr;gr++){const mr=hr[gr],fr=ar[mr.materialIndex],_r=Math.max(mr.start,pr.start),Ar=Math.min(or.count,Math.min(mr.start+mr.count,pr.start+pr.count));for(let yr=_r,wr=Ar;yr<wr;yr+=3){const xr=or.getX(yr),Sr=or.getX(yr+1),br=or.getX(yr+2);nr=checkGeometryIntersection(this,fr,er,ir,cr,ur,dr,xr,Sr,br),nr&&(nr.faceIndex=Math.floor(yr/3),nr.face.materialIndex=mr.materialIndex,tr.push(nr))}}else{const gr=Math.max(0,pr.start),vr=Math.min(or.count,pr.start+pr.count);for(let mr=gr,fr=vr;mr<fr;mr+=3){const _r=or.getX(mr),Ar=or.getX(mr+1),yr=or.getX(mr+2);nr=checkGeometryIntersection(this,ar,er,ir,cr,ur,dr,_r,Ar,yr),nr&&(nr.faceIndex=Math.floor(mr/3),tr.push(nr))}}else if(lr!==void 0)if(Array.isArray(ar))for(let gr=0,vr=hr.length;gr<vr;gr++){const mr=hr[gr],fr=ar[mr.materialIndex],_r=Math.max(mr.start,pr.start),Ar=Math.min(lr.count,Math.min(mr.start+mr.count,pr.start+pr.count));for(let yr=_r,wr=Ar;yr<wr;yr+=3){const xr=yr,Sr=yr+1,br=yr+2;nr=checkGeometryIntersection(this,fr,er,ir,cr,ur,dr,xr,Sr,br),nr&&(nr.faceIndex=Math.floor(yr/3),nr.face.materialIndex=mr.materialIndex,tr.push(nr))}}else{const gr=Math.max(0,pr.start),vr=Math.min(lr.count,pr.start+pr.count);for(let mr=gr,fr=vr;mr<fr;mr+=3){const _r=mr,Ar=mr+1,yr=mr+2;nr=checkGeometryIntersection(this,ar,er,ir,cr,ur,dr,_r,Ar,yr),nr&&(nr.faceIndex=Math.floor(mr/3),tr.push(nr))}}}}function checkIntersection$1(rr,er,tr,ir,nr,sr,ar,or){let lr;if(er.side===BackSide?lr=ir.intersectTriangle(ar,sr,nr,!0,or):lr=ir.intersectTriangle(nr,sr,ar,er.side===FrontSide,or),lr===null)return null;_intersectionPointWorld.copy(or),_intersectionPointWorld.applyMatrix4(rr.matrixWorld);const cr=tr.ray.origin.distanceTo(_intersectionPointWorld);return cr<tr.near||cr>tr.far?null:{distance:cr,point:_intersectionPointWorld.clone(),object:rr}}function checkGeometryIntersection(rr,er,tr,ir,nr,sr,ar,or,lr,cr){rr.getVertexPosition(or,_vA$1$1),rr.getVertexPosition(lr,_vB$1$1),rr.getVertexPosition(cr,_vC$1$1);const ur=checkIntersection$1(rr,er,tr,ir,_vA$1$1,_vB$1$1,_vC$1$1,_intersectionPoint$1);if(ur){const dr=new Vector3$1;Triangle$2.getBarycoord(_intersectionPoint$1,_vA$1$1,_vB$1$1,_vC$1$1,dr),nr&&(ur.uv=Triangle$2.getInterpolatedAttribute(nr,or,lr,cr,dr,new Vector2)),sr&&(ur.uv1=Triangle$2.getInterpolatedAttribute(sr,or,lr,cr,dr,new Vector2)),ar&&(ur.normal=Triangle$2.getInterpolatedAttribute(ar,or,lr,cr,dr,new Vector3$1),ur.normal.dot(ir.direction)>0&&ur.normal.multiplyScalar(-1));const hr={a:or,b:lr,c:cr,normal:new Vector3$1,materialIndex:0};Triangle$2.getNormal(_vA$1$1,_vB$1$1,_vC$1$1,hr.normal),ur.face=hr,ur.barycoord=dr}return ur}class BoxGeometry extends BufferGeometry{constructor(er=1,tr=1,ir=1,nr=1,sr=1,ar=1){super(),this.type="BoxGeometry",this.parameters={width:er,height:tr,depth:ir,widthSegments:nr,heightSegments:sr,depthSegments:ar};const or=this;nr=Math.floor(nr),sr=Math.floor(sr),ar=Math.floor(ar);const lr=[],cr=[],ur=[],dr=[];let hr=0,pr=0;gr("z","y","x",-1,-1,ir,tr,er,ar,sr,0),gr("z","y","x",1,-1,ir,tr,-er,ar,sr,1),gr("x","z","y",1,1,er,ir,tr,nr,ar,2),gr("x","z","y",1,-1,er,ir,-tr,nr,ar,3),gr("x","y","z",1,-1,er,tr,ir,nr,sr,4),gr("x","y","z",-1,-1,er,tr,-ir,nr,sr,5),this.setIndex(lr),this.setAttribute("position",new Float32BufferAttribute(cr,3)),this.setAttribute("normal",new Float32BufferAttribute(ur,3)),this.setAttribute("uv",new Float32BufferAttribute(dr,2));function gr(vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr){const Ir=yr/Sr,Rr=wr/br,Pr=yr/2,Dr=wr/2,Fr=xr/2,Or=Sr+1,Nr=br+1;let Ur=0,Br=0;const Wr=new Vector3$1;for(let Xr=0;Xr<Nr;Xr++){const Yr=Xr*Rr-Dr;for(let Qi=0;Qi<Or;Qi++){const Xi=Qi*Ir-Pr;Wr[vr]=Xi*_r,Wr[mr]=Yr*Ar,Wr[fr]=Fr,cr.push(Wr.x,Wr.y,Wr.z),Wr[vr]=0,Wr[mr]=0,Wr[fr]=xr>0?1:-1,ur.push(Wr.x,Wr.y,Wr.z),dr.push(Qi/Sr),dr.push(1-Xr/br),Ur+=1}}for(let Xr=0;Xr<br;Xr++)for(let Yr=0;Yr<Sr;Yr++){const Qi=hr+Yr+Or*Xr,Xi=hr+Yr+Or*(Xr+1),Kr=hr+(Yr+1)+Or*(Xr+1),$r=hr+(Yr+1)+Or*Xr;lr.push(Qi,Xi,$r),lr.push(Xi,Kr,$r),Br+=6}or.addGroup(pr,Br,Cr),pr+=Br,hr+=Ur}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new BoxGeometry(er.width,er.height,er.depth,er.widthSegments,er.heightSegments,er.depthSegments)}}function cloneUniforms(rr){const er={};for(const tr in rr){er[tr]={};for(const ir in rr[tr]){const nr=rr[tr][ir];nr&&(nr.isColor||nr.isMatrix3||nr.isMatrix4||nr.isVector2||nr.isVector3||nr.isVector4||nr.isTexture||nr.isQuaternion)?nr.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),er[tr][ir]=null):er[tr][ir]=nr.clone():Array.isArray(nr)?er[tr][ir]=nr.slice():er[tr][ir]=nr}}return er}function mergeUniforms(rr){const er={};for(let tr=0;tr<rr.length;tr++){const ir=cloneUniforms(rr[tr]);for(const nr in ir)er[nr]=ir[nr]}return er}function cloneUniformsGroups(rr){const er=[];for(let tr=0;tr<rr.length;tr++)er.push(rr[tr].clone());return er}function getUnlitUniformColorSpace(rr){const er=rr.getRenderTarget();return er===null?rr.outputColorSpace:er.isXRRenderTarget===!0?er.texture.colorSpace:ColorManagement.workingColorSpace}const UniformsUtils={clone:cloneUniforms,merge:mergeUniforms};var default_vertex=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,default_fragment=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class ShaderMaterial extends Material{static get type(){return"ShaderMaterial"}constructor(er){super(),this.isShaderMaterial=!0,this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=default_vertex,this.fragmentShader=default_fragment,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,er!==void 0&&this.setValues(er)}copy(er){return super.copy(er),this.fragmentShader=er.fragmentShader,this.vertexShader=er.vertexShader,this.uniforms=cloneUniforms(er.uniforms),this.uniformsGroups=cloneUniformsGroups(er.uniformsGroups),this.defines=Object.assign({},er.defines),this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.fog=er.fog,this.lights=er.lights,this.clipping=er.clipping,this.extensions=Object.assign({},er.extensions),this.glslVersion=er.glslVersion,this}toJSON(er){const tr=super.toJSON(er);tr.glslVersion=this.glslVersion,tr.uniforms={};for(const nr in this.uniforms){const ar=this.uniforms[nr].value;ar&&ar.isTexture?tr.uniforms[nr]={type:"t",value:ar.toJSON(er).uuid}:ar&&ar.isColor?tr.uniforms[nr]={type:"c",value:ar.getHex()}:ar&&ar.isVector2?tr.uniforms[nr]={type:"v2",value:ar.toArray()}:ar&&ar.isVector3?tr.uniforms[nr]={type:"v3",value:ar.toArray()}:ar&&ar.isVector4?tr.uniforms[nr]={type:"v4",value:ar.toArray()}:ar&&ar.isMatrix3?tr.uniforms[nr]={type:"m3",value:ar.toArray()}:ar&&ar.isMatrix4?tr.uniforms[nr]={type:"m4",value:ar.toArray()}:tr.uniforms[nr]={value:ar}}Object.keys(this.defines).length>0&&(tr.defines=this.defines),tr.vertexShader=this.vertexShader,tr.fragmentShader=this.fragmentShader,tr.lights=this.lights,tr.clipping=this.clipping;const ir={};for(const nr in this.extensions)this.extensions[nr]===!0&&(ir[nr]=!0);return Object.keys(ir).length>0&&(tr.extensions=ir),tr}}class Camera extends Object3D{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4,this.coordinateSystem=WebGLCoordinateSystem}copy(er,tr){return super.copy(er,tr),this.matrixWorldInverse.copy(er.matrixWorldInverse),this.projectionMatrix.copy(er.projectionMatrix),this.projectionMatrixInverse.copy(er.projectionMatrixInverse),this.coordinateSystem=er.coordinateSystem,this}getWorldDirection(er){return super.getWorldDirection(er).negate()}updateMatrixWorld(er){super.updateMatrixWorld(er),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(er,tr){super.updateWorldMatrix(er,tr),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const _v3$1=new Vector3$1,_minTarget=new Vector2,_maxTarget=new Vector2;class PerspectiveCamera extends Camera{constructor(er=50,tr=1,ir=.1,nr=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=er,this.zoom=1,this.near=ir,this.far=nr,this.focus=10,this.aspect=tr,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(er,tr){return super.copy(er,tr),this.fov=er.fov,this.zoom=er.zoom,this.near=er.near,this.far=er.far,this.focus=er.focus,this.aspect=er.aspect,this.view=er.view===null?null:Object.assign({},er.view),this.filmGauge=er.filmGauge,this.filmOffset=er.filmOffset,this}setFocalLength(er){const tr=.5*this.getFilmHeight()/er;this.fov=RAD2DEG*2*Math.atan(tr),this.updateProjectionMatrix()}getFocalLength(){const er=Math.tan(DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/er}getEffectiveFOV(){return RAD2DEG*2*Math.atan(Math.tan(DEG2RAD*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(er,tr,ir){_v3$1.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),tr.set(_v3$1.x,_v3$1.y).multiplyScalar(-er/_v3$1.z),_v3$1.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),ir.set(_v3$1.x,_v3$1.y).multiplyScalar(-er/_v3$1.z)}getViewSize(er,tr){return this.getViewBounds(er,_minTarget,_maxTarget),tr.subVectors(_maxTarget,_minTarget)}setViewOffset(er,tr,ir,nr,sr,ar){this.aspect=er/tr,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=er,this.view.fullHeight=tr,this.view.offsetX=ir,this.view.offsetY=nr,this.view.width=sr,this.view.height=ar,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const er=this.near;let tr=er*Math.tan(DEG2RAD*.5*this.fov)/this.zoom,ir=2*tr,nr=this.aspect*ir,sr=-.5*nr;const ar=this.view;if(this.view!==null&&this.view.enabled){const lr=ar.fullWidth,cr=ar.fullHeight;sr+=ar.offsetX*nr/lr,tr-=ar.offsetY*ir/cr,nr*=ar.width/lr,ir*=ar.height/cr}const or=this.filmOffset;or!==0&&(sr+=er*or/this.getFilmWidth()),this.projectionMatrix.makePerspective(sr,sr+nr,tr,tr-ir,er,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(er){const tr=super.toJSON(er);return tr.object.fov=this.fov,tr.object.zoom=this.zoom,tr.object.near=this.near,tr.object.far=this.far,tr.object.focus=this.focus,tr.object.aspect=this.aspect,this.view!==null&&(tr.object.view=Object.assign({},this.view)),tr.object.filmGauge=this.filmGauge,tr.object.filmOffset=this.filmOffset,tr}}const fov=-90,aspect=1;class CubeCamera extends Object3D{constructor(er,tr,ir){super(),this.type="CubeCamera",this.renderTarget=ir,this.coordinateSystem=null,this.activeMipmapLevel=0;const nr=new PerspectiveCamera(fov,aspect,er,tr);nr.layers=this.layers,this.add(nr);const sr=new PerspectiveCamera(fov,aspect,er,tr);sr.layers=this.layers,this.add(sr);const ar=new PerspectiveCamera(fov,aspect,er,tr);ar.layers=this.layers,this.add(ar);const or=new PerspectiveCamera(fov,aspect,er,tr);or.layers=this.layers,this.add(or);const lr=new PerspectiveCamera(fov,aspect,er,tr);lr.layers=this.layers,this.add(lr);const cr=new PerspectiveCamera(fov,aspect,er,tr);cr.layers=this.layers,this.add(cr)}updateCoordinateSystem(){const er=this.coordinateSystem,tr=this.children.concat(),[ir,nr,sr,ar,or,lr]=tr;for(const cr of tr)this.remove(cr);if(er===WebGLCoordinateSystem)ir.up.set(0,1,0),ir.lookAt(1,0,0),nr.up.set(0,1,0),nr.lookAt(-1,0,0),sr.up.set(0,0,-1),sr.lookAt(0,1,0),ar.up.set(0,0,1),ar.lookAt(0,-1,0),or.up.set(0,1,0),or.lookAt(0,0,1),lr.up.set(0,1,0),lr.lookAt(0,0,-1);else if(er===WebGPUCoordinateSystem)ir.up.set(0,-1,0),ir.lookAt(-1,0,0),nr.up.set(0,-1,0),nr.lookAt(1,0,0),sr.up.set(0,0,1),sr.lookAt(0,1,0),ar.up.set(0,0,-1),ar.lookAt(0,-1,0),or.up.set(0,-1,0),or.lookAt(0,0,1),lr.up.set(0,-1,0),lr.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+er);for(const cr of tr)this.add(cr),cr.updateMatrixWorld()}update(er,tr){this.parent===null&&this.updateMatrixWorld();const{renderTarget:ir,activeMipmapLevel:nr}=this;this.coordinateSystem!==er.coordinateSystem&&(this.coordinateSystem=er.coordinateSystem,this.updateCoordinateSystem());const[sr,ar,or,lr,cr,ur]=this.children,dr=er.getRenderTarget(),hr=er.getActiveCubeFace(),pr=er.getActiveMipmapLevel(),gr=er.xr.enabled;er.xr.enabled=!1;const vr=ir.texture.generateMipmaps;ir.texture.generateMipmaps=!1,er.setRenderTarget(ir,0,nr),er.render(tr,sr),er.setRenderTarget(ir,1,nr),er.render(tr,ar),er.setRenderTarget(ir,2,nr),er.render(tr,or),er.setRenderTarget(ir,3,nr),er.render(tr,lr),er.setRenderTarget(ir,4,nr),er.render(tr,cr),ir.texture.generateMipmaps=vr,er.setRenderTarget(ir,5,nr),er.render(tr,ur),er.setRenderTarget(dr,hr,pr),er.xr.enabled=gr,ir.texture.needsPMREMUpdate=!0}}class CubeTexture extends Texture{constructor(er,tr,ir,nr,sr,ar,or,lr,cr,ur){er=er!==void 0?er:[],tr=tr!==void 0?tr:CubeReflectionMapping,super(er,tr,ir,nr,sr,ar,or,lr,cr,ur),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(er){this.image=er}}class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(er=1,tr={}){super(er,er,tr),this.isWebGLCubeRenderTarget=!0;const ir={width:er,height:er,depth:1},nr=[ir,ir,ir,ir,ir,ir];this.texture=new CubeTexture(nr,tr.mapping,tr.wrapS,tr.wrapT,tr.magFilter,tr.minFilter,tr.format,tr.type,tr.anisotropy,tr.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=tr.generateMipmaps!==void 0?tr.generateMipmaps:!1,this.texture.minFilter=tr.minFilter!==void 0?tr.minFilter:LinearFilter}fromEquirectangularTexture(er,tr){this.texture.type=tr.type,this.texture.colorSpace=tr.colorSpace,this.texture.generateMipmaps=tr.generateMipmaps,this.texture.minFilter=tr.minFilter,this.texture.magFilter=tr.magFilter;const ir={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},nr=new BoxGeometry(5,5,5),sr=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:cloneUniforms(ir.uniforms),vertexShader:ir.vertexShader,fragmentShader:ir.fragmentShader,side:BackSide,blending:NoBlending});sr.uniforms.tEquirect.value=tr;const ar=new Mesh(nr,sr),or=tr.minFilter;return tr.minFilter===LinearMipmapLinearFilter&&(tr.minFilter=LinearFilter),new CubeCamera(1,10,this).update(er,ar),tr.minFilter=or,ar.geometry.dispose(),ar.material.dispose(),this}clear(er,tr,ir,nr){const sr=er.getRenderTarget();for(let ar=0;ar<6;ar++)er.setRenderTarget(this,ar),er.clear(tr,ir,nr);er.setRenderTarget(sr)}}const _vector1=new Vector3$1,_vector2=new Vector3$1,_normalMatrix$1=new Matrix3;class Plane{constructor(er=new Vector3$1(1,0,0),tr=0){this.isPlane=!0,this.normal=er,this.constant=tr}set(er,tr){return this.normal.copy(er),this.constant=tr,this}setComponents(er,tr,ir,nr){return this.normal.set(er,tr,ir),this.constant=nr,this}setFromNormalAndCoplanarPoint(er,tr){return this.normal.copy(er),this.constant=-tr.dot(this.normal),this}setFromCoplanarPoints(er,tr,ir){const nr=_vector1.subVectors(ir,tr).cross(_vector2.subVectors(er,tr)).normalize();return this.setFromNormalAndCoplanarPoint(nr,er),this}copy(er){return this.normal.copy(er.normal),this.constant=er.constant,this}normalize(){const er=1/this.normal.length();return this.normal.multiplyScalar(er),this.constant*=er,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(er){return this.normal.dot(er)+this.constant}distanceToSphere(er){return this.distanceToPoint(er.center)-er.radius}projectPoint(er,tr){return tr.copy(er).addScaledVector(this.normal,-this.distanceToPoint(er))}intersectLine(er,tr){const ir=er.delta(_vector1),nr=this.normal.dot(ir);if(nr===0)return this.distanceToPoint(er.start)===0?tr.copy(er.start):null;const sr=-(er.start.dot(this.normal)+this.constant)/nr;return sr<0||sr>1?null:tr.copy(er.start).addScaledVector(ir,sr)}intersectsLine(er){const tr=this.distanceToPoint(er.start),ir=this.distanceToPoint(er.end);return tr<0&&ir>0||ir<0&&tr>0}intersectsBox(er){return er.intersectsPlane(this)}intersectsSphere(er){return er.intersectsPlane(this)}coplanarPoint(er){return er.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(er,tr){const ir=tr||_normalMatrix$1.getNormalMatrix(er),nr=this.coplanarPoint(_vector1).applyMatrix4(er),sr=this.normal.applyMatrix3(ir).normalize();return this.constant=-nr.dot(sr),this}translate(er){return this.constant-=er.dot(this.normal),this}equals(er){return er.normal.equals(this.normal)&&er.constant===this.constant}clone(){return new this.constructor().copy(this)}}const _sphere$5=new Sphere,_vector$7=new Vector3$1;class Frustum{constructor(er=new Plane,tr=new Plane,ir=new Plane,nr=new Plane,sr=new Plane,ar=new Plane){this.planes=[er,tr,ir,nr,sr,ar]}set(er,tr,ir,nr,sr,ar){const or=this.planes;return or[0].copy(er),or[1].copy(tr),or[2].copy(ir),or[3].copy(nr),or[4].copy(sr),or[5].copy(ar),this}copy(er){const tr=this.planes;for(let ir=0;ir<6;ir++)tr[ir].copy(er.planes[ir]);return this}setFromProjectionMatrix(er,tr=WebGLCoordinateSystem){const ir=this.planes,nr=er.elements,sr=nr[0],ar=nr[1],or=nr[2],lr=nr[3],cr=nr[4],ur=nr[5],dr=nr[6],hr=nr[7],pr=nr[8],gr=nr[9],vr=nr[10],mr=nr[11],fr=nr[12],_r=nr[13],Ar=nr[14],yr=nr[15];if(ir[0].setComponents(lr-sr,hr-cr,mr-pr,yr-fr).normalize(),ir[1].setComponents(lr+sr,hr+cr,mr+pr,yr+fr).normalize(),ir[2].setComponents(lr+ar,hr+ur,mr+gr,yr+_r).normalize(),ir[3].setComponents(lr-ar,hr-ur,mr-gr,yr-_r).normalize(),ir[4].setComponents(lr-or,hr-dr,mr-vr,yr-Ar).normalize(),tr===WebGLCoordinateSystem)ir[5].setComponents(lr+or,hr+dr,mr+vr,yr+Ar).normalize();else if(tr===WebGPUCoordinateSystem)ir[5].setComponents(or,dr,vr,Ar).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+tr);return this}intersectsObject(er){if(er.boundingSphere!==void 0)er.boundingSphere===null&&er.computeBoundingSphere(),_sphere$5.copy(er.boundingSphere).applyMatrix4(er.matrixWorld);else{const tr=er.geometry;tr.boundingSphere===null&&tr.computeBoundingSphere(),_sphere$5.copy(tr.boundingSphere).applyMatrix4(er.matrixWorld)}return this.intersectsSphere(_sphere$5)}intersectsSprite(er){return _sphere$5.center.set(0,0,0),_sphere$5.radius=.7071067811865476,_sphere$5.applyMatrix4(er.matrixWorld),this.intersectsSphere(_sphere$5)}intersectsSphere(er){const tr=this.planes,ir=er.center,nr=-er.radius;for(let sr=0;sr<6;sr++)if(tr[sr].distanceToPoint(ir)<nr)return!1;return!0}intersectsBox(er){const tr=this.planes;for(let ir=0;ir<6;ir++){const nr=tr[ir];if(_vector$7.x=nr.normal.x>0?er.max.x:er.min.x,_vector$7.y=nr.normal.y>0?er.max.y:er.min.y,_vector$7.z=nr.normal.z>0?er.max.z:er.min.z,nr.distanceToPoint(_vector$7)<0)return!1}return!0}containsPoint(er){const tr=this.planes;for(let ir=0;ir<6;ir++)if(tr[ir].distanceToPoint(er)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function WebGLAnimation(){let rr=null,er=!1,tr=null,ir=null;function nr(sr,ar){tr(sr,ar),ir=rr.requestAnimationFrame(nr)}return{start:function(){er!==!0&&tr!==null&&(ir=rr.requestAnimationFrame(nr),er=!0)},stop:function(){rr.cancelAnimationFrame(ir),er=!1},setAnimationLoop:function(sr){tr=sr},setContext:function(sr){rr=sr}}}function WebGLAttributes(rr){const er=new WeakMap;function tr(or,lr){const cr=or.array,ur=or.usage,dr=cr.byteLength,hr=rr.createBuffer();rr.bindBuffer(lr,hr),rr.bufferData(lr,cr,ur),or.onUploadCallback();let pr;if(cr instanceof Float32Array)pr=rr.FLOAT;else if(cr instanceof Uint16Array)or.isFloat16BufferAttribute?pr=rr.HALF_FLOAT:pr=rr.UNSIGNED_SHORT;else if(cr instanceof Int16Array)pr=rr.SHORT;else if(cr instanceof Uint32Array)pr=rr.UNSIGNED_INT;else if(cr instanceof Int32Array)pr=rr.INT;else if(cr instanceof Int8Array)pr=rr.BYTE;else if(cr instanceof Uint8Array)pr=rr.UNSIGNED_BYTE;else if(cr instanceof Uint8ClampedArray)pr=rr.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+cr);return{buffer:hr,type:pr,bytesPerElement:cr.BYTES_PER_ELEMENT,version:or.version,size:dr}}function ir(or,lr,cr){const ur=lr.array,dr=lr.updateRanges;if(rr.bindBuffer(cr,or),dr.length===0)rr.bufferSubData(cr,0,ur);else{dr.sort((pr,gr)=>pr.start-gr.start);let hr=0;for(let pr=1;pr<dr.length;pr++){const gr=dr[hr],vr=dr[pr];vr.start<=gr.start+gr.count+1?gr.count=Math.max(gr.count,vr.start+vr.count-gr.start):(++hr,dr[hr]=vr)}dr.length=hr+1;for(let pr=0,gr=dr.length;pr<gr;pr++){const vr=dr[pr];rr.bufferSubData(cr,vr.start*ur.BYTES_PER_ELEMENT,ur,vr.start,vr.count)}lr.clearUpdateRanges()}lr.onUploadCallback()}function nr(or){return or.isInterleavedBufferAttribute&&(or=or.data),er.get(or)}function sr(or){or.isInterleavedBufferAttribute&&(or=or.data);const lr=er.get(or);lr&&(rr.deleteBuffer(lr.buffer),er.delete(or))}function ar(or,lr){if(or.isInterleavedBufferAttribute&&(or=or.data),or.isGLBufferAttribute){const ur=er.get(or);(!ur||ur.version<or.version)&&er.set(or,{buffer:or.buffer,type:or.type,bytesPerElement:or.elementSize,version:or.version});return}const cr=er.get(or);if(cr===void 0)er.set(or,tr(or,lr));else if(cr.version<or.version){if(cr.size!==or.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");ir(cr.buffer,or,lr),cr.version=or.version}}return{get:nr,remove:sr,update:ar}}class PlaneGeometry extends BufferGeometry{constructor(er=1,tr=1,ir=1,nr=1){super(),this.type="PlaneGeometry",this.parameters={width:er,height:tr,widthSegments:ir,heightSegments:nr};const sr=er/2,ar=tr/2,or=Math.floor(ir),lr=Math.floor(nr),cr=or+1,ur=lr+1,dr=er/or,hr=tr/lr,pr=[],gr=[],vr=[],mr=[];for(let fr=0;fr<ur;fr++){const _r=fr*hr-ar;for(let Ar=0;Ar<cr;Ar++){const yr=Ar*dr-sr;gr.push(yr,-_r,0),vr.push(0,0,1),mr.push(Ar/or),mr.push(1-fr/lr)}}for(let fr=0;fr<lr;fr++)for(let _r=0;_r<or;_r++){const Ar=_r+cr*fr,yr=_r+cr*(fr+1),wr=_r+1+cr*(fr+1),xr=_r+1+cr*fr;pr.push(Ar,yr,xr),pr.push(yr,wr,xr)}this.setIndex(pr),this.setAttribute("position",new Float32BufferAttribute(gr,3)),this.setAttribute("normal",new Float32BufferAttribute(vr,3)),this.setAttribute("uv",new Float32BufferAttribute(mr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new PlaneGeometry(er.width,er.height,er.widthSegments,er.heightSegments)}}var alphahash_fragment=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,alphahash_pars_fragment=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,alphamap_fragment=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,alphamap_pars_fragment=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,alphatest_pars_fragment=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,batching_pars_vertex=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,batching_vertex=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,begin_vertex=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,beginnormal_vertex=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,iridescence_fragment=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,clipping_planes_pars_fragment=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,common=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,cube_uv_reflection_fragment=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,colorspace_fragment="gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,envmap_fragment=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_vertex=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_pars_fragment=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,lights_pars_begin=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,envmap_physical_pars_fragment=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,lights_toon_fragment=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,lights_phong_fragment=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,lights_physical_fragment=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lights_physical_pars_fragment=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,logdepthbuf_fragment=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_vertex=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,map_fragment=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphinstance_vertex=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,morphcolor_vertex=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,morphtarget_pars_vertex=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,morphtarget_vertex=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,normal_fragment_begin=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,normal_fragment_maps=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,clearcoat_normal_fragment_begin=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,clearcoat_normal_fragment_maps=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,clearcoat_pars_fragment=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,iridescence_pars_fragment=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,opaque_fragment=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,premultiplied_alpha_fragment=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,shadowmap_pars_vertex=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,shadowmask_pars_fragment=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,skinning_vertex=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,transmission_pars_fragment=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,uv_pars_fragment=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_pars_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,uv_vertex=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,worldpos_vertex=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const vertex$h=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,fragment$h=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$g=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$g=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$f=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fragment$f=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$e=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,fragment$e=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,vertex$d=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,fragment$d=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vertex$c=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,fragment$c=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,vertex$b=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$b=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$a=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,fragment$a=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$9=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$9=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$8=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,fragment$8=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$7=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,fragment$7=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,vertex$6=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$6=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$5=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,fragment$5=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$4=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$4=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,vertex$3=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,fragment$3=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vertex$2=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,fragment$2=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,vertex$1=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,fragment$1=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,ShaderChunk={alphahash_fragment,alphahash_pars_fragment,alphamap_fragment,alphamap_pars_fragment,alphatest_fragment,alphatest_pars_fragment,aomap_fragment,aomap_pars_fragment,batching_pars_vertex,batching_vertex,begin_vertex,beginnormal_vertex,bsdfs,iridescence_fragment,bumpmap_pars_fragment,clipping_planes_fragment,clipping_planes_pars_fragment,clipping_planes_pars_vertex,clipping_planes_vertex,color_fragment,color_pars_fragment,color_pars_vertex,color_vertex,common,cube_uv_reflection_fragment,defaultnormal_vertex,displacementmap_pars_vertex,displacementmap_vertex,emissivemap_fragment,emissivemap_pars_fragment,colorspace_fragment,colorspace_pars_fragment,envmap_fragment,envmap_common_pars_fragment,envmap_pars_fragment,envmap_pars_vertex,envmap_physical_pars_fragment,envmap_vertex,fog_vertex,fog_pars_vertex,fog_fragment,fog_pars_fragment,gradientmap_pars_fragment,lightmap_pars_fragment,lights_lambert_fragment,lights_lambert_pars_fragment,lights_pars_begin,lights_toon_fragment,lights_toon_pars_fragment,lights_phong_fragment,lights_phong_pars_fragment,lights_physical_fragment,lights_physical_pars_fragment,lights_fragment_begin,lights_fragment_maps,lights_fragment_end,logdepthbuf_fragment,logdepthbuf_pars_fragment,logdepthbuf_pars_vertex,logdepthbuf_vertex,map_fragment,map_pars_fragment,map_particle_fragment,map_particle_pars_fragment,metalnessmap_fragment,metalnessmap_pars_fragment,morphinstance_vertex,morphcolor_vertex,morphnormal_vertex,morphtarget_pars_vertex,morphtarget_vertex,normal_fragment_begin,normal_fragment_maps,normal_pars_fragment,normal_pars_vertex,normal_vertex,normalmap_pars_fragment,clearcoat_normal_fragment_begin,clearcoat_normal_fragment_maps,clearcoat_pars_fragment,iridescence_pars_fragment,opaque_fragment,packing,premultiplied_alpha_fragment,project_vertex,dithering_fragment,dithering_pars_fragment,roughnessmap_fragment,roughnessmap_pars_fragment,shadowmap_pars_fragment,shadowmap_pars_vertex,shadowmap_vertex,shadowmask_pars_fragment,skinbase_vertex,skinning_pars_vertex,skinning_vertex,skinnormal_vertex,specularmap_fragment,specularmap_pars_fragment,tonemapping_fragment,tonemapping_pars_fragment,transmission_fragment,transmission_pars_fragment,uv_pars_fragment,uv_pars_vertex,uv_vertex,worldpos_vertex,background_vert:vertex$h,background_frag:fragment$h,backgroundCube_vert:vertex$g,backgroundCube_frag:fragment$g,cube_vert:vertex$f,cube_frag:fragment$f,depth_vert:vertex$e,depth_frag:fragment$e,distanceRGBA_vert:vertex$d,distanceRGBA_frag:fragment$d,equirect_vert:vertex$c,equirect_frag:fragment$c,linedashed_vert:vertex$b,linedashed_frag:fragment$b,meshbasic_vert:vertex$a,meshbasic_frag:fragment$a,meshlambert_vert:vertex$9,meshlambert_frag:fragment$9,meshmatcap_vert:vertex$8,meshmatcap_frag:fragment$8,meshnormal_vert:vertex$7,meshnormal_frag:fragment$7,meshphong_vert:vertex$6,meshphong_frag:fragment$6,meshphysical_vert:vertex$5,meshphysical_frag:fragment$5,meshtoon_vert:vertex$4,meshtoon_frag:fragment$4,points_vert:vertex$3,points_frag:fragment$3,shadow_vert:vertex$2,shadow_frag:fragment$2,sprite_vert:vertex$1,sprite_frag:fragment$1},UniformsLib={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Matrix3}},envmap:{envMap:{value:null},envMapRotation:{value:new Matrix3},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Matrix3}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Matrix3}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Matrix3},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Matrix3},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Matrix3},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Matrix3}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Matrix3}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Matrix3}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Matrix3},alphaMap:{value:null},alphaMapTransform:{value:new Matrix3},alphaTest:{value:0}}},ShaderLib={basic:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},toon:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshtoon_vert,fragmentShader:ShaderChunk.meshtoon_frag},matcap:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.fog,{matcap:{value:null}}]),vertexShader:ShaderChunk.meshmatcap_vert,fragmentShader:ShaderChunk.meshmatcap_frag},points:{uniforms:mergeUniforms([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.meshnormal_vert,fragmentShader:ShaderChunk.meshnormal_frag},sprite:{uniforms:mergeUniforms([UniformsLib.sprite,UniformsLib.fog]),vertexShader:ShaderChunk.sprite_vert,fragmentShader:ShaderChunk.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:ShaderChunk.background_vert,fragmentShader:ShaderChunk.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Matrix3}},vertexShader:ShaderChunk.backgroundCube_vert,fragmentShader:ShaderChunk.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:mergeUniforms([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3$1},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:mergeUniforms([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:mergeUniforms([ShaderLib.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Matrix3},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Matrix3},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Matrix3},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Matrix3},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Matrix3},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Matrix3},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Matrix3},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Matrix3},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Matrix3},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Matrix3},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Matrix3},anisotropyVector:{value:new Vector2},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Matrix3}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};const _rgb={r:0,b:0,g:0},_e1$1=new Euler,_m1$1=new Matrix4;function WebGLBackground(rr,er,tr,ir,nr,sr,ar){const or=new Color(0);let lr=sr===!0?0:1,cr,ur,dr=null,hr=0,pr=null;function gr(_r){let Ar=_r.isScene===!0?_r.background:null;return Ar&&Ar.isTexture&&(Ar=(_r.backgroundBlurriness>0?tr:er).get(Ar)),Ar}function vr(_r){let Ar=!1;const yr=gr(_r);yr===null?fr(or,lr):yr&&yr.isColor&&(fr(yr,1),Ar=!0);const wr=rr.xr.getEnvironmentBlendMode();wr==="additive"?ir.buffers.color.setClear(0,0,0,1,ar):wr==="alpha-blend"&&ir.buffers.color.setClear(0,0,0,0,ar),(rr.autoClear||Ar)&&(ir.buffers.depth.setTest(!0),ir.buffers.depth.setMask(!0),ir.buffers.color.setMask(!0),rr.clear(rr.autoClearColor,rr.autoClearDepth,rr.autoClearStencil))}function mr(_r,Ar){const yr=gr(Ar);yr&&(yr.isCubeTexture||yr.mapping===CubeUVReflectionMapping)?(ur===void 0&&(ur=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:cloneUniforms(ShaderLib.backgroundCube.uniforms),vertexShader:ShaderLib.backgroundCube.vertexShader,fragmentShader:ShaderLib.backgroundCube.fragmentShader,side:BackSide,depthTest:!1,depthWrite:!1,fog:!1})),ur.geometry.deleteAttribute("normal"),ur.geometry.deleteAttribute("uv"),ur.onBeforeRender=function(wr,xr,Sr){this.matrixWorld.copyPosition(Sr.matrixWorld)},Object.defineProperty(ur.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),nr.update(ur)),_e1$1.copy(Ar.backgroundRotation),_e1$1.x*=-1,_e1$1.y*=-1,_e1$1.z*=-1,yr.isCubeTexture&&yr.isRenderTargetTexture===!1&&(_e1$1.y*=-1,_e1$1.z*=-1),ur.material.uniforms.envMap.value=yr,ur.material.uniforms.flipEnvMap.value=yr.isCubeTexture&&yr.isRenderTargetTexture===!1?-1:1,ur.material.uniforms.backgroundBlurriness.value=Ar.backgroundBlurriness,ur.material.uniforms.backgroundIntensity.value=Ar.backgroundIntensity,ur.material.uniforms.backgroundRotation.value.setFromMatrix4(_m1$1.makeRotationFromEuler(_e1$1)),ur.material.toneMapped=ColorManagement.getTransfer(yr.colorSpace)!==SRGBTransfer,(dr!==yr||hr!==yr.version||pr!==rr.toneMapping)&&(ur.material.needsUpdate=!0,dr=yr,hr=yr.version,pr=rr.toneMapping),ur.layers.enableAll(),_r.unshift(ur,ur.geometry,ur.material,0,0,null)):yr&&yr.isTexture&&(cr===void 0&&(cr=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:cloneUniforms(ShaderLib.background.uniforms),vertexShader:ShaderLib.background.vertexShader,fragmentShader:ShaderLib.background.fragmentShader,side:FrontSide,depthTest:!1,depthWrite:!1,fog:!1})),cr.geometry.deleteAttribute("normal"),Object.defineProperty(cr.material,"map",{get:function(){return this.uniforms.t2D.value}}),nr.update(cr)),cr.material.uniforms.t2D.value=yr,cr.material.uniforms.backgroundIntensity.value=Ar.backgroundIntensity,cr.material.toneMapped=ColorManagement.getTransfer(yr.colorSpace)!==SRGBTransfer,yr.matrixAutoUpdate===!0&&yr.updateMatrix(),cr.material.uniforms.uvTransform.value.copy(yr.matrix),(dr!==yr||hr!==yr.version||pr!==rr.toneMapping)&&(cr.material.needsUpdate=!0,dr=yr,hr=yr.version,pr=rr.toneMapping),cr.layers.enableAll(),_r.unshift(cr,cr.geometry,cr.material,0,0,null))}function fr(_r,Ar){_r.getRGB(_rgb,getUnlitUniformColorSpace(rr)),ir.buffers.color.setClear(_rgb.r,_rgb.g,_rgb.b,Ar,ar)}return{getClearColor:function(){return or},setClearColor:function(_r,Ar=1){or.set(_r),lr=Ar,fr(or,lr)},getClearAlpha:function(){return lr},setClearAlpha:function(_r){lr=_r,fr(or,lr)},render:vr,addToRenderList:mr}}function WebGLBindingStates(rr,er){const tr=rr.getParameter(rr.MAX_VERTEX_ATTRIBS),ir={},nr=hr(null);let sr=nr,ar=!1;function or(Ir,Rr,Pr,Dr,Fr){let Or=!1;const Nr=dr(Dr,Pr,Rr);sr!==Nr&&(sr=Nr,cr(sr.object)),Or=pr(Ir,Dr,Pr,Fr),Or&&gr(Ir,Dr,Pr,Fr),Fr!==null&&er.update(Fr,rr.ELEMENT_ARRAY_BUFFER),(Or||ar)&&(ar=!1,yr(Ir,Rr,Pr,Dr),Fr!==null&&rr.bindBuffer(rr.ELEMENT_ARRAY_BUFFER,er.get(Fr).buffer))}function lr(){return rr.createVertexArray()}function cr(Ir){return rr.bindVertexArray(Ir)}function ur(Ir){return rr.deleteVertexArray(Ir)}function dr(Ir,Rr,Pr){const Dr=Pr.wireframe===!0;let Fr=ir[Ir.id];Fr===void 0&&(Fr={},ir[Ir.id]=Fr);let Or=Fr[Rr.id];Or===void 0&&(Or={},Fr[Rr.id]=Or);let Nr=Or[Dr];return Nr===void 0&&(Nr=hr(lr()),Or[Dr]=Nr),Nr}function hr(Ir){const Rr=[],Pr=[],Dr=[];for(let Fr=0;Fr<tr;Fr++)Rr[Fr]=0,Pr[Fr]=0,Dr[Fr]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Rr,enabledAttributes:Pr,attributeDivisors:Dr,object:Ir,attributes:{},index:null}}function pr(Ir,Rr,Pr,Dr){const Fr=sr.attributes,Or=Rr.attributes;let Nr=0;const Ur=Pr.getAttributes();for(const Br in Ur)if(Ur[Br].location>=0){const Xr=Fr[Br];let Yr=Or[Br];if(Yr===void 0&&(Br==="instanceMatrix"&&Ir.instanceMatrix&&(Yr=Ir.instanceMatrix),Br==="instanceColor"&&Ir.instanceColor&&(Yr=Ir.instanceColor)),Xr===void 0||Xr.attribute!==Yr||Yr&&Xr.data!==Yr.data)return!0;Nr++}return sr.attributesNum!==Nr||sr.index!==Dr}function gr(Ir,Rr,Pr,Dr){const Fr={},Or=Rr.attributes;let Nr=0;const Ur=Pr.getAttributes();for(const Br in Ur)if(Ur[Br].location>=0){let Xr=Or[Br];Xr===void 0&&(Br==="instanceMatrix"&&Ir.instanceMatrix&&(Xr=Ir.instanceMatrix),Br==="instanceColor"&&Ir.instanceColor&&(Xr=Ir.instanceColor));const Yr={};Yr.attribute=Xr,Xr&&Xr.data&&(Yr.data=Xr.data),Fr[Br]=Yr,Nr++}sr.attributes=Fr,sr.attributesNum=Nr,sr.index=Dr}function vr(){const Ir=sr.newAttributes;for(let Rr=0,Pr=Ir.length;Rr<Pr;Rr++)Ir[Rr]=0}function mr(Ir){fr(Ir,0)}function fr(Ir,Rr){const Pr=sr.newAttributes,Dr=sr.enabledAttributes,Fr=sr.attributeDivisors;Pr[Ir]=1,Dr[Ir]===0&&(rr.enableVertexAttribArray(Ir),Dr[Ir]=1),Fr[Ir]!==Rr&&(rr.vertexAttribDivisor(Ir,Rr),Fr[Ir]=Rr)}function _r(){const Ir=sr.newAttributes,Rr=sr.enabledAttributes;for(let Pr=0,Dr=Rr.length;Pr<Dr;Pr++)Rr[Pr]!==Ir[Pr]&&(rr.disableVertexAttribArray(Pr),Rr[Pr]=0)}function Ar(Ir,Rr,Pr,Dr,Fr,Or,Nr){Nr===!0?rr.vertexAttribIPointer(Ir,Rr,Pr,Fr,Or):rr.vertexAttribPointer(Ir,Rr,Pr,Dr,Fr,Or)}function yr(Ir,Rr,Pr,Dr){vr();const Fr=Dr.attributes,Or=Pr.getAttributes(),Nr=Rr.defaultAttributeValues;for(const Ur in Or){const Br=Or[Ur];if(Br.location>=0){let Wr=Fr[Ur];if(Wr===void 0&&(Ur==="instanceMatrix"&&Ir.instanceMatrix&&(Wr=Ir.instanceMatrix),Ur==="instanceColor"&&Ir.instanceColor&&(Wr=Ir.instanceColor)),Wr!==void 0){const Xr=Wr.normalized,Yr=Wr.itemSize,Qi=er.get(Wr);if(Qi===void 0)continue;const Xi=Qi.buffer,Kr=Qi.type,$r=Qi.bytesPerElement,Vr=Kr===rr.INT||Kr===rr.UNSIGNED_INT||Wr.gpuType===IntType;if(Wr.isInterleavedBufferAttribute){const Gr=Wr.data,qr=Gr.stride,ji=Wr.offset;if(Gr.isInstancedInterleavedBuffer){for(let Jr=0;Jr<Br.locationSize;Jr++)fr(Br.location+Jr,Gr.meshPerAttribute);Ir.isInstancedMesh!==!0&&Dr._maxInstanceCount===void 0&&(Dr._maxInstanceCount=Gr.meshPerAttribute*Gr.count)}else for(let Jr=0;Jr<Br.locationSize;Jr++)mr(Br.location+Jr);rr.bindBuffer(rr.ARRAY_BUFFER,Xi);for(let Jr=0;Jr<Br.locationSize;Jr++)Ar(Br.location+Jr,Yr/Br.locationSize,Kr,Xr,qr*$r,(ji+Yr/Br.locationSize*Jr)*$r,Vr)}else{if(Wr.isInstancedBufferAttribute){for(let Gr=0;Gr<Br.locationSize;Gr++)fr(Br.location+Gr,Wr.meshPerAttribute);Ir.isInstancedMesh!==!0&&Dr._maxInstanceCount===void 0&&(Dr._maxInstanceCount=Wr.meshPerAttribute*Wr.count)}else for(let Gr=0;Gr<Br.locationSize;Gr++)mr(Br.location+Gr);rr.bindBuffer(rr.ARRAY_BUFFER,Xi);for(let Gr=0;Gr<Br.locationSize;Gr++)Ar(Br.location+Gr,Yr/Br.locationSize,Kr,Xr,Yr*$r,Yr/Br.locationSize*Gr*$r,Vr)}}else if(Nr!==void 0){const Xr=Nr[Ur];if(Xr!==void 0)switch(Xr.length){case 2:rr.vertexAttrib2fv(Br.location,Xr);break;case 3:rr.vertexAttrib3fv(Br.location,Xr);break;case 4:rr.vertexAttrib4fv(Br.location,Xr);break;default:rr.vertexAttrib1fv(Br.location,Xr)}}}}_r()}function wr(){br();for(const Ir in ir){const Rr=ir[Ir];for(const Pr in Rr){const Dr=Rr[Pr];for(const Fr in Dr)ur(Dr[Fr].object),delete Dr[Fr];delete Rr[Pr]}delete ir[Ir]}}function xr(Ir){if(ir[Ir.id]===void 0)return;const Rr=ir[Ir.id];for(const Pr in Rr){const Dr=Rr[Pr];for(const Fr in Dr)ur(Dr[Fr].object),delete Dr[Fr];delete Rr[Pr]}delete ir[Ir.id]}function Sr(Ir){for(const Rr in ir){const Pr=ir[Rr];if(Pr[Ir.id]===void 0)continue;const Dr=Pr[Ir.id];for(const Fr in Dr)ur(Dr[Fr].object),delete Dr[Fr];delete Pr[Ir.id]}}function br(){Cr(),ar=!0,sr!==nr&&(sr=nr,cr(sr.object))}function Cr(){nr.geometry=null,nr.program=null,nr.wireframe=!1}return{setup:or,reset:br,resetDefaultState:Cr,dispose:wr,releaseStatesOfGeometry:xr,releaseStatesOfProgram:Sr,initAttributes:vr,enableAttribute:mr,disableUnusedAttributes:_r}}function WebGLBufferRenderer(rr,er,tr){let ir;function nr(cr){ir=cr}function sr(cr,ur){rr.drawArrays(ir,cr,ur),tr.update(ur,ir,1)}function ar(cr,ur,dr){dr!==0&&(rr.drawArraysInstanced(ir,cr,ur,dr),tr.update(ur,ir,dr))}function or(cr,ur,dr){if(dr===0)return;er.get("WEBGL_multi_draw").multiDrawArraysWEBGL(ir,cr,0,ur,0,dr);let pr=0;for(let gr=0;gr<dr;gr++)pr+=ur[gr];tr.update(pr,ir,1)}function lr(cr,ur,dr,hr){if(dr===0)return;const pr=er.get("WEBGL_multi_draw");if(pr===null)for(let gr=0;gr<cr.length;gr++)ar(cr[gr],ur[gr],hr[gr]);else{pr.multiDrawArraysInstancedWEBGL(ir,cr,0,ur,0,hr,0,dr);let gr=0;for(let vr=0;vr<dr;vr++)gr+=ur[vr]*hr[vr];tr.update(gr,ir,1)}}this.setMode=nr,this.render=sr,this.renderInstances=ar,this.renderMultiDraw=or,this.renderMultiDrawInstances=lr}function WebGLCapabilities(rr,er,tr,ir){let nr;function sr(){if(nr!==void 0)return nr;if(er.has("EXT_texture_filter_anisotropic")===!0){const Sr=er.get("EXT_texture_filter_anisotropic");nr=rr.getParameter(Sr.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else nr=0;return nr}function ar(Sr){return!(Sr!==RGBAFormat&&ir.convert(Sr)!==rr.getParameter(rr.IMPLEMENTATION_COLOR_READ_FORMAT))}function or(Sr){const br=Sr===HalfFloatType&&(er.has("EXT_color_buffer_half_float")||er.has("EXT_color_buffer_float"));return!(Sr!==UnsignedByteType&&ir.convert(Sr)!==rr.getParameter(rr.IMPLEMENTATION_COLOR_READ_TYPE)&&Sr!==FloatType&&!br)}function lr(Sr){if(Sr==="highp"){if(rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.HIGH_FLOAT).precision>0&&rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.HIGH_FLOAT).precision>0)return"highp";Sr="mediump"}return Sr==="mediump"&&rr.getShaderPrecisionFormat(rr.VERTEX_SHADER,rr.MEDIUM_FLOAT).precision>0&&rr.getShaderPrecisionFormat(rr.FRAGMENT_SHADER,rr.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let cr=tr.precision!==void 0?tr.precision:"highp";const ur=lr(cr);ur!==cr&&(console.warn("THREE.WebGLRenderer:",cr,"not supported, using",ur,"instead."),cr=ur);const dr=tr.logarithmicDepthBuffer===!0,hr=tr.reverseDepthBuffer===!0&&er.has("EXT_clip_control"),pr=rr.getParameter(rr.MAX_TEXTURE_IMAGE_UNITS),gr=rr.getParameter(rr.MAX_VERTEX_TEXTURE_IMAGE_UNITS),vr=rr.getParameter(rr.MAX_TEXTURE_SIZE),mr=rr.getParameter(rr.MAX_CUBE_MAP_TEXTURE_SIZE),fr=rr.getParameter(rr.MAX_VERTEX_ATTRIBS),_r=rr.getParameter(rr.MAX_VERTEX_UNIFORM_VECTORS),Ar=rr.getParameter(rr.MAX_VARYING_VECTORS),yr=rr.getParameter(rr.MAX_FRAGMENT_UNIFORM_VECTORS),wr=gr>0,xr=rr.getParameter(rr.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:sr,getMaxPrecision:lr,textureFormatReadable:ar,textureTypeReadable:or,precision:cr,logarithmicDepthBuffer:dr,reverseDepthBuffer:hr,maxTextures:pr,maxVertexTextures:gr,maxTextureSize:vr,maxCubemapSize:mr,maxAttributes:fr,maxVertexUniforms:_r,maxVaryings:Ar,maxFragmentUniforms:yr,vertexTextures:wr,maxSamples:xr}}function WebGLClipping(rr){const er=this;let tr=null,ir=0,nr=!1,sr=!1;const ar=new Plane,or=new Matrix3,lr={value:null,needsUpdate:!1};this.uniform=lr,this.numPlanes=0,this.numIntersection=0,this.init=function(dr,hr){const pr=dr.length!==0||hr||ir!==0||nr;return nr=hr,ir=dr.length,pr},this.beginShadows=function(){sr=!0,ur(null)},this.endShadows=function(){sr=!1},this.setGlobalState=function(dr,hr){tr=ur(dr,hr,0)},this.setState=function(dr,hr,pr){const gr=dr.clippingPlanes,vr=dr.clipIntersection,mr=dr.clipShadows,fr=rr.get(dr);if(!nr||gr===null||gr.length===0||sr&&!mr)sr?ur(null):cr();else{const _r=sr?0:ir,Ar=_r*4;let yr=fr.clippingState||null;lr.value=yr,yr=ur(gr,hr,Ar,pr);for(let wr=0;wr!==Ar;++wr)yr[wr]=tr[wr];fr.clippingState=yr,this.numIntersection=vr?this.numPlanes:0,this.numPlanes+=_r}};function cr(){lr.value!==tr&&(lr.value=tr,lr.needsUpdate=ir>0),er.numPlanes=ir,er.numIntersection=0}function ur(dr,hr,pr,gr){const vr=dr!==null?dr.length:0;let mr=null;if(vr!==0){if(mr=lr.value,gr!==!0||mr===null){const fr=pr+vr*4,_r=hr.matrixWorldInverse;or.getNormalMatrix(_r),(mr===null||mr.length<fr)&&(mr=new Float32Array(fr));for(let Ar=0,yr=pr;Ar!==vr;++Ar,yr+=4)ar.copy(dr[Ar]).applyMatrix4(_r,or),ar.normal.toArray(mr,yr),mr[yr+3]=ar.constant}lr.value=mr,lr.needsUpdate=!0}return er.numPlanes=vr,er.numIntersection=0,mr}}function WebGLCubeMaps(rr){let er=new WeakMap;function tr(ar,or){return or===EquirectangularReflectionMapping?ar.mapping=CubeReflectionMapping:or===EquirectangularRefractionMapping&&(ar.mapping=CubeRefractionMapping),ar}function ir(ar){if(ar&&ar.isTexture){const or=ar.mapping;if(or===EquirectangularReflectionMapping||or===EquirectangularRefractionMapping)if(er.has(ar)){const lr=er.get(ar).texture;return tr(lr,ar.mapping)}else{const lr=ar.image;if(lr&&lr.height>0){const cr=new WebGLCubeRenderTarget(lr.height);return cr.fromEquirectangularTexture(rr,ar),er.set(ar,cr),ar.addEventListener("dispose",nr),tr(cr.texture,ar.mapping)}else return null}}return ar}function nr(ar){const or=ar.target;or.removeEventListener("dispose",nr);const lr=er.get(or);lr!==void 0&&(er.delete(or),lr.dispose())}function sr(){er=new WeakMap}return{get:ir,dispose:sr}}class OrthographicCamera extends Camera{constructor(er=-1,tr=1,ir=1,nr=-1,sr=.1,ar=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=er,this.right=tr,this.top=ir,this.bottom=nr,this.near=sr,this.far=ar,this.updateProjectionMatrix()}copy(er,tr){return super.copy(er,tr),this.left=er.left,this.right=er.right,this.top=er.top,this.bottom=er.bottom,this.near=er.near,this.far=er.far,this.zoom=er.zoom,this.view=er.view===null?null:Object.assign({},er.view),this}setViewOffset(er,tr,ir,nr,sr,ar){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=er,this.view.fullHeight=tr,this.view.offsetX=ir,this.view.offsetY=nr,this.view.width=sr,this.view.height=ar,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const er=(this.right-this.left)/(2*this.zoom),tr=(this.top-this.bottom)/(2*this.zoom),ir=(this.right+this.left)/2,nr=(this.top+this.bottom)/2;let sr=ir-er,ar=ir+er,or=nr+tr,lr=nr-tr;if(this.view!==null&&this.view.enabled){const cr=(this.right-this.left)/this.view.fullWidth/this.zoom,ur=(this.top-this.bottom)/this.view.fullHeight/this.zoom;sr+=cr*this.view.offsetX,ar=sr+cr*this.view.width,or-=ur*this.view.offsetY,lr=or-ur*this.view.height}this.projectionMatrix.makeOrthographic(sr,ar,or,lr,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(er){const tr=super.toJSON(er);return tr.object.zoom=this.zoom,tr.object.left=this.left,tr.object.right=this.right,tr.object.top=this.top,tr.object.bottom=this.bottom,tr.object.near=this.near,tr.object.far=this.far,this.view!==null&&(tr.object.view=Object.assign({},this.view)),tr}}const LOD_MIN=4,EXTRA_LOD_SIGMA=[.125,.215,.35,.446,.526,.582],MAX_SAMPLES=20,_flatCamera=new OrthographicCamera,_clearColor=new Color;let _oldTarget=null,_oldActiveCubeFace=0,_oldActiveMipmapLevel=0,_oldXrEnabled=!1;const PHI=(1+Math.sqrt(5))/2,INV_PHI=1/PHI,_axisDirections=[new Vector3$1(-PHI,INV_PHI,0),new Vector3$1(PHI,INV_PHI,0),new Vector3$1(-INV_PHI,0,PHI),new Vector3$1(INV_PHI,0,PHI),new Vector3$1(0,PHI,-INV_PHI),new Vector3$1(0,PHI,INV_PHI),new Vector3$1(-1,1,-1),new Vector3$1(1,1,-1),new Vector3$1(-1,1,1),new Vector3$1(1,1,1)];class PMREMGenerator{constructor(er){this._renderer=er,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(er,tr=0,ir=.1,nr=100){_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const sr=this._allocateTargets();return sr.depthBuffer=!0,this._sceneToCubeUV(er,ir,nr,sr),tr>0&&this._blur(sr,0,0,tr),this._applyPMREM(sr),this._cleanup(sr),sr}fromEquirectangular(er,tr=null){return this._fromTexture(er,tr)}fromCubemap(er,tr=null){return this._fromTexture(er,tr)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(er){this._lodMax=Math.floor(Math.log2(er)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let er=0;er<this._lodPlanes.length;er++)this._lodPlanes[er].dispose()}_cleanup(er){this._renderer.setRenderTarget(_oldTarget,_oldActiveCubeFace,_oldActiveMipmapLevel),this._renderer.xr.enabled=_oldXrEnabled,er.scissorTest=!1,_setViewport(er,0,0,er.width,er.height)}_fromTexture(er,tr){er.mapping===CubeReflectionMapping||er.mapping===CubeRefractionMapping?this._setSize(er.image.length===0?16:er.image[0].width||er.image[0].image.width):this._setSize(er.image.width/4),_oldTarget=this._renderer.getRenderTarget(),_oldActiveCubeFace=this._renderer.getActiveCubeFace(),_oldActiveMipmapLevel=this._renderer.getActiveMipmapLevel(),_oldXrEnabled=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const ir=tr||this._allocateTargets();return this._textureToCubeUV(er,ir),this._applyPMREM(ir),this._cleanup(ir),ir}_allocateTargets(){const er=3*Math.max(this._cubeSize,112),tr=4*this._cubeSize,ir={magFilter:LinearFilter,minFilter:LinearFilter,generateMipmaps:!1,type:HalfFloatType,format:RGBAFormat,colorSpace:LinearSRGBColorSpace,depthBuffer:!1},nr=_createRenderTarget(er,tr,ir);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==er||this._pingPongRenderTarget.height!==tr){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=_createRenderTarget(er,tr,ir);const{_lodMax:sr}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=_createPlanes(sr)),this._blurMaterial=_getBlurShader(sr,er,tr)}return nr}_compileMaterial(er){const tr=new Mesh(this._lodPlanes[0],er);this._renderer.compile(tr,_flatCamera)}_sceneToCubeUV(er,tr,ir,nr){const or=new PerspectiveCamera(90,1,tr,ir),lr=[1,-1,1,1,1,1],cr=[1,1,1,-1,-1,-1],ur=this._renderer,dr=ur.autoClear,hr=ur.toneMapping;ur.getClearColor(_clearColor),ur.toneMapping=NoToneMapping,ur.autoClear=!1;const pr=new MeshBasicMaterial({name:"PMREM.Background",side:BackSide,depthWrite:!1,depthTest:!1}),gr=new Mesh(new BoxGeometry,pr);let vr=!1;const mr=er.background;mr?mr.isColor&&(pr.color.copy(mr),er.background=null,vr=!0):(pr.color.copy(_clearColor),vr=!0);for(let fr=0;fr<6;fr++){const _r=fr%3;_r===0?(or.up.set(0,lr[fr],0),or.lookAt(cr[fr],0,0)):_r===1?(or.up.set(0,0,lr[fr]),or.lookAt(0,cr[fr],0)):(or.up.set(0,lr[fr],0),or.lookAt(0,0,cr[fr]));const Ar=this._cubeSize;_setViewport(nr,_r*Ar,fr>2?Ar:0,Ar,Ar),ur.setRenderTarget(nr),vr&&ur.render(gr,or),ur.render(er,or)}gr.geometry.dispose(),gr.material.dispose(),ur.toneMapping=hr,ur.autoClear=dr,er.background=mr}_textureToCubeUV(er,tr){const ir=this._renderer,nr=er.mapping===CubeReflectionMapping||er.mapping===CubeRefractionMapping;nr?(this._cubemapMaterial===null&&(this._cubemapMaterial=_getCubemapMaterial()),this._cubemapMaterial.uniforms.flipEnvMap.value=er.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=_getEquirectMaterial());const sr=nr?this._cubemapMaterial:this._equirectMaterial,ar=new Mesh(this._lodPlanes[0],sr),or=sr.uniforms;or.envMap.value=er;const lr=this._cubeSize;_setViewport(tr,0,0,3*lr,2*lr),ir.setRenderTarget(tr),ir.render(ar,_flatCamera)}_applyPMREM(er){const tr=this._renderer,ir=tr.autoClear;tr.autoClear=!1;const nr=this._lodPlanes.length;for(let sr=1;sr<nr;sr++){const ar=Math.sqrt(this._sigmas[sr]*this._sigmas[sr]-this._sigmas[sr-1]*this._sigmas[sr-1]),or=_axisDirections[(nr-sr-1)%_axisDirections.length];this._blur(er,sr-1,sr,ar,or)}tr.autoClear=ir}_blur(er,tr,ir,nr,sr){const ar=this._pingPongRenderTarget;this._halfBlur(er,ar,tr,ir,nr,"latitudinal",sr),this._halfBlur(ar,er,ir,ir,nr,"longitudinal",sr)}_halfBlur(er,tr,ir,nr,sr,ar,or){const lr=this._renderer,cr=this._blurMaterial;ar!=="latitudinal"&&ar!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const ur=3,dr=new Mesh(this._lodPlanes[nr],cr),hr=cr.uniforms,pr=this._sizeLods[ir]-1,gr=isFinite(sr)?Math.PI/(2*pr):2*Math.PI/(2*MAX_SAMPLES-1),vr=sr/gr,mr=isFinite(sr)?1+Math.floor(ur*vr):MAX_SAMPLES;mr>MAX_SAMPLES&&console.warn(`sigmaRadians, ${sr}, is too large and will clip, as it requested ${mr} samples when the maximum is set to ${MAX_SAMPLES}`);const fr=[];let _r=0;for(let Sr=0;Sr<MAX_SAMPLES;++Sr){const br=Sr/vr,Cr=Math.exp(-br*br/2);fr.push(Cr),Sr===0?_r+=Cr:Sr<mr&&(_r+=2*Cr)}for(let Sr=0;Sr<fr.length;Sr++)fr[Sr]=fr[Sr]/_r;hr.envMap.value=er.texture,hr.samples.value=mr,hr.weights.value=fr,hr.latitudinal.value=ar==="latitudinal",or&&(hr.poleAxis.value=or);const{_lodMax:Ar}=this;hr.dTheta.value=gr,hr.mipInt.value=Ar-ir;const yr=this._sizeLods[nr],wr=3*yr*(nr>Ar-LOD_MIN?nr-Ar+LOD_MIN:0),xr=4*(this._cubeSize-yr);_setViewport(tr,wr,xr,3*yr,2*yr),lr.setRenderTarget(tr),lr.render(dr,_flatCamera)}}function _createPlanes(rr){const er=[],tr=[],ir=[];let nr=rr;const sr=rr-LOD_MIN+1+EXTRA_LOD_SIGMA.length;for(let ar=0;ar<sr;ar++){const or=Math.pow(2,nr);tr.push(or);let lr=1/or;ar>rr-LOD_MIN?lr=EXTRA_LOD_SIGMA[ar-rr+LOD_MIN-1]:ar===0&&(lr=0),ir.push(lr);const cr=1/(or-2),ur=-cr,dr=1+cr,hr=[ur,ur,dr,ur,dr,dr,ur,ur,dr,dr,ur,dr],pr=6,gr=6,vr=3,mr=2,fr=1,_r=new Float32Array(vr*gr*pr),Ar=new Float32Array(mr*gr*pr),yr=new Float32Array(fr*gr*pr);for(let xr=0;xr<pr;xr++){const Sr=xr%3*2/3-1,br=xr>2?0:-1,Cr=[Sr,br,0,Sr+2/3,br,0,Sr+2/3,br+1,0,Sr,br,0,Sr+2/3,br+1,0,Sr,br+1,0];_r.set(Cr,vr*gr*xr),Ar.set(hr,mr*gr*xr);const Ir=[xr,xr,xr,xr,xr,xr];yr.set(Ir,fr*gr*xr)}const wr=new BufferGeometry;wr.setAttribute("position",new BufferAttribute(_r,vr)),wr.setAttribute("uv",new BufferAttribute(Ar,mr)),wr.setAttribute("faceIndex",new BufferAttribute(yr,fr)),er.push(wr),nr>LOD_MIN&&nr--}return{lodPlanes:er,sizeLods:tr,sigmas:ir}}function _createRenderTarget(rr,er,tr){const ir=new WebGLRenderTarget(rr,er,tr);return ir.texture.mapping=CubeUVReflectionMapping,ir.texture.name="PMREM.cubeUv",ir.scissorTest=!0,ir}function _setViewport(rr,er,tr,ir,nr){rr.viewport.set(er,tr,ir,nr),rr.scissor.set(er,tr,ir,nr)}function _getBlurShader(rr,er,tr){const ir=new Float32Array(MAX_SAMPLES),nr=new Vector3$1(0,1,0);return new ShaderMaterial({name:"SphericalGaussianBlur",defines:{n:MAX_SAMPLES,CUBEUV_TEXEL_WIDTH:1/er,CUBEUV_TEXEL_HEIGHT:1/tr,CUBEUV_MAX_MIP:`${rr}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:ir},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:nr}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getEquirectMaterial(){return new ShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCubemapMaterial(){return new ShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:_getCommonVertexShader(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:NoBlending,depthTest:!1,depthWrite:!1})}function _getCommonVertexShader(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function WebGLCubeUVMaps(rr){let er=new WeakMap,tr=null;function ir(or){if(or&&or.isTexture){const lr=or.mapping,cr=lr===EquirectangularReflectionMapping||lr===EquirectangularRefractionMapping,ur=lr===CubeReflectionMapping||lr===CubeRefractionMapping;if(cr||ur){let dr=er.get(or);const hr=dr!==void 0?dr.texture.pmremVersion:0;if(or.isRenderTargetTexture&&or.pmremVersion!==hr)return tr===null&&(tr=new PMREMGenerator(rr)),dr=cr?tr.fromEquirectangular(or,dr):tr.fromCubemap(or,dr),dr.texture.pmremVersion=or.pmremVersion,er.set(or,dr),dr.texture;if(dr!==void 0)return dr.texture;{const pr=or.image;return cr&&pr&&pr.height>0||ur&&pr&&nr(pr)?(tr===null&&(tr=new PMREMGenerator(rr)),dr=cr?tr.fromEquirectangular(or):tr.fromCubemap(or),dr.texture.pmremVersion=or.pmremVersion,er.set(or,dr),or.addEventListener("dispose",sr),dr.texture):null}}}return or}function nr(or){let lr=0;const cr=6;for(let ur=0;ur<cr;ur++)or[ur]!==void 0&&lr++;return lr===cr}function sr(or){const lr=or.target;lr.removeEventListener("dispose",sr);const cr=er.get(lr);cr!==void 0&&(er.delete(lr),cr.dispose())}function ar(){er=new WeakMap,tr!==null&&(tr.dispose(),tr=null)}return{get:ir,dispose:ar}}function WebGLExtensions(rr){const er={};function tr(ir){if(er[ir]!==void 0)return er[ir];let nr;switch(ir){case"WEBGL_depth_texture":nr=rr.getExtension("WEBGL_depth_texture")||rr.getExtension("MOZ_WEBGL_depth_texture")||rr.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":nr=rr.getExtension("EXT_texture_filter_anisotropic")||rr.getExtension("MOZ_EXT_texture_filter_anisotropic")||rr.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":nr=rr.getExtension("WEBGL_compressed_texture_s3tc")||rr.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||rr.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":nr=rr.getExtension("WEBGL_compressed_texture_pvrtc")||rr.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:nr=rr.getExtension(ir)}return er[ir]=nr,nr}return{has:function(ir){return tr(ir)!==null},init:function(){tr("EXT_color_buffer_float"),tr("WEBGL_clip_cull_distance"),tr("OES_texture_float_linear"),tr("EXT_color_buffer_half_float"),tr("WEBGL_multisampled_render_to_texture"),tr("WEBGL_render_shared_exponent")},get:function(ir){const nr=tr(ir);return nr===null&&warnOnce("THREE.WebGLRenderer: "+ir+" extension not supported."),nr}}}function WebGLGeometries(rr,er,tr,ir){const nr={},sr=new WeakMap;function ar(dr){const hr=dr.target;hr.index!==null&&er.remove(hr.index);for(const gr in hr.attributes)er.remove(hr.attributes[gr]);for(const gr in hr.morphAttributes){const vr=hr.morphAttributes[gr];for(let mr=0,fr=vr.length;mr<fr;mr++)er.remove(vr[mr])}hr.removeEventListener("dispose",ar),delete nr[hr.id];const pr=sr.get(hr);pr&&(er.remove(pr),sr.delete(hr)),ir.releaseStatesOfGeometry(hr),hr.isInstancedBufferGeometry===!0&&delete hr._maxInstanceCount,tr.memory.geometries--}function or(dr,hr){return nr[hr.id]===!0||(hr.addEventListener("dispose",ar),nr[hr.id]=!0,tr.memory.geometries++),hr}function lr(dr){const hr=dr.attributes;for(const gr in hr)er.update(hr[gr],rr.ARRAY_BUFFER);const pr=dr.morphAttributes;for(const gr in pr){const vr=pr[gr];for(let mr=0,fr=vr.length;mr<fr;mr++)er.update(vr[mr],rr.ARRAY_BUFFER)}}function cr(dr){const hr=[],pr=dr.index,gr=dr.attributes.position;let vr=0;if(pr!==null){const _r=pr.array;vr=pr.version;for(let Ar=0,yr=_r.length;Ar<yr;Ar+=3){const wr=_r[Ar+0],xr=_r[Ar+1],Sr=_r[Ar+2];hr.push(wr,xr,xr,Sr,Sr,wr)}}else if(gr!==void 0){const _r=gr.array;vr=gr.version;for(let Ar=0,yr=_r.length/3-1;Ar<yr;Ar+=3){const wr=Ar+0,xr=Ar+1,Sr=Ar+2;hr.push(wr,xr,xr,Sr,Sr,wr)}}else return;const mr=new(arrayNeedsUint32(hr)?Uint32BufferAttribute:Uint16BufferAttribute)(hr,1);mr.version=vr;const fr=sr.get(dr);fr&&er.remove(fr),sr.set(dr,mr)}function ur(dr){const hr=sr.get(dr);if(hr){const pr=dr.index;pr!==null&&hr.version<pr.version&&cr(dr)}else cr(dr);return sr.get(dr)}return{get:or,update:lr,getWireframeAttribute:ur}}function WebGLIndexedBufferRenderer(rr,er,tr){let ir;function nr(hr){ir=hr}let sr,ar;function or(hr){sr=hr.type,ar=hr.bytesPerElement}function lr(hr,pr){rr.drawElements(ir,pr,sr,hr*ar),tr.update(pr,ir,1)}function cr(hr,pr,gr){gr!==0&&(rr.drawElementsInstanced(ir,pr,sr,hr*ar,gr),tr.update(pr,ir,gr))}function ur(hr,pr,gr){if(gr===0)return;er.get("WEBGL_multi_draw").multiDrawElementsWEBGL(ir,pr,0,sr,hr,0,gr);let mr=0;for(let fr=0;fr<gr;fr++)mr+=pr[fr];tr.update(mr,ir,1)}function dr(hr,pr,gr,vr){if(gr===0)return;const mr=er.get("WEBGL_multi_draw");if(mr===null)for(let fr=0;fr<hr.length;fr++)cr(hr[fr]/ar,pr[fr],vr[fr]);else{mr.multiDrawElementsInstancedWEBGL(ir,pr,0,sr,hr,0,vr,0,gr);let fr=0;for(let _r=0;_r<gr;_r++)fr+=pr[_r]*vr[_r];tr.update(fr,ir,1)}}this.setMode=nr,this.setIndex=or,this.render=lr,this.renderInstances=cr,this.renderMultiDraw=ur,this.renderMultiDrawInstances=dr}function WebGLInfo(rr){const er={geometries:0,textures:0},tr={frame:0,calls:0,triangles:0,points:0,lines:0};function ir(sr,ar,or){switch(tr.calls++,ar){case rr.TRIANGLES:tr.triangles+=or*(sr/3);break;case rr.LINES:tr.lines+=or*(sr/2);break;case rr.LINE_STRIP:tr.lines+=or*(sr-1);break;case rr.LINE_LOOP:tr.lines+=or*sr;break;case rr.POINTS:tr.points+=or*sr;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ar);break}}function nr(){tr.calls=0,tr.triangles=0,tr.points=0,tr.lines=0}return{memory:er,render:tr,programs:null,autoReset:!0,reset:nr,update:ir}}function WebGLMorphtargets(rr,er,tr){const ir=new WeakMap,nr=new Vector4;function sr(ar,or,lr){const cr=ar.morphTargetInfluences,ur=or.morphAttributes.position||or.morphAttributes.normal||or.morphAttributes.color,dr=ur!==void 0?ur.length:0;let hr=ir.get(or);if(hr===void 0||hr.count!==dr){let Cr=function(){Sr.dispose(),ir.delete(or),or.removeEventListener("dispose",Cr)};hr!==void 0&&hr.texture.dispose();const pr=or.morphAttributes.position!==void 0,gr=or.morphAttributes.normal!==void 0,vr=or.morphAttributes.color!==void 0,mr=or.morphAttributes.position||[],fr=or.morphAttributes.normal||[],_r=or.morphAttributes.color||[];let Ar=0;pr===!0&&(Ar=1),gr===!0&&(Ar=2),vr===!0&&(Ar=3);let yr=or.attributes.position.count*Ar,wr=1;yr>er.maxTextureSize&&(wr=Math.ceil(yr/er.maxTextureSize),yr=er.maxTextureSize);const xr=new Float32Array(yr*wr*4*dr),Sr=new DataArrayTexture(xr,yr,wr,dr);Sr.type=FloatType,Sr.needsUpdate=!0;const br=Ar*4;for(let Ir=0;Ir<dr;Ir++){const Rr=mr[Ir],Pr=fr[Ir],Dr=_r[Ir],Fr=yr*wr*4*Ir;for(let Or=0;Or<Rr.count;Or++){const Nr=Or*br;pr===!0&&(nr.fromBufferAttribute(Rr,Or),xr[Fr+Nr+0]=nr.x,xr[Fr+Nr+1]=nr.y,xr[Fr+Nr+2]=nr.z,xr[Fr+Nr+3]=0),gr===!0&&(nr.fromBufferAttribute(Pr,Or),xr[Fr+Nr+4]=nr.x,xr[Fr+Nr+5]=nr.y,xr[Fr+Nr+6]=nr.z,xr[Fr+Nr+7]=0),vr===!0&&(nr.fromBufferAttribute(Dr,Or),xr[Fr+Nr+8]=nr.x,xr[Fr+Nr+9]=nr.y,xr[Fr+Nr+10]=nr.z,xr[Fr+Nr+11]=Dr.itemSize===4?nr.w:1)}}hr={count:dr,texture:Sr,size:new Vector2(yr,wr)},ir.set(or,hr),or.addEventListener("dispose",Cr)}if(ar.isInstancedMesh===!0&&ar.morphTexture!==null)lr.getUniforms().setValue(rr,"morphTexture",ar.morphTexture,tr);else{let pr=0;for(let vr=0;vr<cr.length;vr++)pr+=cr[vr];const gr=or.morphTargetsRelative?1:1-pr;lr.getUniforms().setValue(rr,"morphTargetBaseInfluence",gr),lr.getUniforms().setValue(rr,"morphTargetInfluences",cr)}lr.getUniforms().setValue(rr,"morphTargetsTexture",hr.texture,tr),lr.getUniforms().setValue(rr,"morphTargetsTextureSize",hr.size)}return{update:sr}}function WebGLObjects(rr,er,tr,ir){let nr=new WeakMap;function sr(lr){const cr=ir.render.frame,ur=lr.geometry,dr=er.get(lr,ur);if(nr.get(dr)!==cr&&(er.update(dr),nr.set(dr,cr)),lr.isInstancedMesh&&(lr.hasEventListener("dispose",or)===!1&&lr.addEventListener("dispose",or),nr.get(lr)!==cr&&(tr.update(lr.instanceMatrix,rr.ARRAY_BUFFER),lr.instanceColor!==null&&tr.update(lr.instanceColor,rr.ARRAY_BUFFER),nr.set(lr,cr))),lr.isSkinnedMesh){const hr=lr.skeleton;nr.get(hr)!==cr&&(hr.update(),nr.set(hr,cr))}return dr}function ar(){nr=new WeakMap}function or(lr){const cr=lr.target;cr.removeEventListener("dispose",or),tr.remove(cr.instanceMatrix),cr.instanceColor!==null&&tr.remove(cr.instanceColor)}return{update:sr,dispose:ar}}class DepthTexture extends Texture{constructor(er,tr,ir,nr,sr,ar,or,lr,cr,ur=DepthFormat){if(ur!==DepthFormat&&ur!==DepthStencilFormat)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");ir===void 0&&ur===DepthFormat&&(ir=UnsignedIntType),ir===void 0&&ur===DepthStencilFormat&&(ir=UnsignedInt248Type),super(null,nr,sr,ar,or,lr,ur,ir,cr),this.isDepthTexture=!0,this.image={width:er,height:tr},this.magFilter=or!==void 0?or:NearestFilter,this.minFilter=lr!==void 0?lr:NearestFilter,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(er){return super.copy(er),this.compareFunction=er.compareFunction,this}toJSON(er){const tr=super.toJSON(er);return this.compareFunction!==null&&(tr.compareFunction=this.compareFunction),tr}}const emptyTexture=new Texture,emptyShadowTexture=new DepthTexture(1,1),emptyArrayTexture=new DataArrayTexture,empty3dTexture=new Data3DTexture,emptyCubeTexture=new CubeTexture,arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9),mat2array=new Float32Array(4);function flatten(rr,er,tr){const ir=rr[0];if(ir<=0||ir>0)return rr;const nr=er*tr;let sr=arrayCacheF32[nr];if(sr===void 0&&(sr=new Float32Array(nr),arrayCacheF32[nr]=sr),er!==0){ir.toArray(sr,0);for(let ar=1,or=0;ar!==er;++ar)or+=tr,rr[ar].toArray(sr,or)}return sr}function arraysEqual$1(rr,er){if(rr.length!==er.length)return!1;for(let tr=0,ir=rr.length;tr<ir;tr++)if(rr[tr]!==er[tr])return!1;return!0}function copyArray(rr,er){for(let tr=0,ir=er.length;tr<ir;tr++)rr[tr]=er[tr]}function allocTexUnits(rr,er){let tr=arrayCacheI32[er];tr===void 0&&(tr=new Int32Array(er),arrayCacheI32[er]=tr);for(let ir=0;ir!==er;++ir)tr[ir]=rr.allocateTextureUnit();return tr}function setValueV1f(rr,er){const tr=this.cache;tr[0]!==er&&(rr.uniform1f(this.addr,er),tr[0]=er)}function setValueV2f(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(rr.uniform2f(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;rr.uniform2fv(this.addr,er),copyArray(tr,er)}}function setValueV3f(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(rr.uniform3f(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else if(er.r!==void 0)(tr[0]!==er.r||tr[1]!==er.g||tr[2]!==er.b)&&(rr.uniform3f(this.addr,er.r,er.g,er.b),tr[0]=er.r,tr[1]=er.g,tr[2]=er.b);else{if(arraysEqual$1(tr,er))return;rr.uniform3fv(this.addr,er),copyArray(tr,er)}}function setValueV4f(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(rr.uniform4f(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;rr.uniform4fv(this.addr,er),copyArray(tr,er)}}function setValueM2(rr,er){const tr=this.cache,ir=er.elements;if(ir===void 0){if(arraysEqual$1(tr,er))return;rr.uniformMatrix2fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,ir))return;mat2array.set(ir),rr.uniformMatrix2fv(this.addr,!1,mat2array),copyArray(tr,ir)}}function setValueM3(rr,er){const tr=this.cache,ir=er.elements;if(ir===void 0){if(arraysEqual$1(tr,er))return;rr.uniformMatrix3fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,ir))return;mat3array.set(ir),rr.uniformMatrix3fv(this.addr,!1,mat3array),copyArray(tr,ir)}}function setValueM4(rr,er){const tr=this.cache,ir=er.elements;if(ir===void 0){if(arraysEqual$1(tr,er))return;rr.uniformMatrix4fv(this.addr,!1,er),copyArray(tr,er)}else{if(arraysEqual$1(tr,ir))return;mat4array.set(ir),rr.uniformMatrix4fv(this.addr,!1,mat4array),copyArray(tr,ir)}}function setValueV1i(rr,er){const tr=this.cache;tr[0]!==er&&(rr.uniform1i(this.addr,er),tr[0]=er)}function setValueV2i(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(rr.uniform2i(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;rr.uniform2iv(this.addr,er),copyArray(tr,er)}}function setValueV3i(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(rr.uniform3i(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else{if(arraysEqual$1(tr,er))return;rr.uniform3iv(this.addr,er),copyArray(tr,er)}}function setValueV4i(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(rr.uniform4i(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;rr.uniform4iv(this.addr,er),copyArray(tr,er)}}function setValueV1ui(rr,er){const tr=this.cache;tr[0]!==er&&(rr.uniform1ui(this.addr,er),tr[0]=er)}function setValueV2ui(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y)&&(rr.uniform2ui(this.addr,er.x,er.y),tr[0]=er.x,tr[1]=er.y);else{if(arraysEqual$1(tr,er))return;rr.uniform2uiv(this.addr,er),copyArray(tr,er)}}function setValueV3ui(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z)&&(rr.uniform3ui(this.addr,er.x,er.y,er.z),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z);else{if(arraysEqual$1(tr,er))return;rr.uniform3uiv(this.addr,er),copyArray(tr,er)}}function setValueV4ui(rr,er){const tr=this.cache;if(er.x!==void 0)(tr[0]!==er.x||tr[1]!==er.y||tr[2]!==er.z||tr[3]!==er.w)&&(rr.uniform4ui(this.addr,er.x,er.y,er.z,er.w),tr[0]=er.x,tr[1]=er.y,tr[2]=er.z,tr[3]=er.w);else{if(arraysEqual$1(tr,er))return;rr.uniform4uiv(this.addr,er),copyArray(tr,er)}}function setValueT1(rr,er,tr){const ir=this.cache,nr=tr.allocateTextureUnit();ir[0]!==nr&&(rr.uniform1i(this.addr,nr),ir[0]=nr);let sr;this.type===rr.SAMPLER_2D_SHADOW?(emptyShadowTexture.compareFunction=LessEqualCompare,sr=emptyShadowTexture):sr=emptyTexture,tr.setTexture2D(er||sr,nr)}function setValueT3D1(rr,er,tr){const ir=this.cache,nr=tr.allocateTextureUnit();ir[0]!==nr&&(rr.uniform1i(this.addr,nr),ir[0]=nr),tr.setTexture3D(er||empty3dTexture,nr)}function setValueT6(rr,er,tr){const ir=this.cache,nr=tr.allocateTextureUnit();ir[0]!==nr&&(rr.uniform1i(this.addr,nr),ir[0]=nr),tr.setTextureCube(er||emptyCubeTexture,nr)}function setValueT2DArray1(rr,er,tr){const ir=this.cache,nr=tr.allocateTextureUnit();ir[0]!==nr&&(rr.uniform1i(this.addr,nr),ir[0]=nr),tr.setTexture2DArray(er||emptyArrayTexture,nr)}function getSingularSetter(rr){switch(rr){case 5126:return setValueV1f;case 35664:return setValueV2f;case 35665:return setValueV3f;case 35666:return setValueV4f;case 35674:return setValueM2;case 35675:return setValueM3;case 35676:return setValueM4;case 5124:case 35670:return setValueV1i;case 35667:case 35671:return setValueV2i;case 35668:case 35672:return setValueV3i;case 35669:case 35673:return setValueV4i;case 5125:return setValueV1ui;case 36294:return setValueV2ui;case 36295:return setValueV3ui;case 36296:return setValueV4ui;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1;case 35679:case 36299:case 36307:return setValueT3D1;case 35680:case 36300:case 36308:case 36293:return setValueT6;case 36289:case 36303:case 36311:case 36292:return setValueT2DArray1}}function setValueV1fArray(rr,er){rr.uniform1fv(this.addr,er)}function setValueV2fArray(rr,er){const tr=flatten(er,this.size,2);rr.uniform2fv(this.addr,tr)}function setValueV3fArray(rr,er){const tr=flatten(er,this.size,3);rr.uniform3fv(this.addr,tr)}function setValueV4fArray(rr,er){const tr=flatten(er,this.size,4);rr.uniform4fv(this.addr,tr)}function setValueM2Array(rr,er){const tr=flatten(er,this.size,4);rr.uniformMatrix2fv(this.addr,!1,tr)}function setValueM3Array(rr,er){const tr=flatten(er,this.size,9);rr.uniformMatrix3fv(this.addr,!1,tr)}function setValueM4Array(rr,er){const tr=flatten(er,this.size,16);rr.uniformMatrix4fv(this.addr,!1,tr)}function setValueV1iArray(rr,er){rr.uniform1iv(this.addr,er)}function setValueV2iArray(rr,er){rr.uniform2iv(this.addr,er)}function setValueV3iArray(rr,er){rr.uniform3iv(this.addr,er)}function setValueV4iArray(rr,er){rr.uniform4iv(this.addr,er)}function setValueV1uiArray(rr,er){rr.uniform1uiv(this.addr,er)}function setValueV2uiArray(rr,er){rr.uniform2uiv(this.addr,er)}function setValueV3uiArray(rr,er){rr.uniform3uiv(this.addr,er)}function setValueV4uiArray(rr,er){rr.uniform4uiv(this.addr,er)}function setValueT1Array(rr,er,tr){const ir=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(ir,sr)||(rr.uniform1iv(this.addr,sr),copyArray(ir,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture2D(er[ar]||emptyTexture,sr[ar])}function setValueT3DArray(rr,er,tr){const ir=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(ir,sr)||(rr.uniform1iv(this.addr,sr),copyArray(ir,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture3D(er[ar]||empty3dTexture,sr[ar])}function setValueT6Array(rr,er,tr){const ir=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(ir,sr)||(rr.uniform1iv(this.addr,sr),copyArray(ir,sr));for(let ar=0;ar!==nr;++ar)tr.setTextureCube(er[ar]||emptyCubeTexture,sr[ar])}function setValueT2DArrayArray(rr,er,tr){const ir=this.cache,nr=er.length,sr=allocTexUnits(tr,nr);arraysEqual$1(ir,sr)||(rr.uniform1iv(this.addr,sr),copyArray(ir,sr));for(let ar=0;ar!==nr;++ar)tr.setTexture2DArray(er[ar]||emptyArrayTexture,sr[ar])}function getPureArraySetter(rr){switch(rr){case 5126:return setValueV1fArray;case 35664:return setValueV2fArray;case 35665:return setValueV3fArray;case 35666:return setValueV4fArray;case 35674:return setValueM2Array;case 35675:return setValueM3Array;case 35676:return setValueM4Array;case 5124:case 35670:return setValueV1iArray;case 35667:case 35671:return setValueV2iArray;case 35668:case 35672:return setValueV3iArray;case 35669:case 35673:return setValueV4iArray;case 5125:return setValueV1uiArray;case 36294:return setValueV2uiArray;case 36295:return setValueV3uiArray;case 36296:return setValueV4uiArray;case 35678:case 36198:case 36298:case 36306:case 35682:return setValueT1Array;case 35679:case 36299:case 36307:return setValueT3DArray;case 35680:case 36300:case 36308:case 36293:return setValueT6Array;case 36289:case 36303:case 36311:case 36292:return setValueT2DArrayArray}}class SingleUniform{constructor(er,tr,ir){this.id=er,this.addr=ir,this.cache=[],this.type=tr.type,this.setValue=getSingularSetter(tr.type)}}class PureArrayUniform{constructor(er,tr,ir){this.id=er,this.addr=ir,this.cache=[],this.type=tr.type,this.size=tr.size,this.setValue=getPureArraySetter(tr.type)}}class StructuredUniform{constructor(er){this.id=er,this.seq=[],this.map={}}setValue(er,tr,ir){const nr=this.seq;for(let sr=0,ar=nr.length;sr!==ar;++sr){const or=nr[sr];or.setValue(er,tr[or.id],ir)}}}const RePathPart=/(\w+)(\])?(\[|\.)?/g;function addUniform(rr,er){rr.seq.push(er),rr.map[er.id]=er}function parseUniform(rr,er,tr){const ir=rr.name,nr=ir.length;for(RePathPart.lastIndex=0;;){const sr=RePathPart.exec(ir),ar=RePathPart.lastIndex;let or=sr[1];const lr=sr[2]==="]",cr=sr[3];if(lr&&(or=or|0),cr===void 0||cr==="["&&ar+2===nr){addUniform(tr,cr===void 0?new SingleUniform(or,rr,er):new PureArrayUniform(or,rr,er));break}else{let dr=tr.map[or];dr===void 0&&(dr=new StructuredUniform(or),addUniform(tr,dr)),tr=dr}}}class WebGLUniforms{constructor(er,tr){this.seq=[],this.map={};const ir=er.getProgramParameter(tr,er.ACTIVE_UNIFORMS);for(let nr=0;nr<ir;++nr){const sr=er.getActiveUniform(tr,nr),ar=er.getUniformLocation(tr,sr.name);parseUniform(sr,ar,this)}}setValue(er,tr,ir,nr){const sr=this.map[tr];sr!==void 0&&sr.setValue(er,ir,nr)}setOptional(er,tr,ir){const nr=tr[ir];nr!==void 0&&this.setValue(er,ir,nr)}static upload(er,tr,ir,nr){for(let sr=0,ar=tr.length;sr!==ar;++sr){const or=tr[sr],lr=ir[or.id];lr.needsUpdate!==!1&&or.setValue(er,lr.value,nr)}}static seqWithValue(er,tr){const ir=[];for(let nr=0,sr=er.length;nr!==sr;++nr){const ar=er[nr];ar.id in tr&&ir.push(ar)}return ir}}function WebGLShader(rr,er,tr){const ir=rr.createShader(er);return rr.shaderSource(ir,tr),rr.compileShader(ir),ir}const COMPLETION_STATUS_KHR=37297;let programIdCount=0;function handleSource(rr,er){const tr=rr.split(`
`),ir=[],nr=Math.max(er-6,0),sr=Math.min(er+6,tr.length);for(let ar=nr;ar<sr;ar++){const or=ar+1;ir.push(`${or===er?">":" "} ${or}: ${tr[ar]}`)}return ir.join(`
`)}const _m0=new Matrix3;function getEncodingComponents(rr){ColorManagement._getMatrix(_m0,ColorManagement.workingColorSpace,rr);const er=`mat3( ${_m0.elements.map(tr=>tr.toFixed(4))} )`;switch(ColorManagement.getTransfer(rr)){case LinearTransfer:return[er,"LinearTransferOETF"];case SRGBTransfer:return[er,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",rr),[er,"LinearTransferOETF"]}}function getShaderErrors(rr,er,tr){const ir=rr.getShaderParameter(er,rr.COMPILE_STATUS),nr=rr.getShaderInfoLog(er).trim();if(ir&&nr==="")return"";const sr=/ERROR: 0:(\d+)/.exec(nr);if(sr){const ar=parseInt(sr[1]);return tr.toUpperCase()+`

`+nr+`

`+handleSource(rr.getShaderSource(er),ar)}else return nr}function getTexelEncodingFunction(rr,er){const tr=getEncodingComponents(er);return[`vec4 ${rr}( vec4 value ) {`,`	return ${tr[1]}( vec4( value.rgb * ${tr[0]}, value.a ) );`,"}"].join(`
`)}function getToneMappingFunction(rr,er){let tr;switch(er){case LinearToneMapping:tr="Linear";break;case ReinhardToneMapping:tr="Reinhard";break;case CineonToneMapping:tr="Cineon";break;case ACESFilmicToneMapping:tr="ACESFilmic";break;case AgXToneMapping:tr="AgX";break;case NeutralToneMapping:tr="Neutral";break;case CustomToneMapping:tr="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",er),tr="Linear"}return"vec3 "+rr+"( vec3 color ) { return "+tr+"ToneMapping( color ); }"}const _v0$1=new Vector3$1;function getLuminanceFunction(){ColorManagement.getLuminanceCoefficients(_v0$1);const rr=_v0$1.x.toFixed(4),er=_v0$1.y.toFixed(4),tr=_v0$1.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${rr}, ${er}, ${tr} );`,"	return dot( weights, rgb );","}"].join(`
`)}function generateVertexExtensions(rr){return[rr.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",rr.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(filterEmptyLine).join(`
`)}function generateDefines(rr){const er=[];for(const tr in rr){const ir=rr[tr];ir!==!1&&er.push("#define "+tr+" "+ir)}return er.join(`
`)}function fetchAttributeLocations(rr,er){const tr={},ir=rr.getProgramParameter(er,rr.ACTIVE_ATTRIBUTES);for(let nr=0;nr<ir;nr++){const sr=rr.getActiveAttrib(er,nr),ar=sr.name;let or=1;sr.type===rr.FLOAT_MAT2&&(or=2),sr.type===rr.FLOAT_MAT3&&(or=3),sr.type===rr.FLOAT_MAT4&&(or=4),tr[ar]={type:sr.type,location:rr.getAttribLocation(er,ar),locationSize:or}}return tr}function filterEmptyLine(rr){return rr!==""}function replaceLightNums(rr,er){const tr=er.numSpotLightShadows+er.numSpotLightMaps-er.numSpotLightShadowsWithMaps;return rr.replace(/NUM_DIR_LIGHTS/g,er.numDirLights).replace(/NUM_SPOT_LIGHTS/g,er.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,er.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,tr).replace(/NUM_RECT_AREA_LIGHTS/g,er.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,er.numPointLights).replace(/NUM_HEMI_LIGHTS/g,er.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,er.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,er.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,er.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,er.numPointLightShadows)}function replaceClippingPlaneNums(rr,er){return rr.replace(/NUM_CLIPPING_PLANES/g,er.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,er.numClippingPlanes-er.numClipIntersection)}const includePattern=/^[ \t]*#include +<([\w\d./]+)>/gm;function resolveIncludes(rr){return rr.replace(includePattern,includeReplacer)}const shaderChunkMap=new Map;function includeReplacer(rr,er){let tr=ShaderChunk[er];if(tr===void 0){const ir=shaderChunkMap.get(er);if(ir!==void 0)tr=ShaderChunk[ir],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',er,ir);else throw new Error("Can not resolve #include <"+er+">")}return resolveIncludes(tr)}const unrollLoopPattern=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function unrollLoops(rr){return rr.replace(unrollLoopPattern,loopReplacer)}function loopReplacer(rr,er,tr,ir){let nr="";for(let sr=parseInt(er);sr<parseInt(tr);sr++)nr+=ir.replace(/\[\s*i\s*\]/g,"[ "+sr+" ]").replace(/UNROLLED_LOOP_INDEX/g,sr);return nr}function generatePrecision(rr){let er=`precision ${rr.precision} float;
	precision ${rr.precision} int;
	precision ${rr.precision} sampler2D;
	precision ${rr.precision} samplerCube;
	precision ${rr.precision} sampler3D;
	precision ${rr.precision} sampler2DArray;
	precision ${rr.precision} sampler2DShadow;
	precision ${rr.precision} samplerCubeShadow;
	precision ${rr.precision} sampler2DArrayShadow;
	precision ${rr.precision} isampler2D;
	precision ${rr.precision} isampler3D;
	precision ${rr.precision} isamplerCube;
	precision ${rr.precision} isampler2DArray;
	precision ${rr.precision} usampler2D;
	precision ${rr.precision} usampler3D;
	precision ${rr.precision} usamplerCube;
	precision ${rr.precision} usampler2DArray;
	`;return rr.precision==="highp"?er+=`
#define HIGH_PRECISION`:rr.precision==="mediump"?er+=`
#define MEDIUM_PRECISION`:rr.precision==="lowp"&&(er+=`
#define LOW_PRECISION`),er}function generateShadowMapTypeDefine(rr){let er="SHADOWMAP_TYPE_BASIC";return rr.shadowMapType===PCFShadowMap?er="SHADOWMAP_TYPE_PCF":rr.shadowMapType===PCFSoftShadowMap?er="SHADOWMAP_TYPE_PCF_SOFT":rr.shadowMapType===VSMShadowMap&&(er="SHADOWMAP_TYPE_VSM"),er}function generateEnvMapTypeDefine(rr){let er="ENVMAP_TYPE_CUBE";if(rr.envMap)switch(rr.envMapMode){case CubeReflectionMapping:case CubeRefractionMapping:er="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:er="ENVMAP_TYPE_CUBE_UV";break}return er}function generateEnvMapModeDefine(rr){let er="ENVMAP_MODE_REFLECTION";if(rr.envMap)switch(rr.envMapMode){case CubeRefractionMapping:er="ENVMAP_MODE_REFRACTION";break}return er}function generateEnvMapBlendingDefine(rr){let er="ENVMAP_BLENDING_NONE";if(rr.envMap)switch(rr.combine){case MultiplyOperation:er="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:er="ENVMAP_BLENDING_MIX";break;case AddOperation:er="ENVMAP_BLENDING_ADD";break}return er}function generateCubeUVSize(rr){const er=rr.envMapCubeUVHeight;if(er===null)return null;const tr=Math.log2(er)-2,ir=1/er;return{texelWidth:1/(3*Math.max(Math.pow(2,tr),7*16)),texelHeight:ir,maxMip:tr}}function WebGLProgram(rr,er,tr,ir){const nr=rr.getContext(),sr=tr.defines;let ar=tr.vertexShader,or=tr.fragmentShader;const lr=generateShadowMapTypeDefine(tr),cr=generateEnvMapTypeDefine(tr),ur=generateEnvMapModeDefine(tr),dr=generateEnvMapBlendingDefine(tr),hr=generateCubeUVSize(tr),pr=generateVertexExtensions(tr),gr=generateDefines(sr),vr=nr.createProgram();let mr,fr,_r=tr.glslVersion?"#version "+tr.glslVersion+`
`:"";tr.isRawShaderMaterial?(mr=["#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr].filter(filterEmptyLine).join(`
`),mr.length>0&&(mr+=`
`),fr=["#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr].filter(filterEmptyLine).join(`
`),fr.length>0&&(fr+=`
`)):(mr=[generatePrecision(tr),"#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr,tr.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",tr.batching?"#define USE_BATCHING":"",tr.batchingColor?"#define USE_BATCHING_COLOR":"",tr.instancing?"#define USE_INSTANCING":"",tr.instancingColor?"#define USE_INSTANCING_COLOR":"",tr.instancingMorph?"#define USE_INSTANCING_MORPH":"",tr.useFog&&tr.fog?"#define USE_FOG":"",tr.useFog&&tr.fogExp2?"#define FOG_EXP2":"",tr.map?"#define USE_MAP":"",tr.envMap?"#define USE_ENVMAP":"",tr.envMap?"#define "+ur:"",tr.lightMap?"#define USE_LIGHTMAP":"",tr.aoMap?"#define USE_AOMAP":"",tr.bumpMap?"#define USE_BUMPMAP":"",tr.normalMap?"#define USE_NORMALMAP":"",tr.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tr.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tr.displacementMap?"#define USE_DISPLACEMENTMAP":"",tr.emissiveMap?"#define USE_EMISSIVEMAP":"",tr.anisotropy?"#define USE_ANISOTROPY":"",tr.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tr.clearcoatMap?"#define USE_CLEARCOATMAP":"",tr.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tr.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tr.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tr.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tr.specularMap?"#define USE_SPECULARMAP":"",tr.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tr.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tr.roughnessMap?"#define USE_ROUGHNESSMAP":"",tr.metalnessMap?"#define USE_METALNESSMAP":"",tr.alphaMap?"#define USE_ALPHAMAP":"",tr.alphaHash?"#define USE_ALPHAHASH":"",tr.transmission?"#define USE_TRANSMISSION":"",tr.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tr.thicknessMap?"#define USE_THICKNESSMAP":"",tr.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tr.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tr.mapUv?"#define MAP_UV "+tr.mapUv:"",tr.alphaMapUv?"#define ALPHAMAP_UV "+tr.alphaMapUv:"",tr.lightMapUv?"#define LIGHTMAP_UV "+tr.lightMapUv:"",tr.aoMapUv?"#define AOMAP_UV "+tr.aoMapUv:"",tr.emissiveMapUv?"#define EMISSIVEMAP_UV "+tr.emissiveMapUv:"",tr.bumpMapUv?"#define BUMPMAP_UV "+tr.bumpMapUv:"",tr.normalMapUv?"#define NORMALMAP_UV "+tr.normalMapUv:"",tr.displacementMapUv?"#define DISPLACEMENTMAP_UV "+tr.displacementMapUv:"",tr.metalnessMapUv?"#define METALNESSMAP_UV "+tr.metalnessMapUv:"",tr.roughnessMapUv?"#define ROUGHNESSMAP_UV "+tr.roughnessMapUv:"",tr.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+tr.anisotropyMapUv:"",tr.clearcoatMapUv?"#define CLEARCOATMAP_UV "+tr.clearcoatMapUv:"",tr.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+tr.clearcoatNormalMapUv:"",tr.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+tr.clearcoatRoughnessMapUv:"",tr.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+tr.iridescenceMapUv:"",tr.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+tr.iridescenceThicknessMapUv:"",tr.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+tr.sheenColorMapUv:"",tr.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+tr.sheenRoughnessMapUv:"",tr.specularMapUv?"#define SPECULARMAP_UV "+tr.specularMapUv:"",tr.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+tr.specularColorMapUv:"",tr.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+tr.specularIntensityMapUv:"",tr.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+tr.transmissionMapUv:"",tr.thicknessMapUv?"#define THICKNESSMAP_UV "+tr.thicknessMapUv:"",tr.vertexTangents&&tr.flatShading===!1?"#define USE_TANGENT":"",tr.vertexColors?"#define USE_COLOR":"",tr.vertexAlphas?"#define USE_COLOR_ALPHA":"",tr.vertexUv1s?"#define USE_UV1":"",tr.vertexUv2s?"#define USE_UV2":"",tr.vertexUv3s?"#define USE_UV3":"",tr.pointsUvs?"#define USE_POINTS_UV":"",tr.flatShading?"#define FLAT_SHADED":"",tr.skinning?"#define USE_SKINNING":"",tr.morphTargets?"#define USE_MORPHTARGETS":"",tr.morphNormals&&tr.flatShading===!1?"#define USE_MORPHNORMALS":"",tr.morphColors?"#define USE_MORPHCOLORS":"",tr.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+tr.morphTextureStride:"",tr.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+tr.morphTargetsCount:"",tr.doubleSided?"#define DOUBLE_SIDED":"",tr.flipSided?"#define FLIP_SIDED":"",tr.shadowMapEnabled?"#define USE_SHADOWMAP":"",tr.shadowMapEnabled?"#define "+lr:"",tr.sizeAttenuation?"#define USE_SIZEATTENUATION":"",tr.numLightProbes>0?"#define USE_LIGHT_PROBES":"",tr.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tr.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(filterEmptyLine).join(`
`),fr=[generatePrecision(tr),"#define SHADER_TYPE "+tr.shaderType,"#define SHADER_NAME "+tr.shaderName,gr,tr.useFog&&tr.fog?"#define USE_FOG":"",tr.useFog&&tr.fogExp2?"#define FOG_EXP2":"",tr.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",tr.map?"#define USE_MAP":"",tr.matcap?"#define USE_MATCAP":"",tr.envMap?"#define USE_ENVMAP":"",tr.envMap?"#define "+cr:"",tr.envMap?"#define "+ur:"",tr.envMap?"#define "+dr:"",hr?"#define CUBEUV_TEXEL_WIDTH "+hr.texelWidth:"",hr?"#define CUBEUV_TEXEL_HEIGHT "+hr.texelHeight:"",hr?"#define CUBEUV_MAX_MIP "+hr.maxMip+".0":"",tr.lightMap?"#define USE_LIGHTMAP":"",tr.aoMap?"#define USE_AOMAP":"",tr.bumpMap?"#define USE_BUMPMAP":"",tr.normalMap?"#define USE_NORMALMAP":"",tr.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",tr.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",tr.emissiveMap?"#define USE_EMISSIVEMAP":"",tr.anisotropy?"#define USE_ANISOTROPY":"",tr.anisotropyMap?"#define USE_ANISOTROPYMAP":"",tr.clearcoat?"#define USE_CLEARCOAT":"",tr.clearcoatMap?"#define USE_CLEARCOATMAP":"",tr.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",tr.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",tr.dispersion?"#define USE_DISPERSION":"",tr.iridescence?"#define USE_IRIDESCENCE":"",tr.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",tr.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",tr.specularMap?"#define USE_SPECULARMAP":"",tr.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",tr.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",tr.roughnessMap?"#define USE_ROUGHNESSMAP":"",tr.metalnessMap?"#define USE_METALNESSMAP":"",tr.alphaMap?"#define USE_ALPHAMAP":"",tr.alphaTest?"#define USE_ALPHATEST":"",tr.alphaHash?"#define USE_ALPHAHASH":"",tr.sheen?"#define USE_SHEEN":"",tr.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",tr.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",tr.transmission?"#define USE_TRANSMISSION":"",tr.transmissionMap?"#define USE_TRANSMISSIONMAP":"",tr.thicknessMap?"#define USE_THICKNESSMAP":"",tr.vertexTangents&&tr.flatShading===!1?"#define USE_TANGENT":"",tr.vertexColors||tr.instancingColor||tr.batchingColor?"#define USE_COLOR":"",tr.vertexAlphas?"#define USE_COLOR_ALPHA":"",tr.vertexUv1s?"#define USE_UV1":"",tr.vertexUv2s?"#define USE_UV2":"",tr.vertexUv3s?"#define USE_UV3":"",tr.pointsUvs?"#define USE_POINTS_UV":"",tr.gradientMap?"#define USE_GRADIENTMAP":"",tr.flatShading?"#define FLAT_SHADED":"",tr.doubleSided?"#define DOUBLE_SIDED":"",tr.flipSided?"#define FLIP_SIDED":"",tr.shadowMapEnabled?"#define USE_SHADOWMAP":"",tr.shadowMapEnabled?"#define "+lr:"",tr.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",tr.numLightProbes>0?"#define USE_LIGHT_PROBES":"",tr.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",tr.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",tr.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",tr.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",tr.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",tr.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",tr.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",tr.toneMapping):"",tr.dithering?"#define DITHERING":"",tr.opaque?"#define OPAQUE":"",ShaderChunk.colorspace_pars_fragment,getTexelEncodingFunction("linearToOutputTexel",tr.outputColorSpace),getLuminanceFunction(),tr.useDepthPacking?"#define DEPTH_PACKING "+tr.depthPacking:"",`
`].filter(filterEmptyLine).join(`
`)),ar=resolveIncludes(ar),ar=replaceLightNums(ar,tr),ar=replaceClippingPlaneNums(ar,tr),or=resolveIncludes(or),or=replaceLightNums(or,tr),or=replaceClippingPlaneNums(or,tr),ar=unrollLoops(ar),or=unrollLoops(or),tr.isRawShaderMaterial!==!0&&(_r=`#version 300 es
`,mr=[pr,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+mr,fr=["#define varying in",tr.glslVersion===GLSL3?"":"layout(location = 0) out highp vec4 pc_fragColor;",tr.glslVersion===GLSL3?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+fr);const Ar=_r+mr+ar,yr=_r+fr+or,wr=WebGLShader(nr,nr.VERTEX_SHADER,Ar),xr=WebGLShader(nr,nr.FRAGMENT_SHADER,yr);nr.attachShader(vr,wr),nr.attachShader(vr,xr),tr.index0AttributeName!==void 0?nr.bindAttribLocation(vr,0,tr.index0AttributeName):tr.morphTargets===!0&&nr.bindAttribLocation(vr,0,"position"),nr.linkProgram(vr);function Sr(Rr){if(rr.debug.checkShaderErrors){const Pr=nr.getProgramInfoLog(vr).trim(),Dr=nr.getShaderInfoLog(wr).trim(),Fr=nr.getShaderInfoLog(xr).trim();let Or=!0,Nr=!0;if(nr.getProgramParameter(vr,nr.LINK_STATUS)===!1)if(Or=!1,typeof rr.debug.onShaderError=="function")rr.debug.onShaderError(nr,vr,wr,xr);else{const Ur=getShaderErrors(nr,wr,"vertex"),Br=getShaderErrors(nr,xr,"fragment");console.error("THREE.WebGLProgram: Shader Error "+nr.getError()+" - VALIDATE_STATUS "+nr.getProgramParameter(vr,nr.VALIDATE_STATUS)+`

Material Name: `+Rr.name+`
Material Type: `+Rr.type+`

Program Info Log: `+Pr+`
`+Ur+`
`+Br)}else Pr!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Pr):(Dr===""||Fr==="")&&(Nr=!1);Nr&&(Rr.diagnostics={runnable:Or,programLog:Pr,vertexShader:{log:Dr,prefix:mr},fragmentShader:{log:Fr,prefix:fr}})}nr.deleteShader(wr),nr.deleteShader(xr),br=new WebGLUniforms(nr,vr),Cr=fetchAttributeLocations(nr,vr)}let br;this.getUniforms=function(){return br===void 0&&Sr(this),br};let Cr;this.getAttributes=function(){return Cr===void 0&&Sr(this),Cr};let Ir=tr.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Ir===!1&&(Ir=nr.getProgramParameter(vr,COMPLETION_STATUS_KHR)),Ir},this.destroy=function(){ir.releaseStatesOfProgram(this),nr.deleteProgram(vr),this.program=void 0},this.type=tr.shaderType,this.name=tr.shaderName,this.id=programIdCount++,this.cacheKey=er,this.usedTimes=1,this.program=vr,this.vertexShader=wr,this.fragmentShader=xr,this}let _id$1=0;class WebGLShaderCache{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(er){const tr=er.vertexShader,ir=er.fragmentShader,nr=this._getShaderStage(tr),sr=this._getShaderStage(ir),ar=this._getShaderCacheForMaterial(er);return ar.has(nr)===!1&&(ar.add(nr),nr.usedTimes++),ar.has(sr)===!1&&(ar.add(sr),sr.usedTimes++),this}remove(er){const tr=this.materialCache.get(er);for(const ir of tr)ir.usedTimes--,ir.usedTimes===0&&this.shaderCache.delete(ir.code);return this.materialCache.delete(er),this}getVertexShaderID(er){return this._getShaderStage(er.vertexShader).id}getFragmentShaderID(er){return this._getShaderStage(er.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(er){const tr=this.materialCache;let ir=tr.get(er);return ir===void 0&&(ir=new Set,tr.set(er,ir)),ir}_getShaderStage(er){const tr=this.shaderCache;let ir=tr.get(er);return ir===void 0&&(ir=new WebGLShaderStage(er),tr.set(er,ir)),ir}}class WebGLShaderStage{constructor(er){this.id=_id$1++,this.code=er,this.usedTimes=0}}function WebGLPrograms(rr,er,tr,ir,nr,sr,ar){const or=new Layers,lr=new WebGLShaderCache,cr=new Set,ur=[],dr=nr.logarithmicDepthBuffer,hr=nr.vertexTextures;let pr=nr.precision;const gr={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function vr(Cr){return cr.add(Cr),Cr===0?"uv":`uv${Cr}`}function mr(Cr,Ir,Rr,Pr,Dr){const Fr=Pr.fog,Or=Dr.geometry,Nr=Cr.isMeshStandardMaterial?Pr.environment:null,Ur=(Cr.isMeshStandardMaterial?tr:er).get(Cr.envMap||Nr),Br=Ur&&Ur.mapping===CubeUVReflectionMapping?Ur.image.height:null,Wr=gr[Cr.type];Cr.precision!==null&&(pr=nr.getMaxPrecision(Cr.precision),pr!==Cr.precision&&console.warn("THREE.WebGLProgram.getParameters:",Cr.precision,"not supported, using",pr,"instead."));const Xr=Or.morphAttributes.position||Or.morphAttributes.normal||Or.morphAttributes.color,Yr=Xr!==void 0?Xr.length:0;let Qi=0;Or.morphAttributes.position!==void 0&&(Qi=1),Or.morphAttributes.normal!==void 0&&(Qi=2),Or.morphAttributes.color!==void 0&&(Qi=3);let Xi,Kr,$r,Vr;if(Wr){const Gs=ShaderLib[Wr];Xi=Gs.vertexShader,Kr=Gs.fragmentShader}else Xi=Cr.vertexShader,Kr=Cr.fragmentShader,lr.update(Cr),$r=lr.getVertexShaderID(Cr),Vr=lr.getFragmentShaderID(Cr);const Gr=rr.getRenderTarget(),qr=rr.state.buffers.depth.getReversed(),ji=Dr.isInstancedMesh===!0,Jr=Dr.isBatchedMesh===!0,Ji=!!Cr.map,Ki=!!Cr.matcap,Zi=!!Ur,Zr=!!Cr.aoMap,is=!!Cr.lightMap,os=!!Cr.bumpMap,cs=!!Cr.normalMap,ss=!!Cr.displacementMap,es=!!Cr.emissiveMap,ms=!!Cr.metalnessMap,Yi=!!Cr.roughnessMap,Gi=Cr.anisotropy>0,Ni=Cr.clearcoat>0,Ri=Cr.dispersion>0,qi=Cr.iridescence>0,as=Cr.sheen>0,us=Cr.transmission>0,gs=Gi&&!!Cr.anisotropyMap,vs=Ni&&!!Cr.clearcoatMap,_s=Ni&&!!Cr.clearcoatNormalMap,As=Ni&&!!Cr.clearcoatRoughnessMap,xs=qi&&!!Cr.iridescenceMap,Es=qi&&!!Cr.iridescenceThicknessMap,Ps=as&&!!Cr.sheenColorMap,Ns=as&&!!Cr.sheenRoughnessMap,Vs=!!Cr.specularMap,Us=!!Cr.specularColorMap,Os=!!Cr.specularIntensityMap,ws=us&&!!Cr.transmissionMap,bs=us&&!!Cr.thicknessMap,Ss=!!Cr.gradientMap,Rs=!!Cr.alphaMap,Hs=Cr.alphaTest>0,ks=!!Cr.alphaHash,na=!!Cr.extensions;let xa=NoToneMapping;Cr.toneMapped&&(Gr===null||Gr.isXRRenderTarget===!0)&&(xa=rr.toneMapping);const fa={shaderID:Wr,shaderType:Cr.type,shaderName:Cr.name,vertexShader:Xi,fragmentShader:Kr,defines:Cr.defines,customVertexShaderID:$r,customFragmentShaderID:Vr,isRawShaderMaterial:Cr.isRawShaderMaterial===!0,glslVersion:Cr.glslVersion,precision:pr,batching:Jr,batchingColor:Jr&&Dr._colorsTexture!==null,instancing:ji,instancingColor:ji&&Dr.instanceColor!==null,instancingMorph:ji&&Dr.morphTexture!==null,supportsVertexTextures:hr,outputColorSpace:Gr===null?rr.outputColorSpace:Gr.isXRRenderTarget===!0?Gr.texture.colorSpace:LinearSRGBColorSpace,alphaToCoverage:!!Cr.alphaToCoverage,map:Ji,matcap:Ki,envMap:Zi,envMapMode:Zi&&Ur.mapping,envMapCubeUVHeight:Br,aoMap:Zr,lightMap:is,bumpMap:os,normalMap:cs,displacementMap:hr&&ss,emissiveMap:es,normalMapObjectSpace:cs&&Cr.normalMapType===ObjectSpaceNormalMap,normalMapTangentSpace:cs&&Cr.normalMapType===TangentSpaceNormalMap,metalnessMap:ms,roughnessMap:Yi,anisotropy:Gi,anisotropyMap:gs,clearcoat:Ni,clearcoatMap:vs,clearcoatNormalMap:_s,clearcoatRoughnessMap:As,dispersion:Ri,iridescence:qi,iridescenceMap:xs,iridescenceThicknessMap:Es,sheen:as,sheenColorMap:Ps,sheenRoughnessMap:Ns,specularMap:Vs,specularColorMap:Us,specularIntensityMap:Os,transmission:us,transmissionMap:ws,thicknessMap:bs,gradientMap:Ss,opaque:Cr.transparent===!1&&Cr.blending===NormalBlending&&Cr.alphaToCoverage===!1,alphaMap:Rs,alphaTest:Hs,alphaHash:ks,combine:Cr.combine,mapUv:Ji&&vr(Cr.map.channel),aoMapUv:Zr&&vr(Cr.aoMap.channel),lightMapUv:is&&vr(Cr.lightMap.channel),bumpMapUv:os&&vr(Cr.bumpMap.channel),normalMapUv:cs&&vr(Cr.normalMap.channel),displacementMapUv:ss&&vr(Cr.displacementMap.channel),emissiveMapUv:es&&vr(Cr.emissiveMap.channel),metalnessMapUv:ms&&vr(Cr.metalnessMap.channel),roughnessMapUv:Yi&&vr(Cr.roughnessMap.channel),anisotropyMapUv:gs&&vr(Cr.anisotropyMap.channel),clearcoatMapUv:vs&&vr(Cr.clearcoatMap.channel),clearcoatNormalMapUv:_s&&vr(Cr.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:As&&vr(Cr.clearcoatRoughnessMap.channel),iridescenceMapUv:xs&&vr(Cr.iridescenceMap.channel),iridescenceThicknessMapUv:Es&&vr(Cr.iridescenceThicknessMap.channel),sheenColorMapUv:Ps&&vr(Cr.sheenColorMap.channel),sheenRoughnessMapUv:Ns&&vr(Cr.sheenRoughnessMap.channel),specularMapUv:Vs&&vr(Cr.specularMap.channel),specularColorMapUv:Us&&vr(Cr.specularColorMap.channel),specularIntensityMapUv:Os&&vr(Cr.specularIntensityMap.channel),transmissionMapUv:ws&&vr(Cr.transmissionMap.channel),thicknessMapUv:bs&&vr(Cr.thicknessMap.channel),alphaMapUv:Rs&&vr(Cr.alphaMap.channel),vertexTangents:!!Or.attributes.tangent&&(cs||Gi),vertexColors:Cr.vertexColors,vertexAlphas:Cr.vertexColors===!0&&!!Or.attributes.color&&Or.attributes.color.itemSize===4,pointsUvs:Dr.isPoints===!0&&!!Or.attributes.uv&&(Ji||Rs),fog:!!Fr,useFog:Cr.fog===!0,fogExp2:!!Fr&&Fr.isFogExp2,flatShading:Cr.flatShading===!0,sizeAttenuation:Cr.sizeAttenuation===!0,logarithmicDepthBuffer:dr,reverseDepthBuffer:qr,skinning:Dr.isSkinnedMesh===!0,morphTargets:Or.morphAttributes.position!==void 0,morphNormals:Or.morphAttributes.normal!==void 0,morphColors:Or.morphAttributes.color!==void 0,morphTargetsCount:Yr,morphTextureStride:Qi,numDirLights:Ir.directional.length,numPointLights:Ir.point.length,numSpotLights:Ir.spot.length,numSpotLightMaps:Ir.spotLightMap.length,numRectAreaLights:Ir.rectArea.length,numHemiLights:Ir.hemi.length,numDirLightShadows:Ir.directionalShadowMap.length,numPointLightShadows:Ir.pointShadowMap.length,numSpotLightShadows:Ir.spotShadowMap.length,numSpotLightShadowsWithMaps:Ir.numSpotLightShadowsWithMaps,numLightProbes:Ir.numLightProbes,numClippingPlanes:ar.numPlanes,numClipIntersection:ar.numIntersection,dithering:Cr.dithering,shadowMapEnabled:rr.shadowMap.enabled&&Rr.length>0,shadowMapType:rr.shadowMap.type,toneMapping:xa,decodeVideoTexture:Ji&&Cr.map.isVideoTexture===!0&&ColorManagement.getTransfer(Cr.map.colorSpace)===SRGBTransfer,decodeVideoTextureEmissive:es&&Cr.emissiveMap.isVideoTexture===!0&&ColorManagement.getTransfer(Cr.emissiveMap.colorSpace)===SRGBTransfer,premultipliedAlpha:Cr.premultipliedAlpha,doubleSided:Cr.side===DoubleSide,flipSided:Cr.side===BackSide,useDepthPacking:Cr.depthPacking>=0,depthPacking:Cr.depthPacking||0,index0AttributeName:Cr.index0AttributeName,extensionClipCullDistance:na&&Cr.extensions.clipCullDistance===!0&&ir.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(na&&Cr.extensions.multiDraw===!0||Jr)&&ir.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:ir.has("KHR_parallel_shader_compile"),customProgramCacheKey:Cr.customProgramCacheKey()};return fa.vertexUv1s=cr.has(1),fa.vertexUv2s=cr.has(2),fa.vertexUv3s=cr.has(3),cr.clear(),fa}function fr(Cr){const Ir=[];if(Cr.shaderID?Ir.push(Cr.shaderID):(Ir.push(Cr.customVertexShaderID),Ir.push(Cr.customFragmentShaderID)),Cr.defines!==void 0)for(const Rr in Cr.defines)Ir.push(Rr),Ir.push(Cr.defines[Rr]);return Cr.isRawShaderMaterial===!1&&(_r(Ir,Cr),Ar(Ir,Cr),Ir.push(rr.outputColorSpace)),Ir.push(Cr.customProgramCacheKey),Ir.join()}function _r(Cr,Ir){Cr.push(Ir.precision),Cr.push(Ir.outputColorSpace),Cr.push(Ir.envMapMode),Cr.push(Ir.envMapCubeUVHeight),Cr.push(Ir.mapUv),Cr.push(Ir.alphaMapUv),Cr.push(Ir.lightMapUv),Cr.push(Ir.aoMapUv),Cr.push(Ir.bumpMapUv),Cr.push(Ir.normalMapUv),Cr.push(Ir.displacementMapUv),Cr.push(Ir.emissiveMapUv),Cr.push(Ir.metalnessMapUv),Cr.push(Ir.roughnessMapUv),Cr.push(Ir.anisotropyMapUv),Cr.push(Ir.clearcoatMapUv),Cr.push(Ir.clearcoatNormalMapUv),Cr.push(Ir.clearcoatRoughnessMapUv),Cr.push(Ir.iridescenceMapUv),Cr.push(Ir.iridescenceThicknessMapUv),Cr.push(Ir.sheenColorMapUv),Cr.push(Ir.sheenRoughnessMapUv),Cr.push(Ir.specularMapUv),Cr.push(Ir.specularColorMapUv),Cr.push(Ir.specularIntensityMapUv),Cr.push(Ir.transmissionMapUv),Cr.push(Ir.thicknessMapUv),Cr.push(Ir.combine),Cr.push(Ir.fogExp2),Cr.push(Ir.sizeAttenuation),Cr.push(Ir.morphTargetsCount),Cr.push(Ir.morphAttributeCount),Cr.push(Ir.numDirLights),Cr.push(Ir.numPointLights),Cr.push(Ir.numSpotLights),Cr.push(Ir.numSpotLightMaps),Cr.push(Ir.numHemiLights),Cr.push(Ir.numRectAreaLights),Cr.push(Ir.numDirLightShadows),Cr.push(Ir.numPointLightShadows),Cr.push(Ir.numSpotLightShadows),Cr.push(Ir.numSpotLightShadowsWithMaps),Cr.push(Ir.numLightProbes),Cr.push(Ir.shadowMapType),Cr.push(Ir.toneMapping),Cr.push(Ir.numClippingPlanes),Cr.push(Ir.numClipIntersection),Cr.push(Ir.depthPacking)}function Ar(Cr,Ir){or.disableAll(),Ir.supportsVertexTextures&&or.enable(0),Ir.instancing&&or.enable(1),Ir.instancingColor&&or.enable(2),Ir.instancingMorph&&or.enable(3),Ir.matcap&&or.enable(4),Ir.envMap&&or.enable(5),Ir.normalMapObjectSpace&&or.enable(6),Ir.normalMapTangentSpace&&or.enable(7),Ir.clearcoat&&or.enable(8),Ir.iridescence&&or.enable(9),Ir.alphaTest&&or.enable(10),Ir.vertexColors&&or.enable(11),Ir.vertexAlphas&&or.enable(12),Ir.vertexUv1s&&or.enable(13),Ir.vertexUv2s&&or.enable(14),Ir.vertexUv3s&&or.enable(15),Ir.vertexTangents&&or.enable(16),Ir.anisotropy&&or.enable(17),Ir.alphaHash&&or.enable(18),Ir.batching&&or.enable(19),Ir.dispersion&&or.enable(20),Ir.batchingColor&&or.enable(21),Cr.push(or.mask),or.disableAll(),Ir.fog&&or.enable(0),Ir.useFog&&or.enable(1),Ir.flatShading&&or.enable(2),Ir.logarithmicDepthBuffer&&or.enable(3),Ir.reverseDepthBuffer&&or.enable(4),Ir.skinning&&or.enable(5),Ir.morphTargets&&or.enable(6),Ir.morphNormals&&or.enable(7),Ir.morphColors&&or.enable(8),Ir.premultipliedAlpha&&or.enable(9),Ir.shadowMapEnabled&&or.enable(10),Ir.doubleSided&&or.enable(11),Ir.flipSided&&or.enable(12),Ir.useDepthPacking&&or.enable(13),Ir.dithering&&or.enable(14),Ir.transmission&&or.enable(15),Ir.sheen&&or.enable(16),Ir.opaque&&or.enable(17),Ir.pointsUvs&&or.enable(18),Ir.decodeVideoTexture&&or.enable(19),Ir.decodeVideoTextureEmissive&&or.enable(20),Ir.alphaToCoverage&&or.enable(21),Cr.push(or.mask)}function yr(Cr){const Ir=gr[Cr.type];let Rr;if(Ir){const Pr=ShaderLib[Ir];Rr=UniformsUtils.clone(Pr.uniforms)}else Rr=Cr.uniforms;return Rr}function wr(Cr,Ir){let Rr;for(let Pr=0,Dr=ur.length;Pr<Dr;Pr++){const Fr=ur[Pr];if(Fr.cacheKey===Ir){Rr=Fr,++Rr.usedTimes;break}}return Rr===void 0&&(Rr=new WebGLProgram(rr,Ir,Cr,sr),ur.push(Rr)),Rr}function xr(Cr){if(--Cr.usedTimes===0){const Ir=ur.indexOf(Cr);ur[Ir]=ur[ur.length-1],ur.pop(),Cr.destroy()}}function Sr(Cr){lr.remove(Cr)}function br(){lr.dispose()}return{getParameters:mr,getProgramCacheKey:fr,getUniforms:yr,acquireProgram:wr,releaseProgram:xr,releaseShaderCache:Sr,programs:ur,dispose:br}}function WebGLProperties(){let rr=new WeakMap;function er(ar){return rr.has(ar)}function tr(ar){let or=rr.get(ar);return or===void 0&&(or={},rr.set(ar,or)),or}function ir(ar){rr.delete(ar)}function nr(ar,or,lr){rr.get(ar)[or]=lr}function sr(){rr=new WeakMap}return{has:er,get:tr,remove:ir,update:nr,dispose:sr}}function painterSortStable(rr,er){return rr.groupOrder!==er.groupOrder?rr.groupOrder-er.groupOrder:rr.renderOrder!==er.renderOrder?rr.renderOrder-er.renderOrder:rr.material.id!==er.material.id?rr.material.id-er.material.id:rr.z!==er.z?rr.z-er.z:rr.id-er.id}function reversePainterSortStable(rr,er){return rr.groupOrder!==er.groupOrder?rr.groupOrder-er.groupOrder:rr.renderOrder!==er.renderOrder?rr.renderOrder-er.renderOrder:rr.z!==er.z?er.z-rr.z:rr.id-er.id}function WebGLRenderList(){const rr=[];let er=0;const tr=[],ir=[],nr=[];function sr(){er=0,tr.length=0,ir.length=0,nr.length=0}function ar(dr,hr,pr,gr,vr,mr){let fr=rr[er];return fr===void 0?(fr={id:dr.id,object:dr,geometry:hr,material:pr,groupOrder:gr,renderOrder:dr.renderOrder,z:vr,group:mr},rr[er]=fr):(fr.id=dr.id,fr.object=dr,fr.geometry=hr,fr.material=pr,fr.groupOrder=gr,fr.renderOrder=dr.renderOrder,fr.z=vr,fr.group=mr),er++,fr}function or(dr,hr,pr,gr,vr,mr){const fr=ar(dr,hr,pr,gr,vr,mr);pr.transmission>0?ir.push(fr):pr.transparent===!0?nr.push(fr):tr.push(fr)}function lr(dr,hr,pr,gr,vr,mr){const fr=ar(dr,hr,pr,gr,vr,mr);pr.transmission>0?ir.unshift(fr):pr.transparent===!0?nr.unshift(fr):tr.unshift(fr)}function cr(dr,hr){tr.length>1&&tr.sort(dr||painterSortStable),ir.length>1&&ir.sort(hr||reversePainterSortStable),nr.length>1&&nr.sort(hr||reversePainterSortStable)}function ur(){for(let dr=er,hr=rr.length;dr<hr;dr++){const pr=rr[dr];if(pr.id===null)break;pr.id=null,pr.object=null,pr.geometry=null,pr.material=null,pr.group=null}}return{opaque:tr,transmissive:ir,transparent:nr,init:sr,push:or,unshift:lr,finish:ur,sort:cr}}function WebGLRenderLists(){let rr=new WeakMap;function er(ir,nr){const sr=rr.get(ir);let ar;return sr===void 0?(ar=new WebGLRenderList,rr.set(ir,[ar])):nr>=sr.length?(ar=new WebGLRenderList,sr.push(ar)):ar=sr[nr],ar}function tr(){rr=new WeakMap}return{get:er,dispose:tr}}function UniformsCache(){const rr={};return{get:function(er){if(rr[er.id]!==void 0)return rr[er.id];let tr;switch(er.type){case"DirectionalLight":tr={direction:new Vector3$1,color:new Color};break;case"SpotLight":tr={position:new Vector3$1,direction:new Vector3$1,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":tr={position:new Vector3$1,color:new Color,distance:0,decay:0};break;case"HemisphereLight":tr={direction:new Vector3$1,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":tr={color:new Color,position:new Vector3$1,halfWidth:new Vector3$1,halfHeight:new Vector3$1};break}return rr[er.id]=tr,tr}}}function ShadowUniformsCache(){const rr={};return{get:function(er){if(rr[er.id]!==void 0)return rr[er.id];let tr;switch(er.type){case"DirectionalLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":tr={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break}return rr[er.id]=tr,tr}}}let nextVersion=0;function shadowCastingAndTexturingLightsFirst(rr,er){return(er.castShadow?2:0)-(rr.castShadow?2:0)+(er.map?1:0)-(rr.map?1:0)}function WebGLLights(rr){const er=new UniformsCache,tr=ShadowUniformsCache(),ir={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let cr=0;cr<9;cr++)ir.probe.push(new Vector3$1);const nr=new Vector3$1,sr=new Matrix4,ar=new Matrix4;function or(cr){let ur=0,dr=0,hr=0;for(let Cr=0;Cr<9;Cr++)ir.probe[Cr].set(0,0,0);let pr=0,gr=0,vr=0,mr=0,fr=0,_r=0,Ar=0,yr=0,wr=0,xr=0,Sr=0;cr.sort(shadowCastingAndTexturingLightsFirst);for(let Cr=0,Ir=cr.length;Cr<Ir;Cr++){const Rr=cr[Cr],Pr=Rr.color,Dr=Rr.intensity,Fr=Rr.distance,Or=Rr.shadow&&Rr.shadow.map?Rr.shadow.map.texture:null;if(Rr.isAmbientLight)ur+=Pr.r*Dr,dr+=Pr.g*Dr,hr+=Pr.b*Dr;else if(Rr.isLightProbe){for(let Nr=0;Nr<9;Nr++)ir.probe[Nr].addScaledVector(Rr.sh.coefficients[Nr],Dr);Sr++}else if(Rr.isDirectionalLight){const Nr=er.get(Rr);if(Nr.color.copy(Rr.color).multiplyScalar(Rr.intensity),Rr.castShadow){const Ur=Rr.shadow,Br=tr.get(Rr);Br.shadowIntensity=Ur.intensity,Br.shadowBias=Ur.bias,Br.shadowNormalBias=Ur.normalBias,Br.shadowRadius=Ur.radius,Br.shadowMapSize=Ur.mapSize,ir.directionalShadow[pr]=Br,ir.directionalShadowMap[pr]=Or,ir.directionalShadowMatrix[pr]=Rr.shadow.matrix,_r++}ir.directional[pr]=Nr,pr++}else if(Rr.isSpotLight){const Nr=er.get(Rr);Nr.position.setFromMatrixPosition(Rr.matrixWorld),Nr.color.copy(Pr).multiplyScalar(Dr),Nr.distance=Fr,Nr.coneCos=Math.cos(Rr.angle),Nr.penumbraCos=Math.cos(Rr.angle*(1-Rr.penumbra)),Nr.decay=Rr.decay,ir.spot[vr]=Nr;const Ur=Rr.shadow;if(Rr.map&&(ir.spotLightMap[wr]=Rr.map,wr++,Ur.updateMatrices(Rr),Rr.castShadow&&xr++),ir.spotLightMatrix[vr]=Ur.matrix,Rr.castShadow){const Br=tr.get(Rr);Br.shadowIntensity=Ur.intensity,Br.shadowBias=Ur.bias,Br.shadowNormalBias=Ur.normalBias,Br.shadowRadius=Ur.radius,Br.shadowMapSize=Ur.mapSize,ir.spotShadow[vr]=Br,ir.spotShadowMap[vr]=Or,yr++}vr++}else if(Rr.isRectAreaLight){const Nr=er.get(Rr);Nr.color.copy(Pr).multiplyScalar(Dr),Nr.halfWidth.set(Rr.width*.5,0,0),Nr.halfHeight.set(0,Rr.height*.5,0),ir.rectArea[mr]=Nr,mr++}else if(Rr.isPointLight){const Nr=er.get(Rr);if(Nr.color.copy(Rr.color).multiplyScalar(Rr.intensity),Nr.distance=Rr.distance,Nr.decay=Rr.decay,Rr.castShadow){const Ur=Rr.shadow,Br=tr.get(Rr);Br.shadowIntensity=Ur.intensity,Br.shadowBias=Ur.bias,Br.shadowNormalBias=Ur.normalBias,Br.shadowRadius=Ur.radius,Br.shadowMapSize=Ur.mapSize,Br.shadowCameraNear=Ur.camera.near,Br.shadowCameraFar=Ur.camera.far,ir.pointShadow[gr]=Br,ir.pointShadowMap[gr]=Or,ir.pointShadowMatrix[gr]=Rr.shadow.matrix,Ar++}ir.point[gr]=Nr,gr++}else if(Rr.isHemisphereLight){const Nr=er.get(Rr);Nr.skyColor.copy(Rr.color).multiplyScalar(Dr),Nr.groundColor.copy(Rr.groundColor).multiplyScalar(Dr),ir.hemi[fr]=Nr,fr++}}mr>0&&(rr.has("OES_texture_float_linear")===!0?(ir.rectAreaLTC1=UniformsLib.LTC_FLOAT_1,ir.rectAreaLTC2=UniformsLib.LTC_FLOAT_2):(ir.rectAreaLTC1=UniformsLib.LTC_HALF_1,ir.rectAreaLTC2=UniformsLib.LTC_HALF_2)),ir.ambient[0]=ur,ir.ambient[1]=dr,ir.ambient[2]=hr;const br=ir.hash;(br.directionalLength!==pr||br.pointLength!==gr||br.spotLength!==vr||br.rectAreaLength!==mr||br.hemiLength!==fr||br.numDirectionalShadows!==_r||br.numPointShadows!==Ar||br.numSpotShadows!==yr||br.numSpotMaps!==wr||br.numLightProbes!==Sr)&&(ir.directional.length=pr,ir.spot.length=vr,ir.rectArea.length=mr,ir.point.length=gr,ir.hemi.length=fr,ir.directionalShadow.length=_r,ir.directionalShadowMap.length=_r,ir.pointShadow.length=Ar,ir.pointShadowMap.length=Ar,ir.spotShadow.length=yr,ir.spotShadowMap.length=yr,ir.directionalShadowMatrix.length=_r,ir.pointShadowMatrix.length=Ar,ir.spotLightMatrix.length=yr+wr-xr,ir.spotLightMap.length=wr,ir.numSpotLightShadowsWithMaps=xr,ir.numLightProbes=Sr,br.directionalLength=pr,br.pointLength=gr,br.spotLength=vr,br.rectAreaLength=mr,br.hemiLength=fr,br.numDirectionalShadows=_r,br.numPointShadows=Ar,br.numSpotShadows=yr,br.numSpotMaps=wr,br.numLightProbes=Sr,ir.version=nextVersion++)}function lr(cr,ur){let dr=0,hr=0,pr=0,gr=0,vr=0;const mr=ur.matrixWorldInverse;for(let fr=0,_r=cr.length;fr<_r;fr++){const Ar=cr[fr];if(Ar.isDirectionalLight){const yr=ir.directional[dr];yr.direction.setFromMatrixPosition(Ar.matrixWorld),nr.setFromMatrixPosition(Ar.target.matrixWorld),yr.direction.sub(nr),yr.direction.transformDirection(mr),dr++}else if(Ar.isSpotLight){const yr=ir.spot[pr];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),yr.direction.setFromMatrixPosition(Ar.matrixWorld),nr.setFromMatrixPosition(Ar.target.matrixWorld),yr.direction.sub(nr),yr.direction.transformDirection(mr),pr++}else if(Ar.isRectAreaLight){const yr=ir.rectArea[gr];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),ar.identity(),sr.copy(Ar.matrixWorld),sr.premultiply(mr),ar.extractRotation(sr),yr.halfWidth.set(Ar.width*.5,0,0),yr.halfHeight.set(0,Ar.height*.5,0),yr.halfWidth.applyMatrix4(ar),yr.halfHeight.applyMatrix4(ar),gr++}else if(Ar.isPointLight){const yr=ir.point[hr];yr.position.setFromMatrixPosition(Ar.matrixWorld),yr.position.applyMatrix4(mr),hr++}else if(Ar.isHemisphereLight){const yr=ir.hemi[vr];yr.direction.setFromMatrixPosition(Ar.matrixWorld),yr.direction.transformDirection(mr),vr++}}}return{setup:or,setupView:lr,state:ir}}function WebGLRenderState(rr){const er=new WebGLLights(rr),tr=[],ir=[];function nr(ur){cr.camera=ur,tr.length=0,ir.length=0}function sr(ur){tr.push(ur)}function ar(ur){ir.push(ur)}function or(){er.setup(tr)}function lr(ur){er.setupView(tr,ur)}const cr={lightsArray:tr,shadowsArray:ir,camera:null,lights:er,transmissionRenderTarget:{}};return{init:nr,state:cr,setupLights:or,setupLightsView:lr,pushLight:sr,pushShadow:ar}}function WebGLRenderStates(rr){let er=new WeakMap;function tr(nr,sr=0){const ar=er.get(nr);let or;return ar===void 0?(or=new WebGLRenderState(rr),er.set(nr,[or])):sr>=ar.length?(or=new WebGLRenderState(rr),ar.push(or)):or=ar[sr],or}function ir(){er=new WeakMap}return{get:tr,dispose:ir}}class MeshDepthMaterial extends Material{static get type(){return"MeshDepthMaterial"}constructor(er){super(),this.isMeshDepthMaterial=!0,this.depthPacking=BasicDepthPacking,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(er)}copy(er){return super.copy(er),this.depthPacking=er.depthPacking,this.map=er.map,this.alphaMap=er.alphaMap,this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this}}class MeshDistanceMaterial extends Material{static get type(){return"MeshDistanceMaterial"}constructor(er){super(),this.isMeshDistanceMaterial=!0,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(er)}copy(er){return super.copy(er),this.map=er.map,this.alphaMap=er.alphaMap,this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this}}const vertex=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragment=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function WebGLShadowMap(rr,er,tr){let ir=new Frustum;const nr=new Vector2,sr=new Vector2,ar=new Vector4,or=new MeshDepthMaterial({depthPacking:RGBADepthPacking}),lr=new MeshDistanceMaterial,cr={},ur=tr.maxTextureSize,dr={[FrontSide]:BackSide,[BackSide]:FrontSide,[DoubleSide]:DoubleSide},hr=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:vertex,fragmentShader:fragment}),pr=hr.clone();pr.defines.HORIZONTAL_PASS=1;const gr=new BufferGeometry;gr.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const vr=new Mesh(gr,hr),mr=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=PCFShadowMap;let fr=this.type;this.render=function(xr,Sr,br){if(mr.enabled===!1||mr.autoUpdate===!1&&mr.needsUpdate===!1||xr.length===0)return;const Cr=rr.getRenderTarget(),Ir=rr.getActiveCubeFace(),Rr=rr.getActiveMipmapLevel(),Pr=rr.state;Pr.setBlending(NoBlending),Pr.buffers.color.setClear(1,1,1,1),Pr.buffers.depth.setTest(!0),Pr.setScissorTest(!1);const Dr=fr!==VSMShadowMap&&this.type===VSMShadowMap,Fr=fr===VSMShadowMap&&this.type!==VSMShadowMap;for(let Or=0,Nr=xr.length;Or<Nr;Or++){const Ur=xr[Or],Br=Ur.shadow;if(Br===void 0){console.warn("THREE.WebGLShadowMap:",Ur,"has no shadow.");continue}if(Br.autoUpdate===!1&&Br.needsUpdate===!1)continue;nr.copy(Br.mapSize);const Wr=Br.getFrameExtents();if(nr.multiply(Wr),sr.copy(Br.mapSize),(nr.x>ur||nr.y>ur)&&(nr.x>ur&&(sr.x=Math.floor(ur/Wr.x),nr.x=sr.x*Wr.x,Br.mapSize.x=sr.x),nr.y>ur&&(sr.y=Math.floor(ur/Wr.y),nr.y=sr.y*Wr.y,Br.mapSize.y=sr.y)),Br.map===null||Dr===!0||Fr===!0){const Yr=this.type!==VSMShadowMap?{minFilter:NearestFilter,magFilter:NearestFilter}:{};Br.map!==null&&Br.map.dispose(),Br.map=new WebGLRenderTarget(nr.x,nr.y,Yr),Br.map.texture.name=Ur.name+".shadowMap",Br.camera.updateProjectionMatrix()}rr.setRenderTarget(Br.map),rr.clear();const Xr=Br.getViewportCount();for(let Yr=0;Yr<Xr;Yr++){const Qi=Br.getViewport(Yr);ar.set(sr.x*Qi.x,sr.y*Qi.y,sr.x*Qi.z,sr.y*Qi.w),Pr.viewport(ar),Br.updateMatrices(Ur,Yr),ir=Br.getFrustum(),yr(Sr,br,Br.camera,Ur,this.type)}Br.isPointLightShadow!==!0&&this.type===VSMShadowMap&&_r(Br,br),Br.needsUpdate=!1}fr=this.type,mr.needsUpdate=!1,rr.setRenderTarget(Cr,Ir,Rr)};function _r(xr,Sr){const br=er.update(vr);hr.defines.VSM_SAMPLES!==xr.blurSamples&&(hr.defines.VSM_SAMPLES=xr.blurSamples,pr.defines.VSM_SAMPLES=xr.blurSamples,hr.needsUpdate=!0,pr.needsUpdate=!0),xr.mapPass===null&&(xr.mapPass=new WebGLRenderTarget(nr.x,nr.y)),hr.uniforms.shadow_pass.value=xr.map.texture,hr.uniforms.resolution.value=xr.mapSize,hr.uniforms.radius.value=xr.radius,rr.setRenderTarget(xr.mapPass),rr.clear(),rr.renderBufferDirect(Sr,null,br,hr,vr,null),pr.uniforms.shadow_pass.value=xr.mapPass.texture,pr.uniforms.resolution.value=xr.mapSize,pr.uniforms.radius.value=xr.radius,rr.setRenderTarget(xr.map),rr.clear(),rr.renderBufferDirect(Sr,null,br,pr,vr,null)}function Ar(xr,Sr,br,Cr){let Ir=null;const Rr=br.isPointLight===!0?xr.customDistanceMaterial:xr.customDepthMaterial;if(Rr!==void 0)Ir=Rr;else if(Ir=br.isPointLight===!0?lr:or,rr.localClippingEnabled&&Sr.clipShadows===!0&&Array.isArray(Sr.clippingPlanes)&&Sr.clippingPlanes.length!==0||Sr.displacementMap&&Sr.displacementScale!==0||Sr.alphaMap&&Sr.alphaTest>0||Sr.map&&Sr.alphaTest>0){const Pr=Ir.uuid,Dr=Sr.uuid;let Fr=cr[Pr];Fr===void 0&&(Fr={},cr[Pr]=Fr);let Or=Fr[Dr];Or===void 0&&(Or=Ir.clone(),Fr[Dr]=Or,Sr.addEventListener("dispose",wr)),Ir=Or}if(Ir.visible=Sr.visible,Ir.wireframe=Sr.wireframe,Cr===VSMShadowMap?Ir.side=Sr.shadowSide!==null?Sr.shadowSide:Sr.side:Ir.side=Sr.shadowSide!==null?Sr.shadowSide:dr[Sr.side],Ir.alphaMap=Sr.alphaMap,Ir.alphaTest=Sr.alphaTest,Ir.map=Sr.map,Ir.clipShadows=Sr.clipShadows,Ir.clippingPlanes=Sr.clippingPlanes,Ir.clipIntersection=Sr.clipIntersection,Ir.displacementMap=Sr.displacementMap,Ir.displacementScale=Sr.displacementScale,Ir.displacementBias=Sr.displacementBias,Ir.wireframeLinewidth=Sr.wireframeLinewidth,Ir.linewidth=Sr.linewidth,br.isPointLight===!0&&Ir.isMeshDistanceMaterial===!0){const Pr=rr.properties.get(Ir);Pr.light=br}return Ir}function yr(xr,Sr,br,Cr,Ir){if(xr.visible===!1)return;if(xr.layers.test(Sr.layers)&&(xr.isMesh||xr.isLine||xr.isPoints)&&(xr.castShadow||xr.receiveShadow&&Ir===VSMShadowMap)&&(!xr.frustumCulled||ir.intersectsObject(xr))){xr.modelViewMatrix.multiplyMatrices(br.matrixWorldInverse,xr.matrixWorld);const Dr=er.update(xr),Fr=xr.material;if(Array.isArray(Fr)){const Or=Dr.groups;for(let Nr=0,Ur=Or.length;Nr<Ur;Nr++){const Br=Or[Nr],Wr=Fr[Br.materialIndex];if(Wr&&Wr.visible){const Xr=Ar(xr,Wr,Cr,Ir);xr.onBeforeShadow(rr,xr,Sr,br,Dr,Xr,Br),rr.renderBufferDirect(br,null,Dr,Xr,xr,Br),xr.onAfterShadow(rr,xr,Sr,br,Dr,Xr,Br)}}}else if(Fr.visible){const Or=Ar(xr,Fr,Cr,Ir);xr.onBeforeShadow(rr,xr,Sr,br,Dr,Or,null),rr.renderBufferDirect(br,null,Dr,Or,xr,null),xr.onAfterShadow(rr,xr,Sr,br,Dr,Or,null)}}const Pr=xr.children;for(let Dr=0,Fr=Pr.length;Dr<Fr;Dr++)yr(Pr[Dr],Sr,br,Cr,Ir)}function wr(xr){xr.target.removeEventListener("dispose",wr);for(const br in cr){const Cr=cr[br],Ir=xr.target.uuid;Ir in Cr&&(Cr[Ir].dispose(),delete Cr[Ir])}}}const reversedFuncs={[NeverDepth]:AlwaysDepth,[LessDepth]:GreaterDepth,[EqualDepth]:NotEqualDepth,[LessEqualDepth]:GreaterEqualDepth,[AlwaysDepth]:NeverDepth,[GreaterDepth]:LessDepth,[NotEqualDepth]:EqualDepth,[GreaterEqualDepth]:LessEqualDepth};function WebGLState(rr,er){function tr(){let ws=!1;const bs=new Vector4;let Ss=null;const Rs=new Vector4(0,0,0,0);return{setMask:function(Hs){Ss!==Hs&&!ws&&(rr.colorMask(Hs,Hs,Hs,Hs),Ss=Hs)},setLocked:function(Hs){ws=Hs},setClear:function(Hs,ks,na,xa,fa){fa===!0&&(Hs*=xa,ks*=xa,na*=xa),bs.set(Hs,ks,na,xa),Rs.equals(bs)===!1&&(rr.clearColor(Hs,ks,na,xa),Rs.copy(bs))},reset:function(){ws=!1,Ss=null,Rs.set(-1,0,0,0)}}}function ir(){let ws=!1,bs=!1,Ss=null,Rs=null,Hs=null;return{setReversed:function(ks){if(bs!==ks){const na=er.get("EXT_clip_control");bs?na.clipControlEXT(na.LOWER_LEFT_EXT,na.ZERO_TO_ONE_EXT):na.clipControlEXT(na.LOWER_LEFT_EXT,na.NEGATIVE_ONE_TO_ONE_EXT);const xa=Hs;Hs=null,this.setClear(xa)}bs=ks},getReversed:function(){return bs},setTest:function(ks){ks?Gr(rr.DEPTH_TEST):qr(rr.DEPTH_TEST)},setMask:function(ks){Ss!==ks&&!ws&&(rr.depthMask(ks),Ss=ks)},setFunc:function(ks){if(bs&&(ks=reversedFuncs[ks]),Rs!==ks){switch(ks){case NeverDepth:rr.depthFunc(rr.NEVER);break;case AlwaysDepth:rr.depthFunc(rr.ALWAYS);break;case LessDepth:rr.depthFunc(rr.LESS);break;case LessEqualDepth:rr.depthFunc(rr.LEQUAL);break;case EqualDepth:rr.depthFunc(rr.EQUAL);break;case GreaterEqualDepth:rr.depthFunc(rr.GEQUAL);break;case GreaterDepth:rr.depthFunc(rr.GREATER);break;case NotEqualDepth:rr.depthFunc(rr.NOTEQUAL);break;default:rr.depthFunc(rr.LEQUAL)}Rs=ks}},setLocked:function(ks){ws=ks},setClear:function(ks){Hs!==ks&&(bs&&(ks=1-ks),rr.clearDepth(ks),Hs=ks)},reset:function(){ws=!1,Ss=null,Rs=null,Hs=null,bs=!1}}}function nr(){let ws=!1,bs=null,Ss=null,Rs=null,Hs=null,ks=null,na=null,xa=null,fa=null;return{setTest:function(Gs){ws||(Gs?Gr(rr.STENCIL_TEST):qr(rr.STENCIL_TEST))},setMask:function(Gs){bs!==Gs&&!ws&&(rr.stencilMask(Gs),bs=Gs)},setFunc:function(Gs,Zs,Ys){(Ss!==Gs||Rs!==Zs||Hs!==Ys)&&(rr.stencilFunc(Gs,Zs,Ys),Ss=Gs,Rs=Zs,Hs=Ys)},setOp:function(Gs,Zs,Ys){(ks!==Gs||na!==Zs||xa!==Ys)&&(rr.stencilOp(Gs,Zs,Ys),ks=Gs,na=Zs,xa=Ys)},setLocked:function(Gs){ws=Gs},setClear:function(Gs){fa!==Gs&&(rr.clearStencil(Gs),fa=Gs)},reset:function(){ws=!1,bs=null,Ss=null,Rs=null,Hs=null,ks=null,na=null,xa=null,fa=null}}}const sr=new tr,ar=new ir,or=new nr,lr=new WeakMap,cr=new WeakMap;let ur={},dr={},hr=new WeakMap,pr=[],gr=null,vr=!1,mr=null,fr=null,_r=null,Ar=null,yr=null,wr=null,xr=null,Sr=new Color(0,0,0),br=0,Cr=!1,Ir=null,Rr=null,Pr=null,Dr=null,Fr=null;const Or=rr.getParameter(rr.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let Nr=!1,Ur=0;const Br=rr.getParameter(rr.VERSION);Br.indexOf("WebGL")!==-1?(Ur=parseFloat(/^WebGL (\d)/.exec(Br)[1]),Nr=Ur>=1):Br.indexOf("OpenGL ES")!==-1&&(Ur=parseFloat(/^OpenGL ES (\d)/.exec(Br)[1]),Nr=Ur>=2);let Wr=null,Xr={};const Yr=rr.getParameter(rr.SCISSOR_BOX),Qi=rr.getParameter(rr.VIEWPORT),Xi=new Vector4().fromArray(Yr),Kr=new Vector4().fromArray(Qi);function $r(ws,bs,Ss,Rs){const Hs=new Uint8Array(4),ks=rr.createTexture();rr.bindTexture(ws,ks),rr.texParameteri(ws,rr.TEXTURE_MIN_FILTER,rr.NEAREST),rr.texParameteri(ws,rr.TEXTURE_MAG_FILTER,rr.NEAREST);for(let na=0;na<Ss;na++)ws===rr.TEXTURE_3D||ws===rr.TEXTURE_2D_ARRAY?rr.texImage3D(bs,0,rr.RGBA,1,1,Rs,0,rr.RGBA,rr.UNSIGNED_BYTE,Hs):rr.texImage2D(bs+na,0,rr.RGBA,1,1,0,rr.RGBA,rr.UNSIGNED_BYTE,Hs);return ks}const Vr={};Vr[rr.TEXTURE_2D]=$r(rr.TEXTURE_2D,rr.TEXTURE_2D,1),Vr[rr.TEXTURE_CUBE_MAP]=$r(rr.TEXTURE_CUBE_MAP,rr.TEXTURE_CUBE_MAP_POSITIVE_X,6),Vr[rr.TEXTURE_2D_ARRAY]=$r(rr.TEXTURE_2D_ARRAY,rr.TEXTURE_2D_ARRAY,1,1),Vr[rr.TEXTURE_3D]=$r(rr.TEXTURE_3D,rr.TEXTURE_3D,1,1),sr.setClear(0,0,0,1),ar.setClear(1),or.setClear(0),Gr(rr.DEPTH_TEST),ar.setFunc(LessEqualDepth),os(!1),cs(CullFaceBack),Gr(rr.CULL_FACE),Zr(NoBlending);function Gr(ws){ur[ws]!==!0&&(rr.enable(ws),ur[ws]=!0)}function qr(ws){ur[ws]!==!1&&(rr.disable(ws),ur[ws]=!1)}function ji(ws,bs){return dr[ws]!==bs?(rr.bindFramebuffer(ws,bs),dr[ws]=bs,ws===rr.DRAW_FRAMEBUFFER&&(dr[rr.FRAMEBUFFER]=bs),ws===rr.FRAMEBUFFER&&(dr[rr.DRAW_FRAMEBUFFER]=bs),!0):!1}function Jr(ws,bs){let Ss=pr,Rs=!1;if(ws){Ss=hr.get(bs),Ss===void 0&&(Ss=[],hr.set(bs,Ss));const Hs=ws.textures;if(Ss.length!==Hs.length||Ss[0]!==rr.COLOR_ATTACHMENT0){for(let ks=0,na=Hs.length;ks<na;ks++)Ss[ks]=rr.COLOR_ATTACHMENT0+ks;Ss.length=Hs.length,Rs=!0}}else Ss[0]!==rr.BACK&&(Ss[0]=rr.BACK,Rs=!0);Rs&&rr.drawBuffers(Ss)}function Ji(ws){return gr!==ws?(rr.useProgram(ws),gr=ws,!0):!1}const Ki={[AddEquation]:rr.FUNC_ADD,[SubtractEquation]:rr.FUNC_SUBTRACT,[ReverseSubtractEquation]:rr.FUNC_REVERSE_SUBTRACT};Ki[MinEquation]=rr.MIN,Ki[MaxEquation]=rr.MAX;const Zi={[ZeroFactor]:rr.ZERO,[OneFactor]:rr.ONE,[SrcColorFactor]:rr.SRC_COLOR,[SrcAlphaFactor]:rr.SRC_ALPHA,[SrcAlphaSaturateFactor]:rr.SRC_ALPHA_SATURATE,[DstColorFactor]:rr.DST_COLOR,[DstAlphaFactor]:rr.DST_ALPHA,[OneMinusSrcColorFactor]:rr.ONE_MINUS_SRC_COLOR,[OneMinusSrcAlphaFactor]:rr.ONE_MINUS_SRC_ALPHA,[OneMinusDstColorFactor]:rr.ONE_MINUS_DST_COLOR,[OneMinusDstAlphaFactor]:rr.ONE_MINUS_DST_ALPHA,[ConstantColorFactor]:rr.CONSTANT_COLOR,[OneMinusConstantColorFactor]:rr.ONE_MINUS_CONSTANT_COLOR,[ConstantAlphaFactor]:rr.CONSTANT_ALPHA,[OneMinusConstantAlphaFactor]:rr.ONE_MINUS_CONSTANT_ALPHA};function Zr(ws,bs,Ss,Rs,Hs,ks,na,xa,fa,Gs){if(ws===NoBlending){vr===!0&&(qr(rr.BLEND),vr=!1);return}if(vr===!1&&(Gr(rr.BLEND),vr=!0),ws!==CustomBlending){if(ws!==mr||Gs!==Cr){if((fr!==AddEquation||yr!==AddEquation)&&(rr.blendEquation(rr.FUNC_ADD),fr=AddEquation,yr=AddEquation),Gs)switch(ws){case NormalBlending:rr.blendFuncSeparate(rr.ONE,rr.ONE_MINUS_SRC_ALPHA,rr.ONE,rr.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:rr.blendFunc(rr.ONE,rr.ONE);break;case SubtractiveBlending:rr.blendFuncSeparate(rr.ZERO,rr.ONE_MINUS_SRC_COLOR,rr.ZERO,rr.ONE);break;case MultiplyBlending:rr.blendFuncSeparate(rr.ZERO,rr.SRC_COLOR,rr.ZERO,rr.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",ws);break}else switch(ws){case NormalBlending:rr.blendFuncSeparate(rr.SRC_ALPHA,rr.ONE_MINUS_SRC_ALPHA,rr.ONE,rr.ONE_MINUS_SRC_ALPHA);break;case AdditiveBlending:rr.blendFunc(rr.SRC_ALPHA,rr.ONE);break;case SubtractiveBlending:rr.blendFuncSeparate(rr.ZERO,rr.ONE_MINUS_SRC_COLOR,rr.ZERO,rr.ONE);break;case MultiplyBlending:rr.blendFunc(rr.ZERO,rr.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",ws);break}_r=null,Ar=null,wr=null,xr=null,Sr.set(0,0,0),br=0,mr=ws,Cr=Gs}return}Hs=Hs||bs,ks=ks||Ss,na=na||Rs,(bs!==fr||Hs!==yr)&&(rr.blendEquationSeparate(Ki[bs],Ki[Hs]),fr=bs,yr=Hs),(Ss!==_r||Rs!==Ar||ks!==wr||na!==xr)&&(rr.blendFuncSeparate(Zi[Ss],Zi[Rs],Zi[ks],Zi[na]),_r=Ss,Ar=Rs,wr=ks,xr=na),(xa.equals(Sr)===!1||fa!==br)&&(rr.blendColor(xa.r,xa.g,xa.b,fa),Sr.copy(xa),br=fa),mr=ws,Cr=!1}function is(ws,bs){ws.side===DoubleSide?qr(rr.CULL_FACE):Gr(rr.CULL_FACE);let Ss=ws.side===BackSide;bs&&(Ss=!Ss),os(Ss),ws.blending===NormalBlending&&ws.transparent===!1?Zr(NoBlending):Zr(ws.blending,ws.blendEquation,ws.blendSrc,ws.blendDst,ws.blendEquationAlpha,ws.blendSrcAlpha,ws.blendDstAlpha,ws.blendColor,ws.blendAlpha,ws.premultipliedAlpha),ar.setFunc(ws.depthFunc),ar.setTest(ws.depthTest),ar.setMask(ws.depthWrite),sr.setMask(ws.colorWrite);const Rs=ws.stencilWrite;or.setTest(Rs),Rs&&(or.setMask(ws.stencilWriteMask),or.setFunc(ws.stencilFunc,ws.stencilRef,ws.stencilFuncMask),or.setOp(ws.stencilFail,ws.stencilZFail,ws.stencilZPass)),es(ws.polygonOffset,ws.polygonOffsetFactor,ws.polygonOffsetUnits),ws.alphaToCoverage===!0?Gr(rr.SAMPLE_ALPHA_TO_COVERAGE):qr(rr.SAMPLE_ALPHA_TO_COVERAGE)}function os(ws){Ir!==ws&&(ws?rr.frontFace(rr.CW):rr.frontFace(rr.CCW),Ir=ws)}function cs(ws){ws!==CullFaceNone?(Gr(rr.CULL_FACE),ws!==Rr&&(ws===CullFaceBack?rr.cullFace(rr.BACK):ws===CullFaceFront?rr.cullFace(rr.FRONT):rr.cullFace(rr.FRONT_AND_BACK))):qr(rr.CULL_FACE),Rr=ws}function ss(ws){ws!==Pr&&(Nr&&rr.lineWidth(ws),Pr=ws)}function es(ws,bs,Ss){ws?(Gr(rr.POLYGON_OFFSET_FILL),(Dr!==bs||Fr!==Ss)&&(rr.polygonOffset(bs,Ss),Dr=bs,Fr=Ss)):qr(rr.POLYGON_OFFSET_FILL)}function ms(ws){ws?Gr(rr.SCISSOR_TEST):qr(rr.SCISSOR_TEST)}function Yi(ws){ws===void 0&&(ws=rr.TEXTURE0+Or-1),Wr!==ws&&(rr.activeTexture(ws),Wr=ws)}function Gi(ws,bs,Ss){Ss===void 0&&(Wr===null?Ss=rr.TEXTURE0+Or-1:Ss=Wr);let Rs=Xr[Ss];Rs===void 0&&(Rs={type:void 0,texture:void 0},Xr[Ss]=Rs),(Rs.type!==ws||Rs.texture!==bs)&&(Wr!==Ss&&(rr.activeTexture(Ss),Wr=Ss),rr.bindTexture(ws,bs||Vr[ws]),Rs.type=ws,Rs.texture=bs)}function Ni(){const ws=Xr[Wr];ws!==void 0&&ws.type!==void 0&&(rr.bindTexture(ws.type,null),ws.type=void 0,ws.texture=void 0)}function Ri(){try{rr.compressedTexImage2D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function qi(){try{rr.compressedTexImage3D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function as(){try{rr.texSubImage2D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function us(){try{rr.texSubImage3D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function gs(){try{rr.compressedTexSubImage2D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function vs(){try{rr.compressedTexSubImage3D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function _s(){try{rr.texStorage2D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function As(){try{rr.texStorage3D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function xs(){try{rr.texImage2D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function Es(){try{rr.texImage3D.apply(rr,arguments)}catch(ws){console.error("THREE.WebGLState:",ws)}}function Ps(ws){Xi.equals(ws)===!1&&(rr.scissor(ws.x,ws.y,ws.z,ws.w),Xi.copy(ws))}function Ns(ws){Kr.equals(ws)===!1&&(rr.viewport(ws.x,ws.y,ws.z,ws.w),Kr.copy(ws))}function Vs(ws,bs){let Ss=cr.get(bs);Ss===void 0&&(Ss=new WeakMap,cr.set(bs,Ss));let Rs=Ss.get(ws);Rs===void 0&&(Rs=rr.getUniformBlockIndex(bs,ws.name),Ss.set(ws,Rs))}function Us(ws,bs){const Rs=cr.get(bs).get(ws);lr.get(bs)!==Rs&&(rr.uniformBlockBinding(bs,Rs,ws.__bindingPointIndex),lr.set(bs,Rs))}function Os(){rr.disable(rr.BLEND),rr.disable(rr.CULL_FACE),rr.disable(rr.DEPTH_TEST),rr.disable(rr.POLYGON_OFFSET_FILL),rr.disable(rr.SCISSOR_TEST),rr.disable(rr.STENCIL_TEST),rr.disable(rr.SAMPLE_ALPHA_TO_COVERAGE),rr.blendEquation(rr.FUNC_ADD),rr.blendFunc(rr.ONE,rr.ZERO),rr.blendFuncSeparate(rr.ONE,rr.ZERO,rr.ONE,rr.ZERO),rr.blendColor(0,0,0,0),rr.colorMask(!0,!0,!0,!0),rr.clearColor(0,0,0,0),rr.depthMask(!0),rr.depthFunc(rr.LESS),ar.setReversed(!1),rr.clearDepth(1),rr.stencilMask(4294967295),rr.stencilFunc(rr.ALWAYS,0,4294967295),rr.stencilOp(rr.KEEP,rr.KEEP,rr.KEEP),rr.clearStencil(0),rr.cullFace(rr.BACK),rr.frontFace(rr.CCW),rr.polygonOffset(0,0),rr.activeTexture(rr.TEXTURE0),rr.bindFramebuffer(rr.FRAMEBUFFER,null),rr.bindFramebuffer(rr.DRAW_FRAMEBUFFER,null),rr.bindFramebuffer(rr.READ_FRAMEBUFFER,null),rr.useProgram(null),rr.lineWidth(1),rr.scissor(0,0,rr.canvas.width,rr.canvas.height),rr.viewport(0,0,rr.canvas.width,rr.canvas.height),ur={},Wr=null,Xr={},dr={},hr=new WeakMap,pr=[],gr=null,vr=!1,mr=null,fr=null,_r=null,Ar=null,yr=null,wr=null,xr=null,Sr=new Color(0,0,0),br=0,Cr=!1,Ir=null,Rr=null,Pr=null,Dr=null,Fr=null,Xi.set(0,0,rr.canvas.width,rr.canvas.height),Kr.set(0,0,rr.canvas.width,rr.canvas.height),sr.reset(),ar.reset(),or.reset()}return{buffers:{color:sr,depth:ar,stencil:or},enable:Gr,disable:qr,bindFramebuffer:ji,drawBuffers:Jr,useProgram:Ji,setBlending:Zr,setMaterial:is,setFlipSided:os,setCullFace:cs,setLineWidth:ss,setPolygonOffset:es,setScissorTest:ms,activeTexture:Yi,bindTexture:Gi,unbindTexture:Ni,compressedTexImage2D:Ri,compressedTexImage3D:qi,texImage2D:xs,texImage3D:Es,updateUBOMapping:Vs,uniformBlockBinding:Us,texStorage2D:_s,texStorage3D:As,texSubImage2D:as,texSubImage3D:us,compressedTexSubImage2D:gs,compressedTexSubImage3D:vs,scissor:Ps,viewport:Ns,reset:Os}}function contain(rr,er){const tr=rr.image&&rr.image.width?rr.image.width/rr.image.height:1;return tr>er?(rr.repeat.x=1,rr.repeat.y=tr/er,rr.offset.x=0,rr.offset.y=(1-rr.repeat.y)/2):(rr.repeat.x=er/tr,rr.repeat.y=1,rr.offset.x=(1-rr.repeat.x)/2,rr.offset.y=0),rr}function cover(rr,er){const tr=rr.image&&rr.image.width?rr.image.width/rr.image.height:1;return tr>er?(rr.repeat.x=er/tr,rr.repeat.y=1,rr.offset.x=(1-rr.repeat.x)/2,rr.offset.y=0):(rr.repeat.x=1,rr.repeat.y=tr/er,rr.offset.x=0,rr.offset.y=(1-rr.repeat.y)/2),rr}function fill(rr){return rr.repeat.x=1,rr.repeat.y=1,rr.offset.x=0,rr.offset.y=0,rr}function getByteLength(rr,er,tr,ir){const nr=getTextureTypeByteLength(ir);switch(tr){case AlphaFormat:return rr*er;case LuminanceFormat:return rr*er;case LuminanceAlphaFormat:return rr*er*2;case RedFormat:return rr*er/nr.components*nr.byteLength;case RedIntegerFormat:return rr*er/nr.components*nr.byteLength;case RGFormat:return rr*er*2/nr.components*nr.byteLength;case RGIntegerFormat:return rr*er*2/nr.components*nr.byteLength;case RGBFormat:return rr*er*3/nr.components*nr.byteLength;case RGBAFormat:return rr*er*4/nr.components*nr.byteLength;case RGBAIntegerFormat:return rr*er*4/nr.components*nr.byteLength;case RGB_S3TC_DXT1_Format:case RGBA_S3TC_DXT1_Format:return Math.floor((rr+3)/4)*Math.floor((er+3)/4)*8;case RGBA_S3TC_DXT3_Format:case RGBA_S3TC_DXT5_Format:return Math.floor((rr+3)/4)*Math.floor((er+3)/4)*16;case RGB_PVRTC_2BPPV1_Format:case RGBA_PVRTC_2BPPV1_Format:return Math.max(rr,16)*Math.max(er,8)/4;case RGB_PVRTC_4BPPV1_Format:case RGBA_PVRTC_4BPPV1_Format:return Math.max(rr,8)*Math.max(er,8)/2;case RGB_ETC1_Format:case RGB_ETC2_Format:return Math.floor((rr+3)/4)*Math.floor((er+3)/4)*8;case RGBA_ETC2_EAC_Format:return Math.floor((rr+3)/4)*Math.floor((er+3)/4)*16;case RGBA_ASTC_4x4_Format:return Math.floor((rr+3)/4)*Math.floor((er+3)/4)*16;case RGBA_ASTC_5x4_Format:return Math.floor((rr+4)/5)*Math.floor((er+3)/4)*16;case RGBA_ASTC_5x5_Format:return Math.floor((rr+4)/5)*Math.floor((er+4)/5)*16;case RGBA_ASTC_6x5_Format:return Math.floor((rr+5)/6)*Math.floor((er+4)/5)*16;case RGBA_ASTC_6x6_Format:return Math.floor((rr+5)/6)*Math.floor((er+5)/6)*16;case RGBA_ASTC_8x5_Format:return Math.floor((rr+7)/8)*Math.floor((er+4)/5)*16;case RGBA_ASTC_8x6_Format:return Math.floor((rr+7)/8)*Math.floor((er+5)/6)*16;case RGBA_ASTC_8x8_Format:return Math.floor((rr+7)/8)*Math.floor((er+7)/8)*16;case RGBA_ASTC_10x5_Format:return Math.floor((rr+9)/10)*Math.floor((er+4)/5)*16;case RGBA_ASTC_10x6_Format:return Math.floor((rr+9)/10)*Math.floor((er+5)/6)*16;case RGBA_ASTC_10x8_Format:return Math.floor((rr+9)/10)*Math.floor((er+7)/8)*16;case RGBA_ASTC_10x10_Format:return Math.floor((rr+9)/10)*Math.floor((er+9)/10)*16;case RGBA_ASTC_12x10_Format:return Math.floor((rr+11)/12)*Math.floor((er+9)/10)*16;case RGBA_ASTC_12x12_Format:return Math.floor((rr+11)/12)*Math.floor((er+11)/12)*16;case RGBA_BPTC_Format:case RGB_BPTC_SIGNED_Format:case RGB_BPTC_UNSIGNED_Format:return Math.ceil(rr/4)*Math.ceil(er/4)*16;case RED_RGTC1_Format:case SIGNED_RED_RGTC1_Format:return Math.ceil(rr/4)*Math.ceil(er/4)*8;case RED_GREEN_RGTC2_Format:case SIGNED_RED_GREEN_RGTC2_Format:return Math.ceil(rr/4)*Math.ceil(er/4)*16}throw new Error(`Unable to determine texture byte length for ${tr} format.`)}function getTextureTypeByteLength(rr){switch(rr){case UnsignedByteType:case ByteType:return{byteLength:1,components:1};case UnsignedShortType:case ShortType:case HalfFloatType:return{byteLength:2,components:1};case UnsignedShort4444Type:case UnsignedShort5551Type:return{byteLength:2,components:4};case UnsignedIntType:case IntType:case FloatType:return{byteLength:4,components:1};case UnsignedInt5999Type:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${rr}.`)}const TextureUtils={contain,cover,fill,getByteLength};function WebGLTextures(rr,er,tr,ir,nr,sr,ar){const or=er.has("WEBGL_multisampled_render_to_texture")?er.get("WEBGL_multisampled_render_to_texture"):null,lr=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),cr=new Vector2,ur=new WeakMap;let dr;const hr=new WeakMap;let pr=!1;try{pr=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function gr(Yi,Gi){return pr?new OffscreenCanvas(Yi,Gi):createElementNS("canvas")}function vr(Yi,Gi,Ni){let Ri=1;const qi=ms(Yi);if((qi.width>Ni||qi.height>Ni)&&(Ri=Ni/Math.max(qi.width,qi.height)),Ri<1)if(typeof HTMLImageElement<"u"&&Yi instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Yi instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Yi instanceof ImageBitmap||typeof VideoFrame<"u"&&Yi instanceof VideoFrame){const as=Math.floor(Ri*qi.width),us=Math.floor(Ri*qi.height);dr===void 0&&(dr=gr(as,us));const gs=Gi?gr(as,us):dr;return gs.width=as,gs.height=us,gs.getContext("2d").drawImage(Yi,0,0,as,us),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+qi.width+"x"+qi.height+") to ("+as+"x"+us+")."),gs}else return"data"in Yi&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+qi.width+"x"+qi.height+")."),Yi;return Yi}function mr(Yi){return Yi.generateMipmaps}function fr(Yi){rr.generateMipmap(Yi)}function _r(Yi){return Yi.isWebGLCubeRenderTarget?rr.TEXTURE_CUBE_MAP:Yi.isWebGL3DRenderTarget?rr.TEXTURE_3D:Yi.isWebGLArrayRenderTarget||Yi.isCompressedArrayTexture?rr.TEXTURE_2D_ARRAY:rr.TEXTURE_2D}function Ar(Yi,Gi,Ni,Ri,qi=!1){if(Yi!==null){if(rr[Yi]!==void 0)return rr[Yi];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Yi+"'")}let as=Gi;if(Gi===rr.RED&&(Ni===rr.FLOAT&&(as=rr.R32F),Ni===rr.HALF_FLOAT&&(as=rr.R16F),Ni===rr.UNSIGNED_BYTE&&(as=rr.R8)),Gi===rr.RED_INTEGER&&(Ni===rr.UNSIGNED_BYTE&&(as=rr.R8UI),Ni===rr.UNSIGNED_SHORT&&(as=rr.R16UI),Ni===rr.UNSIGNED_INT&&(as=rr.R32UI),Ni===rr.BYTE&&(as=rr.R8I),Ni===rr.SHORT&&(as=rr.R16I),Ni===rr.INT&&(as=rr.R32I)),Gi===rr.RG&&(Ni===rr.FLOAT&&(as=rr.RG32F),Ni===rr.HALF_FLOAT&&(as=rr.RG16F),Ni===rr.UNSIGNED_BYTE&&(as=rr.RG8)),Gi===rr.RG_INTEGER&&(Ni===rr.UNSIGNED_BYTE&&(as=rr.RG8UI),Ni===rr.UNSIGNED_SHORT&&(as=rr.RG16UI),Ni===rr.UNSIGNED_INT&&(as=rr.RG32UI),Ni===rr.BYTE&&(as=rr.RG8I),Ni===rr.SHORT&&(as=rr.RG16I),Ni===rr.INT&&(as=rr.RG32I)),Gi===rr.RGB_INTEGER&&(Ni===rr.UNSIGNED_BYTE&&(as=rr.RGB8UI),Ni===rr.UNSIGNED_SHORT&&(as=rr.RGB16UI),Ni===rr.UNSIGNED_INT&&(as=rr.RGB32UI),Ni===rr.BYTE&&(as=rr.RGB8I),Ni===rr.SHORT&&(as=rr.RGB16I),Ni===rr.INT&&(as=rr.RGB32I)),Gi===rr.RGBA_INTEGER&&(Ni===rr.UNSIGNED_BYTE&&(as=rr.RGBA8UI),Ni===rr.UNSIGNED_SHORT&&(as=rr.RGBA16UI),Ni===rr.UNSIGNED_INT&&(as=rr.RGBA32UI),Ni===rr.BYTE&&(as=rr.RGBA8I),Ni===rr.SHORT&&(as=rr.RGBA16I),Ni===rr.INT&&(as=rr.RGBA32I)),Gi===rr.RGB&&Ni===rr.UNSIGNED_INT_5_9_9_9_REV&&(as=rr.RGB9_E5),Gi===rr.RGBA){const us=qi?LinearTransfer:ColorManagement.getTransfer(Ri);Ni===rr.FLOAT&&(as=rr.RGBA32F),Ni===rr.HALF_FLOAT&&(as=rr.RGBA16F),Ni===rr.UNSIGNED_BYTE&&(as=us===SRGBTransfer?rr.SRGB8_ALPHA8:rr.RGBA8),Ni===rr.UNSIGNED_SHORT_4_4_4_4&&(as=rr.RGBA4),Ni===rr.UNSIGNED_SHORT_5_5_5_1&&(as=rr.RGB5_A1)}return(as===rr.R16F||as===rr.R32F||as===rr.RG16F||as===rr.RG32F||as===rr.RGBA16F||as===rr.RGBA32F)&&er.get("EXT_color_buffer_float"),as}function yr(Yi,Gi){let Ni;return Yi?Gi===null||Gi===UnsignedIntType||Gi===UnsignedInt248Type?Ni=rr.DEPTH24_STENCIL8:Gi===FloatType?Ni=rr.DEPTH32F_STENCIL8:Gi===UnsignedShortType&&(Ni=rr.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):Gi===null||Gi===UnsignedIntType||Gi===UnsignedInt248Type?Ni=rr.DEPTH_COMPONENT24:Gi===FloatType?Ni=rr.DEPTH_COMPONENT32F:Gi===UnsignedShortType&&(Ni=rr.DEPTH_COMPONENT16),Ni}function wr(Yi,Gi){return mr(Yi)===!0||Yi.isFramebufferTexture&&Yi.minFilter!==NearestFilter&&Yi.minFilter!==LinearFilter?Math.log2(Math.max(Gi.width,Gi.height))+1:Yi.mipmaps!==void 0&&Yi.mipmaps.length>0?Yi.mipmaps.length:Yi.isCompressedTexture&&Array.isArray(Yi.image)?Gi.mipmaps.length:1}function xr(Yi){const Gi=Yi.target;Gi.removeEventListener("dispose",xr),br(Gi),Gi.isVideoTexture&&ur.delete(Gi)}function Sr(Yi){const Gi=Yi.target;Gi.removeEventListener("dispose",Sr),Ir(Gi)}function br(Yi){const Gi=ir.get(Yi);if(Gi.__webglInit===void 0)return;const Ni=Yi.source,Ri=hr.get(Ni);if(Ri){const qi=Ri[Gi.__cacheKey];qi.usedTimes--,qi.usedTimes===0&&Cr(Yi),Object.keys(Ri).length===0&&hr.delete(Ni)}ir.remove(Yi)}function Cr(Yi){const Gi=ir.get(Yi);rr.deleteTexture(Gi.__webglTexture);const Ni=Yi.source,Ri=hr.get(Ni);delete Ri[Gi.__cacheKey],ar.memory.textures--}function Ir(Yi){const Gi=ir.get(Yi);if(Yi.depthTexture&&(Yi.depthTexture.dispose(),ir.remove(Yi.depthTexture)),Yi.isWebGLCubeRenderTarget)for(let Ri=0;Ri<6;Ri++){if(Array.isArray(Gi.__webglFramebuffer[Ri]))for(let qi=0;qi<Gi.__webglFramebuffer[Ri].length;qi++)rr.deleteFramebuffer(Gi.__webglFramebuffer[Ri][qi]);else rr.deleteFramebuffer(Gi.__webglFramebuffer[Ri]);Gi.__webglDepthbuffer&&rr.deleteRenderbuffer(Gi.__webglDepthbuffer[Ri])}else{if(Array.isArray(Gi.__webglFramebuffer))for(let Ri=0;Ri<Gi.__webglFramebuffer.length;Ri++)rr.deleteFramebuffer(Gi.__webglFramebuffer[Ri]);else rr.deleteFramebuffer(Gi.__webglFramebuffer);if(Gi.__webglDepthbuffer&&rr.deleteRenderbuffer(Gi.__webglDepthbuffer),Gi.__webglMultisampledFramebuffer&&rr.deleteFramebuffer(Gi.__webglMultisampledFramebuffer),Gi.__webglColorRenderbuffer)for(let Ri=0;Ri<Gi.__webglColorRenderbuffer.length;Ri++)Gi.__webglColorRenderbuffer[Ri]&&rr.deleteRenderbuffer(Gi.__webglColorRenderbuffer[Ri]);Gi.__webglDepthRenderbuffer&&rr.deleteRenderbuffer(Gi.__webglDepthRenderbuffer)}const Ni=Yi.textures;for(let Ri=0,qi=Ni.length;Ri<qi;Ri++){const as=ir.get(Ni[Ri]);as.__webglTexture&&(rr.deleteTexture(as.__webglTexture),ar.memory.textures--),ir.remove(Ni[Ri])}ir.remove(Yi)}let Rr=0;function Pr(){Rr=0}function Dr(){const Yi=Rr;return Yi>=nr.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Yi+" texture units while this GPU supports only "+nr.maxTextures),Rr+=1,Yi}function Fr(Yi){const Gi=[];return Gi.push(Yi.wrapS),Gi.push(Yi.wrapT),Gi.push(Yi.wrapR||0),Gi.push(Yi.magFilter),Gi.push(Yi.minFilter),Gi.push(Yi.anisotropy),Gi.push(Yi.internalFormat),Gi.push(Yi.format),Gi.push(Yi.type),Gi.push(Yi.generateMipmaps),Gi.push(Yi.premultiplyAlpha),Gi.push(Yi.flipY),Gi.push(Yi.unpackAlignment),Gi.push(Yi.colorSpace),Gi.join()}function Or(Yi,Gi){const Ni=ir.get(Yi);if(Yi.isVideoTexture&&ss(Yi),Yi.isRenderTargetTexture===!1&&Yi.version>0&&Ni.__version!==Yi.version){const Ri=Yi.image;if(Ri===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ri.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Kr(Ni,Yi,Gi);return}}tr.bindTexture(rr.TEXTURE_2D,Ni.__webglTexture,rr.TEXTURE0+Gi)}function Nr(Yi,Gi){const Ni=ir.get(Yi);if(Yi.version>0&&Ni.__version!==Yi.version){Kr(Ni,Yi,Gi);return}tr.bindTexture(rr.TEXTURE_2D_ARRAY,Ni.__webglTexture,rr.TEXTURE0+Gi)}function Ur(Yi,Gi){const Ni=ir.get(Yi);if(Yi.version>0&&Ni.__version!==Yi.version){Kr(Ni,Yi,Gi);return}tr.bindTexture(rr.TEXTURE_3D,Ni.__webglTexture,rr.TEXTURE0+Gi)}function Br(Yi,Gi){const Ni=ir.get(Yi);if(Yi.version>0&&Ni.__version!==Yi.version){$r(Ni,Yi,Gi);return}tr.bindTexture(rr.TEXTURE_CUBE_MAP,Ni.__webglTexture,rr.TEXTURE0+Gi)}const Wr={[RepeatWrapping]:rr.REPEAT,[ClampToEdgeWrapping]:rr.CLAMP_TO_EDGE,[MirroredRepeatWrapping]:rr.MIRRORED_REPEAT},Xr={[NearestFilter]:rr.NEAREST,[NearestMipmapNearestFilter]:rr.NEAREST_MIPMAP_NEAREST,[NearestMipmapLinearFilter]:rr.NEAREST_MIPMAP_LINEAR,[LinearFilter]:rr.LINEAR,[LinearMipmapNearestFilter]:rr.LINEAR_MIPMAP_NEAREST,[LinearMipmapLinearFilter]:rr.LINEAR_MIPMAP_LINEAR},Yr={[NeverCompare]:rr.NEVER,[AlwaysCompare]:rr.ALWAYS,[LessCompare]:rr.LESS,[LessEqualCompare]:rr.LEQUAL,[EqualCompare]:rr.EQUAL,[GreaterEqualCompare]:rr.GEQUAL,[GreaterCompare]:rr.GREATER,[NotEqualCompare]:rr.NOTEQUAL};function Qi(Yi,Gi){if(Gi.type===FloatType&&er.has("OES_texture_float_linear")===!1&&(Gi.magFilter===LinearFilter||Gi.magFilter===LinearMipmapNearestFilter||Gi.magFilter===NearestMipmapLinearFilter||Gi.magFilter===LinearMipmapLinearFilter||Gi.minFilter===LinearFilter||Gi.minFilter===LinearMipmapNearestFilter||Gi.minFilter===NearestMipmapLinearFilter||Gi.minFilter===LinearMipmapLinearFilter)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),rr.texParameteri(Yi,rr.TEXTURE_WRAP_S,Wr[Gi.wrapS]),rr.texParameteri(Yi,rr.TEXTURE_WRAP_T,Wr[Gi.wrapT]),(Yi===rr.TEXTURE_3D||Yi===rr.TEXTURE_2D_ARRAY)&&rr.texParameteri(Yi,rr.TEXTURE_WRAP_R,Wr[Gi.wrapR]),rr.texParameteri(Yi,rr.TEXTURE_MAG_FILTER,Xr[Gi.magFilter]),rr.texParameteri(Yi,rr.TEXTURE_MIN_FILTER,Xr[Gi.minFilter]),Gi.compareFunction&&(rr.texParameteri(Yi,rr.TEXTURE_COMPARE_MODE,rr.COMPARE_REF_TO_TEXTURE),rr.texParameteri(Yi,rr.TEXTURE_COMPARE_FUNC,Yr[Gi.compareFunction])),er.has("EXT_texture_filter_anisotropic")===!0){if(Gi.magFilter===NearestFilter||Gi.minFilter!==NearestMipmapLinearFilter&&Gi.minFilter!==LinearMipmapLinearFilter||Gi.type===FloatType&&er.has("OES_texture_float_linear")===!1)return;if(Gi.anisotropy>1||ir.get(Gi).__currentAnisotropy){const Ni=er.get("EXT_texture_filter_anisotropic");rr.texParameterf(Yi,Ni.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Gi.anisotropy,nr.getMaxAnisotropy())),ir.get(Gi).__currentAnisotropy=Gi.anisotropy}}}function Xi(Yi,Gi){let Ni=!1;Yi.__webglInit===void 0&&(Yi.__webglInit=!0,Gi.addEventListener("dispose",xr));const Ri=Gi.source;let qi=hr.get(Ri);qi===void 0&&(qi={},hr.set(Ri,qi));const as=Fr(Gi);if(as!==Yi.__cacheKey){qi[as]===void 0&&(qi[as]={texture:rr.createTexture(),usedTimes:0},ar.memory.textures++,Ni=!0),qi[as].usedTimes++;const us=qi[Yi.__cacheKey];us!==void 0&&(qi[Yi.__cacheKey].usedTimes--,us.usedTimes===0&&Cr(Gi)),Yi.__cacheKey=as,Yi.__webglTexture=qi[as].texture}return Ni}function Kr(Yi,Gi,Ni){let Ri=rr.TEXTURE_2D;(Gi.isDataArrayTexture||Gi.isCompressedArrayTexture)&&(Ri=rr.TEXTURE_2D_ARRAY),Gi.isData3DTexture&&(Ri=rr.TEXTURE_3D);const qi=Xi(Yi,Gi),as=Gi.source;tr.bindTexture(Ri,Yi.__webglTexture,rr.TEXTURE0+Ni);const us=ir.get(as);if(as.version!==us.__version||qi===!0){tr.activeTexture(rr.TEXTURE0+Ni);const gs=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),vs=Gi.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Gi.colorSpace),_s=Gi.colorSpace===NoColorSpace||gs===vs?rr.NONE:rr.BROWSER_DEFAULT_WEBGL;rr.pixelStorei(rr.UNPACK_FLIP_Y_WEBGL,Gi.flipY),rr.pixelStorei(rr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Gi.premultiplyAlpha),rr.pixelStorei(rr.UNPACK_ALIGNMENT,Gi.unpackAlignment),rr.pixelStorei(rr.UNPACK_COLORSPACE_CONVERSION_WEBGL,_s);let As=vr(Gi.image,!1,nr.maxTextureSize);As=es(Gi,As);const xs=sr.convert(Gi.format,Gi.colorSpace),Es=sr.convert(Gi.type);let Ps=Ar(Gi.internalFormat,xs,Es,Gi.colorSpace,Gi.isVideoTexture);Qi(Ri,Gi);let Ns;const Vs=Gi.mipmaps,Us=Gi.isVideoTexture!==!0,Os=us.__version===void 0||qi===!0,ws=as.dataReady,bs=wr(Gi,As);if(Gi.isDepthTexture)Ps=yr(Gi.format===DepthStencilFormat,Gi.type),Os&&(Us?tr.texStorage2D(rr.TEXTURE_2D,1,Ps,As.width,As.height):tr.texImage2D(rr.TEXTURE_2D,0,Ps,As.width,As.height,0,xs,Es,null));else if(Gi.isDataTexture)if(Vs.length>0){Us&&Os&&tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,Vs[0].width,Vs[0].height);for(let Ss=0,Rs=Vs.length;Ss<Rs;Ss++)Ns=Vs[Ss],Us?ws&&tr.texSubImage2D(rr.TEXTURE_2D,Ss,0,0,Ns.width,Ns.height,xs,Es,Ns.data):tr.texImage2D(rr.TEXTURE_2D,Ss,Ps,Ns.width,Ns.height,0,xs,Es,Ns.data);Gi.generateMipmaps=!1}else Us?(Os&&tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,As.width,As.height),ws&&tr.texSubImage2D(rr.TEXTURE_2D,0,0,0,As.width,As.height,xs,Es,As.data)):tr.texImage2D(rr.TEXTURE_2D,0,Ps,As.width,As.height,0,xs,Es,As.data);else if(Gi.isCompressedTexture)if(Gi.isCompressedArrayTexture){Us&&Os&&tr.texStorage3D(rr.TEXTURE_2D_ARRAY,bs,Ps,Vs[0].width,Vs[0].height,As.depth);for(let Ss=0,Rs=Vs.length;Ss<Rs;Ss++)if(Ns=Vs[Ss],Gi.format!==RGBAFormat)if(xs!==null)if(Us){if(ws)if(Gi.layerUpdates.size>0){const Hs=getByteLength(Ns.width,Ns.height,Gi.format,Gi.type);for(const ks of Gi.layerUpdates){const na=Ns.data.subarray(ks*Hs/Ns.data.BYTES_PER_ELEMENT,(ks+1)*Hs/Ns.data.BYTES_PER_ELEMENT);tr.compressedTexSubImage3D(rr.TEXTURE_2D_ARRAY,Ss,0,0,ks,Ns.width,Ns.height,1,xs,na)}Gi.clearLayerUpdates()}else tr.compressedTexSubImage3D(rr.TEXTURE_2D_ARRAY,Ss,0,0,0,Ns.width,Ns.height,As.depth,xs,Ns.data)}else tr.compressedTexImage3D(rr.TEXTURE_2D_ARRAY,Ss,Ps,Ns.width,Ns.height,As.depth,0,Ns.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else Us?ws&&tr.texSubImage3D(rr.TEXTURE_2D_ARRAY,Ss,0,0,0,Ns.width,Ns.height,As.depth,xs,Es,Ns.data):tr.texImage3D(rr.TEXTURE_2D_ARRAY,Ss,Ps,Ns.width,Ns.height,As.depth,0,xs,Es,Ns.data)}else{Us&&Os&&tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,Vs[0].width,Vs[0].height);for(let Ss=0,Rs=Vs.length;Ss<Rs;Ss++)Ns=Vs[Ss],Gi.format!==RGBAFormat?xs!==null?Us?ws&&tr.compressedTexSubImage2D(rr.TEXTURE_2D,Ss,0,0,Ns.width,Ns.height,xs,Ns.data):tr.compressedTexImage2D(rr.TEXTURE_2D,Ss,Ps,Ns.width,Ns.height,0,Ns.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Us?ws&&tr.texSubImage2D(rr.TEXTURE_2D,Ss,0,0,Ns.width,Ns.height,xs,Es,Ns.data):tr.texImage2D(rr.TEXTURE_2D,Ss,Ps,Ns.width,Ns.height,0,xs,Es,Ns.data)}else if(Gi.isDataArrayTexture)if(Us){if(Os&&tr.texStorage3D(rr.TEXTURE_2D_ARRAY,bs,Ps,As.width,As.height,As.depth),ws)if(Gi.layerUpdates.size>0){const Ss=getByteLength(As.width,As.height,Gi.format,Gi.type);for(const Rs of Gi.layerUpdates){const Hs=As.data.subarray(Rs*Ss/As.data.BYTES_PER_ELEMENT,(Rs+1)*Ss/As.data.BYTES_PER_ELEMENT);tr.texSubImage3D(rr.TEXTURE_2D_ARRAY,0,0,0,Rs,As.width,As.height,1,xs,Es,Hs)}Gi.clearLayerUpdates()}else tr.texSubImage3D(rr.TEXTURE_2D_ARRAY,0,0,0,0,As.width,As.height,As.depth,xs,Es,As.data)}else tr.texImage3D(rr.TEXTURE_2D_ARRAY,0,Ps,As.width,As.height,As.depth,0,xs,Es,As.data);else if(Gi.isData3DTexture)Us?(Os&&tr.texStorage3D(rr.TEXTURE_3D,bs,Ps,As.width,As.height,As.depth),ws&&tr.texSubImage3D(rr.TEXTURE_3D,0,0,0,0,As.width,As.height,As.depth,xs,Es,As.data)):tr.texImage3D(rr.TEXTURE_3D,0,Ps,As.width,As.height,As.depth,0,xs,Es,As.data);else if(Gi.isFramebufferTexture){if(Os)if(Us)tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,As.width,As.height);else{let Ss=As.width,Rs=As.height;for(let Hs=0;Hs<bs;Hs++)tr.texImage2D(rr.TEXTURE_2D,Hs,Ps,Ss,Rs,0,xs,Es,null),Ss>>=1,Rs>>=1}}else if(Vs.length>0){if(Us&&Os){const Ss=ms(Vs[0]);tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,Ss.width,Ss.height)}for(let Ss=0,Rs=Vs.length;Ss<Rs;Ss++)Ns=Vs[Ss],Us?ws&&tr.texSubImage2D(rr.TEXTURE_2D,Ss,0,0,xs,Es,Ns):tr.texImage2D(rr.TEXTURE_2D,Ss,Ps,xs,Es,Ns);Gi.generateMipmaps=!1}else if(Us){if(Os){const Ss=ms(As);tr.texStorage2D(rr.TEXTURE_2D,bs,Ps,Ss.width,Ss.height)}ws&&tr.texSubImage2D(rr.TEXTURE_2D,0,0,0,xs,Es,As)}else tr.texImage2D(rr.TEXTURE_2D,0,Ps,xs,Es,As);mr(Gi)&&fr(Ri),us.__version=as.version,Gi.onUpdate&&Gi.onUpdate(Gi)}Yi.__version=Gi.version}function $r(Yi,Gi,Ni){if(Gi.image.length!==6)return;const Ri=Xi(Yi,Gi),qi=Gi.source;tr.bindTexture(rr.TEXTURE_CUBE_MAP,Yi.__webglTexture,rr.TEXTURE0+Ni);const as=ir.get(qi);if(qi.version!==as.__version||Ri===!0){tr.activeTexture(rr.TEXTURE0+Ni);const us=ColorManagement.getPrimaries(ColorManagement.workingColorSpace),gs=Gi.colorSpace===NoColorSpace?null:ColorManagement.getPrimaries(Gi.colorSpace),vs=Gi.colorSpace===NoColorSpace||us===gs?rr.NONE:rr.BROWSER_DEFAULT_WEBGL;rr.pixelStorei(rr.UNPACK_FLIP_Y_WEBGL,Gi.flipY),rr.pixelStorei(rr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Gi.premultiplyAlpha),rr.pixelStorei(rr.UNPACK_ALIGNMENT,Gi.unpackAlignment),rr.pixelStorei(rr.UNPACK_COLORSPACE_CONVERSION_WEBGL,vs);const _s=Gi.isCompressedTexture||Gi.image[0].isCompressedTexture,As=Gi.image[0]&&Gi.image[0].isDataTexture,xs=[];for(let Rs=0;Rs<6;Rs++)!_s&&!As?xs[Rs]=vr(Gi.image[Rs],!0,nr.maxCubemapSize):xs[Rs]=As?Gi.image[Rs].image:Gi.image[Rs],xs[Rs]=es(Gi,xs[Rs]);const Es=xs[0],Ps=sr.convert(Gi.format,Gi.colorSpace),Ns=sr.convert(Gi.type),Vs=Ar(Gi.internalFormat,Ps,Ns,Gi.colorSpace),Us=Gi.isVideoTexture!==!0,Os=as.__version===void 0||Ri===!0,ws=qi.dataReady;let bs=wr(Gi,Es);Qi(rr.TEXTURE_CUBE_MAP,Gi);let Ss;if(_s){Us&&Os&&tr.texStorage2D(rr.TEXTURE_CUBE_MAP,bs,Vs,Es.width,Es.height);for(let Rs=0;Rs<6;Rs++){Ss=xs[Rs].mipmaps;for(let Hs=0;Hs<Ss.length;Hs++){const ks=Ss[Hs];Gi.format!==RGBAFormat?Ps!==null?Us?ws&&tr.compressedTexSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs,0,0,ks.width,ks.height,Ps,ks.data):tr.compressedTexImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs,Vs,ks.width,ks.height,0,ks.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Us?ws&&tr.texSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs,0,0,ks.width,ks.height,Ps,Ns,ks.data):tr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs,Vs,ks.width,ks.height,0,Ps,Ns,ks.data)}}}else{if(Ss=Gi.mipmaps,Us&&Os){Ss.length>0&&bs++;const Rs=ms(xs[0]);tr.texStorage2D(rr.TEXTURE_CUBE_MAP,bs,Vs,Rs.width,Rs.height)}for(let Rs=0;Rs<6;Rs++)if(As){Us?ws&&tr.texSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,0,0,0,xs[Rs].width,xs[Rs].height,Ps,Ns,xs[Rs].data):tr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,0,Vs,xs[Rs].width,xs[Rs].height,0,Ps,Ns,xs[Rs].data);for(let Hs=0;Hs<Ss.length;Hs++){const na=Ss[Hs].image[Rs].image;Us?ws&&tr.texSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs+1,0,0,na.width,na.height,Ps,Ns,na.data):tr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs+1,Vs,na.width,na.height,0,Ps,Ns,na.data)}}else{Us?ws&&tr.texSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,0,0,0,Ps,Ns,xs[Rs]):tr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,0,Vs,Ps,Ns,xs[Rs]);for(let Hs=0;Hs<Ss.length;Hs++){const ks=Ss[Hs];Us?ws&&tr.texSubImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs+1,0,0,Ps,Ns,ks.image[Rs]):tr.texImage2D(rr.TEXTURE_CUBE_MAP_POSITIVE_X+Rs,Hs+1,Vs,Ps,Ns,ks.image[Rs])}}}mr(Gi)&&fr(rr.TEXTURE_CUBE_MAP),as.__version=qi.version,Gi.onUpdate&&Gi.onUpdate(Gi)}Yi.__version=Gi.version}function Vr(Yi,Gi,Ni,Ri,qi,as){const us=sr.convert(Ni.format,Ni.colorSpace),gs=sr.convert(Ni.type),vs=Ar(Ni.internalFormat,us,gs,Ni.colorSpace),_s=ir.get(Gi),As=ir.get(Ni);if(As.__renderTarget=Gi,!_s.__hasExternalTextures){const xs=Math.max(1,Gi.width>>as),Es=Math.max(1,Gi.height>>as);qi===rr.TEXTURE_3D||qi===rr.TEXTURE_2D_ARRAY?tr.texImage3D(qi,as,vs,xs,Es,Gi.depth,0,us,gs,null):tr.texImage2D(qi,as,vs,xs,Es,0,us,gs,null)}tr.bindFramebuffer(rr.FRAMEBUFFER,Yi),cs(Gi)?or.framebufferTexture2DMultisampleEXT(rr.FRAMEBUFFER,Ri,qi,As.__webglTexture,0,os(Gi)):(qi===rr.TEXTURE_2D||qi>=rr.TEXTURE_CUBE_MAP_POSITIVE_X&&qi<=rr.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&rr.framebufferTexture2D(rr.FRAMEBUFFER,Ri,qi,As.__webglTexture,as),tr.bindFramebuffer(rr.FRAMEBUFFER,null)}function Gr(Yi,Gi,Ni){if(rr.bindRenderbuffer(rr.RENDERBUFFER,Yi),Gi.depthBuffer){const Ri=Gi.depthTexture,qi=Ri&&Ri.isDepthTexture?Ri.type:null,as=yr(Gi.stencilBuffer,qi),us=Gi.stencilBuffer?rr.DEPTH_STENCIL_ATTACHMENT:rr.DEPTH_ATTACHMENT,gs=os(Gi);cs(Gi)?or.renderbufferStorageMultisampleEXT(rr.RENDERBUFFER,gs,as,Gi.width,Gi.height):Ni?rr.renderbufferStorageMultisample(rr.RENDERBUFFER,gs,as,Gi.width,Gi.height):rr.renderbufferStorage(rr.RENDERBUFFER,as,Gi.width,Gi.height),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,us,rr.RENDERBUFFER,Yi)}else{const Ri=Gi.textures;for(let qi=0;qi<Ri.length;qi++){const as=Ri[qi],us=sr.convert(as.format,as.colorSpace),gs=sr.convert(as.type),vs=Ar(as.internalFormat,us,gs,as.colorSpace),_s=os(Gi);Ni&&cs(Gi)===!1?rr.renderbufferStorageMultisample(rr.RENDERBUFFER,_s,vs,Gi.width,Gi.height):cs(Gi)?or.renderbufferStorageMultisampleEXT(rr.RENDERBUFFER,_s,vs,Gi.width,Gi.height):rr.renderbufferStorage(rr.RENDERBUFFER,vs,Gi.width,Gi.height)}}rr.bindRenderbuffer(rr.RENDERBUFFER,null)}function qr(Yi,Gi){if(Gi&&Gi.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(tr.bindFramebuffer(rr.FRAMEBUFFER,Yi),!(Gi.depthTexture&&Gi.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ri=ir.get(Gi.depthTexture);Ri.__renderTarget=Gi,(!Ri.__webglTexture||Gi.depthTexture.image.width!==Gi.width||Gi.depthTexture.image.height!==Gi.height)&&(Gi.depthTexture.image.width=Gi.width,Gi.depthTexture.image.height=Gi.height,Gi.depthTexture.needsUpdate=!0),Or(Gi.depthTexture,0);const qi=Ri.__webglTexture,as=os(Gi);if(Gi.depthTexture.format===DepthFormat)cs(Gi)?or.framebufferTexture2DMultisampleEXT(rr.FRAMEBUFFER,rr.DEPTH_ATTACHMENT,rr.TEXTURE_2D,qi,0,as):rr.framebufferTexture2D(rr.FRAMEBUFFER,rr.DEPTH_ATTACHMENT,rr.TEXTURE_2D,qi,0);else if(Gi.depthTexture.format===DepthStencilFormat)cs(Gi)?or.framebufferTexture2DMultisampleEXT(rr.FRAMEBUFFER,rr.DEPTH_STENCIL_ATTACHMENT,rr.TEXTURE_2D,qi,0,as):rr.framebufferTexture2D(rr.FRAMEBUFFER,rr.DEPTH_STENCIL_ATTACHMENT,rr.TEXTURE_2D,qi,0);else throw new Error("Unknown depthTexture format")}function ji(Yi){const Gi=ir.get(Yi),Ni=Yi.isWebGLCubeRenderTarget===!0;if(Gi.__boundDepthTexture!==Yi.depthTexture){const Ri=Yi.depthTexture;if(Gi.__depthDisposeCallback&&Gi.__depthDisposeCallback(),Ri){const qi=()=>{delete Gi.__boundDepthTexture,delete Gi.__depthDisposeCallback,Ri.removeEventListener("dispose",qi)};Ri.addEventListener("dispose",qi),Gi.__depthDisposeCallback=qi}Gi.__boundDepthTexture=Ri}if(Yi.depthTexture&&!Gi.__autoAllocateDepthBuffer){if(Ni)throw new Error("target.depthTexture not supported in Cube render targets");qr(Gi.__webglFramebuffer,Yi)}else if(Ni){Gi.__webglDepthbuffer=[];for(let Ri=0;Ri<6;Ri++)if(tr.bindFramebuffer(rr.FRAMEBUFFER,Gi.__webglFramebuffer[Ri]),Gi.__webglDepthbuffer[Ri]===void 0)Gi.__webglDepthbuffer[Ri]=rr.createRenderbuffer(),Gr(Gi.__webglDepthbuffer[Ri],Yi,!1);else{const qi=Yi.stencilBuffer?rr.DEPTH_STENCIL_ATTACHMENT:rr.DEPTH_ATTACHMENT,as=Gi.__webglDepthbuffer[Ri];rr.bindRenderbuffer(rr.RENDERBUFFER,as),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,qi,rr.RENDERBUFFER,as)}}else if(tr.bindFramebuffer(rr.FRAMEBUFFER,Gi.__webglFramebuffer),Gi.__webglDepthbuffer===void 0)Gi.__webglDepthbuffer=rr.createRenderbuffer(),Gr(Gi.__webglDepthbuffer,Yi,!1);else{const Ri=Yi.stencilBuffer?rr.DEPTH_STENCIL_ATTACHMENT:rr.DEPTH_ATTACHMENT,qi=Gi.__webglDepthbuffer;rr.bindRenderbuffer(rr.RENDERBUFFER,qi),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,Ri,rr.RENDERBUFFER,qi)}tr.bindFramebuffer(rr.FRAMEBUFFER,null)}function Jr(Yi,Gi,Ni){const Ri=ir.get(Yi);Gi!==void 0&&Vr(Ri.__webglFramebuffer,Yi,Yi.texture,rr.COLOR_ATTACHMENT0,rr.TEXTURE_2D,0),Ni!==void 0&&ji(Yi)}function Ji(Yi){const Gi=Yi.texture,Ni=ir.get(Yi),Ri=ir.get(Gi);Yi.addEventListener("dispose",Sr);const qi=Yi.textures,as=Yi.isWebGLCubeRenderTarget===!0,us=qi.length>1;if(us||(Ri.__webglTexture===void 0&&(Ri.__webglTexture=rr.createTexture()),Ri.__version=Gi.version,ar.memory.textures++),as){Ni.__webglFramebuffer=[];for(let gs=0;gs<6;gs++)if(Gi.mipmaps&&Gi.mipmaps.length>0){Ni.__webglFramebuffer[gs]=[];for(let vs=0;vs<Gi.mipmaps.length;vs++)Ni.__webglFramebuffer[gs][vs]=rr.createFramebuffer()}else Ni.__webglFramebuffer[gs]=rr.createFramebuffer()}else{if(Gi.mipmaps&&Gi.mipmaps.length>0){Ni.__webglFramebuffer=[];for(let gs=0;gs<Gi.mipmaps.length;gs++)Ni.__webglFramebuffer[gs]=rr.createFramebuffer()}else Ni.__webglFramebuffer=rr.createFramebuffer();if(us)for(let gs=0,vs=qi.length;gs<vs;gs++){const _s=ir.get(qi[gs]);_s.__webglTexture===void 0&&(_s.__webglTexture=rr.createTexture(),ar.memory.textures++)}if(Yi.samples>0&&cs(Yi)===!1){Ni.__webglMultisampledFramebuffer=rr.createFramebuffer(),Ni.__webglColorRenderbuffer=[],tr.bindFramebuffer(rr.FRAMEBUFFER,Ni.__webglMultisampledFramebuffer);for(let gs=0;gs<qi.length;gs++){const vs=qi[gs];Ni.__webglColorRenderbuffer[gs]=rr.createRenderbuffer(),rr.bindRenderbuffer(rr.RENDERBUFFER,Ni.__webglColorRenderbuffer[gs]);const _s=sr.convert(vs.format,vs.colorSpace),As=sr.convert(vs.type),xs=Ar(vs.internalFormat,_s,As,vs.colorSpace,Yi.isXRRenderTarget===!0),Es=os(Yi);rr.renderbufferStorageMultisample(rr.RENDERBUFFER,Es,xs,Yi.width,Yi.height),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.COLOR_ATTACHMENT0+gs,rr.RENDERBUFFER,Ni.__webglColorRenderbuffer[gs])}rr.bindRenderbuffer(rr.RENDERBUFFER,null),Yi.depthBuffer&&(Ni.__webglDepthRenderbuffer=rr.createRenderbuffer(),Gr(Ni.__webglDepthRenderbuffer,Yi,!0)),tr.bindFramebuffer(rr.FRAMEBUFFER,null)}}if(as){tr.bindTexture(rr.TEXTURE_CUBE_MAP,Ri.__webglTexture),Qi(rr.TEXTURE_CUBE_MAP,Gi);for(let gs=0;gs<6;gs++)if(Gi.mipmaps&&Gi.mipmaps.length>0)for(let vs=0;vs<Gi.mipmaps.length;vs++)Vr(Ni.__webglFramebuffer[gs][vs],Yi,Gi,rr.COLOR_ATTACHMENT0,rr.TEXTURE_CUBE_MAP_POSITIVE_X+gs,vs);else Vr(Ni.__webglFramebuffer[gs],Yi,Gi,rr.COLOR_ATTACHMENT0,rr.TEXTURE_CUBE_MAP_POSITIVE_X+gs,0);mr(Gi)&&fr(rr.TEXTURE_CUBE_MAP),tr.unbindTexture()}else if(us){for(let gs=0,vs=qi.length;gs<vs;gs++){const _s=qi[gs],As=ir.get(_s);tr.bindTexture(rr.TEXTURE_2D,As.__webglTexture),Qi(rr.TEXTURE_2D,_s),Vr(Ni.__webglFramebuffer,Yi,_s,rr.COLOR_ATTACHMENT0+gs,rr.TEXTURE_2D,0),mr(_s)&&fr(rr.TEXTURE_2D)}tr.unbindTexture()}else{let gs=rr.TEXTURE_2D;if((Yi.isWebGL3DRenderTarget||Yi.isWebGLArrayRenderTarget)&&(gs=Yi.isWebGL3DRenderTarget?rr.TEXTURE_3D:rr.TEXTURE_2D_ARRAY),tr.bindTexture(gs,Ri.__webglTexture),Qi(gs,Gi),Gi.mipmaps&&Gi.mipmaps.length>0)for(let vs=0;vs<Gi.mipmaps.length;vs++)Vr(Ni.__webglFramebuffer[vs],Yi,Gi,rr.COLOR_ATTACHMENT0,gs,vs);else Vr(Ni.__webglFramebuffer,Yi,Gi,rr.COLOR_ATTACHMENT0,gs,0);mr(Gi)&&fr(gs),tr.unbindTexture()}Yi.depthBuffer&&ji(Yi)}function Ki(Yi){const Gi=Yi.textures;for(let Ni=0,Ri=Gi.length;Ni<Ri;Ni++){const qi=Gi[Ni];if(mr(qi)){const as=_r(Yi),us=ir.get(qi).__webglTexture;tr.bindTexture(as,us),fr(as),tr.unbindTexture()}}}const Zi=[],Zr=[];function is(Yi){if(Yi.samples>0){if(cs(Yi)===!1){const Gi=Yi.textures,Ni=Yi.width,Ri=Yi.height;let qi=rr.COLOR_BUFFER_BIT;const as=Yi.stencilBuffer?rr.DEPTH_STENCIL_ATTACHMENT:rr.DEPTH_ATTACHMENT,us=ir.get(Yi),gs=Gi.length>1;if(gs)for(let vs=0;vs<Gi.length;vs++)tr.bindFramebuffer(rr.FRAMEBUFFER,us.__webglMultisampledFramebuffer),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.COLOR_ATTACHMENT0+vs,rr.RENDERBUFFER,null),tr.bindFramebuffer(rr.FRAMEBUFFER,us.__webglFramebuffer),rr.framebufferTexture2D(rr.DRAW_FRAMEBUFFER,rr.COLOR_ATTACHMENT0+vs,rr.TEXTURE_2D,null,0);tr.bindFramebuffer(rr.READ_FRAMEBUFFER,us.__webglMultisampledFramebuffer),tr.bindFramebuffer(rr.DRAW_FRAMEBUFFER,us.__webglFramebuffer);for(let vs=0;vs<Gi.length;vs++){if(Yi.resolveDepthBuffer&&(Yi.depthBuffer&&(qi|=rr.DEPTH_BUFFER_BIT),Yi.stencilBuffer&&Yi.resolveStencilBuffer&&(qi|=rr.STENCIL_BUFFER_BIT)),gs){rr.framebufferRenderbuffer(rr.READ_FRAMEBUFFER,rr.COLOR_ATTACHMENT0,rr.RENDERBUFFER,us.__webglColorRenderbuffer[vs]);const _s=ir.get(Gi[vs]).__webglTexture;rr.framebufferTexture2D(rr.DRAW_FRAMEBUFFER,rr.COLOR_ATTACHMENT0,rr.TEXTURE_2D,_s,0)}rr.blitFramebuffer(0,0,Ni,Ri,0,0,Ni,Ri,qi,rr.NEAREST),lr===!0&&(Zi.length=0,Zr.length=0,Zi.push(rr.COLOR_ATTACHMENT0+vs),Yi.depthBuffer&&Yi.resolveDepthBuffer===!1&&(Zi.push(as),Zr.push(as),rr.invalidateFramebuffer(rr.DRAW_FRAMEBUFFER,Zr)),rr.invalidateFramebuffer(rr.READ_FRAMEBUFFER,Zi))}if(tr.bindFramebuffer(rr.READ_FRAMEBUFFER,null),tr.bindFramebuffer(rr.DRAW_FRAMEBUFFER,null),gs)for(let vs=0;vs<Gi.length;vs++){tr.bindFramebuffer(rr.FRAMEBUFFER,us.__webglMultisampledFramebuffer),rr.framebufferRenderbuffer(rr.FRAMEBUFFER,rr.COLOR_ATTACHMENT0+vs,rr.RENDERBUFFER,us.__webglColorRenderbuffer[vs]);const _s=ir.get(Gi[vs]).__webglTexture;tr.bindFramebuffer(rr.FRAMEBUFFER,us.__webglFramebuffer),rr.framebufferTexture2D(rr.DRAW_FRAMEBUFFER,rr.COLOR_ATTACHMENT0+vs,rr.TEXTURE_2D,_s,0)}tr.bindFramebuffer(rr.DRAW_FRAMEBUFFER,us.__webglMultisampledFramebuffer)}else if(Yi.depthBuffer&&Yi.resolveDepthBuffer===!1&&lr){const Gi=Yi.stencilBuffer?rr.DEPTH_STENCIL_ATTACHMENT:rr.DEPTH_ATTACHMENT;rr.invalidateFramebuffer(rr.DRAW_FRAMEBUFFER,[Gi])}}}function os(Yi){return Math.min(nr.maxSamples,Yi.samples)}function cs(Yi){const Gi=ir.get(Yi);return Yi.samples>0&&er.has("WEBGL_multisampled_render_to_texture")===!0&&Gi.__useRenderToTexture!==!1}function ss(Yi){const Gi=ar.render.frame;ur.get(Yi)!==Gi&&(ur.set(Yi,Gi),Yi.update())}function es(Yi,Gi){const Ni=Yi.colorSpace,Ri=Yi.format,qi=Yi.type;return Yi.isCompressedTexture===!0||Yi.isVideoTexture===!0||Ni!==LinearSRGBColorSpace&&Ni!==NoColorSpace&&(ColorManagement.getTransfer(Ni)===SRGBTransfer?(Ri!==RGBAFormat||qi!==UnsignedByteType)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Ni)),Gi}function ms(Yi){return typeof HTMLImageElement<"u"&&Yi instanceof HTMLImageElement?(cr.width=Yi.naturalWidth||Yi.width,cr.height=Yi.naturalHeight||Yi.height):typeof VideoFrame<"u"&&Yi instanceof VideoFrame?(cr.width=Yi.displayWidth,cr.height=Yi.displayHeight):(cr.width=Yi.width,cr.height=Yi.height),cr}this.allocateTextureUnit=Dr,this.resetTextureUnits=Pr,this.setTexture2D=Or,this.setTexture2DArray=Nr,this.setTexture3D=Ur,this.setTextureCube=Br,this.rebindTextures=Jr,this.setupRenderTarget=Ji,this.updateRenderTargetMipmap=Ki,this.updateMultisampleRenderTarget=is,this.setupDepthRenderbuffer=ji,this.setupFrameBufferTexture=Vr,this.useMultisampledRTT=cs}function WebGLUtils(rr,er){function tr(ir,nr=NoColorSpace){let sr;const ar=ColorManagement.getTransfer(nr);if(ir===UnsignedByteType)return rr.UNSIGNED_BYTE;if(ir===UnsignedShort4444Type)return rr.UNSIGNED_SHORT_4_4_4_4;if(ir===UnsignedShort5551Type)return rr.UNSIGNED_SHORT_5_5_5_1;if(ir===UnsignedInt5999Type)return rr.UNSIGNED_INT_5_9_9_9_REV;if(ir===ByteType)return rr.BYTE;if(ir===ShortType)return rr.SHORT;if(ir===UnsignedShortType)return rr.UNSIGNED_SHORT;if(ir===IntType)return rr.INT;if(ir===UnsignedIntType)return rr.UNSIGNED_INT;if(ir===FloatType)return rr.FLOAT;if(ir===HalfFloatType)return rr.HALF_FLOAT;if(ir===AlphaFormat)return rr.ALPHA;if(ir===RGBFormat)return rr.RGB;if(ir===RGBAFormat)return rr.RGBA;if(ir===LuminanceFormat)return rr.LUMINANCE;if(ir===LuminanceAlphaFormat)return rr.LUMINANCE_ALPHA;if(ir===DepthFormat)return rr.DEPTH_COMPONENT;if(ir===DepthStencilFormat)return rr.DEPTH_STENCIL;if(ir===RedFormat)return rr.RED;if(ir===RedIntegerFormat)return rr.RED_INTEGER;if(ir===RGFormat)return rr.RG;if(ir===RGIntegerFormat)return rr.RG_INTEGER;if(ir===RGBAIntegerFormat)return rr.RGBA_INTEGER;if(ir===RGB_S3TC_DXT1_Format||ir===RGBA_S3TC_DXT1_Format||ir===RGBA_S3TC_DXT3_Format||ir===RGBA_S3TC_DXT5_Format)if(ar===SRGBTransfer)if(sr=er.get("WEBGL_compressed_texture_s3tc_srgb"),sr!==null){if(ir===RGB_S3TC_DXT1_Format)return sr.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(ir===RGBA_S3TC_DXT1_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(ir===RGBA_S3TC_DXT3_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(ir===RGBA_S3TC_DXT5_Format)return sr.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(sr=er.get("WEBGL_compressed_texture_s3tc"),sr!==null){if(ir===RGB_S3TC_DXT1_Format)return sr.COMPRESSED_RGB_S3TC_DXT1_EXT;if(ir===RGBA_S3TC_DXT1_Format)return sr.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(ir===RGBA_S3TC_DXT3_Format)return sr.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(ir===RGBA_S3TC_DXT5_Format)return sr.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(ir===RGB_PVRTC_4BPPV1_Format||ir===RGB_PVRTC_2BPPV1_Format||ir===RGBA_PVRTC_4BPPV1_Format||ir===RGBA_PVRTC_2BPPV1_Format)if(sr=er.get("WEBGL_compressed_texture_pvrtc"),sr!==null){if(ir===RGB_PVRTC_4BPPV1_Format)return sr.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(ir===RGB_PVRTC_2BPPV1_Format)return sr.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(ir===RGBA_PVRTC_4BPPV1_Format)return sr.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(ir===RGBA_PVRTC_2BPPV1_Format)return sr.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(ir===RGB_ETC1_Format||ir===RGB_ETC2_Format||ir===RGBA_ETC2_EAC_Format)if(sr=er.get("WEBGL_compressed_texture_etc"),sr!==null){if(ir===RGB_ETC1_Format||ir===RGB_ETC2_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ETC2:sr.COMPRESSED_RGB8_ETC2;if(ir===RGBA_ETC2_EAC_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:sr.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(ir===RGBA_ASTC_4x4_Format||ir===RGBA_ASTC_5x4_Format||ir===RGBA_ASTC_5x5_Format||ir===RGBA_ASTC_6x5_Format||ir===RGBA_ASTC_6x6_Format||ir===RGBA_ASTC_8x5_Format||ir===RGBA_ASTC_8x6_Format||ir===RGBA_ASTC_8x8_Format||ir===RGBA_ASTC_10x5_Format||ir===RGBA_ASTC_10x6_Format||ir===RGBA_ASTC_10x8_Format||ir===RGBA_ASTC_10x10_Format||ir===RGBA_ASTC_12x10_Format||ir===RGBA_ASTC_12x12_Format)if(sr=er.get("WEBGL_compressed_texture_astc"),sr!==null){if(ir===RGBA_ASTC_4x4_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:sr.COMPRESSED_RGBA_ASTC_4x4_KHR;if(ir===RGBA_ASTC_5x4_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:sr.COMPRESSED_RGBA_ASTC_5x4_KHR;if(ir===RGBA_ASTC_5x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:sr.COMPRESSED_RGBA_ASTC_5x5_KHR;if(ir===RGBA_ASTC_6x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:sr.COMPRESSED_RGBA_ASTC_6x5_KHR;if(ir===RGBA_ASTC_6x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:sr.COMPRESSED_RGBA_ASTC_6x6_KHR;if(ir===RGBA_ASTC_8x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:sr.COMPRESSED_RGBA_ASTC_8x5_KHR;if(ir===RGBA_ASTC_8x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:sr.COMPRESSED_RGBA_ASTC_8x6_KHR;if(ir===RGBA_ASTC_8x8_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:sr.COMPRESSED_RGBA_ASTC_8x8_KHR;if(ir===RGBA_ASTC_10x5_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:sr.COMPRESSED_RGBA_ASTC_10x5_KHR;if(ir===RGBA_ASTC_10x6_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:sr.COMPRESSED_RGBA_ASTC_10x6_KHR;if(ir===RGBA_ASTC_10x8_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:sr.COMPRESSED_RGBA_ASTC_10x8_KHR;if(ir===RGBA_ASTC_10x10_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:sr.COMPRESSED_RGBA_ASTC_10x10_KHR;if(ir===RGBA_ASTC_12x10_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:sr.COMPRESSED_RGBA_ASTC_12x10_KHR;if(ir===RGBA_ASTC_12x12_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:sr.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(ir===RGBA_BPTC_Format||ir===RGB_BPTC_SIGNED_Format||ir===RGB_BPTC_UNSIGNED_Format)if(sr=er.get("EXT_texture_compression_bptc"),sr!==null){if(ir===RGBA_BPTC_Format)return ar===SRGBTransfer?sr.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:sr.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(ir===RGB_BPTC_SIGNED_Format)return sr.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(ir===RGB_BPTC_UNSIGNED_Format)return sr.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(ir===RED_RGTC1_Format||ir===SIGNED_RED_RGTC1_Format||ir===RED_GREEN_RGTC2_Format||ir===SIGNED_RED_GREEN_RGTC2_Format)if(sr=er.get("EXT_texture_compression_rgtc"),sr!==null){if(ir===RGBA_BPTC_Format)return sr.COMPRESSED_RED_RGTC1_EXT;if(ir===SIGNED_RED_RGTC1_Format)return sr.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(ir===RED_GREEN_RGTC2_Format)return sr.COMPRESSED_RED_GREEN_RGTC2_EXT;if(ir===SIGNED_RED_GREEN_RGTC2_Format)return sr.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return ir===UnsignedInt248Type?rr.UNSIGNED_INT_24_8:rr[ir]!==void 0?rr[ir]:null}return{convert:tr}}class ArrayCamera extends PerspectiveCamera{constructor(er=[]){super(),this.isArrayCamera=!0,this.cameras=er}}class Group extends Object3D{constructor(){super(),this.isGroup=!0,this.type="Group"}}const _moveEvent={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3$1,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3$1),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3$1,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3$1),this._grip}dispatchEvent(er){return this._targetRay!==null&&this._targetRay.dispatchEvent(er),this._grip!==null&&this._grip.dispatchEvent(er),this._hand!==null&&this._hand.dispatchEvent(er),this}connect(er){if(er&&er.hand){const tr=this._hand;if(tr)for(const ir of er.hand.values())this._getHandJoint(tr,ir)}return this.dispatchEvent({type:"connected",data:er}),this}disconnect(er){return this.dispatchEvent({type:"disconnected",data:er}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(er,tr,ir){let nr=null,sr=null,ar=null;const or=this._targetRay,lr=this._grip,cr=this._hand;if(er&&tr.session.visibilityState!=="visible-blurred"){if(cr&&er.hand){ar=!0;for(const vr of er.hand.values()){const mr=tr.getJointPose(vr,ir),fr=this._getHandJoint(cr,vr);mr!==null&&(fr.matrix.fromArray(mr.transform.matrix),fr.matrix.decompose(fr.position,fr.rotation,fr.scale),fr.matrixWorldNeedsUpdate=!0,fr.jointRadius=mr.radius),fr.visible=mr!==null}const ur=cr.joints["index-finger-tip"],dr=cr.joints["thumb-tip"],hr=ur.position.distanceTo(dr.position),pr=.02,gr=.005;cr.inputState.pinching&&hr>pr+gr?(cr.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:er.handedness,target:this})):!cr.inputState.pinching&&hr<=pr-gr&&(cr.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:er.handedness,target:this}))}else lr!==null&&er.gripSpace&&(sr=tr.getPose(er.gripSpace,ir),sr!==null&&(lr.matrix.fromArray(sr.transform.matrix),lr.matrix.decompose(lr.position,lr.rotation,lr.scale),lr.matrixWorldNeedsUpdate=!0,sr.linearVelocity?(lr.hasLinearVelocity=!0,lr.linearVelocity.copy(sr.linearVelocity)):lr.hasLinearVelocity=!1,sr.angularVelocity?(lr.hasAngularVelocity=!0,lr.angularVelocity.copy(sr.angularVelocity)):lr.hasAngularVelocity=!1));or!==null&&(nr=tr.getPose(er.targetRaySpace,ir),nr===null&&sr!==null&&(nr=sr),nr!==null&&(or.matrix.fromArray(nr.transform.matrix),or.matrix.decompose(or.position,or.rotation,or.scale),or.matrixWorldNeedsUpdate=!0,nr.linearVelocity?(or.hasLinearVelocity=!0,or.linearVelocity.copy(nr.linearVelocity)):or.hasLinearVelocity=!1,nr.angularVelocity?(or.hasAngularVelocity=!0,or.angularVelocity.copy(nr.angularVelocity)):or.hasAngularVelocity=!1,this.dispatchEvent(_moveEvent)))}return or!==null&&(or.visible=nr!==null),lr!==null&&(lr.visible=sr!==null),cr!==null&&(cr.visible=ar!==null),this}_getHandJoint(er,tr){if(er.joints[tr.jointName]===void 0){const ir=new Group;ir.matrixAutoUpdate=!1,ir.visible=!1,er.joints[tr.jointName]=ir,er.add(ir)}return er.joints[tr.jointName]}}const _occlusion_vertex=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,_occlusion_fragment=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WebXRDepthSensing{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(er,tr,ir){if(this.texture===null){const nr=new Texture,sr=er.properties.get(nr);sr.__webglTexture=tr.texture,(tr.depthNear!=ir.depthNear||tr.depthFar!=ir.depthFar)&&(this.depthNear=tr.depthNear,this.depthFar=tr.depthFar),this.texture=nr}}getMesh(er){if(this.texture!==null&&this.mesh===null){const tr=er.cameras[0].viewport,ir=new ShaderMaterial({vertexShader:_occlusion_vertex,fragmentShader:_occlusion_fragment,uniforms:{depthColor:{value:this.texture},depthWidth:{value:tr.z},depthHeight:{value:tr.w}}});this.mesh=new Mesh(new PlaneGeometry(20,20),ir)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class WebXRManager extends EventDispatcher{constructor(er,tr){super();const ir=this;let nr=null,sr=1,ar=null,or="local-floor",lr=1,cr=null,ur=null,dr=null,hr=null,pr=null,gr=null;const vr=new WebXRDepthSensing,mr=tr.getContextAttributes();let fr=null,_r=null;const Ar=[],yr=[],wr=new Vector2;let xr=null;const Sr=new PerspectiveCamera;Sr.viewport=new Vector4;const br=new PerspectiveCamera;br.viewport=new Vector4;const Cr=[Sr,br],Ir=new ArrayCamera;let Rr=null,Pr=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Kr){let $r=Ar[Kr];return $r===void 0&&($r=new WebXRController,Ar[Kr]=$r),$r.getTargetRaySpace()},this.getControllerGrip=function(Kr){let $r=Ar[Kr];return $r===void 0&&($r=new WebXRController,Ar[Kr]=$r),$r.getGripSpace()},this.getHand=function(Kr){let $r=Ar[Kr];return $r===void 0&&($r=new WebXRController,Ar[Kr]=$r),$r.getHandSpace()};function Dr(Kr){const $r=yr.indexOf(Kr.inputSource);if($r===-1)return;const Vr=Ar[$r];Vr!==void 0&&(Vr.update(Kr.inputSource,Kr.frame,cr||ar),Vr.dispatchEvent({type:Kr.type,data:Kr.inputSource}))}function Fr(){nr.removeEventListener("select",Dr),nr.removeEventListener("selectstart",Dr),nr.removeEventListener("selectend",Dr),nr.removeEventListener("squeeze",Dr),nr.removeEventListener("squeezestart",Dr),nr.removeEventListener("squeezeend",Dr),nr.removeEventListener("end",Fr),nr.removeEventListener("inputsourceschange",Or);for(let Kr=0;Kr<Ar.length;Kr++){const $r=yr[Kr];$r!==null&&(yr[Kr]=null,Ar[Kr].disconnect($r))}Rr=null,Pr=null,vr.reset(),er.setRenderTarget(fr),pr=null,hr=null,dr=null,nr=null,_r=null,Xi.stop(),ir.isPresenting=!1,er.setPixelRatio(xr),er.setSize(wr.width,wr.height,!1),ir.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Kr){sr=Kr,ir.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Kr){or=Kr,ir.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return cr||ar},this.setReferenceSpace=function(Kr){cr=Kr},this.getBaseLayer=function(){return hr!==null?hr:pr},this.getBinding=function(){return dr},this.getFrame=function(){return gr},this.getSession=function(){return nr},this.setSession=async function(Kr){if(nr=Kr,nr!==null){if(fr=er.getRenderTarget(),nr.addEventListener("select",Dr),nr.addEventListener("selectstart",Dr),nr.addEventListener("selectend",Dr),nr.addEventListener("squeeze",Dr),nr.addEventListener("squeezestart",Dr),nr.addEventListener("squeezeend",Dr),nr.addEventListener("end",Fr),nr.addEventListener("inputsourceschange",Or),mr.xrCompatible!==!0&&await tr.makeXRCompatible(),xr=er.getPixelRatio(),er.getSize(wr),nr.renderState.layers===void 0){const $r={antialias:mr.antialias,alpha:!0,depth:mr.depth,stencil:mr.stencil,framebufferScaleFactor:sr};pr=new XRWebGLLayer(nr,tr,$r),nr.updateRenderState({baseLayer:pr}),er.setPixelRatio(1),er.setSize(pr.framebufferWidth,pr.framebufferHeight,!1),_r=new WebGLRenderTarget(pr.framebufferWidth,pr.framebufferHeight,{format:RGBAFormat,type:UnsignedByteType,colorSpace:er.outputColorSpace,stencilBuffer:mr.stencil})}else{let $r=null,Vr=null,Gr=null;mr.depth&&(Gr=mr.stencil?tr.DEPTH24_STENCIL8:tr.DEPTH_COMPONENT24,$r=mr.stencil?DepthStencilFormat:DepthFormat,Vr=mr.stencil?UnsignedInt248Type:UnsignedIntType);const qr={colorFormat:tr.RGBA8,depthFormat:Gr,scaleFactor:sr};dr=new XRWebGLBinding(nr,tr),hr=dr.createProjectionLayer(qr),nr.updateRenderState({layers:[hr]}),er.setPixelRatio(1),er.setSize(hr.textureWidth,hr.textureHeight,!1),_r=new WebGLRenderTarget(hr.textureWidth,hr.textureHeight,{format:RGBAFormat,type:UnsignedByteType,depthTexture:new DepthTexture(hr.textureWidth,hr.textureHeight,Vr,void 0,void 0,void 0,void 0,void 0,void 0,$r),stencilBuffer:mr.stencil,colorSpace:er.outputColorSpace,samples:mr.antialias?4:0,resolveDepthBuffer:hr.ignoreDepthValues===!1})}_r.isXRRenderTarget=!0,this.setFoveation(lr),cr=null,ar=await nr.requestReferenceSpace(or),Xi.setContext(nr),Xi.start(),ir.isPresenting=!0,ir.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(nr!==null)return nr.environmentBlendMode},this.getDepthTexture=function(){return vr.getDepthTexture()};function Or(Kr){for(let $r=0;$r<Kr.removed.length;$r++){const Vr=Kr.removed[$r],Gr=yr.indexOf(Vr);Gr>=0&&(yr[Gr]=null,Ar[Gr].disconnect(Vr))}for(let $r=0;$r<Kr.added.length;$r++){const Vr=Kr.added[$r];let Gr=yr.indexOf(Vr);if(Gr===-1){for(let ji=0;ji<Ar.length;ji++)if(ji>=yr.length){yr.push(Vr),Gr=ji;break}else if(yr[ji]===null){yr[ji]=Vr,Gr=ji;break}if(Gr===-1)break}const qr=Ar[Gr];qr&&qr.connect(Vr)}}const Nr=new Vector3$1,Ur=new Vector3$1;function Br(Kr,$r,Vr){Nr.setFromMatrixPosition($r.matrixWorld),Ur.setFromMatrixPosition(Vr.matrixWorld);const Gr=Nr.distanceTo(Ur),qr=$r.projectionMatrix.elements,ji=Vr.projectionMatrix.elements,Jr=qr[14]/(qr[10]-1),Ji=qr[14]/(qr[10]+1),Ki=(qr[9]+1)/qr[5],Zi=(qr[9]-1)/qr[5],Zr=(qr[8]-1)/qr[0],is=(ji[8]+1)/ji[0],os=Jr*Zr,cs=Jr*is,ss=Gr/(-Zr+is),es=ss*-Zr;if($r.matrixWorld.decompose(Kr.position,Kr.quaternion,Kr.scale),Kr.translateX(es),Kr.translateZ(ss),Kr.matrixWorld.compose(Kr.position,Kr.quaternion,Kr.scale),Kr.matrixWorldInverse.copy(Kr.matrixWorld).invert(),qr[10]===-1)Kr.projectionMatrix.copy($r.projectionMatrix),Kr.projectionMatrixInverse.copy($r.projectionMatrixInverse);else{const ms=Jr+ss,Yi=Ji+ss,Gi=os-es,Ni=cs+(Gr-es),Ri=Ki*Ji/Yi*ms,qi=Zi*Ji/Yi*ms;Kr.projectionMatrix.makePerspective(Gi,Ni,Ri,qi,ms,Yi),Kr.projectionMatrixInverse.copy(Kr.projectionMatrix).invert()}}function Wr(Kr,$r){$r===null?Kr.matrixWorld.copy(Kr.matrix):Kr.matrixWorld.multiplyMatrices($r.matrixWorld,Kr.matrix),Kr.matrixWorldInverse.copy(Kr.matrixWorld).invert()}this.updateCamera=function(Kr){if(nr===null)return;let $r=Kr.near,Vr=Kr.far;vr.texture!==null&&(vr.depthNear>0&&($r=vr.depthNear),vr.depthFar>0&&(Vr=vr.depthFar)),Ir.near=br.near=Sr.near=$r,Ir.far=br.far=Sr.far=Vr,(Rr!==Ir.near||Pr!==Ir.far)&&(nr.updateRenderState({depthNear:Ir.near,depthFar:Ir.far}),Rr=Ir.near,Pr=Ir.far),Sr.layers.mask=Kr.layers.mask|2,br.layers.mask=Kr.layers.mask|4,Ir.layers.mask=Sr.layers.mask|br.layers.mask;const Gr=Kr.parent,qr=Ir.cameras;Wr(Ir,Gr);for(let ji=0;ji<qr.length;ji++)Wr(qr[ji],Gr);qr.length===2?Br(Ir,Sr,br):Ir.projectionMatrix.copy(Sr.projectionMatrix),Xr(Kr,Ir,Gr)};function Xr(Kr,$r,Vr){Vr===null?Kr.matrix.copy($r.matrixWorld):(Kr.matrix.copy(Vr.matrixWorld),Kr.matrix.invert(),Kr.matrix.multiply($r.matrixWorld)),Kr.matrix.decompose(Kr.position,Kr.quaternion,Kr.scale),Kr.updateMatrixWorld(!0),Kr.projectionMatrix.copy($r.projectionMatrix),Kr.projectionMatrixInverse.copy($r.projectionMatrixInverse),Kr.isPerspectiveCamera&&(Kr.fov=RAD2DEG*2*Math.atan(1/Kr.projectionMatrix.elements[5]),Kr.zoom=1)}this.getCamera=function(){return Ir},this.getFoveation=function(){if(!(hr===null&&pr===null))return lr},this.setFoveation=function(Kr){lr=Kr,hr!==null&&(hr.fixedFoveation=Kr),pr!==null&&pr.fixedFoveation!==void 0&&(pr.fixedFoveation=Kr)},this.hasDepthSensing=function(){return vr.texture!==null},this.getDepthSensingMesh=function(){return vr.getMesh(Ir)};let Yr=null;function Qi(Kr,$r){if(ur=$r.getViewerPose(cr||ar),gr=$r,ur!==null){const Vr=ur.views;pr!==null&&(er.setRenderTargetFramebuffer(_r,pr.framebuffer),er.setRenderTarget(_r));let Gr=!1;Vr.length!==Ir.cameras.length&&(Ir.cameras.length=0,Gr=!0);for(let ji=0;ji<Vr.length;ji++){const Jr=Vr[ji];let Ji=null;if(pr!==null)Ji=pr.getViewport(Jr);else{const Zi=dr.getViewSubImage(hr,Jr);Ji=Zi.viewport,ji===0&&(er.setRenderTargetTextures(_r,Zi.colorTexture,hr.ignoreDepthValues?void 0:Zi.depthStencilTexture),er.setRenderTarget(_r))}let Ki=Cr[ji];Ki===void 0&&(Ki=new PerspectiveCamera,Ki.layers.enable(ji),Ki.viewport=new Vector4,Cr[ji]=Ki),Ki.matrix.fromArray(Jr.transform.matrix),Ki.matrix.decompose(Ki.position,Ki.quaternion,Ki.scale),Ki.projectionMatrix.fromArray(Jr.projectionMatrix),Ki.projectionMatrixInverse.copy(Ki.projectionMatrix).invert(),Ki.viewport.set(Ji.x,Ji.y,Ji.width,Ji.height),ji===0&&(Ir.matrix.copy(Ki.matrix),Ir.matrix.decompose(Ir.position,Ir.quaternion,Ir.scale)),Gr===!0&&Ir.cameras.push(Ki)}const qr=nr.enabledFeatures;if(qr&&qr.includes("depth-sensing")){const ji=dr.getDepthInformation(Vr[0]);ji&&ji.isValid&&ji.texture&&vr.init(er,ji,nr.renderState)}}for(let Vr=0;Vr<Ar.length;Vr++){const Gr=yr[Vr],qr=Ar[Vr];Gr!==null&&qr!==void 0&&qr.update(Gr,$r,cr||ar)}Yr&&Yr(Kr,$r),$r.detectedPlanes&&ir.dispatchEvent({type:"planesdetected",data:$r}),gr=null}const Xi=new WebGLAnimation;Xi.setAnimationLoop(Qi),this.setAnimationLoop=function(Kr){Yr=Kr},this.dispose=function(){}}}const _e1=new Euler,_m1=new Matrix4;function WebGLMaterials(rr,er){function tr(mr,fr){mr.matrixAutoUpdate===!0&&mr.updateMatrix(),fr.value.copy(mr.matrix)}function ir(mr,fr){fr.color.getRGB(mr.fogColor.value,getUnlitUniformColorSpace(rr)),fr.isFog?(mr.fogNear.value=fr.near,mr.fogFar.value=fr.far):fr.isFogExp2&&(mr.fogDensity.value=fr.density)}function nr(mr,fr,_r,Ar,yr){fr.isMeshBasicMaterial||fr.isMeshLambertMaterial?sr(mr,fr):fr.isMeshToonMaterial?(sr(mr,fr),dr(mr,fr)):fr.isMeshPhongMaterial?(sr(mr,fr),ur(mr,fr)):fr.isMeshStandardMaterial?(sr(mr,fr),hr(mr,fr),fr.isMeshPhysicalMaterial&&pr(mr,fr,yr)):fr.isMeshMatcapMaterial?(sr(mr,fr),gr(mr,fr)):fr.isMeshDepthMaterial?sr(mr,fr):fr.isMeshDistanceMaterial?(sr(mr,fr),vr(mr,fr)):fr.isMeshNormalMaterial?sr(mr,fr):fr.isLineBasicMaterial?(ar(mr,fr),fr.isLineDashedMaterial&&or(mr,fr)):fr.isPointsMaterial?lr(mr,fr,_r,Ar):fr.isSpriteMaterial?cr(mr,fr):fr.isShadowMaterial?(mr.color.value.copy(fr.color),mr.opacity.value=fr.opacity):fr.isShaderMaterial&&(fr.uniformsNeedUpdate=!1)}function sr(mr,fr){mr.opacity.value=fr.opacity,fr.color&&mr.diffuse.value.copy(fr.color),fr.emissive&&mr.emissive.value.copy(fr.emissive).multiplyScalar(fr.emissiveIntensity),fr.map&&(mr.map.value=fr.map,tr(fr.map,mr.mapTransform)),fr.alphaMap&&(mr.alphaMap.value=fr.alphaMap,tr(fr.alphaMap,mr.alphaMapTransform)),fr.bumpMap&&(mr.bumpMap.value=fr.bumpMap,tr(fr.bumpMap,mr.bumpMapTransform),mr.bumpScale.value=fr.bumpScale,fr.side===BackSide&&(mr.bumpScale.value*=-1)),fr.normalMap&&(mr.normalMap.value=fr.normalMap,tr(fr.normalMap,mr.normalMapTransform),mr.normalScale.value.copy(fr.normalScale),fr.side===BackSide&&mr.normalScale.value.negate()),fr.displacementMap&&(mr.displacementMap.value=fr.displacementMap,tr(fr.displacementMap,mr.displacementMapTransform),mr.displacementScale.value=fr.displacementScale,mr.displacementBias.value=fr.displacementBias),fr.emissiveMap&&(mr.emissiveMap.value=fr.emissiveMap,tr(fr.emissiveMap,mr.emissiveMapTransform)),fr.specularMap&&(mr.specularMap.value=fr.specularMap,tr(fr.specularMap,mr.specularMapTransform)),fr.alphaTest>0&&(mr.alphaTest.value=fr.alphaTest);const _r=er.get(fr),Ar=_r.envMap,yr=_r.envMapRotation;Ar&&(mr.envMap.value=Ar,_e1.copy(yr),_e1.x*=-1,_e1.y*=-1,_e1.z*=-1,Ar.isCubeTexture&&Ar.isRenderTargetTexture===!1&&(_e1.y*=-1,_e1.z*=-1),mr.envMapRotation.value.setFromMatrix4(_m1.makeRotationFromEuler(_e1)),mr.flipEnvMap.value=Ar.isCubeTexture&&Ar.isRenderTargetTexture===!1?-1:1,mr.reflectivity.value=fr.reflectivity,mr.ior.value=fr.ior,mr.refractionRatio.value=fr.refractionRatio),fr.lightMap&&(mr.lightMap.value=fr.lightMap,mr.lightMapIntensity.value=fr.lightMapIntensity,tr(fr.lightMap,mr.lightMapTransform)),fr.aoMap&&(mr.aoMap.value=fr.aoMap,mr.aoMapIntensity.value=fr.aoMapIntensity,tr(fr.aoMap,mr.aoMapTransform))}function ar(mr,fr){mr.diffuse.value.copy(fr.color),mr.opacity.value=fr.opacity,fr.map&&(mr.map.value=fr.map,tr(fr.map,mr.mapTransform))}function or(mr,fr){mr.dashSize.value=fr.dashSize,mr.totalSize.value=fr.dashSize+fr.gapSize,mr.scale.value=fr.scale}function lr(mr,fr,_r,Ar){mr.diffuse.value.copy(fr.color),mr.opacity.value=fr.opacity,mr.size.value=fr.size*_r,mr.scale.value=Ar*.5,fr.map&&(mr.map.value=fr.map,tr(fr.map,mr.uvTransform)),fr.alphaMap&&(mr.alphaMap.value=fr.alphaMap,tr(fr.alphaMap,mr.alphaMapTransform)),fr.alphaTest>0&&(mr.alphaTest.value=fr.alphaTest)}function cr(mr,fr){mr.diffuse.value.copy(fr.color),mr.opacity.value=fr.opacity,mr.rotation.value=fr.rotation,fr.map&&(mr.map.value=fr.map,tr(fr.map,mr.mapTransform)),fr.alphaMap&&(mr.alphaMap.value=fr.alphaMap,tr(fr.alphaMap,mr.alphaMapTransform)),fr.alphaTest>0&&(mr.alphaTest.value=fr.alphaTest)}function ur(mr,fr){mr.specular.value.copy(fr.specular),mr.shininess.value=Math.max(fr.shininess,1e-4)}function dr(mr,fr){fr.gradientMap&&(mr.gradientMap.value=fr.gradientMap)}function hr(mr,fr){mr.metalness.value=fr.metalness,fr.metalnessMap&&(mr.metalnessMap.value=fr.metalnessMap,tr(fr.metalnessMap,mr.metalnessMapTransform)),mr.roughness.value=fr.roughness,fr.roughnessMap&&(mr.roughnessMap.value=fr.roughnessMap,tr(fr.roughnessMap,mr.roughnessMapTransform)),fr.envMap&&(mr.envMapIntensity.value=fr.envMapIntensity)}function pr(mr,fr,_r){mr.ior.value=fr.ior,fr.sheen>0&&(mr.sheenColor.value.copy(fr.sheenColor).multiplyScalar(fr.sheen),mr.sheenRoughness.value=fr.sheenRoughness,fr.sheenColorMap&&(mr.sheenColorMap.value=fr.sheenColorMap,tr(fr.sheenColorMap,mr.sheenColorMapTransform)),fr.sheenRoughnessMap&&(mr.sheenRoughnessMap.value=fr.sheenRoughnessMap,tr(fr.sheenRoughnessMap,mr.sheenRoughnessMapTransform))),fr.clearcoat>0&&(mr.clearcoat.value=fr.clearcoat,mr.clearcoatRoughness.value=fr.clearcoatRoughness,fr.clearcoatMap&&(mr.clearcoatMap.value=fr.clearcoatMap,tr(fr.clearcoatMap,mr.clearcoatMapTransform)),fr.clearcoatRoughnessMap&&(mr.clearcoatRoughnessMap.value=fr.clearcoatRoughnessMap,tr(fr.clearcoatRoughnessMap,mr.clearcoatRoughnessMapTransform)),fr.clearcoatNormalMap&&(mr.clearcoatNormalMap.value=fr.clearcoatNormalMap,tr(fr.clearcoatNormalMap,mr.clearcoatNormalMapTransform),mr.clearcoatNormalScale.value.copy(fr.clearcoatNormalScale),fr.side===BackSide&&mr.clearcoatNormalScale.value.negate())),fr.dispersion>0&&(mr.dispersion.value=fr.dispersion),fr.iridescence>0&&(mr.iridescence.value=fr.iridescence,mr.iridescenceIOR.value=fr.iridescenceIOR,mr.iridescenceThicknessMinimum.value=fr.iridescenceThicknessRange[0],mr.iridescenceThicknessMaximum.value=fr.iridescenceThicknessRange[1],fr.iridescenceMap&&(mr.iridescenceMap.value=fr.iridescenceMap,tr(fr.iridescenceMap,mr.iridescenceMapTransform)),fr.iridescenceThicknessMap&&(mr.iridescenceThicknessMap.value=fr.iridescenceThicknessMap,tr(fr.iridescenceThicknessMap,mr.iridescenceThicknessMapTransform))),fr.transmission>0&&(mr.transmission.value=fr.transmission,mr.transmissionSamplerMap.value=_r.texture,mr.transmissionSamplerSize.value.set(_r.width,_r.height),fr.transmissionMap&&(mr.transmissionMap.value=fr.transmissionMap,tr(fr.transmissionMap,mr.transmissionMapTransform)),mr.thickness.value=fr.thickness,fr.thicknessMap&&(mr.thicknessMap.value=fr.thicknessMap,tr(fr.thicknessMap,mr.thicknessMapTransform)),mr.attenuationDistance.value=fr.attenuationDistance,mr.attenuationColor.value.copy(fr.attenuationColor)),fr.anisotropy>0&&(mr.anisotropyVector.value.set(fr.anisotropy*Math.cos(fr.anisotropyRotation),fr.anisotropy*Math.sin(fr.anisotropyRotation)),fr.anisotropyMap&&(mr.anisotropyMap.value=fr.anisotropyMap,tr(fr.anisotropyMap,mr.anisotropyMapTransform))),mr.specularIntensity.value=fr.specularIntensity,mr.specularColor.value.copy(fr.specularColor),fr.specularColorMap&&(mr.specularColorMap.value=fr.specularColorMap,tr(fr.specularColorMap,mr.specularColorMapTransform)),fr.specularIntensityMap&&(mr.specularIntensityMap.value=fr.specularIntensityMap,tr(fr.specularIntensityMap,mr.specularIntensityMapTransform))}function gr(mr,fr){fr.matcap&&(mr.matcap.value=fr.matcap)}function vr(mr,fr){const _r=er.get(fr).light;mr.referencePosition.value.setFromMatrixPosition(_r.matrixWorld),mr.nearDistance.value=_r.shadow.camera.near,mr.farDistance.value=_r.shadow.camera.far}return{refreshFogUniforms:ir,refreshMaterialUniforms:nr}}function WebGLUniformsGroups(rr,er,tr,ir){let nr={},sr={},ar=[];const or=rr.getParameter(rr.MAX_UNIFORM_BUFFER_BINDINGS);function lr(_r,Ar){const yr=Ar.program;ir.uniformBlockBinding(_r,yr)}function cr(_r,Ar){let yr=nr[_r.id];yr===void 0&&(gr(_r),yr=ur(_r),nr[_r.id]=yr,_r.addEventListener("dispose",mr));const wr=Ar.program;ir.updateUBOMapping(_r,wr);const xr=er.render.frame;sr[_r.id]!==xr&&(hr(_r),sr[_r.id]=xr)}function ur(_r){const Ar=dr();_r.__bindingPointIndex=Ar;const yr=rr.createBuffer(),wr=_r.__size,xr=_r.usage;return rr.bindBuffer(rr.UNIFORM_BUFFER,yr),rr.bufferData(rr.UNIFORM_BUFFER,wr,xr),rr.bindBuffer(rr.UNIFORM_BUFFER,null),rr.bindBufferBase(rr.UNIFORM_BUFFER,Ar,yr),yr}function dr(){for(let _r=0;_r<or;_r++)if(ar.indexOf(_r)===-1)return ar.push(_r),_r;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function hr(_r){const Ar=nr[_r.id],yr=_r.uniforms,wr=_r.__cache;rr.bindBuffer(rr.UNIFORM_BUFFER,Ar);for(let xr=0,Sr=yr.length;xr<Sr;xr++){const br=Array.isArray(yr[xr])?yr[xr]:[yr[xr]];for(let Cr=0,Ir=br.length;Cr<Ir;Cr++){const Rr=br[Cr];if(pr(Rr,xr,Cr,wr)===!0){const Pr=Rr.__offset,Dr=Array.isArray(Rr.value)?Rr.value:[Rr.value];let Fr=0;for(let Or=0;Or<Dr.length;Or++){const Nr=Dr[Or],Ur=vr(Nr);typeof Nr=="number"||typeof Nr=="boolean"?(Rr.__data[0]=Nr,rr.bufferSubData(rr.UNIFORM_BUFFER,Pr+Fr,Rr.__data)):Nr.isMatrix3?(Rr.__data[0]=Nr.elements[0],Rr.__data[1]=Nr.elements[1],Rr.__data[2]=Nr.elements[2],Rr.__data[3]=0,Rr.__data[4]=Nr.elements[3],Rr.__data[5]=Nr.elements[4],Rr.__data[6]=Nr.elements[5],Rr.__data[7]=0,Rr.__data[8]=Nr.elements[6],Rr.__data[9]=Nr.elements[7],Rr.__data[10]=Nr.elements[8],Rr.__data[11]=0):(Nr.toArray(Rr.__data,Fr),Fr+=Ur.storage/Float32Array.BYTES_PER_ELEMENT)}rr.bufferSubData(rr.UNIFORM_BUFFER,Pr,Rr.__data)}}}rr.bindBuffer(rr.UNIFORM_BUFFER,null)}function pr(_r,Ar,yr,wr){const xr=_r.value,Sr=Ar+"_"+yr;if(wr[Sr]===void 0)return typeof xr=="number"||typeof xr=="boolean"?wr[Sr]=xr:wr[Sr]=xr.clone(),!0;{const br=wr[Sr];if(typeof xr=="number"||typeof xr=="boolean"){if(br!==xr)return wr[Sr]=xr,!0}else if(br.equals(xr)===!1)return br.copy(xr),!0}return!1}function gr(_r){const Ar=_r.uniforms;let yr=0;const wr=16;for(let Sr=0,br=Ar.length;Sr<br;Sr++){const Cr=Array.isArray(Ar[Sr])?Ar[Sr]:[Ar[Sr]];for(let Ir=0,Rr=Cr.length;Ir<Rr;Ir++){const Pr=Cr[Ir],Dr=Array.isArray(Pr.value)?Pr.value:[Pr.value];for(let Fr=0,Or=Dr.length;Fr<Or;Fr++){const Nr=Dr[Fr],Ur=vr(Nr),Br=yr%wr,Wr=Br%Ur.boundary,Xr=Br+Wr;yr+=Wr,Xr!==0&&wr-Xr<Ur.storage&&(yr+=wr-Xr),Pr.__data=new Float32Array(Ur.storage/Float32Array.BYTES_PER_ELEMENT),Pr.__offset=yr,yr+=Ur.storage}}}const xr=yr%wr;return xr>0&&(yr+=wr-xr),_r.__size=yr,_r.__cache={},this}function vr(_r){const Ar={boundary:0,storage:0};return typeof _r=="number"||typeof _r=="boolean"?(Ar.boundary=4,Ar.storage=4):_r.isVector2?(Ar.boundary=8,Ar.storage=8):_r.isVector3||_r.isColor?(Ar.boundary=16,Ar.storage=12):_r.isVector4?(Ar.boundary=16,Ar.storage=16):_r.isMatrix3?(Ar.boundary=48,Ar.storage=48):_r.isMatrix4?(Ar.boundary=64,Ar.storage=64):_r.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_r),Ar}function mr(_r){const Ar=_r.target;Ar.removeEventListener("dispose",mr);const yr=ar.indexOf(Ar.__bindingPointIndex);ar.splice(yr,1),rr.deleteBuffer(nr[Ar.id]),delete nr[Ar.id],delete sr[Ar.id]}function fr(){for(const _r in nr)rr.deleteBuffer(nr[_r]);ar=[],nr={},sr={}}return{bind:lr,update:cr,dispose:fr}}class WebGLRenderer{constructor(er={}){const{canvas:tr=createCanvasElement(),context:ir=null,depth:nr=!0,stencil:sr=!1,alpha:ar=!1,antialias:or=!1,premultipliedAlpha:lr=!0,preserveDrawingBuffer:cr=!1,powerPreference:ur="default",failIfMajorPerformanceCaveat:dr=!1,reverseDepthBuffer:hr=!1}=er;this.isWebGLRenderer=!0;let pr;if(ir!==null){if(typeof WebGLRenderingContext<"u"&&ir instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");pr=ir.getContextAttributes().alpha}else pr=ar;const gr=new Uint32Array(4),vr=new Int32Array(4);let mr=null,fr=null;const _r=[],Ar=[];this.domElement=tr,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=SRGBColorSpace,this.toneMapping=NoToneMapping,this.toneMappingExposure=1;const yr=this;let wr=!1,xr=0,Sr=0,br=null,Cr=-1,Ir=null;const Rr=new Vector4,Pr=new Vector4;let Dr=null;const Fr=new Color(0);let Or=0,Nr=tr.width,Ur=tr.height,Br=1,Wr=null,Xr=null;const Yr=new Vector4(0,0,Nr,Ur),Qi=new Vector4(0,0,Nr,Ur);let Xi=!1;const Kr=new Frustum;let $r=!1,Vr=!1;const Gr=new Matrix4,qr=new Matrix4,ji=new Vector3$1,Jr=new Vector4,Ji={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Ki=!1;function Zi(){return br===null?Br:1}let Zr=ir;function is(Qr,$i){return tr.getContext(Qr,$i)}try{const Qr={alpha:!0,depth:nr,stencil:sr,antialias:or,premultipliedAlpha:lr,preserveDrawingBuffer:cr,powerPreference:ur,failIfMajorPerformanceCaveat:dr};if("setAttribute"in tr&&tr.setAttribute("data-engine",`three.js r${REVISION}`),tr.addEventListener("webglcontextlost",Rs,!1),tr.addEventListener("webglcontextrestored",Hs,!1),tr.addEventListener("webglcontextcreationerror",ks,!1),Zr===null){const $i="webgl2";if(Zr=is($i,Qr),Zr===null)throw is($i)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(Qr){throw console.error("THREE.WebGLRenderer: "+Qr.message),Qr}let os,cs,ss,es,ms,Yi,Gi,Ni,Ri,qi,as,us,gs,vs,_s,As,xs,Es,Ps,Ns,Vs,Us,Os,ws;function bs(){os=new WebGLExtensions(Zr),os.init(),Us=new WebGLUtils(Zr,os),cs=new WebGLCapabilities(Zr,os,er,Us),ss=new WebGLState(Zr,os),cs.reverseDepthBuffer&&hr&&ss.buffers.depth.setReversed(!0),es=new WebGLInfo(Zr),ms=new WebGLProperties,Yi=new WebGLTextures(Zr,os,ss,ms,cs,Us,es),Gi=new WebGLCubeMaps(yr),Ni=new WebGLCubeUVMaps(yr),Ri=new WebGLAttributes(Zr),Os=new WebGLBindingStates(Zr,Ri),qi=new WebGLGeometries(Zr,Ri,es,Os),as=new WebGLObjects(Zr,qi,Ri,es),Ps=new WebGLMorphtargets(Zr,cs,Yi),As=new WebGLClipping(ms),us=new WebGLPrograms(yr,Gi,Ni,os,cs,Os,As),gs=new WebGLMaterials(yr,ms),vs=new WebGLRenderLists,_s=new WebGLRenderStates(os),Es=new WebGLBackground(yr,Gi,Ni,ss,as,pr,lr),xs=new WebGLShadowMap(yr,as,cs),ws=new WebGLUniformsGroups(Zr,es,cs,ss),Ns=new WebGLBufferRenderer(Zr,os,es),Vs=new WebGLIndexedBufferRenderer(Zr,os,es),es.programs=us.programs,yr.capabilities=cs,yr.extensions=os,yr.properties=ms,yr.renderLists=vs,yr.shadowMap=xs,yr.state=ss,yr.info=es}bs();const Ss=new WebXRManager(yr,Zr);this.xr=Ss,this.getContext=function(){return Zr},this.getContextAttributes=function(){return Zr.getContextAttributes()},this.forceContextLoss=function(){const Qr=os.get("WEBGL_lose_context");Qr&&Qr.loseContext()},this.forceContextRestore=function(){const Qr=os.get("WEBGL_lose_context");Qr&&Qr.restoreContext()},this.getPixelRatio=function(){return Br},this.setPixelRatio=function(Qr){Qr!==void 0&&(Br=Qr,this.setSize(Nr,Ur,!1))},this.getSize=function(Qr){return Qr.set(Nr,Ur)},this.setSize=function(Qr,$i,ns=!0){if(Ss.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}Nr=Qr,Ur=$i,tr.width=Math.floor(Qr*Br),tr.height=Math.floor($i*Br),ns===!0&&(tr.style.width=Qr+"px",tr.style.height=$i+"px"),this.setViewport(0,0,Qr,$i)},this.getDrawingBufferSize=function(Qr){return Qr.set(Nr*Br,Ur*Br).floor()},this.setDrawingBufferSize=function(Qr,$i,ns){Nr=Qr,Ur=$i,Br=ns,tr.width=Math.floor(Qr*ns),tr.height=Math.floor($i*ns),this.setViewport(0,0,Qr,$i)},this.getCurrentViewport=function(Qr){return Qr.copy(Rr)},this.getViewport=function(Qr){return Qr.copy(Yr)},this.setViewport=function(Qr,$i,ns,ds){Qr.isVector4?Yr.set(Qr.x,Qr.y,Qr.z,Qr.w):Yr.set(Qr,$i,ns,ds),ss.viewport(Rr.copy(Yr).multiplyScalar(Br).round())},this.getScissor=function(Qr){return Qr.copy(Qi)},this.setScissor=function(Qr,$i,ns,ds){Qr.isVector4?Qi.set(Qr.x,Qr.y,Qr.z,Qr.w):Qi.set(Qr,$i,ns,ds),ss.scissor(Pr.copy(Qi).multiplyScalar(Br).round())},this.getScissorTest=function(){return Xi},this.setScissorTest=function(Qr){ss.setScissorTest(Xi=Qr)},this.setOpaqueSort=function(Qr){Wr=Qr},this.setTransparentSort=function(Qr){Xr=Qr},this.getClearColor=function(Qr){return Qr.copy(Es.getClearColor())},this.setClearColor=function(){Es.setClearColor.apply(Es,arguments)},this.getClearAlpha=function(){return Es.getClearAlpha()},this.setClearAlpha=function(){Es.setClearAlpha.apply(Es,arguments)},this.clear=function(Qr=!0,$i=!0,ns=!0){let ds=0;if(Qr){let ps=!1;if(br!==null){const ys=br.texture.format;ps=ys===RGBAIntegerFormat||ys===RGIntegerFormat||ys===RedIntegerFormat}if(ps){const ys=br.texture.type,Ts=ys===UnsignedByteType||ys===UnsignedIntType||ys===UnsignedShortType||ys===UnsignedInt248Type||ys===UnsignedShort4444Type||ys===UnsignedShort5551Type,Ds=Es.getClearColor(),Ms=Es.getClearAlpha(),Cs=Ds.r,Is=Ds.g,Fs=Ds.b;Ts?(gr[0]=Cs,gr[1]=Is,gr[2]=Fs,gr[3]=Ms,Zr.clearBufferuiv(Zr.COLOR,0,gr)):(vr[0]=Cs,vr[1]=Is,vr[2]=Fs,vr[3]=Ms,Zr.clearBufferiv(Zr.COLOR,0,vr))}else ds|=Zr.COLOR_BUFFER_BIT}$i&&(ds|=Zr.DEPTH_BUFFER_BIT),ns&&(ds|=Zr.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Zr.clear(ds)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){tr.removeEventListener("webglcontextlost",Rs,!1),tr.removeEventListener("webglcontextrestored",Hs,!1),tr.removeEventListener("webglcontextcreationerror",ks,!1),vs.dispose(),_s.dispose(),ms.dispose(),Gi.dispose(),Ni.dispose(),as.dispose(),Os.dispose(),ws.dispose(),us.dispose(),Ss.dispose(),Ss.removeEventListener("sessionstart",Js),Ss.removeEventListener("sessionend",aa),Ta.stop()};function Rs(Qr){Qr.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),wr=!0}function Hs(){console.log("THREE.WebGLRenderer: Context Restored."),wr=!1;const Qr=es.autoReset,$i=xs.enabled,ns=xs.autoUpdate,ds=xs.needsUpdate,ps=xs.type;bs(),es.autoReset=Qr,xs.enabled=$i,xs.autoUpdate=ns,xs.needsUpdate=ds,xs.type=ps}function ks(Qr){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Qr.statusMessage)}function na(Qr){const $i=Qr.target;$i.removeEventListener("dispose",na),xa($i)}function xa(Qr){fa(Qr),ms.remove(Qr)}function fa(Qr){const $i=ms.get(Qr).programs;$i!==void 0&&($i.forEach(function(ns){us.releaseProgram(ns)}),Qr.isShaderMaterial&&us.releaseShaderCache(Qr))}this.renderBufferDirect=function(Qr,$i,ns,ds,ps,ys){$i===null&&($i=Ji);const Ts=ps.isMesh&&ps.matrixWorld.determinant()<0,Ds=no(Qr,$i,ns,ds,ps);ss.setMaterial(ds,Ts);let Ms=ns.index,Cs=1;if(ds.wireframe===!0){if(Ms=qi.getWireframeAttribute(ns),Ms===void 0)return;Cs=2}const Is=ns.drawRange,Fs=ns.attributes.position;let Ws=Is.start*Cs,js=(Is.start+Is.count)*Cs;ys!==null&&(Ws=Math.max(Ws,ys.start*Cs),js=Math.min(js,(ys.start+ys.count)*Cs)),Ms!==null?(Ws=Math.max(Ws,0),js=Math.min(js,Ms.count)):Fs!=null&&(Ws=Math.max(Ws,0),js=Math.min(js,Fs.count));const qs=js-Ws;if(qs<0||qs===1/0)return;Os.setup(ps,ds,Ds,ns,Ms);let Xs,$s=Ns;if(Ms!==null&&(Xs=Ri.get(Ms),$s=Vs,$s.setIndex(Xs)),ps.isMesh)ds.wireframe===!0?(ss.setLineWidth(ds.wireframeLinewidth*Zi()),$s.setMode(Zr.LINES)):$s.setMode(Zr.TRIANGLES);else if(ps.isLine){let zs=ds.linewidth;zs===void 0&&(zs=1),ss.setLineWidth(zs*Zi()),ps.isLineSegments?$s.setMode(Zr.LINES):ps.isLineLoop?$s.setMode(Zr.LINE_LOOP):$s.setMode(Zr.LINE_STRIP)}else ps.isPoints?$s.setMode(Zr.POINTS):ps.isSprite&&$s.setMode(Zr.TRIANGLES);if(ps.isBatchedMesh)if(ps._multiDrawInstances!==null)$s.renderMultiDrawInstances(ps._multiDrawStarts,ps._multiDrawCounts,ps._multiDrawCount,ps._multiDrawInstances);else if(os.get("WEBGL_multi_draw"))$s.renderMultiDraw(ps._multiDrawStarts,ps._multiDrawCounts,ps._multiDrawCount);else{const zs=ps._multiDrawStarts,Sa=ps._multiDrawCounts,ma=ps._multiDrawCount,Oa=Ms?Ri.get(Ms).bytesPerElement:1,Ma=ms.get(ds).currentProgram.getUniforms();for(let ya=0;ya<ma;ya++)Ma.setValue(Zr,"_gl_DrawID",ya),$s.render(zs[ya]/Oa,Sa[ya])}else if(ps.isInstancedMesh)$s.renderInstances(Ws,qs,ps.count);else if(ns.isInstancedBufferGeometry){const zs=ns._maxInstanceCount!==void 0?ns._maxInstanceCount:1/0,Sa=Math.min(ns.instanceCount,zs);$s.renderInstances(Ws,qs,Sa)}else $s.render(Ws,qs)};function Gs(Qr,$i,ns){Qr.transparent===!0&&Qr.side===DoubleSide&&Qr.forceSinglePass===!1?(Qr.side=BackSide,Qr.needsUpdate=!0,Xa(Qr,$i,ns),Qr.side=FrontSide,Qr.needsUpdate=!0,Xa(Qr,$i,ns),Qr.side=DoubleSide):Xa(Qr,$i,ns)}this.compile=function(Qr,$i,ns=null){ns===null&&(ns=Qr),fr=_s.get(ns),fr.init($i),Ar.push(fr),ns.traverseVisible(function(ps){ps.isLight&&ps.layers.test($i.layers)&&(fr.pushLight(ps),ps.castShadow&&fr.pushShadow(ps))}),Qr!==ns&&Qr.traverseVisible(function(ps){ps.isLight&&ps.layers.test($i.layers)&&(fr.pushLight(ps),ps.castShadow&&fr.pushShadow(ps))}),fr.setupLights();const ds=new Set;return Qr.traverse(function(ps){if(!(ps.isMesh||ps.isPoints||ps.isLine||ps.isSprite))return;const ys=ps.material;if(ys)if(Array.isArray(ys))for(let Ts=0;Ts<ys.length;Ts++){const Ds=ys[Ts];Gs(Ds,ns,ps),ds.add(Ds)}else Gs(ys,ns,ps),ds.add(ys)}),Ar.pop(),fr=null,ds},this.compileAsync=function(Qr,$i,ns=null){const ds=this.compile(Qr,$i,ns);return new Promise(ps=>{function ys(){if(ds.forEach(function(Ts){ms.get(Ts).currentProgram.isReady()&&ds.delete(Ts)}),ds.size===0){ps(Qr);return}setTimeout(ys,10)}os.get("KHR_parallel_shader_compile")!==null?ys():setTimeout(ys,10)})};let Zs=null;function Ys(Qr){Zs&&Zs(Qr)}function Js(){Ta.stop()}function aa(){Ta.start()}const Ta=new WebGLAnimation;Ta.setAnimationLoop(Ys),typeof self<"u"&&Ta.setContext(self),this.setAnimationLoop=function(Qr){Zs=Qr,Ss.setAnimationLoop(Qr),Qr===null?Ta.stop():Ta.start()},Ss.addEventListener("sessionstart",Js),Ss.addEventListener("sessionend",aa),this.render=function(Qr,$i){if($i!==void 0&&$i.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(wr===!0)return;if(Qr.matrixWorldAutoUpdate===!0&&Qr.updateMatrixWorld(),$i.parent===null&&$i.matrixWorldAutoUpdate===!0&&$i.updateMatrixWorld(),Ss.enabled===!0&&Ss.isPresenting===!0&&(Ss.cameraAutoUpdate===!0&&Ss.updateCamera($i),$i=Ss.getCamera()),Qr.isScene===!0&&Qr.onBeforeRender(yr,Qr,$i,br),fr=_s.get(Qr,Ar.length),fr.init($i),Ar.push(fr),qr.multiplyMatrices($i.projectionMatrix,$i.matrixWorldInverse),Kr.setFromProjectionMatrix(qr),Vr=this.localClippingEnabled,$r=As.init(this.clippingPlanes,Vr),mr=vs.get(Qr,_r.length),mr.init(),_r.push(mr),Ss.enabled===!0&&Ss.isPresenting===!0){const ys=yr.xr.getDepthSensingMesh();ys!==null&&za(ys,$i,-1/0,yr.sortObjects)}za(Qr,$i,0,yr.sortObjects),mr.finish(),yr.sortObjects===!0&&mr.sort(Wr,Xr),Ki=Ss.enabled===!1||Ss.isPresenting===!1||Ss.hasDepthSensing()===!1,Ki&&Es.addToRenderList(mr,Qr),this.info.render.frame++,$r===!0&&As.beginShadows();const ns=fr.state.shadowsArray;xs.render(ns,Qr,$i),$r===!0&&As.endShadows(),this.info.autoReset===!0&&this.info.reset();const ds=mr.opaque,ps=mr.transmissive;if(fr.setupLights(),$i.isArrayCamera){const ys=$i.cameras;if(ps.length>0)for(let Ts=0,Ds=ys.length;Ts<Ds;Ts++){const Ms=ys[Ts];Qa(ds,ps,Qr,Ms)}Ki&&Es.render(Qr);for(let Ts=0,Ds=ys.length;Ts<Ds;Ts++){const Ms=ys[Ts];Ga(mr,Qr,Ms,Ms.viewport)}}else ps.length>0&&Qa(ds,ps,Qr,$i),Ki&&Es.render(Qr),Ga(mr,Qr,$i);br!==null&&(Yi.updateMultisampleRenderTarget(br),Yi.updateRenderTargetMipmap(br)),Qr.isScene===!0&&Qr.onAfterRender(yr,Qr,$i),Os.resetDefaultState(),Cr=-1,Ir=null,Ar.pop(),Ar.length>0?(fr=Ar[Ar.length-1],$r===!0&&As.setGlobalState(yr.clippingPlanes,fr.state.camera)):fr=null,_r.pop(),_r.length>0?mr=_r[_r.length-1]:mr=null};function za(Qr,$i,ns,ds){if(Qr.visible===!1)return;if(Qr.layers.test($i.layers)){if(Qr.isGroup)ns=Qr.renderOrder;else if(Qr.isLOD)Qr.autoUpdate===!0&&Qr.update($i);else if(Qr.isLight)fr.pushLight(Qr),Qr.castShadow&&fr.pushShadow(Qr);else if(Qr.isSprite){if(!Qr.frustumCulled||Kr.intersectsSprite(Qr)){ds&&Jr.setFromMatrixPosition(Qr.matrixWorld).applyMatrix4(qr);const Ts=as.update(Qr),Ds=Qr.material;Ds.visible&&mr.push(Qr,Ts,Ds,ns,Jr.z,null)}}else if((Qr.isMesh||Qr.isLine||Qr.isPoints)&&(!Qr.frustumCulled||Kr.intersectsObject(Qr))){const Ts=as.update(Qr),Ds=Qr.material;if(ds&&(Qr.boundingSphere!==void 0?(Qr.boundingSphere===null&&Qr.computeBoundingSphere(),Jr.copy(Qr.boundingSphere.center)):(Ts.boundingSphere===null&&Ts.computeBoundingSphere(),Jr.copy(Ts.boundingSphere.center)),Jr.applyMatrix4(Qr.matrixWorld).applyMatrix4(qr)),Array.isArray(Ds)){const Ms=Ts.groups;for(let Cs=0,Is=Ms.length;Cs<Is;Cs++){const Fs=Ms[Cs],Ws=Ds[Fs.materialIndex];Ws&&Ws.visible&&mr.push(Qr,Ts,Ws,ns,Jr.z,Fs)}}else Ds.visible&&mr.push(Qr,Ts,Ds,ns,Jr.z,null)}}const ys=Qr.children;for(let Ts=0,Ds=ys.length;Ts<Ds;Ts++)za(ys[Ts],$i,ns,ds)}function Ga(Qr,$i,ns,ds){const ps=Qr.opaque,ys=Qr.transmissive,Ts=Qr.transparent;fr.setupLightsView(ns),$r===!0&&As.setGlobalState(yr.clippingPlanes,ns),ds&&ss.viewport(Rr.copy(ds)),ps.length>0&&$a(ps,$i,ns),ys.length>0&&$a(ys,$i,ns),Ts.length>0&&$a(Ts,$i,ns),ss.buffers.depth.setTest(!0),ss.buffers.depth.setMask(!0),ss.buffers.color.setMask(!0),ss.setPolygonOffset(!1)}function Qa(Qr,$i,ns,ds){if((ns.isScene===!0?ns.overrideMaterial:null)!==null)return;fr.state.transmissionRenderTarget[ds.id]===void 0&&(fr.state.transmissionRenderTarget[ds.id]=new WebGLRenderTarget(1,1,{generateMipmaps:!0,type:os.has("EXT_color_buffer_half_float")||os.has("EXT_color_buffer_float")?HalfFloatType:UnsignedByteType,minFilter:LinearMipmapLinearFilter,samples:4,stencilBuffer:sr,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ColorManagement.workingColorSpace}));const ys=fr.state.transmissionRenderTarget[ds.id],Ts=ds.viewport||Rr;ys.setSize(Ts.z,Ts.w);const Ds=yr.getRenderTarget();yr.setRenderTarget(ys),yr.getClearColor(Fr),Or=yr.getClearAlpha(),Or<1&&yr.setClearColor(16777215,.5),yr.clear(),Ki&&Es.render(ns);const Ms=yr.toneMapping;yr.toneMapping=NoToneMapping;const Cs=ds.viewport;if(ds.viewport!==void 0&&(ds.viewport=void 0),fr.setupLightsView(ds),$r===!0&&As.setGlobalState(yr.clippingPlanes,ds),$a(Qr,ns,ds),Yi.updateMultisampleRenderTarget(ys),Yi.updateRenderTargetMipmap(ys),os.has("WEBGL_multisampled_render_to_texture")===!1){let Is=!1;for(let Fs=0,Ws=$i.length;Fs<Ws;Fs++){const js=$i[Fs],qs=js.object,Xs=js.geometry,$s=js.material,zs=js.group;if($s.side===DoubleSide&&qs.layers.test(ds.layers)){const Sa=$s.side;$s.side=BackSide,$s.needsUpdate=!0,Ya(qs,ns,ds,Xs,$s,zs),$s.side=Sa,$s.needsUpdate=!0,Is=!0}}Is===!0&&(Yi.updateMultisampleRenderTarget(ys),Yi.updateRenderTargetMipmap(ys))}yr.setRenderTarget(Ds),yr.setClearColor(Fr,Or),Cs!==void 0&&(ds.viewport=Cs),yr.toneMapping=Ms}function $a(Qr,$i,ns){const ds=$i.isScene===!0?$i.overrideMaterial:null;for(let ps=0,ys=Qr.length;ps<ys;ps++){const Ts=Qr[ps],Ds=Ts.object,Ms=Ts.geometry,Cs=ds===null?Ts.material:ds,Is=Ts.group;Ds.layers.test(ns.layers)&&Ya(Ds,$i,ns,Ms,Cs,Is)}}function Ya(Qr,$i,ns,ds,ps,ys){Qr.onBeforeRender(yr,$i,ns,ds,ps,ys),Qr.modelViewMatrix.multiplyMatrices(ns.matrixWorldInverse,Qr.matrixWorld),Qr.normalMatrix.getNormalMatrix(Qr.modelViewMatrix),ps.onBeforeRender(yr,$i,ns,ds,Qr,ys),ps.transparent===!0&&ps.side===DoubleSide&&ps.forceSinglePass===!1?(ps.side=BackSide,ps.needsUpdate=!0,yr.renderBufferDirect(ns,$i,ds,ps,Qr,ys),ps.side=FrontSide,ps.needsUpdate=!0,yr.renderBufferDirect(ns,$i,ds,ps,Qr,ys),ps.side=DoubleSide):yr.renderBufferDirect(ns,$i,ds,ps,Qr,ys),Qr.onAfterRender(yr,$i,ns,ds,ps,ys)}function Xa(Qr,$i,ns){$i.isScene!==!0&&($i=Ji);const ds=ms.get(Qr),ps=fr.state.lights,ys=fr.state.shadowsArray,Ts=ps.state.version,Ds=us.getParameters(Qr,ps.state,ys,$i,ns),Ms=us.getProgramCacheKey(Ds);let Cs=ds.programs;ds.environment=Qr.isMeshStandardMaterial?$i.environment:null,ds.fog=$i.fog,ds.envMap=(Qr.isMeshStandardMaterial?Ni:Gi).get(Qr.envMap||ds.environment),ds.envMapRotation=ds.environment!==null&&Qr.envMap===null?$i.environmentRotation:Qr.envMapRotation,Cs===void 0&&(Qr.addEventListener("dispose",na),Cs=new Map,ds.programs=Cs);let Is=Cs.get(Ms);if(Is!==void 0){if(ds.currentProgram===Is&&ds.lightsStateVersion===Ts)return to(Qr,Ds),Is}else Ds.uniforms=us.getUniforms(Qr),Qr.onBeforeCompile(Ds,yr),Is=us.acquireProgram(Ds,Ms),Cs.set(Ms,Is),ds.uniforms=Ds.uniforms;const Fs=ds.uniforms;return(!Qr.isShaderMaterial&&!Qr.isRawShaderMaterial||Qr.clipping===!0)&&(Fs.clippingPlanes=As.uniform),to(Qr,Ds),ds.needsLights=Ka(Qr),ds.lightsStateVersion=Ts,ds.needsLights&&(Fs.ambientLightColor.value=ps.state.ambient,Fs.lightProbe.value=ps.state.probe,Fs.directionalLights.value=ps.state.directional,Fs.directionalLightShadows.value=ps.state.directionalShadow,Fs.spotLights.value=ps.state.spot,Fs.spotLightShadows.value=ps.state.spotShadow,Fs.rectAreaLights.value=ps.state.rectArea,Fs.ltc_1.value=ps.state.rectAreaLTC1,Fs.ltc_2.value=ps.state.rectAreaLTC2,Fs.pointLights.value=ps.state.point,Fs.pointLightShadows.value=ps.state.pointShadow,Fs.hemisphereLights.value=ps.state.hemi,Fs.directionalShadowMap.value=ps.state.directionalShadowMap,Fs.directionalShadowMatrix.value=ps.state.directionalShadowMatrix,Fs.spotShadowMap.value=ps.state.spotShadowMap,Fs.spotLightMatrix.value=ps.state.spotLightMatrix,Fs.spotLightMap.value=ps.state.spotLightMap,Fs.pointShadowMap.value=ps.state.pointShadowMap,Fs.pointShadowMatrix.value=ps.state.pointShadowMatrix),ds.currentProgram=Is,ds.uniformsList=null,Is}function eo(Qr){if(Qr.uniformsList===null){const $i=Qr.currentProgram.getUniforms();Qr.uniformsList=WebGLUniforms.seqWithValue($i.seq,Qr.uniforms)}return Qr.uniformsList}function to(Qr,$i){const ns=ms.get(Qr);ns.outputColorSpace=$i.outputColorSpace,ns.batching=$i.batching,ns.batchingColor=$i.batchingColor,ns.instancing=$i.instancing,ns.instancingColor=$i.instancingColor,ns.instancingMorph=$i.instancingMorph,ns.skinning=$i.skinning,ns.morphTargets=$i.morphTargets,ns.morphNormals=$i.morphNormals,ns.morphColors=$i.morphColors,ns.morphTargetsCount=$i.morphTargetsCount,ns.numClippingPlanes=$i.numClippingPlanes,ns.numIntersection=$i.numClipIntersection,ns.vertexAlphas=$i.vertexAlphas,ns.vertexTangents=$i.vertexTangents,ns.toneMapping=$i.toneMapping}function no(Qr,$i,ns,ds,ps){$i.isScene!==!0&&($i=Ji),Yi.resetTextureUnits();const ys=$i.fog,Ts=ds.isMeshStandardMaterial?$i.environment:null,Ds=br===null?yr.outputColorSpace:br.isXRRenderTarget===!0?br.texture.colorSpace:LinearSRGBColorSpace,Ms=(ds.isMeshStandardMaterial?Ni:Gi).get(ds.envMap||Ts),Cs=ds.vertexColors===!0&&!!ns.attributes.color&&ns.attributes.color.itemSize===4,Is=!!ns.attributes.tangent&&(!!ds.normalMap||ds.anisotropy>0),Fs=!!ns.morphAttributes.position,Ws=!!ns.morphAttributes.normal,js=!!ns.morphAttributes.color;let qs=NoToneMapping;ds.toneMapped&&(br===null||br.isXRRenderTarget===!0)&&(qs=yr.toneMapping);const Xs=ns.morphAttributes.position||ns.morphAttributes.normal||ns.morphAttributes.color,$s=Xs!==void 0?Xs.length:0,zs=ms.get(ds),Sa=fr.state.lights;if($r===!0&&(Vr===!0||Qr!==Ir)){const ba=Qr===Ir&&ds.id===Cr;As.setState(ds,Qr,ba)}let ma=!1;ds.version===zs.__version?(zs.needsLights&&zs.lightsStateVersion!==Sa.state.version||zs.outputColorSpace!==Ds||ps.isBatchedMesh&&zs.batching===!1||!ps.isBatchedMesh&&zs.batching===!0||ps.isBatchedMesh&&zs.batchingColor===!0&&ps.colorTexture===null||ps.isBatchedMesh&&zs.batchingColor===!1&&ps.colorTexture!==null||ps.isInstancedMesh&&zs.instancing===!1||!ps.isInstancedMesh&&zs.instancing===!0||ps.isSkinnedMesh&&zs.skinning===!1||!ps.isSkinnedMesh&&zs.skinning===!0||ps.isInstancedMesh&&zs.instancingColor===!0&&ps.instanceColor===null||ps.isInstancedMesh&&zs.instancingColor===!1&&ps.instanceColor!==null||ps.isInstancedMesh&&zs.instancingMorph===!0&&ps.morphTexture===null||ps.isInstancedMesh&&zs.instancingMorph===!1&&ps.morphTexture!==null||zs.envMap!==Ms||ds.fog===!0&&zs.fog!==ys||zs.numClippingPlanes!==void 0&&(zs.numClippingPlanes!==As.numPlanes||zs.numIntersection!==As.numIntersection)||zs.vertexAlphas!==Cs||zs.vertexTangents!==Is||zs.morphTargets!==Fs||zs.morphNormals!==Ws||zs.morphColors!==js||zs.toneMapping!==qs||zs.morphTargetsCount!==$s)&&(ma=!0):(ma=!0,zs.__version=ds.version);let Oa=zs.currentProgram;ma===!0&&(Oa=Xa(ds,$i,ps));let Ma=!1,ya=!1,Ua=!1;const ha=Oa.getUniforms(),Ca=zs.uniforms;if(ss.useProgram(Oa.program)&&(Ma=!0,ya=!0,Ua=!0),ds.id!==Cr&&(Cr=ds.id,ya=!0),Ma||Ir!==Qr){ss.buffers.depth.getReversed()?(Gr.copy(Qr.projectionMatrix),toNormalizedProjectionMatrix(Gr),toReversedProjectionMatrix(Gr),ha.setValue(Zr,"projectionMatrix",Gr)):ha.setValue(Zr,"projectionMatrix",Qr.projectionMatrix),ha.setValue(Zr,"viewMatrix",Qr.matrixWorldInverse);const Va=ha.map.cameraPosition;Va!==void 0&&Va.setValue(Zr,ji.setFromMatrixPosition(Qr.matrixWorld)),cs.logarithmicDepthBuffer&&ha.setValue(Zr,"logDepthBufFC",2/(Math.log(Qr.far+1)/Math.LN2)),(ds.isMeshPhongMaterial||ds.isMeshToonMaterial||ds.isMeshLambertMaterial||ds.isMeshBasicMaterial||ds.isMeshStandardMaterial||ds.isShaderMaterial)&&ha.setValue(Zr,"isOrthographic",Qr.isOrthographicCamera===!0),Ir!==Qr&&(Ir=Qr,ya=!0,Ua=!0)}if(ps.isSkinnedMesh){ha.setOptional(Zr,ps,"bindMatrix"),ha.setOptional(Zr,ps,"bindMatrixInverse");const ba=ps.skeleton;ba&&(ba.boneTexture===null&&ba.computeBoneTexture(),ha.setValue(Zr,"boneTexture",ba.boneTexture,Yi))}ps.isBatchedMesh&&(ha.setOptional(Zr,ps,"batchingTexture"),ha.setValue(Zr,"batchingTexture",ps._matricesTexture,Yi),ha.setOptional(Zr,ps,"batchingIdTexture"),ha.setValue(Zr,"batchingIdTexture",ps._indirectTexture,Yi),ha.setOptional(Zr,ps,"batchingColorTexture"),ps._colorsTexture!==null&&ha.setValue(Zr,"batchingColorTexture",ps._colorsTexture,Yi));const Ea=ns.morphAttributes;if((Ea.position!==void 0||Ea.normal!==void 0||Ea.color!==void 0)&&Ps.update(ps,ns,Oa),(ya||zs.receiveShadow!==ps.receiveShadow)&&(zs.receiveShadow=ps.receiveShadow,ha.setValue(Zr,"receiveShadow",ps.receiveShadow)),ds.isMeshGouraudMaterial&&ds.envMap!==null&&(Ca.envMap.value=Ms,Ca.flipEnvMap.value=Ms.isCubeTexture&&Ms.isRenderTargetTexture===!1?-1:1),ds.isMeshStandardMaterial&&ds.envMap===null&&$i.environment!==null&&(Ca.envMapIntensity.value=$i.environmentIntensity),ya&&(ha.setValue(Zr,"toneMappingExposure",yr.toneMappingExposure),zs.needsLights&&qa(Ca,Ua),ys&&ds.fog===!0&&gs.refreshFogUniforms(Ca,ys),gs.refreshMaterialUniforms(Ca,ds,Br,Ur,fr.state.transmissionRenderTarget[Qr.id]),WebGLUniforms.upload(Zr,eo(zs),Ca,Yi)),ds.isShaderMaterial&&ds.uniformsNeedUpdate===!0&&(WebGLUniforms.upload(Zr,eo(zs),Ca,Yi),ds.uniformsNeedUpdate=!1),ds.isSpriteMaterial&&ha.setValue(Zr,"center",ps.center),ha.setValue(Zr,"modelViewMatrix",ps.modelViewMatrix),ha.setValue(Zr,"normalMatrix",ps.normalMatrix),ha.setValue(Zr,"modelMatrix",ps.matrixWorld),ds.isShaderMaterial||ds.isRawShaderMaterial){const ba=ds.uniformsGroups;for(let Va=0,Ha=ba.length;Va<Ha;Va++){const Wa=ba[Va];ws.update(Wa,Oa),ws.bind(Wa,Oa)}}return Oa}function qa(Qr,$i){Qr.ambientLightColor.needsUpdate=$i,Qr.lightProbe.needsUpdate=$i,Qr.directionalLights.needsUpdate=$i,Qr.directionalLightShadows.needsUpdate=$i,Qr.pointLights.needsUpdate=$i,Qr.pointLightShadows.needsUpdate=$i,Qr.spotLights.needsUpdate=$i,Qr.spotLightShadows.needsUpdate=$i,Qr.rectAreaLights.needsUpdate=$i,Qr.hemisphereLights.needsUpdate=$i}function Ka(Qr){return Qr.isMeshLambertMaterial||Qr.isMeshToonMaterial||Qr.isMeshPhongMaterial||Qr.isMeshStandardMaterial||Qr.isShadowMaterial||Qr.isShaderMaterial&&Qr.lights===!0}this.getActiveCubeFace=function(){return xr},this.getActiveMipmapLevel=function(){return Sr},this.getRenderTarget=function(){return br},this.setRenderTargetTextures=function(Qr,$i,ns){ms.get(Qr.texture).__webglTexture=$i,ms.get(Qr.depthTexture).__webglTexture=ns;const ds=ms.get(Qr);ds.__hasExternalTextures=!0,ds.__autoAllocateDepthBuffer=ns===void 0,ds.__autoAllocateDepthBuffer||os.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),ds.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(Qr,$i){const ns=ms.get(Qr);ns.__webglFramebuffer=$i,ns.__useDefaultFramebuffer=$i===void 0},this.setRenderTarget=function(Qr,$i=0,ns=0){br=Qr,xr=$i,Sr=ns;let ds=!0,ps=null,ys=!1,Ts=!1;if(Qr){const Ms=ms.get(Qr);if(Ms.__useDefaultFramebuffer!==void 0)ss.bindFramebuffer(Zr.FRAMEBUFFER,null),ds=!1;else if(Ms.__webglFramebuffer===void 0)Yi.setupRenderTarget(Qr);else if(Ms.__hasExternalTextures)Yi.rebindTextures(Qr,ms.get(Qr.texture).__webglTexture,ms.get(Qr.depthTexture).__webglTexture);else if(Qr.depthBuffer){const Fs=Qr.depthTexture;if(Ms.__boundDepthTexture!==Fs){if(Fs!==null&&ms.has(Fs)&&(Qr.width!==Fs.image.width||Qr.height!==Fs.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Yi.setupDepthRenderbuffer(Qr)}}const Cs=Qr.texture;(Cs.isData3DTexture||Cs.isDataArrayTexture||Cs.isCompressedArrayTexture)&&(Ts=!0);const Is=ms.get(Qr).__webglFramebuffer;Qr.isWebGLCubeRenderTarget?(Array.isArray(Is[$i])?ps=Is[$i][ns]:ps=Is[$i],ys=!0):Qr.samples>0&&Yi.useMultisampledRTT(Qr)===!1?ps=ms.get(Qr).__webglMultisampledFramebuffer:Array.isArray(Is)?ps=Is[ns]:ps=Is,Rr.copy(Qr.viewport),Pr.copy(Qr.scissor),Dr=Qr.scissorTest}else Rr.copy(Yr).multiplyScalar(Br).floor(),Pr.copy(Qi).multiplyScalar(Br).floor(),Dr=Xi;if(ss.bindFramebuffer(Zr.FRAMEBUFFER,ps)&&ds&&ss.drawBuffers(Qr,ps),ss.viewport(Rr),ss.scissor(Pr),ss.setScissorTest(Dr),ys){const Ms=ms.get(Qr.texture);Zr.framebufferTexture2D(Zr.FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,Zr.TEXTURE_CUBE_MAP_POSITIVE_X+$i,Ms.__webglTexture,ns)}else if(Ts){const Ms=ms.get(Qr.texture),Cs=$i||0;Zr.framebufferTextureLayer(Zr.FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,Ms.__webglTexture,ns||0,Cs)}Cr=-1},this.readRenderTargetPixels=function(Qr,$i,ns,ds,ps,ys,Ts){if(!(Qr&&Qr.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Ds=ms.get(Qr).__webglFramebuffer;if(Qr.isWebGLCubeRenderTarget&&Ts!==void 0&&(Ds=Ds[Ts]),Ds){ss.bindFramebuffer(Zr.FRAMEBUFFER,Ds);try{const Ms=Qr.texture,Cs=Ms.format,Is=Ms.type;if(!cs.textureFormatReadable(Cs)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!cs.textureTypeReadable(Is)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}$i>=0&&$i<=Qr.width-ds&&ns>=0&&ns<=Qr.height-ps&&Zr.readPixels($i,ns,ds,ps,Us.convert(Cs),Us.convert(Is),ys)}finally{const Ms=br!==null?ms.get(br).__webglFramebuffer:null;ss.bindFramebuffer(Zr.FRAMEBUFFER,Ms)}}},this.readRenderTargetPixelsAsync=async function(Qr,$i,ns,ds,ps,ys,Ts){if(!(Qr&&Qr.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Ds=ms.get(Qr).__webglFramebuffer;if(Qr.isWebGLCubeRenderTarget&&Ts!==void 0&&(Ds=Ds[Ts]),Ds){const Ms=Qr.texture,Cs=Ms.format,Is=Ms.type;if(!cs.textureFormatReadable(Cs))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!cs.textureTypeReadable(Is))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");if($i>=0&&$i<=Qr.width-ds&&ns>=0&&ns<=Qr.height-ps){ss.bindFramebuffer(Zr.FRAMEBUFFER,Ds);const Fs=Zr.createBuffer();Zr.bindBuffer(Zr.PIXEL_PACK_BUFFER,Fs),Zr.bufferData(Zr.PIXEL_PACK_BUFFER,ys.byteLength,Zr.STREAM_READ),Zr.readPixels($i,ns,ds,ps,Us.convert(Cs),Us.convert(Is),0);const Ws=br!==null?ms.get(br).__webglFramebuffer:null;ss.bindFramebuffer(Zr.FRAMEBUFFER,Ws);const js=Zr.fenceSync(Zr.SYNC_GPU_COMMANDS_COMPLETE,0);return Zr.flush(),await probeAsync(Zr,js,4),Zr.bindBuffer(Zr.PIXEL_PACK_BUFFER,Fs),Zr.getBufferSubData(Zr.PIXEL_PACK_BUFFER,0,ys),Zr.deleteBuffer(Fs),Zr.deleteSync(js),ys}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")}},this.copyFramebufferToTexture=function(Qr,$i=null,ns=0){Qr.isTexture!==!0&&(warnOnce("WebGLRenderer: copyFramebufferToTexture function signature has changed."),$i=arguments[0]||null,Qr=arguments[1]);const ds=Math.pow(2,-ns),ps=Math.floor(Qr.image.width*ds),ys=Math.floor(Qr.image.height*ds),Ts=$i!==null?$i.x:0,Ds=$i!==null?$i.y:0;Yi.setTexture2D(Qr,0),Zr.copyTexSubImage2D(Zr.TEXTURE_2D,ns,0,0,Ts,Ds,ps,ys),ss.unbindTexture()},this.copyTextureToTexture=function(Qr,$i,ns=null,ds=null,ps=0){Qr.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture function signature has changed."),ds=arguments[0]||null,Qr=arguments[1],$i=arguments[2],ps=arguments[3]||0,ns=null);let ys,Ts,Ds,Ms,Cs,Is,Fs,Ws,js;const qs=Qr.isCompressedTexture?Qr.mipmaps[ps]:Qr.image;ns!==null?(ys=ns.max.x-ns.min.x,Ts=ns.max.y-ns.min.y,Ds=ns.isBox3?ns.max.z-ns.min.z:1,Ms=ns.min.x,Cs=ns.min.y,Is=ns.isBox3?ns.min.z:0):(ys=qs.width,Ts=qs.height,Ds=qs.depth||1,Ms=0,Cs=0,Is=0),ds!==null?(Fs=ds.x,Ws=ds.y,js=ds.z):(Fs=0,Ws=0,js=0);const Xs=Us.convert($i.format),$s=Us.convert($i.type);let zs;$i.isData3DTexture?(Yi.setTexture3D($i,0),zs=Zr.TEXTURE_3D):$i.isDataArrayTexture||$i.isCompressedArrayTexture?(Yi.setTexture2DArray($i,0),zs=Zr.TEXTURE_2D_ARRAY):(Yi.setTexture2D($i,0),zs=Zr.TEXTURE_2D),Zr.pixelStorei(Zr.UNPACK_FLIP_Y_WEBGL,$i.flipY),Zr.pixelStorei(Zr.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$i.premultiplyAlpha),Zr.pixelStorei(Zr.UNPACK_ALIGNMENT,$i.unpackAlignment);const Sa=Zr.getParameter(Zr.UNPACK_ROW_LENGTH),ma=Zr.getParameter(Zr.UNPACK_IMAGE_HEIGHT),Oa=Zr.getParameter(Zr.UNPACK_SKIP_PIXELS),Ma=Zr.getParameter(Zr.UNPACK_SKIP_ROWS),ya=Zr.getParameter(Zr.UNPACK_SKIP_IMAGES);Zr.pixelStorei(Zr.UNPACK_ROW_LENGTH,qs.width),Zr.pixelStorei(Zr.UNPACK_IMAGE_HEIGHT,qs.height),Zr.pixelStorei(Zr.UNPACK_SKIP_PIXELS,Ms),Zr.pixelStorei(Zr.UNPACK_SKIP_ROWS,Cs),Zr.pixelStorei(Zr.UNPACK_SKIP_IMAGES,Is);const Ua=Qr.isDataArrayTexture||Qr.isData3DTexture,ha=$i.isDataArrayTexture||$i.isData3DTexture;if(Qr.isRenderTargetTexture||Qr.isDepthTexture){const Ca=ms.get(Qr),Ea=ms.get($i),ba=ms.get(Ca.__renderTarget),Va=ms.get(Ea.__renderTarget);ss.bindFramebuffer(Zr.READ_FRAMEBUFFER,ba.__webglFramebuffer),ss.bindFramebuffer(Zr.DRAW_FRAMEBUFFER,Va.__webglFramebuffer);for(let Ha=0;Ha<Ds;Ha++)Ua&&Zr.framebufferTextureLayer(Zr.READ_FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,ms.get(Qr).__webglTexture,ps,Is+Ha),Qr.isDepthTexture?(ha&&Zr.framebufferTextureLayer(Zr.DRAW_FRAMEBUFFER,Zr.COLOR_ATTACHMENT0,ms.get($i).__webglTexture,ps,js+Ha),Zr.blitFramebuffer(Ms,Cs,ys,Ts,Fs,Ws,ys,Ts,Zr.DEPTH_BUFFER_BIT,Zr.NEAREST)):ha?Zr.copyTexSubImage3D(zs,ps,Fs,Ws,js+Ha,Ms,Cs,ys,Ts):Zr.copyTexSubImage2D(zs,ps,Fs,Ws,js+Ha,Ms,Cs,ys,Ts);ss.bindFramebuffer(Zr.READ_FRAMEBUFFER,null),ss.bindFramebuffer(Zr.DRAW_FRAMEBUFFER,null)}else ha?Qr.isDataTexture||Qr.isData3DTexture?Zr.texSubImage3D(zs,ps,Fs,Ws,js,ys,Ts,Ds,Xs,$s,qs.data):$i.isCompressedArrayTexture?Zr.compressedTexSubImage3D(zs,ps,Fs,Ws,js,ys,Ts,Ds,Xs,qs.data):Zr.texSubImage3D(zs,ps,Fs,Ws,js,ys,Ts,Ds,Xs,$s,qs):Qr.isDataTexture?Zr.texSubImage2D(Zr.TEXTURE_2D,ps,Fs,Ws,ys,Ts,Xs,$s,qs.data):Qr.isCompressedTexture?Zr.compressedTexSubImage2D(Zr.TEXTURE_2D,ps,Fs,Ws,qs.width,qs.height,Xs,qs.data):Zr.texSubImage2D(Zr.TEXTURE_2D,ps,Fs,Ws,ys,Ts,Xs,$s,qs);Zr.pixelStorei(Zr.UNPACK_ROW_LENGTH,Sa),Zr.pixelStorei(Zr.UNPACK_IMAGE_HEIGHT,ma),Zr.pixelStorei(Zr.UNPACK_SKIP_PIXELS,Oa),Zr.pixelStorei(Zr.UNPACK_SKIP_ROWS,Ma),Zr.pixelStorei(Zr.UNPACK_SKIP_IMAGES,ya),ps===0&&$i.generateMipmaps&&Zr.generateMipmap(zs),ss.unbindTexture()},this.copyTextureToTexture3D=function(Qr,$i,ns=null,ds=null,ps=0){return Qr.isTexture!==!0&&(warnOnce("WebGLRenderer: copyTextureToTexture3D function signature has changed."),ns=arguments[0]||null,ds=arguments[1]||null,Qr=arguments[2],$i=arguments[3],ps=arguments[4]||0),warnOnce('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(Qr,$i,ns,ds,ps)},this.initRenderTarget=function(Qr){ms.get(Qr).__webglFramebuffer===void 0&&Yi.setupRenderTarget(Qr)},this.initTexture=function(Qr){Qr.isCubeTexture?Yi.setTextureCube(Qr,0):Qr.isData3DTexture?Yi.setTexture3D(Qr,0):Qr.isDataArrayTexture||Qr.isCompressedArrayTexture?Yi.setTexture2DArray(Qr,0):Yi.setTexture2D(Qr,0),ss.unbindTexture()},this.resetState=function(){xr=0,Sr=0,br=null,ss.reset(),Os.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return WebGLCoordinateSystem}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(er){this._outputColorSpace=er;const tr=this.getContext();tr.drawingBufferColorspace=ColorManagement._getDrawingBufferColorSpace(er),tr.unpackColorSpace=ColorManagement._getUnpackColorSpace()}}class FogExp2{constructor(er,tr=25e-5){this.isFogExp2=!0,this.name="",this.color=new Color(er),this.density=tr}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Fog{constructor(er,tr=1,ir=1e3){this.isFog=!0,this.name="",this.color=new Color(er),this.near=tr,this.far=ir}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Scene extends Object3D{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Euler,this.environmentIntensity=1,this.environmentRotation=new Euler,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(er,tr){return super.copy(er,tr),er.background!==null&&(this.background=er.background.clone()),er.environment!==null&&(this.environment=er.environment.clone()),er.fog!==null&&(this.fog=er.fog.clone()),this.backgroundBlurriness=er.backgroundBlurriness,this.backgroundIntensity=er.backgroundIntensity,this.backgroundRotation.copy(er.backgroundRotation),this.environmentIntensity=er.environmentIntensity,this.environmentRotation.copy(er.environmentRotation),er.overrideMaterial!==null&&(this.overrideMaterial=er.overrideMaterial.clone()),this.matrixAutoUpdate=er.matrixAutoUpdate,this}toJSON(er){const tr=super.toJSON(er);return this.fog!==null&&(tr.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(tr.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(tr.object.backgroundIntensity=this.backgroundIntensity),tr.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(tr.object.environmentIntensity=this.environmentIntensity),tr.object.environmentRotation=this.environmentRotation.toArray(),tr}}class InterleavedBuffer{constructor(er,tr){this.isInterleavedBuffer=!0,this.array=er,this.stride=tr,this.count=er!==void 0?er.length/tr:0,this.usage=StaticDrawUsage,this.updateRanges=[],this.version=0,this.uuid=generateUUID()}onUploadCallback(){}set needsUpdate(er){er===!0&&this.version++}setUsage(er){return this.usage=er,this}addUpdateRange(er,tr){this.updateRanges.push({start:er,count:tr})}clearUpdateRanges(){this.updateRanges.length=0}copy(er){return this.array=new er.array.constructor(er.array),this.count=er.count,this.stride=er.stride,this.usage=er.usage,this}copyAt(er,tr,ir){er*=this.stride,ir*=tr.stride;for(let nr=0,sr=this.stride;nr<sr;nr++)this.array[er+nr]=tr.array[ir+nr];return this}set(er,tr=0){return this.array.set(er,tr),this}clone(er){er.arrayBuffers===void 0&&(er.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),er.arrayBuffers[this.array.buffer._uuid]===void 0&&(er.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const tr=new this.array.constructor(er.arrayBuffers[this.array.buffer._uuid]),ir=new this.constructor(tr,this.stride);return ir.setUsage(this.usage),ir}onUpload(er){return this.onUploadCallback=er,this}toJSON(er){return er.arrayBuffers===void 0&&(er.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=generateUUID()),er.arrayBuffers[this.array.buffer._uuid]===void 0&&(er.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const _vector$6=new Vector3$1;class InterleavedBufferAttribute{constructor(er,tr,ir,nr=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=er,this.itemSize=tr,this.offset=ir,this.normalized=nr}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(er){this.data.needsUpdate=er}applyMatrix4(er){for(let tr=0,ir=this.data.count;tr<ir;tr++)_vector$6.fromBufferAttribute(this,tr),_vector$6.applyMatrix4(er),this.setXYZ(tr,_vector$6.x,_vector$6.y,_vector$6.z);return this}applyNormalMatrix(er){for(let tr=0,ir=this.count;tr<ir;tr++)_vector$6.fromBufferAttribute(this,tr),_vector$6.applyNormalMatrix(er),this.setXYZ(tr,_vector$6.x,_vector$6.y,_vector$6.z);return this}transformDirection(er){for(let tr=0,ir=this.count;tr<ir;tr++)_vector$6.fromBufferAttribute(this,tr),_vector$6.transformDirection(er),this.setXYZ(tr,_vector$6.x,_vector$6.y,_vector$6.z);return this}getComponent(er,tr){let ir=this.array[er*this.data.stride+this.offset+tr];return this.normalized&&(ir=denormalize(ir,this.array)),ir}setComponent(er,tr,ir){return this.normalized&&(ir=normalize(ir,this.array)),this.data.array[er*this.data.stride+this.offset+tr]=ir,this}setX(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset]=tr,this}setY(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+1]=tr,this}setZ(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+2]=tr,this}setW(er,tr){return this.normalized&&(tr=normalize(tr,this.array)),this.data.array[er*this.data.stride+this.offset+3]=tr,this}getX(er){let tr=this.data.array[er*this.data.stride+this.offset];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getY(er){let tr=this.data.array[er*this.data.stride+this.offset+1];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getZ(er){let tr=this.data.array[er*this.data.stride+this.offset+2];return this.normalized&&(tr=denormalize(tr,this.array)),tr}getW(er){let tr=this.data.array[er*this.data.stride+this.offset+3];return this.normalized&&(tr=denormalize(tr,this.array)),tr}setXY(er,tr,ir){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=ir,this}setXYZ(er,tr,ir,nr){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=ir,this.data.array[er+2]=nr,this}setXYZW(er,tr,ir,nr,sr){return er=er*this.data.stride+this.offset,this.normalized&&(tr=normalize(tr,this.array),ir=normalize(ir,this.array),nr=normalize(nr,this.array),sr=normalize(sr,this.array)),this.data.array[er+0]=tr,this.data.array[er+1]=ir,this.data.array[er+2]=nr,this.data.array[er+3]=sr,this}clone(er){if(er===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const tr=[];for(let ir=0;ir<this.count;ir++){const nr=ir*this.data.stride+this.offset;for(let sr=0;sr<this.itemSize;sr++)tr.push(this.data.array[nr+sr])}return new BufferAttribute(new this.array.constructor(tr),this.itemSize,this.normalized)}else return er.interleavedBuffers===void 0&&(er.interleavedBuffers={}),er.interleavedBuffers[this.data.uuid]===void 0&&(er.interleavedBuffers[this.data.uuid]=this.data.clone(er)),new InterleavedBufferAttribute(er.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(er){if(er===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const tr=[];for(let ir=0;ir<this.count;ir++){const nr=ir*this.data.stride+this.offset;for(let sr=0;sr<this.itemSize;sr++)tr.push(this.data.array[nr+sr])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:tr,normalized:this.normalized}}else return er.interleavedBuffers===void 0&&(er.interleavedBuffers={}),er.interleavedBuffers[this.data.uuid]===void 0&&(er.interleavedBuffers[this.data.uuid]=this.data.toJSON(er)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class SpriteMaterial extends Material{static get type(){return"SpriteMaterial"}constructor(er){super(),this.isSpriteMaterial=!0,this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.alphaMap=er.alphaMap,this.rotation=er.rotation,this.sizeAttenuation=er.sizeAttenuation,this.fog=er.fog,this}}let _geometry$1;const _intersectPoint=new Vector3$1,_worldScale$1=new Vector3$1,_mvPosition=new Vector3$1,_alignedPosition=new Vector2,_rotatedPosition=new Vector2,_viewWorldMatrix=new Matrix4,_vA$2=new Vector3$1,_vB$2=new Vector3$1,_vC$2=new Vector3$1,_uvA$1=new Vector2,_uvB$1=new Vector2,_uvC$1=new Vector2;class Sprite extends Object3D{constructor(er=new SpriteMaterial){if(super(),this.isSprite=!0,this.type="Sprite",_geometry$1===void 0){_geometry$1=new BufferGeometry;const tr=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),ir=new InterleavedBuffer(tr,5);_geometry$1.setIndex([0,1,2,0,2,3]),_geometry$1.setAttribute("position",new InterleavedBufferAttribute(ir,3,0,!1)),_geometry$1.setAttribute("uv",new InterleavedBufferAttribute(ir,2,3,!1))}this.geometry=_geometry$1,this.material=er,this.center=new Vector2(.5,.5)}raycast(er,tr){er.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),_worldScale$1.setFromMatrixScale(this.matrixWorld),_viewWorldMatrix.copy(er.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(er.camera.matrixWorldInverse,this.matrixWorld),_mvPosition.setFromMatrixPosition(this.modelViewMatrix),er.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&_worldScale$1.multiplyScalar(-_mvPosition.z);const ir=this.material.rotation;let nr,sr;ir!==0&&(sr=Math.cos(ir),nr=Math.sin(ir));const ar=this.center;transformVertex(_vA$2.set(-.5,-.5,0),_mvPosition,ar,_worldScale$1,nr,sr),transformVertex(_vB$2.set(.5,-.5,0),_mvPosition,ar,_worldScale$1,nr,sr),transformVertex(_vC$2.set(.5,.5,0),_mvPosition,ar,_worldScale$1,nr,sr),_uvA$1.set(0,0),_uvB$1.set(1,0),_uvC$1.set(1,1);let or=er.ray.intersectTriangle(_vA$2,_vB$2,_vC$2,!1,_intersectPoint);if(or===null&&(transformVertex(_vB$2.set(-.5,.5,0),_mvPosition,ar,_worldScale$1,nr,sr),_uvB$1.set(0,1),or=er.ray.intersectTriangle(_vA$2,_vC$2,_vB$2,!1,_intersectPoint),or===null))return;const lr=er.ray.origin.distanceTo(_intersectPoint);lr<er.near||lr>er.far||tr.push({distance:lr,point:_intersectPoint.clone(),uv:Triangle$2.getInterpolation(_intersectPoint,_vA$2,_vB$2,_vC$2,_uvA$1,_uvB$1,_uvC$1,new Vector2),face:null,object:this})}copy(er,tr){return super.copy(er,tr),er.center!==void 0&&this.center.copy(er.center),this.material=er.material,this}}function transformVertex(rr,er,tr,ir,nr,sr){_alignedPosition.subVectors(rr,tr).addScalar(.5).multiply(ir),nr!==void 0?(_rotatedPosition.x=sr*_alignedPosition.x-nr*_alignedPosition.y,_rotatedPosition.y=nr*_alignedPosition.x+sr*_alignedPosition.y):_rotatedPosition.copy(_alignedPosition),rr.copy(er),rr.x+=_rotatedPosition.x,rr.y+=_rotatedPosition.y,rr.applyMatrix4(_viewWorldMatrix)}const _v1$2$1=new Vector3$1,_v2$1$1=new Vector3$1;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(er){super.copy(er,!1);const tr=er.levels;for(let ir=0,nr=tr.length;ir<nr;ir++){const sr=tr[ir];this.addLevel(sr.object.clone(),sr.distance,sr.hysteresis)}return this.autoUpdate=er.autoUpdate,this}addLevel(er,tr=0,ir=0){tr=Math.abs(tr);const nr=this.levels;let sr;for(sr=0;sr<nr.length&&!(tr<nr[sr].distance);sr++);return nr.splice(sr,0,{distance:tr,hysteresis:ir,object:er}),this.add(er),this}removeLevel(er){const tr=this.levels;for(let ir=0;ir<tr.length;ir++)if(tr[ir].distance===er){const nr=tr.splice(ir,1);return this.remove(nr[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(er){const tr=this.levels;if(tr.length>0){let ir,nr;for(ir=1,nr=tr.length;ir<nr;ir++){let sr=tr[ir].distance;if(tr[ir].object.visible&&(sr-=sr*tr[ir].hysteresis),er<sr)break}return tr[ir-1].object}return null}raycast(er,tr){if(this.levels.length>0){_v1$2$1.setFromMatrixPosition(this.matrixWorld);const nr=er.ray.origin.distanceTo(_v1$2$1);this.getObjectForDistance(nr).raycast(er,tr)}}update(er){const tr=this.levels;if(tr.length>1){_v1$2$1.setFromMatrixPosition(er.matrixWorld),_v2$1$1.setFromMatrixPosition(this.matrixWorld);const ir=_v1$2$1.distanceTo(_v2$1$1)/er.zoom;tr[0].object.visible=!0;let nr,sr;for(nr=1,sr=tr.length;nr<sr;nr++){let ar=tr[nr].distance;if(tr[nr].object.visible&&(ar-=ar*tr[nr].hysteresis),ir>=ar)tr[nr-1].object.visible=!1,tr[nr].object.visible=!0;else break}for(this._currentLevel=nr-1;nr<sr;nr++)tr[nr].object.visible=!1}}toJSON(er){const tr=super.toJSON(er);this.autoUpdate===!1&&(tr.object.autoUpdate=!1),tr.object.levels=[];const ir=this.levels;for(let nr=0,sr=ir.length;nr<sr;nr++){const ar=ir[nr];tr.object.levels.push({object:ar.object.uuid,distance:ar.distance,hysteresis:ar.hysteresis})}return tr}}const _basePosition=new Vector3$1,_skinIndex$1=new Vector4,_skinWeight$1=new Vector4,_vector3=new Vector3$1,_matrix4=new Matrix4,_vertex=new Vector3$1,_sphere$4=new Sphere,_inverseMatrix$2=new Matrix4,_ray$2$1=new Ray$1;class SkinnedMesh extends Mesh{constructor(er,tr){super(er,tr),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=AttachedBindMode,this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const er=this.geometry;this.boundingBox===null&&(this.boundingBox=new Box3),this.boundingBox.makeEmpty();const tr=er.getAttribute("position");for(let ir=0;ir<tr.count;ir++)this.getVertexPosition(ir,_vertex),this.boundingBox.expandByPoint(_vertex)}computeBoundingSphere(){const er=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingSphere.makeEmpty();const tr=er.getAttribute("position");for(let ir=0;ir<tr.count;ir++)this.getVertexPosition(ir,_vertex),this.boundingSphere.expandByPoint(_vertex)}copy(er,tr){return super.copy(er,tr),this.bindMode=er.bindMode,this.bindMatrix.copy(er.bindMatrix),this.bindMatrixInverse.copy(er.bindMatrixInverse),this.skeleton=er.skeleton,er.boundingBox!==null&&(this.boundingBox=er.boundingBox.clone()),er.boundingSphere!==null&&(this.boundingSphere=er.boundingSphere.clone()),this}raycast(er,tr){const ir=this.material,nr=this.matrixWorld;ir!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$4.copy(this.boundingSphere),_sphere$4.applyMatrix4(nr),er.ray.intersectsSphere(_sphere$4)!==!1&&(_inverseMatrix$2.copy(nr).invert(),_ray$2$1.copy(er.ray).applyMatrix4(_inverseMatrix$2),!(this.boundingBox!==null&&_ray$2$1.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(er,tr,_ray$2$1)))}getVertexPosition(er,tr){return super.getVertexPosition(er,tr),this.applyBoneTransform(er,tr),tr}bind(er,tr){this.skeleton=er,tr===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),tr=this.matrixWorld),this.bindMatrix.copy(tr),this.bindMatrixInverse.copy(tr).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const er=new Vector4,tr=this.geometry.attributes.skinWeight;for(let ir=0,nr=tr.count;ir<nr;ir++){er.fromBufferAttribute(tr,ir);const sr=1/er.manhattanLength();sr!==1/0?er.multiplyScalar(sr):er.set(1,0,0,0),tr.setXYZW(ir,er.x,er.y,er.z,er.w)}}updateMatrixWorld(er){super.updateMatrixWorld(er),this.bindMode===AttachedBindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DetachedBindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(er,tr){const ir=this.skeleton,nr=this.geometry;_skinIndex$1.fromBufferAttribute(nr.attributes.skinIndex,er),_skinWeight$1.fromBufferAttribute(nr.attributes.skinWeight,er),_basePosition.copy(tr).applyMatrix4(this.bindMatrix),tr.set(0,0,0);for(let sr=0;sr<4;sr++){const ar=_skinWeight$1.getComponent(sr);if(ar!==0){const or=_skinIndex$1.getComponent(sr);_matrix4.multiplyMatrices(ir.bones[or].matrixWorld,ir.boneInverses[or]),tr.addScaledVector(_vector3.copy(_basePosition).applyMatrix4(_matrix4),ar)}}return tr.applyMatrix4(this.bindMatrixInverse)}}class Bone extends Object3D{constructor(){super(),this.isBone=!0,this.type="Bone"}}class DataTexture extends Texture{constructor(er=null,tr=1,ir=1,nr,sr,ar,or,lr,cr=NearestFilter,ur=NearestFilter,dr,hr){super(null,ar,or,lr,cr,ur,nr,sr,dr,hr),this.isDataTexture=!0,this.image={data:er,width:tr,height:ir},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const _offsetMatrix=new Matrix4,_identityMatrix$1=new Matrix4;class Skeleton{constructor(er=[],tr=[]){this.uuid=generateUUID(),this.bones=er.slice(0),this.boneInverses=tr,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const er=this.bones,tr=this.boneInverses;if(this.boneMatrices=new Float32Array(er.length*16),tr.length===0)this.calculateInverses();else if(er.length!==tr.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let ir=0,nr=this.bones.length;ir<nr;ir++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let er=0,tr=this.bones.length;er<tr;er++){const ir=new Matrix4;this.bones[er]&&ir.copy(this.bones[er].matrixWorld).invert(),this.boneInverses.push(ir)}}pose(){for(let er=0,tr=this.bones.length;er<tr;er++){const ir=this.bones[er];ir&&ir.matrixWorld.copy(this.boneInverses[er]).invert()}for(let er=0,tr=this.bones.length;er<tr;er++){const ir=this.bones[er];ir&&(ir.parent&&ir.parent.isBone?(ir.matrix.copy(ir.parent.matrixWorld).invert(),ir.matrix.multiply(ir.matrixWorld)):ir.matrix.copy(ir.matrixWorld),ir.matrix.decompose(ir.position,ir.quaternion,ir.scale))}}update(){const er=this.bones,tr=this.boneInverses,ir=this.boneMatrices,nr=this.boneTexture;for(let sr=0,ar=er.length;sr<ar;sr++){const or=er[sr]?er[sr].matrixWorld:_identityMatrix$1;_offsetMatrix.multiplyMatrices(or,tr[sr]),_offsetMatrix.toArray(ir,sr*16)}nr!==null&&(nr.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let er=Math.sqrt(this.bones.length*4);er=Math.ceil(er/4)*4,er=Math.max(er,4);const tr=new Float32Array(er*er*4);tr.set(this.boneMatrices);const ir=new DataTexture(tr,er,er,RGBAFormat,FloatType);return ir.needsUpdate=!0,this.boneMatrices=tr,this.boneTexture=ir,this}getBoneByName(er){for(let tr=0,ir=this.bones.length;tr<ir;tr++){const nr=this.bones[tr];if(nr.name===er)return nr}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(er,tr){this.uuid=er.uuid;for(let ir=0,nr=er.bones.length;ir<nr;ir++){const sr=er.bones[ir];let ar=tr[sr];ar===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",sr),ar=new Bone),this.bones.push(ar),this.boneInverses.push(new Matrix4().fromArray(er.boneInverses[ir]))}return this.init(),this}toJSON(){const er={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};er.uuid=this.uuid;const tr=this.bones,ir=this.boneInverses;for(let nr=0,sr=tr.length;nr<sr;nr++){const ar=tr[nr];er.bones.push(ar.uuid);const or=ir[nr];er.boneInverses.push(or.toArray())}return er}}class InstancedBufferAttribute extends BufferAttribute{constructor(er,tr,ir,nr=1){super(er,tr,ir),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=nr}copy(er){return super.copy(er),this.meshPerAttribute=er.meshPerAttribute,this}toJSON(){const er=super.toJSON();return er.meshPerAttribute=this.meshPerAttribute,er.isInstancedBufferAttribute=!0,er}}const _instanceLocalMatrix=new Matrix4,_instanceWorldMatrix=new Matrix4,_instanceIntersects=[],_box3=new Box3,_identity=new Matrix4,_mesh$1=new Mesh,_sphere$3=new Sphere;class InstancedMesh extends Mesh{constructor(er,tr,ir){super(er,tr),this.isInstancedMesh=!0,this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(ir*16),16),this.instanceColor=null,this.morphTexture=null,this.count=ir,this.boundingBox=null,this.boundingSphere=null;for(let nr=0;nr<ir;nr++)this.setMatrixAt(nr,_identity)}computeBoundingBox(){const er=this.geometry,tr=this.count;this.boundingBox===null&&(this.boundingBox=new Box3),er.boundingBox===null&&er.computeBoundingBox(),this.boundingBox.makeEmpty();for(let ir=0;ir<tr;ir++)this.getMatrixAt(ir,_instanceLocalMatrix),_box3.copy(er.boundingBox).applyMatrix4(_instanceLocalMatrix),this.boundingBox.union(_box3)}computeBoundingSphere(){const er=this.geometry,tr=this.count;this.boundingSphere===null&&(this.boundingSphere=new Sphere),er.boundingSphere===null&&er.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let ir=0;ir<tr;ir++)this.getMatrixAt(ir,_instanceLocalMatrix),_sphere$3.copy(er.boundingSphere).applyMatrix4(_instanceLocalMatrix),this.boundingSphere.union(_sphere$3)}copy(er,tr){return super.copy(er,tr),this.instanceMatrix.copy(er.instanceMatrix),er.morphTexture!==null&&(this.morphTexture=er.morphTexture.clone()),er.instanceColor!==null&&(this.instanceColor=er.instanceColor.clone()),this.count=er.count,er.boundingBox!==null&&(this.boundingBox=er.boundingBox.clone()),er.boundingSphere!==null&&(this.boundingSphere=er.boundingSphere.clone()),this}getColorAt(er,tr){tr.fromArray(this.instanceColor.array,er*3)}getMatrixAt(er,tr){tr.fromArray(this.instanceMatrix.array,er*16)}getMorphAt(er,tr){const ir=tr.morphTargetInfluences,nr=this.morphTexture.source.data.data,sr=ir.length+1,ar=er*sr+1;for(let or=0;or<ir.length;or++)ir[or]=nr[ar+or]}raycast(er,tr){const ir=this.matrixWorld,nr=this.count;if(_mesh$1.geometry=this.geometry,_mesh$1.material=this.material,_mesh$1.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),_sphere$3.copy(this.boundingSphere),_sphere$3.applyMatrix4(ir),er.ray.intersectsSphere(_sphere$3)!==!1))for(let sr=0;sr<nr;sr++){this.getMatrixAt(sr,_instanceLocalMatrix),_instanceWorldMatrix.multiplyMatrices(ir,_instanceLocalMatrix),_mesh$1.matrixWorld=_instanceWorldMatrix,_mesh$1.raycast(er,_instanceIntersects);for(let ar=0,or=_instanceIntersects.length;ar<or;ar++){const lr=_instanceIntersects[ar];lr.instanceId=sr,lr.object=this,tr.push(lr)}_instanceIntersects.length=0}}setColorAt(er,tr){this.instanceColor===null&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),tr.toArray(this.instanceColor.array,er*3)}setMatrixAt(er,tr){tr.toArray(this.instanceMatrix.array,er*16)}setMorphAt(er,tr){const ir=tr.morphTargetInfluences,nr=ir.length+1;this.morphTexture===null&&(this.morphTexture=new DataTexture(new Float32Array(nr*this.count),nr,this.count,RedFormat,FloatType));const sr=this.morphTexture.source.data.data;let ar=0;for(let cr=0;cr<ir.length;cr++)ar+=ir[cr];const or=this.geometry.morphTargetsRelative?1:1-ar,lr=nr*er;sr[lr]=or,sr.set(ir,lr+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}function ascIdSort(rr,er){return rr-er}function sortOpaque(rr,er){return rr.z-er.z}function sortTransparent(rr,er){return er.z-rr.z}class MultiDrawRenderList{constructor(){this.index=0,this.pool=[],this.list=[]}push(er,tr,ir,nr){const sr=this.pool,ar=this.list;this.index>=sr.length&&sr.push({start:-1,count:-1,z:-1,index:-1});const or=sr[this.index];ar.push(or),this.index++,or.start=er,or.count=tr,or.z=ir,or.index=nr}reset(){this.list.length=0,this.index=0}}const _matrix$1$1=new Matrix4,_whiteColor=new Color(1,1,1),_frustum$1=new Frustum,_box$1$1=new Box3,_sphere$2=new Sphere,_vector$5=new Vector3$1,_forward=new Vector3$1,_temp$1=new Vector3$1,_renderList=new MultiDrawRenderList,_mesh$2=new Mesh,_batchIntersects$1=[];function copyAttributeData(rr,er,tr=0){const ir=er.itemSize;if(rr.isInterleavedBufferAttribute||rr.array.constructor!==er.array.constructor){const nr=rr.count;for(let sr=0;sr<nr;sr++)for(let ar=0;ar<ir;ar++)er.setComponent(sr+tr,ar,rr.getComponent(sr,ar))}else er.array.set(rr.array,tr*ir);er.needsUpdate=!0}function copyArrayContents(rr,er){if(rr.constructor!==er.constructor){const tr=Math.min(rr.length,er.length);for(let ir=0;ir<tr;ir++)er[ir]=rr[ir]}else{const tr=Math.min(rr.length,er.length);er.set(new rr.constructor(rr.buffer,0,tr))}}class BatchedMesh extends Mesh{get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}constructor(er,tr,ir=tr*2,nr){super(new BufferGeometry,nr),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=er,this._maxVertexCount=tr,this._maxIndexCount=ir,this._multiDrawCounts=new Int32Array(er),this._multiDrawStarts=new Int32Array(er),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}_initMatricesTexture(){let er=Math.sqrt(this._maxInstanceCount*4);er=Math.ceil(er/4)*4,er=Math.max(er,4);const tr=new Float32Array(er*er*4),ir=new DataTexture(tr,er,er,RGBAFormat,FloatType);this._matricesTexture=ir}_initIndirectTexture(){let er=Math.sqrt(this._maxInstanceCount);er=Math.ceil(er);const tr=new Uint32Array(er*er),ir=new DataTexture(tr,er,er,RedIntegerFormat,UnsignedIntType);this._indirectTexture=ir}_initColorsTexture(){let er=Math.sqrt(this._maxInstanceCount);er=Math.ceil(er);const tr=new Float32Array(er*er*4).fill(1),ir=new DataTexture(tr,er,er,RGBAFormat,FloatType);ir.colorSpace=ColorManagement.workingColorSpace,this._colorsTexture=ir}_initializeGeometry(er){const tr=this.geometry,ir=this._maxVertexCount,nr=this._maxIndexCount;if(this._geometryInitialized===!1){for(const sr in er.attributes){const ar=er.getAttribute(sr),{array:or,itemSize:lr,normalized:cr}=ar,ur=new or.constructor(ir*lr),dr=new BufferAttribute(ur,lr,cr);tr.setAttribute(sr,dr)}if(er.getIndex()!==null){const sr=ir>65535?new Uint32Array(nr):new Uint16Array(nr);tr.setIndex(new BufferAttribute(sr,1))}this._geometryInitialized=!0}}_validateGeometry(er){const tr=this.geometry;if(!!er.getIndex()!=!!tr.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const ir in tr.attributes){if(!er.hasAttribute(ir))throw new Error(`BatchedMesh: Added geometry missing "${ir}". All geometries must have consistent attributes.`);const nr=er.getAttribute(ir),sr=tr.getAttribute(ir);if(nr.itemSize!==sr.itemSize||nr.normalized!==sr.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(er){return this.customSort=er,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.boundingBox,tr=this._instanceInfo;er.makeEmpty();for(let ir=0,nr=tr.length;ir<nr;ir++){if(tr[ir].active===!1)continue;const sr=tr[ir].geometryIndex;this.getMatrixAt(ir,_matrix$1$1),this.getBoundingBoxAt(sr,_box$1$1).applyMatrix4(_matrix$1$1),er.union(_box$1$1)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere);const er=this.boundingSphere,tr=this._instanceInfo;er.makeEmpty();for(let ir=0,nr=tr.length;ir<nr;ir++){if(tr[ir].active===!1)continue;const sr=tr[ir].geometryIndex;this.getMatrixAt(ir,_matrix$1$1),this.getBoundingSphereAt(sr,_sphere$2).applyMatrix4(_matrix$1$1),er.union(_sphere$2)}}addInstance(er){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("BatchedMesh: Maximum item count reached.");const ir={visible:!0,active:!0,geometryIndex:er};let nr=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(ascIdSort),nr=this._availableInstanceIds.shift(),this._instanceInfo[nr]=ir):(nr=this._instanceInfo.length,this._instanceInfo.push(ir));const sr=this._matricesTexture;_matrix$1$1.identity().toArray(sr.image.data,nr*16),sr.needsUpdate=!0;const ar=this._colorsTexture;return ar&&(_whiteColor.toArray(ar.image.data,nr*4),ar.needsUpdate=!0),this._visibilityChanged=!0,nr}addGeometry(er,tr=-1,ir=-1){this._initializeGeometry(er),this._validateGeometry(er);const nr={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},sr=this._geometryInfo;nr.vertexStart=this._nextVertexStart,nr.reservedVertexCount=tr===-1?er.getAttribute("position").count:tr;const ar=er.getIndex();if(ar!==null&&(nr.indexStart=this._nextIndexStart,nr.reservedIndexCount=ir===-1?ar.count:ir),nr.indexStart!==-1&&nr.indexStart+nr.reservedIndexCount>this._maxIndexCount||nr.vertexStart+nr.reservedVertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");let lr;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(ascIdSort),lr=this._availableGeometryIds.shift(),sr[lr]=nr):(lr=this._geometryCount,this._geometryCount++,sr.push(nr)),this.setGeometryAt(lr,er),this._nextIndexStart=nr.indexStart+nr.reservedIndexCount,this._nextVertexStart=nr.vertexStart+nr.reservedVertexCount,lr}setGeometryAt(er,tr){if(er>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(tr);const ir=this.geometry,nr=ir.getIndex()!==null,sr=ir.getIndex(),ar=tr.getIndex(),or=this._geometryInfo[er];if(nr&&ar.count>or.reservedIndexCount||tr.attributes.position.count>or.reservedVertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const lr=or.vertexStart,cr=or.reservedVertexCount;or.vertexCount=tr.getAttribute("position").count;for(const ur in ir.attributes){const dr=tr.getAttribute(ur),hr=ir.getAttribute(ur);copyAttributeData(dr,hr,lr);const pr=dr.itemSize;for(let gr=dr.count,vr=cr;gr<vr;gr++){const mr=lr+gr;for(let fr=0;fr<pr;fr++)hr.setComponent(mr,fr,0)}hr.needsUpdate=!0,hr.addUpdateRange(lr*pr,cr*pr)}if(nr){const ur=or.indexStart,dr=or.reservedIndexCount;or.indexCount=tr.getIndex().count;for(let hr=0;hr<ar.count;hr++)sr.setX(ur+hr,lr+ar.getX(hr));for(let hr=ar.count,pr=dr;hr<pr;hr++)sr.setX(ur+hr,lr);sr.needsUpdate=!0,sr.addUpdateRange(ur,or.reservedIndexCount)}return or.start=nr?or.indexStart:or.vertexStart,or.count=nr?or.indexCount:or.vertexCount,or.boundingBox=null,tr.boundingBox!==null&&(or.boundingBox=tr.boundingBox.clone()),or.boundingSphere=null,tr.boundingSphere!==null&&(or.boundingSphere=tr.boundingSphere.clone()),this._visibilityChanged=!0,er}deleteGeometry(er){const tr=this._geometryInfo;if(er>=tr.length||tr[er].active===!1)return this;const ir=this._instanceInfo;for(let nr=0,sr=ir.length;nr<sr;nr++)ir[nr].geometryIndex===er&&this.deleteInstance(nr);return tr[er].active=!1,this._availableGeometryIds.push(er),this._visibilityChanged=!0,this}deleteInstance(er){const tr=this._instanceInfo;return er>=tr.length||tr[er].active===!1?this:(tr[er].active=!1,this._availableInstanceIds.push(er),this._visibilityChanged=!0,this)}optimize(){let er=0,tr=0;const ir=this._geometryInfo,nr=ir.map((ar,or)=>or).sort((ar,or)=>ir[ar].vertexStart-ir[or].vertexStart),sr=this.geometry;for(let ar=0,or=ir.length;ar<or;ar++){const lr=nr[ar],cr=ir[lr];if(cr.active!==!1){if(sr.index!==null){if(cr.indexStart!==tr){const{indexStart:ur,vertexStart:dr,reservedIndexCount:hr}=cr,pr=sr.index,gr=pr.array,vr=er-dr;for(let mr=ur;mr<ur+hr;mr++)gr[mr]=gr[mr]+vr;pr.array.copyWithin(tr,ur,ur+hr),pr.addUpdateRange(tr,hr),cr.indexStart=tr}tr+=cr.reservedIndexCount}if(cr.vertexStart!==er){const{vertexStart:ur,reservedVertexCount:dr}=cr,hr=sr.attributes;for(const pr in hr){const gr=hr[pr],{array:vr,itemSize:mr}=gr;vr.copyWithin(er*mr,ur*mr,(ur+dr)*mr),gr.addUpdateRange(er*mr,dr*mr)}cr.vertexStart=er}er+=cr.reservedVertexCount,cr.start=sr.index?cr.indexStart:cr.vertexStart,this._nextIndexStart=sr.index?cr.indexStart+cr.reservedIndexCount:0,this._nextVertexStart=cr.vertexStart+cr.reservedVertexCount}}return this}getBoundingBoxAt(er,tr){if(er>=this._geometryCount)return null;const ir=this.geometry,nr=this._geometryInfo[er];if(nr.boundingBox===null){const sr=new Box3,ar=ir.index,or=ir.attributes.position;for(let lr=nr.start,cr=nr.start+nr.count;lr<cr;lr++){let ur=lr;ar&&(ur=ar.getX(ur)),sr.expandByPoint(_vector$5.fromBufferAttribute(or,ur))}nr.boundingBox=sr}return tr.copy(nr.boundingBox),tr}getBoundingSphereAt(er,tr){if(er>=this._geometryCount)return null;const ir=this.geometry,nr=this._geometryInfo[er];if(nr.boundingSphere===null){const sr=new Sphere;this.getBoundingBoxAt(er,_box$1$1),_box$1$1.getCenter(sr.center);const ar=ir.index,or=ir.attributes.position;let lr=0;for(let cr=nr.start,ur=nr.start+nr.count;cr<ur;cr++){let dr=cr;ar&&(dr=ar.getX(dr)),_vector$5.fromBufferAttribute(or,dr),lr=Math.max(lr,sr.center.distanceToSquared(_vector$5))}sr.radius=Math.sqrt(lr),nr.boundingSphere=sr}return tr.copy(nr.boundingSphere),tr}setMatrixAt(er,tr){const ir=this._instanceInfo,nr=this._matricesTexture,sr=this._matricesTexture.image.data;return er>=ir.length||ir[er].active===!1?this:(tr.toArray(sr,er*16),nr.needsUpdate=!0,this)}getMatrixAt(er,tr){const ir=this._instanceInfo,nr=this._matricesTexture.image.data;return er>=ir.length||ir[er].active===!1?null:tr.fromArray(nr,er*16)}setColorAt(er,tr){this._colorsTexture===null&&this._initColorsTexture();const ir=this._colorsTexture,nr=this._colorsTexture.image.data,sr=this._instanceInfo;return er>=sr.length||sr[er].active===!1?this:(tr.toArray(nr,er*4),ir.needsUpdate=!0,this)}getColorAt(er,tr){const ir=this._colorsTexture.image.data,nr=this._instanceInfo;return er>=nr.length||nr[er].active===!1?null:tr.fromArray(ir,er*4)}setVisibleAt(er,tr){const ir=this._instanceInfo;return er>=ir.length||ir[er].active===!1||ir[er].visible===tr?this:(ir[er].visible=tr,this._visibilityChanged=!0,this)}getVisibleAt(er){const tr=this._instanceInfo;return er>=tr.length||tr[er].active===!1?!1:tr[er].visible}setGeometryIdAt(er,tr){const ir=this._instanceInfo,nr=this._geometryInfo;return er>=ir.length||ir[er].active===!1||tr>=nr.length||nr[tr].active===!1?null:(ir[er].geometryIndex=tr,this)}getGeometryIdAt(er){const tr=this._instanceInfo;return er>=tr.length||tr[er].active===!1?-1:tr[er].geometryIndex}getGeometryRangeAt(er,tr={}){if(er<0||er>=this._geometryCount)return null;const ir=this._geometryInfo[er];return tr.vertexStart=ir.vertexStart,tr.vertexCount=ir.vertexCount,tr.reservedVertexCount=ir.reservedVertexCount,tr.indexStart=ir.indexStart,tr.indexCount=ir.indexCount,tr.reservedIndexCount=ir.reservedIndexCount,tr.start=ir.start,tr.count=ir.count,tr}setInstanceCount(er){const tr=this._availableInstanceIds,ir=this._instanceInfo;for(tr.sort(ascIdSort);tr[tr.length-1]===ir.length;)ir.pop(),tr.pop();if(er<ir.length)throw new Error(`BatchedMesh: Instance ids outside the range ${er} are being used. Cannot shrink instance count.`);const nr=new Int32Array(er),sr=new Int32Array(er);copyArrayContents(this._multiDrawCounts,nr),copyArrayContents(this._multiDrawStarts,sr),this._multiDrawCounts=nr,this._multiDrawStarts=sr,this._maxInstanceCount=er;const ar=this._indirectTexture,or=this._matricesTexture,lr=this._colorsTexture;ar.dispose(),this._initIndirectTexture(),copyArrayContents(ar.image.data,this._indirectTexture.image.data),or.dispose(),this._initMatricesTexture(),copyArrayContents(or.image.data,this._matricesTexture.image.data),lr&&(lr.dispose(),this._initColorsTexture(),copyArrayContents(lr.image.data,this._colorsTexture.image.data))}setGeometrySize(er,tr){const ir=[...this._geometryInfo].filter(or=>or.active);if(Math.max(...ir.map(or=>or.vertexStart+or.reservedVertexCount))>er)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${tr}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...ir.map(lr=>lr.indexStart+lr.reservedIndexCount))>tr)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${tr}. Cannot shrink further.`);const sr=this.geometry;sr.dispose(),this._maxVertexCount=er,this._maxIndexCount=tr,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new BufferGeometry,this._initializeGeometry(sr));const ar=this.geometry;sr.index&&copyArrayContents(sr.index.array,ar.index.array);for(const or in sr.attributes)copyArrayContents(sr.attributes[or].array,ar.attributes[or].array)}raycast(er,tr){const ir=this._instanceInfo,nr=this._geometryInfo,sr=this.matrixWorld,ar=this.geometry;_mesh$2.material=this.material,_mesh$2.geometry.index=ar.index,_mesh$2.geometry.attributes=ar.attributes,_mesh$2.geometry.boundingBox===null&&(_mesh$2.geometry.boundingBox=new Box3),_mesh$2.geometry.boundingSphere===null&&(_mesh$2.geometry.boundingSphere=new Sphere);for(let or=0,lr=ir.length;or<lr;or++){if(!ir[or].visible||!ir[or].active)continue;const cr=ir[or].geometryIndex,ur=nr[cr];_mesh$2.geometry.setDrawRange(ur.start,ur.count),this.getMatrixAt(or,_mesh$2.matrixWorld).premultiply(sr),this.getBoundingBoxAt(cr,_mesh$2.geometry.boundingBox),this.getBoundingSphereAt(cr,_mesh$2.geometry.boundingSphere),_mesh$2.raycast(er,_batchIntersects$1);for(let dr=0,hr=_batchIntersects$1.length;dr<hr;dr++){const pr=_batchIntersects$1[dr];pr.object=this,pr.batchId=or,tr.push(pr)}_batchIntersects$1.length=0}_mesh$2.material=null,_mesh$2.geometry.index=null,_mesh$2.geometry.attributes={},_mesh$2.geometry.setDrawRange(0,1/0)}copy(er){return super.copy(er),this.geometry=er.geometry.clone(),this.perObjectFrustumCulled=er.perObjectFrustumCulled,this.sortObjects=er.sortObjects,this.boundingBox=er.boundingBox!==null?er.boundingBox.clone():null,this.boundingSphere=er.boundingSphere!==null?er.boundingSphere.clone():null,this._geometryInfo=er._geometryInfo.map(tr=>({...tr,boundingBox:tr.boundingBox!==null?tr.boundingBox.clone():null,boundingSphere:tr.boundingSphere!==null?tr.boundingSphere.clone():null})),this._instanceInfo=er._instanceInfo.map(tr=>({...tr})),this._maxInstanceCount=er._maxInstanceCount,this._maxVertexCount=er._maxVertexCount,this._maxIndexCount=er._maxIndexCount,this._geometryInitialized=er._geometryInitialized,this._geometryCount=er._geometryCount,this._multiDrawCounts=er._multiDrawCounts.slice(),this._multiDrawStarts=er._multiDrawStarts.slice(),this._matricesTexture=er._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=er._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(er,tr,ir,nr,sr){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const ar=nr.getIndex(),or=ar===null?1:ar.array.BYTES_PER_ELEMENT,lr=this._instanceInfo,cr=this._multiDrawStarts,ur=this._multiDrawCounts,dr=this._geometryInfo,hr=this.perObjectFrustumCulled,pr=this._indirectTexture,gr=pr.image.data;hr&&(_matrix$1$1.multiplyMatrices(ir.projectionMatrix,ir.matrixWorldInverse).multiply(this.matrixWorld),_frustum$1.setFromProjectionMatrix(_matrix$1$1,er.coordinateSystem));let vr=0;if(this.sortObjects){_matrix$1$1.copy(this.matrixWorld).invert(),_vector$5.setFromMatrixPosition(ir.matrixWorld).applyMatrix4(_matrix$1$1),_forward.set(0,0,-1).transformDirection(ir.matrixWorld).transformDirection(_matrix$1$1);for(let _r=0,Ar=lr.length;_r<Ar;_r++)if(lr[_r].visible&&lr[_r].active){const yr=lr[_r].geometryIndex;this.getMatrixAt(_r,_matrix$1$1),this.getBoundingSphereAt(yr,_sphere$2).applyMatrix4(_matrix$1$1);let wr=!1;if(hr&&(wr=!_frustum$1.intersectsSphere(_sphere$2)),!wr){const xr=dr[yr],Sr=_temp$1.subVectors(_sphere$2.center,_vector$5).dot(_forward);_renderList.push(xr.start,xr.count,Sr,_r)}}const mr=_renderList.list,fr=this.customSort;fr===null?mr.sort(sr.transparent?sortTransparent:sortOpaque):fr.call(this,mr,ir);for(let _r=0,Ar=mr.length;_r<Ar;_r++){const yr=mr[_r];cr[vr]=yr.start*or,ur[vr]=yr.count,gr[vr]=yr.index,vr++}_renderList.reset()}else for(let mr=0,fr=lr.length;mr<fr;mr++)if(lr[mr].visible&&lr[mr].active){const _r=lr[mr].geometryIndex;let Ar=!1;if(hr&&(this.getMatrixAt(mr,_matrix$1$1),this.getBoundingSphereAt(_r,_sphere$2).applyMatrix4(_matrix$1$1),Ar=!_frustum$1.intersectsSphere(_sphere$2)),!Ar){const yr=dr[_r];cr[vr]=yr.start*or,ur[vr]=yr.count,gr[vr]=mr,vr++}}pr.needsUpdate=!0,this._multiDrawCount=vr,this._visibilityChanged=!1}onBeforeShadow(er,tr,ir,nr,sr,ar){this.onBeforeRender(er,null,nr,sr,ar)}}class LineBasicMaterial extends Material{static get type(){return"LineBasicMaterial"}constructor(er){super(),this.isLineBasicMaterial=!0,this.color=new Color(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.linewidth=er.linewidth,this.linecap=er.linecap,this.linejoin=er.linejoin,this.fog=er.fog,this}}const _vStart=new Vector3$1,_vEnd=new Vector3$1,_inverseMatrix$1=new Matrix4,_ray$1$1=new Ray$1,_sphere$1$1=new Sphere,_intersectPointOnRay=new Vector3$1,_intersectPointOnSegment=new Vector3$1;class Line extends Object3D{constructor(er=new BufferGeometry,tr=new LineBasicMaterial){super(),this.isLine=!0,this.type="Line",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}computeLineDistances(){const er=this.geometry;if(er.index===null){const tr=er.attributes.position,ir=[0];for(let nr=1,sr=tr.count;nr<sr;nr++)_vStart.fromBufferAttribute(tr,nr-1),_vEnd.fromBufferAttribute(tr,nr),ir[nr]=ir[nr-1],ir[nr]+=_vStart.distanceTo(_vEnd);er.setAttribute("lineDistance",new Float32BufferAttribute(ir,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(er,tr){const ir=this.geometry,nr=this.matrixWorld,sr=er.params.Line.threshold,ar=ir.drawRange;if(ir.boundingSphere===null&&ir.computeBoundingSphere(),_sphere$1$1.copy(ir.boundingSphere),_sphere$1$1.applyMatrix4(nr),_sphere$1$1.radius+=sr,er.ray.intersectsSphere(_sphere$1$1)===!1)return;_inverseMatrix$1.copy(nr).invert(),_ray$1$1.copy(er.ray).applyMatrix4(_inverseMatrix$1);const or=sr/((this.scale.x+this.scale.y+this.scale.z)/3),lr=or*or,cr=this.isLineSegments?2:1,ur=ir.index,hr=ir.attributes.position;if(ur!==null){const pr=Math.max(0,ar.start),gr=Math.min(ur.count,ar.start+ar.count);for(let vr=pr,mr=gr-1;vr<mr;vr+=cr){const fr=ur.getX(vr),_r=ur.getX(vr+1),Ar=checkIntersection$2(this,er,_ray$1$1,lr,fr,_r);Ar&&tr.push(Ar)}if(this.isLineLoop){const vr=ur.getX(gr-1),mr=ur.getX(pr),fr=checkIntersection$2(this,er,_ray$1$1,lr,vr,mr);fr&&tr.push(fr)}}else{const pr=Math.max(0,ar.start),gr=Math.min(hr.count,ar.start+ar.count);for(let vr=pr,mr=gr-1;vr<mr;vr+=cr){const fr=checkIntersection$2(this,er,_ray$1$1,lr,vr,vr+1);fr&&tr.push(fr)}if(this.isLineLoop){const vr=checkIntersection$2(this,er,_ray$1$1,lr,gr-1,pr);vr&&tr.push(vr)}}}updateMorphTargets(){const tr=this.geometry.morphAttributes,ir=Object.keys(tr);if(ir.length>0){const nr=tr[ir[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}}function checkIntersection$2(rr,er,tr,ir,nr,sr){const ar=rr.geometry.attributes.position;if(_vStart.fromBufferAttribute(ar,nr),_vEnd.fromBufferAttribute(ar,sr),tr.distanceSqToSegment(_vStart,_vEnd,_intersectPointOnRay,_intersectPointOnSegment)>ir)return;_intersectPointOnRay.applyMatrix4(rr.matrixWorld);const lr=er.ray.origin.distanceTo(_intersectPointOnRay);if(!(lr<er.near||lr>er.far))return{distance:lr,point:_intersectPointOnSegment.clone().applyMatrix4(rr.matrixWorld),index:nr,face:null,faceIndex:null,barycoord:null,object:rr}}const _start$2=new Vector3$1,_end$2=new Vector3$1;class LineSegments extends Line{constructor(er,tr){super(er,tr),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const er=this.geometry;if(er.index===null){const tr=er.attributes.position,ir=[];for(let nr=0,sr=tr.count;nr<sr;nr+=2)_start$2.fromBufferAttribute(tr,nr),_end$2.fromBufferAttribute(tr,nr+1),ir[nr]=nr===0?0:ir[nr-1],ir[nr+1]=ir[nr]+_start$2.distanceTo(_end$2);er.setAttribute("lineDistance",new Float32BufferAttribute(ir,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class LineLoop extends Line{constructor(er,tr){super(er,tr),this.isLineLoop=!0,this.type="LineLoop"}}class PointsMaterial extends Material{static get type(){return"PointsMaterial"}constructor(er){super(),this.isPointsMaterial=!0,this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.alphaMap=er.alphaMap,this.size=er.size,this.sizeAttenuation=er.sizeAttenuation,this.fog=er.fog,this}}const _inverseMatrix$4=new Matrix4,_ray$4=new Ray$1,_sphere$7=new Sphere,_position$2$1=new Vector3$1;class Points extends Object3D{constructor(er=new BufferGeometry,tr=new PointsMaterial){super(),this.isPoints=!0,this.type="Points",this.geometry=er,this.material=tr,this.updateMorphTargets()}copy(er,tr){return super.copy(er,tr),this.material=Array.isArray(er.material)?er.material.slice():er.material,this.geometry=er.geometry,this}raycast(er,tr){const ir=this.geometry,nr=this.matrixWorld,sr=er.params.Points.threshold,ar=ir.drawRange;if(ir.boundingSphere===null&&ir.computeBoundingSphere(),_sphere$7.copy(ir.boundingSphere),_sphere$7.applyMatrix4(nr),_sphere$7.radius+=sr,er.ray.intersectsSphere(_sphere$7)===!1)return;_inverseMatrix$4.copy(nr).invert(),_ray$4.copy(er.ray).applyMatrix4(_inverseMatrix$4);const or=sr/((this.scale.x+this.scale.y+this.scale.z)/3),lr=or*or,cr=ir.index,dr=ir.attributes.position;if(cr!==null){const hr=Math.max(0,ar.start),pr=Math.min(cr.count,ar.start+ar.count);for(let gr=hr,vr=pr;gr<vr;gr++){const mr=cr.getX(gr);_position$2$1.fromBufferAttribute(dr,mr),testPoint(_position$2$1,mr,lr,nr,er,tr,this)}}else{const hr=Math.max(0,ar.start),pr=Math.min(dr.count,ar.start+ar.count);for(let gr=hr,vr=pr;gr<vr;gr++)_position$2$1.fromBufferAttribute(dr,gr),testPoint(_position$2$1,gr,lr,nr,er,tr,this)}}updateMorphTargets(){const tr=this.geometry.morphAttributes,ir=Object.keys(tr);if(ir.length>0){const nr=tr[ir[0]];if(nr!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr].name||String(sr);this.morphTargetInfluences.push(0),this.morphTargetDictionary[or]=sr}}}}}function testPoint(rr,er,tr,ir,nr,sr,ar){const or=_ray$4.distanceSqToPoint(rr);if(or<tr){const lr=new Vector3$1;_ray$4.closestPointToPoint(rr,lr),lr.applyMatrix4(ir);const cr=nr.ray.origin.distanceTo(lr);if(cr<nr.near||cr>nr.far)return;sr.push({distance:cr,distanceToRay:Math.sqrt(or),point:lr,index:er,face:null,faceIndex:null,barycoord:null,object:ar})}}class VideoTexture extends Texture{constructor(er,tr,ir,nr,sr,ar,or,lr,cr){super(er,tr,ir,nr,sr,ar,or,lr,cr),this.isVideoTexture=!0,this.minFilter=ar!==void 0?ar:LinearFilter,this.magFilter=sr!==void 0?sr:LinearFilter,this.generateMipmaps=!1;const ur=this;function dr(){ur.needsUpdate=!0,er.requestVideoFrameCallback(dr)}"requestVideoFrameCallback"in er&&er.requestVideoFrameCallback(dr)}clone(){return new this.constructor(this.image).copy(this)}update(){const er=this.image;"requestVideoFrameCallback"in er===!1&&er.readyState>=er.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class FramebufferTexture extends Texture{constructor(er,tr){super({width:er,height:tr}),this.isFramebufferTexture=!0,this.magFilter=NearestFilter,this.minFilter=NearestFilter,this.generateMipmaps=!1,this.needsUpdate=!0}}class CompressedTexture extends Texture{constructor(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr){super(null,ar,or,lr,cr,ur,nr,sr,dr,hr),this.isCompressedTexture=!0,this.image={width:tr,height:ir},this.mipmaps=er,this.flipY=!1,this.generateMipmaps=!1}}class CompressedArrayTexture extends CompressedTexture{constructor(er,tr,ir,nr,sr,ar){super(er,tr,ir,sr,ar),this.isCompressedArrayTexture=!0,this.image.depth=nr,this.wrapR=ClampToEdgeWrapping,this.layerUpdates=new Set}addLayerUpdate(er){this.layerUpdates.add(er)}clearLayerUpdates(){this.layerUpdates.clear()}}class CompressedCubeTexture extends CompressedTexture{constructor(er,tr,ir){super(void 0,er[0].width,er[0].height,tr,ir,CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=er}}class CanvasTexture extends Texture{constructor(er,tr,ir,nr,sr,ar,or,lr,cr){super(er,tr,ir,nr,sr,ar,or,lr,cr),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(er,tr){const ir=this.getUtoTmapping(er);return this.getPoint(ir,tr)}getPoints(er=5){const tr=[];for(let ir=0;ir<=er;ir++)tr.push(this.getPoint(ir/er));return tr}getSpacedPoints(er=5){const tr=[];for(let ir=0;ir<=er;ir++)tr.push(this.getPointAt(ir/er));return tr}getLength(){const er=this.getLengths();return er[er.length-1]}getLengths(er=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===er+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const tr=[];let ir,nr=this.getPoint(0),sr=0;tr.push(0);for(let ar=1;ar<=er;ar++)ir=this.getPoint(ar/er),sr+=ir.distanceTo(nr),tr.push(sr),nr=ir;return this.cacheArcLengths=tr,tr}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(er,tr){const ir=this.getLengths();let nr=0;const sr=ir.length;let ar;tr?ar=tr:ar=er*ir[sr-1];let or=0,lr=sr-1,cr;for(;or<=lr;)if(nr=Math.floor(or+(lr-or)/2),cr=ir[nr]-ar,cr<0)or=nr+1;else if(cr>0)lr=nr-1;else{lr=nr;break}if(nr=lr,ir[nr]===ar)return nr/(sr-1);const ur=ir[nr],hr=ir[nr+1]-ur,pr=(ar-ur)/hr;return(nr+pr)/(sr-1)}getTangent(er,tr){let nr=er-1e-4,sr=er+1e-4;nr<0&&(nr=0),sr>1&&(sr=1);const ar=this.getPoint(nr),or=this.getPoint(sr),lr=tr||(ar.isVector2?new Vector2:new Vector3$1);return lr.copy(or).sub(ar).normalize(),lr}getTangentAt(er,tr){const ir=this.getUtoTmapping(er);return this.getTangent(ir,tr)}computeFrenetFrames(er,tr){const ir=new Vector3$1,nr=[],sr=[],ar=[],or=new Vector3$1,lr=new Matrix4;for(let pr=0;pr<=er;pr++){const gr=pr/er;nr[pr]=this.getTangentAt(gr,new Vector3$1)}sr[0]=new Vector3$1,ar[0]=new Vector3$1;let cr=Number.MAX_VALUE;const ur=Math.abs(nr[0].x),dr=Math.abs(nr[0].y),hr=Math.abs(nr[0].z);ur<=cr&&(cr=ur,ir.set(1,0,0)),dr<=cr&&(cr=dr,ir.set(0,1,0)),hr<=cr&&ir.set(0,0,1),or.crossVectors(nr[0],ir).normalize(),sr[0].crossVectors(nr[0],or),ar[0].crossVectors(nr[0],sr[0]);for(let pr=1;pr<=er;pr++){if(sr[pr]=sr[pr-1].clone(),ar[pr]=ar[pr-1].clone(),or.crossVectors(nr[pr-1],nr[pr]),or.length()>Number.EPSILON){or.normalize();const gr=Math.acos(clamp(nr[pr-1].dot(nr[pr]),-1,1));sr[pr].applyMatrix4(lr.makeRotationAxis(or,gr))}ar[pr].crossVectors(nr[pr],sr[pr])}if(tr===!0){let pr=Math.acos(clamp(sr[0].dot(sr[er]),-1,1));pr/=er,nr[0].dot(or.crossVectors(sr[0],sr[er]))>0&&(pr=-pr);for(let gr=1;gr<=er;gr++)sr[gr].applyMatrix4(lr.makeRotationAxis(nr[gr],pr*gr)),ar[gr].crossVectors(nr[gr],sr[gr])}return{tangents:nr,normals:sr,binormals:ar}}clone(){return new this.constructor().copy(this)}copy(er){return this.arcLengthDivisions=er.arcLengthDivisions,this}toJSON(){const er={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return er.arcLengthDivisions=this.arcLengthDivisions,er.type=this.type,er}fromJSON(er){return this.arcLengthDivisions=er.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(er=0,tr=0,ir=1,nr=1,sr=0,ar=Math.PI*2,or=!1,lr=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=er,this.aY=tr,this.xRadius=ir,this.yRadius=nr,this.aStartAngle=sr,this.aEndAngle=ar,this.aClockwise=or,this.aRotation=lr}getPoint(er,tr=new Vector2){const ir=tr,nr=Math.PI*2;let sr=this.aEndAngle-this.aStartAngle;const ar=Math.abs(sr)<Number.EPSILON;for(;sr<0;)sr+=nr;for(;sr>nr;)sr-=nr;sr<Number.EPSILON&&(ar?sr=0:sr=nr),this.aClockwise===!0&&!ar&&(sr===nr?sr=-nr:sr=sr-nr);const or=this.aStartAngle+er*sr;let lr=this.aX+this.xRadius*Math.cos(or),cr=this.aY+this.yRadius*Math.sin(or);if(this.aRotation!==0){const ur=Math.cos(this.aRotation),dr=Math.sin(this.aRotation),hr=lr-this.aX,pr=cr-this.aY;lr=hr*ur-pr*dr+this.aX,cr=hr*dr+pr*ur+this.aY}return ir.set(lr,cr)}copy(er){return super.copy(er),this.aX=er.aX,this.aY=er.aY,this.xRadius=er.xRadius,this.yRadius=er.yRadius,this.aStartAngle=er.aStartAngle,this.aEndAngle=er.aEndAngle,this.aClockwise=er.aClockwise,this.aRotation=er.aRotation,this}toJSON(){const er=super.toJSON();return er.aX=this.aX,er.aY=this.aY,er.xRadius=this.xRadius,er.yRadius=this.yRadius,er.aStartAngle=this.aStartAngle,er.aEndAngle=this.aEndAngle,er.aClockwise=this.aClockwise,er.aRotation=this.aRotation,er}fromJSON(er){return super.fromJSON(er),this.aX=er.aX,this.aY=er.aY,this.xRadius=er.xRadius,this.yRadius=er.yRadius,this.aStartAngle=er.aStartAngle,this.aEndAngle=er.aEndAngle,this.aClockwise=er.aClockwise,this.aRotation=er.aRotation,this}}class ArcCurve extends EllipseCurve{constructor(er,tr,ir,nr,sr,ar){super(er,tr,ir,ir,nr,sr,ar),this.isArcCurve=!0,this.type="ArcCurve"}}function CubicPoly(){let rr=0,er=0,tr=0,ir=0;function nr(sr,ar,or,lr){rr=sr,er=or,tr=-3*sr+3*ar-2*or-lr,ir=2*sr-2*ar+or+lr}return{initCatmullRom:function(sr,ar,or,lr,cr){nr(ar,or,cr*(or-sr),cr*(lr-ar))},initNonuniformCatmullRom:function(sr,ar,or,lr,cr,ur,dr){let hr=(ar-sr)/cr-(or-sr)/(cr+ur)+(or-ar)/ur,pr=(or-ar)/ur-(lr-ar)/(ur+dr)+(lr-or)/dr;hr*=ur,pr*=ur,nr(ar,or,hr,pr)},calc:function(sr){const ar=sr*sr,or=ar*sr;return rr+er*sr+tr*ar+ir*or}}}const tmp=new Vector3$1,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;class CatmullRomCurve3 extends Curve{constructor(er=[],tr=!1,ir="centripetal",nr=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=er,this.closed=tr,this.curveType=ir,this.tension=nr}getPoint(er,tr=new Vector3$1){const ir=tr,nr=this.points,sr=nr.length,ar=(sr-(this.closed?0:1))*er;let or=Math.floor(ar),lr=ar-or;this.closed?or+=or>0?0:(Math.floor(Math.abs(or)/sr)+1)*sr:lr===0&&or===sr-1&&(or=sr-2,lr=1);let cr,ur;this.closed||or>0?cr=nr[(or-1)%sr]:(tmp.subVectors(nr[0],nr[1]).add(nr[0]),cr=tmp);const dr=nr[or%sr],hr=nr[(or+1)%sr];if(this.closed||or+2<sr?ur=nr[(or+2)%sr]:(tmp.subVectors(nr[sr-1],nr[sr-2]).add(nr[sr-1]),ur=tmp),this.curveType==="centripetal"||this.curveType==="chordal"){const pr=this.curveType==="chordal"?.5:.25;let gr=Math.pow(cr.distanceToSquared(dr),pr),vr=Math.pow(dr.distanceToSquared(hr),pr),mr=Math.pow(hr.distanceToSquared(ur),pr);vr<1e-4&&(vr=1),gr<1e-4&&(gr=vr),mr<1e-4&&(mr=vr),px.initNonuniformCatmullRom(cr.x,dr.x,hr.x,ur.x,gr,vr,mr),py.initNonuniformCatmullRom(cr.y,dr.y,hr.y,ur.y,gr,vr,mr),pz.initNonuniformCatmullRom(cr.z,dr.z,hr.z,ur.z,gr,vr,mr)}else this.curveType==="catmullrom"&&(px.initCatmullRom(cr.x,dr.x,hr.x,ur.x,this.tension),py.initCatmullRom(cr.y,dr.y,hr.y,ur.y,this.tension),pz.initCatmullRom(cr.z,dr.z,hr.z,ur.z,this.tension));return ir.set(px.calc(lr),py.calc(lr),pz.calc(lr)),ir}copy(er){super.copy(er),this.points=[];for(let tr=0,ir=er.points.length;tr<ir;tr++){const nr=er.points[tr];this.points.push(nr.clone())}return this.closed=er.closed,this.curveType=er.curveType,this.tension=er.tension,this}toJSON(){const er=super.toJSON();er.points=[];for(let tr=0,ir=this.points.length;tr<ir;tr++){const nr=this.points[tr];er.points.push(nr.toArray())}return er.closed=this.closed,er.curveType=this.curveType,er.tension=this.tension,er}fromJSON(er){super.fromJSON(er),this.points=[];for(let tr=0,ir=er.points.length;tr<ir;tr++){const nr=er.points[tr];this.points.push(new Vector3$1().fromArray(nr))}return this.closed=er.closed,this.curveType=er.curveType,this.tension=er.tension,this}}function CatmullRom(rr,er,tr,ir,nr){const sr=(ir-er)*.5,ar=(nr-tr)*.5,or=rr*rr,lr=rr*or;return(2*tr-2*ir+sr+ar)*lr+(-3*tr+3*ir-2*sr-ar)*or+sr*rr+tr}function QuadraticBezierP0(rr,er){const tr=1-rr;return tr*tr*er}function QuadraticBezierP1(rr,er){return 2*(1-rr)*rr*er}function QuadraticBezierP2(rr,er){return rr*rr*er}function QuadraticBezier(rr,er,tr,ir){return QuadraticBezierP0(rr,er)+QuadraticBezierP1(rr,tr)+QuadraticBezierP2(rr,ir)}function CubicBezierP0(rr,er){const tr=1-rr;return tr*tr*tr*er}function CubicBezierP1(rr,er){const tr=1-rr;return 3*tr*tr*rr*er}function CubicBezierP2(rr,er){return 3*(1-rr)*rr*rr*er}function CubicBezierP3(rr,er){return rr*rr*rr*er}function CubicBezier(rr,er,tr,ir,nr){return CubicBezierP0(rr,er)+CubicBezierP1(rr,tr)+CubicBezierP2(rr,ir)+CubicBezierP3(rr,nr)}class CubicBezierCurve extends Curve{constructor(er=new Vector2,tr=new Vector2,ir=new Vector2,nr=new Vector2){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=er,this.v1=tr,this.v2=ir,this.v3=nr}getPoint(er,tr=new Vector2){const ir=tr,nr=this.v0,sr=this.v1,ar=this.v2,or=this.v3;return ir.set(CubicBezier(er,nr.x,sr.x,ar.x,or.x),CubicBezier(er,nr.y,sr.y,ar.y,or.y)),ir}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this.v3.copy(er.v3),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er.v3=this.v3.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this.v3.fromArray(er.v3),this}}class CubicBezierCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1,ir=new Vector3$1,nr=new Vector3$1){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=er,this.v1=tr,this.v2=ir,this.v3=nr}getPoint(er,tr=new Vector3$1){const ir=tr,nr=this.v0,sr=this.v1,ar=this.v2,or=this.v3;return ir.set(CubicBezier(er,nr.x,sr.x,ar.x,or.x),CubicBezier(er,nr.y,sr.y,ar.y,or.y),CubicBezier(er,nr.z,sr.z,ar.z,or.z)),ir}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this.v3.copy(er.v3),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er.v3=this.v3.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this.v3.fromArray(er.v3),this}}class LineCurve extends Curve{constructor(er=new Vector2,tr=new Vector2){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=er,this.v2=tr}getPoint(er,tr=new Vector2){const ir=tr;return er===1?ir.copy(this.v2):(ir.copy(this.v2).sub(this.v1),ir.multiplyScalar(er).add(this.v1)),ir}getPointAt(er,tr){return this.getPoint(er,tr)}getTangent(er,tr=new Vector2){return tr.subVectors(this.v2,this.v1).normalize()}getTangentAt(er,tr){return this.getTangent(er,tr)}copy(er){return super.copy(er),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class LineCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=er,this.v2=tr}getPoint(er,tr=new Vector3$1){const ir=tr;return er===1?ir.copy(this.v2):(ir.copy(this.v2).sub(this.v1),ir.multiplyScalar(er).add(this.v1)),ir}getPointAt(er,tr){return this.getPoint(er,tr)}getTangent(er,tr=new Vector3$1){return tr.subVectors(this.v2,this.v1).normalize()}getTangentAt(er,tr){return this.getTangent(er,tr)}copy(er){return super.copy(er),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class QuadraticBezierCurve extends Curve{constructor(er=new Vector2,tr=new Vector2,ir=new Vector2){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=er,this.v1=tr,this.v2=ir}getPoint(er,tr=new Vector2){const ir=tr,nr=this.v0,sr=this.v1,ar=this.v2;return ir.set(QuadraticBezier(er,nr.x,sr.x,ar.x),QuadraticBezier(er,nr.y,sr.y,ar.y)),ir}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class QuadraticBezierCurve3 extends Curve{constructor(er=new Vector3$1,tr=new Vector3$1,ir=new Vector3$1){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=er,this.v1=tr,this.v2=ir}getPoint(er,tr=new Vector3$1){const ir=tr,nr=this.v0,sr=this.v1,ar=this.v2;return ir.set(QuadraticBezier(er,nr.x,sr.x,ar.x),QuadraticBezier(er,nr.y,sr.y,ar.y),QuadraticBezier(er,nr.z,sr.z,ar.z)),ir}copy(er){return super.copy(er),this.v0.copy(er.v0),this.v1.copy(er.v1),this.v2.copy(er.v2),this}toJSON(){const er=super.toJSON();return er.v0=this.v0.toArray(),er.v1=this.v1.toArray(),er.v2=this.v2.toArray(),er}fromJSON(er){return super.fromJSON(er),this.v0.fromArray(er.v0),this.v1.fromArray(er.v1),this.v2.fromArray(er.v2),this}}class SplineCurve extends Curve{constructor(er=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=er}getPoint(er,tr=new Vector2){const ir=tr,nr=this.points,sr=(nr.length-1)*er,ar=Math.floor(sr),or=sr-ar,lr=nr[ar===0?ar:ar-1],cr=nr[ar],ur=nr[ar>nr.length-2?nr.length-1:ar+1],dr=nr[ar>nr.length-3?nr.length-1:ar+2];return ir.set(CatmullRom(or,lr.x,cr.x,ur.x,dr.x),CatmullRom(or,lr.y,cr.y,ur.y,dr.y)),ir}copy(er){super.copy(er),this.points=[];for(let tr=0,ir=er.points.length;tr<ir;tr++){const nr=er.points[tr];this.points.push(nr.clone())}return this}toJSON(){const er=super.toJSON();er.points=[];for(let tr=0,ir=this.points.length;tr<ir;tr++){const nr=this.points[tr];er.points.push(nr.toArray())}return er}fromJSON(er){super.fromJSON(er),this.points=[];for(let tr=0,ir=er.points.length;tr<ir;tr++){const nr=er.points[tr];this.points.push(new Vector2().fromArray(nr))}return this}}var Curves$1=Object.freeze({__proto__:null,ArcCurve,CatmullRomCurve3,CubicBezierCurve,CubicBezierCurve3,EllipseCurve,LineCurve,LineCurve3,QuadraticBezierCurve,QuadraticBezierCurve3,SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(er){this.curves.push(er)}closePath(){const er=this.curves[0].getPoint(0),tr=this.curves[this.curves.length-1].getPoint(1);if(!er.equals(tr)){const ir=er.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new Curves$1[ir](tr,er))}return this}getPoint(er,tr){const ir=er*this.getLength(),nr=this.getCurveLengths();let sr=0;for(;sr<nr.length;){if(nr[sr]>=ir){const ar=nr[sr]-ir,or=this.curves[sr],lr=or.getLength(),cr=lr===0?0:1-ar/lr;return or.getPointAt(cr,tr)}sr++}return null}getLength(){const er=this.getCurveLengths();return er[er.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const er=[];let tr=0;for(let ir=0,nr=this.curves.length;ir<nr;ir++)tr+=this.curves[ir].getLength(),er.push(tr);return this.cacheLengths=er,er}getSpacedPoints(er=40){const tr=[];for(let ir=0;ir<=er;ir++)tr.push(this.getPoint(ir/er));return this.autoClose&&tr.push(tr[0]),tr}getPoints(er=12){const tr=[];let ir;for(let nr=0,sr=this.curves;nr<sr.length;nr++){const ar=sr[nr],or=ar.isEllipseCurve?er*2:ar.isLineCurve||ar.isLineCurve3?1:ar.isSplineCurve?er*ar.points.length:er,lr=ar.getPoints(or);for(let cr=0;cr<lr.length;cr++){const ur=lr[cr];ir&&ir.equals(ur)||(tr.push(ur),ir=ur)}}return this.autoClose&&tr.length>1&&!tr[tr.length-1].equals(tr[0])&&tr.push(tr[0]),tr}copy(er){super.copy(er),this.curves=[];for(let tr=0,ir=er.curves.length;tr<ir;tr++){const nr=er.curves[tr];this.curves.push(nr.clone())}return this.autoClose=er.autoClose,this}toJSON(){const er=super.toJSON();er.autoClose=this.autoClose,er.curves=[];for(let tr=0,ir=this.curves.length;tr<ir;tr++){const nr=this.curves[tr];er.curves.push(nr.toJSON())}return er}fromJSON(er){super.fromJSON(er),this.autoClose=er.autoClose,this.curves=[];for(let tr=0,ir=er.curves.length;tr<ir;tr++){const nr=er.curves[tr];this.curves.push(new Curves$1[nr.type]().fromJSON(nr))}return this}}let Path$1=class extends CurvePath{constructor(er){super(),this.type="Path",this.currentPoint=new Vector2,er&&this.setFromPoints(er)}setFromPoints(er){this.moveTo(er[0].x,er[0].y);for(let tr=1,ir=er.length;tr<ir;tr++)this.lineTo(er[tr].x,er[tr].y);return this}moveTo(er,tr){return this.currentPoint.set(er,tr),this}lineTo(er,tr){const ir=new LineCurve(this.currentPoint.clone(),new Vector2(er,tr));return this.curves.push(ir),this.currentPoint.set(er,tr),this}quadraticCurveTo(er,tr,ir,nr){const sr=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(er,tr),new Vector2(ir,nr));return this.curves.push(sr),this.currentPoint.set(ir,nr),this}bezierCurveTo(er,tr,ir,nr,sr,ar){const or=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(er,tr),new Vector2(ir,nr),new Vector2(sr,ar));return this.curves.push(or),this.currentPoint.set(sr,ar),this}splineThru(er){const tr=[this.currentPoint.clone()].concat(er),ir=new SplineCurve(tr);return this.curves.push(ir),this.currentPoint.copy(er[er.length-1]),this}arc(er,tr,ir,nr,sr,ar){const or=this.currentPoint.x,lr=this.currentPoint.y;return this.absarc(er+or,tr+lr,ir,nr,sr,ar),this}absarc(er,tr,ir,nr,sr,ar){return this.absellipse(er,tr,ir,ir,nr,sr,ar),this}ellipse(er,tr,ir,nr,sr,ar,or,lr){const cr=this.currentPoint.x,ur=this.currentPoint.y;return this.absellipse(er+cr,tr+ur,ir,nr,sr,ar,or,lr),this}absellipse(er,tr,ir,nr,sr,ar,or,lr){const cr=new EllipseCurve(er,tr,ir,nr,sr,ar,or,lr);if(this.curves.length>0){const dr=cr.getPoint(0);dr.equals(this.currentPoint)||this.lineTo(dr.x,dr.y)}this.curves.push(cr);const ur=cr.getPoint(1);return this.currentPoint.copy(ur),this}copy(er){return super.copy(er),this.currentPoint.copy(er.currentPoint),this}toJSON(){const er=super.toJSON();return er.currentPoint=this.currentPoint.toArray(),er}fromJSON(er){return super.fromJSON(er),this.currentPoint.fromArray(er.currentPoint),this}};class LatheGeometry extends BufferGeometry{constructor(er=[new Vector2(0,-.5),new Vector2(.5,0),new Vector2(0,.5)],tr=12,ir=0,nr=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:er,segments:tr,phiStart:ir,phiLength:nr},tr=Math.floor(tr),nr=clamp(nr,0,Math.PI*2);const sr=[],ar=[],or=[],lr=[],cr=[],ur=1/tr,dr=new Vector3$1,hr=new Vector2,pr=new Vector3$1,gr=new Vector3$1,vr=new Vector3$1;let mr=0,fr=0;for(let _r=0;_r<=er.length-1;_r++)switch(_r){case 0:mr=er[_r+1].x-er[_r].x,fr=er[_r+1].y-er[_r].y,pr.x=fr*1,pr.y=-mr,pr.z=fr*0,vr.copy(pr),pr.normalize(),lr.push(pr.x,pr.y,pr.z);break;case er.length-1:lr.push(vr.x,vr.y,vr.z);break;default:mr=er[_r+1].x-er[_r].x,fr=er[_r+1].y-er[_r].y,pr.x=fr*1,pr.y=-mr,pr.z=fr*0,gr.copy(pr),pr.x+=vr.x,pr.y+=vr.y,pr.z+=vr.z,pr.normalize(),lr.push(pr.x,pr.y,pr.z),vr.copy(gr)}for(let _r=0;_r<=tr;_r++){const Ar=ir+_r*ur*nr,yr=Math.sin(Ar),wr=Math.cos(Ar);for(let xr=0;xr<=er.length-1;xr++){dr.x=er[xr].x*yr,dr.y=er[xr].y,dr.z=er[xr].x*wr,ar.push(dr.x,dr.y,dr.z),hr.x=_r/tr,hr.y=xr/(er.length-1),or.push(hr.x,hr.y);const Sr=lr[3*xr+0]*yr,br=lr[3*xr+1],Cr=lr[3*xr+0]*wr;cr.push(Sr,br,Cr)}}for(let _r=0;_r<tr;_r++)for(let Ar=0;Ar<er.length-1;Ar++){const yr=Ar+_r*er.length,wr=yr,xr=yr+er.length,Sr=yr+er.length+1,br=yr+1;sr.push(wr,xr,br),sr.push(Sr,br,xr)}this.setIndex(sr),this.setAttribute("position",new Float32BufferAttribute(ar,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2)),this.setAttribute("normal",new Float32BufferAttribute(cr,3))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new LatheGeometry(er.points,er.segments,er.phiStart,er.phiLength)}}class CapsuleGeometry extends LatheGeometry{constructor(er=1,tr=1,ir=4,nr=8){const sr=new Path$1;sr.absarc(0,-tr/2,er,Math.PI*1.5,0),sr.absarc(0,tr/2,er,0,Math.PI*.5),super(sr.getPoints(ir),nr),this.type="CapsuleGeometry",this.parameters={radius:er,length:tr,capSegments:ir,radialSegments:nr}}static fromJSON(er){return new CapsuleGeometry(er.radius,er.length,er.capSegments,er.radialSegments)}}class CircleGeometry extends BufferGeometry{constructor(er=1,tr=32,ir=0,nr=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:er,segments:tr,thetaStart:ir,thetaLength:nr},tr=Math.max(3,tr);const sr=[],ar=[],or=[],lr=[],cr=new Vector3$1,ur=new Vector2;ar.push(0,0,0),or.push(0,0,1),lr.push(.5,.5);for(let dr=0,hr=3;dr<=tr;dr++,hr+=3){const pr=ir+dr/tr*nr;cr.x=er*Math.cos(pr),cr.y=er*Math.sin(pr),ar.push(cr.x,cr.y,cr.z),or.push(0,0,1),ur.x=(ar[hr]/er+1)/2,ur.y=(ar[hr+1]/er+1)/2,lr.push(ur.x,ur.y)}for(let dr=1;dr<=tr;dr++)sr.push(dr,dr+1,0);this.setIndex(sr),this.setAttribute("position",new Float32BufferAttribute(ar,3)),this.setAttribute("normal",new Float32BufferAttribute(or,3)),this.setAttribute("uv",new Float32BufferAttribute(lr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new CircleGeometry(er.radius,er.segments,er.thetaStart,er.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(er=1,tr=1,ir=1,nr=32,sr=1,ar=!1,or=0,lr=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:er,radiusBottom:tr,height:ir,radialSegments:nr,heightSegments:sr,openEnded:ar,thetaStart:or,thetaLength:lr};const cr=this;nr=Math.floor(nr),sr=Math.floor(sr);const ur=[],dr=[],hr=[],pr=[];let gr=0;const vr=[],mr=ir/2;let fr=0;_r(),ar===!1&&(er>0&&Ar(!0),tr>0&&Ar(!1)),this.setIndex(ur),this.setAttribute("position",new Float32BufferAttribute(dr,3)),this.setAttribute("normal",new Float32BufferAttribute(hr,3)),this.setAttribute("uv",new Float32BufferAttribute(pr,2));function _r(){const yr=new Vector3$1,wr=new Vector3$1;let xr=0;const Sr=(tr-er)/ir;for(let br=0;br<=sr;br++){const Cr=[],Ir=br/sr,Rr=Ir*(tr-er)+er;for(let Pr=0;Pr<=nr;Pr++){const Dr=Pr/nr,Fr=Dr*lr+or,Or=Math.sin(Fr),Nr=Math.cos(Fr);wr.x=Rr*Or,wr.y=-Ir*ir+mr,wr.z=Rr*Nr,dr.push(wr.x,wr.y,wr.z),yr.set(Or,Sr,Nr).normalize(),hr.push(yr.x,yr.y,yr.z),pr.push(Dr,1-Ir),Cr.push(gr++)}vr.push(Cr)}for(let br=0;br<nr;br++)for(let Cr=0;Cr<sr;Cr++){const Ir=vr[Cr][br],Rr=vr[Cr+1][br],Pr=vr[Cr+1][br+1],Dr=vr[Cr][br+1];(er>0||Cr!==0)&&(ur.push(Ir,Rr,Dr),xr+=3),(tr>0||Cr!==sr-1)&&(ur.push(Rr,Pr,Dr),xr+=3)}cr.addGroup(fr,xr,0),fr+=xr}function Ar(yr){const wr=gr,xr=new Vector2,Sr=new Vector3$1;let br=0;const Cr=yr===!0?er:tr,Ir=yr===!0?1:-1;for(let Pr=1;Pr<=nr;Pr++)dr.push(0,mr*Ir,0),hr.push(0,Ir,0),pr.push(.5,.5),gr++;const Rr=gr;for(let Pr=0;Pr<=nr;Pr++){const Fr=Pr/nr*lr+or,Or=Math.cos(Fr),Nr=Math.sin(Fr);Sr.x=Cr*Nr,Sr.y=mr*Ir,Sr.z=Cr*Or,dr.push(Sr.x,Sr.y,Sr.z),hr.push(0,Ir,0),xr.x=Or*.5+.5,xr.y=Nr*.5*Ir+.5,pr.push(xr.x,xr.y),gr++}for(let Pr=0;Pr<nr;Pr++){const Dr=wr+Pr,Fr=Rr+Pr;yr===!0?ur.push(Fr,Fr+1,Dr):ur.push(Fr+1,Fr,Dr),br+=3}cr.addGroup(fr,br,yr===!0?1:2),fr+=br}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new CylinderGeometry(er.radiusTop,er.radiusBottom,er.height,er.radialSegments,er.heightSegments,er.openEnded,er.thetaStart,er.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(er=1,tr=1,ir=32,nr=1,sr=!1,ar=0,or=Math.PI*2){super(0,er,tr,ir,nr,sr,ar,or),this.type="ConeGeometry",this.parameters={radius:er,height:tr,radialSegments:ir,heightSegments:nr,openEnded:sr,thetaStart:ar,thetaLength:or}}static fromJSON(er){return new ConeGeometry(er.radius,er.height,er.radialSegments,er.heightSegments,er.openEnded,er.thetaStart,er.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(er=[],tr=[],ir=1,nr=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:er,indices:tr,radius:ir,detail:nr};const sr=[],ar=[];or(nr),cr(ir),ur(),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("normal",new Float32BufferAttribute(sr.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(ar,2)),nr===0?this.computeVertexNormals():this.normalizeNormals();function or(_r){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1;for(let xr=0;xr<tr.length;xr+=3)pr(tr[xr+0],Ar),pr(tr[xr+1],yr),pr(tr[xr+2],wr),lr(Ar,yr,wr,_r)}function lr(_r,Ar,yr,wr){const xr=wr+1,Sr=[];for(let br=0;br<=xr;br++){Sr[br]=[];const Cr=_r.clone().lerp(yr,br/xr),Ir=Ar.clone().lerp(yr,br/xr),Rr=xr-br;for(let Pr=0;Pr<=Rr;Pr++)Pr===0&&br===xr?Sr[br][Pr]=Cr:Sr[br][Pr]=Cr.clone().lerp(Ir,Pr/Rr)}for(let br=0;br<xr;br++)for(let Cr=0;Cr<2*(xr-br)-1;Cr++){const Ir=Math.floor(Cr/2);Cr%2===0?(hr(Sr[br][Ir+1]),hr(Sr[br+1][Ir]),hr(Sr[br][Ir])):(hr(Sr[br][Ir+1]),hr(Sr[br+1][Ir+1]),hr(Sr[br+1][Ir]))}}function cr(_r){const Ar=new Vector3$1;for(let yr=0;yr<sr.length;yr+=3)Ar.x=sr[yr+0],Ar.y=sr[yr+1],Ar.z=sr[yr+2],Ar.normalize().multiplyScalar(_r),sr[yr+0]=Ar.x,sr[yr+1]=Ar.y,sr[yr+2]=Ar.z}function ur(){const _r=new Vector3$1;for(let Ar=0;Ar<sr.length;Ar+=3){_r.x=sr[Ar+0],_r.y=sr[Ar+1],_r.z=sr[Ar+2];const yr=mr(_r)/2/Math.PI+.5,wr=fr(_r)/Math.PI+.5;ar.push(yr,1-wr)}gr(),dr()}function dr(){for(let _r=0;_r<ar.length;_r+=6){const Ar=ar[_r+0],yr=ar[_r+2],wr=ar[_r+4],xr=Math.max(Ar,yr,wr),Sr=Math.min(Ar,yr,wr);xr>.9&&Sr<.1&&(Ar<.2&&(ar[_r+0]+=1),yr<.2&&(ar[_r+2]+=1),wr<.2&&(ar[_r+4]+=1))}}function hr(_r){sr.push(_r.x,_r.y,_r.z)}function pr(_r,Ar){const yr=_r*3;Ar.x=er[yr+0],Ar.y=er[yr+1],Ar.z=er[yr+2]}function gr(){const _r=new Vector3$1,Ar=new Vector3$1,yr=new Vector3$1,wr=new Vector3$1,xr=new Vector2,Sr=new Vector2,br=new Vector2;for(let Cr=0,Ir=0;Cr<sr.length;Cr+=9,Ir+=6){_r.set(sr[Cr+0],sr[Cr+1],sr[Cr+2]),Ar.set(sr[Cr+3],sr[Cr+4],sr[Cr+5]),yr.set(sr[Cr+6],sr[Cr+7],sr[Cr+8]),xr.set(ar[Ir+0],ar[Ir+1]),Sr.set(ar[Ir+2],ar[Ir+3]),br.set(ar[Ir+4],ar[Ir+5]),wr.copy(_r).add(Ar).add(yr).divideScalar(3);const Rr=mr(wr);vr(xr,Ir+0,_r,Rr),vr(Sr,Ir+2,Ar,Rr),vr(br,Ir+4,yr,Rr)}}function vr(_r,Ar,yr,wr){wr<0&&_r.x===1&&(ar[Ar]=_r.x-1),yr.x===0&&yr.z===0&&(ar[Ar]=wr/2/Math.PI+.5)}function mr(_r){return Math.atan2(_r.z,-_r.x)}function fr(_r){return Math.atan2(-_r.y,Math.sqrt(_r.x*_r.x+_r.z*_r.z))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new PolyhedronGeometry(er.vertices,er.indices,er.radius,er.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const ir=(1+Math.sqrt(5))/2,nr=1/ir,sr=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-nr,-ir,0,-nr,ir,0,nr,-ir,0,nr,ir,-nr,-ir,0,-nr,ir,0,nr,-ir,0,nr,ir,0,-ir,0,-nr,ir,0,-nr,-ir,0,nr,ir,0,nr],ar=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(sr,ar,er,tr),this.type="DodecahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new DodecahedronGeometry(er.radius,er.detail)}}const _v0=new Vector3$1,_v1$1$1=new Vector3$1,_normal=new Vector3$1,_triangle$1=new Triangle$2;class EdgesGeometry extends BufferGeometry{constructor(er=null,tr=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:er,thresholdAngle:tr},er!==null){const nr=Math.pow(10,4),sr=Math.cos(DEG2RAD*tr),ar=er.getIndex(),or=er.getAttribute("position"),lr=ar?ar.count:or.count,cr=[0,0,0],ur=["a","b","c"],dr=new Array(3),hr={},pr=[];for(let gr=0;gr<lr;gr+=3){ar?(cr[0]=ar.getX(gr),cr[1]=ar.getX(gr+1),cr[2]=ar.getX(gr+2)):(cr[0]=gr,cr[1]=gr+1,cr[2]=gr+2);const{a:vr,b:mr,c:fr}=_triangle$1;if(vr.fromBufferAttribute(or,cr[0]),mr.fromBufferAttribute(or,cr[1]),fr.fromBufferAttribute(or,cr[2]),_triangle$1.getNormal(_normal),dr[0]=`${Math.round(vr.x*nr)},${Math.round(vr.y*nr)},${Math.round(vr.z*nr)}`,dr[1]=`${Math.round(mr.x*nr)},${Math.round(mr.y*nr)},${Math.round(mr.z*nr)}`,dr[2]=`${Math.round(fr.x*nr)},${Math.round(fr.y*nr)},${Math.round(fr.z*nr)}`,!(dr[0]===dr[1]||dr[1]===dr[2]||dr[2]===dr[0]))for(let _r=0;_r<3;_r++){const Ar=(_r+1)%3,yr=dr[_r],wr=dr[Ar],xr=_triangle$1[ur[_r]],Sr=_triangle$1[ur[Ar]],br=`${yr}_${wr}`,Cr=`${wr}_${yr}`;Cr in hr&&hr[Cr]?(_normal.dot(hr[Cr].normal)<=sr&&(pr.push(xr.x,xr.y,xr.z),pr.push(Sr.x,Sr.y,Sr.z)),hr[Cr]=null):br in hr||(hr[br]={index0:cr[_r],index1:cr[Ar],normal:_normal.clone()})}}for(const gr in hr)if(hr[gr]){const{index0:vr,index1:mr}=hr[gr];_v0.fromBufferAttribute(or,vr),_v1$1$1.fromBufferAttribute(or,mr),pr.push(_v0.x,_v0.y,_v0.z),pr.push(_v1$1$1.x,_v1$1$1.y,_v1$1$1.z)}this.setAttribute("position",new Float32BufferAttribute(pr,3))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}let Shape$1=class extends Path$1{constructor(er){super(er),this.uuid=generateUUID(),this.type="Shape",this.holes=[]}getPointsHoles(er){const tr=[];for(let ir=0,nr=this.holes.length;ir<nr;ir++)tr[ir]=this.holes[ir].getPoints(er);return tr}extractPoints(er){return{shape:this.getPoints(er),holes:this.getPointsHoles(er)}}copy(er){super.copy(er),this.holes=[];for(let tr=0,ir=er.holes.length;tr<ir;tr++){const nr=er.holes[tr];this.holes.push(nr.clone())}return this}toJSON(){const er=super.toJSON();er.uuid=this.uuid,er.holes=[];for(let tr=0,ir=this.holes.length;tr<ir;tr++){const nr=this.holes[tr];er.holes.push(nr.toJSON())}return er}fromJSON(er){super.fromJSON(er),this.uuid=er.uuid,this.holes=[];for(let tr=0,ir=er.holes.length;tr<ir;tr++){const nr=er.holes[tr];this.holes.push(new Path$1().fromJSON(nr))}return this}};const Earcut={triangulate:function(rr,er,tr=2){const ir=er&&er.length,nr=ir?er[0]*tr:rr.length;let sr=linkedList(rr,0,nr,tr,!0);const ar=[];if(!sr||sr.next===sr.prev)return ar;let or,lr,cr,ur,dr,hr,pr;if(ir&&(sr=eliminateHoles(rr,er,sr,tr)),rr.length>80*tr){or=cr=rr[0],lr=ur=rr[1];for(let gr=tr;gr<nr;gr+=tr)dr=rr[gr],hr=rr[gr+1],dr<or&&(or=dr),hr<lr&&(lr=hr),dr>cr&&(cr=dr),hr>ur&&(ur=hr);pr=Math.max(cr-or,ur-lr),pr=pr!==0?32767/pr:0}return earcutLinked(sr,ar,tr,or,lr,pr,0),ar}};function linkedList(rr,er,tr,ir,nr){let sr,ar;if(nr===signedArea(rr,er,tr,ir)>0)for(sr=er;sr<tr;sr+=ir)ar=insertNode(sr,rr[sr],rr[sr+1],ar);else for(sr=tr-ir;sr>=er;sr-=ir)ar=insertNode(sr,rr[sr],rr[sr+1],ar);return ar&&equals$1(ar,ar.next)&&(removeNode(ar),ar=ar.next),ar}function filterPoints(rr,er){if(!rr)return rr;er||(er=rr);let tr=rr,ir;do if(ir=!1,!tr.steiner&&(equals$1(tr,tr.next)||area$1(tr.prev,tr,tr.next)===0)){if(removeNode(tr),tr=er=tr.prev,tr===tr.next)break;ir=!0}else tr=tr.next;while(ir||tr!==er);return er}function earcutLinked(rr,er,tr,ir,nr,sr,ar){if(!rr)return;!ar&&sr&&indexCurve(rr,ir,nr,sr);let or=rr,lr,cr;for(;rr.prev!==rr.next;){if(lr=rr.prev,cr=rr.next,sr?isEarHashed(rr,ir,nr,sr):isEar(rr)){er.push(lr.i/tr|0),er.push(rr.i/tr|0),er.push(cr.i/tr|0),removeNode(rr),rr=cr.next,or=cr.next;continue}if(rr=cr,rr===or){ar?ar===1?(rr=cureLocalIntersections(filterPoints(rr),er,tr),earcutLinked(rr,er,tr,ir,nr,sr,2)):ar===2&&splitEarcut(rr,er,tr,ir,nr,sr):earcutLinked(filterPoints(rr),er,tr,ir,nr,sr,1);break}}}function isEar(rr){const er=rr.prev,tr=rr,ir=rr.next;if(area$1(er,tr,ir)>=0)return!1;const nr=er.x,sr=tr.x,ar=ir.x,or=er.y,lr=tr.y,cr=ir.y,ur=nr<sr?nr<ar?nr:ar:sr<ar?sr:ar,dr=or<lr?or<cr?or:cr:lr<cr?lr:cr,hr=nr>sr?nr>ar?nr:ar:sr>ar?sr:ar,pr=or>lr?or>cr?or:cr:lr>cr?lr:cr;let gr=ir.next;for(;gr!==er;){if(gr.x>=ur&&gr.x<=hr&&gr.y>=dr&&gr.y<=pr&&pointInTriangle(nr,or,sr,lr,ar,cr,gr.x,gr.y)&&area$1(gr.prev,gr,gr.next)>=0)return!1;gr=gr.next}return!0}function isEarHashed(rr,er,tr,ir){const nr=rr.prev,sr=rr,ar=rr.next;if(area$1(nr,sr,ar)>=0)return!1;const or=nr.x,lr=sr.x,cr=ar.x,ur=nr.y,dr=sr.y,hr=ar.y,pr=or<lr?or<cr?or:cr:lr<cr?lr:cr,gr=ur<dr?ur<hr?ur:hr:dr<hr?dr:hr,vr=or>lr?or>cr?or:cr:lr>cr?lr:cr,mr=ur>dr?ur>hr?ur:hr:dr>hr?dr:hr,fr=zOrder(pr,gr,er,tr,ir),_r=zOrder(vr,mr,er,tr,ir);let Ar=rr.prevZ,yr=rr.nextZ;for(;Ar&&Ar.z>=fr&&yr&&yr.z<=_r;){if(Ar.x>=pr&&Ar.x<=vr&&Ar.y>=gr&&Ar.y<=mr&&Ar!==nr&&Ar!==ar&&pointInTriangle(or,ur,lr,dr,cr,hr,Ar.x,Ar.y)&&area$1(Ar.prev,Ar,Ar.next)>=0||(Ar=Ar.prevZ,yr.x>=pr&&yr.x<=vr&&yr.y>=gr&&yr.y<=mr&&yr!==nr&&yr!==ar&&pointInTriangle(or,ur,lr,dr,cr,hr,yr.x,yr.y)&&area$1(yr.prev,yr,yr.next)>=0))return!1;yr=yr.nextZ}for(;Ar&&Ar.z>=fr;){if(Ar.x>=pr&&Ar.x<=vr&&Ar.y>=gr&&Ar.y<=mr&&Ar!==nr&&Ar!==ar&&pointInTriangle(or,ur,lr,dr,cr,hr,Ar.x,Ar.y)&&area$1(Ar.prev,Ar,Ar.next)>=0)return!1;Ar=Ar.prevZ}for(;yr&&yr.z<=_r;){if(yr.x>=pr&&yr.x<=vr&&yr.y>=gr&&yr.y<=mr&&yr!==nr&&yr!==ar&&pointInTriangle(or,ur,lr,dr,cr,hr,yr.x,yr.y)&&area$1(yr.prev,yr,yr.next)>=0)return!1;yr=yr.nextZ}return!0}function cureLocalIntersections(rr,er,tr){let ir=rr;do{const nr=ir.prev,sr=ir.next.next;!equals$1(nr,sr)&&intersects(nr,ir,ir.next,sr)&&locallyInside(nr,sr)&&locallyInside(sr,nr)&&(er.push(nr.i/tr|0),er.push(ir.i/tr|0),er.push(sr.i/tr|0),removeNode(ir),removeNode(ir.next),ir=rr=sr),ir=ir.next}while(ir!==rr);return filterPoints(ir)}function splitEarcut(rr,er,tr,ir,nr,sr){let ar=rr;do{let or=ar.next.next;for(;or!==ar.prev;){if(ar.i!==or.i&&isValidDiagonal(ar,or)){let lr=splitPolygon(ar,or);ar=filterPoints(ar,ar.next),lr=filterPoints(lr,lr.next),earcutLinked(ar,er,tr,ir,nr,sr,0),earcutLinked(lr,er,tr,ir,nr,sr,0);return}or=or.next}ar=ar.next}while(ar!==rr)}function eliminateHoles(rr,er,tr,ir){const nr=[];let sr,ar,or,lr,cr;for(sr=0,ar=er.length;sr<ar;sr++)or=er[sr]*ir,lr=sr<ar-1?er[sr+1]*ir:rr.length,cr=linkedList(rr,or,lr,ir,!1),cr===cr.next&&(cr.steiner=!0),nr.push(getLeftmost(cr));for(nr.sort(compareX),sr=0;sr<nr.length;sr++)tr=eliminateHole(nr[sr],tr);return tr}function compareX(rr,er){return rr.x-er.x}function eliminateHole(rr,er){const tr=findHoleBridge(rr,er);if(!tr)return er;const ir=splitPolygon(tr,rr);return filterPoints(ir,ir.next),filterPoints(tr,tr.next)}function findHoleBridge(rr,er){let tr=er,ir=-1/0,nr;const sr=rr.x,ar=rr.y;do{if(ar<=tr.y&&ar>=tr.next.y&&tr.next.y!==tr.y){const hr=tr.x+(ar-tr.y)*(tr.next.x-tr.x)/(tr.next.y-tr.y);if(hr<=sr&&hr>ir&&(ir=hr,nr=tr.x<tr.next.x?tr:tr.next,hr===sr))return nr}tr=tr.next}while(tr!==er);if(!nr)return null;const or=nr,lr=nr.x,cr=nr.y;let ur=1/0,dr;tr=nr;do sr>=tr.x&&tr.x>=lr&&sr!==tr.x&&pointInTriangle(ar<cr?sr:ir,ar,lr,cr,ar<cr?ir:sr,ar,tr.x,tr.y)&&(dr=Math.abs(ar-tr.y)/(sr-tr.x),locallyInside(tr,rr)&&(dr<ur||dr===ur&&(tr.x>nr.x||tr.x===nr.x&&sectorContainsSector(nr,tr)))&&(nr=tr,ur=dr)),tr=tr.next;while(tr!==or);return nr}function sectorContainsSector(rr,er){return area$1(rr.prev,rr,er.prev)<0&&area$1(er.next,rr,rr.next)<0}function indexCurve(rr,er,tr,ir){let nr=rr;do nr.z===0&&(nr.z=zOrder(nr.x,nr.y,er,tr,ir)),nr.prevZ=nr.prev,nr.nextZ=nr.next,nr=nr.next;while(nr!==rr);nr.prevZ.nextZ=null,nr.prevZ=null,sortLinked(nr)}function sortLinked(rr){let er,tr,ir,nr,sr,ar,or,lr,cr=1;do{for(tr=rr,rr=null,sr=null,ar=0;tr;){for(ar++,ir=tr,or=0,er=0;er<cr&&(or++,ir=ir.nextZ,!!ir);er++);for(lr=cr;or>0||lr>0&&ir;)or!==0&&(lr===0||!ir||tr.z<=ir.z)?(nr=tr,tr=tr.nextZ,or--):(nr=ir,ir=ir.nextZ,lr--),sr?sr.nextZ=nr:rr=nr,nr.prevZ=sr,sr=nr;tr=ir}sr.nextZ=null,cr*=2}while(ar>1);return rr}function zOrder(rr,er,tr,ir,nr){return rr=(rr-tr)*nr|0,er=(er-ir)*nr|0,rr=(rr|rr<<8)&16711935,rr=(rr|rr<<4)&252645135,rr=(rr|rr<<2)&858993459,rr=(rr|rr<<1)&1431655765,er=(er|er<<8)&16711935,er=(er|er<<4)&252645135,er=(er|er<<2)&858993459,er=(er|er<<1)&1431655765,rr|er<<1}function getLeftmost(rr){let er=rr,tr=rr;do(er.x<tr.x||er.x===tr.x&&er.y<tr.y)&&(tr=er),er=er.next;while(er!==rr);return tr}function pointInTriangle(rr,er,tr,ir,nr,sr,ar,or){return(nr-ar)*(er-or)>=(rr-ar)*(sr-or)&&(rr-ar)*(ir-or)>=(tr-ar)*(er-or)&&(tr-ar)*(sr-or)>=(nr-ar)*(ir-or)}function isValidDiagonal(rr,er){return rr.next.i!==er.i&&rr.prev.i!==er.i&&!intersectsPolygon(rr,er)&&(locallyInside(rr,er)&&locallyInside(er,rr)&&middleInside(rr,er)&&(area$1(rr.prev,rr,er.prev)||area$1(rr,er.prev,er))||equals$1(rr,er)&&area$1(rr.prev,rr,rr.next)>0&&area$1(er.prev,er,er.next)>0)}function area$1(rr,er,tr){return(er.y-rr.y)*(tr.x-er.x)-(er.x-rr.x)*(tr.y-er.y)}function equals$1(rr,er){return rr.x===er.x&&rr.y===er.y}function intersects(rr,er,tr,ir){const nr=sign(area$1(rr,er,tr)),sr=sign(area$1(rr,er,ir)),ar=sign(area$1(tr,ir,rr)),or=sign(area$1(tr,ir,er));return!!(nr!==sr&&ar!==or||nr===0&&onSegment(rr,tr,er)||sr===0&&onSegment(rr,ir,er)||ar===0&&onSegment(tr,rr,ir)||or===0&&onSegment(tr,er,ir))}function onSegment(rr,er,tr){return er.x<=Math.max(rr.x,tr.x)&&er.x>=Math.min(rr.x,tr.x)&&er.y<=Math.max(rr.y,tr.y)&&er.y>=Math.min(rr.y,tr.y)}function sign(rr){return rr>0?1:rr<0?-1:0}function intersectsPolygon(rr,er){let tr=rr;do{if(tr.i!==rr.i&&tr.next.i!==rr.i&&tr.i!==er.i&&tr.next.i!==er.i&&intersects(tr,tr.next,rr,er))return!0;tr=tr.next}while(tr!==rr);return!1}function locallyInside(rr,er){return area$1(rr.prev,rr,rr.next)<0?area$1(rr,er,rr.next)>=0&&area$1(rr,rr.prev,er)>=0:area$1(rr,er,rr.prev)<0||area$1(rr,rr.next,er)<0}function middleInside(rr,er){let tr=rr,ir=!1;const nr=(rr.x+er.x)/2,sr=(rr.y+er.y)/2;do tr.y>sr!=tr.next.y>sr&&tr.next.y!==tr.y&&nr<(tr.next.x-tr.x)*(sr-tr.y)/(tr.next.y-tr.y)+tr.x&&(ir=!ir),tr=tr.next;while(tr!==rr);return ir}function splitPolygon(rr,er){const tr=new Node$1(rr.i,rr.x,rr.y),ir=new Node$1(er.i,er.x,er.y),nr=rr.next,sr=er.prev;return rr.next=er,er.prev=rr,tr.next=nr,nr.prev=tr,ir.next=tr,tr.prev=ir,sr.next=ir,ir.prev=sr,ir}function insertNode(rr,er,tr,ir){const nr=new Node$1(rr,er,tr);return ir?(nr.next=ir.next,nr.prev=ir,ir.next.prev=nr,ir.next=nr):(nr.prev=nr,nr.next=nr),nr}function removeNode(rr){rr.next.prev=rr.prev,rr.prev.next=rr.next,rr.prevZ&&(rr.prevZ.nextZ=rr.nextZ),rr.nextZ&&(rr.nextZ.prevZ=rr.prevZ)}function Node$1(rr,er,tr){this.i=rr,this.x=er,this.y=tr,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(rr,er,tr,ir){let nr=0;for(let sr=er,ar=tr-ir;sr<tr;sr+=ir)nr+=(rr[ar]-rr[sr])*(rr[sr+1]+rr[ar+1]),ar=sr;return nr}class ShapeUtils{static area(er){const tr=er.length;let ir=0;for(let nr=tr-1,sr=0;sr<tr;nr=sr++)ir+=er[nr].x*er[sr].y-er[sr].x*er[nr].y;return ir*.5}static isClockWise(er){return ShapeUtils.area(er)<0}static triangulateShape(er,tr){const ir=[],nr=[],sr=[];removeDupEndPts(er),addContour(ir,er);let ar=er.length;tr.forEach(removeDupEndPts);for(let lr=0;lr<tr.length;lr++)nr.push(ar),ar+=tr[lr].length,addContour(ir,tr[lr]);const or=Earcut.triangulate(ir,nr);for(let lr=0;lr<or.length;lr+=3)sr.push(or.slice(lr,lr+3));return sr}}function removeDupEndPts(rr){const er=rr.length;er>2&&rr[er-1].equals(rr[0])&&rr.pop()}function addContour(rr,er){for(let tr=0;tr<er.length;tr++)rr.push(er[tr].x),rr.push(er[tr].y)}class ExtrudeGeometry extends BufferGeometry{constructor(er=new Shape$1([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tr={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:er,options:tr},er=Array.isArray(er)?er:[er];const ir=this,nr=[],sr=[];for(let or=0,lr=er.length;or<lr;or++){const cr=er[or];ar(cr)}this.setAttribute("position",new Float32BufferAttribute(nr,3)),this.setAttribute("uv",new Float32BufferAttribute(sr,2)),this.computeVertexNormals();function ar(or){const lr=[],cr=tr.curveSegments!==void 0?tr.curveSegments:12,ur=tr.steps!==void 0?tr.steps:1,dr=tr.depth!==void 0?tr.depth:1;let hr=tr.bevelEnabled!==void 0?tr.bevelEnabled:!0,pr=tr.bevelThickness!==void 0?tr.bevelThickness:.2,gr=tr.bevelSize!==void 0?tr.bevelSize:pr-.1,vr=tr.bevelOffset!==void 0?tr.bevelOffset:0,mr=tr.bevelSegments!==void 0?tr.bevelSegments:3;const fr=tr.extrudePath,_r=tr.UVGenerator!==void 0?tr.UVGenerator:WorldUVGenerator;let Ar,yr=!1,wr,xr,Sr,br;fr&&(Ar=fr.getSpacedPoints(ur),yr=!0,hr=!1,wr=fr.computeFrenetFrames(ur,!1),xr=new Vector3$1,Sr=new Vector3$1,br=new Vector3$1),hr||(mr=0,pr=0,gr=0,vr=0);const Cr=or.extractPoints(cr);let Ir=Cr.shape;const Rr=Cr.holes;if(!ShapeUtils.isClockWise(Ir)){Ir=Ir.reverse();for(let Ki=0,Zi=Rr.length;Ki<Zi;Ki++){const Zr=Rr[Ki];ShapeUtils.isClockWise(Zr)&&(Rr[Ki]=Zr.reverse())}}const Dr=ShapeUtils.triangulateShape(Ir,Rr),Fr=Ir;for(let Ki=0,Zi=Rr.length;Ki<Zi;Ki++){const Zr=Rr[Ki];Ir=Ir.concat(Zr)}function Or(Ki,Zi,Zr){return Zi||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ki.clone().addScaledVector(Zi,Zr)}const Nr=Ir.length,Ur=Dr.length;function Br(Ki,Zi,Zr){let is,os,cs;const ss=Ki.x-Zi.x,es=Ki.y-Zi.y,ms=Zr.x-Ki.x,Yi=Zr.y-Ki.y,Gi=ss*ss+es*es,Ni=ss*Yi-es*ms;if(Math.abs(Ni)>Number.EPSILON){const Ri=Math.sqrt(Gi),qi=Math.sqrt(ms*ms+Yi*Yi),as=Zi.x-es/Ri,us=Zi.y+ss/Ri,gs=Zr.x-Yi/qi,vs=Zr.y+ms/qi,_s=((gs-as)*Yi-(vs-us)*ms)/(ss*Yi-es*ms);is=as+ss*_s-Ki.x,os=us+es*_s-Ki.y;const As=is*is+os*os;if(As<=2)return new Vector2(is,os);cs=Math.sqrt(As/2)}else{let Ri=!1;ss>Number.EPSILON?ms>Number.EPSILON&&(Ri=!0):ss<-Number.EPSILON?ms<-Number.EPSILON&&(Ri=!0):Math.sign(es)===Math.sign(Yi)&&(Ri=!0),Ri?(is=-es,os=ss,cs=Math.sqrt(Gi)):(is=ss,os=es,cs=Math.sqrt(Gi/2))}return new Vector2(is/cs,os/cs)}const Wr=[];for(let Ki=0,Zi=Fr.length,Zr=Zi-1,is=Ki+1;Ki<Zi;Ki++,Zr++,is++)Zr===Zi&&(Zr=0),is===Zi&&(is=0),Wr[Ki]=Br(Fr[Ki],Fr[Zr],Fr[is]);const Xr=[];let Yr,Qi=Wr.concat();for(let Ki=0,Zi=Rr.length;Ki<Zi;Ki++){const Zr=Rr[Ki];Yr=[];for(let is=0,os=Zr.length,cs=os-1,ss=is+1;is<os;is++,cs++,ss++)cs===os&&(cs=0),ss===os&&(ss=0),Yr[is]=Br(Zr[is],Zr[cs],Zr[ss]);Xr.push(Yr),Qi=Qi.concat(Yr)}for(let Ki=0;Ki<mr;Ki++){const Zi=Ki/mr,Zr=pr*Math.cos(Zi*Math.PI/2),is=gr*Math.sin(Zi*Math.PI/2)+vr;for(let os=0,cs=Fr.length;os<cs;os++){const ss=Or(Fr[os],Wr[os],is);Gr(ss.x,ss.y,-Zr)}for(let os=0,cs=Rr.length;os<cs;os++){const ss=Rr[os];Yr=Xr[os];for(let es=0,ms=ss.length;es<ms;es++){const Yi=Or(ss[es],Yr[es],is);Gr(Yi.x,Yi.y,-Zr)}}}const Xi=gr+vr;for(let Ki=0;Ki<Nr;Ki++){const Zi=hr?Or(Ir[Ki],Qi[Ki],Xi):Ir[Ki];yr?(Sr.copy(wr.normals[0]).multiplyScalar(Zi.x),xr.copy(wr.binormals[0]).multiplyScalar(Zi.y),br.copy(Ar[0]).add(Sr).add(xr),Gr(br.x,br.y,br.z)):Gr(Zi.x,Zi.y,0)}for(let Ki=1;Ki<=ur;Ki++)for(let Zi=0;Zi<Nr;Zi++){const Zr=hr?Or(Ir[Zi],Qi[Zi],Xi):Ir[Zi];yr?(Sr.copy(wr.normals[Ki]).multiplyScalar(Zr.x),xr.copy(wr.binormals[Ki]).multiplyScalar(Zr.y),br.copy(Ar[Ki]).add(Sr).add(xr),Gr(br.x,br.y,br.z)):Gr(Zr.x,Zr.y,dr/ur*Ki)}for(let Ki=mr-1;Ki>=0;Ki--){const Zi=Ki/mr,Zr=pr*Math.cos(Zi*Math.PI/2),is=gr*Math.sin(Zi*Math.PI/2)+vr;for(let os=0,cs=Fr.length;os<cs;os++){const ss=Or(Fr[os],Wr[os],is);Gr(ss.x,ss.y,dr+Zr)}for(let os=0,cs=Rr.length;os<cs;os++){const ss=Rr[os];Yr=Xr[os];for(let es=0,ms=ss.length;es<ms;es++){const Yi=Or(ss[es],Yr[es],is);yr?Gr(Yi.x,Yi.y+Ar[ur-1].y,Ar[ur-1].x+Zr):Gr(Yi.x,Yi.y,dr+Zr)}}}Kr(),$r();function Kr(){const Ki=nr.length/3;if(hr){let Zi=0,Zr=Nr*Zi;for(let is=0;is<Ur;is++){const os=Dr[is];qr(os[2]+Zr,os[1]+Zr,os[0]+Zr)}Zi=ur+mr*2,Zr=Nr*Zi;for(let is=0;is<Ur;is++){const os=Dr[is];qr(os[0]+Zr,os[1]+Zr,os[2]+Zr)}}else{for(let Zi=0;Zi<Ur;Zi++){const Zr=Dr[Zi];qr(Zr[2],Zr[1],Zr[0])}for(let Zi=0;Zi<Ur;Zi++){const Zr=Dr[Zi];qr(Zr[0]+Nr*ur,Zr[1]+Nr*ur,Zr[2]+Nr*ur)}}ir.addGroup(Ki,nr.length/3-Ki,0)}function $r(){const Ki=nr.length/3;let Zi=0;Vr(Fr,Zi),Zi+=Fr.length;for(let Zr=0,is=Rr.length;Zr<is;Zr++){const os=Rr[Zr];Vr(os,Zi),Zi+=os.length}ir.addGroup(Ki,nr.length/3-Ki,1)}function Vr(Ki,Zi){let Zr=Ki.length;for(;--Zr>=0;){const is=Zr;let os=Zr-1;os<0&&(os=Ki.length-1);for(let cs=0,ss=ur+mr*2;cs<ss;cs++){const es=Nr*cs,ms=Nr*(cs+1),Yi=Zi+is+es,Gi=Zi+os+es,Ni=Zi+os+ms,Ri=Zi+is+ms;ji(Yi,Gi,Ni,Ri)}}}function Gr(Ki,Zi,Zr){lr.push(Ki),lr.push(Zi),lr.push(Zr)}function qr(Ki,Zi,Zr){Jr(Ki),Jr(Zi),Jr(Zr);const is=nr.length/3,os=_r.generateTopUV(ir,nr,is-3,is-2,is-1);Ji(os[0]),Ji(os[1]),Ji(os[2])}function ji(Ki,Zi,Zr,is){Jr(Ki),Jr(Zi),Jr(is),Jr(Zi),Jr(Zr),Jr(is);const os=nr.length/3,cs=_r.generateSideWallUV(ir,nr,os-6,os-3,os-2,os-1);Ji(cs[0]),Ji(cs[1]),Ji(cs[3]),Ji(cs[1]),Ji(cs[2]),Ji(cs[3])}function Jr(Ki){nr.push(lr[Ki*3+0]),nr.push(lr[Ki*3+1]),nr.push(lr[Ki*3+2])}function Ji(Ki){sr.push(Ki.x),sr.push(Ki.y)}}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON(),tr=this.parameters.shapes,ir=this.parameters.options;return toJSON$1(tr,ir,er)}static fromJSON(er,tr){const ir=[];for(let sr=0,ar=er.shapes.length;sr<ar;sr++){const or=tr[er.shapes[sr]];ir.push(or)}const nr=er.options.extrudePath;return nr!==void 0&&(er.options.extrudePath=new Curves$1[nr.type]().fromJSON(nr)),new ExtrudeGeometry(ir,er.options)}}const WorldUVGenerator={generateTopUV:function(rr,er,tr,ir,nr){const sr=er[tr*3],ar=er[tr*3+1],or=er[ir*3],lr=er[ir*3+1],cr=er[nr*3],ur=er[nr*3+1];return[new Vector2(sr,ar),new Vector2(or,lr),new Vector2(cr,ur)]},generateSideWallUV:function(rr,er,tr,ir,nr,sr){const ar=er[tr*3],or=er[tr*3+1],lr=er[tr*3+2],cr=er[ir*3],ur=er[ir*3+1],dr=er[ir*3+2],hr=er[nr*3],pr=er[nr*3+1],gr=er[nr*3+2],vr=er[sr*3],mr=er[sr*3+1],fr=er[sr*3+2];return Math.abs(or-ur)<Math.abs(ar-cr)?[new Vector2(ar,1-lr),new Vector2(cr,1-dr),new Vector2(hr,1-gr),new Vector2(vr,1-fr)]:[new Vector2(or,1-lr),new Vector2(ur,1-dr),new Vector2(pr,1-gr),new Vector2(mr,1-fr)]}};function toJSON$1(rr,er,tr){if(tr.shapes=[],Array.isArray(rr))for(let ir=0,nr=rr.length;ir<nr;ir++){const sr=rr[ir];tr.shapes.push(sr.uuid)}else tr.shapes.push(rr.uuid);return tr.options=Object.assign({},er),er.extrudePath!==void 0&&(tr.options.extrudePath=er.extrudePath.toJSON()),tr}class IcosahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const ir=(1+Math.sqrt(5))/2,nr=[-1,ir,0,1,ir,0,-1,-ir,0,1,-ir,0,0,-1,ir,0,1,ir,0,-1,-ir,0,1,-ir,ir,0,-1,ir,0,1,-ir,0,-1,-ir,0,1],sr=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(nr,sr,er,tr),this.type="IcosahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new IcosahedronGeometry(er.radius,er.detail)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const ir=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],nr=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(ir,nr,er,tr),this.type="OctahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new OctahedronGeometry(er.radius,er.detail)}}class RingGeometry extends BufferGeometry{constructor(er=.5,tr=1,ir=32,nr=1,sr=0,ar=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:er,outerRadius:tr,thetaSegments:ir,phiSegments:nr,thetaStart:sr,thetaLength:ar},ir=Math.max(3,ir),nr=Math.max(1,nr);const or=[],lr=[],cr=[],ur=[];let dr=er;const hr=(tr-er)/nr,pr=new Vector3$1,gr=new Vector2;for(let vr=0;vr<=nr;vr++){for(let mr=0;mr<=ir;mr++){const fr=sr+mr/ir*ar;pr.x=dr*Math.cos(fr),pr.y=dr*Math.sin(fr),lr.push(pr.x,pr.y,pr.z),cr.push(0,0,1),gr.x=(pr.x/tr+1)/2,gr.y=(pr.y/tr+1)/2,ur.push(gr.x,gr.y)}dr+=hr}for(let vr=0;vr<nr;vr++){const mr=vr*(ir+1);for(let fr=0;fr<ir;fr++){const _r=fr+mr,Ar=_r,yr=_r+ir+1,wr=_r+ir+2,xr=_r+1;or.push(Ar,yr,xr),or.push(yr,wr,xr)}}this.setIndex(or),this.setAttribute("position",new Float32BufferAttribute(lr,3)),this.setAttribute("normal",new Float32BufferAttribute(cr,3)),this.setAttribute("uv",new Float32BufferAttribute(ur,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new RingGeometry(er.innerRadius,er.outerRadius,er.thetaSegments,er.phiSegments,er.thetaStart,er.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(er=new Shape$1([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),tr=12){super(),this.type="ShapeGeometry",this.parameters={shapes:er,curveSegments:tr};const ir=[],nr=[],sr=[],ar=[];let or=0,lr=0;if(Array.isArray(er)===!1)cr(er);else for(let ur=0;ur<er.length;ur++)cr(er[ur]),this.addGroup(or,lr,ur),or+=lr,lr=0;this.setIndex(ir),this.setAttribute("position",new Float32BufferAttribute(nr,3)),this.setAttribute("normal",new Float32BufferAttribute(sr,3)),this.setAttribute("uv",new Float32BufferAttribute(ar,2));function cr(ur){const dr=nr.length/3,hr=ur.extractPoints(tr);let pr=hr.shape;const gr=hr.holes;ShapeUtils.isClockWise(pr)===!1&&(pr=pr.reverse());for(let mr=0,fr=gr.length;mr<fr;mr++){const _r=gr[mr];ShapeUtils.isClockWise(_r)===!0&&(gr[mr]=_r.reverse())}const vr=ShapeUtils.triangulateShape(pr,gr);for(let mr=0,fr=gr.length;mr<fr;mr++){const _r=gr[mr];pr=pr.concat(_r)}for(let mr=0,fr=pr.length;mr<fr;mr++){const _r=pr[mr];nr.push(_r.x,_r.y,0),sr.push(0,0,1),ar.push(_r.x,_r.y)}for(let mr=0,fr=vr.length;mr<fr;mr++){const _r=vr[mr],Ar=_r[0]+dr,yr=_r[1]+dr,wr=_r[2]+dr;ir.push(Ar,yr,wr),lr+=3}}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON(),tr=this.parameters.shapes;return toJSON(tr,er)}static fromJSON(er,tr){const ir=[];for(let nr=0,sr=er.shapes.length;nr<sr;nr++){const ar=tr[er.shapes[nr]];ir.push(ar)}return new ShapeGeometry(ir,er.curveSegments)}}function toJSON(rr,er){if(er.shapes=[],Array.isArray(rr))for(let tr=0,ir=rr.length;tr<ir;tr++){const nr=rr[tr];er.shapes.push(nr.uuid)}else er.shapes.push(rr.uuid);return er}class SphereGeometry extends BufferGeometry{constructor(er=1,tr=32,ir=16,nr=0,sr=Math.PI*2,ar=0,or=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:er,widthSegments:tr,heightSegments:ir,phiStart:nr,phiLength:sr,thetaStart:ar,thetaLength:or},tr=Math.max(3,Math.floor(tr)),ir=Math.max(2,Math.floor(ir));const lr=Math.min(ar+or,Math.PI);let cr=0;const ur=[],dr=new Vector3$1,hr=new Vector3$1,pr=[],gr=[],vr=[],mr=[];for(let fr=0;fr<=ir;fr++){const _r=[],Ar=fr/ir;let yr=0;fr===0&&ar===0?yr=.5/tr:fr===ir&&lr===Math.PI&&(yr=-.5/tr);for(let wr=0;wr<=tr;wr++){const xr=wr/tr;dr.x=-er*Math.cos(nr+xr*sr)*Math.sin(ar+Ar*or),dr.y=er*Math.cos(ar+Ar*or),dr.z=er*Math.sin(nr+xr*sr)*Math.sin(ar+Ar*or),gr.push(dr.x,dr.y,dr.z),hr.copy(dr).normalize(),vr.push(hr.x,hr.y,hr.z),mr.push(xr+yr,1-Ar),_r.push(cr++)}ur.push(_r)}for(let fr=0;fr<ir;fr++)for(let _r=0;_r<tr;_r++){const Ar=ur[fr][_r+1],yr=ur[fr][_r],wr=ur[fr+1][_r],xr=ur[fr+1][_r+1];(fr!==0||ar>0)&&pr.push(Ar,yr,xr),(fr!==ir-1||lr<Math.PI)&&pr.push(yr,wr,xr)}this.setIndex(pr),this.setAttribute("position",new Float32BufferAttribute(gr,3)),this.setAttribute("normal",new Float32BufferAttribute(vr,3)),this.setAttribute("uv",new Float32BufferAttribute(mr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new SphereGeometry(er.radius,er.widthSegments,er.heightSegments,er.phiStart,er.phiLength,er.thetaStart,er.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(er=1,tr=0){const ir=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],nr=[2,1,0,0,3,2,1,3,0,2,3,1];super(ir,nr,er,tr),this.type="TetrahedronGeometry",this.parameters={radius:er,detail:tr}}static fromJSON(er){return new TetrahedronGeometry(er.radius,er.detail)}}class TorusGeometry extends BufferGeometry{constructor(er=1,tr=.4,ir=12,nr=48,sr=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:er,tube:tr,radialSegments:ir,tubularSegments:nr,arc:sr},ir=Math.floor(ir),nr=Math.floor(nr);const ar=[],or=[],lr=[],cr=[],ur=new Vector3$1,dr=new Vector3$1,hr=new Vector3$1;for(let pr=0;pr<=ir;pr++)for(let gr=0;gr<=nr;gr++){const vr=gr/nr*sr,mr=pr/ir*Math.PI*2;dr.x=(er+tr*Math.cos(mr))*Math.cos(vr),dr.y=(er+tr*Math.cos(mr))*Math.sin(vr),dr.z=tr*Math.sin(mr),or.push(dr.x,dr.y,dr.z),ur.x=er*Math.cos(vr),ur.y=er*Math.sin(vr),hr.subVectors(dr,ur).normalize(),lr.push(hr.x,hr.y,hr.z),cr.push(gr/nr),cr.push(pr/ir)}for(let pr=1;pr<=ir;pr++)for(let gr=1;gr<=nr;gr++){const vr=(nr+1)*pr+gr-1,mr=(nr+1)*(pr-1)+gr-1,fr=(nr+1)*(pr-1)+gr,_r=(nr+1)*pr+gr;ar.push(vr,mr,_r),ar.push(mr,fr,_r)}this.setIndex(ar),this.setAttribute("position",new Float32BufferAttribute(or,3)),this.setAttribute("normal",new Float32BufferAttribute(lr,3)),this.setAttribute("uv",new Float32BufferAttribute(cr,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new TorusGeometry(er.radius,er.tube,er.radialSegments,er.tubularSegments,er.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(er=1,tr=.4,ir=64,nr=8,sr=2,ar=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:er,tube:tr,tubularSegments:ir,radialSegments:nr,p:sr,q:ar},ir=Math.floor(ir),nr=Math.floor(nr);const or=[],lr=[],cr=[],ur=[],dr=new Vector3$1,hr=new Vector3$1,pr=new Vector3$1,gr=new Vector3$1,vr=new Vector3$1,mr=new Vector3$1,fr=new Vector3$1;for(let Ar=0;Ar<=ir;++Ar){const yr=Ar/ir*sr*Math.PI*2;_r(yr,sr,ar,er,pr),_r(yr+.01,sr,ar,er,gr),mr.subVectors(gr,pr),fr.addVectors(gr,pr),vr.crossVectors(mr,fr),fr.crossVectors(vr,mr),vr.normalize(),fr.normalize();for(let wr=0;wr<=nr;++wr){const xr=wr/nr*Math.PI*2,Sr=-tr*Math.cos(xr),br=tr*Math.sin(xr);dr.x=pr.x+(Sr*fr.x+br*vr.x),dr.y=pr.y+(Sr*fr.y+br*vr.y),dr.z=pr.z+(Sr*fr.z+br*vr.z),lr.push(dr.x,dr.y,dr.z),hr.subVectors(dr,pr).normalize(),cr.push(hr.x,hr.y,hr.z),ur.push(Ar/ir),ur.push(wr/nr)}}for(let Ar=1;Ar<=ir;Ar++)for(let yr=1;yr<=nr;yr++){const wr=(nr+1)*(Ar-1)+(yr-1),xr=(nr+1)*Ar+(yr-1),Sr=(nr+1)*Ar+yr,br=(nr+1)*(Ar-1)+yr;or.push(wr,xr,br),or.push(xr,Sr,br)}this.setIndex(or),this.setAttribute("position",new Float32BufferAttribute(lr,3)),this.setAttribute("normal",new Float32BufferAttribute(cr,3)),this.setAttribute("uv",new Float32BufferAttribute(ur,2));function _r(Ar,yr,wr,xr,Sr){const br=Math.cos(Ar),Cr=Math.sin(Ar),Ir=wr/yr*Ar,Rr=Math.cos(Ir);Sr.x=xr*(2+Rr)*.5*br,Sr.y=xr*(2+Rr)*Cr*.5,Sr.z=xr*Math.sin(Ir)*.5}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}static fromJSON(er){return new TorusKnotGeometry(er.radius,er.tube,er.tubularSegments,er.radialSegments,er.p,er.q)}}class TubeGeometry extends BufferGeometry{constructor(er=new QuadraticBezierCurve3(new Vector3$1(-1,-1,0),new Vector3$1(-1,1,0),new Vector3$1(1,1,0)),tr=64,ir=1,nr=8,sr=!1){super(),this.type="TubeGeometry",this.parameters={path:er,tubularSegments:tr,radius:ir,radialSegments:nr,closed:sr};const ar=er.computeFrenetFrames(tr,sr);this.tangents=ar.tangents,this.normals=ar.normals,this.binormals=ar.binormals;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector2;let ur=new Vector3$1;const dr=[],hr=[],pr=[],gr=[];vr(),this.setIndex(gr),this.setAttribute("position",new Float32BufferAttribute(dr,3)),this.setAttribute("normal",new Float32BufferAttribute(hr,3)),this.setAttribute("uv",new Float32BufferAttribute(pr,2));function vr(){for(let Ar=0;Ar<tr;Ar++)mr(Ar);mr(sr===!1?tr:0),_r(),fr()}function mr(Ar){ur=er.getPointAt(Ar/tr,ur);const yr=ar.normals[Ar],wr=ar.binormals[Ar];for(let xr=0;xr<=nr;xr++){const Sr=xr/nr*Math.PI*2,br=Math.sin(Sr),Cr=-Math.cos(Sr);lr.x=Cr*yr.x+br*wr.x,lr.y=Cr*yr.y+br*wr.y,lr.z=Cr*yr.z+br*wr.z,lr.normalize(),hr.push(lr.x,lr.y,lr.z),or.x=ur.x+ir*lr.x,or.y=ur.y+ir*lr.y,or.z=ur.z+ir*lr.z,dr.push(or.x,or.y,or.z)}}function fr(){for(let Ar=1;Ar<=tr;Ar++)for(let yr=1;yr<=nr;yr++){const wr=(nr+1)*(Ar-1)+(yr-1),xr=(nr+1)*Ar+(yr-1),Sr=(nr+1)*Ar+yr,br=(nr+1)*(Ar-1)+yr;gr.push(wr,xr,br),gr.push(xr,Sr,br)}}function _r(){for(let Ar=0;Ar<=tr;Ar++)for(let yr=0;yr<=nr;yr++)cr.x=Ar/tr,cr.y=yr/nr,pr.push(cr.x,cr.y)}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}toJSON(){const er=super.toJSON();return er.path=this.parameters.path.toJSON(),er}static fromJSON(er){return new TubeGeometry(new Curves$1[er.path.type]().fromJSON(er.path),er.tubularSegments,er.radius,er.radialSegments,er.closed)}}class WireframeGeometry extends BufferGeometry{constructor(er=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:er},er!==null){const tr=[],ir=new Set,nr=new Vector3$1,sr=new Vector3$1;if(er.index!==null){const ar=er.attributes.position,or=er.index;let lr=er.groups;lr.length===0&&(lr=[{start:0,count:or.count,materialIndex:0}]);for(let cr=0,ur=lr.length;cr<ur;++cr){const dr=lr[cr],hr=dr.start,pr=dr.count;for(let gr=hr,vr=hr+pr;gr<vr;gr+=3)for(let mr=0;mr<3;mr++){const fr=or.getX(gr+mr),_r=or.getX(gr+(mr+1)%3);nr.fromBufferAttribute(ar,fr),sr.fromBufferAttribute(ar,_r),isUniqueEdge(nr,sr,ir)===!0&&(tr.push(nr.x,nr.y,nr.z),tr.push(sr.x,sr.y,sr.z))}}}else{const ar=er.attributes.position;for(let or=0,lr=ar.count/3;or<lr;or++)for(let cr=0;cr<3;cr++){const ur=3*or+cr,dr=3*or+(cr+1)%3;nr.fromBufferAttribute(ar,ur),sr.fromBufferAttribute(ar,dr),isUniqueEdge(nr,sr,ir)===!0&&(tr.push(nr.x,nr.y,nr.z),tr.push(sr.x,sr.y,sr.z))}}this.setAttribute("position",new Float32BufferAttribute(tr,3))}}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}function isUniqueEdge(rr,er,tr){const ir=`${rr.x},${rr.y},${rr.z}-${er.x},${er.y},${er.z}`,nr=`${er.x},${er.y},${er.z}-${rr.x},${rr.y},${rr.z}`;return tr.has(ir)===!0||tr.has(nr)===!0?!1:(tr.add(ir),tr.add(nr),!0)}var Geometries=Object.freeze({__proto__:null,BoxGeometry,CapsuleGeometry,CircleGeometry,ConeGeometry,CylinderGeometry,DodecahedronGeometry,EdgesGeometry,ExtrudeGeometry,IcosahedronGeometry,LatheGeometry,OctahedronGeometry,PlaneGeometry,PolyhedronGeometry,RingGeometry,ShapeGeometry,SphereGeometry,TetrahedronGeometry,TorusGeometry,TorusKnotGeometry,TubeGeometry,WireframeGeometry});class ShadowMaterial extends Material{static get type(){return"ShadowMaterial"}constructor(er){super(),this.isShadowMaterial=!0,this.color=new Color(0),this.transparent=!0,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.fog=er.fog,this}}class RawShaderMaterial extends ShaderMaterial{static get type(){return"RawShaderMaterial"}constructor(er){super(er),this.isRawShaderMaterial=!0}}class MeshStandardMaterial extends Material{static get type(){return"MeshStandardMaterial"}constructor(er){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.defines={STANDARD:""},this.color.copy(er.color),this.roughness=er.roughness,this.metalness=er.metalness,this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.roughnessMap=er.roughnessMap,this.metalnessMap=er.metalnessMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.envMapIntensity=er.envMapIntensity,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshPhysicalMaterial extends MeshStandardMaterial{static get type(){return"MeshPhysicalMaterial"}constructor(er){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return clamp(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(tr){this.ior=(1+.4*tr)/(1-.4*tr)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(er)}get anisotropy(){return this._anisotropy}set anisotropy(er){this._anisotropy>0!=er>0&&this.version++,this._anisotropy=er}get clearcoat(){return this._clearcoat}set clearcoat(er){this._clearcoat>0!=er>0&&this.version++,this._clearcoat=er}get iridescence(){return this._iridescence}set iridescence(er){this._iridescence>0!=er>0&&this.version++,this._iridescence=er}get dispersion(){return this._dispersion}set dispersion(er){this._dispersion>0!=er>0&&this.version++,this._dispersion=er}get sheen(){return this._sheen}set sheen(er){this._sheen>0!=er>0&&this.version++,this._sheen=er}get transmission(){return this._transmission}set transmission(er){this._transmission>0!=er>0&&this.version++,this._transmission=er}copy(er){return super.copy(er),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=er.anisotropy,this.anisotropyRotation=er.anisotropyRotation,this.anisotropyMap=er.anisotropyMap,this.clearcoat=er.clearcoat,this.clearcoatMap=er.clearcoatMap,this.clearcoatRoughness=er.clearcoatRoughness,this.clearcoatRoughnessMap=er.clearcoatRoughnessMap,this.clearcoatNormalMap=er.clearcoatNormalMap,this.clearcoatNormalScale.copy(er.clearcoatNormalScale),this.dispersion=er.dispersion,this.ior=er.ior,this.iridescence=er.iridescence,this.iridescenceMap=er.iridescenceMap,this.iridescenceIOR=er.iridescenceIOR,this.iridescenceThicknessRange=[...er.iridescenceThicknessRange],this.iridescenceThicknessMap=er.iridescenceThicknessMap,this.sheen=er.sheen,this.sheenColor.copy(er.sheenColor),this.sheenColorMap=er.sheenColorMap,this.sheenRoughness=er.sheenRoughness,this.sheenRoughnessMap=er.sheenRoughnessMap,this.transmission=er.transmission,this.transmissionMap=er.transmissionMap,this.thickness=er.thickness,this.thicknessMap=er.thicknessMap,this.attenuationDistance=er.attenuationDistance,this.attenuationColor.copy(er.attenuationColor),this.specularIntensity=er.specularIntensity,this.specularIntensityMap=er.specularIntensityMap,this.specularColor.copy(er.specularColor),this.specularColorMap=er.specularColorMap,this}}class MeshPhongMaterial extends Material{static get type(){return"MeshPhongMaterial"}constructor(er){super(),this.isMeshPhongMaterial=!0,this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.specular.copy(er.specular),this.shininess=er.shininess,this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshToonMaterial extends Material{static get type(){return"MeshToonMaterial"}constructor(er){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.gradientMap=er.gradientMap,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.alphaMap=er.alphaMap,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}class MeshNormalMaterial extends Material{static get type(){return"MeshNormalMaterial"}constructor(er){super(),this.isMeshNormalMaterial=!0,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(er)}copy(er){return super.copy(er),this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.flatShading=er.flatShading,this}}class MeshLambertMaterial extends Material{static get type(){return"MeshLambertMaterial"}constructor(er){super(),this.isMeshLambertMaterial=!0,this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Euler,this.combine=MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.envMapRotation.copy(er.envMapRotation),this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this.fog=er.fog,this}}class MeshMatcapMaterial extends Material{static get type(){return"MeshMatcapMaterial"}constructor(er){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=TangentSpaceNormalMap,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(er)}copy(er){return super.copy(er),this.defines={MATCAP:""},this.color.copy(er.color),this.matcap=er.matcap,this.map=er.map,this.bumpMap=er.bumpMap,this.bumpScale=er.bumpScale,this.normalMap=er.normalMap,this.normalMapType=er.normalMapType,this.normalScale.copy(er.normalScale),this.displacementMap=er.displacementMap,this.displacementScale=er.displacementScale,this.displacementBias=er.displacementBias,this.alphaMap=er.alphaMap,this.flatShading=er.flatShading,this.fog=er.fog,this}}class LineDashedMaterial extends LineBasicMaterial{static get type(){return"LineDashedMaterial"}constructor(er){super(),this.isLineDashedMaterial=!0,this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(er)}copy(er){return super.copy(er),this.scale=er.scale,this.dashSize=er.dashSize,this.gapSize=er.gapSize,this}}function convertArray(rr,er,tr){return!rr||!tr&&rr.constructor===er?rr:typeof er.BYTES_PER_ELEMENT=="number"?new er(rr):Array.prototype.slice.call(rr)}function isTypedArray$1(rr){return ArrayBuffer.isView(rr)&&!(rr instanceof DataView)}function getKeyframeOrder(rr){function er(nr,sr){return rr[nr]-rr[sr]}const tr=rr.length,ir=new Array(tr);for(let nr=0;nr!==tr;++nr)ir[nr]=nr;return ir.sort(er),ir}function sortedArray(rr,er,tr){const ir=rr.length,nr=new rr.constructor(ir);for(let sr=0,ar=0;ar!==ir;++sr){const or=tr[sr]*er;for(let lr=0;lr!==er;++lr)nr[ar++]=rr[or+lr]}return nr}function flattenJSON(rr,er,tr,ir){let nr=1,sr=rr[0];for(;sr!==void 0&&sr[ir]===void 0;)sr=rr[nr++];if(sr===void 0)return;let ar=sr[ir];if(ar!==void 0)if(Array.isArray(ar))do ar=sr[ir],ar!==void 0&&(er.push(sr.time),tr.push.apply(tr,ar)),sr=rr[nr++];while(sr!==void 0);else if(ar.toArray!==void 0)do ar=sr[ir],ar!==void 0&&(er.push(sr.time),ar.toArray(tr,tr.length)),sr=rr[nr++];while(sr!==void 0);else do ar=sr[ir],ar!==void 0&&(er.push(sr.time),tr.push(ar)),sr=rr[nr++];while(sr!==void 0)}function subclip(rr,er,tr,ir,nr=30){const sr=rr.clone();sr.name=er;const ar=[];for(let lr=0;lr<sr.tracks.length;++lr){const cr=sr.tracks[lr],ur=cr.getValueSize(),dr=[],hr=[];for(let pr=0;pr<cr.times.length;++pr){const gr=cr.times[pr]*nr;if(!(gr<tr||gr>=ir)){dr.push(cr.times[pr]);for(let vr=0;vr<ur;++vr)hr.push(cr.values[pr*ur+vr])}}dr.length!==0&&(cr.times=convertArray(dr,cr.times.constructor),cr.values=convertArray(hr,cr.values.constructor),ar.push(cr))}sr.tracks=ar;let or=1/0;for(let lr=0;lr<sr.tracks.length;++lr)or>sr.tracks[lr].times[0]&&(or=sr.tracks[lr].times[0]);for(let lr=0;lr<sr.tracks.length;++lr)sr.tracks[lr].shift(-1*or);return sr.resetDuration(),sr}function makeClipAdditive(rr,er=0,tr=rr,ir=30){ir<=0&&(ir=30);const nr=tr.tracks.length,sr=er/ir;for(let ar=0;ar<nr;++ar){const or=tr.tracks[ar],lr=or.ValueTypeName;if(lr==="bool"||lr==="string")continue;const cr=rr.tracks.find(function(fr){return fr.name===or.name&&fr.ValueTypeName===lr});if(cr===void 0)continue;let ur=0;const dr=or.getValueSize();or.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(ur=dr/3);let hr=0;const pr=cr.getValueSize();cr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(hr=pr/3);const gr=or.times.length-1;let vr;if(sr<=or.times[0]){const fr=ur,_r=dr-ur;vr=or.values.slice(fr,_r)}else if(sr>=or.times[gr]){const fr=gr*dr+ur,_r=fr+dr-ur;vr=or.values.slice(fr,_r)}else{const fr=or.createInterpolant(),_r=ur,Ar=dr-ur;fr.evaluate(sr),vr=fr.resultBuffer.slice(_r,Ar)}lr==="quaternion"&&new Quaternion$1().fromArray(vr).normalize().conjugate().toArray(vr);const mr=cr.times.length;for(let fr=0;fr<mr;++fr){const _r=fr*pr+hr;if(lr==="quaternion")Quaternion$1.multiplyQuaternionsFlat(cr.values,_r,vr,0,cr.values,_r);else{const Ar=pr-hr*2;for(let yr=0;yr<Ar;++yr)cr.values[_r+yr]-=vr[yr]}}}return rr.blendMode=AdditiveAnimationBlendMode,rr}const AnimationUtils={convertArray,isTypedArray:isTypedArray$1,getKeyframeOrder,sortedArray,flattenJSON,subclip,makeClipAdditive};class Interpolant{constructor(er,tr,ir,nr){this.parameterPositions=er,this._cachedIndex=0,this.resultBuffer=nr!==void 0?nr:new tr.constructor(ir),this.sampleValues=tr,this.valueSize=ir,this.settings=null,this.DefaultSettings_={}}evaluate(er){const tr=this.parameterPositions;let ir=this._cachedIndex,nr=tr[ir],sr=tr[ir-1];e:{t:{let ar;r:{i:if(!(er<nr)){for(let or=ir+2;;){if(nr===void 0){if(er<sr)break i;return ir=tr.length,this._cachedIndex=ir,this.copySampleValue_(ir-1)}if(ir===or)break;if(sr=nr,nr=tr[++ir],er<nr)break t}ar=tr.length;break r}if(!(er>=sr)){const or=tr[1];er<or&&(ir=2,sr=or);for(let lr=ir-2;;){if(sr===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(ir===lr)break;if(nr=sr,sr=tr[--ir-1],er>=sr)break t}ar=ir,ir=0;break r}break e}for(;ir<ar;){const or=ir+ar>>>1;er<tr[or]?ar=or:ir=or+1}if(nr=tr[ir],sr=tr[ir-1],sr===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(nr===void 0)return ir=tr.length,this._cachedIndex=ir,this.copySampleValue_(ir-1)}this._cachedIndex=ir,this.intervalChanged_(ir,sr,nr)}return this.interpolate_(ir,sr,er,nr)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(er){const tr=this.resultBuffer,ir=this.sampleValues,nr=this.valueSize,sr=er*nr;for(let ar=0;ar!==nr;++ar)tr[ar]=ir[sr+ar];return tr}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class CubicInterpolant extends Interpolant{constructor(er,tr,ir,nr){super(er,tr,ir,nr),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding}}intervalChanged_(er,tr,ir){const nr=this.parameterPositions;let sr=er-2,ar=er+1,or=nr[sr],lr=nr[ar];if(or===void 0)switch(this.getSettings_().endingStart){case ZeroSlopeEnding:sr=er,or=2*tr-ir;break;case WrapAroundEnding:sr=nr.length-2,or=tr+nr[sr]-nr[sr+1];break;default:sr=er,or=ir}if(lr===void 0)switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:ar=er,lr=2*ir-tr;break;case WrapAroundEnding:ar=1,lr=ir+nr[1]-nr[0];break;default:ar=er-1,lr=tr}const cr=(ir-tr)*.5,ur=this.valueSize;this._weightPrev=cr/(tr-or),this._weightNext=cr/(lr-ir),this._offsetPrev=sr*ur,this._offsetNext=ar*ur}interpolate_(er,tr,ir,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=er*or,cr=lr-or,ur=this._offsetPrev,dr=this._offsetNext,hr=this._weightPrev,pr=this._weightNext,gr=(ir-tr)/(nr-tr),vr=gr*gr,mr=vr*gr,fr=-hr*mr+2*hr*vr-hr*gr,_r=(1+hr)*mr+(-1.5-2*hr)*vr+(-.5+hr)*gr+1,Ar=(-1-pr)*mr+(1.5+pr)*vr+.5*gr,yr=pr*mr-pr*vr;for(let wr=0;wr!==or;++wr)sr[wr]=fr*ar[ur+wr]+_r*ar[cr+wr]+Ar*ar[lr+wr]+yr*ar[dr+wr];return sr}}class LinearInterpolant extends Interpolant{constructor(er,tr,ir,nr){super(er,tr,ir,nr)}interpolate_(er,tr,ir,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=er*or,cr=lr-or,ur=(ir-tr)/(nr-tr),dr=1-ur;for(let hr=0;hr!==or;++hr)sr[hr]=ar[cr+hr]*dr+ar[lr+hr]*ur;return sr}}class DiscreteInterpolant extends Interpolant{constructor(er,tr,ir,nr){super(er,tr,ir,nr)}interpolate_(er){return this.copySampleValue_(er-1)}}class KeyframeTrack{constructor(er,tr,ir,nr){if(er===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(tr===void 0||tr.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+er);this.name=er,this.times=convertArray(tr,this.TimeBufferType),this.values=convertArray(ir,this.ValueBufferType),this.setInterpolation(nr||this.DefaultInterpolation)}static toJSON(er){const tr=er.constructor;let ir;if(tr.toJSON!==this.toJSON)ir=tr.toJSON(er);else{ir={name:er.name,times:convertArray(er.times,Array),values:convertArray(er.values,Array)};const nr=er.getInterpolation();nr!==er.DefaultInterpolation&&(ir.interpolation=nr)}return ir.type=er.ValueTypeName,ir}InterpolantFactoryMethodDiscrete(er){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),er)}InterpolantFactoryMethodLinear(er){return new LinearInterpolant(this.times,this.values,this.getValueSize(),er)}InterpolantFactoryMethodSmooth(er){return new CubicInterpolant(this.times,this.values,this.getValueSize(),er)}setInterpolation(er){let tr;switch(er){case InterpolateDiscrete:tr=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:tr=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:tr=this.InterpolantFactoryMethodSmooth;break}if(tr===void 0){const ir="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(er!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(ir);return console.warn("THREE.KeyframeTrack:",ir),this}return this.createInterpolant=tr,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth}}getValueSize(){return this.values.length/this.times.length}shift(er){if(er!==0){const tr=this.times;for(let ir=0,nr=tr.length;ir!==nr;++ir)tr[ir]+=er}return this}scale(er){if(er!==1){const tr=this.times;for(let ir=0,nr=tr.length;ir!==nr;++ir)tr[ir]*=er}return this}trim(er,tr){const ir=this.times,nr=ir.length;let sr=0,ar=nr-1;for(;sr!==nr&&ir[sr]<er;)++sr;for(;ar!==-1&&ir[ar]>tr;)--ar;if(++ar,sr!==0||ar!==nr){sr>=ar&&(ar=Math.max(ar,1),sr=ar-1);const or=this.getValueSize();this.times=ir.slice(sr,ar),this.values=this.values.slice(sr*or,ar*or)}return this}validate(){let er=!0;const tr=this.getValueSize();tr-Math.floor(tr)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),er=!1);const ir=this.times,nr=this.values,sr=ir.length;sr===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),er=!1);let ar=null;for(let or=0;or!==sr;or++){const lr=ir[or];if(typeof lr=="number"&&isNaN(lr)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,or,lr),er=!1;break}if(ar!==null&&ar>lr){console.error("THREE.KeyframeTrack: Out of order keys.",this,or,lr,ar),er=!1;break}ar=lr}if(nr!==void 0&&isTypedArray$1(nr))for(let or=0,lr=nr.length;or!==lr;++or){const cr=nr[or];if(isNaN(cr)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,or,cr),er=!1;break}}return er}optimize(){const er=this.times.slice(),tr=this.values.slice(),ir=this.getValueSize(),nr=this.getInterpolation()===InterpolateSmooth,sr=er.length-1;let ar=1;for(let or=1;or<sr;++or){let lr=!1;const cr=er[or],ur=er[or+1];if(cr!==ur&&(or!==1||cr!==er[0]))if(nr)lr=!0;else{const dr=or*ir,hr=dr-ir,pr=dr+ir;for(let gr=0;gr!==ir;++gr){const vr=tr[dr+gr];if(vr!==tr[hr+gr]||vr!==tr[pr+gr]){lr=!0;break}}}if(lr){if(or!==ar){er[ar]=er[or];const dr=or*ir,hr=ar*ir;for(let pr=0;pr!==ir;++pr)tr[hr+pr]=tr[dr+pr]}++ar}}if(sr>0){er[ar]=er[sr];for(let or=sr*ir,lr=ar*ir,cr=0;cr!==ir;++cr)tr[lr+cr]=tr[or+cr];++ar}return ar!==er.length?(this.times=er.slice(0,ar),this.values=tr.slice(0,ar*ir)):(this.times=er,this.values=tr),this}clone(){const er=this.times.slice(),tr=this.values.slice(),ir=this.constructor,nr=new ir(this.name,er,tr);return nr.createInterpolant=this.createInterpolant,nr}}KeyframeTrack.prototype.TimeBufferType=Float32Array;KeyframeTrack.prototype.ValueBufferType=Float32Array;KeyframeTrack.prototype.DefaultInterpolation=InterpolateLinear;class BooleanKeyframeTrack extends KeyframeTrack{constructor(er,tr,ir){super(er,tr,ir)}}BooleanKeyframeTrack.prototype.ValueTypeName="bool";BooleanKeyframeTrack.prototype.ValueBufferType=Array;BooleanKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(er,tr,ir,nr){super(er,tr,ir,nr)}interpolate_(er,tr,ir,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=(ir-tr)/(nr-tr);let cr=er*or;for(let ur=cr+or;cr!==ur;cr+=4)Quaternion$1.slerpFlat(sr,0,ar,cr-or,ar,cr,lr);return sr}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(er){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),er)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion";QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{constructor(er,tr,ir){super(er,tr,ir)}}StringKeyframeTrack.prototype.ValueTypeName="string";StringKeyframeTrack.prototype.ValueBufferType=Array;StringKeyframeTrack.prototype.DefaultInterpolation=InterpolateDiscrete;StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0;StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(er="",tr=-1,ir=[],nr=NormalAnimationBlendMode){this.name=er,this.tracks=ir,this.duration=tr,this.blendMode=nr,this.uuid=generateUUID(),this.duration<0&&this.resetDuration()}static parse(er){const tr=[],ir=er.tracks,nr=1/(er.fps||1);for(let ar=0,or=ir.length;ar!==or;++ar)tr.push(parseKeyframeTrack(ir[ar]).scale(nr));const sr=new this(er.name,er.duration,tr,er.blendMode);return sr.uuid=er.uuid,sr}static toJSON(er){const tr=[],ir=er.tracks,nr={name:er.name,duration:er.duration,tracks:tr,uuid:er.uuid,blendMode:er.blendMode};for(let sr=0,ar=ir.length;sr!==ar;++sr)tr.push(KeyframeTrack.toJSON(ir[sr]));return nr}static CreateFromMorphTargetSequence(er,tr,ir,nr){const sr=tr.length,ar=[];for(let or=0;or<sr;or++){let lr=[],cr=[];lr.push((or+sr-1)%sr,or,(or+1)%sr),cr.push(0,1,0);const ur=getKeyframeOrder(lr);lr=sortedArray(lr,1,ur),cr=sortedArray(cr,1,ur),!nr&&lr[0]===0&&(lr.push(sr),cr.push(cr[0])),ar.push(new NumberKeyframeTrack(".morphTargetInfluences["+tr[or].name+"]",lr,cr).scale(1/ir))}return new this(er,-1,ar)}static findByName(er,tr){let ir=er;if(!Array.isArray(er)){const nr=er;ir=nr.geometry&&nr.geometry.animations||nr.animations}for(let nr=0;nr<ir.length;nr++)if(ir[nr].name===tr)return ir[nr];return null}static CreateClipsFromMorphTargetSequences(er,tr,ir){const nr={},sr=/^([\w-]*?)([\d]+)$/;for(let or=0,lr=er.length;or<lr;or++){const cr=er[or],ur=cr.name.match(sr);if(ur&&ur.length>1){const dr=ur[1];let hr=nr[dr];hr||(nr[dr]=hr=[]),hr.push(cr)}}const ar=[];for(const or in nr)ar.push(this.CreateFromMorphTargetSequence(or,nr[or],tr,ir));return ar}static parseAnimation(er,tr){if(!er)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const ir=function(dr,hr,pr,gr,vr){if(pr.length!==0){const mr=[],fr=[];flattenJSON(pr,mr,fr,gr),mr.length!==0&&vr.push(new dr(hr,mr,fr))}},nr=[],sr=er.name||"default",ar=er.fps||30,or=er.blendMode;let lr=er.length||-1;const cr=er.hierarchy||[];for(let dr=0;dr<cr.length;dr++){const hr=cr[dr].keys;if(!(!hr||hr.length===0))if(hr[0].morphTargets){const pr={};let gr;for(gr=0;gr<hr.length;gr++)if(hr[gr].morphTargets)for(let vr=0;vr<hr[gr].morphTargets.length;vr++)pr[hr[gr].morphTargets[vr]]=-1;for(const vr in pr){const mr=[],fr=[];for(let _r=0;_r!==hr[gr].morphTargets.length;++_r){const Ar=hr[gr];mr.push(Ar.time),fr.push(Ar.morphTarget===vr?1:0)}nr.push(new NumberKeyframeTrack(".morphTargetInfluence["+vr+"]",mr,fr))}lr=pr.length*ar}else{const pr=".bones["+tr[dr].name+"]";ir(VectorKeyframeTrack,pr+".position",hr,"pos",nr),ir(QuaternionKeyframeTrack,pr+".quaternion",hr,"rot",nr),ir(VectorKeyframeTrack,pr+".scale",hr,"scl",nr)}}return nr.length===0?null:new this(sr,lr,nr,or)}resetDuration(){const er=this.tracks;let tr=0;for(let ir=0,nr=er.length;ir!==nr;++ir){const sr=this.tracks[ir];tr=Math.max(tr,sr.times[sr.times.length-1])}return this.duration=tr,this}trim(){for(let er=0;er<this.tracks.length;er++)this.tracks[er].trim(0,this.duration);return this}validate(){let er=!0;for(let tr=0;tr<this.tracks.length;tr++)er=er&&this.tracks[tr].validate();return er}optimize(){for(let er=0;er<this.tracks.length;er++)this.tracks[er].optimize();return this}clone(){const er=[];for(let tr=0;tr<this.tracks.length;tr++)er.push(this.tracks[tr].clone());return new this.constructor(this.name,this.duration,er,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function getTrackTypeForValueTypeName(rr){switch(rr.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+rr)}function parseKeyframeTrack(rr){if(rr.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const er=getTrackTypeForValueTypeName(rr.type);if(rr.times===void 0){const tr=[],ir=[];flattenJSON(rr.keys,tr,ir,"value"),rr.times=tr,rr.values=ir}return er.parse!==void 0?er.parse(rr):new er(rr.name,rr.times,rr.values,rr.interpolation)}const Cache={enabled:!1,files:{},add:function(rr,er){this.enabled!==!1&&(this.files[rr]=er)},get:function(rr){if(this.enabled!==!1)return this.files[rr]},remove:function(rr){delete this.files[rr]},clear:function(){this.files={}}};class LoadingManager{constructor(er,tr,ir){const nr=this;let sr=!1,ar=0,or=0,lr;const cr=[];this.onStart=void 0,this.onLoad=er,this.onProgress=tr,this.onError=ir,this.itemStart=function(ur){or++,sr===!1&&nr.onStart!==void 0&&nr.onStart(ur,ar,or),sr=!0},this.itemEnd=function(ur){ar++,nr.onProgress!==void 0&&nr.onProgress(ur,ar,or),ar===or&&(sr=!1,nr.onLoad!==void 0&&nr.onLoad())},this.itemError=function(ur){nr.onError!==void 0&&nr.onError(ur)},this.resolveURL=function(ur){return lr?lr(ur):ur},this.setURLModifier=function(ur){return lr=ur,this},this.addHandler=function(ur,dr){return cr.push(ur,dr),this},this.removeHandler=function(ur){const dr=cr.indexOf(ur);return dr!==-1&&cr.splice(dr,2),this},this.getHandler=function(ur){for(let dr=0,hr=cr.length;dr<hr;dr+=2){const pr=cr[dr],gr=cr[dr+1];if(pr.global&&(pr.lastIndex=0),pr.test(ur))return gr}return null}}}const DefaultLoadingManager=new LoadingManager;class Loader{constructor(er){this.manager=er!==void 0?er:DefaultLoadingManager,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(er,tr){const ir=this;return new Promise(function(nr,sr){ir.load(er,nr,tr,sr)})}parse(){}setCrossOrigin(er){return this.crossOrigin=er,this}setWithCredentials(er){return this.withCredentials=er,this}setPath(er){return this.path=er,this}setResourcePath(er){return this.resourcePath=er,this}setRequestHeader(er){return this.requestHeader=er,this}}Loader.DEFAULT_MATERIAL_NAME="__DEFAULT";const loading={};class HttpError extends Error{constructor(er,tr){super(er),this.response=tr}}class FileLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){er===void 0&&(er=""),this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=Cache.get(er);if(sr!==void 0)return this.manager.itemStart(er),setTimeout(()=>{tr&&tr(sr),this.manager.itemEnd(er)},0),sr;if(loading[er]!==void 0){loading[er].push({onLoad:tr,onProgress:ir,onError:nr});return}loading[er]=[],loading[er].push({onLoad:tr,onProgress:ir,onError:nr});const ar=new Request(er,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),or=this.mimeType,lr=this.responseType;fetch(ar).then(cr=>{if(cr.status===200||cr.status===0){if(cr.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||cr.body===void 0||cr.body.getReader===void 0)return cr;const ur=loading[er],dr=cr.body.getReader(),hr=cr.headers.get("X-File-Size")||cr.headers.get("Content-Length"),pr=hr?parseInt(hr):0,gr=pr!==0;let vr=0;const mr=new ReadableStream({start(fr){_r();function _r(){dr.read().then(({done:Ar,value:yr})=>{if(Ar)fr.close();else{vr+=yr.byteLength;const wr=new ProgressEvent("progress",{lengthComputable:gr,loaded:vr,total:pr});for(let xr=0,Sr=ur.length;xr<Sr;xr++){const br=ur[xr];br.onProgress&&br.onProgress(wr)}fr.enqueue(yr),_r()}},Ar=>{fr.error(Ar)})}}});return new Response(mr)}else throw new HttpError(`fetch for "${cr.url}" responded with ${cr.status}: ${cr.statusText}`,cr)}).then(cr=>{switch(lr){case"arraybuffer":return cr.arrayBuffer();case"blob":return cr.blob();case"document":return cr.text().then(ur=>new DOMParser().parseFromString(ur,or));case"json":return cr.json();default:if(or===void 0)return cr.text();{const dr=/charset="?([^;"\s]*)"?/i.exec(or),hr=dr&&dr[1]?dr[1].toLowerCase():void 0,pr=new TextDecoder(hr);return cr.arrayBuffer().then(gr=>pr.decode(gr))}}}).then(cr=>{Cache.add(er,cr);const ur=loading[er];delete loading[er];for(let dr=0,hr=ur.length;dr<hr;dr++){const pr=ur[dr];pr.onLoad&&pr.onLoad(cr)}}).catch(cr=>{const ur=loading[er];if(ur===void 0)throw this.manager.itemError(er),cr;delete loading[er];for(let dr=0,hr=ur.length;dr<hr;dr++){const pr=ur[dr];pr.onError&&pr.onError(cr)}this.manager.itemError(er)}).finally(()=>{this.manager.itemEnd(er)}),this.manager.itemStart(er)}setResponseType(er){return this.responseType=er,this}setMimeType(er){return this.mimeType=er,this}}class AnimationLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=[];for(let ir=0;ir<er.length;ir++){const nr=AnimationClip.parse(er[ir]);tr.push(nr)}return tr}}class CompressedTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=[],or=new CompressedTexture,lr=new FileLoader(this.manager);lr.setPath(this.path),lr.setResponseType("arraybuffer"),lr.setRequestHeader(this.requestHeader),lr.setWithCredentials(sr.withCredentials);let cr=0;function ur(dr){lr.load(er[dr],function(hr){const pr=sr.parse(hr,!0);ar[dr]={width:pr.width,height:pr.height,format:pr.format,mipmaps:pr.mipmaps},cr+=1,cr===6&&(pr.mipmapCount===1&&(or.minFilter=LinearFilter),or.image=ar,or.format=pr.format,or.needsUpdate=!0,tr&&tr(or))},ir,nr)}if(Array.isArray(er))for(let dr=0,hr=er.length;dr<hr;++dr)ur(dr);else lr.load(er,function(dr){const hr=sr.parse(dr,!0);if(hr.isCubemap){const pr=hr.mipmaps.length/hr.mipmapCount;for(let gr=0;gr<pr;gr++){ar[gr]={mipmaps:[]};for(let vr=0;vr<hr.mipmapCount;vr++)ar[gr].mipmaps.push(hr.mipmaps[gr*hr.mipmapCount+vr]),ar[gr].format=hr.format,ar[gr].width=hr.width,ar[gr].height=hr.height}or.image=ar}else or.image.width=hr.width,or.image.height=hr.height,or.mipmaps=hr.mipmaps;hr.mipmapCount===1&&(or.minFilter=LinearFilter),or.format=hr.format,or.needsUpdate=!0,tr&&tr(or)},ir,nr);return or}}class ImageLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=this,ar=Cache.get(er);if(ar!==void 0)return sr.manager.itemStart(er),setTimeout(function(){tr&&tr(ar),sr.manager.itemEnd(er)},0),ar;const or=createElementNS("img");function lr(){ur(),Cache.add(er,this),tr&&tr(this),sr.manager.itemEnd(er)}function cr(dr){ur(),nr&&nr(dr),sr.manager.itemError(er),sr.manager.itemEnd(er)}function ur(){or.removeEventListener("load",lr,!1),or.removeEventListener("error",cr,!1)}return or.addEventListener("load",lr,!1),or.addEventListener("error",cr,!1),er.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(or.crossOrigin=this.crossOrigin),sr.manager.itemStart(er),or.src=er,or}}class CubeTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=new CubeTexture;sr.colorSpace=SRGBColorSpace;const ar=new ImageLoader(this.manager);ar.setCrossOrigin(this.crossOrigin),ar.setPath(this.path);let or=0;function lr(cr){ar.load(er[cr],function(ur){sr.images[cr]=ur,or++,or===6&&(sr.needsUpdate=!0,tr&&tr(sr))},void 0,nr)}for(let cr=0;cr<er.length;++cr)lr(cr);return sr}}class DataTextureLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new DataTexture,or=new FileLoader(this.manager);return or.setResponseType("arraybuffer"),or.setRequestHeader(this.requestHeader),or.setPath(this.path),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){let cr;try{cr=sr.parse(lr)}catch(ur){if(nr!==void 0)nr(ur);else{console.error(ur);return}}cr.image!==void 0?ar.image=cr.image:cr.data!==void 0&&(ar.image.width=cr.width,ar.image.height=cr.height,ar.image.data=cr.data),ar.wrapS=cr.wrapS!==void 0?cr.wrapS:ClampToEdgeWrapping,ar.wrapT=cr.wrapT!==void 0?cr.wrapT:ClampToEdgeWrapping,ar.magFilter=cr.magFilter!==void 0?cr.magFilter:LinearFilter,ar.minFilter=cr.minFilter!==void 0?cr.minFilter:LinearFilter,ar.anisotropy=cr.anisotropy!==void 0?cr.anisotropy:1,cr.colorSpace!==void 0&&(ar.colorSpace=cr.colorSpace),cr.flipY!==void 0&&(ar.flipY=cr.flipY),cr.format!==void 0&&(ar.format=cr.format),cr.type!==void 0&&(ar.type=cr.type),cr.mipmaps!==void 0&&(ar.mipmaps=cr.mipmaps,ar.minFilter=LinearMipmapLinearFilter),cr.mipmapCount===1&&(ar.minFilter=LinearFilter),cr.generateMipmaps!==void 0&&(ar.generateMipmaps=cr.generateMipmaps),ar.needsUpdate=!0,tr&&tr(ar,cr)},ir,nr),ar}}class TextureLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=new Texture,ar=new ImageLoader(this.manager);return ar.setCrossOrigin(this.crossOrigin),ar.setPath(this.path),ar.load(er,function(or){sr.image=or,sr.needsUpdate=!0,tr!==void 0&&tr(sr)},ir,nr),sr}}class Light extends Object3D{constructor(er,tr=1){super(),this.isLight=!0,this.type="Light",this.color=new Color(er),this.intensity=tr}dispose(){}copy(er,tr){return super.copy(er,tr),this.color.copy(er.color),this.intensity=er.intensity,this}toJSON(er){const tr=super.toJSON(er);return tr.object.color=this.color.getHex(),tr.object.intensity=this.intensity,this.groundColor!==void 0&&(tr.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(tr.object.distance=this.distance),this.angle!==void 0&&(tr.object.angle=this.angle),this.decay!==void 0&&(tr.object.decay=this.decay),this.penumbra!==void 0&&(tr.object.penumbra=this.penumbra),this.shadow!==void 0&&(tr.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(tr.object.target=this.target.uuid),tr}}class HemisphereLight extends Light{constructor(er,tr,ir){super(er,ir),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.groundColor=new Color(tr)}copy(er,tr){return super.copy(er,tr),this.groundColor.copy(er.groundColor),this}}const _projScreenMatrix$1=new Matrix4,_lightPositionWorld$1=new Vector3$1,_lookTarget$1=new Vector3$1;class LightShadow{constructor(er){this.camera=er,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(er){const tr=this.camera,ir=this.matrix;_lightPositionWorld$1.setFromMatrixPosition(er.matrixWorld),tr.position.copy(_lightPositionWorld$1),_lookTarget$1.setFromMatrixPosition(er.target.matrixWorld),tr.lookAt(_lookTarget$1),tr.updateMatrixWorld(),_projScreenMatrix$1.multiplyMatrices(tr.projectionMatrix,tr.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix$1),ir.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),ir.multiply(_projScreenMatrix$1)}getViewport(er){return this._viewports[er]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(er){return this.camera=er.camera.clone(),this.intensity=er.intensity,this.bias=er.bias,this.radius=er.radius,this.mapSize.copy(er.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const er={};return this.intensity!==1&&(er.intensity=this.intensity),this.bias!==0&&(er.bias=this.bias),this.normalBias!==0&&(er.normalBias=this.normalBias),this.radius!==1&&(er.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(er.mapSize=this.mapSize.toArray()),er.camera=this.camera.toJSON(!1).object,delete er.camera.matrix,er}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(er){const tr=this.camera,ir=RAD2DEG*2*er.angle*this.focus,nr=this.mapSize.width/this.mapSize.height,sr=er.distance||tr.far;(ir!==tr.fov||nr!==tr.aspect||sr!==tr.far)&&(tr.fov=ir,tr.aspect=nr,tr.far=sr,tr.updateProjectionMatrix()),super.updateMatrices(er)}copy(er){return super.copy(er),this.focus=er.focus,this}}class SpotLight extends Light{constructor(er,tr,ir=0,nr=Math.PI/3,sr=0,ar=2){super(er,tr),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.distance=ir,this.angle=nr,this.penumbra=sr,this.decay=ar,this.map=null,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(er){this.intensity=er/Math.PI}dispose(){this.shadow.dispose()}copy(er,tr){return super.copy(er,tr),this.distance=er.distance,this.angle=er.angle,this.penumbra=er.penumbra,this.decay=er.decay,this.target=er.target.clone(),this.shadow=er.shadow.clone(),this}}const _projScreenMatrix=new Matrix4,_lightPositionWorld=new Vector3$1,_lookTarget=new Vector3$1;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3$1(1,0,0),new Vector3$1(-1,0,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1),new Vector3$1(0,1,0),new Vector3$1(0,-1,0)],this._cubeUps=[new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1),new Vector3$1(0,0,-1)]}updateMatrices(er,tr=0){const ir=this.camera,nr=this.matrix,sr=er.distance||ir.far;sr!==ir.far&&(ir.far=sr,ir.updateProjectionMatrix()),_lightPositionWorld.setFromMatrixPosition(er.matrixWorld),ir.position.copy(_lightPositionWorld),_lookTarget.copy(ir.position),_lookTarget.add(this._cubeDirections[tr]),ir.up.copy(this._cubeUps[tr]),ir.lookAt(_lookTarget),ir.updateMatrixWorld(),nr.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z),_projScreenMatrix.multiplyMatrices(ir.projectionMatrix,ir.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_projScreenMatrix)}}class PointLight extends Light{constructor(er,tr,ir=0,nr=2){super(er,tr),this.isPointLight=!0,this.type="PointLight",this.distance=ir,this.decay=nr,this.shadow=new PointLightShadow}get power(){return this.intensity*4*Math.PI}set power(er){this.intensity=er/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(er,tr){return super.copy(er,tr),this.distance=er.distance,this.decay=er.decay,this.shadow=er.shadow.clone(),this}}class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class DirectionalLight extends Light{constructor(er,tr){super(er,tr),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Object3D.DEFAULT_UP),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(er){return super.copy(er),this.target=er.target.clone(),this.shadow=er.shadow.clone(),this}}class AmbientLight extends Light{constructor(er,tr){super(er,tr),this.isAmbientLight=!0,this.type="AmbientLight"}}class RectAreaLight extends Light{constructor(er,tr,ir=10,nr=10){super(er,tr),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=ir,this.height=nr}get power(){return this.intensity*this.width*this.height*Math.PI}set power(er){this.intensity=er/(this.width*this.height*Math.PI)}copy(er){return super.copy(er),this.width=er.width,this.height=er.height,this}toJSON(er){const tr=super.toJSON(er);return tr.object.width=this.width,tr.object.height=this.height,tr}}class SphericalHarmonics3{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let er=0;er<9;er++)this.coefficients.push(new Vector3$1)}set(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].copy(er[tr]);return this}zero(){for(let er=0;er<9;er++)this.coefficients[er].set(0,0,0);return this}getAt(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=this.coefficients;return tr.copy(ar[0]).multiplyScalar(.282095),tr.addScaledVector(ar[1],.488603*nr),tr.addScaledVector(ar[2],.488603*sr),tr.addScaledVector(ar[3],.488603*ir),tr.addScaledVector(ar[4],1.092548*(ir*nr)),tr.addScaledVector(ar[5],1.092548*(nr*sr)),tr.addScaledVector(ar[6],.315392*(3*sr*sr-1)),tr.addScaledVector(ar[7],1.092548*(ir*sr)),tr.addScaledVector(ar[8],.546274*(ir*ir-nr*nr)),tr}getIrradianceAt(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=this.coefficients;return tr.copy(ar[0]).multiplyScalar(.886227),tr.addScaledVector(ar[1],2*.511664*nr),tr.addScaledVector(ar[2],2*.511664*sr),tr.addScaledVector(ar[3],2*.511664*ir),tr.addScaledVector(ar[4],2*.429043*ir*nr),tr.addScaledVector(ar[5],2*.429043*nr*sr),tr.addScaledVector(ar[6],.743125*sr*sr-.247708),tr.addScaledVector(ar[7],2*.429043*ir*sr),tr.addScaledVector(ar[8],.429043*(ir*ir-nr*nr)),tr}add(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].add(er.coefficients[tr]);return this}addScaledSH(er,tr){for(let ir=0;ir<9;ir++)this.coefficients[ir].addScaledVector(er.coefficients[ir],tr);return this}scale(er){for(let tr=0;tr<9;tr++)this.coefficients[tr].multiplyScalar(er);return this}lerp(er,tr){for(let ir=0;ir<9;ir++)this.coefficients[ir].lerp(er.coefficients[ir],tr);return this}equals(er){for(let tr=0;tr<9;tr++)if(!this.coefficients[tr].equals(er.coefficients[tr]))return!1;return!0}copy(er){return this.set(er.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(er,tr=0){const ir=this.coefficients;for(let nr=0;nr<9;nr++)ir[nr].fromArray(er,tr+nr*3);return this}toArray(er=[],tr=0){const ir=this.coefficients;for(let nr=0;nr<9;nr++)ir[nr].toArray(er,tr+nr*3);return er}static getBasisAt(er,tr){const ir=er.x,nr=er.y,sr=er.z;tr[0]=.282095,tr[1]=.488603*nr,tr[2]=.488603*sr,tr[3]=.488603*ir,tr[4]=1.092548*ir*nr,tr[5]=1.092548*nr*sr,tr[6]=.315392*(3*sr*sr-1),tr[7]=1.092548*ir*sr,tr[8]=.546274*(ir*ir-nr*nr)}}class LightProbe extends Light{constructor(er=new SphericalHarmonics3,tr=1){super(void 0,tr),this.isLightProbe=!0,this.sh=er}copy(er){return super.copy(er),this.sh.copy(er.sh),this}fromJSON(er){return this.intensity=er.intensity,this.sh.fromArray(er.sh),this}toJSON(er){const tr=super.toJSON(er);return tr.object.sh=this.sh.toArray(),tr}}class MaterialLoader extends Loader{constructor(er){super(er),this.textures={}}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=this.textures;function ir(sr){return tr[sr]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",sr),tr[sr]}const nr=this.createMaterialFromType(er.type);if(er.uuid!==void 0&&(nr.uuid=er.uuid),er.name!==void 0&&(nr.name=er.name),er.color!==void 0&&nr.color!==void 0&&nr.color.setHex(er.color),er.roughness!==void 0&&(nr.roughness=er.roughness),er.metalness!==void 0&&(nr.metalness=er.metalness),er.sheen!==void 0&&(nr.sheen=er.sheen),er.sheenColor!==void 0&&(nr.sheenColor=new Color().setHex(er.sheenColor)),er.sheenRoughness!==void 0&&(nr.sheenRoughness=er.sheenRoughness),er.emissive!==void 0&&nr.emissive!==void 0&&nr.emissive.setHex(er.emissive),er.specular!==void 0&&nr.specular!==void 0&&nr.specular.setHex(er.specular),er.specularIntensity!==void 0&&(nr.specularIntensity=er.specularIntensity),er.specularColor!==void 0&&nr.specularColor!==void 0&&nr.specularColor.setHex(er.specularColor),er.shininess!==void 0&&(nr.shininess=er.shininess),er.clearcoat!==void 0&&(nr.clearcoat=er.clearcoat),er.clearcoatRoughness!==void 0&&(nr.clearcoatRoughness=er.clearcoatRoughness),er.dispersion!==void 0&&(nr.dispersion=er.dispersion),er.iridescence!==void 0&&(nr.iridescence=er.iridescence),er.iridescenceIOR!==void 0&&(nr.iridescenceIOR=er.iridescenceIOR),er.iridescenceThicknessRange!==void 0&&(nr.iridescenceThicknessRange=er.iridescenceThicknessRange),er.transmission!==void 0&&(nr.transmission=er.transmission),er.thickness!==void 0&&(nr.thickness=er.thickness),er.attenuationDistance!==void 0&&(nr.attenuationDistance=er.attenuationDistance),er.attenuationColor!==void 0&&nr.attenuationColor!==void 0&&nr.attenuationColor.setHex(er.attenuationColor),er.anisotropy!==void 0&&(nr.anisotropy=er.anisotropy),er.anisotropyRotation!==void 0&&(nr.anisotropyRotation=er.anisotropyRotation),er.fog!==void 0&&(nr.fog=er.fog),er.flatShading!==void 0&&(nr.flatShading=er.flatShading),er.blending!==void 0&&(nr.blending=er.blending),er.combine!==void 0&&(nr.combine=er.combine),er.side!==void 0&&(nr.side=er.side),er.shadowSide!==void 0&&(nr.shadowSide=er.shadowSide),er.opacity!==void 0&&(nr.opacity=er.opacity),er.transparent!==void 0&&(nr.transparent=er.transparent),er.alphaTest!==void 0&&(nr.alphaTest=er.alphaTest),er.alphaHash!==void 0&&(nr.alphaHash=er.alphaHash),er.depthFunc!==void 0&&(nr.depthFunc=er.depthFunc),er.depthTest!==void 0&&(nr.depthTest=er.depthTest),er.depthWrite!==void 0&&(nr.depthWrite=er.depthWrite),er.colorWrite!==void 0&&(nr.colorWrite=er.colorWrite),er.blendSrc!==void 0&&(nr.blendSrc=er.blendSrc),er.blendDst!==void 0&&(nr.blendDst=er.blendDst),er.blendEquation!==void 0&&(nr.blendEquation=er.blendEquation),er.blendSrcAlpha!==void 0&&(nr.blendSrcAlpha=er.blendSrcAlpha),er.blendDstAlpha!==void 0&&(nr.blendDstAlpha=er.blendDstAlpha),er.blendEquationAlpha!==void 0&&(nr.blendEquationAlpha=er.blendEquationAlpha),er.blendColor!==void 0&&nr.blendColor!==void 0&&nr.blendColor.setHex(er.blendColor),er.blendAlpha!==void 0&&(nr.blendAlpha=er.blendAlpha),er.stencilWriteMask!==void 0&&(nr.stencilWriteMask=er.stencilWriteMask),er.stencilFunc!==void 0&&(nr.stencilFunc=er.stencilFunc),er.stencilRef!==void 0&&(nr.stencilRef=er.stencilRef),er.stencilFuncMask!==void 0&&(nr.stencilFuncMask=er.stencilFuncMask),er.stencilFail!==void 0&&(nr.stencilFail=er.stencilFail),er.stencilZFail!==void 0&&(nr.stencilZFail=er.stencilZFail),er.stencilZPass!==void 0&&(nr.stencilZPass=er.stencilZPass),er.stencilWrite!==void 0&&(nr.stencilWrite=er.stencilWrite),er.wireframe!==void 0&&(nr.wireframe=er.wireframe),er.wireframeLinewidth!==void 0&&(nr.wireframeLinewidth=er.wireframeLinewidth),er.wireframeLinecap!==void 0&&(nr.wireframeLinecap=er.wireframeLinecap),er.wireframeLinejoin!==void 0&&(nr.wireframeLinejoin=er.wireframeLinejoin),er.rotation!==void 0&&(nr.rotation=er.rotation),er.linewidth!==void 0&&(nr.linewidth=er.linewidth),er.dashSize!==void 0&&(nr.dashSize=er.dashSize),er.gapSize!==void 0&&(nr.gapSize=er.gapSize),er.scale!==void 0&&(nr.scale=er.scale),er.polygonOffset!==void 0&&(nr.polygonOffset=er.polygonOffset),er.polygonOffsetFactor!==void 0&&(nr.polygonOffsetFactor=er.polygonOffsetFactor),er.polygonOffsetUnits!==void 0&&(nr.polygonOffsetUnits=er.polygonOffsetUnits),er.dithering!==void 0&&(nr.dithering=er.dithering),er.alphaToCoverage!==void 0&&(nr.alphaToCoverage=er.alphaToCoverage),er.premultipliedAlpha!==void 0&&(nr.premultipliedAlpha=er.premultipliedAlpha),er.forceSinglePass!==void 0&&(nr.forceSinglePass=er.forceSinglePass),er.visible!==void 0&&(nr.visible=er.visible),er.toneMapped!==void 0&&(nr.toneMapped=er.toneMapped),er.userData!==void 0&&(nr.userData=er.userData),er.vertexColors!==void 0&&(typeof er.vertexColors=="number"?nr.vertexColors=er.vertexColors>0:nr.vertexColors=er.vertexColors),er.uniforms!==void 0)for(const sr in er.uniforms){const ar=er.uniforms[sr];switch(nr.uniforms[sr]={},ar.type){case"t":nr.uniforms[sr].value=ir(ar.value);break;case"c":nr.uniforms[sr].value=new Color().setHex(ar.value);break;case"v2":nr.uniforms[sr].value=new Vector2().fromArray(ar.value);break;case"v3":nr.uniforms[sr].value=new Vector3$1().fromArray(ar.value);break;case"v4":nr.uniforms[sr].value=new Vector4().fromArray(ar.value);break;case"m3":nr.uniforms[sr].value=new Matrix3().fromArray(ar.value);break;case"m4":nr.uniforms[sr].value=new Matrix4().fromArray(ar.value);break;default:nr.uniforms[sr].value=ar.value}}if(er.defines!==void 0&&(nr.defines=er.defines),er.vertexShader!==void 0&&(nr.vertexShader=er.vertexShader),er.fragmentShader!==void 0&&(nr.fragmentShader=er.fragmentShader),er.glslVersion!==void 0&&(nr.glslVersion=er.glslVersion),er.extensions!==void 0)for(const sr in er.extensions)nr.extensions[sr]=er.extensions[sr];if(er.lights!==void 0&&(nr.lights=er.lights),er.clipping!==void 0&&(nr.clipping=er.clipping),er.size!==void 0&&(nr.size=er.size),er.sizeAttenuation!==void 0&&(nr.sizeAttenuation=er.sizeAttenuation),er.map!==void 0&&(nr.map=ir(er.map)),er.matcap!==void 0&&(nr.matcap=ir(er.matcap)),er.alphaMap!==void 0&&(nr.alphaMap=ir(er.alphaMap)),er.bumpMap!==void 0&&(nr.bumpMap=ir(er.bumpMap)),er.bumpScale!==void 0&&(nr.bumpScale=er.bumpScale),er.normalMap!==void 0&&(nr.normalMap=ir(er.normalMap)),er.normalMapType!==void 0&&(nr.normalMapType=er.normalMapType),er.normalScale!==void 0){let sr=er.normalScale;Array.isArray(sr)===!1&&(sr=[sr,sr]),nr.normalScale=new Vector2().fromArray(sr)}return er.displacementMap!==void 0&&(nr.displacementMap=ir(er.displacementMap)),er.displacementScale!==void 0&&(nr.displacementScale=er.displacementScale),er.displacementBias!==void 0&&(nr.displacementBias=er.displacementBias),er.roughnessMap!==void 0&&(nr.roughnessMap=ir(er.roughnessMap)),er.metalnessMap!==void 0&&(nr.metalnessMap=ir(er.metalnessMap)),er.emissiveMap!==void 0&&(nr.emissiveMap=ir(er.emissiveMap)),er.emissiveIntensity!==void 0&&(nr.emissiveIntensity=er.emissiveIntensity),er.specularMap!==void 0&&(nr.specularMap=ir(er.specularMap)),er.specularIntensityMap!==void 0&&(nr.specularIntensityMap=ir(er.specularIntensityMap)),er.specularColorMap!==void 0&&(nr.specularColorMap=ir(er.specularColorMap)),er.envMap!==void 0&&(nr.envMap=ir(er.envMap)),er.envMapRotation!==void 0&&nr.envMapRotation.fromArray(er.envMapRotation),er.envMapIntensity!==void 0&&(nr.envMapIntensity=er.envMapIntensity),er.reflectivity!==void 0&&(nr.reflectivity=er.reflectivity),er.refractionRatio!==void 0&&(nr.refractionRatio=er.refractionRatio),er.lightMap!==void 0&&(nr.lightMap=ir(er.lightMap)),er.lightMapIntensity!==void 0&&(nr.lightMapIntensity=er.lightMapIntensity),er.aoMap!==void 0&&(nr.aoMap=ir(er.aoMap)),er.aoMapIntensity!==void 0&&(nr.aoMapIntensity=er.aoMapIntensity),er.gradientMap!==void 0&&(nr.gradientMap=ir(er.gradientMap)),er.clearcoatMap!==void 0&&(nr.clearcoatMap=ir(er.clearcoatMap)),er.clearcoatRoughnessMap!==void 0&&(nr.clearcoatRoughnessMap=ir(er.clearcoatRoughnessMap)),er.clearcoatNormalMap!==void 0&&(nr.clearcoatNormalMap=ir(er.clearcoatNormalMap)),er.clearcoatNormalScale!==void 0&&(nr.clearcoatNormalScale=new Vector2().fromArray(er.clearcoatNormalScale)),er.iridescenceMap!==void 0&&(nr.iridescenceMap=ir(er.iridescenceMap)),er.iridescenceThicknessMap!==void 0&&(nr.iridescenceThicknessMap=ir(er.iridescenceThicknessMap)),er.transmissionMap!==void 0&&(nr.transmissionMap=ir(er.transmissionMap)),er.thicknessMap!==void 0&&(nr.thicknessMap=ir(er.thicknessMap)),er.anisotropyMap!==void 0&&(nr.anisotropyMap=ir(er.anisotropyMap)),er.sheenColorMap!==void 0&&(nr.sheenColorMap=ir(er.sheenColorMap)),er.sheenRoughnessMap!==void 0&&(nr.sheenRoughnessMap=ir(er.sheenRoughnessMap)),nr}setTextures(er){return this.textures=er,this}createMaterialFromType(er){return MaterialLoader.createMaterialFromType(er)}static createMaterialFromType(er){const tr={ShadowMaterial,SpriteMaterial,RawShaderMaterial,ShaderMaterial,PointsMaterial,MeshPhysicalMaterial,MeshStandardMaterial,MeshPhongMaterial,MeshToonMaterial,MeshNormalMaterial,MeshLambertMaterial,MeshDepthMaterial,MeshDistanceMaterial,MeshBasicMaterial,MeshMatcapMaterial,LineDashedMaterial,LineBasicMaterial,Material};return new tr[er]}}class LoaderUtils{static decodeText(er){if(console.warn("THREE.LoaderUtils: decodeText() has been deprecated with r165 and will be removed with r175. Use TextDecoder instead."),typeof TextDecoder<"u")return new TextDecoder().decode(er);let tr="";for(let ir=0,nr=er.length;ir<nr;ir++)tr+=String.fromCharCode(er[ir]);try{return decodeURIComponent(escape(tr))}catch{return tr}}static extractUrlBase(er){const tr=er.lastIndexOf("/");return tr===-1?"./":er.slice(0,tr+1)}static resolveURL(er,tr){return typeof er!="string"||er===""?"":(/^https?:\/\//i.test(tr)&&/^\//.test(er)&&(tr=tr.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(er)||/^data:.*,.*$/i.test(er)||/^blob:.*$/i.test(er)?er:tr+er)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(er){return super.copy(er),this.instanceCount=er.instanceCount,this}toJSON(){const er=super.toJSON();return er.instanceCount=this.instanceCount,er.isInstancedBufferGeometry=!0,er}}class BufferGeometryLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(JSON.parse(or)))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr={},ir={};function nr(pr,gr){if(tr[gr]!==void 0)return tr[gr];const mr=pr.interleavedBuffers[gr],fr=sr(pr,mr.buffer),_r=getTypedArray(mr.type,fr),Ar=new InterleavedBuffer(_r,mr.stride);return Ar.uuid=mr.uuid,tr[gr]=Ar,Ar}function sr(pr,gr){if(ir[gr]!==void 0)return ir[gr];const mr=pr.arrayBuffers[gr],fr=new Uint32Array(mr).buffer;return ir[gr]=fr,fr}const ar=er.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,or=er.data.index;if(or!==void 0){const pr=getTypedArray(or.type,or.array);ar.setIndex(new BufferAttribute(pr,1))}const lr=er.data.attributes;for(const pr in lr){const gr=lr[pr];let vr;if(gr.isInterleavedBufferAttribute){const mr=nr(er.data,gr.data);vr=new InterleavedBufferAttribute(mr,gr.itemSize,gr.offset,gr.normalized)}else{const mr=getTypedArray(gr.type,gr.array),fr=gr.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute;vr=new fr(mr,gr.itemSize,gr.normalized)}gr.name!==void 0&&(vr.name=gr.name),gr.usage!==void 0&&vr.setUsage(gr.usage),ar.setAttribute(pr,vr)}const cr=er.data.morphAttributes;if(cr)for(const pr in cr){const gr=cr[pr],vr=[];for(let mr=0,fr=gr.length;mr<fr;mr++){const _r=gr[mr];let Ar;if(_r.isInterleavedBufferAttribute){const yr=nr(er.data,_r.data);Ar=new InterleavedBufferAttribute(yr,_r.itemSize,_r.offset,_r.normalized)}else{const yr=getTypedArray(_r.type,_r.array);Ar=new BufferAttribute(yr,_r.itemSize,_r.normalized)}_r.name!==void 0&&(Ar.name=_r.name),vr.push(Ar)}ar.morphAttributes[pr]=vr}er.data.morphTargetsRelative&&(ar.morphTargetsRelative=!0);const dr=er.data.groups||er.data.drawcalls||er.data.offsets;if(dr!==void 0)for(let pr=0,gr=dr.length;pr!==gr;++pr){const vr=dr[pr];ar.addGroup(vr.start,vr.count,vr.materialIndex)}const hr=er.data.boundingSphere;if(hr!==void 0){const pr=new Vector3$1;hr.center!==void 0&&pr.fromArray(hr.center),ar.boundingSphere=new Sphere(pr,hr.radius)}return er.name&&(ar.name=er.name),er.userData&&(ar.userData=er.userData),ar}}class ObjectLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path;this.resourcePath=this.resourcePath||ar;const or=new FileLoader(this.manager);or.setPath(this.path),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){let cr=null;try{cr=JSON.parse(lr)}catch(dr){nr!==void 0&&nr(dr),console.error("THREE:ObjectLoader: Can't parse "+er+".",dr.message);return}const ur=cr.metadata;if(ur===void 0||ur.type===void 0||ur.type.toLowerCase()==="geometry"){nr!==void 0&&nr(new Error("THREE.ObjectLoader: Can't load "+er)),console.error("THREE.ObjectLoader: Can't load "+er);return}sr.parse(cr,tr)},ir,nr)}async loadAsync(er,tr){const ir=this,nr=this.path===""?LoaderUtils.extractUrlBase(er):this.path;this.resourcePath=this.resourcePath||nr;const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials);const ar=await sr.loadAsync(er,tr),or=JSON.parse(ar),lr=or.metadata;if(lr===void 0||lr.type===void 0||lr.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+er);return await ir.parseAsync(or)}parse(er,tr){const ir=this.parseAnimations(er.animations),nr=this.parseShapes(er.shapes),sr=this.parseGeometries(er.geometries,nr),ar=this.parseImages(er.images,function(){tr!==void 0&&tr(cr)}),or=this.parseTextures(er.textures,ar),lr=this.parseMaterials(er.materials,or),cr=this.parseObject(er.object,sr,lr,or,ir),ur=this.parseSkeletons(er.skeletons,cr);if(this.bindSkeletons(cr,ur),this.bindLightTargets(cr),tr!==void 0){let dr=!1;for(const hr in ar)if(ar[hr].data instanceof HTMLImageElement){dr=!0;break}dr===!1&&tr(cr)}return cr}async parseAsync(er){const tr=this.parseAnimations(er.animations),ir=this.parseShapes(er.shapes),nr=this.parseGeometries(er.geometries,ir),sr=await this.parseImagesAsync(er.images),ar=this.parseTextures(er.textures,sr),or=this.parseMaterials(er.materials,ar),lr=this.parseObject(er.object,nr,or,ar,tr),cr=this.parseSkeletons(er.skeletons,lr);return this.bindSkeletons(lr,cr),this.bindLightTargets(lr),lr}parseShapes(er){const tr={};if(er!==void 0)for(let ir=0,nr=er.length;ir<nr;ir++){const sr=new Shape$1().fromJSON(er[ir]);tr[sr.uuid]=sr}return tr}parseSkeletons(er,tr){const ir={},nr={};if(tr.traverse(function(sr){sr.isBone&&(nr[sr.uuid]=sr)}),er!==void 0)for(let sr=0,ar=er.length;sr<ar;sr++){const or=new Skeleton().fromJSON(er[sr],nr);ir[or.uuid]=or}return ir}parseGeometries(er,tr){const ir={};if(er!==void 0){const nr=new BufferGeometryLoader;for(let sr=0,ar=er.length;sr<ar;sr++){let or;const lr=er[sr];switch(lr.type){case"BufferGeometry":case"InstancedBufferGeometry":or=nr.parse(lr);break;default:lr.type in Geometries?or=Geometries[lr.type].fromJSON(lr,tr):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${lr.type}"`)}or.uuid=lr.uuid,lr.name!==void 0&&(or.name=lr.name),lr.userData!==void 0&&(or.userData=lr.userData),ir[lr.uuid]=or}}return ir}parseMaterials(er,tr){const ir={},nr={};if(er!==void 0){const sr=new MaterialLoader;sr.setTextures(tr);for(let ar=0,or=er.length;ar<or;ar++){const lr=er[ar];ir[lr.uuid]===void 0&&(ir[lr.uuid]=sr.parse(lr)),nr[lr.uuid]=ir[lr.uuid]}}return nr}parseAnimations(er){const tr={};if(er!==void 0)for(let ir=0;ir<er.length;ir++){const nr=er[ir],sr=AnimationClip.parse(nr);tr[sr.uuid]=sr}return tr}parseImages(er,tr){const ir=this,nr={};let sr;function ar(lr){return ir.manager.itemStart(lr),sr.load(lr,function(){ir.manager.itemEnd(lr)},void 0,function(){ir.manager.itemError(lr),ir.manager.itemEnd(lr)})}function or(lr){if(typeof lr=="string"){const cr=lr,ur=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(cr)?cr:ir.resourcePath+cr;return ar(ur)}else return lr.data?{data:getTypedArray(lr.type,lr.data),width:lr.width,height:lr.height}:null}if(er!==void 0&&er.length>0){const lr=new LoadingManager(tr);sr=new ImageLoader(lr),sr.setCrossOrigin(this.crossOrigin);for(let cr=0,ur=er.length;cr<ur;cr++){const dr=er[cr],hr=dr.url;if(Array.isArray(hr)){const pr=[];for(let gr=0,vr=hr.length;gr<vr;gr++){const mr=hr[gr],fr=or(mr);fr!==null&&(fr instanceof HTMLImageElement?pr.push(fr):pr.push(new DataTexture(fr.data,fr.width,fr.height)))}nr[dr.uuid]=new Source(pr)}else{const pr=or(dr.url);nr[dr.uuid]=new Source(pr)}}}return nr}async parseImagesAsync(er){const tr=this,ir={};let nr;async function sr(ar){if(typeof ar=="string"){const or=ar,lr=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(or)?or:tr.resourcePath+or;return await nr.loadAsync(lr)}else return ar.data?{data:getTypedArray(ar.type,ar.data),width:ar.width,height:ar.height}:null}if(er!==void 0&&er.length>0){nr=new ImageLoader(this.manager),nr.setCrossOrigin(this.crossOrigin);for(let ar=0,or=er.length;ar<or;ar++){const lr=er[ar],cr=lr.url;if(Array.isArray(cr)){const ur=[];for(let dr=0,hr=cr.length;dr<hr;dr++){const pr=cr[dr],gr=await sr(pr);gr!==null&&(gr instanceof HTMLImageElement?ur.push(gr):ur.push(new DataTexture(gr.data,gr.width,gr.height)))}ir[lr.uuid]=new Source(ur)}else{const ur=await sr(lr.url);ir[lr.uuid]=new Source(ur)}}}return ir}parseTextures(er,tr){function ir(sr,ar){return typeof sr=="number"?sr:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",sr),ar[sr])}const nr={};if(er!==void 0)for(let sr=0,ar=er.length;sr<ar;sr++){const or=er[sr];or.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',or.uuid),tr[or.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",or.image);const lr=tr[or.image],cr=lr.data;let ur;Array.isArray(cr)?(ur=new CubeTexture,cr.length===6&&(ur.needsUpdate=!0)):(cr&&cr.data?ur=new DataTexture:ur=new Texture,cr&&(ur.needsUpdate=!0)),ur.source=lr,ur.uuid=or.uuid,or.name!==void 0&&(ur.name=or.name),or.mapping!==void 0&&(ur.mapping=ir(or.mapping,TEXTURE_MAPPING)),or.channel!==void 0&&(ur.channel=or.channel),or.offset!==void 0&&ur.offset.fromArray(or.offset),or.repeat!==void 0&&ur.repeat.fromArray(or.repeat),or.center!==void 0&&ur.center.fromArray(or.center),or.rotation!==void 0&&(ur.rotation=or.rotation),or.wrap!==void 0&&(ur.wrapS=ir(or.wrap[0],TEXTURE_WRAPPING),ur.wrapT=ir(or.wrap[1],TEXTURE_WRAPPING)),or.format!==void 0&&(ur.format=or.format),or.internalFormat!==void 0&&(ur.internalFormat=or.internalFormat),or.type!==void 0&&(ur.type=or.type),or.colorSpace!==void 0&&(ur.colorSpace=or.colorSpace),or.minFilter!==void 0&&(ur.minFilter=ir(or.minFilter,TEXTURE_FILTER)),or.magFilter!==void 0&&(ur.magFilter=ir(or.magFilter,TEXTURE_FILTER)),or.anisotropy!==void 0&&(ur.anisotropy=or.anisotropy),or.flipY!==void 0&&(ur.flipY=or.flipY),or.generateMipmaps!==void 0&&(ur.generateMipmaps=or.generateMipmaps),or.premultiplyAlpha!==void 0&&(ur.premultiplyAlpha=or.premultiplyAlpha),or.unpackAlignment!==void 0&&(ur.unpackAlignment=or.unpackAlignment),or.compareFunction!==void 0&&(ur.compareFunction=or.compareFunction),or.userData!==void 0&&(ur.userData=or.userData),nr[or.uuid]=ur}return nr}parseObject(er,tr,ir,nr,sr){let ar;function or(hr){return tr[hr]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",hr),tr[hr]}function lr(hr){if(hr!==void 0){if(Array.isArray(hr)){const pr=[];for(let gr=0,vr=hr.length;gr<vr;gr++){const mr=hr[gr];ir[mr]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",mr),pr.push(ir[mr])}return pr}return ir[hr]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",hr),ir[hr]}}function cr(hr){return nr[hr]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",hr),nr[hr]}let ur,dr;switch(er.type){case"Scene":ar=new Scene,er.background!==void 0&&(Number.isInteger(er.background)?ar.background=new Color(er.background):ar.background=cr(er.background)),er.environment!==void 0&&(ar.environment=cr(er.environment)),er.fog!==void 0&&(er.fog.type==="Fog"?ar.fog=new Fog(er.fog.color,er.fog.near,er.fog.far):er.fog.type==="FogExp2"&&(ar.fog=new FogExp2(er.fog.color,er.fog.density)),er.fog.name!==""&&(ar.fog.name=er.fog.name)),er.backgroundBlurriness!==void 0&&(ar.backgroundBlurriness=er.backgroundBlurriness),er.backgroundIntensity!==void 0&&(ar.backgroundIntensity=er.backgroundIntensity),er.backgroundRotation!==void 0&&ar.backgroundRotation.fromArray(er.backgroundRotation),er.environmentIntensity!==void 0&&(ar.environmentIntensity=er.environmentIntensity),er.environmentRotation!==void 0&&ar.environmentRotation.fromArray(er.environmentRotation);break;case"PerspectiveCamera":ar=new PerspectiveCamera(er.fov,er.aspect,er.near,er.far),er.focus!==void 0&&(ar.focus=er.focus),er.zoom!==void 0&&(ar.zoom=er.zoom),er.filmGauge!==void 0&&(ar.filmGauge=er.filmGauge),er.filmOffset!==void 0&&(ar.filmOffset=er.filmOffset),er.view!==void 0&&(ar.view=Object.assign({},er.view));break;case"OrthographicCamera":ar=new OrthographicCamera(er.left,er.right,er.top,er.bottom,er.near,er.far),er.zoom!==void 0&&(ar.zoom=er.zoom),er.view!==void 0&&(ar.view=Object.assign({},er.view));break;case"AmbientLight":ar=new AmbientLight(er.color,er.intensity);break;case"DirectionalLight":ar=new DirectionalLight(er.color,er.intensity),ar.target=er.target||"";break;case"PointLight":ar=new PointLight(er.color,er.intensity,er.distance,er.decay);break;case"RectAreaLight":ar=new RectAreaLight(er.color,er.intensity,er.width,er.height);break;case"SpotLight":ar=new SpotLight(er.color,er.intensity,er.distance,er.angle,er.penumbra,er.decay),ar.target=er.target||"";break;case"HemisphereLight":ar=new HemisphereLight(er.color,er.groundColor,er.intensity);break;case"LightProbe":ar=new LightProbe().fromJSON(er);break;case"SkinnedMesh":ur=or(er.geometry),dr=lr(er.material),ar=new SkinnedMesh(ur,dr),er.bindMode!==void 0&&(ar.bindMode=er.bindMode),er.bindMatrix!==void 0&&ar.bindMatrix.fromArray(er.bindMatrix),er.skeleton!==void 0&&(ar.skeleton=er.skeleton);break;case"Mesh":ur=or(er.geometry),dr=lr(er.material),ar=new Mesh(ur,dr);break;case"InstancedMesh":ur=or(er.geometry),dr=lr(er.material);const hr=er.count,pr=er.instanceMatrix,gr=er.instanceColor;ar=new InstancedMesh(ur,dr,hr),ar.instanceMatrix=new InstancedBufferAttribute(new Float32Array(pr.array),16),gr!==void 0&&(ar.instanceColor=new InstancedBufferAttribute(new Float32Array(gr.array),gr.itemSize));break;case"BatchedMesh":ur=or(er.geometry),dr=lr(er.material),ar=new BatchedMesh(er.maxInstanceCount,er.maxVertexCount,er.maxIndexCount,dr),ar.geometry=ur,ar.perObjectFrustumCulled=er.perObjectFrustumCulled,ar.sortObjects=er.sortObjects,ar._drawRanges=er.drawRanges,ar._reservedRanges=er.reservedRanges,ar._visibility=er.visibility,ar._active=er.active,ar._bounds=er.bounds.map(vr=>{const mr=new Box3;mr.min.fromArray(vr.boxMin),mr.max.fromArray(vr.boxMax);const fr=new Sphere;return fr.radius=vr.sphereRadius,fr.center.fromArray(vr.sphereCenter),{boxInitialized:vr.boxInitialized,box:mr,sphereInitialized:vr.sphereInitialized,sphere:fr}}),ar._maxInstanceCount=er.maxInstanceCount,ar._maxVertexCount=er.maxVertexCount,ar._maxIndexCount=er.maxIndexCount,ar._geometryInitialized=er.geometryInitialized,ar._geometryCount=er.geometryCount,ar._matricesTexture=cr(er.matricesTexture.uuid),er.colorsTexture!==void 0&&(ar._colorsTexture=cr(er.colorsTexture.uuid));break;case"LOD":ar=new LOD;break;case"Line":ar=new Line(or(er.geometry),lr(er.material));break;case"LineLoop":ar=new LineLoop(or(er.geometry),lr(er.material));break;case"LineSegments":ar=new LineSegments(or(er.geometry),lr(er.material));break;case"PointCloud":case"Points":ar=new Points(or(er.geometry),lr(er.material));break;case"Sprite":ar=new Sprite(lr(er.material));break;case"Group":ar=new Group;break;case"Bone":ar=new Bone;break;default:ar=new Object3D}if(ar.uuid=er.uuid,er.name!==void 0&&(ar.name=er.name),er.matrix!==void 0?(ar.matrix.fromArray(er.matrix),er.matrixAutoUpdate!==void 0&&(ar.matrixAutoUpdate=er.matrixAutoUpdate),ar.matrixAutoUpdate&&ar.matrix.decompose(ar.position,ar.quaternion,ar.scale)):(er.position!==void 0&&ar.position.fromArray(er.position),er.rotation!==void 0&&ar.rotation.fromArray(er.rotation),er.quaternion!==void 0&&ar.quaternion.fromArray(er.quaternion),er.scale!==void 0&&ar.scale.fromArray(er.scale)),er.up!==void 0&&ar.up.fromArray(er.up),er.castShadow!==void 0&&(ar.castShadow=er.castShadow),er.receiveShadow!==void 0&&(ar.receiveShadow=er.receiveShadow),er.shadow&&(er.shadow.intensity!==void 0&&(ar.shadow.intensity=er.shadow.intensity),er.shadow.bias!==void 0&&(ar.shadow.bias=er.shadow.bias),er.shadow.normalBias!==void 0&&(ar.shadow.normalBias=er.shadow.normalBias),er.shadow.radius!==void 0&&(ar.shadow.radius=er.shadow.radius),er.shadow.mapSize!==void 0&&ar.shadow.mapSize.fromArray(er.shadow.mapSize),er.shadow.camera!==void 0&&(ar.shadow.camera=this.parseObject(er.shadow.camera))),er.visible!==void 0&&(ar.visible=er.visible),er.frustumCulled!==void 0&&(ar.frustumCulled=er.frustumCulled),er.renderOrder!==void 0&&(ar.renderOrder=er.renderOrder),er.userData!==void 0&&(ar.userData=er.userData),er.layers!==void 0&&(ar.layers.mask=er.layers),er.children!==void 0){const hr=er.children;for(let pr=0;pr<hr.length;pr++)ar.add(this.parseObject(hr[pr],tr,ir,nr,sr))}if(er.animations!==void 0){const hr=er.animations;for(let pr=0;pr<hr.length;pr++){const gr=hr[pr];ar.animations.push(sr[gr])}}if(er.type==="LOD"){er.autoUpdate!==void 0&&(ar.autoUpdate=er.autoUpdate);const hr=er.levels;for(let pr=0;pr<hr.length;pr++){const gr=hr[pr],vr=ar.getObjectByProperty("uuid",gr.object);vr!==void 0&&ar.addLevel(vr,gr.distance,gr.hysteresis)}}return ar}bindSkeletons(er,tr){Object.keys(tr).length!==0&&er.traverse(function(ir){if(ir.isSkinnedMesh===!0&&ir.skeleton!==void 0){const nr=tr[ir.skeleton];nr===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",ir.skeleton):ir.bind(nr,ir.bindMatrix)}})}bindLightTargets(er){er.traverse(function(tr){if(tr.isDirectionalLight||tr.isSpotLight){const ir=tr.target,nr=er.getObjectByProperty("uuid",ir);nr!==void 0?tr.target=nr:tr.target=new Object3D}})}}const TEXTURE_MAPPING={UVMapping,CubeReflectionMapping,CubeRefractionMapping,EquirectangularReflectionMapping,EquirectangularRefractionMapping,CubeUVReflectionMapping},TEXTURE_WRAPPING={RepeatWrapping,ClampToEdgeWrapping,MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter,NearestMipmapNearestFilter,NearestMipmapLinearFilter,LinearFilter,LinearMipmapNearestFilter,LinearMipmapLinearFilter};class ImageBitmapLoader extends Loader{constructor(er){super(er),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(er){return this.options=er,this}load(er,tr,ir,nr){er===void 0&&(er=""),this.path!==void 0&&(er=this.path+er),er=this.manager.resolveURL(er);const sr=this,ar=Cache.get(er);if(ar!==void 0){if(sr.manager.itemStart(er),ar.then){ar.then(cr=>{tr&&tr(cr),sr.manager.itemEnd(er)}).catch(cr=>{nr&&nr(cr)});return}return setTimeout(function(){tr&&tr(ar),sr.manager.itemEnd(er)},0),ar}const or={};or.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",or.headers=this.requestHeader;const lr=fetch(er,or).then(function(cr){return cr.blob()}).then(function(cr){return createImageBitmap(cr,Object.assign(sr.options,{colorSpaceConversion:"none"}))}).then(function(cr){return Cache.add(er,cr),tr&&tr(cr),sr.manager.itemEnd(er),cr}).catch(function(cr){nr&&nr(cr),Cache.remove(er),sr.manager.itemError(er),sr.manager.itemEnd(er)});Cache.add(er,lr),sr.manager.itemStart(er)}}let _context;class AudioContext{static getContext(){return _context===void 0&&(_context=new(window.AudioContext||window.webkitAudioContext)),_context}static setContext(er){_context=er}}class AudioLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setResponseType("arraybuffer"),ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(lr){try{const cr=lr.slice(0);AudioContext.getContext().decodeAudioData(cr,function(dr){tr(dr)}).catch(or)}catch(cr){or(cr)}},ir,nr);function or(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}}}const _eyeRight=new Matrix4,_eyeLeft=new Matrix4,_projectionMatrix=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(er){const tr=this._cache;if(tr.focus!==er.focus||tr.fov!==er.fov||tr.aspect!==er.aspect*this.aspect||tr.near!==er.near||tr.far!==er.far||tr.zoom!==er.zoom||tr.eyeSep!==this.eyeSep){tr.focus=er.focus,tr.fov=er.fov,tr.aspect=er.aspect*this.aspect,tr.near=er.near,tr.far=er.far,tr.zoom=er.zoom,tr.eyeSep=this.eyeSep,_projectionMatrix.copy(er.projectionMatrix);const nr=tr.eyeSep/2,sr=nr*tr.near/tr.focus,ar=tr.near*Math.tan(DEG2RAD*tr.fov*.5)/tr.zoom;let or,lr;_eyeLeft.elements[12]=-nr,_eyeRight.elements[12]=nr,or=-ar*tr.aspect+sr,lr=ar*tr.aspect+sr,_projectionMatrix.elements[0]=2*tr.near/(lr-or),_projectionMatrix.elements[8]=(lr+or)/(lr-or),this.cameraL.projectionMatrix.copy(_projectionMatrix),or=-ar*tr.aspect-sr,lr=ar*tr.aspect-sr,_projectionMatrix.elements[0]=2*tr.near/(lr-or),_projectionMatrix.elements[8]=(lr+or)/(lr-or),this.cameraR.projectionMatrix.copy(_projectionMatrix)}this.cameraL.matrixWorld.copy(er.matrixWorld).multiply(_eyeLeft),this.cameraR.matrixWorld.copy(er.matrixWorld).multiply(_eyeRight)}}class Clock{constructor(er=!0){this.autoStart=er,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=now$1(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let er=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const tr=now$1();er=(tr-this.oldTime)/1e3,this.oldTime=tr,this.elapsedTime+=er}return er}}function now$1(){return performance.now()}const _position$1$1=new Vector3$1,_quaternion$1$1=new Quaternion$1,_scale$1$1=new Vector3$1,_orientation$1=new Vector3$1;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=AudioContext.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(er){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=er,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(er){return this.gain.gain.setTargetAtTime(er,this.context.currentTime,.01),this}updateMatrixWorld(er){super.updateMatrixWorld(er);const tr=this.context.listener,ir=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(_position$1$1,_quaternion$1$1,_scale$1$1),_orientation$1.set(0,0,-1).applyQuaternion(_quaternion$1$1),tr.positionX){const nr=this.context.currentTime+this.timeDelta;tr.positionX.linearRampToValueAtTime(_position$1$1.x,nr),tr.positionY.linearRampToValueAtTime(_position$1$1.y,nr),tr.positionZ.linearRampToValueAtTime(_position$1$1.z,nr),tr.forwardX.linearRampToValueAtTime(_orientation$1.x,nr),tr.forwardY.linearRampToValueAtTime(_orientation$1.y,nr),tr.forwardZ.linearRampToValueAtTime(_orientation$1.z,nr),tr.upX.linearRampToValueAtTime(ir.x,nr),tr.upY.linearRampToValueAtTime(ir.y,nr),tr.upZ.linearRampToValueAtTime(ir.z,nr)}else tr.setPosition(_position$1$1.x,_position$1$1.y,_position$1$1.z),tr.setOrientation(_orientation$1.x,_orientation$1.y,_orientation$1.z,ir.x,ir.y,ir.z)}}let Audio$1=class extends Object3D{constructor(er){super(),this.type="Audio",this.listener=er,this.context=er.context,this.gain=this.context.createGain(),this.gain.connect(er.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(er){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=er,this.connect(),this}setMediaElementSource(er){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(er),this.connect(),this}setMediaStreamSource(er){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(er),this.connect(),this}setBuffer(er){return this.buffer=er,this.sourceType="buffer",this.autoplay&&this.play(),this}play(er=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+er;const tr=this.context.createBufferSource();return tr.buffer=this.buffer,tr.loop=this.loop,tr.loopStart=this.loopStart,tr.loopEnd=this.loopEnd,tr.onended=this.onEnded.bind(this),tr.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=tr,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(er=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+er),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let er=1,tr=this.filters.length;er<tr;er++)this.filters[er-1].connect(this.filters[er]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let er=1,tr=this.filters.length;er<tr;er++)this.filters[er-1].disconnect(this.filters[er]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(er){return er||(er=[]),this._connected===!0?(this.disconnect(),this.filters=er.slice(),this.connect()):this.filters=er.slice(),this}setDetune(er){return this.detune=er,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(er){return this.setFilters(er?[er]:[])}setPlaybackRate(er){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=er,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(er){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=er,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(er){return this.loopStart=er,this}setLoopEnd(er){return this.loopEnd=er,this}getVolume(){return this.gain.gain.value}setVolume(er){return this.gain.gain.setTargetAtTime(er,this.context.currentTime,.01),this}};const _position$4=new Vector3$1,_quaternion$5=new Quaternion$1,_scale$4=new Vector3$1,_orientation=new Vector3$1;class PositionalAudio extends Audio$1{constructor(er){super(er),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){super.connect(),this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(er){return this.panner.refDistance=er,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(er){return this.panner.rolloffFactor=er,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(er){return this.panner.distanceModel=er,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(er){return this.panner.maxDistance=er,this}setDirectionalCone(er,tr,ir){return this.panner.coneInnerAngle=er,this.panner.coneOuterAngle=tr,this.panner.coneOuterGain=ir,this}updateMatrixWorld(er){if(super.updateMatrixWorld(er),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_position$4,_quaternion$5,_scale$4),_orientation.set(0,0,1).applyQuaternion(_quaternion$5);const tr=this.panner;if(tr.positionX){const ir=this.context.currentTime+this.listener.timeDelta;tr.positionX.linearRampToValueAtTime(_position$4.x,ir),tr.positionY.linearRampToValueAtTime(_position$4.y,ir),tr.positionZ.linearRampToValueAtTime(_position$4.z,ir),tr.orientationX.linearRampToValueAtTime(_orientation.x,ir),tr.orientationY.linearRampToValueAtTime(_orientation.y,ir),tr.orientationZ.linearRampToValueAtTime(_orientation.z,ir)}else tr.setPosition(_position$4.x,_position$4.y,_position$4.z),tr.setOrientation(_orientation.x,_orientation.y,_orientation.z)}}class AudioAnalyser{constructor(er,tr=2048){this.analyser=er.context.createAnalyser(),this.analyser.fftSize=tr,this.data=new Uint8Array(this.analyser.frequencyBinCount),er.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let er=0;const tr=this.getFrequencyData();for(let ir=0;ir<tr.length;ir++)er+=tr[ir];return er/tr.length}}class PropertyMixer{constructor(er,tr,ir){this.binding=er,this.valueSize=ir;let nr,sr,ar;switch(tr){case"quaternion":nr=this._slerp,sr=this._slerpAdditive,ar=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(ir*6),this._workIndex=5;break;case"string":case"bool":nr=this._select,sr=this._select,ar=this._setAdditiveIdentityOther,this.buffer=new Array(ir*5);break;default:nr=this._lerp,sr=this._lerpAdditive,ar=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(ir*5)}this._mixBufferRegion=nr,this._mixBufferRegionAdditive=sr,this._setIdentity=ar,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(er,tr){const ir=this.buffer,nr=this.valueSize,sr=er*nr+nr;let ar=this.cumulativeWeight;if(ar===0){for(let or=0;or!==nr;++or)ir[sr+or]=ir[or];ar=tr}else{ar+=tr;const or=tr/ar;this._mixBufferRegion(ir,sr,0,or,nr)}this.cumulativeWeight=ar}accumulateAdditive(er){const tr=this.buffer,ir=this.valueSize,nr=ir*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(tr,nr,0,er,ir),this.cumulativeWeightAdditive+=er}apply(er){const tr=this.valueSize,ir=this.buffer,nr=er*tr+tr,sr=this.cumulativeWeight,ar=this.cumulativeWeightAdditive,or=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,sr<1){const lr=tr*this._origIndex;this._mixBufferRegion(ir,nr,lr,1-sr,tr)}ar>0&&this._mixBufferRegionAdditive(ir,nr,this._addIndex*tr,1,tr);for(let lr=tr,cr=tr+tr;lr!==cr;++lr)if(ir[lr]!==ir[lr+tr]){or.setValue(ir,nr);break}}saveOriginalState(){const er=this.binding,tr=this.buffer,ir=this.valueSize,nr=ir*this._origIndex;er.getValue(tr,nr);for(let sr=ir,ar=nr;sr!==ar;++sr)tr[sr]=tr[nr+sr%ir];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const er=this.valueSize*3;this.binding.setValue(this.buffer,er)}_setAdditiveIdentityNumeric(){const er=this._addIndex*this.valueSize,tr=er+this.valueSize;for(let ir=er;ir<tr;ir++)this.buffer[ir]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const er=this._origIndex*this.valueSize,tr=this._addIndex*this.valueSize;for(let ir=0;ir<this.valueSize;ir++)this.buffer[tr+ir]=this.buffer[er+ir]}_select(er,tr,ir,nr,sr){if(nr>=.5)for(let ar=0;ar!==sr;++ar)er[tr+ar]=er[ir+ar]}_slerp(er,tr,ir,nr){Quaternion$1.slerpFlat(er,tr,er,tr,er,ir,nr)}_slerpAdditive(er,tr,ir,nr,sr){const ar=this._workIndex*sr;Quaternion$1.multiplyQuaternionsFlat(er,ar,er,tr,er,ir),Quaternion$1.slerpFlat(er,tr,er,tr,er,ar,nr)}_lerp(er,tr,ir,nr,sr){const ar=1-nr;for(let or=0;or!==sr;++or){const lr=tr+or;er[lr]=er[lr]*ar+er[ir+or]*nr}}_lerpAdditive(er,tr,ir,nr,sr){for(let ar=0;ar!==sr;++ar){const or=tr+ar;er[or]=er[or]+er[ir+ar]*nr}}}const _RESERVED_CHARS_RE="\\[\\]\\.:\\/",_reservedRe=new RegExp("["+_RESERVED_CHARS_RE+"]","g"),_wordChar="[^"+_RESERVED_CHARS_RE+"]",_wordCharOrDot="[^"+_RESERVED_CHARS_RE.replace("\\.","")+"]",_directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",_wordChar),_nodeRe=/(WCOD+)?/.source.replace("WCOD",_wordCharOrDot),_objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",_wordChar),_propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",_wordChar),_trackRe=new RegExp("^"+_directoryRe+_nodeRe+_objectRe+_propertyRe+"$"),_supportedObjectNames=["material","materials","bones","map"];class Composite{constructor(er,tr,ir){const nr=ir||PropertyBinding.parseTrackName(tr);this._targetGroup=er,this._bindings=er.subscribe_(tr,nr)}getValue(er,tr){this.bind();const ir=this._targetGroup.nCachedObjects_,nr=this._bindings[ir];nr!==void 0&&nr.getValue(er,tr)}setValue(er,tr){const ir=this._bindings;for(let nr=this._targetGroup.nCachedObjects_,sr=ir.length;nr!==sr;++nr)ir[nr].setValue(er,tr)}bind(){const er=this._bindings;for(let tr=this._targetGroup.nCachedObjects_,ir=er.length;tr!==ir;++tr)er[tr].bind()}unbind(){const er=this._bindings;for(let tr=this._targetGroup.nCachedObjects_,ir=er.length;tr!==ir;++tr)er[tr].unbind()}}class PropertyBinding{constructor(er,tr,ir){this.path=tr,this.parsedPath=ir||PropertyBinding.parseTrackName(tr),this.node=PropertyBinding.findNode(er,this.parsedPath.nodeName),this.rootNode=er,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(er,tr,ir){return er&&er.isAnimationObjectGroup?new PropertyBinding.Composite(er,tr,ir):new PropertyBinding(er,tr,ir)}static sanitizeNodeName(er){return er.replace(/\s/g,"_").replace(_reservedRe,"")}static parseTrackName(er){const tr=_trackRe.exec(er);if(tr===null)throw new Error("PropertyBinding: Cannot parse trackName: "+er);const ir={nodeName:tr[2],objectName:tr[3],objectIndex:tr[4],propertyName:tr[5],propertyIndex:tr[6]},nr=ir.nodeName&&ir.nodeName.lastIndexOf(".");if(nr!==void 0&&nr!==-1){const sr=ir.nodeName.substring(nr+1);_supportedObjectNames.indexOf(sr)!==-1&&(ir.nodeName=ir.nodeName.substring(0,nr),ir.objectName=sr)}if(ir.propertyName===null||ir.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+er);return ir}static findNode(er,tr){if(tr===void 0||tr===""||tr==="."||tr===-1||tr===er.name||tr===er.uuid)return er;if(er.skeleton){const ir=er.skeleton.getBoneByName(tr);if(ir!==void 0)return ir}if(er.children){const ir=function(sr){for(let ar=0;ar<sr.length;ar++){const or=sr[ar];if(or.name===tr||or.uuid===tr)return or;const lr=ir(or.children);if(lr)return lr}return null},nr=ir(er.children);if(nr)return nr}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(er,tr){er[tr]=this.targetObject[this.propertyName]}_getValue_array(er,tr){const ir=this.resolvedProperty;for(let nr=0,sr=ir.length;nr!==sr;++nr)er[tr++]=ir[nr]}_getValue_arrayElement(er,tr){er[tr]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(er,tr){this.resolvedProperty.toArray(er,tr)}_setValue_direct(er,tr){this.targetObject[this.propertyName]=er[tr]}_setValue_direct_setNeedsUpdate(er,tr){this.targetObject[this.propertyName]=er[tr],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(er,tr){this.targetObject[this.propertyName]=er[tr],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(er,tr){const ir=this.resolvedProperty;for(let nr=0,sr=ir.length;nr!==sr;++nr)ir[nr]=er[tr++]}_setValue_array_setNeedsUpdate(er,tr){const ir=this.resolvedProperty;for(let nr=0,sr=ir.length;nr!==sr;++nr)ir[nr]=er[tr++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(er,tr){const ir=this.resolvedProperty;for(let nr=0,sr=ir.length;nr!==sr;++nr)ir[nr]=er[tr++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr]}_setValue_arrayElement_setNeedsUpdate(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(er,tr){this.resolvedProperty[this.propertyIndex]=er[tr],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(er,tr){this.resolvedProperty.fromArray(er,tr)}_setValue_fromArray_setNeedsUpdate(er,tr){this.resolvedProperty.fromArray(er,tr),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(er,tr){this.resolvedProperty.fromArray(er,tr),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(er,tr){this.bind(),this.getValue(er,tr)}_setValue_unbound(er,tr){this.bind(),this.setValue(er,tr)}bind(){let er=this.node;const tr=this.parsedPath,ir=tr.objectName,nr=tr.propertyName;let sr=tr.propertyIndex;if(er||(er=PropertyBinding.findNode(this.rootNode,tr.nodeName),this.node=er),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!er){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(ir){let cr=tr.objectIndex;switch(ir){case"materials":if(!er.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!er.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}er=er.material.materials;break;case"bones":if(!er.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}er=er.skeleton.bones;for(let ur=0;ur<er.length;ur++)if(er[ur].name===cr){cr=ur;break}break;case"map":if("map"in er){er=er.map;break}if(!er.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!er.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}er=er.material.map;break;default:if(er[ir]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}er=er[ir]}if(cr!==void 0){if(er[cr]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,er);return}er=er[cr]}}const ar=er[nr];if(ar===void 0){const cr=tr.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+cr+"."+nr+" but it wasn't found.",er);return}let or=this.Versioning.None;this.targetObject=er,er.needsUpdate!==void 0?or=this.Versioning.NeedsUpdate:er.matrixWorldNeedsUpdate!==void 0&&(or=this.Versioning.MatrixWorldNeedsUpdate);let lr=this.BindingType.Direct;if(sr!==void 0){if(nr==="morphTargetInfluences"){if(!er.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!er.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}er.morphTargetDictionary[sr]!==void 0&&(sr=er.morphTargetDictionary[sr])}lr=this.BindingType.ArrayElement,this.resolvedProperty=ar,this.propertyIndex=sr}else ar.fromArray!==void 0&&ar.toArray!==void 0?(lr=this.BindingType.HasFromToArray,this.resolvedProperty=ar):Array.isArray(ar)?(lr=this.BindingType.EntireArray,this.resolvedProperty=ar):this.propertyName=nr;this.getValue=this.GetterByBindingType[lr],this.setValue=this.SetterByBindingTypeAndVersioning[lr][or]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=Composite;PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray];PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.isAnimationObjectGroup=!0,this.uuid=generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const er={};this._indicesByUUID=er;for(let ir=0,nr=arguments.length;ir!==nr;++ir)er[arguments[ir].uuid]=ir;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const tr=this;this.stats={objects:{get total(){return tr._objects.length},get inUse(){return this.total-tr.nCachedObjects_}},get bindingsPerObject(){return tr._bindings.length}}}add(){const er=this._objects,tr=this._indicesByUUID,ir=this._paths,nr=this._parsedPaths,sr=this._bindings,ar=sr.length;let or,lr=er.length,cr=this.nCachedObjects_;for(let ur=0,dr=arguments.length;ur!==dr;++ur){const hr=arguments[ur],pr=hr.uuid;let gr=tr[pr];if(gr===void 0){gr=lr++,tr[pr]=gr,er.push(hr);for(let vr=0,mr=ar;vr!==mr;++vr)sr[vr].push(new PropertyBinding(hr,ir[vr],nr[vr]))}else if(gr<cr){or=er[gr];const vr=--cr,mr=er[vr];tr[mr.uuid]=gr,er[gr]=mr,tr[pr]=vr,er[vr]=hr;for(let fr=0,_r=ar;fr!==_r;++fr){const Ar=sr[fr],yr=Ar[vr];let wr=Ar[gr];Ar[gr]=yr,wr===void 0&&(wr=new PropertyBinding(hr,ir[fr],nr[fr])),Ar[vr]=wr}}else er[gr]!==or&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=cr}remove(){const er=this._objects,tr=this._indicesByUUID,ir=this._bindings,nr=ir.length;let sr=this.nCachedObjects_;for(let ar=0,or=arguments.length;ar!==or;++ar){const lr=arguments[ar],cr=lr.uuid,ur=tr[cr];if(ur!==void 0&&ur>=sr){const dr=sr++,hr=er[dr];tr[hr.uuid]=ur,er[ur]=hr,tr[cr]=dr,er[dr]=lr;for(let pr=0,gr=nr;pr!==gr;++pr){const vr=ir[pr],mr=vr[dr],fr=vr[ur];vr[ur]=mr,vr[dr]=fr}}}this.nCachedObjects_=sr}uncache(){const er=this._objects,tr=this._indicesByUUID,ir=this._bindings,nr=ir.length;let sr=this.nCachedObjects_,ar=er.length;for(let or=0,lr=arguments.length;or!==lr;++or){const cr=arguments[or],ur=cr.uuid,dr=tr[ur];if(dr!==void 0)if(delete tr[ur],dr<sr){const hr=--sr,pr=er[hr],gr=--ar,vr=er[gr];tr[pr.uuid]=dr,er[dr]=pr,tr[vr.uuid]=hr,er[hr]=vr,er.pop();for(let mr=0,fr=nr;mr!==fr;++mr){const _r=ir[mr],Ar=_r[hr],yr=_r[gr];_r[dr]=Ar,_r[hr]=yr,_r.pop()}}else{const hr=--ar,pr=er[hr];hr>0&&(tr[pr.uuid]=dr),er[dr]=pr,er.pop();for(let gr=0,vr=nr;gr!==vr;++gr){const mr=ir[gr];mr[dr]=mr[hr],mr.pop()}}}this.nCachedObjects_=sr}subscribe_(er,tr){const ir=this._bindingsIndicesByPath;let nr=ir[er];const sr=this._bindings;if(nr!==void 0)return sr[nr];const ar=this._paths,or=this._parsedPaths,lr=this._objects,cr=lr.length,ur=this.nCachedObjects_,dr=new Array(cr);nr=sr.length,ir[er]=nr,ar.push(er),or.push(tr),sr.push(dr);for(let hr=ur,pr=lr.length;hr!==pr;++hr){const gr=lr[hr];dr[hr]=new PropertyBinding(gr,er,tr)}return dr}unsubscribe_(er){const tr=this._bindingsIndicesByPath,ir=tr[er];if(ir!==void 0){const nr=this._paths,sr=this._parsedPaths,ar=this._bindings,or=ar.length-1,lr=ar[or],cr=er[or];tr[cr]=ir,ar[ir]=lr,ar.pop(),sr[ir]=sr[or],sr.pop(),nr[ir]=nr[or],nr.pop()}}}class AnimationAction{constructor(er,tr,ir=null,nr=tr.blendMode){this._mixer=er,this._clip=tr,this._localRoot=ir,this.blendMode=nr;const sr=tr.tracks,ar=sr.length,or=new Array(ar),lr={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding};for(let cr=0;cr!==ar;++cr){const ur=sr[cr].createInterpolant(null);or[cr]=ur,ur.settings=lr}this._interpolantSettings=lr,this._interpolants=or,this._propertyBindings=new Array(ar),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=LoopRepeat,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(er){return this._startTime=er,this}setLoop(er,tr){return this.loop=er,this.repetitions=tr,this}setEffectiveWeight(er){return this.weight=er,this._effectiveWeight=this.enabled?er:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(er){return this._scheduleFading(er,0,1)}fadeOut(er){return this._scheduleFading(er,1,0)}crossFadeFrom(er,tr,ir){if(er.fadeOut(tr),this.fadeIn(tr),ir){const nr=this._clip.duration,sr=er._clip.duration,ar=sr/nr,or=nr/sr;er.warp(1,ar,tr),this.warp(or,1,tr)}return this}crossFadeTo(er,tr,ir){return er.crossFadeFrom(this,tr,ir)}stopFading(){const er=this._weightInterpolant;return er!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(er)),this}setEffectiveTimeScale(er){return this.timeScale=er,this._effectiveTimeScale=this.paused?0:er,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(er){return this.timeScale=this._clip.duration/er,this.stopWarping()}syncWith(er){return this.time=er.time,this.timeScale=er.timeScale,this.stopWarping()}halt(er){return this.warp(this._effectiveTimeScale,0,er)}warp(er,tr,ir){const nr=this._mixer,sr=nr.time,ar=this.timeScale;let or=this._timeScaleInterpolant;or===null&&(or=nr._lendControlInterpolant(),this._timeScaleInterpolant=or);const lr=or.parameterPositions,cr=or.sampleValues;return lr[0]=sr,lr[1]=sr+ir,cr[0]=er/ar,cr[1]=tr/ar,this}stopWarping(){const er=this._timeScaleInterpolant;return er!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(er)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(er,tr,ir,nr){if(!this.enabled){this._updateWeight(er);return}const sr=this._startTime;if(sr!==null){const lr=(er-sr)*ir;lr<0||ir===0?tr=0:(this._startTime=null,tr=ir*lr)}tr*=this._updateTimeScale(er);const ar=this._updateTime(tr),or=this._updateWeight(er);if(or>0){const lr=this._interpolants,cr=this._propertyBindings;switch(this.blendMode){case AdditiveAnimationBlendMode:for(let ur=0,dr=lr.length;ur!==dr;++ur)lr[ur].evaluate(ar),cr[ur].accumulateAdditive(or);break;case NormalAnimationBlendMode:default:for(let ur=0,dr=lr.length;ur!==dr;++ur)lr[ur].evaluate(ar),cr[ur].accumulate(nr,or)}}}_updateWeight(er){let tr=0;if(this.enabled){tr=this.weight;const ir=this._weightInterpolant;if(ir!==null){const nr=ir.evaluate(er)[0];tr*=nr,er>ir.parameterPositions[1]&&(this.stopFading(),nr===0&&(this.enabled=!1))}}return this._effectiveWeight=tr,tr}_updateTimeScale(er){let tr=0;if(!this.paused){tr=this.timeScale;const ir=this._timeScaleInterpolant;if(ir!==null){const nr=ir.evaluate(er)[0];tr*=nr,er>ir.parameterPositions[1]&&(this.stopWarping(),tr===0?this.paused=!0:this.timeScale=tr)}}return this._effectiveTimeScale=tr,tr}_updateTime(er){const tr=this._clip.duration,ir=this.loop;let nr=this.time+er,sr=this._loopCount;const ar=ir===LoopPingPong;if(er===0)return sr===-1?nr:ar&&(sr&1)===1?tr-nr:nr;if(ir===LoopOnce){sr===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(nr>=tr)nr=tr;else if(nr<0)nr=0;else{this.time=nr;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=nr,this._mixer.dispatchEvent({type:"finished",action:this,direction:er<0?-1:1})}}else{if(sr===-1&&(er>=0?(sr=0,this._setEndings(!0,this.repetitions===0,ar)):this._setEndings(this.repetitions===0,!0,ar)),nr>=tr||nr<0){const or=Math.floor(nr/tr);nr-=tr*or,sr+=Math.abs(or);const lr=this.repetitions-sr;if(lr<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,nr=er>0?tr:0,this.time=nr,this._mixer.dispatchEvent({type:"finished",action:this,direction:er>0?1:-1});else{if(lr===1){const cr=er<0;this._setEndings(cr,!cr,ar)}else this._setEndings(!1,!1,ar);this._loopCount=sr,this.time=nr,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:or})}}else this.time=nr;if(ar&&(sr&1)===1)return tr-nr}return nr}_setEndings(er,tr,ir){const nr=this._interpolantSettings;ir?(nr.endingStart=ZeroSlopeEnding,nr.endingEnd=ZeroSlopeEnding):(er?nr.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding:nr.endingStart=WrapAroundEnding,tr?nr.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding:nr.endingEnd=WrapAroundEnding)}_scheduleFading(er,tr,ir){const nr=this._mixer,sr=nr.time;let ar=this._weightInterpolant;ar===null&&(ar=nr._lendControlInterpolant(),this._weightInterpolant=ar);const or=ar.parameterPositions,lr=ar.sampleValues;return or[0]=sr,lr[0]=tr,or[1]=sr+er,lr[1]=ir,this}}const _controlInterpolantsResultBuffer=new Float32Array(1);class AnimationMixer extends EventDispatcher{constructor(er){super(),this._root=er,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(er,tr){const ir=er._localRoot||this._root,nr=er._clip.tracks,sr=nr.length,ar=er._propertyBindings,or=er._interpolants,lr=ir.uuid,cr=this._bindingsByRootAndName;let ur=cr[lr];ur===void 0&&(ur={},cr[lr]=ur);for(let dr=0;dr!==sr;++dr){const hr=nr[dr],pr=hr.name;let gr=ur[pr];if(gr!==void 0)++gr.referenceCount,ar[dr]=gr;else{if(gr=ar[dr],gr!==void 0){gr._cacheIndex===null&&(++gr.referenceCount,this._addInactiveBinding(gr,lr,pr));continue}const vr=tr&&tr._propertyBindings[dr].binding.parsedPath;gr=new PropertyMixer(PropertyBinding.create(ir,pr,vr),hr.ValueTypeName,hr.getValueSize()),++gr.referenceCount,this._addInactiveBinding(gr,lr,pr),ar[dr]=gr}or[dr].resultBuffer=gr.buffer}}_activateAction(er){if(!this._isActiveAction(er)){if(er._cacheIndex===null){const ir=(er._localRoot||this._root).uuid,nr=er._clip.uuid,sr=this._actionsByClip[nr];this._bindAction(er,sr&&sr.knownActions[0]),this._addInactiveAction(er,nr,ir)}const tr=er._propertyBindings;for(let ir=0,nr=tr.length;ir!==nr;++ir){const sr=tr[ir];sr.useCount++===0&&(this._lendBinding(sr),sr.saveOriginalState())}this._lendAction(er)}}_deactivateAction(er){if(this._isActiveAction(er)){const tr=er._propertyBindings;for(let ir=0,nr=tr.length;ir!==nr;++ir){const sr=tr[ir];--sr.useCount===0&&(sr.restoreOriginalState(),this._takeBackBinding(sr))}this._takeBackAction(er)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const er=this;this.stats={actions:{get total(){return er._actions.length},get inUse(){return er._nActiveActions}},bindings:{get total(){return er._bindings.length},get inUse(){return er._nActiveBindings}},controlInterpolants:{get total(){return er._controlInterpolants.length},get inUse(){return er._nActiveControlInterpolants}}}}_isActiveAction(er){const tr=er._cacheIndex;return tr!==null&&tr<this._nActiveActions}_addInactiveAction(er,tr,ir){const nr=this._actions,sr=this._actionsByClip;let ar=sr[tr];if(ar===void 0)ar={knownActions:[er],actionByRoot:{}},er._byClipCacheIndex=0,sr[tr]=ar;else{const or=ar.knownActions;er._byClipCacheIndex=or.length,or.push(er)}er._cacheIndex=nr.length,nr.push(er),ar.actionByRoot[ir]=er}_removeInactiveAction(er){const tr=this._actions,ir=tr[tr.length-1],nr=er._cacheIndex;ir._cacheIndex=nr,tr[nr]=ir,tr.pop(),er._cacheIndex=null;const sr=er._clip.uuid,ar=this._actionsByClip,or=ar[sr],lr=or.knownActions,cr=lr[lr.length-1],ur=er._byClipCacheIndex;cr._byClipCacheIndex=ur,lr[ur]=cr,lr.pop(),er._byClipCacheIndex=null;const dr=or.actionByRoot,hr=(er._localRoot||this._root).uuid;delete dr[hr],lr.length===0&&delete ar[sr],this._removeInactiveBindingsForAction(er)}_removeInactiveBindingsForAction(er){const tr=er._propertyBindings;for(let ir=0,nr=tr.length;ir!==nr;++ir){const sr=tr[ir];--sr.referenceCount===0&&this._removeInactiveBinding(sr)}}_lendAction(er){const tr=this._actions,ir=er._cacheIndex,nr=this._nActiveActions++,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=ir,tr[ir]=sr}_takeBackAction(er){const tr=this._actions,ir=er._cacheIndex,nr=--this._nActiveActions,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=ir,tr[ir]=sr}_addInactiveBinding(er,tr,ir){const nr=this._bindingsByRootAndName,sr=this._bindings;let ar=nr[tr];ar===void 0&&(ar={},nr[tr]=ar),ar[ir]=er,er._cacheIndex=sr.length,sr.push(er)}_removeInactiveBinding(er){const tr=this._bindings,ir=er.binding,nr=ir.rootNode.uuid,sr=ir.path,ar=this._bindingsByRootAndName,or=ar[nr],lr=tr[tr.length-1],cr=er._cacheIndex;lr._cacheIndex=cr,tr[cr]=lr,tr.pop(),delete or[sr],Object.keys(or).length===0&&delete ar[nr]}_lendBinding(er){const tr=this._bindings,ir=er._cacheIndex,nr=this._nActiveBindings++,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=ir,tr[ir]=sr}_takeBackBinding(er){const tr=this._bindings,ir=er._cacheIndex,nr=--this._nActiveBindings,sr=tr[nr];er._cacheIndex=nr,tr[nr]=er,sr._cacheIndex=ir,tr[ir]=sr}_lendControlInterpolant(){const er=this._controlInterpolants,tr=this._nActiveControlInterpolants++;let ir=er[tr];return ir===void 0&&(ir=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,_controlInterpolantsResultBuffer),ir.__cacheIndex=tr,er[tr]=ir),ir}_takeBackControlInterpolant(er){const tr=this._controlInterpolants,ir=er.__cacheIndex,nr=--this._nActiveControlInterpolants,sr=tr[nr];er.__cacheIndex=nr,tr[nr]=er,sr.__cacheIndex=ir,tr[ir]=sr}clipAction(er,tr,ir){const nr=tr||this._root,sr=nr.uuid;let ar=typeof er=="string"?AnimationClip.findByName(nr,er):er;const or=ar!==null?ar.uuid:er,lr=this._actionsByClip[or];let cr=null;if(ir===void 0&&(ar!==null?ir=ar.blendMode:ir=NormalAnimationBlendMode),lr!==void 0){const dr=lr.actionByRoot[sr];if(dr!==void 0&&dr.blendMode===ir)return dr;cr=lr.knownActions[0],ar===null&&(ar=cr._clip)}if(ar===null)return null;const ur=new AnimationAction(this,ar,tr,ir);return this._bindAction(ur,cr),this._addInactiveAction(ur,or,sr),ur}existingAction(er,tr){const ir=tr||this._root,nr=ir.uuid,sr=typeof er=="string"?AnimationClip.findByName(ir,er):er,ar=sr?sr.uuid:er,or=this._actionsByClip[ar];return or!==void 0&&or.actionByRoot[nr]||null}stopAllAction(){const er=this._actions,tr=this._nActiveActions;for(let ir=tr-1;ir>=0;--ir)er[ir].stop();return this}update(er){er*=this.timeScale;const tr=this._actions,ir=this._nActiveActions,nr=this.time+=er,sr=Math.sign(er),ar=this._accuIndex^=1;for(let cr=0;cr!==ir;++cr)tr[cr]._update(nr,er,sr,ar);const or=this._bindings,lr=this._nActiveBindings;for(let cr=0;cr!==lr;++cr)or[cr].apply(ar);return this}setTime(er){this.time=0;for(let tr=0;tr<this._actions.length;tr++)this._actions[tr].time=0;return this.update(er)}getRoot(){return this._root}uncacheClip(er){const tr=this._actions,ir=er.uuid,nr=this._actionsByClip,sr=nr[ir];if(sr!==void 0){const ar=sr.knownActions;for(let or=0,lr=ar.length;or!==lr;++or){const cr=ar[or];this._deactivateAction(cr);const ur=cr._cacheIndex,dr=tr[tr.length-1];cr._cacheIndex=null,cr._byClipCacheIndex=null,dr._cacheIndex=ur,tr[ur]=dr,tr.pop(),this._removeInactiveBindingsForAction(cr)}delete nr[ir]}}uncacheRoot(er){const tr=er.uuid,ir=this._actionsByClip;for(const ar in ir){const or=ir[ar].actionByRoot,lr=or[tr];lr!==void 0&&(this._deactivateAction(lr),this._removeInactiveAction(lr))}const nr=this._bindingsByRootAndName,sr=nr[tr];if(sr!==void 0)for(const ar in sr){const or=sr[ar];or.restoreOriginalState(),this._removeInactiveBinding(or)}}uncacheAction(er,tr){const ir=this.existingAction(er,tr);ir!==null&&(this._deactivateAction(ir),this._removeInactiveAction(ir))}}class Uniform{constructor(er){this.value=er}clone(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())}}let _id=0;class UniformsGroup extends EventDispatcher{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:_id++}),this.name="",this.usage=StaticDrawUsage,this.uniforms=[]}add(er){return this.uniforms.push(er),this}remove(er){const tr=this.uniforms.indexOf(er);return tr!==-1&&this.uniforms.splice(tr,1),this}setName(er){return this.name=er,this}setUsage(er){return this.usage=er,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(er){this.name=er.name,this.usage=er.usage;const tr=er.uniforms;this.uniforms.length=0;for(let ir=0,nr=tr.length;ir<nr;ir++){const sr=Array.isArray(tr[ir])?tr[ir]:[tr[ir]];for(let ar=0;ar<sr.length;ar++)this.uniforms.push(sr[ar].clone())}return this}clone(){return new this.constructor().copy(this)}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(er,tr,ir=1){super(er,tr),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=ir}copy(er){return super.copy(er),this.meshPerAttribute=er.meshPerAttribute,this}clone(er){const tr=super.clone(er);return tr.meshPerAttribute=this.meshPerAttribute,tr}toJSON(er){const tr=super.toJSON(er);return tr.isInstancedInterleavedBuffer=!0,tr.meshPerAttribute=this.meshPerAttribute,tr}}class GLBufferAttribute{constructor(er,tr,ir,nr,sr){this.isGLBufferAttribute=!0,this.name="",this.buffer=er,this.type=tr,this.itemSize=ir,this.elementSize=nr,this.count=sr,this.version=0}set needsUpdate(er){er===!0&&this.version++}setBuffer(er){return this.buffer=er,this}setType(er,tr){return this.type=er,this.elementSize=tr,this}setItemSize(er){return this.itemSize=er,this}setCount(er){return this.count=er,this}}const _matrix$6=new Matrix4;class Raycaster{constructor(er,tr,ir=0,nr=1/0){this.ray=new Ray$1(er,tr),this.near=ir,this.far=nr,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(er,tr){this.ray.set(er,tr)}setFromCamera(er,tr){tr.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(tr.matrixWorld),this.ray.direction.set(er.x,er.y,.5).unproject(tr).sub(this.ray.origin).normalize(),this.camera=tr):tr.isOrthographicCamera?(this.ray.origin.set(er.x,er.y,(tr.near+tr.far)/(tr.near-tr.far)).unproject(tr),this.ray.direction.set(0,0,-1).transformDirection(tr.matrixWorld),this.camera=tr):console.error("THREE.Raycaster: Unsupported camera type: "+tr.type)}setFromXRController(er){return _matrix$6.identity().extractRotation(er.matrixWorld),this.ray.origin.setFromMatrixPosition(er.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(_matrix$6),this}intersectObject(er,tr=!0,ir=[]){return intersect(er,this,ir,tr),ir.sort(ascSort),ir}intersectObjects(er,tr=!0,ir=[]){for(let nr=0,sr=er.length;nr<sr;nr++)intersect(er[nr],this,ir,tr);return ir.sort(ascSort),ir}}function ascSort(rr,er){return rr.distance-er.distance}function intersect(rr,er,tr,ir){let nr=!0;if(rr.layers.test(er.layers)&&rr.raycast(er,tr)===!1&&(nr=!1),nr===!0&&ir===!0){const sr=rr.children;for(let ar=0,or=sr.length;ar<or;ar++)intersect(sr[ar],er,tr,!0)}}class Spherical{constructor(er=1,tr=0,ir=0){return this.radius=er,this.phi=tr,this.theta=ir,this}set(er,tr,ir){return this.radius=er,this.phi=tr,this.theta=ir,this}copy(er){return this.radius=er.radius,this.phi=er.phi,this.theta=er.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(er){return this.setFromCartesianCoords(er.x,er.y,er.z)}setFromCartesianCoords(er,tr,ir){return this.radius=Math.sqrt(er*er+tr*tr+ir*ir),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(er,ir),this.phi=Math.acos(clamp(tr/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class Cylindrical{constructor(er=1,tr=0,ir=0){return this.radius=er,this.theta=tr,this.y=ir,this}set(er,tr,ir){return this.radius=er,this.theta=tr,this.y=ir,this}copy(er){return this.radius=er.radius,this.theta=er.theta,this.y=er.y,this}setFromVector3(er){return this.setFromCartesianCoords(er.x,er.y,er.z)}setFromCartesianCoords(er,tr,ir){return this.radius=Math.sqrt(er*er+ir*ir),this.theta=Math.atan2(er,ir),this.y=tr,this}clone(){return new this.constructor().copy(this)}}class Matrix2{constructor(er,tr,ir,nr){Matrix2.prototype.isMatrix2=!0,this.elements=[1,0,0,1],er!==void 0&&this.set(er,tr,ir,nr)}identity(){return this.set(1,0,0,1),this}fromArray(er,tr=0){for(let ir=0;ir<4;ir++)this.elements[ir]=er[ir+tr];return this}set(er,tr,ir,nr){const sr=this.elements;return sr[0]=er,sr[2]=tr,sr[1]=ir,sr[3]=nr,this}}const _vector$4$1=new Vector2;class Box2{constructor(er=new Vector2(1/0,1/0),tr=new Vector2(-1/0,-1/0)){this.isBox2=!0,this.min=er,this.max=tr}set(er,tr){return this.min.copy(er),this.max.copy(tr),this}setFromPoints(er){this.makeEmpty();for(let tr=0,ir=er.length;tr<ir;tr++)this.expandByPoint(er[tr]);return this}setFromCenterAndSize(er,tr){const ir=_vector$4$1.copy(tr).multiplyScalar(.5);return this.min.copy(er).sub(ir),this.max.copy(er).add(ir),this}clone(){return new this.constructor().copy(this)}copy(er){return this.min.copy(er.min),this.max.copy(er.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(er){return this.isEmpty()?er.set(0,0):er.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(er){return this.isEmpty()?er.set(0,0):er.subVectors(this.max,this.min)}expandByPoint(er){return this.min.min(er),this.max.max(er),this}expandByVector(er){return this.min.sub(er),this.max.add(er),this}expandByScalar(er){return this.min.addScalar(-er),this.max.addScalar(er),this}containsPoint(er){return er.x>=this.min.x&&er.x<=this.max.x&&er.y>=this.min.y&&er.y<=this.max.y}containsBox(er){return this.min.x<=er.min.x&&er.max.x<=this.max.x&&this.min.y<=er.min.y&&er.max.y<=this.max.y}getParameter(er,tr){return tr.set((er.x-this.min.x)/(this.max.x-this.min.x),(er.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(er){return er.max.x>=this.min.x&&er.min.x<=this.max.x&&er.max.y>=this.min.y&&er.min.y<=this.max.y}clampPoint(er,tr){return tr.copy(er).clamp(this.min,this.max)}distanceToPoint(er){return this.clampPoint(er,_vector$4$1).distanceTo(er)}intersect(er){return this.min.max(er.min),this.max.min(er.max),this.isEmpty()&&this.makeEmpty(),this}union(er){return this.min.min(er.min),this.max.max(er.max),this}translate(er){return this.min.add(er),this.max.add(er),this}equals(er){return er.min.equals(this.min)&&er.max.equals(this.max)}}const _startP=new Vector3$1,_startEnd=new Vector3$1;class Line3{constructor(er=new Vector3$1,tr=new Vector3$1){this.start=er,this.end=tr}set(er,tr){return this.start.copy(er),this.end.copy(tr),this}copy(er){return this.start.copy(er.start),this.end.copy(er.end),this}getCenter(er){return er.addVectors(this.start,this.end).multiplyScalar(.5)}delta(er){return er.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(er,tr){return this.delta(tr).multiplyScalar(er).add(this.start)}closestPointToPointParameter(er,tr){_startP.subVectors(er,this.start),_startEnd.subVectors(this.end,this.start);const ir=_startEnd.dot(_startEnd);let sr=_startEnd.dot(_startP)/ir;return tr&&(sr=clamp(sr,0,1)),sr}closestPointToPoint(er,tr,ir){const nr=this.closestPointToPointParameter(er,tr);return this.delta(ir).multiplyScalar(nr).add(this.start)}applyMatrix4(er){return this.start.applyMatrix4(er),this.end.applyMatrix4(er),this}equals(er){return er.start.equals(this.start)&&er.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const _vector$3$1=new Vector3$1;class SpotLightHelper extends Object3D{constructor(er,tr){super(),this.light=er,this.matrixAutoUpdate=!1,this.color=tr,this.type="SpotLightHelper";const ir=new BufferGeometry,nr=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let ar=0,or=1,lr=32;ar<lr;ar++,or++){const cr=ar/lr*Math.PI*2,ur=or/lr*Math.PI*2;nr.push(Math.cos(cr),Math.sin(cr),1,Math.cos(ur),Math.sin(ur),1)}ir.setAttribute("position",new Float32BufferAttribute(nr,3));const sr=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(ir,sr),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const er=this.light.distance?this.light.distance:1e3,tr=er*Math.tan(this.light.angle);this.cone.scale.set(tr,tr,er),_vector$3$1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(_vector$3$1),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const _vector$2$1=new Vector3$1,_boneMatrix$1=new Matrix4,_matrixWorldInv$1=new Matrix4;class SkeletonHelper extends LineSegments{constructor(er){const tr=getBoneList(er),ir=new BufferGeometry,nr=[],sr=[],ar=new Color(0,0,1),or=new Color(0,1,0);for(let cr=0;cr<tr.length;cr++){const ur=tr[cr];ur.parent&&ur.parent.isBone&&(nr.push(0,0,0),nr.push(0,0,0),sr.push(ar.r,ar.g,ar.b),sr.push(or.r,or.g,or.b))}ir.setAttribute("position",new Float32BufferAttribute(nr,3)),ir.setAttribute("color",new Float32BufferAttribute(sr,3));const lr=new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(ir,lr),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=er,this.bones=tr,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(er){const tr=this.bones,ir=this.geometry,nr=ir.getAttribute("position");_matrixWorldInv$1.copy(this.root.matrixWorld).invert();for(let sr=0,ar=0;sr<tr.length;sr++){const or=tr[sr];or.parent&&or.parent.isBone&&(_boneMatrix$1.multiplyMatrices(_matrixWorldInv$1,or.matrixWorld),_vector$2$1.setFromMatrixPosition(_boneMatrix$1),nr.setXYZ(ar,_vector$2$1.x,_vector$2$1.y,_vector$2$1.z),_boneMatrix$1.multiplyMatrices(_matrixWorldInv$1,or.parent.matrixWorld),_vector$2$1.setFromMatrixPosition(_boneMatrix$1),nr.setXYZ(ar+1,_vector$2$1.x,_vector$2$1.y,_vector$2$1.z),ar+=2)}ir.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(er)}dispose(){this.geometry.dispose(),this.material.dispose()}}function getBoneList(rr){const er=[];rr.isBone===!0&&er.push(rr);for(let tr=0;tr<rr.children.length;tr++)er.push.apply(er,getBoneList(rr.children[tr]));return er}class PointLightHelper extends Mesh{constructor(er,tr,ir){const nr=new SphereGeometry(tr,4,2),sr=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1});super(nr,sr),this.light=er,this.color=ir,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const _vector$1$1=new Vector3$1,_color1=new Color,_color2=new Color;class HemisphereLightHelper extends Object3D{constructor(er,tr,ir){super(),this.light=er,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.color=ir,this.type="HemisphereLightHelper";const nr=new OctahedronGeometry(tr);nr.rotateY(Math.PI*.5),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const sr=nr.getAttribute("position"),ar=new Float32Array(sr.count*3);nr.setAttribute("color",new BufferAttribute(ar,3)),this.add(new Mesh(nr,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const er=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const tr=er.geometry.getAttribute("color");_color1.copy(this.light.color),_color2.copy(this.light.groundColor);for(let ir=0,nr=tr.count;ir<nr;ir++){const sr=ir<nr/2?_color1:_color2;tr.setXYZ(ir,sr.r,sr.g,sr.b)}tr.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),er.lookAt(_vector$1$1.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(er=10,tr=10,ir=4473924,nr=8947848){ir=new Color(ir),nr=new Color(nr);const sr=tr/2,ar=er/tr,or=er/2,lr=[],cr=[];for(let hr=0,pr=0,gr=-or;hr<=tr;hr++,gr+=ar){lr.push(-or,0,gr,or,0,gr),lr.push(gr,0,-or,gr,0,or);const vr=hr===sr?ir:nr;vr.toArray(cr,pr),pr+=3,vr.toArray(cr,pr),pr+=3,vr.toArray(cr,pr),pr+=3,vr.toArray(cr,pr),pr+=3}const ur=new BufferGeometry;ur.setAttribute("position",new Float32BufferAttribute(lr,3)),ur.setAttribute("color",new Float32BufferAttribute(cr,3));const dr=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(ur,dr),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class PolarGridHelper extends LineSegments{constructor(er=10,tr=16,ir=8,nr=64,sr=4473924,ar=8947848){sr=new Color(sr),ar=new Color(ar);const or=[],lr=[];if(tr>1)for(let dr=0;dr<tr;dr++){const hr=dr/tr*(Math.PI*2),pr=Math.sin(hr)*er,gr=Math.cos(hr)*er;or.push(0,0,0),or.push(pr,0,gr);const vr=dr&1?sr:ar;lr.push(vr.r,vr.g,vr.b),lr.push(vr.r,vr.g,vr.b)}for(let dr=0;dr<ir;dr++){const hr=dr&1?sr:ar,pr=er-er/ir*dr;for(let gr=0;gr<nr;gr++){let vr=gr/nr*(Math.PI*2),mr=Math.sin(vr)*pr,fr=Math.cos(vr)*pr;or.push(mr,0,fr),lr.push(hr.r,hr.g,hr.b),vr=(gr+1)/nr*(Math.PI*2),mr=Math.sin(vr)*pr,fr=Math.cos(vr)*pr,or.push(mr,0,fr),lr.push(hr.r,hr.g,hr.b)}}const cr=new BufferGeometry;cr.setAttribute("position",new Float32BufferAttribute(or,3)),cr.setAttribute("color",new Float32BufferAttribute(lr,3));const ur=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(cr,ur),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1$8=new Vector3$1,_v2$5=new Vector3$1,_v3$3=new Vector3$1;class DirectionalLightHelper extends Object3D{constructor(er,tr,ir){super(),this.light=er,this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.color=ir,this.type="DirectionalLightHelper",tr===void 0&&(tr=1);let nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute([-tr,tr,0,tr,tr,0,tr,-tr,0,-tr,-tr,0,-tr,tr,0],3));const sr=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(nr,sr),this.add(this.lightPlane),nr=new BufferGeometry,nr.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(nr,sr),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),_v1$8.setFromMatrixPosition(this.light.matrixWorld),_v2$5.setFromMatrixPosition(this.light.target.matrixWorld),_v3$3.subVectors(_v2$5,_v1$8),this.lightPlane.lookAt(_v2$5),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(_v2$5),this.targetLine.scale.z=_v3$3.length()}}const _vector$d=new Vector3$1,_camera$1=new Camera;class CameraHelper extends LineSegments{constructor(er){const tr=new BufferGeometry,ir=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),nr=[],sr=[],ar={};or("n1","n2"),or("n2","n4"),or("n4","n3"),or("n3","n1"),or("f1","f2"),or("f2","f4"),or("f4","f3"),or("f3","f1"),or("n1","f1"),or("n2","f2"),or("n3","f3"),or("n4","f4"),or("p","n1"),or("p","n2"),or("p","n3"),or("p","n4"),or("u1","u2"),or("u2","u3"),or("u3","u1"),or("c","t"),or("p","c"),or("cn1","cn2"),or("cn3","cn4"),or("cf1","cf2"),or("cf3","cf4");function or(gr,vr){lr(gr),lr(vr)}function lr(gr){nr.push(0,0,0),sr.push(0,0,0),ar[gr]===void 0&&(ar[gr]=[]),ar[gr].push(nr.length/3-1)}tr.setAttribute("position",new Float32BufferAttribute(nr,3)),tr.setAttribute("color",new Float32BufferAttribute(sr,3)),super(tr,ir),this.type="CameraHelper",this.camera=er,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=er.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=ar,this.update();const cr=new Color(16755200),ur=new Color(16711680),dr=new Color(43775),hr=new Color(16777215),pr=new Color(3355443);this.setColors(cr,ur,dr,hr,pr)}setColors(er,tr,ir,nr,sr){const or=this.geometry.getAttribute("color");or.setXYZ(0,er.r,er.g,er.b),or.setXYZ(1,er.r,er.g,er.b),or.setXYZ(2,er.r,er.g,er.b),or.setXYZ(3,er.r,er.g,er.b),or.setXYZ(4,er.r,er.g,er.b),or.setXYZ(5,er.r,er.g,er.b),or.setXYZ(6,er.r,er.g,er.b),or.setXYZ(7,er.r,er.g,er.b),or.setXYZ(8,er.r,er.g,er.b),or.setXYZ(9,er.r,er.g,er.b),or.setXYZ(10,er.r,er.g,er.b),or.setXYZ(11,er.r,er.g,er.b),or.setXYZ(12,er.r,er.g,er.b),or.setXYZ(13,er.r,er.g,er.b),or.setXYZ(14,er.r,er.g,er.b),or.setXYZ(15,er.r,er.g,er.b),or.setXYZ(16,er.r,er.g,er.b),or.setXYZ(17,er.r,er.g,er.b),or.setXYZ(18,er.r,er.g,er.b),or.setXYZ(19,er.r,er.g,er.b),or.setXYZ(20,er.r,er.g,er.b),or.setXYZ(21,er.r,er.g,er.b),or.setXYZ(22,er.r,er.g,er.b),or.setXYZ(23,er.r,er.g,er.b),or.setXYZ(24,tr.r,tr.g,tr.b),or.setXYZ(25,tr.r,tr.g,tr.b),or.setXYZ(26,tr.r,tr.g,tr.b),or.setXYZ(27,tr.r,tr.g,tr.b),or.setXYZ(28,tr.r,tr.g,tr.b),or.setXYZ(29,tr.r,tr.g,tr.b),or.setXYZ(30,tr.r,tr.g,tr.b),or.setXYZ(31,tr.r,tr.g,tr.b),or.setXYZ(32,ir.r,ir.g,ir.b),or.setXYZ(33,ir.r,ir.g,ir.b),or.setXYZ(34,ir.r,ir.g,ir.b),or.setXYZ(35,ir.r,ir.g,ir.b),or.setXYZ(36,ir.r,ir.g,ir.b),or.setXYZ(37,ir.r,ir.g,ir.b),or.setXYZ(38,nr.r,nr.g,nr.b),or.setXYZ(39,nr.r,nr.g,nr.b),or.setXYZ(40,sr.r,sr.g,sr.b),or.setXYZ(41,sr.r,sr.g,sr.b),or.setXYZ(42,sr.r,sr.g,sr.b),or.setXYZ(43,sr.r,sr.g,sr.b),or.setXYZ(44,sr.r,sr.g,sr.b),or.setXYZ(45,sr.r,sr.g,sr.b),or.setXYZ(46,sr.r,sr.g,sr.b),or.setXYZ(47,sr.r,sr.g,sr.b),or.setXYZ(48,sr.r,sr.g,sr.b),or.setXYZ(49,sr.r,sr.g,sr.b),or.needsUpdate=!0}update(){const er=this.geometry,tr=this.pointMap,ir=1,nr=1;_camera$1.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),setPoint("c",tr,er,_camera$1,0,0,-1),setPoint("t",tr,er,_camera$1,0,0,1),setPoint("n1",tr,er,_camera$1,-ir,-nr,-1),setPoint("n2",tr,er,_camera$1,ir,-nr,-1),setPoint("n3",tr,er,_camera$1,-ir,nr,-1),setPoint("n4",tr,er,_camera$1,ir,nr,-1),setPoint("f1",tr,er,_camera$1,-ir,-nr,1),setPoint("f2",tr,er,_camera$1,ir,-nr,1),setPoint("f3",tr,er,_camera$1,-ir,nr,1),setPoint("f4",tr,er,_camera$1,ir,nr,1),setPoint("u1",tr,er,_camera$1,ir*.7,nr*1.1,-1),setPoint("u2",tr,er,_camera$1,-ir*.7,nr*1.1,-1),setPoint("u3",tr,er,_camera$1,0,nr*2,-1),setPoint("cf1",tr,er,_camera$1,-ir,0,1),setPoint("cf2",tr,er,_camera$1,ir,0,1),setPoint("cf3",tr,er,_camera$1,0,-nr,1),setPoint("cf4",tr,er,_camera$1,0,nr,1),setPoint("cn1",tr,er,_camera$1,-ir,0,-1),setPoint("cn2",tr,er,_camera$1,ir,0,-1),setPoint("cn3",tr,er,_camera$1,0,-nr,-1),setPoint("cn4",tr,er,_camera$1,0,nr,-1),er.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function setPoint(rr,er,tr,ir,nr,sr,ar){_vector$d.set(nr,sr,ar).unproject(ir);const or=er[rr];if(or!==void 0){const lr=tr.getAttribute("position");for(let cr=0,ur=or.length;cr<ur;cr++)lr.setXYZ(or[cr],_vector$d.x,_vector$d.y,_vector$d.z)}}const _box$5=new Box3;class BoxHelper extends LineSegments{constructor(er,tr=16776960){const ir=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),nr=new Float32Array(8*3),sr=new BufferGeometry;sr.setIndex(new BufferAttribute(ir,1)),sr.setAttribute("position",new BufferAttribute(nr,3)),super(sr,new LineBasicMaterial({color:tr,toneMapped:!1})),this.object=er,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(er){if(er!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&_box$5.setFromObject(this.object),_box$5.isEmpty())return;const tr=_box$5.min,ir=_box$5.max,nr=this.geometry.attributes.position,sr=nr.array;sr[0]=ir.x,sr[1]=ir.y,sr[2]=ir.z,sr[3]=tr.x,sr[4]=ir.y,sr[5]=ir.z,sr[6]=tr.x,sr[7]=tr.y,sr[8]=ir.z,sr[9]=ir.x,sr[10]=tr.y,sr[11]=ir.z,sr[12]=ir.x,sr[13]=ir.y,sr[14]=tr.z,sr[15]=tr.x,sr[16]=ir.y,sr[17]=tr.z,sr[18]=tr.x,sr[19]=tr.y,sr[20]=tr.z,sr[21]=ir.x,sr[22]=tr.y,sr[23]=tr.z,nr.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(er){return this.object=er,this.update(),this}copy(er,tr){return super.copy(er,tr),this.object=er.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Box3Helper extends LineSegments{constructor(er,tr=16776960){const ir=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),nr=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],sr=new BufferGeometry;sr.setIndex(new BufferAttribute(ir,1)),sr.setAttribute("position",new Float32BufferAttribute(nr,3)),super(sr,new LineBasicMaterial({color:tr,toneMapped:!1})),this.box=er,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(er){const tr=this.box;tr.isEmpty()||(tr.getCenter(this.position),tr.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(er))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PlaneHelper extends Line{constructor(er,tr=1,ir=16776960){const nr=ir,sr=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],ar=new BufferGeometry;ar.setAttribute("position",new Float32BufferAttribute(sr,3)),ar.computeBoundingSphere(),super(ar,new LineBasicMaterial({color:nr,toneMapped:!1})),this.type="PlaneHelper",this.plane=er,this.size=tr;const or=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],lr=new BufferGeometry;lr.setAttribute("position",new Float32BufferAttribute(or,3)),lr.computeBoundingSphere(),this.add(new Mesh(lr,new MeshBasicMaterial({color:nr,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(er){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(er)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const _axis$2=new Vector3$1;let _lineGeometry,_coneGeometry;class ArrowHelper extends Object3D{constructor(er=new Vector3$1(0,0,1),tr=new Vector3$1(0,0,0),ir=1,nr=16776960,sr=ir*.2,ar=sr*.2){super(),this.type="ArrowHelper",_lineGeometry===void 0&&(_lineGeometry=new BufferGeometry,_lineGeometry.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),_coneGeometry=new CylinderGeometry(0,.5,1,5,1),_coneGeometry.translate(0,-.5,0)),this.position.copy(tr),this.line=new Line(_lineGeometry,new LineBasicMaterial({color:nr,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(_coneGeometry,new MeshBasicMaterial({color:nr,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(er),this.setLength(ir,sr,ar)}setDirection(er){if(er.y>.99999)this.quaternion.set(0,0,0,1);else if(er.y<-.99999)this.quaternion.set(1,0,0,0);else{_axis$2.set(er.z,0,-er.x).normalize();const tr=Math.acos(er.y);this.quaternion.setFromAxisAngle(_axis$2,tr)}}setLength(er,tr=er*.2,ir=tr*.2){this.line.scale.set(1,Math.max(1e-4,er-tr),1),this.line.updateMatrix(),this.cone.scale.set(ir,tr,ir),this.cone.position.y=er,this.cone.updateMatrix()}setColor(er){this.line.material.color.set(er),this.cone.material.color.set(er)}copy(er){return super.copy(er,!1),this.line.copy(er.line),this.cone.copy(er.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class AxesHelper extends LineSegments{constructor(er=1){const tr=[0,0,0,er,0,0,0,0,0,0,er,0,0,0,0,0,0,er],ir=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute(tr,3)),nr.setAttribute("color",new Float32BufferAttribute(ir,3));const sr=new LineBasicMaterial({vertexColors:!0,toneMapped:!1});super(nr,sr),this.type="AxesHelper"}setColors(er,tr,ir){const nr=new Color,sr=this.geometry.attributes.color.array;return nr.set(er),nr.toArray(sr,0),nr.toArray(sr,3),nr.set(tr),nr.toArray(sr,6),nr.toArray(sr,9),nr.set(ir),nr.toArray(sr,12),nr.toArray(sr,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(er,tr){return this.currentPath=new Path$1,this.subPaths.push(this.currentPath),this.currentPath.moveTo(er,tr),this}lineTo(er,tr){return this.currentPath.lineTo(er,tr),this}quadraticCurveTo(er,tr,ir,nr){return this.currentPath.quadraticCurveTo(er,tr,ir,nr),this}bezierCurveTo(er,tr,ir,nr,sr,ar){return this.currentPath.bezierCurveTo(er,tr,ir,nr,sr,ar),this}splineThru(er){return this.currentPath.splineThru(er),this}toShapes(er){function tr(fr){const _r=[];for(let Ar=0,yr=fr.length;Ar<yr;Ar++){const wr=fr[Ar],xr=new Shape$1;xr.curves=wr.curves,_r.push(xr)}return _r}function ir(fr,_r){const Ar=_r.length;let yr=!1;for(let wr=Ar-1,xr=0;xr<Ar;wr=xr++){let Sr=_r[wr],br=_r[xr],Cr=br.x-Sr.x,Ir=br.y-Sr.y;if(Math.abs(Ir)>Number.EPSILON){if(Ir<0&&(Sr=_r[xr],Cr=-Cr,br=_r[wr],Ir=-Ir),fr.y<Sr.y||fr.y>br.y)continue;if(fr.y===Sr.y){if(fr.x===Sr.x)return!0}else{const Rr=Ir*(fr.x-Sr.x)-Cr*(fr.y-Sr.y);if(Rr===0)return!0;if(Rr<0)continue;yr=!yr}}else{if(fr.y!==Sr.y)continue;if(br.x<=fr.x&&fr.x<=Sr.x||Sr.x<=fr.x&&fr.x<=br.x)return!0}}return yr}const nr=ShapeUtils.isClockWise,sr=this.subPaths;if(sr.length===0)return[];let ar,or,lr;const cr=[];if(sr.length===1)return or=sr[0],lr=new Shape$1,lr.curves=or.curves,cr.push(lr),cr;let ur=!nr(sr[0].getPoints());ur=er?!ur:ur;const dr=[],hr=[];let pr=[],gr=0,vr;hr[gr]=void 0,pr[gr]=[];for(let fr=0,_r=sr.length;fr<_r;fr++)or=sr[fr],vr=or.getPoints(),ar=nr(vr),ar=er?!ar:ar,ar?(!ur&&hr[gr]&&gr++,hr[gr]={s:new Shape$1,p:vr},hr[gr].s.curves=or.curves,ur&&gr++,pr[gr]=[]):pr[gr].push({h:or,p:vr[0]});if(!hr[0])return tr(sr);if(hr.length>1){let fr=!1,_r=0;for(let Ar=0,yr=hr.length;Ar<yr;Ar++)dr[Ar]=[];for(let Ar=0,yr=hr.length;Ar<yr;Ar++){const wr=pr[Ar];for(let xr=0;xr<wr.length;xr++){const Sr=wr[xr];let br=!0;for(let Cr=0;Cr<hr.length;Cr++)ir(Sr.p,hr[Cr].p)&&(Ar!==Cr&&_r++,br?(br=!1,dr[Cr].push(Sr)):fr=!0);br&&dr[Ar].push(Sr)}}_r>0&&fr===!1&&(pr=dr)}let mr;for(let fr=0,_r=hr.length;fr<_r;fr++){lr=hr[fr].s,cr.push(lr),mr=pr[fr];for(let Ar=0,yr=mr.length;Ar<yr;Ar++)lr.holes.push(mr[Ar].h)}return cr}}class Controls extends EventDispatcher{constructor(er,tr=null){super(),this.object=er,this.domElement=tr,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(er=1,tr=1,ir=1,nr={}){console.warn('THREE.WebGLMultipleRenderTargets has been deprecated and will be removed in r172. Use THREE.WebGLRenderTarget and set the "count" parameter to enable MRT.'),super(er,tr,{...nr,count:ir}),this.isWebGLMultipleRenderTargets=!0}get texture(){return this.textures}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:REVISION}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=REVISION);const __vite__wasmUrl="/assets/rapier_wasm3d_bg-CN52XpWN.wasm",__vite__initWasm=async(rr={},er)=>{let tr;if(er.startsWith("data:")){const ir=er.replace(/^data:.*?base64,/,"");let nr;if(typeof Buffer=="function"&&typeof Buffer.from=="function")nr=Buffer.from(ir,"base64");else if(typeof atob=="function"){const sr=atob(ir);nr=new Uint8Array(sr.length);for(let ar=0;ar<sr.length;ar++)nr[ar]=sr.charCodeAt(ar)}else throw new Error("Cannot decode base64-encoded data URL");tr=await WebAssembly.instantiate(nr,rr)}else{const ir=await fetch(er),nr=ir.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&nr.startsWith("application/wasm"))tr=await WebAssembly.instantiateStreaming(ir,rr);else{const sr=await ir.arrayBuffer();tr=await WebAssembly.instantiate(sr,rr)}}return tr.instance.exports};let wasm$1;function __wbg_set_wasm(rr){wasm$1=rr}const heap=new Array(128).fill(void 0);heap.push(void 0,null,!0,!1);let heap_next=heap.length;function addHeapObject(rr){heap_next===heap.length&&heap.push(heap.length+1);const er=heap_next;return heap_next=heap[er],heap[er]=rr,er}function getObject(rr){return heap[rr]}function dropObject(rr){rr<132||(heap[rr]=heap_next,heap_next=rr)}function takeObject(rr){const er=getObject(rr);return dropObject(rr),er}function isLikeNone(rr){return rr==null}let cachedFloat64Memory0=null;function getFloat64Memory0(){return(cachedFloat64Memory0===null||cachedFloat64Memory0.byteLength===0)&&(cachedFloat64Memory0=new Float64Array(wasm$1.memory.buffer)),cachedFloat64Memory0}let cachedInt32Memory0=null;function getInt32Memory0(){return(cachedInt32Memory0===null||cachedInt32Memory0.byteLength===0)&&(cachedInt32Memory0=new Int32Array(wasm$1.memory.buffer)),cachedInt32Memory0}const lTextDecoder=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let cachedTextDecoder=new lTextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});cachedTextDecoder.decode();let cachedUint8Memory0=null;function getUint8Memory0(){return(cachedUint8Memory0===null||cachedUint8Memory0.byteLength===0)&&(cachedUint8Memory0=new Uint8Array(wasm$1.memory.buffer)),cachedUint8Memory0}function getStringFromWasm0(rr,er){return rr=rr>>>0,cachedTextDecoder.decode(getUint8Memory0().subarray(rr,rr+er))}function version$3(){let rr,er;try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.version(nr);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];return rr=tr,er=ir,getStringFromWasm0(tr,ir)}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),wasm$1.__wbindgen_free(rr,er,1)}}function _assertClass(rr,er){if(!(rr instanceof er))throw new Error(`expected instance of ${er.name}`);return rr.ptr}let cachedFloat32Memory0=null;function getFloat32Memory0(){return(cachedFloat32Memory0===null||cachedFloat32Memory0.byteLength===0)&&(cachedFloat32Memory0=new Float32Array(wasm$1.memory.buffer)),cachedFloat32Memory0}let stack_pointer=128;function addBorrowedObject(rr){if(stack_pointer==1)throw new Error("out of js stack");return heap[--stack_pointer]=rr,stack_pointer}function getArrayF32FromWasm0(rr,er){return rr=rr>>>0,getFloat32Memory0().subarray(rr/4,rr/4+er)}let cachedUint32Memory0=null;function getUint32Memory0(){return(cachedUint32Memory0===null||cachedUint32Memory0.byteLength===0)&&(cachedUint32Memory0=new Uint32Array(wasm$1.memory.buffer)),cachedUint32Memory0}function getArrayU32FromWasm0(rr,er){return rr=rr>>>0,getUint32Memory0().subarray(rr/4,rr/4+er)}let WASM_VECTOR_LEN=0;function passArrayF32ToWasm0(rr,er){const tr=er(rr.length*4,4)>>>0;return getFloat32Memory0().set(rr,tr/4),WASM_VECTOR_LEN=rr.length,tr}function passArray32ToWasm0(rr,er){const tr=er(rr.length*4,4)>>>0;return getUint32Memory0().set(rr,tr/4),WASM_VECTOR_LEN=rr.length,tr}function handleError(rr,er){try{return rr.apply(this,er)}catch(tr){wasm$1.__wbindgen_exn_store(addHeapObject(tr))}}const RawFeatureType=Object.freeze({Vertex:0,0:"Vertex",Edge:1,1:"Edge",Face:2,2:"Face",Unknown:3,3:"Unknown"}),RawShapeType=Object.freeze({Ball:0,0:"Ball",Cuboid:1,1:"Cuboid",Capsule:2,2:"Capsule",Segment:3,3:"Segment",Polyline:4,4:"Polyline",Triangle:5,5:"Triangle",TriMesh:6,6:"TriMesh",HeightField:7,7:"HeightField",Compound:8,8:"Compound",ConvexPolyhedron:9,9:"ConvexPolyhedron",Cylinder:10,10:"Cylinder",Cone:11,11:"Cone",RoundCuboid:12,12:"RoundCuboid",RoundTriangle:13,13:"RoundTriangle",RoundCylinder:14,14:"RoundCylinder",RoundCone:15,15:"RoundCone",RoundConvexPolyhedron:16,16:"RoundConvexPolyhedron",HalfSpace:17,17:"HalfSpace"}),RawJointAxis=Object.freeze({LinX:0,0:"LinX",LinY:1,1:"LinY",LinZ:2,2:"LinZ",AngX:3,3:"AngX",AngY:4,4:"AngY",AngZ:5,5:"AngZ"}),RawRigidBodyType=Object.freeze({Dynamic:0,0:"Dynamic",Fixed:1,1:"Fixed",KinematicPositionBased:2,2:"KinematicPositionBased",KinematicVelocityBased:3,3:"KinematicVelocityBased"}),RawMotorModel=Object.freeze({AccelerationBased:0,0:"AccelerationBased",ForceBased:1,1:"ForceBased"}),RawJointType=Object.freeze({Revolute:0,0:"Revolute",Fixed:1,1:"Fixed",Prismatic:2,2:"Prismatic",Rope:3,3:"Rope",Spring:4,4:"Spring",Spherical:5,5:"Spherical",Generic:6,6:"Generic"}),RawBroadPhaseFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawbroadphase_free(rr>>>0));class RawBroadPhase{static __wrap(er){er=er>>>0;const tr=Object.create(RawBroadPhase.prototype);return tr.__wbg_ptr=er,RawBroadPhaseFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawBroadPhaseFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawbroadphase_free(er)}constructor(){const er=wasm$1.rawbroadphase_new();return this.__wbg_ptr=er>>>0,this}}const RawCCDSolverFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawccdsolver_free(rr>>>0));class RawCCDSolver{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawCCDSolverFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawccdsolver_free(er)}constructor(){const er=wasm$1.rawccdsolver_new();return this.__wbg_ptr=er>>>0,this}}const RawCharacterCollisionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcharactercollision_free(rr>>>0));class RawCharacterCollision{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawCharacterCollisionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcharactercollision_free(er)}constructor(){const er=wasm$1.rawcharactercollision_new();return this.__wbg_ptr=er>>>0,this}handle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}translationDeltaApplied(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}translationDeltaRemaining(){const er=wasm$1.rawcharactercollision_translationDeltaRemaining(this.__wbg_ptr);return RawVector.__wrap(er)}toi(){return wasm$1.rawcharactercollision_toi(this.__wbg_ptr)}worldWitness1(){const er=wasm$1.rawcharactercollision_worldWitness1(this.__wbg_ptr);return RawVector.__wrap(er)}worldWitness2(){const er=wasm$1.rawcharactercollision_worldWitness2(this.__wbg_ptr);return RawVector.__wrap(er)}worldNormal1(){const er=wasm$1.rawcharactercollision_worldNormal1(this.__wbg_ptr);return RawVector.__wrap(er)}worldNormal2(){const er=wasm$1.rawcharactercollision_worldNormal2(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawColliderSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcolliderset_free(rr>>>0));class RawColliderSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawColliderSet.prototype);return tr.__wbg_ptr=er,RawColliderSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawColliderSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcolliderset_free(er)}coTranslation(er){const tr=wasm$1.rawcolliderset_coTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}coRotation(er){const tr=wasm$1.rawcolliderset_coRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}coSetTranslation(er,tr,ir,nr){wasm$1.rawcolliderset_coSetTranslation(this.__wbg_ptr,er,tr,ir,nr)}coSetTranslationWrtParent(er,tr,ir,nr){wasm$1.rawcolliderset_coSetTranslationWrtParent(this.__wbg_ptr,er,tr,ir,nr)}coSetRotation(er,tr,ir,nr,sr){wasm$1.rawcolliderset_coSetRotation(this.__wbg_ptr,er,tr,ir,nr,sr)}coSetRotationWrtParent(er,tr,ir,nr,sr){wasm$1.rawcolliderset_coSetRotationWrtParent(this.__wbg_ptr,er,tr,ir,nr,sr)}coIsSensor(er){return wasm$1.rawcolliderset_coIsSensor(this.__wbg_ptr,er)!==0}coShapeType(er){return wasm$1.rawcolliderset_coShapeType(this.__wbg_ptr,er)}coHalfspaceNormal(er){const tr=wasm$1.rawcolliderset_coHalfspaceNormal(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coHalfExtents(er){const tr=wasm$1.rawcolliderset_coHalfExtents(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coSetHalfExtents(er,tr){_assertClass(tr,RawVector),wasm$1.rawcolliderset_coSetHalfExtents(this.__wbg_ptr,er,tr.__wbg_ptr)}coRadius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coRadius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetRadius(er,tr){wasm$1.rawcolliderset_coSetRadius(this.__wbg_ptr,er,tr)}coHalfHeight(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHalfHeight(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetHalfHeight(er,tr){wasm$1.rawcolliderset_coSetHalfHeight(this.__wbg_ptr,er,tr)}coRoundRadius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coRoundRadius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetRoundRadius(er,tr){wasm$1.rawcolliderset_coSetRoundRadius(this.__wbg_ptr,er,tr)}coVertices(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coVertices(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayF32FromWasm0(tr,ir).slice(),wasm$1.__wbindgen_free(tr,ir*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coIndices(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coIndices(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayU32FromWasm0(tr,ir).slice(),wasm$1.__wbindgen_free(tr,ir*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coTriMeshFlags(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coTriMeshFlags(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];return tr===0?void 0:ir>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightFieldFlags(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightFieldFlags(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];return tr===0?void 0:ir>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldHeights(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldHeights(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];let sr;return tr!==0&&(sr=getArrayF32FromWasm0(tr,ir).slice(),wasm$1.__wbindgen_free(tr,ir*4,4)),sr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldScale(er){const tr=wasm$1.rawcolliderset_coHeightfieldScale(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}coHeightfieldNRows(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldNRows(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];return tr===0?void 0:ir>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coHeightfieldNCols(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coHeightfieldNCols(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getInt32Memory0()[nr/4+1];return tr===0?void 0:ir>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coParent(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawcolliderset_coParent(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat64Memory0()[nr/8+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}coSetEnabled(er,tr){wasm$1.rawcolliderset_coSetEnabled(this.__wbg_ptr,er,tr)}coIsEnabled(er){return wasm$1.rawcolliderset_coIsEnabled(this.__wbg_ptr,er)!==0}coSetContactSkin(er,tr){wasm$1.rawcolliderset_coSetContactSkin(this.__wbg_ptr,er,tr)}coContactSkin(er){return wasm$1.rawcolliderset_coContactSkin(this.__wbg_ptr,er)}coFriction(er){return wasm$1.rawcolliderset_coFriction(this.__wbg_ptr,er)}coRestitution(er){return wasm$1.rawcolliderset_coRestitution(this.__wbg_ptr,er)}coDensity(er){return wasm$1.rawcolliderset_coDensity(this.__wbg_ptr,er)}coMass(er){return wasm$1.rawcolliderset_coMass(this.__wbg_ptr,er)}coVolume(er){return wasm$1.rawcolliderset_coVolume(this.__wbg_ptr,er)}coCollisionGroups(er){return wasm$1.rawcolliderset_coCollisionGroups(this.__wbg_ptr,er)>>>0}coSolverGroups(er){return wasm$1.rawcolliderset_coSolverGroups(this.__wbg_ptr,er)>>>0}coActiveHooks(er){return wasm$1.rawcolliderset_coActiveHooks(this.__wbg_ptr,er)>>>0}coActiveCollisionTypes(er){return wasm$1.rawcolliderset_coActiveCollisionTypes(this.__wbg_ptr,er)}coActiveEvents(er){return wasm$1.rawcolliderset_coActiveEvents(this.__wbg_ptr,er)>>>0}coContactForceEventThreshold(er){return wasm$1.rawcolliderset_coContactForceEventThreshold(this.__wbg_ptr,er)}coContainsPoint(er,tr){return _assertClass(tr,RawVector),wasm$1.rawcolliderset_coContainsPoint(this.__wbg_ptr,er,tr.__wbg_ptr)!==0}coCastShape(er,tr,ir,nr,sr,ar,or,lr,cr){_assertClass(tr,RawVector),_assertClass(ir,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),_assertClass(ar,RawVector);const ur=wasm$1.rawcolliderset_coCastShape(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or,lr,cr);return ur===0?void 0:RawShapeCastHit.__wrap(ur)}coCastCollider(er,tr,ir,nr,sr,ar,or){_assertClass(tr,RawVector),_assertClass(nr,RawVector);const lr=wasm$1.rawcolliderset_coCastCollider(this.__wbg_ptr,er,tr.__wbg_ptr,ir,nr.__wbg_ptr,sr,ar,or);return lr===0?void 0:RawColliderShapeCastHit.__wrap(lr)}coIntersectsShape(er,tr,ir,nr){return _assertClass(tr,RawShape),_assertClass(ir,RawVector),_assertClass(nr,RawRotation),wasm$1.rawcolliderset_coIntersectsShape(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr)!==0}coContactShape(er,tr,ir,nr,sr){_assertClass(tr,RawShape),_assertClass(ir,RawVector),_assertClass(nr,RawRotation);const ar=wasm$1.rawcolliderset_coContactShape(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr);return ar===0?void 0:RawShapeContact.__wrap(ar)}coContactCollider(er,tr,ir){const nr=wasm$1.rawcolliderset_coContactCollider(this.__wbg_ptr,er,tr,ir);return nr===0?void 0:RawShapeContact.__wrap(nr)}coProjectPoint(er,tr,ir){_assertClass(tr,RawVector);const nr=wasm$1.rawcolliderset_coProjectPoint(this.__wbg_ptr,er,tr.__wbg_ptr,ir);return RawPointProjection.__wrap(nr)}coIntersectsRay(er,tr,ir,nr){return _assertClass(tr,RawVector),_assertClass(ir,RawVector),wasm$1.rawcolliderset_coIntersectsRay(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr)!==0}coCastRay(er,tr,ir,nr,sr){return _assertClass(tr,RawVector),_assertClass(ir,RawVector),wasm$1.rawcolliderset_coCastRay(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr)}coCastRayAndGetNormal(er,tr,ir,nr,sr){_assertClass(tr,RawVector),_assertClass(ir,RawVector);const ar=wasm$1.rawcolliderset_coCastRayAndGetNormal(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr);return ar===0?void 0:RawRayIntersection.__wrap(ar)}coSetSensor(er,tr){wasm$1.rawcolliderset_coSetSensor(this.__wbg_ptr,er,tr)}coSetRestitution(er,tr){wasm$1.rawcolliderset_coSetRestitution(this.__wbg_ptr,er,tr)}coSetFriction(er,tr){wasm$1.rawcolliderset_coSetFriction(this.__wbg_ptr,er,tr)}coFrictionCombineRule(er){return wasm$1.rawcolliderset_coFrictionCombineRule(this.__wbg_ptr,er)>>>0}coSetFrictionCombineRule(er,tr){wasm$1.rawcolliderset_coSetFrictionCombineRule(this.__wbg_ptr,er,tr)}coRestitutionCombineRule(er){return wasm$1.rawcolliderset_coRestitutionCombineRule(this.__wbg_ptr,er)>>>0}coSetRestitutionCombineRule(er,tr){wasm$1.rawcolliderset_coSetRestitutionCombineRule(this.__wbg_ptr,er,tr)}coSetCollisionGroups(er,tr){wasm$1.rawcolliderset_coSetCollisionGroups(this.__wbg_ptr,er,tr)}coSetSolverGroups(er,tr){wasm$1.rawcolliderset_coSetSolverGroups(this.__wbg_ptr,er,tr)}coSetActiveHooks(er,tr){wasm$1.rawcolliderset_coSetActiveHooks(this.__wbg_ptr,er,tr)}coSetActiveEvents(er,tr){wasm$1.rawcolliderset_coSetActiveEvents(this.__wbg_ptr,er,tr)}coSetActiveCollisionTypes(er,tr){wasm$1.rawcolliderset_coSetActiveCollisionTypes(this.__wbg_ptr,er,tr)}coSetShape(er,tr){_assertClass(tr,RawShape),wasm$1.rawcolliderset_coSetShape(this.__wbg_ptr,er,tr.__wbg_ptr)}coSetContactForceEventThreshold(er,tr){wasm$1.rawcolliderset_coSetContactForceEventThreshold(this.__wbg_ptr,er,tr)}coSetDensity(er,tr){wasm$1.rawcolliderset_coSetDensity(this.__wbg_ptr,er,tr)}coSetMass(er,tr){wasm$1.rawcolliderset_coSetMass(this.__wbg_ptr,er,tr)}coSetMassProperties(er,tr,ir,nr,sr){_assertClass(ir,RawVector),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawcolliderset_coSetMassProperties(this.__wbg_ptr,er,tr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}constructor(){const er=wasm$1.rawcolliderset_new();return this.__wbg_ptr=er>>>0,this}len(){return wasm$1.rawcolliderset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawcolliderset_contains(this.__wbg_ptr,er)!==0}createCollider(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr){try{const Pr=wasm$1.__wbindgen_add_to_stack_pointer(-16);_assertClass(tr,RawShape),_assertClass(ir,RawVector),_assertClass(nr,RawRotation),_assertClass(or,RawVector),_assertClass(lr,RawVector),_assertClass(cr,RawRotation),_assertClass(Cr,RawRigidBodySet),wasm$1.rawcolliderset_createCollider(Pr,this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,ur,dr,hr,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr.__wbg_ptr);var Ir=getInt32Memory0()[Pr/4+0],Rr=getFloat64Memory0()[Pr/8+1];return Ir===0?void 0:Rr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}remove(er,tr,ir,nr){_assertClass(tr,RawIslandManager),_assertClass(ir,RawRigidBodySet),wasm$1.rawcolliderset_remove(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr)}isHandleValid(er){return wasm$1.rawcolliderset_contains(this.__wbg_ptr,er)!==0}forEachColliderHandle(er){try{wasm$1.rawcolliderset_forEachColliderHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}}const RawColliderShapeCastHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcollidershapecasthit_free(rr>>>0));class RawColliderShapeCastHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawColliderShapeCastHit.prototype);return tr.__wbg_ptr=er,RawColliderShapeCastHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawColliderShapeCastHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcollidershapecasthit_free(er)}colliderHandle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}witness1(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}witness2(){const er=wasm$1.rawcollidershapecasthit_witness2(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawcharactercollision_translationDeltaRemaining(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawContactForceEventFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcontactforceevent_free(rr>>>0));class RawContactForceEvent{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactForceEvent.prototype);return tr.__wbg_ptr=er,RawContactForceEventFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactForceEventFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactforceevent_free(er)}collider1(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}collider2(){return wasm$1.rawcontactforceevent_collider2(this.__wbg_ptr)}total_force(){const er=wasm$1.rawcontactforceevent_total_force(this.__wbg_ptr);return RawVector.__wrap(er)}total_force_magnitude(){return wasm$1.rawcontactforceevent_total_force_magnitude(this.__wbg_ptr)}max_force_direction(){const er=wasm$1.rawcontactforceevent_max_force_direction(this.__wbg_ptr);return RawVector.__wrap(er)}max_force_magnitude(){return wasm$1.rawcontactforceevent_max_force_magnitude(this.__wbg_ptr)}}const RawContactManifoldFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcontactmanifold_free(rr>>>0));class RawContactManifold{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactManifold.prototype);return tr.__wbg_ptr=er,RawContactManifoldFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactManifoldFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactmanifold_free(er)}normal(){const er=wasm$1.rawcontactmanifold_normal(this.__wbg_ptr);return RawVector.__wrap(er)}local_n1(){const er=wasm$1.rawcontactmanifold_local_n1(this.__wbg_ptr);return RawVector.__wrap(er)}local_n2(){const er=wasm$1.rawcontactmanifold_local_n2(this.__wbg_ptr);return RawVector.__wrap(er)}subshape1(){return wasm$1.rawcontactmanifold_subshape1(this.__wbg_ptr)>>>0}subshape2(){return wasm$1.rawcontactmanifold_subshape2(this.__wbg_ptr)>>>0}num_contacts(){return wasm$1.rawcontactmanifold_num_contacts(this.__wbg_ptr)>>>0}contact_local_p1(er){const tr=wasm$1.rawcontactmanifold_contact_local_p1(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}contact_local_p2(er){const tr=wasm$1.rawcontactmanifold_contact_local_p2(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}contact_dist(er){return wasm$1.rawcontactmanifold_contact_dist(this.__wbg_ptr,er)}contact_fid1(er){return wasm$1.rawcontactmanifold_contact_fid1(this.__wbg_ptr,er)>>>0}contact_fid2(er){return wasm$1.rawcontactmanifold_contact_fid2(this.__wbg_ptr,er)>>>0}contact_impulse(er){return wasm$1.rawcontactmanifold_contact_impulse(this.__wbg_ptr,er)}contact_tangent_impulse_x(er){return wasm$1.rawcontactmanifold_contact_tangent_impulse_x(this.__wbg_ptr,er)}contact_tangent_impulse_y(er){return wasm$1.rawcontactmanifold_contact_tangent_impulse_y(this.__wbg_ptr,er)}num_solver_contacts(){return wasm$1.rawcontactmanifold_num_solver_contacts(this.__wbg_ptr)>>>0}solver_contact_point(er){const tr=wasm$1.rawcontactmanifold_solver_contact_point(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}solver_contact_dist(er){return wasm$1.rawcontactmanifold_solver_contact_dist(this.__wbg_ptr,er)}solver_contact_friction(er){return wasm$1.rawcontactmanifold_solver_contact_friction(this.__wbg_ptr,er)}solver_contact_restitution(er){return wasm$1.rawcontactmanifold_solver_contact_restitution(this.__wbg_ptr,er)}solver_contact_tangent_velocity(er){const tr=wasm$1.rawcontactmanifold_solver_contact_tangent_velocity(this.__wbg_ptr,er);return RawVector.__wrap(tr)}}const RawContactPairFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawcontactpair_free(rr>>>0));class RawContactPair{static __wrap(er){er=er>>>0;const tr=Object.create(RawContactPair.prototype);return tr.__wbg_ptr=er,RawContactPairFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawContactPairFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawcontactpair_free(er)}collider1(){return wasm$1.rawcontactpair_collider1(this.__wbg_ptr)}collider2(){return wasm$1.rawcontactpair_collider2(this.__wbg_ptr)}numContactManifolds(){return wasm$1.rawcontactpair_numContactManifolds(this.__wbg_ptr)>>>0}contactManifold(er){const tr=wasm$1.rawcontactpair_contactManifold(this.__wbg_ptr,er);return tr===0?void 0:RawContactManifold.__wrap(tr)}}const RawDebugRenderPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawdebugrenderpipeline_free(rr>>>0));class RawDebugRenderPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDebugRenderPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdebugrenderpipeline_free(er)}constructor(){const er=wasm$1.rawdebugrenderpipeline_new();return this.__wbg_ptr=er>>>0,this}vertices(){const er=wasm$1.rawdebugrenderpipeline_vertices(this.__wbg_ptr);return takeObject(er)}colors(){const er=wasm$1.rawdebugrenderpipeline_colors(this.__wbg_ptr);return takeObject(er)}render(er,tr,ir,nr,sr){_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawImpulseJointSet),_assertClass(nr,RawMultibodyJointSet),_assertClass(sr,RawNarrowPhase),wasm$1.rawdebugrenderpipeline_render(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}}const RawDeserializedWorldFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawdeserializedworld_free(rr>>>0));class RawDeserializedWorld{static __wrap(er){er=er>>>0;const tr=Object.create(RawDeserializedWorld.prototype);return tr.__wbg_ptr=er,RawDeserializedWorldFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDeserializedWorldFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdeserializedworld_free(er)}takeGravity(){const er=wasm$1.rawdeserializedworld_takeGravity(this.__wbg_ptr);return er===0?void 0:RawVector.__wrap(er)}takeIntegrationParameters(){const er=wasm$1.rawdeserializedworld_takeIntegrationParameters(this.__wbg_ptr);return er===0?void 0:RawIntegrationParameters.__wrap(er)}takeIslandManager(){const er=wasm$1.rawdeserializedworld_takeIslandManager(this.__wbg_ptr);return er===0?void 0:RawIslandManager.__wrap(er)}takeBroadPhase(){const er=wasm$1.rawdeserializedworld_takeBroadPhase(this.__wbg_ptr);return er===0?void 0:RawBroadPhase.__wrap(er)}takeNarrowPhase(){const er=wasm$1.rawdeserializedworld_takeNarrowPhase(this.__wbg_ptr);return er===0?void 0:RawNarrowPhase.__wrap(er)}takeBodies(){const er=wasm$1.rawdeserializedworld_takeBodies(this.__wbg_ptr);return er===0?void 0:RawRigidBodySet.__wrap(er)}takeColliders(){const er=wasm$1.rawdeserializedworld_takeColliders(this.__wbg_ptr);return er===0?void 0:RawColliderSet.__wrap(er)}takeImpulseJoints(){const er=wasm$1.rawdeserializedworld_takeImpulseJoints(this.__wbg_ptr);return er===0?void 0:RawImpulseJointSet.__wrap(er)}takeMultibodyJoints(){const er=wasm$1.rawdeserializedworld_takeMultibodyJoints(this.__wbg_ptr);return er===0?void 0:RawMultibodyJointSet.__wrap(er)}}const RawDynamicRayCastVehicleControllerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawdynamicraycastvehiclecontroller_free(rr>>>0));class RawDynamicRayCastVehicleController{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawDynamicRayCastVehicleControllerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawdynamicraycastvehiclecontroller_free(er)}constructor(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_new(er);return this.__wbg_ptr=tr>>>0,this}current_vehicle_speed(){return wasm$1.rawdynamicraycastvehiclecontroller_current_vehicle_speed(this.__wbg_ptr)}chassis(){return wasm$1.rawdynamicraycastvehiclecontroller_chassis(this.__wbg_ptr)}index_up_axis(){return wasm$1.rawdynamicraycastvehiclecontroller_index_up_axis(this.__wbg_ptr)>>>0}set_index_up_axis(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_up_axis(this.__wbg_ptr,er)}index_forward_axis(){return wasm$1.rawdynamicraycastvehiclecontroller_index_forward_axis(this.__wbg_ptr)>>>0}set_index_forward_axis(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_forward_axis(this.__wbg_ptr,er)}add_wheel(er,tr,ir,nr,sr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_add_wheel(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr)}num_wheels(){return wasm$1.rawdynamicraycastvehiclecontroller_num_wheels(this.__wbg_ptr)>>>0}update_vehicle(er,tr,ir,nr,sr,ar,or){try{_assertClass(tr,RawRigidBodySet),_assertClass(ir,RawColliderSet),_assertClass(nr,RawQueryPipeline),wasm$1.rawdynamicraycastvehiclecontroller_update_vehicle(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,addBorrowedObject(or))}finally{heap[stack_pointer++]=void 0}}wheel_chassis_connection_point_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_chassis_connection_point_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_suspension_rest_length(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_rest_length(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length(this.__wbg_ptr,er,tr)}wheel_max_suspension_travel(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_max_suspension_travel(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel(this.__wbg_ptr,er,tr)}wheel_radius(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_radius(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_radius(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_radius(this.__wbg_ptr,er,tr)}wheel_suspension_stiffness(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_stiffness(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness(this.__wbg_ptr,er,tr)}wheel_suspension_compression(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_compression(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_compression(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression(this.__wbg_ptr,er,tr)}wheel_suspension_relaxation(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_suspension_relaxation(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation(this.__wbg_ptr,er,tr)}wheel_max_suspension_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_max_suspension_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_max_suspension_force(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force(this.__wbg_ptr,er,tr)}wheel_brake(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_brake(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_brake(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_brake(this.__wbg_ptr,er,tr)}wheel_steering(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_steering(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_steering(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_steering(this.__wbg_ptr,er,tr)}wheel_engine_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_engine_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_engine_force(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_engine_force(this.__wbg_ptr,er,tr)}wheel_direction_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_direction_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_direction_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_direction_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_axle_cs(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_axle_cs(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}set_wheel_axle_cs(er,tr){_assertClass(tr,RawVector),wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_axle_cs(this.__wbg_ptr,er,tr.__wbg_ptr)}wheel_friction_slip(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_friction_slip(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_friction_slip(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_friction_slip(this.__wbg_ptr,er,tr)}wheel_side_friction_stiffness(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}set_wheel_side_friction_stiffness(er,tr){wasm$1.rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness(this.__wbg_ptr,er,tr)}wheel_rotation(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_rotation(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_forward_impulse(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_forward_impulse(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_side_impulse(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_side_impulse(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_suspension_force(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_force(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_contact_normal_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_contact_point_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_contact_point_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_suspension_length(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_suspension_length(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat32Memory0()[nr/4+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}wheel_hard_point_ws(er){const tr=wasm$1.rawdynamicraycastvehiclecontroller_wheel_hard_point_ws(this.__wbg_ptr,er);return tr===0?void 0:RawVector.__wrap(tr)}wheel_is_in_contact(er){return wasm$1.rawdynamicraycastvehiclecontroller_wheel_is_in_contact(this.__wbg_ptr,er)!==0}wheel_ground_object(er){try{const nr=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawdynamicraycastvehiclecontroller_wheel_ground_object(nr,this.__wbg_ptr,er);var tr=getInt32Memory0()[nr/4+0],ir=getFloat64Memory0()[nr/8+1];return tr===0?void 0:ir}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawEventQueueFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_raweventqueue_free(rr>>>0));class RawEventQueue{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawEventQueueFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_raweventqueue_free(er)}constructor(er){const tr=wasm$1.raweventqueue_new(er);return this.__wbg_ptr=tr>>>0,this}drainCollisionEvents(er){try{wasm$1.raweventqueue_drainCollisionEvents(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}drainContactForceEvents(er){try{wasm$1.raweventqueue_drainContactForceEvents(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}clear(){wasm$1.raweventqueue_clear(this.__wbg_ptr)}}const RawGenericJointFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawgenericjoint_free(rr>>>0));class RawGenericJoint{static __wrap(er){er=er>>>0;const tr=Object.create(RawGenericJoint.prototype);return tr.__wbg_ptr=er,RawGenericJointFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawGenericJointFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawgenericjoint_free(er)}static generic(er,tr,ir,nr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector);const sr=wasm$1.rawgenericjoint_generic(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr);return sr===0?void 0:RawGenericJoint.__wrap(sr)}static spring(er,tr,ir,nr,sr){_assertClass(nr,RawVector),_assertClass(sr,RawVector);const ar=wasm$1.rawgenericjoint_spring(er,tr,ir,nr.__wbg_ptr,sr.__wbg_ptr);return RawGenericJoint.__wrap(ar)}static rope(er,tr,ir){_assertClass(tr,RawVector),_assertClass(ir,RawVector);const nr=wasm$1.rawgenericjoint_rope(er,tr.__wbg_ptr,ir.__wbg_ptr);return RawGenericJoint.__wrap(nr)}static spherical(er,tr){_assertClass(er,RawVector),_assertClass(tr,RawVector);const ir=wasm$1.rawgenericjoint_spherical(er.__wbg_ptr,tr.__wbg_ptr);return RawGenericJoint.__wrap(ir)}static prismatic(er,tr,ir,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector);const or=wasm$1.rawgenericjoint_prismatic(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr,ar);return or===0?void 0:RawGenericJoint.__wrap(or)}static fixed(er,tr,ir,nr){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),_assertClass(nr,RawRotation);const sr=wasm$1.rawgenericjoint_fixed(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr);return RawGenericJoint.__wrap(sr)}static revolute(er,tr,ir){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector);const nr=wasm$1.rawgenericjoint_revolute(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr);return nr===0?void 0:RawGenericJoint.__wrap(nr)}}const RawImpulseJointSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawimpulsejointset_free(rr>>>0));class RawImpulseJointSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawImpulseJointSet.prototype);return tr.__wbg_ptr=er,RawImpulseJointSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawImpulseJointSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawimpulsejointset_free(er)}jointType(er){return wasm$1.rawimpulsejointset_jointType(this.__wbg_ptr,er)}jointBodyHandle1(er){return wasm$1.rawimpulsejointset_jointBodyHandle1(this.__wbg_ptr,er)}jointBodyHandle2(er){return wasm$1.rawimpulsejointset_jointBodyHandle2(this.__wbg_ptr,er)}jointFrameX1(er){const tr=wasm$1.rawimpulsejointset_jointFrameX1(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointFrameX2(er){const tr=wasm$1.rawimpulsejointset_jointFrameX2(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointAnchor1(er){const tr=wasm$1.rawimpulsejointset_jointAnchor1(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointAnchor2(er){const tr=wasm$1.rawimpulsejointset_jointAnchor2(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointSetAnchor1(er,tr){_assertClass(tr,RawVector),wasm$1.rawimpulsejointset_jointSetAnchor1(this.__wbg_ptr,er,tr.__wbg_ptr)}jointSetAnchor2(er,tr){_assertClass(tr,RawVector),wasm$1.rawimpulsejointset_jointSetAnchor2(this.__wbg_ptr,er,tr.__wbg_ptr)}jointContactsEnabled(er){return wasm$1.rawimpulsejointset_jointContactsEnabled(this.__wbg_ptr,er)!==0}jointSetContactsEnabled(er,tr){wasm$1.rawimpulsejointset_jointSetContactsEnabled(this.__wbg_ptr,er,tr)}jointLimitsEnabled(er,tr){return wasm$1.rawimpulsejointset_jointLimitsEnabled(this.__wbg_ptr,er,tr)!==0}jointLimitsMin(er,tr){return wasm$1.rawimpulsejointset_jointLimitsMin(this.__wbg_ptr,er,tr)}jointLimitsMax(er,tr){return wasm$1.rawimpulsejointset_jointLimitsMax(this.__wbg_ptr,er,tr)}jointSetLimits(er,tr,ir,nr){wasm$1.rawimpulsejointset_jointSetLimits(this.__wbg_ptr,er,tr,ir,nr)}jointConfigureMotorModel(er,tr,ir){wasm$1.rawimpulsejointset_jointConfigureMotorModel(this.__wbg_ptr,er,tr,ir)}jointConfigureMotorVelocity(er,tr,ir,nr){wasm$1.rawimpulsejointset_jointConfigureMotorVelocity(this.__wbg_ptr,er,tr,ir,nr)}jointConfigureMotorPosition(er,tr,ir,nr,sr){wasm$1.rawimpulsejointset_jointConfigureMotorPosition(this.__wbg_ptr,er,tr,ir,nr,sr)}jointConfigureMotor(er,tr,ir,nr,sr,ar){wasm$1.rawimpulsejointset_jointConfigureMotor(this.__wbg_ptr,er,tr,ir,nr,sr,ar)}constructor(){const er=wasm$1.rawimpulsejointset_new();return this.__wbg_ptr=er>>>0,this}createJoint(er,tr,ir,nr){return _assertClass(er,RawGenericJoint),wasm$1.rawimpulsejointset_createJoint(this.__wbg_ptr,er.__wbg_ptr,tr,ir,nr)}remove(er,tr){wasm$1.rawimpulsejointset_remove(this.__wbg_ptr,er,tr)}len(){return wasm$1.rawimpulsejointset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawimpulsejointset_contains(this.__wbg_ptr,er)!==0}forEachJointHandle(er){try{wasm$1.rawimpulsejointset_forEachJointHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}forEachJointAttachedToRigidBody(er,tr){try{wasm$1.rawimpulsejointset_forEachJointAttachedToRigidBody(this.__wbg_ptr,er,addBorrowedObject(tr))}finally{heap[stack_pointer++]=void 0}}}const RawIntegrationParametersFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawintegrationparameters_free(rr>>>0));class RawIntegrationParameters{static __wrap(er){er=er>>>0;const tr=Object.create(RawIntegrationParameters.prototype);return tr.__wbg_ptr=er,RawIntegrationParametersFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawIntegrationParametersFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawintegrationparameters_free(er)}constructor(){const er=wasm$1.rawintegrationparameters_new();return this.__wbg_ptr=er>>>0,this}get dt(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}get contact_erp(){return wasm$1.rawintegrationparameters_contact_erp(this.__wbg_ptr)}get normalizedAllowedLinearError(){return wasm$1.rawdynamicraycastvehiclecontroller_current_vehicle_speed(this.__wbg_ptr)}get normalizedPredictionDistance(){return wasm$1.rawcontactforceevent_max_force_magnitude(this.__wbg_ptr)}get numSolverIterations(){return wasm$1.rawintegrationparameters_numSolverIterations(this.__wbg_ptr)>>>0}get numAdditionalFrictionIterations(){return wasm$1.rawdynamicraycastvehiclecontroller_index_up_axis(this.__wbg_ptr)>>>0}get numInternalPgsIterations(){return wasm$1.rawdynamicraycastvehiclecontroller_index_forward_axis(this.__wbg_ptr)>>>0}get minIslandSize(){return wasm$1.rawimpulsejointset_len(this.__wbg_ptr)>>>0}get maxCcdSubsteps(){return wasm$1.rawintegrationparameters_maxCcdSubsteps(this.__wbg_ptr)>>>0}get lengthUnit(){return wasm$1.rawintegrationparameters_lengthUnit(this.__wbg_ptr)}set dt(er){wasm$1.rawintegrationparameters_set_dt(this.__wbg_ptr,er)}set contact_natural_frequency(er){wasm$1.rawintegrationparameters_set_contact_natural_frequency(this.__wbg_ptr,er)}set normalizedAllowedLinearError(er){wasm$1.rawintegrationparameters_set_normalizedAllowedLinearError(this.__wbg_ptr,er)}set normalizedPredictionDistance(er){wasm$1.rawintegrationparameters_set_normalizedPredictionDistance(this.__wbg_ptr,er)}set numSolverIterations(er){wasm$1.rawintegrationparameters_set_numSolverIterations(this.__wbg_ptr,er)}set numAdditionalFrictionIterations(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_up_axis(this.__wbg_ptr,er)}set numInternalPgsIterations(er){wasm$1.rawdynamicraycastvehiclecontroller_set_index_forward_axis(this.__wbg_ptr,er)}set minIslandSize(er){wasm$1.rawintegrationparameters_set_minIslandSize(this.__wbg_ptr,er)}set maxCcdSubsteps(er){wasm$1.rawintegrationparameters_set_maxCcdSubsteps(this.__wbg_ptr,er)}set lengthUnit(er){wasm$1.rawintegrationparameters_set_lengthUnit(this.__wbg_ptr,er)}switchToStandardPgsSolver(){wasm$1.rawintegrationparameters_switchToStandardPgsSolver(this.__wbg_ptr)}switchToSmallStepsPgsSolver(){wasm$1.rawintegrationparameters_switchToSmallStepsPgsSolver(this.__wbg_ptr)}switchToSmallStepsPgsSolverWithoutWarmstart(){wasm$1.rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart(this.__wbg_ptr)}}const RawIslandManagerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawislandmanager_free(rr>>>0));class RawIslandManager{static __wrap(er){er=er>>>0;const tr=Object.create(RawIslandManager.prototype);return tr.__wbg_ptr=er,RawIslandManagerFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawIslandManagerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawislandmanager_free(er)}constructor(){const er=wasm$1.rawislandmanager_new();return this.__wbg_ptr=er>>>0,this}forEachActiveRigidBodyHandle(er){try{wasm$1.rawislandmanager_forEachActiveRigidBodyHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}}const RawKinematicCharacterControllerFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawkinematiccharactercontroller_free(rr>>>0));class RawKinematicCharacterController{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawKinematicCharacterControllerFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawkinematiccharactercontroller_free(er)}constructor(er){const tr=wasm$1.rawkinematiccharactercontroller_new(er);return this.__wbg_ptr=tr>>>0,this}up(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}setUp(er){_assertClass(er,RawVector),wasm$1.rawkinematiccharactercontroller_setUp(this.__wbg_ptr,er.__wbg_ptr)}normalNudgeFactor(){return wasm$1.rawkinematiccharactercontroller_normalNudgeFactor(this.__wbg_ptr)}setNormalNudgeFactor(er){wasm$1.rawkinematiccharactercontroller_setNormalNudgeFactor(this.__wbg_ptr,er)}offset(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}setOffset(er){wasm$1.rawkinematiccharactercontroller_setOffset(this.__wbg_ptr,er)}slideEnabled(){return wasm$1.rawkinematiccharactercontroller_slideEnabled(this.__wbg_ptr)!==0}setSlideEnabled(er){wasm$1.rawkinematiccharactercontroller_setSlideEnabled(this.__wbg_ptr,er)}autostepMaxHeight(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_autostepMaxHeight(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getFloat32Memory0()[ir/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}autostepMinWidth(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_autostepMinWidth(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getFloat32Memory0()[ir/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}autostepIncludesDynamicBodies(){const er=wasm$1.rawkinematiccharactercontroller_autostepIncludesDynamicBodies(this.__wbg_ptr);return er===16777215?void 0:er!==0}autostepEnabled(){return wasm$1.rawkinematiccharactercontroller_autostepEnabled(this.__wbg_ptr)!==0}enableAutostep(er,tr,ir){wasm$1.rawkinematiccharactercontroller_enableAutostep(this.__wbg_ptr,er,tr,ir)}disableAutostep(){wasm$1.rawkinematiccharactercontroller_disableAutostep(this.__wbg_ptr)}maxSlopeClimbAngle(){return wasm$1.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}setMaxSlopeClimbAngle(er){wasm$1.rawkinematiccharactercontroller_setMaxSlopeClimbAngle(this.__wbg_ptr,er)}minSlopeSlideAngle(){return wasm$1.rawkinematiccharactercontroller_minSlopeSlideAngle(this.__wbg_ptr)}setMinSlopeSlideAngle(er){wasm$1.rawkinematiccharactercontroller_setMinSlopeSlideAngle(this.__wbg_ptr,er)}snapToGroundDistance(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawkinematiccharactercontroller_snapToGroundDistance(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getFloat32Memory0()[ir/4+1];return er===0?void 0:tr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}enableSnapToGround(er){wasm$1.rawkinematiccharactercontroller_enableSnapToGround(this.__wbg_ptr,er)}disableSnapToGround(){wasm$1.rawkinematiccharactercontroller_disableSnapToGround(this.__wbg_ptr)}snapToGroundEnabled(){return wasm$1.rawkinematiccharactercontroller_snapToGroundEnabled(this.__wbg_ptr)!==0}computeColliderMovement(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){try{_assertClass(tr,RawRigidBodySet),_assertClass(ir,RawColliderSet),_assertClass(nr,RawQueryPipeline),_assertClass(ar,RawVector),wasm$1.rawkinematiccharactercontroller_computeColliderMovement(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar.__wbg_ptr,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,cr,!isLikeNone(ur),isLikeNone(ur)?0:ur,addBorrowedObject(dr))}finally{heap[stack_pointer++]=void 0}}computedMovement(){const er=wasm$1.rawkinematiccharactercontroller_computedMovement(this.__wbg_ptr);return RawVector.__wrap(er)}computedGrounded(){return wasm$1.rawkinematiccharactercontroller_computedGrounded(this.__wbg_ptr)!==0}numComputedCollisions(){return wasm$1.rawkinematiccharactercontroller_numComputedCollisions(this.__wbg_ptr)>>>0}computedCollision(er,tr){return _assertClass(tr,RawCharacterCollision),wasm$1.rawkinematiccharactercontroller_computedCollision(this.__wbg_ptr,er,tr.__wbg_ptr)!==0}}const RawMultibodyJointSetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawmultibodyjointset_free(rr>>>0));class RawMultibodyJointSet{static __wrap(er){er=er>>>0;const tr=Object.create(RawMultibodyJointSet.prototype);return tr.__wbg_ptr=er,RawMultibodyJointSetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawMultibodyJointSetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawmultibodyjointset_free(er)}jointType(er){return wasm$1.rawmultibodyjointset_jointType(this.__wbg_ptr,er)}jointFrameX1(er){const tr=wasm$1.rawmultibodyjointset_jointFrameX1(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointFrameX2(er){const tr=wasm$1.rawmultibodyjointset_jointFrameX2(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}jointAnchor1(er){const tr=wasm$1.rawmultibodyjointset_jointAnchor1(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointAnchor2(er){const tr=wasm$1.rawmultibodyjointset_jointAnchor2(this.__wbg_ptr,er);return RawVector.__wrap(tr)}jointContactsEnabled(er){return wasm$1.rawmultibodyjointset_jointContactsEnabled(this.__wbg_ptr,er)!==0}jointSetContactsEnabled(er,tr){wasm$1.rawmultibodyjointset_jointSetContactsEnabled(this.__wbg_ptr,er,tr)}jointLimitsEnabled(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsEnabled(this.__wbg_ptr,er,tr)!==0}jointLimitsMin(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsMin(this.__wbg_ptr,er,tr)}jointLimitsMax(er,tr){return wasm$1.rawmultibodyjointset_jointLimitsMax(this.__wbg_ptr,er,tr)}constructor(){const er=wasm$1.rawmultibodyjointset_new();return this.__wbg_ptr=er>>>0,this}createJoint(er,tr,ir,nr){return _assertClass(er,RawGenericJoint),wasm$1.rawmultibodyjointset_createJoint(this.__wbg_ptr,er.__wbg_ptr,tr,ir,nr)}remove(er,tr){wasm$1.rawmultibodyjointset_remove(this.__wbg_ptr,er,tr)}contains(er){return wasm$1.rawmultibodyjointset_contains(this.__wbg_ptr,er)!==0}forEachJointHandle(er){try{wasm$1.rawmultibodyjointset_forEachJointHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}forEachJointAttachedToRigidBody(er,tr){try{wasm$1.rawmultibodyjointset_forEachJointAttachedToRigidBody(this.__wbg_ptr,er,addBorrowedObject(tr))}finally{heap[stack_pointer++]=void 0}}}const RawNarrowPhaseFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawnarrowphase_free(rr>>>0));class RawNarrowPhase{static __wrap(er){er=er>>>0;const tr=Object.create(RawNarrowPhase.prototype);return tr.__wbg_ptr=er,RawNarrowPhaseFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawNarrowPhaseFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawnarrowphase_free(er)}constructor(){const er=wasm$1.rawnarrowphase_new();return this.__wbg_ptr=er>>>0,this}contact_pairs_with(er,tr){wasm$1.rawnarrowphase_contact_pairs_with(this.__wbg_ptr,er,addHeapObject(tr))}contact_pair(er,tr){const ir=wasm$1.rawnarrowphase_contact_pair(this.__wbg_ptr,er,tr);return ir===0?void 0:RawContactPair.__wrap(ir)}intersection_pairs_with(er,tr){wasm$1.rawnarrowphase_intersection_pairs_with(this.__wbg_ptr,er,addHeapObject(tr))}intersection_pair(er,tr){return wasm$1.rawnarrowphase_intersection_pair(this.__wbg_ptr,er,tr)!==0}}const RawPhysicsPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawphysicspipeline_free(rr>>>0));class RawPhysicsPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPhysicsPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawphysicspipeline_free(er)}constructor(){const er=wasm$1.rawphysicspipeline_new();return this.__wbg_ptr=er>>>0,this}step(er,tr,ir,nr,sr,ar,or,lr,cr,ur){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(ir,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet),_assertClass(ur,RawCCDSolver),wasm$1.rawphysicspipeline_step(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,ur.__wbg_ptr)}stepWithEvents(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(ir,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet),_assertClass(ur,RawCCDSolver),_assertClass(dr,RawEventQueue),wasm$1.rawphysicspipeline_stepWithEvents(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,ur.__wbg_ptr,dr.__wbg_ptr,addHeapObject(hr),addHeapObject(pr),addHeapObject(gr))}}const RawPointColliderProjectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawpointcolliderprojection_free(rr>>>0));class RawPointColliderProjection{static __wrap(er){er=er>>>0;const tr=Object.create(RawPointColliderProjection.prototype);return tr.__wbg_ptr=er,RawPointColliderProjectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPointColliderProjectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawpointcolliderprojection_free(er)}colliderHandle(){return wasm$1.rawpointcolliderprojection_colliderHandle(this.__wbg_ptr)}point(){const er=wasm$1.rawpointcolliderprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}isInside(){return wasm$1.rawpointcolliderprojection_isInside(this.__wbg_ptr)!==0}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getInt32Memory0()[ir/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawPointProjectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawpointprojection_free(rr>>>0));class RawPointProjection{static __wrap(er){er=er>>>0;const tr=Object.create(RawPointProjection.prototype);return tr.__wbg_ptr=er,RawPointProjectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawPointProjectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawpointprojection_free(er)}point(){const er=wasm$1.rawpointprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}isInside(){return wasm$1.rawpointprojection_isInside(this.__wbg_ptr)!==0}}const RawQueryPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawquerypipeline_free(rr>>>0));class RawQueryPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawQueryPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawquerypipeline_free(er)}constructor(){const er=wasm$1.rawquerypipeline_new();return this.__wbg_ptr=er>>>0,this}update(er){_assertClass(er,RawColliderSet),wasm$1.rawquerypipeline_update(this.__wbg_ptr,er.__wbg_ptr)}castRay(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawVector);const hr=wasm$1.rawquerypipeline_castRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(ur),isLikeNone(ur)?0:ur,addBorrowedObject(dr));return hr===0?void 0:RawRayColliderHit.__wrap(hr)}finally{heap[stack_pointer++]=void 0}}castRayAndGetNormal(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawVector);const hr=wasm$1.rawquerypipeline_castRayAndGetNormal(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar,or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(ur),isLikeNone(ur)?0:ur,addBorrowedObject(dr));return hr===0?void 0:RawRayColliderIntersection.__wrap(hr)}finally{heap[stack_pointer++]=void 0}}intersectionsWithRay(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawVector),wasm$1.rawquerypipeline_intersectionsWithRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar,addBorrowedObject(or),lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(ur),isLikeNone(ur)?0:ur,!isLikeNone(dr),isLikeNone(dr)?0:dr,addBorrowedObject(hr))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}intersectionWithShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur){try{const pr=wasm$1.__wbindgen_add_to_stack_pointer(-16);_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawShape),wasm$1.rawquerypipeline_intersectionWithShape(pr,this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,addBorrowedObject(ur));var dr=getInt32Memory0()[pr/4+0],hr=getFloat64Memory0()[pr/8+1];return dr===0?void 0:hr}finally{wasm$1.__wbindgen_add_to_stack_pointer(16),heap[stack_pointer++]=void 0}}projectPoint(er,tr,ir,nr,sr,ar,or,lr,cr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector);const ur=wasm$1.rawquerypipeline_projectPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,addBorrowedObject(cr));return ur===0?void 0:RawPointColliderProjection.__wrap(ur)}finally{heap[stack_pointer++]=void 0}}projectPointAndGetFeature(er,tr,ir,nr,sr,ar,or,lr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector);const cr=wasm$1.rawquerypipeline_projectPointAndGetFeature(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr,!isLikeNone(sr),isLikeNone(sr)?0:sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,addBorrowedObject(lr));return cr===0?void 0:RawPointColliderProjection.__wrap(cr)}finally{heap[stack_pointer++]=void 0}}intersectionsWithPoint(er,tr,ir,nr,sr,ar,or,lr,cr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),wasm$1.rawquerypipeline_intersectionsWithPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,addBorrowedObject(nr),sr,!isLikeNone(ar),isLikeNone(ar)?0:ar,!isLikeNone(or),isLikeNone(or)?0:or,!isLikeNone(lr),isLikeNone(lr)?0:lr,addBorrowedObject(cr))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}castShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawVector),_assertClass(ar,RawShape);const vr=wasm$1.rawquerypipeline_castShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or,lr,cr,ur,!isLikeNone(dr),isLikeNone(dr)?0:dr,!isLikeNone(hr),isLikeNone(hr)?0:hr,!isLikeNone(pr),isLikeNone(pr)?0:pr,addBorrowedObject(gr));return vr===0?void 0:RawColliderShapeCastHit.__wrap(vr)}finally{heap[stack_pointer++]=void 0}}intersectionsWithShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){try{_assertClass(er,RawRigidBodySet),_assertClass(tr,RawColliderSet),_assertClass(ir,RawVector),_assertClass(nr,RawRotation),_assertClass(sr,RawShape),wasm$1.rawquerypipeline_intersectionsWithShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,addBorrowedObject(ar),or,!isLikeNone(lr),isLikeNone(lr)?0:lr,!isLikeNone(cr),isLikeNone(cr)?0:cr,!isLikeNone(ur),isLikeNone(ur)?0:ur,addBorrowedObject(dr))}finally{heap[stack_pointer++]=void 0,heap[stack_pointer++]=void 0}}collidersWithAabbIntersectingAabb(er,tr,ir){try{_assertClass(er,RawVector),_assertClass(tr,RawVector),wasm$1.rawquerypipeline_collidersWithAabbIntersectingAabb(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,addBorrowedObject(ir))}finally{heap[stack_pointer++]=void 0}}}const RawRayColliderHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawraycolliderhit_free(rr>>>0));class RawRayColliderHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayColliderHit.prototype);return tr.__wbg_ptr=er,RawRayColliderHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayColliderHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawraycolliderhit_free(er)}colliderHandle(){return wasm$1.rawcharactercollision_handle(this.__wbg_ptr)}timeOfImpact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}}const RawRayColliderIntersectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawraycolliderintersection_free(rr>>>0));class RawRayColliderIntersection{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayColliderIntersection.prototype);return tr.__wbg_ptr=er,RawRayColliderIntersectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayColliderIntersectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawraycolliderintersection_free(er)}colliderHandle(){return wasm$1.rawpointcolliderprojection_colliderHandle(this.__wbg_ptr)}normal(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getInt32Memory0()[ir/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawRayIntersectionFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawrayintersection_free(rr>>>0));class RawRayIntersection{static __wrap(er){er=er>>>0;const tr=Object.create(RawRayIntersection.prototype);return tr.__wbg_ptr=er,RawRayIntersectionFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRayIntersectionFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrayintersection_free(er)}normal(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}time_of_impact(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}featureType(){return wasm$1.rawpointcolliderprojection_featureType(this.__wbg_ptr)}featureId(){try{const ir=wasm$1.__wbindgen_add_to_stack_pointer(-16);wasm$1.rawpointcolliderprojection_featureId(ir,this.__wbg_ptr);var er=getInt32Memory0()[ir/4+0],tr=getInt32Memory0()[ir/4+1];return er===0?void 0:tr>>>0}finally{wasm$1.__wbindgen_add_to_stack_pointer(16)}}}const RawRigidBodySetFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawrigidbodyset_free(rr>>>0));class RawRigidBodySet{static __wrap(er){er=er>>>0;const tr=Object.create(RawRigidBodySet.prototype);return tr.__wbg_ptr=er,RawRigidBodySetFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRigidBodySetFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrigidbodyset_free(er)}rbTranslation(er){const tr=wasm$1.rawrigidbodyset_rbTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbRotation(er){const tr=wasm$1.rawrigidbodyset_rbRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbSleep(er){wasm$1.rawrigidbodyset_rbSleep(this.__wbg_ptr,er)}rbIsSleeping(er){return wasm$1.rawrigidbodyset_rbIsSleeping(this.__wbg_ptr,er)!==0}rbIsMoving(er){return wasm$1.rawrigidbodyset_rbIsMoving(this.__wbg_ptr,er)!==0}rbNextTranslation(er){const tr=wasm$1.rawrigidbodyset_rbNextTranslation(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbNextRotation(er){const tr=wasm$1.rawrigidbodyset_rbNextRotation(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbSetTranslation(er,tr,ir,nr,sr){wasm$1.rawrigidbodyset_rbSetTranslation(this.__wbg_ptr,er,tr,ir,nr,sr)}rbSetRotation(er,tr,ir,nr,sr,ar){wasm$1.rawrigidbodyset_rbSetRotation(this.__wbg_ptr,er,tr,ir,nr,sr,ar)}rbSetLinvel(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbSetLinvel(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbSetAngvel(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbSetAngvel(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbSetNextKinematicTranslation(er,tr,ir,nr){wasm$1.rawrigidbodyset_rbSetNextKinematicTranslation(this.__wbg_ptr,er,tr,ir,nr)}rbSetNextKinematicRotation(er,tr,ir,nr,sr){wasm$1.rawrigidbodyset_rbSetNextKinematicRotation(this.__wbg_ptr,er,tr,ir,nr,sr)}rbRecomputeMassPropertiesFromColliders(er,tr){_assertClass(tr,RawColliderSet),wasm$1.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders(this.__wbg_ptr,er,tr.__wbg_ptr)}rbSetAdditionalMass(er,tr,ir){wasm$1.rawrigidbodyset_rbSetAdditionalMass(this.__wbg_ptr,er,tr,ir)}rbSetAdditionalMassProperties(er,tr,ir,nr,sr,ar){_assertClass(ir,RawVector),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawrigidbodyset_rbSetAdditionalMassProperties(this.__wbg_ptr,er,tr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar)}rbLinvel(er){const tr=wasm$1.rawrigidbodyset_rbLinvel(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbAngvel(er){const tr=wasm$1.rawrigidbodyset_rbAngvel(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbLockTranslations(er,tr,ir){wasm$1.rawrigidbodyset_rbLockTranslations(this.__wbg_ptr,er,tr,ir)}rbSetEnabledTranslations(er,tr,ir,nr,sr){wasm$1.rawrigidbodyset_rbSetEnabledTranslations(this.__wbg_ptr,er,tr,ir,nr,sr)}rbLockRotations(er,tr,ir){wasm$1.rawrigidbodyset_rbLockRotations(this.__wbg_ptr,er,tr,ir)}rbSetEnabledRotations(er,tr,ir,nr,sr){wasm$1.rawrigidbodyset_rbSetEnabledRotations(this.__wbg_ptr,er,tr,ir,nr,sr)}rbDominanceGroup(er){return wasm$1.rawrigidbodyset_rbDominanceGroup(this.__wbg_ptr,er)}rbSetDominanceGroup(er,tr){wasm$1.rawrigidbodyset_rbSetDominanceGroup(this.__wbg_ptr,er,tr)}rbEnableCcd(er,tr){wasm$1.rawrigidbodyset_rbEnableCcd(this.__wbg_ptr,er,tr)}rbSetSoftCcdPrediction(er,tr){wasm$1.rawrigidbodyset_rbSetSoftCcdPrediction(this.__wbg_ptr,er,tr)}rbMass(er){return wasm$1.rawrigidbodyset_rbMass(this.__wbg_ptr,er)}rbInvMass(er){return wasm$1.rawrigidbodyset_rbInvMass(this.__wbg_ptr,er)}rbEffectiveInvMass(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveInvMass(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbLocalCom(er){const tr=wasm$1.rawrigidbodyset_rbLocalCom(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbWorldCom(er){const tr=wasm$1.rawrigidbodyset_rbWorldCom(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbInvPrincipalInertiaSqrt(er){const tr=wasm$1.rawrigidbodyset_rbInvPrincipalInertiaSqrt(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbPrincipalInertiaLocalFrame(er){const tr=wasm$1.rawrigidbodyset_rbPrincipalInertiaLocalFrame(this.__wbg_ptr,er);return RawRotation.__wrap(tr)}rbPrincipalInertia(er){const tr=wasm$1.rawrigidbodyset_rbPrincipalInertia(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbEffectiveWorldInvInertiaSqrt(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt(this.__wbg_ptr,er);return RawSdpMatrix3.__wrap(tr)}rbEffectiveAngularInertia(er){const tr=wasm$1.rawrigidbodyset_rbEffectiveAngularInertia(this.__wbg_ptr,er);return RawSdpMatrix3.__wrap(tr)}rbWakeUp(er){wasm$1.rawrigidbodyset_rbWakeUp(this.__wbg_ptr,er)}rbIsCcdEnabled(er){return wasm$1.rawrigidbodyset_rbIsCcdEnabled(this.__wbg_ptr,er)!==0}rbSoftCcdPrediction(er){return wasm$1.rawrigidbodyset_rbSoftCcdPrediction(this.__wbg_ptr,er)}rbNumColliders(er){return wasm$1.rawrigidbodyset_rbNumColliders(this.__wbg_ptr,er)>>>0}rbCollider(er,tr){return wasm$1.rawrigidbodyset_rbCollider(this.__wbg_ptr,er,tr)}rbBodyType(er){return wasm$1.rawrigidbodyset_rbBodyType(this.__wbg_ptr,er)}rbSetBodyType(er,tr,ir){wasm$1.rawrigidbodyset_rbSetBodyType(this.__wbg_ptr,er,tr,ir)}rbIsFixed(er){return wasm$1.rawrigidbodyset_rbIsFixed(this.__wbg_ptr,er)!==0}rbIsKinematic(er){return wasm$1.rawrigidbodyset_rbIsKinematic(this.__wbg_ptr,er)!==0}rbIsDynamic(er){return wasm$1.rawrigidbodyset_rbIsDynamic(this.__wbg_ptr,er)!==0}rbLinearDamping(er){return wasm$1.rawrigidbodyset_rbLinearDamping(this.__wbg_ptr,er)}rbAngularDamping(er){return wasm$1.rawrigidbodyset_rbAngularDamping(this.__wbg_ptr,er)}rbSetLinearDamping(er,tr){wasm$1.rawrigidbodyset_rbSetLinearDamping(this.__wbg_ptr,er,tr)}rbSetAngularDamping(er,tr){wasm$1.rawrigidbodyset_rbSetAngularDamping(this.__wbg_ptr,er,tr)}rbSetEnabled(er,tr){wasm$1.rawrigidbodyset_rbSetEnabled(this.__wbg_ptr,er,tr)}rbIsEnabled(er){return wasm$1.rawrigidbodyset_rbIsEnabled(this.__wbg_ptr,er)!==0}rbGravityScale(er){return wasm$1.rawrigidbodyset_rbGravityScale(this.__wbg_ptr,er)}rbSetGravityScale(er,tr,ir){wasm$1.rawrigidbodyset_rbSetGravityScale(this.__wbg_ptr,er,tr,ir)}rbResetForces(er,tr){wasm$1.rawrigidbodyset_rbResetForces(this.__wbg_ptr,er,tr)}rbResetTorques(er,tr){wasm$1.rawrigidbodyset_rbResetTorques(this.__wbg_ptr,er,tr)}rbAddForce(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbAddForce(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbApplyImpulse(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbApplyImpulse(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbAddTorque(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbAddTorque(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbApplyTorqueImpulse(er,tr,ir){_assertClass(tr,RawVector),wasm$1.rawrigidbodyset_rbApplyTorqueImpulse(this.__wbg_ptr,er,tr.__wbg_ptr,ir)}rbAddForceAtPoint(er,tr,ir,nr){_assertClass(tr,RawVector),_assertClass(ir,RawVector),wasm$1.rawrigidbodyset_rbAddForceAtPoint(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr)}rbApplyImpulseAtPoint(er,tr,ir,nr){_assertClass(tr,RawVector),_assertClass(ir,RawVector),wasm$1.rawrigidbodyset_rbApplyImpulseAtPoint(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr)}rbAdditionalSolverIterations(er){return wasm$1.rawrigidbodyset_rbAdditionalSolverIterations(this.__wbg_ptr,er)>>>0}rbSetAdditionalSolverIterations(er,tr){wasm$1.rawrigidbodyset_rbSetAdditionalSolverIterations(this.__wbg_ptr,er,tr)}rbUserData(er){return wasm$1.rawrigidbodyset_rbUserData(this.__wbg_ptr,er)>>>0}rbSetUserData(er,tr){wasm$1.rawrigidbodyset_rbSetUserData(this.__wbg_ptr,er,tr)}rbUserForce(er){const tr=wasm$1.rawrigidbodyset_rbUserForce(this.__wbg_ptr,er);return RawVector.__wrap(tr)}rbUserTorque(er){const tr=wasm$1.rawrigidbodyset_rbUserTorque(this.__wbg_ptr,er);return RawVector.__wrap(tr)}constructor(){const er=wasm$1.rawrigidbodyset_new();return this.__wbg_ptr=er>>>0,this}createRigidBody(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr,Ir){return _assertClass(tr,RawVector),_assertClass(ir,RawRotation),_assertClass(or,RawVector),_assertClass(lr,RawVector),_assertClass(cr,RawVector),_assertClass(ur,RawVector),_assertClass(dr,RawRotation),wasm$1.rawrigidbodyset_createRigidBody(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr,sr,ar,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr,ur.__wbg_ptr,dr.__wbg_ptr,hr,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr,Ir)}remove(er,tr,ir,nr,sr){_assertClass(tr,RawIslandManager),_assertClass(ir,RawColliderSet),_assertClass(nr,RawImpulseJointSet),_assertClass(sr,RawMultibodyJointSet),wasm$1.rawrigidbodyset_remove(this.__wbg_ptr,er,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)}len(){return wasm$1.rawcolliderset_len(this.__wbg_ptr)>>>0}contains(er){return wasm$1.rawrigidbodyset_contains(this.__wbg_ptr,er)!==0}forEachRigidBodyHandle(er){try{wasm$1.rawrigidbodyset_forEachRigidBodyHandle(this.__wbg_ptr,addBorrowedObject(er))}finally{heap[stack_pointer++]=void 0}}propagateModifiedBodyPositionsToColliders(er){_assertClass(er,RawColliderSet),wasm$1.rawrigidbodyset_propagateModifiedBodyPositionsToColliders(this.__wbg_ptr,er.__wbg_ptr)}}const RawRotationFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawrotation_free(rr>>>0));class RawRotation{static __wrap(er){er=er>>>0;const tr=Object.create(RawRotation.prototype);return tr.__wbg_ptr=er,RawRotationFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawRotationFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawrotation_free(er)}constructor(er,tr,ir,nr){const sr=wasm$1.rawrotation_new(er,tr,ir,nr);return this.__wbg_ptr=sr>>>0,this}static identity(){const er=wasm$1.rawrotation_identity();return RawRotation.__wrap(er)}get x(){return wasm$1.rawrotation_x(this.__wbg_ptr)}get y(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}get z(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}get w(){return wasm$1.rawrotation_w(this.__wbg_ptr)}}const RawSdpMatrix3Finalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawsdpmatrix3_free(rr>>>0));class RawSdpMatrix3{static __wrap(er){er=er>>>0;const tr=Object.create(RawSdpMatrix3.prototype);return tr.__wbg_ptr=er,RawSdpMatrix3Finalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawSdpMatrix3Finalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawsdpmatrix3_free(er)}elements(){const er=wasm$1.rawsdpmatrix3_elements(this.__wbg_ptr);return takeObject(er)}}const RawSerializationPipelineFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawserializationpipeline_free(rr>>>0));class RawSerializationPipeline{__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawSerializationPipelineFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawserializationpipeline_free(er)}constructor(){const er=wasm$1.rawserializationpipeline_new();return this.__wbg_ptr=er>>>0,this}serializeAll(er,tr,ir,nr,sr,ar,or,lr,cr){_assertClass(er,RawVector),_assertClass(tr,RawIntegrationParameters),_assertClass(ir,RawIslandManager),_assertClass(nr,RawBroadPhase),_assertClass(sr,RawNarrowPhase),_assertClass(ar,RawRigidBodySet),_assertClass(or,RawColliderSet),_assertClass(lr,RawImpulseJointSet),_assertClass(cr,RawMultibodyJointSet);const ur=wasm$1.rawserializationpipeline_serializeAll(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr.__wbg_ptr,cr.__wbg_ptr);return takeObject(ur)}deserializeAll(er){const tr=wasm$1.rawserializationpipeline_deserializeAll(this.__wbg_ptr,addHeapObject(er));return tr===0?void 0:RawDeserializedWorld.__wrap(tr)}}const RawShapeFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawshape_free(rr>>>0));class RawShape{static __wrap(er){er=er>>>0;const tr=Object.create(RawShape.prototype);return tr.__wbg_ptr=er,RawShapeFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshape_free(er)}static cuboid(er,tr,ir){const nr=wasm$1.rawshape_cuboid(er,tr,ir);return RawShape.__wrap(nr)}static roundCuboid(er,tr,ir,nr){const sr=wasm$1.rawshape_roundCuboid(er,tr,ir,nr);return RawShape.__wrap(sr)}static ball(er){const tr=wasm$1.rawshape_ball(er);return RawShape.__wrap(tr)}static halfspace(er){_assertClass(er,RawVector);const tr=wasm$1.rawshape_halfspace(er.__wbg_ptr);return RawShape.__wrap(tr)}static capsule(er,tr){const ir=wasm$1.rawshape_capsule(er,tr);return RawShape.__wrap(ir)}static cylinder(er,tr){const ir=wasm$1.rawshape_cylinder(er,tr);return RawShape.__wrap(ir)}static roundCylinder(er,tr,ir){const nr=wasm$1.rawshape_roundCylinder(er,tr,ir);return RawShape.__wrap(nr)}static cone(er,tr){const ir=wasm$1.rawshape_cone(er,tr);return RawShape.__wrap(ir)}static roundCone(er,tr,ir){const nr=wasm$1.rawshape_roundCone(er,tr,ir);return RawShape.__wrap(nr)}static polyline(er,tr){const ir=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),ar=WASM_VECTOR_LEN,or=wasm$1.rawshape_polyline(ir,nr,sr,ar);return RawShape.__wrap(or)}static trimesh(er,tr,ir){const nr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),sr=WASM_VECTOR_LEN,ar=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN,lr=wasm$1.rawshape_trimesh(nr,sr,ar,or,ir);return RawShape.__wrap(lr)}static heightfield(er,tr,ir,nr,sr){const ar=passArrayF32ToWasm0(ir,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN;_assertClass(nr,RawVector);const lr=wasm$1.rawshape_heightfield(er,tr,ar,or,nr.__wbg_ptr,sr);return RawShape.__wrap(lr)}static segment(er,tr){_assertClass(er,RawVector),_assertClass(tr,RawVector);const ir=wasm$1.rawshape_segment(er.__wbg_ptr,tr.__wbg_ptr);return RawShape.__wrap(ir)}static triangle(er,tr,ir){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector);const nr=wasm$1.rawshape_triangle(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr);return RawShape.__wrap(nr)}static roundTriangle(er,tr,ir,nr){_assertClass(er,RawVector),_assertClass(tr,RawVector),_assertClass(ir,RawVector);const sr=wasm$1.rawshape_roundTriangle(er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr);return RawShape.__wrap(sr)}static convexHull(er){const tr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),ir=WASM_VECTOR_LEN,nr=wasm$1.rawshape_convexHull(tr,ir);return nr===0?void 0:RawShape.__wrap(nr)}static roundConvexHull(er,tr){const ir=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=wasm$1.rawshape_roundConvexHull(ir,nr,tr);return sr===0?void 0:RawShape.__wrap(sr)}static convexMesh(er,tr){const ir=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),nr=WASM_VECTOR_LEN,sr=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),ar=WASM_VECTOR_LEN,or=wasm$1.rawshape_convexMesh(ir,nr,sr,ar);return or===0?void 0:RawShape.__wrap(or)}static roundConvexMesh(er,tr,ir){const nr=passArrayF32ToWasm0(er,wasm$1.__wbindgen_malloc),sr=WASM_VECTOR_LEN,ar=passArray32ToWasm0(tr,wasm$1.__wbindgen_malloc),or=WASM_VECTOR_LEN,lr=wasm$1.rawshape_roundConvexMesh(nr,sr,ar,or,ir);return lr===0?void 0:RawShape.__wrap(lr)}castShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),_assertClass(nr,RawShape),_assertClass(sr,RawVector),_assertClass(ar,RawRotation),_assertClass(or,RawVector);const dr=wasm$1.rawshape_castShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar.__wbg_ptr,or.__wbg_ptr,lr,cr,ur);return dr===0?void 0:RawShapeCastHit.__wrap(dr)}intersectsShape(er,tr,ir,nr,sr){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation),wasm$1.rawshape_intersectsShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr)!==0}contactShape(er,tr,ir,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawShape),_assertClass(nr,RawVector),_assertClass(sr,RawRotation);const or=wasm$1.rawshape_contactShape(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr.__wbg_ptr,ar);return or===0?void 0:RawShapeContact.__wrap(or)}containsPoint(er,tr,ir){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),wasm$1.rawshape_containsPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr)!==0}projectPoint(er,tr,ir,nr){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector);const sr=wasm$1.rawshape_projectPoint(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr);return RawPointProjection.__wrap(sr)}intersectsRay(er,tr,ir,nr,sr){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),_assertClass(nr,RawVector),wasm$1.rawshape_intersectsRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr)!==0}castRay(er,tr,ir,nr,sr,ar){return _assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),_assertClass(nr,RawVector),wasm$1.rawshape_castRay(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar)}castRayAndGetNormal(er,tr,ir,nr,sr,ar){_assertClass(er,RawVector),_assertClass(tr,RawRotation),_assertClass(ir,RawVector),_assertClass(nr,RawVector);const or=wasm$1.rawshape_castRayAndGetNormal(this.__wbg_ptr,er.__wbg_ptr,tr.__wbg_ptr,ir.__wbg_ptr,nr.__wbg_ptr,sr,ar);return or===0?void 0:RawRayIntersection.__wrap(or)}}const RawShapeCastHitFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawshapecasthit_free(rr>>>0));class RawShapeCastHit{static __wrap(er){er=er>>>0;const tr=Object.create(RawShapeCastHit.prototype);return tr.__wbg_ptr=er,RawShapeCastHitFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeCastHitFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshapecasthit_free(er)}time_of_impact(){return wasm$1.rawrotation_x(this.__wbg_ptr)}witness1(){const er=wasm$1.rawshapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}witness2(){const er=wasm$1.rawcontactforceevent_total_force(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawshapecasthit_normal1(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawshapecasthit_normal2(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawShapeContactFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawshapecontact_free(rr>>>0));class RawShapeContact{static __wrap(er){er=er>>>0;const tr=Object.create(RawShapeContact.prototype);return tr.__wbg_ptr=er,RawShapeContactFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawShapeContactFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawshapecontact_free(er)}distance(){return wasm$1.rawkinematiccharactercontroller_maxSlopeClimbAngle(this.__wbg_ptr)}point1(){const er=wasm$1.rawpointprojection_point(this.__wbg_ptr);return RawVector.__wrap(er)}point2(){const er=wasm$1.rawcollidershapecasthit_witness1(this.__wbg_ptr);return RawVector.__wrap(er)}normal1(){const er=wasm$1.rawcollidershapecasthit_witness2(this.__wbg_ptr);return RawVector.__wrap(er)}normal2(){const er=wasm$1.rawcharactercollision_translationDeltaApplied(this.__wbg_ptr);return RawVector.__wrap(er)}}const RawVectorFinalization=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(rr=>wasm$1.__wbg_rawvector_free(rr>>>0));class RawVector{static __wrap(er){er=er>>>0;const tr=Object.create(RawVector.prototype);return tr.__wbg_ptr=er,RawVectorFinalization.register(tr,tr.__wbg_ptr,tr),tr}__destroy_into_raw(){const er=this.__wbg_ptr;return this.__wbg_ptr=0,RawVectorFinalization.unregister(this),er}free(){const er=this.__destroy_into_raw();wasm$1.__wbg_rawvector_free(er)}static zero(){const er=wasm$1.rawvector_zero();return RawVector.__wrap(er)}constructor(er,tr,ir){const nr=wasm$1.rawvector_new(er,tr,ir);return this.__wbg_ptr=nr>>>0,this}get x(){return wasm$1.rawrotation_x(this.__wbg_ptr)}set x(er){wasm$1.rawvector_set_x(this.__wbg_ptr,er)}get y(){return wasm$1.rawintegrationparameters_dt(this.__wbg_ptr)}set y(er){wasm$1.rawintegrationparameters_set_dt(this.__wbg_ptr,er)}get z(){return wasm$1.rawcollidershapecasthit_time_of_impact(this.__wbg_ptr)}set z(er){wasm$1.rawvector_set_z(this.__wbg_ptr,er)}xyz(){const er=wasm$1.rawvector_xyz(this.__wbg_ptr);return RawVector.__wrap(er)}yxz(){const er=wasm$1.rawvector_yxz(this.__wbg_ptr);return RawVector.__wrap(er)}zxy(){const er=wasm$1.rawvector_zxy(this.__wbg_ptr);return RawVector.__wrap(er)}xzy(){const er=wasm$1.rawvector_xzy(this.__wbg_ptr);return RawVector.__wrap(er)}yzx(){const er=wasm$1.rawvector_yzx(this.__wbg_ptr);return RawVector.__wrap(er)}zyx(){const er=wasm$1.rawvector_zyx(this.__wbg_ptr);return RawVector.__wrap(er)}}function __wbindgen_number_new(rr){return addHeapObject(rr)}function __wbindgen_boolean_get(rr){const er=getObject(rr);return typeof er=="boolean"?er?1:0:2}function __wbindgen_object_drop_ref(rr){takeObject(rr)}function __wbindgen_number_get(rr,er){const tr=getObject(er),ir=typeof tr=="number"?tr:void 0;getFloat64Memory0()[rr/8+1]=isLikeNone(ir)?0:ir,getInt32Memory0()[rr/4+0]=!isLikeNone(ir)}function __wbindgen_is_function(rr){return typeof getObject(rr)=="function"}function __wbg_rawraycolliderintersection_new(rr){const er=RawRayColliderIntersection.__wrap(rr);return addHeapObject(er)}function __wbg_rawcontactforceevent_new(rr){const er=RawContactForceEvent.__wrap(rr);return addHeapObject(er)}function __wbg_call_b3ca7c6051f9bec1(){return handleError(function(rr,er,tr){const ir=getObject(rr).call(getObject(er),getObject(tr));return addHeapObject(ir)},arguments)}function __wbg_call_8e7cb608789c2528(){return handleError(function(rr,er,tr,ir){const nr=getObject(rr).call(getObject(er),getObject(tr),getObject(ir));return addHeapObject(nr)},arguments)}function __wbg_call_938992c832f74314(){return handleError(function(rr,er,tr,ir,nr){const sr=getObject(rr).call(getObject(er),getObject(tr),getObject(ir),getObject(nr));return addHeapObject(sr)},arguments)}function __wbg_bind_4d857b598695205e(rr,er,tr,ir){const nr=getObject(rr).bind(getObject(er),getObject(tr),getObject(ir));return addHeapObject(nr)}function __wbg_buffer_12d079cc21e14bdb(rr){const er=getObject(rr).buffer;return addHeapObject(er)}function __wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb(rr,er,tr){const ir=new Uint8Array(getObject(rr),er>>>0,tr>>>0);return addHeapObject(ir)}function __wbg_new_63b92bc8671ed464(rr){const er=new Uint8Array(getObject(rr));return addHeapObject(er)}function __wbg_set_a47bac70306a19a7(rr,er,tr){getObject(rr).set(getObject(er),tr>>>0)}function __wbg_length_c20a40f15020d68a(rr){return getObject(rr).length}function __wbg_newwithbyteoffsetandlength_4a659d079a1650e0(rr,er,tr){const ir=new Float32Array(getObject(rr),er>>>0,tr>>>0);return addHeapObject(ir)}function __wbg_set_bd975934d1b1fddb(rr,er,tr){getObject(rr).set(getObject(er),tr>>>0)}function __wbg_length_d25bbcbc3367f684(rr){return getObject(rr).length}function __wbg_newwithlength_1e8b839a06de01c5(rr){const er=new Float32Array(rr>>>0);return addHeapObject(er)}function __wbindgen_throw(rr,er){throw new Error(getStringFromWasm0(rr,er))}function __wbindgen_memory(){const rr=wasm$1.memory;return addHeapObject(rr)}URL=globalThis.URL;const __vite__wasmModule=await __vite__initWasm({"./rapier_wasm3d_bg.js":{__wbindgen_number_new,__wbindgen_boolean_get,__wbindgen_object_drop_ref,__wbindgen_number_get,__wbindgen_is_function,__wbg_rawraycolliderintersection_new,__wbg_rawcontactforceevent_new,__wbg_call_b3ca7c6051f9bec1,__wbg_call_8e7cb608789c2528,__wbg_call_938992c832f74314,__wbg_bind_4d857b598695205e,__wbg_buffer_12d079cc21e14bdb,__wbg_newwithbyteoffsetandlength_aa4a17c33a06e5cb,__wbg_new_63b92bc8671ed464,__wbg_set_a47bac70306a19a7,__wbg_length_c20a40f15020d68a,__wbg_newwithbyteoffsetandlength_4a659d079a1650e0,__wbg_set_bd975934d1b1fddb,__wbg_length_d25bbcbc3367f684,__wbg_newwithlength_1e8b839a06de01c5,__wbindgen_throw,__wbindgen_memory}},__vite__wasmUrl),memory=__vite__wasmModule.memory,version$2=__vite__wasmModule.version,__wbg_rawkinematiccharactercontroller_free=__vite__wasmModule.__wbg_rawkinematiccharactercontroller_free,rawkinematiccharactercontroller_new=__vite__wasmModule.rawkinematiccharactercontroller_new,rawkinematiccharactercontroller_setUp=__vite__wasmModule.rawkinematiccharactercontroller_setUp,rawkinematiccharactercontroller_normalNudgeFactor=__vite__wasmModule.rawkinematiccharactercontroller_normalNudgeFactor,rawkinematiccharactercontroller_setNormalNudgeFactor=__vite__wasmModule.rawkinematiccharactercontroller_setNormalNudgeFactor,rawkinematiccharactercontroller_setOffset=__vite__wasmModule.rawkinematiccharactercontroller_setOffset,rawkinematiccharactercontroller_slideEnabled=__vite__wasmModule.rawkinematiccharactercontroller_slideEnabled,rawkinematiccharactercontroller_setSlideEnabled=__vite__wasmModule.rawkinematiccharactercontroller_setSlideEnabled,rawkinematiccharactercontroller_autostepMaxHeight=__vite__wasmModule.rawkinematiccharactercontroller_autostepMaxHeight,rawkinematiccharactercontroller_autostepMinWidth=__vite__wasmModule.rawkinematiccharactercontroller_autostepMinWidth,rawkinematiccharactercontroller_autostepIncludesDynamicBodies=__vite__wasmModule.rawkinematiccharactercontroller_autostepIncludesDynamicBodies,rawkinematiccharactercontroller_autostepEnabled=__vite__wasmModule.rawkinematiccharactercontroller_autostepEnabled,rawkinematiccharactercontroller_enableAutostep=__vite__wasmModule.rawkinematiccharactercontroller_enableAutostep,rawkinematiccharactercontroller_disableAutostep=__vite__wasmModule.rawkinematiccharactercontroller_disableAutostep,rawkinematiccharactercontroller_maxSlopeClimbAngle=__vite__wasmModule.rawkinematiccharactercontroller_maxSlopeClimbAngle,rawkinematiccharactercontroller_setMaxSlopeClimbAngle=__vite__wasmModule.rawkinematiccharactercontroller_setMaxSlopeClimbAngle,rawkinematiccharactercontroller_minSlopeSlideAngle=__vite__wasmModule.rawkinematiccharactercontroller_minSlopeSlideAngle,rawkinematiccharactercontroller_setMinSlopeSlideAngle=__vite__wasmModule.rawkinematiccharactercontroller_setMinSlopeSlideAngle,rawkinematiccharactercontroller_snapToGroundDistance=__vite__wasmModule.rawkinematiccharactercontroller_snapToGroundDistance,rawkinematiccharactercontroller_enableSnapToGround=__vite__wasmModule.rawkinematiccharactercontroller_enableSnapToGround,rawkinematiccharactercontroller_disableSnapToGround=__vite__wasmModule.rawkinematiccharactercontroller_disableSnapToGround,rawkinematiccharactercontroller_snapToGroundEnabled=__vite__wasmModule.rawkinematiccharactercontroller_snapToGroundEnabled,rawkinematiccharactercontroller_computeColliderMovement=__vite__wasmModule.rawkinematiccharactercontroller_computeColliderMovement,rawkinematiccharactercontroller_computedMovement=__vite__wasmModule.rawkinematiccharactercontroller_computedMovement,rawkinematiccharactercontroller_computedGrounded=__vite__wasmModule.rawkinematiccharactercontroller_computedGrounded,rawkinematiccharactercontroller_numComputedCollisions=__vite__wasmModule.rawkinematiccharactercontroller_numComputedCollisions,rawkinematiccharactercontroller_computedCollision=__vite__wasmModule.rawkinematiccharactercontroller_computedCollision,__wbg_rawcharactercollision_free=__vite__wasmModule.__wbg_rawcharactercollision_free,rawcharactercollision_new=__vite__wasmModule.rawcharactercollision_new,rawcharactercollision_handle=__vite__wasmModule.rawcharactercollision_handle,rawcharactercollision_translationDeltaApplied=__vite__wasmModule.rawcharactercollision_translationDeltaApplied,rawcharactercollision_translationDeltaRemaining=__vite__wasmModule.rawcharactercollision_translationDeltaRemaining,rawcharactercollision_toi=__vite__wasmModule.rawcharactercollision_toi,rawcharactercollision_worldWitness1=__vite__wasmModule.rawcharactercollision_worldWitness1,rawcharactercollision_worldWitness2=__vite__wasmModule.rawcharactercollision_worldWitness2,rawcharactercollision_worldNormal1=__vite__wasmModule.rawcharactercollision_worldNormal1,rawcharactercollision_worldNormal2=__vite__wasmModule.rawcharactercollision_worldNormal2,__wbg_rawdynamicraycastvehiclecontroller_free=__vite__wasmModule.__wbg_rawdynamicraycastvehiclecontroller_free,rawdynamicraycastvehiclecontroller_new=__vite__wasmModule.rawdynamicraycastvehiclecontroller_new,rawdynamicraycastvehiclecontroller_current_vehicle_speed=__vite__wasmModule.rawdynamicraycastvehiclecontroller_current_vehicle_speed,rawdynamicraycastvehiclecontroller_chassis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_chassis,rawdynamicraycastvehiclecontroller_index_up_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_index_up_axis,rawdynamicraycastvehiclecontroller_set_index_up_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_index_up_axis,rawdynamicraycastvehiclecontroller_index_forward_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_index_forward_axis,rawdynamicraycastvehiclecontroller_set_index_forward_axis=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_index_forward_axis,rawdynamicraycastvehiclecontroller_add_wheel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_add_wheel,rawdynamicraycastvehiclecontroller_num_wheels=__vite__wasmModule.rawdynamicraycastvehiclecontroller_num_wheels,rawdynamicraycastvehiclecontroller_update_vehicle=__vite__wasmModule.rawdynamicraycastvehiclecontroller_update_vehicle,rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_wheel_radius=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_radius,rawdynamicraycastvehiclecontroller_set_wheel_radius=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_radius,rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_wheel_suspension_compression=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_wheel_max_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_wheel_brake=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_brake,rawdynamicraycastvehiclecontroller_set_wheel_brake=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_brake,rawdynamicraycastvehiclecontroller_wheel_steering=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_steering,rawdynamicraycastvehiclecontroller_set_wheel_steering=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_steering,rawdynamicraycastvehiclecontroller_wheel_engine_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_engine_force,rawdynamicraycastvehiclecontroller_set_wheel_engine_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_engine_force,rawdynamicraycastvehiclecontroller_wheel_direction_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_direction_cs,rawdynamicraycastvehiclecontroller_set_wheel_direction_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_direction_cs,rawdynamicraycastvehiclecontroller_wheel_axle_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_axle_cs,rawdynamicraycastvehiclecontroller_set_wheel_axle_cs=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_axle_cs,rawdynamicraycastvehiclecontroller_wheel_friction_slip=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_friction_slip,rawdynamicraycastvehiclecontroller_set_wheel_friction_slip=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_friction_slip,rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness=__vite__wasmModule.rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_wheel_rotation=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_rotation,rawdynamicraycastvehiclecontroller_wheel_forward_impulse=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_forward_impulse,rawdynamicraycastvehiclecontroller_wheel_side_impulse=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_side_impulse,rawdynamicraycastvehiclecontroller_wheel_suspension_force=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_force,rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws,rawdynamicraycastvehiclecontroller_wheel_contact_point_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_contact_point_ws,rawdynamicraycastvehiclecontroller_wheel_suspension_length=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_suspension_length,rawdynamicraycastvehiclecontroller_wheel_hard_point_ws=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_hard_point_ws,rawdynamicraycastvehiclecontroller_wheel_is_in_contact=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_is_in_contact,rawdynamicraycastvehiclecontroller_wheel_ground_object=__vite__wasmModule.rawdynamicraycastvehiclecontroller_wheel_ground_object,__wbg_rawccdsolver_free=__vite__wasmModule.__wbg_rawccdsolver_free,rawccdsolver_new=__vite__wasmModule.rawccdsolver_new,rawimpulsejointset_jointType=__vite__wasmModule.rawimpulsejointset_jointType,rawimpulsejointset_jointBodyHandle1=__vite__wasmModule.rawimpulsejointset_jointBodyHandle1,rawimpulsejointset_jointBodyHandle2=__vite__wasmModule.rawimpulsejointset_jointBodyHandle2,rawimpulsejointset_jointFrameX1=__vite__wasmModule.rawimpulsejointset_jointFrameX1,rawimpulsejointset_jointFrameX2=__vite__wasmModule.rawimpulsejointset_jointFrameX2,rawimpulsejointset_jointAnchor1=__vite__wasmModule.rawimpulsejointset_jointAnchor1,rawimpulsejointset_jointAnchor2=__vite__wasmModule.rawimpulsejointset_jointAnchor2,rawimpulsejointset_jointSetAnchor1=__vite__wasmModule.rawimpulsejointset_jointSetAnchor1,rawimpulsejointset_jointSetAnchor2=__vite__wasmModule.rawimpulsejointset_jointSetAnchor2,rawimpulsejointset_jointContactsEnabled=__vite__wasmModule.rawimpulsejointset_jointContactsEnabled,rawimpulsejointset_jointSetContactsEnabled=__vite__wasmModule.rawimpulsejointset_jointSetContactsEnabled,rawimpulsejointset_jointLimitsEnabled=__vite__wasmModule.rawimpulsejointset_jointLimitsEnabled,rawimpulsejointset_jointLimitsMin=__vite__wasmModule.rawimpulsejointset_jointLimitsMin,rawimpulsejointset_jointLimitsMax=__vite__wasmModule.rawimpulsejointset_jointLimitsMax,rawimpulsejointset_jointSetLimits=__vite__wasmModule.rawimpulsejointset_jointSetLimits,rawimpulsejointset_jointConfigureMotorModel=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorModel,rawimpulsejointset_jointConfigureMotorVelocity=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorVelocity,rawimpulsejointset_jointConfigureMotorPosition=__vite__wasmModule.rawimpulsejointset_jointConfigureMotorPosition,rawimpulsejointset_jointConfigureMotor=__vite__wasmModule.rawimpulsejointset_jointConfigureMotor,__wbg_rawimpulsejointset_free=__vite__wasmModule.__wbg_rawimpulsejointset_free,rawimpulsejointset_new=__vite__wasmModule.rawimpulsejointset_new,rawimpulsejointset_createJoint=__vite__wasmModule.rawimpulsejointset_createJoint,rawimpulsejointset_remove=__vite__wasmModule.rawimpulsejointset_remove,rawimpulsejointset_len=__vite__wasmModule.rawimpulsejointset_len,rawimpulsejointset_contains=__vite__wasmModule.rawimpulsejointset_contains,rawimpulsejointset_forEachJointHandle=__vite__wasmModule.rawimpulsejointset_forEachJointHandle,rawimpulsejointset_forEachJointAttachedToRigidBody=__vite__wasmModule.rawimpulsejointset_forEachJointAttachedToRigidBody,__wbg_rawintegrationparameters_free=__vite__wasmModule.__wbg_rawintegrationparameters_free,rawintegrationparameters_new=__vite__wasmModule.rawintegrationparameters_new,rawintegrationparameters_dt=__vite__wasmModule.rawintegrationparameters_dt,rawintegrationparameters_contact_erp=__vite__wasmModule.rawintegrationparameters_contact_erp,rawintegrationparameters_numSolverIterations=__vite__wasmModule.rawintegrationparameters_numSolverIterations,rawintegrationparameters_maxCcdSubsteps=__vite__wasmModule.rawintegrationparameters_maxCcdSubsteps,rawintegrationparameters_lengthUnit=__vite__wasmModule.rawintegrationparameters_lengthUnit,rawintegrationparameters_set_dt=__vite__wasmModule.rawintegrationparameters_set_dt,rawintegrationparameters_set_contact_natural_frequency=__vite__wasmModule.rawintegrationparameters_set_contact_natural_frequency,rawintegrationparameters_set_normalizedAllowedLinearError=__vite__wasmModule.rawintegrationparameters_set_normalizedAllowedLinearError,rawintegrationparameters_set_normalizedPredictionDistance=__vite__wasmModule.rawintegrationparameters_set_normalizedPredictionDistance,rawintegrationparameters_set_numSolverIterations=__vite__wasmModule.rawintegrationparameters_set_numSolverIterations,rawintegrationparameters_set_minIslandSize=__vite__wasmModule.rawintegrationparameters_set_minIslandSize,rawintegrationparameters_set_maxCcdSubsteps=__vite__wasmModule.rawintegrationparameters_set_maxCcdSubsteps,rawintegrationparameters_set_lengthUnit=__vite__wasmModule.rawintegrationparameters_set_lengthUnit,rawintegrationparameters_switchToStandardPgsSolver=__vite__wasmModule.rawintegrationparameters_switchToStandardPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolver=__vite__wasmModule.rawintegrationparameters_switchToSmallStepsPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart=__vite__wasmModule.rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart,__wbg_rawislandmanager_free=__vite__wasmModule.__wbg_rawislandmanager_free,rawislandmanager_new=__vite__wasmModule.rawislandmanager_new,rawislandmanager_forEachActiveRigidBodyHandle=__vite__wasmModule.rawislandmanager_forEachActiveRigidBodyHandle,__wbg_rawgenericjoint_free=__vite__wasmModule.__wbg_rawgenericjoint_free,rawgenericjoint_generic=__vite__wasmModule.rawgenericjoint_generic,rawgenericjoint_spring=__vite__wasmModule.rawgenericjoint_spring,rawgenericjoint_rope=__vite__wasmModule.rawgenericjoint_rope,rawgenericjoint_spherical=__vite__wasmModule.rawgenericjoint_spherical,rawgenericjoint_prismatic=__vite__wasmModule.rawgenericjoint_prismatic,rawgenericjoint_fixed=__vite__wasmModule.rawgenericjoint_fixed,rawgenericjoint_revolute=__vite__wasmModule.rawgenericjoint_revolute,rawmultibodyjointset_jointType=__vite__wasmModule.rawmultibodyjointset_jointType,rawmultibodyjointset_jointFrameX1=__vite__wasmModule.rawmultibodyjointset_jointFrameX1,rawmultibodyjointset_jointFrameX2=__vite__wasmModule.rawmultibodyjointset_jointFrameX2,rawmultibodyjointset_jointAnchor1=__vite__wasmModule.rawmultibodyjointset_jointAnchor1,rawmultibodyjointset_jointAnchor2=__vite__wasmModule.rawmultibodyjointset_jointAnchor2,rawmultibodyjointset_jointContactsEnabled=__vite__wasmModule.rawmultibodyjointset_jointContactsEnabled,rawmultibodyjointset_jointSetContactsEnabled=__vite__wasmModule.rawmultibodyjointset_jointSetContactsEnabled,rawmultibodyjointset_jointLimitsEnabled=__vite__wasmModule.rawmultibodyjointset_jointLimitsEnabled,rawmultibodyjointset_jointLimitsMin=__vite__wasmModule.rawmultibodyjointset_jointLimitsMin,rawmultibodyjointset_jointLimitsMax=__vite__wasmModule.rawmultibodyjointset_jointLimitsMax,__wbg_rawmultibodyjointset_free=__vite__wasmModule.__wbg_rawmultibodyjointset_free,rawmultibodyjointset_new=__vite__wasmModule.rawmultibodyjointset_new,rawmultibodyjointset_createJoint=__vite__wasmModule.rawmultibodyjointset_createJoint,rawmultibodyjointset_remove=__vite__wasmModule.rawmultibodyjointset_remove,rawmultibodyjointset_contains=__vite__wasmModule.rawmultibodyjointset_contains,rawmultibodyjointset_forEachJointHandle=__vite__wasmModule.rawmultibodyjointset_forEachJointHandle,rawmultibodyjointset_forEachJointAttachedToRigidBody=__vite__wasmModule.rawmultibodyjointset_forEachJointAttachedToRigidBody,rawrigidbodyset_rbTranslation=__vite__wasmModule.rawrigidbodyset_rbTranslation,rawrigidbodyset_rbRotation=__vite__wasmModule.rawrigidbodyset_rbRotation,rawrigidbodyset_rbSleep=__vite__wasmModule.rawrigidbodyset_rbSleep,rawrigidbodyset_rbIsSleeping=__vite__wasmModule.rawrigidbodyset_rbIsSleeping,rawrigidbodyset_rbIsMoving=__vite__wasmModule.rawrigidbodyset_rbIsMoving,rawrigidbodyset_rbNextTranslation=__vite__wasmModule.rawrigidbodyset_rbNextTranslation,rawrigidbodyset_rbNextRotation=__vite__wasmModule.rawrigidbodyset_rbNextRotation,rawrigidbodyset_rbSetTranslation=__vite__wasmModule.rawrigidbodyset_rbSetTranslation,rawrigidbodyset_rbSetRotation=__vite__wasmModule.rawrigidbodyset_rbSetRotation,rawrigidbodyset_rbSetLinvel=__vite__wasmModule.rawrigidbodyset_rbSetLinvel,rawrigidbodyset_rbSetAngvel=__vite__wasmModule.rawrigidbodyset_rbSetAngvel,rawrigidbodyset_rbSetNextKinematicTranslation=__vite__wasmModule.rawrigidbodyset_rbSetNextKinematicTranslation,rawrigidbodyset_rbSetNextKinematicRotation=__vite__wasmModule.rawrigidbodyset_rbSetNextKinematicRotation,rawrigidbodyset_rbRecomputeMassPropertiesFromColliders=__vite__wasmModule.rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,rawrigidbodyset_rbSetAdditionalMass=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalMass,rawrigidbodyset_rbSetAdditionalMassProperties=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalMassProperties,rawrigidbodyset_rbLinvel=__vite__wasmModule.rawrigidbodyset_rbLinvel,rawrigidbodyset_rbAngvel=__vite__wasmModule.rawrigidbodyset_rbAngvel,rawrigidbodyset_rbLockTranslations=__vite__wasmModule.rawrigidbodyset_rbLockTranslations,rawrigidbodyset_rbSetEnabledTranslations=__vite__wasmModule.rawrigidbodyset_rbSetEnabledTranslations,rawrigidbodyset_rbLockRotations=__vite__wasmModule.rawrigidbodyset_rbLockRotations,rawrigidbodyset_rbSetEnabledRotations=__vite__wasmModule.rawrigidbodyset_rbSetEnabledRotations,rawrigidbodyset_rbDominanceGroup=__vite__wasmModule.rawrigidbodyset_rbDominanceGroup,rawrigidbodyset_rbSetDominanceGroup=__vite__wasmModule.rawrigidbodyset_rbSetDominanceGroup,rawrigidbodyset_rbEnableCcd=__vite__wasmModule.rawrigidbodyset_rbEnableCcd,rawrigidbodyset_rbSetSoftCcdPrediction=__vite__wasmModule.rawrigidbodyset_rbSetSoftCcdPrediction,rawrigidbodyset_rbMass=__vite__wasmModule.rawrigidbodyset_rbMass,rawrigidbodyset_rbInvMass=__vite__wasmModule.rawrigidbodyset_rbInvMass,rawrigidbodyset_rbEffectiveInvMass=__vite__wasmModule.rawrigidbodyset_rbEffectiveInvMass,rawrigidbodyset_rbLocalCom=__vite__wasmModule.rawrigidbodyset_rbLocalCom,rawrigidbodyset_rbWorldCom=__vite__wasmModule.rawrigidbodyset_rbWorldCom,rawrigidbodyset_rbInvPrincipalInertiaSqrt=__vite__wasmModule.rawrigidbodyset_rbInvPrincipalInertiaSqrt,rawrigidbodyset_rbPrincipalInertiaLocalFrame=__vite__wasmModule.rawrigidbodyset_rbPrincipalInertiaLocalFrame,rawrigidbodyset_rbPrincipalInertia=__vite__wasmModule.rawrigidbodyset_rbPrincipalInertia,rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt=__vite__wasmModule.rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,rawrigidbodyset_rbEffectiveAngularInertia=__vite__wasmModule.rawrigidbodyset_rbEffectiveAngularInertia,rawrigidbodyset_rbWakeUp=__vite__wasmModule.rawrigidbodyset_rbWakeUp,rawrigidbodyset_rbIsCcdEnabled=__vite__wasmModule.rawrigidbodyset_rbIsCcdEnabled,rawrigidbodyset_rbSoftCcdPrediction=__vite__wasmModule.rawrigidbodyset_rbSoftCcdPrediction,rawrigidbodyset_rbNumColliders=__vite__wasmModule.rawrigidbodyset_rbNumColliders,rawrigidbodyset_rbCollider=__vite__wasmModule.rawrigidbodyset_rbCollider,rawrigidbodyset_rbBodyType=__vite__wasmModule.rawrigidbodyset_rbBodyType,rawrigidbodyset_rbSetBodyType=__vite__wasmModule.rawrigidbodyset_rbSetBodyType,rawrigidbodyset_rbIsFixed=__vite__wasmModule.rawrigidbodyset_rbIsFixed,rawrigidbodyset_rbIsKinematic=__vite__wasmModule.rawrigidbodyset_rbIsKinematic,rawrigidbodyset_rbIsDynamic=__vite__wasmModule.rawrigidbodyset_rbIsDynamic,rawrigidbodyset_rbLinearDamping=__vite__wasmModule.rawrigidbodyset_rbLinearDamping,rawrigidbodyset_rbAngularDamping=__vite__wasmModule.rawrigidbodyset_rbAngularDamping,rawrigidbodyset_rbSetLinearDamping=__vite__wasmModule.rawrigidbodyset_rbSetLinearDamping,rawrigidbodyset_rbSetAngularDamping=__vite__wasmModule.rawrigidbodyset_rbSetAngularDamping,rawrigidbodyset_rbSetEnabled=__vite__wasmModule.rawrigidbodyset_rbSetEnabled,rawrigidbodyset_rbIsEnabled=__vite__wasmModule.rawrigidbodyset_rbIsEnabled,rawrigidbodyset_rbGravityScale=__vite__wasmModule.rawrigidbodyset_rbGravityScale,rawrigidbodyset_rbSetGravityScale=__vite__wasmModule.rawrigidbodyset_rbSetGravityScale,rawrigidbodyset_rbResetForces=__vite__wasmModule.rawrigidbodyset_rbResetForces,rawrigidbodyset_rbResetTorques=__vite__wasmModule.rawrigidbodyset_rbResetTorques,rawrigidbodyset_rbAddForce=__vite__wasmModule.rawrigidbodyset_rbAddForce,rawrigidbodyset_rbApplyImpulse=__vite__wasmModule.rawrigidbodyset_rbApplyImpulse,rawrigidbodyset_rbAddTorque=__vite__wasmModule.rawrigidbodyset_rbAddTorque,rawrigidbodyset_rbApplyTorqueImpulse=__vite__wasmModule.rawrigidbodyset_rbApplyTorqueImpulse,rawrigidbodyset_rbAddForceAtPoint=__vite__wasmModule.rawrigidbodyset_rbAddForceAtPoint,rawrigidbodyset_rbApplyImpulseAtPoint=__vite__wasmModule.rawrigidbodyset_rbApplyImpulseAtPoint,rawrigidbodyset_rbAdditionalSolverIterations=__vite__wasmModule.rawrigidbodyset_rbAdditionalSolverIterations,rawrigidbodyset_rbSetAdditionalSolverIterations=__vite__wasmModule.rawrigidbodyset_rbSetAdditionalSolverIterations,rawrigidbodyset_rbUserData=__vite__wasmModule.rawrigidbodyset_rbUserData,rawrigidbodyset_rbSetUserData=__vite__wasmModule.rawrigidbodyset_rbSetUserData,rawrigidbodyset_rbUserForce=__vite__wasmModule.rawrigidbodyset_rbUserForce,rawrigidbodyset_rbUserTorque=__vite__wasmModule.rawrigidbodyset_rbUserTorque,__wbg_rawrigidbodyset_free=__vite__wasmModule.__wbg_rawrigidbodyset_free,rawrigidbodyset_new=__vite__wasmModule.rawrigidbodyset_new,rawrigidbodyset_createRigidBody=__vite__wasmModule.rawrigidbodyset_createRigidBody,rawrigidbodyset_remove=__vite__wasmModule.rawrigidbodyset_remove,rawrigidbodyset_contains=__vite__wasmModule.rawrigidbodyset_contains,rawrigidbodyset_forEachRigidBodyHandle=__vite__wasmModule.rawrigidbodyset_forEachRigidBodyHandle,rawrigidbodyset_propagateModifiedBodyPositionsToColliders=__vite__wasmModule.rawrigidbodyset_propagateModifiedBodyPositionsToColliders,__wbg_rawbroadphase_free=__vite__wasmModule.__wbg_rawbroadphase_free,rawbroadphase_new=__vite__wasmModule.rawbroadphase_new,rawcolliderset_coTranslation=__vite__wasmModule.rawcolliderset_coTranslation,rawcolliderset_coRotation=__vite__wasmModule.rawcolliderset_coRotation,rawcolliderset_coSetTranslation=__vite__wasmModule.rawcolliderset_coSetTranslation,rawcolliderset_coSetTranslationWrtParent=__vite__wasmModule.rawcolliderset_coSetTranslationWrtParent,rawcolliderset_coSetRotation=__vite__wasmModule.rawcolliderset_coSetRotation,rawcolliderset_coSetRotationWrtParent=__vite__wasmModule.rawcolliderset_coSetRotationWrtParent,rawcolliderset_coIsSensor=__vite__wasmModule.rawcolliderset_coIsSensor,rawcolliderset_coShapeType=__vite__wasmModule.rawcolliderset_coShapeType,rawcolliderset_coHalfspaceNormal=__vite__wasmModule.rawcolliderset_coHalfspaceNormal,rawcolliderset_coHalfExtents=__vite__wasmModule.rawcolliderset_coHalfExtents,rawcolliderset_coSetHalfExtents=__vite__wasmModule.rawcolliderset_coSetHalfExtents,rawcolliderset_coRadius=__vite__wasmModule.rawcolliderset_coRadius,rawcolliderset_coSetRadius=__vite__wasmModule.rawcolliderset_coSetRadius,rawcolliderset_coHalfHeight=__vite__wasmModule.rawcolliderset_coHalfHeight,rawcolliderset_coSetHalfHeight=__vite__wasmModule.rawcolliderset_coSetHalfHeight,rawcolliderset_coRoundRadius=__vite__wasmModule.rawcolliderset_coRoundRadius,rawcolliderset_coSetRoundRadius=__vite__wasmModule.rawcolliderset_coSetRoundRadius,rawcolliderset_coVertices=__vite__wasmModule.rawcolliderset_coVertices,rawcolliderset_coIndices=__vite__wasmModule.rawcolliderset_coIndices,rawcolliderset_coTriMeshFlags=__vite__wasmModule.rawcolliderset_coTriMeshFlags,rawcolliderset_coHeightFieldFlags=__vite__wasmModule.rawcolliderset_coHeightFieldFlags,rawcolliderset_coHeightfieldHeights=__vite__wasmModule.rawcolliderset_coHeightfieldHeights,rawcolliderset_coHeightfieldScale=__vite__wasmModule.rawcolliderset_coHeightfieldScale,rawcolliderset_coHeightfieldNRows=__vite__wasmModule.rawcolliderset_coHeightfieldNRows,rawcolliderset_coHeightfieldNCols=__vite__wasmModule.rawcolliderset_coHeightfieldNCols,rawcolliderset_coParent=__vite__wasmModule.rawcolliderset_coParent,rawcolliderset_coSetEnabled=__vite__wasmModule.rawcolliderset_coSetEnabled,rawcolliderset_coIsEnabled=__vite__wasmModule.rawcolliderset_coIsEnabled,rawcolliderset_coSetContactSkin=__vite__wasmModule.rawcolliderset_coSetContactSkin,rawcolliderset_coContactSkin=__vite__wasmModule.rawcolliderset_coContactSkin,rawcolliderset_coFriction=__vite__wasmModule.rawcolliderset_coFriction,rawcolliderset_coRestitution=__vite__wasmModule.rawcolliderset_coRestitution,rawcolliderset_coDensity=__vite__wasmModule.rawcolliderset_coDensity,rawcolliderset_coMass=__vite__wasmModule.rawcolliderset_coMass,rawcolliderset_coVolume=__vite__wasmModule.rawcolliderset_coVolume,rawcolliderset_coCollisionGroups=__vite__wasmModule.rawcolliderset_coCollisionGroups,rawcolliderset_coSolverGroups=__vite__wasmModule.rawcolliderset_coSolverGroups,rawcolliderset_coActiveHooks=__vite__wasmModule.rawcolliderset_coActiveHooks,rawcolliderset_coActiveCollisionTypes=__vite__wasmModule.rawcolliderset_coActiveCollisionTypes,rawcolliderset_coActiveEvents=__vite__wasmModule.rawcolliderset_coActiveEvents,rawcolliderset_coContactForceEventThreshold=__vite__wasmModule.rawcolliderset_coContactForceEventThreshold,rawcolliderset_coContainsPoint=__vite__wasmModule.rawcolliderset_coContainsPoint,rawcolliderset_coCastShape=__vite__wasmModule.rawcolliderset_coCastShape,rawcolliderset_coCastCollider=__vite__wasmModule.rawcolliderset_coCastCollider,rawcolliderset_coIntersectsShape=__vite__wasmModule.rawcolliderset_coIntersectsShape,rawcolliderset_coContactShape=__vite__wasmModule.rawcolliderset_coContactShape,rawcolliderset_coContactCollider=__vite__wasmModule.rawcolliderset_coContactCollider,rawcolliderset_coProjectPoint=__vite__wasmModule.rawcolliderset_coProjectPoint,rawcolliderset_coIntersectsRay=__vite__wasmModule.rawcolliderset_coIntersectsRay,rawcolliderset_coCastRay=__vite__wasmModule.rawcolliderset_coCastRay,rawcolliderset_coCastRayAndGetNormal=__vite__wasmModule.rawcolliderset_coCastRayAndGetNormal,rawcolliderset_coSetSensor=__vite__wasmModule.rawcolliderset_coSetSensor,rawcolliderset_coSetRestitution=__vite__wasmModule.rawcolliderset_coSetRestitution,rawcolliderset_coSetFriction=__vite__wasmModule.rawcolliderset_coSetFriction,rawcolliderset_coFrictionCombineRule=__vite__wasmModule.rawcolliderset_coFrictionCombineRule,rawcolliderset_coSetFrictionCombineRule=__vite__wasmModule.rawcolliderset_coSetFrictionCombineRule,rawcolliderset_coRestitutionCombineRule=__vite__wasmModule.rawcolliderset_coRestitutionCombineRule,rawcolliderset_coSetRestitutionCombineRule=__vite__wasmModule.rawcolliderset_coSetRestitutionCombineRule,rawcolliderset_coSetCollisionGroups=__vite__wasmModule.rawcolliderset_coSetCollisionGroups,rawcolliderset_coSetSolverGroups=__vite__wasmModule.rawcolliderset_coSetSolverGroups,rawcolliderset_coSetActiveHooks=__vite__wasmModule.rawcolliderset_coSetActiveHooks,rawcolliderset_coSetActiveEvents=__vite__wasmModule.rawcolliderset_coSetActiveEvents,rawcolliderset_coSetActiveCollisionTypes=__vite__wasmModule.rawcolliderset_coSetActiveCollisionTypes,rawcolliderset_coSetShape=__vite__wasmModule.rawcolliderset_coSetShape,rawcolliderset_coSetContactForceEventThreshold=__vite__wasmModule.rawcolliderset_coSetContactForceEventThreshold,rawcolliderset_coSetDensity=__vite__wasmModule.rawcolliderset_coSetDensity,rawcolliderset_coSetMass=__vite__wasmModule.rawcolliderset_coSetMass,rawcolliderset_coSetMassProperties=__vite__wasmModule.rawcolliderset_coSetMassProperties,__wbg_rawcolliderset_free=__vite__wasmModule.__wbg_rawcolliderset_free,rawcolliderset_new=__vite__wasmModule.rawcolliderset_new,rawcolliderset_len=__vite__wasmModule.rawcolliderset_len,rawcolliderset_contains=__vite__wasmModule.rawcolliderset_contains,rawcolliderset_createCollider=__vite__wasmModule.rawcolliderset_createCollider,rawcolliderset_remove=__vite__wasmModule.rawcolliderset_remove,rawcolliderset_forEachColliderHandle=__vite__wasmModule.rawcolliderset_forEachColliderHandle,__wbg_rawshapecontact_free=__vite__wasmModule.__wbg_rawshapecontact_free,__wbg_rawnarrowphase_free=__vite__wasmModule.__wbg_rawnarrowphase_free,rawnarrowphase_new=__vite__wasmModule.rawnarrowphase_new,rawnarrowphase_contact_pairs_with=__vite__wasmModule.rawnarrowphase_contact_pairs_with,rawnarrowphase_contact_pair=__vite__wasmModule.rawnarrowphase_contact_pair,rawnarrowphase_intersection_pairs_with=__vite__wasmModule.rawnarrowphase_intersection_pairs_with,rawnarrowphase_intersection_pair=__vite__wasmModule.rawnarrowphase_intersection_pair,__wbg_rawcontactmanifold_free=__vite__wasmModule.__wbg_rawcontactmanifold_free,rawcontactpair_collider1=__vite__wasmModule.rawcontactpair_collider1,rawcontactpair_collider2=__vite__wasmModule.rawcontactpair_collider2,rawcontactpair_numContactManifolds=__vite__wasmModule.rawcontactpair_numContactManifolds,rawcontactpair_contactManifold=__vite__wasmModule.rawcontactpair_contactManifold,rawcontactmanifold_normal=__vite__wasmModule.rawcontactmanifold_normal,rawcontactmanifold_local_n1=__vite__wasmModule.rawcontactmanifold_local_n1,rawcontactmanifold_local_n2=__vite__wasmModule.rawcontactmanifold_local_n2,rawcontactmanifold_subshape1=__vite__wasmModule.rawcontactmanifold_subshape1,rawcontactmanifold_subshape2=__vite__wasmModule.rawcontactmanifold_subshape2,rawcontactmanifold_num_contacts=__vite__wasmModule.rawcontactmanifold_num_contacts,rawcontactmanifold_contact_local_p1=__vite__wasmModule.rawcontactmanifold_contact_local_p1,rawcontactmanifold_contact_local_p2=__vite__wasmModule.rawcontactmanifold_contact_local_p2,rawcontactmanifold_contact_dist=__vite__wasmModule.rawcontactmanifold_contact_dist,rawcontactmanifold_contact_fid1=__vite__wasmModule.rawcontactmanifold_contact_fid1,rawcontactmanifold_contact_fid2=__vite__wasmModule.rawcontactmanifold_contact_fid2,rawcontactmanifold_contact_impulse=__vite__wasmModule.rawcontactmanifold_contact_impulse,rawcontactmanifold_contact_tangent_impulse_x=__vite__wasmModule.rawcontactmanifold_contact_tangent_impulse_x,rawcontactmanifold_contact_tangent_impulse_y=__vite__wasmModule.rawcontactmanifold_contact_tangent_impulse_y,rawcontactmanifold_num_solver_contacts=__vite__wasmModule.rawcontactmanifold_num_solver_contacts,rawcontactmanifold_solver_contact_point=__vite__wasmModule.rawcontactmanifold_solver_contact_point,rawcontactmanifold_solver_contact_dist=__vite__wasmModule.rawcontactmanifold_solver_contact_dist,rawcontactmanifold_solver_contact_friction=__vite__wasmModule.rawcontactmanifold_solver_contact_friction,rawcontactmanifold_solver_contact_restitution=__vite__wasmModule.rawcontactmanifold_solver_contact_restitution,rawcontactmanifold_solver_contact_tangent_velocity=__vite__wasmModule.rawcontactmanifold_solver_contact_tangent_velocity,__wbg_rawpointprojection_free=__vite__wasmModule.__wbg_rawpointprojection_free,rawpointprojection_point=__vite__wasmModule.rawpointprojection_point,rawpointprojection_isInside=__vite__wasmModule.rawpointprojection_isInside,__wbg_rawpointcolliderprojection_free=__vite__wasmModule.__wbg_rawpointcolliderprojection_free,rawpointcolliderprojection_colliderHandle=__vite__wasmModule.rawpointcolliderprojection_colliderHandle,rawpointcolliderprojection_point=__vite__wasmModule.rawpointcolliderprojection_point,rawpointcolliderprojection_isInside=__vite__wasmModule.rawpointcolliderprojection_isInside,rawpointcolliderprojection_featureType=__vite__wasmModule.rawpointcolliderprojection_featureType,rawpointcolliderprojection_featureId=__vite__wasmModule.rawpointcolliderprojection_featureId,__wbg_rawrayintersection_free=__vite__wasmModule.__wbg_rawrayintersection_free,__wbg_rawraycolliderhit_free=__vite__wasmModule.__wbg_rawraycolliderhit_free,__wbg_rawshape_free=__vite__wasmModule.__wbg_rawshape_free,rawshape_cuboid=__vite__wasmModule.rawshape_cuboid,rawshape_roundCuboid=__vite__wasmModule.rawshape_roundCuboid,rawshape_ball=__vite__wasmModule.rawshape_ball,rawshape_halfspace=__vite__wasmModule.rawshape_halfspace,rawshape_capsule=__vite__wasmModule.rawshape_capsule,rawshape_cylinder=__vite__wasmModule.rawshape_cylinder,rawshape_roundCylinder=__vite__wasmModule.rawshape_roundCylinder,rawshape_cone=__vite__wasmModule.rawshape_cone,rawshape_roundCone=__vite__wasmModule.rawshape_roundCone,rawshape_polyline=__vite__wasmModule.rawshape_polyline,rawshape_trimesh=__vite__wasmModule.rawshape_trimesh,rawshape_heightfield=__vite__wasmModule.rawshape_heightfield,rawshape_segment=__vite__wasmModule.rawshape_segment,rawshape_triangle=__vite__wasmModule.rawshape_triangle,rawshape_roundTriangle=__vite__wasmModule.rawshape_roundTriangle,rawshape_convexHull=__vite__wasmModule.rawshape_convexHull,rawshape_roundConvexHull=__vite__wasmModule.rawshape_roundConvexHull,rawshape_convexMesh=__vite__wasmModule.rawshape_convexMesh,rawshape_roundConvexMesh=__vite__wasmModule.rawshape_roundConvexMesh,rawshape_castShape=__vite__wasmModule.rawshape_castShape,rawshape_intersectsShape=__vite__wasmModule.rawshape_intersectsShape,rawshape_contactShape=__vite__wasmModule.rawshape_contactShape,rawshape_containsPoint=__vite__wasmModule.rawshape_containsPoint,rawshape_projectPoint=__vite__wasmModule.rawshape_projectPoint,rawshape_intersectsRay=__vite__wasmModule.rawshape_intersectsRay,rawshape_castRay=__vite__wasmModule.rawshape_castRay,rawshape_castRayAndGetNormal=__vite__wasmModule.rawshape_castRayAndGetNormal,__wbg_rawshapecasthit_free=__vite__wasmModule.__wbg_rawshapecasthit_free,rawshapecasthit_witness1=__vite__wasmModule.rawshapecasthit_witness1,rawshapecasthit_normal1=__vite__wasmModule.rawshapecasthit_normal1,rawshapecasthit_normal2=__vite__wasmModule.rawshapecasthit_normal2,__wbg_rawcollidershapecasthit_free=__vite__wasmModule.__wbg_rawcollidershapecasthit_free,rawcollidershapecasthit_time_of_impact=__vite__wasmModule.rawcollidershapecasthit_time_of_impact,rawcollidershapecasthit_witness1=__vite__wasmModule.rawcollidershapecasthit_witness1,rawcollidershapecasthit_witness2=__vite__wasmModule.rawcollidershapecasthit_witness2,rawrotation_new=__vite__wasmModule.rawrotation_new,rawrotation_identity=__vite__wasmModule.rawrotation_identity,rawrotation_x=__vite__wasmModule.rawrotation_x,rawrotation_w=__vite__wasmModule.rawrotation_w,rawvector_zero=__vite__wasmModule.rawvector_zero,rawvector_new=__vite__wasmModule.rawvector_new,rawvector_set_x=__vite__wasmModule.rawvector_set_x,rawvector_set_z=__vite__wasmModule.rawvector_set_z,rawvector_xyz=__vite__wasmModule.rawvector_xyz,rawvector_yxz=__vite__wasmModule.rawvector_yxz,rawvector_zxy=__vite__wasmModule.rawvector_zxy,rawvector_xzy=__vite__wasmModule.rawvector_xzy,rawvector_yzx=__vite__wasmModule.rawvector_yzx,rawvector_zyx=__vite__wasmModule.rawvector_zyx,rawsdpmatrix3_elements=__vite__wasmModule.rawsdpmatrix3_elements,__wbg_rawdebugrenderpipeline_free=__vite__wasmModule.__wbg_rawdebugrenderpipeline_free,rawdebugrenderpipeline_new=__vite__wasmModule.rawdebugrenderpipeline_new,rawdebugrenderpipeline_vertices=__vite__wasmModule.rawdebugrenderpipeline_vertices,rawdebugrenderpipeline_colors=__vite__wasmModule.rawdebugrenderpipeline_colors,rawdebugrenderpipeline_render=__vite__wasmModule.rawdebugrenderpipeline_render,__wbg_raweventqueue_free=__vite__wasmModule.__wbg_raweventqueue_free,__wbg_rawcontactforceevent_free=__vite__wasmModule.__wbg_rawcontactforceevent_free,rawcontactforceevent_collider2=__vite__wasmModule.rawcontactforceevent_collider2,rawcontactforceevent_total_force=__vite__wasmModule.rawcontactforceevent_total_force,rawcontactforceevent_total_force_magnitude=__vite__wasmModule.rawcontactforceevent_total_force_magnitude,rawcontactforceevent_max_force_direction=__vite__wasmModule.rawcontactforceevent_max_force_direction,rawcontactforceevent_max_force_magnitude=__vite__wasmModule.rawcontactforceevent_max_force_magnitude,raweventqueue_new=__vite__wasmModule.raweventqueue_new,raweventqueue_drainCollisionEvents=__vite__wasmModule.raweventqueue_drainCollisionEvents,raweventqueue_drainContactForceEvents=__vite__wasmModule.raweventqueue_drainContactForceEvents,raweventqueue_clear=__vite__wasmModule.raweventqueue_clear,__wbg_rawphysicspipeline_free=__vite__wasmModule.__wbg_rawphysicspipeline_free,rawphysicspipeline_new=__vite__wasmModule.rawphysicspipeline_new,rawphysicspipeline_step=__vite__wasmModule.rawphysicspipeline_step,rawphysicspipeline_stepWithEvents=__vite__wasmModule.rawphysicspipeline_stepWithEvents,rawquerypipeline_new=__vite__wasmModule.rawquerypipeline_new,rawquerypipeline_update=__vite__wasmModule.rawquerypipeline_update,rawquerypipeline_castRay=__vite__wasmModule.rawquerypipeline_castRay,rawquerypipeline_castRayAndGetNormal=__vite__wasmModule.rawquerypipeline_castRayAndGetNormal,rawquerypipeline_intersectionsWithRay=__vite__wasmModule.rawquerypipeline_intersectionsWithRay,rawquerypipeline_intersectionWithShape=__vite__wasmModule.rawquerypipeline_intersectionWithShape,rawquerypipeline_projectPoint=__vite__wasmModule.rawquerypipeline_projectPoint,rawquerypipeline_projectPointAndGetFeature=__vite__wasmModule.rawquerypipeline_projectPointAndGetFeature,rawquerypipeline_intersectionsWithPoint=__vite__wasmModule.rawquerypipeline_intersectionsWithPoint,rawquerypipeline_castShape=__vite__wasmModule.rawquerypipeline_castShape,rawquerypipeline_intersectionsWithShape=__vite__wasmModule.rawquerypipeline_intersectionsWithShape,rawquerypipeline_collidersWithAabbIntersectingAabb=__vite__wasmModule.rawquerypipeline_collidersWithAabbIntersectingAabb,__wbg_rawdeserializedworld_free=__vite__wasmModule.__wbg_rawdeserializedworld_free,rawdeserializedworld_takeGravity=__vite__wasmModule.rawdeserializedworld_takeGravity,rawdeserializedworld_takeIntegrationParameters=__vite__wasmModule.rawdeserializedworld_takeIntegrationParameters,rawdeserializedworld_takeIslandManager=__vite__wasmModule.rawdeserializedworld_takeIslandManager,rawdeserializedworld_takeBroadPhase=__vite__wasmModule.rawdeserializedworld_takeBroadPhase,rawdeserializedworld_takeNarrowPhase=__vite__wasmModule.rawdeserializedworld_takeNarrowPhase,rawdeserializedworld_takeBodies=__vite__wasmModule.rawdeserializedworld_takeBodies,rawdeserializedworld_takeColliders=__vite__wasmModule.rawdeserializedworld_takeColliders,rawdeserializedworld_takeImpulseJoints=__vite__wasmModule.rawdeserializedworld_takeImpulseJoints,rawdeserializedworld_takeMultibodyJoints=__vite__wasmModule.rawdeserializedworld_takeMultibodyJoints,rawserializationpipeline_new=__vite__wasmModule.rawserializationpipeline_new,rawserializationpipeline_serializeAll=__vite__wasmModule.rawserializationpipeline_serializeAll,rawserializationpipeline_deserializeAll=__vite__wasmModule.rawserializationpipeline_deserializeAll,rawkinematiccharactercontroller_offset=__vite__wasmModule.rawkinematiccharactercontroller_offset,rawintegrationparameters_normalizedAllowedLinearError=__vite__wasmModule.rawintegrationparameters_normalizedAllowedLinearError,rawintegrationparameters_numAdditionalFrictionIterations=__vite__wasmModule.rawintegrationparameters_numAdditionalFrictionIterations,rawintegrationparameters_numInternalPgsIterations=__vite__wasmModule.rawintegrationparameters_numInternalPgsIterations,rawintegrationparameters_minIslandSize=__vite__wasmModule.rawintegrationparameters_minIslandSize,rawrigidbodyset_len=__vite__wasmModule.rawrigidbodyset_len,rawshapecontact_distance=__vite__wasmModule.rawshapecontact_distance,rawrayintersection_featureType=__vite__wasmModule.rawrayintersection_featureType,rawraycolliderintersection_colliderHandle=__vite__wasmModule.rawraycolliderintersection_colliderHandle,rawrayintersection_time_of_impact=__vite__wasmModule.rawrayintersection_time_of_impact,rawraycolliderintersection_featureType=__vite__wasmModule.rawraycolliderintersection_featureType,rawraycolliderhit_colliderHandle=__vite__wasmModule.rawraycolliderhit_colliderHandle,rawraycolliderintersection_time_of_impact=__vite__wasmModule.rawraycolliderintersection_time_of_impact,rawcollidershapecasthit_colliderHandle=__vite__wasmModule.rawcollidershapecasthit_colliderHandle,rawraycolliderhit_timeOfImpact=__vite__wasmModule.rawraycolliderhit_timeOfImpact,rawshapecasthit_time_of_impact=__vite__wasmModule.rawshapecasthit_time_of_impact,rawrotation_y=__vite__wasmModule.rawrotation_y,rawrotation_z=__vite__wasmModule.rawrotation_z,rawvector_x=__vite__wasmModule.rawvector_x,rawvector_y=__vite__wasmModule.rawvector_y,rawvector_z=__vite__wasmModule.rawvector_z,rawcontactforceevent_collider1=__vite__wasmModule.rawcontactforceevent_collider1,rawintegrationparameters_normalizedPredictionDistance=__vite__wasmModule.rawintegrationparameters_normalizedPredictionDistance,rawrayintersection_featureId=__vite__wasmModule.rawrayintersection_featureId,rawraycolliderintersection_featureId=__vite__wasmModule.rawraycolliderintersection_featureId,rawcolliderset_isHandleValid=__vite__wasmModule.rawcolliderset_isHandleValid,rawintegrationparameters_set_numAdditionalFrictionIterations=__vite__wasmModule.rawintegrationparameters_set_numAdditionalFrictionIterations,rawintegrationparameters_set_numInternalPgsIterations=__vite__wasmModule.rawintegrationparameters_set_numInternalPgsIterations,rawvector_set_y=__vite__wasmModule.rawvector_set_y,__wbg_rawcontactpair_free=__vite__wasmModule.__wbg_rawcontactpair_free,__wbg_rawraycolliderintersection_free=__vite__wasmModule.__wbg_rawraycolliderintersection_free,__wbg_rawrotation_free=__vite__wasmModule.__wbg_rawrotation_free,__wbg_rawvector_free=__vite__wasmModule.__wbg_rawvector_free,__wbg_rawsdpmatrix3_free=__vite__wasmModule.__wbg_rawsdpmatrix3_free,__wbg_rawserializationpipeline_free=__vite__wasmModule.__wbg_rawserializationpipeline_free,__wbg_rawquerypipeline_free=__vite__wasmModule.__wbg_rawquerypipeline_free,rawkinematiccharactercontroller_up=__vite__wasmModule.rawkinematiccharactercontroller_up,rawshapecontact_normal2=__vite__wasmModule.rawshapecontact_normal2,rawshapecontact_point1=__vite__wasmModule.rawshapecontact_point1,rawshapecontact_point2=__vite__wasmModule.rawshapecontact_point2,rawrayintersection_normal=__vite__wasmModule.rawrayintersection_normal,rawraycolliderintersection_normal=__vite__wasmModule.rawraycolliderintersection_normal,rawshapecontact_normal1=__vite__wasmModule.rawshapecontact_normal1,rawcollidershapecasthit_normal1=__vite__wasmModule.rawcollidershapecasthit_normal1,rawcollidershapecasthit_normal2=__vite__wasmModule.rawcollidershapecasthit_normal2,rawshapecasthit_witness2=__vite__wasmModule.rawshapecasthit_witness2,__wbindgen_add_to_stack_pointer=__vite__wasmModule.__wbindgen_add_to_stack_pointer,__wbindgen_free=__vite__wasmModule.__wbindgen_free,__wbindgen_malloc=__vite__wasmModule.__wbindgen_malloc,__wbindgen_exn_store=__vite__wasmModule.__wbindgen_exn_store,wasm=Object.freeze(Object.defineProperty({__proto__:null,__wbg_rawbroadphase_free,__wbg_rawccdsolver_free,__wbg_rawcharactercollision_free,__wbg_rawcolliderset_free,__wbg_rawcollidershapecasthit_free,__wbg_rawcontactforceevent_free,__wbg_rawcontactmanifold_free,__wbg_rawcontactpair_free,__wbg_rawdebugrenderpipeline_free,__wbg_rawdeserializedworld_free,__wbg_rawdynamicraycastvehiclecontroller_free,__wbg_raweventqueue_free,__wbg_rawgenericjoint_free,__wbg_rawimpulsejointset_free,__wbg_rawintegrationparameters_free,__wbg_rawislandmanager_free,__wbg_rawkinematiccharactercontroller_free,__wbg_rawmultibodyjointset_free,__wbg_rawnarrowphase_free,__wbg_rawphysicspipeline_free,__wbg_rawpointcolliderprojection_free,__wbg_rawpointprojection_free,__wbg_rawquerypipeline_free,__wbg_rawraycolliderhit_free,__wbg_rawraycolliderintersection_free,__wbg_rawrayintersection_free,__wbg_rawrigidbodyset_free,__wbg_rawrotation_free,__wbg_rawsdpmatrix3_free,__wbg_rawserializationpipeline_free,__wbg_rawshape_free,__wbg_rawshapecasthit_free,__wbg_rawshapecontact_free,__wbg_rawvector_free,__wbindgen_add_to_stack_pointer,__wbindgen_exn_store,__wbindgen_free,__wbindgen_malloc,memory,rawbroadphase_new,rawccdsolver_new,rawcharactercollision_handle,rawcharactercollision_new,rawcharactercollision_toi,rawcharactercollision_translationDeltaApplied,rawcharactercollision_translationDeltaRemaining,rawcharactercollision_worldNormal1,rawcharactercollision_worldNormal2,rawcharactercollision_worldWitness1,rawcharactercollision_worldWitness2,rawcolliderset_coActiveCollisionTypes,rawcolliderset_coActiveEvents,rawcolliderset_coActiveHooks,rawcolliderset_coCastCollider,rawcolliderset_coCastRay,rawcolliderset_coCastRayAndGetNormal,rawcolliderset_coCastShape,rawcolliderset_coCollisionGroups,rawcolliderset_coContactCollider,rawcolliderset_coContactForceEventThreshold,rawcolliderset_coContactShape,rawcolliderset_coContactSkin,rawcolliderset_coContainsPoint,rawcolliderset_coDensity,rawcolliderset_coFriction,rawcolliderset_coFrictionCombineRule,rawcolliderset_coHalfExtents,rawcolliderset_coHalfHeight,rawcolliderset_coHalfspaceNormal,rawcolliderset_coHeightFieldFlags,rawcolliderset_coHeightfieldHeights,rawcolliderset_coHeightfieldNCols,rawcolliderset_coHeightfieldNRows,rawcolliderset_coHeightfieldScale,rawcolliderset_coIndices,rawcolliderset_coIntersectsRay,rawcolliderset_coIntersectsShape,rawcolliderset_coIsEnabled,rawcolliderset_coIsSensor,rawcolliderset_coMass,rawcolliderset_coParent,rawcolliderset_coProjectPoint,rawcolliderset_coRadius,rawcolliderset_coRestitution,rawcolliderset_coRestitutionCombineRule,rawcolliderset_coRotation,rawcolliderset_coRoundRadius,rawcolliderset_coSetActiveCollisionTypes,rawcolliderset_coSetActiveEvents,rawcolliderset_coSetActiveHooks,rawcolliderset_coSetCollisionGroups,rawcolliderset_coSetContactForceEventThreshold,rawcolliderset_coSetContactSkin,rawcolliderset_coSetDensity,rawcolliderset_coSetEnabled,rawcolliderset_coSetFriction,rawcolliderset_coSetFrictionCombineRule,rawcolliderset_coSetHalfExtents,rawcolliderset_coSetHalfHeight,rawcolliderset_coSetMass,rawcolliderset_coSetMassProperties,rawcolliderset_coSetRadius,rawcolliderset_coSetRestitution,rawcolliderset_coSetRestitutionCombineRule,rawcolliderset_coSetRotation,rawcolliderset_coSetRotationWrtParent,rawcolliderset_coSetRoundRadius,rawcolliderset_coSetSensor,rawcolliderset_coSetShape,rawcolliderset_coSetSolverGroups,rawcolliderset_coSetTranslation,rawcolliderset_coSetTranslationWrtParent,rawcolliderset_coShapeType,rawcolliderset_coSolverGroups,rawcolliderset_coTranslation,rawcolliderset_coTriMeshFlags,rawcolliderset_coVertices,rawcolliderset_coVolume,rawcolliderset_contains,rawcolliderset_createCollider,rawcolliderset_forEachColliderHandle,rawcolliderset_isHandleValid,rawcolliderset_len,rawcolliderset_new,rawcolliderset_remove,rawcollidershapecasthit_colliderHandle,rawcollidershapecasthit_normal1,rawcollidershapecasthit_normal2,rawcollidershapecasthit_time_of_impact,rawcollidershapecasthit_witness1,rawcollidershapecasthit_witness2,rawcontactforceevent_collider1,rawcontactforceevent_collider2,rawcontactforceevent_max_force_direction,rawcontactforceevent_max_force_magnitude,rawcontactforceevent_total_force,rawcontactforceevent_total_force_magnitude,rawcontactmanifold_contact_dist,rawcontactmanifold_contact_fid1,rawcontactmanifold_contact_fid2,rawcontactmanifold_contact_impulse,rawcontactmanifold_contact_local_p1,rawcontactmanifold_contact_local_p2,rawcontactmanifold_contact_tangent_impulse_x,rawcontactmanifold_contact_tangent_impulse_y,rawcontactmanifold_local_n1,rawcontactmanifold_local_n2,rawcontactmanifold_normal,rawcontactmanifold_num_contacts,rawcontactmanifold_num_solver_contacts,rawcontactmanifold_solver_contact_dist,rawcontactmanifold_solver_contact_friction,rawcontactmanifold_solver_contact_point,rawcontactmanifold_solver_contact_restitution,rawcontactmanifold_solver_contact_tangent_velocity,rawcontactmanifold_subshape1,rawcontactmanifold_subshape2,rawcontactpair_collider1,rawcontactpair_collider2,rawcontactpair_contactManifold,rawcontactpair_numContactManifolds,rawdebugrenderpipeline_colors,rawdebugrenderpipeline_new,rawdebugrenderpipeline_render,rawdebugrenderpipeline_vertices,rawdeserializedworld_takeBodies,rawdeserializedworld_takeBroadPhase,rawdeserializedworld_takeColliders,rawdeserializedworld_takeGravity,rawdeserializedworld_takeImpulseJoints,rawdeserializedworld_takeIntegrationParameters,rawdeserializedworld_takeIslandManager,rawdeserializedworld_takeMultibodyJoints,rawdeserializedworld_takeNarrowPhase,rawdynamicraycastvehiclecontroller_add_wheel,rawdynamicraycastvehiclecontroller_chassis,rawdynamicraycastvehiclecontroller_current_vehicle_speed,rawdynamicraycastvehiclecontroller_index_forward_axis,rawdynamicraycastvehiclecontroller_index_up_axis,rawdynamicraycastvehiclecontroller_new,rawdynamicraycastvehiclecontroller_num_wheels,rawdynamicraycastvehiclecontroller_set_index_forward_axis,rawdynamicraycastvehiclecontroller_set_index_up_axis,rawdynamicraycastvehiclecontroller_set_wheel_axle_cs,rawdynamicraycastvehiclecontroller_set_wheel_brake,rawdynamicraycastvehiclecontroller_set_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_set_wheel_direction_cs,rawdynamicraycastvehiclecontroller_set_wheel_engine_force,rawdynamicraycastvehiclecontroller_set_wheel_friction_slip,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_set_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_set_wheel_radius,rawdynamicraycastvehiclecontroller_set_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_set_wheel_steering,rawdynamicraycastvehiclecontroller_set_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_set_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_set_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_set_wheel_suspension_stiffness,rawdynamicraycastvehiclecontroller_update_vehicle,rawdynamicraycastvehiclecontroller_wheel_axle_cs,rawdynamicraycastvehiclecontroller_wheel_brake,rawdynamicraycastvehiclecontroller_wheel_chassis_connection_point_cs,rawdynamicraycastvehiclecontroller_wheel_contact_normal_ws,rawdynamicraycastvehiclecontroller_wheel_contact_point_ws,rawdynamicraycastvehiclecontroller_wheel_direction_cs,rawdynamicraycastvehiclecontroller_wheel_engine_force,rawdynamicraycastvehiclecontroller_wheel_forward_impulse,rawdynamicraycastvehiclecontroller_wheel_friction_slip,rawdynamicraycastvehiclecontroller_wheel_ground_object,rawdynamicraycastvehiclecontroller_wheel_hard_point_ws,rawdynamicraycastvehiclecontroller_wheel_is_in_contact,rawdynamicraycastvehiclecontroller_wheel_max_suspension_force,rawdynamicraycastvehiclecontroller_wheel_max_suspension_travel,rawdynamicraycastvehiclecontroller_wheel_radius,rawdynamicraycastvehiclecontroller_wheel_rotation,rawdynamicraycastvehiclecontroller_wheel_side_friction_stiffness,rawdynamicraycastvehiclecontroller_wheel_side_impulse,rawdynamicraycastvehiclecontroller_wheel_steering,rawdynamicraycastvehiclecontroller_wheel_suspension_compression,rawdynamicraycastvehiclecontroller_wheel_suspension_force,rawdynamicraycastvehiclecontroller_wheel_suspension_length,rawdynamicraycastvehiclecontroller_wheel_suspension_relaxation,rawdynamicraycastvehiclecontroller_wheel_suspension_rest_length,rawdynamicraycastvehiclecontroller_wheel_suspension_stiffness,raweventqueue_clear,raweventqueue_drainCollisionEvents,raweventqueue_drainContactForceEvents,raweventqueue_new,rawgenericjoint_fixed,rawgenericjoint_generic,rawgenericjoint_prismatic,rawgenericjoint_revolute,rawgenericjoint_rope,rawgenericjoint_spherical,rawgenericjoint_spring,rawimpulsejointset_contains,rawimpulsejointset_createJoint,rawimpulsejointset_forEachJointAttachedToRigidBody,rawimpulsejointset_forEachJointHandle,rawimpulsejointset_jointAnchor1,rawimpulsejointset_jointAnchor2,rawimpulsejointset_jointBodyHandle1,rawimpulsejointset_jointBodyHandle2,rawimpulsejointset_jointConfigureMotor,rawimpulsejointset_jointConfigureMotorModel,rawimpulsejointset_jointConfigureMotorPosition,rawimpulsejointset_jointConfigureMotorVelocity,rawimpulsejointset_jointContactsEnabled,rawimpulsejointset_jointFrameX1,rawimpulsejointset_jointFrameX2,rawimpulsejointset_jointLimitsEnabled,rawimpulsejointset_jointLimitsMax,rawimpulsejointset_jointLimitsMin,rawimpulsejointset_jointSetAnchor1,rawimpulsejointset_jointSetAnchor2,rawimpulsejointset_jointSetContactsEnabled,rawimpulsejointset_jointSetLimits,rawimpulsejointset_jointType,rawimpulsejointset_len,rawimpulsejointset_new,rawimpulsejointset_remove,rawintegrationparameters_contact_erp,rawintegrationparameters_dt,rawintegrationparameters_lengthUnit,rawintegrationparameters_maxCcdSubsteps,rawintegrationparameters_minIslandSize,rawintegrationparameters_new,rawintegrationparameters_normalizedAllowedLinearError,rawintegrationparameters_normalizedPredictionDistance,rawintegrationparameters_numAdditionalFrictionIterations,rawintegrationparameters_numInternalPgsIterations,rawintegrationparameters_numSolverIterations,rawintegrationparameters_set_contact_natural_frequency,rawintegrationparameters_set_dt,rawintegrationparameters_set_lengthUnit,rawintegrationparameters_set_maxCcdSubsteps,rawintegrationparameters_set_minIslandSize,rawintegrationparameters_set_normalizedAllowedLinearError,rawintegrationparameters_set_normalizedPredictionDistance,rawintegrationparameters_set_numAdditionalFrictionIterations,rawintegrationparameters_set_numInternalPgsIterations,rawintegrationparameters_set_numSolverIterations,rawintegrationparameters_switchToSmallStepsPgsSolver,rawintegrationparameters_switchToSmallStepsPgsSolverWithoutWarmstart,rawintegrationparameters_switchToStandardPgsSolver,rawislandmanager_forEachActiveRigidBodyHandle,rawislandmanager_new,rawkinematiccharactercontroller_autostepEnabled,rawkinematiccharactercontroller_autostepIncludesDynamicBodies,rawkinematiccharactercontroller_autostepMaxHeight,rawkinematiccharactercontroller_autostepMinWidth,rawkinematiccharactercontroller_computeColliderMovement,rawkinematiccharactercontroller_computedCollision,rawkinematiccharactercontroller_computedGrounded,rawkinematiccharactercontroller_computedMovement,rawkinematiccharactercontroller_disableAutostep,rawkinematiccharactercontroller_disableSnapToGround,rawkinematiccharactercontroller_enableAutostep,rawkinematiccharactercontroller_enableSnapToGround,rawkinematiccharactercontroller_maxSlopeClimbAngle,rawkinematiccharactercontroller_minSlopeSlideAngle,rawkinematiccharactercontroller_new,rawkinematiccharactercontroller_normalNudgeFactor,rawkinematiccharactercontroller_numComputedCollisions,rawkinematiccharactercontroller_offset,rawkinematiccharactercontroller_setMaxSlopeClimbAngle,rawkinematiccharactercontroller_setMinSlopeSlideAngle,rawkinematiccharactercontroller_setNormalNudgeFactor,rawkinematiccharactercontroller_setOffset,rawkinematiccharactercontroller_setSlideEnabled,rawkinematiccharactercontroller_setUp,rawkinematiccharactercontroller_slideEnabled,rawkinematiccharactercontroller_snapToGroundDistance,rawkinematiccharactercontroller_snapToGroundEnabled,rawkinematiccharactercontroller_up,rawmultibodyjointset_contains,rawmultibodyjointset_createJoint,rawmultibodyjointset_forEachJointAttachedToRigidBody,rawmultibodyjointset_forEachJointHandle,rawmultibodyjointset_jointAnchor1,rawmultibodyjointset_jointAnchor2,rawmultibodyjointset_jointContactsEnabled,rawmultibodyjointset_jointFrameX1,rawmultibodyjointset_jointFrameX2,rawmultibodyjointset_jointLimitsEnabled,rawmultibodyjointset_jointLimitsMax,rawmultibodyjointset_jointLimitsMin,rawmultibodyjointset_jointSetContactsEnabled,rawmultibodyjointset_jointType,rawmultibodyjointset_new,rawmultibodyjointset_remove,rawnarrowphase_contact_pair,rawnarrowphase_contact_pairs_with,rawnarrowphase_intersection_pair,rawnarrowphase_intersection_pairs_with,rawnarrowphase_new,rawphysicspipeline_new,rawphysicspipeline_step,rawphysicspipeline_stepWithEvents,rawpointcolliderprojection_colliderHandle,rawpointcolliderprojection_featureId,rawpointcolliderprojection_featureType,rawpointcolliderprojection_isInside,rawpointcolliderprojection_point,rawpointprojection_isInside,rawpointprojection_point,rawquerypipeline_castRay,rawquerypipeline_castRayAndGetNormal,rawquerypipeline_castShape,rawquerypipeline_collidersWithAabbIntersectingAabb,rawquerypipeline_intersectionWithShape,rawquerypipeline_intersectionsWithPoint,rawquerypipeline_intersectionsWithRay,rawquerypipeline_intersectionsWithShape,rawquerypipeline_new,rawquerypipeline_projectPoint,rawquerypipeline_projectPointAndGetFeature,rawquerypipeline_update,rawraycolliderhit_colliderHandle,rawraycolliderhit_timeOfImpact,rawraycolliderintersection_colliderHandle,rawraycolliderintersection_featureId,rawraycolliderintersection_featureType,rawraycolliderintersection_normal,rawraycolliderintersection_time_of_impact,rawrayintersection_featureId,rawrayintersection_featureType,rawrayintersection_normal,rawrayintersection_time_of_impact,rawrigidbodyset_contains,rawrigidbodyset_createRigidBody,rawrigidbodyset_forEachRigidBodyHandle,rawrigidbodyset_len,rawrigidbodyset_new,rawrigidbodyset_propagateModifiedBodyPositionsToColliders,rawrigidbodyset_rbAddForce,rawrigidbodyset_rbAddForceAtPoint,rawrigidbodyset_rbAddTorque,rawrigidbodyset_rbAdditionalSolverIterations,rawrigidbodyset_rbAngularDamping,rawrigidbodyset_rbAngvel,rawrigidbodyset_rbApplyImpulse,rawrigidbodyset_rbApplyImpulseAtPoint,rawrigidbodyset_rbApplyTorqueImpulse,rawrigidbodyset_rbBodyType,rawrigidbodyset_rbCollider,rawrigidbodyset_rbDominanceGroup,rawrigidbodyset_rbEffectiveAngularInertia,rawrigidbodyset_rbEffectiveInvMass,rawrigidbodyset_rbEffectiveWorldInvInertiaSqrt,rawrigidbodyset_rbEnableCcd,rawrigidbodyset_rbGravityScale,rawrigidbodyset_rbInvMass,rawrigidbodyset_rbInvPrincipalInertiaSqrt,rawrigidbodyset_rbIsCcdEnabled,rawrigidbodyset_rbIsDynamic,rawrigidbodyset_rbIsEnabled,rawrigidbodyset_rbIsFixed,rawrigidbodyset_rbIsKinematic,rawrigidbodyset_rbIsMoving,rawrigidbodyset_rbIsSleeping,rawrigidbodyset_rbLinearDamping,rawrigidbodyset_rbLinvel,rawrigidbodyset_rbLocalCom,rawrigidbodyset_rbLockRotations,rawrigidbodyset_rbLockTranslations,rawrigidbodyset_rbMass,rawrigidbodyset_rbNextRotation,rawrigidbodyset_rbNextTranslation,rawrigidbodyset_rbNumColliders,rawrigidbodyset_rbPrincipalInertia,rawrigidbodyset_rbPrincipalInertiaLocalFrame,rawrigidbodyset_rbRecomputeMassPropertiesFromColliders,rawrigidbodyset_rbResetForces,rawrigidbodyset_rbResetTorques,rawrigidbodyset_rbRotation,rawrigidbodyset_rbSetAdditionalMass,rawrigidbodyset_rbSetAdditionalMassProperties,rawrigidbodyset_rbSetAdditionalSolverIterations,rawrigidbodyset_rbSetAngularDamping,rawrigidbodyset_rbSetAngvel,rawrigidbodyset_rbSetBodyType,rawrigidbodyset_rbSetDominanceGroup,rawrigidbodyset_rbSetEnabled,rawrigidbodyset_rbSetEnabledRotations,rawrigidbodyset_rbSetEnabledTranslations,rawrigidbodyset_rbSetGravityScale,rawrigidbodyset_rbSetLinearDamping,rawrigidbodyset_rbSetLinvel,rawrigidbodyset_rbSetNextKinematicRotation,rawrigidbodyset_rbSetNextKinematicTranslation,rawrigidbodyset_rbSetRotation,rawrigidbodyset_rbSetSoftCcdPrediction,rawrigidbodyset_rbSetTranslation,rawrigidbodyset_rbSetUserData,rawrigidbodyset_rbSleep,rawrigidbodyset_rbSoftCcdPrediction,rawrigidbodyset_rbTranslation,rawrigidbodyset_rbUserData,rawrigidbodyset_rbUserForce,rawrigidbodyset_rbUserTorque,rawrigidbodyset_rbWakeUp,rawrigidbodyset_rbWorldCom,rawrigidbodyset_remove,rawrotation_identity,rawrotation_new,rawrotation_w,rawrotation_x,rawrotation_y,rawrotation_z,rawsdpmatrix3_elements,rawserializationpipeline_deserializeAll,rawserializationpipeline_new,rawserializationpipeline_serializeAll,rawshape_ball,rawshape_capsule,rawshape_castRay,rawshape_castRayAndGetNormal,rawshape_castShape,rawshape_cone,rawshape_contactShape,rawshape_containsPoint,rawshape_convexHull,rawshape_convexMesh,rawshape_cuboid,rawshape_cylinder,rawshape_halfspace,rawshape_heightfield,rawshape_intersectsRay,rawshape_intersectsShape,rawshape_polyline,rawshape_projectPoint,rawshape_roundCone,rawshape_roundConvexHull,rawshape_roundConvexMesh,rawshape_roundCuboid,rawshape_roundCylinder,rawshape_roundTriangle,rawshape_segment,rawshape_triangle,rawshape_trimesh,rawshapecasthit_normal1,rawshapecasthit_normal2,rawshapecasthit_time_of_impact,rawshapecasthit_witness1,rawshapecasthit_witness2,rawshapecontact_distance,rawshapecontact_normal1,rawshapecontact_normal2,rawshapecontact_point1,rawshapecontact_point2,rawvector_new,rawvector_set_x,rawvector_set_y,rawvector_set_z,rawvector_x,rawvector_xyz,rawvector_xzy,rawvector_y,rawvector_yxz,rawvector_yzx,rawvector_z,rawvector_zero,rawvector_zxy,rawvector_zyx,version:version$2},Symbol.toStringTag,{value:"Module"}));__wbg_set_wasm(wasm);class Vector3{constructor(er,tr,ir){this.x=er,this.y=tr,this.z=ir}}class VectorOps{static new(er,tr,ir){return new Vector3(er,tr,ir)}static intoRaw(er){return new RawVector(er.x,er.y,er.z)}static zeros(){return VectorOps.new(0,0,0)}static fromRaw(er){if(!er)return null;let tr=VectorOps.new(er.x,er.y,er.z);return er.free(),tr}static copy(er,tr){er.x=tr.x,er.y=tr.y,er.z=tr.z}}class Quaternion{constructor(er,tr,ir,nr){this.x=er,this.y=tr,this.z=ir,this.w=nr}}class RotationOps{static identity(){return new Quaternion(0,0,0,1)}static fromRaw(er){if(!er)return null;let tr=new Quaternion(er.x,er.y,er.z,er.w);return er.free(),tr}static intoRaw(er){return new RawRotation(er.x,er.y,er.z,er.w)}static copy(er,tr){er.x=tr.x,er.y=tr.y,er.z=tr.z,er.w=tr.w}}class SdpMatrix3{constructor(er){this.elements=er}get m11(){return this.elements[0]}get m12(){return this.elements[1]}get m21(){return this.m12}get m13(){return this.elements[2]}get m31(){return this.m13}get m22(){return this.elements[3]}get m23(){return this.elements[4]}get m32(){return this.m23}get m33(){return this.elements[5]}}class SdpMatrix3Ops{static fromRaw(er){const tr=new SdpMatrix3(er.elements());return er.free(),tr}}var RigidBodyType;(function(rr){rr[rr.Dynamic=0]="Dynamic",rr[rr.Fixed=1]="Fixed",rr[rr.KinematicPositionBased=2]="KinematicPositionBased",rr[rr.KinematicVelocityBased=3]="KinematicVelocityBased"})(RigidBodyType||(RigidBodyType={}));let RigidBody$1=class{constructor(er,tr,ir){this.rawSet=er,this.colliderSet=tr,this.handle=ir}finalizeDeserialization(er){this.colliderSet=er}isValid(){return this.rawSet.contains(this.handle)}lockTranslations(er,tr){return this.rawSet.rbLockTranslations(this.handle,er,tr)}lockRotations(er,tr){return this.rawSet.rbLockRotations(this.handle,er,tr)}setEnabledTranslations(er,tr,ir,nr){return this.rawSet.rbSetEnabledTranslations(this.handle,er,tr,ir,nr)}restrictTranslations(er,tr,ir,nr){this.setEnabledTranslations(er,tr,ir,nr)}setEnabledRotations(er,tr,ir,nr){return this.rawSet.rbSetEnabledRotations(this.handle,er,tr,ir,nr)}restrictRotations(er,tr,ir,nr){this.setEnabledRotations(er,tr,ir,nr)}dominanceGroup(){return this.rawSet.rbDominanceGroup(this.handle)}setDominanceGroup(er){this.rawSet.rbSetDominanceGroup(this.handle,er)}additionalSolverIterations(){return this.rawSet.rbAdditionalSolverIterations(this.handle)}setAdditionalSolverIterations(er){this.rawSet.rbSetAdditionalSolverIterations(this.handle,er)}enableCcd(er){this.rawSet.rbEnableCcd(this.handle,er)}setSoftCcdPrediction(er){this.rawSet.rbSetSoftCcdPrediction(this.handle,er)}softCcdPrediction(){return this.rawSet.rbSoftCcdPrediction(this.handle)}translation(){let er=this.rawSet.rbTranslation(this.handle);return VectorOps.fromRaw(er)}rotation(){let er=this.rawSet.rbRotation(this.handle);return RotationOps.fromRaw(er)}nextTranslation(){let er=this.rawSet.rbNextTranslation(this.handle);return VectorOps.fromRaw(er)}nextRotation(){let er=this.rawSet.rbNextRotation(this.handle);return RotationOps.fromRaw(er)}setTranslation(er,tr){this.rawSet.rbSetTranslation(this.handle,er.x,er.y,er.z,tr)}setLinvel(er,tr){let ir=VectorOps.intoRaw(er);this.rawSet.rbSetLinvel(this.handle,ir,tr),ir.free()}gravityScale(){return this.rawSet.rbGravityScale(this.handle)}setGravityScale(er,tr){this.rawSet.rbSetGravityScale(this.handle,er,tr)}setRotation(er,tr){this.rawSet.rbSetRotation(this.handle,er.x,er.y,er.z,er.w,tr)}setAngvel(er,tr){let ir=VectorOps.intoRaw(er);this.rawSet.rbSetAngvel(this.handle,ir,tr),ir.free()}setNextKinematicTranslation(er){this.rawSet.rbSetNextKinematicTranslation(this.handle,er.x,er.y,er.z)}setNextKinematicRotation(er){this.rawSet.rbSetNextKinematicRotation(this.handle,er.x,er.y,er.z,er.w)}linvel(){return VectorOps.fromRaw(this.rawSet.rbLinvel(this.handle))}angvel(){return VectorOps.fromRaw(this.rawSet.rbAngvel(this.handle))}mass(){return this.rawSet.rbMass(this.handle)}effectiveInvMass(){return VectorOps.fromRaw(this.rawSet.rbEffectiveInvMass(this.handle))}invMass(){return this.rawSet.rbInvMass(this.handle)}localCom(){return VectorOps.fromRaw(this.rawSet.rbLocalCom(this.handle))}worldCom(){return VectorOps.fromRaw(this.rawSet.rbWorldCom(this.handle))}invPrincipalInertiaSqrt(){return VectorOps.fromRaw(this.rawSet.rbInvPrincipalInertiaSqrt(this.handle))}principalInertia(){return VectorOps.fromRaw(this.rawSet.rbPrincipalInertia(this.handle))}principalInertiaLocalFrame(){return RotationOps.fromRaw(this.rawSet.rbPrincipalInertiaLocalFrame(this.handle))}effectiveWorldInvInertiaSqrt(){return SdpMatrix3Ops.fromRaw(this.rawSet.rbEffectiveWorldInvInertiaSqrt(this.handle))}effectiveAngularInertia(){return SdpMatrix3Ops.fromRaw(this.rawSet.rbEffectiveAngularInertia(this.handle))}sleep(){this.rawSet.rbSleep(this.handle)}wakeUp(){this.rawSet.rbWakeUp(this.handle)}isCcdEnabled(){return this.rawSet.rbIsCcdEnabled(this.handle)}numColliders(){return this.rawSet.rbNumColliders(this.handle)}collider(er){return this.colliderSet.get(this.rawSet.rbCollider(this.handle,er))}setEnabled(er){this.rawSet.rbSetEnabled(this.handle,er)}isEnabled(){return this.rawSet.rbIsEnabled(this.handle)}bodyType(){return this.rawSet.rbBodyType(this.handle)}setBodyType(er,tr){return this.rawSet.rbSetBodyType(this.handle,er,tr)}isSleeping(){return this.rawSet.rbIsSleeping(this.handle)}isMoving(){return this.rawSet.rbIsMoving(this.handle)}isFixed(){return this.rawSet.rbIsFixed(this.handle)}isKinematic(){return this.rawSet.rbIsKinematic(this.handle)}isDynamic(){return this.rawSet.rbIsDynamic(this.handle)}linearDamping(){return this.rawSet.rbLinearDamping(this.handle)}angularDamping(){return this.rawSet.rbAngularDamping(this.handle)}setLinearDamping(er){this.rawSet.rbSetLinearDamping(this.handle,er)}recomputeMassPropertiesFromColliders(){this.rawSet.rbRecomputeMassPropertiesFromColliders(this.handle,this.colliderSet.raw)}setAdditionalMass(er,tr){this.rawSet.rbSetAdditionalMass(this.handle,er,tr)}setAdditionalMassProperties(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(tr),or=VectorOps.intoRaw(ir),lr=RotationOps.intoRaw(nr);this.rawSet.rbSetAdditionalMassProperties(this.handle,er,ar,or,lr,sr),ar.free(),or.free(),lr.free()}setAngularDamping(er){this.rawSet.rbSetAngularDamping(this.handle,er)}resetForces(er){this.rawSet.rbResetForces(this.handle,er)}resetTorques(er){this.rawSet.rbResetTorques(this.handle,er)}addForce(er,tr){const ir=VectorOps.intoRaw(er);this.rawSet.rbAddForce(this.handle,ir,tr),ir.free()}applyImpulse(er,tr){const ir=VectorOps.intoRaw(er);this.rawSet.rbApplyImpulse(this.handle,ir,tr),ir.free()}addTorque(er,tr){const ir=VectorOps.intoRaw(er);this.rawSet.rbAddTorque(this.handle,ir,tr),ir.free()}applyTorqueImpulse(er,tr){const ir=VectorOps.intoRaw(er);this.rawSet.rbApplyTorqueImpulse(this.handle,ir,tr),ir.free()}addForceAtPoint(er,tr,ir){const nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.rawSet.rbAddForceAtPoint(this.handle,nr,sr,ir),nr.free(),sr.free()}applyImpulseAtPoint(er,tr,ir){const nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.rawSet.rbApplyImpulseAtPoint(this.handle,nr,sr,ir),nr.free(),sr.free()}userForce(){return VectorOps.fromRaw(this.rawSet.rbUserForce(this.handle))}userTorque(){return VectorOps.fromRaw(this.rawSet.rbUserTorque(this.handle))}};class RigidBodyDesc{constructor(er){this.enabled=!0,this.status=er,this.translation=VectorOps.zeros(),this.rotation=RotationOps.identity(),this.gravityScale=1,this.linvel=VectorOps.zeros(),this.mass=0,this.massOnly=!1,this.centerOfMass=VectorOps.zeros(),this.translationsEnabledX=!0,this.translationsEnabledY=!0,this.angvel=VectorOps.zeros(),this.principalAngularInertia=VectorOps.zeros(),this.angularInertiaLocalFrame=RotationOps.identity(),this.translationsEnabledZ=!0,this.rotationsEnabledX=!0,this.rotationsEnabledY=!0,this.rotationsEnabledZ=!0,this.linearDamping=0,this.angularDamping=0,this.canSleep=!0,this.sleeping=!1,this.ccdEnabled=!1,this.softCcdPrediction=0,this.dominanceGroup=0,this.additionalSolverIterations=0}static dynamic(){return new RigidBodyDesc(RigidBodyType.Dynamic)}static kinematicPositionBased(){return new RigidBodyDesc(RigidBodyType.KinematicPositionBased)}static kinematicVelocityBased(){return new RigidBodyDesc(RigidBodyType.KinematicVelocityBased)}static fixed(){return new RigidBodyDesc(RigidBodyType.Fixed)}static newDynamic(){return new RigidBodyDesc(RigidBodyType.Dynamic)}static newKinematicPositionBased(){return new RigidBodyDesc(RigidBodyType.KinematicPositionBased)}static newKinematicVelocityBased(){return new RigidBodyDesc(RigidBodyType.KinematicVelocityBased)}static newStatic(){return new RigidBodyDesc(RigidBodyType.Fixed)}setDominanceGroup(er){return this.dominanceGroup=er,this}setAdditionalSolverIterations(er){return this.additionalSolverIterations=er,this}setEnabled(er){return this.enabled=er,this}setTranslation(er,tr,ir){if(typeof er!="number"||typeof tr!="number"||typeof ir!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:er,y:tr,z:ir},this}setRotation(er){return RotationOps.copy(this.rotation,er),this}setGravityScale(er){return this.gravityScale=er,this}setAdditionalMass(er){return this.mass=er,this.massOnly=!0,this}setLinvel(er,tr,ir){if(typeof er!="number"||typeof tr!="number"||typeof ir!="number")throw TypeError("The linvel components must be numbers.");return this.linvel={x:er,y:tr,z:ir},this}setAngvel(er){return VectorOps.copy(this.angvel,er),this}setAdditionalMassProperties(er,tr,ir,nr){return this.mass=er,VectorOps.copy(this.centerOfMass,tr),VectorOps.copy(this.principalAngularInertia,ir),RotationOps.copy(this.angularInertiaLocalFrame,nr),this.massOnly=!1,this}enabledTranslations(er,tr,ir){return this.translationsEnabledX=er,this.translationsEnabledY=tr,this.translationsEnabledZ=ir,this}restrictTranslations(er,tr,ir){return this.enabledTranslations(er,tr,ir)}lockTranslations(){return this.enabledTranslations(!1,!1,!1)}enabledRotations(er,tr,ir){return this.rotationsEnabledX=er,this.rotationsEnabledY=tr,this.rotationsEnabledZ=ir,this}restrictRotations(er,tr,ir){return this.enabledRotations(er,tr,ir)}lockRotations(){return this.restrictRotations(!1,!1,!1)}setLinearDamping(er){return this.linearDamping=er,this}setAngularDamping(er){return this.angularDamping=er,this}setCanSleep(er){return this.canSleep=er,this}setSleeping(er){return this.sleeping=er,this}setCcdEnabled(er){return this.ccdEnabled=er,this}setSoftCcdPrediction(er){return this.softCcdPrediction=er,this}setUserData(er){return this.userData=er,this}}class Coarena{constructor(){this.fconv=new Float64Array(1),this.uconv=new Uint32Array(this.fconv.buffer),this.data=new Array,this.size=0}set(er,tr){let ir=this.index(er);for(;this.data.length<=ir;)this.data.push(null);this.data[ir]==null&&(this.size+=1),this.data[ir]=tr}len(){return this.size}delete(er){let tr=this.index(er);tr<this.data.length&&(this.data[tr]!=null&&(this.size-=1),this.data[tr]=null)}clear(){this.data=new Array}get(er){let tr=this.index(er);return tr<this.data.length?this.data[tr]:null}forEach(er){for(const tr of this.data)tr!=null&&er(tr)}getAll(){return this.data.filter(er=>er!=null)}index(er){return this.fconv[0]=er,this.uconv[0]}}class RigidBodySet{constructor(er){this.raw=er||new RawRigidBodySet,this.map=new Coarena,er&&er.forEachRigidBodyHandle(tr=>{this.map.set(tr,new RigidBody$1(er,null,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createRigidBody(er,tr){let ir=VectorOps.intoRaw(tr.translation),nr=RotationOps.intoRaw(tr.rotation),sr=VectorOps.intoRaw(tr.linvel),ar=VectorOps.intoRaw(tr.centerOfMass),or=VectorOps.intoRaw(tr.angvel),lr=VectorOps.intoRaw(tr.principalAngularInertia),cr=RotationOps.intoRaw(tr.angularInertiaLocalFrame),ur=this.raw.createRigidBody(tr.enabled,ir,nr,tr.gravityScale,tr.mass,tr.massOnly,ar,sr,or,lr,cr,tr.translationsEnabledX,tr.translationsEnabledY,tr.translationsEnabledZ,tr.rotationsEnabledX,tr.rotationsEnabledY,tr.rotationsEnabledZ,tr.linearDamping,tr.angularDamping,tr.status,tr.canSleep,tr.sleeping,tr.softCcdPrediction,tr.ccdEnabled,tr.dominanceGroup,tr.additionalSolverIterations);ir.free(),nr.free(),sr.free(),ar.free(),or.free(),lr.free(),cr.free();const dr=new RigidBody$1(this.raw,er,ur);return dr.userData=tr.userData,this.map.set(ur,dr),dr}remove(er,tr,ir,nr,sr){for(let ar=0;ar<this.raw.rbNumColliders(er);ar+=1)ir.unmap(this.raw.rbCollider(er,ar));nr.forEachJointHandleAttachedToRigidBody(er,ar=>nr.unmap(ar)),sr.forEachJointHandleAttachedToRigidBody(er,ar=>sr.unmap(ar)),this.raw.remove(er,tr.raw,ir.raw,nr.raw,sr.raw),this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}forEachActiveRigidBody(er,tr){er.forEachActiveRigidBodyHandle(ir=>{tr(this.get(ir))})}getAll(){return this.map.getAll()}}class IntegrationParameters{constructor(er){this.raw=er||new RawIntegrationParameters}free(){this.raw&&this.raw.free(),this.raw=void 0}get dt(){return this.raw.dt}get contact_erp(){return this.raw.contact_erp}get lengthUnit(){return this.raw.lengthUnit}get normalizedAllowedLinearError(){return this.raw.normalizedAllowedLinearError}get normalizedPredictionDistance(){return this.raw.normalizedPredictionDistance}get numSolverIterations(){return this.raw.numSolverIterations}get numAdditionalFrictionIterations(){return this.raw.numAdditionalFrictionIterations}get numInternalPgsIterations(){return this.raw.numInternalPgsIterations}get minIslandSize(){return this.raw.minIslandSize}get maxCcdSubsteps(){return this.raw.maxCcdSubsteps}set dt(er){this.raw.dt=er}set contact_natural_frequency(er){this.raw.contact_natural_frequency=er}set lengthUnit(er){this.raw.lengthUnit=er}set normalizedAllowedLinearError(er){this.raw.normalizedAllowedLinearError=er}set normalizedPredictionDistance(er){this.raw.normalizedPredictionDistance=er}set numSolverIterations(er){this.raw.numSolverIterations=er}set numAdditionalFrictionIterations(er){this.raw.numAdditionalFrictionIterations=er}set numInternalPgsIterations(er){this.raw.numInternalPgsIterations=er}set minIslandSize(er){this.raw.minIslandSize=er}set maxCcdSubsteps(er){this.raw.maxCcdSubsteps=er}switchToStandardPgsSolver(){this.raw.switchToStandardPgsSolver()}switchToSmallStepsPgsSolver(){this.raw.switchToSmallStepsPgsSolver()}switchToSmallStepsPgsSolverWithoutWarmstart(){this.raw.switchToSmallStepsPgsSolverWithoutWarmstart()}}var JointType;(function(rr){rr[rr.Revolute=0]="Revolute",rr[rr.Fixed=1]="Fixed",rr[rr.Prismatic=2]="Prismatic",rr[rr.Rope=3]="Rope",rr[rr.Spring=4]="Spring",rr[rr.Spherical=5]="Spherical",rr[rr.Generic=6]="Generic"})(JointType||(JointType={}));var MotorModel;(function(rr){rr[rr.AccelerationBased=0]="AccelerationBased",rr[rr.ForceBased=1]="ForceBased"})(MotorModel||(MotorModel={}));var JointAxesMask;(function(rr){rr[rr.LinX=1]="LinX",rr[rr.LinY=2]="LinY",rr[rr.LinZ=4]="LinZ",rr[rr.AngX=8]="AngX",rr[rr.AngY=16]="AngY",rr[rr.AngZ=32]="AngZ"})(JointAxesMask||(JointAxesMask={}));class ImpulseJoint{constructor(er,tr,ir){this.rawSet=er,this.bodySet=tr,this.handle=ir}static newTyped(er,tr,ir){switch(er.jointType(ir)){case RawJointType.Revolute:return new RevoluteImpulseJoint(er,tr,ir);case RawJointType.Prismatic:return new PrismaticImpulseJoint(er,tr,ir);case RawJointType.Fixed:return new FixedImpulseJoint(er,tr,ir);case RawJointType.Spring:return new SpringImpulseJoint(er,tr,ir);case RawJointType.Rope:return new RopeImpulseJoint(er,tr,ir);case RawJointType.Spherical:return new SphericalImpulseJoint(er,tr,ir);case RawJointType.Generic:return new GenericImpulseJoint(er,tr,ir);default:return new ImpulseJoint(er,tr,ir)}}finalizeDeserialization(er){this.bodySet=er}isValid(){return this.rawSet.contains(this.handle)}body1(){return this.bodySet.get(this.rawSet.jointBodyHandle1(this.handle))}body2(){return this.bodySet.get(this.rawSet.jointBodyHandle2(this.handle))}type(){return this.rawSet.jointType(this.handle)}frameX1(){return RotationOps.fromRaw(this.rawSet.jointFrameX1(this.handle))}frameX2(){return RotationOps.fromRaw(this.rawSet.jointFrameX2(this.handle))}anchor1(){return VectorOps.fromRaw(this.rawSet.jointAnchor1(this.handle))}anchor2(){return VectorOps.fromRaw(this.rawSet.jointAnchor2(this.handle))}setAnchor1(er){const tr=VectorOps.intoRaw(er);this.rawSet.jointSetAnchor1(this.handle,tr),tr.free()}setAnchor2(er){const tr=VectorOps.intoRaw(er);this.rawSet.jointSetAnchor2(this.handle,tr),tr.free()}setContactsEnabled(er){this.rawSet.jointSetContactsEnabled(this.handle,er)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class UnitImpulseJoint extends ImpulseJoint{limitsEnabled(){return this.rawSet.jointLimitsEnabled(this.handle,this.rawAxis())}limitsMin(){return this.rawSet.jointLimitsMin(this.handle,this.rawAxis())}limitsMax(){return this.rawSet.jointLimitsMax(this.handle,this.rawAxis())}setLimits(er,tr){this.rawSet.jointSetLimits(this.handle,this.rawAxis(),er,tr)}configureMotorModel(er){this.rawSet.jointConfigureMotorModel(this.handle,this.rawAxis(),er)}configureMotorVelocity(er,tr){this.rawSet.jointConfigureMotorVelocity(this.handle,this.rawAxis(),er,tr)}configureMotorPosition(er,tr,ir){this.rawSet.jointConfigureMotorPosition(this.handle,this.rawAxis(),er,tr,ir)}configureMotor(er,tr,ir,nr){this.rawSet.jointConfigureMotor(this.handle,this.rawAxis(),er,tr,ir,nr)}}class FixedImpulseJoint extends ImpulseJoint{}class RopeImpulseJoint extends ImpulseJoint{}class SpringImpulseJoint extends ImpulseJoint{}class PrismaticImpulseJoint extends UnitImpulseJoint{rawAxis(){return RawJointAxis.LinX}}class RevoluteImpulseJoint extends UnitImpulseJoint{rawAxis(){return RawJointAxis.AngX}}class GenericImpulseJoint extends ImpulseJoint{}class SphericalImpulseJoint extends ImpulseJoint{}class JointData{constructor(){}static fixed(er,tr,ir,nr){let sr=new JointData;return sr.anchor1=er,sr.anchor2=ir,sr.frame1=tr,sr.frame2=nr,sr.jointType=JointType.Fixed,sr}static spring(er,tr,ir,nr,sr){let ar=new JointData;return ar.anchor1=nr,ar.anchor2=sr,ar.length=er,ar.stiffness=tr,ar.damping=ir,ar.jointType=JointType.Spring,ar}static rope(er,tr,ir){let nr=new JointData;return nr.anchor1=tr,nr.anchor2=ir,nr.length=er,nr.jointType=JointType.Rope,nr}static generic(er,tr,ir,nr){let sr=new JointData;return sr.anchor1=er,sr.anchor2=tr,sr.axis=ir,sr.axesMask=nr,sr.jointType=JointType.Generic,sr}static spherical(er,tr){let ir=new JointData;return ir.anchor1=er,ir.anchor2=tr,ir.jointType=JointType.Spherical,ir}static prismatic(er,tr,ir){let nr=new JointData;return nr.anchor1=er,nr.anchor2=tr,nr.axis=ir,nr.jointType=JointType.Prismatic,nr}static revolute(er,tr,ir){let nr=new JointData;return nr.anchor1=er,nr.anchor2=tr,nr.axis=ir,nr.jointType=JointType.Revolute,nr}intoRaw(){let er=VectorOps.intoRaw(this.anchor1),tr=VectorOps.intoRaw(this.anchor2),ir,nr,sr=!1,ar=0,or=0;switch(this.jointType){case JointType.Fixed:let lr=RotationOps.intoRaw(this.frame1),cr=RotationOps.intoRaw(this.frame2);nr=RawGenericJoint.fixed(er,lr,tr,cr),lr.free(),cr.free();break;case JointType.Spring:nr=RawGenericJoint.spring(this.length,this.stiffness,this.damping,er,tr);break;case JointType.Rope:nr=RawGenericJoint.rope(this.length,er,tr);break;case JointType.Prismatic:ir=VectorOps.intoRaw(this.axis),this.limitsEnabled&&(sr=!0,ar=this.limits[0],or=this.limits[1]),nr=RawGenericJoint.prismatic(er,tr,ir,sr,ar,or),ir.free();break;case JointType.Generic:ir=VectorOps.intoRaw(this.axis);let ur=this.axesMask;nr=RawGenericJoint.generic(er,tr,ir,ur);break;case JointType.Spherical:nr=RawGenericJoint.spherical(er,tr);break;case JointType.Revolute:ir=VectorOps.intoRaw(this.axis),nr=RawGenericJoint.revolute(er,tr,ir),ir.free();break}return er.free(),tr.free(),nr}}class ImpulseJointSet{constructor(er){this.raw=er||new RawImpulseJointSet,this.map=new Coarena,er&&er.forEachJointHandle(tr=>{this.map.set(tr,ImpulseJoint.newTyped(er,null,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createJoint(er,tr,ir,nr,sr){const ar=tr.intoRaw(),or=this.raw.createJoint(ar,ir,nr,sr);ar.free();let lr=ImpulseJoint.newTyped(this.raw,er,or);return this.map.set(or,lr),lr}remove(er,tr){this.raw.remove(er,tr),this.unmap(er)}forEachJointHandleAttachedToRigidBody(er,tr){this.raw.forEachJointAttachedToRigidBody(er,tr)}unmap(er){this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}getAll(){return this.map.getAll()}}class MultibodyJoint{constructor(er,tr){this.rawSet=er,this.handle=tr}static newTyped(er,tr){switch(er.jointType(tr)){case RawJointType.Revolute:return new RevoluteMultibodyJoint(er,tr);case RawJointType.Prismatic:return new PrismaticMultibodyJoint(er,tr);case RawJointType.Fixed:return new FixedMultibodyJoint(er,tr);case RawJointType.Spherical:return new SphericalMultibodyJoint(er,tr);default:return new MultibodyJoint(er,tr)}}isValid(){return this.rawSet.contains(this.handle)}setContactsEnabled(er){this.rawSet.jointSetContactsEnabled(this.handle,er)}contactsEnabled(){return this.rawSet.jointContactsEnabled(this.handle)}}class UnitMultibodyJoint extends MultibodyJoint{}class FixedMultibodyJoint extends MultibodyJoint{}class PrismaticMultibodyJoint extends UnitMultibodyJoint{rawAxis(){return RawJointAxis.LinX}}class RevoluteMultibodyJoint extends UnitMultibodyJoint{rawAxis(){return RawJointAxis.AngX}}class SphericalMultibodyJoint extends MultibodyJoint{}class MultibodyJointSet{constructor(er){this.raw=er||new RawMultibodyJointSet,this.map=new Coarena,er&&er.forEachJointHandle(tr=>{this.map.set(tr,MultibodyJoint.newTyped(this.raw,tr))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}createJoint(er,tr,ir,nr){const sr=er.intoRaw(),ar=this.raw.createJoint(sr,tr,ir,nr);sr.free();let or=MultibodyJoint.newTyped(this.raw,ar);return this.map.set(ar,or),or}remove(er,tr){this.raw.remove(er,tr),this.map.delete(er)}unmap(er){this.map.delete(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}get(er){return this.map.get(er)}forEach(er){this.map.forEach(er)}forEachJointHandleAttachedToRigidBody(er,tr){this.raw.forEachJointAttachedToRigidBody(er,tr)}getAll(){return this.map.getAll()}}var CoefficientCombineRule;(function(rr){rr[rr.Average=0]="Average",rr[rr.Min=1]="Min",rr[rr.Multiply=2]="Multiply",rr[rr.Max=3]="Max"})(CoefficientCombineRule||(CoefficientCombineRule={}));class CCDSolver{constructor(er){this.raw=er||new RawCCDSolver}free(){this.raw&&this.raw.free(),this.raw=void 0}}class IslandManager{constructor(er){this.raw=er||new RawIslandManager}free(){this.raw&&this.raw.free(),this.raw=void 0}forEachActiveRigidBodyHandle(er){this.raw.forEachActiveRigidBodyHandle(er)}}class BroadPhase{constructor(er){this.raw=er||new RawBroadPhase}free(){this.raw&&this.raw.free(),this.raw=void 0}}class NarrowPhase{constructor(er){this.raw=er||new RawNarrowPhase,this.tempManifold=new TempContactManifold(null)}free(){this.raw&&this.raw.free(),this.raw=void 0}contactPairsWith(er,tr){this.raw.contact_pairs_with(er,tr)}intersectionPairsWith(er,tr){this.raw.intersection_pairs_with(er,tr)}contactPair(er,tr,ir){const nr=this.raw.contact_pair(er,tr);if(nr){const sr=nr.collider1()!=er;let ar;for(ar=0;ar<nr.numContactManifolds();++ar)this.tempManifold.raw=nr.contactManifold(ar),this.tempManifold.raw&&ir(this.tempManifold,sr),this.tempManifold.free();nr.free()}}intersectionPair(er,tr){return this.raw.intersection_pair(er,tr)}}class TempContactManifold{constructor(er){this.raw=er}free(){this.raw&&this.raw.free(),this.raw=void 0}normal(){return VectorOps.fromRaw(this.raw.normal())}localNormal1(){return VectorOps.fromRaw(this.raw.local_n1())}localNormal2(){return VectorOps.fromRaw(this.raw.local_n2())}subshape1(){return this.raw.subshape1()}subshape2(){return this.raw.subshape2()}numContacts(){return this.raw.num_contacts()}localContactPoint1(er){return VectorOps.fromRaw(this.raw.contact_local_p1(er))}localContactPoint2(er){return VectorOps.fromRaw(this.raw.contact_local_p2(er))}contactDist(er){return this.raw.contact_dist(er)}contactFid1(er){return this.raw.contact_fid1(er)}contactFid2(er){return this.raw.contact_fid2(er)}contactImpulse(er){return this.raw.contact_impulse(er)}contactTangentImpulseX(er){return this.raw.contact_tangent_impulse_x(er)}contactTangentImpulseY(er){return this.raw.contact_tangent_impulse_y(er)}numSolverContacts(){return this.raw.num_solver_contacts()}solverContactPoint(er){return VectorOps.fromRaw(this.raw.solver_contact_point(er))}solverContactDist(er){return this.raw.solver_contact_dist(er)}solverContactFriction(er){return this.raw.solver_contact_friction(er)}solverContactRestitution(er){return this.raw.solver_contact_restitution(er)}solverContactTangentVelocity(er){return VectorOps.fromRaw(this.raw.solver_contact_tangent_velocity(er))}}class ShapeContact{constructor(er,tr,ir,nr,sr){this.distance=er,this.point1=tr,this.point2=ir,this.normal1=nr,this.normal2=sr}static fromRaw(er){if(!er)return null;const tr=new ShapeContact(er.distance(),VectorOps.fromRaw(er.point1()),VectorOps.fromRaw(er.point2()),VectorOps.fromRaw(er.normal1()),VectorOps.fromRaw(er.normal2()));return er.free(),tr}}var FeatureType;(function(rr){rr[rr.Vertex=0]="Vertex",rr[rr.Edge=1]="Edge",rr[rr.Face=2]="Face",rr[rr.Unknown=3]="Unknown"})(FeatureType||(FeatureType={}));class PointProjection{constructor(er,tr){this.point=er,this.isInside=tr}static fromRaw(er){if(!er)return null;const tr=new PointProjection(VectorOps.fromRaw(er.point()),er.isInside());return er.free(),tr}}class PointColliderProjection{constructor(er,tr,ir,nr,sr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.collider=er,this.point=tr,this.isInside=ir,sr!==void 0&&(this.featureId=sr),nr!==void 0&&(this.featureType=nr)}static fromRaw(er,tr){if(!tr)return null;const ir=new PointColliderProjection(er.get(tr.colliderHandle()),VectorOps.fromRaw(tr.point()),tr.isInside(),tr.featureType(),tr.featureId());return tr.free(),ir}}class Ray{constructor(er,tr){this.origin=er,this.dir=tr}pointAt(er){return{x:this.origin.x+this.dir.x*er,y:this.origin.y+this.dir.y*er,z:this.origin.z+this.dir.z*er}}}class RayIntersection{constructor(er,tr,ir,nr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.timeOfImpact=er,this.normal=tr,nr!==void 0&&(this.featureId=nr),ir!==void 0&&(this.featureType=ir)}static fromRaw(er){if(!er)return null;const tr=new RayIntersection(er.time_of_impact(),VectorOps.fromRaw(er.normal()),er.featureType(),er.featureId());return er.free(),tr}}class RayColliderIntersection{constructor(er,tr,ir,nr,sr){this.featureType=FeatureType.Unknown,this.featureId=void 0,this.collider=er,this.timeOfImpact=tr,this.normal=ir,sr!==void 0&&(this.featureId=sr),nr!==void 0&&(this.featureType=nr)}static fromRaw(er,tr){if(!tr)return null;const ir=new RayColliderIntersection(er.get(tr.colliderHandle()),tr.time_of_impact(),VectorOps.fromRaw(tr.normal()),tr.featureType(),tr.featureId());return tr.free(),ir}}class RayColliderHit{constructor(er,tr){this.collider=er,this.timeOfImpact=tr}static fromRaw(er,tr){if(!tr)return null;const ir=new RayColliderHit(er.get(tr.colliderHandle()),tr.timeOfImpact());return tr.free(),ir}}class ShapeCastHit{constructor(er,tr,ir,nr,sr){this.time_of_impact=er,this.witness1=tr,this.witness2=ir,this.normal1=nr,this.normal2=sr}static fromRaw(er,tr){if(!tr)return null;const ir=new ShapeCastHit(tr.time_of_impact(),VectorOps.fromRaw(tr.witness1()),VectorOps.fromRaw(tr.witness2()),VectorOps.fromRaw(tr.normal1()),VectorOps.fromRaw(tr.normal2()));return tr.free(),ir}}class ColliderShapeCastHit extends ShapeCastHit{constructor(er,tr,ir,nr,sr,ar){super(tr,ir,nr,sr,ar),this.collider=er}static fromRaw(er,tr){if(!tr)return null;const ir=new ColliderShapeCastHit(er.get(tr.colliderHandle()),tr.time_of_impact(),VectorOps.fromRaw(tr.witness1()),VectorOps.fromRaw(tr.witness2()),VectorOps.fromRaw(tr.normal1()),VectorOps.fromRaw(tr.normal2()));return tr.free(),ir}}class Shape{static fromRaw(er,tr){const ir=er.coShapeType(tr);let nr,sr,ar,or,lr,cr,ur;switch(ir){case RawShapeType.Ball:return new Ball(er.coRadius(tr));case RawShapeType.Cuboid:return nr=er.coHalfExtents(tr),new Cuboid(nr.x,nr.y,nr.z);case RawShapeType.RoundCuboid:return nr=er.coHalfExtents(tr),sr=er.coRoundRadius(tr),new RoundCuboid(nr.x,nr.y,nr.z,sr);case RawShapeType.Capsule:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Capsule$1(lr,cr);case RawShapeType.Segment:return ar=er.coVertices(tr),new Segment(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]));case RawShapeType.Polyline:return ar=er.coVertices(tr),or=er.coIndices(tr),new Polyline(ar,or);case RawShapeType.Triangle:return ar=er.coVertices(tr),new Triangle$1(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]),VectorOps.new(ar[6],ar[7],ar[8]));case RawShapeType.RoundTriangle:return ar=er.coVertices(tr),sr=er.coRoundRadius(tr),new RoundTriangle(VectorOps.new(ar[0],ar[1],ar[2]),VectorOps.new(ar[3],ar[4],ar[5]),VectorOps.new(ar[6],ar[7],ar[8]),sr);case RawShapeType.HalfSpace:return ur=VectorOps.fromRaw(er.coHalfspaceNormal(tr)),new HalfSpace(ur);case RawShapeType.TriMesh:ar=er.coVertices(tr),or=er.coIndices(tr);const dr=er.coTriMeshFlags(tr);return new TriMesh(ar,or,dr);case RawShapeType.HeightField:const hr=er.coHeightfieldScale(tr),pr=er.coHeightfieldHeights(tr),gr=er.coHeightfieldNRows(tr),vr=er.coHeightfieldNCols(tr),mr=er.coHeightFieldFlags(tr);return new Heightfield(gr,vr,pr,hr,mr);case RawShapeType.ConvexPolyhedron:return ar=er.coVertices(tr),or=er.coIndices(tr),new ConvexPolyhedron(ar,or);case RawShapeType.RoundConvexPolyhedron:return ar=er.coVertices(tr),or=er.coIndices(tr),sr=er.coRoundRadius(tr),new RoundConvexPolyhedron(ar,or,sr);case RawShapeType.Cylinder:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Cylinder(lr,cr);case RawShapeType.RoundCylinder:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),sr=er.coRoundRadius(tr),new RoundCylinder(lr,cr,sr);case RawShapeType.Cone:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),new Cone(lr,cr);case RawShapeType.RoundCone:return lr=er.coHalfHeight(tr),cr=er.coRadius(tr),sr=er.coRoundRadius(tr),new RoundCone(lr,cr,sr);default:throw new Error("unknown shape type: "+ir)}}castShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur){let dr=VectorOps.intoRaw(er),hr=RotationOps.intoRaw(tr),pr=VectorOps.intoRaw(ir),gr=VectorOps.intoRaw(sr),vr=RotationOps.intoRaw(ar),mr=VectorOps.intoRaw(or),fr=this.intoRaw(),_r=nr.intoRaw(),Ar=ShapeCastHit.fromRaw(null,fr.castShape(dr,hr,pr,_r,gr,vr,mr,lr,cr,ur));return dr.free(),hr.free(),pr.free(),gr.free(),vr.free(),mr.free(),fr.free(),_r.free(),Ar}intersectsShape(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(er),or=RotationOps.intoRaw(tr),lr=VectorOps.intoRaw(nr),cr=RotationOps.intoRaw(sr),ur=this.intoRaw(),dr=ir.intoRaw(),hr=ur.intersectsShape(ar,or,dr,lr,cr);return ar.free(),or.free(),lr.free(),cr.free(),ur.free(),dr.free(),hr}contactShape(er,tr,ir,nr,sr,ar){let or=VectorOps.intoRaw(er),lr=RotationOps.intoRaw(tr),cr=VectorOps.intoRaw(nr),ur=RotationOps.intoRaw(sr),dr=this.intoRaw(),hr=ir.intoRaw(),pr=ShapeContact.fromRaw(dr.contactShape(or,lr,hr,cr,ur,ar));return or.free(),lr.free(),cr.free(),ur.free(),dr.free(),hr.free(),pr}containsPoint(er,tr,ir){let nr=VectorOps.intoRaw(er),sr=RotationOps.intoRaw(tr),ar=VectorOps.intoRaw(ir),or=this.intoRaw(),lr=or.containsPoint(nr,sr,ar);return nr.free(),sr.free(),ar.free(),or.free(),lr}projectPoint(er,tr,ir,nr){let sr=VectorOps.intoRaw(er),ar=RotationOps.intoRaw(tr),or=VectorOps.intoRaw(ir),lr=this.intoRaw(),cr=PointProjection.fromRaw(lr.projectPoint(sr,ar,or,nr));return sr.free(),ar.free(),or.free(),lr.free(),cr}intersectsRay(er,tr,ir,nr){let sr=VectorOps.intoRaw(tr),ar=RotationOps.intoRaw(ir),or=VectorOps.intoRaw(er.origin),lr=VectorOps.intoRaw(er.dir),cr=this.intoRaw(),ur=cr.intersectsRay(sr,ar,or,lr,nr);return sr.free(),ar.free(),or.free(),lr.free(),cr.free(),ur}castRay(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(tr),or=RotationOps.intoRaw(ir),lr=VectorOps.intoRaw(er.origin),cr=VectorOps.intoRaw(er.dir),ur=this.intoRaw(),dr=ur.castRay(ar,or,lr,cr,nr,sr);return ar.free(),or.free(),lr.free(),cr.free(),ur.free(),dr}castRayAndGetNormal(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(tr),or=RotationOps.intoRaw(ir),lr=VectorOps.intoRaw(er.origin),cr=VectorOps.intoRaw(er.dir),ur=this.intoRaw(),dr=RayIntersection.fromRaw(ur.castRayAndGetNormal(ar,or,lr,cr,nr,sr));return ar.free(),or.free(),lr.free(),cr.free(),ur.free(),dr}}var ShapeType;(function(rr){rr[rr.Ball=0]="Ball",rr[rr.Cuboid=1]="Cuboid",rr[rr.Capsule=2]="Capsule",rr[rr.Segment=3]="Segment",rr[rr.Polyline=4]="Polyline",rr[rr.Triangle=5]="Triangle",rr[rr.TriMesh=6]="TriMesh",rr[rr.HeightField=7]="HeightField",rr[rr.ConvexPolyhedron=9]="ConvexPolyhedron",rr[rr.Cylinder=10]="Cylinder",rr[rr.Cone=11]="Cone",rr[rr.RoundCuboid=12]="RoundCuboid",rr[rr.RoundTriangle=13]="RoundTriangle",rr[rr.RoundCylinder=14]="RoundCylinder",rr[rr.RoundCone=15]="RoundCone",rr[rr.RoundConvexPolyhedron=16]="RoundConvexPolyhedron",rr[rr.HalfSpace=17]="HalfSpace"})(ShapeType||(ShapeType={}));var HeightFieldFlags;(function(rr){rr[rr.FIX_INTERNAL_EDGES=1]="FIX_INTERNAL_EDGES"})(HeightFieldFlags||(HeightFieldFlags={}));var TriMeshFlags;(function(rr){rr[rr.DELETE_BAD_TOPOLOGY_TRIANGLES=4]="DELETE_BAD_TOPOLOGY_TRIANGLES",rr[rr.ORIENTED=8]="ORIENTED",rr[rr.MERGE_DUPLICATE_VERTICES=16]="MERGE_DUPLICATE_VERTICES",rr[rr.DELETE_DEGENERATE_TRIANGLES=32]="DELETE_DEGENERATE_TRIANGLES",rr[rr.DELETE_DUPLICATE_TRIANGLES=64]="DELETE_DUPLICATE_TRIANGLES",rr[rr.FIX_INTERNAL_EDGES=152]="FIX_INTERNAL_EDGES"})(TriMeshFlags||(TriMeshFlags={}));class Ball extends Shape{constructor(er){super(),this.type=ShapeType.Ball,this.radius=er}intoRaw(){return RawShape.ball(this.radius)}}class HalfSpace extends Shape{constructor(er){super(),this.type=ShapeType.HalfSpace,this.normal=er}intoRaw(){let er=VectorOps.intoRaw(this.normal),tr=RawShape.halfspace(er);return er.free(),tr}}class Cuboid extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.Cuboid,this.halfExtents=VectorOps.new(er,tr,ir)}intoRaw(){return RawShape.cuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z)}}class RoundCuboid extends Shape{constructor(er,tr,ir,nr){super(),this.type=ShapeType.RoundCuboid,this.halfExtents=VectorOps.new(er,tr,ir),this.borderRadius=nr}intoRaw(){return RawShape.roundCuboid(this.halfExtents.x,this.halfExtents.y,this.halfExtents.z,this.borderRadius)}}let Capsule$1=class extends Shape{constructor(er,tr){super(),this.type=ShapeType.Capsule,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.capsule(this.halfHeight,this.radius)}};class Segment extends Shape{constructor(er,tr){super(),this.type=ShapeType.Segment,this.a=er,this.b=tr}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),ir=RawShape.segment(er,tr);return er.free(),tr.free(),ir}}let Triangle$1=class extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.Triangle,this.a=er,this.b=tr,this.c=ir}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),ir=VectorOps.intoRaw(this.c),nr=RawShape.triangle(er,tr,ir);return er.free(),tr.free(),ir.free(),nr}};class RoundTriangle extends Shape{constructor(er,tr,ir,nr){super(),this.type=ShapeType.RoundTriangle,this.a=er,this.b=tr,this.c=ir,this.borderRadius=nr}intoRaw(){let er=VectorOps.intoRaw(this.a),tr=VectorOps.intoRaw(this.b),ir=VectorOps.intoRaw(this.c),nr=RawShape.roundTriangle(er,tr,ir,this.borderRadius);return er.free(),tr.free(),ir.free(),nr}}class Polyline extends Shape{constructor(er,tr){super(),this.type=ShapeType.Polyline,this.vertices=er,this.indices=tr??new Uint32Array(0)}intoRaw(){return RawShape.polyline(this.vertices,this.indices)}}class TriMesh extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.TriMesh,this.vertices=er,this.indices=tr,this.flags=ir}intoRaw(){return RawShape.trimesh(this.vertices,this.indices,this.flags)}}class ConvexPolyhedron extends Shape{constructor(er,tr){super(),this.type=ShapeType.ConvexPolyhedron,this.vertices=er,this.indices=tr}intoRaw(){return this.indices?RawShape.convexMesh(this.vertices,this.indices):RawShape.convexHull(this.vertices)}}class RoundConvexPolyhedron extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.RoundConvexPolyhedron,this.vertices=er,this.indices=tr,this.borderRadius=ir}intoRaw(){return this.indices?RawShape.roundConvexMesh(this.vertices,this.indices,this.borderRadius):RawShape.roundConvexHull(this.vertices,this.borderRadius)}}class Heightfield extends Shape{constructor(er,tr,ir,nr,sr){super(),this.type=ShapeType.HeightField,this.nrows=er,this.ncols=tr,this.heights=ir,this.scale=nr,this.flags=sr}intoRaw(){let er=VectorOps.intoRaw(this.scale),tr=RawShape.heightfield(this.nrows,this.ncols,this.heights,er,this.flags);return er.free(),tr}}class Cylinder extends Shape{constructor(er,tr){super(),this.type=ShapeType.Cylinder,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.cylinder(this.halfHeight,this.radius)}}class RoundCylinder extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.RoundCylinder,this.borderRadius=ir,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.roundCylinder(this.halfHeight,this.radius,this.borderRadius)}}class Cone extends Shape{constructor(er,tr){super(),this.type=ShapeType.Cone,this.halfHeight=er,this.radius=tr}intoRaw(){return RawShape.cone(this.halfHeight,this.radius)}}class RoundCone extends Shape{constructor(er,tr,ir){super(),this.type=ShapeType.RoundCone,this.halfHeight=er,this.radius=tr,this.borderRadius=ir}intoRaw(){return RawShape.roundCone(this.halfHeight,this.radius,this.borderRadius)}}class PhysicsPipeline{constructor(er){this.raw=er||new RawPhysicsPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}step(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr){let pr=VectorOps.intoRaw(er);dr?this.raw.stepWithEvents(pr,tr.raw,ir.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw,ur.raw,dr.raw,hr,hr?hr.filterContactPair:null,hr?hr.filterIntersectionPair:null):this.raw.step(pr,tr.raw,ir.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw,ur.raw),pr.free()}}var QueryFilterFlags;(function(rr){rr[rr.EXCLUDE_FIXED=1]="EXCLUDE_FIXED",rr[rr.EXCLUDE_KINEMATIC=2]="EXCLUDE_KINEMATIC",rr[rr.EXCLUDE_DYNAMIC=4]="EXCLUDE_DYNAMIC",rr[rr.EXCLUDE_SENSORS=8]="EXCLUDE_SENSORS",rr[rr.EXCLUDE_SOLIDS=16]="EXCLUDE_SOLIDS",rr[rr.ONLY_DYNAMIC=3]="ONLY_DYNAMIC",rr[rr.ONLY_KINEMATIC=5]="ONLY_KINEMATIC",rr[rr.ONLY_FIXED=6]="ONLY_FIXED"})(QueryFilterFlags||(QueryFilterFlags={}));class QueryPipeline{constructor(er){this.raw=er||new RawQueryPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}update(er){this.raw.update(er.raw)}castRay(er,tr,ir,nr,sr,ar,or,lr,cr,ur){let dr=VectorOps.intoRaw(ir.origin),hr=VectorOps.intoRaw(ir.dir),pr=RayColliderHit.fromRaw(tr,this.raw.castRay(er.raw,tr.raw,dr,hr,nr,sr,ar,or,lr,cr,ur));return dr.free(),hr.free(),pr}castRayAndGetNormal(er,tr,ir,nr,sr,ar,or,lr,cr,ur){let dr=VectorOps.intoRaw(ir.origin),hr=VectorOps.intoRaw(ir.dir),pr=RayColliderIntersection.fromRaw(tr,this.raw.castRayAndGetNormal(er.raw,tr.raw,dr,hr,nr,sr,ar,or,lr,cr,ur));return dr.free(),hr.free(),pr}intersectionsWithRay(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){let hr=VectorOps.intoRaw(ir.origin),pr=VectorOps.intoRaw(ir.dir),gr=vr=>ar(RayColliderIntersection.fromRaw(tr,vr));this.raw.intersectionsWithRay(er.raw,tr.raw,hr,pr,nr,sr,gr,or,lr,cr,ur,dr),hr.free(),pr.free()}intersectionWithShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur){let dr=VectorOps.intoRaw(ir),hr=RotationOps.intoRaw(nr),pr=sr.intoRaw(),gr=this.raw.intersectionWithShape(er.raw,tr.raw,dr,hr,pr,ar,or,lr,cr,ur);return dr.free(),hr.free(),pr.free(),gr}projectPoint(er,tr,ir,nr,sr,ar,or,lr,cr){let ur=VectorOps.intoRaw(ir),dr=PointColliderProjection.fromRaw(tr,this.raw.projectPoint(er.raw,tr.raw,ur,nr,sr,ar,or,lr,cr));return ur.free(),dr}projectPointAndGetFeature(er,tr,ir,nr,sr,ar,or,lr){let cr=VectorOps.intoRaw(ir),ur=PointColliderProjection.fromRaw(tr,this.raw.projectPointAndGetFeature(er.raw,tr.raw,cr,nr,sr,ar,or,lr));return cr.free(),ur}intersectionsWithPoint(er,tr,ir,nr,sr,ar,or,lr,cr){let ur=VectorOps.intoRaw(ir);this.raw.intersectionsWithPoint(er.raw,tr.raw,ur,nr,sr,ar,or,lr,cr),ur.free()}castShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr){let vr=VectorOps.intoRaw(ir),mr=RotationOps.intoRaw(nr),fr=VectorOps.intoRaw(sr),_r=ar.intoRaw(),Ar=ColliderShapeCastHit.fromRaw(tr,this.raw.castShape(er.raw,tr.raw,vr,mr,fr,_r,or,lr,cr,ur,dr,hr,pr,gr));return vr.free(),mr.free(),fr.free(),_r.free(),Ar}intersectionsWithShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr){let hr=VectorOps.intoRaw(ir),pr=RotationOps.intoRaw(nr),gr=sr.intoRaw();this.raw.intersectionsWithShape(er.raw,tr.raw,hr,pr,gr,ar,or,lr,cr,ur,dr),hr.free(),pr.free(),gr.free()}collidersWithAabbIntersectingAabb(er,tr,ir){let nr=VectorOps.intoRaw(er),sr=VectorOps.intoRaw(tr);this.raw.collidersWithAabbIntersectingAabb(nr,sr,ir),nr.free(),sr.free()}}class SerializationPipeline{constructor(er){this.raw=er||new RawSerializationPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0}serializeAll(er,tr,ir,nr,sr,ar,or,lr,cr){let ur=VectorOps.intoRaw(er);const dr=this.raw.serializeAll(ur,tr.raw,ir.raw,nr.raw,sr.raw,ar.raw,or.raw,lr.raw,cr.raw);return ur.free(),dr}deserializeAll(er){return World.fromRaw(this.raw.deserializeAll(er))}}class DebugRenderBuffers{constructor(er,tr){this.vertices=er,this.colors=tr}}class DebugRenderPipeline{constructor(er){this.raw=er||new RawDebugRenderPipeline}free(){this.raw&&this.raw.free(),this.raw=void 0,this.vertices=void 0,this.colors=void 0}render(er,tr,ir,nr,sr){this.raw.render(er.raw,tr.raw,ir.raw,nr.raw,sr.raw),this.vertices=this.raw.vertices(),this.colors=this.raw.colors()}}class CharacterCollision{}class KinematicCharacterController{constructor(er,tr,ir,nr,sr){this.params=tr,this.bodies=ir,this.colliders=nr,this.queries=sr,this.raw=new RawKinematicCharacterController(er),this.rawCharacterCollision=new RawCharacterCollision,this._applyImpulsesToDynamicBodies=!1,this._characterMass=null}free(){this.raw&&(this.raw.free(),this.rawCharacterCollision.free()),this.raw=void 0,this.rawCharacterCollision=void 0}up(){return this.raw.up()}setUp(er){let tr=VectorOps.intoRaw(er);return this.raw.setUp(tr)}applyImpulsesToDynamicBodies(){return this._applyImpulsesToDynamicBodies}setApplyImpulsesToDynamicBodies(er){this._applyImpulsesToDynamicBodies=er}characterMass(){return this._characterMass}setCharacterMass(er){this._characterMass=er}offset(){return this.raw.offset()}setOffset(er){this.raw.setOffset(er)}normalNudgeFactor(){return this.raw.normalNudgeFactor()}setNormalNudgeFactor(er){this.raw.setNormalNudgeFactor(er)}slideEnabled(){return this.raw.slideEnabled()}setSlideEnabled(er){this.raw.setSlideEnabled(er)}autostepMaxHeight(){return this.raw.autostepMaxHeight()}autostepMinWidth(){return this.raw.autostepMinWidth()}autostepIncludesDynamicBodies(){return this.raw.autostepIncludesDynamicBodies()}autostepEnabled(){return this.raw.autostepEnabled()}enableAutostep(er,tr,ir){this.raw.enableAutostep(er,tr,ir)}disableAutostep(){return this.raw.disableAutostep()}maxSlopeClimbAngle(){return this.raw.maxSlopeClimbAngle()}setMaxSlopeClimbAngle(er){this.raw.setMaxSlopeClimbAngle(er)}minSlopeSlideAngle(){return this.raw.minSlopeSlideAngle()}setMinSlopeSlideAngle(er){this.raw.setMinSlopeSlideAngle(er)}snapToGroundDistance(){return this.raw.snapToGroundDistance()}enableSnapToGround(er){this.raw.enableSnapToGround(er)}disableSnapToGround(){this.raw.disableSnapToGround()}snapToGroundEnabled(){return this.raw.snapToGroundEnabled()}computeColliderMovement(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(tr);this.raw.computeColliderMovement(this.params.dt,this.bodies.raw,this.colliders.raw,this.queries.raw,er.handle,ar,this._applyImpulsesToDynamicBodies,this._characterMass,ir,nr,this.colliders.castClosure(sr)),ar.free()}computedMovement(){return VectorOps.fromRaw(this.raw.computedMovement())}computedGrounded(){return this.raw.computedGrounded()}numComputedCollisions(){return this.raw.numComputedCollisions()}computedCollision(er,tr){if(this.raw.computedCollision(er,this.rawCharacterCollision)){let ir=this.rawCharacterCollision;return tr=tr??new CharacterCollision,tr.translationDeltaApplied=VectorOps.fromRaw(ir.translationDeltaApplied()),tr.translationDeltaRemaining=VectorOps.fromRaw(ir.translationDeltaRemaining()),tr.toi=ir.toi(),tr.witness1=VectorOps.fromRaw(ir.worldWitness1()),tr.witness2=VectorOps.fromRaw(ir.worldWitness2()),tr.normal1=VectorOps.fromRaw(ir.worldNormal1()),tr.normal2=VectorOps.fromRaw(ir.worldNormal2()),tr.collider=this.colliders.get(ir.handle()),tr}else return null}}class DynamicRayCastVehicleController{constructor(er,tr,ir,nr){this.raw=new RawDynamicRayCastVehicleController(er.handle),this.bodies=tr,this.colliders=ir,this.queries=nr,this._chassis=er}free(){this.raw&&this.raw.free(),this.raw=void 0}updateVehicle(er,tr,ir,nr){this.raw.update_vehicle(er,this.bodies.raw,this.colliders.raw,this.queries.raw,tr,ir,this.colliders.castClosure(nr))}currentVehicleSpeed(){return this.raw.current_vehicle_speed()}chassis(){return this._chassis}get indexUpAxis(){return this.raw.index_up_axis()}set indexUpAxis(er){this.raw.set_index_up_axis(er)}get indexForwardAxis(){return this.raw.index_forward_axis()}set setIndexForwardAxis(er){this.raw.set_index_forward_axis(er)}addWheel(er,tr,ir,nr,sr){let ar=VectorOps.intoRaw(er),or=VectorOps.intoRaw(tr),lr=VectorOps.intoRaw(ir);this.raw.add_wheel(ar,or,lr,nr,sr),ar.free(),or.free(),lr.free()}numWheels(){return this.raw.num_wheels()}wheelChassisConnectionPointCs(er){return VectorOps.fromRaw(this.raw.wheel_chassis_connection_point_cs(er))}setWheelChassisConnectionPointCs(er,tr){let ir=VectorOps.intoRaw(tr);this.raw.set_wheel_chassis_connection_point_cs(er,ir),ir.free()}wheelSuspensionRestLength(er){return this.raw.wheel_suspension_rest_length(er)}setWheelSuspensionRestLength(er,tr){this.raw.set_wheel_suspension_rest_length(er,tr)}wheelMaxSuspensionTravel(er){return this.raw.wheel_max_suspension_travel(er)}setWheelMaxSuspensionTravel(er,tr){this.raw.set_wheel_max_suspension_travel(er,tr)}wheelRadius(er){return this.raw.wheel_radius(er)}setWheelRadius(er,tr){this.raw.set_wheel_radius(er,tr)}wheelSuspensionStiffness(er){return this.raw.wheel_suspension_stiffness(er)}setWheelSuspensionStiffness(er,tr){this.raw.set_wheel_suspension_stiffness(er,tr)}wheelSuspensionCompression(er){return this.raw.wheel_suspension_compression(er)}setWheelSuspensionCompression(er,tr){this.raw.set_wheel_suspension_compression(er,tr)}wheelSuspensionRelaxation(er){return this.raw.wheel_suspension_relaxation(er)}setWheelSuspensionRelaxation(er,tr){this.raw.set_wheel_suspension_relaxation(er,tr)}wheelMaxSuspensionForce(er){return this.raw.wheel_max_suspension_force(er)}setWheelMaxSuspensionForce(er,tr){this.raw.set_wheel_max_suspension_force(er,tr)}wheelBrake(er){return this.raw.wheel_brake(er)}setWheelBrake(er,tr){this.raw.set_wheel_brake(er,tr)}wheelSteering(er){return this.raw.wheel_steering(er)}setWheelSteering(er,tr){this.raw.set_wheel_steering(er,tr)}wheelEngineForce(er){return this.raw.wheel_engine_force(er)}setWheelEngineForce(er,tr){this.raw.set_wheel_engine_force(er,tr)}wheelDirectionCs(er){return VectorOps.fromRaw(this.raw.wheel_direction_cs(er))}setWheelDirectionCs(er,tr){let ir=VectorOps.intoRaw(tr);this.raw.set_wheel_direction_cs(er,ir),ir.free()}wheelAxleCs(er){return VectorOps.fromRaw(this.raw.wheel_axle_cs(er))}setWheelAxleCs(er,tr){let ir=VectorOps.intoRaw(tr);this.raw.set_wheel_axle_cs(er,ir),ir.free()}wheelFrictionSlip(er){return this.raw.wheel_friction_slip(er)}setWheelFrictionSlip(er,tr){this.raw.set_wheel_friction_slip(er,tr)}wheelSideFrictionStiffness(er){return this.raw.wheel_side_friction_stiffness(er)}setWheelSideFrictionStiffness(er,tr){this.raw.set_wheel_side_friction_stiffness(er,tr)}wheelRotation(er){return this.raw.wheel_rotation(er)}wheelForwardImpulse(er){return this.raw.wheel_forward_impulse(er)}wheelSideImpulse(er){return this.raw.wheel_side_impulse(er)}wheelSuspensionForce(er){return this.raw.wheel_suspension_force(er)}wheelContactNormal(er){return VectorOps.fromRaw(this.raw.wheel_contact_normal_ws(er))}wheelContactPoint(er){return VectorOps.fromRaw(this.raw.wheel_contact_point_ws(er))}wheelSuspensionLength(er){return this.raw.wheel_suspension_length(er)}wheelHardPoint(er){return VectorOps.fromRaw(this.raw.wheel_hard_point_ws(er))}wheelIsInContact(er){return this.raw.wheel_is_in_contact(er)}wheelGroundObject(er){return this.colliders.get(this.raw.wheel_ground_object(er))}}class World{constructor(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr,pr,gr){this.gravity=er,this.integrationParameters=new IntegrationParameters(tr),this.islands=new IslandManager(ir),this.broadPhase=new BroadPhase(nr),this.narrowPhase=new NarrowPhase(sr),this.bodies=new RigidBodySet(ar),this.colliders=new ColliderSet(or),this.impulseJoints=new ImpulseJointSet(lr),this.multibodyJoints=new MultibodyJointSet(cr),this.ccdSolver=new CCDSolver(ur),this.queryPipeline=new QueryPipeline(dr),this.physicsPipeline=new PhysicsPipeline(hr),this.serializationPipeline=new SerializationPipeline(pr),this.debugRenderPipeline=new DebugRenderPipeline(gr),this.characterControllers=new Set,this.vehicleControllers=new Set,this.impulseJoints.finalizeDeserialization(this.bodies),this.bodies.finalizeDeserialization(this.colliders),this.colliders.finalizeDeserialization(this.bodies)}free(){this.integrationParameters.free(),this.islands.free(),this.broadPhase.free(),this.narrowPhase.free(),this.bodies.free(),this.colliders.free(),this.impulseJoints.free(),this.multibodyJoints.free(),this.ccdSolver.free(),this.queryPipeline.free(),this.physicsPipeline.free(),this.serializationPipeline.free(),this.debugRenderPipeline.free(),this.characterControllers.forEach(er=>er.free()),this.vehicleControllers.forEach(er=>er.free()),this.integrationParameters=void 0,this.islands=void 0,this.broadPhase=void 0,this.narrowPhase=void 0,this.bodies=void 0,this.colliders=void 0,this.ccdSolver=void 0,this.impulseJoints=void 0,this.multibodyJoints=void 0,this.queryPipeline=void 0,this.physicsPipeline=void 0,this.serializationPipeline=void 0,this.debugRenderPipeline=void 0,this.characterControllers=void 0,this.vehicleControllers=void 0}static fromRaw(er){return er?new World(VectorOps.fromRaw(er.takeGravity()),er.takeIntegrationParameters(),er.takeIslandManager(),er.takeBroadPhase(),er.takeNarrowPhase(),er.takeBodies(),er.takeColliders(),er.takeImpulseJoints(),er.takeMultibodyJoints()):null}takeSnapshot(){return this.serializationPipeline.serializeAll(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints)}static restoreSnapshot(er){return new SerializationPipeline().deserializeAll(er)}debugRender(){return this.debugRenderPipeline.render(this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.narrowPhase),new DebugRenderBuffers(this.debugRenderPipeline.vertices,this.debugRenderPipeline.colors)}step(er,tr){this.physicsPipeline.step(this.gravity,this.integrationParameters,this.islands,this.broadPhase,this.narrowPhase,this.bodies,this.colliders,this.impulseJoints,this.multibodyJoints,this.ccdSolver,er,tr),this.queryPipeline.update(this.colliders)}propagateModifiedBodyPositionsToColliders(){this.bodies.raw.propagateModifiedBodyPositionsToColliders(this.colliders.raw)}updateSceneQueries(){this.propagateModifiedBodyPositionsToColliders(),this.queryPipeline.update(this.colliders)}get timestep(){return this.integrationParameters.dt}set timestep(er){this.integrationParameters.dt=er}get lengthUnit(){return this.integrationParameters.lengthUnit}set lengthUnit(er){this.integrationParameters.lengthUnit=er}get numSolverIterations(){return this.integrationParameters.numSolverIterations}set numSolverIterations(er){this.integrationParameters.numSolverIterations=er}get numAdditionalFrictionIterations(){return this.integrationParameters.numAdditionalFrictionIterations}set numAdditionalFrictionIterations(er){this.integrationParameters.numAdditionalFrictionIterations=er}get numInternalPgsIterations(){return this.integrationParameters.numInternalPgsIterations}set numInternalPgsIterations(er){this.integrationParameters.numInternalPgsIterations=er}switchToStandardPgsSolver(){this.integrationParameters.switchToStandardPgsSolver()}switchToSmallStepsPgsSolver(){this.integrationParameters.switchToSmallStepsPgsSolver()}switchToSmallStepsPgsSolverWithoutWarmstart(){this.integrationParameters.switchToSmallStepsPgsSolverWithoutWarmstart()}createRigidBody(er){return this.bodies.createRigidBody(this.colliders,er)}createCharacterController(er){let tr=new KinematicCharacterController(er,this.integrationParameters,this.bodies,this.colliders,this.queryPipeline);return this.characterControllers.add(tr),tr}removeCharacterController(er){this.characterControllers.delete(er),er.free()}createVehicleController(er){let tr=new DynamicRayCastVehicleController(er,this.bodies,this.colliders,this.queryPipeline);return this.vehicleControllers.add(tr),tr}removeVehicleController(er){this.vehicleControllers.delete(er),er.free()}createCollider(er,tr){let ir=tr?tr.handle:void 0;return this.colliders.createCollider(this.bodies,er,ir)}createImpulseJoint(er,tr,ir,nr){return this.impulseJoints.createJoint(this.bodies,er,tr.handle,ir.handle,nr)}createMultibodyJoint(er,tr,ir,nr){return this.multibodyJoints.createJoint(er,tr.handle,ir.handle,nr)}getRigidBody(er){return this.bodies.get(er)}getCollider(er){return this.colliders.get(er)}getImpulseJoint(er){return this.impulseJoints.get(er)}getMultibodyJoint(er){return this.multibodyJoints.get(er)}removeRigidBody(er){this.bodies&&this.bodies.remove(er.handle,this.islands,this.colliders,this.impulseJoints,this.multibodyJoints)}removeCollider(er,tr){this.colliders&&this.colliders.remove(er.handle,this.islands,this.bodies,tr)}removeImpulseJoint(er,tr){this.impulseJoints&&this.impulseJoints.remove(er.handle,tr)}removeMultibodyJoint(er,tr){this.impulseJoints&&this.multibodyJoints.remove(er.handle,tr)}forEachCollider(er){this.colliders.forEach(er)}forEachRigidBody(er){this.bodies.forEach(er)}forEachActiveRigidBody(er){this.bodies.forEachActiveRigidBody(this.islands,er)}castRay(er,tr,ir,nr,sr,ar,or,lr){return this.queryPipeline.castRay(this.bodies,this.colliders,er,tr,ir,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr))}castRayAndGetNormal(er,tr,ir,nr,sr,ar,or,lr){return this.queryPipeline.castRayAndGetNormal(this.bodies,this.colliders,er,tr,ir,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr))}intersectionsWithRay(er,tr,ir,nr,sr,ar,or,lr,cr){this.queryPipeline.intersectionsWithRay(this.bodies,this.colliders,er,tr,ir,nr,sr,ar,or?or.handle:null,lr?lr.handle:null,this.colliders.castClosure(cr))}intersectionWithShape(er,tr,ir,nr,sr,ar,or,lr){let cr=this.queryPipeline.intersectionWithShape(this.bodies,this.colliders,er,tr,ir,nr,sr,ar?ar.handle:null,or?or.handle:null,this.colliders.castClosure(lr));return cr!=null?this.colliders.get(cr):null}projectPoint(er,tr,ir,nr,sr,ar,or){return this.queryPipeline.projectPoint(this.bodies,this.colliders,er,tr,ir,nr,sr?sr.handle:null,ar?ar.handle:null,this.colliders.castClosure(or))}projectPointAndGetFeature(er,tr,ir,nr,sr,ar){return this.queryPipeline.projectPointAndGetFeature(this.bodies,this.colliders,er,tr,ir,nr?nr.handle:null,sr?sr.handle:null,this.colliders.castClosure(ar))}intersectionsWithPoint(er,tr,ir,nr,sr,ar,or){this.queryPipeline.intersectionsWithPoint(this.bodies,this.colliders,er,this.colliders.castClosure(tr),ir,nr,sr?sr.handle:null,ar?ar.handle:null,this.colliders.castClosure(or))}castShape(er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr){return this.queryPipeline.castShape(this.bodies,this.colliders,er,tr,ir,nr,sr,ar,or,lr,cr,ur?ur.handle:null,dr?dr.handle:null,this.colliders.castClosure(hr))}intersectionsWithShape(er,tr,ir,nr,sr,ar,or,lr,cr){this.queryPipeline.intersectionsWithShape(this.bodies,this.colliders,er,tr,ir,this.colliders.castClosure(nr),sr,ar,or?or.handle:null,lr?lr.handle:null,this.colliders.castClosure(cr))}collidersWithAabbIntersectingAabb(er,tr,ir){this.queryPipeline.collidersWithAabbIntersectingAabb(er,tr,this.colliders.castClosure(ir))}contactPairsWith(er,tr){this.narrowPhase.contactPairsWith(er.handle,this.colliders.castClosure(tr))}intersectionPairsWith(er,tr){this.narrowPhase.intersectionPairsWith(er.handle,this.colliders.castClosure(tr))}contactPair(er,tr,ir){this.narrowPhase.contactPair(er.handle,tr.handle,ir)}intersectionPair(er,tr){return this.narrowPhase.intersectionPair(er.handle,tr.handle)}}var ActiveEvents;(function(rr){rr[rr.NONE=0]="NONE",rr[rr.COLLISION_EVENTS=1]="COLLISION_EVENTS",rr[rr.CONTACT_FORCE_EVENTS=2]="CONTACT_FORCE_EVENTS"})(ActiveEvents||(ActiveEvents={}));class TempContactForceEvent{free(){this.raw&&this.raw.free(),this.raw=void 0}collider1(){return this.raw.collider1()}collider2(){return this.raw.collider2()}totalForce(){return VectorOps.fromRaw(this.raw.total_force())}totalForceMagnitude(){return this.raw.total_force_magnitude()}maxForceDirection(){return VectorOps.fromRaw(this.raw.max_force_direction())}maxForceMagnitude(){return this.raw.max_force_magnitude()}}class EventQueue{constructor(er,tr){this.raw=tr||new RawEventQueue(er)}free(){this.raw&&this.raw.free(),this.raw=void 0}drainCollisionEvents(er){this.raw.drainCollisionEvents(er)}drainContactForceEvents(er){let tr=new TempContactForceEvent;this.raw.drainContactForceEvents(ir=>{tr.raw=ir,er(tr),tr.free()})}clear(){this.raw.clear()}}var ActiveHooks;(function(rr){rr[rr.NONE=0]="NONE",rr[rr.FILTER_CONTACT_PAIRS=1]="FILTER_CONTACT_PAIRS",rr[rr.FILTER_INTERSECTION_PAIRS=2]="FILTER_INTERSECTION_PAIRS"})(ActiveHooks||(ActiveHooks={}));var SolverFlags;(function(rr){rr[rr.EMPTY=0]="EMPTY",rr[rr.COMPUTE_IMPULSE=1]="COMPUTE_IMPULSE"})(SolverFlags||(SolverFlags={}));var ActiveCollisionTypes;(function(rr){rr[rr.DYNAMIC_DYNAMIC=1]="DYNAMIC_DYNAMIC",rr[rr.DYNAMIC_KINEMATIC=12]="DYNAMIC_KINEMATIC",rr[rr.DYNAMIC_FIXED=2]="DYNAMIC_FIXED",rr[rr.KINEMATIC_KINEMATIC=52224]="KINEMATIC_KINEMATIC",rr[rr.KINEMATIC_FIXED=8704]="KINEMATIC_FIXED",rr[rr.FIXED_FIXED=32]="FIXED_FIXED",rr[rr.DEFAULT=15]="DEFAULT",rr[rr.ALL=60943]="ALL"})(ActiveCollisionTypes||(ActiveCollisionTypes={}));class Collider{constructor(er,tr,ir,nr){this.colliderSet=er,this.handle=tr,this._parent=ir,this._shape=nr}finalizeDeserialization(er){this.handle!=null&&(this._parent=er.get(this.colliderSet.raw.coParent(this.handle)))}ensureShapeIsCached(){this._shape||(this._shape=Shape.fromRaw(this.colliderSet.raw,this.handle))}get shape(){return this.ensureShapeIsCached(),this._shape}isValid(){return this.colliderSet.raw.contains(this.handle)}translation(){return VectorOps.fromRaw(this.colliderSet.raw.coTranslation(this.handle))}rotation(){return RotationOps.fromRaw(this.colliderSet.raw.coRotation(this.handle))}isSensor(){return this.colliderSet.raw.coIsSensor(this.handle)}setSensor(er){this.colliderSet.raw.coSetSensor(this.handle,er)}setShape(er){let tr=er.intoRaw();this.colliderSet.raw.coSetShape(this.handle,tr),tr.free(),this._shape=er}setEnabled(er){this.colliderSet.raw.coSetEnabled(this.handle,er)}isEnabled(){return this.colliderSet.raw.coIsEnabled(this.handle)}setRestitution(er){this.colliderSet.raw.coSetRestitution(this.handle,er)}setFriction(er){this.colliderSet.raw.coSetFriction(this.handle,er)}frictionCombineRule(){return this.colliderSet.raw.coFrictionCombineRule(this.handle)}setFrictionCombineRule(er){this.colliderSet.raw.coSetFrictionCombineRule(this.handle,er)}restitutionCombineRule(){return this.colliderSet.raw.coRestitutionCombineRule(this.handle)}setRestitutionCombineRule(er){this.colliderSet.raw.coSetRestitutionCombineRule(this.handle,er)}setCollisionGroups(er){this.colliderSet.raw.coSetCollisionGroups(this.handle,er)}setSolverGroups(er){this.colliderSet.raw.coSetSolverGroups(this.handle,er)}contactSkin(){return this.colliderSet.raw.coContactSkin(this.handle)}setContactSkin(er){return this.colliderSet.raw.coSetContactSkin(this.handle,er)}activeHooks(){return this.colliderSet.raw.coActiveHooks(this.handle)}setActiveHooks(er){this.colliderSet.raw.coSetActiveHooks(this.handle,er)}activeEvents(){return this.colliderSet.raw.coActiveEvents(this.handle)}setActiveEvents(er){this.colliderSet.raw.coSetActiveEvents(this.handle,er)}activeCollisionTypes(){return this.colliderSet.raw.coActiveCollisionTypes(this.handle)}setContactForceEventThreshold(er){return this.colliderSet.raw.coSetContactForceEventThreshold(this.handle,er)}contactForceEventThreshold(){return this.colliderSet.raw.coContactForceEventThreshold(this.handle)}setActiveCollisionTypes(er){this.colliderSet.raw.coSetActiveCollisionTypes(this.handle,er)}setDensity(er){this.colliderSet.raw.coSetDensity(this.handle,er)}setMass(er){this.colliderSet.raw.coSetMass(this.handle,er)}setMassProperties(er,tr,ir,nr){let sr=VectorOps.intoRaw(tr),ar=VectorOps.intoRaw(ir),or=RotationOps.intoRaw(nr);this.colliderSet.raw.coSetMassProperties(this.handle,er,sr,ar,or),sr.free(),ar.free(),or.free()}setTranslation(er){this.colliderSet.raw.coSetTranslation(this.handle,er.x,er.y,er.z)}setTranslationWrtParent(er){this.colliderSet.raw.coSetTranslationWrtParent(this.handle,er.x,er.y,er.z)}setRotation(er){this.colliderSet.raw.coSetRotation(this.handle,er.x,er.y,er.z,er.w)}setRotationWrtParent(er){this.colliderSet.raw.coSetRotationWrtParent(this.handle,er.x,er.y,er.z,er.w)}shapeType(){return this.colliderSet.raw.coShapeType(this.handle)}halfExtents(){return VectorOps.fromRaw(this.colliderSet.raw.coHalfExtents(this.handle))}setHalfExtents(er){const tr=VectorOps.intoRaw(er);this.colliderSet.raw.coSetHalfExtents(this.handle,tr)}radius(){return this.colliderSet.raw.coRadius(this.handle)}setRadius(er){this.colliderSet.raw.coSetRadius(this.handle,er)}roundRadius(){return this.colliderSet.raw.coRoundRadius(this.handle)}setRoundRadius(er){this.colliderSet.raw.coSetRoundRadius(this.handle,er)}halfHeight(){return this.colliderSet.raw.coHalfHeight(this.handle)}setHalfHeight(er){this.colliderSet.raw.coSetHalfHeight(this.handle,er)}vertices(){return this.colliderSet.raw.coVertices(this.handle)}indices(){return this.colliderSet.raw.coIndices(this.handle)}heightfieldHeights(){return this.colliderSet.raw.coHeightfieldHeights(this.handle)}heightfieldScale(){let er=this.colliderSet.raw.coHeightfieldScale(this.handle);return VectorOps.fromRaw(er)}heightfieldNRows(){return this.colliderSet.raw.coHeightfieldNRows(this.handle)}heightfieldNCols(){return this.colliderSet.raw.coHeightfieldNCols(this.handle)}parent(){return this._parent}friction(){return this.colliderSet.raw.coFriction(this.handle)}restitution(){return this.colliderSet.raw.coRestitution(this.handle)}density(){return this.colliderSet.raw.coDensity(this.handle)}mass(){return this.colliderSet.raw.coMass(this.handle)}volume(){return this.colliderSet.raw.coVolume(this.handle)}collisionGroups(){return this.colliderSet.raw.coCollisionGroups(this.handle)}solverGroups(){return this.colliderSet.raw.coSolverGroups(this.handle)}containsPoint(er){let tr=VectorOps.intoRaw(er),ir=this.colliderSet.raw.coContainsPoint(this.handle,tr);return tr.free(),ir}projectPoint(er,tr){let ir=VectorOps.intoRaw(er),nr=PointProjection.fromRaw(this.colliderSet.raw.coProjectPoint(this.handle,ir,tr));return ir.free(),nr}intersectsRay(er,tr){let ir=VectorOps.intoRaw(er.origin),nr=VectorOps.intoRaw(er.dir),sr=this.colliderSet.raw.coIntersectsRay(this.handle,ir,nr,tr);return ir.free(),nr.free(),sr}castShape(er,tr,ir,nr,sr,ar,or,lr){let cr=VectorOps.intoRaw(er),ur=VectorOps.intoRaw(ir),dr=RotationOps.intoRaw(nr),hr=VectorOps.intoRaw(sr),pr=tr.intoRaw(),gr=ShapeCastHit.fromRaw(this.colliderSet,this.colliderSet.raw.coCastShape(this.handle,cr,pr,ur,dr,hr,ar,or,lr));return cr.free(),ur.free(),dr.free(),hr.free(),pr.free(),gr}castCollider(er,tr,ir,nr,sr,ar){let or=VectorOps.intoRaw(er),lr=VectorOps.intoRaw(ir),cr=ColliderShapeCastHit.fromRaw(this.colliderSet,this.colliderSet.raw.coCastCollider(this.handle,or,tr.handle,lr,nr,sr,ar));return or.free(),lr.free(),cr}intersectsShape(er,tr,ir){let nr=VectorOps.intoRaw(tr),sr=RotationOps.intoRaw(ir),ar=er.intoRaw(),or=this.colliderSet.raw.coIntersectsShape(this.handle,ar,nr,sr);return nr.free(),sr.free(),ar.free(),or}contactShape(er,tr,ir,nr){let sr=VectorOps.intoRaw(tr),ar=RotationOps.intoRaw(ir),or=er.intoRaw(),lr=ShapeContact.fromRaw(this.colliderSet.raw.coContactShape(this.handle,or,sr,ar,nr));return sr.free(),ar.free(),or.free(),lr}contactCollider(er,tr){return ShapeContact.fromRaw(this.colliderSet.raw.coContactCollider(this.handle,er.handle,tr))}castRay(er,tr,ir){let nr=VectorOps.intoRaw(er.origin),sr=VectorOps.intoRaw(er.dir),ar=this.colliderSet.raw.coCastRay(this.handle,nr,sr,tr,ir);return nr.free(),sr.free(),ar}castRayAndGetNormal(er,tr,ir){let nr=VectorOps.intoRaw(er.origin),sr=VectorOps.intoRaw(er.dir),ar=RayIntersection.fromRaw(this.colliderSet.raw.coCastRayAndGetNormal(this.handle,nr,sr,tr,ir));return nr.free(),sr.free(),ar}}var MassPropsMode;(function(rr){rr[rr.Density=0]="Density",rr[rr.Mass=1]="Mass",rr[rr.MassProps=2]="MassProps"})(MassPropsMode||(MassPropsMode={}));class ColliderDesc{constructor(er){this.enabled=!0,this.shape=er,this.massPropsMode=MassPropsMode.Density,this.density=1,this.friction=.5,this.restitution=0,this.rotation=RotationOps.identity(),this.translation=VectorOps.zeros(),this.isSensor=!1,this.collisionGroups=4294967295,this.solverGroups=4294967295,this.frictionCombineRule=CoefficientCombineRule.Average,this.restitutionCombineRule=CoefficientCombineRule.Average,this.activeCollisionTypes=ActiveCollisionTypes.DEFAULT,this.activeEvents=ActiveEvents.NONE,this.activeHooks=ActiveHooks.NONE,this.mass=0,this.centerOfMass=VectorOps.zeros(),this.contactForceEventThreshold=0,this.contactSkin=0,this.principalAngularInertia=VectorOps.zeros(),this.angularInertiaLocalFrame=RotationOps.identity()}static ball(er){const tr=new Ball(er);return new ColliderDesc(tr)}static capsule(er,tr){const ir=new Capsule$1(er,tr);return new ColliderDesc(ir)}static segment(er,tr){const ir=new Segment(er,tr);return new ColliderDesc(ir)}static triangle(er,tr,ir){const nr=new Triangle$1(er,tr,ir);return new ColliderDesc(nr)}static roundTriangle(er,tr,ir,nr){const sr=new RoundTriangle(er,tr,ir,nr);return new ColliderDesc(sr)}static polyline(er,tr){const ir=new Polyline(er,tr);return new ColliderDesc(ir)}static trimesh(er,tr,ir){const nr=new TriMesh(er,tr,ir);return new ColliderDesc(nr)}static cuboid(er,tr,ir){const nr=new Cuboid(er,tr,ir);return new ColliderDesc(nr)}static roundCuboid(er,tr,ir,nr){const sr=new RoundCuboid(er,tr,ir,nr);return new ColliderDesc(sr)}static heightfield(er,tr,ir,nr,sr){const ar=new Heightfield(er,tr,ir,nr,sr);return new ColliderDesc(ar)}static cylinder(er,tr){const ir=new Cylinder(er,tr);return new ColliderDesc(ir)}static roundCylinder(er,tr,ir){const nr=new RoundCylinder(er,tr,ir);return new ColliderDesc(nr)}static cone(er,tr){const ir=new Cone(er,tr);return new ColliderDesc(ir)}static roundCone(er,tr,ir){const nr=new RoundCone(er,tr,ir);return new ColliderDesc(nr)}static convexHull(er){const tr=new ConvexPolyhedron(er,null);return new ColliderDesc(tr)}static convexMesh(er,tr){const ir=new ConvexPolyhedron(er,tr);return new ColliderDesc(ir)}static roundConvexHull(er,tr){const ir=new RoundConvexPolyhedron(er,null,tr);return new ColliderDesc(ir)}static roundConvexMesh(er,tr,ir){const nr=new RoundConvexPolyhedron(er,tr,ir);return new ColliderDesc(nr)}setTranslation(er,tr,ir){if(typeof er!="number"||typeof tr!="number"||typeof ir!="number")throw TypeError("The translation components must be numbers.");return this.translation={x:er,y:tr,z:ir},this}setRotation(er){return RotationOps.copy(this.rotation,er),this}setSensor(er){return this.isSensor=er,this}setEnabled(er){return this.enabled=er,this}setContactSkin(er){return this.contactSkin=er,this}setDensity(er){return this.massPropsMode=MassPropsMode.Density,this.density=er,this}setMass(er){return this.massPropsMode=MassPropsMode.Mass,this.mass=er,this}setMassProperties(er,tr,ir,nr){return this.massPropsMode=MassPropsMode.MassProps,this.mass=er,VectorOps.copy(this.centerOfMass,tr),VectorOps.copy(this.principalAngularInertia,ir),RotationOps.copy(this.angularInertiaLocalFrame,nr),this}setRestitution(er){return this.restitution=er,this}setFriction(er){return this.friction=er,this}setFrictionCombineRule(er){return this.frictionCombineRule=er,this}setRestitutionCombineRule(er){return this.restitutionCombineRule=er,this}setCollisionGroups(er){return this.collisionGroups=er,this}setSolverGroups(er){return this.solverGroups=er,this}setActiveHooks(er){return this.activeHooks=er,this}setActiveEvents(er){return this.activeEvents=er,this}setActiveCollisionTypes(er){return this.activeCollisionTypes=er,this}setContactForceEventThreshold(er){return this.contactForceEventThreshold=er,this}}class ColliderSet{constructor(er){this.raw=er||new RawColliderSet,this.map=new Coarena,er&&er.forEachColliderHandle(tr=>{this.map.set(tr,new Collider(this,tr,null))})}free(){this.raw&&this.raw.free(),this.raw=void 0,this.map&&this.map.clear(),this.map=void 0}castClosure(er){return tr=>{if(er)return er(this.get(tr))}}finalizeDeserialization(er){this.map.forEach(tr=>tr.finalizeDeserialization(er))}createCollider(er,tr,ir){let nr=ir!=null&&ir!=null;if(nr&&isNaN(ir))throw Error("Cannot create a collider with a parent rigid-body handle that is not a number.");let sr=tr.shape.intoRaw(),ar=VectorOps.intoRaw(tr.translation),or=RotationOps.intoRaw(tr.rotation),lr=VectorOps.intoRaw(tr.centerOfMass),cr=VectorOps.intoRaw(tr.principalAngularInertia),ur=RotationOps.intoRaw(tr.angularInertiaLocalFrame),dr=this.raw.createCollider(tr.enabled,sr,ar,or,tr.massPropsMode,tr.mass,lr,cr,ur,tr.density,tr.friction,tr.restitution,tr.frictionCombineRule,tr.restitutionCombineRule,tr.isSensor,tr.collisionGroups,tr.solverGroups,tr.activeCollisionTypes,tr.activeHooks,tr.activeEvents,tr.contactForceEventThreshold,tr.contactSkin,nr,nr?ir:0,er.raw);sr.free(),ar.free(),or.free(),lr.free(),cr.free(),ur.free();let hr=nr?er.get(ir):null,pr=new Collider(this,dr,hr,tr.shape);return this.map.set(dr,pr),pr}remove(er,tr,ir,nr){this.raw.remove(er,tr.raw,ir.raw,nr),this.unmap(er)}unmap(er){this.map.delete(er)}get(er){return this.map.get(er)}len(){return this.map.len()}contains(er){return this.get(er)!=null}forEach(er){this.map.forEach(er)}getAll(){return this.map.getAll()}}function version$1(){return version$3()}const RAPIER$1=Object.freeze(Object.defineProperty({__proto__:null,get ActiveCollisionTypes(){return ActiveCollisionTypes},get ActiveEvents(){return ActiveEvents},get ActiveHooks(){return ActiveHooks},Ball,BroadPhase,CCDSolver,Capsule:Capsule$1,CharacterCollision,get CoefficientCombineRule(){return CoefficientCombineRule},Collider,ColliderDesc,ColliderSet,ColliderShapeCastHit,Cone,ConvexPolyhedron,Cuboid,Cylinder,DebugRenderBuffers,DebugRenderPipeline,DynamicRayCastVehicleController,EventQueue,get FeatureType(){return FeatureType},FixedImpulseJoint,FixedMultibodyJoint,GenericImpulseJoint,HalfSpace,get HeightFieldFlags(){return HeightFieldFlags},Heightfield,ImpulseJoint,ImpulseJointSet,IntegrationParameters,IslandManager,get JointAxesMask(){return JointAxesMask},JointData,get JointType(){return JointType},KinematicCharacterController,get MassPropsMode(){return MassPropsMode},get MotorModel(){return MotorModel},MultibodyJoint,MultibodyJointSet,NarrowPhase,PhysicsPipeline,PointColliderProjection,PointProjection,Polyline,PrismaticImpulseJoint,PrismaticMultibodyJoint,Quaternion,get QueryFilterFlags(){return QueryFilterFlags},QueryPipeline,Ray,RayColliderHit,RayColliderIntersection,RayIntersection,RevoluteImpulseJoint,RevoluteMultibodyJoint,RigidBody:RigidBody$1,RigidBodyDesc,RigidBodySet,get RigidBodyType(){return RigidBodyType},RopeImpulseJoint,RotationOps,RoundCone,RoundConvexPolyhedron,RoundCuboid,RoundCylinder,RoundTriangle,SdpMatrix3,SdpMatrix3Ops,Segment,SerializationPipeline,Shape,ShapeCastHit,ShapeContact,get ShapeType(){return ShapeType},get SolverFlags(){return SolverFlags},SphericalImpulseJoint,SphericalMultibodyJoint,SpringImpulseJoint,TempContactForceEvent,TempContactManifold,TriMesh,get TriMeshFlags(){return TriMeshFlags},Triangle:Triangle$1,UnitImpulseJoint,UnitMultibodyJoint,Vector3,VectorOps,World,version:version$1},Symbol.toStringTag,{value:"Module"}));function timeDiffToStr(rr){let er=Math.floor(rr/86400);rr-=er*86400;let tr=Math.floor(rr/3600);rr-=tr*3600;let ir=Math.floor(rr/60);rr-=ir*60;let nr="";return er>0&&(nr+=er+"d "),tr>0&&(nr+=tr+"hr "),ir>0&&(nr+=ir+"min "),nr+=rr.toFixed(3)+"sec",nr}class GameManager{constructor(){this.scene=new Scene,this.camera=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,200),this.world=new World({x:0,y:-9.81,z:0}),this.paused=0,this.timeElapsed=0,this.gameobj=[],this.map=new Map,this.gameStarted=!1,this.difficulty=0,this.gameEndElem=document.getElementById("endgame")}get gameEnded(){return this.gameend}get deltatime(){return this.paused?0:Math.min(this.dtime,.1)}async init(){document.getElementById("giveup").onclick=()=>{this.isPaused=!1,this.endGame()},this.gameend=new Promise((nr,sr)=>{this.gameend_resolve=nr});const er=new CubeTextureLoader;er.setPath("image/background/");const tr=er.load(["space_ft.png","space_bk.png","space_up.png","space_dn.png","space_rt.png","space_lf.png"]);this.scene.background=tr;let ir=[];for(let nr=0;nr<this.gameobj.length;nr++)ir.push(this.gameobj[nr].init());await Promise.all(ir);for(let nr=0;nr<this.gameobj.length;nr++)this.gameobj[nr].lateinit();this.world.step()}reset(){this.gameend=new Promise((er,tr)=>{this.gameend_resolve=er}),this.gameStarted=!1;for(let er=0;er<this.gameobj.length;er++)this.gameobj[er].reset()}beforeStart(){this.clk=new Clock,this.timeElapsed=0,this.paused=0;for(let er=0;er<this.gameobj.length;er++)this.gameobj[er].beforeStart()}update(){if(this.dtime=this.clk.getDelta(),this.world.step(),this.paused)for(let er=0;er<this.gameobj.length;er++)this.gameobj[er].pauseUpdate();else{this.timeElapsed+=this.dtime;for(let er=0;er<this.gameobj.length;er++)this.gameobj[er].update()}}lateUpdate(){if(!this.paused)for(let er=0;er<this.gameobj.length;er++)this.gameobj[er].lateUpdate()}registerGameObj(er){this.gameobj.push(this.map[er.toString()]=new er)}getGameObj(er){if(er.toString()in this.map)return this.map[er.toString()];throw new TypeError("No corresponding GameObject found")}endGame(){this.paused=2,this.gameEndElem.innerHTML="Game Over",this.gameEndElem.innerHTML+="<div style='font-size: 0.2em'>Time Elapsed: "+timeDiffToStr(this.timeElapsed)+"</div>",this.gameEndElem.innerHTML+="<div style='font-size: 0.2em'>Difficulty: "+["Casual","Normal","Brutal","Mega Brutal"][this.difficulty]+"</div>",this.gameend_resolve()}victory(){this.paused=2,this.gameEndElem.innerText="Victory",this.gameEndElem.innerHTML+="<div style='font-size: 0.2em'>Time Elapsed: "+timeDiffToStr(this.timeElapsed)+"</div>",this.gameEndElem.innerHTML+="<div style='font-size: 0.2em'>Difficulty: "+["Casual","Normal","Brutal","Mega Brutal"][this.difficulty]+"</div>",this.gameend_resolve()}get isPaused(){return!!this.paused}set isPaused(er){if(this.paused==2||!!this.paused==er||!this.gameStarted)return;this.paused=Number(er);let tr=document.getElementById("pause");tr.style.display=er?"":"none",tr=document.getElementById("invincible-ui")}}let game$1=new GameManager;class AnimationClipCreator{static CreateRotationAnimation(er,tr="x"){const ir=[0,er],nr=[0,360],sr=".rotation["+tr+"]",ar=new NumberKeyframeTrack(sr,ir,nr);return new AnimationClip(null,er,[ar])}static CreateScaleAxisAnimation(er,tr="x"){const ir=[0,er],nr=[0,1],sr=".scale["+tr+"]",ar=new NumberKeyframeTrack(sr,ir,nr);return new AnimationClip(null,er,[ar])}static CreateShakeAnimation(er,tr){const ir=[],nr=[],sr=new Vector3$1;for(let lr=0;lr<er*10;lr++)ir.push(lr/10),sr.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).multiply(tr).toArray(nr,nr.length);const ar=".position",or=new VectorKeyframeTrack(ar,ir,nr);return new AnimationClip(null,er,[or])}static CreatePulsationAnimation(er,tr){const ir=[],nr=[],sr=new Vector3$1;for(let lr=0;lr<er*10;lr++){ir.push(lr/10);const cr=Math.random()*tr;sr.set(cr,cr,cr).toArray(nr,nr.length)}const ar=".scale",or=new VectorKeyframeTrack(ar,ir,nr);return new AnimationClip(null,er,[or])}static CreateVisibilityAnimation(er){const tr=[0,er/2,er],ir=[!0,!1,!0],nr=".visible",sr=new BooleanKeyframeTrack(nr,tr,ir);return new AnimationClip(null,er,[sr])}static CreateMaterialColorAnimation(er,tr){const ir=[],nr=[],sr=tr.length>1?er/(tr.length-1):0;for(let lr=0;lr<tr.length;lr++){ir.push(lr*sr);const cr=tr[lr];nr.push(cr.r,cr.g,cr.b)}const ar=".material.color",or=new ColorKeyframeTrack(ar,ir,nr);return new AnimationClip(null,er,[or])}}const _q$2=new Quaternion$1,_targetPos=new Vector3$1,_targetVec=new Vector3$1,_effectorPos=new Vector3$1,_effectorVec=new Vector3$1,_linkPos=new Vector3$1,_invLinkQ=new Quaternion$1,_linkScale=new Vector3$1,_axis$1=new Vector3$1,_vector$4=new Vector3$1,_matrix$5=new Matrix4;class CCDIKSolver{constructor(er,tr=[]){this.mesh=er,this.iks=tr,this._valid()}update(){const er=this.iks;for(let tr=0,ir=er.length;tr<ir;tr++)this.updateOne(er[tr]);return this}updateOne(er){const tr=this.mesh.skeleton.bones,ir=Math,nr=tr[er.effector],sr=tr[er.target];_targetPos.setFromMatrixPosition(sr.matrixWorld);const ar=er.links,or=er.iteration!==void 0?er.iteration:1;for(let lr=0;lr<or;lr++){let cr=!1;for(let ur=0,dr=ar.length;ur<dr;ur++){const hr=tr[ar[ur].index];if(ar[ur].enabled===!1)break;const pr=ar[ur].limitation,gr=ar[ur].rotationMin,vr=ar[ur].rotationMax;hr.matrixWorld.decompose(_linkPos,_invLinkQ,_linkScale),_invLinkQ.invert(),_effectorPos.setFromMatrixPosition(nr.matrixWorld),_effectorVec.subVectors(_effectorPos,_linkPos),_effectorVec.applyQuaternion(_invLinkQ),_effectorVec.normalize(),_targetVec.subVectors(_targetPos,_linkPos),_targetVec.applyQuaternion(_invLinkQ),_targetVec.normalize();let mr=_targetVec.dot(_effectorVec);if(mr>1?mr=1:mr<-1&&(mr=-1),mr=ir.acos(mr),!(mr<1e-5)){if(er.minAngle!==void 0&&mr<er.minAngle&&(mr=er.minAngle),er.maxAngle!==void 0&&mr>er.maxAngle&&(mr=er.maxAngle),_axis$1.crossVectors(_effectorVec,_targetVec),_axis$1.normalize(),_q$2.setFromAxisAngle(_axis$1,mr),hr.quaternion.multiply(_q$2),pr!==void 0){let fr=hr.quaternion.w;fr>1&&(fr=1);const _r=ir.sqrt(1-fr*fr);hr.quaternion.set(pr.x*_r,pr.y*_r,pr.z*_r,fr)}gr!==void 0&&hr.rotation.setFromVector3(_vector$4.setFromEuler(hr.rotation).max(gr)),vr!==void 0&&hr.rotation.setFromVector3(_vector$4.setFromEuler(hr.rotation).min(vr)),hr.updateMatrixWorld(!0),cr=!0}}if(!cr)break}return this}createHelper(er){return new CCDIKHelper(this.mesh,this.iks,er)}_valid(){const er=this.iks,tr=this.mesh.skeleton.bones;for(let ir=0,nr=er.length;ir<nr;ir++){const sr=er[ir],ar=tr[sr.effector],or=sr.links;let lr,cr;lr=ar;for(let ur=0,dr=or.length;ur<dr;ur++)cr=tr[or[ur].index],lr.parent!==cr&&console.warn("THREE.CCDIKSolver: bone "+lr.name+" is not the child of bone "+cr.name),lr=cr}}}function getPosition(rr,er){return _vector$4.setFromMatrixPosition(rr.matrixWorld).applyMatrix4(er)}function setPositionOfBoneToAttributeArray(rr,er,tr,ir){const nr=getPosition(tr,ir);rr[er*3+0]=nr.x,rr[er*3+1]=nr.y,rr[er*3+2]=nr.z}class CCDIKHelper extends Object3D{constructor(er,tr=[],ir=.25){super(),this.root=er,this.iks=tr,this.matrix.copy(er.matrixWorld),this.matrixAutoUpdate=!1,this.sphereGeometry=new SphereGeometry(ir,16,8),this.targetSphereMaterial=new MeshBasicMaterial({color:new Color(16746632),depthTest:!1,depthWrite:!1,transparent:!0}),this.effectorSphereMaterial=new MeshBasicMaterial({color:new Color(8978312),depthTest:!1,depthWrite:!1,transparent:!0}),this.linkSphereMaterial=new MeshBasicMaterial({color:new Color(8947967),depthTest:!1,depthWrite:!1,transparent:!0}),this.lineMaterial=new LineBasicMaterial({color:new Color(16711680),depthTest:!1,depthWrite:!1,transparent:!0}),this._init()}updateMatrixWorld(er){const tr=this.root;if(this.visible){let ir=0;const nr=this.iks,sr=tr.skeleton.bones;_matrix$5.copy(tr.matrixWorld).invert();for(let ar=0,or=nr.length;ar<or;ar++){const lr=nr[ar],cr=sr[lr.target],ur=sr[lr.effector],dr=this.children[ir++],hr=this.children[ir++];dr.position.copy(getPosition(cr,_matrix$5)),hr.position.copy(getPosition(ur,_matrix$5));for(let vr=0,mr=lr.links.length;vr<mr;vr++){const fr=lr.links[vr],_r=sr[fr.index];this.children[ir++].position.copy(getPosition(_r,_matrix$5))}const pr=this.children[ir++],gr=pr.geometry.attributes.position.array;setPositionOfBoneToAttributeArray(gr,0,cr,_matrix$5),setPositionOfBoneToAttributeArray(gr,1,ur,_matrix$5);for(let vr=0,mr=lr.links.length;vr<mr;vr++){const fr=lr.links[vr],_r=sr[fr.index];setPositionOfBoneToAttributeArray(gr,vr+2,_r,_matrix$5)}pr.geometry.attributes.position.needsUpdate=!0}}this.matrix.copy(tr.matrixWorld),super.updateMatrixWorld(er)}dispose(){this.sphereGeometry.dispose(),this.targetSphereMaterial.dispose(),this.effectorSphereMaterial.dispose(),this.linkSphereMaterial.dispose(),this.lineMaterial.dispose();const er=this.children;for(let tr=0;tr<er.length;tr++){const ir=er[tr];ir.isLine&&ir.geometry.dispose()}}_init(){const er=this,tr=this.iks;function ir(lr){const cr=new BufferGeometry,ur=new Float32Array((2+lr.links.length)*3);return cr.setAttribute("position",new BufferAttribute(ur,3)),cr}function nr(){return new Mesh(er.sphereGeometry,er.targetSphereMaterial)}function sr(){return new Mesh(er.sphereGeometry,er.effectorSphereMaterial)}function ar(){return new Mesh(er.sphereGeometry,er.linkSphereMaterial)}function or(lr){return new Line(ir(lr),er.lineMaterial)}for(let lr=0,cr=tr.length;lr<cr;lr++){const ur=tr[lr];this.add(nr()),this.add(sr());for(let dr=0,hr=ur.links.length;dr<hr;dr++)this.add(ar());this.add(or(ur))}}}class MMDPhysics{constructor(er,tr,ir=[],nr={}){if(typeof Ammo>"u")throw new Error("THREE.MMDPhysics: Import ammo.js https://github.com/kripken/ammo.js");this.manager=new ResourceManager,this.mesh=er,this.unitStep=nr.unitStep!==void 0?nr.unitStep:1/65,this.maxStepNum=nr.maxStepNum!==void 0?nr.maxStepNum:3,this.gravity=new Vector3$1(0,-9.8*10,0),nr.gravity!==void 0&&this.gravity.copy(nr.gravity),this.world=nr.world!==void 0?nr.world:null,this.bodies=[],this.constraints=[],this._init(er,tr,ir),console.warn("THREE.MMDPhysics: The module has been deprecated and will be removed with r172. Please migrate to https://github.com/takahirox/three-mmd-loader instead.")}update(er){const tr=this.manager,ir=this.mesh;let nr=!1;const sr=tr.allocThreeVector3(),ar=tr.allocThreeQuaternion(),or=tr.allocThreeVector3();ir.matrixWorld.decompose(sr,ar,or),(or.x!==1||or.y!==1||or.z!==1)&&(nr=!0);let lr;return nr&&(lr=ir.parent,lr!==null&&(ir.parent=null),or.copy(this.mesh.scale),ir.scale.set(1,1,1),ir.updateMatrixWorld(!0)),this._updateRigidBodies(),this._stepSimulation(er),this._updateBones(),nr&&(lr!==null&&(ir.parent=lr),ir.scale.copy(or)),tr.freeThreeVector3(or),tr.freeThreeQuaternion(ar),tr.freeThreeVector3(sr),this}reset(){for(let er=0,tr=this.bodies.length;er<tr;er++)this.bodies[er].reset();return this}warmup(er){for(let tr=0;tr<er;tr++)this.update(1/60);return this}setGravity(er){return this.world.setGravity(new Ammo.btVector3(er.x,er.y,er.z)),this.gravity.copy(er),this}createHelper(){return new MMDPhysicsHelper(this.mesh,this)}_init(er,tr,ir){const nr=this.manager,sr=er.parent;sr!==null&&(er.parent=null);const ar=nr.allocThreeVector3(),or=nr.allocThreeQuaternion(),lr=nr.allocThreeVector3();ar.copy(er.position),or.copy(er.quaternion),lr.copy(er.scale),er.position.set(0,0,0),er.quaternion.set(0,0,0,1),er.scale.set(1,1,1),er.updateMatrixWorld(!0),this.world===null&&(this.world=this._createWorld(),this.setGravity(this.gravity)),this._initRigidBodies(tr),this._initConstraints(ir),sr!==null&&(er.parent=sr),er.position.copy(ar),er.quaternion.copy(or),er.scale.copy(lr),er.updateMatrixWorld(!0),this.reset(),nr.freeThreeVector3(ar),nr.freeThreeQuaternion(or),nr.freeThreeVector3(lr)}_createWorld(){const er=new Ammo.btDefaultCollisionConfiguration,tr=new Ammo.btCollisionDispatcher(er),ir=new Ammo.btDbvtBroadphase,nr=new Ammo.btSequentialImpulseConstraintSolver;return new Ammo.btDiscreteDynamicsWorld(tr,ir,nr,er)}_initRigidBodies(er){for(let tr=0,ir=er.length;tr<ir;tr++)this.bodies.push(new RigidBody(this.mesh,this.world,er[tr],this.manager))}_initConstraints(er){for(let tr=0,ir=er.length;tr<ir;tr++){const nr=er[tr],sr=this.bodies[nr.rigidBodyIndex1],ar=this.bodies[nr.rigidBodyIndex2];this.constraints.push(new Constraint(this.mesh,this.world,sr,ar,nr,this.manager))}}_stepSimulation(er){const tr=this.unitStep;let ir=er,nr=(er/tr|0)+1;ir<tr&&(ir=tr,nr=1),nr>this.maxStepNum&&(nr=this.maxStepNum),this.world.stepSimulation(ir,nr,tr)}_updateRigidBodies(){for(let er=0,tr=this.bodies.length;er<tr;er++)this.bodies[er].updateFromBone()}_updateBones(){for(let er=0,tr=this.bodies.length;er<tr;er++)this.bodies[er].updateBone()}}class ResourceManager{constructor(){this.threeVector3s=[],this.threeMatrix4s=[],this.threeQuaternions=[],this.threeEulers=[],this.transforms=[],this.quaternions=[],this.vector3s=[]}allocThreeVector3(){return this.threeVector3s.length>0?this.threeVector3s.pop():new Vector3$1}freeThreeVector3(er){this.threeVector3s.push(er)}allocThreeMatrix4(){return this.threeMatrix4s.length>0?this.threeMatrix4s.pop():new Matrix4}freeThreeMatrix4(er){this.threeMatrix4s.push(er)}allocThreeQuaternion(){return this.threeQuaternions.length>0?this.threeQuaternions.pop():new Quaternion$1}freeThreeQuaternion(er){this.threeQuaternions.push(er)}allocThreeEuler(){return this.threeEulers.length>0?this.threeEulers.pop():new Euler}freeThreeEuler(er){this.threeEulers.push(er)}allocTransform(){return this.transforms.length>0?this.transforms.pop():new Ammo.btTransform}freeTransform(er){this.transforms.push(er)}allocQuaternion(){return this.quaternions.length>0?this.quaternions.pop():new Ammo.btQuaternion}freeQuaternion(er){this.quaternions.push(er)}allocVector3(){return this.vector3s.length>0?this.vector3s.pop():new Ammo.btVector3}freeVector3(er){this.vector3s.push(er)}setIdentity(er){er.setIdentity()}getBasis(er){var tr=this.allocQuaternion();return er.getBasis().getRotation(tr),tr}getBasisAsMatrix3(er){var tr=this.getBasis(er),ir=this.quaternionToMatrix3(tr);return this.freeQuaternion(tr),ir}getOrigin(er){return er.getOrigin()}setOrigin(er,tr){er.getOrigin().setValue(tr.x(),tr.y(),tr.z())}copyOrigin(er,tr){var ir=tr.getOrigin();this.setOrigin(er,ir)}setBasis(er,tr){er.setRotation(tr)}setBasisFromMatrix3(er,tr){var ir=this.matrix3ToQuaternion(tr);this.setBasis(er,ir),this.freeQuaternion(ir)}setOriginFromArray3(er,tr){er.getOrigin().setValue(tr[0],tr[1],tr[2])}setOriginFromThreeVector3(er,tr){er.getOrigin().setValue(tr.x,tr.y,tr.z)}setBasisFromArray3(er,tr){var ir=this.allocThreeQuaternion(),nr=this.allocThreeEuler();nr.set(tr[0],tr[1],tr[2]),this.setBasisFromThreeQuaternion(er,ir.setFromEuler(nr)),this.freeThreeEuler(nr),this.freeThreeQuaternion(ir)}setBasisFromThreeQuaternion(er,tr){var ir=this.allocQuaternion();ir.setX(tr.x),ir.setY(tr.y),ir.setZ(tr.z),ir.setW(tr.w),this.setBasis(er,ir),this.freeQuaternion(ir)}multiplyTransforms(er,tr){var ir=this.allocTransform();this.setIdentity(ir);var nr=this.getBasisAsMatrix3(er),sr=this.getBasisAsMatrix3(tr),ar=this.getOrigin(er),or=this.getOrigin(tr),lr=this.multiplyMatrix3ByVector3(nr,or),cr=this.addVector3(lr,ar);this.setOrigin(ir,cr);var ur=this.multiplyMatrices3(nr,sr);return this.setBasisFromMatrix3(ir,ur),this.freeVector3(lr),this.freeVector3(cr),ir}inverseTransform(er){var tr=this.allocTransform(),ir=this.getBasisAsMatrix3(er),nr=this.getOrigin(er),sr=this.transposeMatrix3(ir),ar=this.negativeVector3(nr),or=this.multiplyMatrix3ByVector3(sr,ar);return this.setOrigin(tr,or),this.setBasisFromMatrix3(tr,sr),this.freeVector3(ar),this.freeVector3(or),tr}multiplyMatrices3(er,tr){var ir=[],nr=this.rowOfMatrix3(er,0),sr=this.rowOfMatrix3(er,1),ar=this.rowOfMatrix3(er,2),or=this.columnOfMatrix3(tr,0),lr=this.columnOfMatrix3(tr,1),cr=this.columnOfMatrix3(tr,2);return ir[0]=this.dotVectors3(nr,or),ir[1]=this.dotVectors3(nr,lr),ir[2]=this.dotVectors3(nr,cr),ir[3]=this.dotVectors3(sr,or),ir[4]=this.dotVectors3(sr,lr),ir[5]=this.dotVectors3(sr,cr),ir[6]=this.dotVectors3(ar,or),ir[7]=this.dotVectors3(ar,lr),ir[8]=this.dotVectors3(ar,cr),this.freeVector3(nr),this.freeVector3(sr),this.freeVector3(ar),this.freeVector3(or),this.freeVector3(lr),this.freeVector3(cr),ir}addVector3(er,tr){var ir=this.allocVector3();return ir.setValue(er.x()+tr.x(),er.y()+tr.y(),er.z()+tr.z()),ir}dotVectors3(er,tr){return er.x()*tr.x()+er.y()*tr.y()+er.z()*tr.z()}rowOfMatrix3(er,tr){var ir=this.allocVector3();return ir.setValue(er[tr*3+0],er[tr*3+1],er[tr*3+2]),ir}columnOfMatrix3(er,tr){var ir=this.allocVector3();return ir.setValue(er[tr+0],er[tr+3],er[tr+6]),ir}negativeVector3(er){var tr=this.allocVector3();return tr.setValue(-er.x(),-er.y(),-er.z()),tr}multiplyMatrix3ByVector3(er,tr){var ir=this.allocVector3(),nr=this.rowOfMatrix3(er,0),sr=this.rowOfMatrix3(er,1),ar=this.rowOfMatrix3(er,2),or=this.dotVectors3(nr,tr),lr=this.dotVectors3(sr,tr),cr=this.dotVectors3(ar,tr);return ir.setValue(or,lr,cr),this.freeVector3(nr),this.freeVector3(sr),this.freeVector3(ar),ir}transposeMatrix3(er){var tr=[];return tr[0]=er[0],tr[1]=er[3],tr[2]=er[6],tr[3]=er[1],tr[4]=er[4],tr[5]=er[7],tr[6]=er[2],tr[7]=er[5],tr[8]=er[8],tr}quaternionToMatrix3(er){var tr=[],ir=er.x(),nr=er.y(),sr=er.z(),ar=er.w(),or=ir*ir,lr=nr*nr,cr=sr*sr,ur=ir*nr,dr=nr*sr,hr=sr*ir,pr=ir*ar,gr=nr*ar,vr=sr*ar;return tr[0]=1-2*(lr+cr),tr[1]=2*(ur-vr),tr[2]=2*(hr+gr),tr[3]=2*(ur+vr),tr[4]=1-2*(cr+or),tr[5]=2*(dr-pr),tr[6]=2*(hr-gr),tr[7]=2*(dr+pr),tr[8]=1-2*(or+lr),tr}matrix3ToQuaternion(er){var tr=er[0]+er[4]+er[8],ir,nr,sr,ar,or;tr>0?(ir=Math.sqrt(tr+1)*2,or=.25*ir,nr=(er[7]-er[5])/ir,sr=(er[2]-er[6])/ir,ar=(er[3]-er[1])/ir):er[0]>er[4]&&er[0]>er[8]?(ir=Math.sqrt(1+er[0]-er[4]-er[8])*2,or=(er[7]-er[5])/ir,nr=.25*ir,sr=(er[1]+er[3])/ir,ar=(er[2]+er[6])/ir):er[4]>er[8]?(ir=Math.sqrt(1+er[4]-er[0]-er[8])*2,or=(er[2]-er[6])/ir,nr=(er[1]+er[3])/ir,sr=.25*ir,ar=(er[5]+er[7])/ir):(ir=Math.sqrt(1+er[8]-er[0]-er[4])*2,or=(er[3]-er[1])/ir,nr=(er[2]+er[6])/ir,sr=(er[5]+er[7])/ir,ar=.25*ir);var lr=this.allocQuaternion();return lr.setX(nr),lr.setY(sr),lr.setZ(ar),lr.setW(or),lr}}class RigidBody{constructor(er,tr,ir,nr){this.mesh=er,this.world=tr,this.params=ir,this.manager=nr,this.body=null,this.bone=null,this.boneOffsetForm=null,this.boneOffsetFormInverse=null,this._init()}reset(){return this._setTransformFromBone(),this}updateFromBone(){return this.params.boneIndex!==-1&&this.params.type===0&&this._setTransformFromBone(),this}updateBone(){return this.params.type===0||this.params.boneIndex===-1?this:(this._updateBoneRotation(),this.params.type===1&&this._updateBonePosition(),this.bone.updateMatrixWorld(!0),this.params.type===2&&this._setPositionFromBone(),this)}_init(){function er(mr){switch(mr.shapeType){case 0:return new Ammo.btSphereShape(mr.width);case 1:return new Ammo.btBoxShape(new Ammo.btVector3(mr.width,mr.height,mr.depth));case 2:return new Ammo.btCapsuleShape(mr.width,mr.height);default:throw new Error("unknown shape type "+mr.shapeType)}}const tr=this.manager,ir=this.params,nr=this.mesh.skeleton.bones,sr=ir.boneIndex===-1?new Bone:nr[ir.boneIndex],ar=er(ir),or=ir.type===0?0:ir.weight,lr=tr.allocVector3();lr.setValue(0,0,0),or!==0&&ar.calculateLocalInertia(or,lr);const cr=tr.allocTransform();tr.setIdentity(cr),tr.setOriginFromArray3(cr,ir.position),tr.setBasisFromArray3(cr,ir.rotation);const ur=tr.allocThreeVector3(),dr=tr.allocTransform();tr.setIdentity(dr),tr.setOriginFromThreeVector3(dr,sr.getWorldPosition(ur));const hr=tr.multiplyTransforms(dr,cr),pr=new Ammo.btDefaultMotionState(hr),gr=new Ammo.btRigidBodyConstructionInfo(or,pr,ar,lr);gr.set_m_friction(ir.friction),gr.set_m_restitution(ir.restitution);const vr=new Ammo.btRigidBody(gr);ir.type===0&&(vr.setCollisionFlags(vr.getCollisionFlags()|2),vr.setActivationState(4)),vr.setDamping(ir.positionDamping,ir.rotationDamping),vr.setSleepingThresholds(0,0),this.world.addRigidBody(vr,1<<ir.groupIndex,ir.groupTarget),this.body=vr,this.bone=sr,this.boneOffsetForm=cr,this.boneOffsetFormInverse=tr.inverseTransform(cr),tr.freeVector3(lr),tr.freeTransform(hr),tr.freeTransform(dr),tr.freeThreeVector3(ur)}_getBoneTransform(){const er=this.manager,tr=er.allocThreeVector3(),ir=er.allocThreeQuaternion(),nr=er.allocThreeVector3();this.bone.matrixWorld.decompose(tr,ir,nr);const sr=er.allocTransform();er.setOriginFromThreeVector3(sr,tr),er.setBasisFromThreeQuaternion(sr,ir);const ar=er.multiplyTransforms(sr,this.boneOffsetForm);return er.freeTransform(sr),er.freeThreeVector3(nr),er.freeThreeQuaternion(ir),er.freeThreeVector3(tr),ar}_getWorldTransformForBone(){const er=this.manager,tr=this.body.getCenterOfMassTransform();return er.multiplyTransforms(tr,this.boneOffsetFormInverse)}_setTransformFromBone(){const er=this.manager,tr=this._getBoneTransform();this.body.setCenterOfMassTransform(tr),this.body.getMotionState().setWorldTransform(tr),er.freeTransform(tr)}_setPositionFromBone(){const er=this.manager,tr=this._getBoneTransform(),ir=er.allocTransform();this.body.getMotionState().getWorldTransform(ir),er.copyOrigin(ir,tr),this.body.setCenterOfMassTransform(ir),this.body.getMotionState().setWorldTransform(ir),er.freeTransform(ir),er.freeTransform(tr)}_updateBoneRotation(){const er=this.manager,tr=this._getWorldTransformForBone(),ir=er.getBasis(tr),nr=er.allocThreeQuaternion(),sr=er.allocThreeQuaternion(),ar=er.allocThreeQuaternion();nr.set(ir.x(),ir.y(),ir.z(),ir.w()),sr.setFromRotationMatrix(this.bone.matrixWorld),sr.conjugate(),sr.multiply(nr),ar.setFromRotationMatrix(this.bone.matrix),this.bone.quaternion.copy(sr.multiply(ar).normalize()),er.freeThreeQuaternion(nr),er.freeThreeQuaternion(sr),er.freeThreeQuaternion(ar),er.freeQuaternion(ir),er.freeTransform(tr)}_updateBonePosition(){const er=this.manager,tr=this._getWorldTransformForBone(),ir=er.allocThreeVector3(),nr=er.getOrigin(tr);ir.set(nr.x(),nr.y(),nr.z()),this.bone.parent&&this.bone.parent.worldToLocal(ir),this.bone.position.copy(ir),er.freeThreeVector3(ir),er.freeTransform(tr)}}class Constraint{constructor(er,tr,ir,nr,sr,ar){this.mesh=er,this.world=tr,this.bodyA=ir,this.bodyB=nr,this.params=sr,this.manager=ar,this.constraint=null,this._init()}_init(){const er=this.manager,tr=this.params,ir=this.bodyA,nr=this.bodyB,sr=er.allocTransform();er.setIdentity(sr),er.setOriginFromArray3(sr,tr.position),er.setBasisFromArray3(sr,tr.rotation);const ar=er.allocTransform(),or=er.allocTransform();ir.body.getMotionState().getWorldTransform(ar),nr.body.getMotionState().getWorldTransform(or);const lr=er.inverseTransform(ar),cr=er.inverseTransform(or),ur=er.multiplyTransforms(lr,sr),dr=er.multiplyTransforms(cr,sr),hr=new Ammo.btGeneric6DofSpringConstraint(ir.body,nr.body,ur,dr,!0),pr=er.allocVector3(),gr=er.allocVector3(),vr=er.allocVector3(),mr=er.allocVector3();pr.setValue(tr.translationLimitation1[0],tr.translationLimitation1[1],tr.translationLimitation1[2]),gr.setValue(tr.translationLimitation2[0],tr.translationLimitation2[1],tr.translationLimitation2[2]),vr.setValue(tr.rotationLimitation1[0],tr.rotationLimitation1[1],tr.rotationLimitation1[2]),mr.setValue(tr.rotationLimitation2[0],tr.rotationLimitation2[1],tr.rotationLimitation2[2]),hr.setLinearLowerLimit(pr),hr.setLinearUpperLimit(gr),hr.setAngularLowerLimit(vr),hr.setAngularUpperLimit(mr);for(let fr=0;fr<3;fr++)tr.springPosition[fr]!==0&&(hr.enableSpring(fr,!0),hr.setStiffness(fr,tr.springPosition[fr]));for(let fr=0;fr<3;fr++)tr.springRotation[fr]!==0&&(hr.enableSpring(fr+3,!0),hr.setStiffness(fr+3,tr.springRotation[fr]));if(hr.setParam!==void 0)for(let fr=0;fr<6;fr++)hr.setParam(2,.475,fr);this.world.addConstraint(hr,!0),this.constraint=hr,er.freeTransform(sr),er.freeTransform(ar),er.freeTransform(or),er.freeTransform(lr),er.freeTransform(cr),er.freeTransform(ur),er.freeTransform(dr),er.freeVector3(pr),er.freeVector3(gr),er.freeVector3(vr),er.freeVector3(mr)}}const _position$2=new Vector3$1,_quaternion$3=new Quaternion$1,_scale$3=new Vector3$1,_matrixWorldInv=new Matrix4;class MMDPhysicsHelper extends Object3D{constructor(er,tr){super(),this.root=er,this.physics=tr,this.matrix.copy(er.matrixWorld),this.matrixAutoUpdate=!1,this.materials=[],this.materials.push(new MeshBasicMaterial({color:new Color(16746632),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8978312),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this.materials.push(new MeshBasicMaterial({color:new Color(8947967),wireframe:!0,depthTest:!1,depthWrite:!1,opacity:.25,transparent:!0})),this._init()}dispose(){const er=this.materials,tr=this.children;for(let ir=0;ir<er.length;ir++)er[ir].dispose();for(let ir=0;ir<tr.length;ir++){const nr=tr[ir];nr.isMesh&&nr.geometry.dispose()}}updateMatrixWorld(er){var tr=this.root;if(this.visible){var ir=this.physics.bodies;_matrixWorldInv.copy(tr.matrixWorld).decompose(_position$2,_quaternion$3,_scale$3).compose(_position$2,_quaternion$3,_scale$3.set(1,1,1)).invert();for(var nr=0,sr=ir.length;nr<sr;nr++){var ar=ir[nr].body,or=this.children[nr],lr=ar.getCenterOfMassTransform(),cr=lr.getOrigin(),ur=lr.getRotation();or.position.set(cr.x(),cr.y(),cr.z()).applyMatrix4(_matrixWorldInv),or.quaternion.setFromRotationMatrix(_matrixWorldInv).multiply(_quaternion$3.set(ur.x(),ur.y(),ur.z(),ur.w()))}}this.matrix.copy(tr.matrixWorld).decompose(_position$2,_quaternion$3,_scale$3).compose(_position$2,_quaternion$3,_scale$3.set(1,1,1)),super.updateMatrixWorld(er)}_init(){var er=this.physics.bodies;function tr(ar){switch(ar.shapeType){case 0:return new SphereGeometry(ar.width,16,8);case 1:return new BoxGeometry(ar.width*2,ar.height*2,ar.depth*2,8,8,8);case 2:return new CapsuleGeometry(ar.width,ar.height,8,16);default:return null}}for(var ir=0,nr=er.length;ir<nr;ir++){var sr=er[ir].params;this.add(new Mesh(tr(sr),this.materials[sr.type]))}}}class MMDAnimationHelper{constructor(er={}){this.meshes=[],this.camera=null,this.cameraTarget=new Object3D,this.cameraTarget.name="target",this.audio=null,this.audioManager=null,this.objects=new WeakMap,this.configuration={sync:er.sync!==void 0?er.sync:!0,afterglow:er.afterglow!==void 0?er.afterglow:0,resetPhysicsOnLoop:er.resetPhysicsOnLoop!==void 0?er.resetPhysicsOnLoop:!0,pmxAnimation:er.pmxAnimation!==void 0?er.pmxAnimation:!1},this.enabled={animation:!0,ik:!0,grant:!0,physics:!0,cameraAnimation:!0},this.onBeforePhysics=function(){},this.sharedPhysics=!1,this.masterPhysics=null,console.warn("THREE.MMDAnimationHelper: The module has been deprecated and will be removed with r172. Please migrate to https://github.com/takahirox/three-mmd-loader instead.")}add(er,tr={}){if(er.isSkinnedMesh)this._addMesh(er,tr);else if(er.isCamera)this._setupCamera(er,tr);else if(er.type==="Audio")this._setupAudio(er,tr);else throw new Error("THREE.MMDAnimationHelper.add: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}remove(er){if(er.isSkinnedMesh)this._removeMesh(er);else if(er.isCamera)this._clearCamera(er);else if(er.type==="Audio")this._clearAudio(er);else throw new Error("THREE.MMDAnimationHelper.remove: accepts only THREE.SkinnedMesh or THREE.Camera or THREE.Audio instance.");return this.configuration.sync&&this._syncDuration(),this}update(er){this.audioManager!==null&&this.audioManager.control(er);for(let tr=0;tr<this.meshes.length;tr++)this._animateMesh(this.meshes[tr],er);return this.sharedPhysics&&this._updateSharedPhysics(er),this.camera!==null&&this._animateCamera(this.camera,er),this}pose(er,tr,ir={}){ir.resetPose!==!1&&er.pose();const nr=er.skeleton.bones,sr=tr.bones,ar={};for(let cr=0,ur=nr.length;cr<ur;cr++)ar[nr[cr].name]=cr;const or=new Vector3$1,lr=new Quaternion$1;for(let cr=0,ur=sr.length;cr<ur;cr++){const dr=sr[cr],hr=ar[dr.name];if(hr===void 0)continue;const pr=nr[hr];pr.position.add(or.fromArray(dr.translation)),pr.quaternion.multiply(lr.fromArray(dr.quaternion))}if(er.updateMatrixWorld(!0),this.configuration.pmxAnimation&&er.geometry.userData.MMD&&er.geometry.userData.MMD.format==="pmx"){const cr=this._sortBoneDataArray(er.geometry.userData.MMD.bones.slice()),ur=ir.ik!==!1?this._createCCDIKSolver(er):null,dr=ir.grant!==!1?this.createGrantSolver(er):null;this._animatePMXMesh(er,cr,ur,dr)}else ir.ik!==!1&&this._createCCDIKSolver(er).update(),ir.grant!==!1&&this.createGrantSolver(er).update();return this}enable(er,tr){if(this.enabled[er]===void 0)throw new Error("THREE.MMDAnimationHelper.enable: unknown key "+er);if(this.enabled[er]=tr,er==="physics")for(let ir=0,nr=this.meshes.length;ir<nr;ir++)this._optimizeIK(this.meshes[ir],tr);return this}createGrantSolver(er){return new GrantSolver(er,er.geometry.userData.MMD.grants)}_addMesh(er,tr){if(this.meshes.indexOf(er)>=0)throw new Error("THREE.MMDAnimationHelper._addMesh: SkinnedMesh '"+er.name+"' has already been added.");return this.meshes.push(er),this.objects.set(er,{looped:!1}),this._setupMeshAnimation(er,tr.animation),tr.physics!==!1&&this._setupMeshPhysics(er,tr),this}_setupCamera(er,tr){if(this.camera===er)throw new Error("THREE.MMDAnimationHelper._setupCamera: Camera '"+er.name+"' has already been set.");return this.camera&&this.clearCamera(this.camera),this.camera=er,er.add(this.cameraTarget),this.objects.set(er,{}),tr.animation!==void 0&&this._setupCameraAnimation(er,tr.animation),this}_setupAudio(er,tr){if(this.audio===er)throw new Error("THREE.MMDAnimationHelper._setupAudio: Audio '"+er.name+"' has already been set.");return this.audio&&this.clearAudio(this.audio),this.audio=er,this.audioManager=new AudioManager(er,tr),this.objects.set(this.audioManager,{duration:this.audioManager.duration}),this}_removeMesh(er){let tr=!1,ir=0;for(let nr=0,sr=this.meshes.length;nr<sr;nr++){if(this.meshes[nr]===er){this.objects.delete(er),tr=!0;continue}this.meshes[ir++]=this.meshes[nr]}if(!tr)throw new Error("THREE.MMDAnimationHelper._removeMesh: SkinnedMesh '"+er.name+"' has not been added yet.");return this.meshes.length=ir,this}_clearCamera(er){if(er!==this.camera)throw new Error("THREE.MMDAnimationHelper._clearCamera: Camera '"+er.name+"' has not been set yet.");return this.camera.remove(this.cameraTarget),this.objects.delete(this.camera),this.camera=null,this}_clearAudio(er){if(er!==this.audio)throw new Error("THREE.MMDAnimationHelper._clearAudio: Audio '"+er.name+"' has not been set yet.");return this.objects.delete(this.audioManager),this.audio=null,this.audioManager=null,this}_setupMeshAnimation(er,tr){const ir=this.objects.get(er);if(tr!==void 0){const nr=Array.isArray(tr)?tr:[tr];ir.mixer=new AnimationMixer(er);for(let sr=0,ar=nr.length;sr<ar;sr++)ir.mixer.clipAction(nr[sr]).play();ir.mixer.addEventListener("loop",function(sr){const ar=sr.action._clip.tracks;ar.length>0&&ar[0].name.slice(0,6)!==".bones"||(ir.looped=!0)})}return ir.ikSolver=this._createCCDIKSolver(er),ir.grantSolver=this.createGrantSolver(er),this}_setupCameraAnimation(er,tr){const ir=Array.isArray(tr)?tr:[tr],nr=this.objects.get(er);nr.mixer=new AnimationMixer(er);for(let sr=0,ar=ir.length;sr<ar;sr++)nr.mixer.clipAction(ir[sr]).play()}_setupMeshPhysics(er,tr){const ir=this.objects.get(er);if(tr.world===void 0&&this.sharedPhysics){const nr=this._getMasterPhysics();nr!==null&&(world=nr.world)}ir.physics=this._createMMDPhysics(er,tr),ir.mixer&&tr.animationWarmup!==!1&&(this._animateMesh(er,0),ir.physics.reset()),ir.physics.warmup(tr.warmup!==void 0?tr.warmup:60),this._optimizeIK(er,!0)}_animateMesh(er,tr){const ir=this.objects.get(er),nr=ir.mixer,sr=ir.ikSolver,ar=ir.grantSolver,or=ir.physics,lr=ir.looped;nr&&this.enabled.animation&&(this._restoreBones(er),nr.update(tr),this._saveBones(er),this.configuration.pmxAnimation&&er.geometry.userData.MMD&&er.geometry.userData.MMD.format==="pmx"?(ir.sortedBonesData||(ir.sortedBonesData=this._sortBoneDataArray(er.geometry.userData.MMD.bones.slice())),this._animatePMXMesh(er,ir.sortedBonesData,sr&&this.enabled.ik?sr:null,ar&&this.enabled.grant?ar:null)):(sr&&this.enabled.ik&&(er.updateMatrixWorld(!0),sr.update()),ar&&this.enabled.grant&&ar.update())),lr===!0&&this.enabled.physics&&(or&&this.configuration.resetPhysicsOnLoop&&or.reset(),ir.looped=!1),or&&this.enabled.physics&&!this.sharedPhysics&&(this.onBeforePhysics(er),or.update(tr))}_sortBoneDataArray(er){return er.sort(function(tr,ir){return tr.transformationClass!==ir.transformationClass?tr.transformationClass-ir.transformationClass:tr.index-ir.index})}_animatePMXMesh(er,tr,ir,nr){_quaternionIndex=0,_grantResultMap.clear();for(let sr=0,ar=tr.length;sr<ar;sr++)updateOne(er,tr[sr].index,ir,nr);return er.updateMatrixWorld(!0),this}_animateCamera(er,tr){const ir=this.objects.get(er).mixer;ir&&this.enabled.cameraAnimation&&(ir.update(tr),er.updateProjectionMatrix(),er.up.set(0,1,0),er.up.applyQuaternion(er.quaternion),er.lookAt(this.cameraTarget.position))}_optimizeIK(er,tr){const ir=er.geometry.userData.MMD.iks,nr=er.geometry.userData.MMD.bones;for(let sr=0,ar=ir.length;sr<ar;sr++){const lr=ir[sr].links;for(let cr=0,ur=lr.length;cr<ur;cr++){const dr=lr[cr];tr===!0?dr.enabled=!(nr[dr.index].rigidBodyType>0):dr.enabled=!0}}}_createCCDIKSolver(er){if(CCDIKSolver===void 0)throw new Error("THREE.MMDAnimationHelper: Import CCDIKSolver.");return new CCDIKSolver(er,er.geometry.userData.MMD.iks)}_createMMDPhysics(er,tr){if(MMDPhysics===void 0)throw new Error("THREE.MMDPhysics: Import MMDPhysics.");return new MMDPhysics(er,er.geometry.userData.MMD.rigidBodies,er.geometry.userData.MMD.constraints,tr)}_syncDuration(){let er=0;const tr=this.objects,ir=this.meshes,nr=this.camera,sr=this.audioManager;for(let ar=0,or=ir.length;ar<or;ar++){const lr=this.objects.get(ir[ar]).mixer;if(lr!==void 0)for(let cr=0;cr<lr._actions.length;cr++){const ur=lr._actions[cr]._clip;tr.has(ur)||tr.set(ur,{duration:ur.duration}),er=Math.max(er,tr.get(ur).duration)}}if(nr!==null){const ar=this.objects.get(nr).mixer;if(ar!==void 0)for(let or=0,lr=ar._actions.length;or<lr;or++){const cr=ar._actions[or]._clip;tr.has(cr)||tr.set(cr,{duration:cr.duration}),er=Math.max(er,tr.get(cr).duration)}}sr!==null&&(er=Math.max(er,tr.get(sr).duration)),er+=this.configuration.afterglow;for(let ar=0,or=this.meshes.length;ar<or;ar++){const lr=this.objects.get(this.meshes[ar]).mixer;if(lr!==void 0)for(let cr=0,ur=lr._actions.length;cr<ur;cr++)lr._actions[cr]._clip.duration=er}if(nr!==null){const ar=this.objects.get(nr).mixer;if(ar!==void 0)for(let or=0,lr=ar._actions.length;or<lr;or++)ar._actions[or]._clip.duration=er}sr!==null&&(sr.duration=er)}_updatePropertyMixersBuffer(er){const tr=this.objects.get(er).mixer,ir=tr._bindings,nr=tr._accuIndex;for(let sr=0,ar=ir.length;sr<ar;sr++){const or=ir[sr],lr=or.buffer,cr=or.valueSize,ur=(nr+1)*cr;or.binding.getValue(lr,ur)}}_saveBones(er){const tr=this.objects.get(er),ir=er.skeleton.bones;let nr=tr.backupBones;nr===void 0&&(nr=new Float32Array(ir.length*7),tr.backupBones=nr);for(let sr=0,ar=ir.length;sr<ar;sr++){const or=ir[sr];or.position.toArray(nr,sr*7),or.quaternion.toArray(nr,sr*7+3)}}_restoreBones(er){const ir=this.objects.get(er).backupBones;if(ir===void 0)return;const nr=er.skeleton.bones;for(let sr=0,ar=nr.length;sr<ar;sr++){const or=nr[sr];or.position.fromArray(ir,sr*7),or.quaternion.fromArray(ir,sr*7+3)}}_getMasterPhysics(){if(this.masterPhysics!==null)return this.masterPhysics;for(let er=0,tr=this.meshes.length;er<tr;er++){const ir=this.meshes[er].physics;if(ir!=null)return this.masterPhysics=ir,this.masterPhysics}return null}_updateSharedPhysics(er){if(this.meshes.length===0||!this.enabled.physics||!this.sharedPhysics)return;const tr=this._getMasterPhysics();if(tr!==null){for(let ir=0,nr=this.meshes.length;ir<nr;ir++){const sr=this.meshes[ir].physics;sr?.updateRigidBodies()}tr.stepSimulation(er);for(let ir=0,nr=this.meshes.length;ir<nr;ir++){const sr=this.meshes[ir].physics;sr?.updateBones()}}}}const _quaternions=[];let _quaternionIndex=0;function getQuaternion(){return _quaternionIndex>=_quaternions.length&&_quaternions.push(new Quaternion$1),_quaternions[_quaternionIndex++]}const _grantResultMap=new Map;function updateOne(rr,er,tr,ir){const nr=rr.skeleton.bones,ar=rr.geometry.userData.MMD.bones[er],or=nr[er];if(_grantResultMap.has(er))return;const lr=getQuaternion();if(_grantResultMap.set(er,lr.copy(or.quaternion)),ir&&ar.grant&&!ar.grant.isLocal&&ar.grant.affectRotation){const cr=ar.grant.parentIndex,ur=ar.grant.ratio;_grantResultMap.has(cr)||updateOne(rr,cr,tr,ir),ir.addGrantRotation(or,_grantResultMap.get(cr),ur)}if(tr&&ar.ik){rr.updateMatrixWorld(!0),tr.updateOne(ar.ik);const cr=ar.ik.links;for(let ur=0,dr=cr.length;ur<dr;ur++){const hr=cr[ur];if(hr.enabled===!1)continue;const pr=hr.index;_grantResultMap.has(pr)&&_grantResultMap.set(pr,_grantResultMap.get(pr).copy(nr[pr].quaternion))}}lr.copy(or.quaternion)}class AudioManager{constructor(er,tr={}){this.audio=er,this.elapsedTime=0,this.currentTime=0,this.delayTime=tr.delayTime!==void 0?tr.delayTime:0,this.audioDuration=this.audio.buffer.duration,this.duration=this.audioDuration+this.delayTime}control(er){return this.elapsed+=er,this.currentTime+=er,this._shouldStopAudio()&&this.audio.stop(),this._shouldStartAudio()&&this.audio.play(),this}_shouldStartAudio(){if(this.audio.isPlaying)return!1;for(;this.currentTime>=this.duration;)this.currentTime-=this.duration;return!(this.currentTime<this.delayTime||this.currentTime-this.delayTime>this.audioDuration)}_shouldStopAudio(){return this.audio.isPlaying&&this.currentTime>=this.duration}}const _q$1=new Quaternion$1;class GrantSolver{constructor(er,tr=[]){this.mesh=er,this.grants=tr}update(){const er=this.grants;for(let tr=0,ir=er.length;tr<ir;tr++)this.updateOne(er[tr]);return this}updateOne(er){const tr=this.mesh.skeleton.bones,ir=tr[er.index],nr=tr[er.parentIndex];return er.isLocal?(er.affectPosition,er.affectRotation):(er.affectPosition,er.affectRotation&&this.addGrantRotation(ir,nr.quaternion,er.ratio)),this}addGrantRotation(er,tr,ir){return _q$1.set(0,0,0,1),_q$1.slerp(tr,ir),er.quaternion.multiply(_q$1),this}}class WebGL{static isWebGL2Available(){try{const er=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&er.getContext("webgl2"))}catch{return!1}}static isColorSpaceAvailable(er){try{const tr=document.createElement("canvas"),ir=window.WebGL2RenderingContext&&tr.getContext("webgl2");return ir.drawingBufferColorSpace=er,ir.drawingBufferColorSpace===er}catch{return!1}}static getWebGL2ErrorMessage(){return this.getErrorMessage(2)}static getErrorMessage(er){const tr={1:"WebGL",2:"WebGL 2"},ir={1:window.WebGLRenderingContext,2:window.WebGL2RenderingContext};let nr='Your $0 does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">$1</a>';const sr=document.createElement("div");return sr.id="webglmessage",sr.style.fontFamily="monospace",sr.style.fontSize="13px",sr.style.fontWeight="normal",sr.style.textAlign="center",sr.style.background="#fff",sr.style.color="#000",sr.style.padding="1.5em",sr.style.width="400px",sr.style.margin="5em auto 0",ir[er]?nr=nr.replace("$0","graphics card"):nr=nr.replace("$0","browser"),nr=nr.replace("$1",tr[er]),sr.innerHTML=nr,sr}static isWebGLAvailable(){console.warn("isWebGLAvailable() has been deprecated and will be removed in r178. Use isWebGL2Available() instead.");try{const er=document.createElement("canvas");return!!(window.WebGLRenderingContext&&(er.getContext("webgl")||er.getContext("experimental-webgl")))}catch{return!1}}static getWebGLErrorMessage(){return console.warn("getWebGLErrorMessage() has been deprecated and will be removed in r178. Use getWebGL2ErrorMessage() instead."),this.getErrorMessage(1)}}const STATE$1={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},INPUT={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},_center$2={x:0,y:0},_transformation={camera:new Matrix4,gizmos:new Matrix4},_changeEvent$5={type:"change"},_startEvent$2={type:"start"},_endEvent$2={type:"end"},_raycaster$2=new Raycaster,_offset$1=new Vector3$1,_gizmoMatrixStateTemp=new Matrix4,_cameraMatrixStateTemp=new Matrix4,_scalePointTemp=new Vector3$1;class ArcballControls extends Controls{constructor(er,tr=null,ir=null){super(er,tr),this.scene=ir,this.target=new Vector3$1,this._currentTarget=new Vector3$1,this.radiusFactor=.67,this.mouseActions=[],this._mouseOp=null,this._v2_1=new Vector2,this._v3_1=new Vector3$1,this._v3_2=new Vector3$1,this._m4_1=new Matrix4,this._m4_2=new Matrix4,this._quat=new Quaternion$1,this._translationMatrix=new Matrix4,this._rotationMatrix=new Matrix4,this._scaleMatrix=new Matrix4,this._rotationAxis=new Vector3$1,this._cameraMatrixState=new Matrix4,this._cameraProjectionState=new Matrix4,this._fovState=1,this._upState=new Vector3$1,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new Matrix4,this._up0=new Vector3$1,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new Matrix4,this._gizmoMatrixState0=new Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=INPUT.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._downStart=0,this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new Vector3$1,this._startCursorPosition=new Vector3$1,this._grid=null,this._gridPosition=new Vector3$1,this._gizmos=new Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new Vector3$1,this._cursorPosCurr=new Vector3$1,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.rotateSpeed=1,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.enableGizmos=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this._tbRadius=1,this._state=STATE$1.IDLE,this.setCamera(er),this.scene!=null&&this.scene.add(this._gizmos),this.initializeMouseActions(),this._onContextMenu=onContextMenu$5.bind(this),this._onWheel=onWheel.bind(this),this._onPointerUp=onPointerUp$5.bind(this),this._onPointerMove=onPointerMove$6.bind(this),this._onPointerDown=onPointerDown$6.bind(this),this._onPointerCancel=onPointerCancel$3.bind(this),this._onWindowResize=onWindowResize.bind(this),tr!==null&&this.connect()}connect(){this.domElement.style.touchAction="none",this._devPxRatio=window.devicePixelRatio,this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onWheel),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),window.addEventListener("resize",this._onWindowResize)}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),window.removeEventListener("resize",this._onWindowResize)}onSinglePanStart(er,tr){if(this.enabled)switch(this.dispatchEvent(_startEvent$2),this.setCenter(er.clientX,er.clientY),tr){case"PAN":if(!this.enablePan)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.PAN,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(_changeEvent$5));break;case"ROTATE":if(!this.enableRotate)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.updateTbState(STATE$1.ROTATE,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius)),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr),this.dispatchEvent(_changeEvent$5);break;case"FOV":if(!this.object.isPerspectiveCamera||!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.FOV,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break;case"ZOOM":if(!this.enableZoom)return;this._animationId!=-1&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)),this.updateTbState(STATE$1.SCALE,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition);break}}onSinglePanMove(er,tr){if(this.enabled){const ir=tr!=this._state;switch(this.setCenter(er.clientX,er.clientY),tr){case STATE$1.PAN:this.enablePan&&(ir?(this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)):(this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))));break;case STATE$1.ROTATE:if(this.enableRotate)if(ir)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius)),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0);else{this._currentCursorPosition.copy(this.unprojectOnTbSurface(this.object,_center$2.x,_center$2.y,this.domElement,this._tbRadius));const nr=this._startCursorPosition.distanceTo(this._currentCursorPosition),sr=this._startCursorPosition.angleTo(this._currentCursorPosition),ar=Math.max(nr/this._tbRadius,sr)*this.rotateSpeed;this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),ar)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=ar,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case STATE$1.SCALE:if(this.enableZoom)if(ir)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*8):sr>0&&(ar=Math.pow(this.scaleFactor,sr*8)),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this.applyTransformMatrix(this.scale(ar,this._v3_1))}break;case STATE$1.FOV:if(this.enableZoom&&this.object.isPerspectiveCamera)if(ir)this.dispatchEvent(_endEvent$2),this.dispatchEvent(_startEvent$2),this.updateTbState(tr,!0),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*8):sr>0&&(ar=Math.pow(this.scaleFactor,sr*8)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const or=this._v3_1.distanceTo(this._gizmos.position);let lr=or/ar;lr=MathUtils.clamp(lr,this.minDistance,this.maxDistance);const cr=or*Math.tan(MathUtils.DEG2RAD*this._fovState*.5);let ur=MathUtils.RAD2DEG*(Math.atan(cr/lr)*2);ur=MathUtils.clamp(ur,this.minFov,this.maxFov);const dr=cr/Math.tan(MathUtils.DEG2RAD*(ur/2));ar=or/dr,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(ur),this.applyTransformMatrix(this.scale(ar,this._v3_2,!1)),_offset$1.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(dr/or),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z)}break}this.dispatchEvent(_changeEvent$5)}}onSinglePanEnd(){if(this._state==STATE$1.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){const tr=Math.abs((this._wPrev+this._wCurr)/2),ir=this;this._animationId=window.requestAnimationFrame(function(nr){ir.updateTbState(STATE$1.ANIMATION_ROTATE,!0);const sr=ir.calculateRotationAxis(ir._cursorPosPrev,ir._cursorPosCurr);ir.onRotationAnim(nr,sr,Math.min(tr,ir.wMax))})}else this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5);else this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)}else(this._state==STATE$1.PAN||this._state==STATE$1.IDLE)&&(this.updateTbState(STATE$1.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5));this.dispatchEvent(_endEvent$2)}onDoubleTap(er){if(this.enabled&&this.enablePan&&this.scene!=null){this.dispatchEvent(_startEvent$2),this.setCenter(er.clientX,er.clientY);const tr=this.unprojectOnObj(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement),this.object);if(tr!=null&&this.enableAnimations){const ir=this;this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(nr){ir.updateTbState(STATE$1.ANIMATION_FOCUS,!0),ir.onFocusAnim(nr,tr,ir._cameraMatrixState,ir._gizmoMatrixState)})}else tr!=null&&!this.enableAnimations&&(this.updateTbState(STATE$1.FOCUS,!0),this.focus(tr,this.scaleFactor),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5))}this.dispatchEvent(_endEvent$2)}onDoublePanStart(){this.enabled&&this.enablePan&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._startCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement,!0)),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1))}onDoublePanMove(){this.enabled&&this.enablePan&&(this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=STATE$1.PAN&&(this.updateTbState(STATE$1.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition)),this._currentCursorPosition.copy(this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement,!0)),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(_changeEvent$5))}onDoublePanEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}onRotateStart(){this.enabled&&this.enableRotate&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,this.object.getWorldDirection(this._rotationAxis),!this.enablePan&&!this.enableZoom&&this.activateGizmos(!0))}onRotateMove(){if(this.enabled&&this.enableRotate){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let er;this._state!=STATE$1.ZROTATE&&(this.updateTbState(STATE$1.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),er=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._v3_2)):er=new Vector3$1().setFromMatrixPosition(this._gizmoMatrixState);const tr=MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);this.applyTransformMatrix(this.zRotate(er,tr)),this.dispatchEvent(_changeEvent$5)}}onRotateEnd(){this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_endEvent$2)}onPinchStart(){this.enabled&&this.enableZoom&&(this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}onPinchMove(){if(this.enabled&&this.enableZoom){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);const er=12;this._state!=STATE$1.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(STATE$1.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),er*this._devPxRatio);const tr=this._currentFingerDistance/this._startFingerDistance;let ir;this.enablePan?this.object.isOrthographicCamera?ir=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(ir=this.unprojectOnTbPlane(this.object,_center$2.x,_center$2.y,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)):ir=this._gizmos.position,this.applyTransformMatrix(this.scale(tr,ir)),this.dispatchEvent(_changeEvent$5)}}onPinchEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}onTriplePanStart(){if(this.enabled&&this.enableZoom){this.dispatchEvent(_startEvent$2),this.updateTbState(STATE$1.SCALE,!0);let er=0,tr=0;const ir=this._touchCurrent.length;for(let nr=0;nr<ir;nr++)er+=this._touchCurrent[nr].clientX,tr+=this._touchCurrent[nr].clientY;this.setCenter(er/ir,tr/ir),this._startCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5),this._currentCursorPosition.copy(this._startCursorPosition)}}onTriplePanMove(){if(this.enabled&&this.enableZoom){let er=0,tr=0;const ir=this._touchCurrent.length;for(let hr=0;hr<ir;hr++)er+=this._touchCurrent[hr].clientX,tr+=this._touchCurrent[hr].clientY;this.setCenter(er/ir,tr/ir);const nr=8;this._currentCursorPosition.setY(this.getCursorNDC(_center$2.x,_center$2.y,this.domElement).y*.5);const sr=this._currentCursorPosition.y-this._startCursorPosition.y;let ar=1;sr<0?ar=1/Math.pow(this.scaleFactor,-sr*nr):sr>0&&(ar=Math.pow(this.scaleFactor,sr*nr)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const or=this._v3_1.distanceTo(this._gizmos.position);let lr=or/ar;lr=MathUtils.clamp(lr,this.minDistance,this.maxDistance);const cr=or*Math.tan(MathUtils.DEG2RAD*this._fovState*.5);let ur=MathUtils.RAD2DEG*(Math.atan(cr/lr)*2);ur=MathUtils.clamp(ur,this.minFov,this.maxFov);const dr=cr/Math.tan(MathUtils.DEG2RAD*(ur/2));ar=or/dr,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(ur),this.applyTransformMatrix(this.scale(ar,this._v3_2,!1)),_offset$1.copy(this._gizmos.position).sub(this.object.position).normalize().multiplyScalar(dr/or),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),this.dispatchEvent(_changeEvent$5)}}onTriplePanEnd(){this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_endEvent$2)}setCenter(er,tr){_center$2.x=er,_center$2.y=tr}initializeMouseActions(){this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}compareMouseAction(er,tr){return er.operation==tr.operation?er.mouse==tr.mouse&&er.key==tr.key:!1}setMouseAction(er,tr,ir=null){const nr=["PAN","ROTATE","ZOOM","FOV"],sr=[0,1,2,"WHEEL"],ar=["CTRL","SHIFT",null];let or;if(!nr.includes(er)||!sr.includes(tr)||!ar.includes(ir)||tr=="WHEEL"&&er!="ZOOM"&&er!="FOV")return!1;switch(er){case"PAN":or=STATE$1.PAN;break;case"ROTATE":or=STATE$1.ROTATE;break;case"ZOOM":or=STATE$1.SCALE;break;case"FOV":or=STATE$1.FOV;break}const lr={operation:er,mouse:tr,key:ir,state:or};for(let cr=0;cr<this.mouseActions.length;cr++)if(this.mouseActions[cr].mouse==lr.mouse&&this.mouseActions[cr].key==lr.key)return this.mouseActions.splice(cr,1,lr),!0;return this.mouseActions.push(lr),!0}unsetMouseAction(er,tr=null){for(let ir=0;ir<this.mouseActions.length;ir++)if(this.mouseActions[ir].mouse==er&&this.mouseActions[ir].key==tr)return this.mouseActions.splice(ir,1),!0;return!1}getOpFromAction(er,tr){let ir;for(let nr=0;nr<this.mouseActions.length;nr++)if(ir=this.mouseActions[nr],ir.mouse==er&&ir.key==tr)return ir.operation;if(tr!=null){for(let nr=0;nr<this.mouseActions.length;nr++)if(ir=this.mouseActions[nr],ir.mouse==er&&ir.key==null)return ir.operation}return null}getOpStateFromAction(er,tr){let ir;for(let nr=0;nr<this.mouseActions.length;nr++)if(ir=this.mouseActions[nr],ir.mouse==er&&ir.key==tr)return ir.state;if(tr!=null){for(let nr=0;nr<this.mouseActions.length;nr++)if(ir=this.mouseActions[nr],ir.mouse==er&&ir.key==null)return ir.state}return null}getAngle(er,tr){return Math.atan2(tr.clientY-er.clientY,tr.clientX-er.clientX)*180/Math.PI}updateTouchEvent(er){for(let tr=0;tr<this._touchCurrent.length;tr++)if(this._touchCurrent[tr].pointerId==er.pointerId){this._touchCurrent.splice(tr,1,er);break}}applyTransformMatrix(er){if(er.camera!=null&&(this._m4_1.copy(this._cameraMatrixState).premultiply(er.camera),this._m4_1.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.updateMatrix(),(this._state==STATE$1.ROTATE||this._state==STATE$1.ZROTATE||this._state==STATE$1.ANIMATION_ROTATE)&&this.object.up.copy(this._upState).applyQuaternion(this.object.quaternion)),er.gizmos!=null&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(er.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),this._state==STATE$1.SCALE||this._state==STATE$1.FOCUS||this._state==STATE$1.ANIMATION_FOCUS)if(this._tbRadius=this.calculateTbRadius(this.object),this.adjustNearFar){const tr=this.object.position.distanceTo(this._gizmos.position),ir=new Box3;ir.setFromObject(this._gizmos);const nr=new Sphere;ir.getBoundingSphere(nr);const sr=Math.max(this._nearPos0,nr.radius+nr.center.length()),ar=tr-this._initialNear,or=Math.min(sr,ar);this.object.near=tr-or;const lr=Math.min(this._farPos0,-nr.radius+nr.center.length()),cr=tr-this._initialFar,ur=Math.min(lr,cr);this.object.far=tr-ur,this.object.updateProjectionMatrix()}else{let tr=!1;this.object.near!=this._initialNear&&(this.object.near=this._initialNear,tr=!0),this.object.far!=this._initialFar&&(this.object.far=this._initialFar,tr=!0),tr&&this.object.updateProjectionMatrix()}}calculateAngularSpeed(er,tr,ir,nr){const sr=tr-er,ar=(nr-ir)/1e3;return ar==0?0:sr/ar}calculatePointersDistance(er,tr){return Math.sqrt(Math.pow(tr.clientX-er.clientX,2)+Math.pow(tr.clientY-er.clientY,2))}calculateRotationAxis(er,tr){return this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(er,tr).applyQuaternion(this._quat),this._rotationAxis.normalize().clone()}calculateTbRadius(er){const tr=er.position.distanceTo(this._gizmos.position);if(er.type=="PerspectiveCamera"){const ir=MathUtils.DEG2RAD*er.fov*.5,nr=Math.atan(er.aspect*Math.tan(ir));return Math.tan(Math.min(ir,nr))*tr*this.radiusFactor}else if(er.type=="OrthographicCamera")return Math.min(er.top,er.right)*this.radiusFactor}focus(er,tr,ir=1){_offset$1.copy(er).sub(this._gizmos.position).multiplyScalar(ir),this._translationMatrix.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),_gizmoMatrixStateTemp.copy(this._gizmoMatrixState),this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),_cameraMatrixStateTemp.copy(this._cameraMatrixState),this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.enableZoom&&this.applyTransformMatrix(this.scale(tr,this._gizmos.position)),this._gizmoMatrixState.copy(_gizmoMatrixStateTemp),this._cameraMatrixState.copy(_cameraMatrixStateTemp)}drawGrid(){if(this.scene!=null){let ir,nr,sr,ar;if(this.object.isOrthographicCamera){const or=this.object.right-this.object.left,lr=this.object.bottom-this.object.top;sr=Math.max(or,lr),ar=sr/20,ir=sr/this.object.zoom*3,nr=ir/ar*this.object.zoom}else if(this.object.isPerspectiveCamera){const or=this.object.position.distanceTo(this._gizmos.position),lr=MathUtils.DEG2RAD*this.object.fov*.5,cr=Math.atan(this.object.aspect*Math.tan(lr));sr=Math.tan(Math.max(lr,cr))*or*2,ar=sr/20,ir=sr*3,nr=ir/ar}this._grid==null&&(this._grid=new GridHelper(ir,nr,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.object.quaternion),this._grid.rotateX(Math.PI*.5),this.scene.add(this._grid))}}dispose(){this._animationId!=-1&&window.cancelAnimationFrame(this._animationId),this.disconnect(),this.scene!==null&&this.scene.remove(this._gizmos),this.disposeGrid()}disposeGrid(){this._grid!=null&&this.scene!=null&&(this.scene.remove(this._grid),this._grid=null)}easeOutCubic(er){return 1-Math.pow(1-er,3)}activateGizmos(er){const tr=this._gizmos.children[0],ir=this._gizmos.children[1],nr=this._gizmos.children[2];er?(tr.material.setValues({opacity:1}),ir.material.setValues({opacity:1}),nr.material.setValues({opacity:1})):(tr.material.setValues({opacity:.6}),ir.material.setValues({opacity:.6}),nr.material.setValues({opacity:.6}))}getCursorNDC(er,tr,ir){const nr=ir.getBoundingClientRect();return this._v2_1.setX((er-nr.left)/nr.width*2-1),this._v2_1.setY((nr.bottom-tr)/nr.height*2-1),this._v2_1.clone()}getCursorPosition(er,tr,ir){return this._v2_1.copy(this.getCursorNDC(er,tr,ir)),this._v2_1.x*=(this.object.right-this.object.left)*.5,this._v2_1.y*=(this.object.top-this.object.bottom)*.5,this._v2_1.clone()}setCamera(er){er.lookAt(this.target),er.updateMatrix(),er.type=="PerspectiveCamera"&&(this._fov0=er.fov,this._fovState=er.fov),this._cameraMatrixState0.copy(er.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(er.projectionMatrix),this._zoom0=er.zoom,this._zoomState=this._zoom0,this._initialNear=er.near,this._nearPos0=er.position.distanceTo(this.target)-er.near,this._nearPos=this._initialNear,this._initialFar=er.far,this._farPos0=er.position.distanceTo(this.target)-er.far,this._farPos=this._initialFar,this._up0.copy(er.up),this._upState.copy(er.up),this.object=er,this.object.updateProjectionMatrix(),this._tbRadius=this.calculateTbRadius(er),this.makeGizmos(this.target,this._tbRadius)}setGizmosVisible(er){this._gizmos.visible=er,this.dispatchEvent(_changeEvent$5)}setTbRadius(er){this.radiusFactor=er,this._tbRadius=this.calculateTbRadius(this.object);const ir=new EllipseCurve(0,0,this._tbRadius,this._tbRadius).getPoints(this._curvePts),nr=new BufferGeometry().setFromPoints(ir);for(const sr in this._gizmos.children)this._gizmos.children[sr].geometry=nr;this.dispatchEvent(_changeEvent$5)}makeGizmos(er,tr){const nr=new EllipseCurve(0,0,tr,tr).getPoints(this._curvePts),sr=new BufferGeometry().setFromPoints(nr),ar=new LineBasicMaterial({color:16744576,fog:!1,transparent:!0,opacity:.6}),or=new LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),lr=new LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),cr=new Line(sr,ar),ur=new Line(sr,or),dr=new Line(sr,lr),hr=Math.PI*.5;if(cr.rotation.x=hr,ur.rotation.y=hr,this._gizmoMatrixState0.identity().setPosition(er),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.object.zoom!==1){const pr=1/this.object.zoom;this._scaleMatrix.makeScale(pr,pr,pr),this._translationMatrix.makeTranslation(-er.x,-er.y,-er.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(er.x,er.y,er.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.traverse(function(pr){pr.isLine&&(pr.geometry.dispose(),pr.material.dispose())}),this._gizmos.clear(),this._gizmos.add(cr),this._gizmos.add(ur),this._gizmos.add(dr)}onFocusAnim(er,tr,ir,nr){if(this._timeStart==-1&&(this._timeStart=er),this._state==STATE$1.ANIMATION_FOCUS){const ar=(er-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(nr),ar>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(tr,this.scaleFactor),this._timeStart=-1,this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5);else{const or=this.easeOutCubic(ar),lr=1-or+this.scaleFactor*or;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(tr,lr,or),this.dispatchEvent(_changeEvent$5);const cr=this;this._animationId=window.requestAnimationFrame(function(ur){cr.onFocusAnim(ur,tr,ir,nr.clone())})}}else this._animationId=-1,this._timeStart=-1}onRotationAnim(er,tr,ir){if(this._timeStart==-1&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=er),this._state==STATE$1.ANIMATION_ROTATE){const nr=(er-this._timeStart)/1e3;if(ir+-this.dampingFactor*nr>0){this._angleCurrent=.5*-this.dampingFactor*Math.pow(nr,2)+ir*nr+0,this.applyTransformMatrix(this.rotate(tr,this._angleCurrent)),this.dispatchEvent(_changeEvent$5);const ar=this;this._animationId=window.requestAnimationFrame(function(or){ar.onRotationAnim(or,tr,ir)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(STATE$1.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5)}else this._animationId=-1,this._timeStart=-1,this._state!=STATE$1.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(_changeEvent$5))}pan(er,tr,ir=!1){const nr=er.clone().sub(tr);if(this.object.isOrthographicCamera)nr.multiplyScalar(1/this.object.zoom);else if(this.object.isPerspectiveCamera&&ir){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);const sr=this._v3_1.distanceTo(this._v3_2)/this.object.position.distanceTo(this._gizmos.position);nr.multiplyScalar(1/sr)}return this._v3_1.set(nr.x,nr.y,0).applyQuaternion(this.object.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1),_transformation}reset(){this.object.zoom=this._zoom0,this.object.isPerspectiveCamera&&(this.object.fov=this._fov0),this.object.near=this._nearPos,this.object.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(this._up0),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this._gizmos.position,this._tbRadius),this.object.lookAt(this._gizmos.position),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5)}rotate(er,tr){const ir=this._gizmos.position;return this._translationMatrix.makeTranslation(-ir.x,-ir.y,-ir.z),this._rotationMatrix.makeRotationAxis(er,-tr),this._m4_1.makeTranslation(ir.x,ir.y,ir.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),_transformation}copyState(){let er;this.object.isOrthographicCamera?er=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix}}):this.object.isPerspectiveCamera&&(er=JSON.stringify({arcballState:{cameraFar:this.object.far,cameraFov:this.object.fov,cameraMatrix:this.object.matrix,cameraNear:this.object.near,cameraUp:this.object.up,cameraZoom:this.object.zoom,gizmoMatrix:this._gizmos.matrix}})),navigator.clipboard.writeText(er)}pasteState(){const er=this;navigator.clipboard.readText().then(function(ir){er.setStateFromJSON(ir)})}saveState(){this._cameraMatrixState0.copy(this.object.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.object.near,this._farPos=this.object.far,this._zoom0=this.object.zoom,this._up0.copy(this.object.up),this.object.isPerspectiveCamera&&(this._fov0=this.object.fov)}scale(er,tr,ir=!0){_scalePointTemp.copy(tr);let nr=1/er;if(this.object.isOrthographicCamera){this.object.zoom=this._zoomState,this.object.zoom*=er,this.object.zoom>this.maxZoom?(this.object.zoom=this.maxZoom,nr=this._zoomState/this.maxZoom):this.object.zoom<this.minZoom&&(this.object.zoom=this.minZoom,nr=this._zoomState/this.minZoom),this.object.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(nr,nr,nr),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),_scalePointTemp.sub(this._v3_1);const sr=_scalePointTemp.clone().multiplyScalar(nr);return _scalePointTemp.sub(sr),this._m4_1.makeTranslation(_scalePointTemp.x,_scalePointTemp.y,_scalePointTemp.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),_transformation}else if(this.object.isPerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let sr=this._v3_1.distanceTo(_scalePointTemp),ar=sr-sr*nr;const or=sr-ar;if(or<this.minDistance?(nr=this.minDistance/sr,ar=sr-sr*nr):or>this.maxDistance&&(nr=this.maxDistance/sr,ar=sr-sr*nr),_offset$1.copy(_scalePointTemp).sub(this._v3_1).normalize().multiplyScalar(ar),this._m4_1.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z),ir){const lr=this._v3_2;sr=lr.distanceTo(_scalePointTemp),ar=sr-sr*nr,_offset$1.copy(_scalePointTemp).sub(this._v3_2).normalize().multiplyScalar(ar),this._translationMatrix.makeTranslation(lr.x,lr.y,lr.z),this._scaleMatrix.makeScale(nr,nr,nr),this._m4_2.makeTranslation(_offset$1.x,_offset$1.y,_offset$1.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-lr.x,-lr.y,-lr.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return _transformation}}setFov(er){this.object.isPerspectiveCamera&&(this.object.fov=MathUtils.clamp(er,this.minFov,this.maxFov),this.object.updateProjectionMatrix())}setTransformationMatrices(er=null,tr=null){er!=null?_transformation.camera!=null?_transformation.camera.copy(er):_transformation.camera=er.clone():_transformation.camera=null,tr!=null?_transformation.gizmos!=null?_transformation.gizmos.copy(tr):_transformation.gizmos=tr.clone():_transformation.gizmos=null}zRotate(er,tr){return this._rotationMatrix.makeRotationAxis(this._rotationAxis,tr),this._translationMatrix.makeTranslation(-er.x,-er.y,-er.z),this._m4_1.makeTranslation(er.x,er.y,er.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(er),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,tr),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),_transformation}getRaycaster(){return _raycaster$2}unprojectOnObj(er,tr){const ir=this.getRaycaster();ir.near=tr.near,ir.far=tr.far,ir.setFromCamera(er,tr);const nr=ir.intersectObjects(this.scene.children,!0);for(let sr=0;sr<nr.length;sr++)if(nr[sr].object.uuid!=this._gizmos.uuid&&nr[sr].face!=null)return nr[sr].point.clone();return null}unprojectOnTbSurface(er,tr,ir,nr,sr){if(er.type=="OrthographicCamera"){this._v2_1.copy(this.getCursorPosition(tr,ir,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);const ar=Math.pow(this._v2_1.x,2),or=Math.pow(this._v2_1.y,2),lr=Math.pow(this._tbRadius,2);return ar+or<=lr*.5?this._v3_1.setZ(Math.sqrt(lr-(ar+or))):this._v3_1.setZ(lr*.5/Math.sqrt(ar+or)),this._v3_1}else if(er.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(tr,ir,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(er.projectionMatrixInverse);const ar=this._v3_1.clone().normalize(),or=er.position.distanceTo(this._gizmos.position),lr=Math.pow(sr,2),cr=this._v3_1.z,ur=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(ur==0)return ar.set(this._v3_1.x,this._v3_1.y,sr),ar;const dr=cr/ur,hr=or;let pr=Math.pow(dr,2)+1,gr=2*dr*hr,vr=Math.pow(hr,2)-lr,mr=Math.pow(gr,2)-4*pr*vr;if(mr>=0&&(this._v2_1.setX((-gr-Math.sqrt(mr))/(2*pr)),this._v2_1.setY(dr*this._v2_1.x+hr),MathUtils.RAD2DEG*this._v2_1.angle()>=45)){const Ar=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(or-this._v2_1.y,2));return ar.multiplyScalar(Ar),ar.z+=or,ar}pr=dr,gr=hr,vr=-lr*.5,mr=Math.pow(gr,2)-4*pr*vr,this._v2_1.setX((-gr-Math.sqrt(mr))/(2*pr)),this._v2_1.setY(dr*this._v2_1.x+hr);const fr=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(or-this._v2_1.y,2));return ar.multiplyScalar(fr),ar.z+=or,ar}}unprojectOnTbPlane(er,tr,ir,nr,sr=!1){if(er.type=="OrthographicCamera")return this._v2_1.copy(this.getCursorPosition(tr,ir,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(er.type=="PerspectiveCamera"){this._v2_1.copy(this.getCursorNDC(tr,ir,nr)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(er.projectionMatrixInverse);const ar=this._v3_1.clone().normalize(),or=this._v3_1.z,lr=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));let cr;if(sr?cr=this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):cr=er.position.distanceTo(this._gizmos.position),lr==0)return ar.set(0,0,0),ar;const ur=or/lr,dr=cr,hr=-dr/ur,pr=Math.sqrt(Math.pow(dr,2)+Math.pow(hr,2));return ar.multiplyScalar(pr),ar.z=0,ar}}updateMatrixState(){this._cameraMatrixState.copy(this.object.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.object.isOrthographicCamera?(this._cameraProjectionState.copy(this.object.projectionMatrix),this.object.updateProjectionMatrix(),this._zoomState=this.object.zoom):this.object.isPerspectiveCamera&&(this._fovState=this.object.fov)}updateTbState(er,tr){this._state=er,tr&&this.updateMatrixState()}update(){if(this.target.equals(this._currentTarget)===!1&&(this._gizmos.position.copy(this.target),this._tbRadius=this.calculateTbRadius(this.object),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)),this.object.isOrthographicCamera){if(this.object.zoom>this.maxZoom||this.object.zoom<this.minZoom){const tr=MathUtils.clamp(this.object.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.scale(tr/this.object.zoom,this._gizmos.position,!0))}}else if(this.object.isPerspectiveCamera){const tr=this.object.position.distanceTo(this._gizmos.position);if(tr>this.maxDistance+1e-6||tr<this.minDistance-1e-6){const nr=MathUtils.clamp(tr,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.scale(nr/tr,this._gizmos.position)),this.updateMatrixState()}(this.object.fov<this.minFov||this.object.fov>this.maxFov)&&(this.object.fov=MathUtils.clamp(this.object.fov,this.minFov,this.maxFov),this.object.updateProjectionMatrix());const ir=this._tbRadius;if(this._tbRadius=this.calculateTbRadius(this.object),ir<this._tbRadius-1e-6||ir>this._tbRadius+1e-6){const nr=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,sr=this._tbRadius/nr,or=new EllipseCurve(0,0,sr,sr).getPoints(this._curvePts),lr=new BufferGeometry().setFromPoints(or);for(const cr in this._gizmos.children)this._gizmos.children[cr].geometry=lr}}this.object.lookAt(this._gizmos.position)}setStateFromJSON(er){const tr=JSON.parse(er);if(tr.arcballState!=null){this._cameraMatrixState.fromArray(tr.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.object.position,this.object.quaternion,this.object.scale),this.object.up.copy(tr.arcballState.cameraUp),this.object.near=tr.arcballState.cameraNear,this.object.far=tr.arcballState.cameraFar,this.object.zoom=tr.arcballState.cameraZoom,this.object.isPerspectiveCamera&&(this.object.fov=tr.arcballState.cameraFov),this._gizmoMatrixState.fromArray(tr.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.object.updateMatrix(),this.object.updateProjectionMatrix(),this._gizmos.updateMatrix(),this._tbRadius=this.calculateTbRadius(this.object);const ir=new Matrix4().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(ir),this.object.lookAt(this._gizmos.position),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5)}}}function onWindowResize(){const rr=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;this._tbRadius=this.calculateTbRadius(this.object);const er=this._tbRadius/rr,ir=new EllipseCurve(0,0,er,er).getPoints(this._curvePts),nr=new BufferGeometry().setFromPoints(ir);for(const sr in this._gizmos.children)this._gizmos.children[sr].geometry=nr;this.dispatchEvent(_changeEvent$5)}function onContextMenu$5(rr){if(this.enabled){for(let er=0;er<this.mouseActions.length;er++)if(this.mouseActions[er].mouse==2){rr.preventDefault();break}}}function onPointerCancel$3(){this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=INPUT.NONE}function onPointerDown$6(rr){if(rr.button==0&&rr.isPrimary?(this._downValid=!0,this._downEvents.push(rr),this._downStart=performance.now()):this._downValid=!1,rr.pointerType=="touch"&&this._input!=INPUT.CURSOR)switch(this._touchStart.push(rr),this._touchCurrent.push(rr),this._input){case INPUT.NONE:this._input=INPUT.ONE_FINGER,this.onSinglePanStart(rr,"ROTATE"),window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp);break;case INPUT.ONE_FINGER:case INPUT.ONE_FINGER_SWITCHED:this._input=INPUT.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case INPUT.TWO_FINGER:this._input=INPUT.MULT_FINGER,this.onTriplePanStart(rr);break}else if(rr.pointerType!="touch"&&this._input==INPUT.NONE){let er=null;rr.ctrlKey||rr.metaKey?er="CTRL":rr.shiftKey&&(er="SHIFT"),this._mouseOp=this.getOpFromAction(rr.button,er),this._mouseOp!=null&&(window.addEventListener("pointermove",this._onPointerMove),window.addEventListener("pointerup",this._onPointerUp),this._input=INPUT.CURSOR,this._button=rr.button,this.onSinglePanStart(rr,this._mouseOp))}}function onPointerMove$6(rr){if(rr.pointerType=="touch"&&this._input!=INPUT.CURSOR)switch(this._input){case INPUT.ONE_FINGER:this.updateTouchEvent(rr),this.onSinglePanMove(rr,STATE$1.ROTATE);break;case INPUT.ONE_FINGER_SWITCHED:if(this.calculatePointersDistance(this._touchCurrent[0],rr)*this._devPxRatio>=this._switchSensibility){this._input=INPUT.ONE_FINGER,this.updateTouchEvent(rr),this.onSinglePanStart(rr,"ROTATE");break}break;case INPUT.TWO_FINGER:this.updateTouchEvent(rr),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case INPUT.MULT_FINGER:this.updateTouchEvent(rr),this.onTriplePanMove(rr);break}else if(rr.pointerType!="touch"&&this._input==INPUT.CURSOR){let er=null;rr.ctrlKey||rr.metaKey?er="CTRL":rr.shiftKey&&(er="SHIFT");const tr=this.getOpStateFromAction(this._button,er);tr!=null&&this.onSinglePanMove(rr,tr)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],rr)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}function onPointerUp$5(rr){if(rr.pointerType=="touch"&&this._input!=INPUT.CURSOR){const er=this._touchCurrent.length;for(let tr=0;tr<er;tr++)if(this._touchCurrent[tr].pointerId==rr.pointerId){this._touchCurrent.splice(tr,1),this._touchStart.splice(tr,1);break}switch(this._input){case INPUT.ONE_FINGER:case INPUT.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onSinglePanEnd();break;case INPUT.TWO_FINGER:this.onDoublePanEnd(rr),this.onPinchEnd(rr),this.onRotateEnd(rr),this._input=INPUT.ONE_FINGER_SWITCHED;break;case INPUT.MULT_FINGER:this._touchCurrent.length==0&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onTriplePanEnd());break}}else rr.pointerType!="touch"&&this._input==INPUT.CURSOR&&(window.removeEventListener("pointermove",this._onPointerMove),window.removeEventListener("pointerup",this._onPointerUp),this._input=INPUT.NONE,this.onSinglePanEnd(),this._button=-1);if(rr.isPrimary)if(this._downValid)if(rr.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(this._nclicks==0)this._nclicks=1,this._clickStart=performance.now();else{const tr=rr.timeStamp-this._clickStart,ir=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;tr<=this._maxInterval&&ir<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(rr)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}function onWheel(rr){if(this.enabled&&this.enableZoom){let er=null;rr.ctrlKey||rr.metaKey?er="CTRL":rr.shiftKey&&(er="SHIFT");const tr=this.getOpFromAction("WHEEL",er);if(tr!=null){rr.preventDefault(),this.dispatchEvent(_startEvent$2);const ir=125;let nr=rr.deltaY/ir,sr=1;switch(nr>0?sr=1/this.scaleFactor:nr<0&&(sr=this.scaleFactor),tr){case"ZOOM":if(this.updateTbState(STATE$1.SCALE,!0),nr>0?sr=1/Math.pow(this.scaleFactor,nr):nr<0&&(sr=Math.pow(this.scaleFactor,-nr)),this.cursorZoom&&this.enablePan){let ar;this.object.isOrthographicCamera?ar=this.unprojectOnTbPlane(this.object,rr.clientX,rr.clientY,this.domElement).applyQuaternion(this.object.quaternion).multiplyScalar(1/this.object.zoom).add(this._gizmos.position):this.object.isPerspectiveCamera&&(ar=this.unprojectOnTbPlane(this.object,rr.clientX,rr.clientY,this.domElement).applyQuaternion(this.object.quaternion).add(this._gizmos.position)),this.applyTransformMatrix(this.scale(sr,ar))}else this.applyTransformMatrix(this.scale(sr,this._gizmos.position));this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5),this.dispatchEvent(_endEvent$2);break;case"FOV":if(this.object.isPerspectiveCamera){this.updateTbState(STATE$1.FOV,!0),rr.deltaX!=0&&(nr=rr.deltaX/ir,sr=1,nr>0?sr=1/Math.pow(this.scaleFactor,nr):nr<0&&(sr=Math.pow(this.scaleFactor,-nr))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);const ar=this._v3_1.distanceTo(this._gizmos.position);let or=ar/sr;or=MathUtils.clamp(or,this.minDistance,this.maxDistance);const lr=ar*Math.tan(MathUtils.DEG2RAD*this.object.fov*.5);let cr=MathUtils.RAD2DEG*(Math.atan(lr/or)*2);cr>this.maxFov?cr=this.maxFov:cr<this.minFov&&(cr=this.minFov);const ur=lr/Math.tan(MathUtils.DEG2RAD*(cr/2));sr=ar/ur,this.setFov(cr),this.applyTransformMatrix(this.scale(sr,this._gizmos.position,!1))}this._grid!=null&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(STATE$1.IDLE,!1),this.dispatchEvent(_changeEvent$5),this.dispatchEvent(_endEvent$2);break}}}}const _plane$3=new Plane,_pointer$1=new Vector2,_offset=new Vector3$1,_diff=new Vector2,_previousPointer=new Vector2,_intersection=new Vector3$1,_worldPosition=new Vector3$1,_inverseMatrix=new Matrix4,_up$1=new Vector3$1,_right=new Vector3$1;let _selected=null,_hovered=null;const _intersections=[],STATE={NONE:-1,PAN:0,ROTATE:1};class DragControls extends Controls{constructor(er,tr,ir=null){super(tr,ir),this.objects=er,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Raycaster,this.mouseButtons={LEFT:MOUSE.PAN,MIDDLE:MOUSE.PAN,RIGHT:MOUSE.ROTATE},this.touches={ONE:TOUCH.PAN},this._onPointerMove=onPointerMove$5.bind(this),this._onPointerDown=onPointerDown$5.bind(this),this._onPointerCancel=onPointerCancel$2.bind(this),this._onContextMenu=onContextMenu$4.bind(this),ir!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(er){const tr=this.domElement.getBoundingClientRect();_pointer$1.x=(er.clientX-tr.left)/tr.width*2-1,_pointer$1.y=-(er.clientY-tr.top)/tr.height*2+1}_updateState(er){let tr;if(er.pointerType==="touch")tr=this.touches.ONE;else switch(er.button){case 0:tr=this.mouseButtons.LEFT;break;case 1:tr=this.mouseButtons.MIDDLE;break;case 2:tr=this.mouseButtons.RIGHT;break;default:tr=null}switch(tr){case MOUSE.PAN:case TOUCH.PAN:this.state=STATE.PAN;break;case MOUSE.ROTATE:case TOUCH.ROTATE:this.state=STATE.ROTATE;break;default:this.state=STATE.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(er){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=er}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(er){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function onPointerMove$5(rr){const er=this.object,tr=this.domElement,ir=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(rr),ir.setFromCamera(_pointer$1,er),_selected)this.state===STATE.PAN?ir.ray.intersectPlane(_plane$3,_intersection)&&_selected.position.copy(_intersection.sub(_offset).applyMatrix4(_inverseMatrix)):this.state===STATE.ROTATE&&(_diff.subVectors(_pointer$1,_previousPointer).multiplyScalar(this.rotateSpeed),_selected.rotateOnWorldAxis(_up$1,_diff.x),_selected.rotateOnWorldAxis(_right.normalize(),-_diff.y)),this.dispatchEvent({type:"drag",object:_selected}),_previousPointer.copy(_pointer$1);else if(rr.pointerType==="mouse"||rr.pointerType==="pen")if(_intersections.length=0,ir.setFromCamera(_pointer$1,er),ir.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0){const nr=_intersections[0].object;_plane$3.setFromNormalAndCoplanarPoint(er.getWorldDirection(_plane$3.normal),_worldPosition.setFromMatrixPosition(nr.matrixWorld)),_hovered!==nr&&_hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),tr.style.cursor="auto",_hovered=null),_hovered!==nr&&(this.dispatchEvent({type:"hoveron",object:nr}),tr.style.cursor="pointer",_hovered=nr)}else _hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),tr.style.cursor="auto",_hovered=null);_previousPointer.copy(_pointer$1)}}function onPointerDown$5(rr){const er=this.object,tr=this.domElement,ir=this.raycaster;this.enabled!==!1&&(this._updatePointer(rr),this._updateState(rr),_intersections.length=0,ir.setFromCamera(_pointer$1,er),ir.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0&&(this.transformGroup===!0?_selected=findGroup(_intersections[0].object):_selected=_intersections[0].object,_plane$3.setFromNormalAndCoplanarPoint(er.getWorldDirection(_plane$3.normal),_worldPosition.setFromMatrixPosition(_selected.matrixWorld)),ir.ray.intersectPlane(_plane$3,_intersection)&&(this.state===STATE.PAN?(_inverseMatrix.copy(_selected.parent.matrixWorld).invert(),_offset.copy(_intersection).sub(_worldPosition.setFromMatrixPosition(_selected.matrixWorld))):this.state===STATE.ROTATE&&(_up$1.set(0,1,0).applyQuaternion(er.quaternion).normalize(),_right.set(1,0,0).applyQuaternion(er.quaternion).normalize())),tr.style.cursor="move",this.dispatchEvent({type:"dragstart",object:_selected})),_previousPointer.copy(_pointer$1))}function onPointerCancel$2(){this.enabled!==!1&&(_selected&&(this.dispatchEvent({type:"dragend",object:_selected}),_selected=null),this.domElement.style.cursor=_hovered?"pointer":"auto",this.state=STATE.NONE)}function onContextMenu$4(rr){this.enabled!==!1&&rr.preventDefault()}function findGroup(rr,er=null){return rr.isGroup&&(er=rr),rr.parent===null?er:findGroup(rr.parent,er)}const _lookDirection=new Vector3$1,_spherical=new Spherical,_target=new Vector3$1,_targetPosition=new Vector3$1;class FirstPersonControls extends Controls{constructor(er,tr=null){super(er,tr),this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this._autoSpeedFactor=0,this._pointerX=0,this._pointerY=0,this._moveForward=!1,this._moveBackward=!1,this._moveLeft=!1,this._moveRight=!1,this._viewHalfX=0,this._viewHalfY=0,this._lat=0,this._lon=0,this._onPointerMove=onPointerMove$4.bind(this),this._onPointerDown=onPointerDown$4.bind(this),this._onPointerUp=onPointerUp$4.bind(this),this._onContextMenu=onContextMenu$3.bind(this),this._onKeyDown=onKeyDown$3.bind(this),this._onKeyUp=onKeyUp$2.bind(this),tr!==null&&(this.connect(),this.handleResize()),this._setOrientation()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerMove),this.domElement.removeEventListener("pointermove",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}handleResize(){this.domElement===document?(this._viewHalfX=window.innerWidth/2,this._viewHalfY=window.innerHeight/2):(this._viewHalfX=this.domElement.offsetWidth/2,this._viewHalfY=this.domElement.offsetHeight/2)}lookAt(er,tr,ir){return er.isVector3?_target.copy(er):_target.set(er,tr,ir),this.object.lookAt(_target),this._setOrientation(),this}update(er){if(this.enabled===!1)return;if(this.heightSpeed){const cr=MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this._autoSpeedFactor=er*(cr*this.heightCoef)}else this._autoSpeedFactor=0;const tr=er*this.movementSpeed;(this._moveForward||this.autoForward&&!this._moveBackward)&&this.object.translateZ(-(tr+this._autoSpeedFactor)),this._moveBackward&&this.object.translateZ(tr),this._moveLeft&&this.object.translateX(-tr),this._moveRight&&this.object.translateX(tr),this._moveUp&&this.object.translateY(tr),this._moveDown&&this.object.translateY(-tr);let ir=er*this.lookSpeed;this.activeLook||(ir=0);let nr=1;this.constrainVertical&&(nr=Math.PI/(this.verticalMax-this.verticalMin)),this._lon-=this._pointerX*ir,this.lookVertical&&(this._lat-=this._pointerY*ir*nr),this._lat=Math.max(-85,Math.min(85,this._lat));let sr=MathUtils.degToRad(90-this._lat);const ar=MathUtils.degToRad(this._lon);this.constrainVertical&&(sr=MathUtils.mapLinear(sr,0,Math.PI,this.verticalMin,this.verticalMax));const or=this.object.position;_targetPosition.setFromSphericalCoords(1,sr,ar).add(or),this.object.lookAt(_targetPosition)}_setOrientation(){const er=this.object.quaternion;_lookDirection.set(0,0,-1).applyQuaternion(er),_spherical.setFromVector3(_lookDirection),this._lat=90-MathUtils.radToDeg(_spherical.phi),this._lon=MathUtils.radToDeg(_spherical.theta)}}function onPointerDown$4(rr){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(rr.button){case 0:this._moveForward=!0;break;case 2:this._moveBackward=!0;break}this.mouseDragOn=!0}function onPointerUp$4(rr){if(this.activeLook)switch(rr.button){case 0:this._moveForward=!1;break;case 2:this._moveBackward=!1;break}this.mouseDragOn=!1}function onPointerMove$4(rr){this.domElement===document?(this._pointerX=rr.pageX-this._viewHalfX,this._pointerY=rr.pageY-this._viewHalfY):(this._pointerX=rr.pageX-this.domElement.offsetLeft-this._viewHalfX,this._pointerY=rr.pageY-this.domElement.offsetTop-this._viewHalfY)}function onKeyDown$3(rr){switch(rr.code){case"ArrowUp":case"KeyW":this._moveForward=!0;break;case"ArrowLeft":case"KeyA":this._moveLeft=!0;break;case"ArrowDown":case"KeyS":this._moveBackward=!0;break;case"ArrowRight":case"KeyD":this._moveRight=!0;break;case"KeyR":this._moveUp=!0;break;case"KeyF":this._moveDown=!0;break}}function onKeyUp$2(rr){switch(rr.code){case"ArrowUp":case"KeyW":this._moveForward=!1;break;case"ArrowLeft":case"KeyA":this._moveLeft=!1;break;case"ArrowDown":case"KeyS":this._moveBackward=!1;break;case"ArrowRight":case"KeyD":this._moveRight=!1;break;case"KeyR":this._moveUp=!1;break;case"KeyF":this._moveDown=!1;break}}function onContextMenu$3(rr){this.enabled!==!1&&rr.preventDefault()}const _changeEvent$4={type:"change"},_EPS$2=1e-6,_tmpQuaternion=new Quaternion$1;class FlyControls extends Controls{constructor(er,tr=null){super(er,tr),this.movementSpeed=1,this.rollSpeed=.005,this.dragToLook=!1,this.autoForward=!1,this._moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0},this._moveVector=new Vector3$1(0,0,0),this._rotationVector=new Vector3$1(0,0,0),this._lastQuaternion=new Quaternion$1,this._lastPosition=new Vector3$1,this._status=0,this._onKeyDown=onKeyDown$2.bind(this),this._onKeyUp=onKeyUp$1.bind(this),this._onPointerMove=onPointerMove$3.bind(this),this._onPointerDown=onPointerDown$3.bind(this),this._onPointerUp=onPointerUp$3.bind(this),this._onPointerCancel=onPointerCancel$1.bind(this),this._onContextMenu=onContextMenu$2.bind(this),tr!==null&&this.connect()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu)}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu)}dispose(){this.disconnect()}update(er){if(this.enabled===!1)return;const tr=this.object,ir=er*this.movementSpeed,nr=er*this.rollSpeed;tr.translateX(this._moveVector.x*ir),tr.translateY(this._moveVector.y*ir),tr.translateZ(this._moveVector.z*ir),_tmpQuaternion.set(this._rotationVector.x*nr,this._rotationVector.y*nr,this._rotationVector.z*nr,1).normalize(),tr.quaternion.multiply(_tmpQuaternion),(this._lastPosition.distanceToSquared(tr.position)>_EPS$2||8*(1-this._lastQuaternion.dot(tr.quaternion))>_EPS$2)&&(this.dispatchEvent(_changeEvent$4),this._lastQuaternion.copy(tr.quaternion),this._lastPosition.copy(tr.position))}_updateMovementVector(){const er=this._moveState.forward||this.autoForward&&!this._moveState.back?1:0;this._moveVector.x=-this._moveState.left+this._moveState.right,this._moveVector.y=-this._moveState.down+this._moveState.up,this._moveVector.z=-er+this._moveState.back}_updateRotationVector(){this._rotationVector.x=-this._moveState.pitchDown+this._moveState.pitchUp,this._rotationVector.y=-this._moveState.yawRight+this._moveState.yawLeft,this._rotationVector.z=-this._moveState.rollRight+this._moveState.rollLeft}_getContainerDimensions(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}}}function onKeyDown$2(rr){if(!(rr.altKey||this.enabled===!1)){switch(rr.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this._moveState.forward=1;break;case"KeyS":this._moveState.back=1;break;case"KeyA":this._moveState.left=1;break;case"KeyD":this._moveState.right=1;break;case"KeyR":this._moveState.up=1;break;case"KeyF":this._moveState.down=1;break;case"ArrowUp":this._moveState.pitchUp=1;break;case"ArrowDown":this._moveState.pitchDown=1;break;case"ArrowLeft":this._moveState.yawLeft=1;break;case"ArrowRight":this._moveState.yawRight=1;break;case"KeyQ":this._moveState.rollLeft=1;break;case"KeyE":this._moveState.rollRight=1;break}this._updateMovementVector(),this._updateRotationVector()}}function onKeyUp$1(rr){if(this.enabled!==!1){switch(rr.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this._moveState.forward=0;break;case"KeyS":this._moveState.back=0;break;case"KeyA":this._moveState.left=0;break;case"KeyD":this._moveState.right=0;break;case"KeyR":this._moveState.up=0;break;case"KeyF":this._moveState.down=0;break;case"ArrowUp":this._moveState.pitchUp=0;break;case"ArrowDown":this._moveState.pitchDown=0;break;case"ArrowLeft":this._moveState.yawLeft=0;break;case"ArrowRight":this._moveState.yawRight=0;break;case"KeyQ":this._moveState.rollLeft=0;break;case"KeyE":this._moveState.rollRight=0;break}this._updateMovementVector(),this._updateRotationVector()}}function onPointerDown$3(rr){if(this.enabled!==!1)if(this.dragToLook)this._status++;else{switch(rr.button){case 0:this._moveState.forward=1;break;case 2:this._moveState.back=1;break}this._updateMovementVector()}}function onPointerMove$3(rr){if(this.enabled!==!1&&(!this.dragToLook||this._status>0)){const er=this._getContainerDimensions(),tr=er.size[0]/2,ir=er.size[1]/2;this._moveState.yawLeft=-(rr.pageX-er.offset[0]-tr)/tr,this._moveState.pitchDown=(rr.pageY-er.offset[1]-ir)/ir,this._updateRotationVector()}}function onPointerUp$3(rr){if(this.enabled!==!1){if(this.dragToLook)this._status--,this._moveState.yawLeft=this._moveState.pitchDown=0;else{switch(rr.button){case 0:this._moveState.forward=0;break;case 2:this._moveState.back=0;break}this._updateMovementVector()}this._updateRotationVector()}}function onPointerCancel$1(){this.enabled!==!1&&(this.dragToLook?(this._status=0,this._moveState.yawLeft=this._moveState.pitchDown=0):(this._moveState.forward=0,this._moveState.back=0,this._updateMovementVector()),this._updateRotationVector())}function onContextMenu$2(rr){this.enabled!==!1&&rr.preventDefault()}const _changeEvent$3={type:"change"},_startEvent$1={type:"start"},_endEvent$1={type:"end"},_ray$2=new Ray$1,_plane$2=new Plane,_TILT_LIMIT=Math.cos(70*MathUtils.DEG2RAD),_v=new Vector3$1,_twoPI=2*Math.PI,_STATE$1={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_EPS$1=1e-6;class OrbitControls extends Controls{constructor(er,tr=null){super(er,tr),this.state=_STATE$1.NONE,this.enabled=!0,this.target=new Vector3$1,this.cursor=new Vector3$1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Vector3$1,this._lastQuaternion=new Quaternion$1,this._lastTargetPosition=new Vector3$1,this._quat=new Quaternion$1().setFromUnitVectors(er.up,new Vector3$1(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Spherical,this._sphericalDelta=new Spherical,this._scale=1,this._panOffset=new Vector3$1,this._rotateStart=new Vector2,this._rotateEnd=new Vector2,this._rotateDelta=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._panDelta=new Vector2,this._dollyStart=new Vector2,this._dollyEnd=new Vector2,this._dollyDelta=new Vector2,this._dollyDirection=new Vector3$1,this._mouse=new Vector2,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove$2.bind(this),this._onPointerDown=onPointerDown$2.bind(this),this._onPointerUp=onPointerUp$2.bind(this),this._onContextMenu=onContextMenu$1.bind(this),this._onMouseWheel=onMouseWheel$1.bind(this),this._onKeyDown=onKeyDown$1.bind(this),this._onTouchStart=onTouchStart$1.bind(this),this._onTouchMove=onTouchMove$1.bind(this),this._onMouseDown=onMouseDown$1.bind(this),this._onMouseMove=onMouseMove$2.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(er){er.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=er}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_changeEvent$3),this.update(),this.state=_STATE$1.NONE}update(er=null){const tr=this.object.position;_v.copy(tr).sub(this.target),_v.applyQuaternion(this._quat),this._spherical.setFromVector3(_v),this.autoRotate&&this.state===_STATE$1.NONE&&this._rotateLeft(this._getAutoRotationAngle(er)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let ir=this.minAzimuthAngle,nr=this.maxAzimuthAngle;isFinite(ir)&&isFinite(nr)&&(ir<-Math.PI?ir+=_twoPI:ir>Math.PI&&(ir-=_twoPI),nr<-Math.PI?nr+=_twoPI:nr>Math.PI&&(nr-=_twoPI),ir<=nr?this._spherical.theta=Math.max(ir,Math.min(nr,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(ir+nr)/2?Math.max(ir,this._spherical.theta):Math.min(nr,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let sr=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const ar=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),sr=ar!=this._spherical.radius}if(_v.setFromSpherical(this._spherical),_v.applyQuaternion(this._quatInverse),tr.copy(this.target).add(_v),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let ar=null;if(this.object.isPerspectiveCamera){const or=_v.length();ar=this._clampDistance(or*this._scale);const lr=or-ar;this.object.position.addScaledVector(this._dollyDirection,lr),this.object.updateMatrixWorld(),sr=!!lr}else if(this.object.isOrthographicCamera){const or=new Vector3$1(this._mouse.x,this._mouse.y,0);or.unproject(this.object);const lr=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),sr=lr!==this.object.zoom;const cr=new Vector3$1(this._mouse.x,this._mouse.y,0);cr.unproject(this.object),this.object.position.sub(cr).add(or),this.object.updateMatrixWorld(),ar=_v.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;ar!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(ar).add(this.object.position):(_ray$2.origin.copy(this.object.position),_ray$2.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_ray$2.direction))<_TILT_LIMIT?this.object.lookAt(this.target):(_plane$2.setFromNormalAndCoplanarPoint(this.object.up,this.target),_ray$2.intersectPlane(_plane$2,this.target))))}else if(this.object.isOrthographicCamera){const ar=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),ar!==this.object.zoom&&(this.object.updateProjectionMatrix(),sr=!0)}return this._scale=1,this._performCursorZoom=!1,sr||this._lastPosition.distanceToSquared(this.object.position)>_EPS$1||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_EPS$1||this._lastTargetPosition.distanceToSquared(this.target)>_EPS$1?(this.dispatchEvent(_changeEvent$3),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(er){return er!==null?_twoPI/60*this.autoRotateSpeed*er:_twoPI/60/60*this.autoRotateSpeed}_getZoomScale(er){const tr=Math.abs(er*.01);return Math.pow(.95,this.zoomSpeed*tr)}_rotateLeft(er){this._sphericalDelta.theta-=er}_rotateUp(er){this._sphericalDelta.phi-=er}_panLeft(er,tr){_v.setFromMatrixColumn(tr,0),_v.multiplyScalar(-er),this._panOffset.add(_v)}_panUp(er,tr){this.screenSpacePanning===!0?_v.setFromMatrixColumn(tr,1):(_v.setFromMatrixColumn(tr,0),_v.crossVectors(this.object.up,_v)),_v.multiplyScalar(er),this._panOffset.add(_v)}_pan(er,tr){const ir=this.domElement;if(this.object.isPerspectiveCamera){const nr=this.object.position;_v.copy(nr).sub(this.target);let sr=_v.length();sr*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*er*sr/ir.clientHeight,this.object.matrix),this._panUp(2*tr*sr/ir.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(er*(this.object.right-this.object.left)/this.object.zoom/ir.clientWidth,this.object.matrix),this._panUp(tr*(this.object.top-this.object.bottom)/this.object.zoom/ir.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(er){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=er:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(er){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=er:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(er,tr){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const ir=this.domElement.getBoundingClientRect(),nr=er-ir.left,sr=tr-ir.top,ar=ir.width,or=ir.height;this._mouse.x=nr/ar*2-1,this._mouse.y=-(sr/or)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(er){return Math.max(this.minDistance,Math.min(this.maxDistance,er))}_handleMouseDownRotate(er){this._rotateStart.set(er.clientX,er.clientY)}_handleMouseDownDolly(er){this._updateZoomParameters(er.clientX,er.clientX),this._dollyStart.set(er.clientX,er.clientY)}_handleMouseDownPan(er){this._panStart.set(er.clientX,er.clientY)}_handleMouseMoveRotate(er){this._rotateEnd.set(er.clientX,er.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const tr=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/tr.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/tr.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(er){this._dollyEnd.set(er.clientX,er.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(er){this._panEnd.set(er.clientX,er.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(er){this._updateZoomParameters(er.clientX,er.clientY),er.deltaY<0?this._dollyIn(this._getZoomScale(er.deltaY)):er.deltaY>0&&this._dollyOut(this._getZoomScale(er.deltaY)),this.update()}_handleKeyDown(er){let tr=!1;switch(er.code){case this.keys.UP:er.ctrlKey||er.metaKey||er.shiftKey?this._rotateUp(_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,this.keyPanSpeed),tr=!0;break;case this.keys.BOTTOM:er.ctrlKey||er.metaKey||er.shiftKey?this._rotateUp(-_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(0,-this.keyPanSpeed),tr=!0;break;case this.keys.LEFT:er.ctrlKey||er.metaKey||er.shiftKey?this._rotateLeft(_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(this.keyPanSpeed,0),tr=!0;break;case this.keys.RIGHT:er.ctrlKey||er.metaKey||er.shiftKey?this._rotateLeft(-_twoPI*this.rotateSpeed/this.domElement.clientHeight):this._pan(-this.keyPanSpeed,0),tr=!0;break}tr&&(er.preventDefault(),this.update())}_handleTouchStartRotate(er){if(this._pointers.length===1)this._rotateStart.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),ir=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._rotateStart.set(ir,nr)}}_handleTouchStartPan(er){if(this._pointers.length===1)this._panStart.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),ir=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._panStart.set(ir,nr)}}_handleTouchStartDolly(er){const tr=this._getSecondPointerPosition(er),ir=er.pageX-tr.x,nr=er.pageY-tr.y,sr=Math.sqrt(ir*ir+nr*nr);this._dollyStart.set(0,sr)}_handleTouchStartDollyPan(er){this.enableZoom&&this._handleTouchStartDolly(er),this.enablePan&&this._handleTouchStartPan(er)}_handleTouchStartDollyRotate(er){this.enableZoom&&this._handleTouchStartDolly(er),this.enableRotate&&this._handleTouchStartRotate(er)}_handleTouchMoveRotate(er){if(this._pointers.length==1)this._rotateEnd.set(er.pageX,er.pageY);else{const ir=this._getSecondPointerPosition(er),nr=.5*(er.pageX+ir.x),sr=.5*(er.pageY+ir.y);this._rotateEnd.set(nr,sr)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const tr=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/tr.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/tr.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(er){if(this._pointers.length===1)this._panEnd.set(er.pageX,er.pageY);else{const tr=this._getSecondPointerPosition(er),ir=.5*(er.pageX+tr.x),nr=.5*(er.pageY+tr.y);this._panEnd.set(ir,nr)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(er){const tr=this._getSecondPointerPosition(er),ir=er.pageX-tr.x,nr=er.pageY-tr.y,sr=Math.sqrt(ir*ir+nr*nr);this._dollyEnd.set(0,sr),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const ar=(er.pageX+tr.x)*.5,or=(er.pageY+tr.y)*.5;this._updateZoomParameters(ar,or)}_handleTouchMoveDollyPan(er){this.enableZoom&&this._handleTouchMoveDolly(er),this.enablePan&&this._handleTouchMovePan(er)}_handleTouchMoveDollyRotate(er){this.enableZoom&&this._handleTouchMoveDolly(er),this.enableRotate&&this._handleTouchMoveRotate(er)}_addPointer(er){this._pointers.push(er.pointerId)}_removePointer(er){delete this._pointerPositions[er.pointerId];for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr]==er.pointerId){this._pointers.splice(tr,1);return}}_isTrackingPointer(er){for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr]==er.pointerId)return!0;return!1}_trackPointer(er){let tr=this._pointerPositions[er.pointerId];tr===void 0&&(tr=new Vector2,this._pointerPositions[er.pointerId]=tr),tr.set(er.pageX,er.pageY)}_getSecondPointerPosition(er){const tr=er.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[tr]}_customWheelEvent(er){const tr=er.deltaMode,ir={clientX:er.clientX,clientY:er.clientY,deltaY:er.deltaY};switch(tr){case 1:ir.deltaY*=16;break;case 2:ir.deltaY*=100;break}return er.ctrlKey&&!this._controlActive&&(ir.deltaY*=10),ir}}function onPointerDown$2(rr){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(rr.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(rr)&&(this._addPointer(rr),rr.pointerType==="touch"?this._onTouchStart(rr):this._onMouseDown(rr)))}function onPointerMove$2(rr){this.enabled!==!1&&(rr.pointerType==="touch"?this._onTouchMove(rr):this._onMouseMove(rr))}function onPointerUp$2(rr){switch(this._removePointer(rr),this._pointers.length){case 0:this.domElement.releasePointerCapture(rr.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(_endEvent$1),this.state=_STATE$1.NONE;break;case 1:const er=this._pointers[0],tr=this._pointerPositions[er];this._onTouchStart({pointerId:er,pageX:tr.x,pageY:tr.y});break}}function onMouseDown$1(rr){let er;switch(rr.button){case 0:er=this.mouseButtons.LEFT;break;case 1:er=this.mouseButtons.MIDDLE;break;case 2:er=this.mouseButtons.RIGHT;break;default:er=-1}switch(er){case MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(rr),this.state=_STATE$1.DOLLY;break;case MOUSE.ROTATE:if(rr.ctrlKey||rr.metaKey||rr.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(rr),this.state=_STATE$1.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(rr),this.state=_STATE$1.ROTATE}break;case MOUSE.PAN:if(rr.ctrlKey||rr.metaKey||rr.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(rr),this.state=_STATE$1.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(rr),this.state=_STATE$1.PAN}break;default:this.state=_STATE$1.NONE}this.state!==_STATE$1.NONE&&this.dispatchEvent(_startEvent$1)}function onMouseMove$2(rr){switch(this.state){case _STATE$1.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(rr);break;case _STATE$1.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(rr);break;case _STATE$1.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(rr);break}}function onMouseWheel$1(rr){this.enabled===!1||this.enableZoom===!1||this.state!==_STATE$1.NONE||(rr.preventDefault(),this.dispatchEvent(_startEvent$1),this._handleMouseWheel(this._customWheelEvent(rr)),this.dispatchEvent(_endEvent$1))}function onKeyDown$1(rr){this.enabled===!1||this.enablePan===!1||this._handleKeyDown(rr)}function onTouchStart$1(rr){switch(this._trackPointer(rr),this._pointers.length){case 1:switch(this.touches.ONE){case TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(rr),this.state=_STATE$1.TOUCH_ROTATE;break;case TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(rr),this.state=_STATE$1.TOUCH_PAN;break;default:this.state=_STATE$1.NONE}break;case 2:switch(this.touches.TWO){case TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(rr),this.state=_STATE$1.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(rr),this.state=_STATE$1.TOUCH_DOLLY_ROTATE;break;default:this.state=_STATE$1.NONE}break;default:this.state=_STATE$1.NONE}this.state!==_STATE$1.NONE&&this.dispatchEvent(_startEvent$1)}function onTouchMove$1(rr){switch(this._trackPointer(rr),this.state){case _STATE$1.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(rr),this.update();break;case _STATE$1.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(rr),this.update();break;case _STATE$1.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(rr),this.update();break;case _STATE$1.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(rr),this.update();break;default:this.state=_STATE$1.NONE}}function onContextMenu$1(rr){this.enabled!==!1&&rr.preventDefault()}function interceptControlDown(rr){rr.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(rr){rr.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}class MapControls extends OrbitControls{constructor(er,tr){super(er,tr),this.screenSpacePanning=!1,this.mouseButtons={LEFT:MOUSE.PAN,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.ROTATE},this.touches={ONE:TOUCH.PAN,TWO:TOUCH.DOLLY_ROTATE}}}const _euler=new Euler(0,0,0,"YXZ"),_vector$3=new Vector3$1,_changeEvent$2={type:"change"},_lockEvent={type:"lock"},_unlockEvent={type:"unlock"},_PI_2=Math.PI/2;class PointerLockControls extends Controls{constructor(er,tr=null){super(er,tr),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=onMouseMove$1.bind(this),this._onPointerlockChange=onPointerlockChange.bind(this),this._onPointerlockError=onPointerlockError.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(er){return er.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(er){if(this.enabled===!1)return;const tr=this.object;_vector$3.setFromMatrixColumn(tr.matrix,0),_vector$3.crossVectors(tr.up,_vector$3),tr.position.addScaledVector(_vector$3,er)}moveRight(er){if(this.enabled===!1)return;const tr=this.object;_vector$3.setFromMatrixColumn(tr.matrix,0),tr.position.addScaledVector(_vector$3,er)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function onMouseMove$1(rr){if(this.enabled===!1||this.isLocked===!1)return;const er=rr.movementX||rr.mozMovementX||rr.webkitMovementX||0,tr=rr.movementY||rr.mozMovementY||rr.webkitMovementY||0,ir=this.object;_euler.setFromQuaternion(ir.quaternion),_euler.y-=er*.002*this.pointerSpeed,_euler.x-=tr*.002*this.pointerSpeed,_euler.x=Math.max(_PI_2-this.maxPolarAngle,Math.min(_PI_2-this.minPolarAngle,_euler.x)),ir.quaternion.setFromEuler(_euler),this.dispatchEvent(_changeEvent$2)}function onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(_lockEvent),this.isLocked=!0):(this.dispatchEvent(_unlockEvent),this.isLocked=!1)}function onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}const _changeEvent$1={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_EPS=1e-6,_STATE={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4},_v2$4=new Vector2,_mouseChange=new Vector2,_objectUp=new Vector3$1,_pan=new Vector3$1,_axis=new Vector3$1,_quaternion$2=new Quaternion$1,_eyeDirection=new Vector3$1,_objectUpDirection=new Vector3$1,_objectSidewaysDirection=new Vector3$1,_moveDirection=new Vector3$1;class TrackballControls extends Controls{constructor(er,tr=null){super(er,tr),this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.keys=["KeyA","KeyS","KeyD"],this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.state=_STATE.NONE,this.keyState=_STATE.NONE,this.target=new Vector3$1,this._lastPosition=new Vector3$1,this._lastZoom=1,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._lastAngle=0,this._eye=new Vector3$1,this._movePrev=new Vector2,this._moveCurr=new Vector2,this._lastAxis=new Vector3$1,this._zoomStart=new Vector2,this._zoomEnd=new Vector2,this._panStart=new Vector2,this._panEnd=new Vector2,this._pointers=[],this._pointerPositions={},this._onPointerMove=onPointerMove$1.bind(this),this._onPointerDown=onPointerDown$1.bind(this),this._onPointerUp=onPointerUp$1.bind(this),this._onPointerCancel=onPointerCancel.bind(this),this._onContextMenu=onContextMenu.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown.bind(this),this._onKeyUp=onKeyUp.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onTouchEnd=onTouchEnd.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._onMouseUp=onMouseUp.bind(this),this._target0=this.target.clone(),this._position0=this.object.position.clone(),this._up0=this.object.up.clone(),this._zoom0=this.object.zoom,tr!==null&&(this.connect(),this.handleResize()),this.update()}connect(){window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerCancel),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerCancel),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}handleResize(){const er=this.domElement.getBoundingClientRect(),tr=this.domElement.ownerDocument.documentElement;this.screen.left=er.left+window.pageXOffset-tr.clientLeft,this.screen.top=er.top+window.pageYOffset-tr.clientTop,this.screen.width=er.width,this.screen.height=er.height}update(){this._eye.subVectors(this.object.position,this.target),this.noRotate||this._rotateCamera(),this.noZoom||this._zoomCamera(),this.noPan||this._panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this._checkDistances(),this.object.lookAt(this.target),this._lastPosition.distanceToSquared(this.object.position)>_EPS&&(this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this._lastPosition.distanceToSquared(this.object.position)>_EPS||this._lastZoom!==this.object.zoom)&&(this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type.")}reset(){this.state=_STATE.NONE,this.keyState=_STATE.NONE,this.target.copy(this._target0),this.object.position.copy(this._position0),this.object.up.copy(this._up0),this.object.zoom=this._zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(_changeEvent$1),this._lastPosition.copy(this.object.position),this._lastZoom=this.object.zoom}_panCamera(){if(_mouseChange.copy(this._panEnd).sub(this._panStart),_mouseChange.lengthSq()){if(this.object.isOrthographicCamera){const er=(this.object.right-this.object.left)/this.object.zoom/this.domElement.clientWidth,tr=(this.object.top-this.object.bottom)/this.object.zoom/this.domElement.clientWidth;_mouseChange.x*=er,_mouseChange.y*=tr}_mouseChange.multiplyScalar(this._eye.length()*this.panSpeed),_pan.copy(this._eye).cross(this.object.up).setLength(_mouseChange.x),_pan.add(_objectUp.copy(this.object.up).setLength(_mouseChange.y)),this.object.position.add(_pan),this.target.add(_pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(_mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}_rotateCamera(){_moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0);let er=_moveDirection.length();er?(this._eye.copy(this.object.position).sub(this.target),_eyeDirection.copy(this._eye).normalize(),_objectUpDirection.copy(this.object.up).normalize(),_objectSidewaysDirection.crossVectors(_objectUpDirection,_eyeDirection).normalize(),_objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),_objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),_moveDirection.copy(_objectUpDirection.add(_objectSidewaysDirection)),_axis.crossVectors(_moveDirection,this._eye).normalize(),er*=this.rotateSpeed,_quaternion$2.setFromAxisAngle(_axis,er),this._eye.applyQuaternion(_quaternion$2),this.object.up.applyQuaternion(_quaternion$2),this._lastAxis.copy(_axis),this._lastAngle=er):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),_quaternion$2.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(_quaternion$2),this.object.up.applyQuaternion(_quaternion$2)),this._movePrev.copy(this._moveCurr)}_zoomCamera(){let er;this.state===_STATE.TOUCH_ZOOM_PAN?(er=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(er):this.object.isOrthographicCamera?(this.object.zoom=MathUtils.clamp(this.object.zoom/er,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")):(er=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed,er!==1&&er>0&&(this.object.isPerspectiveCamera?this._eye.multiplyScalar(er):this.object.isOrthographicCamera?(this.object.zoom=MathUtils.clamp(this.object.zoom/er,this.minZoom,this.maxZoom),this._lastZoom!==this.object.zoom&&this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}_getMouseOnScreen(er,tr){return _v2$4.set((er-this.screen.left)/this.screen.width,(tr-this.screen.top)/this.screen.height),_v2$4}_getMouseOnCircle(er,tr){return _v2$4.set((er-this.screen.width*.5-this.screen.left)/(this.screen.width*.5),(this.screen.height+2*(this.screen.top-tr))/this.screen.width),_v2$4}_addPointer(er){this._pointers.push(er)}_removePointer(er){delete this._pointerPositions[er.pointerId];for(let tr=0;tr<this._pointers.length;tr++)if(this._pointers[tr].pointerId==er.pointerId){this._pointers.splice(tr,1);return}}_trackPointer(er){let tr=this._pointerPositions[er.pointerId];tr===void 0&&(tr=new Vector2,this._pointerPositions[er.pointerId]=tr),tr.set(er.pageX,er.pageY)}_getSecondPointerPosition(er){const tr=er.pointerId===this._pointers[0].pointerId?this._pointers[1]:this._pointers[0];return this._pointerPositions[tr.pointerId]}_checkDistances(){(!this.noZoom||!this.noPan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}}function onPointerDown$1(rr){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(rr.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),this._addPointer(rr),rr.pointerType==="touch"?this._onTouchStart(rr):this._onMouseDown(rr))}function onPointerMove$1(rr){this.enabled!==!1&&(rr.pointerType==="touch"?this._onTouchMove(rr):this._onMouseMove(rr))}function onPointerUp$1(rr){this.enabled!==!1&&(rr.pointerType==="touch"?this._onTouchEnd(rr):this._onMouseUp(),this._removePointer(rr),this._pointers.length===0&&(this.domElement.releasePointerCapture(rr.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp)))}function onPointerCancel(rr){this._removePointer(rr)}function onKeyUp(){this.enabled!==!1&&(this.keyState=_STATE.NONE,window.addEventListener("keydown",this._onKeyDown))}function onKeyDown(rr){this.enabled!==!1&&(window.removeEventListener("keydown",this._onKeyDown),this.keyState===_STATE.NONE&&(rr.code===this.keys[_STATE.ROTATE]&&!this.noRotate?this.keyState=_STATE.ROTATE:rr.code===this.keys[_STATE.ZOOM]&&!this.noZoom?this.keyState=_STATE.ZOOM:rr.code===this.keys[_STATE.PAN]&&!this.noPan&&(this.keyState=_STATE.PAN)))}function onMouseDown(rr){let er;switch(rr.button){case 0:er=this.mouseButtons.LEFT;break;case 1:er=this.mouseButtons.MIDDLE;break;case 2:er=this.mouseButtons.RIGHT;break;default:er=-1}switch(er){case MOUSE.DOLLY:this.state=_STATE.ZOOM;break;case MOUSE.ROTATE:this.state=_STATE.ROTATE;break;case MOUSE.PAN:this.state=_STATE.PAN;break;default:this.state=_STATE.NONE}const tr=this.keyState!==_STATE.NONE?this.keyState:this.state;tr===_STATE.ROTATE&&!this.noRotate?(this._moveCurr.copy(this._getMouseOnCircle(rr.pageX,rr.pageY)),this._movePrev.copy(this._moveCurr)):tr===_STATE.ZOOM&&!this.noZoom?(this._zoomStart.copy(this._getMouseOnScreen(rr.pageX,rr.pageY)),this._zoomEnd.copy(this._zoomStart)):tr===_STATE.PAN&&!this.noPan&&(this._panStart.copy(this._getMouseOnScreen(rr.pageX,rr.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(_startEvent)}function onMouseMove(rr){const er=this.keyState!==_STATE.NONE?this.keyState:this.state;er===_STATE.ROTATE&&!this.noRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(rr.pageX,rr.pageY))):er===_STATE.ZOOM&&!this.noZoom?this._zoomEnd.copy(this._getMouseOnScreen(rr.pageX,rr.pageY)):er===_STATE.PAN&&!this.noPan&&this._panEnd.copy(this._getMouseOnScreen(rr.pageX,rr.pageY))}function onMouseUp(){this.state=_STATE.NONE,this.dispatchEvent(_endEvent)}function onMouseWheel(rr){if(this.enabled!==!1&&this.noZoom!==!0){switch(rr.preventDefault(),rr.deltaMode){case 2:this._zoomStart.y-=rr.deltaY*.025;break;case 1:this._zoomStart.y-=rr.deltaY*.01;break;default:this._zoomStart.y-=rr.deltaY*25e-5;break}this.dispatchEvent(_startEvent),this.dispatchEvent(_endEvent)}}function onContextMenu(rr){this.enabled!==!1&&rr.preventDefault()}function onTouchStart(rr){switch(this._trackPointer(rr),this._pointers.length){case 1:this.state=_STATE.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(this._pointers[0].pageX,this._pointers[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this.state=_STATE.TOUCH_ZOOM_PAN;const er=this._pointers[0].pageX-this._pointers[1].pageX,tr=this._pointers[0].pageY-this._pointers[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(er*er+tr*tr);const ir=(this._pointers[0].pageX+this._pointers[1].pageX)/2,nr=(this._pointers[0].pageY+this._pointers[1].pageY)/2;this._panStart.copy(this._getMouseOnScreen(ir,nr)),this._panEnd.copy(this._panStart);break}this.dispatchEvent(_startEvent)}function onTouchMove(rr){switch(this._trackPointer(rr),this._pointers.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this._getMouseOnCircle(rr.pageX,rr.pageY));break;default:const er=this._getSecondPointerPosition(rr),tr=rr.pageX-er.x,ir=rr.pageY-er.y;this._touchZoomDistanceEnd=Math.sqrt(tr*tr+ir*ir);const nr=(rr.pageX+er.x)/2,sr=(rr.pageY+er.y)/2;this._panEnd.copy(this._getMouseOnScreen(nr,sr));break}}function onTouchEnd(rr){switch(this._pointers.length){case 0:this.state=_STATE.NONE;break;case 1:this.state=_STATE.TOUCH_ROTATE,this._moveCurr.copy(this._getMouseOnCircle(rr.pageX,rr.pageY)),this._movePrev.copy(this._moveCurr);break;case 2:this.state=_STATE.TOUCH_ZOOM_PAN;for(let er=0;er<this._pointers.length;er++)if(this._pointers[er].pointerId!==rr.pointerId){const tr=this._pointerPositions[this._pointers[er].pointerId];this._moveCurr.copy(this._getMouseOnCircle(tr.x,tr.y)),this._movePrev.copy(this._moveCurr);break}break}this.dispatchEvent(_endEvent)}const _raycaster$1=new Raycaster,_tempVector=new Vector3$1,_tempVector2=new Vector3$1,_tempQuaternion=new Quaternion$1,_unit={X:new Vector3$1(1,0,0),Y:new Vector3$1(0,1,0),Z:new Vector3$1(0,0,1)},_changeEvent={type:"change"},_mouseDownEvent={type:"mouseDown",mode:null},_mouseUpEvent={type:"mouseUp",mode:null},_objectChangeEvent={type:"objectChange"};class TransformControls extends Controls{constructor(er,tr=null){super(void 0,tr);const ir=new TransformControlsRoot(this);this._root=ir;const nr=new TransformControlsGizmo;this._gizmo=nr,ir.add(nr);const sr=new TransformControlsPlane;this._plane=sr,ir.add(sr);const ar=this;function or(Ar,yr){let wr=yr;Object.defineProperty(ar,Ar,{get:function(){return wr!==void 0?wr:yr},set:function(xr){wr!==xr&&(wr=xr,sr[Ar]=xr,nr[Ar]=xr,ar.dispatchEvent({type:Ar+"-changed",value:xr}),ar.dispatchEvent(_changeEvent))}}),ar[Ar]=yr,sr[Ar]=yr,nr[Ar]=yr}or("camera",er),or("object",void 0),or("enabled",!0),or("axis",null),or("mode","translate"),or("translationSnap",null),or("rotationSnap",null),or("scaleSnap",null),or("space","world"),or("size",1),or("dragging",!1),or("showX",!0),or("showY",!0),or("showZ",!0),or("minX",-1/0),or("maxX",1/0),or("minY",-1/0),or("maxY",1/0),or("minZ",-1/0),or("maxZ",1/0);const lr=new Vector3$1,cr=new Vector3$1,ur=new Quaternion$1,dr=new Quaternion$1,hr=new Vector3$1,pr=new Quaternion$1,gr=new Vector3$1,vr=new Vector3$1,mr=new Vector3$1,fr=0,_r=new Vector3$1;or("worldPosition",lr),or("worldPositionStart",cr),or("worldQuaternion",ur),or("worldQuaternionStart",dr),or("cameraPosition",hr),or("cameraQuaternion",pr),or("pointStart",gr),or("pointEnd",vr),or("rotationAxis",mr),or("rotationAngle",fr),or("eye",_r),this._offset=new Vector3$1,this._startNorm=new Vector3$1,this._endNorm=new Vector3$1,this._cameraScale=new Vector3$1,this._parentPosition=new Vector3$1,this._parentQuaternion=new Quaternion$1,this._parentQuaternionInv=new Quaternion$1,this._parentScale=new Vector3$1,this._worldScaleStart=new Vector3$1,this._worldQuaternionInv=new Quaternion$1,this._worldScale=new Vector3$1,this._positionStart=new Vector3$1,this._quaternionStart=new Quaternion$1,this._scaleStart=new Vector3$1,this._getPointer=getPointer.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerHover=onPointerHover.bind(this),this._onPointerMove=onPointerMove.bind(this),this._onPointerUp=onPointerUp.bind(this),tr!==null&&this.connect()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.style.touchAction="auto"}getHelper(){return this._root}pointerHover(er){if(this.object===void 0||this.dragging===!0)return;er!==null&&_raycaster$1.setFromCamera(er,this.camera);const tr=intersectObjectWithRay(this._gizmo.picker[this.mode],_raycaster$1);tr?this.axis=tr.object.name:this.axis=null}pointerDown(er){if(!(this.object===void 0||this.dragging===!0||er!=null&&er.button!==0)&&this.axis!==null){er!==null&&_raycaster$1.setFromCamera(er,this.camera);const tr=intersectObjectWithRay(this._plane,_raycaster$1,!0);tr&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(tr.point).sub(this.worldPositionStart)),this.dragging=!0,_mouseDownEvent.mode=this.mode,this.dispatchEvent(_mouseDownEvent)}}pointerMove(er){const tr=this.axis,ir=this.mode,nr=this.object;let sr=this.space;if(ir==="scale"?sr="local":(tr==="E"||tr==="XYZE"||tr==="XYZ")&&(sr="world"),nr===void 0||tr===null||this.dragging===!1||er!==null&&er.button!==-1)return;er!==null&&_raycaster$1.setFromCamera(er,this.camera);const ar=intersectObjectWithRay(this._plane,_raycaster$1,!0);if(ar){if(this.pointEnd.copy(ar.point).sub(this.worldPositionStart),ir==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),sr==="local"&&tr!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),tr.indexOf("X")===-1&&(this._offset.x=0),tr.indexOf("Y")===-1&&(this._offset.y=0),tr.indexOf("Z")===-1&&(this._offset.z=0),sr==="local"&&tr!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),nr.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(sr==="local"&&(nr.position.applyQuaternion(_tempQuaternion.copy(this._quaternionStart).invert()),tr.search("X")!==-1&&(nr.position.x=Math.round(nr.position.x/this.translationSnap)*this.translationSnap),tr.search("Y")!==-1&&(nr.position.y=Math.round(nr.position.y/this.translationSnap)*this.translationSnap),tr.search("Z")!==-1&&(nr.position.z=Math.round(nr.position.z/this.translationSnap)*this.translationSnap),nr.position.applyQuaternion(this._quaternionStart)),sr==="world"&&(nr.parent&&nr.position.add(_tempVector.setFromMatrixPosition(nr.parent.matrixWorld)),tr.search("X")!==-1&&(nr.position.x=Math.round(nr.position.x/this.translationSnap)*this.translationSnap),tr.search("Y")!==-1&&(nr.position.y=Math.round(nr.position.y/this.translationSnap)*this.translationSnap),tr.search("Z")!==-1&&(nr.position.z=Math.round(nr.position.z/this.translationSnap)*this.translationSnap),nr.parent&&nr.position.sub(_tempVector.setFromMatrixPosition(nr.parent.matrixWorld)))),nr.position.x=Math.max(this.minX,Math.min(this.maxX,nr.position.x)),nr.position.y=Math.max(this.minY,Math.min(this.maxY,nr.position.y)),nr.position.z=Math.max(this.minZ,Math.min(this.maxZ,nr.position.z));else if(ir==="scale"){if(tr.search("XYZ")!==-1){let or=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(or*=-1),_tempVector2.set(or,or,or)}else _tempVector.copy(this.pointStart),_tempVector2.copy(this.pointEnd),_tempVector.applyQuaternion(this._worldQuaternionInv),_tempVector2.applyQuaternion(this._worldQuaternionInv),_tempVector2.divide(_tempVector),tr.search("X")===-1&&(_tempVector2.x=1),tr.search("Y")===-1&&(_tempVector2.y=1),tr.search("Z")===-1&&(_tempVector2.z=1);nr.scale.copy(this._scaleStart).multiply(_tempVector2),this.scaleSnap&&(tr.search("X")!==-1&&(nr.scale.x=Math.round(nr.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),tr.search("Y")!==-1&&(nr.scale.y=Math.round(nr.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),tr.search("Z")!==-1&&(nr.scale.z=Math.round(nr.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(ir==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const or=20/this.worldPosition.distanceTo(_tempVector.setFromMatrixPosition(this.camera.matrixWorld));let lr=!1;tr==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(_tempVector.copy(this.rotationAxis).cross(this.eye))*or):(tr==="X"||tr==="Y"||tr==="Z")&&(this.rotationAxis.copy(_unit[tr]),_tempVector.copy(_unit[tr]),sr==="local"&&_tempVector.applyQuaternion(this.worldQuaternion),_tempVector.cross(this.eye),_tempVector.length()===0?lr=!0:this.rotationAngle=this._offset.dot(_tempVector.normalize())*or),(tr==="E"||lr)&&(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),sr==="local"&&tr!=="E"&&tr!=="XYZE"?(nr.quaternion.copy(this._quaternionStart),nr.quaternion.multiply(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),nr.quaternion.copy(_tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),nr.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent)}}pointerUp(er){er!==null&&er.button!==0||(this.dragging&&this.axis!==null&&(_mouseUpEvent.mode=this.mode,this.dispatchEvent(_mouseUpEvent)),this.dragging=!1,this.axis=null)}dispose(){this.disconnect(),this._root.dispose()}attach(er){return this.object=er,this._root.visible=!0,this}detach(){return this.object=void 0,this.axis=null,this._root.visible=!1,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(_changeEvent),this.dispatchEvent(_objectChangeEvent),this.pointStart.copy(this.pointEnd))}getRaycaster(){return _raycaster$1}getMode(){return this.mode}setMode(er){this.mode=er}setTranslationSnap(er){this.translationSnap=er}setRotationSnap(er){this.rotationSnap=er}setScaleSnap(er){this.scaleSnap=er}setSize(er){this.size=er}setSpace(er){this.space=er}}function getPointer(rr){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:rr.button};{const er=this.domElement.getBoundingClientRect();return{x:(rr.clientX-er.left)/er.width*2-1,y:-(rr.clientY-er.top)/er.height*2+1,button:rr.button}}}function onPointerHover(rr){if(this.enabled)switch(rr.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(rr));break}}function onPointerDown(rr){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(rr.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(rr)),this.pointerDown(this._getPointer(rr)))}function onPointerMove(rr){this.enabled&&this.pointerMove(this._getPointer(rr))}function onPointerUp(rr){this.enabled&&(this.domElement.releasePointerCapture(rr.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(rr)))}function intersectObjectWithRay(rr,er,tr){const ir=er.intersectObject(rr,!0);for(let nr=0;nr<ir.length;nr++)if(ir[nr].object.visible||tr)return ir[nr];return!1}const _tempEuler=new Euler,_alignVector=new Vector3$1(0,1,0),_zeroVector=new Vector3$1(0,0,0),_lookAtMatrix=new Matrix4,_tempQuaternion2=new Quaternion$1,_identityQuaternion=new Quaternion$1,_dirVector=new Vector3$1,_tempMatrix=new Matrix4,_unitX=new Vector3$1(1,0,0),_unitY=new Vector3$1(0,1,0),_unitZ=new Vector3$1(0,0,1),_v1$5=new Vector3$1,_v2$3=new Vector3$1,_v3=new Vector3$1;class TransformControlsRoot extends Object3D{constructor(er){super(),this.isTransformControlsRoot=!0,this.controls=er,this.visible=!1}updateMatrixWorld(er){const tr=this.controls;tr.object!==void 0&&(tr.object.updateMatrixWorld(),tr.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):tr.object.parent.matrixWorld.decompose(tr._parentPosition,tr._parentQuaternion,tr._parentScale),tr.object.matrixWorld.decompose(tr.worldPosition,tr.worldQuaternion,tr._worldScale),tr._parentQuaternionInv.copy(tr._parentQuaternion).invert(),tr._worldQuaternionInv.copy(tr.worldQuaternion).invert()),tr.camera.updateMatrixWorld(),tr.camera.matrixWorld.decompose(tr.cameraPosition,tr.cameraQuaternion,tr._cameraScale),tr.camera.isOrthographicCamera?tr.camera.getWorldDirection(tr.eye).negate():tr.eye.copy(tr.cameraPosition).sub(tr.worldPosition).normalize(),super.updateMatrixWorld(er)}dispose(){this.traverse(function(er){er.geometry&&er.geometry.dispose(),er.material&&er.material.dispose()})}}class TransformControlsGizmo extends Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const er=new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),tr=new LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),ir=er.clone();ir.opacity=.15;const nr=tr.clone();nr.opacity=.5;const sr=er.clone();sr.color.setHex(16711680);const ar=er.clone();ar.color.setHex(65280);const or=er.clone();or.color.setHex(255);const lr=er.clone();lr.color.setHex(16711680),lr.opacity=.5;const cr=er.clone();cr.color.setHex(65280),cr.opacity=.5;const ur=er.clone();ur.color.setHex(255),ur.opacity=.5;const dr=er.clone();dr.opacity=.25;const hr=er.clone();hr.color.setHex(16776960),hr.opacity=.25,er.clone().color.setHex(16776960);const gr=er.clone();gr.color.setHex(7895160);const vr=new CylinderGeometry(0,.04,.1,12);vr.translate(0,.05,0);const mr=new BoxGeometry(.08,.08,.08);mr.translate(0,.04,0);const fr=new BufferGeometry;fr.setAttribute("position",new Float32BufferAttribute([0,0,0,1,0,0],3));const _r=new CylinderGeometry(.0075,.0075,.5,3);_r.translate(0,.25,0);function Ar(Or,Nr){const Ur=new TorusGeometry(Or,.0075,3,64,Nr*Math.PI*2);return Ur.rotateY(Math.PI/2),Ur.rotateX(Math.PI/2),Ur}function yr(){const Or=new BufferGeometry;return Or.setAttribute("position",new Float32BufferAttribute([0,0,0,1,1,1],3)),Or}const wr={X:[[new Mesh(vr,sr),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(vr,sr),[-.5,0,0],[0,0,Math.PI/2]],[new Mesh(_r,sr),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new Mesh(vr,ar),[0,.5,0]],[new Mesh(vr,ar),[0,-.5,0],[Math.PI,0,0]],[new Mesh(_r,ar)]],Z:[[new Mesh(vr,or),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(vr,or),[0,0,-.5],[-Math.PI/2,0,0]],[new Mesh(_r,or),null,[Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.1,0),dr.clone()),[0,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),ur.clone()),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),lr.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),cr.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},xr={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new OctahedronGeometry(.2,0),ir)]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[.15,0,.15],[-Math.PI/2,0,0]]]},Sr={START:[[new Mesh(new OctahedronGeometry(.01,2),nr),null,null,null,"helper"]],END:[[new Mesh(new OctahedronGeometry(.01,2),nr),null,null,null,"helper"]],DELTA:[[new Line(yr(),nr),null,null,null,"helper"]],X:[[new Line(fr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(fr,nr.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(fr,nr.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},br={XYZE:[[new Mesh(Ar(.5,1),gr),null,[0,Math.PI/2,0]]],X:[[new Mesh(Ar(.5,.5),sr)]],Y:[[new Mesh(Ar(.5,.5),ar),null,[0,0,-Math.PI/2]]],Z:[[new Mesh(Ar(.5,.5),or),null,[0,Math.PI/2,0]]],E:[[new Mesh(Ar(.75,1),hr),null,[0,Math.PI/2,0]]]},Cr={AXIS:[[new Line(fr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},Ir={XYZE:[[new Mesh(new SphereGeometry(.25,10,8),ir)]],X:[[new Mesh(new TorusGeometry(.5,.1,4,24),ir),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new Mesh(new TorusGeometry(.5,.1,4,24),ir),[0,0,0],[Math.PI/2,0,0]]],Z:[[new Mesh(new TorusGeometry(.5,.1,4,24),ir),[0,0,0],[0,0,-Math.PI/2]]],E:[[new Mesh(new TorusGeometry(.75,.1,2,24),ir)]]},Rr={X:[[new Mesh(mr,sr),[.5,0,0],[0,0,-Math.PI/2]],[new Mesh(_r,sr),[0,0,0],[0,0,-Math.PI/2]],[new Mesh(mr,sr),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(mr,ar),[0,.5,0]],[new Mesh(_r,ar)],[new Mesh(mr,ar),[0,-.5,0],[0,0,Math.PI]]],Z:[[new Mesh(mr,or),[0,0,.5],[Math.PI/2,0,0]],[new Mesh(_r,or),[0,0,0],[Math.PI/2,0,0]],[new Mesh(mr,or),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.15,.15,.01),ur),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.15,.15,.01),lr),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.15,.15,.01),cr),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.1,.1,.1),dr.clone())]]},Pr={X:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[.3,0,0],[0,0,-Math.PI/2]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,.3,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,-.3,0],[0,0,Math.PI]]],Z:[[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,0,.3],[Math.PI/2,0,0]],[new Mesh(new CylinderGeometry(.2,0,.6,4),ir),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[.15,.15,0]]],YZ:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new Mesh(new BoxGeometry(.2,.2,.01),ir),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new Mesh(new BoxGeometry(.2,.2,.2),ir),[0,0,0]]]},Dr={X:[[new Line(fr,nr.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new Line(fr,nr.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new Line(fr,nr.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function Fr(Or){const Nr=new Object3D;for(const Ur in Or)for(let Br=Or[Ur].length;Br--;){const Wr=Or[Ur][Br][0].clone(),Xr=Or[Ur][Br][1],Yr=Or[Ur][Br][2],Qi=Or[Ur][Br][3],Xi=Or[Ur][Br][4];Wr.name=Ur,Wr.tag=Xi,Xr&&Wr.position.set(Xr[0],Xr[1],Xr[2]),Yr&&Wr.rotation.set(Yr[0],Yr[1],Yr[2]),Qi&&Wr.scale.set(Qi[0],Qi[1],Qi[2]),Wr.updateMatrix();const Kr=Wr.geometry.clone();Kr.applyMatrix4(Wr.matrix),Wr.geometry=Kr,Wr.renderOrder=1/0,Wr.position.set(0,0,0),Wr.rotation.set(0,0,0),Wr.scale.set(1,1,1),Nr.add(Wr)}return Nr}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=Fr(wr)),this.add(this.gizmo.rotate=Fr(br)),this.add(this.gizmo.scale=Fr(Rr)),this.add(this.picker.translate=Fr(xr)),this.add(this.picker.rotate=Fr(Ir)),this.add(this.picker.scale=Fr(Pr)),this.add(this.helper.translate=Fr(Sr)),this.add(this.helper.rotate=Fr(Cr)),this.add(this.helper.scale=Fr(Dr)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(er){const ir=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:_identityQuaternion;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let nr=[];nr=nr.concat(this.picker[this.mode].children),nr=nr.concat(this.gizmo[this.mode].children),nr=nr.concat(this.helper[this.mode].children);for(let sr=0;sr<nr.length;sr++){const ar=nr[sr];ar.visible=!0,ar.rotation.set(0,0,0),ar.position.copy(this.worldPosition);let or;if(this.camera.isOrthographicCamera?or=(this.camera.top-this.camera.bottom)/this.camera.zoom:or=this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),ar.scale.set(1,1,1).multiplyScalar(or*this.size/4),ar.tag==="helper"){ar.visible=!1,ar.name==="AXIS"?(ar.visible=!!this.axis,this.axis==="X"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,0)),ar.quaternion.copy(ir).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitX).applyQuaternion(ir).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="Y"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,0,Math.PI/2)),ar.quaternion.copy(ir).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitY).applyQuaternion(ir).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="Z"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),ar.quaternion.copy(ir).multiply(_tempQuaternion),Math.abs(_alignVector.copy(_unitZ).applyQuaternion(ir).dot(this.eye))>.9&&(ar.visible=!1)),this.axis==="XYZE"&&(_tempQuaternion.setFromEuler(_tempEuler.set(0,Math.PI/2,0)),_alignVector.copy(this.rotationAxis),ar.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(_zeroVector,_alignVector,_unitY)),ar.quaternion.multiply(_tempQuaternion),ar.visible=this.dragging),this.axis==="E"&&(ar.visible=!1)):ar.name==="START"?(ar.position.copy(this.worldPositionStart),ar.visible=this.dragging):ar.name==="END"?(ar.position.copy(this.worldPosition),ar.visible=this.dragging):ar.name==="DELTA"?(ar.position.copy(this.worldPositionStart),ar.quaternion.copy(this.worldQuaternionStart),_tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),_tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),ar.scale.copy(_tempVector),ar.visible=this.dragging):(ar.quaternion.copy(ir),this.dragging?ar.position.copy(this.worldPositionStart):ar.position.copy(this.worldPosition),this.axis&&(ar.visible=this.axis.search(ar.name)!==-1));continue}ar.quaternion.copy(ir),this.mode==="translate"||this.mode==="scale"?(ar.name==="X"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(ir).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="Y"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(ir).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="Z"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(ir).dot(this.eye))>.99&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="XY"&&Math.abs(_alignVector.copy(_unitZ).applyQuaternion(ir).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="YZ"&&Math.abs(_alignVector.copy(_unitX).applyQuaternion(ir).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1),ar.name==="XZ"&&Math.abs(_alignVector.copy(_unitY).applyQuaternion(ir).dot(this.eye))<.2&&(ar.scale.set(1e-10,1e-10,1e-10),ar.visible=!1)):this.mode==="rotate"&&(_tempQuaternion2.copy(ir),_alignVector.copy(this.eye).applyQuaternion(_tempQuaternion.copy(ir).invert()),ar.name.search("E")!==-1&&ar.quaternion.setFromRotationMatrix(_lookAtMatrix.lookAt(this.eye,_zeroVector,_unitY)),ar.name==="X"&&(_tempQuaternion.setFromAxisAngle(_unitX,Math.atan2(-_alignVector.y,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion)),ar.name==="Y"&&(_tempQuaternion.setFromAxisAngle(_unitY,Math.atan2(_alignVector.x,_alignVector.z)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion)),ar.name==="Z"&&(_tempQuaternion.setFromAxisAngle(_unitZ,Math.atan2(_alignVector.y,_alignVector.x)),_tempQuaternion.multiplyQuaternions(_tempQuaternion2,_tempQuaternion),ar.quaternion.copy(_tempQuaternion))),ar.visible=ar.visible&&(ar.name.indexOf("X")===-1||this.showX),ar.visible=ar.visible&&(ar.name.indexOf("Y")===-1||this.showY),ar.visible=ar.visible&&(ar.name.indexOf("Z")===-1||this.showZ),ar.visible=ar.visible&&(ar.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),ar.material._color=ar.material._color||ar.material.color.clone(),ar.material._opacity=ar.material._opacity||ar.material.opacity,ar.material.color.copy(ar.material._color),ar.material.opacity=ar.material._opacity,this.enabled&&this.axis&&(ar.name===this.axis||this.axis.split("").some(function(lr){return ar.name===lr}))&&(ar.material.color.setHex(16776960),ar.material.opacity=1)}super.updateMatrixWorld(er)}}class TransformControlsPlane extends Mesh{constructor(){super(new PlaneGeometry(1e5,1e5,2,2),new MeshBasicMaterial({visible:!1,wireframe:!0,side:DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(er){let tr=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(tr="local"),_v1$5.copy(_unitX).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_v2$3.copy(_unitY).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_v3.copy(_unitZ).applyQuaternion(tr==="local"?this.worldQuaternion:_identityQuaternion),_alignVector.copy(_v2$3),this.mode){case"translate":case"scale":switch(this.axis){case"X":_alignVector.copy(this.eye).cross(_v1$5),_dirVector.copy(_v1$5).cross(_alignVector);break;case"Y":_alignVector.copy(this.eye).cross(_v2$3),_dirVector.copy(_v2$3).cross(_alignVector);break;case"Z":_alignVector.copy(this.eye).cross(_v3),_dirVector.copy(_v3).cross(_alignVector);break;case"XY":_dirVector.copy(_v3);break;case"YZ":_dirVector.copy(_v1$5);break;case"XZ":_alignVector.copy(_v3),_dirVector.copy(_v2$3);break;case"XYZ":case"E":_dirVector.set(0,0,0);break}break;case"rotate":default:_dirVector.set(0,0,0)}_dirVector.length()===0?this.quaternion.copy(this.cameraQuaternion):(_tempMatrix.lookAt(_tempVector.set(0,0,0),_dirVector,_alignVector),this.quaternion.setFromRotationMatrix(_tempMatrix)),super.updateMatrixWorld(er)}}const inverseProjectionMatrix=new Matrix4;class CSMFrustum{constructor(er){er=er||{},this.zNear=er.webGL===!0?-1:0,this.vertices={near:[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1],far:[new Vector3$1,new Vector3$1,new Vector3$1,new Vector3$1]},er.projectionMatrix!==void 0&&this.setFromProjectionMatrix(er.projectionMatrix,er.maxFar||1e4)}setFromProjectionMatrix(er,tr){const ir=this.zNear,nr=er.elements[2*4+3]===0;return inverseProjectionMatrix.copy(er).invert(),this.vertices.near[0].set(1,1,ir),this.vertices.near[1].set(1,-1,ir),this.vertices.near[2].set(-1,-1,ir),this.vertices.near[3].set(-1,1,ir),this.vertices.near.forEach(function(sr){sr.applyMatrix4(inverseProjectionMatrix)}),this.vertices.far[0].set(1,1,1),this.vertices.far[1].set(1,-1,1),this.vertices.far[2].set(-1,-1,1),this.vertices.far[3].set(-1,1,1),this.vertices.far.forEach(function(sr){sr.applyMatrix4(inverseProjectionMatrix);const ar=Math.abs(sr.z);nr?sr.z*=Math.min(tr/ar,1):sr.multiplyScalar(Math.min(tr/ar,1))}),this.vertices}split(er,tr){for(;er.length>tr.length;)tr.push(new CSMFrustum);tr.length=er.length;for(let ir=0;ir<er.length;ir++){const nr=tr[ir];if(ir===0)for(let sr=0;sr<4;sr++)nr.vertices.near[sr].copy(this.vertices.near[sr]);else for(let sr=0;sr<4;sr++)nr.vertices.near[sr].lerpVectors(this.vertices.near[sr],this.vertices.far[sr],er[ir-1]);if(ir===er.length-1)for(let sr=0;sr<4;sr++)nr.vertices.far[sr].copy(this.vertices.far[sr]);else for(let sr=0;sr<4;sr++)nr.vertices.far[sr].lerpVectors(this.vertices.near[sr],this.vertices.far[sr],er[ir])}}toSpace(er,tr){for(let ir=0;ir<4;ir++)tr.vertices.near[ir].copy(this.vertices.near[ir]).applyMatrix4(er),tr.vertices.far[ir].copy(this.vertices.far[ir]).applyMatrix4(er)}}const CSMShader={lights_fragment_begin:`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

vec3 geometryClearcoatNormal = vec3( 0.0 );

#ifdef USE_CLEARCOAT

	geometryClearcoatNormal = clearcoatNormal;

#endif

#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		// Iridescence F0 approximation
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif

IncidentLight directLight;

#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

		pointLight = pointLights[ i ];

		getPointLightInfo( pointLight, geometryPosition, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

	SpotLight spotLight;
 	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;

	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

		spotLight = spotLights[ i ];

		getSpotLightInfo( spotLight, geometryPosition, directLight );

  		// spot lights are ordered [shadows with maps, shadows without maps, maps without shadows, none]
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;

		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && defined( USE_CSM ) && defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	float linearDepth = (vViewPosition.z) / (shadowFar - cameraNear);
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#if defined( USE_SHADOWMAP ) && defined( CSM_FADE )
		vec2 cascade;
		float cascadeCenter;
		float closestEdge;
		float margin;
		float csmx;
		float csmy;

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
				// NOTE: Depth gets larger away from the camera.
				// cascade.x is closer, cascade.y is further
				cascade = CSM_cascades[ i ];
				cascadeCenter = ( cascade.x + cascade.y ) / 2.0;
				closestEdge = linearDepth < cascadeCenter ? cascade.x : cascade.y;
				margin = 0.25 * pow( closestEdge, 2.0 );
				csmx = cascade.x - margin / 2.0;
				csmy = cascade.y + margin / 2.0;
				if( linearDepth >= csmx && ( linearDepth < csmy || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 ) ) {

					float dist = min( linearDepth - csmx, csmy - linearDepth );
					float ratio = clamp( dist / margin, 0.0, 1.0 );

					vec3 prevColor = directLight.color;
					directionalLightShadow = directionalLightShadows[ i ];
					directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

					bool shouldFadeLastCascade = UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth > cascadeCenter;
					directLight.color = mix( prevColor, directLight.color, shouldFadeLastCascade ? ratio : 1.0 );

					ReflectedLight prevLight = reflectedLight;
					RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

					bool shouldBlend = UNROLLED_LOOP_INDEX != CSM_CASCADES - 1 || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1 && linearDepth < cascadeCenter;
					float blendRatio = shouldBlend ? ratio : 1.0;

					reflectedLight.directDiffuse = mix( prevLight.directDiffuse, reflectedLight.directDiffuse, blendRatio );
					reflectedLight.directSpecular = mix( prevLight.directSpecular, reflectedLight.directSpecular, blendRatio );
					reflectedLight.indirectDiffuse = mix( prevLight.indirectDiffuse, reflectedLight.indirectDiffuse, blendRatio );
					reflectedLight.indirectSpecular = mix( prevLight.indirectSpecular, reflectedLight.indirectSpecular, blendRatio );

				}
			#endif

		}
		#pragma unroll_loop_end
	#elif defined (USE_SHADOWMAP)

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];
			getDirectionalLightInfo( directionalLight, directLight );

			#if ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )

				directionalLightShadow = directionalLightShadows[ i ];
				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y) directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;

				if(linearDepth >= CSM_cascades[UNROLLED_LOOP_INDEX].x && (linearDepth < CSM_cascades[UNROLLED_LOOP_INDEX].y || UNROLLED_LOOP_INDEX == CSM_CASCADES - 1)) RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

			#endif

		}
		#pragma unroll_loop_end

	#elif ( NUM_DIR_LIGHT_SHADOWS > 0 )
		// note: no loop here - all CSM lights are in fact one light only
		getDirectionalLightInfo( directionalLights[0], directLight );
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	#endif

	#if ( NUM_DIR_LIGHTS > NUM_DIR_LIGHT_SHADOWS)
		// compute the lights not casting shadows (if any)

		#pragma unroll_loop_start
		for ( int i = NUM_DIR_LIGHT_SHADOWS; i < NUM_DIR_LIGHTS; i ++ ) {

			directionalLight = directionalLights[ i ];

			getDirectionalLightInfo( directionalLight, directLight );

			RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

		}
		#pragma unroll_loop_end

	#endif

#endif


#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct ) && !defined( USE_CSM ) && !defined( CSM_CASCADES )

	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

		directionalLight = directionalLights[ i ];

		getDirectionalLightInfo( directionalLight, directLight );

		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif

		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

	RectAreaLight rectAreaLight;

	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );

	}
	#pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )

	vec3 iblIrradiance = vec3( 0.0 );

	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

	#if defined( USE_LIGHT_PROBES )

		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );

	#endif

	#if ( NUM_HEMI_LIGHTS > 0 )

		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

		}
		#pragma unroll_loop_end

	#endif

#endif

#if defined( RE_IndirectSpecular )

	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );

#endif
`,lights_pars_begin:`
#if defined( USE_CSM ) && defined( CSM_CASCADES )
uniform vec2 CSM_cascades[CSM_CASCADES];
uniform float cameraNear;
uniform float shadowFar;
#endif
	`+ShaderChunk.lights_pars_begin},_cameraToLightMatrix=new Matrix4,_lightSpaceFrustum=new CSMFrustum({webGL:!0}),_center$1=new Vector3$1,_bbox=new Box3,_uniformArray=[],_logArray=[],_lightOrientationMatrix=new Matrix4,_lightOrientationMatrixInverse=new Matrix4,_up=new Vector3$1(0,1,0);class CSM{constructor(er){this.camera=er.camera,this.parent=er.parent,this.cascades=er.cascades||3,this.maxFar=er.maxFar||1e5,this.mode=er.mode||"practical",this.shadowMapSize=er.shadowMapSize||2048,this.shadowBias=er.shadowBias||1e-6,this.lightDirection=er.lightDirection||new Vector3$1(1,-1,1).normalize(),this.lightIntensity=er.lightIntensity||3,this.lightNear=er.lightNear||1,this.lightFar=er.lightFar||2e3,this.lightMargin=er.lightMargin||200,this.customSplitsCallback=er.customSplitsCallback,this.fade=!1,this.mainFrustum=new CSMFrustum({webGL:!0}),this.frustums=[],this.breaks=[],this.lights=[],this.shaders=new Map,this.createLights(),this.updateFrustums(),this.injectInclude()}createLights(){for(let er=0;er<this.cascades;er++){const tr=new DirectionalLight(16777215,this.lightIntensity);tr.castShadow=!0,tr.shadow.mapSize.width=this.shadowMapSize,tr.shadow.mapSize.height=this.shadowMapSize,tr.shadow.camera.near=this.lightNear,tr.shadow.camera.far=this.lightFar,tr.shadow.bias=this.shadowBias,this.parent.add(tr),this.parent.add(tr.target),this.lights.push(tr)}}initCascades(){const er=this.camera;er.updateProjectionMatrix(),this.mainFrustum.setFromProjectionMatrix(er.projectionMatrix,this.maxFar),this.mainFrustum.split(this.breaks,this.frustums)}updateShadowBounds(){const er=this.frustums;for(let tr=0;tr<er.length;tr++){const nr=this.lights[tr].shadow.camera,sr=this.frustums[tr],ar=sr.vertices.near,or=sr.vertices.far,lr=or[0];let cr;lr.distanceTo(or[2])>lr.distanceTo(ar[2])?cr=or[2]:cr=ar[2];let ur=lr.distanceTo(cr);if(this.fade){const dr=this.camera,hr=Math.max(dr.far,this.maxFar),pr=sr.vertices.far[0].z/(hr-dr.near),gr=.25*Math.pow(pr,2)*(hr-dr.near);ur+=gr}nr.left=-ur/2,nr.right=ur/2,nr.top=ur/2,nr.bottom=-ur/2,nr.updateProjectionMatrix()}}getBreaks(){const er=this.camera,tr=Math.min(er.far,this.maxFar);switch(this.breaks.length=0,this.mode){case"uniform":ir(this.cascades,er.near,tr,this.breaks);break;case"logarithmic":nr(this.cascades,er.near,tr,this.breaks);break;case"practical":sr(this.cascades,er.near,tr,.5,this.breaks);break;case"custom":this.customSplitsCallback===void 0&&console.error("CSM: Custom split scheme callback not defined."),this.customSplitsCallback(this.cascades,er.near,tr,this.breaks);break}function ir(ar,or,lr,cr){for(let ur=1;ur<ar;ur++)cr.push((or+(lr-or)*ur/ar)/lr);cr.push(1)}function nr(ar,or,lr,cr){for(let ur=1;ur<ar;ur++)cr.push(or*(lr/or)**(ur/ar)/lr);cr.push(1)}function sr(ar,or,lr,cr,ur){_uniformArray.length=0,_logArray.length=0,nr(ar,or,lr,_logArray),ir(ar,or,lr,_uniformArray);for(let dr=1;dr<ar;dr++)ur.push(MathUtils.lerp(_uniformArray[dr-1],_logArray[dr-1],cr));ur.push(1)}}update(){const er=this.camera,tr=this.frustums;_lightOrientationMatrix.lookAt(new Vector3$1,this.lightDirection,_up),_lightOrientationMatrixInverse.copy(_lightOrientationMatrix).invert();for(let ir=0;ir<tr.length;ir++){const nr=this.lights[ir],sr=nr.shadow.camera,ar=(sr.right-sr.left)/this.shadowMapSize,or=(sr.top-sr.bottom)/this.shadowMapSize;_cameraToLightMatrix.multiplyMatrices(_lightOrientationMatrixInverse,er.matrixWorld),tr[ir].toSpace(_cameraToLightMatrix,_lightSpaceFrustum);const lr=_lightSpaceFrustum.vertices.near,cr=_lightSpaceFrustum.vertices.far;_bbox.makeEmpty();for(let ur=0;ur<4;ur++)_bbox.expandByPoint(lr[ur]),_bbox.expandByPoint(cr[ur]);_bbox.getCenter(_center$1),_center$1.z=_bbox.max.z+this.lightMargin,_center$1.x=Math.floor(_center$1.x/ar)*ar,_center$1.y=Math.floor(_center$1.y/or)*or,_center$1.applyMatrix4(_lightOrientationMatrix),nr.position.copy(_center$1),nr.target.position.copy(_center$1),nr.target.position.x+=this.lightDirection.x,nr.target.position.y+=this.lightDirection.y,nr.target.position.z+=this.lightDirection.z}}injectInclude(){ShaderChunk.lights_fragment_begin=CSMShader.lights_fragment_begin,ShaderChunk.lights_pars_begin=CSMShader.lights_pars_begin}setupMaterial(er){er.defines=er.defines||{},er.defines.USE_CSM=1,er.defines.CSM_CASCADES=this.cascades,this.fade&&(er.defines.CSM_FADE="");const tr=[],ir=this,nr=this.shaders;er.onBeforeCompile=function(sr){const ar=Math.min(ir.camera.far,ir.maxFar);ir.getExtendedBreaks(tr),sr.uniforms.CSM_cascades={value:tr},sr.uniforms.cameraNear={value:ir.camera.near},sr.uniforms.shadowFar={value:ar},nr.set(er,sr)},nr.set(er,null)}updateUniforms(){const er=Math.min(this.camera.far,this.maxFar);this.shaders.forEach(function(ir,nr){if(ir!==null){const sr=ir.uniforms;this.getExtendedBreaks(sr.CSM_cascades.value),sr.cameraNear.value=this.camera.near,sr.shadowFar.value=er}!this.fade&&"CSM_FADE"in nr.defines?(delete nr.defines.CSM_FADE,nr.needsUpdate=!0):this.fade&&!("CSM_FADE"in nr.defines)&&(nr.defines.CSM_FADE="",nr.needsUpdate=!0)},this)}getExtendedBreaks(er){for(;er.length<this.breaks.length;)er.push(new Vector2);er.length=this.breaks.length;for(let tr=0;tr<this.cascades;tr++){const ir=this.breaks[tr],nr=this.breaks[tr-1]||0;er[tr].x=nr,er[tr].y=ir}}updateFrustums(){this.getBreaks(),this.initCascades(),this.updateShadowBounds(),this.updateUniforms()}remove(){for(let er=0;er<this.lights.length;er++)this.parent.remove(this.lights[er].target),this.parent.remove(this.lights[er])}dispose(){const er=this.shaders;er.forEach(function(tr,ir){delete ir.onBeforeCompile,delete ir.defines.USE_CSM,delete ir.defines.CSM_CASCADES,delete ir.defines.CSM_FADE,tr!==null&&(delete tr.uniforms.CSM_cascades,delete tr.uniforms.cameraNear,delete tr.uniforms.shadowFar),ir.needsUpdate=!0}),er.clear()}}class CSMHelper extends Group{constructor(er){super(),this.csm=er,this.displayFrustum=!0,this.displayPlanes=!0,this.displayShadowBounds=!0;const tr=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),ir=new Float32Array(24),nr=new BufferGeometry;nr.setIndex(new BufferAttribute(tr,1)),nr.setAttribute("position",new BufferAttribute(ir,3,!1));const sr=new LineSegments(nr,new LineBasicMaterial);this.add(sr),this.frustumLines=sr,this.cascadeLines=[],this.cascadePlanes=[],this.shadowLines=[]}updateVisibility(){const er=this.displayFrustum,tr=this.displayPlanes,ir=this.displayShadowBounds,nr=this.frustumLines,sr=this.cascadeLines,ar=this.cascadePlanes,or=this.shadowLines;for(let lr=0,cr=sr.length;lr<cr;lr++){const ur=sr[lr],dr=ar[lr],hr=or[lr];ur.visible=er,dr.visible=er&&tr,hr.visible=ir}nr.visible=er}update(){const er=this.csm,tr=er.camera,ir=er.cascades,nr=er.mainFrustum,sr=er.frustums,ar=er.lights,lr=this.frustumLines.geometry.getAttribute("position"),cr=this.cascadeLines,ur=this.cascadePlanes,dr=this.shadowLines;if(tr===null)return;for(this.position.copy(tr.position),this.quaternion.copy(tr.quaternion),this.scale.copy(tr.scale),this.updateMatrixWorld(!0);cr.length>ir;)this.remove(cr.pop()),this.remove(ur.pop()),this.remove(dr.pop());for(;cr.length<ir;){const gr=new Box3Helper(new Box3,16777215),vr=new MeshBasicMaterial({transparent:!0,opacity:.1,depthWrite:!1,side:DoubleSide}),mr=new Mesh(new PlaneGeometry,vr),fr=new Group,_r=new Box3Helper(new Box3,16776960);fr.add(_r),this.add(gr),this.add(mr),this.add(fr),cr.push(gr),ur.push(mr),dr.push(fr)}for(let gr=0;gr<ir;gr++){const vr=sr[gr],fr=ar[gr].shadow.camera,_r=vr.vertices.far,Ar=cr[gr],yr=ur[gr],wr=dr[gr],xr=wr.children[0];Ar.box.min.copy(_r[2]),Ar.box.max.copy(_r[0]),Ar.box.max.z+=1e-4,yr.position.addVectors(_r[0],_r[2]),yr.position.multiplyScalar(.5),yr.scale.subVectors(_r[0],_r[2]),yr.scale.z=1e-4,this.remove(wr),wr.position.copy(fr.position),wr.quaternion.copy(fr.quaternion),wr.scale.copy(fr.scale),wr.updateMatrixWorld(!0),this.attach(wr),xr.box.min.set(fr.bottom,fr.left,-fr.far),xr.box.max.set(fr.top,fr.right,-fr.near)}const hr=nr.vertices.near,pr=nr.vertices.far;lr.setXYZ(0,pr[0].x,pr[0].y,pr[0].z),lr.setXYZ(1,pr[3].x,pr[3].y,pr[3].z),lr.setXYZ(2,pr[2].x,pr[2].y,pr[2].z),lr.setXYZ(3,pr[1].x,pr[1].y,pr[1].z),lr.setXYZ(4,hr[0].x,hr[0].y,hr[0].z),lr.setXYZ(5,hr[3].x,hr[3].y,hr[3].z),lr.setXYZ(6,hr[2].x,hr[2].y,hr[2].z),lr.setXYZ(7,hr[1].x,hr[1].y,hr[1].z),lr.needsUpdate=!0}dispose(){const er=this.frustumLines,tr=this.cascadeLines,ir=this.cascadePlanes,nr=this.shadowLines;er.geometry.dispose(),er.material.dispose();const sr=this.csm.cascades;for(let ar=0;ar<sr;ar++){const or=tr[ar],lr=ir[ar],ur=nr[ar].children[0];or.dispose(),lr.geometry.dispose(),lr.material.dispose(),ur.dispose()}}}class GrannyKnot extends Curve{getPoint(er,tr=new Vector3$1){const ir=tr;er=2*Math.PI*er;const nr=-.22*Math.cos(er)-1.28*Math.sin(er)-.44*Math.cos(3*er)-.78*Math.sin(3*er),sr=-.1*Math.cos(2*er)-.27*Math.sin(2*er)+.38*Math.cos(4*er)+.46*Math.sin(4*er),ar=.7*Math.cos(3*er)-.4*Math.sin(3*er);return ir.set(nr,sr,ar).multiplyScalar(20)}}class HeartCurve extends Curve{constructor(er=5){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er*=2*Math.PI;const nr=16*Math.pow(Math.sin(er),3),sr=13*Math.cos(er)-5*Math.cos(2*er)-2*Math.cos(3*er)-Math.cos(4*er);return ir.set(nr,sr,0).multiplyScalar(this.scale)}}class VivianiCurve extends Curve{constructor(er=70){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er=er*4*Math.PI;const nr=this.scale/2,sr=nr*(1+Math.cos(er)),ar=nr*Math.sin(er),or=2*nr*Math.sin(er/2);return ir.set(sr,ar,or)}}class KnotCurve extends Curve{getPoint(er,tr=new Vector3$1){const ir=tr;er*=2*Math.PI;const nr=10,sr=50,ar=sr*Math.sin(er),or=Math.cos(er)*(nr+sr*Math.cos(er)),lr=Math.sin(er)*(nr+sr*Math.cos(er));return ir.set(ar,or,lr)}}class HelixCurve extends Curve{getPoint(er,tr=new Vector3$1){const ir=tr,nr=30,sr=150,ar=2*Math.PI*er*sr/30,or=Math.cos(ar)*nr,lr=Math.sin(ar)*nr,cr=sr*er;return ir.set(or,lr,cr)}}class TrefoilKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er*=Math.PI*2;const nr=(2+Math.cos(3*er))*Math.cos(2*er),sr=(2+Math.cos(3*er))*Math.sin(2*er),ar=Math.sin(3*er);return ir.set(nr,sr,ar).multiplyScalar(this.scale)}}class TorusKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr,nr=3,sr=4;er*=Math.PI*2;const ar=(2+Math.cos(sr*er))*Math.cos(nr*er),or=(2+Math.cos(sr*er))*Math.sin(nr*er),lr=Math.sin(sr*er);return ir.set(ar,or,lr).multiplyScalar(this.scale)}}class CinquefoilKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr,nr=2,sr=5;er*=Math.PI*2;const ar=(2+Math.cos(sr*er))*Math.cos(nr*er),or=(2+Math.cos(sr*er))*Math.sin(nr*er),lr=Math.sin(sr*er);return ir.set(ar,or,lr).multiplyScalar(this.scale)}}class TrefoilPolynomialKnot extends Curve{constructor(er=10){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er=er*4-2;const nr=Math.pow(er,3)-3*er,sr=Math.pow(er,4)-4*er*er,ar=1/5*Math.pow(er,5)-2*er;return ir.set(nr,sr,ar).multiplyScalar(this.scale)}}function scaleTo(rr,er,tr){const ir=er-rr;return tr*ir+rr}class FigureEightPolynomialKnot extends Curve{constructor(er=1){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er=scaleTo(-4,4,er);const nr=2/5*er*(er*er-7)*(er*er-10),sr=Math.pow(er,4)-13*er*er,ar=1/10*er*(er*er-4)*(er*er-9)*(er*er-12);return ir.set(nr,sr,ar).multiplyScalar(this.scale)}}class DecoratedTorusKnot4a extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr;er*=Math.PI*2;const nr=Math.cos(2*er)*(1+.6*(Math.cos(5*er)+.75*Math.cos(10*er))),sr=Math.sin(2*er)*(1+.6*(Math.cos(5*er)+.75*Math.cos(10*er))),ar=.35*Math.sin(5*er);return ir.set(nr,sr,ar).multiplyScalar(this.scale)}}class DecoratedTorusKnot4b extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr,nr=er*Math.PI*2,sr=Math.cos(2*nr)*(1+.45*Math.cos(3*nr)+.4*Math.cos(9*nr)),ar=Math.sin(2*nr)*(1+.45*Math.cos(3*nr)+.4*Math.cos(9*nr)),or=.2*Math.sin(9*nr);return ir.set(sr,ar,or).multiplyScalar(this.scale)}}class DecoratedTorusKnot5a extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr,nr=er*Math.PI*2,sr=Math.cos(3*nr)*(1+.3*Math.cos(5*nr)+.5*Math.cos(10*nr)),ar=Math.sin(3*nr)*(1+.3*Math.cos(5*nr)+.5*Math.cos(10*nr)),or=.2*Math.sin(20*nr);return ir.set(sr,ar,or).multiplyScalar(this.scale)}}class DecoratedTorusKnot5c extends Curve{constructor(er=40){super(),this.scale=er}getPoint(er,tr=new Vector3$1){const ir=tr,nr=er*Math.PI*2,sr=Math.cos(4*nr)*(1+.5*(Math.cos(5*nr)+.4*Math.cos(20*nr))),ar=Math.sin(4*nr)*(1+.5*(Math.cos(5*nr)+.4*Math.cos(20*nr))),or=.35*Math.sin(15*nr);return ir.set(sr,ar,or).multiplyScalar(this.scale)}}const CurveExtras=Object.freeze(Object.defineProperty({__proto__:null,CinquefoilKnot,DecoratedTorusKnot4a,DecoratedTorusKnot4b,DecoratedTorusKnot5a,DecoratedTorusKnot5c,FigureEightPolynomialKnot,GrannyKnot,HeartCurve,HelixCurve,KnotCurve,TorusKnot,TrefoilKnot,TrefoilPolynomialKnot,VivianiCurve},Symbol.toStringTag,{value:"Module"}));function findSpan(rr,er,tr){const ir=tr.length-rr-1;if(er>=tr[ir])return ir-1;if(er<=tr[rr])return rr;let nr=rr,sr=ir,ar=Math.floor((nr+sr)/2);for(;er<tr[ar]||er>=tr[ar+1];)er<tr[ar]?sr=ar:nr=ar,ar=Math.floor((nr+sr)/2);return ar}function calcBasisFunctions(rr,er,tr,ir){const nr=[],sr=[],ar=[];nr[0]=1;for(let or=1;or<=tr;++or){sr[or]=er-ir[rr+1-or],ar[or]=ir[rr+or]-er;let lr=0;for(let cr=0;cr<or;++cr){const ur=ar[cr+1],dr=sr[or-cr],hr=nr[cr]/(ur+dr);nr[cr]=lr+ur*hr,lr=dr*hr}nr[or]=lr}return nr}function calcBSplinePoint(rr,er,tr,ir){const nr=findSpan(rr,ir,er),sr=calcBasisFunctions(nr,ir,rr,er),ar=new Vector4(0,0,0,0);for(let or=0;or<=rr;++or){const lr=tr[nr-rr+or],cr=sr[or],ur=lr.w*cr;ar.x+=lr.x*ur,ar.y+=lr.y*ur,ar.z+=lr.z*ur,ar.w+=lr.w*cr}return ar}function calcBasisFunctionDerivatives(rr,er,tr,ir,nr){const sr=[];for(let dr=0;dr<=tr;++dr)sr[dr]=0;const ar=[];for(let dr=0;dr<=ir;++dr)ar[dr]=sr.slice(0);const or=[];for(let dr=0;dr<=tr;++dr)or[dr]=sr.slice(0);or[0][0]=1;const lr=sr.slice(0),cr=sr.slice(0);for(let dr=1;dr<=tr;++dr){lr[dr]=er-nr[rr+1-dr],cr[dr]=nr[rr+dr]-er;let hr=0;for(let pr=0;pr<dr;++pr){const gr=cr[pr+1],vr=lr[dr-pr];or[dr][pr]=gr+vr;const mr=or[pr][dr-1]/or[dr][pr];or[pr][dr]=hr+gr*mr,hr=vr*mr}or[dr][dr]=hr}for(let dr=0;dr<=tr;++dr)ar[0][dr]=or[dr][tr];for(let dr=0;dr<=tr;++dr){let hr=0,pr=1;const gr=[];for(let vr=0;vr<=tr;++vr)gr[vr]=sr.slice(0);gr[0][0]=1;for(let vr=1;vr<=ir;++vr){let mr=0;const fr=dr-vr,_r=tr-vr;dr>=vr&&(gr[pr][0]=gr[hr][0]/or[_r+1][fr],mr=gr[pr][0]*or[fr][_r]);const Ar=fr>=-1?1:-fr,yr=dr-1<=_r?vr-1:tr-dr;for(let xr=Ar;xr<=yr;++xr)gr[pr][xr]=(gr[hr][xr]-gr[hr][xr-1])/or[_r+1][fr+xr],mr+=gr[pr][xr]*or[fr+xr][_r];dr<=_r&&(gr[pr][vr]=-gr[hr][vr-1]/or[_r+1][dr],mr+=gr[pr][vr]*or[dr][_r]),ar[vr][dr]=mr;const wr=hr;hr=pr,pr=wr}}let ur=tr;for(let dr=1;dr<=ir;++dr){for(let hr=0;hr<=tr;++hr)ar[dr][hr]*=ur;ur*=tr-dr}return ar}function calcBSplineDerivatives(rr,er,tr,ir,nr){const sr=nr<rr?nr:rr,ar=[],or=findSpan(rr,ir,er),lr=calcBasisFunctionDerivatives(or,ir,rr,sr,er),cr=[];for(let ur=0;ur<tr.length;++ur){const dr=tr[ur].clone(),hr=dr.w;dr.x*=hr,dr.y*=hr,dr.z*=hr,cr[ur]=dr}for(let ur=0;ur<=sr;++ur){const dr=cr[or-rr].clone().multiplyScalar(lr[ur][0]);for(let hr=1;hr<=rr;++hr)dr.add(cr[or-rr+hr].clone().multiplyScalar(lr[ur][hr]));ar[ur]=dr}for(let ur=sr+1;ur<=nr+1;++ur)ar[ur]=new Vector4(0,0,0);return ar}function calcKoverI(rr,er){let tr=1;for(let nr=2;nr<=rr;++nr)tr*=nr;let ir=1;for(let nr=2;nr<=er;++nr)ir*=nr;for(let nr=2;nr<=rr-er;++nr)ir*=nr;return tr/ir}function calcRationalCurveDerivatives(rr){const er=rr.length,tr=[],ir=[];for(let sr=0;sr<er;++sr){const ar=rr[sr];tr[sr]=new Vector3$1(ar.x,ar.y,ar.z),ir[sr]=ar.w}const nr=[];for(let sr=0;sr<er;++sr){const ar=tr[sr].clone();for(let or=1;or<=sr;++or)ar.sub(nr[sr-or].clone().multiplyScalar(calcKoverI(sr,or)*ir[or]));nr[sr]=ar.divideScalar(ir[0])}return nr}function calcNURBSDerivatives(rr,er,tr,ir,nr){const sr=calcBSplineDerivatives(rr,er,tr,ir,nr);return calcRationalCurveDerivatives(sr)}function calcSurfacePoint(rr,er,tr,ir,nr,sr,ar,or){const lr=findSpan(rr,sr,tr),cr=findSpan(er,ar,ir),ur=calcBasisFunctions(lr,sr,rr,tr),dr=calcBasisFunctions(cr,ar,er,ir),hr=[];for(let gr=0;gr<=er;++gr){hr[gr]=new Vector4(0,0,0,0);for(let vr=0;vr<=rr;++vr){const mr=nr[lr-rr+vr][cr-er+gr].clone(),fr=mr.w;mr.x*=fr,mr.y*=fr,mr.z*=fr,hr[gr].add(mr.multiplyScalar(ur[vr]))}}const pr=new Vector4(0,0,0,0);for(let gr=0;gr<=er;++gr)pr.add(hr[gr].multiplyScalar(dr[gr]));pr.divideScalar(pr.w),or.set(pr.x,pr.y,pr.z)}function calcVolumePoint(rr,er,tr,ir,nr,sr,ar,or,lr,cr,ur){const dr=findSpan(rr,or,ir),hr=findSpan(er,lr,nr),pr=findSpan(tr,cr,sr),gr=calcBasisFunctions(dr,or,rr,ir),vr=calcBasisFunctions(hr,lr,er,nr),mr=calcBasisFunctions(pr,cr,tr,sr),fr=[];for(let Ar=0;Ar<=tr;++Ar){fr[Ar]=[];for(let yr=0;yr<=er;++yr){fr[Ar][yr]=new Vector4(0,0,0,0);for(let wr=0;wr<=rr;++wr){const xr=ar[dr-rr+wr][hr-er+yr][pr-tr+Ar].clone(),Sr=xr.w;xr.x*=Sr,xr.y*=Sr,xr.z*=Sr,fr[Ar][yr].add(xr.multiplyScalar(gr[wr]))}}}const _r=new Vector4(0,0,0,0);for(let Ar=0;Ar<=tr;++Ar)for(let yr=0;yr<=er;++yr)_r.add(fr[Ar][yr].multiplyScalar(mr[Ar]).multiplyScalar(vr[yr]));_r.divideScalar(_r.w),ur.set(_r.x,_r.y,_r.z)}const NURBSUtils$1=Object.freeze(Object.defineProperty({__proto__:null,calcBSplineDerivatives,calcBSplinePoint,calcBasisFunctionDerivatives,calcBasisFunctions,calcKoverI,calcNURBSDerivatives,calcRationalCurveDerivatives,calcSurfacePoint,calcVolumePoint,findSpan},Symbol.toStringTag,{value:"Module"}));class NURBSCurve extends Curve{constructor(er,tr,ir,nr,sr){super();const ar=tr?tr.length-1:0,or=ir?ir.length:0;this.degree=er,this.knots=tr,this.controlPoints=[],this.startKnot=nr||0,this.endKnot=sr||ar;for(let lr=0;lr<or;++lr){const cr=ir[lr];this.controlPoints[lr]=new Vector4(cr.x,cr.y,cr.z,cr.w)}}getPoint(er,tr=new Vector3$1){const ir=tr,nr=this.knots[this.startKnot]+er*(this.knots[this.endKnot]-this.knots[this.startKnot]),sr=calcBSplinePoint(this.degree,this.knots,this.controlPoints,nr);return sr.w!==1&&sr.divideScalar(sr.w),ir.set(sr.x,sr.y,sr.z)}getTangent(er,tr=new Vector3$1){const ir=tr,nr=this.knots[0]+er*(this.knots[this.knots.length-1]-this.knots[0]),sr=calcNURBSDerivatives(this.degree,this.knots,this.controlPoints,nr,1);return ir.copy(sr[1]).normalize(),ir}toJSON(){const er=super.toJSON();return er.degree=this.degree,er.knots=[...this.knots],er.controlPoints=this.controlPoints.map(tr=>tr.toArray()),er.startKnot=this.startKnot,er.endKnot=this.endKnot,er}fromJSON(er){return super.fromJSON(er),this.degree=er.degree,this.knots=[...er.knots],this.controlPoints=er.controlPoints.map(tr=>new Vector4(tr[0],tr[1],tr[2],tr[3])),this.startKnot=er.startKnot,this.endKnot=er.endKnot,this}}class NURBSSurface{constructor(er,tr,ir,nr,sr){this.degree1=er,this.degree2=tr,this.knots1=ir,this.knots2=nr,this.controlPoints=[];const ar=ir.length-er-1,or=nr.length-tr-1;for(let lr=0;lr<ar;++lr){this.controlPoints[lr]=[];for(let cr=0;cr<or;++cr){const ur=sr[lr][cr];this.controlPoints[lr][cr]=new Vector4(ur.x,ur.y,ur.z,ur.w)}}}getPoint(er,tr,ir){const nr=this.knots1[0]+er*(this.knots1[this.knots1.length-1]-this.knots1[0]),sr=this.knots2[0]+tr*(this.knots2[this.knots2.length-1]-this.knots2[0]);calcSurfacePoint(this.degree1,this.degree2,this.knots1,this.knots2,this.controlPoints,nr,sr,ir)}}class NURBSVolume{constructor(er,tr,ir,nr,sr,ar,or){this.degree1=er,this.degree2=tr,this.degree3=ir,this.knots1=nr,this.knots2=sr,this.knots3=ar,this.controlPoints=[];const lr=nr.length-er-1,cr=sr.length-tr-1,ur=ar.length-ir-1;for(let dr=0;dr<lr;++dr){this.controlPoints[dr]=[];for(let hr=0;hr<cr;++hr){this.controlPoints[dr][hr]=[];for(let pr=0;pr<ur;++pr){const gr=or[dr][hr][pr];this.controlPoints[dr][hr][pr]=new Vector4(gr.x,gr.y,gr.z,gr.w)}}}}getPoint(er,tr,ir,nr){const sr=this.knots1[0]+er*(this.knots1[this.knots1.length-1]-this.knots1[0]),ar=this.knots2[0]+tr*(this.knots2[this.knots2.length-1]-this.knots2[0]),or=this.knots3[0]+ir*(this.knots3[this.knots3.length-1]-this.knots3[0]);calcVolumePoint(this.degree1,this.degree2,this.degree3,this.knots1,this.knots2,this.knots3,this.controlPoints,sr,ar,or,nr)}}let Pass$1=class{constructor(){this.isPass=!0,this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}};const _camera=new OrthographicCamera(-1,1,1,-1,0,1);class FullscreenTriangleGeometry extends BufferGeometry{constructor(){super(),this.setAttribute("position",new Float32BufferAttribute([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Float32BufferAttribute([0,2,0,0,2,0],2))}}const _geometry=new FullscreenTriangleGeometry;class FullScreenQuad{constructor(er){this._mesh=new Mesh(_geometry,er)}dispose(){this._mesh.geometry.dispose()}render(er){er.render(this._mesh,_camera)}get material(){return this._mesh.material}set material(er){this._mesh.material=er}}class AnaglyphEffect{constructor(er,tr=512,ir=512){this.colorMatrixLeft=new Matrix3().fromArray([.4561,-.0400822,-.0152161,.500484,-.0378246,-.0205971,.176381,-.0157589,-.00546856]),this.colorMatrixRight=new Matrix3().fromArray([-.0434706,.378476,-.0721527,-.0879388,.73364,-.112961,-.00155529,-.0184503,1.2264]);const nr=new StereoCamera,sr={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},ar=new WebGLRenderTarget(tr,ir,sr),or=new WebGLRenderTarget(tr,ir,sr),lr=new ShaderMaterial({uniforms:{mapLeft:{value:ar.texture},mapRight:{value:or.texture},colorMatrixLeft:{value:this.colorMatrixLeft},colorMatrixRight:{value:this.colorMatrixRight}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","uniform mat3 colorMatrixLeft;","uniform mat3 colorMatrixRight;","void main() {","	vec2 uv = vUv;","	vec4 colorL = texture2D( mapLeft, uv );","	vec4 colorR = texture2D( mapRight, uv );","	vec3 color = clamp(","			colorMatrixLeft * colorL.rgb +","			colorMatrixRight * colorR.rgb, 0., 1. );","	gl_FragColor = vec4(","			color.r, color.g, color.b,","			max( colorL.a, colorR.a ) );","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","}"].join(`
`)}),cr=new FullScreenQuad(lr);this.setSize=function(ur,dr){er.setSize(ur,dr);const hr=er.getPixelRatio();ar.setSize(ur*hr,dr*hr),or.setSize(ur*hr,dr*hr)},this.render=function(ur,dr){const hr=er.getRenderTarget();ur.matrixWorldAutoUpdate===!0&&ur.updateMatrixWorld(),dr.parent===null&&dr.matrixWorldAutoUpdate===!0&&dr.updateMatrixWorld(),nr.update(dr),er.setRenderTarget(ar),er.clear(),er.render(ur,nr.cameraL),er.setRenderTarget(or),er.clear(),er.render(ur,nr.cameraR),er.setRenderTarget(null),cr.render(er),er.setRenderTarget(hr)},this.dispose=function(){ar.dispose(),or.dispose(),lr.dispose(),cr.dispose()}}}class AsciiEffect{constructor(er,tr=" .:-=+*#%@",ir={}){const nr=ir.resolution||.15,sr=ir.scale||1,ar=ir.color||!1,or=ir.alpha||!1,lr=ir.block||!1,cr=ir.invert||!1,ur=ir.strResolution||"low";let dr,hr;const pr=document.createElement("div");pr.style.cursor="default";const gr=document.createElement("table");pr.appendChild(gr);let vr,mr,fr;this.setSize=function(Fr,Or){dr=Fr,hr=Or,er.setSize(Fr,Or),_r()},this.render=function(Fr,Or){er.render(Fr,Or),Dr(gr)},this.domElement=pr;function _r(){vr=Math.floor(dr*nr),mr=Math.floor(hr*nr),Sr.width=vr,Sr.height=mr,fr=er.domElement,fr.style.backgroundColor&&(gr.rows[0].cells[0].style.backgroundColor=fr.style.backgroundColor,gr.rows[0].cells[0].style.color=fr.style.color),gr.cellSpacing=0,gr.cellPadding=0;const Fr=gr.style;Fr.whiteSpace="pre",Fr.margin="0px",Fr.padding="0px",Fr.letterSpacing=Pr+"px",Fr.fontFamily=wr,Fr.fontSize=Ir+"px",Fr.lineHeight=Rr+"px",Fr.textAlign="left",Fr.textDecoration="none"}const Ar=" .,:;i1tfLCG08@".split(""),yr=" CGO08@".split(""),wr="courier new, monospace",xr=er.domElement,Sr=document.createElement("canvas");if(!Sr.getContext)return;const br=Sr.getContext("2d");if(!br.getImageData)return;let Cr=ar?yr:Ar;tr&&(Cr=tr);const Ir=2/nr*sr,Rr=2/nr*sr;let Pr=0;if(ur=="low")switch(sr){case 1:Pr=-1;break;case 2:case 3:Pr=-2.1;break;case 4:Pr=-3.1;break;case 5:Pr=-4.15;break}if(ur=="medium")switch(sr){case 1:Pr=0;break;case 2:Pr=-1;break;case 3:Pr=-1.04;break;case 4:case 5:Pr=-2.1;break}if(ur=="high")switch(sr){case 1:case 2:Pr=0;break;case 3:case 4:case 5:Pr=-1;break}function Dr(Fr){br.clearRect(0,0,vr,mr),br.drawImage(xr,0,0,vr,mr);const Or=br.getImageData(0,0,vr,mr).data;let Nr="";for(let Ur=0;Ur<mr;Ur+=2){for(let Br=0;Br<vr;Br++){const Wr=(Ur*vr+Br)*4,Xr=Or[Wr],Yr=Or[Wr+1],Qi=Or[Wr+2],Xi=Or[Wr+3];let Kr,$r;$r=(.3*Xr+.59*Yr+.11*Qi)/255,Xi==0&&($r=1),Kr=Math.floor((1-$r)*(Cr.length-1)),cr&&(Kr=Cr.length-Kr-1);let Vr=Cr[Kr];(Vr===void 0||Vr==" ")&&(Vr="&nbsp;"),ar?Nr+="<span style='color:rgb("+Xr+","+Yr+","+Qi+");"+(lr?"background-color:rgb("+Xr+","+Yr+","+Qi+");":"")+(or?"opacity:"+Xi/255+";":"")+"'>"+Vr+"</span>":Nr+=Vr}Nr+="<br/>"}Fr.innerHTML=`<tr><td style="display:block;width:${dr}px;height:${hr}px;overflow:hidden">${Nr}</td></tr>`}}}let OutlineEffect$1=class{constructor(er,tr={}){this.enabled=!0;const ir=tr.defaultThickness!==void 0?tr.defaultThickness:.003,nr=new Color().fromArray(tr.defaultColor!==void 0?tr.defaultColor:[0,0,0]),sr=tr.defaultAlpha!==void 0?tr.defaultAlpha:1,ar=tr.defaultKeepAlive!==void 0?tr.defaultKeepAlive:!1,or={},lr=60,cr={},ur={},dr={outlineThickness:{value:ir},outlineColor:{value:nr},outlineAlpha:{value:sr}},hr=["#include <common>","#include <uv_pars_vertex>","#include <displacementmap_pars_vertex>","#include <fog_pars_vertex>","#include <morphtarget_pars_vertex>","#include <skinning_pars_vertex>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","uniform float outlineThickness;","vec4 calculateOutline( vec4 pos, vec3 normal, vec4 skinned ) {","	float thickness = outlineThickness;","	const float ratio = 1.0;","	vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + normal, 1.0 );","	vec4 norm = normalize( pos - pos2 );","	return pos + norm * thickness * pos.w * ratio;","}","void main() {","	#include <uv_vertex>","	#include <beginnormal_vertex>","	#include <morphnormal_vertex>","	#include <skinbase_vertex>","	#include <skinnormal_vertex>","	#include <begin_vertex>","	#include <morphtarget_vertex>","	#include <skinning_vertex>","	#include <displacementmap_vertex>","	#include <project_vertex>","	vec3 outlineNormal = - objectNormal;","	gl_Position = calculateOutline( gl_Position, outlineNormal, vec4( transformed, 1.0 ) );","	#include <logdepthbuf_vertex>","	#include <clipping_planes_vertex>","	#include <fog_vertex>","}"].join(`
`),pr=["#include <common>","#include <fog_pars_fragment>","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","uniform vec3 outlineColor;","uniform float outlineAlpha;","void main() {","	#include <clipping_planes_fragment>","	#include <logdepthbuf_fragment>","	gl_FragColor = vec4( outlineColor, outlineAlpha );","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","	#include <fog_fragment>","	#include <premultiplied_alpha_fragment>","}"].join(`
`);function gr(){return new ShaderMaterial({type:"OutlineEffect",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.displacementmap,dr]),vertexShader:hr,fragmentShader:pr,side:BackSide})}function vr(br){let Cr=or[br.uuid];return Cr===void 0&&(Cr={material:gr(),used:!0,keepAlive:ar,count:0},or[br.uuid]=Cr),Cr.used=!0,Cr.material}function mr(br){const Cr=vr(br);return cr[Cr.uuid]=br,xr(Cr,br),Cr}function fr(br){const Cr=br.geometry,Ir=Cr!==void 0&&Cr.attributes.normal!==void 0;return br.isMesh===!0&&br.material!==void 0&&Ir===!0}function _r(br){if(fr(br)!==!1){if(Array.isArray(br.material))for(let Cr=0,Ir=br.material.length;Cr<Ir;Cr++)br.material[Cr]=mr(br.material[Cr]);else br.material=mr(br.material);ur[br.uuid]=br.onBeforeRender,br.onBeforeRender=yr}}function Ar(br){if(fr(br)!==!1){if(Array.isArray(br.material))for(let Cr=0,Ir=br.material.length;Cr<Ir;Cr++)br.material[Cr]=cr[br.material[Cr].uuid];else br.material=cr[br.material.uuid];br.onBeforeRender=ur[br.uuid]}}function yr(br,Cr,Ir,Rr,Pr){const Dr=cr[Pr.uuid];Dr!==void 0&&wr(Pr,Dr)}function wr(br,Cr){const Ir=Cr.userData.outlineParameters;br.uniforms.outlineAlpha.value=Cr.opacity,Ir!==void 0&&(Ir.thickness!==void 0&&(br.uniforms.outlineThickness.value=Ir.thickness),Ir.color!==void 0&&br.uniforms.outlineColor.value.fromArray(Ir.color),Ir.alpha!==void 0&&(br.uniforms.outlineAlpha.value=Ir.alpha)),Cr.displacementMap&&(br.uniforms.displacementMap.value=Cr.displacementMap,br.uniforms.displacementScale.value=Cr.displacementScale,br.uniforms.displacementBias.value=Cr.displacementBias)}function xr(br,Cr){if(br.name==="invisible")return;const Ir=Cr.userData.outlineParameters;br.fog=Cr.fog,br.toneMapped=Cr.toneMapped,br.premultipliedAlpha=Cr.premultipliedAlpha,br.displacementMap=Cr.displacementMap,Ir!==void 0?(Cr.visible===!1?br.visible=!1:br.visible=Ir.visible!==void 0?Ir.visible:!0,br.transparent=Ir.alpha!==void 0&&Ir.alpha<1?!0:Cr.transparent,Ir.keepAlive!==void 0&&(or[Cr.uuid].keepAlive=Ir.keepAlive)):(br.transparent=Cr.transparent,br.visible=Cr.visible),(Cr.wireframe===!0||Cr.depthTest===!1)&&(br.visible=!1),Cr.clippingPlanes&&(br.clipping=!0,br.clippingPlanes=Cr.clippingPlanes,br.clipIntersection=Cr.clipIntersection,br.clipShadows=Cr.clipShadows),br.version=Cr.version}function Sr(){let br;br=Object.keys(cr);for(let Cr=0,Ir=br.length;Cr<Ir;Cr++)cr[br[Cr]]=void 0;br=Object.keys(ur);for(let Cr=0,Ir=br.length;Cr<Ir;Cr++)ur[br[Cr]]=void 0;br=Object.keys(or);for(let Cr=0,Ir=br.length;Cr<Ir;Cr++){const Rr=br[Cr];or[Rr].used===!1?(or[Rr].count++,or[Rr].keepAlive===!1&&or[Rr].count>lr&&delete or[Rr]):(or[Rr].used=!1,or[Rr].count=0)}}this.render=function(br,Cr){if(this.enabled===!1){er.render(br,Cr);return}const Ir=er.autoClear;er.autoClear=this.autoClear,er.render(br,Cr),er.autoClear=Ir,this.renderOutline(br,Cr)},this.renderOutline=function(br,Cr){const Ir=er.autoClear,Rr=br.matrixWorldAutoUpdate,Pr=br.background,Dr=er.shadowMap.enabled;br.matrixWorldAutoUpdate=!1,br.background=null,er.autoClear=!1,er.shadowMap.enabled=!1,br.traverse(_r),er.render(br,Cr),br.traverse(Ar),Sr(),br.matrixWorldAutoUpdate=Rr,br.background=Pr,er.autoClear=Ir,er.shadowMap.enabled=Dr},this.autoClear=er.autoClear,this.domElement=er.domElement,this.shadowMap=er.shadowMap,this.clear=function(br,Cr,Ir){er.clear(br,Cr,Ir)},this.getPixelRatio=function(){return er.getPixelRatio()},this.setPixelRatio=function(br){er.setPixelRatio(br)},this.getSize=function(br){return er.getSize(br)},this.setSize=function(br,Cr,Ir){er.setSize(br,Cr,Ir)},this.setViewport=function(br,Cr,Ir,Rr){er.setViewport(br,Cr,Ir,Rr)},this.setScissor=function(br,Cr,Ir,Rr){er.setScissor(br,Cr,Ir,Rr)},this.setScissorTest=function(br){er.setScissorTest(br)},this.setRenderTarget=function(br){er.setRenderTarget(br)}}};class ParallaxBarrierEffect{constructor(er){const tr=new StereoCamera,ir={minFilter:LinearFilter,magFilter:NearestFilter,format:RGBAFormat},nr=new WebGLRenderTarget(512,512,ir),sr=new WebGLRenderTarget(512,512,ir),ar=new ShaderMaterial({uniforms:{mapLeft:{value:nr.texture},mapRight:{value:sr.texture}},vertexShader:["varying vec2 vUv;","void main() {","	vUv = vec2( uv.x, uv.y );","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["uniform sampler2D mapLeft;","uniform sampler2D mapRight;","varying vec2 vUv;","void main() {","	vec2 uv = vUv;","	if ( ( mod( gl_FragCoord.y, 2.0 ) ) > 1.00 ) {","		gl_FragColor = texture2D( mapLeft, uv );","	} else {","		gl_FragColor = texture2D( mapRight, uv );","	}","	#include <tonemapping_fragment>","	#include <colorspace_fragment>","}"].join(`
`)}),or=new FullScreenQuad(ar);this.setSize=function(lr,cr){er.setSize(lr,cr);const ur=er.getPixelRatio();nr.setSize(lr*ur,cr*ur),sr.setSize(lr*ur,cr*ur)},this.render=function(lr,cr){const ur=er.getRenderTarget();lr.matrixWorldAutoUpdate===!0&&lr.updateMatrixWorld(),cr.parent===null&&cr.matrixWorldAutoUpdate===!0&&cr.updateMatrixWorld(),tr.update(cr),er.setRenderTarget(nr),er.clear(),er.render(lr,tr.cameraL),er.setRenderTarget(sr),er.clear(),er.render(lr,tr.cameraR),er.setRenderTarget(null),or.render(er),er.setRenderTarget(ur)},this.dispose=function(){nr.dispose(),sr.dispose(),ar.dispose(),or.dispose()}}}class PeppersGhostEffect{constructor(er){const tr=this;tr.cameraDistance=15,tr.reflectFromAbove=!1;let ir,nr,sr;const ar=new PerspectiveCamera,or=new PerspectiveCamera,lr=new PerspectiveCamera,cr=new PerspectiveCamera,ur=new Vector3$1,dr=new Quaternion$1,hr=new Vector3$1;er.autoClear=!1,this.setSize=function(pr,gr){ir=pr/2,pr<gr?(nr=pr/3,sr=pr/3):(nr=gr/3,sr=gr/3),er.setSize(pr,gr)},this.render=function(pr,gr){pr.matrixWorldAutoUpdate===!0&&pr.updateMatrixWorld(),gr.parent===null&&gr.matrixWorldAutoUpdate===!0&&gr.updateMatrixWorld(),gr.matrixWorld.decompose(ur,dr,hr),ar.position.copy(ur),ar.quaternion.copy(dr),ar.translateZ(tr.cameraDistance),ar.lookAt(pr.position),or.position.copy(ur),or.quaternion.copy(dr),or.translateZ(-tr.cameraDistance),or.lookAt(pr.position),or.rotation.z+=180*(Math.PI/180),lr.position.copy(ur),lr.quaternion.copy(dr),lr.translateX(-tr.cameraDistance),lr.lookAt(pr.position),lr.rotation.x+=90*(Math.PI/180),cr.position.copy(ur),cr.quaternion.copy(dr),cr.translateX(tr.cameraDistance),cr.lookAt(pr.position),cr.rotation.x+=90*(Math.PI/180),er.clear(),er.setScissorTest(!0),er.setScissor(ir-nr/2,sr*2,nr,sr),er.setViewport(ir-nr/2,sr*2,nr,sr),tr.reflectFromAbove?er.render(pr,or):er.render(pr,ar),er.setScissor(ir-nr/2,0,nr,sr),er.setViewport(ir-nr/2,0,nr,sr),tr.reflectFromAbove?er.render(pr,ar):er.render(pr,or),er.setScissor(ir-nr/2-nr,sr,nr,sr),er.setViewport(ir-nr/2-nr,sr,nr,sr),tr.reflectFromAbove?er.render(pr,cr):er.render(pr,lr),er.setScissor(ir+nr/2,sr,nr,sr),er.setViewport(ir+nr/2,sr,nr,sr),tr.reflectFromAbove?er.render(pr,lr):er.render(pr,cr),er.setScissorTest(!1)}}}class StereoEffect{constructor(er){const tr=new StereoCamera;tr.aspect=.5;const ir=new Vector2;this.setEyeSeparation=function(nr){tr.eyeSep=nr},this.setSize=function(nr,sr){er.setSize(nr,sr)},this.render=function(nr,sr){nr.matrixWorldAutoUpdate===!0&&nr.updateMatrixWorld(),sr.parent===null&&sr.matrixWorldAutoUpdate===!0&&sr.updateMatrixWorld(),tr.update(sr);const ar=er.autoClear;er.getSize(ir),er.autoClear=!1,er.clear(),er.setScissorTest(!0),er.setScissor(0,0,ir.width/2,ir.height),er.setViewport(0,0,ir.width/2,ir.height),er.render(nr,tr.cameraL),er.setScissor(ir.width/2,0,ir.width/2,ir.height),er.setViewport(ir.width/2,0,ir.width/2,ir.height),er.render(nr,tr.cameraR),er.setScissorTest(!1),er.autoClear=ar}}}class DebugEnvironment extends Scene{constructor(){super();const er=new BoxGeometry;er.deleteAttribute("uv");const tr=new MeshStandardMaterial({metalness:0,side:BackSide}),ir=new Mesh(er,tr);ir.scale.setScalar(10),this.add(ir);const nr=new PointLight(16777215,50,0,2);this.add(nr);const sr=new MeshLambertMaterial({color:16711680,emissive:16777215,emissiveIntensity:10}),ar=new Mesh(er,sr);ar.position.set(-5,2,0),ar.scale.set(.1,1,1),this.add(ar);const or=new MeshLambertMaterial({color:65280,emissive:16777215,emissiveIntensity:10}),lr=new Mesh(er,or);lr.position.set(0,5,0),lr.scale.set(1,.1,1),this.add(lr);const cr=new MeshLambertMaterial({color:255,emissive:16777215,emissiveIntensity:10}),ur=new Mesh(er,cr);ur.position.set(2,1,5),ur.scale.set(1.5,2,.1),this.add(ur)}}class RoomEnvironment extends Scene{constructor(){super();const er=new BoxGeometry;er.deleteAttribute("uv");const tr=new MeshStandardMaterial({side:BackSide}),ir=new MeshStandardMaterial,nr=new PointLight(16777215,900,28,2);nr.position.set(.418,16.199,.3),this.add(nr);const sr=new Mesh(er,tr);sr.position.set(-.757,13.219,.717),sr.scale.set(31.713,28.305,28.591),this.add(sr);const ar=new Mesh(er,ir);ar.position.set(-10.906,2.009,1.846),ar.rotation.set(0,-.195,0),ar.scale.set(2.328,7.905,4.651),this.add(ar);const or=new Mesh(er,ir);or.position.set(-5.607,-.754,-.758),or.rotation.set(0,.994,0),or.scale.set(1.97,1.534,3.955),this.add(or);const lr=new Mesh(er,ir);lr.position.set(6.167,.857,7.803),lr.rotation.set(0,.561,0),lr.scale.set(3.927,6.285,3.687),this.add(lr);const cr=new Mesh(er,ir);cr.position.set(-2.017,.018,6.124),cr.rotation.set(0,.333,0),cr.scale.set(2.002,4.566,2.064),this.add(cr);const ur=new Mesh(er,ir);ur.position.set(2.291,-.756,-2.621),ur.rotation.set(0,-.286,0),ur.scale.set(1.546,1.552,1.496),this.add(ur);const dr=new Mesh(er,ir);dr.position.set(-2.193,-.369,-5.547),dr.rotation.set(0,.516,0),dr.scale.set(3.875,3.487,2.986),this.add(dr);const hr=new Mesh(er,createAreaLightMaterial(50));hr.position.set(-16.116,14.37,8.208),hr.scale.set(.1,2.428,2.739),this.add(hr);const pr=new Mesh(er,createAreaLightMaterial(50));pr.position.set(-16.109,18.021,-8.207),pr.scale.set(.1,2.425,2.751),this.add(pr);const gr=new Mesh(er,createAreaLightMaterial(17));gr.position.set(14.904,12.198,-1.832),gr.scale.set(.15,4.265,6.331),this.add(gr);const vr=new Mesh(er,createAreaLightMaterial(43));vr.position.set(-.462,8.89,14.52),vr.scale.set(4.38,5.441,.088),this.add(vr);const mr=new Mesh(er,createAreaLightMaterial(20));mr.position.set(3.235,11.486,-12.541),mr.scale.set(2.5,2,.1),this.add(mr);const fr=new Mesh(er,createAreaLightMaterial(100));fr.position.set(0,20,0),fr.scale.set(1,.1,1),this.add(fr)}dispose(){const er=new Set;this.traverse(tr=>{tr.isMesh&&(er.add(tr.geometry),er.add(tr.material))});for(const tr of er)tr.dispose()}}function createAreaLightMaterial(rr){const er=new MeshBasicMaterial;return er.color.setScalar(rr),er}class DRACOExporter{parse(er,tr={}){if(tr=Object.assign({decodeSpeed:5,encodeSpeed:5,encoderMethod:DRACOExporter.MESH_EDGEBREAKER_ENCODING,quantization:[16,8,8,8,8],exportUvs:!0,exportNormals:!0,exportColor:!1},tr),DracoEncoderModule===void 0)throw new Error("THREE.DRACOExporter: required the draco_encoder to work.");const ir=er.geometry,nr=DracoEncoderModule(),sr=new nr.Encoder;let ar,or;if(er.isMesh===!0){ar=new nr.MeshBuilder,or=new nr.Mesh;const pr=ir.getAttribute("position");ar.AddFloatAttributeToMesh(or,nr.POSITION,pr.count,pr.itemSize,pr.array);const gr=ir.getIndex();if(gr!==null)ar.AddFacesToMesh(or,gr.count/3,gr.array);else{const vr=new(pr.count>65535?Uint32Array:Uint16Array)(pr.count);for(let mr=0;mr<vr.length;mr++)vr[mr]=mr;ar.AddFacesToMesh(or,pr.count,vr)}if(tr.exportNormals===!0){const vr=ir.getAttribute("normal");vr!==void 0&&ar.AddFloatAttributeToMesh(or,nr.NORMAL,vr.count,vr.itemSize,vr.array)}if(tr.exportUvs===!0){const vr=ir.getAttribute("uv");vr!==void 0&&ar.AddFloatAttributeToMesh(or,nr.TEX_COORD,vr.count,vr.itemSize,vr.array)}if(tr.exportColor===!0){const vr=ir.getAttribute("color");if(vr!==void 0){const mr=createVertexColorSRGBArray(vr);ar.AddFloatAttributeToMesh(or,nr.COLOR,vr.count,vr.itemSize,mr)}}}else if(er.isPoints===!0){ar=new nr.PointCloudBuilder,or=new nr.PointCloud;const pr=ir.getAttribute("position");if(ar.AddFloatAttribute(or,nr.POSITION,pr.count,pr.itemSize,pr.array),tr.exportColor===!0){const gr=ir.getAttribute("color");if(gr!==void 0){const vr=createVertexColorSRGBArray(gr);ar.AddFloatAttribute(or,nr.COLOR,gr.count,gr.itemSize,vr)}}}else throw new Error("DRACOExporter: Unsupported object type.");const lr=new nr.DracoInt8Array,cr=tr.encodeSpeed!==void 0?tr.encodeSpeed:5,ur=tr.decodeSpeed!==void 0?tr.decodeSpeed:5;if(sr.SetSpeedOptions(cr,ur),tr.encoderMethod!==void 0&&sr.SetEncodingMethod(tr.encoderMethod),tr.quantization!==void 0)for(let pr=0;pr<5;pr++)tr.quantization[pr]!==void 0&&sr.SetAttributeQuantization(pr,tr.quantization[pr]);let dr;if(er.isMesh===!0?dr=sr.EncodeMeshToDracoBuffer(or,lr):dr=sr.EncodePointCloudToDracoBuffer(or,!0,lr),nr.destroy(or),dr===0)throw new Error("THREE.DRACOExporter: Draco encoding failed.");const hr=new Int8Array(new ArrayBuffer(dr));for(let pr=0;pr<dr;pr++)hr[pr]=lr.GetValue(pr);return nr.destroy(lr),nr.destroy(sr),nr.destroy(ar),hr}}function createVertexColorSRGBArray(rr){const er=new Color,tr=rr.count,ir=rr.itemSize,nr=new Float32Array(tr*ir);for(let sr=0,ar=tr;sr<ar;sr++)er.fromBufferAttribute(rr,sr),ColorManagement.fromWorkingColorSpace(er,SRGBColorSpace),nr[sr*ir]=er.r,nr[sr*ir+1]=er.g,nr[sr*ir+2]=er.b,ir===4&&(nr[sr*ir+3]=rr.getW(sr));return nr}DRACOExporter.MESH_EDGEBREAKER_ENCODING=1;DRACOExporter.MESH_SEQUENTIAL_ENCODING=0;DRACOExporter.POINT_CLOUD=0;DRACOExporter.TRIANGULAR_MESH=1;DRACOExporter.INVALID=-1;DRACOExporter.POSITION=0;DRACOExporter.NORMAL=1;DRACOExporter.COLOR=2;DRACOExporter.TEX_COORD=3;DRACOExporter.GENERIC=4;/*!
fflate - fast JavaScript compression/decompression
<https://101arrowz.github.io/fflate>
Licensed under MIT. https://github.com/101arrowz/fflate/blob/master/LICENSE
version 0.8.2
*/var ch2={},wk=function(rr,er,tr,ir,nr){var sr=new Worker(ch2[er]||(ch2[er]=URL.createObjectURL(new Blob([rr+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return sr.onmessage=function(ar){var or=ar.data,lr=or.$e$;if(lr){var cr=new Error(lr[0]);cr.code=lr[1],cr.stack=lr[2],nr(cr,null)}else nr(null,or)},sr.postMessage(tr,ir),sr},u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(rr,er){for(var tr=new u16(31),ir=0;ir<31;++ir)tr[ir]=er+=1<<rr[ir-1];for(var nr=new i32(tr[30]),ir=1;ir<30;++ir)for(var sr=tr[ir];sr<tr[ir+1];++sr)nr[sr]=sr-tr[ir]<<5|ir;return{b:tr,r:nr}},_a$1=freb(fleb,2),fl=_a$1.b,revfl=_a$1.r;fl[28]=258,revfl[258]=28;var _b$1=freb(fdeb,0),fd=_b$1.b,revfd=_b$1.r,rev=new u16(32768);for(var i$1=0;i$1<32768;++i$1){var x$1=(i$1&43690)>>1|(i$1&21845)<<1;x$1=(x$1&52428)>>2|(x$1&13107)<<2,x$1=(x$1&61680)>>4|(x$1&3855)<<4,rev[i$1]=((x$1&65280)>>8|(x$1&255)<<8)>>1}var hMap=function(rr,er,tr){for(var ir=rr.length,nr=0,sr=new u16(er);nr<ir;++nr)rr[nr]&&++sr[rr[nr]-1];var ar=new u16(er);for(nr=1;nr<er;++nr)ar[nr]=ar[nr-1]+sr[nr-1]<<1;var or;if(tr){or=new u16(1<<er);var lr=15-er;for(nr=0;nr<ir;++nr)if(rr[nr])for(var cr=nr<<4|rr[nr],ur=er-rr[nr],dr=ar[rr[nr]-1]++<<ur,hr=dr|(1<<ur)-1;dr<=hr;++dr)or[rev[dr]>>lr]=cr}else for(or=new u16(ir),nr=0;nr<ir;++nr)rr[nr]&&(or[nr]=rev[ar[rr[nr]-1]++]>>15-rr[nr]);return or},flt=new u8(288);for(var i$1=0;i$1<144;++i$1)flt[i$1]=8;for(var i$1=144;i$1<256;++i$1)flt[i$1]=9;for(var i$1=256;i$1<280;++i$1)flt[i$1]=7;for(var i$1=280;i$1<288;++i$1)flt[i$1]=8;var fdt=new u8(32);for(var i$1=0;i$1<32;++i$1)fdt[i$1]=5;var flm=hMap(flt,9,0),flrm=hMap(flt,9,1),fdm=hMap(fdt,5,0),fdrm=hMap(fdt,5,1),max=function(rr){for(var er=rr[0],tr=1;tr<rr.length;++tr)rr[tr]>er&&(er=rr[tr]);return er},bits=function(rr,er,tr){var ir=er/8|0;return(rr[ir]|rr[ir+1]<<8)>>(er&7)&tr},bits16=function(rr,er){var tr=er/8|0;return(rr[tr]|rr[tr+1]<<8|rr[tr+2]<<16)>>(er&7)},shft=function(rr){return(rr+7)/8|0},slc=function(rr,er,tr){return(er==null||er<0)&&(er=0),(tr==null||tr>rr.length)&&(tr=rr.length),new u8(rr.subarray(er,tr))},FlateErrorCode={UnexpectedEOF:0,InvalidBlockType:1,InvalidLengthLiteral:2,InvalidDistance:3,StreamFinished:4,NoStreamHandler:5,InvalidHeader:6,NoCallback:7,InvalidUTF8:8,ExtraFieldTooLong:9,InvalidDate:10,FilenameTooLong:11,StreamFinishing:12,InvalidZipData:13,UnknownCompressionMethod:14},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(rr,er,tr){var ir=new Error(er||ec[rr]);if(ir.code=rr,Error.captureStackTrace&&Error.captureStackTrace(ir,err),!tr)throw ir;return ir},inflt=function(rr,er,tr,ir){var nr=rr.length,sr=ir?ir.length:0;if(!nr||er.f&&!er.l)return tr||new u8(0);var ar=!tr,or=ar||er.i!=2,lr=er.i;ar&&(tr=new u8(nr*3));var cr=function(Ji){var Ki=tr.length;if(Ji>Ki){var Zi=new u8(Math.max(Ki*2,Ji));Zi.set(tr),tr=Zi}},ur=er.f||0,dr=er.p||0,hr=er.b||0,pr=er.l,gr=er.d,vr=er.m,mr=er.n,fr=nr*8;do{if(!pr){ur=bits(rr,dr,1);var _r=bits(rr,dr+1,3);if(dr+=3,_r)if(_r==1)pr=flrm,gr=fdrm,vr=9,mr=5;else if(_r==2){var xr=bits(rr,dr,31)+257,Sr=bits(rr,dr+10,15)+4,br=xr+bits(rr,dr+5,31)+1;dr+=14;for(var Cr=new u8(br),Ir=new u8(19),Rr=0;Rr<Sr;++Rr)Ir[clim[Rr]]=bits(rr,dr+Rr*3,7);dr+=Sr*3;for(var Pr=max(Ir),Dr=(1<<Pr)-1,Fr=hMap(Ir,Pr,1),Rr=0;Rr<br;){var Or=Fr[bits(rr,dr,Dr)];dr+=Or&15;var Ar=Or>>4;if(Ar<16)Cr[Rr++]=Ar;else{var Nr=0,Ur=0;for(Ar==16?(Ur=3+bits(rr,dr,3),dr+=2,Nr=Cr[Rr-1]):Ar==17?(Ur=3+bits(rr,dr,7),dr+=3):Ar==18&&(Ur=11+bits(rr,dr,127),dr+=7);Ur--;)Cr[Rr++]=Nr}}var Br=Cr.subarray(0,xr),Wr=Cr.subarray(xr);vr=max(Br),mr=max(Wr),pr=hMap(Br,vr,1),gr=hMap(Wr,mr,1)}else err(1);else{var Ar=shft(dr)+4,yr=rr[Ar-4]|rr[Ar-3]<<8,wr=Ar+yr;if(wr>nr){lr&&err(0);break}or&&cr(hr+yr),tr.set(rr.subarray(Ar,wr),hr),er.b=hr+=yr,er.p=dr=wr*8,er.f=ur;continue}if(dr>fr){lr&&err(0);break}}or&&cr(hr+131072);for(var Xr=(1<<vr)-1,Yr=(1<<mr)-1,Qi=dr;;Qi=dr){var Nr=pr[bits16(rr,dr)&Xr],Xi=Nr>>4;if(dr+=Nr&15,dr>fr){lr&&err(0);break}if(Nr||err(2),Xi<256)tr[hr++]=Xi;else if(Xi==256){Qi=dr,pr=null;break}else{var Kr=Xi-254;if(Xi>264){var Rr=Xi-257,$r=fleb[Rr];Kr=bits(rr,dr,(1<<$r)-1)+fl[Rr],dr+=$r}var Vr=gr[bits16(rr,dr)&Yr],Gr=Vr>>4;Vr||err(3),dr+=Vr&15;var Wr=fd[Gr];if(Gr>3){var $r=fdeb[Gr];Wr+=bits16(rr,dr)&(1<<$r)-1,dr+=$r}if(dr>fr){lr&&err(0);break}or&&cr(hr+131072);var qr=hr+Kr;if(hr<Wr){var ji=sr-Wr,Jr=Math.min(Wr,qr);for(ji+hr<0&&err(3);hr<Jr;++hr)tr[hr]=ir[ji+hr]}for(;hr<qr;++hr)tr[hr]=tr[hr-Wr]}}er.l=pr,er.p=Qi,er.b=hr,er.f=ur,pr&&(ur=1,er.m=vr,er.d=gr,er.n=mr)}while(!ur);return hr!=tr.length&&ar?slc(tr,0,hr):tr.subarray(0,hr)},wbits=function(rr,er,tr){tr<<=er&7;var ir=er/8|0;rr[ir]|=tr,rr[ir+1]|=tr>>8},wbits16=function(rr,er,tr){tr<<=er&7;var ir=er/8|0;rr[ir]|=tr,rr[ir+1]|=tr>>8,rr[ir+2]|=tr>>16},hTree=function(rr,er){for(var tr=[],ir=0;ir<rr.length;++ir)rr[ir]&&tr.push({s:ir,f:rr[ir]});var nr=tr.length,sr=tr.slice();if(!nr)return{t:et$2,l:0};if(nr==1){var ar=new u8(tr[0].s+1);return ar[tr[0].s]=1,{t:ar,l:1}}tr.sort(function(wr,xr){return wr.f-xr.f}),tr.push({s:-1,f:25001});var or=tr[0],lr=tr[1],cr=0,ur=1,dr=2;for(tr[0]={s:-1,f:or.f+lr.f,l:or,r:lr};ur!=nr-1;)or=tr[tr[cr].f<tr[dr].f?cr++:dr++],lr=tr[cr!=ur&&tr[cr].f<tr[dr].f?cr++:dr++],tr[ur++]={s:-1,f:or.f+lr.f,l:or,r:lr};for(var hr=sr[0].s,ir=1;ir<nr;++ir)sr[ir].s>hr&&(hr=sr[ir].s);var pr=new u16(hr+1),gr=ln$1(tr[ur-1],pr,0);if(gr>er){var ir=0,vr=0,mr=gr-er,fr=1<<mr;for(sr.sort(function(xr,Sr){return pr[Sr.s]-pr[xr.s]||xr.f-Sr.f});ir<nr;++ir){var _r=sr[ir].s;if(pr[_r]>er)vr+=fr-(1<<gr-pr[_r]),pr[_r]=er;else break}for(vr>>=mr;vr>0;){var Ar=sr[ir].s;pr[Ar]<er?vr-=1<<er-pr[Ar]++-1:++ir}for(;ir>=0&&vr;--ir){var yr=sr[ir].s;pr[yr]==er&&(--pr[yr],++vr)}gr=er}return{t:new u8(pr),l:gr}},ln$1=function(rr,er,tr){return rr.s==-1?Math.max(ln$1(rr.l,er,tr+1),ln$1(rr.r,er,tr+1)):er[rr.s]=tr},lc=function(rr){for(var er=rr.length;er&&!rr[--er];);for(var tr=new u16(++er),ir=0,nr=rr[0],sr=1,ar=function(lr){tr[ir++]=lr},or=1;or<=er;++or)if(rr[or]==nr&&or!=er)++sr;else{if(!nr&&sr>2){for(;sr>138;sr-=138)ar(32754);sr>2&&(ar(sr>10?sr-11<<5|28690:sr-3<<5|12305),sr=0)}else if(sr>3){for(ar(nr),--sr;sr>6;sr-=6)ar(8304);sr>2&&(ar(sr-3<<5|8208),sr=0)}for(;sr--;)ar(nr);sr=1,nr=rr[or]}return{c:tr.subarray(0,ir),n:er}},clen=function(rr,er){for(var tr=0,ir=0;ir<er.length;++ir)tr+=rr[ir]*er[ir];return tr},wfblk=function(rr,er,tr){var ir=tr.length,nr=shft(er+2);rr[nr]=ir&255,rr[nr+1]=ir>>8,rr[nr+2]=rr[nr]^255,rr[nr+3]=rr[nr+1]^255;for(var sr=0;sr<ir;++sr)rr[nr+sr+4]=tr[sr];return(nr+4+ir)*8},wblk=function(rr,er,tr,ir,nr,sr,ar,or,lr,cr,ur){wbits(er,ur++,tr),++nr[256];for(var dr=hTree(nr,15),hr=dr.t,pr=dr.l,gr=hTree(sr,15),vr=gr.t,mr=gr.l,fr=lc(hr),_r=fr.c,Ar=fr.n,yr=lc(vr),wr=yr.c,xr=yr.n,Sr=new u16(19),br=0;br<_r.length;++br)++Sr[_r[br]&31];for(var br=0;br<wr.length;++br)++Sr[wr[br]&31];for(var Cr=hTree(Sr,7),Ir=Cr.t,Rr=Cr.l,Pr=19;Pr>4&&!Ir[clim[Pr-1]];--Pr);var Dr=cr+5<<3,Fr=clen(nr,flt)+clen(sr,fdt)+ar,Or=clen(nr,hr)+clen(sr,vr)+ar+14+3*Pr+clen(Sr,Ir)+2*Sr[16]+3*Sr[17]+7*Sr[18];if(lr>=0&&Dr<=Fr&&Dr<=Or)return wfblk(er,ur,rr.subarray(lr,lr+cr));var Nr,Ur,Br,Wr;if(wbits(er,ur,1+(Or<Fr)),ur+=2,Or<Fr){Nr=hMap(hr,pr,0),Ur=hr,Br=hMap(vr,mr,0),Wr=vr;var Xr=hMap(Ir,Rr,0);wbits(er,ur,Ar-257),wbits(er,ur+5,xr-1),wbits(er,ur+10,Pr-4),ur+=14;for(var br=0;br<Pr;++br)wbits(er,ur+3*br,Ir[clim[br]]);ur+=3*Pr;for(var Yr=[_r,wr],Qi=0;Qi<2;++Qi)for(var Xi=Yr[Qi],br=0;br<Xi.length;++br){var Kr=Xi[br]&31;wbits(er,ur,Xr[Kr]),ur+=Ir[Kr],Kr>15&&(wbits(er,ur,Xi[br]>>5&127),ur+=Xi[br]>>12)}}else Nr=flm,Ur=flt,Br=fdm,Wr=fdt;for(var br=0;br<or;++br){var $r=ir[br];if($r>255){var Kr=$r>>18&31;wbits16(er,ur,Nr[Kr+257]),ur+=Ur[Kr+257],Kr>7&&(wbits(er,ur,$r>>23&31),ur+=fleb[Kr]);var Vr=$r&31;wbits16(er,ur,Br[Vr]),ur+=Wr[Vr],Vr>3&&(wbits16(er,ur,$r>>5&8191),ur+=fdeb[Vr])}else wbits16(er,ur,Nr[$r]),ur+=Ur[$r]}return wbits16(er,ur,Nr[256]),ur+Ur[256]},deo=new i32([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),et$2=new u8(0),dflt=function(rr,er,tr,ir,nr,sr){var ar=sr.z||rr.length,or=new u8(ir+ar+5*(1+Math.ceil(ar/7e3))+nr),lr=or.subarray(ir,or.length-nr),cr=sr.l,ur=(sr.r||0)&7;if(er){ur&&(lr[0]=sr.r>>3);for(var dr=deo[er-1],hr=dr>>13,pr=dr&8191,gr=(1<<tr)-1,vr=sr.p||new u16(32768),mr=sr.h||new u16(gr+1),fr=Math.ceil(tr/3),_r=2*fr,Ar=function(Zr){return(rr[Zr]^rr[Zr+1]<<fr^rr[Zr+2]<<_r)&gr},yr=new i32(25e3),wr=new u16(288),xr=new u16(32),Sr=0,br=0,Cr=sr.i||0,Ir=0,Rr=sr.w||0,Pr=0;Cr+2<ar;++Cr){var Dr=Ar(Cr),Fr=Cr&32767,Or=mr[Dr];if(vr[Fr]=Or,mr[Dr]=Fr,Rr<=Cr){var Nr=ar-Cr;if((Sr>7e3||Ir>24576)&&(Nr>423||!cr)){ur=wblk(rr,lr,0,yr,wr,xr,br,Ir,Pr,Cr-Pr,ur),Ir=Sr=br=0,Pr=Cr;for(var Ur=0;Ur<286;++Ur)wr[Ur]=0;for(var Ur=0;Ur<30;++Ur)xr[Ur]=0}var Br=2,Wr=0,Xr=pr,Yr=Fr-Or&32767;if(Nr>2&&Dr==Ar(Cr-Yr))for(var Qi=Math.min(hr,Nr)-1,Xi=Math.min(32767,Cr),Kr=Math.min(258,Nr);Yr<=Xi&&--Xr&&Fr!=Or;){if(rr[Cr+Br]==rr[Cr+Br-Yr]){for(var $r=0;$r<Kr&&rr[Cr+$r]==rr[Cr+$r-Yr];++$r);if($r>Br){if(Br=$r,Wr=Yr,$r>Qi)break;for(var Vr=Math.min(Yr,$r-2),Gr=0,Ur=0;Ur<Vr;++Ur){var qr=Cr-Yr+Ur&32767,ji=vr[qr],Jr=qr-ji&32767;Jr>Gr&&(Gr=Jr,Or=qr)}}}Fr=Or,Or=vr[Fr],Yr+=Fr-Or&32767}if(Wr){yr[Ir++]=268435456|revfl[Br]<<18|revfd[Wr];var Ji=revfl[Br]&31,Ki=revfd[Wr]&31;br+=fleb[Ji]+fdeb[Ki],++wr[257+Ji],++xr[Ki],Rr=Cr+Br,++Sr}else yr[Ir++]=rr[Cr],++wr[rr[Cr]]}}for(Cr=Math.max(Cr,Rr);Cr<ar;++Cr)yr[Ir++]=rr[Cr],++wr[rr[Cr]];ur=wblk(rr,lr,cr,yr,wr,xr,br,Ir,Pr,Cr-Pr,ur),cr||(sr.r=ur&7|lr[ur/8|0]<<3,ur-=7,sr.h=mr,sr.p=vr,sr.i=Cr,sr.w=Rr)}else{for(var Cr=sr.w||0;Cr<ar+cr;Cr+=65535){var Zi=Cr+65535;Zi>=ar&&(lr[ur/8|0]=cr,Zi=ar),ur=wfblk(lr,ur+1,rr.subarray(Cr,Zi))}sr.i=ar}return slc(or,0,ir+shft(ur)+nr)},crct=function(){for(var rr=new Int32Array(256),er=0;er<256;++er){for(var tr=er,ir=9;--ir;)tr=(tr&1&&-306674912)^tr>>>1;rr[er]=tr}return rr}(),crc=function(){var rr=-1;return{p:function(er){for(var tr=rr,ir=0;ir<er.length;++ir)tr=crct[tr&255^er[ir]]^tr>>>8;rr=tr},d:function(){return~rr}}},adler=function(){var rr=1,er=0;return{p:function(tr){for(var ir=rr,nr=er,sr=tr.length|0,ar=0;ar!=sr;){for(var or=Math.min(ar+2655,sr);ar<or;++ar)nr+=ir+=tr[ar];ir=(ir&65535)+15*(ir>>16),nr=(nr&65535)+15*(nr>>16)}rr=ir,er=nr},d:function(){return rr%=65521,er%=65521,(rr&255)<<24|(rr&65280)<<8|(er&255)<<8|er>>8}}},dopt=function(rr,er,tr,ir,nr){if(!nr&&(nr={l:1},er.dictionary)){var sr=er.dictionary.subarray(-32768),ar=new u8(sr.length+rr.length);ar.set(sr),ar.set(rr,sr.length),rr=ar,nr.w=sr.length}return dflt(rr,er.level==null?6:er.level,er.mem==null?nr.l?Math.ceil(Math.max(8,Math.min(13,Math.log(rr.length)))*1.5):20:12+er.mem,tr,ir,nr)},mrg=function(rr,er){var tr={};for(var ir in rr)tr[ir]=rr[ir];for(var ir in er)tr[ir]=er[ir];return tr},wcln=function(rr,er,tr){for(var ir=rr(),nr=rr.toString(),sr=nr.slice(nr.indexOf("[")+1,nr.lastIndexOf("]")).replace(/\s+/g,"").split(","),ar=0;ar<ir.length;++ar){var or=ir[ar],lr=sr[ar];if(typeof or=="function"){er+=";"+lr+"=";var cr=or.toString();if(or.prototype)if(cr.indexOf("[native code]")!=-1){var ur=cr.indexOf(" ",8)+1;er+=cr.slice(ur,cr.indexOf("(",ur))}else{er+=cr;for(var dr in or.prototype)er+=";"+lr+".prototype."+dr+"="+or.prototype[dr].toString()}else er+=cr}else tr[lr]=or}return er},ch=[],cbfs=function(rr){var er=[];for(var tr in rr)rr[tr].buffer&&er.push((rr[tr]=new rr[tr].constructor(rr[tr])).buffer);return er},wrkr=function(rr,er,tr,ir){if(!ch[tr]){for(var nr="",sr={},ar=rr.length-1,or=0;or<ar;++or)nr=wcln(rr[or],nr,sr);ch[tr]={c:wcln(rr[ar],nr,sr),e:sr}}var lr=mrg({},ch[tr].e);return wk(ch[tr].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+er.toString()+"}",tr,lr,cbfs(lr),ir)},bInflt=function(){return[u8,u16,i32,fleb,fdeb,clim,fl,fd,flrm,fdrm,rev,ec,hMap,max,bits,bits16,shft,slc,err,inflt,inflateSync,pbf,gopt]},bDflt=function(){return[u8,u16,i32,fleb,fdeb,clim,revfl,revfd,flm,flt,fdm,fdt,rev,deo,et$2,hMap,wbits,wbits16,hTree,ln$1,lc,clen,wfblk,wblk,shft,slc,dflt,dopt,deflateSync,pbf]},gze=function(){return[gzh,gzhl,wbytes,crc,crct]},guze=function(){return[gzs,gzl]},zle=function(){return[zlh,wbytes,adler]},zule=function(){return[zls]},pbf=function(rr){return postMessage(rr,[rr.buffer])},gopt=function(rr){return rr&&{out:rr.size&&new u8(rr.size),dictionary:rr.dictionary}},cbify=function(rr,er,tr,ir,nr,sr){var ar=wrkr(tr,ir,nr,function(or,lr){ar.terminate(),sr(or,lr)});return ar.postMessage([rr,er],er.consume?[rr.buffer]:[]),function(){ar.terminate()}},astrm=function(rr){return rr.ondata=function(er,tr){return postMessage([er,tr],[er.buffer])},function(er){er.data.length?(rr.push(er.data[0],er.data[1]),postMessage([er.data[0].length])):rr.flush()}},astrmify=function(rr,er,tr,ir,nr,sr,ar){var or,lr=wrkr(rr,ir,nr,function(cr,ur){cr?(lr.terminate(),er.ondata.call(er,cr)):Array.isArray(ur)?ur.length==1?(er.queuedSize-=ur[0],er.ondrain&&er.ondrain(ur[0])):(ur[1]&&lr.terminate(),er.ondata.call(er,cr,ur[0],ur[1])):ar(ur)});lr.postMessage(tr),er.queuedSize=0,er.push=function(cr,ur){er.ondata||err(5),or&&er.ondata(err(4,0,1),null,!!ur),er.queuedSize+=cr.length,lr.postMessage([cr,or=ur],[cr.buffer])},er.terminate=function(){lr.terminate()},sr&&(er.flush=function(){lr.postMessage([])})},b2=function(rr,er){return rr[er]|rr[er+1]<<8},b4=function(rr,er){return(rr[er]|rr[er+1]<<8|rr[er+2]<<16|rr[er+3]<<24)>>>0},b8=function(rr,er){return b4(rr,er)+b4(rr,er+4)*4294967296},wbytes=function(rr,er,tr){for(;tr;++er)rr[er]=tr,tr>>>=8},gzh=function(rr,er){var tr=er.filename;if(rr[0]=31,rr[1]=139,rr[2]=8,rr[8]=er.level<2?4:er.level==9?2:0,rr[9]=3,er.mtime!=0&&wbytes(rr,4,Math.floor(new Date(er.mtime||Date.now())/1e3)),tr){rr[3]=8;for(var ir=0;ir<=tr.length;++ir)rr[ir+10]=tr.charCodeAt(ir)}},gzs=function(rr){(rr[0]!=31||rr[1]!=139||rr[2]!=8)&&err(6,"invalid gzip data");var er=rr[3],tr=10;er&4&&(tr+=(rr[10]|rr[11]<<8)+2);for(var ir=(er>>3&1)+(er>>4&1);ir>0;ir-=!rr[tr++]);return tr+(er&2)},gzl=function(rr){var er=rr.length;return(rr[er-4]|rr[er-3]<<8|rr[er-2]<<16|rr[er-1]<<24)>>>0},gzhl=function(rr){return 10+(rr.filename?rr.filename.length+1:0)},zlh=function(rr,er){var tr=er.level,ir=tr==0?0:tr<6?1:tr==9?3:2;if(rr[0]=120,rr[1]=ir<<6|(er.dictionary&&32),rr[1]|=31-(rr[0]<<8|rr[1])%31,er.dictionary){var nr=adler();nr.p(er.dictionary),wbytes(rr,2,nr.d())}},zls=function(rr,er){return((rr[0]&15)!=8||rr[0]>>4>7||(rr[0]<<8|rr[1])%31)&&err(6,"invalid zlib data"),(rr[1]>>5&1)==+!er&&err(6,"invalid zlib data: "+(rr[1]&32?"need":"unexpected")+" dictionary"),(rr[1]>>3&4)+2};function StrmOpt(rr,er){return typeof rr=="function"&&(er=rr,rr={}),this.ondata=er,rr}var Deflate=function(){function rr(er,tr){if(typeof er=="function"&&(tr=er,er={}),this.ondata=tr,this.o=er||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new u8(98304),this.o.dictionary){var ir=this.o.dictionary.subarray(-32768);this.b.set(ir,32768-ir.length),this.s.i=32768-ir.length}}return rr.prototype.p=function(er,tr){this.ondata(dopt(er,this.o,0,0,this.s),tr)},rr.prototype.push=function(er,tr){this.ondata||err(5),this.s.l&&err(4);var ir=er.length+this.s.z;if(ir>this.b.length){if(ir>2*this.b.length-32768){var nr=new u8(ir&-32768);nr.set(this.b.subarray(0,this.s.z)),this.b=nr}var sr=this.b.length-this.s.z;this.b.set(er.subarray(0,sr),this.s.z),this.s.z=this.b.length,this.p(this.b,!1),this.b.set(this.b.subarray(-32768)),this.b.set(er.subarray(sr),32768),this.s.z=er.length-sr+32768,this.s.i=32766,this.s.w=32768}else this.b.set(er,this.s.z),this.s.z+=er.length;this.s.l=tr&1,(this.s.z>this.s.w+8191||tr)&&(this.p(this.b,tr||!1),this.s.w=this.s.i,this.s.i-=2)},rr.prototype.flush=function(){this.ondata||err(5),this.s.l&&err(4),this.p(this.b,!1),this.s.w=this.s.i,this.s.i-=2},rr}(),AsyncDeflate=function(){function rr(er,tr){astrmify([bDflt,function(){return[astrm,Deflate]}],this,StrmOpt.call(this,er,tr),function(ir){var nr=new Deflate(ir.data);onmessage=astrm(nr)},6,1)}return rr}();function deflate(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bDflt],function(ir){return pbf(deflateSync(ir.data[0],ir.data[1]))},0,tr)}function deflateSync(rr,er){return dopt(rr,er||{},0,0)}var Inflate=function(){function rr(er,tr){typeof er=="function"&&(tr=er,er={}),this.ondata=tr;var ir=er&&er.dictionary&&er.dictionary.subarray(-32768);this.s={i:0,b:ir?ir.length:0},this.o=new u8(32768),this.p=new u8(0),ir&&this.o.set(ir)}return rr.prototype.e=function(er){if(this.ondata||err(5),this.d&&err(4),!this.p.length)this.p=er;else if(er.length){var tr=new u8(this.p.length+er.length);tr.set(this.p),tr.set(er,this.p.length),this.p=tr}},rr.prototype.c=function(er){this.s.i=+(this.d=er||!1);var tr=this.s.b,ir=inflt(this.p,this.s,this.o);this.ondata(slc(ir,tr,this.s.b),this.d),this.o=slc(ir,this.s.b-32768),this.s.b=this.o.length,this.p=slc(this.p,this.s.p/8|0),this.s.p&=7},rr.prototype.push=function(er,tr){this.e(er),this.c(tr)},rr}(),AsyncInflate=function(){function rr(er,tr){astrmify([bInflt,function(){return[astrm,Inflate]}],this,StrmOpt.call(this,er,tr),function(ir){var nr=new Inflate(ir.data);onmessage=astrm(nr)},7,0)}return rr}();function inflate(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bInflt],function(ir){return pbf(inflateSync(ir.data[0],gopt(ir.data[1])))},1,tr)}function inflateSync(rr,er){return inflt(rr,{i:2},er&&er.out,er&&er.dictionary)}var Gzip=function(){function rr(er,tr){this.c=crc(),this.l=0,this.v=1,Deflate.call(this,er,tr)}return rr.prototype.push=function(er,tr){this.c.p(er),this.l+=er.length,Deflate.prototype.push.call(this,er,tr)},rr.prototype.p=function(er,tr){var ir=dopt(er,this.o,this.v&&gzhl(this.o),tr&&8,this.s);this.v&&(gzh(ir,this.o),this.v=0),tr&&(wbytes(ir,ir.length-8,this.c.d()),wbytes(ir,ir.length-4,this.l)),this.ondata(ir,tr)},rr.prototype.flush=function(){Deflate.prototype.flush.call(this)},rr}(),AsyncGzip=function(){function rr(er,tr){astrmify([bDflt,gze,function(){return[astrm,Deflate,Gzip]}],this,StrmOpt.call(this,er,tr),function(ir){var nr=new Gzip(ir.data);onmessage=astrm(nr)},8,1)}return rr}();function gzip(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bDflt,gze,function(){return[gzipSync]}],function(ir){return pbf(gzipSync(ir.data[0],ir.data[1]))},2,tr)}function gzipSync(rr,er){er||(er={});var tr=crc(),ir=rr.length;tr.p(rr);var nr=dopt(rr,er,gzhl(er),8),sr=nr.length;return gzh(nr,er),wbytes(nr,sr-8,tr.d()),wbytes(nr,sr-4,ir),nr}var Gunzip=function(){function rr(er,tr){this.v=1,this.r=0,Inflate.call(this,er,tr)}return rr.prototype.push=function(er,tr){if(Inflate.prototype.e.call(this,er),this.r+=er.length,this.v){var ir=this.p.subarray(this.v-1),nr=ir.length>3?gzs(ir):4;if(nr>ir.length){if(!tr)return}else this.v>1&&this.onmember&&this.onmember(this.r-ir.length);this.p=ir.subarray(nr),this.v=0}Inflate.prototype.c.call(this,tr),this.s.f&&!this.s.l&&!tr&&(this.v=shft(this.s.p)+9,this.s={i:0},this.o=new u8(0),this.push(new u8(0),tr))},rr}(),AsyncGunzip=function(){function rr(er,tr){var ir=this;astrmify([bInflt,guze,function(){return[astrm,Inflate,Gunzip]}],this,StrmOpt.call(this,er,tr),function(nr){var sr=new Gunzip(nr.data);sr.onmember=function(ar){return postMessage(ar)},onmessage=astrm(sr)},9,0,function(nr){return ir.onmember&&ir.onmember(nr)})}return rr}();function gunzip(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bInflt,guze,function(){return[gunzipSync]}],function(ir){return pbf(gunzipSync(ir.data[0],ir.data[1]))},3,tr)}function gunzipSync(rr,er){var tr=gzs(rr);return tr+8>rr.length&&err(6,"invalid gzip data"),inflt(rr.subarray(tr,-8),{i:2},er&&er.out||new u8(gzl(rr)),er&&er.dictionary)}var Zlib=function(){function rr(er,tr){this.c=adler(),this.v=1,Deflate.call(this,er,tr)}return rr.prototype.push=function(er,tr){this.c.p(er),Deflate.prototype.push.call(this,er,tr)},rr.prototype.p=function(er,tr){var ir=dopt(er,this.o,this.v&&(this.o.dictionary?6:2),tr&&4,this.s);this.v&&(zlh(ir,this.o),this.v=0),tr&&wbytes(ir,ir.length-4,this.c.d()),this.ondata(ir,tr)},rr.prototype.flush=function(){Deflate.prototype.flush.call(this)},rr}(),AsyncZlib=function(){function rr(er,tr){astrmify([bDflt,zle,function(){return[astrm,Deflate,Zlib]}],this,StrmOpt.call(this,er,tr),function(ir){var nr=new Zlib(ir.data);onmessage=astrm(nr)},10,1)}return rr}();function zlib(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bDflt,zle,function(){return[zlibSync]}],function(ir){return pbf(zlibSync(ir.data[0],ir.data[1]))},4,tr)}function zlibSync(rr,er){er||(er={});var tr=adler();tr.p(rr);var ir=dopt(rr,er,er.dictionary?6:2,4);return zlh(ir,er),wbytes(ir,ir.length-4,tr.d()),ir}var Unzlib=function(){function rr(er,tr){Inflate.call(this,er,tr),this.v=er&&er.dictionary?2:1}return rr.prototype.push=function(er,tr){if(Inflate.prototype.e.call(this,er),this.v){if(this.p.length<6&&!tr)return;this.p=this.p.subarray(zls(this.p,this.v-1)),this.v=0}tr&&(this.p.length<4&&err(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),Inflate.prototype.c.call(this,tr)},rr}(),AsyncUnzlib=function(){function rr(er,tr){astrmify([bInflt,zule,function(){return[astrm,Inflate,Unzlib]}],this,StrmOpt.call(this,er,tr),function(ir){var nr=new Unzlib(ir.data);onmessage=astrm(nr)},11,0)}return rr}();function unzlib(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),cbify(rr,er,[bInflt,zule,function(){return[unzlibSync]}],function(ir){return pbf(unzlibSync(ir.data[0],gopt(ir.data[1])))},5,tr)}function unzlibSync(rr,er){return inflt(rr.subarray(zls(rr,er&&er.dictionary),-4),{i:2},er&&er.out,er&&er.dictionary)}var Decompress=function(){function rr(er,tr){this.o=StrmOpt.call(this,er,tr)||{},this.G=Gunzip,this.I=Inflate,this.Z=Unzlib}return rr.prototype.i=function(){var er=this;this.s.ondata=function(tr,ir){er.ondata(tr,ir)}},rr.prototype.push=function(er,tr){if(this.ondata||err(5),this.s)this.s.push(er,tr);else{if(this.p&&this.p.length){var ir=new u8(this.p.length+er.length);ir.set(this.p),ir.set(er,this.p.length)}else this.p=er;this.p.length>2&&(this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(this.o):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(this.o):new this.Z(this.o),this.i(),this.s.push(this.p,tr),this.p=null)}},rr}(),AsyncDecompress=function(){function rr(er,tr){Decompress.call(this,er,tr),this.queuedSize=0,this.G=AsyncGunzip,this.I=AsyncInflate,this.Z=AsyncUnzlib}return rr.prototype.i=function(){var er=this;this.s.ondata=function(tr,ir,nr){er.ondata(tr,ir,nr)},this.s.ondrain=function(tr){er.queuedSize-=tr,er.ondrain&&er.ondrain(tr)}},rr.prototype.push=function(er,tr){this.queuedSize+=er.length,Decompress.prototype.push.call(this,er,tr)},rr}();function decompress$1(rr,er,tr){return tr||(tr=er,er={}),typeof tr!="function"&&err(7),rr[0]==31&&rr[1]==139&&rr[2]==8?gunzip(rr,er,tr):(rr[0]&15)!=8||rr[0]>>4>7||(rr[0]<<8|rr[1])%31?inflate(rr,er,tr):unzlib(rr,er,tr)}function decompressSync(rr,er){return rr[0]==31&&rr[1]==139&&rr[2]==8?gunzipSync(rr,er):(rr[0]&15)!=8||rr[0]>>4>7||(rr[0]<<8|rr[1])%31?inflateSync(rr,er):unzlibSync(rr,er)}var fltn=function(rr,er,tr,ir){for(var nr in rr){var sr=rr[nr],ar=er+nr,or=ir;Array.isArray(sr)&&(or=mrg(ir,sr[1]),sr=sr[0]),sr instanceof u8?tr[ar]=[sr,or]:(tr[ar+="/"]=[new u8(0),or],fltn(sr,ar,tr,ir))}},te$1=typeof TextEncoder<"u"&&new TextEncoder,td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et$2,{stream:!0}),tds=1}catch{}var dutf8=function(rr){for(var er="",tr=0;;){var ir=rr[tr++],nr=(ir>127)+(ir>223)+(ir>239);if(tr+nr>rr.length)return{s:er,r:slc(rr,tr-1)};nr?nr==3?(ir=((ir&15)<<18|(rr[tr++]&63)<<12|(rr[tr++]&63)<<6|rr[tr++]&63)-65536,er+=String.fromCharCode(55296|ir>>10,56320|ir&1023)):nr&1?er+=String.fromCharCode((ir&31)<<6|rr[tr++]&63):er+=String.fromCharCode((ir&15)<<12|(rr[tr++]&63)<<6|rr[tr++]&63):er+=String.fromCharCode(ir)}},DecodeUTF8=function(){function rr(er){this.ondata=er,tds?this.t=new TextDecoder:this.p=et$2}return rr.prototype.push=function(er,tr){if(this.ondata||err(5),tr=!!tr,this.t){this.ondata(this.t.decode(er,{stream:!0}),tr),tr&&(this.t.decode().length&&err(8),this.t=null);return}this.p||err(4);var ir=new u8(this.p.length+er.length);ir.set(this.p),ir.set(er,this.p.length);var nr=dutf8(ir),sr=nr.s,ar=nr.r;tr?(ar.length&&err(8),this.p=null):this.p=ar,this.ondata(sr,tr)},rr}(),EncodeUTF8=function(){function rr(er){this.ondata=er}return rr.prototype.push=function(er,tr){this.ondata||err(5),this.d&&err(4),this.ondata(strToU8(er),this.d=tr||!1)},rr}();function strToU8(rr,er){if(er){for(var tr=new u8(rr.length),ir=0;ir<rr.length;++ir)tr[ir]=rr.charCodeAt(ir);return tr}if(te$1)return te$1.encode(rr);for(var nr=rr.length,sr=new u8(rr.length+(rr.length>>1)),ar=0,or=function(ur){sr[ar++]=ur},ir=0;ir<nr;++ir){if(ar+5>sr.length){var lr=new u8(ar+8+(nr-ir<<1));lr.set(sr),sr=lr}var cr=rr.charCodeAt(ir);cr<128||er?or(cr):cr<2048?(or(192|cr>>6),or(128|cr&63)):cr>55295&&cr<57344?(cr=65536+(cr&1047552)|rr.charCodeAt(++ir)&1023,or(240|cr>>18),or(128|cr>>12&63),or(128|cr>>6&63),or(128|cr&63)):(or(224|cr>>12),or(128|cr>>6&63),or(128|cr&63))}return slc(sr,0,ar)}function strFromU8(rr,er){if(er){for(var tr="",ir=0;ir<rr.length;ir+=16384)tr+=String.fromCharCode.apply(null,rr.subarray(ir,ir+16384));return tr}else{if(td)return td.decode(rr);var nr=dutf8(rr),sr=nr.s,tr=nr.r;return tr.length&&err(8),sr}}var dbf=function(rr){return rr==1?3:rr<6?2:rr==9?1:0},slzh=function(rr,er){return er+30+b2(rr,er+26)+b2(rr,er+28)},zh=function(rr,er,tr){var ir=b2(rr,er+28),nr=strFromU8(rr.subarray(er+46,er+46+ir),!(b2(rr,er+8)&2048)),sr=er+46+ir,ar=b4(rr,er+20),or=tr&&ar==4294967295?z64e(rr,sr):[ar,b4(rr,er+24),b4(rr,er+42)],lr=or[0],cr=or[1],ur=or[2];return[b2(rr,er+10),lr,cr,nr,sr+b2(rr,er+30)+b2(rr,er+32),ur]},z64e=function(rr,er){for(;b2(rr,er)!=1;er+=4+b2(rr,er+2));return[b8(rr,er+12),b8(rr,er+4),b8(rr,er+20)]},exfl=function(rr){var er=0;if(rr)for(var tr in rr){var ir=rr[tr].length;ir>65535&&err(9),er+=ir+4}return er},wzh=function(rr,er,tr,ir,nr,sr,ar,or){var lr=ir.length,cr=tr.extra,ur=or&&or.length,dr=exfl(cr);wbytes(rr,er,ar!=null?33639248:67324752),er+=4,ar!=null&&(rr[er++]=20,rr[er++]=tr.os),rr[er]=20,er+=2,rr[er++]=tr.flag<<1|(sr<0&&8),rr[er++]=nr&&8,rr[er++]=tr.compression&255,rr[er++]=tr.compression>>8;var hr=new Date(tr.mtime==null?Date.now():tr.mtime),pr=hr.getFullYear()-1980;if((pr<0||pr>119)&&err(10),wbytes(rr,er,pr<<25|hr.getMonth()+1<<21|hr.getDate()<<16|hr.getHours()<<11|hr.getMinutes()<<5|hr.getSeconds()>>1),er+=4,sr!=-1&&(wbytes(rr,er,tr.crc),wbytes(rr,er+4,sr<0?-sr-2:sr),wbytes(rr,er+8,tr.size)),wbytes(rr,er+12,lr),wbytes(rr,er+14,dr),er+=16,ar!=null&&(wbytes(rr,er,ur),wbytes(rr,er+6,tr.attrs),wbytes(rr,er+10,ar),er+=14),rr.set(ir,er),er+=lr,dr)for(var gr in cr){var vr=cr[gr],mr=vr.length;wbytes(rr,er,+gr),wbytes(rr,er+2,mr),rr.set(vr,er+4),er+=4+mr}return ur&&(rr.set(or,er),er+=ur),er},wzf=function(rr,er,tr,ir,nr){wbytes(rr,er,101010256),wbytes(rr,er+8,tr),wbytes(rr,er+10,tr),wbytes(rr,er+12,ir),wbytes(rr,er+16,nr)},ZipPassThrough=function(){function rr(er){this.filename=er,this.c=crc(),this.size=0,this.compression=0}return rr.prototype.process=function(er,tr){this.ondata(null,er,tr)},rr.prototype.push=function(er,tr){this.ondata||err(5),this.c.p(er),this.size+=er.length,tr&&(this.crc=this.c.d()),this.process(er,tr||!1)},rr}(),ZipDeflate=function(){function rr(er,tr){var ir=this;tr||(tr={}),ZipPassThrough.call(this,er),this.d=new Deflate(tr,function(nr,sr){ir.ondata(null,nr,sr)}),this.compression=8,this.flag=dbf(tr.level)}return rr.prototype.process=function(er,tr){try{this.d.push(er,tr)}catch(ir){this.ondata(ir,null,tr)}},rr.prototype.push=function(er,tr){ZipPassThrough.prototype.push.call(this,er,tr)},rr}(),AsyncZipDeflate=function(){function rr(er,tr){var ir=this;tr||(tr={}),ZipPassThrough.call(this,er),this.d=new AsyncDeflate(tr,function(nr,sr,ar){ir.ondata(nr,sr,ar)}),this.compression=8,this.flag=dbf(tr.level),this.terminate=this.d.terminate}return rr.prototype.process=function(er,tr){this.d.push(er,tr)},rr.prototype.push=function(er,tr){ZipPassThrough.prototype.push.call(this,er,tr)},rr}(),Zip=function(){function rr(er){this.ondata=er,this.u=[],this.d=1}return rr.prototype.add=function(er){var tr=this;if(this.ondata||err(5),this.d&2)this.ondata(err(4+(this.d&1)*8,0,1),null,!1);else{var ir=strToU8(er.filename),nr=ir.length,sr=er.comment,ar=sr&&strToU8(sr),or=nr!=er.filename.length||ar&&sr.length!=ar.length,lr=nr+exfl(er.extra)+30;nr>65535&&this.ondata(err(11,0,1),null,!1);var cr=new u8(lr);wzh(cr,0,er,ir,or,-1);var ur=[cr],dr=function(){for(var mr=0,fr=ur;mr<fr.length;mr++){var _r=fr[mr];tr.ondata(null,_r,!1)}ur=[]},hr=this.d;this.d=0;var pr=this.u.length,gr=mrg(er,{f:ir,u:or,o:ar,t:function(){er.terminate&&er.terminate()},r:function(){if(dr(),hr){var mr=tr.u[pr+1];mr?mr.r():tr.d=1}hr=1}}),vr=0;er.ondata=function(mr,fr,_r){if(mr)tr.ondata(mr,fr,_r),tr.terminate();else if(vr+=fr.length,ur.push(fr),_r){var Ar=new u8(16);wbytes(Ar,0,134695760),wbytes(Ar,4,er.crc),wbytes(Ar,8,vr),wbytes(Ar,12,er.size),ur.push(Ar),gr.c=vr,gr.b=lr+vr+16,gr.crc=er.crc,gr.size=er.size,hr&&gr.r(),hr=1}else hr&&dr()},this.u.push(gr)}},rr.prototype.end=function(){var er=this;if(this.d&2){this.ondata(err(4+(this.d&1)*8,0,1),null,!0);return}this.d?this.e():this.u.push({r:function(){er.d&1&&(er.u.splice(-1,1),er.e())},t:function(){}}),this.d=3},rr.prototype.e=function(){for(var er=0,tr=0,ir=0,nr=0,sr=this.u;nr<sr.length;nr++){var ar=sr[nr];ir+=46+ar.f.length+exfl(ar.extra)+(ar.o?ar.o.length:0)}for(var or=new u8(ir+22),lr=0,cr=this.u;lr<cr.length;lr++){var ar=cr[lr];wzh(or,er,ar,ar.f,ar.u,-ar.c-2,tr,ar.o),er+=46+ar.f.length+exfl(ar.extra)+(ar.o?ar.o.length:0),tr+=ar.b}wzf(or,er,this.u.length,ir,tr),this.ondata(null,or,!0),this.d=2},rr.prototype.terminate=function(){for(var er=0,tr=this.u;er<tr.length;er++){var ir=tr[er];ir.t()}this.d=2},rr}();function zip(rr,er,tr){tr||(tr=er,er={}),typeof tr!="function"&&err(7);var ir={};fltn(rr,"",ir,er);var nr=Object.keys(ir),sr=nr.length,ar=0,or=0,lr=sr,cr=new Array(sr),ur=[],dr=function(){for(var mr=0;mr<ur.length;++mr)ur[mr]()},hr=function(mr,fr){mt$2(function(){tr(mr,fr)})};mt$2(function(){hr=tr});var pr=function(){var mr=new u8(or+22),fr=ar,_r=or-ar;or=0;for(var Ar=0;Ar<lr;++Ar){var yr=cr[Ar];try{var wr=yr.c.length;wzh(mr,or,yr,yr.f,yr.u,wr);var xr=30+yr.f.length+exfl(yr.extra),Sr=or+xr;mr.set(yr.c,Sr),wzh(mr,ar,yr,yr.f,yr.u,wr,or,yr.m),ar+=16+xr+(yr.m?yr.m.length:0),or=Sr+wr}catch(br){return hr(br,null)}}wzf(mr,ar,cr.length,_r,fr),hr(null,mr)};sr||pr();for(var gr=function(mr){var fr=nr[mr],_r=ir[fr],Ar=_r[0],yr=_r[1],wr=crc(),xr=Ar.length;wr.p(Ar);var Sr=strToU8(fr),br=Sr.length,Cr=yr.comment,Ir=Cr&&strToU8(Cr),Rr=Ir&&Ir.length,Pr=exfl(yr.extra),Dr=yr.level==0?0:8,Fr=function(Or,Nr){if(Or)dr(),hr(Or,null);else{var Ur=Nr.length;cr[mr]=mrg(yr,{size:xr,crc:wr.d(),c:Nr,f:Sr,m:Ir,u:br!=fr.length||Ir&&Cr.length!=Rr,compression:Dr}),ar+=30+br+Pr+Ur,or+=76+2*(br+Pr)+(Rr||0)+Ur,--sr||pr()}};if(br>65535&&Fr(err(11,0,1),null),!Dr)Fr(null,Ar);else if(xr<16e4)try{Fr(null,deflateSync(Ar,yr))}catch(Or){Fr(Or,null)}else ur.push(deflate(Ar,yr,Fr))},vr=0;vr<lr;++vr)gr(vr);return dr}function zipSync(rr,er){er||(er={});var tr={},ir=[];fltn(rr,"",tr,er);var nr=0,sr=0;for(var ar in tr){var or=tr[ar],lr=or[0],cr=or[1],ur=cr.level==0?0:8,dr=strToU8(ar),hr=dr.length,pr=cr.comment,gr=pr&&strToU8(pr),vr=gr&&gr.length,mr=exfl(cr.extra);hr>65535&&err(11);var fr=ur?deflateSync(lr,cr):lr,_r=fr.length,Ar=crc();Ar.p(lr),ir.push(mrg(cr,{size:lr.length,crc:Ar.d(),c:fr,f:dr,m:gr,u:hr!=ar.length||gr&&pr.length!=vr,o:nr,compression:ur})),nr+=30+hr+mr+_r,sr+=76+2*(hr+mr)+(vr||0)+_r}for(var yr=new u8(sr+22),wr=nr,xr=sr-nr,Sr=0;Sr<ir.length;++Sr){var dr=ir[Sr];wzh(yr,dr.o,dr,dr.f,dr.u,dr.c.length);var br=30+dr.f.length+exfl(dr.extra);yr.set(dr.c,dr.o+br),wzh(yr,nr,dr,dr.f,dr.u,dr.c.length,dr.o,dr.m),nr+=16+br+(dr.m?dr.m.length:0)}return wzf(yr,nr,ir.length,xr,wr),yr}var UnzipPassThrough=function(){function rr(){}return rr.prototype.push=function(er,tr){this.ondata(null,er,tr)},rr.compression=0,rr}(),UnzipInflate=function(){function rr(){var er=this;this.i=new Inflate(function(tr,ir){er.ondata(null,tr,ir)})}return rr.prototype.push=function(er,tr){try{this.i.push(er,tr)}catch(ir){this.ondata(ir,null,tr)}},rr.compression=8,rr}(),AsyncUnzipInflate=function(){function rr(er,tr){var ir=this;tr<32e4?this.i=new Inflate(function(nr,sr){ir.ondata(null,nr,sr)}):(this.i=new AsyncInflate(function(nr,sr,ar){ir.ondata(nr,sr,ar)}),this.terminate=this.i.terminate)}return rr.prototype.push=function(er,tr){this.i.terminate&&(er=slc(er,0)),this.i.push(er,tr)},rr.compression=8,rr}(),Unzip=function(){function rr(er){this.onfile=er,this.k=[],this.o={0:UnzipPassThrough},this.p=et$2}return rr.prototype.push=function(er,tr){var ir=this;if(this.onfile||err(5),this.p||err(4),this.c>0){var nr=Math.min(this.c,er.length),sr=er.subarray(0,nr);if(this.c-=nr,this.d?this.d.push(sr,!this.c):this.k[0].push(sr),er=er.subarray(nr),er.length)return this.push(er,tr)}else{var ar=0,or=0,lr=void 0,cr=void 0;this.p.length?er.length?(cr=new u8(this.p.length+er.length),cr.set(this.p),cr.set(er,this.p.length)):cr=this.p:cr=er;for(var ur=cr.length,dr=this.c,hr=dr&&this.d,pr=function(){var fr,_r=b4(cr,or);if(_r==67324752){ar=1,lr=or,gr.d=null,gr.c=0;var Ar=b2(cr,or+6),yr=b2(cr,or+8),wr=Ar&2048,xr=Ar&8,Sr=b2(cr,or+26),br=b2(cr,or+28);if(ur>or+30+Sr+br){var Cr=[];gr.k.unshift(Cr),ar=2;var Ir=b4(cr,or+18),Rr=b4(cr,or+22),Pr=strFromU8(cr.subarray(or+30,or+=30+Sr),!wr);Ir==4294967295?(fr=xr?[-2]:z64e(cr,or),Ir=fr[0],Rr=fr[1]):xr&&(Ir=-1),or+=br,gr.c=Ir;var Dr,Fr={name:Pr,compression:yr,start:function(){if(Fr.ondata||err(5),!Ir)Fr.ondata(null,et$2,!0);else{var Or=ir.o[yr];Or||Fr.ondata(err(14,"unknown compression type "+yr,1),null,!1),Dr=Ir<0?new Or(Pr):new Or(Pr,Ir,Rr),Dr.ondata=function(Wr,Xr,Yr){Fr.ondata(Wr,Xr,Yr)};for(var Nr=0,Ur=Cr;Nr<Ur.length;Nr++){var Br=Ur[Nr];Dr.push(Br,!1)}ir.k[0]==Cr&&ir.c?ir.d=Dr:Dr.push(et$2,!0)}},terminate:function(){Dr&&Dr.terminate&&Dr.terminate()}};Ir>=0&&(Fr.size=Ir,Fr.originalSize=Rr),gr.onfile(Fr)}return"break"}else if(dr){if(_r==134695760)return lr=or+=12+(dr==-2&&8),ar=3,gr.c=0,"break";if(_r==33639248)return lr=or-=4,ar=3,gr.c=0,"break"}},gr=this;or<ur-4;++or){var vr=pr();if(vr==="break")break}if(this.p=et$2,dr<0){var mr=ar?cr.subarray(0,lr-12-(dr==-2&&8)-(b4(cr,lr-16)==134695760&&4)):cr.subarray(0,or);hr?hr.push(mr,!!ar):this.k[+(ar==2)].push(mr)}if(ar&2)return this.push(cr.subarray(or),tr);this.p=cr.subarray(or)}tr&&(this.c&&err(13),this.p=null)},rr.prototype.register=function(er){this.o[er.compression]=er},rr}(),mt$2=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(rr){rr()};function unzip(rr,er,tr){tr||(tr=er,er={}),typeof tr!="function"&&err(7);var ir=[],nr=function(){for(var mr=0;mr<ir.length;++mr)ir[mr]()},sr={},ar=function(mr,fr){mt$2(function(){tr(mr,fr)})};mt$2(function(){ar=tr});for(var or=rr.length-22;b4(rr,or)!=101010256;--or)if(!or||rr.length-or>65558)return ar(err(13,0,1),null),nr;var lr=b2(rr,or+8);if(lr){var cr=lr,ur=b4(rr,or+16),dr=ur==4294967295||cr==65535;if(dr){var hr=b4(rr,or-12);dr=b4(rr,hr)==101075792,dr&&(cr=lr=b4(rr,hr+32),ur=b4(rr,hr+48))}for(var pr=er&&er.filter,gr=function(mr){var fr=zh(rr,ur,dr),_r=fr[0],Ar=fr[1],yr=fr[2],wr=fr[3],xr=fr[4],Sr=fr[5],br=slzh(rr,Sr);ur=xr;var Cr=function(Rr,Pr){Rr?(nr(),ar(Rr,null)):(Pr&&(sr[wr]=Pr),--lr||ar(null,sr))};if(!pr||pr({name:wr,size:Ar,originalSize:yr,compression:_r}))if(!_r)Cr(null,slc(rr,br,br+Ar));else if(_r==8){var Ir=rr.subarray(br,br+Ar);if(yr<524288||Ar>.8*yr)try{Cr(null,inflateSync(Ir,{out:new u8(yr)}))}catch(Rr){Cr(Rr,null)}else ir.push(inflate(Ir,{size:yr},Cr))}else Cr(err(14,"unknown compression type "+_r,1),null);else Cr(null,null)},vr=0;vr<cr;++vr)gr(vr)}else ar(null,{});return nr}function unzipSync(rr,er){for(var tr={},ir=rr.length-22;b4(rr,ir)!=101010256;--ir)(!ir||rr.length-ir>65558)&&err(13);var nr=b2(rr,ir+8);if(!nr)return{};var sr=b4(rr,ir+16),ar=sr==4294967295||nr==65535;if(ar){var or=b4(rr,ir-12);ar=b4(rr,or)==101075792,ar&&(nr=b4(rr,or+32),sr=b4(rr,or+48))}for(var lr=er&&er.filter,cr=0;cr<nr;++cr){var ur=zh(rr,sr,ar),dr=ur[0],hr=ur[1],pr=ur[2],gr=ur[3],vr=ur[4],mr=ur[5],fr=slzh(rr,mr);sr=vr,(!lr||lr({name:gr,size:hr,originalSize:pr,compression:dr}))&&(dr?dr==8?tr[gr]=inflateSync(rr.subarray(fr,fr+hr),{out:new u8(pr)}):err(14,"unknown compression type "+dr):tr[gr]=slc(rr,fr,fr+hr))}return tr}const textEncoder=new TextEncoder,NO_COMPRESSION=0,ZIPS_COMPRESSION=2,ZIP_COMPRESSION=3;class EXRExporter{async parse(er,tr,ir){if(!er||!(er.isWebGLRenderer||er.isWebGPURenderer||er.isDataTexture))throw Error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer or DataTexture.");if(er.isWebGLRenderer||er.isWebGPURenderer){const nr=er,sr=tr,ar=ir;supportedRTT(sr);const or=buildInfoRTT(sr,ar),lr=await getPixelData(nr,sr,or),cr=reorganizeDataBuffer(lr,or),ur=compressData(cr,or);return fillData(ur,or)}else if(er.isDataTexture){const nr=er,sr=tr;supportedDT(nr);const ar=buildInfoDT(nr,sr),or=nr.image.data,lr=reorganizeDataBuffer(or,ar),cr=compressData(lr,ar);return fillData(cr,ar)}}}function supportedRTT(rr){if(!rr||!rr.isRenderTarget)throw Error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget.");if(rr.isWebGLCubeRenderTarget||rr.isWebGL3DRenderTarget||rr.isWebGLArrayRenderTarget)throw Error("EXRExporter.parse: Unsupported render target type, expected instance of WebGLRenderTarget.");if(rr.texture.type!==FloatType&&rr.texture.type!==HalfFloatType)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture type.");if(rr.texture.format!==RGBAFormat)throw Error("EXRExporter.parse: Unsupported WebGLRenderTarget texture format, expected RGBAFormat.")}function supportedDT(rr){if(rr.type!==FloatType&&rr.type!==HalfFloatType)throw Error("EXRExporter.parse: Unsupported DataTexture texture type.");if(rr.format!==RGBAFormat)throw Error("EXRExporter.parse: Unsupported DataTexture texture format, expected RGBAFormat.");if(!rr.image.data)throw Error("EXRExporter.parse: Invalid DataTexture image data.");if(rr.type===FloatType&&rr.image.data.constructor.name!=="Float32Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Float32Array'.");if(rr.type===HalfFloatType&&rr.image.data.constructor.name!=="Uint16Array")throw Error("EXRExporter.parse: DataTexture image data doesn't match type, expected 'Uint16Array'.")}function buildInfoRTT(rr,er={}){const tr={0:1,2:1,3:16},ir=rr.width,nr=rr.height,sr=rr.texture.type,ar=rr.texture.format,or=er.compression!==void 0?er.compression:ZIP_COMPRESSION,lr=er.type!==void 0?er.type:HalfFloatType,cr=lr===FloatType?2:1,ur=tr[or];return{width:ir,height:nr,type:sr,format:ar,compression:or,blockLines:ur,dataType:cr,dataSize:2*cr,numBlocks:Math.ceil(nr/ur),numInputChannels:4,numOutputChannels:4}}function buildInfoDT(rr,er={}){const tr={0:1,2:1,3:16},ir=rr.image.width,nr=rr.image.height,sr=rr.type,ar=rr.format,or=er.compression!==void 0?er.compression:ZIP_COMPRESSION,lr=er.type!==void 0?er.type:HalfFloatType,cr=lr===FloatType?2:1,ur=tr[or];return{width:ir,height:nr,type:sr,format:ar,compression:or,blockLines:ur,dataType:cr,dataSize:2*cr,numBlocks:Math.ceil(nr/ur),numInputChannels:4,numOutputChannels:4}}async function getPixelData(rr,er,tr){let ir;return rr.isWebGLRenderer?(tr.type===FloatType?ir=new Float32Array(tr.width*tr.height*tr.numInputChannels):ir=new Uint16Array(tr.width*tr.height*tr.numInputChannels),await rr.readRenderTargetPixelsAsync(er,0,0,tr.width,tr.height,ir)):ir=await rr.readRenderTargetPixelsAsync(er,0,0,tr.width,tr.height),ir}function reorganizeDataBuffer(rr,er){const tr=er.width,ir=er.height,nr={r:0,g:0,b:0,a:0},sr={value:0},ar=er.numOutputChannels==4?1:0,or=er.type==FloatType?getFloat32:getFloat16,lr=er.dataType==1?setFloat16:setFloat32,cr=new Uint8Array(er.width*er.height*er.numOutputChannels*er.dataSize),ur=new DataView(cr.buffer);for(let dr=0;dr<ir;++dr)for(let hr=0;hr<tr;++hr){const pr=dr*tr*4+hr*4,gr=or(rr,pr),vr=or(rr,pr+1),mr=or(rr,pr+2),fr=or(rr,pr+3),_r=(ir-dr-1)*tr*(3+ar)*er.dataSize;decodeLinear(nr,gr,vr,mr,fr),sr.value=_r+hr*er.dataSize,lr(ur,nr.a,sr),sr.value=_r+ar*tr*er.dataSize+hr*er.dataSize,lr(ur,nr.b,sr),sr.value=_r+(1+ar)*tr*er.dataSize+hr*er.dataSize,lr(ur,nr.g,sr),sr.value=_r+(2+ar)*tr*er.dataSize+hr*er.dataSize,lr(ur,nr.r,sr)}return cr}function compressData(rr,er){let tr,ir,nr=0;const sr={data:new Array,totalSize:0},ar=er.width*er.numOutputChannels*er.blockLines*er.dataSize;switch(er.compression){case 0:tr=compressNONE;break;case 2:case 3:tr=compressZIP;break}er.compression!==0&&(ir=new Uint8Array(ar));for(let or=0;or<er.numBlocks;++or){const lr=rr.subarray(ar*or,ar*(or+1)),cr=tr(lr,ir);nr+=cr.length,sr.data.push({dataChunk:cr,size:cr.length})}return sr.totalSize=nr,sr}function compressNONE(rr){return rr}function compressZIP(rr,er){let tr=0,ir=Math.floor((rr.length+1)/2),nr=0;const sr=rr.length-1;for(;!(nr>sr||(er[tr++]=rr[nr++],nr>sr));)er[ir++]=rr[nr++];let ar=er[0];for(let lr=1;lr<er.length;lr++){const cr=er[lr]-ar+384;ar=er[lr],er[lr]=cr}return zlibSync(er)}function fillHeader(rr,er,tr){const ir={value:0},nr=new DataView(rr.buffer);setUint32(nr,20000630,ir),setUint32(nr,2,ir),setString(nr,"compression",ir),setString(nr,"compression",ir),setUint32(nr,1,ir),setUint8(nr,tr.compression,ir),setString(nr,"screenWindowCenter",ir),setString(nr,"v2f",ir),setUint32(nr,8,ir),setUint32(nr,0,ir),setUint32(nr,0,ir),setString(nr,"screenWindowWidth",ir),setString(nr,"float",ir),setUint32(nr,4,ir),setFloat32(nr,1,ir),setString(nr,"pixelAspectRatio",ir),setString(nr,"float",ir),setUint32(nr,4,ir),setFloat32(nr,1,ir),setString(nr,"lineOrder",ir),setString(nr,"lineOrder",ir),setUint32(nr,1,ir),setUint8(nr,0,ir),setString(nr,"dataWindow",ir),setString(nr,"box2i",ir),setUint32(nr,16,ir),setUint32(nr,0,ir),setUint32(nr,0,ir),setUint32(nr,tr.width-1,ir),setUint32(nr,tr.height-1,ir),setString(nr,"displayWindow",ir),setString(nr,"box2i",ir),setUint32(nr,16,ir),setUint32(nr,0,ir),setUint32(nr,0,ir),setUint32(nr,tr.width-1,ir),setUint32(nr,tr.height-1,ir),setString(nr,"channels",ir),setString(nr,"chlist",ir),setUint32(nr,tr.numOutputChannels*18+1,ir),setString(nr,"A",ir),setUint32(nr,tr.dataType,ir),ir.value+=4,setUint32(nr,1,ir),setUint32(nr,1,ir),setString(nr,"B",ir),setUint32(nr,tr.dataType,ir),ir.value+=4,setUint32(nr,1,ir),setUint32(nr,1,ir),setString(nr,"G",ir),setUint32(nr,tr.dataType,ir),ir.value+=4,setUint32(nr,1,ir),setUint32(nr,1,ir),setString(nr,"R",ir),setUint32(nr,tr.dataType,ir),ir.value+=4,setUint32(nr,1,ir),setUint32(nr,1,ir),setUint8(nr,0,ir),setUint8(nr,0,ir);let sr=ir.value+tr.numBlocks*8;for(let ar=0;ar<er.data.length;++ar)setUint64(nr,sr,ir),sr+=er.data[ar].size+8}function fillData(rr,er){const tr=er.numBlocks*8,ir=259+18*er.numOutputChannels,nr={value:ir+tr},sr=new Uint8Array(ir+tr+rr.totalSize+er.numBlocks*8),ar=new DataView(sr.buffer);fillHeader(sr,rr,er);for(let or=0;or<rr.data.length;++or){const lr=rr.data[or].dataChunk,cr=rr.data[or].size;setUint32(ar,or*er.blockLines,nr),setUint32(ar,cr,nr),sr.set(lr,nr.value),nr.value+=cr}return sr}function decodeLinear(rr,er,tr,ir,nr){rr.r=er,rr.g=tr,rr.b=ir,rr.a=nr}function setUint8(rr,er,tr){rr.setUint8(tr.value,er),tr.value+=1}function setUint32(rr,er,tr){rr.setUint32(tr.value,er,!0),tr.value+=4}function setFloat16(rr,er,tr){rr.setUint16(tr.value,DataUtils.toHalfFloat(er),!0),tr.value+=2}function setFloat32(rr,er,tr){rr.setFloat32(tr.value,er,!0),tr.value+=4}function setUint64(rr,er,tr){rr.setBigUint64(tr.value,BigInt(er),!0),tr.value+=8}function setString(rr,er,tr){const ir=textEncoder.encode(er+"\0");for(let nr=0;nr<ir.length;++nr)setUint8(rr,ir[nr],tr)}function decodeFloat16(rr){const er=(rr&31744)>>10,tr=rr&1023;return(rr>>15?-1:1)*(er?er===31?tr?NaN:1/0:Math.pow(2,er-15)*(1+tr/1024):6103515625e-14*(tr/1024))}function getFloat16(rr,er){return decodeFloat16(rr[er])}function getFloat32(rr,er){return rr[er]}const KHR_mesh_quantization_ExtraAttrTypes={POSITION:["byte","byte normalized","unsigned byte","unsigned byte normalized","short","short normalized","unsigned short","unsigned short normalized"],NORMAL:["byte normalized","short normalized"],TANGENT:["byte normalized","short normalized"],TEXCOORD:["byte","byte normalized","unsigned byte","short","short normalized","unsigned short"]};class GLTFExporter{constructor(){this.textureUtils=null,this.pluginCallbacks=[],this.register(function(er){return new GLTFLightExtension(er)}),this.register(function(er){return new GLTFMaterialsUnlitExtension$1(er)}),this.register(function(er){return new GLTFMaterialsTransmissionExtension$1(er)}),this.register(function(er){return new GLTFMaterialsVolumeExtension$1(er)}),this.register(function(er){return new GLTFMaterialsIorExtension$1(er)}),this.register(function(er){return new GLTFMaterialsSpecularExtension$1(er)}),this.register(function(er){return new GLTFMaterialsClearcoatExtension$1(er)}),this.register(function(er){return new GLTFMaterialsDispersionExtension$1(er)}),this.register(function(er){return new GLTFMaterialsIridescenceExtension$1(er)}),this.register(function(er){return new GLTFMaterialsSheenExtension$1(er)}),this.register(function(er){return new GLTFMaterialsAnisotropyExtension$1(er)}),this.register(function(er){return new GLTFMaterialsEmissiveStrengthExtension$1(er)}),this.register(function(er){return new GLTFMaterialsBumpExtension$1(er)}),this.register(function(er){return new GLTFMeshGpuInstancing$1(er)})}register(er){return this.pluginCallbacks.indexOf(er)===-1&&this.pluginCallbacks.push(er),this}unregister(er){return this.pluginCallbacks.indexOf(er)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(er),1),this}setTextureUtils(er){return this.textureUtils=er,this}parse(er,tr,ir,nr){const sr=new GLTFWriter,ar=[];for(let or=0,lr=this.pluginCallbacks.length;or<lr;or++)ar.push(this.pluginCallbacks[or](sr));sr.setPlugins(ar),sr.setTextureUtils(this.textureUtils),sr.writeAsync(er,tr,nr).catch(ir)}parseAsync(er,tr){const ir=this;return new Promise(function(nr,sr){ir.parse(er,nr,sr,tr)})}}const WEBGL_CONSTANTS$1={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},KHR_MESH_QUANTIZATION="KHR_mesh_quantization",THREE_TO_WEBGL={};THREE_TO_WEBGL[NearestFilter]=WEBGL_CONSTANTS$1.NEAREST;THREE_TO_WEBGL[NearestMipmapNearestFilter]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_NEAREST;THREE_TO_WEBGL[NearestMipmapLinearFilter]=WEBGL_CONSTANTS$1.NEAREST_MIPMAP_LINEAR;THREE_TO_WEBGL[LinearFilter]=WEBGL_CONSTANTS$1.LINEAR;THREE_TO_WEBGL[LinearMipmapNearestFilter]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_NEAREST;THREE_TO_WEBGL[LinearMipmapLinearFilter]=WEBGL_CONSTANTS$1.LINEAR_MIPMAP_LINEAR;THREE_TO_WEBGL[ClampToEdgeWrapping]=WEBGL_CONSTANTS$1.CLAMP_TO_EDGE;THREE_TO_WEBGL[RepeatWrapping]=WEBGL_CONSTANTS$1.REPEAT;THREE_TO_WEBGL[MirroredRepeatWrapping]=WEBGL_CONSTANTS$1.MIRRORED_REPEAT;const PATH_PROPERTIES$1={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"},DEFAULT_SPECULAR_COLOR=new Color,GLB_HEADER_BYTES=12,GLB_HEADER_MAGIC=1179937895,GLB_VERSION=2,GLB_CHUNK_PREFIX_BYTES=8,GLB_CHUNK_TYPE_JSON=1313821514,GLB_CHUNK_TYPE_BIN=5130562;function equalArray(rr,er){return rr.length===er.length&&rr.every(function(tr,ir){return tr===er[ir]})}function stringToArrayBuffer(rr){return new TextEncoder().encode(rr).buffer}function isIdentityMatrix(rr){return equalArray(rr.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}function getMinMax(rr,er,tr){const ir={min:new Array(rr.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(rr.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let nr=er;nr<er+tr;nr++)for(let sr=0;sr<rr.itemSize;sr++){let ar;rr.itemSize>4?ar=rr.array[nr*rr.itemSize+sr]:(sr===0?ar=rr.getX(nr):sr===1?ar=rr.getY(nr):sr===2?ar=rr.getZ(nr):sr===3&&(ar=rr.getW(nr)),rr.normalized===!0&&(ar=MathUtils.normalize(ar,rr.array))),ir.min[sr]=Math.min(ir.min[sr],ar),ir.max[sr]=Math.max(ir.max[sr],ar)}return ir}function getPaddedBufferSize(rr){return Math.ceil(rr/4)*4}function getPaddedArrayBuffer(rr,er=0){const tr=getPaddedBufferSize(rr.byteLength);if(tr!==rr.byteLength){const ir=new Uint8Array(tr);if(ir.set(new Uint8Array(rr)),er!==0)for(let nr=rr.byteLength;nr<tr;nr++)ir[nr]=er;return ir.buffer}return rr}function getCanvas(){return typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas")}function getToBlobPromise(rr,er){if(rr.toBlob!==void 0)return new Promise(ir=>rr.toBlob(ir,er));let tr;return er==="image/jpeg"?tr=.92:er==="image/webp"&&(tr=.8),rr.convertToBlob({type:er,quality:tr})}class GLTFWriter{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.extensionsRequired={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter r"+REVISION}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map},this.textureUtils=null}setPlugins(er){this.plugins=er}setTextureUtils(er){this.textureUtils=er}async writeAsync(er,tr,ir={}){this.options=Object.assign({binary:!1,trs:!1,onlyVisible:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},ir),this.options.animations.length>0&&(this.options.trs=!0),await this.processInputAsync(er),await Promise.all(this.pending);const nr=this,sr=nr.buffers,ar=nr.json;ir=nr.options;const or=nr.extensionsUsed,lr=nr.extensionsRequired,cr=new Blob(sr,{type:"application/octet-stream"}),ur=Object.keys(or),dr=Object.keys(lr);if(ur.length>0&&(ar.extensionsUsed=ur),dr.length>0&&(ar.extensionsRequired=dr),ar.buffers&&ar.buffers.length>0&&(ar.buffers[0].byteLength=cr.size),ir.binary===!0){const hr=new FileReader;hr.readAsArrayBuffer(cr),hr.onloadend=function(){const pr=getPaddedArrayBuffer(hr.result),gr=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));gr.setUint32(0,pr.byteLength,!0),gr.setUint32(4,GLB_CHUNK_TYPE_BIN,!0);const vr=getPaddedArrayBuffer(stringToArrayBuffer(JSON.stringify(ar)),32),mr=new DataView(new ArrayBuffer(GLB_CHUNK_PREFIX_BYTES));mr.setUint32(0,vr.byteLength,!0),mr.setUint32(4,GLB_CHUNK_TYPE_JSON,!0);const fr=new ArrayBuffer(GLB_HEADER_BYTES),_r=new DataView(fr);_r.setUint32(0,GLB_HEADER_MAGIC,!0),_r.setUint32(4,GLB_VERSION,!0);const Ar=GLB_HEADER_BYTES+mr.byteLength+vr.byteLength+gr.byteLength+pr.byteLength;_r.setUint32(8,Ar,!0);const yr=new Blob([fr,mr,vr,gr,pr],{type:"application/octet-stream"}),wr=new FileReader;wr.readAsArrayBuffer(yr),wr.onloadend=function(){tr(wr.result)}}}else if(ar.buffers&&ar.buffers.length>0){const hr=new FileReader;hr.readAsDataURL(cr),hr.onloadend=function(){const pr=hr.result;ar.buffers[0].uri=pr,tr(ar)}}else tr(ar)}serializeUserData(er,tr){if(Object.keys(er.userData).length===0)return;const ir=this.options,nr=this.extensionsUsed;try{const sr=JSON.parse(JSON.stringify(er.userData));if(ir.includeCustomExtensions&&sr.gltfExtensions){tr.extensions===void 0&&(tr.extensions={});for(const ar in sr.gltfExtensions)tr.extensions[ar]=sr.gltfExtensions[ar],nr[ar]=!0;delete sr.gltfExtensions}Object.keys(sr).length>0&&(tr.extras=sr)}catch(sr){console.warn("THREE.GLTFExporter: userData of '"+er.name+"' won't be serialized because of JSON.stringify error - "+sr.message)}}getUID(er,tr=!1){if(this.uids.has(er)===!1){const nr=new Map;nr.set(!0,this.uid++),nr.set(!1,this.uid++),this.uids.set(er,nr)}return this.uids.get(er).get(tr)}isNormalizedNormalAttribute(er){if(this.cache.attributesNormalized.has(er))return!1;const ir=new Vector3$1;for(let nr=0,sr=er.count;nr<sr;nr++)if(Math.abs(ir.fromBufferAttribute(er,nr).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(er){const tr=this.cache;if(tr.attributesNormalized.has(er))return tr.attributesNormalized.get(er);const ir=er.clone(),nr=new Vector3$1;for(let sr=0,ar=ir.count;sr<ar;sr++)nr.fromBufferAttribute(ir,sr),nr.x===0&&nr.y===0&&nr.z===0?nr.setX(1):nr.normalize(),ir.setXYZ(sr,nr.x,nr.y,nr.z);return tr.attributesNormalized.set(er,ir),ir}applyTextureTransform(er,tr){let ir=!1;const nr={};(tr.offset.x!==0||tr.offset.y!==0)&&(nr.offset=tr.offset.toArray(),ir=!0),tr.rotation!==0&&(nr.rotation=tr.rotation,ir=!0),(tr.repeat.x!==1||tr.repeat.y!==1)&&(nr.scale=tr.repeat.toArray(),ir=!0),ir&&(er.extensions=er.extensions||{},er.extensions.KHR_texture_transform=nr,this.extensionsUsed.KHR_texture_transform=!0)}async buildMetalRoughTextureAsync(er,tr){if(er===tr)return er;function ir(pr){return pr.colorSpace===SRGBColorSpace?function(vr){return vr<.04045?vr*.0773993808:Math.pow(vr*.9478672986+.0521327014,2.4)}:function(vr){return vr}}er instanceof CompressedTexture&&(er=await this.decompressTextureAsync(er)),tr instanceof CompressedTexture&&(tr=await this.decompressTextureAsync(tr));const nr=er?er.image:null,sr=tr?tr.image:null,ar=Math.max(nr?nr.width:0,sr?sr.width:0),or=Math.max(nr?nr.height:0,sr?sr.height:0),lr=getCanvas();lr.width=ar,lr.height=or;const cr=lr.getContext("2d",{willReadFrequently:!0});cr.fillStyle="#00ffff",cr.fillRect(0,0,ar,or);const ur=cr.getImageData(0,0,ar,or);if(nr){cr.drawImage(nr,0,0,ar,or);const pr=ir(er),gr=cr.getImageData(0,0,ar,or).data;for(let vr=2;vr<gr.length;vr+=4)ur.data[vr]=pr(gr[vr]/256)*256}if(sr){cr.drawImage(sr,0,0,ar,or);const pr=ir(tr),gr=cr.getImageData(0,0,ar,or).data;for(let vr=1;vr<gr.length;vr+=4)ur.data[vr]=pr(gr[vr]/256)*256}cr.putImageData(ur,0,0);const hr=(er||tr).clone();return hr.source=new Source(lr),hr.colorSpace=NoColorSpace,hr.channel=(er||tr).channel,er&&tr&&er.channel!==tr.channel&&console.warn("THREE.GLTFExporter: UV channels for metalnessMap and roughnessMap textures must match."),console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures."),hr}async decompressTextureAsync(er,tr=1/0){if(this.textureUtils===null)throw new Error("THREE.GLTFExporter: setTextureUtils() must be called to process compressed textures.");return await this.textureUtils.decompress(er,tr)}processBuffer(er){const tr=this.json,ir=this.buffers;return tr.buffers||(tr.buffers=[{byteLength:0}]),ir.push(er),0}processBufferView(er,tr,ir,nr,sr){const ar=this.json;ar.bufferViews||(ar.bufferViews=[]);let or;switch(tr){case WEBGL_CONSTANTS$1.BYTE:case WEBGL_CONSTANTS$1.UNSIGNED_BYTE:or=1;break;case WEBGL_CONSTANTS$1.SHORT:case WEBGL_CONSTANTS$1.UNSIGNED_SHORT:or=2;break;default:or=4}let lr=er.itemSize*or;sr===WEBGL_CONSTANTS$1.ARRAY_BUFFER&&(lr=Math.ceil(lr/4)*4);const cr=getPaddedBufferSize(nr*lr),ur=new DataView(new ArrayBuffer(cr));let dr=0;for(let gr=ir;gr<ir+nr;gr++){for(let vr=0;vr<er.itemSize;vr++){let mr;er.itemSize>4?mr=er.array[gr*er.itemSize+vr]:(vr===0?mr=er.getX(gr):vr===1?mr=er.getY(gr):vr===2?mr=er.getZ(gr):vr===3&&(mr=er.getW(gr)),er.normalized===!0&&(mr=MathUtils.normalize(mr,er.array))),tr===WEBGL_CONSTANTS$1.FLOAT?ur.setFloat32(dr,mr,!0):tr===WEBGL_CONSTANTS$1.INT?ur.setInt32(dr,mr,!0):tr===WEBGL_CONSTANTS$1.UNSIGNED_INT?ur.setUint32(dr,mr,!0):tr===WEBGL_CONSTANTS$1.SHORT?ur.setInt16(dr,mr,!0):tr===WEBGL_CONSTANTS$1.UNSIGNED_SHORT?ur.setUint16(dr,mr,!0):tr===WEBGL_CONSTANTS$1.BYTE?ur.setInt8(dr,mr):tr===WEBGL_CONSTANTS$1.UNSIGNED_BYTE&&ur.setUint8(dr,mr),dr+=or}dr%lr!==0&&(dr+=lr-dr%lr)}const hr={buffer:this.processBuffer(ur.buffer),byteOffset:this.byteOffset,byteLength:cr};return sr!==void 0&&(hr.target=sr),sr===WEBGL_CONSTANTS$1.ARRAY_BUFFER&&(hr.byteStride=lr),this.byteOffset+=cr,ar.bufferViews.push(hr),{id:ar.bufferViews.length-1,byteLength:0}}processBufferViewImage(er){const tr=this,ir=tr.json;return ir.bufferViews||(ir.bufferViews=[]),new Promise(function(nr){const sr=new FileReader;sr.readAsArrayBuffer(er),sr.onloadend=function(){const ar=getPaddedArrayBuffer(sr.result),or={buffer:tr.processBuffer(ar),byteOffset:tr.byteOffset,byteLength:ar.byteLength};tr.byteOffset+=ar.byteLength,nr(ir.bufferViews.push(or)-1)}})}processAccessor(er,tr,ir,nr){const sr=this.json,ar={1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",9:"MAT3",16:"MAT4"};let or;if(er.array.constructor===Float32Array)or=WEBGL_CONSTANTS$1.FLOAT;else if(er.array.constructor===Int32Array)or=WEBGL_CONSTANTS$1.INT;else if(er.array.constructor===Uint32Array)or=WEBGL_CONSTANTS$1.UNSIGNED_INT;else if(er.array.constructor===Int16Array)or=WEBGL_CONSTANTS$1.SHORT;else if(er.array.constructor===Uint16Array)or=WEBGL_CONSTANTS$1.UNSIGNED_SHORT;else if(er.array.constructor===Int8Array)or=WEBGL_CONSTANTS$1.BYTE;else if(er.array.constructor===Uint8Array)or=WEBGL_CONSTANTS$1.UNSIGNED_BYTE;else throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type: "+er.array.constructor.name);if(ir===void 0&&(ir=0),(nr===void 0||nr===1/0)&&(nr=er.count),nr===0)return null;const lr=getMinMax(er,ir,nr);let cr;tr!==void 0&&(cr=er===tr.index?WEBGL_CONSTANTS$1.ELEMENT_ARRAY_BUFFER:WEBGL_CONSTANTS$1.ARRAY_BUFFER);const ur=this.processBufferView(er,or,ir,nr,cr),dr={bufferView:ur.id,byteOffset:ur.byteOffset,componentType:or,count:nr,max:lr.max,min:lr.min,type:ar[er.itemSize]};return er.normalized===!0&&(dr.normalized=!0),sr.accessors||(sr.accessors=[]),sr.accessors.push(dr)-1}processImage(er,tr,ir,nr="image/png"){if(er!==null){const sr=this,ar=sr.cache,or=sr.json,lr=sr.options,cr=sr.pending;ar.images.has(er)||ar.images.set(er,{});const ur=ar.images.get(er),dr=nr+":flipY/"+ir.toString();if(ur[dr]!==void 0)return ur[dr];or.images||(or.images=[]);const hr={mimeType:nr},pr=getCanvas();pr.width=Math.min(er.width,lr.maxTextureSize),pr.height=Math.min(er.height,lr.maxTextureSize);const gr=pr.getContext("2d",{willReadFrequently:!0});if(ir===!0&&(gr.translate(0,pr.height),gr.scale(1,-1)),er.data!==void 0){tr!==RGBAFormat&&console.error("GLTFExporter: Only RGBAFormat is supported.",tr),(er.width>lr.maxTextureSize||er.height>lr.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",er);const mr=new Uint8ClampedArray(er.height*er.width*4);for(let fr=0;fr<mr.length;fr+=4)mr[fr+0]=er.data[fr+0],mr[fr+1]=er.data[fr+1],mr[fr+2]=er.data[fr+2],mr[fr+3]=er.data[fr+3];gr.putImageData(new ImageData(mr,er.width,er.height),0,0)}else if(typeof HTMLImageElement<"u"&&er instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&er instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&er instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&er instanceof OffscreenCanvas)gr.drawImage(er,0,0,pr.width,pr.height);else throw new Error("THREE.GLTFExporter: Invalid image type. Use HTMLImageElement, HTMLCanvasElement, ImageBitmap or OffscreenCanvas.");lr.binary===!0?cr.push(getToBlobPromise(pr,nr).then(mr=>sr.processBufferViewImage(mr)).then(mr=>{hr.bufferView=mr})):pr.toDataURL!==void 0?hr.uri=pr.toDataURL(nr):cr.push(getToBlobPromise(pr,nr).then(mr=>new FileReader().readAsDataURL(mr)).then(mr=>{hr.uri=mr}));const vr=or.images.push(hr)-1;return ur[dr]=vr,vr}else throw new Error("THREE.GLTFExporter: No valid image data found. Unable to process texture.")}processSampler(er){const tr=this.json;tr.samplers||(tr.samplers=[]);const ir={magFilter:THREE_TO_WEBGL[er.magFilter],minFilter:THREE_TO_WEBGL[er.minFilter],wrapS:THREE_TO_WEBGL[er.wrapS],wrapT:THREE_TO_WEBGL[er.wrapT]};return tr.samplers.push(ir)-1}async processTextureAsync(er){const ir=this.options,nr=this.cache,sr=this.json;if(nr.textures.has(er))return nr.textures.get(er);sr.textures||(sr.textures=[]),er instanceof CompressedTexture&&(er=await this.decompressTextureAsync(er,ir.maxTextureSize));let ar=er.userData.mimeType;ar==="image/webp"&&(ar="image/png");const or={sampler:this.processSampler(er),source:this.processImage(er.image,er.format,er.flipY,ar)};er.name&&(or.name=er.name),await this._invokeAllAsync(async function(cr){cr.writeTexture&&await cr.writeTexture(er,or)});const lr=sr.textures.push(or)-1;return nr.textures.set(er,lr),lr}async processMaterialAsync(er){const tr=this.cache,ir=this.json;if(tr.materials.has(er))return tr.materials.get(er);if(er.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;ir.materials||(ir.materials=[]);const nr={pbrMetallicRoughness:{}};er.isMeshStandardMaterial!==!0&&er.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const sr=er.color.toArray().concat([er.opacity]);if(equalArray(sr,[1,1,1,1])||(nr.pbrMetallicRoughness.baseColorFactor=sr),er.isMeshStandardMaterial?(nr.pbrMetallicRoughness.metallicFactor=er.metalness,nr.pbrMetallicRoughness.roughnessFactor=er.roughness):(nr.pbrMetallicRoughness.metallicFactor=0,nr.pbrMetallicRoughness.roughnessFactor=1),er.metalnessMap||er.roughnessMap){const or=await this.buildMetalRoughTextureAsync(er.metalnessMap,er.roughnessMap),lr={index:await this.processTextureAsync(or),texCoord:or.channel};this.applyTextureTransform(lr,or),nr.pbrMetallicRoughness.metallicRoughnessTexture=lr}if(er.map){const or={index:await this.processTextureAsync(er.map),texCoord:er.map.channel};this.applyTextureTransform(or,er.map),nr.pbrMetallicRoughness.baseColorTexture=or}if(er.emissive){const or=er.emissive;if(Math.max(or.r,or.g,or.b)>0&&(nr.emissiveFactor=er.emissive.toArray()),er.emissiveMap){const cr={index:await this.processTextureAsync(er.emissiveMap),texCoord:er.emissiveMap.channel};this.applyTextureTransform(cr,er.emissiveMap),nr.emissiveTexture=cr}}if(er.normalMap){const or={index:await this.processTextureAsync(er.normalMap),texCoord:er.normalMap.channel};er.normalScale&&er.normalScale.x!==1&&(or.scale=er.normalScale.x),this.applyTextureTransform(or,er.normalMap),nr.normalTexture=or}if(er.aoMap){const or={index:await this.processTextureAsync(er.aoMap),texCoord:er.aoMap.channel};er.aoMapIntensity!==1&&(or.strength=er.aoMapIntensity),this.applyTextureTransform(or,er.aoMap),nr.occlusionTexture=or}er.transparent?nr.alphaMode="BLEND":er.alphaTest>0&&(nr.alphaMode="MASK",nr.alphaCutoff=er.alphaTest),er.side===DoubleSide&&(nr.doubleSided=!0),er.name!==""&&(nr.name=er.name),this.serializeUserData(er,nr),await this._invokeAllAsync(async function(or){or.writeMaterialAsync&&await or.writeMaterialAsync(er,nr)});const ar=ir.materials.push(nr)-1;return tr.materials.set(er,ar),ar}async processMeshAsync(er){const tr=this.cache,ir=this.json,nr=[er.geometry.uuid];if(Array.isArray(er.material))for(let yr=0,wr=er.material.length;yr<wr;yr++)nr.push(er.material[yr].uuid);else nr.push(er.material.uuid);const sr=nr.join(":");if(tr.meshes.has(sr))return tr.meshes.get(sr);const ar=er.geometry;let or;er.isLineSegments?or=WEBGL_CONSTANTS$1.LINES:er.isLineLoop?or=WEBGL_CONSTANTS$1.LINE_LOOP:er.isLine?or=WEBGL_CONSTANTS$1.LINE_STRIP:er.isPoints?or=WEBGL_CONSTANTS$1.POINTS:or=er.material.wireframe?WEBGL_CONSTANTS$1.LINES:WEBGL_CONSTANTS$1.TRIANGLES;const lr={},cr={},ur=[],dr=[],hr={uv:"TEXCOORD_0",uv1:"TEXCOORD_1",uv2:"TEXCOORD_2",uv3:"TEXCOORD_3",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},pr=ar.getAttribute("normal");pr!==void 0&&!this.isNormalizedNormalAttribute(pr)&&(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),ar.setAttribute("normal",this.createNormalizedNormalAttribute(pr)));let gr=null;for(let yr in ar.attributes){if(yr.slice(0,5)==="morph")continue;const wr=ar.attributes[yr];if(yr=hr[yr]||yr.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(yr)||(yr="_"+yr),tr.attributes.has(this.getUID(wr))){cr[yr]=tr.attributes.get(this.getUID(wr));continue}gr=null;const Sr=wr.array;yr==="JOINTS_0"&&!(Sr instanceof Uint16Array)&&!(Sr instanceof Uint8Array)?(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),gr=new BufferAttribute(new Uint16Array(Sr),wr.itemSize,wr.normalized)):(Sr instanceof Uint32Array||Sr instanceof Int32Array)&&!yr.startsWith("_")&&(console.warn(`GLTFExporter: Attribute "${yr}" converted to type FLOAT.`),gr=GLTFExporter.Utils.toFloat32BufferAttribute(wr));const br=this.processAccessor(gr||wr,ar);br!==null&&(yr.startsWith("_")||this.detectMeshQuantization(yr,wr),cr[yr]=br,tr.attributes.set(this.getUID(wr),br))}if(pr!==void 0&&ar.setAttribute("normal",pr),Object.keys(cr).length===0)return null;if(er.morphTargetInfluences!==void 0&&er.morphTargetInfluences.length>0){const yr=[],wr=[],xr={};if(er.morphTargetDictionary!==void 0)for(const Sr in er.morphTargetDictionary)xr[er.morphTargetDictionary[Sr]]=Sr;for(let Sr=0;Sr<er.morphTargetInfluences.length;++Sr){const br={};let Cr=!1;for(const Ir in ar.morphAttributes){if(Ir!=="position"&&Ir!=="normal"){Cr||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),Cr=!0);continue}const Rr=ar.morphAttributes[Ir][Sr],Pr=Ir.toUpperCase(),Dr=ar.attributes[Ir];if(tr.attributes.has(this.getUID(Rr,!0))){br[Pr]=tr.attributes.get(this.getUID(Rr,!0));continue}const Fr=Rr.clone();if(!ar.morphTargetsRelative)for(let Or=0,Nr=Rr.count;Or<Nr;Or++)for(let Ur=0;Ur<Rr.itemSize;Ur++)Ur===0&&Fr.setX(Or,Rr.getX(Or)-Dr.getX(Or)),Ur===1&&Fr.setY(Or,Rr.getY(Or)-Dr.getY(Or)),Ur===2&&Fr.setZ(Or,Rr.getZ(Or)-Dr.getZ(Or)),Ur===3&&Fr.setW(Or,Rr.getW(Or)-Dr.getW(Or));br[Pr]=this.processAccessor(Fr,ar),tr.attributes.set(this.getUID(Dr,!0),br[Pr])}dr.push(br),yr.push(er.morphTargetInfluences[Sr]),er.morphTargetDictionary!==void 0&&wr.push(xr[Sr])}lr.weights=yr,wr.length>0&&(lr.extras={},lr.extras.targetNames=wr)}const vr=Array.isArray(er.material);if(vr&&ar.groups.length===0)return null;let mr=!1;if(vr&&ar.index===null){const yr=[];for(let wr=0,xr=ar.attributes.position.count;wr<xr;wr++)yr[wr]=wr;ar.setIndex(yr),mr=!0}const fr=vr?er.material:[er.material],_r=vr?ar.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let yr=0,wr=_r.length;yr<wr;yr++){const xr={mode:or,attributes:cr};if(this.serializeUserData(ar,xr),dr.length>0&&(xr.targets=dr),ar.index!==null){let br=this.getUID(ar.index);(_r[yr].start!==void 0||_r[yr].count!==void 0)&&(br+=":"+_r[yr].start+":"+_r[yr].count),tr.attributes.has(br)?xr.indices=tr.attributes.get(br):(xr.indices=this.processAccessor(ar.index,ar,_r[yr].start,_r[yr].count),tr.attributes.set(br,xr.indices)),xr.indices===null&&delete xr.indices}const Sr=await this.processMaterialAsync(fr[_r[yr].materialIndex]);Sr!==null&&(xr.material=Sr),ur.push(xr)}mr===!0&&ar.setIndex(null),lr.primitives=ur,ir.meshes||(ir.meshes=[]),await this._invokeAllAsync(function(yr){yr.writeMesh&&yr.writeMesh(er,lr)});const Ar=ir.meshes.push(lr)-1;return tr.meshes.set(sr,Ar),Ar}detectMeshQuantization(er,tr){if(this.extensionsUsed[KHR_MESH_QUANTIZATION])return;let ir;switch(tr.array.constructor){case Int8Array:ir="byte";break;case Uint8Array:ir="unsigned byte";break;case Int16Array:ir="short";break;case Uint16Array:ir="unsigned short";break;default:return}tr.normalized&&(ir+=" normalized");const nr=er.split("_",1)[0];KHR_mesh_quantization_ExtraAttrTypes[nr]&&KHR_mesh_quantization_ExtraAttrTypes[nr].includes(ir)&&(this.extensionsUsed[KHR_MESH_QUANTIZATION]=!0,this.extensionsRequired[KHR_MESH_QUANTIZATION]=!0)}processCamera(er){const tr=this.json;tr.cameras||(tr.cameras=[]);const ir=er.isOrthographicCamera,nr={type:ir?"orthographic":"perspective"};return ir?nr.orthographic={xmag:er.right*2,ymag:er.top*2,zfar:er.far<=0?.001:er.far,znear:er.near<0?0:er.near}:nr.perspective={aspectRatio:er.aspect,yfov:MathUtils.degToRad(er.fov),zfar:er.far<=0?.001:er.far,znear:er.near<0?0:er.near},er.name!==""&&(nr.name=er.type),tr.cameras.push(nr)-1}processAnimation(er,tr){const ir=this.json,nr=this.nodeMap;ir.animations||(ir.animations=[]),er=GLTFExporter.Utils.mergeMorphTargetTracks(er.clone(),tr);const sr=er.tracks,ar=[],or=[];for(let lr=0;lr<sr.length;++lr){const cr=sr[lr],ur=PropertyBinding.parseTrackName(cr.name);let dr=PropertyBinding.findNode(tr,ur.nodeName);const hr=PATH_PROPERTIES$1[ur.propertyName];if(ur.objectName==="bones"&&(dr.isSkinnedMesh===!0?dr=dr.skeleton.getBoneByName(ur.objectIndex):dr=void 0),!dr||!hr){console.warn('THREE.GLTFExporter: Could not export animation track "%s".',cr.name);continue}const pr=1;let gr=cr.values.length/cr.times.length;hr===PATH_PROPERTIES$1.morphTargetInfluences&&(gr/=dr.morphTargetInfluences.length);let vr;cr.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(vr="CUBICSPLINE",gr/=3):cr.getInterpolation()===InterpolateDiscrete?vr="STEP":vr="LINEAR",or.push({input:this.processAccessor(new BufferAttribute(cr.times,pr)),output:this.processAccessor(new BufferAttribute(cr.values,gr)),interpolation:vr}),ar.push({sampler:or.length-1,target:{node:nr.get(dr),path:hr}})}return ir.animations.push({name:er.name||"clip_"+ir.animations.length,samplers:or,channels:ar}),ir.animations.length-1}processSkin(er){const tr=this.json,ir=this.nodeMap,nr=tr.nodes[ir.get(er)],sr=er.skeleton;if(sr===void 0)return null;const ar=er.skeleton.bones[0];if(ar===void 0)return null;const or=[],lr=new Float32Array(sr.bones.length*16),cr=new Matrix4;for(let dr=0;dr<sr.bones.length;++dr)or.push(ir.get(sr.bones[dr])),cr.copy(sr.boneInverses[dr]),cr.multiply(er.bindMatrix).toArray(lr,dr*16);return tr.skins===void 0&&(tr.skins=[]),tr.skins.push({inverseBindMatrices:this.processAccessor(new BufferAttribute(lr,16)),joints:or,skeleton:ir.get(ar)}),nr.skin=tr.skins.length-1}async processNodeAsync(er){const tr=this.json,ir=this.options,nr=this.nodeMap;tr.nodes||(tr.nodes=[]);const sr={};if(ir.trs){const or=er.quaternion.toArray(),lr=er.position.toArray(),cr=er.scale.toArray();equalArray(or,[0,0,0,1])||(sr.rotation=or),equalArray(lr,[0,0,0])||(sr.translation=lr),equalArray(cr,[1,1,1])||(sr.scale=cr)}else er.matrixAutoUpdate&&er.updateMatrix(),isIdentityMatrix(er.matrix)===!1&&(sr.matrix=er.matrix.elements);if(er.name!==""&&(sr.name=String(er.name)),this.serializeUserData(er,sr),er.isMesh||er.isLine||er.isPoints){const or=await this.processMeshAsync(er);or!==null&&(sr.mesh=or)}else er.isCamera&&(sr.camera=this.processCamera(er));if(er.isSkinnedMesh&&this.skins.push(er),er.children.length>0){const or=[];for(let lr=0,cr=er.children.length;lr<cr;lr++){const ur=er.children[lr];if(ur.visible||ir.onlyVisible===!1){const dr=await this.processNodeAsync(ur);dr!==null&&or.push(dr)}}or.length>0&&(sr.children=or)}await this._invokeAllAsync(function(or){or.writeNode&&or.writeNode(er,sr)});const ar=tr.nodes.push(sr)-1;return nr.set(er,ar),ar}async processSceneAsync(er){const tr=this.json,ir=this.options;tr.scenes||(tr.scenes=[],tr.scene=0);const nr={};er.name!==""&&(nr.name=er.name),tr.scenes.push(nr);const sr=[];for(let ar=0,or=er.children.length;ar<or;ar++){const lr=er.children[ar];if(lr.visible||ir.onlyVisible===!1){const cr=await this.processNodeAsync(lr);cr!==null&&sr.push(cr)}}sr.length>0&&(nr.nodes=sr),this.serializeUserData(er,nr)}async processObjectsAsync(er){const tr=new Scene;tr.name="AuxScene";for(let ir=0;ir<er.length;ir++)tr.children.push(er[ir]);await this.processSceneAsync(tr)}async processInputAsync(er){const tr=this.options;er=er instanceof Array?er:[er],await this._invokeAllAsync(function(nr){nr.beforeParse&&nr.beforeParse(er)});const ir=[];for(let nr=0;nr<er.length;nr++)er[nr]instanceof Scene?await this.processSceneAsync(er[nr]):ir.push(er[nr]);ir.length>0&&await this.processObjectsAsync(ir);for(let nr=0;nr<this.skins.length;++nr)this.processSkin(this.skins[nr]);for(let nr=0;nr<tr.animations.length;++nr)this.processAnimation(tr.animations[nr],er[0]);await this._invokeAllAsync(function(nr){nr.afterParse&&nr.afterParse(er)})}async _invokeAllAsync(er){for(let tr=0,ir=this.plugins.length;tr<ir;tr++)await er(this.plugins[tr])}}class GLTFLightExtension{constructor(er){this.writer=er,this.name="KHR_lights_punctual"}writeNode(er,tr){if(!er.isLight)return;if(!er.isDirectionalLight&&!er.isPointLight&&!er.isSpotLight){console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",er);return}const ir=this.writer,nr=ir.json,sr=ir.extensionsUsed,ar={};er.name&&(ar.name=er.name),ar.color=er.color.toArray(),ar.intensity=er.intensity,er.isDirectionalLight?ar.type="directional":er.isPointLight?(ar.type="point",er.distance>0&&(ar.range=er.distance)):er.isSpotLight&&(ar.type="spot",er.distance>0&&(ar.range=er.distance),ar.spot={},ar.spot.innerConeAngle=(1-er.penumbra)*er.angle,ar.spot.outerConeAngle=er.angle),er.decay!==void 0&&er.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),er.target&&(er.target.parent!==er||er.target.position.x!==0||er.target.position.y!==0||er.target.position.z!==-1)&&console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),sr[this.name]||(nr.extensions=nr.extensions||{},nr.extensions[this.name]={lights:[]},sr[this.name]=!0);const or=nr.extensions[this.name].lights;or.push(ar),tr.extensions=tr.extensions||{},tr.extensions[this.name]={light:or.length-1}}}let GLTFMaterialsUnlitExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_unlit"}async writeMaterialAsync(er,tr){if(!er.isMeshBasicMaterial)return;const nr=this.writer.extensionsUsed;tr.extensions=tr.extensions||{},tr.extensions[this.name]={},nr[this.name]=!0,tr.pbrMetallicRoughness.metallicFactor=0,tr.pbrMetallicRoughness.roughnessFactor=.9}},GLTFMaterialsClearcoatExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_clearcoat"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.clearcoat===0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(sr.clearcoatFactor=er.clearcoat,er.clearcoatMap){const ar={index:await ir.processTextureAsync(er.clearcoatMap),texCoord:er.clearcoatMap.channel};ir.applyTextureTransform(ar,er.clearcoatMap),sr.clearcoatTexture=ar}if(sr.clearcoatRoughnessFactor=er.clearcoatRoughness,er.clearcoatRoughnessMap){const ar={index:await ir.processTextureAsync(er.clearcoatRoughnessMap),texCoord:er.clearcoatRoughnessMap.channel};ir.applyTextureTransform(ar,er.clearcoatRoughnessMap),sr.clearcoatRoughnessTexture=ar}if(er.clearcoatNormalMap){const ar={index:await ir.processTextureAsync(er.clearcoatNormalMap),texCoord:er.clearcoatNormalMap.channel};er.clearcoatNormalScale.x!==1&&(ar.scale=er.clearcoatNormalScale.x),ir.applyTextureTransform(ar,er.clearcoatNormalMap),sr.clearcoatNormalTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsDispersionExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_dispersion"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.dispersion===0)return;const nr=this.writer.extensionsUsed,sr={};sr.dispersion=er.dispersion,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsIridescenceExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_iridescence"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.iridescence===0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(sr.iridescenceFactor=er.iridescence,er.iridescenceMap){const ar={index:await ir.processTextureAsync(er.iridescenceMap),texCoord:er.iridescenceMap.channel};ir.applyTextureTransform(ar,er.iridescenceMap),sr.iridescenceTexture=ar}if(sr.iridescenceIor=er.iridescenceIOR,sr.iridescenceThicknessMinimum=er.iridescenceThicknessRange[0],sr.iridescenceThicknessMaximum=er.iridescenceThicknessRange[1],er.iridescenceThicknessMap){const ar={index:await ir.processTextureAsync(er.iridescenceThicknessMap),texCoord:er.iridescenceThicknessMap.channel};ir.applyTextureTransform(ar,er.iridescenceThicknessMap),sr.iridescenceThicknessTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsTransmissionExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_transmission"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.transmission===0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(sr.transmissionFactor=er.transmission,er.transmissionMap){const ar={index:await ir.processTextureAsync(er.transmissionMap),texCoord:er.transmissionMap.channel};ir.applyTextureTransform(ar,er.transmissionMap),sr.transmissionTexture=ar}tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsVolumeExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_volume"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.transmission===0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(sr.thicknessFactor=er.thickness,er.thicknessMap){const ar={index:await ir.processTextureAsync(er.thicknessMap),texCoord:er.thicknessMap.channel};ir.applyTextureTransform(ar,er.thicknessMap),sr.thicknessTexture=ar}er.attenuationDistance!==1/0&&(sr.attenuationDistance=er.attenuationDistance),sr.attenuationColor=er.attenuationColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsIorExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_ior"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.ior===1.5)return;const nr=this.writer.extensionsUsed,sr={};sr.ior=er.ior,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsSpecularExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_specular"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.specularIntensity===1&&er.specularColor.equals(DEFAULT_SPECULAR_COLOR)&&!er.specularIntensityMap&&!er.specularColorMap)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(er.specularIntensityMap){const ar={index:await ir.processTextureAsync(er.specularIntensityMap),texCoord:er.specularIntensityMap.channel};ir.applyTextureTransform(ar,er.specularIntensityMap),sr.specularTexture=ar}if(er.specularColorMap){const ar={index:await ir.processTextureAsync(er.specularColorMap),texCoord:er.specularColorMap.channel};ir.applyTextureTransform(ar,er.specularColorMap),sr.specularColorTexture=ar}sr.specularFactor=er.specularIntensity,sr.specularColorFactor=er.specularColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsSheenExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_sheen"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.sheen==0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(er.sheenRoughnessMap){const ar={index:await ir.processTextureAsync(er.sheenRoughnessMap),texCoord:er.sheenRoughnessMap.channel};ir.applyTextureTransform(ar,er.sheenRoughnessMap),sr.sheenRoughnessTexture=ar}if(er.sheenColorMap){const ar={index:await ir.processTextureAsync(er.sheenColorMap),texCoord:er.sheenColorMap.channel};ir.applyTextureTransform(ar,er.sheenColorMap),sr.sheenColorTexture=ar}sr.sheenRoughnessFactor=er.sheenRoughness,sr.sheenColorFactor=er.sheenColor.toArray(),tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsAnisotropyExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_anisotropy"}async writeMaterialAsync(er,tr){if(!er.isMeshPhysicalMaterial||er.anisotropy==0)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(er.anisotropyMap){const ar={index:await ir.processTextureAsync(er.anisotropyMap)};ir.applyTextureTransform(ar,er.anisotropyMap),sr.anisotropyTexture=ar}sr.anisotropyStrength=er.anisotropy,sr.anisotropyRotation=er.anisotropyRotation,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsEmissiveStrengthExtension$1=class{constructor(er){this.writer=er,this.name="KHR_materials_emissive_strength"}async writeMaterialAsync(er,tr){if(!er.isMeshStandardMaterial||er.emissiveIntensity===1)return;const nr=this.writer.extensionsUsed,sr={};sr.emissiveStrength=er.emissiveIntensity,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMaterialsBumpExtension$1=class{constructor(er){this.writer=er,this.name="EXT_materials_bump"}async writeMaterialAsync(er,tr){if(!er.isMeshStandardMaterial||er.bumpScale===1&&!er.bumpMap)return;const ir=this.writer,nr=ir.extensionsUsed,sr={};if(er.bumpMap){const ar={index:await ir.processTextureAsync(er.bumpMap),texCoord:er.bumpMap.channel};ir.applyTextureTransform(ar,er.bumpMap),sr.bumpTexture=ar}sr.bumpFactor=er.bumpScale,tr.extensions=tr.extensions||{},tr.extensions[this.name]=sr,nr[this.name]=!0}},GLTFMeshGpuInstancing$1=class{constructor(er){this.writer=er,this.name="EXT_mesh_gpu_instancing"}writeNode(er,tr){if(!er.isInstancedMesh)return;const ir=this.writer,nr=er,sr=new Float32Array(nr.count*3),ar=new Float32Array(nr.count*4),or=new Float32Array(nr.count*3),lr=new Matrix4,cr=new Vector3$1,ur=new Quaternion$1,dr=new Vector3$1;for(let pr=0;pr<nr.count;pr++)nr.getMatrixAt(pr,lr),lr.decompose(cr,ur,dr),cr.toArray(sr,pr*3),ur.toArray(ar,pr*4),dr.toArray(or,pr*3);const hr={TRANSLATION:ir.processAccessor(new BufferAttribute(sr,3)),ROTATION:ir.processAccessor(new BufferAttribute(ar,4)),SCALE:ir.processAccessor(new BufferAttribute(or,3))};nr.instanceColor&&(hr._COLOR_0=ir.processAccessor(nr.instanceColor)),tr.extensions=tr.extensions||{},tr.extensions[this.name]={attributes:hr},ir.extensionsUsed[this.name]=!0,ir.extensionsRequired[this.name]=!0}};GLTFExporter.Utils={insertKeyframe:function(rr,er){const ir=rr.getValueSize(),nr=new rr.TimeBufferType(rr.times.length+1),sr=new rr.ValueBufferType(rr.values.length+ir),ar=rr.createInterpolant(new rr.ValueBufferType(ir));let or;if(rr.times.length===0){nr[0]=er;for(let lr=0;lr<ir;lr++)sr[lr]=0;or=0}else if(er<rr.times[0]){if(Math.abs(rr.times[0]-er)<.001)return 0;nr[0]=er,nr.set(rr.times,1),sr.set(ar.evaluate(er),0),sr.set(rr.values,ir),or=0}else if(er>rr.times[rr.times.length-1]){if(Math.abs(rr.times[rr.times.length-1]-er)<.001)return rr.times.length-1;nr[nr.length-1]=er,nr.set(rr.times,0),sr.set(rr.values,0),sr.set(ar.evaluate(er),rr.values.length),or=nr.length-1}else for(let lr=0;lr<rr.times.length;lr++){if(Math.abs(rr.times[lr]-er)<.001)return lr;if(rr.times[lr]<er&&rr.times[lr+1]>er){nr.set(rr.times.slice(0,lr+1),0),nr[lr+1]=er,nr.set(rr.times.slice(lr+1),lr+2),sr.set(rr.values.slice(0,(lr+1)*ir),0),sr.set(ar.evaluate(er),(lr+1)*ir),sr.set(rr.values.slice((lr+1)*ir),(lr+2)*ir),or=lr+1;break}}return rr.times=nr,rr.values=sr,or},mergeMorphTargetTracks:function(rr,er){const tr=[],ir={},nr=rr.tracks;for(let sr=0;sr<nr.length;++sr){let ar=nr[sr];const or=PropertyBinding.parseTrackName(ar.name),lr=PropertyBinding.findNode(er,or.nodeName);if(or.propertyName!=="morphTargetInfluences"||or.propertyIndex===void 0){tr.push(ar);continue}if(ar.createInterpolant!==ar.InterpolantFactoryMethodDiscrete&&ar.createInterpolant!==ar.InterpolantFactoryMethodLinear){if(ar.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),ar=ar.clone(),ar.setInterpolation(InterpolateLinear)}const cr=lr.morphTargetInfluences.length,ur=lr.morphTargetDictionary[or.propertyIndex];if(ur===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+or.propertyIndex);let dr;if(ir[lr.uuid]===void 0){dr=ar.clone();const pr=new dr.ValueBufferType(cr*dr.times.length);for(let gr=0;gr<dr.times.length;gr++)pr[gr*cr+ur]=dr.values[gr];dr.name=(or.nodeName||"")+".morphTargetInfluences",dr.values=pr,ir[lr.uuid]=dr,tr.push(dr);continue}const hr=ar.createInterpolant(new ar.ValueBufferType(1));dr=ir[lr.uuid];for(let pr=0;pr<dr.times.length;pr++)dr.values[pr*cr+ur]=hr.evaluate(dr.times[pr]);for(let pr=0;pr<ar.times.length;pr++){const gr=this.insertKeyframe(dr,ar.times[pr]);dr.values[gr*cr+ur]=ar.values[pr]}}return rr.tracks=tr,rr},toFloat32BufferAttribute:function(rr){const er=new BufferAttribute(new Float32Array(rr.count*rr.itemSize),rr.itemSize,!1);if(!rr.normalized&&!rr.isInterleavedBufferAttribute)return er.array.set(rr.array),er;for(let tr=0,ir=rr.count;tr<ir;tr++)for(let nr=0;nr<rr.itemSize;nr++)er.setComponent(tr,nr,rr.getComponent(tr,nr));return er}};const t$1=0,e=1,n=2,i=3,s=0,a$1=0,r=2,o=0,l=1,f=160,h=161,U=162,c$2=163,_=166,p=0,g$1=1,y=0,x=1,u=2,b$1=3,d=4,w=5,m$1=6,D=7,B$1=8,L=9,v$1=10,A$1=11,k$1=12,V=13,I$1=14,S=15,F=16,O=17,E=18,T$1=0,C$2=1,M=2,P$1=3,z=4,W=5,H=6,N=7,K=8,X=9,R$2=10,Y=11,j=0,q=1,G=2,J=13,Q$1=14,Z=15,$=128,tt=64,et$1=32,nt=16,it=0,st=1,at=2,rt=3,ot=4,lt=5,ft$1=6,ht=7,Ut=8,ct=9,_t=10,pt=13,gt=14,yt$1=15,xt$1=16,ut=17,bt=20,dt=21,wt=22,mt$1=23,Dt=24,Bt=27,Lt$1=28,vt$1=29,At=30,kt=31,Vt=34,It=35,St=36,Ft=37,Ot=38,Et=41,Tt$1=42,Ct=43,Mt=44,Pt=45,zt=48,Wt=49,Ht=50,Nt=58,Kt=59,Xt=62,Rt=63,Yt$1=64,jt=65,qt=68,Gt$1=69,Jt=70,Qt=71,Zt=74,$t=75,te=76,ee=77,ne$1=78,ie=81,se=82,ae=83,re=84,oe=85,le=88,fe=89,he=90,Ue$1=91,ce$1=92,_e=95,pe=96,ge=97,ye=98,xe=99,ue=100,be=101,de=102,we=103,me=104,De=105,Be=106,Le=107,ve=108,Ae=109,ke=110,Ve=111,Ie=112,Se=113,Fe=114,Oe=115,Ee=116,Te=117,Ce=118,Me=119,Pe=120,ze=121,We=122,He=123,Ne=124,Ke=125,Xe$1=126,Re=127,Ye=128,je=129,qe=130,Ge=131,Je=132,Qe=133,Ze=134,$e$1=135,tn=136,en=137,nn=138,sn=139,an=140,rn=141,on=142,ln=143,fn=144,hn=145,Un=146,cn=147,_n=148,pn$1=149,gn=150,yn=151,xn=152,un=153,bn=154,dn=155,wn=156,mn=157,Dn=158,Bn=159,Ln=160,vn=161,An=162,kn=163,Vn=164,In=165,Sn=166,Fn=167,On=168,En=169,Tn=170,Cn=171,Mn=172,Pn=173,zn=174,Wn=175,Hn=176,Nn=177,Kn=178,Xn=179,Rn=180,Yn=181,jn=182,qn=183,Gn=184,Jn=1000156007,Qn=1000156008,Zn=1000156009,$n=1000156010,ti=1000156011,ei=1000156017,ni=1000156018,ii=1000156019,si=1000156020,ai=1000156021,ri=1000054e3,oi=1000054001,li=1000054002,fi=1000054003,hi=1000054004,Ui$1=1000054005,ci=1000054006,_i=1000054007,pi$1=1000066e3,gi=1000066001,yi=1000066002,xi=1000066003,ui=1000066004,bi=1000066005,di=1000066006,wi=1000066007,mi$1=1000066008,Di=1000066009,Bi=1000066010,Li=1000066011,vi=1000066012,Ai=1000066013,ki=100034e4,Vi=1000340001;class Ii{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Si{constructor(er,tr,ir,nr){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(er.buffer,er.byteOffset+tr,ir),this._littleEndian=nr,this._offset=0}_nextUint8(){const er=this._dataView.getUint8(this._offset);return this._offset+=1,er}_nextUint16(){const er=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,er}_nextUint32(){const er=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,er}_nextUint64(){const er=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,er}_nextInt32(){const er=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,er}_nextUint8Array(er){const tr=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,er);return this._offset+=er,tr}_skip(er){return this._offset+=er,this}_scan(er,tr){tr===void 0&&(tr=0);const ir=this._offset;let nr=0;for(;this._dataView.getUint8(this._offset)!==tr&&nr<er;)nr++,this._offset++;return nr<er&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+ir,nr)}}const Fi=new Uint8Array([0]),Oi=[171,75,84,88,32,50,48,187,13,10,26,10];function Ei(rr){return new TextEncoder().encode(rr)}function Ti(rr){return new TextDecoder().decode(rr)}function Ci(rr){let er=0;for(const nr of rr)er+=nr.byteLength;const tr=new Uint8Array(er);let ir=0;for(const nr of rr)tr.set(new Uint8Array(nr),ir),ir+=nr.byteLength;return tr}function Mi(rr,er){return er===void 0&&(er=4),Math.ceil(rr/er)*er-rr}function Pi(rr){const er=new Uint8Array(rr.buffer,rr.byteOffset,Oi.length);if(er[0]!==Oi[0]||er[1]!==Oi[1]||er[2]!==Oi[2]||er[3]!==Oi[3]||er[4]!==Oi[4]||er[5]!==Oi[5]||er[6]!==Oi[6]||er[7]!==Oi[7]||er[8]!==Oi[8]||er[9]!==Oi[9]||er[10]!==Oi[10]||er[11]!==Oi[11])throw new Error("Missing KTX 2.0 identifier.");const tr=new Ii,ir=17*Uint32Array.BYTES_PER_ELEMENT,nr=new Si(rr,Oi.length,ir,!0);tr.vkFormat=nr._nextUint32(),tr.typeSize=nr._nextUint32(),tr.pixelWidth=nr._nextUint32(),tr.pixelHeight=nr._nextUint32(),tr.pixelDepth=nr._nextUint32(),tr.layerCount=nr._nextUint32(),tr.faceCount=nr._nextUint32();const sr=nr._nextUint32();tr.supercompressionScheme=nr._nextUint32();const ar=nr._nextUint32(),or=nr._nextUint32(),lr=nr._nextUint32(),cr=nr._nextUint32(),ur=nr._nextUint64(),dr=nr._nextUint64(),hr=new Si(rr,Oi.length+ir,3*sr*8,!0);for(let Ur=0;Ur<sr;Ur++)tr.levels.push({levelData:new Uint8Array(rr.buffer,rr.byteOffset+hr._nextUint64(),hr._nextUint64()),uncompressedByteLength:hr._nextUint64()});const pr=new Si(rr,ar,or,!0),gr={vendorId:pr._skip(4)._nextUint16(),descriptorType:pr._nextUint16(),versionNumber:pr._nextUint16(),descriptorBlockSize:pr._nextUint16(),colorModel:pr._nextUint8(),colorPrimaries:pr._nextUint8(),transferFunction:pr._nextUint8(),flags:pr._nextUint8(),texelBlockDimension:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],bytesPlane:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],samples:[]},vr=(gr.descriptorBlockSize/4-6)/4;for(let Ur=0;Ur<vr;Ur++){const Br={bitOffset:pr._nextUint16(),bitLength:pr._nextUint8(),channelType:pr._nextUint8(),samplePosition:[pr._nextUint8(),pr._nextUint8(),pr._nextUint8(),pr._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Br.channelType?(Br.sampleLower=pr._nextInt32(),Br.sampleUpper=pr._nextInt32()):(Br.sampleLower=pr._nextUint32(),Br.sampleUpper=pr._nextUint32()),gr.samples[Ur]=Br}tr.dataFormatDescriptor.length=0,tr.dataFormatDescriptor.push(gr);const mr=new Si(rr,lr,cr,!0);for(;mr._offset<cr;){const Ur=mr._nextUint32(),Br=mr._scan(Ur),Wr=Ti(Br);if(tr.keyValue[Wr]=mr._nextUint8Array(Ur-Br.byteLength-1),Wr.match(/^ktx/i)){const Xr=Ti(tr.keyValue[Wr]);tr.keyValue[Wr]=Xr.substring(0,Xr.lastIndexOf("\0"))}mr._skip(Ur%4?4-Ur%4:0)}if(dr<=0)return tr;const fr=new Si(rr,ur,dr,!0),_r=fr._nextUint16(),Ar=fr._nextUint16(),yr=fr._nextUint32(),wr=fr._nextUint32(),xr=fr._nextUint32(),Sr=fr._nextUint32(),br=[];for(let Ur=0;Ur<sr;Ur++)br.push({imageFlags:fr._nextUint32(),rgbSliceByteOffset:fr._nextUint32(),rgbSliceByteLength:fr._nextUint32(),alphaSliceByteOffset:fr._nextUint32(),alphaSliceByteLength:fr._nextUint32()});const Cr=ur+fr._offset,Ir=Cr+yr,Rr=Ir+wr,Pr=Rr+xr,Dr=new Uint8Array(rr.buffer,rr.byteOffset+Cr,yr),Fr=new Uint8Array(rr.buffer,rr.byteOffset+Ir,wr),Or=new Uint8Array(rr.buffer,rr.byteOffset+Rr,xr),Nr=new Uint8Array(rr.buffer,rr.byteOffset+Pr,Sr);return tr.globalData={endpointCount:_r,selectorCount:Ar,imageDescs:br,endpointsData:Dr,selectorsData:Fr,tablesData:Or,extendedData:Nr},tr}const zi$1={keepWriter:!1};function Wi(rr,er){er===void 0&&(er={}),er={...zi$1,...er};let tr=new ArrayBuffer(0);if(rr.globalData){const yr=new ArrayBuffer(20+5*rr.globalData.imageDescs.length*4),wr=new DataView(yr);wr.setUint16(0,rr.globalData.endpointCount,!0),wr.setUint16(2,rr.globalData.selectorCount,!0),wr.setUint32(4,rr.globalData.endpointsData.byteLength,!0),wr.setUint32(8,rr.globalData.selectorsData.byteLength,!0),wr.setUint32(12,rr.globalData.tablesData.byteLength,!0),wr.setUint32(16,rr.globalData.extendedData.byteLength,!0);for(let xr=0;xr<rr.globalData.imageDescs.length;xr++){const Sr=rr.globalData.imageDescs[xr];wr.setUint32(20+5*xr*4+0,Sr.imageFlags,!0),wr.setUint32(20+5*xr*4+4,Sr.rgbSliceByteOffset,!0),wr.setUint32(20+5*xr*4+8,Sr.rgbSliceByteLength,!0),wr.setUint32(20+5*xr*4+12,Sr.alphaSliceByteOffset,!0),wr.setUint32(20+5*xr*4+16,Sr.alphaSliceByteLength,!0)}tr=Ci([yr,rr.globalData.endpointsData,rr.globalData.selectorsData,rr.globalData.tablesData,rr.globalData.extendedData])}const ir=[];let nr=rr.keyValue;er.keepWriter||(nr={...rr.keyValue,KTXwriter:"KTX-Parse v0.7.1"});for(const yr in nr){const wr=nr[yr],xr=Ei(yr),Sr=typeof wr=="string"?Ci([Ei(wr),Fi]):wr,br=xr.byteLength+1+Sr.byteLength,Cr=Mi(br,4);ir.push(Ci([new Uint32Array([br]),xr,Fi,Sr,new Uint8Array(Cr).fill(0)]))}const sr=Ci(ir);if(rr.dataFormatDescriptor.length!==1||rr.dataFormatDescriptor[0].descriptorType!==0)throw new Error("Only BASICFORMAT Data Format Descriptor output supported.");const ar=rr.dataFormatDescriptor[0],or=new ArrayBuffer(28+16*ar.samples.length),lr=new DataView(or),cr=24+16*ar.samples.length;if(lr.setUint32(0,or.byteLength,!0),lr.setUint16(4,ar.vendorId,!0),lr.setUint16(6,ar.descriptorType,!0),lr.setUint16(8,ar.versionNumber,!0),lr.setUint16(10,cr,!0),lr.setUint8(12,ar.colorModel),lr.setUint8(13,ar.colorPrimaries),lr.setUint8(14,ar.transferFunction),lr.setUint8(15,ar.flags),!Array.isArray(ar.texelBlockDimension))throw new Error("texelBlockDimension is now an array. For dimensionality `d`, set `d - 1`.");lr.setUint8(16,ar.texelBlockDimension[0]),lr.setUint8(17,ar.texelBlockDimension[1]),lr.setUint8(18,ar.texelBlockDimension[2]),lr.setUint8(19,ar.texelBlockDimension[3]);for(let yr=0;yr<8;yr++)lr.setUint8(20+yr,ar.bytesPlane[yr]);for(let yr=0;yr<ar.samples.length;yr++){const wr=ar.samples[yr],xr=28+16*yr;if(wr.channelID)throw new Error("channelID has been renamed to channelType.");lr.setUint16(xr+0,wr.bitOffset,!0),lr.setUint8(xr+2,wr.bitLength),lr.setUint8(xr+3,wr.channelType),lr.setUint8(xr+4,wr.samplePosition[0]),lr.setUint8(xr+5,wr.samplePosition[1]),lr.setUint8(xr+6,wr.samplePosition[2]),lr.setUint8(xr+7,wr.samplePosition[3]),64&wr.channelType?(lr.setInt32(xr+8,wr.sampleLower,!0),lr.setInt32(xr+12,wr.sampleUpper,!0)):(lr.setUint32(xr+8,wr.sampleLower,!0),lr.setUint32(xr+12,wr.sampleUpper,!0))}const ur=Oi.length+68+3*rr.levels.length*8,dr=ur+or.byteLength;let hr=tr.byteLength>0?dr+sr.byteLength:0;hr%8&&(hr+=8-hr%8);const pr=[],gr=new DataView(new ArrayBuffer(3*rr.levels.length*8)),vr=new Uint32Array(rr.levels.length);let mr=0;rr.supercompressionScheme===0&&(mr=function(yr,wr){const xr=Math.max(yr,4),Sr=Math.min(yr,4);let br=xr;for(;br%Sr!=0;)br+=xr;return br}(function(yr){return yr.levels[0].levelData.byteLength/function(wr,xr){let Sr=1;const br=[wr.pixelWidth,wr.pixelHeight,wr.pixelDepth],Cr=function(Ir){const[Rr,Pr,Dr]=Ir.dataFormatDescriptor[0].texelBlockDimension;return[Rr+1,Pr+1,Dr+1]}(wr);for(let Ir=0;Ir<3;Ir++)if(br[Ir]>0){const Rr=Math.ceil(Math.floor(br[Ir]*Math.pow(2,-0))/Cr[Ir]);Sr*=Math.max(1,Rr)}return wr.layerCount>0&&(Sr*=wr.layerCount),wr.faceCount>0&&(Sr*=wr.faceCount),Sr}(yr)}(rr)));let fr=(hr||dr+sr.byteLength)+tr.byteLength;for(let yr=rr.levels.length-1;yr>=0;yr--){if(fr%mr){const xr=Mi(fr,mr);pr.push(new Uint8Array(xr)),fr+=xr}const wr=rr.levels[yr];pr.push(wr.levelData),vr[yr]=fr,fr+=wr.levelData.byteLength}for(let yr=0;yr<rr.levels.length;yr++){const wr=rr.levels[yr];gr.setBigUint64(24*yr+0,BigInt(vr[yr]),!0),gr.setBigUint64(24*yr+8,BigInt(wr.levelData.byteLength),!0),gr.setBigUint64(24*yr+16,BigInt(wr.uncompressedByteLength),!0)}const _r=new ArrayBuffer(68),Ar=new DataView(_r);return Ar.setUint32(0,rr.vkFormat,!0),Ar.setUint32(4,rr.typeSize,!0),Ar.setUint32(8,rr.pixelWidth,!0),Ar.setUint32(12,rr.pixelHeight,!0),Ar.setUint32(16,rr.pixelDepth,!0),Ar.setUint32(20,rr.layerCount,!0),Ar.setUint32(24,rr.faceCount,!0),Ar.setUint32(28,rr.levels.length,!0),Ar.setUint32(32,rr.supercompressionScheme,!0),Ar.setUint32(36,ur,!0),Ar.setUint32(40,or.byteLength,!0),Ar.setUint32(44,dr,!0),Ar.setUint32(48,sr.byteLength,!0),Ar.setBigUint64(52,BigInt(tr.byteLength>0?hr:0),!0),Ar.setBigUint64(60,BigInt(tr.byteLength),!0),new Uint8Array(Ci([new Uint8Array(Oi).buffer,_r,gr.buffer,or,sr,hr>0?new ArrayBuffer(hr-(dr+sr.byteLength)):new ArrayBuffer(0),tr,...pr]))}const VK_FORMAT_MAP={[RGBAFormat]:{[FloatType]:{[NoColorSpace]:Ae,[LinearSRGBColorSpace]:Ae},[HalfFloatType]:{[NoColorSpace]:ge,[LinearSRGBColorSpace]:ge},[UnsignedByteType]:{[NoColorSpace]:Ft,[LinearSRGBColorSpace]:Ft,[SRGBColorSpace]:Ct}},[RGFormat]:{[FloatType]:{[NoColorSpace]:we,[LinearSRGBColorSpace]:we},[HalfFloatType]:{[NoColorSpace]:ae,[LinearSRGBColorSpace]:ae},[UnsignedByteType]:{[NoColorSpace]:xt$1,[LinearSRGBColorSpace]:xt$1,[SRGBColorSpace]:wt}},[RedFormat]:{[FloatType]:{[NoColorSpace]:ue,[LinearSRGBColorSpace]:ue},[HalfFloatType]:{[NoColorSpace]:te,[LinearSRGBColorSpace]:te},[UnsignedByteType]:{[NoColorSpace]:ct,[LinearSRGBColorSpace]:ct,[SRGBColorSpace]:yt$1}}},KHR_DF_CHANNEL_MAP=[j,q,G,Z],KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER={[FloatType]:[3212836864,1065353216],[HalfFloatType]:[3212836864,1065353216],[UnsignedByteType]:[0,255]},ERROR_INPUT="THREE.KTX2Exporter: Supported inputs are DataTexture, Data3DTexture, or WebGLRenderer and WebGLRenderTarget.",ERROR_FORMAT="THREE.KTX2Exporter: Supported formats are RGBAFormat, RGFormat, or RedFormat.",ERROR_TYPE='THREE.KTX2Exporter: Supported types are FloatType, HalfFloatType, or UnsignedByteType."',ERROR_COLOR_SPACE="THREE.KTX2Exporter: Supported color spaces are SRGBColorSpace (UnsignedByteType only), LinearSRGBColorSpace, or NoColorSpace.";class KTX2Exporter{async parse(er,tr){let ir;if(er.isDataTexture||er.isData3DTexture)ir=er;else if((er.isWebGLRenderer||er.isWebGPURenderer)&&tr.isRenderTarget)ir=await toDataTexture(er,tr);else throw new Error(ERROR_INPUT);if(VK_FORMAT_MAP[ir.format]===void 0)throw new Error(ERROR_FORMAT);if(VK_FORMAT_MAP[ir.format][ir.type]===void 0)throw new Error(ERROR_TYPE);if(VK_FORMAT_MAP[ir.format][ir.type][ir.colorSpace]===void 0)throw new Error(ERROR_COLOR_SPACE);const nr=ir.image.data,sr=getChannelCount(ir),ar=new Ii;ar.vkFormat=VK_FORMAT_MAP[ir.format][ir.type][ir.colorSpace],ar.typeSize=nr.BYTES_PER_ELEMENT,ar.pixelWidth=ir.image.width,ar.pixelHeight=ir.image.height,ir.isData3DTexture&&(ar.pixelDepth=ir.image.depth);const or=ar.dataFormatDescriptor[0];or.colorModel=l,or.colorPrimaries=ir.colorSpace===NoColorSpace?T$1:C$2,or.transferFunction=ColorManagement.getTransfer(ir.colorSpace)===SRGBTransfer?u:x,or.texelBlockDimension=[0,0,0,0],or.bytesPlane=[ar.typeSize*sr,0,0,0,0,0,0,0];for(let lr=0;lr<sr;++lr){let cr=KHR_DF_CHANNEL_MAP[lr];cr===Z&&or.transferFunction!==x&&(cr|=nt),(ir.type===FloatType||ir.type===HalfFloatType)&&(cr|=$,cr|=tt),or.samples.push({channelType:cr,bitOffset:lr*nr.BYTES_PER_ELEMENT*8,bitLength:nr.BYTES_PER_ELEMENT*8-1,samplePosition:[0,0,0,0],sampleLower:KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER[ir.type][0],sampleUpper:KHR_DF_CHANNEL_SAMPLE_LOWER_UPPER[ir.type][1]})}return ar.levels=[{levelData:new Uint8Array(nr.buffer,nr.byteOffset,nr.byteLength),uncompressedByteLength:nr.byteLength}],ar.keyValue.KTXwriter=`three.js ${REVISION}`,Wi(ar,{keepWriter:!0})}}async function toDataTexture(rr,er){const tr=getChannelCount(er.texture);let ir;if(rr.isWebGLRenderer){if(er.texture.type===FloatType)ir=new Float32Array(er.width*er.height*tr);else if(er.texture.type===HalfFloatType)ir=new Uint16Array(er.width*er.height*tr);else if(er.texture.type===UnsignedByteType)ir=new Uint8Array(er.width*er.height*tr);else throw new Error(ERROR_TYPE);await rr.readRenderTargetPixelsAsync(er,0,0,er.width,er.height,ir)}else ir=await rr.readRenderTargetPixelsAsync(er,0,0,er.width,er.height);const nr=new DataTexture(ir,er.width,er.height,er.texture.format,er.texture.type);return nr.colorSpace=er.texture.colorSpace,nr}function getChannelCount(rr){switch(rr.format){case RGBAFormat:return 4;case RGFormat:case RGIntegerFormat:return 2;case RedFormat:case RedIntegerFormat:return 1;default:throw new Error(ERROR_FORMAT)}}function CharsetEncoder(){}CharsetEncoder.prototype.s2u=function(rr){for(var er=this.s2uTable,tr="",ir=0;ir<rr.length;){var nr=rr[ir++];if(!(nr>=0&&nr<=126||nr>=161&&nr<=223)&&ir<rr.length&&(nr=nr<<8|rr[ir++]),er[nr]===void 0)return console.error("unknown char code "+nr+"."),tr;tr+=String.fromCharCode(er[nr])}return tr};CharsetEncoder.prototype.s2uTable={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,11:11,12:12,13:13,14:14,15:15,16:16,17:17,18:18,19:19,20:20,21:21,22:22,23:23,24:24,25:25,26:26,27:27,28:28,29:29,30:30,31:31,32:32,33:33,34:34,35:35,36:36,37:37,38:38,39:39,40:40,41:41,42:42,43:43,44:44,45:45,46:46,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,56:56,57:57,58:58,59:59,60:60,61:61,62:62,63:63,64:64,65:65,66:66,67:67,68:68,69:69,70:70,71:71,72:72,73:73,74:74,75:75,76:76,77:77,78:78,79:79,80:80,81:81,82:82,83:83,84:84,85:85,86:86,87:87,88:88,89:89,90:90,91:91,92:92,93:93,94:94,95:95,96:96,97:97,98:98,99:99,100:100,101:101,102:102,103:103,104:104,105:105,106:106,107:107,108:108,109:109,110:110,111:111,112:112,113:113,114:114,115:115,116:116,117:117,118:118,119:119,120:120,121:121,122:122,123:123,124:124,125:125,126:126,161:65377,162:65378,163:65379,164:65380,165:65381,166:65382,167:65383,168:65384,169:65385,170:65386,171:65387,172:65388,173:65389,174:65390,175:65391,176:65392,177:65393,178:65394,179:65395,180:65396,181:65397,182:65398,183:65399,184:65400,185:65401,186:65402,187:65403,188:65404,189:65405,190:65406,191:65407,192:65408,193:65409,194:65410,195:65411,196:65412,197:65413,198:65414,199:65415,200:65416,201:65417,202:65418,203:65419,204:65420,205:65421,206:65422,207:65423,208:65424,209:65425,210:65426,211:65427,212:65428,213:65429,214:65430,215:65431,216:65432,217:65433,218:65434,219:65435,220:65436,221:65437,222:65438,223:65439,33088:12288,33089:12289,33090:12290,33091:65292,33092:65294,33093:12539,33094:65306,33095:65307,33096:65311,33097:65281,33098:12443,33099:12444,33100:180,33101:65344,33102:168,33103:65342,33104:65507,33105:65343,33106:12541,33107:12542,33108:12445,33109:12446,33110:12291,33111:20189,33112:12293,33113:12294,33114:12295,33115:12540,33116:8213,33117:8208,33118:65295,33119:65340,33120:65374,33121:8741,33122:65372,33123:8230,33124:8229,33125:8216,33126:8217,33127:8220,33128:8221,33129:65288,33130:65289,33131:12308,33132:12309,33133:65339,33134:65341,33135:65371,33136:65373,33137:12296,33138:12297,33139:12298,33140:12299,33141:12300,33142:12301,33143:12302,33144:12303,33145:12304,33146:12305,33147:65291,33148:65293,33149:177,33150:215,33152:247,33153:65309,33154:8800,33155:65308,33156:65310,33157:8806,33158:8807,33159:8734,33160:8756,33161:9794,33162:9792,33163:176,33164:8242,33165:8243,33166:8451,33167:65509,33168:65284,33169:65504,33170:65505,33171:65285,33172:65283,33173:65286,33174:65290,33175:65312,33176:167,33177:9734,33178:9733,33179:9675,33180:9679,33181:9678,33182:9671,33183:9670,33184:9633,33185:9632,33186:9651,33187:9650,33188:9661,33189:9660,33190:8251,33191:12306,33192:8594,33193:8592,33194:8593,33195:8595,33196:12307,33208:8712,33209:8715,33210:8838,33211:8839,33212:8834,33213:8835,33214:8746,33215:8745,33224:8743,33225:8744,33226:65506,33227:8658,33228:8660,33229:8704,33230:8707,33242:8736,33243:8869,33244:8978,33245:8706,33246:8711,33247:8801,33248:8786,33249:8810,33250:8811,33251:8730,33252:8765,33253:8733,33254:8757,33255:8747,33256:8748,33264:8491,33265:8240,33266:9839,33267:9837,33268:9834,33269:8224,33270:8225,33271:182,33276:9711,33359:65296,33360:65297,33361:65298,33362:65299,33363:65300,33364:65301,33365:65302,33366:65303,33367:65304,33368:65305,33376:65313,33377:65314,33378:65315,33379:65316,33380:65317,33381:65318,33382:65319,33383:65320,33384:65321,33385:65322,33386:65323,33387:65324,33388:65325,33389:65326,33390:65327,33391:65328,33392:65329,33393:65330,33394:65331,33395:65332,33396:65333,33397:65334,33398:65335,33399:65336,33400:65337,33401:65338,33409:65345,33410:65346,33411:65347,33412:65348,33413:65349,33414:65350,33415:65351,33416:65352,33417:65353,33418:65354,33419:65355,33420:65356,33421:65357,33422:65358,33423:65359,33424:65360,33425:65361,33426:65362,33427:65363,33428:65364,33429:65365,33430:65366,33431:65367,33432:65368,33433:65369,33434:65370,33439:12353,33440:12354,33441:12355,33442:12356,33443:12357,33444:12358,33445:12359,33446:12360,33447:12361,33448:12362,33449:12363,33450:12364,33451:12365,33452:12366,33453:12367,33454:12368,33455:12369,33456:12370,33457:12371,33458:12372,33459:12373,33460:12374,33461:12375,33462:12376,33463:12377,33464:12378,33465:12379,33466:12380,33467:12381,33468:12382,33469:12383,33470:12384,33471:12385,33472:12386,33473:12387,33474:12388,33475:12389,33476:12390,33477:12391,33478:12392,33479:12393,33480:12394,33481:12395,33482:12396,33483:12397,33484:12398,33485:12399,33486:12400,33487:12401,33488:12402,33489:12403,33490:12404,33491:12405,33492:12406,33493:12407,33494:12408,33495:12409,33496:12410,33497:12411,33498:12412,33499:12413,33500:12414,33501:12415,33502:12416,33503:12417,33504:12418,33505:12419,33506:12420,33507:12421,33508:12422,33509:12423,33510:12424,33511:12425,33512:12426,33513:12427,33514:12428,33515:12429,33516:12430,33517:12431,33518:12432,33519:12433,33520:12434,33521:12435,33600:12449,33601:12450,33602:12451,33603:12452,33604:12453,33605:12454,33606:12455,33607:12456,33608:12457,33609:12458,33610:12459,33611:12460,33612:12461,33613:12462,33614:12463,33615:12464,33616:12465,33617:12466,33618:12467,33619:12468,33620:12469,33621:12470,33622:12471,33623:12472,33624:12473,33625:12474,33626:12475,33627:12476,33628:12477,33629:12478,33630:12479,33631:12480,33632:12481,33633:12482,33634:12483,33635:12484,33636:12485,33637:12486,33638:12487,33639:12488,33640:12489,33641:12490,33642:12491,33643:12492,33644:12493,33645:12494,33646:12495,33647:12496,33648:12497,33649:12498,33650:12499,33651:12500,33652:12501,33653:12502,33654:12503,33655:12504,33656:12505,33657:12506,33658:12507,33659:12508,33660:12509,33661:12510,33662:12511,33664:12512,33665:12513,33666:12514,33667:12515,33668:12516,33669:12517,33670:12518,33671:12519,33672:12520,33673:12521,33674:12522,33675:12523,33676:12524,33677:12525,33678:12526,33679:12527,33680:12528,33681:12529,33682:12530,33683:12531,33684:12532,33685:12533,33686:12534,33695:913,33696:914,33697:915,33698:916,33699:917,33700:918,33701:919,33702:920,33703:921,33704:922,33705:923,33706:924,33707:925,33708:926,33709:927,33710:928,33711:929,33712:931,33713:932,33714:933,33715:934,33716:935,33717:936,33718:937,33727:945,33728:946,33729:947,33730:948,33731:949,33732:950,33733:951,33734:952,33735:953,33736:954,33737:955,33738:956,33739:957,33740:958,33741:959,33742:960,33743:961,33744:963,33745:964,33746:965,33747:966,33748:967,33749:968,33750:969,33856:1040,33857:1041,33858:1042,33859:1043,33860:1044,33861:1045,33862:1025,33863:1046,33864:1047,33865:1048,33866:1049,33867:1050,33868:1051,33869:1052,33870:1053,33871:1054,33872:1055,33873:1056,33874:1057,33875:1058,33876:1059,33877:1060,33878:1061,33879:1062,33880:1063,33881:1064,33882:1065,33883:1066,33884:1067,33885:1068,33886:1069,33887:1070,33888:1071,33904:1072,33905:1073,33906:1074,33907:1075,33908:1076,33909:1077,33910:1105,33911:1078,33912:1079,33913:1080,33914:1081,33915:1082,33916:1083,33917:1084,33918:1085,33920:1086,33921:1087,33922:1088,33923:1089,33924:1090,33925:1091,33926:1092,33927:1093,33928:1094,33929:1095,33930:1096,33931:1097,33932:1098,33933:1099,33934:1100,33935:1101,33936:1102,33937:1103,33951:9472,33952:9474,33953:9484,33954:9488,33955:9496,33956:9492,33957:9500,33958:9516,33959:9508,33960:9524,33961:9532,33962:9473,33963:9475,33964:9487,33965:9491,33966:9499,33967:9495,33968:9507,33969:9523,33970:9515,33971:9531,33972:9547,33973:9504,33974:9519,33975:9512,33976:9527,33977:9535,33978:9501,33979:9520,33980:9509,33981:9528,33982:9538,34624:9312,34625:9313,34626:9314,34627:9315,34628:9316,34629:9317,34630:9318,34631:9319,34632:9320,34633:9321,34634:9322,34635:9323,34636:9324,34637:9325,34638:9326,34639:9327,34640:9328,34641:9329,34642:9330,34643:9331,34644:8544,34645:8545,34646:8546,34647:8547,34648:8548,34649:8549,34650:8550,34651:8551,34652:8552,34653:8553,34655:13129,34656:13076,34657:13090,34658:13133,34659:13080,34660:13095,34661:13059,34662:13110,34663:13137,34664:13143,34665:13069,34666:13094,34667:13091,34668:13099,34669:13130,34670:13115,34671:13212,34672:13213,34673:13214,34674:13198,34675:13199,34676:13252,34677:13217,34686:13179,34688:12317,34689:12319,34690:8470,34691:13261,34692:8481,34693:12964,34694:12965,34695:12966,34696:12967,34697:12968,34698:12849,34699:12850,34700:12857,34701:13182,34702:13181,34703:13180,34704:8786,34705:8801,34706:8747,34707:8750,34708:8721,34709:8730,34710:8869,34711:8736,34712:8735,34713:8895,34714:8757,34715:8745,34716:8746,34975:20124,34976:21782,34977:23043,34978:38463,34979:21696,34980:24859,34981:25384,34982:23030,34983:36898,34984:33909,34985:33564,34986:31312,34987:24746,34988:25569,34989:28197,34990:26093,34991:33894,34992:33446,34993:39925,34994:26771,34995:22311,34996:26017,34997:25201,34998:23451,34999:22992,35e3:34427,35001:39156,35002:32098,35003:32190,35004:39822,35005:25110,35006:31903,35007:34999,35008:23433,35009:24245,35010:25353,35011:26263,35012:26696,35013:38343,35014:38797,35015:26447,35016:20197,35017:20234,35018:20301,35019:20381,35020:20553,35021:22258,35022:22839,35023:22996,35024:23041,35025:23561,35026:24799,35027:24847,35028:24944,35029:26131,35030:26885,35031:28858,35032:30031,35033:30064,35034:31227,35035:32173,35036:32239,35037:32963,35038:33806,35039:34915,35040:35586,35041:36949,35042:36986,35043:21307,35044:20117,35045:20133,35046:22495,35047:32946,35048:37057,35049:30959,35050:19968,35051:22769,35052:28322,35053:36920,35054:31282,35055:33576,35056:33419,35057:39983,35058:20801,35059:21360,35060:21693,35061:21729,35062:22240,35063:23035,35064:24341,35065:39154,35066:28139,35067:32996,35068:34093,35136:38498,35137:38512,35138:38560,35139:38907,35140:21515,35141:21491,35142:23431,35143:28879,35144:32701,35145:36802,35146:38632,35147:21359,35148:40284,35149:31418,35150:19985,35151:30867,35152:33276,35153:28198,35154:22040,35155:21764,35156:27421,35157:34074,35158:39995,35159:23013,35160:21417,35161:28006,35162:29916,35163:38287,35164:22082,35165:20113,35166:36939,35167:38642,35168:33615,35169:39180,35170:21473,35171:21942,35172:23344,35173:24433,35174:26144,35175:26355,35176:26628,35177:27704,35178:27891,35179:27945,35180:29787,35181:30408,35182:31310,35183:38964,35184:33521,35185:34907,35186:35424,35187:37613,35188:28082,35189:30123,35190:30410,35191:39365,35192:24742,35193:35585,35194:36234,35195:38322,35196:27022,35197:21421,35198:20870,35200:22290,35201:22576,35202:22852,35203:23476,35204:24310,35205:24616,35206:25513,35207:25588,35208:27839,35209:28436,35210:28814,35211:28948,35212:29017,35213:29141,35214:29503,35215:32257,35216:33398,35217:33489,35218:34199,35219:36960,35220:37467,35221:40219,35222:22633,35223:26044,35224:27738,35225:29989,35226:20985,35227:22830,35228:22885,35229:24448,35230:24540,35231:25276,35232:26106,35233:27178,35234:27431,35235:27572,35236:29579,35237:32705,35238:35158,35239:40236,35240:40206,35241:40644,35242:23713,35243:27798,35244:33659,35245:20740,35246:23627,35247:25014,35248:33222,35249:26742,35250:29281,35251:20057,35252:20474,35253:21368,35254:24681,35255:28201,35256:31311,35257:38899,35258:19979,35259:21270,35260:20206,35261:20309,35262:20285,35263:20385,35264:20339,35265:21152,35266:21487,35267:22025,35268:22799,35269:23233,35270:23478,35271:23521,35272:31185,35273:26247,35274:26524,35275:26550,35276:27468,35277:27827,35278:28779,35279:29634,35280:31117,35281:31166,35282:31292,35283:31623,35284:33457,35285:33499,35286:33540,35287:33655,35288:33775,35289:33747,35290:34662,35291:35506,35292:22057,35293:36008,35294:36838,35295:36942,35296:38686,35297:34442,35298:20420,35299:23784,35300:25105,35301:29273,35302:30011,35303:33253,35304:33469,35305:34558,35306:36032,35307:38597,35308:39187,35309:39381,35310:20171,35311:20250,35312:35299,35313:22238,35314:22602,35315:22730,35316:24315,35317:24555,35318:24618,35319:24724,35320:24674,35321:25040,35322:25106,35323:25296,35324:25913,35392:39745,35393:26214,35394:26800,35395:28023,35396:28784,35397:30028,35398:30342,35399:32117,35400:33445,35401:34809,35402:38283,35403:38542,35404:35997,35405:20977,35406:21182,35407:22806,35408:21683,35409:23475,35410:23830,35411:24936,35412:27010,35413:28079,35414:30861,35415:33995,35416:34903,35417:35442,35418:37799,35419:39608,35420:28012,35421:39336,35422:34521,35423:22435,35424:26623,35425:34510,35426:37390,35427:21123,35428:22151,35429:21508,35430:24275,35431:25313,35432:25785,35433:26684,35434:26680,35435:27579,35436:29554,35437:30906,35438:31339,35439:35226,35440:35282,35441:36203,35442:36611,35443:37101,35444:38307,35445:38548,35446:38761,35447:23398,35448:23731,35449:27005,35450:38989,35451:38990,35452:25499,35453:31520,35454:27179,35456:27263,35457:26806,35458:39949,35459:28511,35460:21106,35461:21917,35462:24688,35463:25324,35464:27963,35465:28167,35466:28369,35467:33883,35468:35088,35469:36676,35470:19988,35471:39993,35472:21494,35473:26907,35474:27194,35475:38788,35476:26666,35477:20828,35478:31427,35479:33970,35480:37340,35481:37772,35482:22107,35483:40232,35484:26658,35485:33541,35486:33841,35487:31909,35488:21e3,35489:33477,35490:29926,35491:20094,35492:20355,35493:20896,35494:23506,35495:21002,35496:21208,35497:21223,35498:24059,35499:21914,35500:22570,35501:23014,35502:23436,35503:23448,35504:23515,35505:24178,35506:24185,35507:24739,35508:24863,35509:24931,35510:25022,35511:25563,35512:25954,35513:26577,35514:26707,35515:26874,35516:27454,35517:27475,35518:27735,35519:28450,35520:28567,35521:28485,35522:29872,35523:29976,35524:30435,35525:30475,35526:31487,35527:31649,35528:31777,35529:32233,35530:32566,35531:32752,35532:32925,35533:33382,35534:33694,35535:35251,35536:35532,35537:36011,35538:36996,35539:37969,35540:38291,35541:38289,35542:38306,35543:38501,35544:38867,35545:39208,35546:33304,35547:20024,35548:21547,35549:23736,35550:24012,35551:29609,35552:30284,35553:30524,35554:23721,35555:32747,35556:36107,35557:38593,35558:38929,35559:38996,35560:39e3,35561:20225,35562:20238,35563:21361,35564:21916,35565:22120,35566:22522,35567:22855,35568:23305,35569:23492,35570:23696,35571:24076,35572:24190,35573:24524,35574:25582,35575:26426,35576:26071,35577:26082,35578:26399,35579:26827,35580:26820,35648:27231,35649:24112,35650:27589,35651:27671,35652:27773,35653:30079,35654:31048,35655:23395,35656:31232,35657:32e3,35658:24509,35659:35215,35660:35352,35661:36020,35662:36215,35663:36556,35664:36637,35665:39138,35666:39438,35667:39740,35668:20096,35669:20605,35670:20736,35671:22931,35672:23452,35673:25135,35674:25216,35675:25836,35676:27450,35677:29344,35678:30097,35679:31047,35680:32681,35681:34811,35682:35516,35683:35696,35684:25516,35685:33738,35686:38816,35687:21513,35688:21507,35689:21931,35690:26708,35691:27224,35692:35440,35693:30759,35694:26485,35695:40653,35696:21364,35697:23458,35698:33050,35699:34384,35700:36870,35701:19992,35702:20037,35703:20167,35704:20241,35705:21450,35706:21560,35707:23470,35708:24339,35709:24613,35710:25937,35712:26429,35713:27714,35714:27762,35715:27875,35716:28792,35717:29699,35718:31350,35719:31406,35720:31496,35721:32026,35722:31998,35723:32102,35724:26087,35725:29275,35726:21435,35727:23621,35728:24040,35729:25298,35730:25312,35731:25369,35732:28192,35733:34394,35734:35377,35735:36317,35736:37624,35737:28417,35738:31142,35739:39770,35740:20136,35741:20139,35742:20140,35743:20379,35744:20384,35745:20689,35746:20807,35747:31478,35748:20849,35749:20982,35750:21332,35751:21281,35752:21375,35753:21483,35754:21932,35755:22659,35756:23777,35757:24375,35758:24394,35759:24623,35760:24656,35761:24685,35762:25375,35763:25945,35764:27211,35765:27841,35766:29378,35767:29421,35768:30703,35769:33016,35770:33029,35771:33288,35772:34126,35773:37111,35774:37857,35775:38911,35776:39255,35777:39514,35778:20208,35779:20957,35780:23597,35781:26241,35782:26989,35783:23616,35784:26354,35785:26997,35786:29577,35787:26704,35788:31873,35789:20677,35790:21220,35791:22343,35792:24062,35793:37670,35794:26020,35795:27427,35796:27453,35797:29748,35798:31105,35799:31165,35800:31563,35801:32202,35802:33465,35803:33740,35804:34943,35805:35167,35806:35641,35807:36817,35808:37329,35809:21535,35810:37504,35811:20061,35812:20534,35813:21477,35814:21306,35815:29399,35816:29590,35817:30697,35818:33510,35819:36527,35820:39366,35821:39368,35822:39378,35823:20855,35824:24858,35825:34398,35826:21936,35827:31354,35828:20598,35829:23507,35830:36935,35831:38533,35832:20018,35833:27355,35834:37351,35835:23633,35836:23624,35904:25496,35905:31391,35906:27795,35907:38772,35908:36705,35909:31402,35910:29066,35911:38536,35912:31874,35913:26647,35914:32368,35915:26705,35916:37740,35917:21234,35918:21531,35919:34219,35920:35347,35921:32676,35922:36557,35923:37089,35924:21350,35925:34952,35926:31041,35927:20418,35928:20670,35929:21009,35930:20804,35931:21843,35932:22317,35933:29674,35934:22411,35935:22865,35936:24418,35937:24452,35938:24693,35939:24950,35940:24935,35941:25001,35942:25522,35943:25658,35944:25964,35945:26223,35946:26690,35947:28179,35948:30054,35949:31293,35950:31995,35951:32076,35952:32153,35953:32331,35954:32619,35955:33550,35956:33610,35957:34509,35958:35336,35959:35427,35960:35686,35961:36605,35962:38938,35963:40335,35964:33464,35965:36814,35966:39912,35968:21127,35969:25119,35970:25731,35971:28608,35972:38553,35973:26689,35974:20625,35975:27424,35976:27770,35977:28500,35978:31348,35979:32080,35980:34880,35981:35363,35982:26376,35983:20214,35984:20537,35985:20518,35986:20581,35987:20860,35988:21048,35989:21091,35990:21927,35991:22287,35992:22533,35993:23244,35994:24314,35995:25010,35996:25080,35997:25331,35998:25458,35999:26908,36e3:27177,36001:29309,36002:29356,36003:29486,36004:30740,36005:30831,36006:32121,36007:30476,36008:32937,36009:35211,36010:35609,36011:36066,36012:36562,36013:36963,36014:37749,36015:38522,36016:38997,36017:39443,36018:40568,36019:20803,36020:21407,36021:21427,36022:24187,36023:24358,36024:28187,36025:28304,36026:29572,36027:29694,36028:32067,36029:33335,36030:35328,36031:35578,36032:38480,36033:20046,36034:20491,36035:21476,36036:21628,36037:22266,36038:22993,36039:23396,36040:24049,36041:24235,36042:24359,36043:25144,36044:25925,36045:26543,36046:28246,36047:29392,36048:31946,36049:34996,36050:32929,36051:32993,36052:33776,36053:34382,36054:35463,36055:36328,36056:37431,36057:38599,36058:39015,36059:40723,36060:20116,36061:20114,36062:20237,36063:21320,36064:21577,36065:21566,36066:23087,36067:24460,36068:24481,36069:24735,36070:26791,36071:27278,36072:29786,36073:30849,36074:35486,36075:35492,36076:35703,36077:37264,36078:20062,36079:39881,36080:20132,36081:20348,36082:20399,36083:20505,36084:20502,36085:20809,36086:20844,36087:21151,36088:21177,36089:21246,36090:21402,36091:21475,36092:21521,36160:21518,36161:21897,36162:22353,36163:22434,36164:22909,36165:23380,36166:23389,36167:23439,36168:24037,36169:24039,36170:24055,36171:24184,36172:24195,36173:24218,36174:24247,36175:24344,36176:24658,36177:24908,36178:25239,36179:25304,36180:25511,36181:25915,36182:26114,36183:26179,36184:26356,36185:26477,36186:26657,36187:26775,36188:27083,36189:27743,36190:27946,36191:28009,36192:28207,36193:28317,36194:30002,36195:30343,36196:30828,36197:31295,36198:31968,36199:32005,36200:32024,36201:32094,36202:32177,36203:32789,36204:32771,36205:32943,36206:32945,36207:33108,36208:33167,36209:33322,36210:33618,36211:34892,36212:34913,36213:35611,36214:36002,36215:36092,36216:37066,36217:37237,36218:37489,36219:30783,36220:37628,36221:38308,36222:38477,36224:38917,36225:39321,36226:39640,36227:40251,36228:21083,36229:21163,36230:21495,36231:21512,36232:22741,36233:25335,36234:28640,36235:35946,36236:36703,36237:40633,36238:20811,36239:21051,36240:21578,36241:22269,36242:31296,36243:37239,36244:40288,36245:40658,36246:29508,36247:28425,36248:33136,36249:29969,36250:24573,36251:24794,36252:39592,36253:29403,36254:36796,36255:27492,36256:38915,36257:20170,36258:22256,36259:22372,36260:22718,36261:23130,36262:24680,36263:25031,36264:26127,36265:26118,36266:26681,36267:26801,36268:28151,36269:30165,36270:32058,36271:33390,36272:39746,36273:20123,36274:20304,36275:21449,36276:21766,36277:23919,36278:24038,36279:24046,36280:26619,36281:27801,36282:29811,36283:30722,36284:35408,36285:37782,36286:35039,36287:22352,36288:24231,36289:25387,36290:20661,36291:20652,36292:20877,36293:26368,36294:21705,36295:22622,36296:22971,36297:23472,36298:24425,36299:25165,36300:25505,36301:26685,36302:27507,36303:28168,36304:28797,36305:37319,36306:29312,36307:30741,36308:30758,36309:31085,36310:25998,36311:32048,36312:33756,36313:35009,36314:36617,36315:38555,36316:21092,36317:22312,36318:26448,36319:32618,36320:36001,36321:20916,36322:22338,36323:38442,36324:22586,36325:27018,36326:32948,36327:21682,36328:23822,36329:22524,36330:30869,36331:40442,36332:20316,36333:21066,36334:21643,36335:25662,36336:26152,36337:26388,36338:26613,36339:31364,36340:31574,36341:32034,36342:37679,36343:26716,36344:39853,36345:31545,36346:21273,36347:20874,36348:21047,36416:23519,36417:25334,36418:25774,36419:25830,36420:26413,36421:27578,36422:34217,36423:38609,36424:30352,36425:39894,36426:25420,36427:37638,36428:39851,36429:30399,36430:26194,36431:19977,36432:20632,36433:21442,36434:23665,36435:24808,36436:25746,36437:25955,36438:26719,36439:29158,36440:29642,36441:29987,36442:31639,36443:32386,36444:34453,36445:35715,36446:36059,36447:37240,36448:39184,36449:26028,36450:26283,36451:27531,36452:20181,36453:20180,36454:20282,36455:20351,36456:21050,36457:21496,36458:21490,36459:21987,36460:22235,36461:22763,36462:22987,36463:22985,36464:23039,36465:23376,36466:23629,36467:24066,36468:24107,36469:24535,36470:24605,36471:25351,36472:25903,36473:23388,36474:26031,36475:26045,36476:26088,36477:26525,36478:27490,36480:27515,36481:27663,36482:29509,36483:31049,36484:31169,36485:31992,36486:32025,36487:32043,36488:32930,36489:33026,36490:33267,36491:35222,36492:35422,36493:35433,36494:35430,36495:35468,36496:35566,36497:36039,36498:36060,36499:38604,36500:39164,36501:27503,36502:20107,36503:20284,36504:20365,36505:20816,36506:23383,36507:23546,36508:24904,36509:25345,36510:26178,36511:27425,36512:28363,36513:27835,36514:29246,36515:29885,36516:30164,36517:30913,36518:31034,36519:32780,36520:32819,36521:33258,36522:33940,36523:36766,36524:27728,36525:40575,36526:24335,36527:35672,36528:40235,36529:31482,36530:36600,36531:23437,36532:38635,36533:19971,36534:21489,36535:22519,36536:22833,36537:23241,36538:23460,36539:24713,36540:28287,36541:28422,36542:30142,36543:36074,36544:23455,36545:34048,36546:31712,36547:20594,36548:26612,36549:33437,36550:23649,36551:34122,36552:32286,36553:33294,36554:20889,36555:23556,36556:25448,36557:36198,36558:26012,36559:29038,36560:31038,36561:32023,36562:32773,36563:35613,36564:36554,36565:36974,36566:34503,36567:37034,36568:20511,36569:21242,36570:23610,36571:26451,36572:28796,36573:29237,36574:37196,36575:37320,36576:37675,36577:33509,36578:23490,36579:24369,36580:24825,36581:20027,36582:21462,36583:23432,36584:25163,36585:26417,36586:27530,36587:29417,36588:29664,36589:31278,36590:33131,36591:36259,36592:37202,36593:39318,36594:20754,36595:21463,36596:21610,36597:23551,36598:25480,36599:27193,36600:32172,36601:38656,36602:22234,36603:21454,36604:21608,36672:23447,36673:23601,36674:24030,36675:20462,36676:24833,36677:25342,36678:27954,36679:31168,36680:31179,36681:32066,36682:32333,36683:32722,36684:33261,36685:33311,36686:33936,36687:34886,36688:35186,36689:35728,36690:36468,36691:36655,36692:36913,36693:37195,36694:37228,36695:38598,36696:37276,36697:20160,36698:20303,36699:20805,36700:21313,36701:24467,36702:25102,36703:26580,36704:27713,36705:28171,36706:29539,36707:32294,36708:37325,36709:37507,36710:21460,36711:22809,36712:23487,36713:28113,36714:31069,36715:32302,36716:31899,36717:22654,36718:29087,36719:20986,36720:34899,36721:36848,36722:20426,36723:23803,36724:26149,36725:30636,36726:31459,36727:33308,36728:39423,36729:20934,36730:24490,36731:26092,36732:26991,36733:27529,36734:28147,36736:28310,36737:28516,36738:30462,36739:32020,36740:24033,36741:36981,36742:37255,36743:38918,36744:20966,36745:21021,36746:25152,36747:26257,36748:26329,36749:28186,36750:24246,36751:32210,36752:32626,36753:26360,36754:34223,36755:34295,36756:35576,36757:21161,36758:21465,36759:22899,36760:24207,36761:24464,36762:24661,36763:37604,36764:38500,36765:20663,36766:20767,36767:21213,36768:21280,36769:21319,36770:21484,36771:21736,36772:21830,36773:21809,36774:22039,36775:22888,36776:22974,36777:23100,36778:23477,36779:23558,36780:23567,36781:23569,36782:23578,36783:24196,36784:24202,36785:24288,36786:24432,36787:25215,36788:25220,36789:25307,36790:25484,36791:25463,36792:26119,36793:26124,36794:26157,36795:26230,36796:26494,36797:26786,36798:27167,36799:27189,36800:27836,36801:28040,36802:28169,36803:28248,36804:28988,36805:28966,36806:29031,36807:30151,36808:30465,36809:30813,36810:30977,36811:31077,36812:31216,36813:31456,36814:31505,36815:31911,36816:32057,36817:32918,36818:33750,36819:33931,36820:34121,36821:34909,36822:35059,36823:35359,36824:35388,36825:35412,36826:35443,36827:35937,36828:36062,36829:37284,36830:37478,36831:37758,36832:37912,36833:38556,36834:38808,36835:19978,36836:19976,36837:19998,36838:20055,36839:20887,36840:21104,36841:22478,36842:22580,36843:22732,36844:23330,36845:24120,36846:24773,36847:25854,36848:26465,36849:26454,36850:27972,36851:29366,36852:30067,36853:31331,36854:33976,36855:35698,36856:37304,36857:37664,36858:22065,36859:22516,36860:39166,36928:25325,36929:26893,36930:27542,36931:29165,36932:32340,36933:32887,36934:33394,36935:35302,36936:39135,36937:34645,36938:36785,36939:23611,36940:20280,36941:20449,36942:20405,36943:21767,36944:23072,36945:23517,36946:23529,36947:24515,36948:24910,36949:25391,36950:26032,36951:26187,36952:26862,36953:27035,36954:28024,36955:28145,36956:30003,36957:30137,36958:30495,36959:31070,36960:31206,36961:32051,36962:33251,36963:33455,36964:34218,36965:35242,36966:35386,36967:36523,36968:36763,36969:36914,36970:37341,36971:38663,36972:20154,36973:20161,36974:20995,36975:22645,36976:22764,36977:23563,36978:29978,36979:23613,36980:33102,36981:35338,36982:36805,36983:38499,36984:38765,36985:31525,36986:35535,36987:38920,36988:37218,36989:22259,36990:21416,36992:36887,36993:21561,36994:22402,36995:24101,36996:25512,36997:27700,36998:28810,36999:30561,37e3:31883,37001:32736,37002:34928,37003:36930,37004:37204,37005:37648,37006:37656,37007:38543,37008:29790,37009:39620,37010:23815,37011:23913,37012:25968,37013:26530,37014:36264,37015:38619,37016:25454,37017:26441,37018:26905,37019:33733,37020:38935,37021:38592,37022:35070,37023:28548,37024:25722,37025:23544,37026:19990,37027:28716,37028:30045,37029:26159,37030:20932,37031:21046,37032:21218,37033:22995,37034:24449,37035:24615,37036:25104,37037:25919,37038:25972,37039:26143,37040:26228,37041:26866,37042:26646,37043:27491,37044:28165,37045:29298,37046:29983,37047:30427,37048:31934,37049:32854,37050:22768,37051:35069,37052:35199,37053:35488,37054:35475,37055:35531,37056:36893,37057:37266,37058:38738,37059:38745,37060:25993,37061:31246,37062:33030,37063:38587,37064:24109,37065:24796,37066:25114,37067:26021,37068:26132,37069:26512,37070:30707,37071:31309,37072:31821,37073:32318,37074:33034,37075:36012,37076:36196,37077:36321,37078:36447,37079:30889,37080:20999,37081:25305,37082:25509,37083:25666,37084:25240,37085:35373,37086:31363,37087:31680,37088:35500,37089:38634,37090:32118,37091:33292,37092:34633,37093:20185,37094:20808,37095:21315,37096:21344,37097:23459,37098:23554,37099:23574,37100:24029,37101:25126,37102:25159,37103:25776,37104:26643,37105:26676,37106:27849,37107:27973,37108:27927,37109:26579,37110:28508,37111:29006,37112:29053,37113:26059,37114:31359,37115:31661,37116:32218,37184:32330,37185:32680,37186:33146,37187:33307,37188:33337,37189:34214,37190:35438,37191:36046,37192:36341,37193:36984,37194:36983,37195:37549,37196:37521,37197:38275,37198:39854,37199:21069,37200:21892,37201:28472,37202:28982,37203:20840,37204:31109,37205:32341,37206:33203,37207:31950,37208:22092,37209:22609,37210:23720,37211:25514,37212:26366,37213:26365,37214:26970,37215:29401,37216:30095,37217:30094,37218:30990,37219:31062,37220:31199,37221:31895,37222:32032,37223:32068,37224:34311,37225:35380,37226:38459,37227:36961,37228:40736,37229:20711,37230:21109,37231:21452,37232:21474,37233:20489,37234:21930,37235:22766,37236:22863,37237:29245,37238:23435,37239:23652,37240:21277,37241:24803,37242:24819,37243:25436,37244:25475,37245:25407,37246:25531,37248:25805,37249:26089,37250:26361,37251:24035,37252:27085,37253:27133,37254:28437,37255:29157,37256:20105,37257:30185,37258:30456,37259:31379,37260:31967,37261:32207,37262:32156,37263:32865,37264:33609,37265:33624,37266:33900,37267:33980,37268:34299,37269:35013,37270:36208,37271:36865,37272:36973,37273:37783,37274:38684,37275:39442,37276:20687,37277:22679,37278:24974,37279:33235,37280:34101,37281:36104,37282:36896,37283:20419,37284:20596,37285:21063,37286:21363,37287:24687,37288:25417,37289:26463,37290:28204,37291:36275,37292:36895,37293:20439,37294:23646,37295:36042,37296:26063,37297:32154,37298:21330,37299:34966,37300:20854,37301:25539,37302:23384,37303:23403,37304:23562,37305:25613,37306:26449,37307:36956,37308:20182,37309:22810,37310:22826,37311:27760,37312:35409,37313:21822,37314:22549,37315:22949,37316:24816,37317:25171,37318:26561,37319:33333,37320:26965,37321:38464,37322:39364,37323:39464,37324:20307,37325:22534,37326:23550,37327:32784,37328:23729,37329:24111,37330:24453,37331:24608,37332:24907,37333:25140,37334:26367,37335:27888,37336:28382,37337:32974,37338:33151,37339:33492,37340:34955,37341:36024,37342:36864,37343:36910,37344:38538,37345:40667,37346:39899,37347:20195,37348:21488,37349:22823,37350:31532,37351:37261,37352:38988,37353:40441,37354:28381,37355:28711,37356:21331,37357:21828,37358:23429,37359:25176,37360:25246,37361:25299,37362:27810,37363:28655,37364:29730,37365:35351,37366:37944,37367:28609,37368:35582,37369:33592,37370:20967,37371:34552,37372:21482,37440:21481,37441:20294,37442:36948,37443:36784,37444:22890,37445:33073,37446:24061,37447:31466,37448:36799,37449:26842,37450:35895,37451:29432,37452:40008,37453:27197,37454:35504,37455:20025,37456:21336,37457:22022,37458:22374,37459:25285,37460:25506,37461:26086,37462:27470,37463:28129,37464:28251,37465:28845,37466:30701,37467:31471,37468:31658,37469:32187,37470:32829,37471:32966,37472:34507,37473:35477,37474:37723,37475:22243,37476:22727,37477:24382,37478:26029,37479:26262,37480:27264,37481:27573,37482:30007,37483:35527,37484:20516,37485:30693,37486:22320,37487:24347,37488:24677,37489:26234,37490:27744,37491:30196,37492:31258,37493:32622,37494:33268,37495:34584,37496:36933,37497:39347,37498:31689,37499:30044,37500:31481,37501:31569,37502:33988,37504:36880,37505:31209,37506:31378,37507:33590,37508:23265,37509:30528,37510:20013,37511:20210,37512:23449,37513:24544,37514:25277,37515:26172,37516:26609,37517:27880,37518:34411,37519:34935,37520:35387,37521:37198,37522:37619,37523:39376,37524:27159,37525:28710,37526:29482,37527:33511,37528:33879,37529:36015,37530:19969,37531:20806,37532:20939,37533:21899,37534:23541,37535:24086,37536:24115,37537:24193,37538:24340,37539:24373,37540:24427,37541:24500,37542:25074,37543:25361,37544:26274,37545:26397,37546:28526,37547:29266,37548:30010,37549:30522,37550:32884,37551:33081,37552:33144,37553:34678,37554:35519,37555:35548,37556:36229,37557:36339,37558:37530,37559:38263,37560:38914,37561:40165,37562:21189,37563:25431,37564:30452,37565:26389,37566:27784,37567:29645,37568:36035,37569:37806,37570:38515,37571:27941,37572:22684,37573:26894,37574:27084,37575:36861,37576:37786,37577:30171,37578:36890,37579:22618,37580:26626,37581:25524,37582:27131,37583:20291,37584:28460,37585:26584,37586:36795,37587:34086,37588:32180,37589:37716,37590:26943,37591:28528,37592:22378,37593:22775,37594:23340,37595:32044,37596:29226,37597:21514,37598:37347,37599:40372,37600:20141,37601:20302,37602:20572,37603:20597,37604:21059,37605:35998,37606:21576,37607:22564,37608:23450,37609:24093,37610:24213,37611:24237,37612:24311,37613:24351,37614:24716,37615:25269,37616:25402,37617:25552,37618:26799,37619:27712,37620:30855,37621:31118,37622:31243,37623:32224,37624:33351,37625:35330,37626:35558,37627:36420,37628:36883,37696:37048,37697:37165,37698:37336,37699:40718,37700:27877,37701:25688,37702:25826,37703:25973,37704:28404,37705:30340,37706:31515,37707:36969,37708:37841,37709:28346,37710:21746,37711:24505,37712:25764,37713:36685,37714:36845,37715:37444,37716:20856,37717:22635,37718:22825,37719:23637,37720:24215,37721:28155,37722:32399,37723:29980,37724:36028,37725:36578,37726:39003,37727:28857,37728:20253,37729:27583,37730:28593,37731:3e4,37732:38651,37733:20814,37734:21520,37735:22581,37736:22615,37737:22956,37738:23648,37739:24466,37740:26007,37741:26460,37742:28193,37743:30331,37744:33759,37745:36077,37746:36884,37747:37117,37748:37709,37749:30757,37750:30778,37751:21162,37752:24230,37753:22303,37754:22900,37755:24594,37756:20498,37757:20826,37758:20908,37760:20941,37761:20992,37762:21776,37763:22612,37764:22616,37765:22871,37766:23445,37767:23798,37768:23947,37769:24764,37770:25237,37771:25645,37772:26481,37773:26691,37774:26812,37775:26847,37776:30423,37777:28120,37778:28271,37779:28059,37780:28783,37781:29128,37782:24403,37783:30168,37784:31095,37785:31561,37786:31572,37787:31570,37788:31958,37789:32113,37790:21040,37791:33891,37792:34153,37793:34276,37794:35342,37795:35588,37796:35910,37797:36367,37798:36867,37799:36879,37800:37913,37801:38518,37802:38957,37803:39472,37804:38360,37805:20685,37806:21205,37807:21516,37808:22530,37809:23566,37810:24999,37811:25758,37812:27934,37813:30643,37814:31461,37815:33012,37816:33796,37817:36947,37818:37509,37819:23776,37820:40199,37821:21311,37822:24471,37823:24499,37824:28060,37825:29305,37826:30563,37827:31167,37828:31716,37829:27602,37830:29420,37831:35501,37832:26627,37833:27233,37834:20984,37835:31361,37836:26932,37837:23626,37838:40182,37839:33515,37840:23493,37841:37193,37842:28702,37843:22136,37844:23663,37845:24775,37846:25958,37847:27788,37848:35930,37849:36929,37850:38931,37851:21585,37852:26311,37853:37389,37854:22856,37855:37027,37856:20869,37857:20045,37858:20970,37859:34201,37860:35598,37861:28760,37862:25466,37863:37707,37864:26978,37865:39348,37866:32260,37867:30071,37868:21335,37869:26976,37870:36575,37871:38627,37872:27741,37873:20108,37874:23612,37875:24336,37876:36841,37877:21250,37878:36049,37879:32905,37880:34425,37881:24319,37882:26085,37883:20083,37884:20837,37952:22914,37953:23615,37954:38894,37955:20219,37956:22922,37957:24525,37958:35469,37959:28641,37960:31152,37961:31074,37962:23527,37963:33905,37964:29483,37965:29105,37966:24180,37967:24565,37968:25467,37969:25754,37970:29123,37971:31896,37972:20035,37973:24316,37974:20043,37975:22492,37976:22178,37977:24745,37978:28611,37979:32013,37980:33021,37981:33075,37982:33215,37983:36786,37984:35223,37985:34468,37986:24052,37987:25226,37988:25773,37989:35207,37990:26487,37991:27874,37992:27966,37993:29750,37994:30772,37995:23110,37996:32629,37997:33453,37998:39340,37999:20467,38e3:24259,38001:25309,38002:25490,38003:25943,38004:26479,38005:30403,38006:29260,38007:32972,38008:32954,38009:36649,38010:37197,38011:20493,38012:22521,38013:23186,38014:26757,38016:26995,38017:29028,38018:29437,38019:36023,38020:22770,38021:36064,38022:38506,38023:36889,38024:34687,38025:31204,38026:30695,38027:33833,38028:20271,38029:21093,38030:21338,38031:25293,38032:26575,38033:27850,38034:30333,38035:31636,38036:31893,38037:33334,38038:34180,38039:36843,38040:26333,38041:28448,38042:29190,38043:32283,38044:33707,38045:39361,38046:40614,38047:20989,38048:31665,38049:30834,38050:31672,38051:32903,38052:31560,38053:27368,38054:24161,38055:32908,38056:30033,38057:30048,38058:20843,38059:37474,38060:28300,38061:30330,38062:37271,38063:39658,38064:20240,38065:32624,38066:25244,38067:31567,38068:38309,38069:40169,38070:22138,38071:22617,38072:34532,38073:38588,38074:20276,38075:21028,38076:21322,38077:21453,38078:21467,38079:24070,38080:25644,38081:26001,38082:26495,38083:27710,38084:27726,38085:29256,38086:29359,38087:29677,38088:30036,38089:32321,38090:33324,38091:34281,38092:36009,38093:31684,38094:37318,38095:29033,38096:38930,38097:39151,38098:25405,38099:26217,38100:30058,38101:30436,38102:30928,38103:34115,38104:34542,38105:21290,38106:21329,38107:21542,38108:22915,38109:24199,38110:24444,38111:24754,38112:25161,38113:25209,38114:25259,38115:26e3,38116:27604,38117:27852,38118:30130,38119:30382,38120:30865,38121:31192,38122:32203,38123:32631,38124:32933,38125:34987,38126:35513,38127:36027,38128:36991,38129:38750,38130:39131,38131:27147,38132:31800,38133:20633,38134:23614,38135:24494,38136:26503,38137:27608,38138:29749,38139:30473,38140:32654,38208:40763,38209:26570,38210:31255,38211:21305,38212:30091,38213:39661,38214:24422,38215:33181,38216:33777,38217:32920,38218:24380,38219:24517,38220:30050,38221:31558,38222:36924,38223:26727,38224:23019,38225:23195,38226:32016,38227:30334,38228:35628,38229:20469,38230:24426,38231:27161,38232:27703,38233:28418,38234:29922,38235:31080,38236:34920,38237:35413,38238:35961,38239:24287,38240:25551,38241:30149,38242:31186,38243:33495,38244:37672,38245:37618,38246:33948,38247:34541,38248:39981,38249:21697,38250:24428,38251:25996,38252:27996,38253:28693,38254:36007,38255:36051,38256:38971,38257:25935,38258:29942,38259:19981,38260:20184,38261:22496,38262:22827,38263:23142,38264:23500,38265:20904,38266:24067,38267:24220,38268:24598,38269:25206,38270:25975,38272:26023,38273:26222,38274:28014,38275:29238,38276:31526,38277:33104,38278:33178,38279:33433,38280:35676,38281:36e3,38282:36070,38283:36212,38284:38428,38285:38468,38286:20398,38287:25771,38288:27494,38289:33310,38290:33889,38291:34154,38292:37096,38293:23553,38294:26963,38295:39080,38296:33914,38297:34135,38298:20239,38299:21103,38300:24489,38301:24133,38302:26381,38303:31119,38304:33145,38305:35079,38306:35206,38307:28149,38308:24343,38309:25173,38310:27832,38311:20175,38312:29289,38313:39826,38314:20998,38315:21563,38316:22132,38317:22707,38318:24996,38319:25198,38320:28954,38321:22894,38322:31881,38323:31966,38324:32027,38325:38640,38326:25991,38327:32862,38328:19993,38329:20341,38330:20853,38331:22592,38332:24163,38333:24179,38334:24330,38335:26564,38336:20006,38337:34109,38338:38281,38339:38491,38340:31859,38341:38913,38342:20731,38343:22721,38344:30294,38345:30887,38346:21029,38347:30629,38348:34065,38349:31622,38350:20559,38351:22793,38352:29255,38353:31687,38354:32232,38355:36794,38356:36820,38357:36941,38358:20415,38359:21193,38360:23081,38361:24321,38362:38829,38363:20445,38364:33303,38365:37610,38366:22275,38367:25429,38368:27497,38369:29995,38370:35036,38371:36628,38372:31298,38373:21215,38374:22675,38375:24917,38376:25098,38377:26286,38378:27597,38379:31807,38380:33769,38381:20515,38382:20472,38383:21253,38384:21574,38385:22577,38386:22857,38387:23453,38388:23792,38389:23791,38390:23849,38391:24214,38392:25265,38393:25447,38394:25918,38395:26041,38396:26379,38464:27861,38465:27873,38466:28921,38467:30770,38468:32299,38469:32990,38470:33459,38471:33804,38472:34028,38473:34562,38474:35090,38475:35370,38476:35914,38477:37030,38478:37586,38479:39165,38480:40179,38481:40300,38482:20047,38483:20129,38484:20621,38485:21078,38486:22346,38487:22952,38488:24125,38489:24536,38490:24537,38491:25151,38492:26292,38493:26395,38494:26576,38495:26834,38496:20882,38497:32033,38498:32938,38499:33192,38500:35584,38501:35980,38502:36031,38503:37502,38504:38450,38505:21536,38506:38956,38507:21271,38508:20693,38509:21340,38510:22696,38511:25778,38512:26420,38513:29287,38514:30566,38515:31302,38516:37350,38517:21187,38518:27809,38519:27526,38520:22528,38521:24140,38522:22868,38523:26412,38524:32763,38525:20961,38526:30406,38528:25705,38529:30952,38530:39764,38531:40635,38532:22475,38533:22969,38534:26151,38535:26522,38536:27598,38537:21737,38538:27097,38539:24149,38540:33180,38541:26517,38542:39850,38543:26622,38544:40018,38545:26717,38546:20134,38547:20451,38548:21448,38549:25273,38550:26411,38551:27819,38552:36804,38553:20397,38554:32365,38555:40639,38556:19975,38557:24930,38558:28288,38559:28459,38560:34067,38561:21619,38562:26410,38563:39749,38564:24051,38565:31637,38566:23724,38567:23494,38568:34588,38569:28234,38570:34001,38571:31252,38572:33032,38573:22937,38574:31885,38575:27665,38576:30496,38577:21209,38578:22818,38579:28961,38580:29279,38581:30683,38582:38695,38583:40289,38584:26891,38585:23167,38586:23064,38587:20901,38588:21517,38589:21629,38590:26126,38591:30431,38592:36855,38593:37528,38594:40180,38595:23018,38596:29277,38597:28357,38598:20813,38599:26825,38600:32191,38601:32236,38602:38754,38603:40634,38604:25720,38605:27169,38606:33538,38607:22916,38608:23391,38609:27611,38610:29467,38611:30450,38612:32178,38613:32791,38614:33945,38615:20786,38616:26408,38617:40665,38618:30446,38619:26466,38620:21247,38621:39173,38622:23588,38623:25147,38624:31870,38625:36016,38626:21839,38627:24758,38628:32011,38629:38272,38630:21249,38631:20063,38632:20918,38633:22812,38634:29242,38635:32822,38636:37326,38637:24357,38638:30690,38639:21380,38640:24441,38641:32004,38642:34220,38643:35379,38644:36493,38645:38742,38646:26611,38647:34222,38648:37971,38649:24841,38650:24840,38651:27833,38652:30290,38720:35565,38721:36664,38722:21807,38723:20305,38724:20778,38725:21191,38726:21451,38727:23461,38728:24189,38729:24736,38730:24962,38731:25558,38732:26377,38733:26586,38734:28263,38735:28044,38736:29494,38737:29495,38738:30001,38739:31056,38740:35029,38741:35480,38742:36938,38743:37009,38744:37109,38745:38596,38746:34701,38747:22805,38748:20104,38749:20313,38750:19982,38751:35465,38752:36671,38753:38928,38754:20653,38755:24188,38756:22934,38757:23481,38758:24248,38759:25562,38760:25594,38761:25793,38762:26332,38763:26954,38764:27096,38765:27915,38766:28342,38767:29076,38768:29992,38769:31407,38770:32650,38771:32768,38772:33865,38773:33993,38774:35201,38775:35617,38776:36362,38777:36965,38778:38525,38779:39178,38780:24958,38781:25233,38782:27442,38784:27779,38785:28020,38786:32716,38787:32764,38788:28096,38789:32645,38790:34746,38791:35064,38792:26469,38793:33713,38794:38972,38795:38647,38796:27931,38797:32097,38798:33853,38799:37226,38800:20081,38801:21365,38802:23888,38803:27396,38804:28651,38805:34253,38806:34349,38807:35239,38808:21033,38809:21519,38810:23653,38811:26446,38812:26792,38813:29702,38814:29827,38815:30178,38816:35023,38817:35041,38818:37324,38819:38626,38820:38520,38821:24459,38822:29575,38823:31435,38824:33870,38825:25504,38826:30053,38827:21129,38828:27969,38829:28316,38830:29705,38831:30041,38832:30827,38833:31890,38834:38534,38835:31452,38836:40845,38837:20406,38838:24942,38839:26053,38840:34396,38841:20102,38842:20142,38843:20698,38844:20001,38845:20940,38846:23534,38847:26009,38848:26753,38849:28092,38850:29471,38851:30274,38852:30637,38853:31260,38854:31975,38855:33391,38856:35538,38857:36988,38858:37327,38859:38517,38860:38936,38861:21147,38862:32209,38863:20523,38864:21400,38865:26519,38866:28107,38867:29136,38868:29747,38869:33256,38870:36650,38871:38563,38872:40023,38873:40607,38874:29792,38875:22593,38876:28057,38877:32047,38878:39006,38879:20196,38880:20278,38881:20363,38882:20919,38883:21169,38884:23994,38885:24604,38886:29618,38887:31036,38888:33491,38889:37428,38890:38583,38891:38646,38892:38666,38893:40599,38894:40802,38895:26278,38896:27508,38897:21015,38898:21155,38899:28872,38900:35010,38901:24265,38902:24651,38903:24976,38904:28451,38905:29001,38906:31806,38907:32244,38908:32879,38976:34030,38977:36899,38978:37676,38979:21570,38980:39791,38981:27347,38982:28809,38983:36034,38984:36335,38985:38706,38986:21172,38987:23105,38988:24266,38989:24324,38990:26391,38991:27004,38992:27028,38993:28010,38994:28431,38995:29282,38996:29436,38997:31725,38998:32769,38999:32894,39e3:34635,39001:37070,39002:20845,39003:40595,39004:31108,39005:32907,39006:37682,39007:35542,39008:20525,39009:21644,39010:35441,39011:27498,39012:36036,39013:33031,39014:24785,39015:26528,39016:40434,39017:20121,39018:20120,39019:39952,39020:35435,39021:34241,39022:34152,39023:26880,39024:28286,39025:30871,39026:33109,39071:24332,39072:19984,39073:19989,39074:20010,39075:20017,39076:20022,39077:20028,39078:20031,39079:20034,39080:20054,39081:20056,39082:20098,39083:20101,39084:35947,39085:20106,39086:33298,39087:24333,39088:20110,39089:20126,39090:20127,39091:20128,39092:20130,39093:20144,39094:20147,39095:20150,39096:20174,39097:20173,39098:20164,39099:20166,39100:20162,39101:20183,39102:20190,39103:20205,39104:20191,39105:20215,39106:20233,39107:20314,39108:20272,39109:20315,39110:20317,39111:20311,39112:20295,39113:20342,39114:20360,39115:20367,39116:20376,39117:20347,39118:20329,39119:20336,39120:20369,39121:20335,39122:20358,39123:20374,39124:20760,39125:20436,39126:20447,39127:20430,39128:20440,39129:20443,39130:20433,39131:20442,39132:20432,39133:20452,39134:20453,39135:20506,39136:20520,39137:20500,39138:20522,39139:20517,39140:20485,39141:20252,39142:20470,39143:20513,39144:20521,39145:20524,39146:20478,39147:20463,39148:20497,39149:20486,39150:20547,39151:20551,39152:26371,39153:20565,39154:20560,39155:20552,39156:20570,39157:20566,39158:20588,39159:20600,39160:20608,39161:20634,39162:20613,39163:20660,39164:20658,39232:20681,39233:20682,39234:20659,39235:20674,39236:20694,39237:20702,39238:20709,39239:20717,39240:20707,39241:20718,39242:20729,39243:20725,39244:20745,39245:20737,39246:20738,39247:20758,39248:20757,39249:20756,39250:20762,39251:20769,39252:20794,39253:20791,39254:20796,39255:20795,39256:20799,39257:20800,39258:20818,39259:20812,39260:20820,39261:20834,39262:31480,39263:20841,39264:20842,39265:20846,39266:20864,39267:20866,39268:22232,39269:20876,39270:20873,39271:20879,39272:20881,39273:20883,39274:20885,39275:20886,39276:20900,39277:20902,39278:20898,39279:20905,39280:20906,39281:20907,39282:20915,39283:20913,39284:20914,39285:20912,39286:20917,39287:20925,39288:20933,39289:20937,39290:20955,39291:20960,39292:34389,39293:20969,39294:20973,39296:20976,39297:20981,39298:20990,39299:20996,39300:21003,39301:21012,39302:21006,39303:21031,39304:21034,39305:21038,39306:21043,39307:21049,39308:21071,39309:21060,39310:21067,39311:21068,39312:21086,39313:21076,39314:21098,39315:21108,39316:21097,39317:21107,39318:21119,39319:21117,39320:21133,39321:21140,39322:21138,39323:21105,39324:21128,39325:21137,39326:36776,39327:36775,39328:21164,39329:21165,39330:21180,39331:21173,39332:21185,39333:21197,39334:21207,39335:21214,39336:21219,39337:21222,39338:39149,39339:21216,39340:21235,39341:21237,39342:21240,39343:21241,39344:21254,39345:21256,39346:30008,39347:21261,39348:21264,39349:21263,39350:21269,39351:21274,39352:21283,39353:21295,39354:21297,39355:21299,39356:21304,39357:21312,39358:21318,39359:21317,39360:19991,39361:21321,39362:21325,39363:20950,39364:21342,39365:21353,39366:21358,39367:22808,39368:21371,39369:21367,39370:21378,39371:21398,39372:21408,39373:21414,39374:21413,39375:21422,39376:21424,39377:21430,39378:21443,39379:31762,39380:38617,39381:21471,39382:26364,39383:29166,39384:21486,39385:21480,39386:21485,39387:21498,39388:21505,39389:21565,39390:21568,39391:21548,39392:21549,39393:21564,39394:21550,39395:21558,39396:21545,39397:21533,39398:21582,39399:21647,39400:21621,39401:21646,39402:21599,39403:21617,39404:21623,39405:21616,39406:21650,39407:21627,39408:21632,39409:21622,39410:21636,39411:21648,39412:21638,39413:21703,39414:21666,39415:21688,39416:21669,39417:21676,39418:21700,39419:21704,39420:21672,39488:21675,39489:21698,39490:21668,39491:21694,39492:21692,39493:21720,39494:21733,39495:21734,39496:21775,39497:21780,39498:21757,39499:21742,39500:21741,39501:21754,39502:21730,39503:21817,39504:21824,39505:21859,39506:21836,39507:21806,39508:21852,39509:21829,39510:21846,39511:21847,39512:21816,39513:21811,39514:21853,39515:21913,39516:21888,39517:21679,39518:21898,39519:21919,39520:21883,39521:21886,39522:21912,39523:21918,39524:21934,39525:21884,39526:21891,39527:21929,39528:21895,39529:21928,39530:21978,39531:21957,39532:21983,39533:21956,39534:21980,39535:21988,39536:21972,39537:22036,39538:22007,39539:22038,39540:22014,39541:22013,39542:22043,39543:22009,39544:22094,39545:22096,39546:29151,39547:22068,39548:22070,39549:22066,39550:22072,39552:22123,39553:22116,39554:22063,39555:22124,39556:22122,39557:22150,39558:22144,39559:22154,39560:22176,39561:22164,39562:22159,39563:22181,39564:22190,39565:22198,39566:22196,39567:22210,39568:22204,39569:22209,39570:22211,39571:22208,39572:22216,39573:22222,39574:22225,39575:22227,39576:22231,39577:22254,39578:22265,39579:22272,39580:22271,39581:22276,39582:22281,39583:22280,39584:22283,39585:22285,39586:22291,39587:22296,39588:22294,39589:21959,39590:22300,39591:22310,39592:22327,39593:22328,39594:22350,39595:22331,39596:22336,39597:22351,39598:22377,39599:22464,39600:22408,39601:22369,39602:22399,39603:22409,39604:22419,39605:22432,39606:22451,39607:22436,39608:22442,39609:22448,39610:22467,39611:22470,39612:22484,39613:22482,39614:22483,39615:22538,39616:22486,39617:22499,39618:22539,39619:22553,39620:22557,39621:22642,39622:22561,39623:22626,39624:22603,39625:22640,39626:27584,39627:22610,39628:22589,39629:22649,39630:22661,39631:22713,39632:22687,39633:22699,39634:22714,39635:22750,39636:22715,39637:22712,39638:22702,39639:22725,39640:22739,39641:22737,39642:22743,39643:22745,39644:22744,39645:22757,39646:22748,39647:22756,39648:22751,39649:22767,39650:22778,39651:22777,39652:22779,39653:22780,39654:22781,39655:22786,39656:22794,39657:22800,39658:22811,39659:26790,39660:22821,39661:22828,39662:22829,39663:22834,39664:22840,39665:22846,39666:31442,39667:22869,39668:22864,39669:22862,39670:22874,39671:22872,39672:22882,39673:22880,39674:22887,39675:22892,39676:22889,39744:22904,39745:22913,39746:22941,39747:20318,39748:20395,39749:22947,39750:22962,39751:22982,39752:23016,39753:23004,39754:22925,39755:23001,39756:23002,39757:23077,39758:23071,39759:23057,39760:23068,39761:23049,39762:23066,39763:23104,39764:23148,39765:23113,39766:23093,39767:23094,39768:23138,39769:23146,39770:23194,39771:23228,39772:23230,39773:23243,39774:23234,39775:23229,39776:23267,39777:23255,39778:23270,39779:23273,39780:23254,39781:23290,39782:23291,39783:23308,39784:23307,39785:23318,39786:23346,39787:23248,39788:23338,39789:23350,39790:23358,39791:23363,39792:23365,39793:23360,39794:23377,39795:23381,39796:23386,39797:23387,39798:23397,39799:23401,39800:23408,39801:23411,39802:23413,39803:23416,39804:25992,39805:23418,39806:23424,39808:23427,39809:23462,39810:23480,39811:23491,39812:23495,39813:23497,39814:23508,39815:23504,39816:23524,39817:23526,39818:23522,39819:23518,39820:23525,39821:23531,39822:23536,39823:23542,39824:23539,39825:23557,39826:23559,39827:23560,39828:23565,39829:23571,39830:23584,39831:23586,39832:23592,39833:23608,39834:23609,39835:23617,39836:23622,39837:23630,39838:23635,39839:23632,39840:23631,39841:23409,39842:23660,39843:23662,39844:20066,39845:23670,39846:23673,39847:23692,39848:23697,39849:23700,39850:22939,39851:23723,39852:23739,39853:23734,39854:23740,39855:23735,39856:23749,39857:23742,39858:23751,39859:23769,39860:23785,39861:23805,39862:23802,39863:23789,39864:23948,39865:23786,39866:23819,39867:23829,39868:23831,39869:23900,39870:23839,39871:23835,39872:23825,39873:23828,39874:23842,39875:23834,39876:23833,39877:23832,39878:23884,39879:23890,39880:23886,39881:23883,39882:23916,39883:23923,39884:23926,39885:23943,39886:23940,39887:23938,39888:23970,39889:23965,39890:23980,39891:23982,39892:23997,39893:23952,39894:23991,39895:23996,39896:24009,39897:24013,39898:24019,39899:24018,39900:24022,39901:24027,39902:24043,39903:24050,39904:24053,39905:24075,39906:24090,39907:24089,39908:24081,39909:24091,39910:24118,39911:24119,39912:24132,39913:24131,39914:24128,39915:24142,39916:24151,39917:24148,39918:24159,39919:24162,39920:24164,39921:24135,39922:24181,39923:24182,39924:24186,39925:40636,39926:24191,39927:24224,39928:24257,39929:24258,39930:24264,39931:24272,39932:24271,4e4:24278,40001:24291,40002:24285,40003:24282,40004:24283,40005:24290,40006:24289,40007:24296,40008:24297,40009:24300,40010:24305,40011:24307,40012:24304,40013:24308,40014:24312,40015:24318,40016:24323,40017:24329,40018:24413,40019:24412,40020:24331,40021:24337,40022:24342,40023:24361,40024:24365,40025:24376,40026:24385,40027:24392,40028:24396,40029:24398,40030:24367,40031:24401,40032:24406,40033:24407,40034:24409,40035:24417,40036:24429,40037:24435,40038:24439,40039:24451,40040:24450,40041:24447,40042:24458,40043:24456,40044:24465,40045:24455,40046:24478,40047:24473,40048:24472,40049:24480,40050:24488,40051:24493,40052:24508,40053:24534,40054:24571,40055:24548,40056:24568,40057:24561,40058:24541,40059:24755,40060:24575,40061:24609,40062:24672,40064:24601,40065:24592,40066:24617,40067:24590,40068:24625,40069:24603,40070:24597,40071:24619,40072:24614,40073:24591,40074:24634,40075:24666,40076:24641,40077:24682,40078:24695,40079:24671,40080:24650,40081:24646,40082:24653,40083:24675,40084:24643,40085:24676,40086:24642,40087:24684,40088:24683,40089:24665,40090:24705,40091:24717,40092:24807,40093:24707,40094:24730,40095:24708,40096:24731,40097:24726,40098:24727,40099:24722,40100:24743,40101:24715,40102:24801,40103:24760,40104:24800,40105:24787,40106:24756,40107:24560,40108:24765,40109:24774,40110:24757,40111:24792,40112:24909,40113:24853,40114:24838,40115:24822,40116:24823,40117:24832,40118:24820,40119:24826,40120:24835,40121:24865,40122:24827,40123:24817,40124:24845,40125:24846,40126:24903,40127:24894,40128:24872,40129:24871,40130:24906,40131:24895,40132:24892,40133:24876,40134:24884,40135:24893,40136:24898,40137:24900,40138:24947,40139:24951,40140:24920,40141:24921,40142:24922,40143:24939,40144:24948,40145:24943,40146:24933,40147:24945,40148:24927,40149:24925,40150:24915,40151:24949,40152:24985,40153:24982,40154:24967,40155:25004,40156:24980,40157:24986,40158:24970,40159:24977,40160:25003,40161:25006,40162:25036,40163:25034,40164:25033,40165:25079,40166:25032,40167:25027,40168:25030,40169:25018,40170:25035,40171:32633,40172:25037,40173:25062,40174:25059,40175:25078,40176:25082,40177:25076,40178:25087,40179:25085,40180:25084,40181:25086,40182:25088,40183:25096,40184:25097,40185:25101,40186:25100,40187:25108,40188:25115,40256:25118,40257:25121,40258:25130,40259:25134,40260:25136,40261:25138,40262:25139,40263:25153,40264:25166,40265:25182,40266:25187,40267:25179,40268:25184,40269:25192,40270:25212,40271:25218,40272:25225,40273:25214,40274:25234,40275:25235,40276:25238,40277:25300,40278:25219,40279:25236,40280:25303,40281:25297,40282:25275,40283:25295,40284:25343,40285:25286,40286:25812,40287:25288,40288:25308,40289:25292,40290:25290,40291:25282,40292:25287,40293:25243,40294:25289,40295:25356,40296:25326,40297:25329,40298:25383,40299:25346,40300:25352,40301:25327,40302:25333,40303:25424,40304:25406,40305:25421,40306:25628,40307:25423,40308:25494,40309:25486,40310:25472,40311:25515,40312:25462,40313:25507,40314:25487,40315:25481,40316:25503,40317:25525,40318:25451,40320:25449,40321:25534,40322:25577,40323:25536,40324:25542,40325:25571,40326:25545,40327:25554,40328:25590,40329:25540,40330:25622,40331:25652,40332:25606,40333:25619,40334:25638,40335:25654,40336:25885,40337:25623,40338:25640,40339:25615,40340:25703,40341:25711,40342:25718,40343:25678,40344:25898,40345:25749,40346:25747,40347:25765,40348:25769,40349:25736,40350:25788,40351:25818,40352:25810,40353:25797,40354:25799,40355:25787,40356:25816,40357:25794,40358:25841,40359:25831,40360:33289,40361:25824,40362:25825,40363:25260,40364:25827,40365:25839,40366:25900,40367:25846,40368:25844,40369:25842,40370:25850,40371:25856,40372:25853,40373:25880,40374:25884,40375:25861,40376:25892,40377:25891,40378:25899,40379:25908,40380:25909,40381:25911,40382:25910,40383:25912,40384:30027,40385:25928,40386:25942,40387:25941,40388:25933,40389:25944,40390:25950,40391:25949,40392:25970,40393:25976,40394:25986,40395:25987,40396:35722,40397:26011,40398:26015,40399:26027,40400:26039,40401:26051,40402:26054,40403:26049,40404:26052,40405:26060,40406:26066,40407:26075,40408:26073,40409:26080,40410:26081,40411:26097,40412:26482,40413:26122,40414:26115,40415:26107,40416:26483,40417:26165,40418:26166,40419:26164,40420:26140,40421:26191,40422:26180,40423:26185,40424:26177,40425:26206,40426:26205,40427:26212,40428:26215,40429:26216,40430:26207,40431:26210,40432:26224,40433:26243,40434:26248,40435:26254,40436:26249,40437:26244,40438:26264,40439:26269,40440:26305,40441:26297,40442:26313,40443:26302,40444:26300,40512:26308,40513:26296,40514:26326,40515:26330,40516:26336,40517:26175,40518:26342,40519:26345,40520:26352,40521:26357,40522:26359,40523:26383,40524:26390,40525:26398,40526:26406,40527:26407,40528:38712,40529:26414,40530:26431,40531:26422,40532:26433,40533:26424,40534:26423,40535:26438,40536:26462,40537:26464,40538:26457,40539:26467,40540:26468,40541:26505,40542:26480,40543:26537,40544:26492,40545:26474,40546:26508,40547:26507,40548:26534,40549:26529,40550:26501,40551:26551,40552:26607,40553:26548,40554:26604,40555:26547,40556:26601,40557:26552,40558:26596,40559:26590,40560:26589,40561:26594,40562:26606,40563:26553,40564:26574,40565:26566,40566:26599,40567:27292,40568:26654,40569:26694,40570:26665,40571:26688,40572:26701,40573:26674,40574:26702,40576:26803,40577:26667,40578:26713,40579:26723,40580:26743,40581:26751,40582:26783,40583:26767,40584:26797,40585:26772,40586:26781,40587:26779,40588:26755,40589:27310,40590:26809,40591:26740,40592:26805,40593:26784,40594:26810,40595:26895,40596:26765,40597:26750,40598:26881,40599:26826,40600:26888,40601:26840,40602:26914,40603:26918,40604:26849,40605:26892,40606:26829,40607:26836,40608:26855,40609:26837,40610:26934,40611:26898,40612:26884,40613:26839,40614:26851,40615:26917,40616:26873,40617:26848,40618:26863,40619:26920,40620:26922,40621:26906,40622:26915,40623:26913,40624:26822,40625:27001,40626:26999,40627:26972,40628:27e3,40629:26987,40630:26964,40631:27006,40632:26990,40633:26937,40634:26996,40635:26941,40636:26969,40637:26928,40638:26977,40639:26974,40640:26973,40641:27009,40642:26986,40643:27058,40644:27054,40645:27088,40646:27071,40647:27073,40648:27091,40649:27070,40650:27086,40651:23528,40652:27082,40653:27101,40654:27067,40655:27075,40656:27047,40657:27182,40658:27025,40659:27040,40660:27036,40661:27029,40662:27060,40663:27102,40664:27112,40665:27138,40666:27163,40667:27135,40668:27402,40669:27129,40670:27122,40671:27111,40672:27141,40673:27057,40674:27166,40675:27117,40676:27156,40677:27115,40678:27146,40679:27154,40680:27329,40681:27171,40682:27155,40683:27204,40684:27148,40685:27250,40686:27190,40687:27256,40688:27207,40689:27234,40690:27225,40691:27238,40692:27208,40693:27192,40694:27170,40695:27280,40696:27277,40697:27296,40698:27268,40699:27298,40700:27299,40768:27287,40769:34327,40770:27323,40771:27331,40772:27330,40773:27320,40774:27315,40775:27308,40776:27358,40777:27345,40778:27359,40779:27306,40780:27354,40781:27370,40782:27387,40783:27397,40784:34326,40785:27386,40786:27410,40787:27414,40788:39729,40789:27423,40790:27448,40791:27447,40792:30428,40793:27449,40794:39150,40795:27463,40796:27459,40797:27465,40798:27472,40799:27481,40800:27476,40801:27483,40802:27487,40803:27489,40804:27512,40805:27513,40806:27519,40807:27520,40808:27524,40809:27523,40810:27533,40811:27544,40812:27541,40813:27550,40814:27556,40815:27562,40816:27563,40817:27567,40818:27570,40819:27569,40820:27571,40821:27575,40822:27580,40823:27590,40824:27595,40825:27603,40826:27615,40827:27628,40828:27627,40829:27635,40830:27631,40832:40638,40833:27656,40834:27667,40835:27668,40836:27675,40837:27684,40838:27683,40839:27742,40840:27733,40841:27746,40842:27754,40843:27778,40844:27789,40845:27802,40846:27777,40847:27803,40848:27774,40849:27752,40850:27763,40851:27794,40852:27792,40853:27844,40854:27889,40855:27859,40856:27837,40857:27863,40858:27845,40859:27869,40860:27822,40861:27825,40862:27838,40863:27834,40864:27867,40865:27887,40866:27865,40867:27882,40868:27935,40869:34893,40870:27958,40871:27947,40872:27965,40873:27960,40874:27929,40875:27957,40876:27955,40877:27922,40878:27916,40879:28003,40880:28051,40881:28004,40882:27994,40883:28025,40884:27993,40885:28046,40886:28053,40887:28644,40888:28037,40889:28153,40890:28181,40891:28170,40892:28085,40893:28103,40894:28134,40895:28088,40896:28102,40897:28140,40898:28126,40899:28108,40900:28136,40901:28114,40902:28101,40903:28154,40904:28121,40905:28132,40906:28117,40907:28138,40908:28142,40909:28205,40910:28270,40911:28206,40912:28185,40913:28274,40914:28255,40915:28222,40916:28195,40917:28267,40918:28203,40919:28278,40920:28237,40921:28191,40922:28227,40923:28218,40924:28238,40925:28196,40926:28415,40927:28189,40928:28216,40929:28290,40930:28330,40931:28312,40932:28361,40933:28343,40934:28371,40935:28349,40936:28335,40937:28356,40938:28338,40939:28372,40940:28373,40941:28303,40942:28325,40943:28354,40944:28319,40945:28481,40946:28433,40947:28748,40948:28396,40949:28408,40950:28414,40951:28479,40952:28402,40953:28465,40954:28399,40955:28466,40956:28364,57408:28478,57409:28435,57410:28407,57411:28550,57412:28538,57413:28536,57414:28545,57415:28544,57416:28527,57417:28507,57418:28659,57419:28525,57420:28546,57421:28540,57422:28504,57423:28558,57424:28561,57425:28610,57426:28518,57427:28595,57428:28579,57429:28577,57430:28580,57431:28601,57432:28614,57433:28586,57434:28639,57435:28629,57436:28652,57437:28628,57438:28632,57439:28657,57440:28654,57441:28635,57442:28681,57443:28683,57444:28666,57445:28689,57446:28673,57447:28687,57448:28670,57449:28699,57450:28698,57451:28532,57452:28701,57453:28696,57454:28703,57455:28720,57456:28734,57457:28722,57458:28753,57459:28771,57460:28825,57461:28818,57462:28847,57463:28913,57464:28844,57465:28856,57466:28851,57467:28846,57468:28895,57469:28875,57470:28893,57472:28889,57473:28937,57474:28925,57475:28956,57476:28953,57477:29029,57478:29013,57479:29064,57480:29030,57481:29026,57482:29004,57483:29014,57484:29036,57485:29071,57486:29179,57487:29060,57488:29077,57489:29096,57490:29100,57491:29143,57492:29113,57493:29118,57494:29138,57495:29129,57496:29140,57497:29134,57498:29152,57499:29164,57500:29159,57501:29173,57502:29180,57503:29177,57504:29183,57505:29197,57506:29200,57507:29211,57508:29224,57509:29229,57510:29228,57511:29232,57512:29234,57513:29243,57514:29244,57515:29247,57516:29248,57517:29254,57518:29259,57519:29272,57520:29300,57521:29310,57522:29314,57523:29313,57524:29319,57525:29330,57526:29334,57527:29346,57528:29351,57529:29369,57530:29362,57531:29379,57532:29382,57533:29380,57534:29390,57535:29394,57536:29410,57537:29408,57538:29409,57539:29433,57540:29431,57541:20495,57542:29463,57543:29450,57544:29468,57545:29462,57546:29469,57547:29492,57548:29487,57549:29481,57550:29477,57551:29502,57552:29518,57553:29519,57554:40664,57555:29527,57556:29546,57557:29544,57558:29552,57559:29560,57560:29557,57561:29563,57562:29562,57563:29640,57564:29619,57565:29646,57566:29627,57567:29632,57568:29669,57569:29678,57570:29662,57571:29858,57572:29701,57573:29807,57574:29733,57575:29688,57576:29746,57577:29754,57578:29781,57579:29759,57580:29791,57581:29785,57582:29761,57583:29788,57584:29801,57585:29808,57586:29795,57587:29802,57588:29814,57589:29822,57590:29835,57591:29854,57592:29863,57593:29898,57594:29903,57595:29908,57596:29681,57664:29920,57665:29923,57666:29927,57667:29929,57668:29934,57669:29938,57670:29936,57671:29937,57672:29944,57673:29943,57674:29956,57675:29955,57676:29957,57677:29964,57678:29966,57679:29965,57680:29973,57681:29971,57682:29982,57683:29990,57684:29996,57685:30012,57686:30020,57687:30029,57688:30026,57689:30025,57690:30043,57691:30022,57692:30042,57693:30057,57694:30052,57695:30055,57696:30059,57697:30061,57698:30072,57699:30070,57700:30086,57701:30087,57702:30068,57703:30090,57704:30089,57705:30082,57706:30100,57707:30106,57708:30109,57709:30117,57710:30115,57711:30146,57712:30131,57713:30147,57714:30133,57715:30141,57716:30136,57717:30140,57718:30129,57719:30157,57720:30154,57721:30162,57722:30169,57723:30179,57724:30174,57725:30206,57726:30207,57728:30204,57729:30209,57730:30192,57731:30202,57732:30194,57733:30195,57734:30219,57735:30221,57736:30217,57737:30239,57738:30247,57739:30240,57740:30241,57741:30242,57742:30244,57743:30260,57744:30256,57745:30267,57746:30279,57747:30280,57748:30278,57749:30300,57750:30296,57751:30305,57752:30306,57753:30312,57754:30313,57755:30314,57756:30311,57757:30316,57758:30320,57759:30322,57760:30326,57761:30328,57762:30332,57763:30336,57764:30339,57765:30344,57766:30347,57767:30350,57768:30358,57769:30355,57770:30361,57771:30362,57772:30384,57773:30388,57774:30392,57775:30393,57776:30394,57777:30402,57778:30413,57779:30422,57780:30418,57781:30430,57782:30433,57783:30437,57784:30439,57785:30442,57786:34351,57787:30459,57788:30472,57789:30471,57790:30468,57791:30505,57792:30500,57793:30494,57794:30501,57795:30502,57796:30491,57797:30519,57798:30520,57799:30535,57800:30554,57801:30568,57802:30571,57803:30555,57804:30565,57805:30591,57806:30590,57807:30585,57808:30606,57809:30603,57810:30609,57811:30624,57812:30622,57813:30640,57814:30646,57815:30649,57816:30655,57817:30652,57818:30653,57819:30651,57820:30663,57821:30669,57822:30679,57823:30682,57824:30684,57825:30691,57826:30702,57827:30716,57828:30732,57829:30738,57830:31014,57831:30752,57832:31018,57833:30789,57834:30862,57835:30836,57836:30854,57837:30844,57838:30874,57839:30860,57840:30883,57841:30901,57842:30890,57843:30895,57844:30929,57845:30918,57846:30923,57847:30932,57848:30910,57849:30908,57850:30917,57851:30922,57852:30956,57920:30951,57921:30938,57922:30973,57923:30964,57924:30983,57925:30994,57926:30993,57927:31001,57928:31020,57929:31019,57930:31040,57931:31072,57932:31063,57933:31071,57934:31066,57935:31061,57936:31059,57937:31098,57938:31103,57939:31114,57940:31133,57941:31143,57942:40779,57943:31146,57944:31150,57945:31155,57946:31161,57947:31162,57948:31177,57949:31189,57950:31207,57951:31212,57952:31201,57953:31203,57954:31240,57955:31245,57956:31256,57957:31257,57958:31264,57959:31263,57960:31104,57961:31281,57962:31291,57963:31294,57964:31287,57965:31299,57966:31319,57967:31305,57968:31329,57969:31330,57970:31337,57971:40861,57972:31344,57973:31353,57974:31357,57975:31368,57976:31383,57977:31381,57978:31384,57979:31382,57980:31401,57981:31432,57982:31408,57984:31414,57985:31429,57986:31428,57987:31423,57988:36995,57989:31431,57990:31434,57991:31437,57992:31439,57993:31445,57994:31443,57995:31449,57996:31450,57997:31453,57998:31457,57999:31458,58e3:31462,58001:31469,58002:31472,58003:31490,58004:31503,58005:31498,58006:31494,58007:31539,58008:31512,58009:31513,58010:31518,58011:31541,58012:31528,58013:31542,58014:31568,58015:31610,58016:31492,58017:31565,58018:31499,58019:31564,58020:31557,58021:31605,58022:31589,58023:31604,58024:31591,58025:31600,58026:31601,58027:31596,58028:31598,58029:31645,58030:31640,58031:31647,58032:31629,58033:31644,58034:31642,58035:31627,58036:31634,58037:31631,58038:31581,58039:31641,58040:31691,58041:31681,58042:31692,58043:31695,58044:31668,58045:31686,58046:31709,58047:31721,58048:31761,58049:31764,58050:31718,58051:31717,58052:31840,58053:31744,58054:31751,58055:31763,58056:31731,58057:31735,58058:31767,58059:31757,58060:31734,58061:31779,58062:31783,58063:31786,58064:31775,58065:31799,58066:31787,58067:31805,58068:31820,58069:31811,58070:31828,58071:31823,58072:31808,58073:31824,58074:31832,58075:31839,58076:31844,58077:31830,58078:31845,58079:31852,58080:31861,58081:31875,58082:31888,58083:31908,58084:31917,58085:31906,58086:31915,58087:31905,58088:31912,58089:31923,58090:31922,58091:31921,58092:31918,58093:31929,58094:31933,58095:31936,58096:31941,58097:31938,58098:31960,58099:31954,58100:31964,58101:31970,58102:39739,58103:31983,58104:31986,58105:31988,58106:31990,58107:31994,58108:32006,58176:32002,58177:32028,58178:32021,58179:32010,58180:32069,58181:32075,58182:32046,58183:32050,58184:32063,58185:32053,58186:32070,58187:32115,58188:32086,58189:32078,58190:32114,58191:32104,58192:32110,58193:32079,58194:32099,58195:32147,58196:32137,58197:32091,58198:32143,58199:32125,58200:32155,58201:32186,58202:32174,58203:32163,58204:32181,58205:32199,58206:32189,58207:32171,58208:32317,58209:32162,58210:32175,58211:32220,58212:32184,58213:32159,58214:32176,58215:32216,58216:32221,58217:32228,58218:32222,58219:32251,58220:32242,58221:32225,58222:32261,58223:32266,58224:32291,58225:32289,58226:32274,58227:32305,58228:32287,58229:32265,58230:32267,58231:32290,58232:32326,58233:32358,58234:32315,58235:32309,58236:32313,58237:32323,58238:32311,58240:32306,58241:32314,58242:32359,58243:32349,58244:32342,58245:32350,58246:32345,58247:32346,58248:32377,58249:32362,58250:32361,58251:32380,58252:32379,58253:32387,58254:32213,58255:32381,58256:36782,58257:32383,58258:32392,58259:32393,58260:32396,58261:32402,58262:32400,58263:32403,58264:32404,58265:32406,58266:32398,58267:32411,58268:32412,58269:32568,58270:32570,58271:32581,58272:32588,58273:32589,58274:32590,58275:32592,58276:32593,58277:32597,58278:32596,58279:32600,58280:32607,58281:32608,58282:32616,58283:32617,58284:32615,58285:32632,58286:32642,58287:32646,58288:32643,58289:32648,58290:32647,58291:32652,58292:32660,58293:32670,58294:32669,58295:32666,58296:32675,58297:32687,58298:32690,58299:32697,58300:32686,58301:32694,58302:32696,58303:35697,58304:32709,58305:32710,58306:32714,58307:32725,58308:32724,58309:32737,58310:32742,58311:32745,58312:32755,58313:32761,58314:39132,58315:32774,58316:32772,58317:32779,58318:32786,58319:32792,58320:32793,58321:32796,58322:32801,58323:32808,58324:32831,58325:32827,58326:32842,58327:32838,58328:32850,58329:32856,58330:32858,58331:32863,58332:32866,58333:32872,58334:32883,58335:32882,58336:32880,58337:32886,58338:32889,58339:32893,58340:32895,58341:32900,58342:32902,58343:32901,58344:32923,58345:32915,58346:32922,58347:32941,58348:20880,58349:32940,58350:32987,58351:32997,58352:32985,58353:32989,58354:32964,58355:32986,58356:32982,58357:33033,58358:33007,58359:33009,58360:33051,58361:33065,58362:33059,58363:33071,58364:33099,58432:38539,58433:33094,58434:33086,58435:33107,58436:33105,58437:33020,58438:33137,58439:33134,58440:33125,58441:33126,58442:33140,58443:33155,58444:33160,58445:33162,58446:33152,58447:33154,58448:33184,58449:33173,58450:33188,58451:33187,58452:33119,58453:33171,58454:33193,58455:33200,58456:33205,58457:33214,58458:33208,58459:33213,58460:33216,58461:33218,58462:33210,58463:33225,58464:33229,58465:33233,58466:33241,58467:33240,58468:33224,58469:33242,58470:33247,58471:33248,58472:33255,58473:33274,58474:33275,58475:33278,58476:33281,58477:33282,58478:33285,58479:33287,58480:33290,58481:33293,58482:33296,58483:33302,58484:33321,58485:33323,58486:33336,58487:33331,58488:33344,58489:33369,58490:33368,58491:33373,58492:33370,58493:33375,58494:33380,58496:33378,58497:33384,58498:33386,58499:33387,58500:33326,58501:33393,58502:33399,58503:33400,58504:33406,58505:33421,58506:33426,58507:33451,58508:33439,58509:33467,58510:33452,58511:33505,58512:33507,58513:33503,58514:33490,58515:33524,58516:33523,58517:33530,58518:33683,58519:33539,58520:33531,58521:33529,58522:33502,58523:33542,58524:33500,58525:33545,58526:33497,58527:33589,58528:33588,58529:33558,58530:33586,58531:33585,58532:33600,58533:33593,58534:33616,58535:33605,58536:33583,58537:33579,58538:33559,58539:33560,58540:33669,58541:33690,58542:33706,58543:33695,58544:33698,58545:33686,58546:33571,58547:33678,58548:33671,58549:33674,58550:33660,58551:33717,58552:33651,58553:33653,58554:33696,58555:33673,58556:33704,58557:33780,58558:33811,58559:33771,58560:33742,58561:33789,58562:33795,58563:33752,58564:33803,58565:33729,58566:33783,58567:33799,58568:33760,58569:33778,58570:33805,58571:33826,58572:33824,58573:33725,58574:33848,58575:34054,58576:33787,58577:33901,58578:33834,58579:33852,58580:34138,58581:33924,58582:33911,58583:33899,58584:33965,58585:33902,58586:33922,58587:33897,58588:33862,58589:33836,58590:33903,58591:33913,58592:33845,58593:33994,58594:33890,58595:33977,58596:33983,58597:33951,58598:34009,58599:33997,58600:33979,58601:34010,58602:34e3,58603:33985,58604:33990,58605:34006,58606:33953,58607:34081,58608:34047,58609:34036,58610:34071,58611:34072,58612:34092,58613:34079,58614:34069,58615:34068,58616:34044,58617:34112,58618:34147,58619:34136,58620:34120,58688:34113,58689:34306,58690:34123,58691:34133,58692:34176,58693:34212,58694:34184,58695:34193,58696:34186,58697:34216,58698:34157,58699:34196,58700:34203,58701:34282,58702:34183,58703:34204,58704:34167,58705:34174,58706:34192,58707:34249,58708:34234,58709:34255,58710:34233,58711:34256,58712:34261,58713:34269,58714:34277,58715:34268,58716:34297,58717:34314,58718:34323,58719:34315,58720:34302,58721:34298,58722:34310,58723:34338,58724:34330,58725:34352,58726:34367,58727:34381,58728:20053,58729:34388,58730:34399,58731:34407,58732:34417,58733:34451,58734:34467,58735:34473,58736:34474,58737:34443,58738:34444,58739:34486,58740:34479,58741:34500,58742:34502,58743:34480,58744:34505,58745:34851,58746:34475,58747:34516,58748:34526,58749:34537,58750:34540,58752:34527,58753:34523,58754:34543,58755:34578,58756:34566,58757:34568,58758:34560,58759:34563,58760:34555,58761:34577,58762:34569,58763:34573,58764:34553,58765:34570,58766:34612,58767:34623,58768:34615,58769:34619,58770:34597,58771:34601,58772:34586,58773:34656,58774:34655,58775:34680,58776:34636,58777:34638,58778:34676,58779:34647,58780:34664,58781:34670,58782:34649,58783:34643,58784:34659,58785:34666,58786:34821,58787:34722,58788:34719,58789:34690,58790:34735,58791:34763,58792:34749,58793:34752,58794:34768,58795:38614,58796:34731,58797:34756,58798:34739,58799:34759,58800:34758,58801:34747,58802:34799,58803:34802,58804:34784,58805:34831,58806:34829,58807:34814,58808:34806,58809:34807,58810:34830,58811:34770,58812:34833,58813:34838,58814:34837,58815:34850,58816:34849,58817:34865,58818:34870,58819:34873,58820:34855,58821:34875,58822:34884,58823:34882,58824:34898,58825:34905,58826:34910,58827:34914,58828:34923,58829:34945,58830:34942,58831:34974,58832:34933,58833:34941,58834:34997,58835:34930,58836:34946,58837:34967,58838:34962,58839:34990,58840:34969,58841:34978,58842:34957,58843:34980,58844:34992,58845:35007,58846:34993,58847:35011,58848:35012,58849:35028,58850:35032,58851:35033,58852:35037,58853:35065,58854:35074,58855:35068,58856:35060,58857:35048,58858:35058,58859:35076,58860:35084,58861:35082,58862:35091,58863:35139,58864:35102,58865:35109,58866:35114,58867:35115,58868:35137,58869:35140,58870:35131,58871:35126,58872:35128,58873:35148,58874:35101,58875:35168,58876:35166,58944:35174,58945:35172,58946:35181,58947:35178,58948:35183,58949:35188,58950:35191,58951:35198,58952:35203,58953:35208,58954:35210,58955:35219,58956:35224,58957:35233,58958:35241,58959:35238,58960:35244,58961:35247,58962:35250,58963:35258,58964:35261,58965:35263,58966:35264,58967:35290,58968:35292,58969:35293,58970:35303,58971:35316,58972:35320,58973:35331,58974:35350,58975:35344,58976:35340,58977:35355,58978:35357,58979:35365,58980:35382,58981:35393,58982:35419,58983:35410,58984:35398,58985:35400,58986:35452,58987:35437,58988:35436,58989:35426,58990:35461,58991:35458,58992:35460,58993:35496,58994:35489,58995:35473,58996:35493,58997:35494,58998:35482,58999:35491,59e3:35524,59001:35533,59002:35522,59003:35546,59004:35563,59005:35571,59006:35559,59008:35556,59009:35569,59010:35604,59011:35552,59012:35554,59013:35575,59014:35550,59015:35547,59016:35596,59017:35591,59018:35610,59019:35553,59020:35606,59021:35600,59022:35607,59023:35616,59024:35635,59025:38827,59026:35622,59027:35627,59028:35646,59029:35624,59030:35649,59031:35660,59032:35663,59033:35662,59034:35657,59035:35670,59036:35675,59037:35674,59038:35691,59039:35679,59040:35692,59041:35695,59042:35700,59043:35709,59044:35712,59045:35724,59046:35726,59047:35730,59048:35731,59049:35734,59050:35737,59051:35738,59052:35898,59053:35905,59054:35903,59055:35912,59056:35916,59057:35918,59058:35920,59059:35925,59060:35938,59061:35948,59062:35960,59063:35962,59064:35970,59065:35977,59066:35973,59067:35978,59068:35981,59069:35982,59070:35988,59071:35964,59072:35992,59073:25117,59074:36013,59075:36010,59076:36029,59077:36018,59078:36019,59079:36014,59080:36022,59081:36040,59082:36033,59083:36068,59084:36067,59085:36058,59086:36093,59087:36090,59088:36091,59089:36100,59090:36101,59091:36106,59092:36103,59093:36111,59094:36109,59095:36112,59096:40782,59097:36115,59098:36045,59099:36116,59100:36118,59101:36199,59102:36205,59103:36209,59104:36211,59105:36225,59106:36249,59107:36290,59108:36286,59109:36282,59110:36303,59111:36314,59112:36310,59113:36300,59114:36315,59115:36299,59116:36330,59117:36331,59118:36319,59119:36323,59120:36348,59121:36360,59122:36361,59123:36351,59124:36381,59125:36382,59126:36368,59127:36383,59128:36418,59129:36405,59130:36400,59131:36404,59132:36426,59200:36423,59201:36425,59202:36428,59203:36432,59204:36424,59205:36441,59206:36452,59207:36448,59208:36394,59209:36451,59210:36437,59211:36470,59212:36466,59213:36476,59214:36481,59215:36487,59216:36485,59217:36484,59218:36491,59219:36490,59220:36499,59221:36497,59222:36500,59223:36505,59224:36522,59225:36513,59226:36524,59227:36528,59228:36550,59229:36529,59230:36542,59231:36549,59232:36552,59233:36555,59234:36571,59235:36579,59236:36604,59237:36603,59238:36587,59239:36606,59240:36618,59241:36613,59242:36629,59243:36626,59244:36633,59245:36627,59246:36636,59247:36639,59248:36635,59249:36620,59250:36646,59251:36659,59252:36667,59253:36665,59254:36677,59255:36674,59256:36670,59257:36684,59258:36681,59259:36678,59260:36686,59261:36695,59262:36700,59264:36706,59265:36707,59266:36708,59267:36764,59268:36767,59269:36771,59270:36781,59271:36783,59272:36791,59273:36826,59274:36837,59275:36834,59276:36842,59277:36847,59278:36999,59279:36852,59280:36869,59281:36857,59282:36858,59283:36881,59284:36885,59285:36897,59286:36877,59287:36894,59288:36886,59289:36875,59290:36903,59291:36918,59292:36917,59293:36921,59294:36856,59295:36943,59296:36944,59297:36945,59298:36946,59299:36878,59300:36937,59301:36926,59302:36950,59303:36952,59304:36958,59305:36968,59306:36975,59307:36982,59308:38568,59309:36978,59310:36994,59311:36989,59312:36993,59313:36992,59314:37002,59315:37001,59316:37007,59317:37032,59318:37039,59319:37041,59320:37045,59321:37090,59322:37092,59323:25160,59324:37083,59325:37122,59326:37138,59327:37145,59328:37170,59329:37168,59330:37194,59331:37206,59332:37208,59333:37219,59334:37221,59335:37225,59336:37235,59337:37234,59338:37259,59339:37257,59340:37250,59341:37282,59342:37291,59343:37295,59344:37290,59345:37301,59346:37300,59347:37306,59348:37312,59349:37313,59350:37321,59351:37323,59352:37328,59353:37334,59354:37343,59355:37345,59356:37339,59357:37372,59358:37365,59359:37366,59360:37406,59361:37375,59362:37396,59363:37420,59364:37397,59365:37393,59366:37470,59367:37463,59368:37445,59369:37449,59370:37476,59371:37448,59372:37525,59373:37439,59374:37451,59375:37456,59376:37532,59377:37526,59378:37523,59379:37531,59380:37466,59381:37583,59382:37561,59383:37559,59384:37609,59385:37647,59386:37626,59387:37700,59388:37678,59456:37657,59457:37666,59458:37658,59459:37667,59460:37690,59461:37685,59462:37691,59463:37724,59464:37728,59465:37756,59466:37742,59467:37718,59468:37808,59469:37804,59470:37805,59471:37780,59472:37817,59473:37846,59474:37847,59475:37864,59476:37861,59477:37848,59478:37827,59479:37853,59480:37840,59481:37832,59482:37860,59483:37914,59484:37908,59485:37907,59486:37891,59487:37895,59488:37904,59489:37942,59490:37931,59491:37941,59492:37921,59493:37946,59494:37953,59495:37970,59496:37956,59497:37979,59498:37984,59499:37986,59500:37982,59501:37994,59502:37417,59503:38e3,59504:38005,59505:38007,59506:38013,59507:37978,59508:38012,59509:38014,59510:38017,59511:38015,59512:38274,59513:38279,59514:38282,59515:38292,59516:38294,59517:38296,59518:38297,59520:38304,59521:38312,59522:38311,59523:38317,59524:38332,59525:38331,59526:38329,59527:38334,59528:38346,59529:28662,59530:38339,59531:38349,59532:38348,59533:38357,59534:38356,59535:38358,59536:38364,59537:38369,59538:38373,59539:38370,59540:38433,59541:38440,59542:38446,59543:38447,59544:38466,59545:38476,59546:38479,59547:38475,59548:38519,59549:38492,59550:38494,59551:38493,59552:38495,59553:38502,59554:38514,59555:38508,59556:38541,59557:38552,59558:38549,59559:38551,59560:38570,59561:38567,59562:38577,59563:38578,59564:38576,59565:38580,59566:38582,59567:38584,59568:38585,59569:38606,59570:38603,59571:38601,59572:38605,59573:35149,59574:38620,59575:38669,59576:38613,59577:38649,59578:38660,59579:38662,59580:38664,59581:38675,59582:38670,59583:38673,59584:38671,59585:38678,59586:38681,59587:38692,59588:38698,59589:38704,59590:38713,59591:38717,59592:38718,59593:38724,59594:38726,59595:38728,59596:38722,59597:38729,59598:38748,59599:38752,59600:38756,59601:38758,59602:38760,59603:21202,59604:38763,59605:38769,59606:38777,59607:38789,59608:38780,59609:38785,59610:38778,59611:38790,59612:38795,59613:38799,59614:38800,59615:38812,59616:38824,59617:38822,59618:38819,59619:38835,59620:38836,59621:38851,59622:38854,59623:38856,59624:38859,59625:38876,59626:38893,59627:40783,59628:38898,59629:31455,59630:38902,59631:38901,59632:38927,59633:38924,59634:38968,59635:38948,59636:38945,59637:38967,59638:38973,59639:38982,59640:38991,59641:38987,59642:39019,59643:39023,59644:39024,59712:39025,59713:39028,59714:39027,59715:39082,59716:39087,59717:39089,59718:39094,59719:39108,59720:39107,59721:39110,59722:39145,59723:39147,59724:39171,59725:39177,59726:39186,59727:39188,59728:39192,59729:39201,59730:39197,59731:39198,59732:39204,59733:39200,59734:39212,59735:39214,59736:39229,59737:39230,59738:39234,59739:39241,59740:39237,59741:39248,59742:39243,59743:39249,59744:39250,59745:39244,59746:39253,59747:39319,59748:39320,59749:39333,59750:39341,59751:39342,59752:39356,59753:39391,59754:39387,59755:39389,59756:39384,59757:39377,59758:39405,59759:39406,59760:39409,59761:39410,59762:39419,59763:39416,59764:39425,59765:39439,59766:39429,59767:39394,59768:39449,59769:39467,59770:39479,59771:39493,59772:39490,59773:39488,59774:39491,59776:39486,59777:39509,59778:39501,59779:39515,59780:39511,59781:39519,59782:39522,59783:39525,59784:39524,59785:39529,59786:39531,59787:39530,59788:39597,59789:39600,59790:39612,59791:39616,59792:39631,59793:39633,59794:39635,59795:39636,59796:39646,59797:39647,59798:39650,59799:39651,59800:39654,59801:39663,59802:39659,59803:39662,59804:39668,59805:39665,59806:39671,59807:39675,59808:39686,59809:39704,59810:39706,59811:39711,59812:39714,59813:39715,59814:39717,59815:39719,59816:39720,59817:39721,59818:39722,59819:39726,59820:39727,59821:39730,59822:39748,59823:39747,59824:39759,59825:39757,59826:39758,59827:39761,59828:39768,59829:39796,59830:39827,59831:39811,59832:39825,59833:39830,59834:39831,59835:39839,59836:39840,59837:39848,59838:39860,59839:39872,59840:39882,59841:39865,59842:39878,59843:39887,59844:39889,59845:39890,59846:39907,59847:39906,59848:39908,59849:39892,59850:39905,59851:39994,59852:39922,59853:39921,59854:39920,59855:39957,59856:39956,59857:39945,59858:39955,59859:39948,59860:39942,59861:39944,59862:39954,59863:39946,59864:39940,59865:39982,59866:39963,59867:39973,59868:39972,59869:39969,59870:39984,59871:40007,59872:39986,59873:40006,59874:39998,59875:40026,59876:40032,59877:40039,59878:40054,59879:40056,59880:40167,59881:40172,59882:40176,59883:40201,59884:40200,59885:40171,59886:40195,59887:40198,59888:40234,59889:40230,59890:40367,59891:40227,59892:40223,59893:40260,59894:40213,59895:40210,59896:40257,59897:40255,59898:40254,59899:40262,59900:40264,59968:40285,59969:40286,59970:40292,59971:40273,59972:40272,59973:40281,59974:40306,59975:40329,59976:40327,59977:40363,59978:40303,59979:40314,59980:40346,59981:40356,59982:40361,59983:40370,59984:40388,59985:40385,59986:40379,59987:40376,59988:40378,59989:40390,59990:40399,59991:40386,59992:40409,59993:40403,59994:40440,59995:40422,59996:40429,59997:40431,59998:40445,59999:40474,6e4:40475,60001:40478,60002:40565,60003:40569,60004:40573,60005:40577,60006:40584,60007:40587,60008:40588,60009:40594,60010:40597,60011:40593,60012:40605,60013:40613,60014:40617,60015:40632,60016:40618,60017:40621,60018:38753,60019:40652,60020:40654,60021:40655,60022:40656,60023:40660,60024:40668,60025:40670,60026:40669,60027:40672,60028:40677,60029:40680,60030:40687,60032:40692,60033:40694,60034:40695,60035:40697,60036:40699,60037:40700,60038:40701,60039:40711,60040:40712,60041:30391,60042:40725,60043:40737,60044:40748,60045:40766,60046:40778,60047:40786,60048:40788,60049:40803,60050:40799,60051:40800,60052:40801,60053:40806,60054:40807,60055:40812,60056:40810,60057:40823,60058:40818,60059:40822,60060:40853,60061:40860,60062:40864,60063:22575,60064:27079,60065:36953,60066:29796,60067:20956,60068:29081,60736:32394,60737:35100,60738:37704,60739:37512,60740:34012,60741:20425,60742:28859,60743:26161,60744:26824,60745:37625,60746:26363,60747:24389,60748:20008,60749:20193,60750:20220,60751:20224,60752:20227,60753:20281,60754:20310,60755:20370,60756:20362,60757:20378,60758:20372,60759:20429,60760:20544,60761:20514,60762:20479,60763:20510,60764:20550,60765:20592,60766:20546,60767:20628,60768:20724,60769:20696,60770:20810,60771:20836,60772:20893,60773:20926,60774:20972,60775:21013,60776:21148,60777:21158,60778:21184,60779:21211,60780:21248,60781:21255,60782:21284,60783:21362,60784:21395,60785:21426,60786:21469,60787:64014,60788:21660,60789:21642,60790:21673,60791:21759,60792:21894,60793:22361,60794:22373,60795:22444,60796:22472,60797:22471,60798:64015,60800:64016,60801:22686,60802:22706,60803:22795,60804:22867,60805:22875,60806:22877,60807:22883,60808:22948,60809:22970,60810:23382,60811:23488,60812:29999,60813:23512,60814:23532,60815:23582,60816:23718,60817:23738,60818:23797,60819:23847,60820:23891,60821:64017,60822:23874,60823:23917,60824:23992,60825:23993,60826:24016,60827:24353,60828:24372,60829:24423,60830:24503,60831:24542,60832:24669,60833:24709,60834:24714,60835:24798,60836:24789,60837:24864,60838:24818,60839:24849,60840:24887,60841:24880,60842:24984,60843:25107,60844:25254,60845:25589,60846:25696,60847:25757,60848:25806,60849:25934,60850:26112,60851:26133,60852:26171,60853:26121,60854:26158,60855:26142,60856:26148,60857:26213,60858:26199,60859:26201,60860:64018,60861:26227,60862:26265,60863:26272,60864:26290,60865:26303,60866:26362,60867:26382,60868:63785,60869:26470,60870:26555,60871:26706,60872:26560,60873:26625,60874:26692,60875:26831,60876:64019,60877:26984,60878:64020,60879:27032,60880:27106,60881:27184,60882:27243,60883:27206,60884:27251,60885:27262,60886:27362,60887:27364,60888:27606,60889:27711,60890:27740,60891:27782,60892:27759,60893:27866,60894:27908,60895:28039,60896:28015,60897:28054,60898:28076,60899:28111,60900:28152,60901:28146,60902:28156,60903:28217,60904:28252,60905:28199,60906:28220,60907:28351,60908:28552,60909:28597,60910:28661,60911:28677,60912:28679,60913:28712,60914:28805,60915:28843,60916:28943,60917:28932,60918:29020,60919:28998,60920:28999,60921:64021,60922:29121,60923:29182,60924:29361,60992:29374,60993:29476,60994:64022,60995:29559,60996:29629,60997:29641,60998:29654,60999:29667,61e3:29650,61001:29703,61002:29685,61003:29734,61004:29738,61005:29737,61006:29742,61007:29794,61008:29833,61009:29855,61010:29953,61011:30063,61012:30338,61013:30364,61014:30366,61015:30363,61016:30374,61017:64023,61018:30534,61019:21167,61020:30753,61021:30798,61022:30820,61023:30842,61024:31024,61025:64024,61026:64025,61027:64026,61028:31124,61029:64027,61030:31131,61031:31441,61032:31463,61033:64028,61034:31467,61035:31646,61036:64029,61037:32072,61038:32092,61039:32183,61040:32160,61041:32214,61042:32338,61043:32583,61044:32673,61045:64030,61046:33537,61047:33634,61048:33663,61049:33735,61050:33782,61051:33864,61052:33972,61053:34131,61054:34137,61056:34155,61057:64031,61058:34224,61059:64032,61060:64033,61061:34823,61062:35061,61063:35346,61064:35383,61065:35449,61066:35495,61067:35518,61068:35551,61069:64034,61070:35574,61071:35667,61072:35711,61073:36080,61074:36084,61075:36114,61076:36214,61077:64035,61078:36559,61079:64036,61080:64037,61081:36967,61082:37086,61083:64038,61084:37141,61085:37159,61086:37338,61087:37335,61088:37342,61089:37357,61090:37358,61091:37348,61092:37349,61093:37382,61094:37392,61095:37386,61096:37434,61097:37440,61098:37436,61099:37454,61100:37465,61101:37457,61102:37433,61103:37479,61104:37543,61105:37495,61106:37496,61107:37607,61108:37591,61109:37593,61110:37584,61111:64039,61112:37589,61113:37600,61114:37587,61115:37669,61116:37665,61117:37627,61118:64040,61119:37662,61120:37631,61121:37661,61122:37634,61123:37744,61124:37719,61125:37796,61126:37830,61127:37854,61128:37880,61129:37937,61130:37957,61131:37960,61132:38290,61133:63964,61134:64041,61135:38557,61136:38575,61137:38707,61138:38715,61139:38723,61140:38733,61141:38735,61142:38737,61143:38741,61144:38999,61145:39013,61146:64042,61147:64043,61148:39207,61149:64044,61150:39326,61151:39502,61152:39641,61153:39644,61154:39797,61155:39794,61156:39823,61157:39857,61158:39867,61159:39936,61160:40304,61161:40299,61162:64045,61163:40473,61164:40657,61167:8560,61168:8561,61169:8562,61170:8563,61171:8564,61172:8565,61173:8566,61174:8567,61175:8568,61176:8569,61177:65506,61178:65508,61179:65287,61180:65282,61504:57344,61505:57345,61506:57346,61507:57347,61508:57348,61509:57349,61510:57350,61511:57351,61512:57352,61513:57353,61514:57354,61515:57355,61516:57356,61517:57357,61518:57358,61519:57359,61520:57360,61521:57361,61522:57362,61523:57363,61524:57364,61525:57365,61526:57366,61527:57367,61528:57368,61529:57369,61530:57370,61531:57371,61532:57372,61533:57373,61534:57374,61535:57375,61536:57376,61537:57377,61538:57378,61539:57379,61540:57380,61541:57381,61542:57382,61543:57383,61544:57384,61545:57385,61546:57386,61547:57387,61548:57388,61549:57389,61550:57390,61551:57391,61552:57392,61553:57393,61554:57394,61555:57395,61556:57396,61557:57397,61558:57398,61559:57399,61560:57400,61561:57401,61562:57402,61563:57403,61564:57404,61565:57405,61566:57406,61568:57407,61569:57408,61570:57409,61571:57410,61572:57411,61573:57412,61574:57413,61575:57414,61576:57415,61577:57416,61578:57417,61579:57418,61580:57419,61581:57420,61582:57421,61583:57422,61584:57423,61585:57424,61586:57425,61587:57426,61588:57427,61589:57428,61590:57429,61591:57430,61592:57431,61593:57432,61594:57433,61595:57434,61596:57435,61597:57436,61598:57437,61599:57438,61600:57439,61601:57440,61602:57441,61603:57442,61604:57443,61605:57444,61606:57445,61607:57446,61608:57447,61609:57448,61610:57449,61611:57450,61612:57451,61613:57452,61614:57453,61615:57454,61616:57455,61617:57456,61618:57457,61619:57458,61620:57459,61621:57460,61622:57461,61623:57462,61624:57463,61625:57464,61626:57465,61627:57466,61628:57467,61629:57468,61630:57469,61631:57470,61632:57471,61633:57472,61634:57473,61635:57474,61636:57475,61637:57476,61638:57477,61639:57478,61640:57479,61641:57480,61642:57481,61643:57482,61644:57483,61645:57484,61646:57485,61647:57486,61648:57487,61649:57488,61650:57489,61651:57490,61652:57491,61653:57492,61654:57493,61655:57494,61656:57495,61657:57496,61658:57497,61659:57498,61660:57499,61661:57500,61662:57501,61663:57502,61664:57503,61665:57504,61666:57505,61667:57506,61668:57507,61669:57508,61670:57509,61671:57510,61672:57511,61673:57512,61674:57513,61675:57514,61676:57515,61677:57516,61678:57517,61679:57518,61680:57519,61681:57520,61682:57521,61683:57522,61684:57523,61685:57524,61686:57525,61687:57526,61688:57527,61689:57528,61690:57529,61691:57530,61692:57531,61760:57532,61761:57533,61762:57534,61763:57535,61764:57536,61765:57537,61766:57538,61767:57539,61768:57540,61769:57541,61770:57542,61771:57543,61772:57544,61773:57545,61774:57546,61775:57547,61776:57548,61777:57549,61778:57550,61779:57551,61780:57552,61781:57553,61782:57554,61783:57555,61784:57556,61785:57557,61786:57558,61787:57559,61788:57560,61789:57561,61790:57562,61791:57563,61792:57564,61793:57565,61794:57566,61795:57567,61796:57568,61797:57569,61798:57570,61799:57571,61800:57572,61801:57573,61802:57574,61803:57575,61804:57576,61805:57577,61806:57578,61807:57579,61808:57580,61809:57581,61810:57582,61811:57583,61812:57584,61813:57585,61814:57586,61815:57587,61816:57588,61817:57589,61818:57590,61819:57591,61820:57592,61821:57593,61822:57594,61824:57595,61825:57596,61826:57597,61827:57598,61828:57599,61829:57600,61830:57601,61831:57602,61832:57603,61833:57604,61834:57605,61835:57606,61836:57607,61837:57608,61838:57609,61839:57610,61840:57611,61841:57612,61842:57613,61843:57614,61844:57615,61845:57616,61846:57617,61847:57618,61848:57619,61849:57620,61850:57621,61851:57622,61852:57623,61853:57624,61854:57625,61855:57626,61856:57627,61857:57628,61858:57629,61859:57630,61860:57631,61861:57632,61862:57633,61863:57634,61864:57635,61865:57636,61866:57637,61867:57638,61868:57639,61869:57640,61870:57641,61871:57642,61872:57643,61873:57644,61874:57645,61875:57646,61876:57647,61877:57648,61878:57649,61879:57650,61880:57651,61881:57652,61882:57653,61883:57654,61884:57655,61885:57656,61886:57657,61887:57658,61888:57659,61889:57660,61890:57661,61891:57662,61892:57663,61893:57664,61894:57665,61895:57666,61896:57667,61897:57668,61898:57669,61899:57670,61900:57671,61901:57672,61902:57673,61903:57674,61904:57675,61905:57676,61906:57677,61907:57678,61908:57679,61909:57680,61910:57681,61911:57682,61912:57683,61913:57684,61914:57685,61915:57686,61916:57687,61917:57688,61918:57689,61919:57690,61920:57691,61921:57692,61922:57693,61923:57694,61924:57695,61925:57696,61926:57697,61927:57698,61928:57699,61929:57700,61930:57701,61931:57702,61932:57703,61933:57704,61934:57705,61935:57706,61936:57707,61937:57708,61938:57709,61939:57710,61940:57711,61941:57712,61942:57713,61943:57714,61944:57715,61945:57716,61946:57717,61947:57718,61948:57719,62016:57720,62017:57721,62018:57722,62019:57723,62020:57724,62021:57725,62022:57726,62023:57727,62024:57728,62025:57729,62026:57730,62027:57731,62028:57732,62029:57733,62030:57734,62031:57735,62032:57736,62033:57737,62034:57738,62035:57739,62036:57740,62037:57741,62038:57742,62039:57743,62040:57744,62041:57745,62042:57746,62043:57747,62044:57748,62045:57749,62046:57750,62047:57751,62048:57752,62049:57753,62050:57754,62051:57755,62052:57756,62053:57757,62054:57758,62055:57759,62056:57760,62057:57761,62058:57762,62059:57763,62060:57764,62061:57765,62062:57766,62063:57767,62064:57768,62065:57769,62066:57770,62067:57771,62068:57772,62069:57773,62070:57774,62071:57775,62072:57776,62073:57777,62074:57778,62075:57779,62076:57780,62077:57781,62078:57782,62080:57783,62081:57784,62082:57785,62083:57786,62084:57787,62085:57788,62086:57789,62087:57790,62088:57791,62089:57792,62090:57793,62091:57794,62092:57795,62093:57796,62094:57797,62095:57798,62096:57799,62097:57800,62098:57801,62099:57802,62100:57803,62101:57804,62102:57805,62103:57806,62104:57807,62105:57808,62106:57809,62107:57810,62108:57811,62109:57812,62110:57813,62111:57814,62112:57815,62113:57816,62114:57817,62115:57818,62116:57819,62117:57820,62118:57821,62119:57822,62120:57823,62121:57824,62122:57825,62123:57826,62124:57827,62125:57828,62126:57829,62127:57830,62128:57831,62129:57832,62130:57833,62131:57834,62132:57835,62133:57836,62134:57837,62135:57838,62136:57839,62137:57840,62138:57841,62139:57842,62140:57843,62141:57844,62142:57845,62143:57846,62144:57847,62145:57848,62146:57849,62147:57850,62148:57851,62149:57852,62150:57853,62151:57854,62152:57855,62153:57856,62154:57857,62155:57858,62156:57859,62157:57860,62158:57861,62159:57862,62160:57863,62161:57864,62162:57865,62163:57866,62164:57867,62165:57868,62166:57869,62167:57870,62168:57871,62169:57872,62170:57873,62171:57874,62172:57875,62173:57876,62174:57877,62175:57878,62176:57879,62177:57880,62178:57881,62179:57882,62180:57883,62181:57884,62182:57885,62183:57886,62184:57887,62185:57888,62186:57889,62187:57890,62188:57891,62189:57892,62190:57893,62191:57894,62192:57895,62193:57896,62194:57897,62195:57898,62196:57899,62197:57900,62198:57901,62199:57902,62200:57903,62201:57904,62202:57905,62203:57906,62204:57907,62272:57908,62273:57909,62274:57910,62275:57911,62276:57912,62277:57913,62278:57914,62279:57915,62280:57916,62281:57917,62282:57918,62283:57919,62284:57920,62285:57921,62286:57922,62287:57923,62288:57924,62289:57925,62290:57926,62291:57927,62292:57928,62293:57929,62294:57930,62295:57931,62296:57932,62297:57933,62298:57934,62299:57935,62300:57936,62301:57937,62302:57938,62303:57939,62304:57940,62305:57941,62306:57942,62307:57943,62308:57944,62309:57945,62310:57946,62311:57947,62312:57948,62313:57949,62314:57950,62315:57951,62316:57952,62317:57953,62318:57954,62319:57955,62320:57956,62321:57957,62322:57958,62323:57959,62324:57960,62325:57961,62326:57962,62327:57963,62328:57964,62329:57965,62330:57966,62331:57967,62332:57968,62333:57969,62334:57970,62336:57971,62337:57972,62338:57973,62339:57974,62340:57975,62341:57976,62342:57977,62343:57978,62344:57979,62345:57980,62346:57981,62347:57982,62348:57983,62349:57984,62350:57985,62351:57986,62352:57987,62353:57988,62354:57989,62355:57990,62356:57991,62357:57992,62358:57993,62359:57994,62360:57995,62361:57996,62362:57997,62363:57998,62364:57999,62365:58e3,62366:58001,62367:58002,62368:58003,62369:58004,62370:58005,62371:58006,62372:58007,62373:58008,62374:58009,62375:58010,62376:58011,62377:58012,62378:58013,62379:58014,62380:58015,62381:58016,62382:58017,62383:58018,62384:58019,62385:58020,62386:58021,62387:58022,62388:58023,62389:58024,62390:58025,62391:58026,62392:58027,62393:58028,62394:58029,62395:58030,62396:58031,62397:58032,62398:58033,62399:58034,62400:58035,62401:58036,62402:58037,62403:58038,62404:58039,62405:58040,62406:58041,62407:58042,62408:58043,62409:58044,62410:58045,62411:58046,62412:58047,62413:58048,62414:58049,62415:58050,62416:58051,62417:58052,62418:58053,62419:58054,62420:58055,62421:58056,62422:58057,62423:58058,62424:58059,62425:58060,62426:58061,62427:58062,62428:58063,62429:58064,62430:58065,62431:58066,62432:58067,62433:58068,62434:58069,62435:58070,62436:58071,62437:58072,62438:58073,62439:58074,62440:58075,62441:58076,62442:58077,62443:58078,62444:58079,62445:58080,62446:58081,62447:58082,62448:58083,62449:58084,62450:58085,62451:58086,62452:58087,62453:58088,62454:58089,62455:58090,62456:58091,62457:58092,62458:58093,62459:58094,62460:58095,62528:58096,62529:58097,62530:58098,62531:58099,62532:58100,62533:58101,62534:58102,62535:58103,62536:58104,62537:58105,62538:58106,62539:58107,62540:58108,62541:58109,62542:58110,62543:58111,62544:58112,62545:58113,62546:58114,62547:58115,62548:58116,62549:58117,62550:58118,62551:58119,62552:58120,62553:58121,62554:58122,62555:58123,62556:58124,62557:58125,62558:58126,62559:58127,62560:58128,62561:58129,62562:58130,62563:58131,62564:58132,62565:58133,62566:58134,62567:58135,62568:58136,62569:58137,62570:58138,62571:58139,62572:58140,62573:58141,62574:58142,62575:58143,62576:58144,62577:58145,62578:58146,62579:58147,62580:58148,62581:58149,62582:58150,62583:58151,62584:58152,62585:58153,62586:58154,62587:58155,62588:58156,62589:58157,62590:58158,62592:58159,62593:58160,62594:58161,62595:58162,62596:58163,62597:58164,62598:58165,62599:58166,62600:58167,62601:58168,62602:58169,62603:58170,62604:58171,62605:58172,62606:58173,62607:58174,62608:58175,62609:58176,62610:58177,62611:58178,62612:58179,62613:58180,62614:58181,62615:58182,62616:58183,62617:58184,62618:58185,62619:58186,62620:58187,62621:58188,62622:58189,62623:58190,62624:58191,62625:58192,62626:58193,62627:58194,62628:58195,62629:58196,62630:58197,62631:58198,62632:58199,62633:58200,62634:58201,62635:58202,62636:58203,62637:58204,62638:58205,62639:58206,62640:58207,62641:58208,62642:58209,62643:58210,62644:58211,62645:58212,62646:58213,62647:58214,62648:58215,62649:58216,62650:58217,62651:58218,62652:58219,62653:58220,62654:58221,62655:58222,62656:58223,62657:58224,62658:58225,62659:58226,62660:58227,62661:58228,62662:58229,62663:58230,62664:58231,62665:58232,62666:58233,62667:58234,62668:58235,62669:58236,62670:58237,62671:58238,62672:58239,62673:58240,62674:58241,62675:58242,62676:58243,62677:58244,62678:58245,62679:58246,62680:58247,62681:58248,62682:58249,62683:58250,62684:58251,62685:58252,62686:58253,62687:58254,62688:58255,62689:58256,62690:58257,62691:58258,62692:58259,62693:58260,62694:58261,62695:58262,62696:58263,62697:58264,62698:58265,62699:58266,62700:58267,62701:58268,62702:58269,62703:58270,62704:58271,62705:58272,62706:58273,62707:58274,62708:58275,62709:58276,62710:58277,62711:58278,62712:58279,62713:58280,62714:58281,62715:58282,62716:58283,62784:58284,62785:58285,62786:58286,62787:58287,62788:58288,62789:58289,62790:58290,62791:58291,62792:58292,62793:58293,62794:58294,62795:58295,62796:58296,62797:58297,62798:58298,62799:58299,62800:58300,62801:58301,62802:58302,62803:58303,62804:58304,62805:58305,62806:58306,62807:58307,62808:58308,62809:58309,62810:58310,62811:58311,62812:58312,62813:58313,62814:58314,62815:58315,62816:58316,62817:58317,62818:58318,62819:58319,62820:58320,62821:58321,62822:58322,62823:58323,62824:58324,62825:58325,62826:58326,62827:58327,62828:58328,62829:58329,62830:58330,62831:58331,62832:58332,62833:58333,62834:58334,62835:58335,62836:58336,62837:58337,62838:58338,62839:58339,62840:58340,62841:58341,62842:58342,62843:58343,62844:58344,62845:58345,62846:58346,62848:58347,62849:58348,62850:58349,62851:58350,62852:58351,62853:58352,62854:58353,62855:58354,62856:58355,62857:58356,62858:58357,62859:58358,62860:58359,62861:58360,62862:58361,62863:58362,62864:58363,62865:58364,62866:58365,62867:58366,62868:58367,62869:58368,62870:58369,62871:58370,62872:58371,62873:58372,62874:58373,62875:58374,62876:58375,62877:58376,62878:58377,62879:58378,62880:58379,62881:58380,62882:58381,62883:58382,62884:58383,62885:58384,62886:58385,62887:58386,62888:58387,62889:58388,62890:58389,62891:58390,62892:58391,62893:58392,62894:58393,62895:58394,62896:58395,62897:58396,62898:58397,62899:58398,62900:58399,62901:58400,62902:58401,62903:58402,62904:58403,62905:58404,62906:58405,62907:58406,62908:58407,62909:58408,62910:58409,62911:58410,62912:58411,62913:58412,62914:58413,62915:58414,62916:58415,62917:58416,62918:58417,62919:58418,62920:58419,62921:58420,62922:58421,62923:58422,62924:58423,62925:58424,62926:58425,62927:58426,62928:58427,62929:58428,62930:58429,62931:58430,62932:58431,62933:58432,62934:58433,62935:58434,62936:58435,62937:58436,62938:58437,62939:58438,62940:58439,62941:58440,62942:58441,62943:58442,62944:58443,62945:58444,62946:58445,62947:58446,62948:58447,62949:58448,62950:58449,62951:58450,62952:58451,62953:58452,62954:58453,62955:58454,62956:58455,62957:58456,62958:58457,62959:58458,62960:58459,62961:58460,62962:58461,62963:58462,62964:58463,62965:58464,62966:58465,62967:58466,62968:58467,62969:58468,62970:58469,62971:58470,62972:58471,63040:58472,63041:58473,63042:58474,63043:58475,63044:58476,63045:58477,63046:58478,63047:58479,63048:58480,63049:58481,63050:58482,63051:58483,63052:58484,63053:58485,63054:58486,63055:58487,63056:58488,63057:58489,63058:58490,63059:58491,63060:58492,63061:58493,63062:58494,63063:58495,63064:58496,63065:58497,63066:58498,63067:58499,63068:58500,63069:58501,63070:58502,63071:58503,63072:58504,63073:58505,63074:58506,63075:58507,63076:58508,63077:58509,63078:58510,63079:58511,63080:58512,63081:58513,63082:58514,63083:58515,63084:58516,63085:58517,63086:58518,63087:58519,63088:58520,63089:58521,63090:58522,63091:58523,63092:58524,63093:58525,63094:58526,63095:58527,63096:58528,63097:58529,63098:58530,63099:58531,63100:58532,63101:58533,63102:58534,63104:58535,63105:58536,63106:58537,63107:58538,63108:58539,63109:58540,63110:58541,63111:58542,63112:58543,63113:58544,63114:58545,63115:58546,63116:58547,63117:58548,63118:58549,63119:58550,63120:58551,63121:58552,63122:58553,63123:58554,63124:58555,63125:58556,63126:58557,63127:58558,63128:58559,63129:58560,63130:58561,63131:58562,63132:58563,63133:58564,63134:58565,63135:58566,63136:58567,63137:58568,63138:58569,63139:58570,63140:58571,63141:58572,63142:58573,63143:58574,63144:58575,63145:58576,63146:58577,63147:58578,63148:58579,63149:58580,63150:58581,63151:58582,63152:58583,63153:58584,63154:58585,63155:58586,63156:58587,63157:58588,63158:58589,63159:58590,63160:58591,63161:58592,63162:58593,63163:58594,63164:58595,63165:58596,63166:58597,63167:58598,63168:58599,63169:58600,63170:58601,63171:58602,63172:58603,63173:58604,63174:58605,63175:58606,63176:58607,63177:58608,63178:58609,63179:58610,63180:58611,63181:58612,63182:58613,63183:58614,63184:58615,63185:58616,63186:58617,63187:58618,63188:58619,63189:58620,63190:58621,63191:58622,63192:58623,63193:58624,63194:58625,63195:58626,63196:58627,63197:58628,63198:58629,63199:58630,63200:58631,63201:58632,63202:58633,63203:58634,63204:58635,63205:58636,63206:58637,63207:58638,63208:58639,63209:58640,63210:58641,63211:58642,63212:58643,63213:58644,63214:58645,63215:58646,63216:58647,63217:58648,63218:58649,63219:58650,63220:58651,63221:58652,63222:58653,63223:58654,63224:58655,63225:58656,63226:58657,63227:58658,63228:58659,63296:58660,63297:58661,63298:58662,63299:58663,63300:58664,63301:58665,63302:58666,63303:58667,63304:58668,63305:58669,63306:58670,63307:58671,63308:58672,63309:58673,63310:58674,63311:58675,63312:58676,63313:58677,63314:58678,63315:58679,63316:58680,63317:58681,63318:58682,63319:58683,63320:58684,63321:58685,63322:58686,63323:58687,63324:58688,63325:58689,63326:58690,63327:58691,63328:58692,63329:58693,63330:58694,63331:58695,63332:58696,63333:58697,63334:58698,63335:58699,63336:58700,63337:58701,63338:58702,63339:58703,63340:58704,63341:58705,63342:58706,63343:58707,63344:58708,63345:58709,63346:58710,63347:58711,63348:58712,63349:58713,63350:58714,63351:58715,63352:58716,63353:58717,63354:58718,63355:58719,63356:58720,63357:58721,63358:58722,63360:58723,63361:58724,63362:58725,63363:58726,63364:58727,63365:58728,63366:58729,63367:58730,63368:58731,63369:58732,63370:58733,63371:58734,63372:58735,63373:58736,63374:58737,63375:58738,63376:58739,63377:58740,63378:58741,63379:58742,63380:58743,63381:58744,63382:58745,63383:58746,63384:58747,63385:58748,63386:58749,63387:58750,63388:58751,63389:58752,63390:58753,63391:58754,63392:58755,63393:58756,63394:58757,63395:58758,63396:58759,63397:58760,63398:58761,63399:58762,63400:58763,63401:58764,63402:58765,63403:58766,63404:58767,63405:58768,63406:58769,63407:58770,63408:58771,63409:58772,63410:58773,63411:58774,63412:58775,63413:58776,63414:58777,63415:58778,63416:58779,63417:58780,63418:58781,63419:58782,63420:58783,63421:58784,63422:58785,63423:58786,63424:58787,63425:58788,63426:58789,63427:58790,63428:58791,63429:58792,63430:58793,63431:58794,63432:58795,63433:58796,63434:58797,63435:58798,63436:58799,63437:58800,63438:58801,63439:58802,63440:58803,63441:58804,63442:58805,63443:58806,63444:58807,63445:58808,63446:58809,63447:58810,63448:58811,63449:58812,63450:58813,63451:58814,63452:58815,63453:58816,63454:58817,63455:58818,63456:58819,63457:58820,63458:58821,63459:58822,63460:58823,63461:58824,63462:58825,63463:58826,63464:58827,63465:58828,63466:58829,63467:58830,63468:58831,63469:58832,63470:58833,63471:58834,63472:58835,63473:58836,63474:58837,63475:58838,63476:58839,63477:58840,63478:58841,63479:58842,63480:58843,63481:58844,63482:58845,63483:58846,63484:58847,63552:58848,63553:58849,63554:58850,63555:58851,63556:58852,63557:58853,63558:58854,63559:58855,63560:58856,63561:58857,63562:58858,63563:58859,63564:58860,63565:58861,63566:58862,63567:58863,63568:58864,63569:58865,63570:58866,63571:58867,63572:58868,63573:58869,63574:58870,63575:58871,63576:58872,63577:58873,63578:58874,63579:58875,63580:58876,63581:58877,63582:58878,63583:58879,63584:58880,63585:58881,63586:58882,63587:58883,63588:58884,63589:58885,63590:58886,63591:58887,63592:58888,63593:58889,63594:58890,63595:58891,63596:58892,63597:58893,63598:58894,63599:58895,63600:58896,63601:58897,63602:58898,63603:58899,63604:58900,63605:58901,63606:58902,63607:58903,63608:58904,63609:58905,63610:58906,63611:58907,63612:58908,63613:58909,63614:58910,63616:58911,63617:58912,63618:58913,63619:58914,63620:58915,63621:58916,63622:58917,63623:58918,63624:58919,63625:58920,63626:58921,63627:58922,63628:58923,63629:58924,63630:58925,63631:58926,63632:58927,63633:58928,63634:58929,63635:58930,63636:58931,63637:58932,63638:58933,63639:58934,63640:58935,63641:58936,63642:58937,63643:58938,63644:58939,63645:58940,63646:58941,63647:58942,63648:58943,63649:58944,63650:58945,63651:58946,63652:58947,63653:58948,63654:58949,63655:58950,63656:58951,63657:58952,63658:58953,63659:58954,63660:58955,63661:58956,63662:58957,63663:58958,63664:58959,63665:58960,63666:58961,63667:58962,63668:58963,63669:58964,63670:58965,63671:58966,63672:58967,63673:58968,63674:58969,63675:58970,63676:58971,63677:58972,63678:58973,63679:58974,63680:58975,63681:58976,63682:58977,63683:58978,63684:58979,63685:58980,63686:58981,63687:58982,63688:58983,63689:58984,63690:58985,63691:58986,63692:58987,63693:58988,63694:58989,63695:58990,63696:58991,63697:58992,63698:58993,63699:58994,63700:58995,63701:58996,63702:58997,63703:58998,63704:58999,63705:59e3,63706:59001,63707:59002,63708:59003,63709:59004,63710:59005,63711:59006,63712:59007,63713:59008,63714:59009,63715:59010,63716:59011,63717:59012,63718:59013,63719:59014,63720:59015,63721:59016,63722:59017,63723:59018,63724:59019,63725:59020,63726:59021,63727:59022,63728:59023,63729:59024,63730:59025,63731:59026,63732:59027,63733:59028,63734:59029,63735:59030,63736:59031,63737:59032,63738:59033,63739:59034,63740:59035,64064:8560,64065:8561,64066:8562,64067:8563,64068:8564,64069:8565,64070:8566,64071:8567,64072:8568,64073:8569,64074:8544,64075:8545,64076:8546,64077:8547,64078:8548,64079:8549,64080:8550,64081:8551,64082:8552,64083:8553,64084:65506,64085:65508,64086:65287,64087:65282,64088:12849,64089:8470,64090:8481,64091:8757,64092:32394,64093:35100,64094:37704,64095:37512,64096:34012,64097:20425,64098:28859,64099:26161,64100:26824,64101:37625,64102:26363,64103:24389,64104:20008,64105:20193,64106:20220,64107:20224,64108:20227,64109:20281,64110:20310,64111:20370,64112:20362,64113:20378,64114:20372,64115:20429,64116:20544,64117:20514,64118:20479,64119:20510,64120:20550,64121:20592,64122:20546,64123:20628,64124:20724,64125:20696,64126:20810,64128:20836,64129:20893,64130:20926,64131:20972,64132:21013,64133:21148,64134:21158,64135:21184,64136:21211,64137:21248,64138:21255,64139:21284,64140:21362,64141:21395,64142:21426,64143:21469,64144:64014,64145:21660,64146:21642,64147:21673,64148:21759,64149:21894,64150:22361,64151:22373,64152:22444,64153:22472,64154:22471,64155:64015,64156:64016,64157:22686,64158:22706,64159:22795,64160:22867,64161:22875,64162:22877,64163:22883,64164:22948,64165:22970,64166:23382,64167:23488,64168:29999,64169:23512,64170:23532,64171:23582,64172:23718,64173:23738,64174:23797,64175:23847,64176:23891,64177:64017,64178:23874,64179:23917,64180:23992,64181:23993,64182:24016,64183:24353,64184:24372,64185:24423,64186:24503,64187:24542,64188:24669,64189:24709,64190:24714,64191:24798,64192:24789,64193:24864,64194:24818,64195:24849,64196:24887,64197:24880,64198:24984,64199:25107,64200:25254,64201:25589,64202:25696,64203:25757,64204:25806,64205:25934,64206:26112,64207:26133,64208:26171,64209:26121,64210:26158,64211:26142,64212:26148,64213:26213,64214:26199,64215:26201,64216:64018,64217:26227,64218:26265,64219:26272,64220:26290,64221:26303,64222:26362,64223:26382,64224:63785,64225:26470,64226:26555,64227:26706,64228:26560,64229:26625,64230:26692,64231:26831,64232:64019,64233:26984,64234:64020,64235:27032,64236:27106,64237:27184,64238:27243,64239:27206,64240:27251,64241:27262,64242:27362,64243:27364,64244:27606,64245:27711,64246:27740,64247:27782,64248:27759,64249:27866,64250:27908,64251:28039,64252:28015,64320:28054,64321:28076,64322:28111,64323:28152,64324:28146,64325:28156,64326:28217,64327:28252,64328:28199,64329:28220,64330:28351,64331:28552,64332:28597,64333:28661,64334:28677,64335:28679,64336:28712,64337:28805,64338:28843,64339:28943,64340:28932,64341:29020,64342:28998,64343:28999,64344:64021,64345:29121,64346:29182,64347:29361,64348:29374,64349:29476,64350:64022,64351:29559,64352:29629,64353:29641,64354:29654,64355:29667,64356:29650,64357:29703,64358:29685,64359:29734,64360:29738,64361:29737,64362:29742,64363:29794,64364:29833,64365:29855,64366:29953,64367:30063,64368:30338,64369:30364,64370:30366,64371:30363,64372:30374,64373:64023,64374:30534,64375:21167,64376:30753,64377:30798,64378:30820,64379:30842,64380:31024,64381:64024,64382:64025,64384:64026,64385:31124,64386:64027,64387:31131,64388:31441,64389:31463,64390:64028,64391:31467,64392:31646,64393:64029,64394:32072,64395:32092,64396:32183,64397:32160,64398:32214,64399:32338,64400:32583,64401:32673,64402:64030,64403:33537,64404:33634,64405:33663,64406:33735,64407:33782,64408:33864,64409:33972,64410:34131,64411:34137,64412:34155,64413:64031,64414:34224,64415:64032,64416:64033,64417:34823,64418:35061,64419:35346,64420:35383,64421:35449,64422:35495,64423:35518,64424:35551,64425:64034,64426:35574,64427:35667,64428:35711,64429:36080,64430:36084,64431:36114,64432:36214,64433:64035,64434:36559,64435:64036,64436:64037,64437:36967,64438:37086,64439:64038,64440:37141,64441:37159,64442:37338,64443:37335,64444:37342,64445:37357,64446:37358,64447:37348,64448:37349,64449:37382,64450:37392,64451:37386,64452:37434,64453:37440,64454:37436,64455:37454,64456:37465,64457:37457,64458:37433,64459:37479,64460:37543,64461:37495,64462:37496,64463:37607,64464:37591,64465:37593,64466:37584,64467:64039,64468:37589,64469:37600,64470:37587,64471:37669,64472:37665,64473:37627,64474:64040,64475:37662,64476:37631,64477:37661,64478:37634,64479:37744,64480:37719,64481:37796,64482:37830,64483:37854,64484:37880,64485:37937,64486:37957,64487:37960,64488:38290,64489:63964,64490:64041,64491:38557,64492:38575,64493:38707,64494:38715,64495:38723,64496:38733,64497:38735,64498:38737,64499:38741,64500:38999,64501:39013,64502:64042,64503:64043,64504:39207,64505:64044,64506:39326,64507:39502,64508:39641,64576:39644,64577:39797,64578:39794,64579:39823,64580:39857,64581:39867,64582:39936,64583:40304,64584:40299,64585:64045,64586:40473,64587:40657};function DataViewEx(rr,er){this.dv=new DataView(rr),this.offset=0,this.littleEndian=er!==void 0?er:!0,this.encoder=new CharsetEncoder}DataViewEx.prototype={constructor:DataViewEx,getInt8:function(){var rr=this.dv.getInt8(this.offset);return this.offset+=1,rr},getInt8Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getInt8());return er},getUint8:function(){var rr=this.dv.getUint8(this.offset);return this.offset+=1,rr},getUint8Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getUint8());return er},getInt16:function(){var rr=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,rr},getInt16Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getInt16());return er},getUint16:function(){var rr=this.dv.getUint16(this.offset,this.littleEndian);return this.offset+=2,rr},getUint16Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getUint16());return er},getInt32:function(){var rr=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,rr},getInt32Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getInt32());return er},getUint32:function(){var rr=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,rr},getUint32Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getUint32());return er},getFloat32:function(){var rr=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,rr},getFloat32Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getFloat32());return er},getFloat64:function(){var rr=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,rr},getFloat64Array:function(rr){for(var er=[],tr=0;tr<rr;tr++)er.push(this.getFloat64());return er},getIndex:function(rr,er){switch(rr){case 1:return er===!0?this.getUint8():this.getInt8();case 2:return er===!0?this.getUint16():this.getInt16();case 4:return this.getInt32();default:throw"unknown number type "+rr+" exception."}},getIndexArray:function(rr,er,tr){for(var ir=[],nr=0;nr<er;nr++)ir.push(this.getIndex(rr,tr));return ir},getChars:function(rr){for(var er="";rr>0;){var tr=this.getUint8();if(rr--,tr===0)break;er+=String.fromCharCode(tr)}for(;rr>0;)this.getUint8(),rr--;return er},getSjisStringsAsUnicode:function(rr){for(var er=[];rr>0;){var tr=this.getUint8();if(rr--,tr===0)break;er.push(tr)}for(;rr>0;)this.getUint8(),rr--;return this.encoder.s2u(new Uint8Array(er))},getUnicodeStrings:function(rr){for(var er="";rr>0;){var tr=this.getUint16();if(rr-=2,tr===0)break;er+=String.fromCharCode(tr)}for(;rr>0;)this.getUint8(),rr--;return er},getTextBuffer:function(){var rr=this.getUint32();return this.getUnicodeStrings(rr)}};function DataCreationHelper(){}DataCreationHelper.prototype={constructor:DataCreationHelper,leftToRightVector3:function(rr){rr[2]=-rr[2]},leftToRightQuaternion:function(rr){rr[0]=-rr[0],rr[1]=-rr[1]},leftToRightEuler:function(rr){rr[0]=-rr[0],rr[1]=-rr[1]},leftToRightIndexOrder:function(rr){var er=rr[2];rr[2]=rr[0],rr[0]=er},leftToRightVector3Range:function(rr,er){var tr=-er[2];er[2]=-rr[2],rr[2]=tr},leftToRightEulerRange:function(rr,er){var tr=-er[0],ir=-er[1];er[0]=-rr[0],er[1]=-rr[1],rr[0]=tr,rr[1]=ir}};function Parser$1(){}Parser$1.prototype.parsePmd=function(rr,er){var tr={},ir=new DataViewEx(rr);tr.metadata={},tr.metadata.format="pmd",tr.metadata.coordinateSystem="left";var nr=function(){var wr=tr.metadata;if(wr.magic=ir.getChars(3),wr.magic!=="Pmd")throw"PMD file magic is not Pmd, but "+wr.magic;wr.version=ir.getFloat32(),wr.modelName=ir.getSjisStringsAsUnicode(20),wr.comment=ir.getSjisStringsAsUnicode(256)},sr=function(){var wr=function(){var br={};return br.position=ir.getFloat32Array(3),br.normal=ir.getFloat32Array(3),br.uv=ir.getFloat32Array(2),br.skinIndices=ir.getUint16Array(2),br.skinWeights=[ir.getUint8()/100],br.skinWeights.push(1-br.skinWeights[0]),br.edgeFlag=ir.getUint8(),br},xr=tr.metadata;xr.vertexCount=ir.getUint32(),tr.vertices=[];for(var Sr=0;Sr<xr.vertexCount;Sr++)tr.vertices.push(wr())},ar=function(){var wr=function(){var br={};return br.indices=ir.getUint16Array(3),br},xr=tr.metadata;xr.faceCount=ir.getUint32()/3,tr.faces=[];for(var Sr=0;Sr<xr.faceCount;Sr++)tr.faces.push(wr())},or=function(){var wr=function(){var br={};return br.diffuse=ir.getFloat32Array(4),br.shininess=ir.getFloat32(),br.specular=ir.getFloat32Array(3),br.ambient=ir.getFloat32Array(3),br.toonIndex=ir.getInt8(),br.edgeFlag=ir.getUint8(),br.faceCount=ir.getUint32()/3,br.fileName=ir.getSjisStringsAsUnicode(20),br},xr=tr.metadata;xr.materialCount=ir.getUint32(),tr.materials=[];for(var Sr=0;Sr<xr.materialCount;Sr++)tr.materials.push(wr())},lr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(20),br.parentIndex=ir.getInt16(),br.tailIndex=ir.getInt16(),br.type=ir.getUint8(),br.ikIndex=ir.getInt16(),br.position=ir.getFloat32Array(3),br},xr=tr.metadata;xr.boneCount=ir.getUint16(),tr.bones=[];for(var Sr=0;Sr<xr.boneCount;Sr++)tr.bones.push(wr())},cr=function(){var wr=function(){var br={};br.target=ir.getUint16(),br.effector=ir.getUint16(),br.linkCount=ir.getUint8(),br.iteration=ir.getUint16(),br.maxAngle=ir.getFloat32(),br.links=[];for(var Cr=0;Cr<br.linkCount;Cr++){var Ir={};Ir.index=ir.getUint16(),br.links.push(Ir)}return br},xr=tr.metadata;xr.ikCount=ir.getUint16(),tr.iks=[];for(var Sr=0;Sr<xr.ikCount;Sr++)tr.iks.push(wr())},ur=function(){var wr=function(){var br={};br.name=ir.getSjisStringsAsUnicode(20),br.elementCount=ir.getUint32(),br.type=ir.getUint8(),br.elements=[];for(var Cr=0;Cr<br.elementCount;Cr++)br.elements.push({index:ir.getUint32(),position:ir.getFloat32Array(3)});return br},xr=tr.metadata;xr.morphCount=ir.getUint16(),tr.morphs=[];for(var Sr=0;Sr<xr.morphCount;Sr++)tr.morphs.push(wr())},dr=function(){var wr=function(){var br={};return br.index=ir.getUint16(),br},xr=tr.metadata;xr.morphFrameCount=ir.getUint8(),tr.morphFrames=[];for(var Sr=0;Sr<xr.morphFrameCount;Sr++)tr.morphFrames.push(wr())},hr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(50),br},xr=tr.metadata;xr.boneFrameNameCount=ir.getUint8(),tr.boneFrameNames=[];for(var Sr=0;Sr<xr.boneFrameNameCount;Sr++)tr.boneFrameNames.push(wr())},pr=function(){var wr=function(){var br={};return br.boneIndex=ir.getInt16(),br.frameIndex=ir.getUint8(),br},xr=tr.metadata;xr.boneFrameCount=ir.getUint32(),tr.boneFrames=[];for(var Sr=0;Sr<xr.boneFrameCount;Sr++)tr.boneFrames.push(wr())},gr=function(){var wr=tr.metadata;wr.englishCompatibility=ir.getUint8(),wr.englishCompatibility>0&&(wr.englishModelName=ir.getSjisStringsAsUnicode(20),wr.englishComment=ir.getSjisStringsAsUnicode(256))},vr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(20),br},xr=tr.metadata;if(xr.englishCompatibility!==0){tr.englishBoneNames=[];for(var Sr=0;Sr<xr.boneCount;Sr++)tr.englishBoneNames.push(wr())}},mr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(20),br},xr=tr.metadata;if(xr.englishCompatibility!==0){tr.englishMorphNames=[];for(var Sr=0;Sr<xr.morphCount-1;Sr++)tr.englishMorphNames.push(wr())}},fr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(50),br},xr=tr.metadata;if(xr.englishCompatibility!==0){tr.englishBoneFrameNames=[];for(var Sr=0;Sr<xr.boneFrameNameCount;Sr++)tr.englishBoneFrameNames.push(wr())}},_r=function(){var wr=function(){var Sr={};return Sr.fileName=ir.getSjisStringsAsUnicode(100),Sr};tr.toonTextures=[];for(var xr=0;xr<10;xr++)tr.toonTextures.push(wr())},Ar=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(20),br.boneIndex=ir.getInt16(),br.groupIndex=ir.getUint8(),br.groupTarget=ir.getUint16(),br.shapeType=ir.getUint8(),br.width=ir.getFloat32(),br.height=ir.getFloat32(),br.depth=ir.getFloat32(),br.position=ir.getFloat32Array(3),br.rotation=ir.getFloat32Array(3),br.weight=ir.getFloat32(),br.positionDamping=ir.getFloat32(),br.rotationDamping=ir.getFloat32(),br.restitution=ir.getFloat32(),br.friction=ir.getFloat32(),br.type=ir.getUint8(),br},xr=tr.metadata;xr.rigidBodyCount=ir.getUint32(),tr.rigidBodies=[];for(var Sr=0;Sr<xr.rigidBodyCount;Sr++)tr.rigidBodies.push(wr())},yr=function(){var wr=function(){var br={};return br.name=ir.getSjisStringsAsUnicode(20),br.rigidBodyIndex1=ir.getUint32(),br.rigidBodyIndex2=ir.getUint32(),br.position=ir.getFloat32Array(3),br.rotation=ir.getFloat32Array(3),br.translationLimitation1=ir.getFloat32Array(3),br.translationLimitation2=ir.getFloat32Array(3),br.rotationLimitation1=ir.getFloat32Array(3),br.rotationLimitation2=ir.getFloat32Array(3),br.springPosition=ir.getFloat32Array(3),br.springRotation=ir.getFloat32Array(3),br},xr=tr.metadata;xr.constraintCount=ir.getUint32(),tr.constraints=[];for(var Sr=0;Sr<xr.constraintCount;Sr++)tr.constraints.push(wr())};return nr(),sr(),ar(),or(),lr(),cr(),ur(),dr(),hr(),pr(),gr(),vr(),mr(),fr(),_r(),Ar(),yr(),er===!0&&this.leftToRightModel(tr),tr};Parser$1.prototype.parsePmx=function(rr,er){var tr={},ir=new DataViewEx(rr);tr.metadata={},tr.metadata.format="pmx",tr.metadata.coordinateSystem="left";var nr=function(){var gr=tr.metadata;if(gr.magic=ir.getChars(4),gr.magic!=="PMX ")throw"PMX file magic is not PMX , but "+gr.magic;if(gr.version=ir.getFloat32(),gr.version!==2&&gr.version!==2.1)throw"PMX version "+gr.version+" is not supported.";gr.headerSize=ir.getUint8(),gr.encoding=ir.getUint8(),gr.additionalUvNum=ir.getUint8(),gr.vertexIndexSize=ir.getUint8(),gr.textureIndexSize=ir.getUint8(),gr.materialIndexSize=ir.getUint8(),gr.boneIndexSize=ir.getUint8(),gr.morphIndexSize=ir.getUint8(),gr.rigidBodyIndexSize=ir.getUint8(),gr.modelName=ir.getTextBuffer(),gr.englishModelName=ir.getTextBuffer(),gr.comment=ir.getTextBuffer(),gr.englishComment=ir.getTextBuffer()},sr=function(){var gr=function(){var fr={};fr.position=ir.getFloat32Array(3),fr.normal=ir.getFloat32Array(3),fr.uv=ir.getFloat32Array(2),fr.auvs=[];for(var _r=0;_r<tr.metadata.additionalUvNum;_r++)fr.auvs.push(ir.getFloat32Array(4));fr.type=ir.getUint8();var Ar=vr.boneIndexSize;if(fr.type===0)fr.skinIndices=ir.getIndexArray(Ar,1),fr.skinWeights=[1];else if(fr.type===1)fr.skinIndices=ir.getIndexArray(Ar,2),fr.skinWeights=ir.getFloat32Array(1),fr.skinWeights.push(1-fr.skinWeights[0]);else if(fr.type===2)fr.skinIndices=ir.getIndexArray(Ar,4),fr.skinWeights=ir.getFloat32Array(4);else if(fr.type===3)fr.skinIndices=ir.getIndexArray(Ar,2),fr.skinWeights=ir.getFloat32Array(1),fr.skinWeights.push(1-fr.skinWeights[0]),fr.skinC=ir.getFloat32Array(3),fr.skinR0=ir.getFloat32Array(3),fr.skinR1=ir.getFloat32Array(3),fr.type=1;else throw"unsupport bone type "+fr.type+" exception.";return fr.edgeRatio=ir.getFloat32(),fr},vr=tr.metadata;vr.vertexCount=ir.getUint32(),tr.vertices=[];for(var mr=0;mr<vr.vertexCount;mr++)tr.vertices.push(gr())},ar=function(){var gr=function(){var fr={};return fr.indices=ir.getIndexArray(vr.vertexIndexSize,3,!0),fr},vr=tr.metadata;vr.faceCount=ir.getUint32()/3,tr.faces=[];for(var mr=0;mr<vr.faceCount;mr++)tr.faces.push(gr())},or=function(){var gr=function(){return ir.getTextBuffer()},vr=tr.metadata;vr.textureCount=ir.getUint32(),tr.textures=[];for(var mr=0;mr<vr.textureCount;mr++)tr.textures.push(gr())},lr=function(){var gr=function(){var fr={};if(fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.diffuse=ir.getFloat32Array(4),fr.specular=ir.getFloat32Array(3),fr.shininess=ir.getFloat32(),fr.ambient=ir.getFloat32Array(3),fr.flag=ir.getUint8(),fr.edgeColor=ir.getFloat32Array(4),fr.edgeSize=ir.getFloat32(),fr.textureIndex=ir.getIndex(tr.metadata.textureIndexSize),fr.envTextureIndex=ir.getIndex(tr.metadata.textureIndexSize),fr.envFlag=ir.getUint8(),fr.toonFlag=ir.getUint8(),fr.toonFlag===0)fr.toonIndex=ir.getIndex(tr.metadata.textureIndexSize);else if(fr.toonFlag===1)fr.toonIndex=ir.getInt8();else throw"unknown toon flag "+fr.toonFlag+" exception.";return fr.comment=ir.getTextBuffer(),fr.faceCount=ir.getUint32()/3,fr},vr=tr.metadata;vr.materialCount=ir.getUint32(),tr.materials=[];for(var mr=0;mr<vr.materialCount;mr++)tr.materials.push(gr())},cr=function(){var gr=function(){var fr={};if(fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.position=ir.getFloat32Array(3),fr.parentIndex=ir.getIndex(tr.metadata.boneIndexSize),fr.transformationClass=ir.getUint32(),fr.flag=ir.getUint16(),fr.flag&1?fr.connectIndex=ir.getIndex(tr.metadata.boneIndexSize):fr.offsetPosition=ir.getFloat32Array(3),fr.flag&256||fr.flag&512){var _r={};_r.isLocal=!!(fr.flag&128),_r.affectRotation=!!(fr.flag&256),_r.affectPosition=!!(fr.flag&512),_r.parentIndex=ir.getIndex(tr.metadata.boneIndexSize),_r.ratio=ir.getFloat32(),fr.grant=_r}if(fr.flag&1024&&(fr.fixAxis=ir.getFloat32Array(3)),fr.flag&2048&&(fr.localXVector=ir.getFloat32Array(3),fr.localZVector=ir.getFloat32Array(3)),fr.flag&8192&&(fr.key=ir.getUint32()),fr.flag&32){var Ar={};Ar.effector=ir.getIndex(tr.metadata.boneIndexSize),Ar.target=null,Ar.iteration=ir.getUint32(),Ar.maxAngle=ir.getFloat32(),Ar.linkCount=ir.getUint32(),Ar.links=[];for(var yr=0;yr<Ar.linkCount;yr++){var wr={};wr.index=ir.getIndex(tr.metadata.boneIndexSize),wr.angleLimitation=ir.getUint8(),wr.angleLimitation===1&&(wr.lowerLimitationAngle=ir.getFloat32Array(3),wr.upperLimitationAngle=ir.getFloat32Array(3)),Ar.links.push(wr)}fr.ik=Ar}return fr},vr=tr.metadata;vr.boneCount=ir.getUint32(),tr.bones=[];for(var mr=0;mr<vr.boneCount;mr++)tr.bones.push(gr())},ur=function(){var gr=function(){var fr={};fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.panel=ir.getUint8(),fr.type=ir.getUint8(),fr.elementCount=ir.getUint32(),fr.elements=[];for(var _r=0;_r<fr.elementCount;_r++)if(fr.type===0){var Ar={};Ar.index=ir.getIndex(tr.metadata.morphIndexSize),Ar.ratio=ir.getFloat32(),fr.elements.push(Ar)}else if(fr.type===1){var Ar={};Ar.index=ir.getIndex(tr.metadata.vertexIndexSize,!0),Ar.position=ir.getFloat32Array(3),fr.elements.push(Ar)}else if(fr.type===2){var Ar={};Ar.index=ir.getIndex(tr.metadata.boneIndexSize),Ar.position=ir.getFloat32Array(3),Ar.rotation=ir.getFloat32Array(4),fr.elements.push(Ar)}else if(fr.type===3){var Ar={};Ar.index=ir.getIndex(tr.metadata.vertexIndexSize,!0),Ar.uv=ir.getFloat32Array(4),fr.elements.push(Ar)}else if(fr.type!==4){if(fr.type!==5){if(fr.type!==6){if(fr.type!==7){if(fr.type===8){var Ar={};Ar.index=ir.getIndex(tr.metadata.materialIndexSize),Ar.type=ir.getUint8(),Ar.diffuse=ir.getFloat32Array(4),Ar.specular=ir.getFloat32Array(3),Ar.shininess=ir.getFloat32(),Ar.ambient=ir.getFloat32Array(3),Ar.edgeColor=ir.getFloat32Array(4),Ar.edgeSize=ir.getFloat32(),Ar.textureColor=ir.getFloat32Array(4),Ar.sphereTextureColor=ir.getFloat32Array(4),Ar.toonColor=ir.getFloat32Array(4),fr.elements.push(Ar)}}}}}return fr},vr=tr.metadata;vr.morphCount=ir.getUint32(),tr.morphs=[];for(var mr=0;mr<vr.morphCount;mr++)tr.morphs.push(gr())},dr=function(){var gr=function(){var fr={};fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.type=ir.getUint8(),fr.elementCount=ir.getUint32(),fr.elements=[];for(var _r=0;_r<fr.elementCount;_r++){var Ar={};Ar.target=ir.getUint8(),Ar.index=Ar.target===0?ir.getIndex(tr.metadata.boneIndexSize):ir.getIndex(tr.metadata.morphIndexSize),fr.elements.push(Ar)}return fr},vr=tr.metadata;vr.frameCount=ir.getUint32(),tr.frames=[];for(var mr=0;mr<vr.frameCount;mr++)tr.frames.push(gr())},hr=function(){var gr=function(){var fr={};return fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.boneIndex=ir.getIndex(tr.metadata.boneIndexSize),fr.groupIndex=ir.getUint8(),fr.groupTarget=ir.getUint16(),fr.shapeType=ir.getUint8(),fr.width=ir.getFloat32(),fr.height=ir.getFloat32(),fr.depth=ir.getFloat32(),fr.position=ir.getFloat32Array(3),fr.rotation=ir.getFloat32Array(3),fr.weight=ir.getFloat32(),fr.positionDamping=ir.getFloat32(),fr.rotationDamping=ir.getFloat32(),fr.restitution=ir.getFloat32(),fr.friction=ir.getFloat32(),fr.type=ir.getUint8(),fr},vr=tr.metadata;vr.rigidBodyCount=ir.getUint32(),tr.rigidBodies=[];for(var mr=0;mr<vr.rigidBodyCount;mr++)tr.rigidBodies.push(gr())},pr=function(){var gr=function(){var fr={};return fr.name=ir.getTextBuffer(),fr.englishName=ir.getTextBuffer(),fr.type=ir.getUint8(),fr.rigidBodyIndex1=ir.getIndex(tr.metadata.rigidBodyIndexSize),fr.rigidBodyIndex2=ir.getIndex(tr.metadata.rigidBodyIndexSize),fr.position=ir.getFloat32Array(3),fr.rotation=ir.getFloat32Array(3),fr.translationLimitation1=ir.getFloat32Array(3),fr.translationLimitation2=ir.getFloat32Array(3),fr.rotationLimitation1=ir.getFloat32Array(3),fr.rotationLimitation2=ir.getFloat32Array(3),fr.springPosition=ir.getFloat32Array(3),fr.springRotation=ir.getFloat32Array(3),fr},vr=tr.metadata;vr.constraintCount=ir.getUint32(),tr.constraints=[];for(var mr=0;mr<vr.constraintCount;mr++)tr.constraints.push(gr())};return nr(),sr(),ar(),or(),lr(),cr(),ur(),dr(),hr(),pr(),er===!0&&this.leftToRightModel(tr),tr};Parser$1.prototype.parseVmd=function(rr,er){var tr={},ir=new DataViewEx(rr);tr.metadata={},tr.metadata.coordinateSystem="left";var nr=function(){var lr=tr.metadata;if(lr.magic=ir.getChars(30),lr.magic!=="Vocaloid Motion Data 0002")throw"VMD file magic is not Vocaloid Motion Data 0002, but "+lr.magic;lr.name=ir.getSjisStringsAsUnicode(20)},sr=function(){var lr=function(){var dr={};return dr.boneName=ir.getSjisStringsAsUnicode(15),dr.frameNum=ir.getUint32(),dr.position=ir.getFloat32Array(3),dr.rotation=ir.getFloat32Array(4),dr.interpolation=ir.getUint8Array(64),dr},cr=tr.metadata;cr.motionCount=ir.getUint32(),tr.motions=[];for(var ur=0;ur<cr.motionCount;ur++)tr.motions.push(lr())},ar=function(){var lr=function(){var dr={};return dr.morphName=ir.getSjisStringsAsUnicode(15),dr.frameNum=ir.getUint32(),dr.weight=ir.getFloat32(),dr},cr=tr.metadata;cr.morphCount=ir.getUint32(),tr.morphs=[];for(var ur=0;ur<cr.morphCount;ur++)tr.morphs.push(lr())},or=function(){var lr=function(){var dr={};return dr.frameNum=ir.getUint32(),dr.distance=ir.getFloat32(),dr.position=ir.getFloat32Array(3),dr.rotation=ir.getFloat32Array(3),dr.interpolation=ir.getUint8Array(24),dr.fov=ir.getUint32(),dr.perspective=ir.getUint8(),dr},cr=tr.metadata;cr.cameraCount=ir.getUint32(),tr.cameras=[];for(var ur=0;ur<cr.cameraCount;ur++)tr.cameras.push(lr())};return nr(),sr(),ar(),or(),er===!0&&this.leftToRightVmd(tr),tr};Parser$1.prototype.parseVpd=function(rr,er){var tr={};tr.metadata={},tr.metadata.coordinateSystem="left",tr.bones=[];var ir=/\/\/\w*(\r|\n|\r\n)/g,nr=/\r|\n|\r\n/,sr=rr.replace(ir,"").split(nr);function ar(){throw"the file seems not vpd file."}function or(){sr[0]!=="Vocaloid Pose Data file"&&ar()}function lr(){sr.length<4&&ar(),tr.metadata.parentFile=sr[2],tr.metadata.boneCount=parseInt(sr[3])}function cr(){for(var ur=/^\s*(Bone[0-9]+)\s*\{\s*(.*)$/,dr=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,hr=/^\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*,\s*(-?[0-9]+\.[0-9]+)\s*;/,pr=/^\s*}/,gr=tr.bones,vr=null,mr=null,fr=null,_r=4;_r<sr.length;_r++){var Ar=sr[_r],yr;yr=Ar.match(ur),yr!==null&&(vr!==null&&ar(),vr=yr[2]),yr=Ar.match(dr),yr!==null&&(mr!==null&&ar(),mr=[parseFloat(yr[1]),parseFloat(yr[2]),parseFloat(yr[3])]),yr=Ar.match(hr),yr!==null&&(fr!==null&&ar(),fr=[parseFloat(yr[1]),parseFloat(yr[2]),parseFloat(yr[3]),parseFloat(yr[4])]),yr=Ar.match(pr),yr!==null&&((vr===null||mr===null||fr===null)&&ar(),gr.push({name:vr,translation:mr,quaternion:fr}),vr=null,mr=null,fr=null)}(vr!==null||mr!==null||fr!==null)&&ar()}return or(),lr(),cr(),er===!0&&this.leftToRightVpd(tr),tr};Parser$1.prototype.mergeVmds=function(rr){var er={};er.metadata={},er.metadata.name=rr[0].metadata.name,er.metadata.coordinateSystem=rr[0].metadata.coordinateSystem,er.metadata.motionCount=0,er.metadata.morphCount=0,er.metadata.cameraCount=0,er.motions=[],er.morphs=[],er.cameras=[];for(var tr=0;tr<rr.length;tr++){var ir=rr[tr];er.metadata.motionCount+=ir.metadata.motionCount,er.metadata.morphCount+=ir.metadata.morphCount,er.metadata.cameraCount+=ir.metadata.cameraCount;for(var nr=0;nr<ir.metadata.motionCount;nr++)er.motions.push(ir.motions[nr]);for(var nr=0;nr<ir.metadata.morphCount;nr++)er.morphs.push(ir.morphs[nr]);for(var nr=0;nr<ir.metadata.cameraCount;nr++)er.cameras.push(ir.cameras[nr])}return er};Parser$1.prototype.leftToRightModel=function(rr){if(rr.metadata.coordinateSystem!=="right"){rr.metadata.coordinateSystem="right";for(var er=new DataCreationHelper,tr=0;tr<rr.metadata.vertexCount;tr++)er.leftToRightVector3(rr.vertices[tr].position),er.leftToRightVector3(rr.vertices[tr].normal);for(var tr=0;tr<rr.metadata.faceCount;tr++)er.leftToRightIndexOrder(rr.faces[tr].indices);for(var tr=0;tr<rr.metadata.boneCount;tr++)er.leftToRightVector3(rr.bones[tr].position);for(var tr=0;tr<rr.metadata.morphCount;tr++){var ir=rr.morphs[tr];if(!(rr.metadata.format==="pmx"&&ir.type!==1))for(var nr=0;nr<ir.elements.length;nr++)er.leftToRightVector3(ir.elements[nr].position)}for(var tr=0;tr<rr.metadata.rigidBodyCount;tr++)er.leftToRightVector3(rr.rigidBodies[tr].position),er.leftToRightEuler(rr.rigidBodies[tr].rotation);for(var tr=0;tr<rr.metadata.constraintCount;tr++)er.leftToRightVector3(rr.constraints[tr].position),er.leftToRightEuler(rr.constraints[tr].rotation),er.leftToRightVector3Range(rr.constraints[tr].translationLimitation1,rr.constraints[tr].translationLimitation2),er.leftToRightEulerRange(rr.constraints[tr].rotationLimitation1,rr.constraints[tr].rotationLimitation2)}};Parser$1.prototype.leftToRightVmd=function(rr){if(rr.metadata.coordinateSystem!=="right"){rr.metadata.coordinateSystem="right";for(var er=new DataCreationHelper,tr=0;tr<rr.metadata.motionCount;tr++)er.leftToRightVector3(rr.motions[tr].position),er.leftToRightQuaternion(rr.motions[tr].rotation);for(var tr=0;tr<rr.metadata.cameraCount;tr++)er.leftToRightVector3(rr.cameras[tr].position),er.leftToRightEuler(rr.cameras[tr].rotation)}};Parser$1.prototype.leftToRightVpd=function(rr){if(rr.metadata.coordinateSystem!=="right"){rr.metadata.coordinateSystem="right";for(var er=new DataCreationHelper,tr=0;tr<rr.bones.length;tr++)er.leftToRightVector3(rr.bones[tr].translation),er.leftToRightQuaternion(rr.bones[tr].quaternion)}};var MMDParser={CharsetEncoder,Parser:Parser$1};class MMDExporter{constructor(){console.warn("THREE.MMDExporter: The module has been deprecated and will be removed with r172. Please migrate to https://github.com/takahirox/three-mmd-loader instead.")}parseVpd(er,tr,ir){if(er.isSkinnedMesh!==!0)return console.warn("THREE.MMDExporter: parseVpd() requires SkinnedMesh instance."),null;function nr(gr){Math.abs(gr)<1e-6&&(gr=0);let vr=gr.toString();vr.indexOf(".")===-1&&(vr+="."),vr+="000000";const mr=vr.indexOf("."),fr=vr.slice(0,mr),_r=vr.slice(mr+1,mr+7);return fr+"."+_r}function sr(gr){const vr=[];for(let mr=0,fr=gr.length;mr<fr;mr++)vr.push(nr(gr[mr]));return vr.join(",")}er.updateMatrixWorld(!0);const ar=er.skeleton.bones,or=getBindBones(er),lr=new Vector3$1,cr=new Quaternion$1,ur=new Quaternion$1,dr=new Matrix4,hr=[];hr.push("Vocaloid Pose Data file"),hr.push(""),hr.push((er.name!==""?er.name.replace(/\s/g,"_"):"skin")+".osm;"),hr.push(ar.length+";"),hr.push("");for(let gr=0,vr=ar.length;gr<vr;gr++){const mr=ar[gr],fr=or[gr];ir===!0&&mr.userData.ik!==void 0&&mr.userData.ik.originalMatrix!==void 0?dr.fromArray(mr.userData.ik.originalMatrix):dr.copy(mr.matrix),lr.setFromMatrixPosition(dr),cr.setFromRotationMatrix(dr);const _r=lr.sub(fr.position).toArray(),Ar=ur.copy(fr.quaternion).conjugate().multiply(cr).toArray();_r[2]=-_r[2],Ar[0]=-Ar[0],Ar[1]=-Ar[1],hr.push("Bone"+gr+"{"+mr.name),hr.push("  "+sr(_r)+";"),hr.push("  "+sr(Ar)+";"),hr.push("}"),hr.push("")}hr.push("");const pr=hr.join(`
`);return tr===!0?unicodeToShiftjis(pr):pr}}let u2sTable;function unicodeToShiftjis(rr){if(u2sTable===void 0){const ir=new MMDParser.CharsetEncoder().s2uTable;u2sTable={};const nr=Object.keys(ir);for(let sr=0,ar=nr.length;sr<ar;sr++){let or=nr[sr];const lr=ir[or];or=parseInt(or),u2sTable[lr]=or}}const er=[];for(let tr=0,ir=rr.length;tr<ir;tr++){const nr=rr.charCodeAt(tr),sr=u2sTable[nr];if(sr===void 0)throw new Error("cannot convert charcode 0x"+nr.toString(16));sr>255&&er.push(sr>>8&255),er.push(sr&255)}return new Uint8Array(er)}function getBindBones(rr){const er=rr.clone();return er.pose(),er.skeleton.bones}class OBJExporter{parse(er){let tr="",ir=0,nr=0,sr=0;const ar=new Vector3$1,or=new Color,lr=new Vector3$1,cr=new Vector2,ur=[];function dr(gr){let vr=0,mr=0,fr=0;const _r=gr.geometry,Ar=new Matrix3,yr=_r.getAttribute("position"),wr=_r.getAttribute("normal"),xr=_r.getAttribute("uv"),Sr=_r.getIndex();if(tr+="o "+gr.name+`
`,gr.material&&gr.material.name&&(tr+="usemtl "+gr.material.name+`
`),yr!==void 0)for(let br=0,Cr=yr.count;br<Cr;br++,vr++)ar.fromBufferAttribute(yr,br),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z+`
`;if(xr!==void 0)for(let br=0,Cr=xr.count;br<Cr;br++,fr++)cr.fromBufferAttribute(xr,br),tr+="vt "+cr.x+" "+cr.y+`
`;if(wr!==void 0){Ar.getNormalMatrix(gr.matrixWorld);for(let br=0,Cr=wr.count;br<Cr;br++,mr++)lr.fromBufferAttribute(wr,br),lr.applyMatrix3(Ar).normalize(),tr+="vn "+lr.x+" "+lr.y+" "+lr.z+`
`}if(Sr!==null)for(let br=0,Cr=Sr.count;br<Cr;br+=3){for(let Ir=0;Ir<3;Ir++){const Rr=Sr.getX(br+Ir)+1;ur[Ir]=ir+Rr+(wr||xr?"/"+(xr?nr+Rr:"")+(wr?"/"+(sr+Rr):""):"")}tr+="f "+ur.join(" ")+`
`}else for(let br=0,Cr=yr.count;br<Cr;br+=3){for(let Ir=0;Ir<3;Ir++){const Rr=br+Ir+1;ur[Ir]=ir+Rr+(wr||xr?"/"+(xr?nr+Rr:"")+(wr?"/"+(sr+Rr):""):"")}tr+="f "+ur.join(" ")+`
`}ir+=vr,nr+=fr,sr+=mr}function hr(gr){let vr=0;const mr=gr.geometry,fr=gr.type,_r=mr.getAttribute("position");if(tr+="o "+gr.name+`
`,_r!==void 0)for(let Ar=0,yr=_r.count;Ar<yr;Ar++,vr++)ar.fromBufferAttribute(_r,Ar),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z+`
`;if(fr==="Line"){tr+="l ";for(let Ar=1,yr=_r.count;Ar<=yr;Ar++)tr+=ir+Ar+" ";tr+=`
`}if(fr==="LineSegments")for(let Ar=1,yr=Ar+1,wr=_r.count;Ar<wr;Ar+=2,yr=Ar+1)tr+="l "+(ir+Ar)+" "+(ir+yr)+`
`;ir+=vr}function pr(gr){let vr=0;const mr=gr.geometry,fr=mr.getAttribute("position"),_r=mr.getAttribute("color");if(tr+="o "+gr.name+`
`,fr!==void 0){for(let Ar=0,yr=fr.count;Ar<yr;Ar++,vr++)ar.fromBufferAttribute(fr,Ar),ar.applyMatrix4(gr.matrixWorld),tr+="v "+ar.x+" "+ar.y+" "+ar.z,_r!==void 0&&(or.fromBufferAttribute(_r,Ar),ColorManagement.fromWorkingColorSpace(or,SRGBColorSpace),tr+=" "+or.r+" "+or.g+" "+or.b),tr+=`
`;tr+="p ";for(let Ar=1,yr=fr.count;Ar<=yr;Ar++)tr+=ir+Ar+" ";tr+=`
`}ir+=vr}return er.traverse(function(gr){gr.isMesh===!0&&dr(gr),gr.isLine===!0&&hr(gr),gr.isPoints===!0&&pr(gr)}),tr}}class PLYExporter{parse(er,tr,ir={}){function nr(Ar){er.traverse(function(yr){if(yr.isMesh===!0||yr.isPoints){const wr=yr,xr=wr.geometry;xr.hasAttribute("position")===!0&&Ar(wr,xr)}})}ir=Object.assign({binary:!1,excludeAttributes:[],littleEndian:!1},ir);const ar=ir.excludeAttributes;let or=!0,lr=!1,cr=!1,ur=!1,dr=0,hr=0;er.traverse(function(Ar){if(Ar.isMesh===!0){const wr=Ar.geometry,xr=wr.getAttribute("position"),Sr=wr.getAttribute("normal"),br=wr.getAttribute("uv"),Cr=wr.getAttribute("color"),Ir=wr.getIndex();if(xr===void 0)return;dr+=xr.count,hr+=Ir?Ir.count/3:xr.count/3,Sr!==void 0&&(lr=!0),br!==void 0&&(ur=!0),Cr!==void 0&&(cr=!0)}else if(Ar.isPoints){const wr=Ar.geometry,xr=wr.getAttribute("position"),Sr=wr.getAttribute("normal"),br=wr.getAttribute("color");dr+=xr.count,Sr!==void 0&&(lr=!0),br!==void 0&&(cr=!0),or=!1}});const pr=new Color;if(or=or&&ar.indexOf("index")===-1,lr=lr&&ar.indexOf("normal")===-1,cr=cr&&ar.indexOf("color")===-1,ur=ur&&ar.indexOf("uv")===-1,or&&hr!==Math.floor(hr))return console.error("PLYExporter: Failed to generate a valid PLY file with triangle indices because the number of indices is not divisible by 3."),null;const gr=4;let vr=`ply
format ${ir.binary?ir.littleEndian?"binary_little_endian":"binary_big_endian":"ascii"} 1.0
element vertex ${dr}
property float x
property float y
property float z
`;lr===!0&&(vr+=`property float nx
property float ny
property float nz
`),ur===!0&&(vr+=`property float s
property float t
`),cr===!0&&(vr+=`property uchar red
property uchar green
property uchar blue
`),or===!0&&(vr+=`element face ${hr}
property list uchar int vertex_index
`),vr+=`end_header
`;const mr=new Vector3$1,fr=new Matrix3;let _r=null;if(ir.binary===!0){const Ar=new TextEncoder().encode(vr),yr=dr*(4*3+(lr?4*3:0)+(cr?3:0)+(ur?4*2:0)),wr=or?hr*(gr*3+1):0,xr=new DataView(new ArrayBuffer(Ar.length+yr+wr));new Uint8Array(xr.buffer).set(Ar,0);let Sr=Ar.length,br=Ar.length+yr,Cr=0;nr(function(Ir,Rr){const Pr=Rr.getAttribute("position"),Dr=Rr.getAttribute("normal"),Fr=Rr.getAttribute("uv"),Or=Rr.getAttribute("color"),Nr=Rr.getIndex();fr.getNormalMatrix(Ir.matrixWorld);for(let Ur=0,Br=Pr.count;Ur<Br;Ur++)mr.fromBufferAttribute(Pr,Ur),mr.applyMatrix4(Ir.matrixWorld),xr.setFloat32(Sr,mr.x,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,mr.y,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,mr.z,ir.littleEndian),Sr+=4,lr===!0&&(Dr!=null?(mr.fromBufferAttribute(Dr,Ur),mr.applyMatrix3(fr).normalize(),xr.setFloat32(Sr,mr.x,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,mr.y,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,mr.z,ir.littleEndian),Sr+=4):(xr.setFloat32(Sr,0,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,0,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,0,ir.littleEndian),Sr+=4)),ur===!0&&(Fr!=null?(xr.setFloat32(Sr,Fr.getX(Ur),ir.littleEndian),Sr+=4,xr.setFloat32(Sr,Fr.getY(Ur),ir.littleEndian),Sr+=4):(xr.setFloat32(Sr,0,ir.littleEndian),Sr+=4,xr.setFloat32(Sr,0,ir.littleEndian),Sr+=4)),cr===!0&&(Or!=null?(pr.fromBufferAttribute(Or,Ur),ColorManagement.fromWorkingColorSpace(pr,SRGBColorSpace),xr.setUint8(Sr,Math.floor(pr.r*255)),Sr+=1,xr.setUint8(Sr,Math.floor(pr.g*255)),Sr+=1,xr.setUint8(Sr,Math.floor(pr.b*255)),Sr+=1):(xr.setUint8(Sr,255),Sr+=1,xr.setUint8(Sr,255),Sr+=1,xr.setUint8(Sr,255),Sr+=1));if(or===!0)if(Nr!==null)for(let Ur=0,Br=Nr.count;Ur<Br;Ur+=3)xr.setUint8(br,3),br+=1,xr.setUint32(br,Nr.getX(Ur+0)+Cr,ir.littleEndian),br+=gr,xr.setUint32(br,Nr.getX(Ur+1)+Cr,ir.littleEndian),br+=gr,xr.setUint32(br,Nr.getX(Ur+2)+Cr,ir.littleEndian),br+=gr;else for(let Ur=0,Br=Pr.count;Ur<Br;Ur+=3)xr.setUint8(br,3),br+=1,xr.setUint32(br,Cr+Ur,ir.littleEndian),br+=gr,xr.setUint32(br,Cr+Ur+1,ir.littleEndian),br+=gr,xr.setUint32(br,Cr+Ur+2,ir.littleEndian),br+=gr;Cr+=Pr.count}),_r=xr.buffer}else{let Ar=0,yr="",wr="";nr(function(xr,Sr){const br=Sr.getAttribute("position"),Cr=Sr.getAttribute("normal"),Ir=Sr.getAttribute("uv"),Rr=Sr.getAttribute("color"),Pr=Sr.getIndex();fr.getNormalMatrix(xr.matrixWorld);for(let Dr=0,Fr=br.count;Dr<Fr;Dr++){mr.fromBufferAttribute(br,Dr),mr.applyMatrix4(xr.matrixWorld);let Or=mr.x+" "+mr.y+" "+mr.z;lr===!0&&(Cr!=null?(mr.fromBufferAttribute(Cr,Dr),mr.applyMatrix3(fr).normalize(),Or+=" "+mr.x+" "+mr.y+" "+mr.z):Or+=" 0 0 0"),ur===!0&&(Ir!=null?Or+=" "+Ir.getX(Dr)+" "+Ir.getY(Dr):Or+=" 0 0"),cr===!0&&(Rr!=null?(pr.fromBufferAttribute(Rr,Dr),ColorManagement.fromWorkingColorSpace(pr,SRGBColorSpace),Or+=" "+Math.floor(pr.r*255)+" "+Math.floor(pr.g*255)+" "+Math.floor(pr.b*255)):Or+=" 255 255 255"),yr+=Or+`
`}if(or===!0){if(Pr!==null)for(let Dr=0,Fr=Pr.count;Dr<Fr;Dr+=3)wr+=`3 ${Pr.getX(Dr+0)+Ar}`,wr+=` ${Pr.getX(Dr+1)+Ar}`,wr+=` ${Pr.getX(Dr+2)+Ar}
`;else for(let Dr=0,Fr=br.count;Dr<Fr;Dr+=3)wr+=`3 ${Ar+Dr} ${Ar+Dr+1} ${Ar+Dr+2}
`;hr+=Pr?Pr.count/3:br.count/3}Ar+=br.count}),_r=`${vr}${yr}${or?`${wr}
`:`
`}`}return typeof tr=="function"&&requestAnimationFrame(()=>tr(_r)),_r}}class STLExporter{parse(er,tr={}){tr=Object.assign({binary:!1},tr);const ir=tr.binary,nr=[];let sr=0;er.traverse(function(fr){if(fr.isMesh){const _r=fr.geometry,Ar=_r.index,yr=_r.getAttribute("position");sr+=Ar!==null?Ar.count/3:yr.count/3,nr.push({object3d:fr,geometry:_r})}});let ar,or=80;if(ir===!0){const fr=sr*2+sr*3*4*4+80+4,_r=new ArrayBuffer(fr);ar=new DataView(_r),ar.setUint32(or,sr,!0),or+=4}else ar="",ar+=`solid exported
`;const lr=new Vector3$1,cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1,hr=new Vector3$1,pr=new Vector3$1;for(let fr=0,_r=nr.length;fr<_r;fr++){const Ar=nr[fr].object3d,yr=nr[fr].geometry,wr=yr.index,xr=yr.getAttribute("position");if(wr!==null)for(let Sr=0;Sr<wr.count;Sr+=3){const br=wr.getX(Sr+0),Cr=wr.getX(Sr+1),Ir=wr.getX(Sr+2);gr(br,Cr,Ir,xr,Ar)}else for(let Sr=0;Sr<xr.count;Sr+=3){const br=Sr+0,Cr=Sr+1,Ir=Sr+2;gr(br,Cr,Ir,xr,Ar)}}return ir===!1&&(ar+=`endsolid exported
`),ar;function gr(fr,_r,Ar,yr,wr){lr.fromBufferAttribute(yr,fr),cr.fromBufferAttribute(yr,_r),ur.fromBufferAttribute(yr,Ar),wr.isSkinnedMesh===!0&&(wr.applyBoneTransform(fr,lr),wr.applyBoneTransform(_r,cr),wr.applyBoneTransform(Ar,ur)),lr.applyMatrix4(wr.matrixWorld),cr.applyMatrix4(wr.matrixWorld),ur.applyMatrix4(wr.matrixWorld),vr(lr,cr,ur),mr(lr),mr(cr),mr(ur),ir===!0?(ar.setUint16(or,0,!0),or+=2):(ar+=`		endloop
`,ar+=`	endfacet
`)}function vr(fr,_r,Ar){dr.subVectors(Ar,_r),hr.subVectors(fr,_r),dr.cross(hr).normalize(),pr.copy(dr).normalize(),ir===!0?(ar.setFloat32(or,pr.x,!0),or+=4,ar.setFloat32(or,pr.y,!0),or+=4,ar.setFloat32(or,pr.z,!0),or+=4):(ar+="	facet normal "+pr.x+" "+pr.y+" "+pr.z+`
`,ar+=`		outer loop
`)}function mr(fr){ir===!0?(ar.setFloat32(or,fr.x,!0),or+=4,ar.setFloat32(or,fr.y,!0),or+=4,ar.setFloat32(or,fr.z,!0),or+=4):ar+="			vertex "+fr.x+" "+fr.y+" "+fr.z+`
`}}}class USDZExporter{constructor(){this.textureUtils=null}setTextureUtils(er){this.textureUtils=er}parse(er,tr,ir,nr){this.parseAsync(er,nr).then(tr).catch(ir)}async parseAsync(er,tr={}){tr=Object.assign({ar:{anchoring:{type:"plane"},planeAnchoring:{alignment:"horizontal"}},includeAnchoringProperties:!0,quickLookCompatible:!1,maxTextureSize:1024},tr);const ir={},nr="model.usda";ir[nr]=null;let sr=buildHeader();sr+=buildSceneStart(tr);const ar={},or={};er.traverseVisible(cr=>{if(cr.isMesh){const ur=cr.geometry,dr=cr.material;if(dr.isMeshStandardMaterial){const hr="geometries/Geometry_"+ur.id+".usda";if(!(hr in ir)){const pr=buildMeshObject(ur);ir[hr]=buildUSDFileAsString(pr)}dr.uuid in ar||(ar[dr.uuid]=dr),sr+=buildXform(cr,ur,dr)}else console.warn("THREE.USDZExporter: Unsupported material type (USDZ only supports MeshStandardMaterial)",cr)}else cr.isCamera&&(sr+=buildCamera(cr))}),sr+=buildSceneEnd(),sr+=buildMaterials(ar,or,tr.quickLookCompatible),ir[nr]=strToU8(sr),sr=null;for(const cr in or){let ur=or[cr];if(ur.isCompressedTexture===!0){if(this.textureUtils===null)throw new Error("THREE.USDZExporter: setTextureUtils() must be called to process compressed textures.");ur=await this.textureUtils.decompress(ur)}const dr=imageToCanvas(ur.image,ur.flipY,tr.maxTextureSize),hr=await new Promise(pr=>dr.toBlob(pr,"image/png",1));ir[`textures/Texture_${cr}.png`]=new Uint8Array(await hr.arrayBuffer())}let lr=0;for(const cr in ir){const ur=ir[cr],dr=34+cr.length;lr+=dr;const hr=lr&63;if(hr!==4){const pr=64-hr,gr=new Uint8Array(pr);ir[cr]=[ur,{extra:{12345:gr}}]}lr=ur.length}return zipSync(ir,{level:0})}}function imageToCanvas(rr,er,tr){if(typeof HTMLImageElement<"u"&&rr instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&rr instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&rr instanceof OffscreenCanvas||typeof ImageBitmap<"u"&&rr instanceof ImageBitmap){const ir=tr/Math.max(rr.width,rr.height),nr=document.createElement("canvas");nr.width=rr.width*Math.min(1,ir),nr.height=rr.height*Math.min(1,ir);const sr=nr.getContext("2d");return er===!0&&(sr.translate(0,nr.height),sr.scale(1,-1)),sr.drawImage(rr,0,0,nr.width,nr.height),nr}else throw new Error("THREE.USDZExporter: No valid image data found. Unable to process texture.")}const PRECISION=7;function buildHeader(){return`#usda 1.0
(
	customLayerData = {
		string creator = "Three.js USDZExporter"
	}
	defaultPrim = "Root"
	metersPerUnit = 1
	upAxis = "Y"
)

`}function buildSceneStart(rr){return`def Xform "Root"
{
	def Scope "Scenes" (
		kind = "sceneLibrary"
	)
	{
		def Xform "Scene" (
			customData = {
				bool preliminary_collidesWithEnvironment = 0
				string sceneName = "Scene"
			}
			sceneName = "Scene"
		)
		{${rr.includeAnchoringProperties===!0?`
		token preliminary:anchoring:type = "${rr.ar.anchoring.type}"
		token preliminary:planeAnchoring:alignment = "${rr.ar.planeAnchoring.alignment}"
	`:""}
`}function buildSceneEnd(){return`
		}
	}
}

`}function buildUSDFileAsString(rr){let er=buildHeader();return er+=rr,strToU8(er)}function buildXform(rr,er,tr){const ir="Object_"+rr.id,nr=buildMatrix(rr.matrixWorld);return rr.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",rr),`def Xform "${ir}" (
	prepend references = @./geometries/Geometry_${er.id}.usda@</Geometry>
	prepend apiSchemas = ["MaterialBindingAPI"]
)
{
	matrix4d xformOp:transform = ${nr}
	uniform token[] xformOpOrder = ["xformOp:transform"]

	rel material:binding = </Materials/Material_${tr.id}>
}

`}function buildMatrix(rr){const er=rr.elements;return`( ${buildMatrixRow(er,0)}, ${buildMatrixRow(er,4)}, ${buildMatrixRow(er,8)}, ${buildMatrixRow(er,12)} )`}function buildMatrixRow(rr,er){return`(${rr[er+0]}, ${rr[er+1]}, ${rr[er+2]}, ${rr[er+3]})`}function buildMeshObject(rr){return`
def "Geometry"
{
${buildMesh(rr)}
}
`}function buildMesh(rr){const er="Geometry",tr=rr.attributes,ir=tr.position.count;return`
	def Mesh "${er}"
	{
		int[] faceVertexCounts = [${buildMeshVertexCount(rr)}]
		int[] faceVertexIndices = [${buildMeshVertexIndices(rr)}]
		normal3f[] normals = [${buildVector3Array(tr.normal,ir)}] (
			interpolation = "vertex"
		)
		point3f[] points = [${buildVector3Array(tr.position,ir)}]
${buildPrimvars(tr)}
		uniform token subdivisionScheme = "none"
	}
`}function buildMeshVertexCount(rr){const er=rr.index!==null?rr.index.count:rr.attributes.position.count;return Array(er/3).fill(3).join(", ")}function buildMeshVertexIndices(rr){const er=rr.index,tr=[];if(er!==null)for(let ir=0;ir<er.count;ir++)tr.push(er.getX(ir));else{const ir=rr.attributes.position.count;for(let nr=0;nr<ir;nr++)tr.push(nr)}return tr.join(", ")}function buildVector3Array(rr,er){if(rr===void 0)return console.warn("USDZExporter: Normals missing."),Array(er).fill("(0, 0, 0)").join(", ");const tr=[];for(let ir=0;ir<rr.count;ir++){const nr=rr.getX(ir),sr=rr.getY(ir),ar=rr.getZ(ir);tr.push(`(${nr.toPrecision(PRECISION)}, ${sr.toPrecision(PRECISION)}, ${ar.toPrecision(PRECISION)})`)}return tr.join(", ")}function buildVector2Array(rr){const er=[];for(let tr=0;tr<rr.count;tr++){const ir=rr.getX(tr),nr=rr.getY(tr);er.push(`(${ir.toPrecision(PRECISION)}, ${1-nr.toPrecision(PRECISION)})`)}return er.join(", ")}function buildPrimvars(rr){let er="";for(let ir=0;ir<4;ir++){const nr=ir>0?ir:"",sr=rr["uv"+nr];sr!==void 0&&(er+=`
		texCoord2f[] primvars:st${nr} = [${buildVector2Array(sr)}] (
			interpolation = "vertex"
		)`)}const tr=rr.color;if(tr!==void 0){const ir=tr.count;er+=`
	color3f[] primvars:displayColor = [${buildVector3Array(tr,ir)}] (
		interpolation = "vertex"
		)`}return er}function buildMaterials(rr,er,tr=!1){const ir=[];for(const nr in rr){const sr=rr[nr];ir.push(buildMaterial(sr,er,tr))}return`def "Materials"
{
${ir.join("")}
}

`}function buildMaterial(rr,er,tr=!1){const ir="			",nr=[],sr=[];function ar(or,lr,cr){const ur=or.source.id+"_"+or.flipY;er[ur]=or;const dr=or.channel>0?"st"+or.channel:"st",hr={1e3:"repeat",1001:"clamp",1002:"mirror"},pr=or.repeat.clone(),gr=or.offset.clone(),vr=or.rotation,mr=Math.sin(vr),fr=Math.cos(vr);return gr.y=1-gr.y-pr.y,tr?(gr.x=gr.x/pr.x,gr.y=gr.y/pr.y,gr.x+=mr/pr.x,gr.y+=fr-1):(gr.x+=mr*pr.x,gr.y+=(1-fr)*pr.y),`
		def Shader "PrimvarReader_${lr}"
		{
			uniform token info:id = "UsdPrimvarReader_float2"
			float2 inputs:fallback = (0.0, 0.0)
			token inputs:varname = "${dr}"
			float2 outputs:result
		}

		def Shader "Transform2d_${lr}"
		{
			uniform token info:id = "UsdTransform2d"
			token inputs:in.connect = </Materials/Material_${rr.id}/PrimvarReader_${lr}.outputs:result>
			float inputs:rotation = ${(vr*(180/Math.PI)).toFixed(PRECISION)}
			float2 inputs:scale = ${buildVector2(pr)}
			float2 inputs:translation = ${buildVector2(gr)}
			float2 outputs:result
		}

		def Shader "Texture_${or.id}_${lr}"
		{
			uniform token info:id = "UsdUVTexture"
			asset inputs:file = @textures/Texture_${ur}.png@
			float2 inputs:st.connect = </Materials/Material_${rr.id}/Transform2d_${lr}.outputs:result>
			${cr!==void 0?"float4 inputs:scale = "+buildColor4(cr):""}
			token inputs:sourceColorSpace = "${or.colorSpace===NoColorSpace?"raw":"sRGB"}"
			token inputs:wrapS = "${hr[or.wrapS]}"
			token inputs:wrapT = "${hr[or.wrapT]}"
			float outputs:r
			float outputs:g
			float outputs:b
			float3 outputs:rgb
			${rr.transparent||rr.alphaTest>0?"float outputs:a":""}
		}`}return rr.side===DoubleSide&&console.warn("THREE.USDZExporter: USDZ does not support double sided materials",rr),rr.map!==null?(nr.push(`${ir}color3f inputs:diffuseColor.connect = </Materials/Material_${rr.id}/Texture_${rr.map.id}_diffuse.outputs:rgb>`),rr.transparent?nr.push(`${ir}float inputs:opacity.connect = </Materials/Material_${rr.id}/Texture_${rr.map.id}_diffuse.outputs:a>`):rr.alphaTest>0&&(nr.push(`${ir}float inputs:opacity.connect = </Materials/Material_${rr.id}/Texture_${rr.map.id}_diffuse.outputs:a>`),nr.push(`${ir}float inputs:opacityThreshold = ${rr.alphaTest}`)),sr.push(ar(rr.map,"diffuse",rr.color))):nr.push(`${ir}color3f inputs:diffuseColor = ${buildColor(rr.color)}`),rr.emissiveMap!==null?(nr.push(`${ir}color3f inputs:emissiveColor.connect = </Materials/Material_${rr.id}/Texture_${rr.emissiveMap.id}_emissive.outputs:rgb>`),sr.push(ar(rr.emissiveMap,"emissive",new Color(rr.emissive.r*rr.emissiveIntensity,rr.emissive.g*rr.emissiveIntensity,rr.emissive.b*rr.emissiveIntensity)))):rr.emissive.getHex()>0&&nr.push(`${ir}color3f inputs:emissiveColor = ${buildColor(rr.emissive)}`),rr.normalMap!==null&&(nr.push(`${ir}normal3f inputs:normal.connect = </Materials/Material_${rr.id}/Texture_${rr.normalMap.id}_normal.outputs:rgb>`),sr.push(ar(rr.normalMap,"normal"))),rr.aoMap!==null&&(nr.push(`${ir}float inputs:occlusion.connect = </Materials/Material_${rr.id}/Texture_${rr.aoMap.id}_occlusion.outputs:r>`),sr.push(ar(rr.aoMap,"occlusion",new Color(rr.aoMapIntensity,rr.aoMapIntensity,rr.aoMapIntensity)))),rr.roughnessMap!==null?(nr.push(`${ir}float inputs:roughness.connect = </Materials/Material_${rr.id}/Texture_${rr.roughnessMap.id}_roughness.outputs:g>`),sr.push(ar(rr.roughnessMap,"roughness",new Color(rr.roughness,rr.roughness,rr.roughness)))):nr.push(`${ir}float inputs:roughness = ${rr.roughness}`),rr.metalnessMap!==null?(nr.push(`${ir}float inputs:metallic.connect = </Materials/Material_${rr.id}/Texture_${rr.metalnessMap.id}_metallic.outputs:b>`),sr.push(ar(rr.metalnessMap,"metallic",new Color(rr.metalness,rr.metalness,rr.metalness)))):nr.push(`${ir}float inputs:metallic = ${rr.metalness}`),rr.alphaMap!==null?(nr.push(`${ir}float inputs:opacity.connect = </Materials/Material_${rr.id}/Texture_${rr.alphaMap.id}_opacity.outputs:r>`),nr.push(`${ir}float inputs:opacityThreshold = 0.0001`),sr.push(ar(rr.alphaMap,"opacity"))):nr.push(`${ir}float inputs:opacity = ${rr.opacity}`),rr.isMeshPhysicalMaterial&&(rr.clearcoatMap!==null?(nr.push(`${ir}float inputs:clearcoat.connect = </Materials/Material_${rr.id}/Texture_${rr.clearcoatMap.id}_clearcoat.outputs:r>`),sr.push(ar(rr.clearcoatMap,"clearcoat",new Color(rr.clearcoat,rr.clearcoat,rr.clearcoat)))):nr.push(`${ir}float inputs:clearcoat = ${rr.clearcoat}`),rr.clearcoatRoughnessMap!==null?(nr.push(`${ir}float inputs:clearcoatRoughness.connect = </Materials/Material_${rr.id}/Texture_${rr.clearcoatRoughnessMap.id}_clearcoatRoughness.outputs:g>`),sr.push(ar(rr.clearcoatRoughnessMap,"clearcoatRoughness",new Color(rr.clearcoatRoughness,rr.clearcoatRoughness,rr.clearcoatRoughness)))):nr.push(`${ir}float inputs:clearcoatRoughness = ${rr.clearcoatRoughness}`),nr.push(`${ir}float inputs:ior = ${rr.ior}`)),`
	def Material "Material_${rr.id}"
	{
		def Shader "PreviewSurface"
		{
			uniform token info:id = "UsdPreviewSurface"
${nr.join(`
`)}
			int inputs:useSpecularWorkflow = 0
			token outputs:surface
		}

		token outputs:surface.connect = </Materials/Material_${rr.id}/PreviewSurface.outputs:surface>

${sr.join(`
`)}

	}
`}function buildColor(rr){return`(${rr.r}, ${rr.g}, ${rr.b})`}function buildColor4(rr){return`(${rr.r}, ${rr.g}, ${rr.b}, 1.0)`}function buildVector2(rr){return`(${rr.x}, ${rr.y})`}function buildCamera(rr){const er=rr.name?rr.name:"Camera_"+rr.id,tr=buildMatrix(rr.matrixWorld);return rr.matrixWorld.determinant()<0&&console.warn("THREE.USDZExporter: USDZ does not support negative scales",rr),rr.isOrthographicCamera?`def Camera "${er}"
		{
			matrix4d xformOp:transform = ${tr}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${rr.near.toPrecision(PRECISION)}, ${rr.far.toPrecision(PRECISION)})
			float horizontalAperture = ${((Math.abs(rr.left)+Math.abs(rr.right))*10).toPrecision(PRECISION)}
			float verticalAperture = ${((Math.abs(rr.top)+Math.abs(rr.bottom))*10).toPrecision(PRECISION)}
			token projection = "orthographic"
		}
	
	`:`def Camera "${er}"
		{
			matrix4d xformOp:transform = ${tr}
			uniform token[] xformOpOrder = ["xformOp:transform"]

			float2 clippingRange = (${rr.near.toPrecision(PRECISION)}, ${rr.far.toPrecision(PRECISION)})
			float focalLength = ${rr.getFocalLength().toPrecision(PRECISION)}
			float focusDistance = ${rr.focus.toPrecision(PRECISION)}
			float horizontalAperture = ${rr.getFilmWidth().toPrecision(PRECISION)}
			token projection = "perspective"
			float verticalAperture = ${rr.getFilmHeight().toPrecision(PRECISION)}
		}
	
	`}class BoxLineGeometry extends BufferGeometry{constructor(er=1,tr=1,ir=1,nr=1,sr=1,ar=1){super(),nr=Math.floor(nr),sr=Math.floor(sr),ar=Math.floor(ar);const or=er/2,lr=tr/2,cr=ir/2,ur=er/nr,dr=tr/sr,hr=ir/ar,pr=[];let gr=-or,vr=-lr,mr=-cr;for(let fr=0;fr<=nr;fr++)pr.push(gr,-lr,-cr,gr,lr,-cr),pr.push(gr,lr,-cr,gr,lr,cr),pr.push(gr,lr,cr,gr,-lr,cr),pr.push(gr,-lr,cr,gr,-lr,-cr),gr+=ur;for(let fr=0;fr<=sr;fr++)pr.push(-or,vr,-cr,or,vr,-cr),pr.push(or,vr,-cr,or,vr,cr),pr.push(or,vr,cr,-or,vr,cr),pr.push(-or,vr,cr,-or,vr,-cr),vr+=dr;for(let fr=0;fr<=ar;fr++)pr.push(-or,-lr,mr,-or,lr,mr),pr.push(-or,lr,mr,or,lr,mr),pr.push(or,lr,mr,or,-lr,mr),pr.push(or,-lr,mr,-or,-lr,mr),mr+=hr;this.setAttribute("position",new Float32BufferAttribute(pr,3))}}const Visible=0,Deleted=1,_v1$4=new Vector3$1,_line3=new Line3,_plane$1=new Plane,_closestPoint$1=new Vector3$1,_triangle=new Triangle$2;class ConvexHull{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new VertexList,this.unassigned=new VertexList,this.vertices=[]}setFromPoints(er){if(er.length>=4){this.makeEmpty();for(let tr=0,ir=er.length;tr<ir;tr++)this.vertices.push(new VertexNode(er[tr]));this.compute()}return this}setFromObject(er){const tr=[];return er.updateMatrixWorld(!0),er.traverse(function(ir){const nr=ir.geometry;if(nr!==void 0){const sr=nr.attributes.position;if(sr!==void 0)for(let ar=0,or=sr.count;ar<or;ar++){const lr=new Vector3$1;lr.fromBufferAttribute(sr,ar).applyMatrix4(ir.matrixWorld),tr.push(lr)}}}),this.setFromPoints(tr)}containsPoint(er){const tr=this.faces;for(let ir=0,nr=tr.length;ir<nr;ir++)if(tr[ir].distanceToPoint(er)>this.tolerance)return!1;return!0}intersectRay(er,tr){const ir=this.faces;let nr=-1/0,sr=1/0;for(let ar=0,or=ir.length;ar<or;ar++){const lr=ir[ar],cr=lr.distanceToPoint(er.origin),ur=lr.normal.dot(er.direction);if(cr>0&&ur>=0)return null;const dr=ur!==0?-cr/ur:0;if(!(dr<=0)&&(ur>0?sr=Math.min(dr,sr):nr=Math.max(dr,nr),nr>sr))return null}return nr!==-1/0?er.at(nr,tr):er.at(sr,tr),tr}intersectsRay(er){return this.intersectRay(er,_v1$4)!==null}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(er,tr){return er.face=tr,tr.outside===null?this.assigned.append(er):this.assigned.insertBefore(tr.outside,er),tr.outside=er,this}removeVertexFromFace(er,tr){return er===tr.outside&&(er.next!==null&&er.next.face===tr?tr.outside=er.next:tr.outside=null),this.assigned.remove(er),this}removeAllVerticesFromFace(er){if(er.outside!==null){const tr=er.outside;let ir=er.outside;for(;ir.next!==null&&ir.next.face===er;)ir=ir.next;return this.assigned.removeSubList(tr,ir),tr.prev=ir.next=null,er.outside=null,tr}}deleteFaceVertices(er,tr){const ir=this.removeAllVerticesFromFace(er);if(ir!==void 0)if(tr===void 0)this.unassigned.appendChain(ir);else{let nr=ir;do{const sr=nr.next;tr.distanceToPoint(nr.point)>this.tolerance?this.addVertexToFace(nr,tr):this.unassigned.append(nr),nr=sr}while(nr!==null)}return this}resolveUnassignedPoints(er){if(this.unassigned.isEmpty()===!1){let tr=this.unassigned.first();do{const ir=tr.next;let nr=this.tolerance,sr=null;for(let ar=0;ar<er.length;ar++){const or=er[ar];if(or.mark===Visible){const lr=or.distanceToPoint(tr.point);if(lr>nr&&(nr=lr,sr=or),nr>1e3*this.tolerance)break}}sr!==null&&this.addVertexToFace(tr,sr),tr=ir}while(tr!==null)}return this}computeExtremes(){const er=new Vector3$1,tr=new Vector3$1,ir=[],nr=[];for(let sr=0;sr<3;sr++)ir[sr]=nr[sr]=this.vertices[0];er.copy(this.vertices[0].point),tr.copy(this.vertices[0].point);for(let sr=0,ar=this.vertices.length;sr<ar;sr++){const or=this.vertices[sr],lr=or.point;for(let cr=0;cr<3;cr++)lr.getComponent(cr)<er.getComponent(cr)&&(er.setComponent(cr,lr.getComponent(cr)),ir[cr]=or);for(let cr=0;cr<3;cr++)lr.getComponent(cr)>tr.getComponent(cr)&&(tr.setComponent(cr,lr.getComponent(cr)),nr[cr]=or)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(er.x),Math.abs(tr.x))+Math.max(Math.abs(er.y),Math.abs(tr.y))+Math.max(Math.abs(er.z),Math.abs(tr.z))),{min:ir,max:nr}}computeInitialHull(){const er=this.vertices,tr=this.computeExtremes(),ir=tr.min,nr=tr.max;let sr=0,ar=0;for(let hr=0;hr<3;hr++){const pr=nr[hr].point.getComponent(hr)-ir[hr].point.getComponent(hr);pr>sr&&(sr=pr,ar=hr)}const or=ir[ar],lr=nr[ar];let cr,ur;sr=0,_line3.set(or.point,lr.point);for(let hr=0,pr=this.vertices.length;hr<pr;hr++){const gr=er[hr];if(gr!==or&&gr!==lr){_line3.closestPointToPoint(gr.point,!0,_closestPoint$1);const vr=_closestPoint$1.distanceToSquared(gr.point);vr>sr&&(sr=vr,cr=gr)}}sr=-1,_plane$1.setFromCoplanarPoints(or.point,lr.point,cr.point);for(let hr=0,pr=this.vertices.length;hr<pr;hr++){const gr=er[hr];if(gr!==or&&gr!==lr&&gr!==cr){const vr=Math.abs(_plane$1.distanceToPoint(gr.point));vr>sr&&(sr=vr,ur=gr)}}const dr=[];if(_plane$1.distanceToPoint(ur.point)<0){dr.push(Face$1.create(or,lr,cr),Face$1.create(ur,lr,or),Face$1.create(ur,cr,lr),Face$1.create(ur,or,cr));for(let hr=0;hr<3;hr++){const pr=(hr+1)%3;dr[hr+1].getEdge(2).setTwin(dr[0].getEdge(pr)),dr[hr+1].getEdge(1).setTwin(dr[pr+1].getEdge(0))}}else{dr.push(Face$1.create(or,cr,lr),Face$1.create(ur,or,lr),Face$1.create(ur,lr,cr),Face$1.create(ur,cr,or));for(let hr=0;hr<3;hr++){const pr=(hr+1)%3;dr[hr+1].getEdge(2).setTwin(dr[0].getEdge((3-hr)%3)),dr[hr+1].getEdge(0).setTwin(dr[pr+1].getEdge(1))}}for(let hr=0;hr<4;hr++)this.faces.push(dr[hr]);for(let hr=0,pr=er.length;hr<pr;hr++){const gr=er[hr];if(gr!==or&&gr!==lr&&gr!==cr&&gr!==ur){sr=this.tolerance;let vr=null;for(let mr=0;mr<4;mr++){const fr=this.faces[mr].distanceToPoint(gr.point);fr>sr&&(sr=fr,vr=this.faces[mr])}vr!==null&&this.addVertexToFace(gr,vr)}}return this}reindexFaces(){const er=[];for(let tr=0;tr<this.faces.length;tr++){const ir=this.faces[tr];ir.mark===Visible&&er.push(ir)}return this.faces=er,this}nextVertexToAdd(){if(this.assigned.isEmpty()===!1){let er,tr=0;const ir=this.assigned.first().face;let nr=ir.outside;do{const sr=ir.distanceToPoint(nr.point);sr>tr&&(tr=sr,er=nr),nr=nr.next}while(nr!==null&&nr.face===ir);return er}}computeHorizon(er,tr,ir,nr){this.deleteFaceVertices(ir),ir.mark=Deleted;let sr;tr===null?sr=tr=ir.getEdge(0):sr=tr.next;do{const ar=sr.twin,or=ar.face;or.mark===Visible&&(or.distanceToPoint(er)>this.tolerance?this.computeHorizon(er,ar,or,nr):nr.push(sr)),sr=sr.next}while(sr!==tr);return this}addAdjoiningFace(er,tr){const ir=Face$1.create(er,tr.tail(),tr.head());return this.faces.push(ir),ir.getEdge(-1).setTwin(tr.twin),ir.getEdge(0)}addNewFaces(er,tr){this.newFaces=[];let ir=null,nr=null;for(let sr=0;sr<tr.length;sr++){const ar=tr[sr],or=this.addAdjoiningFace(er,ar);ir===null?ir=or:or.next.setTwin(nr),this.newFaces.push(or.face),nr=or}return ir.next.setTwin(nr),this}addVertexToHull(er){const tr=[];return this.unassigned.clear(),this.removeVertexFromFace(er,er.face),this.computeHorizon(er.point,null,er.face,tr),this.addNewFaces(er,tr),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let er;for(this.computeInitialHull();(er=this.nextVertexToAdd())!==void 0;)this.addVertexToHull(er);return this.reindexFaces(),this.cleanup(),this}}let Face$1=class ho{constructor(){this.normal=new Vector3$1,this.midpoint=new Vector3$1,this.area=0,this.constant=0,this.outside=null,this.mark=Visible,this.edge=null}static create(er,tr,ir){const nr=new ho,sr=new HalfEdge(er,nr),ar=new HalfEdge(tr,nr),or=new HalfEdge(ir,nr);return sr.next=or.prev=ar,ar.next=sr.prev=or,or.next=ar.prev=sr,nr.edge=sr,nr.compute()}getEdge(er){let tr=this.edge;for(;er>0;)tr=tr.next,er--;for(;er<0;)tr=tr.prev,er++;return tr}compute(){const er=this.edge.tail(),tr=this.edge.head(),ir=this.edge.next.head();return _triangle.set(er.point,tr.point,ir.point),_triangle.getNormal(this.normal),_triangle.getMidpoint(this.midpoint),this.area=_triangle.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(er){return this.normal.dot(er)-this.constant}};class HalfEdge{constructor(er,tr){this.vertex=er,this.prev=null,this.next=null,this.twin=null,this.face=tr}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const er=this.head(),tr=this.tail();return tr!==null?tr.point.distanceTo(er.point):-1}lengthSquared(){const er=this.head(),tr=this.tail();return tr!==null?tr.point.distanceToSquared(er.point):-1}setTwin(er){return this.twin=er,er.twin=this,this}}class VertexNode{constructor(er){this.point=er,this.prev=null,this.next=null,this.face=null}}class VertexList{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(er,tr){return tr.prev=er.prev,tr.next=er,tr.prev===null?this.head=tr:tr.prev.next=tr,er.prev=tr,this}insertAfter(er,tr){return tr.prev=er,tr.next=er.next,tr.next===null?this.tail=tr:tr.next.prev=tr,er.next=tr,this}append(er){return this.head===null?this.head=er:this.tail.next=er,er.prev=this.tail,er.next=null,this.tail=er,this}appendChain(er){for(this.head===null?this.head=er:this.tail.next=er,er.prev=this.tail;er.next!==null;)er=er.next;return this.tail=er,this}remove(er){return er.prev===null?this.head=er.next:er.prev.next=er.next,er.next===null?this.tail=er.prev:er.next.prev=er.prev,this}removeSubList(er,tr){return er.prev===null?this.head=tr.next:er.prev.next=tr.next,tr.next===null?this.tail=er.prev:tr.next.prev=er.prev,this}isEmpty(){return this.head===null}}class ConvexGeometry extends BufferGeometry{constructor(er=[]){super();const tr=[],ir=[],sr=new ConvexHull().setFromPoints(er).faces;for(let ar=0;ar<sr.length;ar++){const or=sr[ar];let lr=or.edge;do{const cr=lr.head().point;tr.push(cr.x,cr.y,cr.z),ir.push(or.normal.x,or.normal.y,or.normal.z),lr=lr.next}while(lr!==or.edge)}this.setAttribute("position",new Float32BufferAttribute(tr,3)),this.setAttribute("normal",new Float32BufferAttribute(ir,3))}}class DecalGeometry extends BufferGeometry{constructor(er,tr,ir,nr){super();const sr=[],ar=[],or=[],lr=new Vector3$1,cr=new Matrix3().getNormalMatrix(er.matrixWorld),ur=new Matrix4;ur.makeRotationFromEuler(ir),ur.setPosition(tr);const dr=new Matrix4;dr.copy(ur).invert(),hr(),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2)),ar.length>0&&this.setAttribute("normal",new Float32BufferAttribute(ar,3));function hr(){let mr=[];const fr=new Vector3$1,_r=new Vector3$1,Ar=er.geometry,yr=Ar.attributes.position,wr=Ar.attributes.normal;if(Ar.index!==null){const xr=Ar.index;for(let Sr=0;Sr<xr.count;Sr++)fr.fromBufferAttribute(yr,xr.getX(Sr)),wr?(_r.fromBufferAttribute(wr,xr.getX(Sr)),pr(mr,fr,_r)):pr(mr,fr)}else for(let xr=0;xr<yr.count;xr++)fr.fromBufferAttribute(yr,xr),wr?(_r.fromBufferAttribute(wr,xr),pr(mr,fr,_r)):pr(mr,fr);mr=gr(mr,lr.set(1,0,0)),mr=gr(mr,lr.set(-1,0,0)),mr=gr(mr,lr.set(0,1,0)),mr=gr(mr,lr.set(0,-1,0)),mr=gr(mr,lr.set(0,0,1)),mr=gr(mr,lr.set(0,0,-1));for(let xr=0;xr<mr.length;xr++){const Sr=mr[xr];or.push(.5+Sr.position.x/nr.x,.5+Sr.position.y/nr.y),Sr.position.applyMatrix4(ur),sr.push(Sr.position.x,Sr.position.y,Sr.position.z),Sr.normal!==null&&ar.push(Sr.normal.x,Sr.normal.y,Sr.normal.z)}}function pr(mr,fr,_r=null){fr.applyMatrix4(er.matrixWorld),fr.applyMatrix4(dr),_r?(_r.applyNormalMatrix(cr),mr.push(new DecalVertex(fr.clone(),_r.clone()))):mr.push(new DecalVertex(fr.clone()))}function gr(mr,fr){const _r=[],Ar=.5*Math.abs(nr.dot(fr));for(let yr=0;yr<mr.length;yr+=3){let wr=0,xr,Sr,br,Cr;const Ir=mr[yr+0].position.dot(fr)-Ar,Rr=mr[yr+1].position.dot(fr)-Ar,Pr=mr[yr+2].position.dot(fr)-Ar,Dr=Ir>0,Fr=Rr>0,Or=Pr>0;switch(wr=(Dr?1:0)+(Fr?1:0)+(Or?1:0),wr){case 0:{_r.push(mr[yr]),_r.push(mr[yr+1]),_r.push(mr[yr+2]);break}case 1:{if(Dr&&(xr=mr[yr+1],Sr=mr[yr+2],br=vr(mr[yr],xr,fr,Ar),Cr=vr(mr[yr],Sr,fr,Ar)),Fr){xr=mr[yr],Sr=mr[yr+2],br=vr(mr[yr+1],xr,fr,Ar),Cr=vr(mr[yr+1],Sr,fr,Ar),_r.push(br),_r.push(Sr.clone()),_r.push(xr.clone()),_r.push(Sr.clone()),_r.push(br.clone()),_r.push(Cr);break}Or&&(xr=mr[yr],Sr=mr[yr+1],br=vr(mr[yr+2],xr,fr,Ar),Cr=vr(mr[yr+2],Sr,fr,Ar)),_r.push(xr.clone()),_r.push(Sr.clone()),_r.push(br),_r.push(Cr),_r.push(br.clone()),_r.push(Sr.clone());break}case 2:{Dr||(xr=mr[yr].clone(),Sr=vr(xr,mr[yr+1],fr,Ar),br=vr(xr,mr[yr+2],fr,Ar),_r.push(xr),_r.push(Sr),_r.push(br)),Fr||(xr=mr[yr+1].clone(),Sr=vr(xr,mr[yr+2],fr,Ar),br=vr(xr,mr[yr],fr,Ar),_r.push(xr),_r.push(Sr),_r.push(br)),Or||(xr=mr[yr+2].clone(),Sr=vr(xr,mr[yr],fr,Ar),br=vr(xr,mr[yr+1],fr,Ar),_r.push(xr),_r.push(Sr),_r.push(br));break}case 3:break}}return _r}function vr(mr,fr,_r,Ar){const yr=mr.position.dot(_r)-Ar,wr=fr.position.dot(_r)-Ar,xr=yr/(yr-wr),Sr=new Vector3$1(mr.position.x+xr*(fr.position.x-mr.position.x),mr.position.y+xr*(fr.position.y-mr.position.y),mr.position.z+xr*(fr.position.z-mr.position.z));let br=null;return mr.normal!==null&&fr.normal!==null&&(br=new Vector3$1(mr.normal.x+xr*(fr.normal.x-mr.normal.x),mr.normal.y+xr*(fr.normal.y-mr.normal.y),mr.normal.z+xr*(fr.normal.z-mr.normal.z))),new DecalVertex(Sr,br)}}}class DecalVertex{constructor(er,tr=null){this.position=er,this.normal=tr}clone(){const er=this.position.clone(),tr=this.normal!==null?this.normal.clone():null;return new this.constructor(er,tr)}}class ParametricGeometry extends BufferGeometry{constructor(er=(nr,sr,ar)=>ar.set(nr,sr,Math.cos(nr)*Math.sin(sr)),tr=8,ir=8){super(),this.type="ParametricGeometry",this.parameters={func:er,slices:tr,stacks:ir};const nr=[],sr=[],ar=[],or=[],lr=1e-5,cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1,hr=new Vector3$1,pr=new Vector3$1,gr=tr+1;for(let vr=0;vr<=ir;vr++){const mr=vr/ir;for(let fr=0;fr<=tr;fr++){const _r=fr/tr;er(_r,mr,ur),sr.push(ur.x,ur.y,ur.z),_r-lr>=0?(er(_r-lr,mr,dr),hr.subVectors(ur,dr)):(er(_r+lr,mr,dr),hr.subVectors(dr,ur)),mr-lr>=0?(er(_r,mr-lr,dr),pr.subVectors(ur,dr)):(er(_r,mr+lr,dr),pr.subVectors(dr,ur)),cr.crossVectors(hr,pr).normalize(),ar.push(cr.x,cr.y,cr.z),or.push(_r,mr)}}for(let vr=0;vr<ir;vr++)for(let mr=0;mr<tr;mr++){const fr=vr*gr+mr,_r=vr*gr+mr+1,Ar=(vr+1)*gr+mr+1,yr=(vr+1)*gr+mr;nr.push(fr,_r,yr),nr.push(_r,Ar,yr)}this.setIndex(nr),this.setAttribute("position",new Float32BufferAttribute(sr,3)),this.setAttribute("normal",new Float32BufferAttribute(ar,3)),this.setAttribute("uv",new Float32BufferAttribute(or,2))}copy(er){return super.copy(er),this.parameters=Object.assign({},er.parameters),this}}const ParametricGeometries={klein:function(rr,er,tr){er*=Math.PI,rr*=2*Math.PI,er=er*2;let ir,nr;er<Math.PI?(ir=3*Math.cos(er)*(1+Math.sin(er))+2*(1-Math.cos(er)/2)*Math.cos(er)*Math.cos(rr),nr=-8*Math.sin(er)-2*(1-Math.cos(er)/2)*Math.sin(er)*Math.cos(rr)):(ir=3*Math.cos(er)*(1+Math.sin(er))+2*(1-Math.cos(er)/2)*Math.cos(rr+Math.PI),nr=-8*Math.sin(er));const sr=-2*(1-Math.cos(er)/2)*Math.sin(rr);tr.set(ir,sr,nr)},plane:function(rr,er){return function(tr,ir,nr){const sr=tr*rr,ar=0,or=ir*er;nr.set(sr,ar,or)}},mobius:function(rr,er,tr){rr=rr-.5;const ir=2*Math.PI*er,nr=2,sr=Math.cos(ir)*(nr+rr*Math.cos(ir/2)),ar=Math.sin(ir)*(nr+rr*Math.cos(ir/2)),or=rr*Math.sin(ir/2);tr.set(sr,ar,or)},mobius3d:function(rr,er,tr){rr*=Math.PI,er*=2*Math.PI,rr=rr*2;const ir=rr/2,nr=2.25,sr=.125,ar=.65;let or=sr*Math.cos(er)*Math.cos(ir)-ar*Math.sin(er)*Math.sin(ir);const lr=sr*Math.cos(er)*Math.sin(ir)+ar*Math.sin(er)*Math.cos(ir),cr=(nr+or)*Math.sin(rr);or=(nr+or)*Math.cos(rr),tr.set(or,cr,lr)}};ParametricGeometries.TubeGeometry=class extends ParametricGeometry{constructor(er,tr=64,ir=1,nr=8,sr=!1){const ar=tr+1,or=er.computeFrenetFrames(tr,sr),lr=or.tangents,cr=or.normals,ur=or.binormals,dr=new Vector3$1;function hr(pr,gr,vr){gr*=2*Math.PI;const mr=Math.floor(pr*(ar-1));er.getPointAt(pr,dr);const fr=cr[mr],_r=ur[mr],Ar=-ir*Math.cos(gr),yr=ir*Math.sin(gr);dr.x+=Ar*fr.x+yr*_r.x,dr.y+=Ar*fr.y+yr*_r.y,dr.z+=Ar*fr.z+yr*_r.z,vr.copy(dr)}super(hr,tr,nr),this.tangents=lr,this.normals=cr,this.binormals=ur,this.path=er,this.segments=tr,this.radius=ir,this.segmentsRadius=nr,this.closed=sr}};ParametricGeometries.TorusKnotGeometry=class extends ParametricGeometries.TubeGeometry{constructor(er=200,tr=40,ir=64,nr=8,sr=2,ar=3){class or extends Curve{getPoint(hr,pr=new Vector3$1){const gr=pr;hr*=Math.PI*2;const vr=.5,mr=(1+vr*Math.cos(ar*hr))*Math.cos(sr*hr),fr=(1+vr*Math.cos(ar*hr))*Math.sin(sr*hr),_r=vr*Math.sin(ar*hr);return gr.set(mr,fr,_r).multiplyScalar(er)}}const lr=ir,cr=nr,ur=new or;super(ur,lr,tr,cr,!0,!1),this.radius=er,this.tube=tr,this.segmentsT=ir,this.segmentsR=nr,this.p=sr,this.q=ar}};ParametricGeometries.SphereGeometry=class extends ParametricGeometry{constructor(er,tr,ir){function nr(sr,ar,or){sr*=Math.PI,ar*=2*Math.PI;const lr=er*Math.sin(sr)*Math.cos(ar),cr=er*Math.sin(sr)*Math.sin(ar),ur=er*Math.cos(sr);or.set(lr,cr,ur)}super(nr,tr,ir)}};ParametricGeometries.PlaneGeometry=class extends ParametricGeometry{constructor(er,tr,ir,nr){function sr(ar,or,lr){const cr=ar*er,ur=0,dr=or*tr;lr.set(cr,ur,dr)}super(sr,ir,nr)}};const _tempNormal=new Vector3$1;function getUv(rr,er,tr,ir,nr,sr){const ar=2*Math.PI*nr/4,or=Math.max(sr-2*nr,0),lr=Math.PI/4;_tempNormal.copy(er),_tempNormal[ir]=0,_tempNormal.normalize();const cr=.5*ar/(ar+or),ur=1-_tempNormal.angleTo(rr)/lr;return Math.sign(_tempNormal[tr])===1?ur*cr:or/(ar+or)+cr+cr*(1-ur)}class RoundedBoxGeometry extends BoxGeometry{constructor(er=1,tr=1,ir=1,nr=2,sr=.1){if(nr=nr*2+1,sr=Math.min(er/2,tr/2,ir/2,sr),super(1,1,1,nr,nr,nr),nr===1)return;const ar=this.toNonIndexed();this.index=null,this.attributes.position=ar.attributes.position,this.attributes.normal=ar.attributes.normal,this.attributes.uv=ar.attributes.uv;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1(er,tr,ir).divideScalar(2).subScalar(sr),ur=this.attributes.position.array,dr=this.attributes.normal.array,hr=this.attributes.uv.array,pr=ur.length/6,gr=new Vector3$1,vr=.5/nr;for(let mr=0,fr=0;mr<ur.length;mr+=3,fr+=2)switch(or.fromArray(ur,mr),lr.copy(or),lr.x-=Math.sign(lr.x)*vr,lr.y-=Math.sign(lr.y)*vr,lr.z-=Math.sign(lr.z)*vr,lr.normalize(),ur[mr+0]=cr.x*Math.sign(or.x)+lr.x*sr,ur[mr+1]=cr.y*Math.sign(or.y)+lr.y*sr,ur[mr+2]=cr.z*Math.sign(or.z)+lr.z*sr,dr[mr+0]=lr.x,dr[mr+1]=lr.y,dr[mr+2]=lr.z,Math.floor(mr/pr)){case 0:gr.set(1,0,0),hr[fr+0]=getUv(gr,lr,"z","y",sr,ir),hr[fr+1]=1-getUv(gr,lr,"y","z",sr,tr);break;case 1:gr.set(-1,0,0),hr[fr+0]=1-getUv(gr,lr,"z","y",sr,ir),hr[fr+1]=1-getUv(gr,lr,"y","z",sr,tr);break;case 2:gr.set(0,1,0),hr[fr+0]=1-getUv(gr,lr,"x","z",sr,er),hr[fr+1]=getUv(gr,lr,"z","x",sr,ir);break;case 3:gr.set(0,-1,0),hr[fr+0]=1-getUv(gr,lr,"x","z",sr,er),hr[fr+1]=1-getUv(gr,lr,"z","x",sr,ir);break;case 4:gr.set(0,0,1),hr[fr+0]=1-getUv(gr,lr,"x","y",sr,er),hr[fr+1]=1-getUv(gr,lr,"y","x",sr,tr);break;case 5:gr.set(0,0,-1),hr[fr+0]=getUv(gr,lr,"x","y",sr,er),hr[fr+1]=1-getUv(gr,lr,"y","x",sr,tr);break}}}class TeapotGeometry extends BufferGeometry{constructor(er=50,tr=10,ir=!0,nr=!0,sr=!0,ar=!0,or=!0){const lr=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],cr=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];super(),tr=Math.max(2,Math.floor(tr));const ur=1.3,hr=3.15*(or?1:ur)/2,pr=er/hr;let gr=ir?(8*tr-4)*tr:0;gr+=nr?(16*tr-4)*tr:0,gr+=sr?40*tr*tr:0;const vr=new Uint32Array(gr*3);let mr=ir?4:0;mr+=nr?8:0,mr+=sr?20:0,mr*=(tr+1)*(tr+1);const fr=new Float32Array(mr*3),_r=new Float32Array(mr*3),Ar=new Float32Array(mr*2),yr=new Matrix4;yr.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);const wr=[],xr=[],Sr=[],br=[],Cr=[],Ir=[],Rr=[],Pr=[],Dr=[],Fr=new Vector3$1;let Or,Nr,Ur,Br,Wr=0,Xr=0;const Yr=new Vector3$1,Qi=new Matrix4,Xi=new Matrix4,Kr=new Vector4,$r=new Vector4,Vr=new Vector4,Gr=new Vector4,qr=new Vector3$1,ji=new Vector3$1,Jr=yr.clone();Jr.transpose();const Ji=(ms,Yi,Gi)=>!(fr[ms*3]===fr[Yi*3]&&fr[ms*3+1]===fr[Yi*3+1]&&fr[ms*3+2]===fr[Yi*3+2]||fr[ms*3]===fr[Gi*3]&&fr[ms*3+1]===fr[Gi*3+1]&&fr[ms*3+2]===fr[Gi*3+2]||fr[Yi*3]===fr[Gi*3]&&fr[Yi*3+1]===fr[Gi*3+1]&&fr[Yi*3+2]===fr[Gi*3+2]);for(let ms=0;ms<3;ms++)Ir[ms]=new Matrix4;const Ki=sr?0:20,Zi=ir?32:28,Zr=tr+1;let is=0,os=0,cs=0,ss=0,es=0;for(let ms=Ki;ms<Zi;ms++)if(nr||ms<20||ms>=28){for(let Yi=0;Yi<3;Yi++){for(let Gi=0;Gi<4;Gi++)for(let Ni=0;Ni<4;Ni++)wr[Ni*4+Gi]=cr[lr[ms*16+Gi*4+Ni]*3+Yi],ar&&ms>=20&&ms<28&&Yi!==2&&(wr[Ni*4+Gi]*=1.077),!or&&Yi===2&&(wr[Ni*4+Gi]*=ur);Qi.set(wr[0],wr[1],wr[2],wr[3],wr[4],wr[5],wr[6],wr[7],wr[8],wr[9],wr[10],wr[11],wr[12],wr[13],wr[14],wr[15]),Xi.multiplyMatrices(Qi,yr),Ir[Yi].multiplyMatrices(Jr,Xi)}for(let Yi=0;Yi<=tr;Yi++){const Gi=Yi/tr;for(let Ni=0;Ni<=tr;Ni++){const Ri=Ni/tr;for(Br=4,Nr=Ur=1;Br--;)xr[Br]=Nr,Sr[Br]=Ur,Nr*=Gi,Ur*=Ri,Br===3?(br[Br]=Cr[Br]=0,Wr=Xr=1):(br[Br]=Wr*(3-Br),Cr[Br]=Xr*(3-Br),Wr*=Gi,Xr*=Ri);Kr.fromArray(xr),$r.fromArray(Sr),Vr.fromArray(br),Gr.fromArray(Cr);for(let qi=0;qi<3;qi++)Or=Kr.clone(),Or.applyMatrix4(Ir[qi]),Rr[qi]=Or.dot($r),Or=Vr.clone(),Or.applyMatrix4(Ir[qi]),Pr[qi]=Or.dot($r),Or=Kr.clone(),Or.applyMatrix4(Ir[qi]),Dr[qi]=Or.dot(Gr);qr.fromArray(Pr),ji.fromArray(Dr),Fr.crossVectors(ji,qr),Fr.normalize(),Rr[0]===0&&Rr[1]===0?Yr.set(0,Rr[2]>hr?1:-1,0):Yr.set(Fr.x,Fr.z,-Fr.y),fr[os++]=pr*Rr[0],fr[os++]=pr*(Rr[2]-hr),fr[os++]=-pr*Rr[1],_r[cs++]=Yr.x,_r[cs++]=Yr.y,_r[cs++]=Yr.z,Ar[ss++]=1-Ri,Ar[ss++]=1-Gi}}for(let Yi=0;Yi<tr;Yi++)for(let Gi=0;Gi<tr;Gi++){const Ni=is*Zr*Zr+Yi*Zr+Gi,Ri=Ni+1,qi=Ri+Zr,as=Ni+Zr;Ji(Ni,Ri,qi)&&(vr[es++]=Ni,vr[es++]=Ri,vr[es++]=qi),Ji(Ni,qi,as)&&(vr[es++]=Ni,vr[es++]=qi,vr[es++]=as)}is++}this.setIndex(new BufferAttribute(vr,1)),this.setAttribute("position",new BufferAttribute(fr,3)),this.setAttribute("normal",new BufferAttribute(_r,3)),this.setAttribute("uv",new BufferAttribute(Ar,2)),this.computeBoundingSphere()}}class TextGeometry extends ExtrudeGeometry{constructor(er,tr={}){const ir=tr.font;if(ir===void 0)super();else{const nr=ir.generateShapes(er,tr.size);tr.depth===void 0&&tr.height!==void 0&&console.warn("THREE.TextGeometry: .height is now depreciated. Please use .depth instead"),tr.depth=tr.depth!==void 0?tr.depth:tr.height!==void 0?tr.height:50,tr.bevelThickness===void 0&&(tr.bevelThickness=10),tr.bevelSize===void 0&&(tr.bevelSize=8),tr.bevelEnabled===void 0&&(tr.bevelEnabled=!1),super(nr,tr)}this.type="TextGeometry"}}class LightProbeHelper extends Mesh{constructor(er,tr=1){const ir=new ShaderMaterial({type:"LightProbeHelperMaterial",uniforms:{sh:{value:er.sh.coefficients},intensity:{value:er.intensity}},vertexShader:`

				varying vec3 vNormal;

				void main() {

					vNormal = normalize( normalMatrix * normal );

					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}

			`,fragmentShader:`

				#define RECIPROCAL_PI 0.318309886

				vec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {

					// matrix is assumed to be orthogonal

					return normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );

				}

				// source: https://graphics.stanford.edu/papers/envmap/envmap.pdf,
				vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {

					// normal is assumed to have unit length,

					float x = normal.x, y = normal.y, z = normal.z;

					// band 0,
					vec3 result = shCoefficients[ 0 ] * 0.886227;

					// band 1,
					result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
					result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
					result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;

					// band 2,
					result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
					result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
					result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
					result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
					result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
					return result;

				}

				uniform vec3 sh[ 9 ]; // sh coefficients

				uniform float intensity; // light probe intensity

				varying vec3 vNormal;

				void main() {

					vec3 normal = normalize( vNormal );

					vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );

					vec3 irradiance = shGetIrradianceAt( worldNormal, sh );

					vec3 outgoingLight = RECIPROCAL_PI * irradiance * intensity;

					gl_FragColor = linearToOutputTexel( vec4( outgoingLight, 1.0 ) );

				}

			`}),nr=new SphereGeometry(1,32,16);super(nr,ir),this.lightProbe=er,this.size=tr,this.type="LightProbeHelper",this.onBeforeRender()}dispose(){this.geometry.dispose(),this.material.dispose()}onBeforeRender(){this.position.copy(this.lightProbe.position),this.scale.set(1,1,1).multiplyScalar(this.size),this.material.uniforms.intensity.value=this.lightProbe.intensity}}class OctreeHelper extends LineSegments{constructor(er,tr=16776960){super(new BufferGeometry,new LineBasicMaterial({color:tr,toneMapped:!1})),this.octree=er,this.color=tr,this.type="OctreeHelper",this.update()}update(){const er=[];function tr(ir){for(let nr=0;nr<ir.length;nr++){const sr=ir[nr].box.min,ar=ir[nr].box.max;er.push(ar.x,ar.y,ar.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,sr.y,ar.z),er.push(sr.x,sr.y,ar.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,ar.y,ar.z),er.push(ar.x,ar.y,sr.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,sr.y,sr.z),er.push(sr.x,sr.y,sr.z),er.push(ar.x,sr.y,sr.z),er.push(ar.x,sr.y,sr.z),er.push(ar.x,ar.y,sr.z),er.push(ar.x,ar.y,ar.z),er.push(ar.x,ar.y,sr.z),er.push(sr.x,ar.y,ar.z),er.push(sr.x,ar.y,sr.z),er.push(sr.x,sr.y,ar.z),er.push(sr.x,sr.y,sr.z),er.push(ar.x,sr.y,ar.z),er.push(ar.x,sr.y,sr.z),tr(ir[nr].subTrees)}}tr(this.octree.subTrees),this.geometry.dispose(),this.geometry=new BufferGeometry,this.geometry.setAttribute("position",new Float32BufferAttribute(er,3))}dispose(){this.geometry.dispose(),this.material.dispose()}}class PositionalAudioHelper extends Line{constructor(er,tr=1,ir=16,nr=2){const sr=new BufferGeometry,ar=ir+nr*2,or=new Float32Array((ar*3+3)*3);sr.setAttribute("position",new BufferAttribute(or,3));const lr=new LineBasicMaterial({color:65280}),cr=new LineBasicMaterial({color:16776960});super(sr,[cr,lr]),this.audio=er,this.range=tr,this.divisionsInnerAngle=ir,this.divisionsOuterAngle=nr,this.type="PositionalAudioHelper",this.update()}update(){const er=this.audio,tr=this.range,ir=this.divisionsInnerAngle,nr=this.divisionsOuterAngle,sr=MathUtils.degToRad(er.panner.coneInnerAngle),ar=MathUtils.degToRad(er.panner.coneOuterAngle),or=sr/2,lr=ar/2;let cr=0,ur=0,dr,hr;const pr=this.geometry,gr=pr.attributes.position;pr.clearGroups();function vr(mr,fr,_r,Ar){const yr=(fr-mr)/_r;for(gr.setXYZ(cr,0,0,0),ur++,dr=mr;dr<fr;dr+=yr)hr=cr+ur,gr.setXYZ(hr,Math.sin(dr)*tr,0,Math.cos(dr)*tr),gr.setXYZ(hr+1,Math.sin(Math.min(dr+yr,fr))*tr,0,Math.cos(Math.min(dr+yr,fr))*tr),gr.setXYZ(hr+2,0,0,0),ur+=3;pr.addGroup(cr,ur,Ar),cr+=ur,ur=0}vr(-lr,-or,nr,0),vr(-or,or,ir,1),vr(or,lr,nr,0),gr.needsUpdate=!0,sr===ar&&(this.material[0].visible=!1)}dispose(){this.geometry.dispose(),this.material[0].dispose(),this.material[1].dispose()}}class RectAreaLightHelper extends Line{constructor(er,tr){const ir=[1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],nr=new BufferGeometry;nr.setAttribute("position",new Float32BufferAttribute(ir,3)),nr.computeBoundingSphere();const sr=new LineBasicMaterial({fog:!1});super(nr,sr),this.light=er,this.color=tr,this.type="RectAreaLightHelper";const ar=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],or=new BufferGeometry;or.setAttribute("position",new Float32BufferAttribute(ar,3)),or.computeBoundingSphere(),this.add(new Mesh(or,new MeshBasicMaterial({side:BackSide,fog:!1})))}updateMatrixWorld(){if(this.scale.set(.5*this.light.width,.5*this.light.height,1),this.color!==void 0)this.material.color.set(this.color),this.children[0].material.color.set(this.color);else{this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);const er=this.material.color,tr=Math.max(er.r,er.g,er.b);tr>1&&er.multiplyScalar(1/tr),this.children[0].material.color.copy(this.material.color)}this.matrixWorld.extractRotation(this.light.matrixWorld).scale(this.scale).copyPosition(this.light.matrixWorld),this.children[0].matrixWorld.copy(this.matrixWorld)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}function computeMikkTSpaceTangents(rr,er,tr=!0){if(!er||!er.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!rr.hasAttribute("position")||!rr.hasAttribute("normal")||!rr.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function ir(ar){if(ar.normalized||ar.isInterleavedBufferAttribute){const or=new Float32Array(ar.count*ar.itemSize);for(let lr=0,cr=0;lr<ar.count;lr++)or[cr++]=ar.getX(lr),or[cr++]=ar.getY(lr),ar.itemSize>2&&(or[cr++]=ar.getZ(lr));return or}return ar.array instanceof Float32Array?ar.array:new Float32Array(ar.array)}const nr=rr.index?rr.toNonIndexed():rr,sr=er.generateTangents(ir(nr.attributes.position),ir(nr.attributes.normal),ir(nr.attributes.uv));if(tr)for(let ar=3;ar<sr.length;ar+=4)sr[ar]*=-1;return nr.setAttribute("tangent",new BufferAttribute(sr,4)),rr!==nr&&rr.copy(nr),rr}function mergeGeometries(rr,er=!1){const tr=rr[0].index!==null,ir=new Set(Object.keys(rr[0].attributes)),nr=new Set(Object.keys(rr[0].morphAttributes)),sr={},ar={},or=rr[0].morphTargetsRelative,lr=new BufferGeometry;let cr=0;for(let ur=0;ur<rr.length;++ur){const dr=rr[ur];let hr=0;if(tr!==(dr.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const pr in dr.attributes){if(!ir.has(pr))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+'. All geometries must have compatible attributes; make sure "'+pr+'" attribute exists among all geometries, or in none of them.'),null;sr[pr]===void 0&&(sr[pr]=[]),sr[pr].push(dr.attributes[pr]),hr++}if(hr!==ir.size)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+". Make sure all geometries have the same number of attributes."),null;if(or!==dr.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const pr in dr.morphAttributes){if(!nr.has(pr))return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+".  .morphAttributes must be consistent throughout all geometries."),null;ar[pr]===void 0&&(ar[pr]=[]),ar[pr].push(dr.morphAttributes[pr])}if(er){let pr;if(tr)pr=dr.index.count;else if(dr.attributes.position!==void 0)pr=dr.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index "+ur+". The geometry must have either an index or a position attribute"),null;lr.addGroup(cr,pr,ur),cr+=pr}}if(tr){let ur=0;const dr=[];for(let hr=0;hr<rr.length;++hr){const pr=rr[hr].index;for(let gr=0;gr<pr.count;++gr)dr.push(pr.getX(gr)+ur);ur+=rr[hr].attributes.position.count}lr.setIndex(dr)}for(const ur in sr){const dr=mergeAttributes(sr[ur]);if(!dr)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+ur+" attribute."),null;lr.setAttribute(ur,dr)}for(const ur in ar){const dr=ar[ur][0].length;if(dr===0)break;lr.morphAttributes=lr.morphAttributes||{},lr.morphAttributes[ur]=[];for(let hr=0;hr<dr;++hr){const pr=[];for(let vr=0;vr<ar[ur].length;++vr)pr.push(ar[ur][vr][hr]);const gr=mergeAttributes(pr);if(!gr)return console.error("THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the "+ur+" morphAttribute."),null;lr.morphAttributes[ur].push(gr)}}return lr}function mergeAttributes(rr){let er,tr,ir,nr=-1,sr=0;for(let cr=0;cr<rr.length;++cr){const ur=rr[cr];if(er===void 0&&(er=ur.array.constructor),er!==ur.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(tr===void 0&&(tr=ur.itemSize),tr!==ur.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(ir===void 0&&(ir=ur.normalized),ir!==ur.normalized)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;if(nr===-1&&(nr=ur.gpuType),nr!==ur.gpuType)return console.error("THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes."),null;sr+=ur.count*tr}const ar=new er(sr),or=new BufferAttribute(ar,tr,ir);let lr=0;for(let cr=0;cr<rr.length;++cr){const ur=rr[cr];if(ur.isInterleavedBufferAttribute){const dr=lr/tr;for(let hr=0,pr=ur.count;hr<pr;hr++)for(let gr=0;gr<tr;gr++){const vr=ur.getComponent(hr,gr);or.setComponent(hr+dr,gr,vr)}}else ar.set(ur.array,lr);lr+=ur.count*tr}return nr!==void 0&&(or.gpuType=nr),or}function deepCloneAttribute(rr){return rr.isInstancedInterleavedBufferAttribute||rr.isInterleavedBufferAttribute?deinterleaveAttribute(rr):rr.isInstancedBufferAttribute?new InstancedBufferAttribute().copy(rr):new BufferAttribute().copy(rr)}function interleaveAttributes(rr){let er,tr=0,ir=0;for(let cr=0,ur=rr.length;cr<ur;++cr){const dr=rr[cr];if(er===void 0&&(er=dr.array.constructor),er!==dr.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;tr+=dr.array.length,ir+=dr.itemSize}const nr=new InterleavedBuffer(new er(tr),ir);let sr=0;const ar=[],or=["getX","getY","getZ","getW"],lr=["setX","setY","setZ","setW"];for(let cr=0,ur=rr.length;cr<ur;cr++){const dr=rr[cr],hr=dr.itemSize,pr=dr.count,gr=new InterleavedBufferAttribute(nr,hr,sr,dr.normalized);ar.push(gr),sr+=hr;for(let vr=0;vr<pr;vr++)for(let mr=0;mr<hr;mr++)gr[lr[mr]](vr,dr[or[mr]](vr))}return ar}function deinterleaveAttribute(rr){const er=rr.data.array.constructor,tr=rr.count,ir=rr.itemSize,nr=rr.normalized,sr=new er(tr*ir);let ar;rr.isInstancedInterleavedBufferAttribute?ar=new InstancedBufferAttribute(sr,ir,nr,rr.meshPerAttribute):ar=new BufferAttribute(sr,ir,nr);for(let or=0;or<tr;or++)ar.setX(or,rr.getX(or)),ir>=2&&ar.setY(or,rr.getY(or)),ir>=3&&ar.setZ(or,rr.getZ(or)),ir>=4&&ar.setW(or,rr.getW(or));return ar}function deinterleaveGeometry(rr){const er=rr.attributes,tr=rr.morphTargets,ir=new Map;for(const nr in er){const sr=er[nr];sr.isInterleavedBufferAttribute&&(ir.has(sr)||ir.set(sr,deinterleaveAttribute(sr)),er[nr]=ir.get(sr))}for(const nr in tr){const sr=tr[nr];sr.isInterleavedBufferAttribute&&(ir.has(sr)||ir.set(sr,deinterleaveAttribute(sr)),tr[nr]=ir.get(sr))}}function estimateBytesUsed(rr){let er=0;for(const ir in rr.attributes){const nr=rr.getAttribute(ir);er+=nr.count*nr.itemSize*nr.array.BYTES_PER_ELEMENT}const tr=rr.getIndex();return er+=tr?tr.count*tr.itemSize*tr.array.BYTES_PER_ELEMENT:0,er}function mergeVertices(rr,er=1e-4){er=Math.max(er,Number.EPSILON);const tr={},ir=rr.getIndex(),nr=rr.getAttribute("position"),sr=ir?ir.count:nr.count;let ar=0;const or=Object.keys(rr.attributes),lr={},cr={},ur=[],dr=["getX","getY","getZ","getW"],hr=["setX","setY","setZ","setW"];for(let _r=0,Ar=or.length;_r<Ar;_r++){const yr=or[_r],wr=rr.attributes[yr];lr[yr]=new wr.constructor(new wr.array.constructor(wr.count*wr.itemSize),wr.itemSize,wr.normalized);const xr=rr.morphAttributes[yr];xr&&(cr[yr]||(cr[yr]=[]),xr.forEach((Sr,br)=>{const Cr=new Sr.array.constructor(Sr.count*Sr.itemSize);cr[yr][br]=new Sr.constructor(Cr,Sr.itemSize,Sr.normalized)}))}const pr=er*.5,gr=Math.log10(1/er),vr=Math.pow(10,gr),mr=pr*vr;for(let _r=0;_r<sr;_r++){const Ar=ir?ir.getX(_r):_r;let yr="";for(let wr=0,xr=or.length;wr<xr;wr++){const Sr=or[wr],br=rr.getAttribute(Sr),Cr=br.itemSize;for(let Ir=0;Ir<Cr;Ir++)yr+=`${~~(br[dr[Ir]](Ar)*vr+mr)},`}if(yr in tr)ur.push(tr[yr]);else{for(let wr=0,xr=or.length;wr<xr;wr++){const Sr=or[wr],br=rr.getAttribute(Sr),Cr=rr.morphAttributes[Sr],Ir=br.itemSize,Rr=lr[Sr],Pr=cr[Sr];for(let Dr=0;Dr<Ir;Dr++){const Fr=dr[Dr],Or=hr[Dr];if(Rr[Or](ar,br[Fr](Ar)),Cr)for(let Nr=0,Ur=Cr.length;Nr<Ur;Nr++)Pr[Nr][Or](ar,Cr[Nr][Fr](Ar))}}tr[yr]=ar,ur.push(ar),ar++}}const fr=rr.clone();for(const _r in rr.attributes){const Ar=lr[_r];if(fr.setAttribute(_r,new Ar.constructor(Ar.array.slice(0,ar*Ar.itemSize),Ar.itemSize,Ar.normalized)),_r in cr)for(let yr=0;yr<cr[_r].length;yr++){const wr=cr[_r][yr];fr.morphAttributes[_r][yr]=new wr.constructor(wr.array.slice(0,ar*wr.itemSize),wr.itemSize,wr.normalized)}}return fr.setIndex(ur),fr}function toTrianglesDrawMode(rr,er){if(er===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),rr;if(er===TriangleFanDrawMode||er===TriangleStripDrawMode){let tr=rr.getIndex();if(tr===null){const ar=[],or=rr.getAttribute("position");if(or!==void 0){for(let lr=0;lr<or.count;lr++)ar.push(lr);rr.setIndex(ar),tr=rr.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),rr}const ir=tr.count-2,nr=[];if(er===TriangleFanDrawMode)for(let ar=1;ar<=ir;ar++)nr.push(tr.getX(0)),nr.push(tr.getX(ar)),nr.push(tr.getX(ar+1));else for(let ar=0;ar<ir;ar++)ar%2===0?(nr.push(tr.getX(ar)),nr.push(tr.getX(ar+1)),nr.push(tr.getX(ar+2))):(nr.push(tr.getX(ar+2)),nr.push(tr.getX(ar+1)),nr.push(tr.getX(ar)));nr.length/3!==ir&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const sr=rr.clone();return sr.setIndex(nr),sr.clearGroups(),sr}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",er),rr}function computeMorphedAttributes(rr){const er=new Vector3$1,tr=new Vector3$1,ir=new Vector3$1,nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1;function ur(Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr){er.fromBufferAttribute(Xr,Xi),tr.fromBufferAttribute(Xr,Kr),ir.fromBufferAttribute(Xr,$r);const Gr=Wr.morphTargetInfluences;if(Yr&&Gr){or.set(0,0,0),lr.set(0,0,0),cr.set(0,0,0);for(let qr=0,ji=Yr.length;qr<ji;qr++){const Jr=Gr[qr],Ji=Yr[qr];Jr!==0&&(nr.fromBufferAttribute(Ji,Xi),sr.fromBufferAttribute(Ji,Kr),ar.fromBufferAttribute(Ji,$r),Qi?(or.addScaledVector(nr,Jr),lr.addScaledVector(sr,Jr),cr.addScaledVector(ar,Jr)):(or.addScaledVector(nr.sub(er),Jr),lr.addScaledVector(sr.sub(tr),Jr),cr.addScaledVector(ar.sub(ir),Jr)))}er.add(or),tr.add(lr),ir.add(cr)}Wr.isSkinnedMesh&&(Wr.applyBoneTransform(Xi,er),Wr.applyBoneTransform(Kr,tr),Wr.applyBoneTransform($r,ir)),Vr[Xi*3+0]=er.x,Vr[Xi*3+1]=er.y,Vr[Xi*3+2]=er.z,Vr[Kr*3+0]=tr.x,Vr[Kr*3+1]=tr.y,Vr[Kr*3+2]=tr.z,Vr[$r*3+0]=ir.x,Vr[$r*3+1]=ir.y,Vr[$r*3+2]=ir.z}const dr=rr.geometry,hr=rr.material;let pr,gr,vr;const mr=dr.index,fr=dr.attributes.position,_r=dr.morphAttributes.position,Ar=dr.morphTargetsRelative,yr=dr.attributes.normal,wr=dr.morphAttributes.position,xr=dr.groups,Sr=dr.drawRange;let br,Cr,Ir,Rr,Pr,Dr,Fr;const Or=new Float32Array(fr.count*fr.itemSize),Nr=new Float32Array(yr.count*yr.itemSize);if(mr!==null)if(Array.isArray(hr))for(br=0,Ir=xr.length;br<Ir;br++)for(Pr=xr[br],Dr=Math.max(Pr.start,Sr.start),Fr=Math.min(Pr.start+Pr.count,Sr.start+Sr.count),Cr=Dr,Rr=Fr;Cr<Rr;Cr+=3)pr=mr.getX(Cr),gr=mr.getX(Cr+1),vr=mr.getX(Cr+2),ur(rr,fr,_r,Ar,pr,gr,vr,Or),ur(rr,yr,wr,Ar,pr,gr,vr,Nr);else for(Dr=Math.max(0,Sr.start),Fr=Math.min(mr.count,Sr.start+Sr.count),br=Dr,Ir=Fr;br<Ir;br+=3)pr=mr.getX(br),gr=mr.getX(br+1),vr=mr.getX(br+2),ur(rr,fr,_r,Ar,pr,gr,vr,Or),ur(rr,yr,wr,Ar,pr,gr,vr,Nr);else if(Array.isArray(hr))for(br=0,Ir=xr.length;br<Ir;br++)for(Pr=xr[br],Dr=Math.max(Pr.start,Sr.start),Fr=Math.min(Pr.start+Pr.count,Sr.start+Sr.count),Cr=Dr,Rr=Fr;Cr<Rr;Cr+=3)pr=Cr,gr=Cr+1,vr=Cr+2,ur(rr,fr,_r,Ar,pr,gr,vr,Or),ur(rr,yr,wr,Ar,pr,gr,vr,Nr);else for(Dr=Math.max(0,Sr.start),Fr=Math.min(fr.count,Sr.start+Sr.count),br=Dr,Ir=Fr;br<Ir;br+=3)pr=br,gr=br+1,vr=br+2,ur(rr,fr,_r,Ar,pr,gr,vr,Or),ur(rr,yr,wr,Ar,pr,gr,vr,Nr);const Ur=new Float32BufferAttribute(Or,3),Br=new Float32BufferAttribute(Nr,3);return{positionAttribute:fr,normalAttribute:yr,morphedPositionAttribute:Ur,morphedNormalAttribute:Br}}function mergeGroups(rr){if(rr.groups.length===0)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),rr;let er=rr.groups;if(er=er.sort((ar,or)=>ar.materialIndex!==or.materialIndex?ar.materialIndex-or.materialIndex:ar.start-or.start),rr.getIndex()===null){const ar=rr.getAttribute("position"),or=[];for(let lr=0;lr<ar.count;lr+=3)or.push(lr,lr+1,lr+2);rr.setIndex(or)}const tr=rr.getIndex(),ir=[];for(let ar=0;ar<er.length;ar++){const or=er[ar],lr=or.start,cr=lr+or.count;for(let ur=lr;ur<cr;ur++)ir.push(tr.getX(ur))}rr.dispose(),rr.setIndex(ir);let nr=0;for(let ar=0;ar<er.length;ar++){const or=er[ar];or.start=nr,nr+=or.count}let sr=er[0];rr.groups=[sr];for(let ar=1;ar<er.length;ar++){const or=er[ar];sr.materialIndex===or.materialIndex?sr.count+=or.count:(sr=or,rr.groups.push(sr))}return rr}function toCreasedNormals(rr,er=Math.PI/3){const tr=Math.cos(er),ir=(1+1e-10)*100,nr=[new Vector3$1,new Vector3$1,new Vector3$1],sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1;function cr(vr){const mr=~~(vr.x*ir),fr=~~(vr.y*ir),_r=~~(vr.z*ir);return`${mr},${fr},${_r}`}const ur=rr.index?rr.toNonIndexed():rr,dr=ur.attributes.position,hr={};for(let vr=0,mr=dr.count/3;vr<mr;vr++){const fr=3*vr,_r=nr[0].fromBufferAttribute(dr,fr+0),Ar=nr[1].fromBufferAttribute(dr,fr+1),yr=nr[2].fromBufferAttribute(dr,fr+2);sr.subVectors(yr,Ar),ar.subVectors(_r,Ar);const wr=new Vector3$1().crossVectors(sr,ar).normalize();for(let xr=0;xr<3;xr++){const Sr=nr[xr],br=cr(Sr);br in hr||(hr[br]=[]),hr[br].push(wr)}}const pr=new Float32Array(dr.count*3),gr=new BufferAttribute(pr,3,!1);for(let vr=0,mr=dr.count/3;vr<mr;vr++){const fr=3*vr,_r=nr[0].fromBufferAttribute(dr,fr+0),Ar=nr[1].fromBufferAttribute(dr,fr+1),yr=nr[2].fromBufferAttribute(dr,fr+2);sr.subVectors(yr,Ar),ar.subVectors(_r,Ar),or.crossVectors(sr,ar).normalize();for(let wr=0;wr<3;wr++){const xr=nr[wr],Sr=cr(xr),br=hr[Sr];lr.set(0,0,0);for(let Cr=0,Ir=br.length;Cr<Ir;Cr++){const Rr=br[Cr];or.dot(Rr)>tr&&lr.add(Rr)}lr.normalize(),gr.setXYZ(fr+wr,lr.x,lr.y,lr.z)}}return ur.setAttribute("normal",gr),ur}const BufferGeometryUtils$1=Object.freeze(Object.defineProperty({__proto__:null,computeMikkTSpaceTangents,computeMorphedAttributes,deepCloneAttribute,deinterleaveAttribute,deinterleaveGeometry,estimateBytesUsed,interleaveAttributes,mergeAttributes,mergeGeometries,mergeGroups,mergeVertices,toCreasedNormals,toTrianglesDrawMode},Symbol.toStringTag,{value:"Module"}));class TextureHelper extends Mesh{constructor(er,tr=1,ir=1,nr=1){const sr=new ShaderMaterial({type:"TextureHelperMaterial",side:DoubleSide,transparent:!0,uniforms:{map:{value:er},alpha:{value:getAlpha(er)}},vertexShader:["attribute vec3 uvw;","varying vec3 vUvw;","void main() {","	vUvw = uvw;","	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join(`
`),fragmentShader:["precision highp float;","precision highp sampler2DArray;","precision highp sampler3D;","uniform {samplerType} map;","uniform float alpha;","varying vec3 vUvw;","vec4 textureHelper( in sampler2D map ) { return texture( map, vUvw.xy ); }","vec4 textureHelper( in sampler2DArray map ) { return texture( map, vUvw ); }","vec4 textureHelper( in sampler3D map ) { return texture( map, vUvw ); }","vec4 textureHelper( in samplerCube map ) { return texture( map, vUvw ); }","void main() {","	gl_FragColor = linearToOutputTexel( vec4( textureHelper( map ).xyz, alpha ) );","}"].join(`
`).replace("{samplerType}",getSamplerType(er))}),ar=er.isCubeTexture?createCubeGeometry(tr,ir,nr):createSliceGeometry(er,tr,ir,nr);super(ar,sr),this.texture=er,this.type="TextureHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}function getSamplerType(rr){return rr.isCubeTexture?"samplerCube":rr.isDataArrayTexture||rr.isCompressedArrayTexture?"sampler2DArray":rr.isData3DTexture||rr.isCompressed3DTexture?"sampler3D":"sampler2D"}function getImageCount(rr){return rr.isCubeTexture?6:rr.isDataArrayTexture||rr.isCompressedArrayTexture||rr.isData3DTexture||rr.isCompressed3DTexture?rr.image.depth:1}function getAlpha(rr){return rr.isCubeTexture?1:rr.isDataArrayTexture||rr.isCompressedArrayTexture||rr.isData3DTexture||rr.isCompressed3DTexture?Math.max(1/rr.image.depth,.25):1}function createCubeGeometry(rr,er,tr){const ir=new BoxGeometry(rr,er,tr),nr=ir.attributes.position,sr=ir.attributes.uv,ar=new BufferAttribute(new Float32Array(sr.count*3),3),or=new Vector3$1;for(let lr=0,cr=sr.count;lr<cr;++lr){or.fromBufferAttribute(nr,lr).normalize();const ur=or.x,dr=or.y,hr=or.z;ar.setXYZ(lr,ur,dr,hr)}return ir.deleteAttribute("uv"),ir.setAttribute("uvw",ar),ir}function createSliceGeometry(rr,er,tr,ir){const nr=getImageCount(rr),sr=[];for(let ar=0;ar<nr;++ar){const or=new PlaneGeometry(er,tr);nr>1&&or.translate(0,0,ir*(ar/(nr-1)-.5));const lr=or.attributes.uv,cr=new BufferAttribute(new Float32Array(lr.count*3),3);for(let ur=0,dr=lr.count;ur<dr;++ur){const hr=lr.getX(ur),pr=rr.flipY?lr.getY(ur):1-lr.getY(ur),gr=nr===1?1:rr.isDataArrayTexture||rr.isCompressedArrayTexture?ar:ar/(nr-1);cr.setXYZ(ur,hr,pr,gr)}or.deleteAttribute("uv"),or.setAttribute("uvw",cr),sr.push(or)}return mergeGeometries(sr)}const _v1$3=new Vector3$1,_v2$2=new Vector3$1,_normalMatrix=new Matrix3;class VertexNormalsHelper extends LineSegments{constructor(er,tr=1,ir=16711680){const nr=new BufferGeometry,sr=er.geometry.attributes.normal.count,ar=new Float32BufferAttribute(sr*2*3,3);nr.setAttribute("position",ar),super(nr,new LineBasicMaterial({color:ir,toneMapped:!1})),this.object=er,this.size=tr,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0),_normalMatrix.getNormalMatrix(this.object.matrixWorld);const er=this.object.matrixWorld,tr=this.geometry.attributes.position,ir=this.object.geometry;if(ir){const nr=ir.attributes.position,sr=ir.attributes.normal;let ar=0;for(let or=0,lr=nr.count;or<lr;or++)_v1$3.fromBufferAttribute(nr,or).applyMatrix4(er),_v2$2.fromBufferAttribute(sr,or),_v2$2.applyMatrix3(_normalMatrix).normalize().multiplyScalar(this.size).add(_v1$3),tr.setXYZ(ar,_v1$3.x,_v1$3.y,_v1$3.z),ar=ar+1,tr.setXYZ(ar,_v2$2.x,_v2$2.y,_v2$2.z),ar=ar+1}tr.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}const _v1$2=new Vector3$1,_v2$1=new Vector3$1;class VertexTangentsHelper extends LineSegments{constructor(er,tr=1,ir=65535){const nr=new BufferGeometry,sr=er.geometry.attributes.tangent.count,ar=new Float32BufferAttribute(sr*2*3,3);nr.setAttribute("position",ar),super(nr,new LineBasicMaterial({color:ir,toneMapped:!1})),this.object=er,this.size=tr,this.type="VertexTangentsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);const er=this.object.matrixWorld,tr=this.geometry.attributes.position,ir=this.object.geometry,nr=ir.attributes.position,sr=ir.attributes.tangent;let ar=0;for(let or=0,lr=nr.count;or<lr;or++)_v1$2.fromBufferAttribute(nr,or).applyMatrix4(er),_v2$1.fromBufferAttribute(sr,or),_v2$1.transformDirection(er).multiplyScalar(this.size).add(_v1$2),tr.setXYZ(ar,_v1$2.x,_v1$2.y,_v1$2.z),ar=ar+1,tr.setXYZ(ar,_v2$1.x,_v2$1.y,_v2$1.z),ar=ar+1;tr.needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}class ViewHelper extends Object3D{constructor(er,tr){super(),this.isViewHelper=!0,this.animating=!1,this.center=new Vector3$1;const ir=new Color("#ff4466"),nr=new Color("#88ff44"),sr=new Color("#4488ff"),ar=new Color("#000000"),or={},lr=[],cr=new Raycaster,ur=new Vector2,dr=new Object3D,hr=new OrthographicCamera(-2,2,2,-2,0,4);hr.position.set(0,0,2);const pr=new CylinderGeometry(.04,.04,.8,5).rotateZ(-Math.PI/2).translate(.4,0,0),gr=new Mesh(pr,Yr(ir)),vr=new Mesh(pr,Yr(nr)),mr=new Mesh(pr,Yr(sr));vr.rotation.z=Math.PI/2,mr.rotation.y=-Math.PI/2,this.add(gr),this.add(mr),this.add(vr);const fr=Qi(ir),_r=Qi(nr),Ar=Qi(sr),yr=Qi(ar),wr=new Sprite(fr),xr=new Sprite(_r),Sr=new Sprite(Ar),br=new Sprite(yr),Cr=new Sprite(yr),Ir=new Sprite(yr);wr.position.x=1,xr.position.y=1,Sr.position.z=1,br.position.x=-1,Cr.position.y=-1,Ir.position.z=-1,br.material.opacity=.2,Cr.material.opacity=.2,Ir.material.opacity=.2,wr.userData.type="posX",xr.userData.type="posY",Sr.userData.type="posZ",br.userData.type="negX",Cr.userData.type="negY",Ir.userData.type="negZ",this.add(wr),this.add(xr),this.add(Sr),this.add(br),this.add(Cr),this.add(Ir),lr.push(wr),lr.push(xr),lr.push(Sr),lr.push(br),lr.push(Cr),lr.push(Ir);const Rr=new Vector3$1,Pr=128,Dr=2*Math.PI;this.render=function(Kr){this.quaternion.copy(er.quaternion).invert(),this.updateMatrixWorld(),Rr.set(0,0,1),Rr.applyQuaternion(er.quaternion);const $r=tr.offsetWidth-Pr;Kr.clearDepth(),Kr.getViewport(Br),Kr.setViewport($r,0,Pr,Pr),Kr.render(this,hr),Kr.setViewport(Br.x,Br.y,Br.z,Br.w)};const Fr=new Vector3$1,Or=new Quaternion$1,Nr=new Quaternion$1,Ur=new Quaternion$1,Br=new Vector4;let Wr=0;this.handleClick=function(Kr){if(this.animating===!0)return!1;const $r=tr.getBoundingClientRect(),Vr=$r.left+(tr.offsetWidth-Pr),Gr=$r.top+(tr.offsetHeight-Pr);ur.x=(Kr.clientX-Vr)/($r.right-Vr)*2-1,ur.y=-((Kr.clientY-Gr)/($r.bottom-Gr))*2+1,cr.setFromCamera(ur,hr);const qr=cr.intersectObjects(lr);if(qr.length>0){const Jr=qr[0].object;return Xr(Jr,this.center),this.animating=!0,!0}else return!1},this.setLabels=function(Kr,$r,Vr){or.labelX=Kr,or.labelY=$r,or.labelZ=Vr,Xi()},this.setLabelStyle=function(Kr,$r,Vr){or.font=Kr,or.color=$r,or.radius=Vr,Xi()},this.update=function(Kr){const $r=Kr*Dr;Nr.rotateTowards(Ur,$r),er.position.set(0,0,1).applyQuaternion(Nr).multiplyScalar(Wr).add(this.center),er.quaternion.rotateTowards(Or,$r),Nr.angleTo(Ur)===0&&(this.animating=!1)},this.dispose=function(){pr.dispose(),gr.material.dispose(),vr.material.dispose(),mr.material.dispose(),wr.material.map.dispose(),xr.material.map.dispose(),Sr.material.map.dispose(),br.material.map.dispose(),Cr.material.map.dispose(),Ir.material.map.dispose(),wr.material.dispose(),xr.material.dispose(),Sr.material.dispose(),br.material.dispose(),Cr.material.dispose(),Ir.material.dispose()};function Xr(Kr,$r){switch(Kr.userData.type){case"posX":Fr.set(1,0,0),Or.setFromEuler(new Euler(0,Math.PI*.5,0));break;case"posY":Fr.set(0,1,0),Or.setFromEuler(new Euler(-Math.PI*.5,0,0));break;case"posZ":Fr.set(0,0,1),Or.setFromEuler(new Euler);break;case"negX":Fr.set(-1,0,0),Or.setFromEuler(new Euler(0,-Math.PI*.5,0));break;case"negY":Fr.set(0,-1,0),Or.setFromEuler(new Euler(Math.PI*.5,0,0));break;case"negZ":Fr.set(0,0,-1),Or.setFromEuler(new Euler(0,Math.PI,0));break;default:console.error("ViewHelper: Invalid axis.")}Wr=er.position.distanceTo($r),Fr.multiplyScalar(Wr).add($r),dr.position.copy($r),dr.lookAt(er.position),Nr.copy(dr.quaternion),dr.lookAt(Fr),Ur.copy(dr.quaternion)}function Yr(Kr){return new MeshBasicMaterial({color:Kr,toneMapped:!1})}function Qi(Kr,$r){const{font:Vr="24px Arial",color:Gr="#000000",radius:qr=14}=or,ji=document.createElement("canvas");ji.width=64,ji.height=64;const Jr=ji.getContext("2d");Jr.beginPath(),Jr.arc(32,32,qr,0,2*Math.PI),Jr.closePath(),Jr.fillStyle=Kr.getStyle(),Jr.fill(),$r&&(Jr.font=Vr,Jr.textAlign="center",Jr.fillStyle=Gr,Jr.fillText($r,32,41));const Ji=new CanvasTexture(ji);return Ji.colorSpace=SRGBColorSpace,new SpriteMaterial({map:Ji,toneMapped:!1})}function Xi(){wr.material.map.dispose(),xr.material.map.dispose(),Sr.material.map.dispose(),wr.material.dispose(),xr.material.dispose(),Sr.material.dispose(),wr.material=Qi(ir,or.labelX),xr.material=Qi(nr,or.labelY),Sr.material=Qi(sr,or.labelZ)}}}class HTMLMesh extends Mesh{constructor(er){const tr=new HTMLTexture(er),ir=new PlaneGeometry(tr.image.width*.001,tr.image.height*.001),nr=new MeshBasicMaterial({map:tr,toneMapped:!1,transparent:!0});super(ir,nr);function sr(ar){nr.map.dispatchDOMEvent(ar)}this.addEventListener("mousedown",sr),this.addEventListener("mousemove",sr),this.addEventListener("mouseup",sr),this.addEventListener("click",sr),this.dispose=function(){ir.dispose(),nr.dispose(),nr.map.dispose(),canvases.delete(er),this.removeEventListener("mousedown",sr),this.removeEventListener("mousemove",sr),this.removeEventListener("mouseup",sr),this.removeEventListener("click",sr)}}}class HTMLTexture extends CanvasTexture{constructor(er){super(html2canvas(er)),this.dom=er,this.anisotropy=16,this.colorSpace=SRGBColorSpace,this.minFilter=LinearFilter,this.magFilter=LinearFilter,this.generateMipmaps=!1;const tr=new MutationObserver(()=>{this.scheduleUpdate||(this.scheduleUpdate=setTimeout(()=>this.update(),16))}),ir={attributes:!0,childList:!0,subtree:!0,characterData:!0};tr.observe(er,ir),this.observer=tr}dispatchDOMEvent(er){er.data&&htmlevent(this.dom,er.type,er.data.x,er.data.y)}update(){this.image=html2canvas(this.dom),this.needsUpdate=!0,this.scheduleUpdate=null}dispose(){this.observer&&this.observer.disconnect(),this.scheduleUpdate=clearTimeout(this.scheduleUpdate),super.dispose()}}const canvases=new WeakMap;function html2canvas(rr){const er=document.createRange(),tr=new Color;function ir(hr){const pr=[];let gr=!1;function vr(){if(gr&&(gr=!1,hr.restore()),pr.length===0)return;let mr=-1/0,fr=-1/0,_r=1/0,Ar=1/0;for(let yr=0;yr<pr.length;yr++){const wr=pr[yr];mr=Math.max(mr,wr.x),fr=Math.max(fr,wr.y),_r=Math.min(_r,wr.x+wr.width),Ar=Math.min(Ar,wr.y+wr.height)}hr.save(),hr.beginPath(),hr.rect(mr,fr,_r-mr,Ar-fr),hr.clip(),gr=!0}return{add:function(mr){pr.push(mr),vr()},remove:function(){pr.pop(),vr()}}}function nr(hr,pr,gr,vr){vr!==""&&(hr.textTransform==="uppercase"&&(vr=vr.toUpperCase()),ur.font=hr.fontWeight+" "+hr.fontSize+" "+hr.fontFamily,ur.textBaseline="top",ur.fillStyle=hr.color,ur.fillText(vr,pr,gr+parseFloat(hr.fontSize)*.1))}function sr(hr,pr,gr,vr,mr){gr<2*mr&&(mr=gr/2),vr<2*mr&&(mr=vr/2),ur.beginPath(),ur.moveTo(hr+mr,pr),ur.arcTo(hr+gr,pr,hr+gr,pr+vr,mr),ur.arcTo(hr+gr,pr+vr,hr,pr+vr,mr),ur.arcTo(hr,pr+vr,hr,pr,mr),ur.arcTo(hr,pr,hr+gr,pr,mr),ur.closePath()}function ar(hr,pr,gr,vr,mr,fr){const _r=hr[pr+"Width"],Ar=hr[pr+"Style"],yr=hr[pr+"Color"];_r!=="0px"&&Ar!=="none"&&yr!=="transparent"&&yr!=="rgba(0, 0, 0, 0)"&&(ur.strokeStyle=yr,ur.lineWidth=parseFloat(_r),ur.beginPath(),ur.moveTo(gr,vr),ur.lineTo(gr+mr,vr+fr),ur.stroke())}function or(hr,pr){if(hr.nodeType===Node.COMMENT_NODE||hr.nodeName==="SCRIPT"||hr.style&&hr.style.display==="none")return;let gr=0,vr=0,mr=0,fr=0;if(hr.nodeType===Node.TEXT_NODE){er.selectNode(hr);const Ar=er.getBoundingClientRect();gr=Ar.left-lr.left-.5,vr=Ar.top-lr.top-.5,mr=Ar.width,fr=Ar.height,nr(pr,gr,vr,hr.nodeValue.trim())}else if(hr instanceof HTMLCanvasElement){const Ar=hr.getBoundingClientRect();gr=Ar.left-lr.left-.5,vr=Ar.top-lr.top-.5,ur.save();const yr=window.devicePixelRatio;ur.scale(1/yr,1/yr),ur.drawImage(hr,gr,vr),ur.restore()}else if(hr instanceof HTMLImageElement){const Ar=hr.getBoundingClientRect();gr=Ar.left-lr.left-.5,vr=Ar.top-lr.top-.5,mr=Ar.width,fr=Ar.height,ur.drawImage(hr,gr,vr,mr,fr)}else{const Ar=hr.getBoundingClientRect();gr=Ar.left-lr.left-.5,vr=Ar.top-lr.top-.5,mr=Ar.width,fr=Ar.height,pr=window.getComputedStyle(hr),sr(gr,vr,mr,fr,parseFloat(pr.borderRadius));const yr=pr.backgroundColor;yr!=="transparent"&&yr!=="rgba(0, 0, 0, 0)"&&(ur.fillStyle=yr,ur.fill());const wr=["borderTop","borderLeft","borderBottom","borderRight"];let xr=!0,Sr=null;for(const br of wr){if(Sr!==null&&(xr=pr[br+"Width"]===pr[Sr+"Width"]&&pr[br+"Color"]===pr[Sr+"Color"]&&pr[br+"Style"]===pr[Sr+"Style"]),xr===!1)break;Sr=br}if(xr===!0){const br=parseFloat(pr.borderTopWidth);pr.borderTopWidth!=="0px"&&pr.borderTopStyle!=="none"&&pr.borderTopColor!=="transparent"&&pr.borderTopColor!=="rgba(0, 0, 0, 0)"&&(ur.strokeStyle=pr.borderTopColor,ur.lineWidth=br,ur.stroke())}else ar(pr,"borderTop",gr,vr,mr,0),ar(pr,"borderLeft",gr,vr,0,fr),ar(pr,"borderBottom",gr,vr+fr,mr,0),ar(pr,"borderRight",gr+mr,vr,0,fr);if(hr instanceof HTMLInputElement){let br=pr.accentColor;(br===void 0||br==="auto")&&(br=pr.color),tr.set(br);const Ir=Math.sqrt(.299*tr.r**2+.587*tr.g**2+.114*tr.b**2)<.5?"white":"#111111";if(hr.type==="radio"&&(sr(gr,vr,mr,fr,fr),ur.fillStyle="white",ur.strokeStyle=br,ur.lineWidth=1,ur.fill(),ur.stroke(),hr.checked&&(sr(gr+2,vr+2,mr-4,fr-4,fr),ur.fillStyle=br,ur.strokeStyle=Ir,ur.lineWidth=2,ur.fill(),ur.stroke())),hr.type==="checkbox"&&(sr(gr,vr,mr,fr,2),ur.fillStyle=hr.checked?br:"white",ur.strokeStyle=hr.checked?Ir:br,ur.lineWidth=1,ur.stroke(),ur.fill(),hr.checked)){const Rr=ur.textAlign;ur.textAlign="center";const Pr={color:Ir,fontFamily:pr.fontFamily,fontSize:fr+"px",fontWeight:"bold"};nr(Pr,gr+mr/2,vr,""),ur.textAlign=Rr}if(hr.type==="range"){const[Rr,Pr,Dr]=["min","max","value"].map(Or=>parseFloat(hr[Or])),Fr=(Dr-Rr)/(Pr-Rr)*(mr-fr);sr(gr,vr+fr/4,mr,fr/2,fr/4),ur.fillStyle=Ir,ur.strokeStyle=br,ur.lineWidth=1,ur.fill(),ur.stroke(),sr(gr,vr+fr/4,Fr+fr/2,fr/2,fr/4),ur.fillStyle=br,ur.fill(),sr(gr+Fr,vr,fr,fr,fr/2),ur.fillStyle=br,ur.fill()}(hr.type==="color"||hr.type==="text"||hr.type==="number")&&(dr.add({x:gr,y:vr,width:mr,height:fr}),nr(pr,gr+parseInt(pr.paddingLeft),vr+parseInt(pr.paddingTop),hr.value),dr.remove())}}const _r=pr.overflow==="auto"||pr.overflow==="hidden";_r&&dr.add({x:gr,y:vr,width:mr,height:fr});for(let Ar=0;Ar<hr.childNodes.length;Ar++)or(hr.childNodes[Ar],pr);_r&&dr.remove()}const lr=rr.getBoundingClientRect();let cr=canvases.get(rr);cr===void 0&&(cr=document.createElement("canvas"),cr.width=lr.width,cr.height=lr.height,canvases.set(rr,cr));const ur=cr.getContext("2d"),dr=new ir(ur);return ur.clearRect(0,0,cr.width,cr.height),or(rr),cr}function htmlevent(rr,er,tr,ir){const nr={clientX:tr*rr.offsetWidth+rr.offsetLeft,clientY:ir*rr.offsetHeight+rr.offsetTop,view:rr.ownerDocument.defaultView};window.dispatchEvent(new MouseEvent(er,nr));const sr=rr.getBoundingClientRect();tr=tr*sr.width+sr.left,ir=ir*sr.height+sr.top;function ar(or){if(or.nodeType!==Node.TEXT_NODE&&or.nodeType!==Node.COMMENT_NODE){const lr=or.getBoundingClientRect();if(tr>lr.left&&tr<lr.right&&ir>lr.top&&ir<lr.bottom&&(or.dispatchEvent(new MouseEvent(er,nr)),or instanceof HTMLInputElement&&or.type==="range"&&(er==="mousedown"||er==="click"))){const[cr,ur]=["min","max"].map(gr=>parseFloat(or[gr])),dr=lr.width,pr=(tr-lr.x)/dr;or.value=cr+(ur-cr)*pr,or.dispatchEvent(new InputEvent("input",{bubbles:!0}))}for(let cr=0;cr<or.childNodes.length;cr++)ar(or.childNodes[cr])}}ar(rr)}const _pointer=new Vector2,_event={type:"",data:_pointer},_raycaster=new Raycaster;class InteractiveGroup extends Group{listenToPointerEvents(er,tr){const ir=this,nr=new Raycaster,sr=er.domElement;function ar(or){or.stopPropagation();const lr=er.domElement.getBoundingClientRect();_pointer.x=(or.clientX-lr.left)/lr.width*2-1,_pointer.y=-(or.clientY-lr.top)/lr.height*2+1,nr.setFromCamera(_pointer,tr);const cr=nr.intersectObjects(ir.children,!1);if(cr.length>0){const ur=cr[0],dr=ur.object,hr=ur.uv;_event.type=or.type,_event.data.set(hr.x,1-hr.y),dr.dispatchEvent(_event)}}sr.addEventListener("pointerdown",ar),sr.addEventListener("pointerup",ar),sr.addEventListener("pointermove",ar),sr.addEventListener("mousedown",ar),sr.addEventListener("mouseup",ar),sr.addEventListener("mousemove",ar),sr.addEventListener("click",ar)}listenToXRControllerEvents(er){const tr=this,ir={move:"mousemove",select:"click",selectstart:"mousedown",selectend:"mouseup"};function nr(sr){const ar=sr.target;_raycaster.setFromXRController(ar);const or=_raycaster.intersectObjects(tr.children,!1);if(or.length>0){const lr=or[0],cr=lr.object,ur=lr.uv;_event.type=ir[sr.type],_event.data.set(ur.x,1-ur.y),cr.dispatchEvent(_event)}}er.addEventListener("move",nr),er.addEventListener("select",nr),er.addEventListener("selectstart",nr),er.addEventListener("selectend",nr)}}const _frustum=new Frustum,_center=new Vector3$1,_tmpPoint=new Vector3$1,_vecNear=new Vector3$1,_vecTopLeft=new Vector3$1,_vecTopRight=new Vector3$1,_vecDownRight=new Vector3$1,_vecDownLeft=new Vector3$1,_vecFarTopLeft=new Vector3$1,_vecFarTopRight=new Vector3$1,_vecFarDownRight=new Vector3$1,_vecFarDownLeft=new Vector3$1,_vectemp1=new Vector3$1,_vectemp2=new Vector3$1,_vectemp3=new Vector3$1,_matrix$4=new Matrix4,_quaternion$1=new Quaternion$1,_scale$2=new Vector3$1;class SelectionBox{constructor(er,tr,ir=Number.MAX_VALUE){this.camera=er,this.scene=tr,this.startPoint=new Vector3$1,this.endPoint=new Vector3$1,this.collection=[],this.instances={},this.deep=ir}select(er,tr){return this.startPoint=er||this.startPoint,this.endPoint=tr||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(_frustum,this.scene),this.collection}updateFrustum(er,tr){if(er=er||this.startPoint,tr=tr||this.endPoint,er.x===tr.x&&(tr.x+=Number.EPSILON),er.y===tr.y&&(tr.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){_tmpPoint.copy(er),_tmpPoint.x=Math.min(er.x,tr.x),_tmpPoint.y=Math.max(er.y,tr.y),tr.x=Math.max(er.x,tr.x),tr.y=Math.min(er.y,tr.y),_vecNear.setFromMatrixPosition(this.camera.matrixWorld),_vecTopLeft.copy(_tmpPoint),_vecTopRight.set(tr.x,_tmpPoint.y,0),_vecDownRight.copy(tr),_vecDownLeft.set(_tmpPoint.x,tr.y,0),_vecTopLeft.unproject(this.camera),_vecTopRight.unproject(this.camera),_vecDownRight.unproject(this.camera),_vecDownLeft.unproject(this.camera),_vectemp1.copy(_vecTopLeft).sub(_vecNear),_vectemp2.copy(_vecTopRight).sub(_vecNear),_vectemp3.copy(_vecDownRight).sub(_vecNear),_vectemp1.normalize(),_vectemp2.normalize(),_vectemp3.normalize(),_vectemp1.multiplyScalar(this.deep),_vectemp2.multiplyScalar(this.deep),_vectemp3.multiplyScalar(this.deep),_vectemp1.add(_vecNear),_vectemp2.add(_vecNear),_vectemp3.add(_vecNear);const ir=_frustum.planes;ir[0].setFromCoplanarPoints(_vecNear,_vecTopLeft,_vecTopRight),ir[1].setFromCoplanarPoints(_vecNear,_vecTopRight,_vecDownRight),ir[2].setFromCoplanarPoints(_vecDownRight,_vecDownLeft,_vecNear),ir[3].setFromCoplanarPoints(_vecDownLeft,_vecTopLeft,_vecNear),ir[4].setFromCoplanarPoints(_vecTopRight,_vecDownRight,_vecDownLeft),ir[5].setFromCoplanarPoints(_vectemp3,_vectemp2,_vectemp1),ir[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){const ir=Math.min(er.x,tr.x),nr=Math.max(er.y,tr.y),sr=Math.max(er.x,tr.x),ar=Math.min(er.y,tr.y);_vecTopLeft.set(ir,nr,-1),_vecTopRight.set(sr,nr,-1),_vecDownRight.set(sr,ar,-1),_vecDownLeft.set(ir,ar,-1),_vecFarTopLeft.set(ir,nr,1),_vecFarTopRight.set(sr,nr,1),_vecFarDownRight.set(sr,ar,1),_vecFarDownLeft.set(ir,ar,1),_vecTopLeft.unproject(this.camera),_vecTopRight.unproject(this.camera),_vecDownRight.unproject(this.camera),_vecDownLeft.unproject(this.camera),_vecFarTopLeft.unproject(this.camera),_vecFarTopRight.unproject(this.camera),_vecFarDownRight.unproject(this.camera),_vecFarDownLeft.unproject(this.camera);const or=_frustum.planes;or[0].setFromCoplanarPoints(_vecTopLeft,_vecFarTopLeft,_vecFarTopRight),or[1].setFromCoplanarPoints(_vecTopRight,_vecFarTopRight,_vecFarDownRight),or[2].setFromCoplanarPoints(_vecFarDownRight,_vecFarDownLeft,_vecDownLeft),or[3].setFromCoplanarPoints(_vecFarDownLeft,_vecFarTopLeft,_vecTopLeft),or[4].setFromCoplanarPoints(_vecTopRight,_vecDownRight,_vecDownLeft),or[5].setFromCoplanarPoints(_vecFarDownRight,_vecFarTopRight,_vecFarTopLeft),or[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(er,tr){if(tr.isMesh||tr.isLine||tr.isPoints)if(tr.isInstancedMesh){this.instances[tr.uuid]=[];for(let ir=0;ir<tr.count;ir++)tr.getMatrixAt(ir,_matrix$4),_matrix$4.decompose(_center,_quaternion$1,_scale$2),_center.applyMatrix4(tr.matrixWorld),er.containsPoint(_center)&&this.instances[tr.uuid].push(ir)}else tr.geometry.boundingSphere===null&&tr.geometry.computeBoundingSphere(),_center.copy(tr.geometry.boundingSphere.center),_center.applyMatrix4(tr.matrixWorld),er.containsPoint(_center)&&this.collection.push(tr);if(tr.children.length>0)for(let ir=0;ir<tr.children.length;ir++)this.searchChildInFrustum(er,tr.children[ir])}}class SelectionHelper{constructor(er,tr){this.element=document.createElement("div"),this.element.classList.add(tr),this.element.style.pointerEvents="none",this.renderer=er,this.startPoint=new Vector2,this.pointTopLeft=new Vector2,this.pointBottomRight=new Vector2,this.isDown=!1,this.enabled=!0,this.onPointerDown=function(ir){this.enabled!==!1&&(this.isDown=!0,this.onSelectStart(ir))}.bind(this),this.onPointerMove=function(ir){this.enabled!==!1&&this.isDown&&this.onSelectMove(ir)}.bind(this),this.onPointerUp=function(){this.enabled!==!1&&(this.isDown=!1,this.onSelectOver())}.bind(this),this.renderer.domElement.addEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.addEventListener("pointermove",this.onPointerMove),this.renderer.domElement.addEventListener("pointerup",this.onPointerUp)}dispose(){this.renderer.domElement.removeEventListener("pointerdown",this.onPointerDown),this.renderer.domElement.removeEventListener("pointermove",this.onPointerMove),this.renderer.domElement.removeEventListener("pointerup",this.onPointerUp)}onSelectStart(er){this.element.style.display="none",this.renderer.domElement.parentElement.appendChild(this.element),this.element.style.left=er.clientX+"px",this.element.style.top=er.clientY+"px",this.element.style.width="0px",this.element.style.height="0px",this.startPoint.x=er.clientX,this.startPoint.y=er.clientY}onSelectMove(er){this.element.style.display="block",this.pointBottomRight.x=Math.max(this.startPoint.x,er.clientX),this.pointBottomRight.y=Math.max(this.startPoint.y,er.clientY),this.pointTopLeft.x=Math.min(this.startPoint.x,er.clientX),this.pointTopLeft.y=Math.min(this.startPoint.y,er.clientY),this.element.style.left=this.pointTopLeft.x+"px",this.element.style.top=this.pointTopLeft.y+"px",this.element.style.width=this.pointBottomRight.x-this.pointTopLeft.x+"px",this.element.style.height=this.pointBottomRight.y-this.pointTopLeft.y+"px"}onSelectOver(){this.element.parentElement.removeChild(this.element)}}class LightProbeGenerator{static fromCubeTexture(er){let tr=0;const ir=new Vector3$1,nr=new Vector3$1,sr=new Color,ar=[0,0,0,0,0,0,0,0,0],or=new SphericalHarmonics3,lr=or.coefficients;for(let ur=0;ur<6;ur++){const dr=er.image[ur],hr=dr.width,pr=dr.height,gr=document.createElement("canvas");gr.width=hr,gr.height=pr;const vr=gr.getContext("2d");vr.drawImage(dr,0,0,hr,pr);const mr=vr.getImageData(0,0,hr,pr),fr=mr.data,_r=mr.width,Ar=2/_r;for(let yr=0,wr=fr.length;yr<wr;yr+=4){sr.setRGB(fr[yr]/255,fr[yr+1]/255,fr[yr+2]/255),convertColorToLinear(sr,er.colorSpace);const xr=yr/4,Sr=-1+(xr%_r+.5)*Ar,br=1-(Math.floor(xr/_r)+.5)*Ar;switch(ur){case 0:ir.set(-1,br,-Sr);break;case 1:ir.set(1,br,Sr);break;case 2:ir.set(-Sr,1,-br);break;case 3:ir.set(-Sr,-1,br);break;case 4:ir.set(-Sr,br,1);break;case 5:ir.set(Sr,br,-1);break}const Cr=ir.lengthSq(),Ir=4/(Math.sqrt(Cr)*Cr);tr+=Ir,nr.copy(ir).normalize(),SphericalHarmonics3.getBasisAt(nr,ar);for(let Rr=0;Rr<9;Rr++)lr[Rr].x+=ar[Rr]*sr.r*Ir,lr[Rr].y+=ar[Rr]*sr.g*Ir,lr[Rr].z+=ar[Rr]*sr.b*Ir}}const cr=4*Math.PI/tr;for(let ur=0;ur<9;ur++)lr[ur].x*=cr,lr[ur].y*=cr,lr[ur].z*=cr;return new LightProbe(or)}static async fromCubeRenderTarget(er,tr){const ir=er.coordinateSystem===WebGLCoordinateSystem?-1:1;let nr=0;const sr=new Vector3$1,ar=new Vector3$1,or=new Color,lr=[0,0,0,0,0,0,0,0,0],cr=new SphericalHarmonics3,ur=cr.coefficients,dr=tr.texture.type,hr=tr.width;let pr;er.isWebGLRenderer&&(dr===HalfFloatType?pr=new Uint16Array(hr*hr*4):pr=new Uint8Array(hr*hr*4));for(let vr=0;vr<6;vr++){er.isWebGLRenderer?await er.readRenderTargetPixelsAsync(tr,0,0,hr,hr,pr,vr):pr=await er.readRenderTargetPixelsAsync(tr,0,0,hr,hr,0,vr);const mr=2/hr;for(let fr=0,_r=pr.length;fr<_r;fr+=4){let Ar,yr,wr;dr===HalfFloatType?(Ar=DataUtils.fromHalfFloat(pr[fr]),yr=DataUtils.fromHalfFloat(pr[fr+1]),wr=DataUtils.fromHalfFloat(pr[fr+2])):(Ar=pr[fr]/255,yr=pr[fr+1]/255,wr=pr[fr+2]/255),or.setRGB(Ar,yr,wr),convertColorToLinear(or,tr.texture.colorSpace);const xr=fr/4,Sr=(1-(xr%hr+.5)*mr)*ir,br=1-(Math.floor(xr/hr)+.5)*mr;switch(vr){case 0:sr.set(-1*ir,br,Sr*ir);break;case 1:sr.set(1*ir,br,-Sr*ir);break;case 2:sr.set(Sr,1,-br);break;case 3:sr.set(Sr,-1,br);break;case 4:sr.set(Sr,br,1);break;case 5:sr.set(-Sr,br,-1);break}const Cr=sr.lengthSq(),Ir=4/(Math.sqrt(Cr)*Cr);nr+=Ir,ar.copy(sr).normalize(),SphericalHarmonics3.getBasisAt(ar,lr);for(let Rr=0;Rr<9;Rr++)ur[Rr].x+=lr[Rr]*or.r*Ir,ur[Rr].y+=lr[Rr]*or.g*Ir,ur[Rr].z+=lr[Rr]*or.b*Ir}}const gr=4*Math.PI/nr;for(let vr=0;vr<9;vr++)ur[vr].x*=gr,ur[vr].y*=gr,ur[vr].z*=gr;return new LightProbe(cr)}}function convertColorToLinear(rr,er){switch(er){case SRGBColorSpace:rr.convertSRGBToLinear();break;case LinearSRGBColorSpace:case NoColorSpace:break;default:console.warn("WARNING: LightProbeGenerator convertColorToLinear() encountered an unsupported color space.");break}return rr}class RectAreaLightTexturesLib{static init(){const er=[1,0,0,2e-5,1,0,0,503905e-9,1,0,0,.00201562,1,0,0,.00453516,1,0,0,.00806253,1,0,0,.0125978,1,0,0,.018141,1,0,0,.0246924,1,0,0,.0322525,1,0,0,.0408213,1,0,0,.0503999,1,0,0,.0609894,1,0,0,.0725906,1,0,0,.0852058,1,0,0,.0988363,1,0,0,.113484,1,0,0,.129153,1,0,0,.145839,1,0,0,.163548,1,0,0,.182266,1,0,0,.201942,1,0,0,.222314,1,0,0,.241906,1,0,0,.262314,1,0,0,.285754,1,0,0,.310159,1,0,0,.335426,1,0,0,.361341,1,0,0,.387445,1,0,0,.412784,1,0,0,.438197,1,0,0,.466966,1,0,0,.49559,1,0,0,.523448,1,0,0,.549938,1,0,0,.57979,1,0,0,.608746,1,0,0,.636185,1,0,0,.664748,1,0,0,.69313,1,0,0,.71966,1,0,0,.747662,1,0,0,.774023,1,0,0,.799775,1,0,0,.825274,1,0,0,.849156,1,0,0,.873248,1,0,0,.89532,1,0,0,.917565,1,0,0,.937863,1,0,0,.958139,1,0,0,.976563,1,0,0,.994658,1,0,0,1.0112,1,0,0,1.02712,1,0,0,1.04189,1,0,0,1.05568,1,0,0,1.06877,1,0,0,1.08058,1,0,0,1.09194,1,0,0,1.10191,1,0,0,1.11161,1,0,0,1.1199,1,0,0,1.12813,.999547,-448815e-12,.0224417,199902e-10,.999495,-113079e-10,.0224406,503651e-9,.999496,-452317e-10,.0224406,.00201461,.999496,-101772e-9,.0224406,.00453287,.999495,-180928e-9,.0224406,.00805845,.999497,-282702e-9,.0224406,.0125914,.999496,-407096e-9,.0224406,.0181319,.999498,-554114e-9,.0224406,.02468,.999499,-723768e-9,.0224406,.0322363,.999495,-916058e-9,.0224405,.0408009,.999499,-.00113101,.0224408,.050375,.999494,-.00136863,.0224405,.0609586,.999489,-.00162896,.0224401,.0725537,.999489,-.00191201,.0224414,.0851619,.999498,-.00221787,.0224413,.0987867,.999492,-.00254642,.0224409,.113426,.999507,-.00289779,.0224417,.129088,.999494,-.0032716,.0224386,.145767,.999546,-.0036673,.0224424,.163472,.999543,-.00408166,.0224387,.182182,.999499,-.00450056,.0224338,.201843,.999503,-.00483661,.0224203,.222198,.999546,-.00452928,.022315,.241714,.999508,-.00587403,.0224329,.262184,.999509,-.00638806,.0224271,.285609,.999501,-.00691028,.0224166,.309998,.999539,-.00741979,.0223989,.335262,.999454,-.00786282,.0223675,.361154,.999529,-.00811928,.0222828,.387224,.999503,-.00799941,.0221063,.41252,.999561,-.00952753,.0223057,.438006,.999557,-.0099134,.0222065,.466735,.999541,-.0100935,.0220402,.495332,.999562,-.00996821,.0218067,.523197,.999556,-.0105031,.0217096,.550223,.999561,-.0114191,.0217215,.579498,.999588,-.0111818,.0213357,.608416,.999633,-.0107725,.0208689,.635965,.999527,-.0121671,.0210149,.664476,.999508,-.0116005,.020431,.692786,.999568,-.0115604,.0199791,.719709,.999671,-.0121117,.0197415,.74737,.999688,-.0110769,.0188846,.773692,.99962,-.0122368,.0188452,.799534,.999823,-.0110325,.0178001,.825046,.999599,-.0114923,.0174221,.849075,.999619,-.0105923,.0164345,.872999,.999613,-.0105988,.0158227,.895371,.99964,-.00979861,.0148131,.917364,.99977,-.00967238,.0140721,.938002,.999726,-.00869175,.0129543,.957917,.99973,-.00866872,.0122329,.976557,.999773,-.00731956,.0108958,.994459,.999811,-.00756027,.0102715,1.01118,.999862,-.00583732,.00878781,1.02701,.999835,-.00631438,.00827529,1.04186,.999871,-.00450785,.00674583,1.05569,.999867,-.00486079,.00621041,1.06861,.999939,-.00322072,.00478301,1.08064,.999918,-.00318199,.00406395,1.09181,1.00003,-.00193348,.00280682,1.10207,.999928,-.00153729,.00198741,1.11152,.999933,-623666e-9,917714e-9,1.12009,1,-102387e-11,907581e-12,1.12813,.997866,-896716e-12,.0448334,199584e-10,.997987,-225945e-10,.0448389,502891e-9,.997987,-903781e-10,.0448388,.00201156,.997985,-203351e-9,.0448388,.00452602,.997986,-361514e-9,.0448388,.00804629,.997987,-56487e-8,.0448389,.0125724,.997988,-813423e-9,.0448389,.0181045,.997984,-.00110718,.0448387,.0246427,.997985,-.00144616,.0448388,.0321875,.997987,-.00183038,.044839,.0407392,.997983,-.00225987,.0448387,.0502986,.997991,-.00273467,.0448389,.0608667,.997984,-.00325481,.0448384,.0724444,.998002,-.00382043,.044839,.0850348,.997997,-.00443145,.0448396,.0986372,.998007,-.00508796,.0448397,.113255,.998008,-.00578985,.04484,.128891,.998003,-.00653683,.0448384,.145548,.997983,-.00732713,.0448358,.163221,.997985,-.00815454,.0448358,.181899,.998005,-.00898985,.0448286,.201533,.998026,-.00964404,.0447934,.221821,.998055,-.00922677,.044611,.241282,.99804,-.0117361,.0448245,.261791,.998048,-.0127628,.0448159,.285181,.998088,-.0138055,.0447996,.30954,.998058,-.0148206,.0447669,.334751,.998099,-.0156998,.044697,.36061,.998116,-.0161976,.0445122,.386603,.998195,-.015945,.0441711,.411844,.998168,-.0183947,.0444255,.43773,.998184,-.0197913,.0443809,.466009,.998251,-.0201426,.0440689,.494574,.998305,-.0198847,.0435632,.522405,.998273,-.0210577,.043414,.549967,.998254,-.0227901,.0433943,.578655,.998349,-.0223108,.0426529,.60758,.99843,-.0223088,.042,.635524,.998373,-.0241141,.0418987,.663621,.998425,-.0231446,.0408118,.691906,.998504,-.0233684,.0400565,.719339,.998443,-.0241652,.0394634,.74643,.99848,-.0228715,.0380002,.773086,.998569,-.023519,.0372322,.798988,.998619,-.0223108,.0356468,.824249,.998594,-.0223105,.034523,.848808,.998622,-.0213426,.0328887,.87227,.998669,-.0207912,.0314374,.895157,.998705,-.0198416,.0296925,.916769,.998786,-.0189168,.0279634,.937773,.998888,-.0178811,.0261597,.957431,.99906,-.0166845,.0242159,.976495,.999038,-.0155464,.0222638,.994169,.999237,-.0141349,.0201967,1.01112,.999378,-.0129324,.0181744,1.02692,.999433,-.0113192,.0159898,1.04174,.999439,-.0101244,.0140385,1.05559,.999614,-.00837456,.0117826,1.06852,.999722,-.00721769,.00983745,1.08069,.999817,-.00554067,.00769002,1.09176,.99983,-.00426961,.005782,1.10211,.999964,-.00273904,.00374503,1.11152,1.00001,-.00136739,.00187176,1.12031,.999946,393227e-10,-28919e-9,1.12804,.995847,-13435e-10,.0671785,19916e-9,.995464,-338387e-10,.0671527,501622e-9,.99547,-135355e-9,.0671531,.00200649,.995471,-30455e-8,.0671532,.00451461,.99547,-541423e-9,.0671531,.008026,.995471,-84598e-8,.0671531,.0125407,.99547,-.00121823,.0671531,.0180589,.99547,-.00165817,.0671531,.0245806,.995463,-.00216583,.0671526,.0321062,.995468,-.00274127,.0671527,.0406366,.995474,-.00338447,.0671534,.0501717,.995473,-.00409554,.0671533,.0607131,.995478,-.00487451,.0671531,.0722618,.995476,-.00572148,.0671532,.0848191,.995477,-.00663658,.0671539,.0983882,.995498,-.00761986,.0671541,.112972,.995509,-.00867094,.0671542,.128568,.995509,-.00978951,.0671531,.145183,.995503,-.0109725,.0671491,.162808,.995501,-.012211,.0671465,.181441,.99553,-.0134565,.0671371,.201015,.99555,-.014391,.0670831,.221206,.99558,-.014351,.0668883,.240813,.995577,-.0173997,.0671055,.261257,.995602,-.0191111,.0671178,.284467,.995623,-.0206705,.0670946,.308765,.995658,-.022184,.0670472,.333905,.995705,-.0234832,.0669417,.359677,.995719,-.0241933,.0666714,.385554,.995786,-.0243539,.066266,.410951,.995887,-.0271866,.0664367,.437163,.995944,-.0296012,.0664931,.464842,.996004,-.0301045,.0660105,.49332,.996128,-.0298311,.0652694,.521131,.996253,-.0316426,.0650739,.549167,.996244,-.0339043,.0649433,.57737,.996309,-.033329,.0638926,.606073,.996417,-.0338935,.0630849,.634527,.996372,-.0353104,.0625083,.66256,.996542,-.0348942,.0611986,.690516,.996568,-.0351614,.060069,.718317,.996711,-.0354317,.0588522,.74528,.996671,-.0349513,.0571902,.772061,.996865,-.0345622,.0555321,.798089,.996802,-.0342566,.0537816,.823178,.996992,-.0330862,.0516095,.847949,.996944,-.0324666,.0495537,.871431,.997146,-.0309544,.0470302,.894357,.997189,-.0299372,.0446043,.916142,.997471,-.0281389,.0418812,.937193,.997515,-.0268702,.0391823,.957,.997812,-.0247166,.0361338,.975936,.998027,-.0233525,.0333945,.99391,.998233,-.0209839,.0301917,1.01075,.998481,-.0194309,.027271,1.02669,.998859,-.0169728,.0240162,1.04173,.99894,-.0152322,.0210517,1.05551,.999132,-.0127497,.0178632,1.06856,.999369,-.0108282,.014787,1.08054,.999549,-.00845886,.0116185,1.09185,.999805,-.0063937,.00867209,1.10207,.99985,-.00414582,.00566823,1.1117,.999912,-.00207443,.00277562,1.12022,1.00001,870226e-10,-53766e-9,1.12832,.991943,-178672e-11,.0893382,198384e-10,.991952,-450183e-10,.089339,499849e-9,.991956,-180074e-9,.0893394,.0019994,.991955,-405167e-9,.0893393,.00449867,.991953,-720298e-9,.0893391,.00799764,.991955,-.00112548,.0893393,.0124964,.991957,-.0016207,.0893395,.0179951,.991958,-.00220601,.0893396,.0244939,.991947,-.00288137,.0893385,.0319929,.991962,-.00364693,.0893399,.0404933,.991965,-.00450264,.0893399,.049995,.99198,-.00544862,.0893411,.0604995,.99197,-.00648491,.0893397,.0720074,.991976,-.00761164,.089341,.0845207,.99198,-.00882891,.0893405,.0980413,.991982,-.0101367,.0893396,.112571,.992008,-.011535,.0893415,.128115,.992026,-.0130228,.0893414,.144672,.992064,-.0145966,.0893418,.162241,.992041,-.0162421,.0893359,.180801,.992086,-.0178888,.0893214,.200302,.992157,-.0190368,.0892401,.220332,.992181,-.0195584,.0890525,.240144,.992175,-.0227257,.0892153,.260728,.99221,-.0254195,.089304,.283473,.99222,-.0274883,.0892703,.307673,.992317,-.0294905,.0892027,.332729,.992374,-.0311861,.0890577,.358387,.992505,-.0320656,.0886994,.384102,.992568,-.0329715,.0883198,.409767,.992675,-.036006,.0883602,.436145,.992746,-.0392897,.0884591,.463217,.992873,-.0399337,.0878287,.491557,.992934,-.040231,.0870108,.519516,.993091,-.0422013,.0865857,.547741,.993259,-.0443503,.0861937,.575792,.993455,-.0446368,.0851187,.604233,.993497,-.0454299,.0840576,.632925,.993694,-.0463296,.0829671,.660985,.993718,-.0470619,.0817185,.688714,.993973,-.0468838,.0800294,.716743,.994207,-.046705,.0781286,.74377,.994168,-.0469698,.0763337,.77042,.9945,-.0456816,.0738184,.796659,.994356,-.0455518,.0715545,.821868,.994747,-.0439488,.0686085,.846572,.994937,-.0430056,.065869,.870435,.995142,-.0413414,.0626446,.893272,.995451,-.0396521,.05929,.915376,.995445,-.0378453,.0558503,.936196,.995967,-.0355219,.0520949,.956376,.996094,-.0335146,.048377,.975327,.996622,-.030682,.0442575,.993471,.996938,-.0285504,.0404693,1.01052,.997383,-.0253399,.0360903,1.02637,.997714,-.0231651,.0322176,1.04139,.998249,-.0198138,.0278433,1.05542,.998596,-.0174337,.0238759,1.06846,.998946,-.0141349,.0195944,1.08056,.99928,-.0115603,.0156279,1.09181,.999507,-.00839065,.0114607,1.10213,.999697,-.005666,.00763325,1.11169,.999869,-.00269902,.00364946,1.12042,1.00001,623836e-10,-319288e-10,1.12832,.987221,-222675e-11,.111332,197456e-10,.98739,-561116e-10,.111351,497563e-9,.987448,-224453e-9,.111357,.00199031,.987441,-505019e-9,.111357,.0044782,.987442,-897816e-9,.111357,.00796129,.987442,-.00140284,.111357,.0124396,.987444,-.00202012,.111357,.0179132,.987442,-.00274964,.111357,.0243824,.987446,-.00359147,.111357,.0318474,.987435,-.00454562,.111356,.0403086,.987461,-.00561225,.111358,.0497678,.987458,-.00679125,.111358,.0602239,.987443,-.0080828,.111356,.0716792,.987476,-.0094872,.111358,.0841364,.98749,-.0110044,.111361,.097597,.987508,-.0126344,.111362,.112062,.987494,-.0143767,.111357,.127533,.987526,-.0162307,.111359,.144015,.987558,-.0181912,.111361,.161502,.987602,-.0202393,.111355,.179979,.987692,-.022273,.111346,.199386,.987702,-.0235306,.111215,.219183,.987789,-.0247628,.111061,.239202,.987776,-.0280668,.111171,.259957,.987856,-.0316751,.111327,.282198,.987912,-.0342468,.111282,.306294,.988,-.0367205,.111198,.331219,.988055,-.0387766,.110994,.356708,.988241,-.0397722,.110547,.382234,.988399,-.0416076,.110198,.408227,.988539,-.0448192,.110137,.434662,.988661,-.0483793,.110143,.461442,.988967,-.0495895,.109453,.489318,.989073,-.0506797,.108628,.517516,.989274,-.0526953,.108003,.545844,.989528,-.054578,.107255,.573823,.989709,-.0561503,.106294,.601944,.989991,-.056866,.104896,.630855,.990392,-.0572914,.103336,.658925,.990374,-.0586224,.10189,.686661,.990747,-.0584764,.099783,.714548,.991041,-.0582662,.0974309,.74186,.991236,-.0584118,.0951678,.768422,.991585,-.0573055,.0921581,.794817,.991984,-.0564241,.0891167,.820336,.9921,-.0553608,.085805,.84493,.992749,-.0533816,.0820354,.868961,.99288,-.0518661,.0782181,.891931,.993511,-.0492492,.0738935,.914186,.993617,-.0471956,.0696402,.93532,.99411,-.044216,.0649659,.95543,.994595,-.0416654,.0603177,.974685,.994976,-.0384314,.0553493,.992807,.995579,-.0353491,.0503942,1.00996,.996069,-.0319787,.0452123,1.02606,.996718,-.028472,.0400112,1.04114,.997173,-.0250789,.0349456,1.05517,.997818,-.0213326,.029653,1.0683,.998318,-.0178509,.024549,1.0805,.998853,-.0141118,.0194197,1.09177,.999218,-.0105914,.0143869,1.1022,.999594,-.00693474,.00943517,1.11175,.99975,-.00340478,.00464051,1.12056,1.00001,109172e-9,-112821e-9,1.12853,.983383,-266524e-11,.133358,196534e-10,.981942,-671009e-10,.133162,494804e-9,.981946,-268405e-9,.133163,.00197923,.981944,-603912e-9,.133163,.00445326,.981941,-.00107362,.133162,.00791693,.981946,-.00167755,.133163,.0123703,.981944,-.00241569,.133162,.0178135,.981945,-.00328807,.133163,.0242466,.981945,-.00429472,.133162,.03167,.981955,-.00543573,.133164,.0400846,.981951,-.00671105,.133163,.0494901,.981968,-.00812092,.133165,.0598886,.981979,-.00966541,.133166,.0712811,.981996,-.0113446,.133168,.083669,.982014,-.0131585,.133169,.0970533,.982011,-.0151073,.133167,.111438,.982062,-.0171906,.133172,.126826,.9821,-.0194067,.133175,.143215,.982149,-.0217502,.133176,.160609,.982163,-.0241945,.133173,.178981,.982247,-.0265907,.133148,.198249,.982291,-.027916,.132974,.217795,.982396,-.0299663,.132868,.238042,.982456,-.0334544,.132934,.258901,.982499,-.0378636,.133137,.280639,.982617,-.0409274,.133085,.304604,.98274,-.0438523,.132985,.329376,.982944,-.0462288,.132728,.354697,.98308,-.0475995,.132228,.380102,.983391,-.0501901,.131924,.406256,.983514,-.0535899,.131737,.432735,.98373,-.0571858,.131567,.459359,.984056,-.0592353,.130932,.486637,.984234,-.0610488,.130092,.51509,.984748,-.0630758,.12923,.543461,.985073,-.0647398,.128174,.571376,.985195,-.0671941,.127133,.599414,.985734,-.0681345,.125576,.628134,.986241,-.0686089,.123639,.656399,.986356,-.0698511,.121834,.684258,.986894,-.0700931,.119454,.711818,.987382,-.0698321,.116718,.739511,.988109,-.0693975,.113699,.766267,.988363,-.0689584,.110454,.792456,.989112,-.0672353,.106602,.81813,.989241,-.0662034,.10267,.842889,.990333,-.0638938,.0981381,.867204,.990591,-.0618534,.0935388,.89038,.991106,-.0593117,.088553,.912576,.991919,-.0562676,.0832187,.934118,.992111,-.0534085,.0778302,.954254,.992997,-.0495459,.0720453,.973722,.993317,-.0463707,.0663458,.991949,.994133,-.0421245,.0601883,1.00936,.994705,-.0384977,.0542501,1.02559,.995495,-.0340956,.0479862,1.04083,.996206,-.030105,.041887,1.05497,.996971,-.0256095,.0355355,1.06824,.997796,-.0213932,.0293655,1.08056,.998272,-.0169612,.0232926,1.09182,.998857,-.0126756,.0172786,1.10219,.99939,-.00832486,.0113156,1.11192,.999752,-.00410826,.00557892,1.12075,1,150957e-9,-119101e-9,1.12885,.975169,-309397e-11,.154669,195073e-10,.975439,-779608e-10,.154712,491534e-9,.975464,-311847e-9,.154716,.00196617,.975464,-701656e-9,.154716,.00442387,.975462,-.0012474,.154715,.0078647,.975461,-.00194906,.154715,.0122886,.975464,-.00280667,.154715,.0176959,.975468,-.00382025,.154716,.0240867,.975471,-.00498985,.154716,.0314612,.975472,-.00631541,.154717,.0398199,.975486,-.00779719,.154718,.0491639,.975489,-.00943505,.154718,.0594932,.975509,-.0112295,.154721,.0708113,.97554,-.0131802,.154724,.0831176,.975557,-.0152876,.154726,.096415,.975585,-.0175512,.154728,.110705,.975605,-.0199713,.154729,.125992,.975645,-.0225447,.154729,.142272,.975711,-.0252649,.154735,.159549,.975788,-.0280986,.154736,.177805,.975872,-.0308232,.154704,.196911,.975968,-.0324841,.154525,.216324,.976063,-.0351281,.154432,.236628,.976157,-.0388618,.15446,.257539,.976204,-.0437704,.154665,.278975,.976358,-.047514,.154652,.302606,.976571,-.0508638,.154535,.327204,.976725,-.0534995,.154221,.352276,.977013,-.0555547,.153737,.377696,.977294,-.0586728,.153403,.403855,.977602,-.0622715,.15312,.430333,.977932,-.0658166,.152755,.456855,.978241,-.0689877,.152233,.483668,.978602,-.0712805,.15132,.512097,.979234,-.0732775,.150235,.540455,.97977,-.075163,.148978,.568486,.979995,-.0778026,.147755,.596524,.98078,-.0791854,.146019,.624825,.981628,-.0799666,.143906,.653403,.982067,-.0808532,.141561,.681445,.98271,-.0816024,.139025,.708918,.983734,-.0812511,.135764,.736594,.98431,-.0806201,.132152,.763576,.985071,-.0801605,.12846,.789797,.98618,-.0784208,.124084,.815804,.986886,-.0766643,.1193,.840869,.987485,-.0747744,.114236,.864952,.988431,-.0716701,.108654,.888431,.988886,-.0691609,.102994,.910963,.990024,-.0654048,.0967278,.932629,.990401,-.0619765,.090384,.95313,.991093,-.0579296,.0837885,.972587,.992018,-.0536576,.0770171,.991184,.992536,-.0493719,.0701486,1.00863,.993421,-.0444813,.062953,1.02494,.993928,-.040008,.0560455,1.04017,.994994,-.0347982,.04856,1.05463,.995866,-.0301017,.0416152,1.06807,.996916,-.0248225,.0342597,1.08039,.997766,-.0199229,.0271668,1.09177,.998479,-.0147422,.0201387,1.10235,.99921,-.00980173,.0131944,1.11206,.999652,-.0047426,.00640712,1.12104,.999998,891673e-10,-10379e-8,1.12906,.967868,-351885e-11,.175947,193569e-10,.968001,-886733e-10,.175972,487782e-9,.96801,-354697e-9,.175973,.00195115,.968012,-798063e-9,.175974,.00439006,.968011,-.00141879,.175973,.00780461,.968011,-.00221686,.175973,.0121948,.968016,-.00319231,.175974,.0175607,.968019,-.00434515,.175974,.0239027,.968018,-.00567538,.175974,.0312208,.968033,-.00718308,.175977,.0395158,.968049,-.00886836,.175979,.0487885,.968047,-.0107312,.175978,.0590394,.968072,-.0127719,.175981,.0702705,.968108,-.0149905,.175986,.0824836,.968112,-.0173866,.175985,.0956783,.968173,-.0199611,.175993,.109862,.96827,-.0227128,.176008,.125033,.968292,-.025639,.17601,.141193,.968339,-.0287299,.176007,.158336,.968389,-.0319399,.176001,.176441,.968501,-.034941,.175962,.195359,.968646,-.0370812,.175793,.214686,.968789,-.0402329,.175708,.234973,.96886,-.0442601,.1757,.255871,.969013,-.049398,.175876,.277238,.969242,-.0539932,.17594,.300326,.969419,-.0577299,.175781,.324702,.969763,-.0605643,.175432,.349527,.970093,-.0634488,.174992,.374976,.970361,-.0670589,.174611,.401097,.970825,-.0708246,.174226,.427496,.971214,-.0742871,.173684,.453858,.971622,-.0782608,.173186,.480637,.972175,-.0813151,.172288,.508655,.972944,-.0832678,.170979,.536973,.973595,-.0855964,.169573,.565138,.974345,-.0882163,.168152,.593222,.975233,-.0901671,.166314,.621201,.976239,-.0912111,.163931,.649919,.977289,-.0916959,.161106,.678011,.978076,-.0927061,.158272,.705717,.979533,-.0925562,.15475,.733228,.980335,-.0918159,.150638,.760454,.981808,-.0908508,.146201,.786918,.983061,-.0896172,.141386,.812953,.984148,-.0871588,.135837,.838281,.985047,-.0850624,.130135,.862594,.986219,-.0818541,.123882,.88633,.987043,-.0784523,.117126,.908952,.988107,-.0749601,.110341,.930744,.988955,-.0703548,.102885,.951728,.989426,-.0662798,.0954167,.971166,.990421,-.0610834,.0876331,.989984,.991032,-.0562936,.0797785,1.00765,.992041,-.0508154,.0718166,1.02434,.992794,-.0454045,.0637125,1.03976,.993691,-.0398194,.0555338,1.05418,.994778,-.0341482,.0473388,1.06772,.995915,-.028428,.0391016,1.08028,.997109,-.022642,.0309953,1.09185,.998095,-.0168738,.0230288,1.10247,.998985,-.0111274,.0150722,1.11229,.999581,-.00543881,.00740605,1.12131,1.00003,162239e-9,-105549e-9,1.12946,.959505,-393734e-11,.196876,191893e-10,.959599,-992157e-10,.196895,483544e-9,.959641,-396868e-9,.196903,.0019342,.959599,-892948e-9,.196895,.00435193,.959603,-.00158747,.196896,.0077368,.959604,-.00248042,.196896,.0120888,.959605,-.00357184,.196896,.0174082,.959605,-.00486169,.196896,.0236949,.959613,-.00635008,.196897,.0309497,.959619,-.00803696,.196898,.0391725,.959636,-.00992255,.196901,.0483649,.959634,-.0120067,.1969,.0585266,.959675,-.0142898,.196906,.0696609,.959712,-.0167717,.196911,.0817678,.959752,-.0194524,.196918,.0948494,.959807,-.0223321,.196925,.10891,.959828,-.0254091,.196924,.123947,.959906,-.0286815,.196934,.139968,.960005,-.0321371,.196944,.156968,.960071,-.0357114,.196936,.17491,.960237,-.0389064,.196882,.193597,.960367,-.041623,.196731,.21285,.960562,-.0452655,.196654,.233075,.960735,-.0496207,.196643,.253941,.960913,-.0549379,.196774,.275278,.961121,-.0603414,.196893,.297733,.96139,-.0644244,.196717,.321877,.961818,-.067556,.196314,.346476,.962175,-.0712709,.195917,.371907,.96255,-.0752848,.1955,.397916,.963164,-.0792073,.195026,.424229,.963782,-.0828225,.194424,.450637,.964306,-.0873119,.193831,.477288,.964923,-.0911051,.192973,.504716,.966048,-.093251,.19151,.533053,.967024,-.0958983,.190013,.561366,.968038,-.09835,.188253,.589464,.969152,-.100754,.186257,.617433,.970557,-.102239,.183775,.645801,.972104,-.102767,.180645,.674278,.973203,-.103492,.177242,.702004,.975123,-.103793,.17345,.729529,.97641,-.102839,.168886,.756712,.978313,-.101687,.163892,.783801,.980036,-.100314,.158439,.809671,.981339,-.097836,.152211,.835402,.982794,-.0950006,.145679,.860081,.984123,-.0920994,.138949,.883757,.984918,-.0878641,.131283,.90685,.985999,-.083939,.123464,.928786,.987151,-.0791234,.115324,.94983,.987827,-.0739332,.106854,.96962,.988806,-.0688088,.0982691,.98861,.989588,-.0628962,.0893456,1.00667,.990438,-.0573146,.0805392,1.02344,.991506,-.0509433,.0713725,1.03933,.992492,-.0448724,.0623732,1.05378,.993663,-.0383497,.0530838,1.06747,.994956,-.0319593,.0439512,1.08007,.99634,-.025401,.0347803,1.09182,.99761,-.0189687,.0257954,1.1025,.99863,-.0124441,.0169893,1.11247,.99947,-.00614003,.00829498,1.12151,1.00008,216624e-9,-146107e-9,1.12993,.950129,-434955e-11,.217413,190081e-10,.950264,-10957e-8,.217444,47884e-8,.9503,-438299e-9,.217451,.00191543,.950246,-986124e-9,.21744,.00430951,.950246,-.00175311,.21744,.00766137,.950245,-.00273923,.21744,.011971,.950253,-.00394453,.217441,.0172385,.950258,-.00536897,.217442,.0234641,.950267,-.00701262,.217444,.030648,.950277,-.00887551,.217446,.038791,.950284,-.0109576,.217446,.0478931,.950312,-.0132591,.217451,.0579568,.950334,-.01578,.217454,.0689821,.950378,-.0185204,.217462,.0809714,.950417,-.0214803,.217467,.0939265,.950488,-.0246594,.217479,.10785,.950534,-.0280565,.217483,.122743,.950633,-.0316685,.217498,.138611,.950698,-.0354787,.217499,.155442,.950844,-.0394003,.217507,.173208,.950999,-.0426812,.217419,.191605,.951221,-.0461302,.217317,.21084,.951412,-.0502131,.217238,.230945,.951623,-.0549183,.21722,.251745,.951867,-.0604493,.217306,.273001,.952069,-.0665189,.217466,.294874,.952459,-.0709179,.217266,.318732,.952996,-.0746112,.216891,.34318,.953425,-.0789252,.216503,.36849,.953885,-.0833293,.216042,.394373,.954617,-.087371,.215469,.420505,.955429,-.0914054,.214802,.446907,.956068,-.0961671,.214146,.473522,.957094,-.10048,.213286,.50052,.958372,-.103248,.211796,.528715,.959654,-.106033,.21016,.557065,.961305,-.108384,.208149,.585286,.962785,-.111122,.206024,.613334,.964848,-.112981,.203442,.641334,.966498,-.113717,.19996,.669955,.968678,-.114121,.196105,.698094,.970489,-.114524,.191906,.725643,.972903,-.113792,.186963,.752856,.974701,-.112406,.181343,.780013,.976718,-.110685,.175185,.806268,.978905,-.108468,.168535,.832073,.980267,-.105061,.161106,.857149,.981967,-.101675,.153387,.881145,.983063,-.0974492,.145199,.904255,.984432,-.0925815,.136527,.926686,.985734,-.0877983,.127584,.947901,.986228,-.081884,.118125,.968111,.98719,-.0761208,.108594,.98719,.988228,-.0698196,.0989996,1.00559,.989046,-.0632739,.0890074,1.02246,.990242,-.056522,.0790832,1.03841,.991252,-.0495272,.0689182,1.05347,.992542,-.0425373,.0588592,1.06724,.994096,-.0353198,.0486833,1.08009,.995593,-.028235,.0385977,1.09177,.99711,-.0209511,.0286457,1.10274,.998263,-.0139289,.0188497,1.11262,.999254,-.0067359,.009208,1.12191,.999967,141846e-9,-657764e-10,1.13024,.935608,-474692e-11,.236466,187817e-10,.93996,-11971e-8,.237568,473646e-9,.939959,-478845e-9,.237567,.0018946,.939954,-.0010774,.237566,.00426284,.939956,-.00191538,.237566,.00757842,.939954,-.00299277,.237566,.0118413,.93996,-.00430961,.237567,.0170518,.939969,-.00586589,.237569,.02321,.939982,-.00766166,.237572,.0303164,.939987,-.00969686,.237572,.0383711,.939997,-.0119715,.237574,.0473751,.940031,-.0144858,.237581,.0573298,.940073,-.0172399,.237589,.0682366,.94012,-.0202335,.237598,.080097,.940162,-.0234663,.237604,.0929116,.940237,-.0269387,.237615,.106686,.940328,-.0306489,.237632,.121421,.940419,-.0345917,.237645,.137115,.940522,-.0387481,.237654,.153766,.940702,-.0429906,.237661,.17133,.940871,-.0465089,.237561,.189502,.941103,-.050531,.23748,.208616,.941369,-.0550657,.237423,.228595,.941641,-.0601337,.237399,.249287,.941903,-.0658804,.237443,.270467,.942224,-.0722674,.237597,.292024,.942633,-.0771788,.237419,.315272,.943172,-.0815623,.237068,.339579,.943691,-.0863973,.236682,.364717,.944382,-.0911536,.236213,.390435,.945392,-.0952967,.235562,.416425,.946185,-.0998948,.234832,.442772,.947212,-.104796,.234114,.469347,.948778,-.10928,.233222,.496162,.950149,-.113081,.231845,.523978,.951989,-.115893,.230005,.552295,.953921,-.11846,.227862,.580569,.955624,-.12115,.225439,.608698,.958234,-.123373,.222635,.636696,.960593,-.124519,.219093,.665208,.963201,-.124736,.214749,.693557,.965642,-.125012,.210059,.721334,.968765,-.124661,.204935,.748613,.971753,-.122996,.198661,.776224,.973751,-.120998,.191823,.802461,.976709,-.118583,.184359,.828399,.977956,-.115102,.176437,.853693,.979672,-.111077,.167681,.877962,.981816,-.10688,.158872,.901564,.98238,-.101469,.149398,.924057,.983964,-.0960013,.139436,.945751,.984933,-.0899626,.12943,.966272,.985694,-.0832973,.11894,.985741,.986822,-.0767082,.108349,1.00407,.987725,-.0693614,.0976026,1.02154,.98877,-.06211,.086652,1.03757,.990129,-.0544143,.0756182,1.05296,.991337,-.046744,.0645753,1.06683,.992978,-.0387931,.0534683,1.0798,.994676,-.030973,.0424137,1.09181,.99645,-.0230311,.0314035,1.10286,.997967,-.0152065,.0206869,1.11291,.99922,-.00744837,.010155,1.12237,1.00002,240209e-9,-752767e-10,1.13089,.922948,-515351e-11,.255626,186069e-10,.928785,-129623e-9,.257244,468009e-9,.928761,-51849e-8,.257237,.00187202,.928751,-.0011666,.257235,.00421204,.928751,-.00207395,.257234,.0074881,.928754,-.00324055,.257235,.0117002,.92876,-.00466639,.257236,.0168486,.928763,-.00635149,.257237,.0229334,.928774,-.00829584,.257239,.029955,.928791,-.0104995,.257243,.0379139,.928804,-.0129623,.257245,.0468108,.928847,-.0156846,.257255,.0566473,.92889,-.0186661,.257263,.0674246,.928924,-.0219067,.257268,.0791433,.928989,-.0254066,.257282,.0918076,.92909,-.0291651,.257301,.105419,.92918,-.0331801,.257316,.119978,.92929,-.0374469,.257332,.135491,.929453,-.041939,.257357,.151948,.929586,-.0464612,.257347,.169275,.929858,-.0503426,.257269,.187257,.930125,-.0548409,.257199,.206204,.930403,-.0598063,.257149,.22601,.930726,-.0652437,.257122,.246561,.931098,-.0712376,.257153,.267618,.931396,-.0777506,.257237,.288993,.931947,-.0832374,.257124,.311527,.932579,-.0883955,.25683,.335697,.933194,-.0937037,.256444,.360634,.934013,-.0987292,.255939,.386126,.935307,-.103215,.255282,.412018,.936374,-.108234,.254538,.438292,.93776,-.113234,.253728,.464805,.939599,-.118013,.25275,.491464,.941036,-.122661,.251404,.518751,.94337,-.125477,.249435,.547133,.945318,-.128374,.247113,.575456,.947995,-.130996,.244441,.60372,.950818,-.133438,.241352,.63174,.954378,-.135004,.237849,.659971,.957151,-.135313,.233188,.688478,.960743,-.13521,.228001,.716767,.964352,-.135007,.222249,.744349,.967273,-.133523,.21542,.771786,.969767,-.131155,.208039,.798639,.973195,-.128492,.200076,.824774,.975557,-.125094,.191451,.850222,.977692,-.120578,.18184,.874761,.98026,-.115882,.172102,.898497,.981394,-.110372,.161859,.921636,.982386,-.10415,.15108,.943467,.983783,-.0978128,.140407,.964045,.98422,-.0906171,.129058,.98398,.985447,-.0832921,.117614,1.00276,.986682,-.0754412,.10585,1.02047,.987326,-.0673885,.0940943,1.03678,.988707,-.0592565,.0822093,1.05218,.990185,-.050717,.070192,1.06652,.991866,-.0423486,.0582081,1.07965,.993897,-.0336118,.0460985,1.09188,.995841,-.0252178,.0342737,1.10307,.997605,-.0164893,.0224829,1.11324,.999037,-.00817112,.0110647,1.12262,1.00003,291686e-9,-168673e-9,1.13139,.915304,-552675e-11,.275999,183285e-10,.91668,-139285e-9,.276414,461914e-9,.916664,-55713e-8,.276409,.00184763,.916653,-.00125354,.276406,.00415715,.916651,-.00222851,.276405,.00739053,.916655,-.00348205,.276406,.0115478,.916653,-.00501414,.276405,.0166291,.916667,-.00682478,.276409,.0226346,.91668,-.00891398,.276412,.0295648,.91669,-.0112817,.276413,.0374199,.916727,-.013928,.276422,.0462016,.916759,-.0168528,.276429,.0559101,.916793,-.0200558,.276436,.0665466,.916849,-.0235373,.276448,.0781139,.916964,-.0272973,.276474,.0906156,.917047,-.0313344,.276491,.104051,.917152,-.0356465,.276511,.118424,.917286,-.0402271,.276533,.133736,.917469,-.0450408,.276564,.149978,.917686,-.0497872,.276563,.167057,.917953,-.0540937,.276493,.184846,.918228,-.0590709,.276437,.203614,.918572,-.0644277,.276398,.223212,.918918,-.0702326,.276362,.243584,.919356,-.076484,.276383,.264465,.919842,-.0830808,.276434,.285701,.920451,-.0892972,.276407,.307559,.921113,-.095016,.276128,.331501,.921881,-.100771,.275754,.356207,.923027,-.106029,.275254,.381477,.924364,-.111029,.274595,.40722,.925818,-.116345,.273841,.433385,.92746,-.121424,.272913,.459848,.929167,-.12657,.271837,.486493,.931426,-.131581,.270575,.513432,.934001,-.135038,.268512,.541502,.936296,-.138039,.266135,.569658,.939985,-.140687,.263271,.598375,.943516,-.143247,.260058,.626563,.94782,-.145135,.256138,.654711,.951023,-.145733,.251154,.683285,.955338,-.145554,.245562,.711831,.959629,-.145008,.239265,.739573,.963123,-.144003,.232064,.767027,.966742,-.141289,.224036,.794359,.969991,-.138247,.215305,.820361,.973403,-.134786,.206051,.846548,.975317,-.129966,.195914,.871541,.977647,-.12471,.185184,.895313,.980137,-.119086,.174161,.918398,.981031,-.112297,.162792,.940679,.982037,-.105372,.150952,.961991,.983164,-.097821,.138921,.981913,.983757,-.0897245,.126611,1.00109,.985036,-.0815974,.114228,1.01902,.986289,-.0727725,.101389,1.03604,.987329,-.0639323,.0886476,1.05149,.989193,-.0548109,.0756837,1.06619,.990716,-.045687,.0627581,1.07948,.992769,-.0364315,.0498337,1.09172,.99524,-.0271761,.0370305,1.1033,.997154,-.0179609,.0243959,1.11353,.998845,-.00878063,.0119567,1.12319,1.00002,259038e-9,-108146e-9,1.13177,.903945,-591681e-11,.295126,181226e-10,.903668,-148672e-9,.295037,455367e-9,.903677,-594683e-9,.29504,.00182145,.903673,-.00133805,.295039,.00409831,.903666,-.00237872,.295036,.00728584,.903668,-.00371676,.295037,.0113842,.903679,-.00535212,.29504,.0163936,.903684,-.00728479,.295041,.0223141,.903698,-.00951473,.295044,.0291462,.903718,-.0120419,.295049,.0368904,.903754,-.0148664,.295058,.0455477,.903801,-.017988,.29507,.0551194,.903851,-.0214064,.295082,.0656058,.903921,-.0251219,.295097,.0770109,.904002,-.0291337,.295116,.0893354,.904111,-.033441,.29514,.102583,.904246,-.0380415,.295169,.116755,.904408,-.0429258,.295202,.131853,.904637,-.0480468,.295245,.147869,.904821,-.0529208,.295214,.164658,.905163,-.0577748,.295185,.182274,.905469,-.0631763,.295143,.200828,.905851,-.068917,.295112,.2202,.906322,-.0750861,.295104,.240372,.906761,-.0815855,.295086,.261082,.90735,-.0882138,.295095,.282123,.908087,-.095082,.295139,.303563,.908826,-.101488,.29492,.327028,.909832,-.107577,.294577,.351464,.911393,-.113033,.294115,.376497,.912804,-.118629,.293446,.402115,.914081,-.124232,.292581,.428111,.91637,-.129399,.29166,.454442,.91814,-.134892,.290422,.481024,.921179,-.140069,.289194,.507924,.924544,-.144431,.287421,.535557,.927995,-.147498,.284867,.563984,.931556,-.150197,.281722,.5923,.935777,-.152711,.278207,.620832,.940869,-.154836,.274148,.649069,.945994,-.155912,.269057,.677746,.949634,-.155641,.262799,.706293,.955032,-.154809,.256097,.734278,.95917,-.153678,.248618,.761751,.962931,-.151253,.239794,.789032,.966045,-.147625,.230281,.815422,.96971,-.143964,.220382,.841787,.972747,-.139464,.209846,.867446,.975545,-.133459,.198189,.892004,.978381,-.127424,.186362,.915458,.979935,-.120506,.173964,.937948,.980948,-.11282,.161429,.959732,.982234,-.104941,.148557,.980118,.982767,-.0962905,.135508,.999463,.983544,-.0873625,.122338,1.01756,.984965,-.0783447,.108669,1.03492,.986233,-.0684798,.0949911,1.05087,.987796,-.0590867,.0811386,1.0656,.989885,-.0489145,.0673099,1.0794,.991821,-.0391,.0535665,1.09174,.99448,-.029087,.0397529,1.10341,.996769,-.019114,.0261463,1.11383,.998641,-.00947007,.0128731,1.1237,.999978,446316e-9,-169093e-9,1.13253,.888362,-627064e-11,.312578,178215e-10,.889988,-157791e-9,.313148,448451e-9,.889825,-631076e-9,.313092,.00179356,.88984,-.00141994,.313097,.00403554,.889828,-.0025243,.313092,.00717429,.889831,-.00394421,.313093,.0112099,.889831,-.00567962,.313093,.0161425,.889844,-.00773051,.313096,.0219724,.889858,-.0100968,.3131,.0286999,.889882,-.0127786,.313106,.0363256,.889918,-.0157757,.313116,.0448509,.889967,-.0190878,.313129,.0542758,.89003,-.022715,.313145,.0646032,.890108,-.0266566,.313165,.0758339,.890218,-.0309131,.313193,.0879729,.890351,-.0354819,.313226,.101019,.89051,-.0403613,.313263,.114979,.890672,-.0455385,.313294,.129848,.890882,-.0509444,.313333,.145616,.891189,-.0559657,.313324,.162122,.891457,-.0613123,.313281,.179524,.891856,-.0671488,.313281,.197855,.892312,-.0732732,.313268,.216991,.892819,-.0797865,.313263,.236924,.893369,-.0865269,.313247,.257433,.894045,-.0931592,.313205,.278215,.894884,-.100532,.313276,.299467,.895832,-.107716,.313205,.322276,.897043,-.114099,.312873,.34642,.898515,-.119941,.312331,.371187,.900191,-.126044,.311731,.396656,.90188,-.131808,.310859,.422488,.904359,-.137289,.309857,.448744,.906923,-.142991,.308714,.475239,.910634,-.148253,.307465,.501983,.914502,-.153332,.305774,.529254,.919046,-.156646,.303156,.557709,.923194,-.159612,.299928,.586267,.928858,-.162027,.296245,.614925,.934464,-.164203,.291832,.643187,.939824,-.165602,.286565,.671601,.944582,-.165383,.280073,.700213,.949257,-.164439,.272891,.728432,.954389,-.162953,.264771,.756082,.958595,-.161007,.255927,.78369,.962138,-.157243,.245769,.810769,.966979,-.152872,.235127,.836999,.969566,-.148209,.22347,.862684,.972372,-.142211,.211147,.887847,.975916,-.135458,.198606,.911843,.978026,-.128398,.185498,.934795,.979686,-.120313,.17171,.956787,.980748,-.11166,.158159,.978046,.981622,-.103035,.144399,.997693,.982356,-.0930328,.13001,1.01642,.983308,-.0834627,.115778,1.03366,.985037,-.0732249,.101327,1.05014,.986493,-.0628145,.086554,1.06507,.988484,-.0526556,.0720413,1.07907,.991051,-.0415744,.0571151,1.09189,.993523,-.0314275,.0426643,1.10369,.99628,-.0203603,.0279325,1.11423,.998344,-.0102446,.0138182,1.12421,.999997,42612e-8,-193628e-9,1.1333,.871555,-660007e-11,.329176,174749e-10,.875255,-166579e-9,.330571,441051e-9,.875644,-666394e-9,.330718,.00176441,.875159,-.00149903,.330536,.00396899,.87516,-.00266493,.330536,.007056,.875158,-.00416393,.330535,.0110251,.87516,-.00599598,.330535,.0158764,.875163,-.00816108,.330536,.0216101,.875174,-.0106591,.330538,.0282266,.875199,-.0134899,.330545,.0357266,.875257,-.0166538,.330563,.0441117,.875304,-.0201501,.330575,.0533821,.875373,-.0239785,.330595,.0635395,.875464,-.0281389,.330619,.0745872,.875565,-.0326301,.330645,.0865255,.875691,-.0374516,.330676,.0993599,.875897,-.0425993,.330733,.113093,.876091,-.0480576,.330776,.127722,.876353,-.0537216,.330826,.143227,.876649,-.0589807,.330809,.159462,.877034,-.0647865,.330819,.176642,.877443,-.0709789,.330817,.194702,.877956,-.0774782,.330832,.213577,.878499,-.0843175,.330822,.233246,.879144,-.0912714,.330804,.253512,.879982,-.0980824,.330766,.274137,.88097,-.105823,.330864,.295209,.882051,-.113671,.330896,.317226,.883397,-.120303,.330545,.341068,.884987,-.12667,.330068,.365613,.886789,-.133118,.329418,.390807,.889311,-.139024,.328683,.416494,.891995,-.144971,.327729,.442618,.895106,-.150747,.326521,.469131,.899527,-.156283,.325229,.495921,.90504,-.161707,.32378,.523162,.909875,-.165661,.32122,.55092,.91561,-.168755,.317942,.579928,.921225,-.171193,.313983,.608539,.927308,-.17319,.309636,.636854,.933077,-.174819,.304262,.66523,.938766,-.175002,.297563,.693609,.943667,-.173946,.289613,.722157,.949033,-.172221,.281227,.750021,.953765,-.169869,.271545,.777466,.95804,-.166578,.261034,.804853,.962302,-.161761,.249434,.831569,.966544,-.156636,.237484,.857779,.969372,-.150784,.224395,.883051,.972486,-.143672,.210786,.907864,.975853,-.135772,.196556,.931223,.977975,-.127942,.182307,.954061,.979122,-.118347,.167607,.97531,.980719,-.109112,.152739,.995666,.981223,-.0991789,.137932,1.01475,.98216,-.0883553,.122692,1.03253,.983379,-.0780825,.107493,1.04917,.985434,-.0665646,.0917791,1.06464,.987332,-.0557714,.0764949,1.07896,.990004,-.0442805,.060721,1.09199,.992975,-.0331676,.0452284,1.10393,.995811,-.0219547,.0297934,1.11476,.9982,-.0107613,.0146415,1.12484,1.00002,248678e-9,-14555e-8,1.13413,.859519,-693595e-11,.347264,171673e-10,.859843,-17503e-8,.347394,433219e-9,.859656,-700076e-9,.347319,.00173277,.859671,-.00157517,.347325,.00389875,.859669,-.00280028,.347324,.00693112,.85967,-.0043754,.347324,.01083,.859665,-.00630049,.347321,.0155954,.859685,-.0085755,.347328,.0212278,.859694,-.0112003,.347329,.0277273,.859718,-.0141747,.347336,.0350946,.85976,-.0174988,.347348,.0433314,.85982,-.0211722,.347366,.0524384,.859892,-.0251941,.347387,.0624168,.860006,-.0295649,.347422,.0732708,.860122,-.0342825,.347453,.0849999,.860282,-.0393462,.347499,.0976102,.860482,-.0447513,.347554,.111104,.860719,-.0504775,.347614,.125479,.860998,-.0563577,.347666,.140703,.861322,-.0619473,.347662,.156681,.861724,-.0681277,.347684,.173597,.862198,-.0746567,.347709,.191371,.862733,-.0815234,.347727,.209976,.863371,-.0886643,.347744,.229351,.86414,-.0957908,.347734,.24934,.865138,-.102912,.34772,.269797,.866182,-.110924,.3478,.290654,.867436,-.119223,.347911,.312074,.869087,-.126197,.347649,.335438,.870859,-.133145,.347222,.359732,.872997,-.139869,.346645,.38467,.875939,-.146089,.345935,.41019,.879012,-.152334,.345012,.436218,.883353,-.15821,.343924,.462641,.888362,-.164097,.342636,.489449,.895026,-.169528,.341351,.516629,.900753,-.174408,.339115,.544109,.906814,-.17751,.335809,.572857,.912855,-.180101,.331597,.601554,.919438,-.182116,.32698,.630198,.925962,-.183494,.321449,.658404,.931734,-.184159,.314595,.686625,.93762,-.18304,.306462,.71531,.943858,-.181323,.297514,.744272,.948662,-.178683,.287447,.771462,.953299,-.175379,.276166,.798593,.957346,-.170395,.263758,.8256,.962565,-.165042,.251019,.852575,.966075,-.158655,.237011,.878316,.969048,-.151707,.222518,.90329,.972423,-.143271,.207848,.927745,.975833,-.134824,.192463,.950859,.977629,-.125444,.1768,.972947,.978995,-.114949,.161033,.993263,.980533,-.104936,.145523,1.01337,.980745,-.0935577,.129799,1.03128,.981814,-.0822956,.113486,1.04825,.983943,-.0710082,.0972925,1.06405,.986141,-.0587931,.0808138,1.0785,.988878,-.0472755,.0644915,1.09204,.992132,-.0349128,.0478128,1.10413,.9953,-.0232407,.031621,1.11527,.998117,-.0112713,.0154935,1.12551,1.00003,339743e-9,-195763e-9,1.13504,.845441,-729126e-11,.364305,169208e-10,.843588,-183164e-9,.363506,425067e-9,.843412,-73253e-8,.36343,.00169999,.843401,-.00164818,.363426,.00382495,.843399,-.00293008,.363425,.00679993,.843401,-.00457822,.363425,.010625,.843394,-.00659249,.363421,.0153002,.843398,-.00897282,.363421,.0208258,.843415,-.0117191,.363426,.0272024,.843438,-.0148312,.363432,.0344305,.843483,-.018309,.363447,.0425116,.84356,-.0221521,.363472,.0514471,.843646,-.0263597,.363499,.061238,.843743,-.0309315,.363527,.0718873,.84388,-.0358658,.363569,.0833969,.844079,-.0411624,.363631,.0957742,.844279,-.0468128,.363688,.109015,.844549,-.0527923,.363761,.123124,.844858,-.0588204,.363817,.138044,.84522,-.0647573,.36383,.153755,.845669,-.0713181,.363879,.170394,.846155,-.0781697,.363908,.187861,.846789,-.0853913,.363969,.206176,.847502,-.0928086,.363999,.225244,.8484,-.10005,.363997,.244926,.849461,-.107615,.364008,.265188,.850562,-.115814,.364055,.28587,.851962,-.124334,.364179,.306926,.854326,-.131995,.364233,.329605,.856295,-.139338,.363856,.35359,.858857,-.146346,.363347,.37831,.862428,-.152994,.362807,.403722,.866203,-.159463,.361963,.429537,.871629,-.165623,.36112,.456,.877365,-.171649,.359917,.482773,.883744,-.177151,.35848,.509705,.890693,-.182381,.356523,.537215,.897278,-.186076,.3533,.565493,.903958,-.188602,.349095,.594293,.910908,-.190755,.344215,.623165,.918117,-.192063,.338606,.651573,.924644,-.192758,.331544,.679869,.931054,-.192238,.323163,.708668,.937303,-.190035,.313529,.737201,.943387,-.187162,.303152,.764977,.948494,-.183876,.29146,.792683,.952546,-.178901,.277917,.819228,.958077,-.173173,.264753,.846559,.962462,-.16645,.25002,.872962,.966569,-.159452,.234873,.898729,.969108,-.15074,.218752,.923126,.973072,-.141523,.202673,.947278,.975452,-.132075,.186326,.969938,.977784,-.121257,.169396,.991325,.97899,-.110182,.153044,1.01123,.979777,-.0989634,.136485,1.0299,.980865,-.0865894,.119343,1.04727,.982432,-.0746115,.102452,1.06341,.984935,-.0621822,.0852423,1.07834,.987776,-.0495694,.0678546,1.092,.99103,-.0372386,.0506917,1.1043,.99474,-.0244353,.0333316,1.11576,.997768,-.0121448,.0164348,1.12617,1.00003,31774e-8,-169504e-9,1.13598,.825551,-756799e-11,.378425,165099e-10,.82664,-190922e-9,.378923,416504e-9,.826323,-763495e-9,.378779,.0016656,.826359,-.00171789,.378795,.00374768,.82636,-.00305402,.378795,.00666259,.826368,-.00477185,.378798,.0104104,.826364,-.00687131,.378795,.0149912,.826368,-.00935232,.378795,.0204054,.826376,-.0122146,.378797,.0266532,.826399,-.0154581,.378803,.0337355,.82646,-.0190825,.378824,.0416537,.826525,-.0230873,.378846,.0504091,.826614,-.0274719,.378876,.0600032,.82674,-.0322355,.378917,.0704393,.826888,-.0373766,.378964,.0817195,.827078,-.0428936,.379024,.0938492,.827318,-.0487778,.379099,.106828,.82764,-.0549935,.379199,.120659,.827926,-.0611058,.379227,.13526,.828325,-.0675054,.379275,.150713,.828801,-.0743455,.379332,.167034,.8294,-.0815523,.379415,.184209,.830094,-.0890779,.379495,.202203,.8309,-.096736,.379555,.220945,.831943,-.104135,.379577,.240306,.833037,-.112106,.379604,.260317,.834278,-.120554,.379668,.2808,.836192,-.129128,.3799,.301654,.838671,-.137541,.380109,.323502,.840939,-.14523,.379809,.347176,.844575,-.15248,.379593,.371706,.848379,-.159607,.37909,.39688,.853616,-.166267,.378617,.422702,.858921,-.172698,.377746,.448919,.865324,-.178823,.376749,.475661,.872207,-.184542,.375363,.502599,.880018,-.189836,.373657,.529914,.88694,-.194294,.370673,.557683,.894779,-.197022,.36662,.586848,.902242,-.199108,.36138,.615831,.909914,-.200398,.355434,.644478,.917088,-.20094,.348173,.672905,.923888,-.200671,.339482,.701327,.930495,-.198773,.32956,.730101,.937247,-.195394,.318363,.758383,.943108,-.191956,.306323,.786539,.948296,-.187227,.292576,.813637,.953472,-.181165,.278234,.840793,.958485,-.174119,.263054,.867712,.962714,-.166564,.246756,.893635,.966185,-.158181,.229945,.919028,.970146,-.148275,.212633,.943413,.973491,-.138157,.195229,.966627,.975741,-.127574,.178048,.988817,.977238,-.11554,.160312,1.00924,.978411,-.10364,.142857,1.02845,.979811,-.0913122,.125317,1.04648,.98116,-.0782558,.107627,1.06284,.983543,-.0655957,.0895862,1.07798,.986789,-.0520411,.0713756,1.092,.990292,-.0389727,.053228,1.10484,.994187,-.025808,.0351945,1.11642,.997499,-.0126071,.0173198,1.12703,.999999,275604e-9,-148602e-9,1.13674,.81075,-78735e-10,.394456,161829e-10,.808692,-198293e-9,.393453,407564e-9,.80846,-792877e-9,.39334,.00162965,.808595,-.00178416,.393407,.00366711,.808597,-.00317182,.393408,.00651934,.808598,-.00495589,.393408,.0101866,.808591,-.00713627,.393403,.0146689,.808592,-.00971285,.393402,.0199667,.80861,-.0126855,.393407,.0260803,.808633,-.0160538,.393413,.0330107,.80868,-.0198175,.393429,.0407589,.808748,-.0239758,.393453,.0493264,.808854,-.0285286,.39349,.0587161,.808992,-.0334748,.39354,.0689304,.809141,-.0388116,.393588,.0799707,.809352,-.0445375,.39366,.0918432,.809608,-.0506427,.393742,.104549,.809915,-.0570708,.393834,.118085,.810253,-.0633526,.393885,.132377,.810687,-.0700966,.393953,.147537,.811233,-.0772274,.394047,.163543,.811865,-.0847629,.394148,.180394,.812648,-.0925663,.394265,.198051,.813583,-.100416,.394363,.216443,.814683,-.108119,.394402,.235502,.815948,-.11644,.394489,.255242,.817278,-.125036,.394542,.275441,.819605,-.133655,.39486,.296094,.822256,-.142682,.395248,.317309,.825349,-.150756,.395241,.340516,.829605,-.158392,.395285,.364819,.83391,-.165801,.394922,.389736,.839808,-.172677,.394691,.415409,.845708,-.179448,.394006,.441546,.853025,-.185746,.393279,.46832,.859666,-.191684,.391655,.495302,.86789,-.197146,.390068,.52262,.875845,-.201904,.38727,.550336,.882634,-.205023,.382688,.578825,.891076,-.207098,.377543,.608103,.900589,-.208474,.371752,.63723,.90791,-.209068,.364016,.665769,.915971,-.208655,.355593,.694428,.923455,-.20729,.345439,.723224,.931514,-.203821,.334099,.751925,.937885,-.19986,.321069,.780249,.943136,-.194993,.306571,.8077,.948818,-.189132,.291556,.83497,.954433,-.181617,.275745,.86188,.959078,-.173595,.258695,.888562,.962705,-.164855,.240825,.914008,.966753,-.155129,.22268,.939145,.970704,-.144241,.204542,.963393,.973367,-.133188,.185927,.985983,.975984,-.121146,.167743,1.00704,.976994,-.108366,.149218,1.02715,.978485,-.0956746,.13131,1.0455,.980074,-.0820733,.112513,1.06221,.98225,-.0684061,.0938323,1.07782,.98553,-.0549503,.0749508,1.09199,.989529,-.0407857,.055848,1.10508,.993536,-.0271978,.0368581,1.11684,.997247,-.0132716,.0181845,1.12789,1,431817e-9,-198809e-9,1.13792,.785886,-812608e-11,.405036,157669e-10,.790388,-205278e-9,.407355,398297e-9,.790145,-820824e-9,.407231,.00159263,.790135,-.00184681,.407226,.00358336,.790119,-.00328316,.407218,.00637039,.790126,-.00512988,.40722,.0099539,.79013,-.00738684,.407221,.0143339,.790135,-.0100538,.407221,.0195107,.790134,-.0131306,.407217,.0254848,.79016,-.0166169,.407224,.0322572,.790197,-.020512,.407236,.0398284,.790273,-.0248157,.407263,.0482014,.790381,-.029527,.407304,.0573777,.790521,-.0346446,.407355,.0673602,.790704,-.0401665,.40742,.0781522,.790925,-.0460896,.407499,.0897582,.791195,-.0524017,.407589,.10218,.791522,-.0590121,.407691,.11541,.791878,-.0654876,.407748,.12939,.792361,-.0725207,.407849,.144237,.792942,-.0799844,.407963,.159924,.79362,-.0877896,.408087,.176425,.794529,-.0958451,.408259,.193733,.795521,-.103827,.408362,.211756,.796778,-.111937,.408482,.230524,.798027,-.120521,.408547,.249967,.799813,-.129242,.408721,.269926,.802387,-.138048,.409148,.290338,.805279,-.147301,.409641,.311193,.809251,-.155895,.410154,.333611,.813733,-.163942,.410297,.357615,.819081,-.171666,.410373,.382339,.825427,-.178905,.410348,.407828,.83172,-.185812,.409486,.434034,.83877,-.192318,.408776,.460493,.845817,-.198249,.407176,.487346,.854664,-.204034,.405719,.514832,.863495,-.208908,.403282,.542401,.871883,-.212765,.399293,.570683,.88065,-.214911,.393803,.599947,.89004,-.216214,.387536,.62932,.898476,-.216745,.379846,.658319,.906738,-.216387,.370625,.687138,.914844,-.215053,.360139,.71601,.923877,-.212007,.348849,.745124,.931925,-.207481,.335639,.773366,.938054,-.202418,.320798,.801636,.943895,-.196507,.304772,.829055,.949468,-.189009,.288033,.856097,.955152,-.180539,.270532,.88301,.959403,-.171437,.251639,.909296,.963309,-.161661,.232563,.934868,.967399,-.150425,.213231,.959662,.972009,-.138659,.194247,.98302,.97433,-.126595,.174718,1.00517,.975823,-.113205,.155518,1.02566,.976371,-.0996096,.136709,1.04418,.978705,-.0860754,.117571,1.06146,.981477,-.0714438,.0980046,1.07777,.984263,-.0572304,.0782181,1.09214,.988423,-.0428875,.0584052,1.10553,.993,-.0282442,.038522,1.11758,.99704,-.0140183,.0190148,1.12864,.999913,369494e-9,-145203e-9,1.13901,.777662,-84153e-10,.423844,154403e-10,.770458,-211714e-9,.419915,38845e-8,.770716,-846888e-9,.420055,.00155386,.770982,-.00190567,.420202,.00349653,.770981,-.00338782,.420201,.00621606,.77098,-.00529338,.4202,.00971274,.770983,-.00762223,.4202,.0139867,.770985,-.0103741,.420198,.0190381,.770996,-.0135489,.4202,.0248677,.771029,-.0171461,.420212,.0314764,.771052,-.0211647,.420215,.0388648,.771131,-.0256048,.420245,.047036,.771235,-.0304647,.420284,.0559911,.771383,-.0357436,.420341,.0657346,.771591,-.0414392,.420423,.0762694,.771819,-.0475462,.420506,.0875984,.772123,-.0540506,.420617,.099727,.772464,-.060797,.42072,.112637,.772855,-.0675393,.420799,.126313,.773317,-.0748323,.420893,.140824,.773981,-.0825681,.421058,.15617,.774746,-.0906307,.421226,.172322,.77566,-.0988982,.421397,.189253,.776837,-.106994,.421569,.206912,.778097,-.115528,.421704,.225359,.779588,-.124317,.421849,.24447,.781574,-.133139,.422097,.264156,.784451,-.142179,.422615,.284318,.787682,-.15165,.423269,.304902,.792433,-.160771,.424396,.3265,.797359,-.169166,.424772,.35014,.803986,-.177149,.425475,.374768,.809504,-.184745,.424996,.399928,.815885,-.19173,.424247,.425796,.823513,-.198525,.423515,.452287,.832549,-.204709,.422787,.479321,.841653,-.210447,.421187,.506718,.850401,-.215501,.418519,.53432,.859854,-.219752,.414715,.56242,.869364,-.222305,.409462,.591558,.878837,-.223744,.402926,.621074,.888636,-.224065,.395043,.650538,.898132,-.223742,.38564,.679538,.907181,-.222308,.375378,.708674,.915621,-.219837,.363212,.737714,.9239,-.215233,.349313,.767014,.931644,-.209592,.334162,.795133,.938887,-.203644,.317943,.823228,.945282,-.196349,.300581,.850822,.950758,-.18742,.282195,.877594,.956146,-.177879,.262481,.904564,.960355,-.167643,.242487,.930741,.965256,-.156671,.222668,.955868,.968029,-.144123,.201907,.979869,.97251,-.131305,.18202,1.00291,.974925,-.118335,.161909,1.02392,.975402,-.103714,.142129,1.0433,.976987,-.089415,.122447,1.06089,.979677,-.0748858,.102248,1.07713,.983184,-.0596086,.0814851,1.09218,.987466,-.0447671,.0609484,1.10585,.992348,-.0295217,.0401835,1.11829,.996674,-.0143917,.0198163,1.12966,1.00003,321364e-9,-149983e-9,1.1402,.757901,-869074e-11,.436176,151011e-10,.751195,-217848e-9,.432317,378533e-9,.751178,-871373e-9,.432307,.0015141,.751195,-.00196061,.432317,.0034068,.751198,-.00348552,.432318,.00605659,.751195,-.00544599,.432315,.00946353,.751207,-.00784203,.43232,.013628,.751213,-.0106732,.43232,.0185499,.751221,-.0139393,.432319,.0242302,.751244,-.0176398,.432325,.0306694,.7513,-.0217743,.432348,.0378698,.751358,-.0263412,.432367,.0458321,.751458,-.0313396,.432404,.0545587,.751608,-.0367682,.432464,.0640543,.7518,-.0426246,.43254,.0743222,.752065,-.0489031,.432645,.0853668,.752376,-.0555828,.432762,.0971911,.752715,-.0623861,.432859,.109768,.753137,-.069415,.432958,.123126,.753676,-.0770039,.433099,.137308,.754345,-.084971,.433272,.15229,.755235,-.0932681,.433504,.168075,.756186,-.10171,.433693,.184625,.757363,-.110019,.433857,.201897,.75884,-.11887,.434102,.220014,.760467,-.127881,.434306,.238778,.762969,-.136766,.434751,.258172,.765823,-.14612,.43529,.278062,.769676,-.15566,.436236,.298437,.774909,-.165177,.437754,.319532,.77994,-.17402,.438343,.342505,.785757,-.182201,.438609,.366693,.792487,-.190104,.438762,.391668,.80038,-.197438,.438795,.417494,.808494,-.204365,.438226,.443933,.817695,-.210714,.437283,.470929,.828111,-.216651,.436087,.498569,.837901,-.221804,.433717,.526165,.847813,-.226318,.430133,.554155,.858314,-.229297,.425213,.582822,.868891,-.230999,.418576,.612847,.878941,-.231155,.410405,.642445,.888809,-.230935,.400544,.672024,.898089,-.229343,.389613,.701366,.908081,-.226886,.377197,.730763,.916819,-.222676,.363397,.759642,.924968,-.216835,.347437,.788775,.932906,-.210245,.32995,.817135,.940025,-.202992,.312262,.844912,.946101,-.19436,.293313,.872164,.952835,-.184125,.273638,.899443,.957347,-.173657,.252385,.926389,.961434,-.162204,.231038,.951947,.965522,-.14979,.209834,.976751,.969412,-.136307,.188821,1.00022,.973902,-.122527,.168013,1.02229,.974045,-.108213,.147634,1.04199,.975775,-.0927397,.12705,1.06019,.978383,-.0778212,.106309,1.07711,.98211,-.0621216,.0849279,1.09245,.986517,-.0463847,.0633519,1.10651,.991696,-.0309353,.0419698,1.11903,.996349,-.0150914,.0206272,1.13073,1.00003,442449e-9,-231396e-9,1.14146,.727498,-885074e-11,.441528,145832e-10,.730897,-223525e-9,.443589,368298e-9,.730796,-893996e-9,.443528,.00147303,.730805,-.00201149,.443533,.00331433,.730814,-.00357596,.443538,.00589222,.730815,-.00558734,.443538,.00920678,.730822,-.00804544,.44354,.0132582,.730836,-.0109501,.443545,.0180468,.730848,-.0143008,.443546,.0235732,.730871,-.0180969,.443552,.0298382,.730915,-.022338,.443567,.0368438,.730982,-.0270225,.443591,.044591,.731076,-.0321491,.443627,.0530831,.731245,-.0377166,.443699,.0623243,.73144,-.0437216,.443777,.0723181,.7317,-.0501576,.443881,.0830691,.732034,-.0569942,.444014,.0945809,.732388,-.0638756,.444113,.106825,.732853,-.071203,.444247,.119859,.733473,-.0790076,.444442,.13369,.734195,-.0871937,.444645,.148304,.735069,-.095696,.444877,.163702,.736169,-.10426,.445133,.179861,.73747,-.112853,.44537,.196778,.738991,-.12199,.445651,.214496,.740865,-.131153,.445958,.232913,.743637,-.140245,.446548,.251977,.746797,-.149722,.447246,.271551,.751517,-.159341,.448656,.291774,.756156,-.169106,.449866,.312455,.761519,-.178436,.450919,.334552,.768295,-.186904,.451776,.358491,.776613,-.195117,.452832,.383446,.783966,-.202695,.45249,.408945,.793542,-.20985,.452587,.435364,.803192,-.216403,.451852,.462336,.813892,-.22251,.450708,.48987,.824968,-.227676,.4486,.517697,.835859,-.232443,.445156,.545975,.846825,-.235775,.440351,.574483,.858085,-.237897,.433641,.604246,.868825,-.238074,.425354,.634101,.879638,-.237661,.415383,.664201,.889966,-.236186,.404136,.693918,.899479,-.233599,.390917,.723481,.908769,-.229737,.376352,.75258,.917966,-.223836,.360372,.781764,.926304,-.217067,.342551,.811139,.934626,-.209309,.324238,.839585,.941841,-.20071,.304484,.867044,.94789,-.190602,.283607,.894579,.954196,-.179253,.262205,.921743,.958383,-.167646,.239847,.948026,.963119,-.155073,.218078,.973296,.966941,-.141426,.195899,.998135,.970836,-.126849,.174121,1.02021,.973301,-.112296,.153052,1.04085,.97448,-.0964965,.131733,1.05946,.977045,-.080489,.10997,1.07693,.980751,-.064844,.0881657,1.09254,.985475,-.0481938,.0657987,1.10697,.991089,-.0319185,.0435215,1.12004,.996122,-.0158088,.0214779,1.13173,1.00001,372455e-9,-200295e-9,1.14291,.708622,-907597e-11,.45304,141962e-10,.711162,-228911e-9,.454662,358052e-9,.709812,-914446e-9,.453797,.00143034,.709865,-.00205819,.453834,.00321935,.709864,-.00365894,.453833,.00572331,.709855,-.00571692,.453826,.00894278,.709862,-.00823201,.453828,.012878,.709875,-.011204,.453832,.0175295,.709896,-.0146323,.453839,.0228978,.709925,-.0185163,.453847,.0289839,.709974,-.0228551,.453866,.0357894,.710045,-.0276473,.453892,.0433161,.710133,-.032891,.453924,.0515665,.710292,-.0385851,.453992,.0605458,.710485,-.0447254,.45407,.0702574,.710769,-.0513051,.454192,.0807077,.711106,-.0582733,.454329,.091896,.711516,-.0652866,.45446,.103814,.712071,-.0728426,.454653,.116508,.712676,-.0808307,.45484,.129968,.713476,-.0892216,.455096,.144206,.714377,-.0979047,.455346,.159212,.715579,-.106531,.455647,.174973,.716977,-.115492,.455961,.191504,.71862,-.124821,.456315,.208835,.72084,-.134079,.4568,.226869,.723786,-.143427,.457521,.245582,.727464,-.153061,.458475,.264957,.732771,-.162768,.460239,.284948,.736515,-.172627,.460899,.30522,.743519,-.182487,.463225,.326717,.750041,-.191295,.464027,.350113,.758589,-.199746,.465227,.374782,.767703,-.207584,.465877,.400226,.777484,-.214973,.465996,.426442,.788792,-.221796,.466019,.453688,.800194,-.228038,.465083,.481246,.811234,-.233346,.462506,.509086,.822859,-.238073,.459257,.537338,.835082,-.241764,.454863,.566108,.846332,-.244241,.448163,.595126,.858355,-.244736,.439709,.625574,.87034,-.244278,.429837,.65617,.881027,-.24255,.418002,.686029,.891007,-.239912,.404325,.716039,.900874,-.236133,.389222,.745518,.911072,-.230672,.373269,.775026,.920359,-.22356,.355083,.804521,.928604,-.215591,.335533,.834045,.937175,-.206503,.315278,.861612,.942825,-.196684,.293653,.889131,.949805,-.185116,.271503,.916853,.955535,-.172703,.248821,.943541,.959843,-.159978,.225591,.970132,.964393,-.146375,.202719,.994709,.968008,-.131269,.179928,1.0186,.971013,-.11569,.158007,1.03928,.973334,-.1003,.13624,1.05887,.975775,-.0833352,.1138,1.07652,.979579,-.0668981,.0913141,1.09297,.984323,-.0500902,.0683051,1.10734,.990351,-.0332377,.0451771,1.12084,.995823,-.0161491,.0221705,1.13296,1.0001,234083e-9,-108712e-9,1.14441,.683895,-924677e-11,.46015,137429e-10,.68833,-233383e-9,.463134,346865e-9,.688368,-933547e-9,.463159,.00138748,.688367,-.00210049,.463159,.00312187,.688369,-.00373415,.463159,.00555004,.688377,-.00583449,.463163,.00867216,.688386,-.00840128,.463166,.0124884,.688398,-.0114343,.463169,.0169993,.688418,-.0149329,.463175,.0222054,.688453,-.0188964,.463188,.028108,.688515,-.0233239,.463214,.0347085,.68857,-.0282136,.463231,.0420091,.688679,-.033564,.463276,.0500132,.688854,-.0393733,.463356,.0587255,.689038,-.0456354,.46343,.0681476,.689321,-.0523433,.463553,.0782897,.689662,-.059412,.463693,.0891501,.690188,-.0665736,.4639,.100735,.690755,-.0743106,.464107,.113074,.691405,-.0824722,.464329,.126161,.692198,-.0910484,.464585,.140007,.693196,-.0998778,.464893,.154612,.69454,-.108651,.465285,.169984,.695921,-.117855,.465596,.186106,.697749,-.12734,.466056,.203034,.700375,-.136714,.466771,.220703,.703395,-.146386,.467579,.239062,.707904,-.156096,.469067,.258188,.711673,-.165904,.469851,.277759,.717489,-.175812,.471815,.297935,.724051,-.185931,.47389,.318916,.731965,-.195238,.47587,.341591,.741151,-.204021,.477523,.366062,.751416,-.212113,.478881,.391396,.761848,-.21979,.479226,.417599,.771886,-.2267,.478495,.444401,.783998,-.232991,.477622,.472084,.796523,-.238645,.475833,.500193,.808851,-.243396,.472568,.52865,.821191,-.247226,.467857,.557362,.834261,-.250102,.461871,.586768,.846762,-.251056,.453543,.617085,.859867,-.250604,.443494,.647659,.871948,-.248783,.431711,.678119,.882967,-.245855,.417911,.708399,.892826,-.242168,.401993,.738256,.90332,-.237062,.385371,.767999,.913633,-.22997,.366837,.798191,.922774,-.221687,.346372,.827756,.931371,-.212345,.325682,.856425,.938929,-.20206,.303665,.884299,.944821,-.190981,.280786,.912023,.951792,-.178065,.2573,.939669,.957712,-.164634,.233448,.96655,.961912,-.150863,.209504,.992366,.966382,-.13577,.18597,1.01633,.969588,-.119593,.162905,1.03843,.971777,-.103203,.14053,1.05841,.97433,-.0865888,.117909,1.07632,.978686,-.0690829,.0944101,1.09326,.983281,-.0516568,.0705671,1.10796,.989562,-.034558,.0468592,1.12182,.995465,-.0167808,.0229846,1.1342,.999991,373016e-9,-235606e-9,1.1459,.662251,-939016e-11,.468575,132714e-10,.666634,-237624e-9,.471675,335842e-9,.666411,-950385e-9,.471516,.00134321,.666399,-.00213833,.471509,.00302221,.666386,-.0038014,.471499,.00537283,.666405,-.00593958,.471511,.00839533,.666406,-.00855253,.471508,.0120898,.666428,-.0116401,.471519,.0164569,.666444,-.0152015,.471522,.0214971,.66649,-.0192362,.471543,.027212,.666537,-.0237428,.471558,.033603,.666617,-.0287198,.471591,.0406728,.666718,-.0341647,.471631,.0484238,.666889,-.0400759,.47171,.0568621,.667104,-.0464479,.471805,.0659915,.667374,-.0532677,.471923,.0758178,.667772,-.0603805,.472098,.0863425,.668371,-.0677392,.472363,.0975917,.668971,-.0756028,.472596,.109567,.669696,-.0839293,.472869,.122272,.670481,-.0926683,.473126,.135718,.6715,-.1016,.473442,.149914,.672911,-.110566,.47389,.164882,.674512,-.119984,.474354,.180602,.67651,-.129574,.474922,.19711,.679292,-.139106,.475764,.214371,.682798,-.148993,.476886,.232405,.686955,-.158737,.478179,.251153,.691406,-.168754,.479432,.270436,.697438,-.178703,.481481,.290374,.704761,-.188955,.484143,.311044,.713599,-.198814,.487007,.333003,.723194,-.207869,.488962,.357144,.732601,-.216189,.489815,.382169,.744193,-.22398,.490888,.408227,.754907,-.231156,.490355,.434928,.767403,-.23747,.489548,.462599,.78107,-.243503,.488274,.490908,.793893,-.248114,.484843,.519421,.807296,-.25222,.4803,.548561,.820529,-.255265,.474097,.577772,.833716,-.256741,.466041,.607782,.848403,-.25637,.456547,.638807,.860755,-.254804,.443946,.670058,.874012,-.251834,.430852,.700749,.885619,-.247867,.414903,.731446,.896069,-.242634,.397276,.761191,.906266,-.236093,.378535,.791053,.916759,-.227543,.358038,.821298,.92523,-.21783,.335705,.850747,.93436,-.207534,.313797,.879258,.941631,-.195983,.289671,.907734,.947564,-.183567,.265319,.935206,.953681,-.169345,.240815,.962739,.960008,-.154909,.216119,.989227,.964145,-.140161,.192096,1.01465,.968171,-.123411,.167855,1.03737,.969859,-.106525,.144817,1.05767,.972666,-.0891023,.12149,1.0761,.977055,-.0718094,.0975306,1.09336,.982527,-.0534213,.0730217,1.10878,.989001,-.0355579,.0483366,1.12285,.99512,-.0176383,.023938,1.13548,1.00007,368831e-9,-211581e-9,1.14744,.651047,-960845e-11,.484101,12922e-9,.644145,-241347e-9,.478968,324578e-9,.64396,-965142e-9,.478831,.00129798,.64396,-.00217154,.47883,.00292046,.643968,-.00386049,.478835,.00519202,.643974,-.00603186,.478838,.0081128,.643977,-.0086854,.478836,.011683,.643982,-.0118207,.478834,.0159031,.644024,-.0154374,.478856,.0207743,.644059,-.0195343,.478868,.0262975,.644122,-.0241103,.478896,.0324747,.644207,-.0291638,.478933,.039309,.64432,-.0346919,.478981,.0468029,.644481,-.0406919,.479053,.0549614,.644722,-.047159,.479169,.0637909,.645013,-.0540748,.479302,.0732974,.645503,-.0612001,.479541,.0834898,.646117,-.0687303,.479829,.0943873,.646707,-.0767846,.480061,.105991,.647431,-.0852465,.480343,.11831,.64831,-.0940719,.48066,.131348,.649486,-.103056,.481083,.14514,.650864,-.112261,.481528,.159676,.652604,-.121852,.482102,.174979,.654825,-.131505,.482813,.191079,.657876,-.141189,.483876,.207927,.661339,-.151239,.48499,.225586,.665463,-.161091,.486279,.243947,.670542,-.171235,.487968,.262957,.677361,-.181347,.49053,.282781,.685672,-.191679,.493862,.303311,.694551,-.201781,.49699,.324607,.703753,-.211164,.498884,.347916,.713703,-.219675,.500086,.372628,.725911,-.227836,.501554,.398694,.73862,-.23533,.502193,.425529,.752118,-.241786,.501811,.453209,.76579,-.247865,.500185,.481381,.779568,-.252696,.497159,.51011,.793991,-.256802,.492765,.539322,.808182,-.259942,.486827,.569078,.821698,-.261703,.478386,.598818,.836009,-.262006,.468772,.629762,.849824,-.260333,.456352,.661366,.863888,-.257398,.442533,.69295,.876585,-.253264,.426573,.723608,.888665,-.248026,.408964,.754378,.899537,-.241487,.389677,.784761,.9094,-.233463,.368516,.814688,.920166,-.223397,.346624,.845009,.928899,-.21255,.322717,.874431,.937156,-.200869,.298698,.902922,.943861,-.188387,.273491,.931356,.949557,-.174341,.247866,.958854,.955862,-.158994,.222496,.986098,.961721,-.143664,.197522,1.01229,.965976,-.127412,.17302,1.03571,.968652,-.109798,.148954,1.05699,.971084,-.0916787,.125044,1.07587,.975584,-.0739634,.100577,1.09372,.98122,-.055322,.0753666,1.10948,.988253,-.0366825,.0498899,1.12394,.99482,-.0180389,.024611,1.13694,1.00001,229839e-9,-188283e-9,1.14919,.613867,-964198e-11,.479449,123452e-10,.621485,-244534e-9,.485399,313091e-9,.621429,-978202e-9,.485353,.00125245,.62112,-.00220004,.485114,.00281687,.621119,-.0039111,.485112,.00500783,.621122,-.00611091,.485112,.00782498,.621133,-.00879922,.485117,.0112687,.621152,-.0119756,.485125,.0153394,.621183,-.0156396,.485139,.0200382,.621227,-.0197898,.485158,.0253663,.621298,-.0244253,.485192,.0313261,.621388,-.0295441,.485233,.0379204,.621507,-.0351432,.485286,.0451523,.621693,-.0412198,.485378,.0530277,.621933,-.0477673,.485495,.0615522,.622232,-.0547574,.485635,.0707316,.622809,-.0619417,.485943,.0805883,.623407,-.069625,.486232,.0911267,.62406,-.077796,.486516,.102354,.624835,-.0863731,.486838,.114279,.625758,-.095251,.487188,.126902,.627043,-.104299,.487695,.140285,.628438,-.113724,.488163,.154397,.630325,-.123417,.488858,.169267,.632801,-.133137,.489754,.184941,.635784,-.143052,.490815,.20136,.639406,-.153132,.492048,.218643,.643872,-.163143,.49363,.236615,.6499,-.17333,.496009,.255449,.657201,-.183622,.498994,.275006,.666221,-.194019,.502888,.295354,.674419,-.204192,.505459,.316244,.683729,-.21406,.507771,.33849,.695584,-.222854,.510245,.363166,.708583,-.231315,.512293,.389071,.721233,-.238911,.512747,.415737,.735134,-.245657,.512482,.443331,.750179,-.251879,.511526,.471891,.765073,-.256911,.508935,.500892,.779794,-.261144,.504341,.530294,.794801,-.264316,.498515,.560144,.810339,-.266276,.491015,.590213,.824818,-.266981,.481126,.620865,.839375,-.265778,.468685,.652687,.853043,-.262748,.453925,.684759,.867335,-.258474,.437912,.716209,.88037,-.253187,.419648,.747508,.891711,-.246476,.39982,.77797,.902896,-.238735,.37879,.808586,.913601,-.22885,.355891,.838843,.923019,-.217656,.331773,.869014,.933432,-.205539,.307356,.898512,.939691,-.192595,.281321,.9269,.946938,-.178945,.255441,.955297,.952372,-.163587,.229013,.983231,.95909,-.147214,.203179,1.00971,.963675,-.13064,.17792,1.03438,.968247,-.113121,.152898,1.05625,.97001,-.0945824,.128712,1.07598,.974458,-.0755648,.103349,1.094,.980168,-.0571998,.0776731,1.1104,.987295,-.0377994,.0514445,1.12491,.994432,-.0186417,.025429,1.13851,.999975,542714e-9,-282356e-9,1.15108,.592656,-980249e-11,.486018,119532e-10,.598467,-247275e-9,.490781,301531e-9,.597934,-988317e-9,.490343,.00120517,.597903,-.00222366,.490319,.0027116,.597913,-.00395315,.490327,.00482077,.597919,-.00617653,.490329,.00753264,.597936,-.00889375,.490339,.0108478,.597956,-.0121043,.490347,.0147668,.597992,-.0158073,.490365,.0192905,.598032,-.0200017,.490382,.0244204,.598109,-.0246865,.49042,.0301593,.598215,-.0298594,.490474,.03651,.59833,-.0355167,.490524,.0434757,.598525,-.0416559,.490624,.0510629,.598778,-.0482692,.490753,.0592781,.599135,-.0553114,.49094,.0681304,.599802,-.062542,.491328,.0776467,.600361,-.0703638,.491598,.0878184,.60101,-.0786256,.491882,.0986573,.601811,-.0872962,.492232,.11018,.602861,-.0962284,.492684,.1224,.604167,-.10538,.493213,.135354,.605693,-.114896,.493799,.149034,.607682,-.124654,.494576,.163469,.610672,-.13456,.4959,.178747,.613313,-.144581,.496713,.194723,.617603,-.154703,.498499,.211617,.622174,-.16489,.500188,.229183,.628855,-.175164,.503072,.247786,.636963,-.185565,.506798,.267116,.644866,-.195911,.509719,.28702,.653741,-.206104,.512776,.307763,.664942,-.216447,.516812,.329631,.67633,-.22552,.519181,.353515,.690012,-.234316,.521681,.379226,.704243,-.242032,.523129,.405901,.719396,-.249172,.523768,.433585,.734471,-.255543,.522541,.462085,.750539,-.260697,.520217,.491233,.766365,-.26501,.516293,.521094,.781677,-.268409,.509708,.551014,.797132,-.270399,.501944,.581463,.812655,-.271247,.492025,.612402,.828592,-.270708,.480424,.643798,.844044,-.268085,.465955,.67682,.857305,-.263459,.448425,.708496,.87114,-.258151,.430243,.74046,.884936,-.251171,.410578,.771583,.895772,-.243305,.38862,.802234,.906961,-.234037,.365214,.833179,.917775,-.222714,.34116,.86353,.927883,-.210175,.31572,.893557,.936617,-.196925,.289159,.922976,.943384,-.182788,.261996,.951606,.949713,-.167965,.235324,.979958,.955818,-.151109,.208408,1.00765,.961344,-.133834,.182591,1.03329,.965469,-.115987,.156958,1.0557,.968693,-.09746,.132239,1.07583,.973165,-.0778514,.106195,1.09451,.979387,-.0585067,.0797669,1.11137,.98671,-.0390409,.0530263,1.12643,.994093,-.019408,.0263163,1.14016,1.00002,540029e-9,-194487e-9,1.15299,.574483,-989066e-11,.494533,114896e-10,.574478,-249127e-9,.494528,289403e-9,.574607,-996811e-9,.494637,.00115797,.574396,-.00224241,.494458,.00260498,.574377,-.00398632,.49444,.00463102,.574386,-.00622836,.494445,.00723623,.574401,-.0089683,.494453,.010421,.574419,-.0122056,.49446,.0141859,.574459,-.0159396,.494481,.0185322,.574525,-.0201692,.49452,.0234617,.574587,-.0248924,.494547,.0289762,.574697,-.0301074,.494604,.0350797,.574853,-.0358114,.494688,.0417767,.575027,-.041999,.494772,.0490718,.575294,-.0486618,.494915,.0569728,.575733,-.0557148,.495173,.0654955,.576356,-.0630489,.495537,.0746612,.576944,-.0709285,.495836,.0844615,.57765,-.0792723,.496177,.0949142,.578491,-.0880167,.496563,.10603,.579639,-.0969462,.497096,.117841,.580989,-.10622,.497684,.130367,.582587,-.115861,.498337,.143609,.584951,-.125605,.499414,.157625,.587602,-.135608,.500518,.172413,.59076,-.145742,.501767,.187999,.594992,-.155934,.503542,.20445,.600656,-.166303,.506135,.221764,.607816,-.176681,.509542,.24002,.61522,-.187071,.51263,.258992,.623702,-.197465,.516021,.278773,.634192,-.207816,.520422,.299377,.644936,-.218183,.524073,.320802,.657888,-.2278,.528049,.34384,.670666,-.236747,.52986,.36916,.685626,-.24484,.531892,.395867,.701304,-.252071,.532727,.423488,.717727,-.258714,.532146,.452201,.733914,-.264211,.529883,.481579,.750529,-.26859,.5259,.511558,.76747,-.272046,.51999,.542042,.785189,-.274225,.513083,.572799,.800954,-.275189,.502936,.603816,.816962,-.274946,.490921,.635461,.83336,-.272695,.47684,.6676,.848143,-.268223,.459405,.70051,.861818,-.262768,.440319,.732902,.876828,-.255872,.420123,.765084,.889312,-.247703,.398379,.796391,.900412,-.238381,.374496,.827333,.912251,-.227783,.349874,.858385,.921792,-.214832,.323181,.888652,.931273,-.200949,.296624,.917763,.940295,-.186537,.269211,.947878,.946812,-.171538,.241447,.977016,.953588,-.155254,.213829,1.00501,.958841,-.137156,.186807,1.03179,.963746,-.118699,.160706,1.05502,.966468,-.0998358,.135504,1.07568,.971178,-.0805186,.109131,1.09479,.97831,-.0599348,.0818293,1.1123,.985886,-.0399661,.0545872,1.12771,.994021,-.0198682,.0269405,1.14186,1.00009,271022e-9,-12989e-8,1.15514,.538716,-990918e-11,.486732,109675e-10,.550656,-250642e-9,.497518,277412e-9,.55057,-.00100265,.497441,.00110974,.550903,-.00225672,.497733,.00249779,.550568,-.00401046,.497438,.00443906,.550574,-.00626613,.49744,.00693637,.550591,-.0090226,.497449,.00998921,.550623,-.0122795,.497469,.0135984,.550667,-.0160361,.497495,.0177654,.550724,-.0202908,.497526,.0224915,.550792,-.0250421,.497557,.0277795,.550918,-.0302878,.49763,.0336334,.551058,-.0360241,.497701,.0400573,.551276,-.0422473,.497824,.0470585,.551551,-.0489441,.497977,.0546433,.552074,-.0559596,.498312,.0628367,.552681,-.0633978,.498679,.071646,.553324,-.0713176,.499031,.0810746,.554011,-.0797268,.499365,.091129,.55488,-.0885238,.499779,.101837,.556171,-.0974417,.500444,.113239,.557498,-.106841,.501025,.125316,.559299,-.116533,.501864,.138128,.561647,-.126298,.502967,.151695,.564347,-.136388,.504129,.16604,.567863,-.146576,.505713,.181207,.572569,-.156832,.507953,.197259,.578919,-.167323,.511186,.214258,.585387,-.177712,.514042,.232038,.593134,-.188184,.517484,.250733,.603295,-.198717,.522345,.270454,.613854,-.209177,.526751,.290807,.626092,-.219644,.531595,.312202,.637868,-.229494,.534721,.334435,.652458,-.238718,.538304,.359184,.666985,-.247061,.539875,.385637,.683301,-.254652,.541042,.41328,.69998,-.261376,.540735,.441903,.717824,-.267085,.539139,.471609,.734617,-.271465,.534958,.501446,.753663,-.27528,.53032,.532571,.770512,-.277617,.522134,.563641,.787356,-.278525,.51206,.595067,.806252,-.278512,.50119,.627226,.822061,-.277023,.486791,.659402,.838959,-.273175,.470467,.692874,.85379,-.267238,.450688,.725702,.868268,-.260327,.429741,.75832,.881994,-.251946,.407223,.790189,.893885,-.242432,.383214,.821625,.905118,-.231904,.357297,.853011,.916045,-.219545,.330733,.883773,.927614,-.205378,.303916,.914435,.936005,-.190388,.275941,.944502,.944533,-.1749,.247493,.974439,.950758,-.158588,.218996,1.00286,.957078,-.141027,.191559,1.0304,.962448,-.121507,.164457,1.05466,.964993,-.102068,.138636,1.0761,.970017,-.0822598,.111861,1.09541,.97661,-.062033,.0843438,1.11317,.985073,-.0409832,.0558496,1.12911,.993515,-.020146,.0275331,1.1438,1.00006,27329e-8,-107883e-9,1.15736,.525324,-999341e-11,.498153,105385e-10,.526513,-251605e-9,.499277,265329e-9,.526517,-.00100641,.499282,.0010613,.526588,-.00226466,.499337,.00238823,.526539,-.0040255,.499302,.00424535,.526547,-.00628954,.499306,.00663364,.526561,-.00905628,.499313,.00955337,.526593,-.0123253,.499334,.0130054,.526642,-.0160957,.499365,.0169911,.5267,-.0203661,.499396,.0215122,.526792,-.0251347,.499451,.0265718,.526904,-.0303985,.499511,.0321732,.527079,-.0361554,.499617,.0383231,.527285,-.0423982,.499731,.045026,.527602,-.0491121,.499924,.0522936,.528166,-.0561127,.500306,.0601528,.52879,-.0635988,.5007,.0686059,.529421,-.071581,.501048,.0776518,.530144,-.0799854,.501421,.0873148,.531062,-.0888032,.501884,.0976084,.532374,-.0977643,.50259,.108588,.533828,-.107197,.50329,.120234,.53581,-.116887,.504312,.132602,.538063,-.126755,.505365,.145721,.5409,-.136819,.506668,.159617,.544882,-.147117,.508731,.174369,.550238,-.157446,.511601,.190028,.556038,-.167988,.514431,.206587,.563031,-.178364,.517808,.224046,.571543,-.189007,.521937,.242503,.582255,-.199546,.527415,.261977,.59272,-.210084,.531682,.282162,.605648,-.220448,.537123,.303426,.61785,-.230593,.540664,.325323,.632223,-.240238,.544467,.348993,.648819,-.24887,.547594,.375462,.665825,-.256657,.54912,.403024,.683389,-.263711,.549294,.431773,.701495,-.269666,.547649,.461494,.719197,-.274169,.543786,.491623,.737906,-.278124,.538644,.522994,.756652,-.280632,.531057,.554775,.775279,-.281741,.521972,.586441,.792688,-.281652,.509613,.618596,.811894,-.280345,.496497,.651462,.827938,-.277128,.47968,.684023,.844837,-.271646,.460688,.718024,.859239,-.264397,.438872,.751207,.874088,-.256144,.41577,.784232,.887693,-.246311,.391369,.816191,.899402,-.235497,.365872,.847828,.910973,-.223631,.338618,.87934,.92204,-.209874,.310803,.910325,.930987,-.194265,.281802,.940695,.94,-.178125,.252836,.970958,.948018,-.161479,.224239,1.00078,.955141,-.144038,.195857,1.0288,.960513,-.124915,.168487,1.05371,.963964,-.104284,.141495,1.07596,.968713,-.0838732,.114437,1.09628,.975524,-.0635579,.0863105,1.11448,.98431,-.042291,.0574774,1.13069,.992916,-.0209131,.0284343,1.14568,.999926,743097e-9,-379265e-9,1.15955,.501042,-998428e-11,.498726,100306e-10,.502992,-252112e-9,.500665,253283e-9,.502417,-.00100791,.500092,.00101259,.502965,-.00226919,.500621,.00227978,.502318,-.00403109,.499994,.00405011,.502333,-.00629832,.500005,.00632868,.502362,-.00906907,.500027,.00911446,.502369,-.0123423,.500023,.0124078,.50243,-.0161178,.500066,.016211,.502493,-.0203937,.500103,.0205256,.502592,-.0251684,.500166,.0253548,.502707,-.0304389,.50023,.0307029,.502881,-.0362015,.500335,.0365753,.503124,-.0424507,.500488,.0429798,.503443,-.0491582,.500686,.0499268,.504083,-.0561476,.501155,.0574541,.504668,-.0636846,.501524,.0655408,.505319,-.0716834,.501904,.0742072,.50609,-.0800925,.502321,.0834699,.507122,-.0888425,.502896,.0933603,.508414,-.097855,.503603,.10391,.509955,-.107304,.504416,.115113,.512061,-.116921,.505565,.127054,.514419,-.12689,.506732,.139709,.517529,-.136934,.508338,.153173,.522085,-.147327,.510987,.167528,.526986,-.157612,.513527,.182708,.533122,-.168213,.516717,.198881,.540807,-.178688,.520832,.215986,.550687,-.189511,.52632,.234335,.560567,-.199998,.531009,.253375,.571698,-.210652,.535839,.273499,.584364,-.220917,.541091,.294355,.599066,-.23137,.546875,.316525,.614148,-.241206,.551306,.339671,.631157,-.250379,.555187,.36531,.647919,-.258397,.556595,.392767,.666112,-.265528,.556949,.421397,.686158,-.271827,.556617,.451433,.704838,-.27674,.552975,.482131,.723957,-.280733,.547814,.513458,.74262,-.283359,.53997,.545446,.762009,-.284541,.530422,.57775,.781314,-.284507,.518546,.610434,.799116,-.283309,.504178,.643178,.817604,-.280378,.48843,.676248,.83459,-.275619,.469457,.709698,.850974,-.26856,.447698,.744245,.866747,-.260094,.424791,.777695,.881412,-.249929,.399913,.810392,.8936,-.239137,.37308,.842872,.905943,-.226818,.345705,.874677,.916408,-.213699,.31706,.906257,.927215,-.198428,.288444,.936881,.935625,-.181643,.258329,.96795,.944076,-.164386,.228488,.998216,.951229,-.146339,.199763,1.02689,.958793,-.127709,.172153,1.0535,.963219,-.107244,.144989,1.07646,.967562,-.0857764,.11685,1.09675,.974866,-.0645377,.0880571,1.11576,.983353,-.0431732,.0587352,1.13227,.992503,-.0218356,.0294181,1.1478,1.00003,605203e-9,-231013e-9,1.16207,.482935,-101177e-10,.504695,968142e-11,.477554,-251521e-9,.499071,240676e-9,.477904,-.00100683,.499436,96342e-8,.478368,-.00226636,.499899,.0021687,.477977,-.00402719,.499513,.00385384,.477993,-.00629226,.499525,.0060221,.478011,-.00906011,.499536,.00867289,.478051,-.0123305,.499566,.0118074,.478089,-.016102,.499587,.0154269,.478171,-.0203736,.499645,.0195341,.478254,-.025143,.499692,.0241318,.47839,-.0304071,.499779,.0292247,.478588,-.0361631,.499911,.0348196,.478812,-.0424023,.500046,.0409231,.479208,-.0490724,.500326,.047552,.479841,-.0560722,.500805,.0547377,.480392,-.0636125,.501152,.0624607,.481068,-.0716134,.501561,.0707473,.481898,-.0800062,.502054,.0796118,.483022,-.0886568,.502728,.0890974,.484332,-.0977553,.503479,.0992099,.486126,-.107173,.504546,.10999,.488066,-.11677,.50557,.121476,.490521,-.126725,.506849,.133672,.494232,-.136793,.50911,.146731,.498302,-.147116,.511345,.160577,.503565,-.157446,.514344,.175335,.510902,-.168121,.518824,.191207,.519263,-.178799,.523666,.208058,.528204,-.189407,.528296,.225875,.538854,-.200145,.533724,.244782,.551278,-.210701,.539833,.264753,.565222,-.221303,.546131,.285745,.579403,-.231688,.551496,.307592,.595469,-.241718,.556809,.330582,.610929,-.250992,.559641,.354995,.629433,-.259602,.562379,.382471,.648504,-.267038,.563676,.411126,.66756,-.273388,.562092,.440924,.689143,-.278788,.560807,.472118,.709056,-.282783,.555701,.503774,.729855,-.285836,.548698,.536364,.748954,-.287078,.538544,.56895,.768373,-.287133,.526711,.601991,.78827,-.285839,.512511,.635403,.807465,-.283238,.496323,.668797,.825194,-.27906,.477638,.702584,.842203,-.272286,.456253,.736393,.857749,-.263854,.432412,.77096,.874799,-.253943,.407806,.80489,.887497,-.24237,.38033,.83771,.89966,-.230278,.352446,.870376,.911753,-.21646,.323268,.902256,.923011,-.202071,.294314,.933306,.932375,-.185519,.264104,.965177,.940537,-.167604,.234035,.996303,.948904,-.149068,.20412,1.0261,.955263,-.129539,.175431,1.05304,.960303,-.109932,.148116,1.07617,.965512,-.0880572,.119693,1.09742,.973466,-.0660548,.0901619,1.11721,.98284,-.0439228,.0599875,1.13436,.992216,-.0219588,.0298975,1.15006,.999946,119402e-9,-208547e-10,1.16471,.447827,-100414e-10,.491543,914833e-11,.454778,-251257e-9,.499172,22891e-8,.453519,-.00100342,.497787,914184e-9,.45357,-.00225776,.497847,.00205701,.453578,-.00401371,.497855,.00365705,.45357,-.00627107,.497841,.00571453,.453598,-.00902968,.497864,.00823019,.453627,-.0122888,.497882,.0112049,.453684,-.0160475,.497923,.0146405,.453764,-.0203044,.49798,.0185394,.453866,-.0250576,.498049,.0229054,.453996,-.0303028,.49813,.0277424,.454196,-.0360379,.498267,.0330587,.454457,-.0422521,.498445,.0388613,.454926,-.0488393,.498812,.0451767,.455525,-.0558653,.499272,.0520153,.456074,-.0633772,.499625,.0593754,.456752,-.0713606,.500049,.0672751,.457648,-.07971,.500615,.0757447,.458849,-.0883032,.501399,.0848231,.46029,-.0974095,.502293,.0945135,.462,-.106729,.503301,.104848,.464121,-.116354,.504533,.115884,.466889,-.126214,.506172,.127652,.470744,-.136324,.508667,.14024,.47488,-.146595,.510995,.153673,.480845,-.157027,.514832,.168053,.488262,-.167658,.519506,.183508,.496547,-.178343,.524347,.199948,.506254,-.188916,.52983,.217503,.517961,-.199975,.536357,.236272,.531484,-.210624,.543641,.256096,.545496,-.221227,.550048,.277085,.559497,-.231568,.555076,.298615,.575752,-.241698,.560541,.321547,.591999,-.251172,.564156,.345602,.610654,-.260178,.567607,.371851,.630484,-.268094,.56923,.40076,.651807,-.274661,.569779,.430801,.67239,-.280331,.566791,.461939,.693024,-.284501,.562007,.493854,.715473,-.287852,.555791,.526992,.736323,-.28929,.546345,.560102,.755771,-.289405,.534,.593543,.775424,-.2881,.519114,.627256,.795447,-.285562,.502543,.661464,.815319,-.281416,.484773,.695206,.831769,-.275523,.463445,.729044,.849464,-.267516,.440269,.764069,.866775,-.257584,.415049,.799089,.881252,-.245817,.388049,.831948,.894209,-.233127,.35889,.865526,.906922,-.219579,.329915,.89818,.919686,-.204491,.300441,.930013,.929044,-.188962,.269445,.962061,.938393,-.171079,.238402,.994214,.94661,-.15199,.208204,1.02533,.953095,-.131953,.178653,1.0529,.958644,-.111233,.150684,1.0771,.963925,-.0903098,.122359,1.09855,.971995,-.0680505,.0923342,1.11874,.981658,-.0448512,.0614195,1.13635,.991649,-.0221931,.0303582,1.15238,.999985,393403e-9,-111086e-9,1.16772,.396806,-971563e-11,.457671,842355e-11,.429186,-249421e-9,.495017,21625e-8,.429324,-998052e-9,.495173,865322e-9,.429175,-.00224487,.494999,.00194637,.429129,-.00399041,.494952,.00346004,.429153,-.00623476,.494974,.00540684,.429168,-.0089773,.494983,.00778714,.429207,-.0122175,.495012,.0106022,.429257,-.0159542,.495047,.0138535,.429338,-.0201864,.495106,.0175443,.429431,-.0249104,.495165,.0216774,.429587,-.0301252,.495279,.0262594,.429796,-.0358249,.495432,.0312968,.430065,-.0419972,.495621,.0367985,.430588,-.0485144,.496061,.042798,.43113,-.0555028,.496472,.0492914,.431743,-.0629852,.496904,.0562907,.432448,-.0709256,.497369,.0638056,.433414,-.0791942,.498032,.071885,.434638,-.0877346,.498854,.0805517,.43611,-.0968056,.499812,.0898047,.437859,-.106002,.500891,.0997142,.440017,-.115648,.502198,.110289,.443236,-.125427,.504389,.121644,.44697,-.135492,.506809,.133769,.451689,-.145746,.509858,.146787,.45811,-.156219,.514247,.160793,.465305,-.166834,.518816,.175791,.474085,-.177546,.524331,.191906,.484808,-.188262,.53104,.209199,.49732,-.199346,.538511,.227825,.509693,-.209951,.544554,.247269,.524367,-.220533,.551616,.267978,.539228,-.231082,.557368,.289672,.55644,-.241342,.563782,.31268,.574204,-.250964,.568851,.33651,.593388,-.260306,.57312,.362219,.613358,-.268667,.574916,.390322,.634512,-.275591,.575053,.420478,.65563,-.281328,.572404,.451614,.678265,-.285948,.568893,.484112,.70011,-.289408,.561878,.517348,.723005,-.291328,.55359,.551355,.743744,-.291418,.541099,.585109,.763949,-.290252,.526489,.619487,.784186,-.287648,.509496,.65404,.804304,-.283782,.491484,.688649,.823629,-.278067,.470517,.723133,.84094,-.270588,.44705,.757163,.857852,-.261188,.421252,.792816,.874934,-.249313,.394191,.827248,.888709,-.236492,.365359,.861074,.902589,-.222185,.336016,.894417,.914201,-.207314,.30527,.926825,.925978,-.191146,.274532,.9595,.93512,-.174135,.243393,.991583,.943656,-.155231,.212414,1.02356,.951719,-.134403,.182005,1.05239,.957164,-.113023,.153043,1.07754,.962656,-.0914493,.124186,1.09984,.970695,-.0694179,.0941654,1.12,.980749,-.0466199,.0629671,1.13849,.991205,-.0227032,.0311146,1.15494,.999884,632388e-9,-254483e-9,1.1706,.379821,-957289e-11,.460637,789337e-11,.405188,-247483e-9,.491396,204064e-9,.404796,-989434e-9,.490914,815853e-9,.40483,-.00222607,.490949,.00183559,.40473,-.00395723,.49084,.00326332,.404731,-.00618287,.490836,.00509945,.404768,-.00890258,.490871,.00734463,.404791,-.0121156,.490883,.00999992,.404857,-.0158214,.490938,.0130676,.404943,-.0200178,.491004,.0165503,.405059,-.0247027,.491093,.0204521,.405213,-.0298729,.491205,.0247788,.405399,-.0355226,.491333,.0295373,.405731,-.0416352,.491604,.034741,.406303,-.0480807,.492116,.0404255,.406814,-.0550458,.492506,.0465732,.407404,-.0624652,.492926,.0532058,.408149,-.0702958,.493442,.0603442,.409128,-.0784623,.494136,.0680297,.410408,-.087007,.495054,.0762786,.411813,-.0959639,.495962,.0851046,.413735,-.105075,.497257,.0945878,.416137,-.114646,.498882,.104725,.41934,-.124394,.501132,.11563,.423326,-.134328,.503883,.127325,.428419,-.14458,.50747,.139911,.43484,-.154979,.511964,.153481,.442641,-.165628,.517328,.168114,.452511,-.176365,.524258,.183995,.463473,-.187298,.531248,.200953,.475564,-.198244,.538367,.219176,.488664,-.208938,.545175,.238514,.504073,-.219599,.553227,.259129,.520832,-.230378,.560653,.280997,.538455,-.240703,.567523,.303821,.55709,-.250548,.573287,.327948,.576646,-.259964,.577795,.353362,.596705,-.268721,.580077,.380336,.618053,-.276054,.58018,.4101,.640303,-.282176,.578747,.44161,.662365,-.286931,.574294,.474106,.684542,-.290521,.567035,.507549,.707984,-.292672,.558687,.541853,.730913,-.293189,.547606,.576581,.752948,-.292199,.533471,.61172,.773452,-.289508,.516395,.646339,.794715,-.285716,.497873,.682131,.814251,-.280051,.476845,.716396,.833057,-.272873,.453449,.751503,.84959,-.263982,.427857,.786085,.867022,-.252745,.400335,.821355,.882277,-.239655,.371304,.85646,.895375,-.225386,.340397,.890828,.909347,-.209587,.310005,.923532,.921885,-.193433,.2796,.956419,.932127,-.176135,.247276,.989445,.941869,-.157872,.216186,1.02221,.949735,-.137577,.185602,1.05195,.956617,-.115285,.155767,1.07822,.961974,-.0928418,.126103,1.10149,.96972,-.0700592,.0956758,1.12207,.98012,-.0474671,.0643269,1.1408,.990825,-.0238113,.0320863,1.1577,.999876,381574e-9,-812203e-10,1.17403,.367636,-961342e-11,.469176,753287e-11,.380377,-244772e-9,.485434,191797e-9,.380416,-978857e-9,.485475,767015e-9,.380376,-.00220165,.485435,.00172522,.380419,-.00391408,.485487,.00306734,.380438,-.00611549,.485505,.00479332,.380462,-.00880558,.485525,.00690391,.380496,-.0119837,.485551,.00940039,.38056,-.0156487,.485605,.0122848,.38064,-.0197988,.485666,.0155601,.380767,-.0244324,.48577,.0192313,.380909,-.0295444,.485871,.0233032,.381142,-.0351321,.48606,.0277861,.381472,-.0411535,.486336,.0326939,.382015,-.0475408,.486833,.0380565,.382523,-.0544395,.487231,.0438615,.383129,-.061784,.487683,.0501332,.383952,-.0695085,.488313,.0568996,.38498,-.0775819,.489077,.0641952,.386331,-.0860443,.490113,.0720324,.387788,-.0948406,.491099,.0804379,.389808,-.103899,.492566,.0894899,.39252,-.113313,.494601,.0992098,.395493,-.123007,.496619,.109641,.399826,-.132859,.499912,.120919,.405341,-.143077,.504061,.133107,.411932,-.153465,.508905,.146263,.420591,-.164108,.515482,.160544,.43101,-.174893,.523191,.176123,.441881,-.185839,.53026,.192757,.453919,-.196633,.537295,.210535,.468715,-.207611,.546156,.229886,.485182,-.218517,.555173,.250543,.501926,-.229249,.562728,.27221,.51785,-.239481,.567494,.294892,.536947,-.249395,.573889,.318987,.557115,-.259,.578831,.344348,.577966,-.268075,.582055,.371223,.599489,-.276115,.583307,.399834,.62479,-.282523,.583902,.431415,.647504,-.287663,.57953,.464301,.670601,-.291538,.573103,.498123,.693539,-.293842,.563731,.532662,.717385,-.294681,.553169,.567925,.741533,-.293717,.539908,.603502,.762142,-.291156,.521902,.639074,.783014,-.28719,.502815,.674439,.805158,-.281773,.482598,.710497,.823646,-.274682,.458949,.7456,.841879,-.266184,.433129,.781085,.859515,-.255682,.406064,.816,.875335,-.242849,.376509,.851074,.890147,-.228329,.345502,.886473,.903144,-.212491,.31428,.920751,.916618,-.195695,.282994,.954606,.927953,-.178267,.251091,.988402,.937414,-.159549,.219107,1.02141,.946823,-.140022,.18896,1.05167,.954651,-.118154,.158667,1.07819,.959955,-.0946636,.128808,1.1025,.96858,-.0711792,.0973787,1.12391,.97938,-.0475046,.0650965,1.14322,.990498,-.024059,.0326267,1.16077,.999844,-512408e-10,112444e-9,1.17727,.316912,-934977e-11,.425996,695559e-11,.356423,-241372e-9,.479108,179562e-9,.356272,-965292e-9,.478897,71811e-8,.356262,-.00217182,.478894,.00161574,.356265,-.00386092,.478895,.00287261,.356278,-.0060324,.478905,.00448907,.356293,-.00868565,.478914,.00646572,.356346,-.0118207,.478965,.00880438,.356395,-.0154355,.479001,.0115066,.356484,-.019529,.479075,.0145762,.356609,-.0240991,.47918,.018018,.356766,-.0291413,.479305,.0218379,.357009,-.0346498,.479512,.0260454,.357424,-.0405462,.479909,.0306657,.357899,-.0468825,.480337,.0357054,.358424,-.0536887,.480771,.0411728,.359041,-.0609416,.481242,.0470841,.359903,-.0685239,.481943,.0534831,.360932,-.0764883,.482741,.0603795,.362196,-.0848364,.483688,.0678028,.363847,-.0935002,.484947,.0758086,.365972,-.102471,.486588,.0844173,.368741,-.111751,.488787,.0937199,.372146,-.121334,.491405,.103732,.377114,-.131147,.495604,.114608,.38226,-.141213,.499436,.126345,.389609,-.151632,.505334,.139116,.397925,-.162073,.51168,.152995,.407824,-.172819,.518876,.168071,.420014,-.183929,.527639,.184495,.434266,-.195032,.537588,.20232,.447352,-.205792,.544379,.221189,.463726,-.216704,.553422,.241616,.481406,-.227531,.562074,.263298,.498707,-.238017,.568227,.286116,.518039,-.247936,.574473,.3101,.538277,-.257437,.579191,.335401,.561166,-.266829,.584807,.362246,.583189,-.275329,.586476,.390609,.606024,-.28234,.585578,.420998,.632419,-.287924,.584496,.454357,.656128,-.291972,.577766,.488233,.679953,-.29456,.56875,.523248,.704654,-.295816,.558388,.559168,.729016,-.295157,.544826,.595326,.752062,-.292779,.528273,.631864,.773138,-.288681,.508482,.667793,.794869,-.283358,.487341,.704035,.815101,-.27608,.46354,.739925,.834212,-.26767,.438672,.775539,.852368,-.257397,.411239,.810895,.870207,-.245689,.3829,.846472,.884063,-.231452,.351496,.881788,.898284,-.215561,.31895,.917438,.912964,-.198208,.287367,.952422,.924666,-.180426,.254487,.987551,.934429,-.161525,.222226,1.02142,.943485,-.141197,.191143,1.05218,.9521,-.120085,.161112,1.07937,.957876,-.0975881,.130982,1.10403,.966943,-.0726842,.0990553,1.12616,.978313,-.0483705,.0662818,1.14619,.990048,-.0239072,.0329243,1.16413,.999984,461885e-9,-772859e-10,1.18099,.321287,-935049e-11,.455413,659662e-11,.332595,-237513e-9,.471437,167562e-9,.332729,-949964e-9,.471618,670192e-9,.332305,-.00213618,.471028,.00150712,.332326,-.00379765,.471055,.00267959,.332344,-.00593353,.471072,.00418751,.332356,-.00854349,.471077,.00603172,.332403,-.0116268,.471121,.00821362,.332461,-.0151824,.47117,.0107357,.332552,-.0192088,.471251,.0136014,.332657,-.0237024,.47133,.0168152,.332835,-.0286615,.471487,.0203853,.333083,-.0340765,.471708,.0243212,.333547,-.0398563,.47219,.0286518,.333989,-.0460916,.472587,.0333763,.334532,-.0527897,.473054,.0385084,.335167,-.0599284,.473568,.0440638,.33608,-.0673514,.474362,.0500962,.337146,-.0752237,.475231,.0566022,.338462,-.083418,.476282,.0636272,.34014,-.0919382,.477615,.0712153,.342341,-.100741,.479404,.079417,.345088,-.109905,.481618,.0882631,.349049,-.119369,.485081,.0978851,.353939,-.129033,.489317,.108336,.359893,-.139038,.494309,.119698,.366945,-.149411,.499983,.132024,.375814,-.159843,.507185,.145558,.387112,-.170664,.516392,.160433,.40023,-.181897,.526519,.176648,.412555,-.192785,.53423,.193922,.427023,-.203663,.542741,.212662,.443685,-.214695,.552066,.232944,.461499,-.225561,.560762,.254495,.480975,-.236257,.569421,.277531,.501,-.24639,.576101,.301724,.521691,-.256101,.581493,.327112,.543478,-.265289,.585221,.353917,.566094,-.273938,.587614,.381941,.589578,-.281679,.587991,.41172,.614583,-.287655,.585928,.444148,.641813,-.292228,.582092,.478617,.666189,-.295172,.57398,.51397,.690475,-.29648,.561676,.550118,.715543,-.296203,.548758,.586933,.740405,-.293999,.532792,.62384,.762183,-.28998,.512735,.660723,.786069,-.28478,.492402,.69807,.806812,-.277568,.469058,.734422,.826987,-.268951,.443017,.770946,.844588,-.259049,.415501,.80699,.863725,-.2471,.387328,.842107,.879137,-.234157,.356108,.878078,.894634,-.218719,.324315,.914058,.909162,-.201293,.291813,.949922,.92072,-.18267,.258474,.985337,.93158,-.163212,.225593,1.0205,.941238,-.142771,.193986,1.05273,.949293,-.120956,.163392,1.08075,.956226,-.0985743,.132934,1.10559,.96546,-.075118,.101255,1.12823,.977403,-.0497921,.0675441,1.149,.989648,-.0241574,.0334681,1.16765,1.00001,5762e-7,-184807e-9,1.18519,.303474,-916603e-11,.4542,61243e-10,.308894,-232869e-9,.462306,155592e-9,.309426,-931661e-9,.463093,622499e-9,.308643,-.0020949,.461933,.00139979,.308651,-.0037242,.461941,.00248874,.308662,-.00581873,.46195,.00388933,.308687,-.00837818,.461974,.00560247,.308728,-.0114016,.462011,.00762948,.308789,-.0148884,.462067,.00997326,.308882,-.0188369,.462151,.0126375,.309007,-.0232436,.462263,.0156271,.30918,-.0281054,.462417,.0189498,.309442,-.0334065,.462667,.0226167,.309901,-.0390589,.463162,.0266614,.310331,-.0452042,.463555,.0310715,.310858,-.0517735,.464019,.0358698,.311576,-.0587359,.464669,.0410848,.312436,-.0660383,.465406,.0467453,.313526,-.0737266,.466339,.0528718,.314903,-.0817574,.467504,.0595039,.316814,-.090167,.469226,.0666888,.318965,-.0987555,.470981,.0744658,.322077,-.107792,.473814,.082912,.325947,-.117098,.477241,.0920846,.331008,-.126602,.48184,.102137,.337893,-.136619,.488334,.113135,.345106,-.146838,.494415,.12511,.355111,-.157357,.503275,.138356,.365095,-.167955,.510966,.152686,.378344,-.179157,.521508,.16856,.391599,-.190143,.530455,.18561,.407786,-.20123,.541275,.204308,.425294,-.212456,.551784,.224623,.444021,-.223568,.561493,.246172,.463418,-.234154,.569886,.268979,.484077,-.244546,.577116,.293411,.505513,-.254301,.582914,.318936,.527672,-.263564,.587208,.345856,.550565,-.272332,.589277,.374054,.573656,-.280011,.588426,.403276,.59827,-.286924,.587504,.43474,.624731,-.291994,.583401,.468767,.652396,-.295159,.576997,.504411,.67732,-.296954,.565863,.54114,.703147,-.296877,.552316,.57816,.728715,-.295147,.536773,.616124,.752448,-.291275,.51771,.653885,.775169,-.285905,.496087,.691537,.799307,-.279064,.474232,.729251,.819482,-.270294,.447676,.766267,.837659,-.260032,.419656,.802616,.856903,-.248497,.391328,.838583,.873325,-.235252,.360285,.874711,.889788,-.221126,.329215,.91077,.904486,-.204304,.296392,.94653,.917711,-.185562,.262159,.983828,.928969,-.165635,.229142,1.01955,.939707,-.14442,.19673,1.05317,.948167,-.122147,.165095,1.0823,.955222,-.099098,.13451,1.10791,.964401,-.0755332,.102476,1.1312,.976605,-.0513817,.0689667,1.15218,.989085,-.0258499,.034506,1.17129,.999908,617773e-9,-271268e-9,1.18961,.285803,-905752e-11,.452348,572272e-11,.284689,-22732e-8,.450581,143626e-9,.285263,-910214e-9,.451482,575099e-9,.285302,-.00204784,.451553,.00129395,.285318,-.00364057,.451574,.0023006,.28533,-.00568813,.451585,.00359547,.285361,-.00819001,.451618,.00517934,.285397,-.0111458,.45165,.007054,.285447,-.0145536,.451688,.00922167,.285527,-.0184127,.451758,.0116869,.285688,-.0227207,.451929,.0144555,.28584,-.0274712,.452055,.0175341,.286136,-.0326278,.452369,.0209406,.286574,-.0381792,.452853,.0246965,.287012,-.0441879,.453272,.0287996,.287542,-.0506096,.453752,.033268,.288299,-.0573634,.454488,.0381504,.289186,-.0645458,.455294,.0434447,.290302,-.0720405,.456301,.0491973,.291776,-.0799046,.457648,.0554453,.29372,-.088117,.459483,.0622311,.296052,-.0965328,.461571,.0695992,.299563,-.105409,.465085,.077658,.30335,-.114553,.468506,.0864176,.309167,-.123917,.474423,.0961078,.31529,-.13381,.47995,.106643,.324163,-.144021,.488592,.118322,.333272,-.154382,.496461,.131133,.344224,-.165015,.50562,.145208,.357733,-.176168,.516719,.16073,.373046,-.187468,.528513,.177807,.38788,-.198488,.537713,.196072,.405133,-.209545,.547999,.21605,.423845,-.220724,.55759,.237484,.443777,-.231518,.566246,.26039,.464824,-.242035,.574326,.284835,.486635,-.251898,.58037,.310518,.51012,-.261304,.58568,.337678,.535301,-.270384,.590197,.366242,.559193,-.27841,.590569,.395873,.583544,-.285325,.588161,.426857,.608834,-.291113,.584249,.459477,.635753,-.294882,.57763,.494734,.664367,-.297088,.569479,.532023,.689688,-.297364,.555064,.569629,.715732,-.295949,.539522,.608124,.741307,-.292259,.521613,.646231,.764949,-.287063,.49969,.684938,.788599,-.28012,.476747,.723548,.81048,-.27153,.45116,.761135,.831372,-.261289,.424101,.798916,.850092,-.249559,.39443,.835952,.867777,-.236348,.363849,.871606,.884632,-.221569,.332477,.907843,.90047,-.20618,.300667,.944187,.914524,-.188771,.266552,.981371,.926892,-.168362,.232349,1.01841,.937951,-.146761,.199359,1.05308,.947236,-.123813,.1675,1.0839,.954367,-.099984,.136166,1.11047,.963907,-.0759278,.103808,1.13414,.976218,-.0511367,.0697061,1.15575,.988772,-.0267415,.0352529,1.17531,.999888,-520778e-9,289926e-9,1.19389,.263546,-883274e-11,.441896,526783e-11,.262352,-221849e-9,.439889,132311e-9,.262325,-886683e-9,.439848,528824e-9,.26228,-.00199476,.439765,.00118975,.262372,-.00354671,.439922,.00211568,.26239,-.00554141,.439941,.00330652,.262412,-.00797888,.439961,.00476346,.262453,-.0108584,.440002,.00648818,.262528,-.0141788,.440085,.0084835,.262615,-.017938,.440166,.0107533,.262744,-.0221346,.440291,.0133044,.262939,-.026762,.440493,.0161445,.263277,-.0317573,.440889,.0192974,.26368,-.0371832,.441338,.0227699,.264106,-.0430371,.441753,.0265698,.264624,-.0493035,.442227,.0307178,.265378,-.0558669,.442985,.0352616,.266253,-.0628718,.443795,.0401968,.267478,-.0701569,.445008,.04559,.269062,-.077845,.446599,.0514539,.270926,-.0857941,.448349,.0578382,.273693,-.0940773,.451221,.0648363,.276746,-.102704,.454097,.0724389,.281693,-.111735,.459517,.0808744,.287335,-.121004,.46531,.0901551,.29448,-.130734,.472605,.100371,.30257,-.140777,.480251,.111644,.312465,-.15111,.489444,.124111,.324856,-.16189,.500919,.137979,.33774,-.172946,.511317,.153163,.35255,-.184152,.522684,.169817,.367786,-.19522,.53248,.187886,.385474,-.20632,.543326,.207634,.404976,-.217744,.554109,.229165,.425203,-.228691,.563395,.252068,.446704,-.239299,.571565,.276471,.468951,-.249348,.577935,.302323,.493487,-.258933,.584309,.329882,.517861,-.268009,.58773,.358525,.543309,-.276238,.589612,.388585,.569704,-.28356,.589294,.419787,.594871,-.289497,.585137,.452114,.622555,-.294452,.580356,.486466,.651167,-.296918,.57185,.523079,.677332,-.297647,.558428,.5611,.703718,-.296321,.542232,.599592,.730262,-.293339,.524541,.639138,.754304,-.288036,.502691,.677978,.778051,-.281018,.479212,.716537,.801557,-.272414,.454071,.75586,.822559,-.262419,.425952,.794477,.843051,-.250702,.397313,.832664,.86232,-.237264,.366534,.869876,.879044,-.222716,.334816,.906973,.896362,-.206827,.303143,.943558,.910342,-.189659,.269699,.979759,.924119,-.171108,.236411,1.01718,.935374,-.149579,.202224,1.05289,.944295,-.126295,.16989,1.08496,.952227,-.101511,.138089,1.11256,.962041,-.0766392,.105053,1.1375,.97528,-.0511967,.070329,1.15983,.988476,-.025463,.0351268,1.17987,.999962,286808e-10,145564e-10,1.19901,.227089,-841413e-11,.404216,472707e-11,.239725,-215083e-9,.426708,120833e-9,.239904,-860718e-9,.427028,483555e-9,.239911,-.00193661,.427039,.00108806,.239914,-.00344276,.42704,.00193457,.239933,-.00537907,.427064,.00302363,.239944,-.00774482,.427065,.00435604,.239993,-.01054,.427122,.00593398,.240052,-.0137626,.427179,.00775987,.240148,-.0174115,.427279,.00983854,.240278,-.021484,.42741,.0121763,.240472,-.0259729,.427618,.0147827,.240839,-.0308131,.428086,.0176837,.241201,-.0360893,.428482,.0208775,.241626,-.0417723,.428907,.0243821,.242207,-.0478337,.42952,.0282228,.24298,-.0542199,.430332,.0324333,.243881,-.0610015,.431222,.0370252,.245123,-.0680874,.432512,.0420535,.24667,-.0755482,.434088,.0475414,.248779,-.0832873,.436323,.0535542,.251665,-.0913546,.439509,.0601716,.255305,-.0998489,.443478,.0674282,.260049,-.108576,.448713,.0754673,.266192,-.117754,.455524,.084339,.273158,-.127294,.4627,.0941683,.282131,-.137311,.472068,.10515,.293332,-.147736,.483565,.117402,.304667,-.158357,.493702,.130824,.317785,-.169274,.504708,.145724,.333245,-.180595,.517107,.16215,.349843,-.191892,.528849,.180149,.367944,-.203168,.540301,.199746,.387579,-.214443,.551514,.221047,.408247,-.225624,.560906,.243981,.43014,-.236422,.56959,.268513,.452669,-.24654,.576098,.294409,.476196,-.256157,.580925,.322002,.501157,-.265289,.584839,.351052,.527632,-.273671,.587614,.3812,.555754,-.281254,.589119,.412994,.581682,-.287448,.585204,.445498,.608196,-.292614,.579006,.479505,.635661,-.296068,.571297,.514643,.664999,-.297395,.560855,.552213,.691039,-.296645,.544525,.591365,.7179,-.293785,.526535,.630883,.744059,-.289089,.50545,.670932,.76863,-.282239,.482514,.710904,.793273,-.273688,.457246,.750259,.814731,-.26328,.428872,.78948,.835603,-.251526,.399384,.828597,.85489,-.238339,.368811,.866892,.872828,-.223607,.336617,.90563,.889462,-.207538,.303997,.943538,.904929,-.190297,.270812,.980591,.919101,-.172034,.237453,1.01935,.930536,-.152058,.204431,1.05498,.941223,-.129515,.172495,1.08717,.94982,-.104263,.140175,1.11551,.960592,-.0781944,.106465,1.14098,.974629,-.051688,.0711592,1.16418,.98811,-.0253929,.0354432,1.18465,1.00004,804378e-9,-330876e-9,1.20462,.214668,-821282e-11,.406619,433582e-11,.218053,-208144e-9,.413025,109887e-9,.217987,-832212e-9,.412901,439362e-9,.217971,-.00187246,.412876,988623e-9,.217968,-.00332855,.41286,.00175772,.217985,-.00520055,.412882,.00274729,.218014,-.00748814,.412916,.00395842,.218054,-.0101901,.412957,.00539274,.218106,-.0133057,.413005,.00705348,.218217,-.0168342,.413139,.00894581,.218338,-.0207707,.413258,.0110754,.21855,-.0251001,.413509,.0134551,.218913,-.0297861,.413992,.0161081,.219265,-.0348956,.414383,.0190307,.219696,-.0403909,.414839,.0222458,.220329,-.0462003,.415567,.025792,.220989,-.0524208,.41621,.0296637,.222027,-.058948,.417385,.0339323,.223301,-.0658208,.418779,.0386055,.224988,-.0730347,.420665,.0437355,.227211,-.0805274,.423198,.0493844,.230131,-.088395,.426566,.0556135,.233908,-.0966208,.43091,.0624829,.239092,-.105223,.437148,.0701636,.245315,-.11424,.444302,.0786949,.253166,-.12368,.453262,.0882382,.262374,-.133569,.463211,.0988682,.273145,-.143836,.474271,.110727,.285512,-.154577,.4863,.123945,.299512,-.165501,.498817,.138581,.314287,-.176698,.510341,.154676,.331083,-.188066,.522583,.172459,.349615,-.199597,.534879,.191979,.369318,-.210843,.546083,.21309,.390377,-.222068,.5562,.235998,.412411,-.233059,.564704,.260518,.435715,-.24357,.572314,.286795,.461196,-.253356,.579395,.314559,.485587,-.262362,.581985,.343581,.511908,-.270895,.584347,.374367,.539798,-.278452,.58505,.406015,.567974,-.284877,.583344,.439168,.594303,-.290124,.577348,.473005,.622951,-.294183,.570751,.508534,.652404,-.296389,.561541,.544764,.679291,-.296605,.546426,.582927,.706437,-.294095,.528599,.622681,.734485,-.28978,.508676,.663567,.758841,-.283363,.484768,.704092,.78537,-.275015,.460434,.745101,.807315,-.264689,.432166,.784712,.8271,-.252597,.401807,.824241,.849191,-.239154,.371458,.863803,.867046,-.224451,.338873,.903063,.8852,-.208342,.306175,.942763,.901771,-.190684,.272759,.981559,.915958,-.172105,.239306,1.02048,.928046,-.152214,.206071,1.05765,.939961,-.130247,.17367,1.08999,.948711,-.10672,.142201,1.11829,.959305,-.0808688,.108454,1.14467,.973009,-.0539145,.0728109,1.16839,.987631,-.0262947,.0360625,1.19004,.999978,.00132758,-559424e-9,1.21058,.193925,-793421e-11,.391974,392537e-11,.196746,-200315e-9,.397675,991033e-10,.19667,-801099e-9,.397521,396342e-9,.196633,-.00180246,.397445,891829e-9,.196654,-.00320443,.397482,.00158582,.196659,-.00500647,.39748,.00247867,.196683,-.0072086,.397506,.00357167,.196728,-.00981001,.397562,.00486675,.196792,-.0128096,.397633,.00636707,.19689,-.0162055,.397746,.00807752,.197017,-.0199943,.397884,.0100052,.19729,-.024139,.39827,.0121691,.197583,-.0286671,.398639,.0145755,.197927,-.0335858,.399034,.0172355,.198383,-.0388806,.399554,.0201718,.199002,-.0444736,.400289,.0234194,.199739,-.0504583,.401111,.026984,.200784,-.056729,.402349,.0309217,.202075,-.0633643,.403841,.0352496,.203898,-.0703247,.406076,.0400313,.206199,-.0775565,.408841,.0453282,.209252,-.085184,.41259,.0511794,.213638,-.0931994,.418288,.0577459,.21881,-.101617,.424681,.0650508,.225642,-.11052,.433429,.0732759,.233717,-.119772,.442897,.0824683,.242823,-.129505,.452888,.0927484,.254772,-.139906,.466407,.104417,.266603,-.150402,.477413,.117211,.28073,-.161395,.490519,.131598,.295399,-.172465,.50201,.147407,.312705,-.183982,.515311,.165031,.331335,-.195532,.52786,.184336,.351037,-.206971,.5392,.205361,.372175,-.218117,.54941,.228043,.394548,-.229327,.558642,.25267,.419598,-.240052,.567861,.279071,.443922,-.249937,.573332,.306882,.471495,-.259407,.58013,.33661,.496769,-.267749,.580564,.367328,.524951,-.275524,.581696,.399753,.55318,-.282148,.579885,.433134,.581577,-.287533,.575471,.467534,.609231,-.291612,.567445,.502943,.637478,-.293911,.557657,.53871,.667795,-.295096,.546535,.576568,.694272,-.294073,.529561,.614929,.722937,-.290386,.510561,.655909,.749682,-.284481,.487846,.697663,.774754,-.276188,.462487,.738515,.799301,-.266215,.43481,.779802,.820762,-.254116,.404879,.820045,.843231,-.240393,.374559,.860294,.861857,-.225503,.341582,.900965,.880815,-.209382,.308778,.941727,.89766,-.19155,.275232,.980916,.912926,-.172346,.240938,1.02162,.926391,-.151799,.207223,1.0597,.938429,-.129968,.17484,1.09291,.947834,-.10651,.142984,1.12248,.958432,-.0824098,.109902,1.149,.972402,-.0565242,.0744454,1.1733,.987191,-.028427,.0373794,1.19538,.999975,385685e-10,-4203e-8,1.21676,.178114,-766075e-11,.385418,354027e-11,.176074,-191966e-9,.381002,887135e-10,.17601,-767549e-9,.380861,354715e-9,.17598,-.00172696,.380798,798168e-9,.175994,-.00307012,.380824,.00141928,.176017,-.00479684,.380858,.00221859,.176019,-.00690648,.380839,.00319714,.176072,-.00939888,.380913,.0043572,.176131,-.0122726,.380979,.005702,.176239,-.0155264,.38112,.00723689,.176371,-.0191551,.381272,.00896907,.176638,-.023117,.381669,.0109194,.176912,-.0274633,.382015,.0130903,.177279,-.032173,.382476,.0154949,.17774,-.0372219,.383041,.0181669,.178344,-.0426132,.38378,.0211209,.179153,-.0483309,.384773,.0243899,.180197,-.0543447,.386076,.0280062,.181581,-.0607122,.387809,.032004,.18344,-.0673855,.390205,.036453,.186139,-.0743989,.393944,.0414162,.189432,-.0817731,.39832,.0469394,.193795,-.0895464,.404188,.0531442,.199641,-.0978264,.4121,.0601374,.206679,-.106499,.421425,.0680078,.214865,-.115654,.431504,.076919,.224406,-.125268,.442526,.0868835,.235876,-.135475,.455465,.0981875,.248335,-.146023,.4681,.110759,.262868,-.157016,.482069,.124885,.278962,-.168245,.496182,.140645,.295082,-.17958,.507401,.157838,.313738,-.191227,.520252,.17695,.333573,-.202718,.531708,.197817,.356433,-.214424,.544509,.220785,.378853,-.225492,.55373,.245306,.402717,-.236236,.561348,.271593,.428375,-.246568,.568538,.299776,.454724,-.255941,.573462,.329433,.482291,-.264511,.576356,.360598,.509706,-.272129,.576446,.393204,.538805,-.278979,.575298,.427227,.568919,-.284528,.572154,.462157,.596804,-.288801,.564691,.497997,.625987,-.291334,.555134,.534467,.656414,-.292722,.545051,.571736,.683916,-.292185,.528813,.610158,.711809,-.290043,.51106,.649061,.739547,-.285246,.490103,.690081,.766914,-.277647,.465523,.732554,.791375,-.267603,.437718,.773982,.814772,-.256109,.40882,.81609,.836691,-.242281,.377823,.856849,.856984,-.227155,.34496,.898363,.876332,-.210395,.311335,.939471,.894988,-.192612,.277703,.980799,.911113,-.173236,.243019,1.02215,.924092,-.152258,.209037,1.06139,.936828,-.129575,.175909,1.09635,.946869,-.10594,.143852,1.12707,.958284,-.081318,.110289,1.15419,.972325,-.0556133,.0747232,1.17909,.986878,-.0297899,.0383149,1.20163,.999936,-.00197169,912402e-9,1.22338,.151174,-720365e-11,.351531,309789e-11,.155594,-18279e-8,.361806,78608e-9,.156099,-731569e-9,.362982,314615e-9,.156053,-.00164578,.362869,707845e-9,.156093,-.0029261,.362961,.00125884,.156099,-.00457155,.362959,.00196783,.15612,-.00658224,.362982,.00283622,.156168,-.00895774,.363048,.00386625,.156221,-.0116962,.363101,.00506109,.156324,-.0147973,.363241,.00642675,.156476,-.0182503,.363448,.00797175,.156731,-.0220266,.36384,.00971484,.156994,-.026176,.364179,.0116575,.157341,-.0306701,.36462,.0138207,.157867,-.0354591,.365364,.0162356,.15846,-.0406141,.366111,.0189092,.159308,-.0460519,.367248,.021885,.160426,-.0518096,.368767,.0252004,.161877,-.0578906,.370745,.0288825,.163995,-.0642812,.373831,.0330139,.16655,-.0710067,.377366,.0376283,.170237,-.0781522,.382799,.0428493,.175096,-.0857172,.389915,.0487324,.181069,-.0938025,.398487,.0554214,.188487,-.102363,.408799,.0630189,.197029,-.111343,.419991,.071634,.206684,-.120812,.431455,.0812797,.218698,-.131033,.445746,.0923651,.230726,-.141373,.457471,.104545,.245516,-.152387,.472388,.118449,.261551,-.163628,.486671,.133923,.277437,-.174814,.49762,.150849,.296662,-.186713,.51162,.169924,.31795,-.198513,.525435,.190848,.339422,-.210119,.536267,.213504,.362143,-.221354,.545982,.237947,.387198,-.23224,.555364,.264427,.412349,-.24257,.561489,.292519,.439274,-.252284,.566903,.322561,.466779,-.261023,.569614,.353952,.496011,-.26899,.571589,.387278,.524964,-.275498,.570325,.421356,.556518,-.281449,.568792,.457314,.584363,-.285526,.560268,.493199,.614214,-.28844,.55205,.530276,.645684,-.289777,.541906,.56855,.673446,-.289722,.526464,.606927,.701924,-.287792,.509872,.645945,.73037,-.284315,.490649,.685564,.757405,-.278804,.467964,.726511,.784025,-.269543,.441468,.768601,.808255,-.258117,.41216,.811321,.830739,-.244728,.380606,.853496,.851914,-.229428,.348111,.895374,.872586,-.212508,.314732,.937674,.891581,-.194025,.280338,.979869,.907641,-.174711,.245203,1.02253,.922233,-.153509,.21077,1.06371,.935878,-.130418,.177399,1.09972,.946338,-.105558,.144507,1.13124,.957265,-.080059,.110508,1.15973,.971668,-.0539766,.0742311,1.18515,.9866,-.0277101,.0375224,1.20858,1.00021,-515531e-9,135226e-9,1.23135,.137468,-686011e-11,.345041,273315e-11,.13703,-173378e-9,.343936,690761e-10,.136986,-693048e-9,.34383,276126e-9,.136964,-.00155931,.343761,621337e-9,.137003,-.00277211,.343863,.00110494,.137012,-.00433103,.343868,.00172744,.137043,-.00623606,.343916,.00249022,.13709,-.0084868,.343986,.00339559,.137145,-.0110814,.344045,.00444687,.137242,-.0140187,.344177,.00565007,.137431,-.0172713,.344491,.00701868,.137644,-.0208605,.344805,.00856042,.13791,-.024792,.345172,.0102863,.138295,-.0290461,.345734,.0122185,.138764,-.0335957,.346371,.0143771,.139415,-.038467,.347298,.0167894,.140272,-.0436176,.348527,.0194895,.141457,-.0491016,.350276,.0225043,.14303,-.0548764,.352646,.0258962,.145289,-.0610096,.356206,.0297168,.148502,-.0674777,.361488,.0340562,.152188,-.074345,.367103,.0389534,.157359,-.0817442,.375247,.0445541,.16379,-.0896334,.385064,.0509535,.171376,-.098005,.396082,.0582611,.179901,-.106817,.407418,.06654,.189892,-.116239,.420031,.075994,.201838,-.12627,.434321,.0867239,.214311,-.136701,.447631,.0987517,.228902,-.147616,.462046,.112353,.245107,-.158871,.476942,.127605,.262292,-.170261,.490285,.144469,.281215,-.182017,.503783,.163282,.301058,-.193729,.515505,.183873,.322752,-.205512,.52682,.206466,.347547,-.217214,.539473,.231194,.370969,-.227966,.546625,.257288,.397533,-.238555,.55472,.285789,.42398,-.248278,.559468,.315746,.452928,-.257422,.564095,.347724,.482121,-.265306,.565426,.380922,.510438,-.272043,.563205,.415639,.541188,-.277614,.561087,.451702,.571667,-.281927,.554922,.48845,.602432,-.285015,.546838,.526442,.634126,-.286512,.537415,.564896,.662816,-.286388,.522906,.604037,.692411,-.284734,.507003,.643795,.720946,-.281297,.488398,.68298,.748293,-.276262,.466353,.723466,.776931,-.269978,.443573,.764565,.801065,-.260305,.415279,.805838,.825843,-.247426,.384773,.849985,.84807,-.232437,.352555,.893174,.869122,-.215806,.318642,.936564,.888963,-.197307,.28381,.980253,.905547,-.177203,.247888,1.02463,.918554,-.155542,.212904,1.06714,.931395,-.131948,.1787,1.10451,.941749,-.106723,.145902,1.13694,.954551,-.0804939,.111193,1.1666,.970279,-.0534239,.0744697,1.19249,.986117,-.0257452,.0368788,1.21665,.999938,.00190634,-.0010291,1.23981,.118493,-647439e-11,.32272,23772e-10,.118765,-163023e-9,.323456,598573e-10,.118772,-65212e-8,.323477,239447e-9,.118843,-.00146741,.323657,538881e-9,.118804,-.00260846,.323553,95826e-8,.118826,-.00407576,.323595,.00149845,.118846,-.00586826,.323617,.00216047,.118886,-.00798578,.32367,.00294679,.118947,-.0104273,.323753,.00386124,.119055,-.0131909,.323922,.00490999,.119241,-.0162444,.324251,.00610804,.11944,-.0196339,.324544,.00745805,.119739,-.0233378,.325026,.00897805,.12011,-.0273179,.325586,.0106895,.120571,-.0316143,.326231,.0126073,.12124,-.0361939,.327264,.0147654,.122162,-.0410511,.328733,.0172001,.123378,-.0462233,.330659,.0199375,.125183,-.0517109,.333754,.0230498,.127832,-.0575652,.338507,.026597,.130909,-.0637441,.343666,.0306345,.135221,-.0704302,.351063,.035273,.14082,-.0776364,.360604,.0406137,.146781,-.0852293,.369638,.0466788,.155121,-.0935351,.3827,.0537628,.16398,-.102234,.39522,.0617985,.173926,-.111465,.40793,.07097,.185137,-.121296,.42105,.0813426,.19826,-.13169,.435735,.0931596,.212938,-.142614,.450932,.106547,.229046,-.153884,.465726,.121575,.246246,-.165382,.479461,.138286,.264637,-.176806,.492106,.15666,.284959,-.188793,.504774,.17728,.308157,-.200763,.518805,.19988,.330951,-.21239,.528231,.224293,.3549,-.223521,.536376,.250541,.381502,-.234169,.544846,.278902,.409529,-.244077,.551717,.309227,.437523,-.253363,.55517,.341426,.467624,-.261659,.557772,.37518,.497268,-.268498,.556442,.41007,.528294,-.274018,.553915,.446445,.559053,-.278169,.549153,.483779,.589329,-.281229,.539878,.522249,.622503,-.282902,.53162,.561754,.652382,-.282815,.518119,.601544,.681847,-.281247,.502187,.641574,.712285,-.277986,.484824,.682633,.740094,-.273017,.463483,.723426,.768478,-.266692,.441299,.763747,.794556,-.258358,.415238,.805565,.819408,-.248807,.386912,.847254,.843411,-.236214,.356165,.891091,.862397,-.219794,.320562,.936174,.883113,-.201768,.285322,.982562,.90023,-.181672,.249713,1.02862,.915192,-.159279,.214546,1.07163,.928458,-.134725,.180285,1.10995,.94069,-.10913,.147119,1.14354,.953409,-.0821315,.112492,1.17372,.969537,-.0542677,.0752014,1.20043,.985612,-.0259096,.0370361,1.22528,.999835,.00298198,-.00151801,1.24959,.10097,-602574e-11,.300277,202619e-11,.101577,-152164e-9,.302077,511662e-10,.101572,-608889e-9,.302066,204751e-9,.101566,-.00136997,.302047,460753e-9,.101592,-.00243557,.302114,819497e-9,.101608,-.0038053,.30214,.00128154,.101627,-.00547906,.30216,.0018483,.101669,-.00745647,.302224,.00252223,.101732,-.00973615,.302318,.00330716,.101844,-.0123097,.302513,.00421061,.102025,-.0151681,.30285,.00524481,.102224,-.0183334,.303166,.0064154,.102515,-.0217819,.303654,.00774063,.102886,-.0255067,.304243,.0092398,.103395,-.029514,.305089,.0109339,.104109,-.0337912,.306301,.0128561,.105074,-.0383565,.30798,.0150338,.10654,-.0432132,.310726,.0175228,.108478,-.0484244,.314351,.0203648,.111015,-.0539339,.319032,.0236325,.114682,-.0598885,.32605,.0274188,.11911,-.0663375,.334109,.0317905,.124736,-.0733011,.344013,.0368502,.131479,-.0807744,.355358,.0427104,.139283,-.0888204,.367614,.0494788,.148054,-.0973394,.380072,.0572367,.159037,-.10665,.395678,.0662704,.169794,-.116221,.40795,.0763192,.18314,-.126632,.423546,.087956,.197515,-.137383,.438213,.101042,.213514,-.148641,.453248,.115827,.23065,-.160117,.46688,.132283,.249148,-.171807,.479962,.150644,.270219,-.183695,.494618,.171073,.292338,-.195574,.506937,.193378,.314999,-.207205,.516463,.217585,.340991,-.218955,.528123,.24428,.367982,-.229917,.537025,.272784,.39432,-.239737,.541627,.302742,.423364,-.249048,.546466,.335112,.453751,-.257329,.549466,.369032,.48416,-.264623,.549503,.404577,.515262,-.270411,.547008,.441337,.547036,-.274581,.542249,.479162,.576614,-.277266,.533015,.517904,.611143,-.279144,.525512,.558508,.640989,-.279001,.51154,.598995,.671182,-.277324,.495641,.639935,.700848,-.273908,.477526,.681017,.729862,-.269063,.457955,.722764,.758273,-.262282,.434846,.764349,.784121,-.254281,.409203,.806206,.809798,-.24505,.382694,.848617,.834953,-.233861,.354034,.892445,.856817,-.221308,.321764,.936263,.877609,-.205996,.288118,.982401,.897489,-.186702,.253277,1.02975,.913792,-.164618,.217963,1.07488,.92785,-.140023,.183221,1.11487,.940378,-.11328,.149385,1.14947,.95273,-.0853958,.114152,1.1807,.969059,-.0568698,.0769845,1.20912,.985574,-.0276502,.0381186,1.23498,.999943,.00239052,-.00126861,1.25987,.0852715,-560067e-11,.279021,171162e-11,.0854143,-140871e-9,.279483,430516e-10,.0854191,-563385e-9,.2795,172184e-9,.0854188,-.00126753,.279493,387464e-9,.0854229,-.00225337,.279501,68918e-8,.0854443,-.00352086,.279549,.00107803,.0854697,-.00506962,.279591,.00155536,.0855093,-.00689873,.279652,.00212354,.0855724,-.00900821,.279752,.00278703,.0856991,-.0113799,.280011,.0035551,.085855,-.0140314,.280297,.00443449,.0860682,-.016963,.280682,.00543636,.086344,-.0201438,.281159,.0065788,.0867426,-.0235999,.281886,.00787977,.087239,-.0273069,.282745,.0093606,.0879815,-.031269,.284139,.011056,.0891258,-.035531,.28647,.0130065,.0906909,-.0400947,.289708,.0152495,.0927624,-.0449638,.293904,.0178454,.0958376,-.0502427,.300471,.0208915,.0995827,-.0559514,.30806,.0244247,.104526,-.0622152,.317874,.0285721,.110532,-.0690046,.329332,.0334227,.117385,-.0763068,.341217,.0390466,.12522,-.084184,.353968,.0455786,.134037,-.0925248,.366797,.0530773,.144014,-.101487,.380209,.0617424,.156013,-.111273,.395956,.071777,.168872,-.121431,.41053,.0830905,.183089,-.132105,.425073,.0959341,.198763,-.143286,.439833,.110448,.216159,-.154841,.454507,.126769,.234859,-.166588,.468368,.14495,.255879,-.178626,.482846,.165233,.27677,-.190218,.493489,.187217,.301184,-.202227,.506549,.211659,.325852,-.213764,.5158,.237922,.352824,-.22487,.525442,.26632,.380882,-.235246,.532487,.296691,.410137,-.244847,.537703,.329179,.439787,-.253122,.540361,.363135,.472291,-.260517,.542734,.399222,.501856,-.266519,.538826,.436352,.534816,-.270905,.535152,.474505,.565069,-.273826,.525979,.513988,.597154,-.275333,.516394,.554852,.630473,-.275314,.506206,.596592,.660574,-.273323,.489769,.638117,.692015,-.270008,.472578,.680457,.720647,-.265001,.452134,.723008,.750528,-.258311,.430344,.765954,.777568,-.250046,.405624,.809012,.80387,-.240114,.378339,.852425,.828439,-.228737,.349877,.895346,.851472,-.216632,.318968,.940695,.873906,-.202782,.287489,.987235,.89467,-.187059,.254394,1.03348,.912281,-.168818,.221294,1.07812,.927358,-.146494,.18675,1.11928,.940385,-.120009,.152322,1.15609,.952672,-.0917183,.117514,1.18875,.968496,-.0620321,.0797405,1.21821,.985236,-.0314945,.0402383,1.24523,.99998,-575153e-9,110644e-9,1.27133,.0702429,-512222e-11,.255273,140947e-11,.0702981,-128826e-9,.255469,354488e-10,.0703691,-515562e-9,.255727,141874e-9,.0703805,-.00116,.255754,31929e-8,.0703961,-.00206224,.255813,567999e-9,.0704102,-.00322223,.255839,88871e-8,.0704298,-.00463928,.255863,.00128272,.0704759,-.00631375,.255953,.00175283,.0705434,-.00824317,.256079,.00230342,.0706693,-.010412,.25636,.0029443,.0708189,-.0128439,.256647,.00368031,.0710364,-.0155177,.257084,.00452614,.0713223,-.0184374,.257637,.00549706,.0717182,-.0216002,.258416,.00661246,.072321,-.0249966,.259699,.00790147,.0731446,-.0286566,.261475,.0093884,.0743352,-.0325888,.264132,.0111186,.0760676,-.036843,.26815,.013145,.078454,-.0414292,.273636,.0155251,.0818618,-.0464634,.281653,.0183525,.0857382,-.0519478,.289992,.0216642,.0908131,-.0579836,.30066,.0255956,.0967512,-.0645124,.312204,.0301954,.103717,-.0716505,.325001,.0356017,.111596,-.0793232,.338129,.041896,.120933,-.087645,.352853,.0492447,.130787,-.096492,.366192,.0576749,.142311,-.105973,.380864,.0673969,.155344,-.116182,.396575,.0785899,.169535,-.126815,.411443,.0912377,.185173,-.138015,.426256,.105607,.201755,-.149325,.439607,.121551,.221334,-.161207,.455467,.139608,.241461,-.173162,.469096,.159591,.26294,-.18504,.481014,.18156,.286776,-.196881,.493291,.205781,.311596,-.208311,.503556,.231819,.338667,-.219671,.513268,.260274,.366021,-.230451,.519414,.290862,.395875,-.240131,.526766,.323196,.425564,-.248566,.52905,.357071,.457094,-.256195,.530796,.393262,.488286,-.262331,.528703,.430797,.522291,-.267141,.52727,.470231,.554172,-.270411,.519848,.510477,.586427,-.271986,.510307,.551594,.619638,-.27192,.499158,.593849,.650656,-.269817,.483852,.636314,.68284,-.266267,.467515,.679679,.714356,-.26113,.44931,.723884,.742717,-.254067,.425789,.767245,.770894,-.245652,.401144,.811819,.797358,-.235554,.374224,.856315,.823377,-.223896,.346167,.901077,.847456,-.210865,.316056,.946502,.870697,-.196574,.284503,.993711,.891068,-.180814,.251628,1.04134,.909267,-.163314,.219065,1.08609,.925653,-.143304,.186446,1.12702,.940017,-.121322,.153416,1.16371,.952398,-.0973872,.120334,1.19712,.967568,-.0698785,.08352,1.22791,.984772,-.0390031,.0439209,1.25672,1.00026,-.0070087,.00315668,1.28428,.0556653,-459654e-11,.227325,112556e-11,.0565238,-116382e-9,.230826,284985e-10,.0565717,-465666e-9,.231026,114036e-9,.0565859,-.00104773,.231079,256656e-9,.0565761,-.00186255,.231025,45663e-8,.0565913,-.00291002,.231058,714664e-9,.0566108,-.00418998,.231085,.00103224,.0566532,-.00570206,.231169,.00141202,.0567473,-.00743666,.231417,.00186018,.0568567,-.00940298,.231661,.00238264,.0569859,-.0115991,.231895,.00298699,.0572221,-.0140096,.232456,.00368957,.057519,-.0166508,.233096,.00450303,.0579534,-.01951,.234094,.00544945,.0585922,-.0225991,.235629,.00655564,.0595647,-.0259416,.238106,.00785724,.0609109,-.0295661,.241557,.00939127,.0628751,-.0335126,.246652,.0112198,.0656908,-.0378604,.254091,.0134168,.0691347,-.0426543,.262666,.0160374,.0732165,-.0478967,.272029,.0191514,.0782863,-.0536716,.283007,.0228597,.0843973,-.0600683,.295732,.0272829,.0913598,-.0670095,.308779,.032484,.0994407,-.0745516,.322886,.0385886,.108189,-.082712,.336408,.0457133,.118574,-.0914927,.351692,.0539832,.129989,-.100854,.366502,.0635162,.142722,-.110837,.381675,.0744386,.156654,-.121353,.3963,.0868483,.172151,-.132414,.411477,.100963,.188712,-.143809,.42508,.116795,.208093,-.155765,.441328,.134715,.227936,-.167608,.454328,.154396,.249495,-.179579,.467235,.176179,.27362,-.191488,.480248,.200193,.296371,-.202618,.487886,.225775,.324234,-.214133,.499632,.25441,.353049,-.225212,.509532,.285077,.381785,-.234875,.514265,.317047,.414038,-.244205,.521282,.351874,.445251,-.252145,.522931,.388279,.476819,-.258433,.520947,.425825,.509209,-.263411,.517669,.465104,.542759,-.266732,.512841,.505741,.574822,-.268263,.503317,.547611,.609324,-.268489,.493035,.590953,.641772,-.266941,.478816,.63488,.674049,-.263297,.462863,.679072,.705071,-.257618,.442931,.723487,.734709,-.250625,.421299,.768708,.763704,-.24179,.397085,.814375,.791818,-.231115,.370577,.859907,.817439,-.21922,.34232,.906715,.843202,-.205658,.312627,.953943,.866639,-.190563,.280933,1.00185,.888129,-.173978,.248393,1.05105,.907239,-.155485,.216007,1.09704,.923893,-.134782,.183233,1.13857,.938882,-.11249,.150376,1.17539,.952464,-.0890706,.117177,1.20924,.968529,-.0646523,.0813095,1.24055,.984763,-.038606,.0439378,1.27018,1.00053,-.01238,.00598668,1.29873,.0437928,-409594e-11,.204012,879224e-12,.0440166,-103395e-9,.205049,221946e-10,.0440529,-413633e-9,.205225,887981e-10,.0440493,-930594e-9,.2052,199858e-9,.0439884,-.00165352,.204901,355495e-9,.0440716,-.0025849,.205255,556983e-9,.0440968,-.00372222,.205311,805326e-9,.0441359,-.00506478,.205391,.00110333,.0442231,-.00660384,.205638,.00145768,.0443254,-.00835246,.205877,.00187275,.0444832,-.0102992,.20627,.00235938,.0447001,-.0124449,.206796,.0029299,.0450168,-.0147935,.207593,.0036005,.0454816,-.017336,.208819,.00439246,.0462446,-.0201156,.211036,.00533864,.0473694,-.0231568,.214388,.00646984,.0490191,-.0264941,.219357,.00783856,.0512776,-.030184,.226061,.00950182,.0541279,-.0342661,.234094,.0115156,.0578989,-.0388539,.244297,.0139687,.0620835,-.0438735,.254457,.0169015,.0673497,-.04951,.266706,.0204554,.0731759,-.0556263,.278753,.0246606,.0803937,-.0624585,.29309,.0297126,.0879287,-.0697556,.305856,.0355868,.0970669,-.0778795,.321059,.0425768,.106508,-.0863541,.333873,.05056,.11776,-.0955935,.349008,.0598972,.130081,-.105438,.363776,.0706314,.144454,-.115899,.380112,.0828822,.1596,-.126827,.394843,.0967611,.176097,-.138161,.409033,.112381,.194726,-.149904,.424257,.129952,.213944,-.161675,.436945,.149333,.235516,-.173659,.450176,.170892,.260564,-.185963,.466305,.194984,.285183,-.197582,.477328,.220805,.311095,-.208697,.486566,.248694,.338924,-.219519,.494811,.279015,.369757,-.229766,.504065,.311725,.3996,-.238879,.507909,.345844,.430484,-.246802,.509805,.381749,.46413,-.253924,.511436,.420251,.497077,-.259319,.508787,.459957,.530434,-.263297,.50394,.501356,.565725,-.265619,.49804,.544252,.599254,-.265842,.487346,.587856,.631251,-.263978,.472975,.631969,.663972,-.26043,.457135,.677471,.697724,-.255358,.439844,.723744,.727725,-.248308,.417872,.770653,.756417,-.239181,.39273,.817357,.785419,-.22814,.367839,.864221,.81266,-.215681,.339449,.912701,.839391,-.201623,.309279,.962419,.86366,-.185624,.278029,1.0122,.885028,-.16797,.245294,1.06186,.904639,-.148336,.212689,1.10934,.922048,-.12637,.179616,1.15063,.936952,-.102928,.146749,1.18885,.951895,-.0785268,.112733,1.22352,.967198,-.0530153,.0760056,1.25681,.984405,-.02649,.0383183,1.28762,1.00021,70019e-8,-20039e-8,1.31656,.0325964,-355447e-11,.176706,655682e-12,.0329333,-899174e-10,.178527,165869e-10,.0329181,-359637e-9,.178453,663498e-10,.0329085,-808991e-9,.178383,149332e-9,.0329181,-.00143826,.178394,265873e-9,.0329425,-.00224678,.178517,416597e-9,.0329511,-.00323575,.17849,603299e-9,.033011,-.00439875,.178695,829422e-9,.0330733,-.00574059,.178843,.00109908,.0331857,-.00725896,.179176,.00141933,.0333445,-.00895289,.179618,.0017999,.0335674,-.0108219,.180238,.00225316,.033939,-.0128687,.181417,.00279765,.0345239,-.015114,.183395,.0034564,.0354458,-.017596,.186616,.00425864,.0368313,-.0203524,.191547,.00524936,.0386115,-.0234105,.197508,.00647033,.0410303,-.0268509,.205395,.00798121,.0442245,-.0307481,.215365,.0098557,.0478659,-.0350863,.225595,.0121417,.0522416,-.0399506,.236946,.0149385,.0574513,-.045357,.249442,.0183189,.0631208,-.0512863,.261222,.0223644,.0701124,-.0579273,.275418,.0272418,.0777331,-.0650652,.288989,.0329458,.0862709,-.0728813,.302546,.0396819,.096103,-.081363,.317164,.04757,.106976,-.0904463,.331733,.0567012,.119175,-.100105,.34661,.067202,.132919,-.110375,.362249,.0792588,.147727,-.121115,.376978,.0928672,.163618,-.132299,.390681,.108228,.182234,-.143887,.406571,.125502,.201809,-.155827,.42042,.144836,.225041,-.168357,.438411,.166706,.247621,-.18004,.450368,.189909,.27097,-.191536,.460083,.215251,.296658,-.203024,.469765,.243164,.325892,-.214056,.481837,.273388,.35406,-.224104,.487474,.305344,.384372,-.233489,.492773,.339741,.41749,-.241874,.498451,.376287,.45013,-.248834,.499632,.414195,.481285,-.254658,.495233,.454077,.519183,-.259367,.496401,.496352,.551544,-.261818,.487686,.538798,.587349,-.262964,.479453,.583626,.621679,-.262128,.467709,.629451,.654991,-.258998,.452123,.67566,.686873,-.254119,.433495,.723248,.719801,-.246946,.413657,.771156,.750355,-.237709,.390366,.81989,.780033,-.226549,.364947,.868601,.809254,-.214186,.337256,.920034,.836576,-.199639,.307395,.971706,.861774,-.183169,.275431,1.02479,.885707,-.165111,.243431,1.07837,.904742,-.144363,.210921,1.12783,.915604,-.121305,.17647,1.17254,.930959,-.0962119,.143106,1.21012,.948404,-.069969,.108112,1.24474,.967012,-.0427586,.0708478,1.27718,.984183,-.0147043,.032335,1.3083,.999577,.0142165,-.00726867,1.3382,.0229227,-299799e-11,.148623,462391e-12,.0232194,-758796e-10,.15054,117033e-10,.0232315,-303636e-9,.15063,468397e-10,.0232354,-683189e-9,.150624,105472e-9,.0232092,-.0012136,.150445,187744e-9,.0232523,-.00189765,.150679,294847e-9,.0232828,-.00273247,.150789,428013e-9,.0233371,-.00371287,.150995,591134e-9,.0234015,-.00484794,.15118,787642e-9,.023514,-.00612877,.151562,.00102547,.023679,-.00756125,.152116,.00131351,.0239559,-.00914651,.153162,.00166594,.0244334,-.010904,.155133,.00210182,.025139,-.0128615,.158035,.00264406,.0262598,-.0150628,.162751,.00332923,.0277875,-.0175532,.168944,.00419773,.0298472,-.0203981,.176835,.00530034,.0325444,-.023655,.186686,.00669777,.0355581,-.0272982,.196248,.00842661,.0392841,-.0314457,.207352,.0105854,.0436815,-.0361157,.219279,.0132458,.0485272,-.0412932,.230728,.0164736,.0541574,-.0470337,.242994,.0203715,.0609479,-.0535002,.257042,.0250953,.0685228,-.0605409,.27102,.0306856,.0768042,-.0680553,.28406,.037193,.0864844,-.0765011,.299186,.0449795,.0969415,-.0852674,.3132,.0538316,.108478,-.0947333,.327138,.0641149,.121705,-.10481,.342345,.0759185,.136743,-.115474,.358472,.0894116,.152986,-.126536,.374067,.104562,.170397,-.138061,.388267,.121632,.191392,-.150203,.406467,.140996,.211566,-.161751,.418641,.161696,.233567,-.173407,.430418,.184557,.257769,-.185397,.44277,.210092,.28531,-.197048,.457191,.237827,.311726,-.20784,.464712,.267253,.340537,-.218345,.472539,.299332,.372921,-.228306,.482331,.333988,.402924,-.236665,.484378,.369722,.434475,-.244097,.484717,.407836,.469736,-.250547,.487093,.448465,.505045,-.25511,.485575,.490263,.540262,-.258444,.481225,.534495,.576347,-.259903,.473481,.579451,.608656,-.259572,.4603,.625604,.646679,-.257908,.450341,.674511,.679902,-.253663,.431561,.723269,.714159,-.247419,.412684,.773263,.745345,-.239122,.389388,.824182,.778248,-.228837,.365361,.876634,.807208,-.216197,.337667,.92945,.835019,-.201772,.307197,.985261,.860261,-.185291,.274205,1.04299,.877601,-.165809,.240178,1.09816,.898211,-.143897,.207571,1.14694,.915789,-.119513,.174904,1.19008,.931831,-.0932919,.141423,1.2297,.949244,-.0656528,.105603,1.26553,.967527,-.0370262,.0679551,1.29986,.984139,-.00730117,.0283133,1.33252,.999713,.0234648,-.0121785,1.36397,.0152135,-245447e-11,.122795,304092e-12,.0151652,-615778e-10,.122399,76292e-10,.0151181,-245948e-9,.122023,304802e-10,.0151203,-553394e-9,.12203,686634e-10,.015125,-983841e-9,.122037,122463e-9,.0151427,-.00153774,.12214,192706e-9,.0151708,-.0022103,.122237,281219e-9,.0152115,-.00300741,.12238,390804e-9,.0152877,-.00392494,.1227,526317e-9,.015412,-.00496597,.123244,69443e-8,.0156201,-.00613314,.124228,90547e-8,.0159658,-.00744113,.125945,.0011732,.0165674,-.00892546,.129098,.00151888,.017487,-.010627,.133865,.00197007,.018839,-.0126043,.140682,.0025637,.020554,-.0148814,.148534,.00333637,.0226727,-.0175123,.157381,.00433738,.0251879,-.0205266,.166685,.00561664,.0283635,-.0240319,.177796,.00725563,.0318694,-.0279432,.188251,.00928811,.0361044,-.0324313,.200038,.011835,.0406656,-.0373527,.210685,.0149146,.0463846,-.0430132,.224182,.0187254,.0525696,-.0491013,.23634,.0232283,.0598083,-.0559175,.250013,.0286521,.0679437,-.0633657,.263981,.0350634,.0771181,-.0714602,.278072,.0425882,.0881273,-.0803502,.29511,.0514487,.0996628,-.0896903,.309976,.0615766,.112702,-.099644,.325611,.0732139,.126488,-.109829,.339321,.0862324,.142625,-.120859,.35574,.101275,.15953,-.131956,.369845,.117892,.176991,-.143145,.38146,.136205,.199715,-.155292,.40052,.157252,.220787,-.167066,.412055,.179966,.243697,-.178396,.423133,.204418,.272106,-.190433,.439524,.232141,.297637,-.201265,.447041,.261109,.325273,-.211834,.454488,.292627,.357219,-.221889,.465004,.326669,.387362,-.230729,.468527,.362426,.423131,-.23924,.475836,.401533,.45543,-.246067,.475017,.441902,.493393,-.251557,.478017,.484239,.526253,-.255571,.4709,.528586,.560554,-.257752,.463167,.574346,.599306,-.258076,.456452,.621655,.634541,-.256471,.443725,.670492,.668907,-.253283,.428719,.721943,.705619,-.247562,.411348,.772477,.739034,-.240626,.388939,.8264,.771408,-.231493,.36425,.881702,.803312,-.220125,.337321,.9385,.828457,-.206645,.305364,.997437,.854819,-.190664,.273715,1.05693,.878666,-.171429,.242218,1.11251,.898404,-.149235,.209556,1.16398,.917416,-.12435,.176863,1.21014,.933133,-.0972703,.142775,1.25178,.95066,-.0683607,.106735,1.29028,.968589,-.0378724,.0681609,1.32703,.984776,-.00605712,.0273966,1.36158,.99994,.0263276,-.0138124,1.3943,.00867437,-186005e-11,.0928979,173682e-12,.00864003,-466389e-10,.0925237,435505e-11,.00864593,-186594e-9,.0925806,174322e-10,.00864095,-419639e-9,.0924903,392862e-10,.00863851,-746272e-9,.0924589,702598e-10,.00868531,-.00116456,.0929,111188e-9,.00869667,-.00167711,.0928529,163867e-9,.00874332,-.00228051,.0930914,23104e-8,.00882709,-.00297864,.0935679,31741e-8,.00898874,-.00377557,.0946165,430186e-9,.00929346,-.00469247,.0967406,580383e-9,.00978271,-.00575491,.100084,783529e-9,.0105746,-.00701514,.105447,.00106304,.0116949,-.00851797,.112494,.00144685,.0130419,-.0102757,.119876,.00196439,.0148375,-.012381,.129034,.00266433,.0168725,-.01482,.137812,.00358364,.0193689,-.0176563,.147696,.00478132,.0222691,-.0209211,.157795,.00631721,.0256891,-.0246655,.168431,.00826346,.0294686,-.0288597,.178587,.0106714,.0340412,-.0336441,.190251,.0136629,.0393918,-.039033,.202999,.0173272,.0453947,-.0450087,.215655,.0217448,.0521936,-.0515461,.228686,.0269941,.0600279,-.058817,.242838,.033272,.0692398,-.0667228,.258145,.0406457,.0793832,-.0752401,.273565,.0492239,.0902297,-.0841851,.287735,.0590105,.102014,-.0936479,.301161,.0702021,.116054,-.103967,.317438,.0832001,.13191,-.114622,.334166,.0977951,.148239,-.125452,.348192,.113985,.165809,-.136453,.361094,.131928,.184616,-.147648,.373534,.151811,.207491,-.159607,.39101,.174476,.230106,-.171119,.402504,.198798,.257036,-.182906,.418032,.225796,.281172,-.193605,.425468,.254027,.312034,-.204771,.440379,.285713,.340402,-.214988,.445406,.319196,.370231,-.224711,.44968,.35537,.407105,-.233516,.460747,.393838,.439037,-.240801,.460624,.433747,.47781,-.24762,.465957,.477234,.510655,-.251823,.460054,.52044,.550584,-.255552,.459172,.567853,.585872,-.257036,.450311,.615943,.620466,-.257535,.437763,.667693,.660496,-.255248,.426639,.718988,.695578,-.251141,.409185,.772503,.732176,-.244718,.39015,.827023,.760782,-.236782,.362594,.885651,.79422,-.225923,.33711,.943756,.824521,-.213855,.308272,1.00874,.854964,-.197723,.278529,1.06764,.878065,-.179209,.246208,1.12836,.899834,-.157569,.21329,1.18318,.918815,-.133206,.181038,1.23161,.934934,-.106545,.146993,1.27644,.952115,-.0780574,.111175,1.31842,.96906,-.0478279,.0728553,1.35839,.985178,-.0160014,.032579,1.39697,1.00039,.0173126,-.0095256,1.43312,.00384146,-124311e-11,.0613583,778271e-13,.00390023,-314043e-10,.0622919,196626e-11,.00389971,-125622e-9,.0622632,787379e-11,.00389491,-282352e-9,.0620659,1778e-8,.00391618,-502512e-9,.0624687,320918e-10,.00392662,-784458e-9,.0625113,515573e-10,.00396053,-.00112907,.0628175,778668e-10,.00401911,-.00153821,.0633286,113811e-9,.00414994,-.0020208,.0646443,16445e-8,.00441223,-.00260007,.0673886,237734e-9,.00484427,-.0033097,.0716528,345929e-9,.00549109,-.00418966,.0774998,505987e-9,.00636293,-.00527331,.0844758,739208e-9,.00746566,-.00660428,.0921325,.00107347,.00876625,-.00818826,.0997067,.00153691,.0103125,-.0100811,.107433,.00217153,.0123309,-.0123643,.117088,.00303427,.0146274,-.0150007,.126438,.00416018,.0172295,-.0180531,.135672,.00561513,.0204248,-.0215962,.146244,.007478,.0241597,-.0256234,.157481,.00981046,.0284693,-.0302209,.169125,.0127148,.033445,-.0353333,.181659,.0162453,.0391251,-.0410845,.1944,.0205417,.0454721,-.0473451,.207082,.0256333,.0530983,-.0542858,.221656,.0317036,.0615356,-.0618384,.236036,.0388319,.0703363,-.0697631,.248398,.046974,.0810391,-.0784757,.263611,.0565246,.0920144,-.0873488,.275857,.0671724,.105584,-.0973652,.292555,.0798105,.119506,-.107271,.306333,.0935945,.134434,-.117608,.318888,.109106,.153399,-.128938,.337552,.127074,.171258,-.139944,.349955,.14643,.191059,-.151288,.361545,.168,.215069,-.163018,.378421,.192082,.237838,-.174226,.38879,.217838,.266965,-.186063,.405857,.246931,.292827,-.196909,.414146,.277505,.324352,-.207473,.426955,.310711,.354427,-.217713,.433429,.346794,.389854,-.227183,.443966,.385237,.420749,-.235131,.44471,.424955,.459597,-.242786,.451729,.468446,.495316,-.248767,.45072,.513422,.534903,-.253351,.450924,.560618,.572369,-.256277,.445266,.609677,.612383,-.2576,.438798,.660995,.644037,-.256931,.421693,.713807,.686749,-.254036,.4109,.767616,.719814,-.249785,.390151,.82533,.754719,-.244283,.367847,.888311,.792022,-.235076,.345013,.948177,.822404,-.225061,.316193,1.01661,.853084,-.211113,.287013,1.08075,.879871,-.19449,.255424,1.14501,.901655,-.174023,.222879,1.20203,.919957,-.1509,.18989,1.25698,.938412,-.124923,.15606,1.30588,.953471,-.0968139,.120512,1.3529,.970451,-.066734,.0828515,1.3986,.985522,-.034734,.0424458,1.44148,1.00099,-.00102222,678929e-9,1.48398,965494e-9,-627338e-12,.0306409,197672e-13,99168e-8,-158573e-10,.0314638,499803e-12,991068e-9,-634012e-10,.031363,200682e-11,974567e-9,-14144e-8,.03036,457312e-11,998079e-9,-252812e-9,.031496,860131e-11,.00102243,-396506e-9,.0319955,148288e-10,.00107877,-577593e-9,.0331376,249141e-10,.00121622,-816816e-9,.0359396,423011e-10,.0014455,-.00113761,.0399652,724613e-10,.00178791,-.00156959,.0450556,123929e-9,.00225668,-.00214064,.0508025,208531e-9,.00285627,-.00287655,.0568443,341969e-9,.0035991,-.00380271,.0630892,544158e-9,.00455524,-.00496264,.0702204,842423e-9,.00569143,-.0063793,.0773426,.00126704,.00716928,-.00813531,.0860839,.00186642,.00885307,-.0101946,.0944079,.00267014,.0109316,-.0126386,.103951,.00374033,.0133704,-.0154876,.113786,.0051304,.0161525,-.0187317,.123477,.00688858,.0194267,-.0224652,.133986,.00910557,.0230967,-.0265976,.143979,.0118074,.0273627,-.0312848,.154645,.0151266,.0323898,-.0365949,.166765,.0191791,.0379225,-.0422914,.177932,.0239236,.0447501,-.0487469,.19167,.0296568,.0519391,-.0556398,.203224,.0362924,.0599464,-.0631646,.215652,.0440585,.0702427,-.0714308,.232089,.0531619,.0806902,-.0800605,.245258,.0634564,.0923194,-.0892815,.258609,.0752481,.106938,-.09931,.276654,.0888914,.121238,-.109575,.289847,.104055,.138817,-.120461,.307566,.121266,.15595,-.131209,.320117,.139944,.178418,-.143049,.339677,.161591,.197875,-.154074,.349886,.184303,.224368,-.166307,.369352,.210669,.252213,-.178051,.386242,.238895,.277321,-.189335,.395294,.269182,.310332,-.200683,.412148,.302508,.338809,-.210856,.418266,.337264,.372678,-.220655,.428723,.374881,.405632,-.230053,.433887,.415656,.442293,-.237993,.439911,.457982,.477256,-.244897,.440175,.502831,.515592,-.250657,.441079,.550277,.550969,-.255459,.435219,.601102,.592883,-.257696,.432882,.651785,.629092,-.259894,.421054,.708961,.672033,-.258592,.41177,.763806,.709147,-.256525,.395267,.824249,.745367,-.254677,.375013,.8951,.784715,-.247892,.353906,.959317,.818107,-.240162,.327801,1.03153,.847895,-.229741,.298821,1.10601,.879603,-.213084,.269115,1.164,.902605,-.195242,.236606,1.22854,.922788,-.174505,.203442,1.29017,.944831,-.150169,.169594,1.34157,.959656,-.124099,.135909,1.3956,.972399,-.0960626,.0990563,1.45128,.986549,-.0657097,.0602348,1.50312,1.00013,-.0333558,.0186694,1.55364,619747e-11,-1e-7,.00778326,796756e-16,237499e-13,-999999e-13,282592e-10,114596e-15,100292e-11,-166369e-11,250354e-9,677492e-14,350752e-11,-637769e-11,357289e-9,631655e-13,826445e-11,-174689e-10,516179e-9,31851e-11,242481e-10,-450868e-10,.0010223,130577e-11,455631e-10,-89044e-9,.00144302,374587e-11,971222e-10,-178311e-9,.00241912,102584e-10,171403e-9,-313976e-9,.00354938,236481e-10,292747e-9,-520026e-9,.00513765,496014e-10,789827e-9,-.00118187,.0238621,139056e-9,.00114093,-.00171827,.0286691,244093e-9,.00176119,-.00249667,.0368565,420623e-9,.0022233,-.00333742,.0400469,65673e-8,.00343382,-.00481976,.0535751,.00109323,.00427602,-.00600755,.057099,.00155268,.00461435,-.00737637,.0551084,.00215031,.00695698,-.00971401,.0715767,.00316529,.00867619,-.0120943,.0793314,.00436995,.0106694,-.0148202,.0869391,.0058959,.0140351,-.0183501,.101572,.00798757,.0168939,-.022006,.11018,.0104233,.020197,-.0261568,.119041,.0134167,.0254702,-.0312778,.135404,.0173009,.0298384,-.0362469,.1437,.0215428,.035159,-.042237,.15512,.0268882,.0427685,-.0488711,.17128,.033235,.0494848,-.0557997,.181813,.0404443,.0592394,-.0635578,.198745,.0490043,.0681463,-.071838,.210497,.0588239,.0804753,-.0809297,.228864,.0702835,.0942205,-.0906488,.247008,.0834012,.106777,-.100216,.258812,.0975952,.124471,-.110827,.278617,.114162,.138389,-.121193,.287049,.131983,.159543,-.13253,.307151,.152541,.176432,-.143611,.31564,.174673,.201723,-.15548,.33538,.199842,.229721,-.167166,.355256,.227097,.250206,-.178238,.360047,.256014,.282118,-.189905,.378761,.28855,.312821,-.201033,.39181,.323348,.341482,-.211584,.397716,.360564,.377368,-.221314,.410141,.400004,.418229,-.230474,.423485,.442371,.444881,-.239443,.418874,.488796,.488899,-.245987,.427545,.535012,.520317,-.253948,.422147,.589678,.568566,-.256616,.42719,.637683,.599607,-.26376,.415114,.703363,.64222,-.268687,.408715,.771363,.685698,-.2694,.399722,.83574,.732327,-.266642,.388651,.897764,.769873,-.267712,.369198,.983312,.806733,-.263479,.346802,1.06222,.843466,-.254575,.321368,1.13477,.873008,-.242749,.29211,1.20712,.908438,-.22725,.262143,1.27465,.936321,-.207621,.228876,1.33203,.950353,-.187932,.19484,1.40439,.96442,-.165154,.163178,1.4732,.979856,-.139302,.127531,1.53574,.982561,-.11134,.0903457,1.59982,.996389,-.0808124,.0489007,1.6577],tr=[1,0,0,0,1,791421e-36,0,0,1,104392e-29,0,0,1,349405e-26,0,0,1,109923e-23,0,0,1,947414e-22,0,0,1,359627e-20,0,0,1,772053e-19,0,0,1,108799e-17,0,0,1,110655e-16,0,0,1,865818e-16,0,0,.999998,545037e-15,0,0,.999994,285095e-14,0,0,.999989,126931e-13,0,0,.999973,489938e-13,0,0,.999947,166347e-12,0,0,.999894,502694e-12,0,0,.999798,136532e-11,0,0,.999617,335898e-11,0,0,.999234,752126e-11,0,0,.998258,152586e-10,0,0,.99504,266207e-10,0,0,.980816,236802e-10,0,0,.967553,207684e-11,0,0,.966877,403733e-11,0,0,.965752,741174e-11,0,0,.96382,127746e-10,0,0,.960306,202792e-10,0,0,.953619,280232e-10,0,0,.941103,278816e-10,0,0,.926619,160221e-10,0,0,.920983,235164e-10,0,0,.912293,311924e-10,0,.0158731,.899277,348118e-10,0,.0476191,.880884,26041e-9,0,.0793651,.870399,338726e-10,0,.111111,.856138,392906e-10,0,.142857,.837436,372874e-10,0,.174603,.820973,392558e-10,0,.206349,.803583,434658e-10,0,.238095,.782168,40256e-9,0,.269841,.764107,448159e-10,0,.301587,.743092,457627e-10,0,.333333,.721626,455314e-10,0,.365079,.700375,477335e-10,0,.396825,.677334,461072e-10,0,.428571,.655702,484393e-10,0,.460317,.632059,464583e-10,0,.492064,.610125,483923e-10,0,.52381,.58653,464342e-10,0,.555556,.564508,477033e-10,0,.587302,.541405,459263e-10,0,.619048,.519556,46412e-9,0,.650794,.497292,448913e-10,0,.68254,.475898,445789e-10,0,.714286,.454722,433496e-10,0,.746032,.434042,423054e-10,0,.777778,.414126,413737e-10,0,.809524,.394387,397265e-10,0,.84127,.375841,390709e-10,0,.873016,.357219,369938e-10,0,.904762,.340084,365618e-10,0,.936508,.322714,342533e-10,0,.968254,.306974,339596e-10,0,1,1,101524e-23,0,0,1,10292e-22,0,0,1,130908e-23,0,0,1,473331e-23,0,0,1,625319e-22,0,0,1,107932e-20,0,0,1,163779e-19,0,0,1,203198e-18,0,0,1,204717e-17,0,0,.999999,168995e-16,0,0,.999998,115855e-15,0,0,.999996,66947e-14,0,0,.999991,330863e-14,0,0,.999983,141737e-13,0,0,.999968,532626e-13,0,0,.99994,177431e-12,0,0,.999891,528835e-12,0,0,.999797,142169e-11,0,0,.999617,347057e-11,0,0,.999227,77231e-10,0,0,.998239,155753e-10,0,0,.994937,268495e-10,0,0,.980225,213742e-10,0,0,.967549,21631e-10,0,0,.966865,417989e-11,0,0,.965739,763341e-11,0,0,.963794,130892e-10,0,0,.960244,206456e-10,0,0,.953495,282016e-10,0,148105e-9,.940876,271581e-10,0,.002454,.926569,164159e-10,0,.00867491,.920905,239521e-10,0,.01956,.912169,315127e-10,0,.035433,.899095,346626e-10,0,.056294,.882209,290223e-10,0,.0818191,.870272,342992e-10,0,.111259,.855977,394164e-10,0,.142857,.837431,372343e-10,0,.174603,.820826,396691e-10,0,.206349,.803408,435395e-10,0,.238095,.782838,419579e-10,0,.269841,.763941,450953e-10,0,.301587,.742904,455847e-10,0,.333333,.721463,458833e-10,0,.365079,.700197,477159e-10,0,.396825,.677501,470641e-10,0,.428571,.655527,484732e-10,0,.460317,.6324,476834e-10,0,.492064,.609964,484213e-10,0,.52381,.586839,475541e-10,0,.555556,.564353,476951e-10,0,.587302,.541589,467611e-10,0,.619048,.519413,463493e-10,0,.650794,.497337,453994e-10,0,.68254,.475797,445308e-10,0,.714286,.454659,435787e-10,0,.746032,.434065,424839e-10,0,.777778,.414018,41436e-9,0,.809524,.39455,401902e-10,0,.84127,.375742,390813e-10,0,.873016,.357501,377116e-10,0,.904762,.339996,36535e-9,0,.936508,.323069,351265e-10,0,.968254,.306897,339112e-10,0,1,1,10396e-19,0,0,1,104326e-20,0,0,1,110153e-20,0,0,1,144668e-20,0,0,1,34528e-19,0,0,1,175958e-19,0,0,1,12627e-17,0,0,1,936074e-18,0,0,1,645742e-17,0,0,.999998,401228e-16,0,0,.999997,222338e-15,0,0,.999995,10967e-13,0,0,.999991,482132e-14,0,0,.999981,189434e-13,0,0,.999967,667716e-13,0,0,.999938,212066e-12,0,0,.999886,60977e-11,0,0,.999792,159504e-11,0,0,.999608,381191e-11,0,0,.999209,833727e-11,0,0,.998179,165288e-10,0,0,.994605,274387e-10,0,0,.979468,167316e-10,0,0,.967529,242877e-11,0,0,.966836,461696e-11,0,0,.96569,830977e-11,0,0,.963706,140427e-10,0,244659e-11,.960063,217353e-10,0,760774e-9,.953113,286606e-10,0,.00367261,.940192,247691e-10,0,.00940263,.927731,195814e-10,0,.018333,.920669,252531e-10,0,.0306825,.911799,324277e-10,0,.0465556,.89857,340982e-10,0,.0659521,.883283,319622e-10,0,.0887677,.86989,35548e-9,0,.114784,.855483,397143e-10,0,.143618,.837987,391665e-10,0,.174606,.820546,411306e-10,0,.206349,.802878,436753e-10,0,.238095,.783402,444e-7,0,.269841,.763439,458726e-10,0,.301587,.742925,467097e-10,0,.333333,.721633,478887e-10,0,.365079,.69985,481251e-10,0,.396825,.67783,491811e-10,0,.428571,.655126,488199e-10,0,.460318,.632697,496025e-10,0,.492064,.609613,48829e-9,0,.52381,.587098,492754e-10,0,.555556,.564119,482625e-10,0,.587302,.541813,482807e-10,0,.619048,.519342,471552e-10,0,.650794,.497514,466765e-10,0,.68254,.475879,455582e-10,0,.714286,.454789,446007e-10,0,.746032,.434217,435382e-10,0,.777778,.414086,421753e-10,0,.809524,.394744,412093e-10,0,.84127,.375782,396634e-10,0,.873016,.357707,386419e-10,0,.904762,.340038,370345e-10,0,.936508,.323284,359725e-10,0,.968254,.306954,3436e-8,0,1,1,599567e-19,0,0,1,600497e-19,0,0,1,614839e-19,0,0,1,686641e-19,0,0,1,972658e-19,0,0,1,221271e-18,0,0,1,833195e-18,0,0,1,403601e-17,0,0,.999999,206001e-16,0,0,.999998,101739e-15,0,0,.999997,470132e-15,0,0,.999993,200436e-14,0,0,.999988,783682e-14,0,0,.999979,280338e-13,0,0,.999962,917033e-13,0,0,.999933,274514e-12,0,0,.999881,753201e-12,0,0,.999783,189826e-11,0,0,.999594,440279e-11,0,0,.999178,93898e-10,0,0,.998073,181265e-10,0,0,.993993,280487e-10,0,0,.979982,149422e-10,0,0,.968145,378481e-11,0,0,.966786,53771e-10,0,0,.965611,947508e-11,0,388934e-10,.963557,156616e-10,0,9693e-7,.959752,235144e-10,0,.00370329,.952461,291568e-10,0,.00868428,.940193,240102e-10,0,.0161889,.929042,231235e-10,0,.0263948,.920266,273968e-10,0,.0394088,.911178,337915e-10,0,.0552818,.897873,333629e-10,0,.0740138,.884053,351405e-10,0,.0955539,.869455,378034e-10,0,.119795,.854655,399378e-10,0,.14656,.838347,419108e-10,0,.175573,.820693,440831e-10,0,.206388,.802277,445599e-10,0,.238095,.783634,472691e-10,0,.269841,.763159,476984e-10,0,.301587,.742914,491487e-10,0,.333333,.721662,502312e-10,0,.365079,.699668,502817e-10,0,.396825,.677839,51406e-9,0,.428571,.655091,511095e-10,0,.460317,.632665,516067e-10,0,.492064,.609734,512255e-10,0,.52381,.587043,510263e-10,0,.555556,.564298,50565e-9,0,.587302,.541769,497951e-10,0,.619048,.519529,492698e-10,0,.650794,.497574,482066e-10,0,.68254,.476028,473689e-10,0,.714286,.454961,461941e-10,0,.746032,.434341,450618e-10,0,.777778,.414364,438355e-10,0,.809524,.394832,424196e-10,0,.84127,.376109,412563e-10,0,.873016,.35779,396226e-10,0,.904762,.340379,384886e-10,0,.936508,.323385,368214e-10,0,.968254,.307295,356636e-10,0,1,1,106465e-17,0,0,1,106555e-17,0,0,1,107966e-17,0,0,1,114601e-17,0,0,1,137123e-17,0,0,1,21243e-16,0,0,.999999,489653e-17,0,0,.999999,160283e-16,0,0,.999998,62269e-15,0,0,.999997,251859e-15,0,0,.999996,996192e-15,0,0,.999992,374531e-14,0,0,.999986,132022e-13,0,0,.999975,433315e-13,0,0,.999959,131956e-12,0,0,.999927,372249e-12,0,0,.999871,972461e-12,0,0,.999771,235343e-11,0,0,.999572,52768e-10,0,0,.999133,109237e-10,0,0,.997912,203675e-10,0,0,.993008,279396e-10,0,0,.980645,139604e-10,0,0,.970057,646596e-11,0,0,.966717,65089e-10,0,474145e-10,.965497,111863e-10,0,89544e-8,.96334,179857e-10,0,.0032647,.959294,259045e-10,0,.0075144,.951519,292327e-10,0,.0138734,.940517,249769e-10,0,.0224952,.93014,26803e-9,0,.0334828,.91972,303656e-10,0,.0468973,.910294,353323e-10,0,.0627703,.897701,351002e-10,0,.0811019,.884522,388104e-10,0,.10186,.869489,412932e-10,0,.124985,.853983,415781e-10,0,.150372,.838425,454066e-10,0,.177868,.820656,471624e-10,0,.207245,.801875,475243e-10,0,.238143,.783521,505621e-10,0,.269841,.763131,50721e-9,0,.301587,.74261,523293e-10,0,.333333,.72148,528699e-10,0,.365079,.699696,538677e-10,0,.396825,.677592,539255e-10,0,.428571,.65525,546367e-10,0,.460317,.632452,541348e-10,0,.492064,.609903,544976e-10,0,.52381,.586928,536201e-10,0,.555556,.564464,535185e-10,0,.587302,.541801,524949e-10,0,.619048,.519681,51812e-9,0,.650794,.497685,507687e-10,0,.68254,.47622,496243e-10,0,.714286,.455135,485714e-10,0,.746032,.4346,471847e-10,0,.777778,.414564,459294e-10,0,.809524,.395165,444705e-10,0,.84127,.376333,430772e-10,0,.873016,.358197,416229e-10,0,.904762,.34064,401019e-10,0,.936508,.323816,386623e-10,0,.968254,.307581,370933e-10,0,1,1,991541e-17,0,0,1,992077e-17,0,0,1,100041e-16,0,0,1,10385e-15,0,0,1,115777e-16,0,0,1,150215e-16,0,0,.999999,254738e-16,0,0,.999999,598822e-16,0,0,.999998,179597e-15,0,0,.999997,602367e-15,0,0,.999994,206835e-14,0,0,.99999,694952e-14,0,0,.999984,223363e-13,0,0,.999972,678578e-13,0,0,.999952,193571e-12,0,0,.999919,516594e-12,0,0,.99986,128739e-11,0,0,.999753,299298e-11,0,0,.999546,648258e-11,0,0,.999074,129985e-10,0,0,.997671,232176e-10,0,0,.991504,256701e-10,0,0,.981148,131141e-10,0,0,.971965,869048e-11,0,280182e-10,.966624,808301e-11,0,695475e-9,.965344,135235e-10,0,.00265522,.963048,210592e-10,0,.00622975,.958673,287473e-10,0,.0116234,.950262,281379e-10,0,.018976,.940836,271089e-10,0,.0283844,.930996,30926e-9,0,.0399151,.919848,348359e-10,0,.0536063,.909136,366092e-10,0,.0694793,.897554,384162e-10,0,.0875342,.884691,430971e-10,0,.107749,.869414,447803e-10,0,.130087,.853462,452858e-10,0,.154481,.838187,495769e-10,0,.180833,.820381,502709e-10,0,.209005,.801844,522713e-10,0,.238791,.783061,541505e-10,0,.269869,.763205,553712e-10,0,.301587,.742362,564909e-10,0,.333333,.721393,572646e-10,0,.365079,.699676,581012e-10,0,.396825,.677395,58096e-9,0,.428571,.655208,585766e-10,0,.460317,.632451,583602e-10,0,.492064,.609839,580234e-10,0,.52381,.587093,577161e-10,0,.555556,.564467,568447e-10,0,.587302,.542043,563166e-10,0,.619048,.519826,55156e-9,0,.650794,.497952,541682e-10,0,.68254,.476477,528971e-10,0,.714286,.455412,514952e-10,0,.746032,.434926,502222e-10,0,.777778,.4149,485779e-10,0,.809524,.395552,472242e-10,0,.84127,.376712,454891e-10,0,.873016,.358622,440924e-10,0,.904762,.341048,422984e-10,0,.936508,.324262,408582e-10,0,.968254,.308013,390839e-10,0,1,1,613913e-16,0,0,1,614145e-16,0,0,1,617708e-16,0,0,1,633717e-16,0,0,1,681648e-16,0,0,1,808291e-16,0,0,1,114608e-15,0,0,.999998,210507e-15,0,0,.999997,499595e-15,0,0,.999995,139897e-14,0,0,.999994,419818e-14,0,0,.999988,127042e-13,0,0,.999979,375153e-13,0,0,.999965,106206e-12,0,0,.999945,285381e-12,0,0,.999908,723611e-12,0,0,.999846,17255e-10,0,0,.999733,386104e-11,0,0,.999511,808493e-11,0,0,.998993,156884e-10,0,0,.997326,265538e-10,0,0,.989706,206466e-10,0,0,.981713,130756e-10,0,70005e-10,.973636,106473e-10,0,464797e-9,.966509,10194e-9,0,.00201743,.965149,165881e-10,0,.00497549,.962669,249147e-10,0,.00953262,.95786,317449e-10,0,.0158211,.949334,281045e-10,0,.0239343,.941041,303263e-10,0,.0339372,.931575,356754e-10,0,.0458738,.920102,397075e-10,0,.059772,.908002,384886e-10,0,.075645,.897269,43027e-9,0,.0934929,.884559,479925e-10,0,.113302,.869161,48246e-9,0,.135045,.853342,509505e-10,0,.158678,.837633,542846e-10,0,.184136,.820252,554139e-10,0,.211325,.801872,581412e-10,0,.240113,.782418,585535e-10,0,.270306,.7631,610923e-10,0,.301594,.742183,613678e-10,0,.333333,.721098,627275e-10,0,.365079,.699512,629413e-10,0,.396825,.677372,636351e-10,0,.428571,.655059,633555e-10,0,.460317,.632567,636513e-10,0,.492064,.609784,628965e-10,0,.52381,.587237,625546e-10,0,.555556,.564525,615825e-10,0,.587302,.542181,605048e-10,0,.619048,.520017,596329e-10,0,.650794,.498204,581516e-10,0,.68254,.476742,569186e-10,0,.714286,.455803,553833e-10,0,.746032,.435251,537807e-10,0,.777778,.415374,522025e-10,0,.809524,.395921,503421e-10,0,.84127,.377253,488211e-10,0,.873016,.359021,468234e-10,0,.904762,.341637,453269e-10,0,.936508,.3247,433014e-10,0,.968254,.308625,418007e-10,0,1,1,286798e-15,0,0,1,286877e-15,0,0,1,288094e-15,0,0,1,293506e-15,0,0,1,309262e-15,0,0,.999999,348593e-15,0,0,.999999,444582e-15,0,0,.999998,688591e-15,0,0,.999996,134391e-14,0,0,.999993,317438e-14,0,0,.999989,835609e-14,0,0,.999983,228677e-13,0,0,.999974,623361e-13,0,0,.999959,165225e-12,0,0,.999936,419983e-12,0,0,.999896,101546e-11,0,0,.99983,232376e-11,0,0,.999709,50156e-10,0,0,.999469,10167e-9,0,0,.998886,190775e-10,0,0,.996819,300511e-10,0,0,.988837,185092e-10,0,168222e-12,.982178,134622e-10,0,259622e-9,.975017,125961e-10,0,.00142595,.967101,13507e-9,0,.00382273,.964905,205003e-10,0,.00764164,.96218,29546e-9,0,.0130121,.956821,343738e-10,0,.0200253,.948829,305063e-10,0,.0287452,.941092,346487e-10,0,.039218,.931883,412061e-10,0,.0514748,.920211,444651e-10,0,.0655351,.907307,431252e-10,0,.0814082,.89684,490382e-10,0,.0990939,.884119,53334e-9,0,.118583,.869148,54114e-9,0,.139856,.853377,578536e-10,0,.162882,.836753,592285e-10,0,.187615,.820063,622787e-10,0,.213991,.801694,645492e-10,0,.241918,.782116,65353e-9,0,.271267,.762673,674344e-10,0,.301847,.742133,682788e-10,0,.333333,.720779,691959e-10,0,.365079,.699386,696817e-10,0,.396826,.67732,699583e-10,0,.428572,.654888,698447e-10,0,.460318,.632499,694063e-10,0,.492064,.609825,691612e-10,0,.52381,.587287,681576e-10,0,.555556,.564743,674138e-10,0,.587302,.542409,661617e-10,0,.619048,.520282,647785e-10,0,.650794,.498506,633836e-10,0,.68254,.477102,615905e-10,0,.714286,.456167,601013e-10,0,.746032,.435728,581457e-10,0,.777778,.415809,564215e-10,0,.809524,.396517,544997e-10,0,.84127,.377737,525061e-10,0,.873016,.359698,506831e-10,0,.904762,.342164,48568e-9,0,.936508,.325417,467826e-10,0,.968254,.309186,446736e-10,0,1,1,109018e-14,0,0,1,10904e-13,0,0,1,109393e-14,0,0,1,11095e-13,0,0,1,1154e-12,0,0,1,126089e-14,0,0,.999999,15059e-13,0,0,.999997,207899e-14,0,0,.999994,348164e-14,0,0,.999993,705728e-14,0,0,.999987,163692e-13,0,0,.999981,406033e-13,0,0,.999969,10245e-11,0,0,.999953,255023e-12,0,0,.999925,61511e-11,0,0,.999881,142218e-11,0,0,.99981,313086e-11,0,0,.99968,653119e-11,0,0,.999418,12832e-9,0,0,.998748,232497e-10,0,0,.996066,329522e-10,0,0,.988379,179613e-10,0,108799e-9,.982567,143715e-10,0,921302e-9,.976097,148096e-10,0,.00280738,.968475,178905e-10,0,.00596622,.964606,253921e-10,0,.0105284,.961564,348623e-10,0,.0165848,.955517,357612e-10,0,.0242,.948381,343493e-10,0,.03342,.941095,405849e-10,0,.0442777,.931923,475394e-10,0,.0567958,.91996,484328e-10,0,.0709879,.907419,502146e-10,0,.086861,.89618,561654e-10,0,.104415,.88337,587612e-10,0,.123643,.869046,618057e-10,0,.144531,.853278,657392e-10,0,.167057,.836091,66303e-9,0,.191188,.819644,704445e-10,0,.216878,.801246,714071e-10,0,.244062,.782031,740093e-10,0,.272649,.762066,74685e-9,0,.302509,.741964,766647e-10,0,.333442,.720554,766328e-10,0,.365079,.699098,777857e-10,0,.396826,.677189,774633e-10,0,.428572,.65484,776235e-10,0,.460318,.632496,770316e-10,0,.492064,.609908,762669e-10,0,.52381,.587312,753972e-10,0,.555556,.564938,739994e-10,0,.587302,.542577,728382e-10,0,.619048,.52062,71112e-9,0,.650794,.498819,694004e-10,0,.68254,.477555,675575e-10,0,.714286,.456568,653449e-10,0,.746032,.436278,636068e-10,0,.777778,.41637,613466e-10,0,.809524,.397144,594177e-10,0,.84127,.378412,570987e-10,0,.873016,.360376,550419e-10,0,.904762,.342906,527422e-10,0,.936508,.326136,506544e-10,0,.968254,.30997,484307e-10,0,1,1,354014e-14,0,0,1,354073e-14,0,0,1,354972e-14,0,0,1,358929e-14,0,0,1,370093e-14,0,0,.999999,396194e-14,0,0,.999998,453352e-14,0,0,.999997,578828e-14,0,0,.999994,863812e-14,0,0,.999991,153622e-13,0,0,.999985,316356e-13,0,0,.999977,712781e-13,0,0,.999964,166725e-12,0,0,.999945,390501e-12,0,0,.999912,895622e-12,0,0,.999866,198428e-11,0,0,.999786,421038e-11,0,0,.999647,850239e-11,0,0,.999356,162059e-10,0,0,.998563,282652e-10,0,0,.994928,336309e-10,0,244244e-10,.987999,178458e-10,0,523891e-9,.982893,159162e-10,0,.00194729,.977044,178056e-10,0,.00451099,.969972,230624e-10,0,.00835132,.964237,313922e-10,0,.013561,.960791,406145e-10,0,.0202056,.954292,372796e-10,0,.0283321,.948052,403199e-10,0,.0379739,.940938,479537e-10,0,.0491551,.931689,545292e-10,0,.0618918,.91987,54038e-9,0,.0761941,.907665,589909e-10,0,.0920672,.895281,642651e-10,0,.109511,.882621,659707e-10,0,.12852,.86873,709973e-10,0,.149085,.853008,742221e-10,0,.171189,.835944,761754e-10,0,.194809,.818949,797052e-10,0,.21991,.800951,812434e-10,0,.246447,.781847,838075e-10,0,.274352,.761649,84501e-9,0,.303535,.74152,860258e-10,0,.333857,.720495,866233e-10,0,.365104,.698742,868326e-10,0,.396826,.677096,87133e-9,0,.428572,.654782,863497e-10,0,.460318,.632335,860206e-10,0,.492064,.610031,849337e-10,0,.52381,.587457,838279e-10,0,.555556,.56513,82309e-9,0,.587302,.542877,803542e-10,0,.619048,.5209,786928e-10,0,.650794,.499291,765171e-10,0,.68254,.477971,744753e-10,0,.714286,.457221,72209e-9,0,.746032,.436803,697448e-10,0,.777778,.417083,675333e-10,0,.809524,.397749,648058e-10,0,.84127,.379177,625759e-10,0,.873016,.361061,598584e-10,0,.904762,.343713,575797e-10,0,.936508,.326894,549999e-10,0,.968254,.310816,527482e-10,0,1,1,10153e-12,0,0,1,101544e-13,0,0,1,101751e-13,0,0,1,102662e-13,0,0,1,10521e-12,0,0,.999999,111049e-13,0,0,.999999,123408e-13,0,0,.999996,14924e-12,0,0,.999992,204471e-13,0,0,.999989,326539e-13,0,0,.99998,603559e-13,0,0,.999971,123936e-12,0,0,.999955,269058e-12,0,0,.999933,593604e-12,0,0,.999901,129633e-11,0,0,.999847,275621e-11,0,0,.999761,564494e-11,0,0,.999607,110485e-10,0,0,.999282,204388e-10,0,0,.99831,341084e-10,0,22038e-11,.993288,294949e-10,0,242388e-9,.987855,192736e-10,0,.0012503,.983167,182383e-10,0,.0032745,.977908,218633e-10,0,.00646321,.971194,290662e-10,0,.0109133,.963867,386401e-10,0,.0166927,.95982,462827e-10,0,.0238494,.953497,420705e-10,0,.0324178,.947621,477743e-10,0,.0424225,.940611,568258e-10,0,.0538808,.931174,618061e-10,0,.0668047,.919919,627098e-10,0,.0812014,.907856,694714e-10,0,.0970745,.894509,735008e-10,0,.114424,.881954,763369e-10,0,.133246,.868309,821896e-10,0,.153534,.852511,83769e-9,0,.175275,.835821,881615e-10,0,.198453,.817981,896368e-10,0,.223042,.800504,930906e-10,0,.249009,.78141,945056e-10,0,.276304,.761427,963605e-10,0,.304862,.74094,968088e-10,0,.334584,.720233,981481e-10,0,.365322,.698592,979122e-10,0,.396826,.676763,981057e-10,0,.428571,.654808,973956e-10,0,.460318,.632326,962619e-10,0,.492064,.610049,952996e-10,0,.52381,.58763,933334e-10,0,.555556,.565261,917573e-10,0,.587302,.543244,896636e-10,0,.619048,.521273,873304e-10,0,.650794,.499818,852648e-10,0,.68254,.478536,823961e-10,0,.714286,.457826,79939e-9,0,.746032,.437549,77126e-9,0,.777778,.41776,743043e-10,0,.809524,.39863,716426e-10,0,.84127,.379954,686456e-10,0,.873016,.362025,660514e-10,0,.904762,.344581,630755e-10,0,.936508,.327909,605439e-10,0,.968254,.311736,576345e-10,0,1,1,263344e-13,0,0,1,263373e-13,0,0,1,263815e-13,0,0,1,265753e-13,0,0,1,271132e-13,0,0,.999999,283279e-13,0,0,.999997,30833e-12,0,0,.999995,358711e-13,0,0,.999992,461266e-13,0,0,.999985,67574e-12,0,0,.999977,11358e-11,0,0,.999966,213657e-12,0,0,.999948,431151e-12,0,0,.999923,896656e-12,0,0,.999884,186603e-11,0,0,.999826,381115e-11,0,0,.999732,754184e-11,0,0,.999561,143192e-10,0,0,.999191,257061e-10,0,0,.997955,405724e-10,0,744132e-10,.992228,276537e-10,0,716477e-9,.987638,208885e-10,0,.0022524,.983395,215226e-10,0,.00484816,.978614,270795e-10,0,.00860962,.972389,365282e-10,0,.0136083,.964392,474747e-10,0,.0198941,.95861,509141e-10,0,.0275023,.952806,48963e-9,0,.0364584,.94712,571119e-10,0,.04678,.940104,671704e-10,0,.0584799,.930398,687586e-10,0,.0715665,.919866,738161e-10,0,.086045,.907853,813235e-10,0,.101918,.894078,834582e-10,0,.119186,.881177,892093e-10,0,.137845,.867575,944548e-10,0,.157891,.852107,969607e-10,0,.179316,.835502,101456e-9,0,.202106,.81756,103256e-9,0,.226243,.79984,106954e-9,0,.251704,.780998,108066e-9,0,.278451,.761132,110111e-9,0,.306436,.740429,110459e-9,0,.335586,.719836,111219e-9,0,.365796,.698467,11145e-8,0,.3969,.676446,110393e-9,0,.428571,.654635,110035e-9,0,.460318,.632411,108548e-9,0,.492064,.609986,106963e-9,0,.52381,.587872,105238e-9,0,.555556,.565528,102665e-9,0,.587302,.543563,100543e-9,0,.619048,.52176,976182e-10,0,.650794,.500188,947099e-10,0,.68254,.479204,919929e-10,0,.714286,.458413,886139e-10,0,.746032,.438314,857839e-10,0,.777778,.418573,82411e-9,0,.809524,.39947,792211e-10,0,.84127,.380892,759546e-10,0,.873016,.362953,727571e-10,0,.904762,.345601,695738e-10,0,.936508,.328895,664907e-10,0,.968254,.312808,634277e-10,0,1,1,628647e-13,0,0,1,628705e-13,0,0,1,629587e-13,0,0,1,633441e-13,0,0,.999999,644087e-13,0,0,.999998,667856e-13,0,0,.999997,715889e-13,0,0,.999995,809577e-13,0,0,.999989,992764e-13,0,0,.999983,135834e-12,0,0,.999974,210482e-12,0,0,.999959,365215e-12,0,0,.999939,686693e-12,0,0,.999911,13472e-10,0,0,.999868,26731e-10,0,0,.999804,524756e-11,0,0,.9997,100403e-10,0,0,.99951,185019e-10,0,0,.999078,322036e-10,0,620676e-11,.997428,470002e-10,0,341552e-9,.99162,287123e-10,0,.00143727,.987479,234706e-10,0,.00349201,.983582,260083e-10,0,.0066242,.979186,337927e-10,0,.0109113,.97325,454689e-10,0,.0164064,.965221,573759e-10,0,.0231463,.957262,544114e-10,0,.0311571,.952211,587006e-10,0,.0404572,.946631,692256e-10,0,.0510592,.939391,787819e-10,0,.0629723,.929795,792368e-10,0,.0762025,.91965,875075e-10,0,.090753,.907737,950903e-10,0,.106626,.893899,972963e-10,0,.123822,.880239,10459e-8,0,.142337,.866562,107689e-9,0,.16217,.85164,113081e-9,0,.183314,.835021,116636e-9,0,.20576,.817311,120074e-9,0,.229496,.798845,121921e-9,0,.254502,.780479,12475e-8,0,.280753,.760694,125255e-9,0,.308212,.740142,126719e-9,0,.336825,.719248,12636e-8,0,.366517,.698209,126712e-9,0,.397167,.676398,125769e-9,0,.428578,.654378,124432e-9,0,.460318,.632484,123272e-9,0,.492064,.610113,12085e-8,0,.52381,.587931,118411e-9,0,.555556,.565872,11569e-8,0,.587302,.543814,112521e-9,0,.619048,.522265,109737e-9,0,.650794,.500835,106228e-9,0,.68254,.479818,102591e-9,0,.714286,.459258,991288e-10,0,.746032,.439061,952325e-10,0,.777778,.419552,91895e-9,0,.809524,.400399,879051e-10,0,.84127,.381976,844775e-10,0,.873016,.364009,806316e-10,0,.904762,.346761,771848e-10,0,.936508,.330049,735429e-10,0,.968254,.314018,702103e-10,0,1,1,139968e-12,0,0,1,139979e-12,0,0,1,140145e-12,0,0,1,14087e-11,0,0,.999999,142865e-12,0,0,.999998,147279e-12,0,0,.999997,156057e-12,0,0,.999992,17276e-11,0,0,.999989,204352e-12,0,0,.99998,26494e-11,0,0,.999969,383435e-12,0,0,.999953,618641e-12,0,0,.999929,108755e-11,0,0,.999898,201497e-11,0,0,.999849,381346e-11,0,0,.999778,719815e-11,0,0,.999661,133215e-10,0,0,.999451,238313e-10,0,0,.998936,401343e-10,0,113724e-9,.99662,517346e-10,0,820171e-9,.991094,304323e-10,0,.00238143,.987487,281757e-10,0,.00493527,.983731,320048e-10,0,.00856859,.979647,423905e-10,0,.0133393,.973837,562935e-10,0,.0192863,.96584,677442e-10,0,.0264369,.956309,623073e-10,0,.03481,.951523,704131e-10,0,.0444184,.946003,836594e-10,0,.0552713,.938454,911736e-10,0,.0673749,.929279,938264e-10,0,.0807329,.919239,103754e-9,0,.0953479,.907293,109928e-9,0,.111221,.893936,115257e-9,0,.128352,.879674,122265e-9,0,.14674,.865668,125733e-9,0,.166382,.850998,132305e-9,0,.187276,.834498,134844e-9,0,.209413,.816903,139276e-9,0,.232786,.798235,140984e-9,0,.257382,.779724,14378e-8,0,.283181,.760251,144623e-9,0,.310156,.739808,145228e-9,0,.338269,.718762,14539e-8,0,.367461,.697815,144432e-9,0,.397646,.67631,143893e-9,0,.428685,.654278,141846e-9,0,.460318,.632347,13935e-8,0,.492064,.610296,137138e-9,0,.52381,.588039,133806e-9,0,.555556,.566218,130755e-9,0,.587302,.544346,127128e-9,0,.619048,.522701,123002e-9,0,.650794,.501542,119443e-9,0,.68254,.480508,115055e-9,0,.714286,.460092,111032e-9,0,.746032,.440021,106635e-9,0,.777778,.420446,102162e-9,0,.809524,.401512,98184e-9,0,.84127,.38299,936497e-10,0,.873016,.365232,89813e-9,0,.904762,.347865,853073e-10,0,.936508,.331342,817068e-10,0,.968254,.315202,773818e-10,0,1,1,29368e-11,0,0,1,2937e-10,0,0,1,293998e-12,0,0,1,295298e-12,0,0,.999999,298865e-12,0,0,.999998,3067e-10,0,0,.999995,322082e-12,0,0,.999992,350767e-12,0,0,.999986,403538e-12,0,0,.999976,501372e-12,0,0,.999964,68562e-11,0,0,.999945,10374e-10,0,0,.999919,171269e-11,0,0,.999882,300175e-11,0,0,.999829,542144e-11,0,0,.999749,984182e-11,0,0,.99962,176213e-10,0,0,.999382,305995e-10,0,138418e-10,.998751,496686e-10,0,389844e-9,.995344,510733e-10,0,.00150343,.990768,345829e-10,0,.00352451,.987464,342841e-10,0,.00655379,.983846,399072e-10,0,.0106554,.980007,533219e-10,0,.0158723,.974494,696992e-10,0,.0222333,.96622,776754e-10,0,.029758,.956273,747718e-10,0,.0384596,.950952,864611e-10,0,.0483473,.945215,100464e-9,0,.0594266,.937287,103729e-9,0,.0717019,.928649,111665e-9,0,.0851752,.918791,12353e-8,0,.0998479,.906685,127115e-9,0,.115721,.893706,13628e-8,0,.132794,.879248,142427e-9,0,.151067,.864685,148091e-9,0,.170538,.850032,153517e-9,0,.191204,.833853,157322e-9,0,.213063,.816353,161086e-9,0,.236107,.797834,164111e-9,0,.260329,.778831,165446e-9,0,.285714,.759756,167492e-9,0,.312243,.739419,166928e-9,0,.339887,.718491,167e-6,0,.368604,.697392,165674e-9,0,.398329,.676102,163815e-9,0,.428961,.654243,162003e-9,0,.460331,.632176,158831e-9,0,.492064,.610407,155463e-9,0,.52381,.588394,152062e-9,0,.555556,.56645,147665e-9,0,.587302,.5449,14375e-8,0,.619048,.523276,138905e-9,0,.650794,.502179,134189e-9,0,.68254,.481359,129392e-9,0,.714286,.46092,124556e-9,0,.746032,.441084,11957e-8,0,.777778,.421517,114652e-9,0,.809524,.402721,109688e-9,0,.84127,.384222,104667e-9,0,.873016,.366534,999633e-10,0,.904762,.349205,950177e-10,0,.936508,.332702,907301e-10,0,.968254,.316599,859769e-10,0,1,1,585473e-12,0,0,1,585507e-12,0,0,1,58602e-11,0,0,.999999,588259e-12,0,0,.999999,594381e-12,0,0,.999998,607754e-12,0,0,.999995,633729e-12,0,0,.99999,68137e-11,0,0,.999984,767003e-12,0,0,.999973,921212e-12,0,0,.999959,120218e-11,0,0,.999936,172024e-11,0,0,.999907,268088e-11,0,0,.999866,445512e-11,0,0,.999806,768481e-11,0,0,.999716,1342e-8,0,0,.999576,232473e-10,0,0,.9993,391694e-10,0,129917e-9,.998498,608429e-10,0,845035e-9,.994132,489743e-10,0,.00237616,.99031,384644e-10,0,.00484456,.987409,421768e-10,0,.00832472,.983981,504854e-10,0,.0128643,.980268,671028e-10,0,.0184947,.974875,852749e-10,0,.025237,.966063,85531e-9,0,.0331046,.956779,900588e-10,0,.0421067,.950259,10577e-8,0,.0522487,.944239,119458e-9,0,.0635343,.936341,122164e-9,0,.0759654,.928047,134929e-9,0,.0895434,.918065,145544e-9,0,.104269,.906267,150531e-9,0,.120142,.893419,161652e-9,0,.137163,.878758,16593e-8,0,.15533,.863699,174014e-9,0,.174645,.848876,177877e-9,0,.195106,.833032,184049e-9,0,.21671,.815557,186088e-9,0,.239454,.797323,19054e-8,0,.263332,.778124,191765e-9,0,.288336,.758929,192535e-9,0,.314451,.738979,192688e-9,0,.341658,.718213,191522e-9,0,.369924,.696947,190491e-9,0,.399202,.675807,187913e-9,0,.429416,.654147,184451e-9,0,.460447,.63229,181442e-9,0,.492064,.610499,177139e-9,0,.523809,.588747,172596e-9,0,.555555,.566783,167457e-9,0,.587301,.545359,162518e-9,0,.619048,.523984,156818e-9,0,.650794,.502917,151884e-9,0,.68254,.482294,145514e-9,0,.714286,.461945,140199e-9,0,.746032,.442133,134101e-9,0,.777778,.422705,128374e-9,0,.809524,.403916,122996e-9,0,.84127,.38554,116808e-9,0,.873016,.367909,111973e-9,0,.904762,.350651,105938e-9,0,.936508,.334208,101355e-9,0,.968254,.318123,957629e-10,0,1,1,111633e-11,0,0,1,111639e-11,0,0,1,111725e-11,0,0,1,112096e-11,0,0,.999999,11311e-10,0,0,.999997,115315e-11,0,0,.999995,11956e-10,0,0,.999989,127239e-11,0,0,.999981,140772e-11,0,0,.999969,164541e-11,0,0,.999952,206607e-11,0,0,.999928,281783e-11,0,0,.999895,416835e-11,0,0,.999848,658728e-11,0,0,.999781,108648e-10,0,0,.999682,182579e-10,0,0,.999523,306003e-10,0,159122e-10,.999205,499862e-10,0,391184e-9,.998131,73306e-9,0,.00147534,.993334,513229e-10,0,.0034227,.99016,467783e-10,0,.00632232,.987321,523413e-10,0,.0102295,.984099,64267e-9,0,.0151794,.980432,843042e-10,0,.0211947,.974976,102819e-9,0,.0282899,.966429,996234e-10,0,.0364739,.957633,111074e-9,0,.0457522,.949422,128644e-9,0,.0561278,.943045,140076e-9,0,.0676023,.935448,146349e-9,0,.0801762,.927225,161854e-9,0,.0938499,.917033,169135e-9,0,.108623,.905762,179987e-9,0,.124496,.892879,189832e-9,0,.141469,.878435,195881e-9,0,.159541,.863114,20466e-8,0,.178713,.84776,209473e-9,0,.198985,.832084,214861e-9,0,.220355,.814915,217695e-9,0,.242823,.796711,220313e-9,0,.266385,.777603,22313e-8,0,.291036,.757991,222471e-9,0,.316767,.738371,222869e-9,0,.343563,.717872,221243e-9,0,.371402,.696619,218089e-9,0,.400248,.675379,21562e-8,0,.430047,.65411,21169e-8,0,.460709,.63241,206947e-9,0,.492079,.61046,201709e-9,0,.52381,.58903,196753e-9,0,.555556,.567267,189637e-9,0,.587302,.545886,184735e-9,0,.619048,.524714,177257e-9,0,.650794,.503789,171424e-9,0,.68254,.483204,164688e-9,0,.714286,.462976,157172e-9,0,.746032,.443294,151341e-9,0,.777778,.423988,143737e-9,0,.809524,.405325,138098e-9,0,.84127,.386981,130698e-9,0,.873016,.369436,125276e-9,0,.904762,.35219,118349e-9,0,.936508,.335804,11312e-8,0,.968254,.319749,106687e-9,0,1,1,204685e-11,0,0,1,204694e-11,0,0,1,204831e-11,0,0,.999999,205428e-11,0,0,.999999,207056e-11,0,0,.999997,210581e-11,0,0,.999993,21732e-10,0,0,.999987,229365e-11,0,0,.999979,250243e-11,0,0,.999965,286127e-11,0,0,.999947,348028e-11,0,0,.999918,455588e-11,0,0,.999881,643303e-11,0,0,.999828,970064e-11,0,0,.999753,153233e-10,0,0,.999642,24793e-9,0,0,.999464,402032e-10,0,122947e-9,.999089,635852e-10,0,807414e-9,.997567,857026e-10,0,.00227206,.992903,594912e-10,0,.00462812,.990011,578515e-10,0,.00794162,.987192,65399e-9,0,.0122534,.98418,819675e-10,0,.0175888,.980491,105514e-9,0,.0239635,.974779,121532e-9,0,.031387,.96675,119144e-9,0,.0398644,.958248,136125e-9,0,.0493982,.948884,155408e-9,0,.0599896,.941673,162281e-9,0,.0716382,.934521,176754e-9,0,.0843437,.926205,192873e-9,0,.0981056,.916089,200038e-9,0,.112923,.904963,213624e-9,0,.128796,.892089,221834e-9,0,.145725,.878028,232619e-9,0,.163709,.86249,238632e-9,0,.182749,.846587,247002e-9,0,.202847,.830988,250702e-9,0,.224001,.814165,255562e-9,0,.246214,.796135,257505e-9,0,.269482,.777052,258625e-9,0,.293805,.757201,258398e-9,0,.319176,.737655,256714e-9,0,.345587,.717477,255187e-9,0,.373021,.696433,251792e-9,0,.401454,.675084,247223e-9,0,.430844,.653907,242213e-9,0,.461125,.632561,237397e-9,0,.492187,.610658,229313e-9,0,.52381,.589322,224402e-9,0,.555556,.567857,216116e-9,0,.587302,.54652,209124e-9,0,.619048,.525433,201601e-9,0,.650794,.504679,192957e-9,0,.68254,.484203,186052e-9,0,.714286,.464203,177672e-9,0,.746032,.444549,170005e-9,0,.777778,.425346,162401e-9,0,.809524,.406706,1544e-7,0,.84127,.388576,147437e-9,0,.873016,.37094,139493e-9,0,.904762,.353996,133219e-9,0,.936508,.337391,125573e-9,0,.968254,.321648,119867e-9,0,1,1,362511e-11,0,0,1,362525e-11,0,0,1,362739e-11,0,0,.999999,363673e-11,0,0,.999998,366214e-11,0,0,.999996,371698e-11,0,0,.999992,382116e-11,0,0,.999986,400554e-11,0,0,.999976,432058e-11,0,0,.999961,485194e-11,0,0,.999938,574808e-11,0,0,.999908,726643e-11,0,0,.999865,984707e-11,0,0,.999807,142217e-10,0,0,.999723,215581e-10,0,0,.999602,336114e-10,0,119113e-10,.999398,527353e-10,0,355813e-9,.998946,805809e-10,0,.00137768,.996647,942908e-10,0,.00322469,.992298,668733e-10,0,.00597897,.989802,716564e-10,0,.00968903,.987019,821355e-10,0,.0143845,.984219,104555e-9,0,.0200831,.980425,131245e-9,0,.0267948,.974241,139613e-9,0,.034525,.967006,145931e-9,0,.0432757,.95893,167153e-9,0,.0530471,.949157,188146e-9,0,.0638386,.94062,194625e-9,0,.0756487,.933509,213721e-9,0,.0884762,.925088,229616e-9,0,.10232,.915178,239638e-9,0,.117178,.904093,254814e-9,0,.133051,.891337,263685e-9,0,.149939,.877326,274789e-9,0,.167841,.861794,280534e-9,0,.18676,.845758,289534e-9,0,.206696,.829792,294446e-9,0,.22765,.813037,296877e-9,0,.249625,.795285,300217e-9,0,.27262,.776323,299826e-9,0,.296636,.756673,299787e-9,0,.321671,.736856,297867e-9,0,.347718,.716883,294052e-9,0,.374768,.696089,289462e-9,0,.402804,.67505,285212e-9,0,.431796,.653509,27653e-8,0,.461695,.63258,271759e-9,0,.49242,.61104,262811e-9,0,.523822,.589567,255151e-9,0,.555556,.568322,246434e-9,0,.587302,.547235,237061e-9,0,.619048,.52616,228343e-9,0,.650794,.505716,219236e-9,0,.68254,.485274,209595e-9,0,.714286,.465411,201011e-9,0,.746032,.445854,19109e-8,0,.777778,.426911,182897e-9,0,.809524,.408222,173569e-9,0,.84127,.390307,165496e-9,0,.873016,.372624,156799e-9,0,.904762,.355804,14917e-8,0,.936508,.33924,140907e-9,0,.968254,.323534,134062e-9,0,1,1,622487e-11,0,0,1,62251e-10,0,0,1,622837e-11,0,0,.999999,624259e-11,0,0,.999998,628127e-11,0,0,.999996,636451e-11,0,0,.999991,65218e-10,0,0,.999984,679782e-11,0,0,.999973,726361e-11,0,0,.999955,803644e-11,0,0,.999931,931397e-11,0,0,.999896,114299e-10,0,0,.999847,149402e-10,0,0,.999784,207461e-10,0,0,.999692,302493e-10,0,0,.999554,454957e-10,0,997275e-10,.999326,690762e-10,0,724813e-9,.998757,101605e-9,0,.0020972,.995367,958745e-10,0,.00432324,.99209,832808e-10,0,.00746347,.989517,887601e-10,0,.0115534,.987008,10564e-8,0,.0166134,.98421,133179e-9,0,.0226552,.98021,161746e-9,0,.0296838,.973676,161821e-9,0,.0377016,.967052,178635e-9,0,.0467079,.959385,206765e-9,0,.0567013,.949461,22476e-8,0,.0676796,.939578,23574e-8,0,.0796403,.932416,25893e-8,0,.0925812,.923759,271228e-9,0,.106501,.914223,289165e-9,0,.121397,.902942,301156e-9,0,.13727,.890419,313852e-9,0,.15412,.876639,324408e-9,0,.171946,.861316,33249e-8,0,.190751,.84496,338497e-9,0,.210537,.828427,345861e-9,0,.231305,.811871,347863e-9,0,.253057,.794397,350225e-9,0,.275797,.775726,349915e-9,0,.299525,.75617,347297e-9,0,.324242,.736091,344232e-9,0,.349947,.716213,340835e-9,0,.376633,.695736,332369e-9,0,.404289,.674961,327943e-9,0,.432895,.653518,318533e-9,0,.462415,.632574,310391e-9,0,.492788,.61134,300755e-9,0,.523909,.590017,290506e-9,0,.555556,.568752,280446e-9,0,.587302,.548061,269902e-9,0,.619048,.52711,258815e-9,0,.650794,.506682,248481e-9,0,.68254,.486524,237141e-9,0,.714286,.466812,226872e-9,0,.746032,.44732,216037e-9,0,.777778,.428473,205629e-9,0,.809524,.409921,195691e-9,0,.84127,.392028,185457e-9,0,.873016,.374606,176436e-9,0,.904762,.357601,166508e-9,0,.936508,.341348,158385e-9,0,.968254,.32542,149203e-9,0,1,1,103967e-10,0,0,1,10397e-9,0,0,1,104019e-10,0,0,.999999,104231e-10,0,0,.999998,104806e-10,0,0,.999995,106042e-10,0,0,.999991,108366e-10,0,0,.999982,112415e-10,0,0,.999968,119174e-10,0,0,.99995,130227e-10,0,0,.999922,148176e-10,0,0,.999884,177303e-10,0,0,.99983,224564e-10,0,0,.999758,300966e-10,0,0,.999654,423193e-10,0,549083e-11,.999503,614848e-10,0,296087e-9,.999237,903576e-10,0,.00123144,.998491,1271e-7,0,.00295954,.994594,107754e-9,0,.00555829,.99178,103025e-9,0,.00907209,.989265,11154e-8,0,.0135257,.986998,136296e-9,0,.0189327,.984137,169154e-9,0,.0252993,.979798,196671e-9,0,.0326272,.97337,196678e-9,0,.0409157,.967239,223121e-9,0,.0501623,.959543,253809e-9,0,.0603638,.949466,265972e-9,0,.0715171,.939074,288372e-9,0,.0836187,.931118,310983e-9,0,.0966657,.922525,325561e-9,0,.110656,.912983,345725e-9,0,.125588,.901617,3556e-7,0,.141461,.889487,374012e-9,0,.158275,.875787,383445e-9,0,.176031,.860654,393972e-9,0,.19473,.844417,400311e-9,0,.214374,.82741,405004e-9,0,.234967,.810545,407378e-9,0,.256512,.793312,407351e-9,0,.279011,.774847,406563e-9,0,.302468,.755621,404903e-9,0,.326887,.735511,397486e-9,0,.352266,.715435,39357e-8,0,.378605,.695403,384739e-9,0,.405897,.674681,376108e-9,0,.43413,.65359,365997e-9,0,.463277,.632471,354957e-9,0,.493295,.61151,343593e-9,0,.524106,.59064,331841e-9,0,.555561,.569386,318891e-9,0,.587302,.548785,3072e-7,0,.619048,.528146,29361e-8,0,.650794,.507872,281709e-9,0,.68254,.487805,268627e-9,0,.714286,.468196,255887e-9,0,.746032,.448922,243997e-9,0,.777778,.430093,231662e-9,0,.809524,.411845,220339e-9,0,.84127,.393808,208694e-9,0,.873016,.376615,198045e-9,0,.904762,.359655,187375e-9,0,.936508,.343452,177371e-9,0,.968254,.32765,167525e-9,0,1,1,169351e-10,0,0,1,169356e-10,0,0,1,169427e-10,0,0,.999999,169736e-10,0,0,.999998,170575e-10,0,0,.999995,172372e-10,0,0,.99999,175739e-10,0,0,.999979,181568e-10,0,0,.999966,191206e-10,0,0,.999944,20677e-9,0,0,.999912,231644e-10,0,0,.999869,271268e-10,0,0,.999811,334272e-10,0,0,.99973,433979e-10,0,0,.999617,590083e-10,0,680315e-10,.999445,829497e-10,0,612796e-9,.999138,118019e-9,0,.00187408,.998095,156712e-9,0,.00395791,.993919,125054e-9,0,.00692144,.991333,126091e-9,0,.0107962,.989226,144912e-9,0,.0155986,.986954,175737e-9,0,.0213364,.983982,213883e-9,0,.0280114,.979128,234526e-9,0,.0356226,.973327,243725e-9,0,.0441668,.967416,2773e-7,0,.0536399,.959729,308799e-9,0,.0640376,.949758,322447e-9,0,.0753554,.939173,350021e-9,0,.0875893,.9296,370089e-9,0,.100736,.921181,391365e-9,0,.114793,.91164,413636e-9,0,.129759,.900435,427068e-9,0,.145632,.888183,441046e-9,0,.162412,.874772,454968e-9,0,.180101,.859566,461882e-9,0,.1987,.843579,471556e-9,0,.218213,.826453,474335e-9,0,.238641,.809164,477078e-9,0,.259989,.792179,47755e-8,0,.282262,.773866,472573e-9,0,.305464,.754944,469765e-9,0,.329599,.735133,462371e-9,0,.35467,.714858,453674e-9,0,.380678,.694829,443888e-9,0,.407622,.674453,432052e-9,0,.435493,.653685,420315e-9,0,.464275,.632666,406829e-9,0,.493938,.611676,392234e-9,0,.524422,.591193,379208e-9,0,.555624,.570145,36319e-8,0,.587302,.549566,349111e-9,0,.619048,.529278,334166e-9,0,.650794,.509026,318456e-9,0,.68254,.489186,30449e-8,0,.714286,.469662,289051e-9,0,.746032,.450691,275494e-9,0,.777778,.431841,261437e-9,0,.809524,.413752,247846e-9,0,.84127,.395951,235085e-9,0,.873016,.378633,222245e-9,0,.904762,.36194,210533e-9,0,.936508,.345599,198494e-9,0,.968254,.329999,188133e-9,0,1,1,269663e-10,0,0,1,26967e-9,0,0,1,269772e-10,0,0,.999999,270214e-10,0,0,.999998,271415e-10,0,0,.999994,27398e-9,0,0,.999988,278771e-10,0,0,.999977,287019e-10,0,0,.999961,300544e-10,0,0,.999937,322138e-10,0,0,.999904,356163e-10,0,0,.999854,409465e-10,0,0,.99979,492651e-10,0,0,.999699,621722e-10,0,88288e-11,.999572,819715e-10,0,223369e-9,.999381,111689e-9,0,.00105414,.999016,153862e-9,0,.0026493,.997437,187667e-9,0,.00508608,.993545,155672e-9,0,.00840554,.991135,161455e-9,0,.012629,.989157,188241e-9,0,.0177661,.986874,226229e-9,0,.0238198,.983714,268668e-9,0,.0307887,.978301,277109e-9,0,.0386688,.973227,303446e-9,0,.0474554,.967317,341851e-9,0,.0571428,.959477,370885e-9,0,.0677256,.950012,392753e-9,0,.0791988,.939484,42781e-8,0,.0915576,.928135,443866e-9,0,.104798,.919819,472959e-9,0,.118918,.910049,491551e-9,0,.133915,.899181,512616e-9,0,.149788,.886881,523563e-9,0,.166537,.87359,540183e-9,0,.184164,.858613,547386e-9,0,.202669,.842809,554809e-9,0,.222056,.825727,558316e-9,0,.242329,.808086,557824e-9,0,.263492,.790728,556346e-9,0,.285551,.772987,552672e-9,0,.30851,.7541,543738e-9,0,.332376,.734669,536107e-9,0,.357153,.714411,523342e-9,0,.382845,.694196,512238e-9,0,.409454,.674252,497465e-9,0,.436977,.65357,481096e-9,0,.465404,.632999,467054e-9,0,.494713,.611994,448771e-9,0,.524864,.591604,431889e-9,0,.555779,.571134,415238e-9,0,.587302,.550528,396369e-9,0,.619048,.530292,379477e-9,0,.650794,.510364,361488e-9,0,.68254,.490749,343787e-9,0,.714286,.471266,327822e-9,0,.746032,.452462,310626e-9,0,.777778,.433907,295352e-9,0,.809524,.415659,279179e-9,0,.84127,.398138,264685e-9,0,.873016,.380833,249905e-9,0,.904762,.364247,236282e-9,0,.936508,.348041,222905e-9,0,.968254,.332389,210522e-9,0,1,1,420604e-10,0,0,1,420614e-10,0,0,1,420757e-10,0,0,.999999,42138e-9,0,0,.999997,423067e-10,0,0,.999993,426668e-10,0,0,.999986,433372e-10,0,0,.999974,444857e-10,0,0,.999956,463554e-10,0,0,.99993,493105e-10,0,0,.999892,539077e-10,0,0,.999838,610005e-10,0,0,.999767,718822e-10,0,0,.999666,884581e-10,0,365471e-10,.999525,113398e-9,0,485623e-9,.999311,150043e-9,0,.00162096,.998865,200063e-9,0,.00355319,.996278,211014e-9,0,.00633818,.992956,189672e-9,0,.0100043,.991017,210262e-9,0,.0145648,.989055,244292e-9,0,.0200237,.986741,290481e-9,0,.0263798,.983288,334303e-9,0,.033629,.977784,340307e-9,0,.0417652,.973037,377864e-9,0,.0507821,.967181,4239e-7,0,.060673,.958971,443854e-9,0,.0714314,.950093,483039e-9,0,.0830518,.939552,517934e-9,0,.0955288,.927678,539449e-9,0,.108859,.918278,568604e-9,0,.123038,.908449,588505e-9,0,.138065,.897713,612473e-9,0,.153938,.885533,625575e-9,0,.170657,.872131,63854e-8,0,.188224,.857517,647034e-9,0,.20664,.841796,65209e-8,0,.225909,.824726,6544e-7,0,.246035,.807297,655744e-9,0,.267022,.789058,646716e-9,0,.288878,.77189,643898e-9,0,.311607,.753082,629973e-9,0,.335216,.7341,621564e-9,0,.359713,.714094,605171e-9,0,.385103,.693839,588752e-9,0,.41139,.673891,573294e-9,0,.438576,.653565,552682e-9,0,.466656,.633326,533446e-9,0,.495617,.612582,514635e-9,0,.525431,.59205,49303e-8,0,.556041,.571918,471842e-9,0,.587338,.551572,451713e-9,0,.619048,.531553,430049e-9,0,.650794,.51175,410445e-9,0,.68254,.49238,390098e-9,0,.714286,.473143,370033e-9,0,.746032,.45423,351205e-9,0,.777778,.435963,332049e-9,0,.809524,.41787,315021e-9,0,.84127,.400387,297315e-9,0,.873016,.383332,281385e-9,0,.904762,.366665,265397e-9,0,.936508,.350633,250601e-9,0,.968254,.334964,23589e-8,0,1,1,643736e-10,0,0,1,64375e-9,0,0,1,643947e-10,0,0,.999999,64481e-9,0,0,.999997,647143e-10,0,0,.999994,652119e-10,0,0,.999985,661359e-10,0,0,.999972,677116e-10,0,0,.999952,702599e-10,0,0,.999922,742517e-10,0,0,.99988,803906e-10,0,0,.99982,897315e-10,0,0,.999741,103838e-9,0,0,.999629,12496e-8,0,149024e-9,.999474,156161e-9,0,861027e-9,.999229,201034e-9,0,.00231198,.998662,259069e-9,0,.00458147,.995299,245439e-9,0,.00770895,.992732,24498e-8,0,.0117126,.990847,273211e-9,0,.0165989,.988911,316492e-9,0,.0223674,.98654,37161e-8,0,.0290135,.982636,410352e-9,0,.0365309,.977346,421756e-9,0,.0449117,.972909,475578e-9,0,.0541481,.966821,522482e-9,0,.0642326,.958686,545008e-9,0,.075158,.949754,589286e-9,0,.0869181,.939184,619995e-9,0,.0995074,.927505,654266e-9,0,.112922,.916606,682362e-9,0,.127157,.906707,704286e-9,0,.142212,.895937,725909e-9,0,.158085,.883913,743939e-9,0,.174776,.870642,755157e-9,0,.192287,.856241,764387e-9,0,.210619,.84069,771032e-9,0,.229775,.823728,765906e-9,0,.249761,.806481,767604e-9,0,.270582,.787924,754385e-9,0,.292243,.770588,749668e-9,0,.314753,.751991,731613e-9,0,.338118,.733407,717655e-9,0,.362347,.713688,700604e-9,0,.387447,.693595,678765e-9,0,.413424,.673426,657042e-9,0,.440284,.65359,635892e-9,0,.468027,.633576,611569e-9,0,.496645,.613144,586011e-9,0,.526122,.592711,563111e-9,0,.556417,.572722,537699e-9,0,.587451,.552762,512556e-9,0,.619048,.532985,489757e-9,0,.650794,.513219,464139e-9,0,.68254,.493992,442193e-9,0,.714286,.47509,418629e-9,0,.746032,.456287,397045e-9,0,.777778,.438152,375504e-9,0,.809524,.420294,35492e-8,0,.84127,.402749,335327e-9,0,.873016,.385879,316422e-9,0,.904762,.369352,298333e-9,0,.936508,.353301,281417e-9,0,.968254,.337781,265203e-9,0,1,1,968267e-10,0,0,1,968284e-10,0,0,1,968556e-10,0,0,.999999,969733e-10,0,0,.999997,972913e-10,0,0,.999993,979688e-10,0,0,.999984,992239e-10,0,0,.999969,101356e-9,0,0,.999946,104784e-9,0,0,.999913,110111e-9,0,0,.999868,118217e-9,0,0,.999801,130396e-9,0,0,.999712,148523e-9,0,124907e-10,.999589,175233e-9,0,355405e-9,.999416,213999e-9,0,.0013528,.999136,268529e-9,0,.00312557,.998367,333088e-9,0,.00573045,.994701,304757e-9,0,.00919397,.992497,318031e-9,0,.0135261,.990608,353863e-9,0,.0187278,.988715,409044e-9,0,.0247947,.986241,472967e-9,0,.0317196,.981696,495104e-9,0,.039494,.977097,532873e-9,0,.0481087,.972583,594447e-9,0,.0575549,.966142,636867e-9,0,.0678242,.95823,669899e-9,0,.0789089,.949677,719499e-9,0,.0908023,.939226,750584e-9,0,.103499,.927501,793183e-9,0,.116993,.915199,81995e-8,0,.131282,.90498,847654e-9,0,.146364,.894243,868929e-9,0,.162237,.882154,884278e-9,0,.178902,.869161,898108e-9,0,.196358,.854751,901254e-9,0,.21461,.839368,90679e-8,0,.23366,.822874,901541e-9,0,.253512,.805514,897297e-9,0,.274174,.78716,881856e-9,0,.29565,.769061,870032e-9,0,.31795,.751,851719e-9,0,.341081,.732614,830671e-9,0,.365053,.713171,806569e-9,0,.389874,.693472,78338e-8,0,.415553,.673528,756404e-9,0,.442098,.653397,726872e-9,0,.469512,.633781,700494e-9,0,.497794,.613877,67105e-8,0,.526935,.593506,640361e-9,0,.556908,.573667,613502e-9,0,.587657,.553932,583177e-9,0,.61906,.534345,554375e-9,0,.650794,.515042,527811e-9,0,.68254,.495674,499367e-9,0,.714286,.477132,47429e-8,0,.746032,.458609,447726e-9,0,.777778,.440354,424205e-9,0,.809524,.422765,399549e-9,0,.84127,.405472,378315e-9,0,.873016,.388482,355327e-9,0,.904762,.372191,336122e-9,0,.936508,.356099,315247e-9,0,.968254,.340737,29794e-8,0,1,1,143327e-9,0,0,1,14333e-8,0,0,1,143366e-9,0,0,.999999,143524e-9,0,0,.999996,143952e-9,0,0,.999991,144862e-9,0,0,.999981,146544e-9,0,0,.999966,149391e-9,0,0,.999941,153946e-9,0,0,.999905,160971e-9,0,0,.999852,171562e-9,0,0,.99978,18729e-8,0,0,.999681,210386e-9,0,826239e-10,.999546,243906e-9,0,664807e-9,.999352,291739e-9,0,.00196192,.999027,357419e-9,0,.00405941,.997886,422349e-9,0,.00699664,.99419,385008e-9,0,.0107896,.99214,409775e-9,0,.0154415,.990274,456418e-9,0,.0209488,.988455,527008e-9,0,.0273037,.985804,597685e-9,0,.0344969,.98103,613124e-9,0,.0425183,.976674,668321e-9,0,.0513575,.972021,736985e-9,0,.0610046,.965274,773789e-9,0,.0714508,.958046,830852e-9,0,.0826877,.949333,875766e-9,0,.0947085,.939135,917088e-9,0,.107507,.927119,952244e-9,0,.121078,.91469,990626e-9,0,.135419,.903006,.00101304,0,.150526,.892368,.00103834,0,.166399,.880231,.00105002,0,.183038,.867432,.00106331,0,.200443,.853208,.00106783,0,.218618,.837956,.00106458,0,.237566,.821772,.00105945,0,.257291,.804328,.00104685,0,.2778,.786465,.00103178,0,.2991,.768004,.00101077,0,.321199,.74972,985504e-9,0,.344106,.731682,962893e-9,0,.36783,.712813,932146e-9,0,.392383,.693139,89871e-8,0,.417774,.673566,869678e-9,0,.444013,.653483,835525e-9,0,.471107,.633891,799853e-9,0,.49906,.614433,766838e-9,0,.527869,.594586,732227e-9,0,.557517,.574769,696442e-9,0,.587966,.555149,663935e-9,0,.61913,.535898,629826e-9,0,.650794,.516753,596486e-9,0,.68254,.497816,567078e-9,0,.714286,.479034,534399e-9,0,.746032,.460975,507013e-9,0,.777778,.442935,477421e-9,0,.809524,.425263,451101e-9,0,.84127,.408248,424964e-9,0,.873016,.391339,39993e-8,0,.904762,.37513,377619e-9,0,.936508,.359172,354418e-9,0,.968254,.343876,334823e-9,0,1,1,209042e-9,0,0,1,209045e-9,0,0,1,209093e-9,0,0,.999999,209304e-9,0,0,.999996,209871e-9,0,0,.999991,211078e-9,0,0,.999979,213304e-9,0,0,.999963,217061e-9,0,0,.999933,223042e-9,0,0,.999894,232206e-9,0,0,.999837,245901e-9,0,0,.999756,266023e-9,0,102927e-11,.999648,295204e-9,0,233468e-9,.999499,336958e-9,0,.00108237,.999283,395563e-9,0,.00268832,.998896,473785e-9,0,.00511138,.997006,520008e-9,0,.00837705,.993819,497261e-9,0,.0124928,.991632,523722e-9,0,.0174561,.989875,587258e-9,0,.0232596,.988109,676329e-9,0,.0298932,.985155,747701e-9,0,.0373453,.980479,768803e-9,0,.0456045,.976271,841054e-9,0,.0546593,.971347,911469e-9,0,.0644994,.964528,953057e-9,0,.0751152,.957632,.00102221,0,.0864981,.948681,.00106122,0,.0986407,.938716,.00111857,0,.111537,.926629,.00114762,0,.125182,.914025,.00118995,0,.139571,.901026,.00121228,0,.154703,.890358,.00123946,0,.170576,.878283,.0012527,0,.18719,.865459,.00125536,0,.204547,.851407,.00126134,0,.222648,.836276,.00124759,0,.241498,.820436,.00124443,0,.261101,.803253,.00122071,0,.281465,.785562,.00120107,0,.302595,.76718,.00117762,0,.324501,.748551,.00114289,0,.347192,.730564,.00110872,0,.370679,.712253,.00107636,0,.394973,.692867,.00103646,0,.420085,.673695,996793e-9,0,.446027,.653912,95675e-8,0,.47281,.634129,916739e-9,0,.500441,.615004,874401e-9,0,.528921,.595587,833411e-9,0,.558244,.575965,794556e-9,0,.588384,.5566,75196e-8,0,.619281,.537428,716381e-9,0,.650795,.518623,676558e-9,0,.68254,.499964,64074e-8,0,.714286,.481356,605984e-9,0,.746032,.463279,570256e-9,0,.777778,.445673,540138e-9,0,.809524,.428032,507299e-9,0,.84127,.411112,479553e-9,0,.873016,.394444,450737e-9,0,.904762,.378247,424269e-9,0,.936508,.362415,399111e-9,0,.968254,.347103,375274e-9,0,1,1,300729e-9,0,0,1,300733e-9,0,0,1,300797e-9,0,0,.999998,301072e-9,0,0,.999996,301817e-9,0,0,.999989,303398e-9,0,0,.999977,306309e-9,0,0,.999958,311209e-9,0,0,.999927,318975e-9,0,0,.999884,330804e-9,0,0,.99982,34834e-8,0,0,.999733,373854e-9,0,326995e-10,.999613,410424e-9,0,477174e-9,.999447,462047e-9,0,.00161099,.999204,533322e-9,0,.00353153,.998725,624964e-9,0,.00627965,.995871,631786e-9,0,.0098693,.993194,632017e-9,0,.0143011,.991541,68923e-8,0,.019568,.989773,766892e-9,0,.0256593,.987647,863668e-9,0,.0325625,.984193,922089e-9,0,.0402647,.980016,970749e-9,0,.0487532,.975859,.00106027,0,.058016,.970514,.00112239,0,.0680419,.963625,.00117212,0,.0788208,.956959,.00125211,0,.0903439,.947956,.00129411,0,.102604,.93809,.00135879,0,.115594,.92659,.00139309,0,.129309,.913829,.00143253,0,.143745,.90005,.00145809,0,.158901,.888129,.0014748,0,.174774,.87607,.00148756,0,.191365,.863461,.00148714,0,.208674,.849594,.00148892,0,.226705,.834531,.00146496,0,.245461,.81903,.0014579,0,.264947,.802122,.00143039,0,.28517,.78445,.00139717,0,.306137,.766434,.00136312,0,.327857,.747816,.00132597,0,.350341,.729519,.00128323,0,.373598,.711454,.00123803,0,.397642,.692699,.00119097,0,.422485,.673723,.00114565,0,.448139,.654386,.00109552,0,.474619,.634673,.00104553,0,.501933,.615554,99985e-8,0,.530089,.596462,948207e-9,0,.559087,.577385,902299e-9,0,.588913,.558257,856448e-9,0,.619525,.5392,810395e-9,0,.650826,.520543,768558e-9,0,.68254,.502206,7239e-7,0,.714286,.48402,685794e-9,0,.746032,.465779,64471e-8,0,.777778,.448455,609583e-9,0,.809524,.431091,57227e-8,0,.84127,.414147,54042e-8,0,.873016,.39765,506545e-9,0,.904762,.381576,477635e-9,0,.936508,.365881,448446e-9,0,.968254,.350582,421424e-9,0,1,1,427144e-9,0,0,1,427151e-9,0,0,1,427232e-9,0,0,.999998,42759e-8,0,0,.999995,428555e-9,0,0,.999988,430603e-9,0,0,.999976,434368e-9,0,0,.999952,440688e-9,0,0,.999919,450667e-9,0,0,.999871,46578e-8,0,0,.999801,488024e-9,0,0,.999704,520092e-9,0,129791e-9,.999572,565553e-9,0,821056e-9,.999389,628906e-9,0,.00225241,.999114,714911e-9,0,.00449109,.998488,819218e-9,0,.00756249,.995234,80415e-8,0,.0114716,.993021,830181e-9,0,.0162131,.991407,902645e-9,0,.021776,.989625,996934e-9,0,.0281471,.987064,.00109707,0,.0353118,.983265,.00114353,0,.0432562,.979535,.0012272,0,.0519665,.975224,.00132642,0,.0614298,.969574,.00138092,0,.0716348,.963021,.00145896,0,.0825709,.956046,.00152834,0,.094229,.947136,.00158217,0,.106602,.937313,.0016347,0,.119682,.926073,.00168383,0,.133465,.913121,.00171627,0,.147947,.899165,.00174229,0,.163125,.885891,.00176137,0,.178998,.873783,.00176406,0,.195566,.861331,.00176156,0,.21283,.847569,.00175346,0,.230793,.832785,.00172753,0,.249459,.817442,.00170204,0,.268832,.800613,.00166576,0,.28892,.783597,.00162909,0,.30973,.76571,.0015826,0,.331271,.747021,.00153106,0,.353554,.728593,.00148036,0,.37659,.710661,.00142808,0,.400391,.692426,.00136906,0,.424973,.673623,.00131066,0,.450347,.65494,.00125569,0,.476531,.635448,.00119517,0,.503535,.616221,.00113828,0,.531372,.597531,.0010816,0,.560047,.578795,.00102673,0,.589554,.559892,970985e-9,0,.619869,.541307,919773e-9,0,.650923,.522608,868479e-9,0,.68254,.504484,82137e-8,0,.714286,.486603,772916e-9,0,.746032,.468802,730353e-9,0,.777778,.451172,684955e-9,0,.809524,.434348,647565e-9,0,.84127,.417445,605863e-9,0,.873016,.401077,571885e-9,0,.904762,.385039,536034e-9,0,.936508,.369483,504227e-9,0,.968254,.354272,473165e-9,0,1,1,599525e-9,0,0,1,599533e-9,0,0,1,599639e-9,0,0,.999998,600097e-9,0,0,.999994,601336e-9,0,0,.999987,603958e-9,0,0,.999972,608775e-9,0,0,.999949,616842e-9,0,0,.999912,629534e-9,0,0,.999857,648658e-9,0,0,.999781,676615e-9,0,538873e-11,.999674,716574e-9,0,308602e-9,.999528,772641e-9,0,.00127003,.999326,849806e-9,0,.00300783,.999009,952682e-9,0,.00556637,.998112,.00106394,0,.00895889,.994496,.00102228,0,.0131827,.992806,.00108586,0,.0182277,.991211,.0011759,0,.0240795,.989415,.00128955,0,.030723,.986499,.00139038,0,.0381418,.982679,.00144539,0,.046321,.978839,.00153954,0,.0552459,.974295,.00164417,0,.0649034,.968784,.00171517,0,.0752814,.962324,.00180282,0,.0863693,.954956,.00186387,0,.0981578,.94624,.00193817,0,.110639,.936517,.00198156,0,.123806,.925186,.00203042,0,.137655,.91252,.0020664,0,.15218,.898441,.00207822,0,.16738,.884394,.0020992,0,.183253,.871273,.00208748,0,.199799,.859057,.00208686,0,.21702,.845243,.00205519,0,.234918,.830723,.00202868,0,.253496,.815801,.00199501,0,.272761,.79914,.00194193,0,.292719,.782372,.00188824,0,.313377,.76482,.00183695,0,.334745,.746586,.00177418,0,.356833,.7281,.00170628,0,.379654,.709842,.00164063,0,.403221,.692019,.00157355,0,.427548,.67364,.00150262,0,.452651,.655277,.00143473,0,.478545,.636438,.00136371,0,.505246,.617364,.00129911,0,.532768,.598603,.00123014,0,.561122,.580195,.00116587,0,.590309,.561786,.00110398,0,.620318,.543377,.00104148,0,.651102,.525093,983984e-9,0,.682545,.506791,92667e-8,0,.714286,.489291,874326e-9,0,.746032,.471811,821734e-9,0,.777778,.454435,774698e-9,0,.809524,.437493,727302e-9,0,.84127,.420977,684039e-9,0,.873016,.404729,64373e-8,0,.904762,.388756,60285e-8,0,.936508,.373344,56765e-8,0,.968254,.358191,531929e-9,0,1,1,832169e-9,0,0,1,832178e-9,0,0,1,83231e-8,0,0,.999998,832893e-9,0,0,.999995,834465e-9,0,0,.999985,837791e-9,0,0,.999969,843893e-9,0,0,.999944,854086e-9,0,0,.999903,870071e-9,0,0,.999843,894042e-9,0,0,.999759,928865e-9,0,531805e-10,.999643,978242e-9,0,579365e-9,.99948,.00104684,0,.00182774,.999255,.00114012,0,.00387804,.998885,.00126188,0,.00675709,.997405,.00135888,0,.010468,.99424,.00133626,0,.0150018,.992458,.00140905,0,.0203443,.990929,.00152305,0,.0264786,.989116,.00165882,0,.0333875,.985624,.00174128,0,.0410536,.982003,.00182108,0,.0494609,.978336,.00194498,0,.0585941,.973184,.00202708,0,.0684396,.9678,.00212166,0,.0789851,.961348,.00221366,0,.0902199,.953841,.00228219,0,.102134,.94534,.00235662,0,.114721,.935552,.00240572,0,.127972,.924064,.00244405,0,.141884,.911827,.00247557,0,.156451,.897731,.00248374,0,.171672,.883409,.00249863,0,.187545,.868625,.00246688,0,.20407,.856529,.00246523,0,.221249,.842999,.00242368,0,.239083,.828505,.00237354,0,.257578,.813825,.00232588,0,.276738,.797813,.00226731,0,.296569,.781097,.00219704,0,.31708,.764038,.00212394,0,.338281,.746067,.00204786,0,.360181,.727687,.00196728,0,.382794,.709571,.00188779,0,.406133,.691503,.00180532,0,.430213,.673673,.00171849,0,.45505,.655732,.00164147,0,.480662,.637399,.00155858,0,.507065,.618616,.00147641,0,.534278,.60005,.00140125,0,.562313,.581713,.00132441,0,.59118,.563546,.00125014,0,.620875,.545605,.00118249,0,.651373,.527559,.0011116,0,.682593,.509764,.00104979,0,.714286,.49193,985977e-9,0,.746032,.475011,928592e-9,0,.777778,.457878,873466e-9,0,.809524,.440979,819585e-9,0,.84127,.424613,772365e-9,0,.873016,.408549,722195e-9,0,.904762,.392771,680014e-9,0,.936508,.377317,636797e-9,0,.968254,.362352,598318e-9,0,1,1,.00114313,0,0,1,.00114314,0,0,.999999,.00114331,0,0,.999998,.00114404,0,0,.999994,.00114601,0,0,.999984,.00115019,0,0,.999967,.00115784,0,0,.999937,.0011706,0,0,.999894,.00119054,0,0,.999828,.00122031,0,0,.999735,.00126331,0,169263e-9,.999606,.00132382,0,949167e-9,.999426,.0014071,0,.00249668,.999173,.00151895,0,.00486392,.99873,.00166102,0,.00806323,.996243,.0017023,0,.0120895,.993779,.00172782,0,.0169288,.9919,.0018108,0,.0225633,.990524,.00196028,0,.028974,.98868,.00212014,0,.036142,.984663,.00217598,0,.044049,.981457,.00230563,0,.0526781,.977608,.00243966,0,.0620137,.972215,.00251336,0,.0720418,.966798,.0026285,0,.0827499,.960241,.00271409,0,.0941271,.952489,.00278381,0,.106164,.944127,.00285399,0,.118852,.934282,.00290994,0,.132185,.923271,.00294558,0,.146157,.910803,.00296269,0,.160766,.896705,.00296803,0,.176007,.88238,.00296637,0,.19188,.867116,.00293163,0,.208385,.853636,.00289418,0,.225523,.840469,.00284663,0,.243296,.82639,.00278594,0,.261709,.811759,.00271618,0,.280767,.796113,.00263187,0,.300476,.779518,.00254589,0,.320845,.763142,.00246003,0,.341883,.745464,.00236529,0,.363601,.727491,.00226536,0,.386011,.709414,.00216375,0,.409128,.691396,.00207127,0,.432967,.67368,.00197106,0,.457545,.656049,.00187022,0,.482881,.638188,.00177605,0,.508992,.620177,.00168482,0,.535899,.601506,.00158909,0,.563619,.58362,.00150583,0,.592165,.565496,.00141791,0,.621544,.54789,.00133693,0,.651743,.530323,.00126038,0,.682709,.512795,.00118556,0,.714286,.495199,.00111527,0,.746032,.478101,.0010489,0,.777778,.461511,984264e-9,0,.809524,.444879,92591e-8,0,.84127,.428424,866582e-9,0,.873016,.412495,814463e-9,0,.904762,.396975,764498e-9,0,.936508,.381614,715967e-9,0,.968254,.366732,672483e-9,0,1,1,.00155501,0,0,1,.00155503,0,0,1,.00155524,0,0,.999998,.00155615,0,0,.999994,.0015586,0,0,.999983,.00156379,0,0,.999963,.0015733,0,0,.999932,.00158911,0,0,.999882,.00161376,0,0,.99981,.00165041,0,100875e-10,.999708,.00170304,0,367658e-9,.999565,.00177658,0,.0014234,.999368,.00187688,0,.00327939,.999081,.00200989,0,.00596629,.99852,.00217177,0,.0094852,.99549,.0021745,0,.013824,.993252,.00222357,0,.0189642,.991727,.00235022,0,.0248856,.989951,.00250561,0,.0315669,.988029,.00268829,0,.0389882,.984029,.0027496,0,.0471302,.980683,.00289793,0,.0559754,.976554,.00303315,0,.0655081,.97139,.00313257,0,.0757138,.965544,.00323656,0,.08658,.95912,.00333432,0,.0980954,.951183,.0034039,0,.110251,.942974,.00347515,0,.123038,.932642,.00350381,0,.13645,.922158,.00354519,0,.150482,.909404,.00353851,0,.165129,.896071,.0035435,0,.18039,.881206,.00349936,0,.196263,.866077,.00347256,0,.212748,.85093,.003415,0,.229847,.837703,.00333367,0,.247561,.823878,.003249,0,.265895,.809449,.00316347,0,.284854,.794379,.00306351,0,.304445,.778138,.0029499,0,.324675,.761997,.00284099,0,.345555,.744938,.00272104,0,.367095,.727212,.00260715,0,.389309,.709549,.00248855,0,.41221,.691704,.00236783,0,.435814,.673689,.00225178,0,.460138,.656453,.00213765,0,.485203,.639128,.00202178,0,.511028,.621512,.00191443,0,.537634,.603598,.00180977,0,.565041,.58559,.00170456,0,.593268,.567852,.00160927,0,.622327,.5503,.00151395,0,.652217,.533033,.00142499,0,.682907,.515942,.00133955,0,.714296,.498814,.0012602,0,.746032,.481595,.00118188,0,.777778,.465117,.00111171,0,.809524,.448865,.00104091,0,.84127,.432711,976618e-9,0,.873016,.416822,91859e-8,0,.904762,.401272,857704e-9,0,.936508,.386226,807172e-9,0,.968254,.371321,75464e-8,0,1,1,.00209596,0,0,1,.00209598,0,0,1,.00209624,0,0,.999997,.00209736,0,0,.999991,.00210039,0,0,.999979,.00210678,0,0,.999959,.00211847,0,0,.999925,.0021379,0,0,.99987,.00216809,0,0,.999791,.00221281,0,681487e-10,.999677,.00227669,0,658161e-9,.999521,.00236533,0,.00200635,.999301,.00248514,0,.0041779,.998977,.00264185,0,.00718648,.998191,.00281695,0,.0110239,.994801,.00278518,0,.015672,.993091,.00288774,0,.0211091,.991571,.00303931,0,.0273123,.9897,.00321643,0,.034259,.987023,.00337332,0,.0419282,.983289,.00346146,0,.0502998,.979892,.00363704,0,.0593562,.975111,.00373601,0,.069081,.970351,.0038842,0,.0794598,.964131,.00397053,0,.0904798,.957747,.00408078,0,.10213,.949536,.00413533,0,.1144,.941372,.00420305,0,.127284,.931049,.00422815,0,.140772,.920647,.00425048,0,.154862,.908033,.0042281,0,.169548,.895028,.00422026,0,.184828,.879968,.00415042,0,.200701,.864875,.00408821,0,.217167,.84918,.00400909,0,.234227,.834934,.00391178,0,.251884,.821397,.00380066,0,.270141,.807135,.00367974,0,.289004,.792363,.00355172,0,.308479,.776661,.003411,0,.328575,.760705,.00328123,0,.349301,.744408,.00314003,0,.370668,.726994,.0029906,0,.392689,.709598,.00285034,0,.415379,.692112,.00271179,0,.438754,.674435,.00257185,0,.46283,.65676,.00243425,0,.48763,.639982,.00230351,0,.513173,.622983,.0021777,0,.539482,.605471,.00204991,0,.566579,.58796,.00193759,0,.594488,.570463,.00181976,0,.623226,.553058,.00171497,0,.6528,.535894,.00161109,0,.683198,.519089,.00151394,0,.714354,.502454,.00142122,0,.746032,.485681,.00133488,0,.777778,.468935,.00124975,0,.809524,.452951,.00117309,0,.84127,.437139,.00110155,0,.873016,.421446,.00103124,0,.904762,.405951,966387e-9,0,.936508,.391003,908119e-9,0,.968254,.376198,848057e-9,0,1,1,.00280076,0,0,1,.00280078,0,0,.999999,.00280109,0,0,.999997,.00280246,0,0,.999992,.00280616,0,0,.999979,.00281396,0,0,.999956,.00282822,0,0,.999916,.00285186,0,0,.999857,.0028885,0,0,.999768,.00294259,0,196026e-9,.999645,.00301946,0,.00104842,.99947,.00312541,0,.00270199,.999229,.00326733,0,.00519449,.998852,.00344992,0,.00852602,.997558,.00361052,0,.0126804,.994417,.0035898,0,.017635,.992824,.00372393,0,.023365,.991344,.00390695,0,.0298456,.989337,.00410392,0,.0370529,.985811,.00420987,0,.0449651,.982772,.00437488,0,.0535615,.979001,.00455069,0,.0628243,.974102,.00464462,0,.0727368,.969197,.00480577,0,.0832844,.962759,.00487818,0,.0944545,.956207,.00498176,0,.106236,.947909,.00503392,0,.118619,.939596,.00507474,0,.131595,.929642,.00509798,0,.145159,.918807,.00508476,0,.159305,.906921,.00505634,0,.174028,.893312,.00498845,0,.189327,.878933,.0049133,0,.2052,.863986,.0048259,0,.221647,.847936,.00470848,0,.23867,.832253,.00456889,0,.25627,.818619,.00442726,0,.274453,.804788,.00427677,0,.293222,.790241,.00411906,0,.312585,.775162,.00394833,0,.33255,.759463,.00377366,0,.353126,.743598,.00361026,0,.374324,.72697,.00343627,0,.396158,.709646,.00326422,0,.418641,.69277,.00309717,0,.44179,.675371,.0029356,0,.465624,.657863,.00277712,0,.490163,.640772,.00261738,0,.515429,.624441,.0024737,0,.541445,.607497,.00233125,0,.568236,.590438,.00218994,0,.595828,.573224,.0020664,0,.624242,.556168,.00193526,0,.653496,.539232,.00182463,0,.683588,.522352,.00170735,0,.714482,.506172,.00160555,0,.746032,.489842,.00150451,0,.777778,.473463,.00140938,0,.809524,.457266,.00132568,0,.84127,.441609,.0012376,0,.873016,.426348,.00116265,0,.904762,.411002,.00108935,0,.936508,.396045,.00101946,0,.968254,.381448,955665e-9,0,1,1,.0037121,0,0,1,.00371213,0,0,1,.00371251,0,0,.999997,.00371417,0,0,.99999,.00371863,0,0,.999977,.00372807,0,0,.99995,.00374529,0,0,.999908,.0037738,0,0,.999843,.00381789,0,123596e-10,.999745,.00388273,0,407442e-9,.999608,.00397443,0,.0015447,.999415,.00409998,0,.00351385,.999143,.00426662,0,.0063316,.9987,.00447625,0,.00998679,.996363,.00455323,0,.0144569,.994021,.00461052,0,.0197151,.992372,.00476359,0,.0257344,.991007,.00499101,0,.0324882,.988767,.0051972,0,.0399517,.984872,.00528407,0,.0481022,.982004,.00548926,0,.0569191,.977714,.00564385,0,.0663839,.973076,.0057693,0,.0764801,.967565,.0058924,0,.0871928,.961384,.00599629,0,.0985095,.954435,.00605998,0,.110419,.946303,.0061133,0,.122912,.937662,.00612028,0,.13598,.927867,.00612209,0,.149617,.916475,.00604813,0,.163817,.90541,.00603088,0,.178577,.891591,.00592218,0,.193894,.877573,.00578854,0,.209767,.862511,.00566648,0,.226196,.846861,.00551481,0,.243182,.83068,.00533754,0,.260728,.815725,.00515487,0,.278837,.802321,.0049655,0,.297515,.787826,.00475421,0,.316768,.773454,.00456002,0,.336605,.758224,.00434727,0,.357034,.74265,.00414444,0,.378067,.726729,.00393738,0,.399717,.710155,.00373575,0,.421998,.693312,.00353736,0,.444928,.67653,.00334368,0,.468523,.659444,.00315981,0,.492806,.642051,.00297809,0,.517798,.625758,.00280592,0,.543525,.609615,.00264254,0,.570012,.592919,.00248459,0,.597288,.576298,.00233327,0,.625379,.559489,.00219519,0,.654307,.542891,.00205441,0,.684084,.526255,.00193385,0,.714693,.509853,.00180745,0,.746044,.494131,.00169817,0,.777778,.478114,.0015913,0,.809524,.462274,.00148981,0,.84127,.446412,.00139537,0,.873016,.431274,.00130984,0,.904762,.41635,.00122403,0,.936508,.401476,.00114809,0,.968254,.386993,.00107563,0,1,1,.00488216,0,0,1,.0048822,0,0,1,.00488265,0,0,.999997,.00488463,0,0,.999988,.00488999,0,0,.999974,.00490129,0,0,.999946,.00492191,0,0,.999897,.00495598,0,0,.999825,.00500855,0,744791e-10,.999718,.00508559,0,712744e-9,.999565,.005194,0,.00215249,.999352,.00534147,0,.00444576,.999046,.00553523,0,.00759218,.998492,.00577016,0,.0115714,.995564,.00578487,0,.0163557,.993339,.00586414,0,.021915,.991834,.00606002,0,.0282201,.990496,.00633312,0,.0352433,.987826,.00651941,0,.042959,.98383,.00660842,0,.0513439,.98109,.00685523,0,.0603772,.976131,.00695778,0,.0700402,.971922,.00714236,0,.0803163,.965901,.00721437,0,.0911908,.959606,.00732017,0,.102651,.952504,.00735788,0,.114686,.944365,.00738493,0,.127286,.935652,.00737969,0,.140443,.925813,.00733612,0,.154151,.914397,.00723094,0,.168405,.903257,.00714002,0,.183201,.890015,.00700149,0,.198536,.876014,.00682813,0,.214409,.861436,.00665567,0,.23082,.845752,.00644526,0,.24777,.829169,.00621635,0,.265263,.813435,.00597789,0,.283301,.799701,.00575694,0,.301889,.785726,.00549866,0,.321035,.77152,.0052503,0,.340746,.75683,.00499619,0,.361032,.741951,.0047543,0,.381904,.726367,.0045084,0,.403374,.710537,.00426784,0,.425457,.693965,.00403487,0,.448169,.677724,.0038075,0,.47153,.66117,.00359431,0,.495561,.644274,.00338354,0,.520284,.627449,.00318163,0,.545725,.611645,.00299672,0,.571911,.595614,.00281016,0,.598873,.579426,.00264252,0,.62664,.563016,.00247509,0,.655239,.546728,.00232647,0,.684692,.530539,.00217803,0,.714999,.514164,.00204216,0,.746106,.498344,.00191403,0,.777778,.482957,.00179203,0,.809524,.467336,.00167695,0,.84127,.451994,.00157567,0,.873016,.436514,.00147113,0,.904762,.42178,.00138034,0,.936508,.407271,.00129219,0,.968254,.392822,.0012098,0,1,1,.00637427,0,0,1,.00637431,0,0,.999999,.00637485,0,0,.999996,.00637721,0,0,.999987,.00638357,0,0,.999971,.006397,0,0,.999939,.00642142,0,0,.999888,.00646177,0,0,.999807,.00652387,0,207916e-9,.999689,.00661454,0,.00112051,.99952,.00674155,0,.00287719,.999283,.00691313,0,.00550145,.998936,.00713598,0,.00897928,.998165,.00738501,0,.0132829,.994847,.00734388,0,.01838,.993182,.00749991,0,.0242381,.991665,.0077246,0,.030826,.989708,.00797579,0,.0381152,.986663,.00813011,0,.0460794,.983288,.00830365,0,.0546951,.980104,.00853496,0,.0639411,.974855,.00861045,0,.0737988,.97045,.00879133,0,.0842516,.964509,.00886377,0,.0952848,.957594,.00890346,0,.106886,.950546,.00893289,0,.119044,.942225,.00890074,0,.131749,.933365,.00886826,0,.144994,.923202,.0087316,0,.158772,.912605,.00863082,0,.173078,.901099,.00847403,0,.187908,.888177,.00825838,0,.203261,.873955,.00801834,0,.219134,.860091,.00779026,0,.235527,.84434,.00752478,0,.252443,.828517,.00724074,0,.269883,.81239,.00693769,0,.287851,.79721,.00664817,0,.306352,.783489,.00634763,0,.325393,.769514,.00604221,0,.344981,.755419,.00573568,0,.365126,.741083,.00544359,0,.385839,.726059,.00515515,0,.407132,.710809,.00487139,0,.42902,.695052,.00459846,0,.45152,.678886,.00433412,0,.474651,.663042,.00407981,0,.498433,.646634,.00384264,0,.52289,.630117,.00360897,0,.548048,.613804,.00338863,0,.573936,.598338,.00318486,0,.600584,.582687,.00298377,0,.628027,.566809,.00280082,0,.656295,.550817,.00262255,0,.685417,.534937,.00245835,0,.715406,.519151,.00230574,0,.74624,.503118,.0021549,0,.777778,.487723,.00202008,0,.809524,.472725,.00189355,0,.84127,.457599,.00177108,0,.873016,.442558,.00165843,0,.904762,.427624,.00155494,0,.936508,.413171,.00145273,0,.968254,.399122,.00136454,0,1,1,.00826496,0,0,1,.00826499,0,0,1,.00826564,0,0,.999996,.00826842,0,0,.999987,.00827589,0,0,.999967,.00829167,0,0,.999933,.00832037,0,0,.999876,.00836768,0,109338e-10,.999786,.00844031,0,427145e-9,.999655,.00854603,0,.0016384,.999468,.00869337,0,.00372392,.999203,.008891,0,.00668513,.998803,.00914387,0,.0104968,.99748,.00935838,0,.015125,.994446,.00933309,0,.0205338,.99292,.00953084,0,.0266884,.991414,.0097893,0,.0335565,.989049,.0100228,0,.0411086,.98582,.0101664,0,.0493181,.982441,.0103582,0,.0581613,.978595,.0105292,0,.0676169,.973495,.0106274,0,.0776661,.968405,.0107261,0,.0882926,.962717,.0108234,0,.0994817,.955478,.0108102,0,.111221,.948275,.0107914,0,.123499,.940006,.0107161,0,.136308,.930831,.0106309,0,.149639,.920648,.0104083,0,.163485,.910205,.0102312,0,.177843,.898445,.0100051,0,.192707,.885986,.00971928,0,.208077,.872204,.00940747,0,.22395,.858436,.0091085,0,.240326,.843454,.00876595,0,.257208,.827437,.00839794,0,.274596,.811488,.00803692,0,.292496,.796039,.00767352,0,.310911,.781083,.0073097,0,.329849,.767642,.00694032,0,.349316,.753901,.00657476,0,.369323,.740131,.00622699,0,.38988,.725845,.0058838,0,.410999,.710991,.00555586,0,.432696,.696002,.00523089,0,.454987,.680461,.00492494,0,.47789,.664875,.00463464,0,.501426,.649273,.00435422,0,.52562,.63302,.0040875,0,.550498,.61705,.00384075,0,.576089,.601154,.00359557,0,.602427,.586008,.00337636,0,.629544,.570699,.00316019,0,.657479,.555166,.00296033,0,.686264,.539645,.00277552,0,.715924,.524159,.00259499,0,.746459,.508682,.00243257,0,.777789,.493163,.00227851,0,.809524,.478004,.00213083,0,.84127,.46347,.00199502,0,.873016,.448778,.00186967,0,.904762,.434105,.00174732,0,.936508,.419576,.00163861,0,.968254,.405541,.00153341,0,1,1,.0106462,0,0,1,.0106462,0,0,.999999,.010647,0,0,.999995,.0106502,0,0,.999985,.0106589,0,0,.999964,.0106773,0,0,.999925,.0107106,0,0,.999861,.0107655,0,712986e-10,.999763,.0108497,0,743959e-9,.999616,.0109716,0,.00227361,.999408,.0111408,0,.0046983,.999112,.0113659,0,.00800158,.998637,.0116475,0,.0121493,.996223,.0117231,0,.0171023,.994006,.0118064,0,.0228218,.992444,.0120254,0,.0292711,.991028,.0123314,0,.036417,.98803,.0124954,0,.0442295,.984816,.0126538,0,.0526815,.981399,.0128537,0,.0617492,.977085,.0129694,0,.0714114,.972154,.013091,0,.0816495,.966617,.0131166,0,.0924472,.960628,.0131583,0,.10379,.953295,.0131094,0,.115665,.94575,.0129966,0,.128062,.937654,.0128796,0,.140972,.927716,.0126477,0,.154387,.917932,.0123889,0,.168301,.907719,.012131,0,.182709,.89584,.0118013,0,.197608,.883526,.0114145,0,.212994,.870301,.0110075,0,.228867,.856272,.0106019,0,.245227,.842251,.0101938,0,.262074,.826466,.00973254,0,.279412,.810859,.0092846,0,.297244,.795051,.00883304,0,.315575,.780053,.00840272,0,.334412,.76575,.00796438,0,.35376,.752298,.00752526,0,.373631,.739153,.00711486,0,.394034,.725514,.00670361,0,.414983,.711473,.00632656,0,.436491,.696936,.00595206,0,.458575,.682126,.00559191,0,.481253,.667027,.00525362,0,.504547,.651875,.00493805,0,.528481,.636463,.00462848,0,.553081,.620641,.00433936,0,.578377,.604931,.00407,0,.604404,.589549,.00380864,0,.631197,.574712,.00357049,0,.658795,.559775,.00334466,0,.687238,.544514,.00312505,0,.716559,.529555,.00293199,0,.746776,.514402,.00274204,0,.777849,.499302,.00256647,0,.809524,.484114,.00239901,0,.84127,.469308,.00225148,0,.873016,.455133,.00210178,0,.904762,.440939,.0019727,0,.936508,.426627,.00184382,0,.968254,.412509,.00172548,0,1,1,.013628,0,0,1,.0136281,0,0,.999999,.0136289,0,0,.999995,.0136327,0,0,.999983,.0136427,0,0,.99996,.0136638,0,0,.999917,.0137022,0,0,.999846,.0137652,0,204597e-9,.999736,.0138615,0,.00116837,.999573,.0140007,0,.00303325,.99934,.0141927,0,.00580613,.999004,.0144457,0,.00945626,.998407,.0147489,0,.0139421,.995464,.014731,0,.0192202,.993328,.0148283,0,.0252495,.991799,.0150797,0,.0319921,.990397,.0154316,0,.0394138,.986835,.0155005,0,.0474843,.983938,.0157308,0,.0561763,.980154,.0158753,0,.0654661,.975659,.0159581,0,.0753326,.970171,.0159832,0,.0857571,.964803,.0160084,0,.0967236,.958366,.0159484,0,.108218,.950613,.0158001,0,.120227,.942874,.0155845,0,.132741,.935005,.0154292,0,.145751,.924991,.0150742,0,.159249,.914814,.0146757,0,.17323,.904743,.0143097,0,.187687,.893216,.0138695,0,.202619,.880769,.0133706,0,.218021,.868136,.0128606,0,.233894,.85469,.0123403,0,.250238,.840593,.0118091,0,.267052,.825808,.011253,0,.284341,.81009,.0107099,0,.302106,.79504,.0101636,0,.320354,.779757,.00964041,0,.33909,.764697,.00911896,0,.358322,.750913,.00859533,0,.378059,.738175,.00811592,0,.398311,.725242,.00764504,0,.41909,.711864,.00718885,0,.440412,.698009,.00675843,0,.462292,.683841,.00634984,0,.484748,.669391,.00595502,0,.507802,.654731,.00558671,0,.531477,.639805,.00523578,0,.555802,.624789,.00490834,0,.580805,.609325,.00459448,0,.606522,.593975,.00430342,0,.63299,.578983,.00403019,0,.66025,.564442,.0037707,0,.688346,.549835,.0035316,0,.717319,.535039,.00330255,0,.7472,.520403,.00308932,0,.777982,.505687,.00289335,0,.809524,.490939,.00270818,0,.84127,.476233,.0025343,0,.873016,.461624,.00237097,0,.904762,.447833,.00222065,0,.936508,.433992,.00207561,0,.968254,.420147,.00194955,0,1,1,.0173415,0,0,1,.0173416,0,0,.999999,.0173426,0,0,.999995,.0173468,0,0,.999983,.0173582,0,0,.999954,.0173822,0,0,.999908,.0174258,0,669501e-11,.999828,.0174973,0,427399e-9,.999705,.0176063,0,.00171019,.999524,.0177631,0,.0039248,.999263,.0179781,0,.00705382,.998878,.018258,0,.0110552,.998012,.0185551,0,.0158812,.994614,.0184264,0,.0214852,.993132,.0186385,0,.0278239,.991563,.0189067,0,.0348585,.989298,.0191577,0,.0425544,.986036,.0192522,0,.050881,.982558,.0194063,0,.059811,.978531,.019486,0,.0693209,.974198,.0195847,0,.0793895,.968148,.0194749,0,.0899984,.962565,.0194277,0,.101132,.956041,.0192991,0,.112775,.947749,.0189893,0,.124917,.94018,.018704,0,.137547,.93165,.0183458,0,.150655,.921798,.0178775,0,.164236,.911573,.0173618,0,.178281,.901569,.0168482,0,.192788,.890341,.016265,0,.207752,.877835,.0156199,0,.223171,.865472,.0149516,0,.239044,.852905,.0143274,0,.255371,.838906,.0136643,0,.272153,.824888,.0129903,0,.289393,.809977,.0123218,0,.307093,.794697,.0116572,0,.325259,.780028,.0110307,0,.343896,.765124,.0104236,0,.363012,.750411,.0098219,0,.382617,.737264,.00924397,0,.402719,.724799,.00868719,0,.423332,.712253,.00816476,0,.444469,.699267,.00767262,0,.466146,.685618,.00719746,0,.488383,.671736,.00673916,0,.511199,.657777,.00631937,0,.534618,.643497,.00592411,0,.558668,.62889,.00553928,0,.58338,.614299,.0051934,0,.608787,.599197,.00485985,0,.634929,.584175,.00454357,0,.661849,.569541,.00425787,0,.689594,.555193,.00397905,0,.718211,.540947,.00372364,0,.747742,.526593,.00348599,0,.778205,.512335,.00326103,0,.80953,.498017,.00305137,0,.84127,.483609,.00285485,0,.873016,.469368,.00267472,0,.904762,.455037,.00249945,0,.936508,.441493,.00234792,0,.968254,.428147,.00219936,0,1,1,.0219422,0,0,1,.0219423,0,0,.999998,.0219434,0,0,.999993,.0219481,0,0,.999981,.021961,0,0,.999949,.0219879,0,0,.999896,.0220367,0,593194e-10,.999808,.0221167,0,75364e-8,.99967,.0222383,0,.00237884,.999466,.0224125,0,.00495612,.999174,.0226495,0,.00844887,.998725,.0229525,0,.0128058,.996979,.0231123,0,.0179742,.994317,.0230742,0,.0239047,.992781,.0232895,0,.0305526,.991191,.0235734,0,.0378786,.987787,.0236152,0,.0458475,.985092,.0237994,0,.0544287,.981121,.0238553,0,.0635952,.976924,.0238706,0,.0733233,.97218,.0238704,0,.0835922,.965956,.0236598,0,.0943839,.959998,.0234735,0,.105682,.953245,.0232277,0,.117474,.944445,.0226973,0,.129747,.937087,.0223527,0,.142491,.928341,.0218144,0,.155697,.9184,.0211516,0,.169358,.907959,.0204553,0,.183469,.89808,.0197673,0,.198024,.887047,.0189915,0,.21302,.875221,.0182082,0,.228455,.86269,.0173584,0,.244329,.850735,.0165718,0,.260639,.837545,.0157524,0,.277389,.823639,.0149482,0,.29458,.809699,.0141431,0,.312216,.794797,.0133527,0,.3303,.780578,.0126193,0,.34884,.766019,.0118914,0,.367842,.751447,.0111839,0,.387315,.737275,.010514,0,.40727,.724545,.00987277,0,.427717,.712644,.00926569,0,.448671,.700432,.00869029,0,.470149,.687664,.00814691,0,.492167,.674288,.00763012,0,.514746,.660966,.00714437,0,.537911,.647264,.00668457,0,.561688,.633431,.00626581,0,.586108,.619133,.00585593,0,.611206,.604935,.00548188,0,.637022,.590236,.00513288,0,.663599,.575473,.0047906,0,.690989,.561228,.00448895,0,.719242,.547054,.00420233,0,.748411,.533175,.00392869,0,.778531,.519163,.00367445,0,.809583,.505328,.00344097,0,.84127,.491446,.00322003,0,.873016,.477356,.00301283,0,.904762,.46356,.00282592,0,.936508,.449623,.00264956,0,.968254,.436068,.00246956,0,1,1,.0276135,0,0,1,.0276136,0,0,.999998,.0276148,0,0,.999993,.0276201,0,0,.999976,.0276342,0,0,.999945,.027664,0,0,.999884,.0277179,0,18679e-8,.999784,.027806,0,.00119607,.99963,.0279394,0,.00318407,.999401,.0281295,0,.00613601,.999066,.0283858,0,.00999963,.998524,.0287027,0,.0147164,.995702,.0286256,0,.0202295,.993593,.0286733,0,.0264876,.992067,.0288989,0,.0334452,.990548,.0292135,0,.0410621,.986775,.0291296,0,.0493032,.984054,.0293099,0,.0581381,.979481,.0291881,0,.0675397,.975297,.0291598,0,.0774848,.96981,.028954,0,.0879528,.963524,.028628,0,.0989258,.957398,.0283135,0,.110388,.950088,.0278469,0,.122327,.941538,.0271798,0,.134729,.933332,.0265388,0,.147587,.924392,.0257776,0,.160889,.914581,.024916,0,.174631,.904347,.0240242,0,.188806,.894324,.0231229,0,.203409,.883724,.022153,0,.218437,.872207,.0211355,0,.233888,.859927,.0201048,0,.249761,.848373,.0191263,0,.266056,.836023,.0181306,0,.282774,.82289,.0171718,0,.299917,.809324,.0162196,0,.317488,.795361,.0152622,0,.335493,.781253,.01439,0,.353936,.767338,.013533,0,.372825,.753156,.0127244,0,.392168,.739122,.0119454,0,.411976,.725358,.0112054,0,.432259,.712949,.010487,0,.453032,.701621,.00984032,0,.47431,.689703,.00921495,0,.496111,.677216,.00862492,0,.518456,.664217,.00806882,0,.541367,.65137,.00755922,0,.564872,.638,.00705705,0,.589001,.62453,.00661266,0,.613789,.610601,.00618432,0,.639277,.59676,.00578033,0,.66551,.582433,.00540927,0,.692539,.568026,.00506104,0,.720422,.55414,.0047353,0,.749216,.540178,.00442889,0,.778974,.526513,.00414363,0,.809711,.512954,.00388237,0,.84127,.499403,.00362875,0,.873016,.486026,.00340827,0,.904762,.472345,.00318598,0,.936508,.458828,.00297635,0,.968254,.445379,.00279447,0,1,1,.0345716,0,0,1,.0345717,0,0,.999999,.034573,0,0,.999991,.0345787,0,0,.999974,.0345941,0,0,.999937,.0346263,0,188589e-11,.999869,.0346847,0,409238e-9,.999757,.0347798,0,.0017674,.999582,.0349233,0,.00413658,.999322,.0351265,0,.00747408,.998939,.0353967,0,.0117157,.998219,.0357018,0,.0167966,.994974,.0354726,0,.0226572,.993201,.0355621,0,.0292445,.991573,.0357641,0,.0365123,.989301,.0359252,0,.0444203,.985712,.0358017,0,.0529334,.982411,.0358353,0,.0620214,.977827,.035617,0,.0716574,.973278,.0354398,0,.0818186,.967397,.0350483,0,.0924846,.960696,.0344795,0,.103638,.954349,.0339861,0,.115263,.946066,.0331323,0,.127348,.938012,.032359,0,.13988,.929413,.0314413,0,.152849,.920355,.0304103,0,.166248,.910586,.0292785,0,.18007,.900609,.0281391,0,.194308,.890093,.0269103,0,.208958,.880013,.0257269,0,.224018,.869001,.0244671,0,.239485,.85751,.0232252,0,.255359,.84582,.0220117,0,.271638,.834383,.0208274,0,.288324,.822158,.0196628,0,.305419,.809056,.0185306,0,.322927,.795832,.0174174,0,.340851,.782547,.0163758,0,.359199,.7689,.015391,0,.377975,.755526,.0144488,0,.397189,.741681,.0135372,0,.416851,.728178,.0126957,0,.436971,.714642,.0118812,0,.457564,.702756,.0111165,0,.478644,.69175,.0104145,0,.500229,.680159,.00974439,0,.522339,.668073,.00911926,0,.544997,.655405,.00851393,0,.56823,.642921,.00797637,0,.592068,.629993,.00745119,0,.616546,.616828,.00696972,0,.641705,.603305,.00652425,0,.66759,.589833,.00610188,0,.694255,.575945,.00570834,0,.72176,.561745,.00533384,0,.750168,.548277,.00500001,0,.779545,.534467,.00467582,0,.809933,.521032,.00438092,0,.841272,.507877,.00410348,0,.873016,.494654,.00383618,0,.904762,.481592,.00358699,0,.936508,.468509,.00337281,0,.968254,.455293,.00316196,0,1,1,.0430698,0,0,1,.0430699,0,0,.999998,.0430713,0,0,.999991,.0430773,0,0,.99997,.0430936,0,0,.999928,.0431277,0,406396e-10,.999852,.0431893,0,744376e-9,.999724,.0432895,0,.0024806,.999527,.0434397,0,.00524779,.99923,.0436507,0,.00898164,.998783,.0439255,0,.0136083,.997507,.0441104,0,.0190582,.994418,.0438225,0,.0252694,.992864,.0439396,0,.0321879,.991127,.0440962,0,.039767,.987331,.0438408,0,.0479667,.984819,.0438991,0,.056752,.980384,.0435906,0,.0660929,.975846,.0432543,0,.075963,.970748,.0428293,0,.0863398,.964303,.042153,0,.0972035,.95772,.0414111,0,.108537,.950747,.0405893,0,.120325,.942533,.0394887,0,.132554,.934045,.0383544,0,.145215,.924942,.037057,0,.158296,.915811,.0356993,0,.17179,.90612,.0342401,0,.185691,.896434,.0328078,0,.199993,.886021,.031288,0,.214691,.876081,.0297776,0,.229782,.865608,.0282334,0,.245265,.854924,.026749,0,.261138,.843607,.02526,0,.277401,.832456,.0238214,0,.294056,.821342,.0224682,0,.311104,.809303,.0211297,0,.328548,.796468,.0198387,0,.346394,.784046,.0186227,0,.364645,.771262,.0174561,0,.38331,.758118,.0163806,0,.402396,.745075,.0153287,0,.421912,.731926,.0143647,0,.44187,.71863,.0134363,0,.462283,.705414,.0125603,0,.483165,.693792,.0117508,0,.504535,.683108,.0110016,0,.52641,.67183,.0102757,0,.548816,.66015,.00962044,0,.571776,.647907,.00898031,0,.595323,.635734,.00840811,0,.619489,.623208,.00786211,0,.644317,.610438,.00734953,0,.669852,.597345,.00687688,0,.696148,.584138,.00643469,0,.723267,.5707,.00602236,0,.75128,.556966,.0056324,0,.780258,.543607,.00528277,0,.810268,.530213,.00493999,0,.841311,.516912,.00462265,0,.873016,.503916,.0043307,0,.904762,.491146,.00406858,0,.936508,.478439,.00381436,0,.968254,.465834,.00358003,0,1,1,.0534039,0,0,1,.053404,0,0,.999998,.0534055,0,0,.999989,.0534116,0,0,.999968,.0534283,0,0,.999918,.0534633,0,155895e-9,.99983,.0535262,0,.00120914,.999685,.0536281,0,.00334944,.999461,.0537799,0,.00653077,.999119,.0539902,0,.0106718,.998582,.0542524,0,.0156907,.995919,.0540318,0,.0215147,.993735,.0538914,0,.0280801,.992126,.0539557,0,.0353323,.990266,.0540401,0,.0432247,.986317,.0536064,0,.0517172,.983213,.0534425,0,.0607754,.978303,.0528622,0,.0703698,.973665,.0523363,0,.0804742,.968091,.0516165,0,.0910667,.961026,.0505434,0,.102128,.954333,.049523,0,.113641,.946372,.0481698,0,.125591,.938254,.0467674,0,.137965,.929516,.0452341,0,.150754,.920106,.0435083,0,.163947,.910899,.0417399,0,.177537,.901532,.0399389,0,.191516,.891919,.0380901,0,.205881,.882006,.0362341,0,.220626,.871965,.0343444,0,.235749,.862145,.0324832,0,.251248,.852058,.0306681,0,.267121,.84161,.0289097,0,.283368,.830806,.0272079,0,.299992,.820476,.0256089,0,.316992,.809514,.0240394,0,.334374,.797865,.0225379,0,.35214,.785621,.0211235,0,.370296,.773765,.0197908,0,.388849,.761629,.0185235,0,.407807,.748891,.0173358,0,.427178,.736437,.0162305,0,.446974,.723707,.0151778,0,.467207,.710606,.0141791,0,.487892,.698019,.0132592,0,.509046,.686203,.0123887,0,.530687,.675692,.0115976,0,.552839,.664826,.0108325,0,.575527,.65349,.0101348,0,.59878,.641774,.00947756,0,.622634,.629794,.00886058,0,.647128,.617647,.00828526,0,.672308,.60534,.00775312,0,.698231,.592718,.00726033,0,.724958,.579746,.00679731,0,.752563,.566763,.00636111,0,.781127,.553515,.00595228,0,.810733,.540118,.00556876,0,.841426,.527325,.00523051,0,.873016,.514265,.00490712,0,.904762,.501406,.00460297,0,.936508,.488922,.00431247,0,.968254,.476541,.0040472,0,1,1,.0659184,0,0,1,.0659185,0,0,.999998,.06592,0,0,.999988,.0659259,0,0,.999963,.0659423,0,0,.999907,.0659764,0,374198e-9,.999806,.0660376,0,.00182071,.999639,.0661361,0,.0043894,.999378,.0662814,0,.00800055,.998985,.0664779,0,.0125594,.998285,.0666914,0,.0179786,.995071,.0661989,0,.0241822,.993172,.0660454,0,.031106,.991438,.0660105,0,.0386952,.988428,.0656875,0,.0469032,.985218,.0652913,0,.0556905,.981128,.0647107,0,.065023,.976015,.0638491,0,.0748717,.97097,.062993,0,.0852112,.964582,.0617927,0,.0960199,.957383,.0603626,0,.107279,.949969,.0588128,0,.118971,.941843,.0570274,0,.131084,.933624,.0551885,0,.143604,.924543,.053122,0,.156521,.914919,.0508897,0,.169825,.905773,.0486418,0,.18351,.896434,.0463364,0,.197569,.887195,.0440623,0,.211997,.877706,.0417799,0,.226789,.867719,.03945,0,.241944,.858587,.037243,0,.257458,.849317,.0350956,0,.273331,.839585,.0329852,0,.289563,.829856,.0310028,0,.306154,.819589,.0290953,0,.323108,.809714,.0272738,0,.340426,.79934,.0255631,0,.358113,.788224,.0239175,0,.376175,.776619,.0223831,0,.394616,.76521,.0209298,0,.413445,.753716,.0195786,0,.432671,.741564,.0183001,0,.452305,.729413,.0171259,0,.472358,.717146,.0159933,0,.492845,.70436,.0149495,0,.513783,.69219,.0139681,0,.535189,.680289,.0130577,0,.557087,.669611,.0122198,0,.5795,.659113,.0114174,0,.602459,.648148,.0106729,0,.625997,.636905,.00998997,0,.650154,.625154,.00934313,0,.674976,.613481,.00874839,0,.700518,.60154,.00818265,0,.726845,.58943,.00766889,0,.754032,.576828,.00717153,0,.782167,.564194,.00672696,0,.811344,.551501,.00630863,0,.841644,.538635,.00592177,0,.873016,.525724,.00554888,0,.904762,.513209,.00520225,0,.936508,.500457,.00488231,0,.968254,.48799,.00457153,0,1,1,.0810131,0,0,1,.0810133,0,0,.999997,.0810145,0,0,.999985,.08102,0,0,.999956,.0810347,0,195026e-10,.999893,.0810656,0,719316e-9,.999777,.0811205,0,.00259774,.999583,.081208,0,.00561807,.999281,.0813343,0,.00967472,.998813,.0814969,0,.0146627,.997597,.0815217,0,.0204902,.994379,.0808502,0,.0270802,.992744,.0806792,0,.0343674,.990745,.0804589,0,.0422974,.986646,.0796107,0,.0508242,.983611,.0790913,0,.0599087,.978869,.0780746,0,.0695175,.973475,.0768218,0,.0796223,.967845,.0754926,0,.0901983,.960778,.0737063,0,.101224,.953333,.0718052,0,.112682,.945274,.0695946,0,.124555,.936955,.0672492,0,.136831,.928319,.0647732,0,.149496,.919075,.0620947,0,.162542,.909114,.0591816,0,.175958,.900137,.0563917,0,.189739,.891069,.0535392,0,.203877,.882262,.0507642,0,.218368,.873232,.0479793,0,.233208,.864042,.045226,0,.248393,.855002,.0425413,0,.263923,.846569,.0400126,0,.279796,.837714,.0375269,0,.296012,.828918,.0352027,0,.312573,.819783,.0330011,0,.329479,.810129,.0308908,0,.346734,.800866,.0289112,0,.364342,.79093,.0270255,0,.382307,.780593,.0252758,0,.400637,.769511,.0236178,0,.419337,.758558,.0220652,0,.438418,.747632,.0206289,0,.457889,.736146,.0192873,0,.477761,.724093,.0180333,0,.49805,.71234,.0168264,0,.51877,.700201,.015746,0,.53994,.687949,.0147027,0,.561581,.676163,.0137512,0,.583718,.665001,.0128655,0,.60638,.65472,.0120366,0,.629599,.644213,.0112604,0,.653415,.633382,.0105413,0,.677874,.62212,.00986498,0,.70303,.610631,.00923308,0,.728948,.599078,.00864206,0,.755706,.587519,.00811784,0,.783396,.575505,.00761237,0,.812121,.563148,.00713949,0,.841989,.550828,.00668379,0,.873035,.538458,.00627715,0,.904762,.525905,.00588336,0,.936508,.513517,.00552687,0,.968254,.501395,.00519681,0,1,1,.0991506,0,0,1,.0991504,0,0,.999996,.0991515,0,0,.999984,.0991558,0,0,.999947,.0991672,0,114389e-9,.999874,.0991912,0,.00121503,.999739,.0992331,0,.00356108,.999514,.0992983,0,.00705578,.999159,.0993877,0,.011574,.998586,.0994837,0,.017003,.995731,.0988425,0,.0232484,.993384,.098276,0,.0302318,.991615,.0979269,0,.0378884,.989029,.0973432,0,.0461641,.985373,.0963539,0,.0550136,.981278,.0952306,0,.0643988,.975777,.0936233,0,.0742868,.970526,.0920219,0,.0846501,.963755,.0898912,0,.0954644,.956676,.0876064,0,.106709,.948099,.0847751,0,.118367,.939718,.0818638,0,.130423,.931305,.078857,0,.142862,.922342,.0756127,0,.155674,.912842,.0721473,0,.168849,.903304,.0686195,0,.182378,.89411,.0650589,0,.196255,.885512,.0616022,0,.210473,.877193,.0582434,0,.225027,.86877,.0548979,0,.239915,.860267,.0516095,0,.255132,.851915,.048468,0,.270678,.843912,.0454447,0,.286551,.83604,.0425612,0,.302751,.828245,.0398752,0,.31928,.820159,.0373198,0,.336138,.81167,.034916,0,.35333,.802659,.0326402,0,.370858,.793921,.0304901,0,.388728,.784713,.0284857,0,.406944,.774946,.0266186,0,.425515,.76448,.0248593,0,.444449,.753793,.0232114,0,.463756,.743506,.0217039,0,.483447,.732555,.0202841,0,.503535,.720965,.0189648,0,.524036,.709422,.0177189,0,.544968,.697756,.0165626,0,.56635,.685565,.015483,0,.588208,.673987,.0144892,0,.610569,.66244,.0135607,0,.633466,.651675,.0126956,0,.656936,.641598,.0118788,0,.681025,.63121,.0111261,0,.705788,.620514,.010437,0,.731289,.609366,.00978747,0,.757606,.598137,.00917257,0,.784834,.586966,.00859778,0,.813085,.575549,.00806803,0,.842485,.563797,.00757294,0,.87313,.551758,.00710592,0,.904762,.539894,.0066841,0,.936508,.527901,.00627901,0,.968254,.515819,.00590506,0,1,1,.120864,0,0,1,.120864,0,0,.999996,.120864,0,0,.99998,.120867,0,0,.99994,.120872,0,323781e-9,.999852,.120884,0,.00188693,.999693,.120903,0,.00473489,.999426,.120929,0,.00872704,.999002,.120955,0,.0137237,.998235,.120918,0,.0196068,.994608,.119764,0,.0262803,.992997,.119265,0,.0336657,.990968,.11863,0,.0416987,.987002,.117261,0,.0503261,.983524,.116009,0,.0595035,.97875,.114252,0,.0691935,.972652,.11193,0,.0793645,.966613,.109555,0,.0899894,.959275,.106612,0,.101045,.951272,.103375,0,.112512,.942323,.0996594,0,.124372,.933679,.0958841,0,.136611,.924822,.0919265,0,.149216,.915742,.0878061,0,.162176,.906348,.0834894,0,.175482,.896883,.079085,0,.189125,.88774,.0746745,0,.203098,.87986,.0705773,0,.217396,.871998,.0665005,0,.232015,.864325,.0625413,0,.24695,.856685,.0586781,0,.2622,.84925,.0550063,0,.277761,.841719,.0514727,0,.293634,.834755,.0481398,0,.309819,.827853,.0450172,0,.326315,.820888,.0420969,0,.343126,.813616,.0393702,0,.360254,.805767,.0367771,0,.377701,.797338,.0343274,0,.395474,.789122,.0320529,0,.413577,.780601,.0299485,0,.432018,.771424,.0279812,0,.450804,.761502,.0261054,0,.469944,.751166,.0243942,0,.489451,.741276,.0228087,0,.509337,.730898,.0213265,0,.529617,.719878,.0199307,0,.550307,.708379,.0186574,0,.571428,.697165,.0174446,0,.593003,.685554,.0163144,0,.615059,.673631,.015276,0,.637628,.662385,.0143003,0,.660746,.651059,.0134112,0,.68446,.640451,.0125794,0,.70882,.630536,.011793,0,.733893,.620316,.0110547,0,.759756,.609722,.0103668,0,.786505,.598804,.00973009,0,.814259,.587871,.00912812,0,.843157,.577121,.00858916,0,.87334,.566019,.00807333,0,.904762,.554664,.00759687,0,.936508,.543101,.00714759,0,.968254,.531558,.00673418,0,1,1,.146767,0,0,1,.146767,0,0,.999997,.146767,0,0,.999977,.146765,0,320658e-11,.999929,.146762,0,682576e-9,.999823,.146753,0,.00276402,.999633,.146735,0,.00614771,.999314,.146699,0,.0106613,.998796,.14662,0,.0161546,.997124,.146107,0,.0225063,.994062,.144857,0,.0296198,.992154,.144011,0,.037417,.989186,.142712,0,.0458348,.985279,.140926,0,.0548211,.980826,.13885,0,.0643326,.975056,.136168,0,.074333,.969005,.133217,0,.0847917,.961554,.12959,0,.0956828,.954206,.125886,0,.106984,.945046,.121335,0,.118675,.935678,.116492,0,.130741,.926748,.111635,0,.143166,.917764,.106625,0,.155939,.908358,.101325,0,.169049,.899219,.0960249,0,.182487,.890089,.0906527,0,.196245,.881488,.0853905,0,.210317,.874031,.0804177,0,.224697,.866932,.0756005,0,.23938,.859976,.0709019,0,.254364,.853375,.0664391,0,.269646,.846971,.0622012,0,.285223,.840483,.058129,0,.301096,.833969,.0542762,0,.317265,.82806,.0507042,0,.333729,.822128,.047368,0,.350491,.815989,.044272,0,.367554,.809336,.0413444,0,.38492,.802177,.038601,0,.402594,.79441,.0360227,0,.420582,.786573,.0336383,0,.438891,.778619,.0314321,0,.457527,.77,.029362,0,.476499,.760698,.0274102,0,.49582,.750932,.0256146,0,.5155,.740993,.023974,0,.535555,.731159,.0224182,0,.556,.720836,.0209889,0,.576855,.709913,.0196411,0,.598143,.698415,.0183824,0,.619888,.68745,.0172222,0,.642123,.676154,.0161509,0,.664883,.664383,.0151397,0,.688211,.6533,.0141873,0,.71216,.642072,.0133105,0,.736792,.631412,.0124932,0,.762186,.621622,.0117408,0,.788439,.611681,.0110358,0,.815672,.60142,.0103775,0,.844034,.59083,.00975623,0,.873699,.580254,.00918084,0,.904765,.569841,.00864721,0,.936508,.559224,.00815731,0,.968254,.548315,.00767924,0,1,1,.177563,0,0,1,.177563,0,0,.999994,.177562,0,0,.999972,.177555,0,664171e-10,.999914,.177536,0,.0012276,.999787,.177496,0,.00388025,.999556,.17742,0,.00783463,.999165,.177285,0,.0128953,.9985,.177037,0,.0189053,.995388,.175634,0,.025742,.993102,.174375,0,.033309,.990992,.173121,0,.0415298,.986932,.170896,0,.0503425,.982786,.16847,0,.0596964,.977592,.165455,0,.0695498,.971075,.161676,0,.0798676,.963967,.157458,0,.0906201,.956397,.152836,0,.101783,.947489,.147467,0,.113333,.937564,.14145,0,.125254,.928182,.135383,0,.137529,.919027,.129212,0,.150144,.909618,.12276,0,.163088,.900492,.116273,0,.176351,.891671,.1098,0,.189924,.883146,.103362,0,.203799,.875151,.0970799,0,.21797,.868338,.0911732,0,.232433,.862033,.0854966,0,.247182,.856107,.0800691,0,.262216,.850644,.0749618,0,.27753,.845261,.070079,0,.293124,.839885,.0654321,0,.308997,.834609,.0610975,0,.325149,.829083,.0569741,0,.341581,.82404,.0531736,0,.358294,.818968,.049665,0,.37529,.813496,.0463856,0,.392573,.807533,.0433217,0,.410148,.80099,.0404402,0,.428019,.793891,.0377578,0,.446192,.786281,.0352616,0,.464676,.778773,.0329577,0,.483478,.770737,.030808,0,.502608,.762094,.0287964,0,.522079,.752898,.0269254,0,.541905,.743306,.0251926,0,.5621,.733416,.023595,0,.582684,.723742,.0221155,0,.603677,.713542,.0207435,0,.625106,.702755,.019434,0,.646998,.691484,.0182046,0,.66939,.680531,.0170771,0,.692324,.66953,.0160339,0,.715849,.658126,.0150677,0,.740028,.646933,.0141551,0,.764937,.636107,.0133179,0,.790673,.625271,.0125284,0,.817358,.615225,.0117937,0,.84515,.605678,.0111181,0,.874244,.59583,.0104759,0,.904828,.585704,.00986672,0,.936508,.575413,.00929712,0,.968254,.565373,.00876713,0,1,1,.214058,0,0,.999999,.214058,0,0,.999994,.214055,0,0,.999966,.214039,0,259642e-9,.999893,.213998,0,.00200075,.999737,.21391,0,.00527775,.999449,.213745,0,.00983959,.99896,.213458,0,.0154755,.9979,.212855,0,.0220249,.994278,.210779,0,.0293654,.992254,.20926,0,.0374021,.98881,.206908,0,.0460604,.984715,.204009,0,.0552802,.979738,.200471,0,.0650127,.972884,.195813,0,.0752175,.965996,.190856,0,.0858612,.957974,.185077,0,.0969155,.949155,.17868,0,.108356,.939288,.171513,0,.120163,.928996,.163838,0,.132319,.919563,.156246,0,.144808,.910004,.148359,0,.157618,.900791,.140417,0,.170737,.892135,.132569,0,.184155,.883803,.124741,0,.197866,.876034,.117091,0,.211861,.869219,.109835,0,.226134,.863062,.102859,0,.240682,.857795,.0962928,0,.255499,.853009,.0900725,0,.270583,.848603,.0842101,0,.285931,.844335,.0786527,0,.301542,.840208,.0734397,0,.317415,.836035,.0685334,0,.33355,.83172,.0639275,0,.349948,.827135,.0595909,0,.36661,.822797,.0556204,0,.383539,.818387,.0519394,0,.400738,.813565,.0485317,0,.41821,.808142,.0453138,0,.435961,.802212,.0423354,0,.453997,.79573,.0395553,0,.472324,.788741,.036988,0,.490951,.781093,.0345688,0,.509887,.773597,.0323297,0,.529144,.765622,.0302719,0,.548735,.757083,.0283477,0,.568674,.747992,.0265562,0,.588979,.738591,.0248844,0,.609671,.728719,.0233342,0,.630773,.719146,.0219081,0,.652314,.709165,.0205711,0,.674328,.69875,.0193248,0,.696854,.687884,.0181582,0,.719942,.676818,.0170746,0,.743651,.666247,.0160718,0,.768057,.655284,.0151262,0,.793253,.64401,.0142561,0,.819363,.633353,.0134327,0,.846547,.622674,.012653,0,.875017,.612265,.0119354,0,.905021,.602455,.0112533,0,.936508,.593147,.0106234,0,.968254,.583592,.0100213,0,1,1,.25717,0,0,1,.25717,0,0,.999992,.257164,0,0,.999958,.257135,0,641715e-9,.999864,.25706,0,.00305314,.999666,.256897,0,.00700975,.999302,.256596,0,.0122194,.998663,.25607,0,.0184622,.995607,.254123,0,.0255773,.993094,.252081,0,.0334439,.9907,.249867,0,.0419696,.98594,.246118,0,.0510823,.981214,.242049,0,.0607242,.974966,.236869,0,.0708486,.967589,.230724,0,.081417,.95915,.223635,0,.0923974,.950257,.21596,0,.103763,.940165,.207296,0,.115491,.929396,.197901,0,.127562,.919288,.188437,0,.13996,.909428,.178762,0,.15267,.900105,.169072,0,.165679,.891418,.159478,0,.178979,.883347,.15002,0,.192558,.875992,.140813,0,.20641,.869466,.13196,0,.220529,.863699,.123501,0,.234907,.858553,.115436,0,.249542,.854379,.107901,0,.264428,.850894,.10088,0,.279564,.847632,.0942296,0,.294947,.844571,.0879861,0,.310575,.84163,.0821534,0,.326448,.838542,.0766409,0,.342566,.835412,.0715322,0,.358929,.831899,.0666883,0,.37554,.828177,.0622175,0,.392399,.82416,.0580452,0,.409511,.820393,.054267,0,.426878,.816068,.0507172,0,.444506,.811201,.0474041,0,.4624,.805785,.0443174,0,.480566,.799878,.0414562,0,.499013,.793469,.0388147,0,.517749,.786473,.0363453,0,.536785,.778874,.0340225,0,.556134,.771277,.0318599,0,.575809,.763426,.0298859,0,.595827,.755044,.0280357,0,.616207,.746161,.0262979,0,.636973,.737124,.0247295,0,.65815,.72761,.0232514,0,.679772,.717822,.0218755,0,.701876,.708279,.0205942,0,.724509,.698333,.0193947,0,.74773,.68802,.0182717,0,.771609,.677321,.0172044,0,.79624,.666504,.0162122,0,.821743,.656184,.0152924,0,.84828,.64556,.0144326,0,.876069,.634636,.0136157,0,.905404,.624124,.0128612,0,.936508,.613914,.0121435,0,.968254,.603589,.0114887,0,1,1,.307946,0,0,.999999,.307945,0,0,.999988,.307934,0,204479e-10,.999944,.307886,0,.00127833,.999824,.307756,0,.00445047,.999565,.30748,0,.00914673,.999085,.306966,0,.0150498,.998103,.306004,0,.0219367,.994249,.303028,0,.0296485,.991807,.300435,0,.038068,.987773,.296554,0,.0471062,.982673,.2916,0,.0566942,.976623,.285641,0,.0667768,.968757,.27815,0,.0773099,.959849,.269529,0,.088257,.950663,.260248,0,.0995879,.940129,.249704,0,.111277,.92895,.238291,0,.123304,.917996,.226501,0,.13565,.907813,.214669,0,.148299,.898305,.202835,0,.161237,.889626,.191158,0,.174455,.88175,.179695,0,.187941,.874715,.168548,0,.201687,.868746,.15792,0,.215687,.863703,.147807,0,.229933,.859315,.138149,0,.24442,.855538,.128993,0,.259145,.852428,.120414,0,.274103,.850168,.112498,0,.289293,.848132,.105054,0,.304711,.846291,.0981087,0,.320357,.844431,.0915942,0,.33623,.842493,.0855056,0,.35233,.840368,.0798204,0,.368658,.83798,.0745097,0,.385214,.83523,.0695424,0,.402002,.832091,.0649092,0,.419023,.828667,.0606291,0,.436282,.824805,.0566523,0,.453782,.820988,.0530229,0,.471529,.816635,.0496364,0,.489528,.811725,.0464658,0,.507788,.806316,.0435082,0,.526317,.800469,.0407873,0,.545124,.794107,.038255,0,.564221,.787218,.0358825,0,.583621,.779872,.0336785,0,.603341,.772097,.0316379,0,.623397,.764484,.0297379,0,.643812,.756428,.0279581,0,.664611,.748022,.0263153,0,.685824,.739268,.0247799,0,.707488,.73024,.0233385,0,.729646,.720893,.0220035,0,.752354,.71119,.0207555,0,.77568,.701791,.0195843,0,.799715,.692184,.0184891,0,.824574,.682258,.0174541,0,.850417,.67206,.0164873,0,.877466,.661717,.0155959,0,.90604,.651462,.0147519,0,.936528,.641467,.0139727,0,.968254,.631229,.0132363,0,1,1,.367573,0,0,.999999,.367571,0,0,.999984,.367553,0,183382e-9,.999925,.367473,0,.00225254,.999759,.367259,0,.00628165,.99941,.366801,0,.0117858,.998739,.365946,0,.0184359,.995529,.363191,0,.0260114,.992875,.360171,0,.0343581,.989135,.355981,0,.0433637,.984166,.350401,0,.0529438,.977871,.343348,0,.0630334,.96951,.334341,0,.0735805,.959964,.323862,0,.0845437,.950162,.312521,0,.095889,.938882,.299577,0,.107588,.926992,.285573,0,.119617,.915589,.271212,0,.131957,.904791,.256611,0,.144591,.895177,.242224,0,.157503,.886403,.227952,0,.170682,.878957,.214192,0,.184117,.872418,.200795,0,.197799,.867029,.188015,0,.21172,.862835,.175975,0,.225873,.859411,.164526,0,.240253,.856655,.153693,0,.254854,.854519,.14352,0,.269673,.852828,.13397,0,.284707,.851412,.124984,0,.299953,.850609,.116748,0,.315408,.849855,.10905,0,.331073,.849017,.101839,0,.346946,.848079,.0951359,0,.363028,.846911,.0888774,0,.379318,.845445,.0830375,0,.395818,.84362,.0775844,0,.41253,.841411,.0725054,0,.429457,.838768,.0677691,0,.446602,.835801,.0634016,0,.463968,.832341,.0593095,0,.481561,.828424,.0555121,0,.499386,.824312,.052024,0,.51745,.819918,.0487865,0,.535761,.815072,.0457801,0,.554328,.809863,.0430184,0,.573162,.804164,.0404245,0,.592275,.798034,.0380146,0,.611681,.791436,.0357436,0,.631398,.784498,.0336475,0,.651445,.777125,.0316666,0,.671845,.769365,.0298122,0,.692628,.761579,.0281001,0,.713827,.753746,.0265049,0,.735484,.745573,.0250067,0,.75765,.737083,.0236026,0,.78039,.728545,.0223302,0,.803789,.719691,.0211243,0,.82796,.710569,.0199983,0,.853056,.701216,.0189569,0,.879298,.692094,.0179702,0,.907014,.682909,.0170418,0,.936691,.673509,.0161732,0,.968254,.663863,.0153406,0,1,1,.437395,0,0,.999998,.437394,0,0,.99998,.437363,0,616704e-9,.999891,.437232,0,.00367925,.999656,.436877,0,.00867446,.999148,.436121,0,.0150679,.997959,.434564,0,.022531,.993464,.430134,0,.0308507,.990606,.426077,0,.0398805,.985027,.419397,0,.0495148,.978491,.41118,0,.0596749,.969643,.40048,0,.0703001,.959189,.38769,0,.0813427,.948223,.373575,0,.0927641,.935955,.357622,0,.104533,.923237,.34043,0,.116624,.911074,.322735,0,.129015,.899724,.30479,0,.141687,.890189,.287392,0,.154626,.881796,.270248,0,.167818,.874781,.253659,0,.181252,.869166,.237786,0,.194918,.864725,.222618,0,.208807,.861565,.208356,0,.222913,.859284,.194867,0,.237229,.857677,.18212,0,.25175,.856714,.17018,0,.266473,.856155,.158969,0,.281392,.8558,.148413,0,.296505,.855672,.138578,0,.311811,.855538,.129345,0,.327306,.855689,.120861,0,.342991,.855767,.112969,0,.358864,.855618,.105593,0,.374925,.85525,.0987451,0,.391176,.854583,.0923727,0,.407616,.853534,.0864143,0,.424249,.852061,.0808338,0,.441076,.850253,.0756771,0,.4581,.848004,.0708612,0,.475324,.845333,.0663784,0,.492754,.842376,.0622631,0,.510394,.838956,.0584112,0,.528251,.835121,.0548328,0,.546331,.830842,.0514838,0,.564644,.826212,.048355,0,.583198,.821522,.0454714,0,.602005,.816551,.0428263,0,.621078,.811211,.0403612,0,.640434,.805479,.038039,0,.660089,.799409,.0358739,0,.680066,.79306,.0338727,0,.70039,.786395,.0319985,0,.721094,.779416,.030241,0,.742215,.77214,.0285951,0,.7638,.764636,.0270747,0,.785912,.756836,.0256354,0,.808628,.749315,.0243027,0,.832055,.741561,.0230497,0,.856338,.733589,.0218801,0,.88169,.725479,.020784,0,.908441,.717255,.0197702,0,.937125,.708829,.0188168,0,.968254,.700191,.0179113,0,1,1,.518937,0,0,.999998,.518933,0,0,.999967,.518883,0,.00147741,.999832,.51866,0,.00573221,.999466,.518057,0,.011826,.998644,.516752,0,.0192116,.994458,.512347,0,.027573,.991223,.507675,0,.0367099,.985515,.500188,0,.046487,.978308,.490408,0,.0568071,.968359,.477357,0,.0675984,.95682,.461752,0,.0788059,.943929,.443796,0,.090386,.930224,.423893,0,.102304,.916514,.402682,0,.114532,.903653,.380914,0,.127047,.892315,.359212,0,.139828,.882942,.338102,0,.152861,.875438,.31773,0,.16613,.869642,.298186,0,.179624,.865304,.279491,0,.193332,.862382,.261804,0,.207247,.860666,.245146,0,.22136,.859788,.229406,0,.235666,.859608,.214605,0,.250158,.859912,.200691,0,.264832,.86053,.187623,0,.279684,.861368,.17539,0,.294711,.862237,.163901,0,.309911,.863127,.153175,0,.32528,.863923,.143147,0,.340819,.864567,.133781,0,.356524,.865013,.125042,0,.372397,.86539,.116952,0,.388438,.865591,.109476,0,.404645,.865517,.102542,0,.421022,.865084,.0960688,0,.437569,.864309,.0900499,0,.454287,.863151,.0844328,0,.471181,.861649,.0792218,0,.488253,.859742,.0743482,0,.505507,.857446,.0697963,0,.522947,.854757,.0655364,0,.54058,.851783,.061608,0,.558412,.848516,.0579701,0,.576449,.844897,.0545742,0,.594701,.840956,.0514167,0,.613178,.836676,.0484598,0,.631892,.832075,.0456934,0,.650856,.827191,.0431178,0,.670088,.822295,.0407718,0,.689606,.817294,.0386032,0,.709434,.812013,.0365675,0,.7296,.806465,.0346547,0,.750138,.800691,.0328717,0,.771093,.794709,.031211,0,.792519,.788493,.0296504,0,.814488,.782049,.0281782,0,.837097,.775403,.0267965,0,.860481,.76857,.0255002,0,.884842,.761536,.0242759,0,.910494,.754303,.0231142,0,.937985,.74692,.0220305,0,.968254,.739745,.0210192,0,1,1,.613914,0,0,.999996,.613907,0,963597e-10,.999942,.613814,0,.00301247,.999704,.613407,0,.00870385,.999046,.612302,0,.0160714,.995516,.608266,0,.0245899,.991726,.602863,0,.0339681,.985157,.593956,0,.0440254,.97642,.581748,0,.0546409,.964404,.565183,0,.0657284,.950601,.545273,0,.0772246,.935158,.522129,0,.0890812,.919364,.496782,0,.10126,.904754,.470571,0,.113731,.89176,.444037,0,.126469,.881492,.418322,0,.139454,.873656,.393522,0,.15267,.868053,.369795,0,.166101,.864336,.347171,0,.179736,.862259,.325737,0,.193565,.861556,.305532,0,.207578,.861776,.286416,0,.221769,.862661,.268355,0,.23613,.864015,.251334,0,.250656,.865711,.235352,0,.265343,.867519,.220302,0,.280187,.869351,.206161,0,.295183,.871144,.192908,0,.31033,.872839,.180505,0,.325624,.874307,.168848,0,.341065,.875667,.158021,0,.35665,.876758,.147877,0,.37238,.87764,.138441,0,.388253,.878237,.129627,0,.404269,.878563,.121415,0,.42043,.878572,.113741,0,.436735,.87842,.106652,0,.453187,.878057,.100097,0,.469786,.877413,.0940128,0,.486536,.87646,.0883462,0,.503439,.875233,.0830924,0,.520498,.8737,.0781975,0,.537717,.871873,.07364,0,.555102,.86978,.0694103,0,.572657,.867405,.0654696,0,.59039,.864751,.0617914,0,.608307,.861818,.0583491,0,.626419,.858645,.0551443,0,.644733,.855307,.0521894,0,.663264,.851736,.0494334,0,.682025,.847927,.0468504,0,.701032,.843888,.0444261,0,.720308,.839629,.0421497,0,.739875,.835158,.0400082,0,.759764,.830509,.0380076,0,.780014,.825714,.0361488,0,.800673,.820729,.0343956,0,.821803,.815751,.0327781,0,.843492,.810752,.031275,0,.86586,.805587,.0298542,0,.889087,.800317,.0285397,0,.913466,.79489,.0272948,0,.93952,.789314,.0261139,0,.96835,.783593,.0249938,0,1,1,.724258,0,0,.999992,.724243,0,726889e-9,.99987,.724044,0,.00569574,.999336,.72317,0,.0131702,.996271,.719432,0,.0220738,.991159,.712576,0,.0319405,.982465,.700927,0,.0425202,.97049,.684297,0,.0536599,.953973,.661244,0,.065258,.935546,.633804,0,.0772427,.916596,.603071,0,.0895616,.899353,.57105,0,.102175,.885216,.539206,0,.11505,.875076,.508714,0,.128164,.868334,.479571,0,.141495,.864414,.451796,0,.155026,.862678,.425328,0,.168745,.862835,.400352,0,.182639,.864067,.376532,0,.196699,.866086,.35391,0,.210915,.868557,.332424,0,.225282,.871271,.312053,0,.239792,.874058,.292764,0,.25444,.8768,.27453,0,.269223,.87939,.257297,0,.284135,.8819,.24114,0,.299174,.884187,.225934,0,.314337,.886262,.211669,0,.329622,.888119,.198311,0,.345026,.889709,.185783,0,.360549,.891054,.174063,0,.376189,.892196,.163143,0,.391946,.893101,.152952,0,.407819,.893803,.143475,0,.423808,.894277,.134647,0,.439914,.894532,.126434,0,.456137,.894576,.1188,0,.472479,.894393,.111694,0,.48894,.893976,.105069,0,.505523,.893346,.0989077,0,.52223,.892502,.0931724,0,.539064,.891441,.0878276,0,.556028,.890276,.082903,0,.573125,.888972,.0783505,0,.590361,.887469,.0741083,0,.607741,.885785,.0701633,0,.62527,.883914,.0664835,0,.642957,.881872,.0630567,0,.660809,.879651,.0598527,0,.678836,.877267,.0568615,0,.69705,.874717,.05406,0,.715465,.872012,.0514378,0,.734098,.869157,.0489805,0,.752968,.866155,.0466727,0,.772101,.863014,.0445056,0,.791529,.859748,.0424733,0,.81129,.856416,.0405957,0,.831438,.852958,.0388273,0,.852044,.849382,.0371619,0,.87321,.845694,.0355959,0,.89509,.841893,.0341155,0,.917932,.837981,.0327141,0,.942204,.833963,.0313856,0,.968981,.829847,.0301275,0,1,1,.85214,0,0,.999969,.852095,0,.00279627,.999483,.851408,0,.0107635,.994545,.84579,0,.0206454,.986188,.835231,0,.0315756,.969847,.814687,0,.0432021,.945951,.783735,0,.0553396,.91917,.746074,0,.0678766,.895488,.706938,0,.0807395,.878232,.669534,0,.0938767,.868252,.635168,0,.10725,.863873,.603069,0,.120832,.863369,.572514,0,.134598,.86545,.543169,0,.148533,.868803,.514578,0,.16262,.872794,.486762,0,.176849,.87702,.459811,0,.19121,.881054,.433654,0,.205694,.884974,.408574,0,.220294,.888587,.384525,0,.235005,.891877,.36156,0,.24982,.894793,.339661,0,.264737,.89743,.318913,0,.279751,.899796,.299302,0,.294859,.901943,.280843,0,.310058,.903858,.263481,0,.325346,.905574,.247197,0,.340721,.907069,.231915,0,.356181,.908379,.217614,0,.371725,.90952,.20425,0,.387353,.910483,.191758,0,.403063,.91128,.180092,0,.418854,.911936,.169222,0,.434727,.912454,.159098,0,.450682,.912835,.149668,0,.466718,.913078,.140884,0,.482837,.913192,.132709,0,.499038,.913175,.125095,0,.515324,.91304,.118012,0,.531695,.912781,.111417,0,.548153,.91241,.105281,0,.5647,.911924,.0995691,0,.581338,.911331,.0942531,0,.59807,.910637,.0893076,0,.6149,.90984,.0846998,0,.63183,.908941,.0804044,0,.648865,.907944,.0763984,0,.666011,.906857,.0726638,0,.683273,.90568,.0691783,0,.700659,.904416,.0659222,0,.718176,.903067,.0628782,0,.735834,.901637,.0600307,0,.753646,.900128,.0573647,0,.771625,.898544,.0548668,0,.78979,.89689,.052527,0,.808162,.895165,.0503306,0,.826771,.893371,.0482668,0,.845654,.891572,.0463605,0,.864863,.889763,.0445998,0,.884472,.887894,.0429451,0,.904592,.885967,.0413884,0,.925407,.883984,.0399225,0,.947271,.881945,.0385405,0,.97105,.879854,.0372362,0,1,.999804,.995833,0,0,.938155,.933611,0,.0158731,.864755,.854311,0,.0317461,.888594,.865264,0,.0476191,.905575,.863922,0,.0634921,.915125,.850558,0,.0793651,.920665,.829254,0,.0952381,.924073,.802578,0,.111111,.926304,.772211,0,.126984,.927829,.739366,0,.142857,.928924,.705033,0,.15873,.92973,.670019,0,.174603,.930339,.634993,0,.190476,.930811,.600485,0,.206349,.931191,.566897,0,.222222,.93149,.534485,0,.238095,.931737,.503429,0,.253968,.931939,.473811,0,.269841,.932108,.445668,0,.285714,.93225,.418993,0,.301587,.932371,.393762,0,.31746,.932474,.369939,0,.333333,.932562,.347479,0,.349206,.932638,.326336,0,.365079,.932703,.306462,0,.380952,.93276,.287805,0,.396825,.932809,.270313,0,.412698,.932851,.253933,0,.428571,.932887,.23861,0,.444444,.932917,.224289,0,.460317,.932943,.210917,0,.47619,.932965,.19844,0,.492063,.932982,.186807,0,.507937,.932995,.175966,0,.52381,.933005,.165869,0,.539683,.933011,.156468,0,.555556,.933013,.147719,0,.571429,.933013,.139579,0,.587302,.93301,.132007,0,.603175,.933004,.124965,0,.619048,.932994,.118416,0,.634921,.932982,.112326,0,.650794,.932968,.106663,0,.666667,.93295,.101397,0,.68254,.932931,.0964993,0,.698413,.932908,.0919438,0,.714286,.932883,.0877057,0,.730159,.932856,.0837623,0,.746032,.932827,.0800921,0,.761905,.932796,.0766754,0,.777778,.932762,.0734936,0,.793651,.932727,.0705296,0,.809524,.932689,.0677676,0,.825397,.93265,.0651929,0,.84127,.932609,.0627917,0,.857143,.932565,.0605515,0,.873016,.932521,.0584606,0,.888889,.932474,.0565082,0,.904762,.932427,.0546841,0,.920635,.932377,.0529793,0,.936508,.932326,.0513851,0,.952381,.932274,.0498936,0,.968254,.93222,.0484975,0,.984127,.932164,.0471899,0,1],ir=new Float32Array(er),nr=new Float32Array(tr),sr=new DataTexture(ir,64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1),ar=new DataTexture(nr,64,64,RGBAFormat,FloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1);sr.needsUpdate=!0,ar.needsUpdate=!0;const or=new Uint16Array(er.length);er.forEach(function(dr,hr){or[hr]=DataUtils.toHalfFloat(dr)});const lr=new Uint16Array(tr.length);tr.forEach(function(dr,hr){lr[hr]=DataUtils.toHalfFloat(dr)});const cr=new DataTexture(or,64,64,RGBAFormat,HalfFloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1),ur=new DataTexture(lr,64,64,RGBAFormat,HalfFloatType,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,NearestFilter,1);return cr.needsUpdate=!0,ur.needsUpdate=!0,this.LTC_HALF_1=cr,this.LTC_HALF_2=ur,this.LTC_FLOAT_1=sr,this.LTC_FLOAT_2=ar,this}}RectAreaLightTexturesLib.LTC_HALF_1=null;RectAreaLightTexturesLib.LTC_HALF_1=null;RectAreaLightTexturesLib.LTC_FLOAT_1=null;RectAreaLightTexturesLib.LTC_FLOAT_2=null;class RectAreaLightUniformsLib{static init(){RectAreaLightTexturesLib.init();const{LTC_FLOAT_1:er,LTC_FLOAT_2:tr,LTC_HALF_1:ir,LTC_HALF_2:nr}=RectAreaLightTexturesLib;UniformsLib.LTC_FLOAT_1=er,UniformsLib.LTC_FLOAT_2=tr,UniformsLib.LTC_HALF_1=ir,UniformsLib.LTC_HALF_2=nr}}const _box$1=new Box3,_vector$2=new Vector3$1;class LineSegmentsGeometry extends InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const er=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],tr=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],ir=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(ir),this.setAttribute("position",new Float32BufferAttribute(er,3)),this.setAttribute("uv",new Float32BufferAttribute(tr,2))}applyMatrix4(er){const tr=this.attributes.instanceStart,ir=this.attributes.instanceEnd;return tr!==void 0&&(tr.applyMatrix4(er),ir.applyMatrix4(er),tr.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(er){let tr;er instanceof Float32Array?tr=er:Array.isArray(er)&&(tr=new Float32Array(er));const ir=new InstancedInterleavedBuffer(tr,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(ir,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(ir,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(er){let tr;er instanceof Float32Array?tr=er:Array.isArray(er)&&(tr=new Float32Array(er));const ir=new InstancedInterleavedBuffer(tr,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(ir,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(ir,3,3)),this}fromWireframeGeometry(er){return this.setPositions(er.attributes.position.array),this}fromEdgesGeometry(er){return this.setPositions(er.attributes.position.array),this}fromMesh(er){return this.fromWireframeGeometry(new WireframeGeometry(er.geometry)),this}fromLineSegments(er){const tr=er.geometry;return this.setPositions(tr.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const er=this.attributes.instanceStart,tr=this.attributes.instanceEnd;er!==void 0&&tr!==void 0&&(this.boundingBox.setFromBufferAttribute(er),_box$1.setFromBufferAttribute(tr),this.boundingBox.union(_box$1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingBox===null&&this.computeBoundingBox();const er=this.attributes.instanceStart,tr=this.attributes.instanceEnd;if(er!==void 0&&tr!==void 0){const ir=this.boundingSphere.center;this.boundingBox.getCenter(ir);let nr=0;for(let sr=0,ar=er.count;sr<ar;sr++)_vector$2.fromBufferAttribute(er,sr),nr=Math.max(nr,ir.distanceToSquared(_vector$2)),_vector$2.fromBufferAttribute(tr,sr),nr=Math.max(nr,ir.distanceToSquared(_vector$2));this.boundingSphere.radius=Math.sqrt(nr),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(er){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(er)}}UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends ShaderMaterial{static get type(){return"LineMaterial"}constructor(er){super({uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(er)}get color(){return this.uniforms.diffuse.value}set color(er){this.uniforms.diffuse.value=er}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(er){er===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(er){this.uniforms.linewidth&&(this.uniforms.linewidth.value=er)}get dashed(){return"USE_DASH"in this.defines}set dashed(er){er===!0!==this.dashed&&(this.needsUpdate=!0),er===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(er){this.uniforms.dashScale.value=er}get dashSize(){return this.uniforms.dashSize.value}set dashSize(er){this.uniforms.dashSize.value=er}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(er){this.uniforms.dashOffset.value=er}get gapSize(){return this.uniforms.gapSize.value}set gapSize(er){this.uniforms.gapSize.value=er}get opacity(){return this.uniforms.opacity.value}set opacity(er){this.uniforms&&(this.uniforms.opacity.value=er)}get resolution(){return this.uniforms.resolution.value}set resolution(er){this.uniforms.resolution.value.copy(er)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(er){this.defines&&(er===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),er===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const _viewport$1=new Vector4,_start$1=new Vector3$1,_end$1=new Vector3$1,_start4=new Vector4,_end4=new Vector4,_ssOrigin=new Vector4,_ssOrigin3=new Vector3$1,_mvMatrix=new Matrix4,_line=new Line3,_closestPoint=new Vector3$1,_box=new Box3,_sphere$1=new Sphere,_clipToWorldVector=new Vector4;let _ray$1,_lineWidth;function getWorldSpaceHalfWidth(rr,er,tr){return _clipToWorldVector.set(0,0,-er,1).applyMatrix4(rr.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/tr.width,_clipToWorldVector.y=_lineWidth/tr.height,_clipToWorldVector.applyMatrix4(rr.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(rr,er){const tr=rr.matrixWorld,ir=rr.geometry,nr=ir.attributes.instanceStart,sr=ir.attributes.instanceEnd,ar=Math.min(ir.instanceCount,nr.count);for(let or=0,lr=ar;or<lr;or++){_line.start.fromBufferAttribute(nr,or),_line.end.fromBufferAttribute(sr,or),_line.applyMatrix4(tr);const cr=new Vector3$1,ur=new Vector3$1;_ray$1.distanceSqToSegment(_line.start,_line.end,ur,cr),ur.distanceTo(cr)<_lineWidth*.5&&er.push({point:ur,pointOnLine:cr,distance:_ray$1.origin.distanceTo(ur),object:rr,face:null,faceIndex:or,uv:null,uv1:null})}}function raycastScreenSpace(rr,er,tr){const ir=er.projectionMatrix,sr=rr.material.resolution,ar=rr.matrixWorld,or=rr.geometry,lr=or.attributes.instanceStart,cr=or.attributes.instanceEnd,ur=Math.min(or.instanceCount,lr.count),dr=-er.near;_ray$1.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(er.matrixWorldInverse),_ssOrigin.applyMatrix4(ir),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=sr.x/2,_ssOrigin.y*=sr.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(er.matrixWorldInverse,ar);for(let hr=0,pr=ur;hr<pr;hr++){if(_start4.fromBufferAttribute(lr,hr),_end4.fromBufferAttribute(cr,hr),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>dr&&_end4.z>dr)continue;if(_start4.z>dr){const Ar=_start4.z-_end4.z,yr=(_start4.z-dr)/Ar;_start4.lerp(_end4,yr)}else if(_end4.z>dr){const Ar=_end4.z-_start4.z,yr=(_end4.z-dr)/Ar;_end4.lerp(_start4,yr)}_start4.applyMatrix4(ir),_end4.applyMatrix4(ir),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=sr.x/2,_start4.y*=sr.y/2,_end4.x*=sr.x/2,_end4.y*=sr.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const vr=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(vr,_closestPoint);const mr=MathUtils.lerp(_start4.z,_end4.z,vr),fr=mr>=-1&&mr<=1,_r=_ssOrigin3.distanceTo(_closestPoint)<_lineWidth*.5;if(fr&&_r){_line.start.fromBufferAttribute(lr,hr),_line.end.fromBufferAttribute(cr,hr),_line.start.applyMatrix4(ar),_line.end.applyMatrix4(ar);const Ar=new Vector3$1,yr=new Vector3$1;_ray$1.distanceSqToSegment(_line.start,_line.end,yr,Ar),tr.push({point:yr,pointOnLine:Ar,distance:_ray$1.origin.distanceTo(yr),object:rr,face:null,faceIndex:hr,uv:null,uv1:null})}}}class LineSegments2 extends Mesh{constructor(er=new LineSegmentsGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const er=this.geometry,tr=er.attributes.instanceStart,ir=er.attributes.instanceEnd,nr=new Float32Array(2*tr.count);for(let ar=0,or=0,lr=tr.count;ar<lr;ar++,or+=2)_start$1.fromBufferAttribute(tr,ar),_end$1.fromBufferAttribute(ir,ar),nr[or]=or===0?0:nr[or-1],nr[or+1]=nr[or]+_start$1.distanceTo(_end$1);const sr=new InstancedInterleavedBuffer(nr,2,1);return er.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(sr,1,0)),er.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(sr,1,1)),this}raycast(er,tr){const ir=this.material.worldUnits,nr=er.camera;nr===null&&!ir&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const sr=er.params.Line2!==void 0&&er.params.Line2.threshold||0;_ray$1=er.ray;const ar=this.matrixWorld,or=this.geometry,lr=this.material;_lineWidth=lr.linewidth+sr,or.boundingSphere===null&&or.computeBoundingSphere(),_sphere$1.copy(or.boundingSphere).applyMatrix4(ar);let cr;if(ir)cr=_lineWidth*.5;else{const dr=Math.max(nr.near,_sphere$1.distanceToPoint(_ray$1.origin));cr=getWorldSpaceHalfWidth(nr,dr,lr.resolution)}if(_sphere$1.radius+=cr,_ray$1.intersectsSphere(_sphere$1)===!1)return;or.boundingBox===null&&or.computeBoundingBox(),_box.copy(or.boundingBox).applyMatrix4(ar);let ur;if(ir)ur=_lineWidth*.5;else{const dr=Math.max(nr.near,_box.distanceToPoint(_ray$1.origin));ur=getWorldSpaceHalfWidth(nr,dr,lr.resolution)}_box.expandByScalar(ur),_ray$1.intersectsBox(_box)!==!1&&(ir?raycastWorldUnits(this,tr):raycastScreenSpace(this,nr,tr))}onBeforeRender(er){const tr=this.material.uniforms;tr&&tr.resolution&&(er.getViewport(_viewport$1),this.material.uniforms.resolution.value.set(_viewport$1.z,_viewport$1.w))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(er){const tr=er.length-3,ir=new Float32Array(2*tr);for(let nr=0;nr<tr;nr+=3)ir[2*nr]=er[nr],ir[2*nr+1]=er[nr+1],ir[2*nr+2]=er[nr+2],ir[2*nr+3]=er[nr+3],ir[2*nr+4]=er[nr+4],ir[2*nr+5]=er[nr+5];return super.setPositions(ir),this}setColors(er){const tr=er.length-3,ir=new Float32Array(2*tr);for(let nr=0;nr<tr;nr+=3)ir[2*nr]=er[nr],ir[2*nr+1]=er[nr+1],ir[2*nr+2]=er[nr+2],ir[2*nr+3]=er[nr+3],ir[2*nr+4]=er[nr+4],ir[2*nr+5]=er[nr+5];return super.setColors(ir),this}fromLine(er){const tr=er.geometry;return this.setPositions(tr.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(er=new LineGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isLine2=!0,this.type="Line2"}}const _start=new Vector3$1,_end=new Vector3$1,_viewport=new Vector4;class Wireframe extends Mesh{constructor(er=new LineSegmentsGeometry,tr=new LineMaterial({color:Math.random()*16777215})){super(er,tr),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const er=this.geometry,tr=er.attributes.instanceStart,ir=er.attributes.instanceEnd,nr=new Float32Array(2*tr.count);for(let ar=0,or=0,lr=tr.count;ar<lr;ar++,or+=2)_start.fromBufferAttribute(tr,ar),_end.fromBufferAttribute(ir,ar),nr[or]=or===0?0:nr[or-1],nr[or+1]=nr[or]+_start.distanceTo(_end);const sr=new InstancedInterleavedBuffer(nr,2,1);return er.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(sr,1,0)),er.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(sr,1,1)),this}onBeforeRender(er){const tr=this.material.uniforms;tr&&tr.resolution&&(er.getViewport(_viewport),this.material.uniforms.resolution.value.set(_viewport.z,_viewport.w))}}class WireframeGeometry2 extends LineSegmentsGeometry{constructor(er){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new WireframeGeometry(er))}}class EXRLoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType}parse(er){const Cr=Math.pow(2.7182818,2.2);function Ir(Qr,$i){let ns=0;for(let ps=0;ps<65536;++ps)(ps==0||Qr[ps>>3]&1<<(ps&7))&&($i[ns++]=ps);const ds=ns-1;for(;ns<65536;)$i[ns++]=0;return ds}function Rr(Qr){for(let $i=0;$i<16384;$i++)Qr[$i]={},Qr[$i].len=0,Qr[$i].lit=0,Qr[$i].p=null}const Pr={l:0,c:0,lc:0};function Dr(Qr,$i,ns,ds,ps){for(;ns<Qr;)$i=$i<<8|Ns(ds,ps),ns+=8;ns-=Qr,Pr.l=$i>>ns&(1<<Qr)-1,Pr.c=$i,Pr.lc=ns}const Fr=new Array(59);function Or(Qr){for(let ns=0;ns<=58;++ns)Fr[ns]=0;for(let ns=0;ns<65537;++ns)Fr[Qr[ns]]+=1;let $i=0;for(let ns=58;ns>0;--ns){const ds=$i+Fr[ns]>>1;Fr[ns]=$i,$i=ds}for(let ns=0;ns<65537;++ns){const ds=Qr[ns];ds>0&&(Qr[ns]=ds|Fr[ds]++<<6)}}function Nr(Qr,$i,ns,ds,ps,ys){const Ts=$i;let Ds=0,Ms=0;for(;ds<=ps;ds++){if(Ts.value-$i.value>ns)return!1;Dr(6,Ds,Ms,Qr,Ts);const Cs=Pr.l;if(Ds=Pr.c,Ms=Pr.lc,ys[ds]=Cs,Cs==63){if(Ts.value-$i.value>ns)throw new Error("Something wrong with hufUnpackEncTable");Dr(8,Ds,Ms,Qr,Ts);let Is=Pr.l+6;if(Ds=Pr.c,Ms=Pr.lc,ds+Is>ps+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Is--;)ys[ds++]=0;ds--}else if(Cs>=59){let Is=Cs-59+2;if(ds+Is>ps+1)throw new Error("Something wrong with hufUnpackEncTable");for(;Is--;)ys[ds++]=0;ds--}}Or(ys)}function Ur(Qr){return Qr&63}function Br(Qr){return Qr>>6}function Wr(Qr,$i,ns,ds){for(;$i<=ns;$i++){const ps=Br(Qr[$i]),ys=Ur(Qr[$i]);if(ps>>ys)throw new Error("Invalid table entry");if(ys>14){const Ts=ds[ps>>ys-14];if(Ts.len)throw new Error("Invalid table entry");if(Ts.lit++,Ts.p){const Ds=Ts.p;Ts.p=new Array(Ts.lit);for(let Ms=0;Ms<Ts.lit-1;++Ms)Ts.p[Ms]=Ds[Ms]}else Ts.p=new Array(1);Ts.p[Ts.lit-1]=$i}else if(ys){let Ts=0;for(let Ds=1<<14-ys;Ds>0;Ds--){const Ms=ds[(ps<<14-ys)+Ts];if(Ms.len||Ms.p)throw new Error("Invalid table entry");Ms.len=ys,Ms.lit=$i,Ts++}}}return!0}const Xr={c:0,lc:0};function Yr(Qr,$i,ns,ds){Qr=Qr<<8|Ns(ns,ds),$i+=8,Xr.c=Qr,Xr.lc=$i}const Qi={c:0,lc:0};function Xi(Qr,$i,ns,ds,ps,ys,Ts,Ds,Ms){if(Qr==$i){ds<8&&(Yr(ns,ds,ps,ys),ns=Xr.c,ds=Xr.lc),ds-=8;let Cs=ns>>ds;if(Cs=new Uint8Array([Cs])[0],Ds.value+Cs>Ms)return!1;const Is=Ts[Ds.value-1];for(;Cs-- >0;)Ts[Ds.value++]=Is}else if(Ds.value<Ms)Ts[Ds.value++]=Qr;else return!1;Qi.c=ns,Qi.lc=ds}function Kr(Qr){return Qr&65535}function $r(Qr){const $i=Kr(Qr);return $i>32767?$i-65536:$i}const Vr={a:0,b:0};function Gr(Qr,$i){const ns=$r(Qr),ps=$r($i),ys=ns+(ps&1)+(ps>>1),Ts=ys,Ds=ys-ps;Vr.a=Ts,Vr.b=Ds}function qr(Qr,$i){const ns=Kr(Qr),ds=Kr($i),ps=ns-(ds>>1)&65535,ys=ds+ps-32768&65535;Vr.a=ys,Vr.b=ps}function ji(Qr,$i,ns,ds,ps,ys,Ts){const Ds=Ts<16384,Ms=ns>ps?ps:ns;let Cs=1,Is,Fs;for(;Cs<=Ms;)Cs<<=1;for(Cs>>=1,Is=Cs,Cs>>=1;Cs>=1;){Fs=0;const Ws=Fs+ys*(ps-Is),js=ys*Cs,qs=ys*Is,Xs=ds*Cs,$s=ds*Is;let zs,Sa,ma,Oa;for(;Fs<=Ws;Fs+=qs){let Ma=Fs;const ya=Fs+ds*(ns-Is);for(;Ma<=ya;Ma+=$s){const Ua=Ma+Xs,ha=Ma+js,Ca=ha+Xs;Ds?(Gr(Qr[Ma+$i],Qr[ha+$i]),zs=Vr.a,ma=Vr.b,Gr(Qr[Ua+$i],Qr[Ca+$i]),Sa=Vr.a,Oa=Vr.b,Gr(zs,Sa),Qr[Ma+$i]=Vr.a,Qr[Ua+$i]=Vr.b,Gr(ma,Oa),Qr[ha+$i]=Vr.a,Qr[Ca+$i]=Vr.b):(qr(Qr[Ma+$i],Qr[ha+$i]),zs=Vr.a,ma=Vr.b,qr(Qr[Ua+$i],Qr[Ca+$i]),Sa=Vr.a,Oa=Vr.b,qr(zs,Sa),Qr[Ma+$i]=Vr.a,Qr[Ua+$i]=Vr.b,qr(ma,Oa),Qr[ha+$i]=Vr.a,Qr[Ca+$i]=Vr.b)}if(ns&Cs){const Ua=Ma+js;Ds?Gr(Qr[Ma+$i],Qr[Ua+$i]):qr(Qr[Ma+$i],Qr[Ua+$i]),zs=Vr.a,Qr[Ua+$i]=Vr.b,Qr[Ma+$i]=zs}}if(ps&Cs){let Ma=Fs;const ya=Fs+ds*(ns-Is);for(;Ma<=ya;Ma+=$s){const Ua=Ma+Xs;Ds?Gr(Qr[Ma+$i],Qr[Ua+$i]):qr(Qr[Ma+$i],Qr[Ua+$i]),zs=Vr.a,Qr[Ua+$i]=Vr.b,Qr[Ma+$i]=zs}}Is=Cs,Cs>>=1}return Fs}function Jr(Qr,$i,ns,ds,ps,ys,Ts,Ds,Ms){let Cs=0,Is=0;const Fs=Ts,Ws=Math.trunc(ds.value+(ps+7)/8);for(;ds.value<Ws;)for(Yr(Cs,Is,ns,ds),Cs=Xr.c,Is=Xr.lc;Is>=14;){const qs=Cs>>Is-14&16383,Xs=$i[qs];if(Xs.len)Is-=Xs.len,Xi(Xs.lit,ys,Cs,Is,ns,ds,Ds,Ms,Fs),Cs=Qi.c,Is=Qi.lc;else{if(!Xs.p)throw new Error("hufDecode issues");let $s;for($s=0;$s<Xs.lit;$s++){const zs=Ur(Qr[Xs.p[$s]]);for(;Is<zs&&ds.value<Ws;)Yr(Cs,Is,ns,ds),Cs=Xr.c,Is=Xr.lc;if(Is>=zs&&Br(Qr[Xs.p[$s]])==(Cs>>Is-zs&(1<<zs)-1)){Is-=zs,Xi(Xs.p[$s],ys,Cs,Is,ns,ds,Ds,Ms,Fs),Cs=Qi.c,Is=Qi.lc;break}}if($s==Xs.lit)throw new Error("hufDecode issues")}}const js=8-ps&7;for(Cs>>=js,Is-=js;Is>0;){const qs=$i[Cs<<14-Is&16383];if(qs.len)Is-=qs.len,Xi(qs.lit,ys,Cs,Is,ns,ds,Ds,Ms,Fs),Cs=Qi.c,Is=Qi.lc;else throw new Error("hufDecode issues")}return!0}function Ji(Qr,$i,ns,ds,ps,ys){const Ts={value:0},Ds=ns.value,Ms=Ps($i,ns),Cs=Ps($i,ns);ns.value+=4;const Is=Ps($i,ns);if(ns.value+=4,Ms<0||Ms>=65537||Cs<0||Cs>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const Fs=new Array(65537),Ws=new Array(16384);Rr(Ws);const js=ds-(ns.value-Ds);if(Nr(Qr,ns,js,Ms,Cs,Fs),Is>8*(ds-(ns.value-Ds)))throw new Error("Something wrong with hufUncompress");Wr(Fs,Ms,Cs,Ws),Jr(Fs,Ws,Qr,ns,Is,Cs,ys,ps,Ts)}function Ki(Qr,$i,ns){for(let ds=0;ds<ns;++ds)$i[ds]=Qr[$i[ds]]}function Zi(Qr){for(let $i=1;$i<Qr.length;$i++){const ns=Qr[$i-1]+Qr[$i]-128;Qr[$i]=ns}}function Zr(Qr,$i){let ns=0,ds=Math.floor((Qr.length+1)/2),ps=0;const ys=Qr.length-1;for(;!(ps>ys||($i[ps++]=Qr[ns++],ps>ys));)$i[ps++]=Qr[ds++]}function is(Qr){let $i=Qr.byteLength;const ns=new Array;let ds=0;const ps=new DataView(Qr);for(;$i>0;){const ys=ps.getInt8(ds++);if(ys<0){const Ts=-ys;$i-=Ts+1;for(let Ds=0;Ds<Ts;Ds++)ns.push(ps.getUint8(ds++))}else{const Ts=ys;$i-=2;const Ds=ps.getUint8(ds++);for(let Ms=0;Ms<Ts+1;Ms++)ns.push(Ds)}}return ns}function os(Qr,$i,ns,ds,ps,ys){let Ts=new DataView(ys.buffer);const Ds=ns[Qr.idx[0]].width,Ms=ns[Qr.idx[0]].height,Cs=3,Is=Math.floor(Ds/8),Fs=Math.ceil(Ds/8),Ws=Math.ceil(Ms/8),js=Ds-(Fs-1)*8,qs=Ms-(Ws-1)*8,Xs={value:0},$s=new Array(Cs),zs=new Array(Cs),Sa=new Array(Cs),ma=new Array(Cs),Oa=new Array(Cs);for(let ya=0;ya<Cs;++ya)Oa[ya]=$i[Qr.idx[ya]],$s[ya]=ya<1?0:$s[ya-1]+Fs*Ws,zs[ya]=new Float32Array(64),Sa[ya]=new Uint16Array(64),ma[ya]=new Uint16Array(Fs*64);for(let ya=0;ya<Ws;++ya){let Ua=8;ya==Ws-1&&(Ua=qs);let ha=8;for(let Ea=0;Ea<Fs;++Ea){Ea==Fs-1&&(ha=js);for(let ba=0;ba<Cs;++ba)Sa[ba].fill(0),Sa[ba][0]=ps[$s[ba]++],cs(Xs,ds,Sa[ba]),ss(Sa[ba],zs[ba]),es(zs[ba]);Cs==3&&ms(zs);for(let ba=0;ba<Cs;++ba)Yi(zs[ba],ma[ba],Ea*64)}let Ca=0;for(let Ea=0;Ea<Cs;++Ea){const ba=ns[Qr.idx[Ea]].type;for(let Va=8*ya;Va<8*ya+Ua;++Va){Ca=Oa[Ea][Va];for(let Ha=0;Ha<Is;++Ha){const Wa=Ha*64+(Va&7)*8;Ts.setUint16(Ca+0*2*ba,ma[Ea][Wa+0],!0),Ts.setUint16(Ca+1*2*ba,ma[Ea][Wa+1],!0),Ts.setUint16(Ca+2*2*ba,ma[Ea][Wa+2],!0),Ts.setUint16(Ca+3*2*ba,ma[Ea][Wa+3],!0),Ts.setUint16(Ca+4*2*ba,ma[Ea][Wa+4],!0),Ts.setUint16(Ca+5*2*ba,ma[Ea][Wa+5],!0),Ts.setUint16(Ca+6*2*ba,ma[Ea][Wa+6],!0),Ts.setUint16(Ca+7*2*ba,ma[Ea][Wa+7],!0),Ca+=8*2*ba}}if(Is!=Fs)for(let Va=8*ya;Va<8*ya+Ua;++Va){const Ha=Oa[Ea][Va]+8*Is*2*ba,Wa=Is*64+(Va&7)*8;for(let Za=0;Za<ha;++Za)Ts.setUint16(Ha+Za*2*ba,ma[Ea][Wa+Za],!0)}}}const Ma=new Uint16Array(Ds);Ts=new DataView(ys.buffer);for(let ya=0;ya<Cs;++ya){ns[Qr.idx[ya]].decoded=!0;const Ua=ns[Qr.idx[ya]].type;if(ns[ya].type==2)for(let ha=0;ha<Ms;++ha){const Ca=Oa[ya][ha];for(let Ea=0;Ea<Ds;++Ea)Ma[Ea]=Ts.getUint16(Ca+Ea*2*Ua,!0);for(let Ea=0;Ea<Ds;++Ea)Ts.setFloat32(Ca+Ea*2*Ua,bs(Ma[Ea]),!0)}}}function cs(Qr,$i,ns){let ds,ps=1;for(;ps<64;)ds=$i[Qr.value],ds==65280?ps=64:ds>>8==255?ps+=ds&255:(ns[ps]=ds,ps++),Qr.value++}function ss(Qr,$i){$i[0]=bs(Qr[0]),$i[1]=bs(Qr[1]),$i[2]=bs(Qr[5]),$i[3]=bs(Qr[6]),$i[4]=bs(Qr[14]),$i[5]=bs(Qr[15]),$i[6]=bs(Qr[27]),$i[7]=bs(Qr[28]),$i[8]=bs(Qr[2]),$i[9]=bs(Qr[4]),$i[10]=bs(Qr[7]),$i[11]=bs(Qr[13]),$i[12]=bs(Qr[16]),$i[13]=bs(Qr[26]),$i[14]=bs(Qr[29]),$i[15]=bs(Qr[42]),$i[16]=bs(Qr[3]),$i[17]=bs(Qr[8]),$i[18]=bs(Qr[12]),$i[19]=bs(Qr[17]),$i[20]=bs(Qr[25]),$i[21]=bs(Qr[30]),$i[22]=bs(Qr[41]),$i[23]=bs(Qr[43]),$i[24]=bs(Qr[9]),$i[25]=bs(Qr[11]),$i[26]=bs(Qr[18]),$i[27]=bs(Qr[24]),$i[28]=bs(Qr[31]),$i[29]=bs(Qr[40]),$i[30]=bs(Qr[44]),$i[31]=bs(Qr[53]),$i[32]=bs(Qr[10]),$i[33]=bs(Qr[19]),$i[34]=bs(Qr[23]),$i[35]=bs(Qr[32]),$i[36]=bs(Qr[39]),$i[37]=bs(Qr[45]),$i[38]=bs(Qr[52]),$i[39]=bs(Qr[54]),$i[40]=bs(Qr[20]),$i[41]=bs(Qr[22]),$i[42]=bs(Qr[33]),$i[43]=bs(Qr[38]),$i[44]=bs(Qr[46]),$i[45]=bs(Qr[51]),$i[46]=bs(Qr[55]),$i[47]=bs(Qr[60]),$i[48]=bs(Qr[21]),$i[49]=bs(Qr[34]),$i[50]=bs(Qr[37]),$i[51]=bs(Qr[47]),$i[52]=bs(Qr[50]),$i[53]=bs(Qr[56]),$i[54]=bs(Qr[59]),$i[55]=bs(Qr[61]),$i[56]=bs(Qr[35]),$i[57]=bs(Qr[36]),$i[58]=bs(Qr[48]),$i[59]=bs(Qr[49]),$i[60]=bs(Qr[57]),$i[61]=bs(Qr[58]),$i[62]=bs(Qr[62]),$i[63]=bs(Qr[63])}function es(Qr){const $i=.5*Math.cos(.7853975),ns=.5*Math.cos(3.14159/16),ds=.5*Math.cos(3.14159/8),ps=.5*Math.cos(3*3.14159/16),ys=.5*Math.cos(5*3.14159/16),Ts=.5*Math.cos(3*3.14159/8),Ds=.5*Math.cos(7*3.14159/16),Ms=new Array(4),Cs=new Array(4),Is=new Array(4),Fs=new Array(4);for(let Ws=0;Ws<8;++Ws){const js=Ws*8;Ms[0]=ds*Qr[js+2],Ms[1]=Ts*Qr[js+2],Ms[2]=ds*Qr[js+6],Ms[3]=Ts*Qr[js+6],Cs[0]=ns*Qr[js+1]+ps*Qr[js+3]+ys*Qr[js+5]+Ds*Qr[js+7],Cs[1]=ps*Qr[js+1]-Ds*Qr[js+3]-ns*Qr[js+5]-ys*Qr[js+7],Cs[2]=ys*Qr[js+1]-ns*Qr[js+3]+Ds*Qr[js+5]+ps*Qr[js+7],Cs[3]=Ds*Qr[js+1]-ys*Qr[js+3]+ps*Qr[js+5]-ns*Qr[js+7],Is[0]=$i*(Qr[js+0]+Qr[js+4]),Is[3]=$i*(Qr[js+0]-Qr[js+4]),Is[1]=Ms[0]+Ms[3],Is[2]=Ms[1]-Ms[2],Fs[0]=Is[0]+Is[1],Fs[1]=Is[3]+Is[2],Fs[2]=Is[3]-Is[2],Fs[3]=Is[0]-Is[1],Qr[js+0]=Fs[0]+Cs[0],Qr[js+1]=Fs[1]+Cs[1],Qr[js+2]=Fs[2]+Cs[2],Qr[js+3]=Fs[3]+Cs[3],Qr[js+4]=Fs[3]-Cs[3],Qr[js+5]=Fs[2]-Cs[2],Qr[js+6]=Fs[1]-Cs[1],Qr[js+7]=Fs[0]-Cs[0]}for(let Ws=0;Ws<8;++Ws)Ms[0]=ds*Qr[16+Ws],Ms[1]=Ts*Qr[16+Ws],Ms[2]=ds*Qr[48+Ws],Ms[3]=Ts*Qr[48+Ws],Cs[0]=ns*Qr[8+Ws]+ps*Qr[24+Ws]+ys*Qr[40+Ws]+Ds*Qr[56+Ws],Cs[1]=ps*Qr[8+Ws]-Ds*Qr[24+Ws]-ns*Qr[40+Ws]-ys*Qr[56+Ws],Cs[2]=ys*Qr[8+Ws]-ns*Qr[24+Ws]+Ds*Qr[40+Ws]+ps*Qr[56+Ws],Cs[3]=Ds*Qr[8+Ws]-ys*Qr[24+Ws]+ps*Qr[40+Ws]-ns*Qr[56+Ws],Is[0]=$i*(Qr[Ws]+Qr[32+Ws]),Is[3]=$i*(Qr[Ws]-Qr[32+Ws]),Is[1]=Ms[0]+Ms[3],Is[2]=Ms[1]-Ms[2],Fs[0]=Is[0]+Is[1],Fs[1]=Is[3]+Is[2],Fs[2]=Is[3]-Is[2],Fs[3]=Is[0]-Is[1],Qr[0+Ws]=Fs[0]+Cs[0],Qr[8+Ws]=Fs[1]+Cs[1],Qr[16+Ws]=Fs[2]+Cs[2],Qr[24+Ws]=Fs[3]+Cs[3],Qr[32+Ws]=Fs[3]-Cs[3],Qr[40+Ws]=Fs[2]-Cs[2],Qr[48+Ws]=Fs[1]-Cs[1],Qr[56+Ws]=Fs[0]-Cs[0]}function ms(Qr){for(let $i=0;$i<64;++$i){const ns=Qr[0][$i],ds=Qr[1][$i],ps=Qr[2][$i];Qr[0][$i]=ns+1.5747*ps,Qr[1][$i]=ns-.1873*ds-.4682*ps,Qr[2][$i]=ns+1.8556*ds}}function Yi(Qr,$i,ns){for(let ds=0;ds<64;++ds)$i[ns+ds]=DataUtils.toHalfFloat(Gi(Qr[ds]))}function Gi(Qr){return Qr<=1?Math.sign(Qr)*Math.pow(Math.abs(Qr),2.2):Math.sign(Qr)*Math.pow(Cr,Math.abs(Qr)-1)}function Ni(Qr){return new DataView(Qr.array.buffer,Qr.offset.value,Qr.size)}function Ri(Qr){const $i=Qr.viewer.buffer.slice(Qr.offset.value,Qr.offset.value+Qr.size),ns=new Uint8Array(is($i)),ds=new Uint8Array(ns.length);return Zi(ns),Zr(ns,ds),new DataView(ds.buffer)}function qi(Qr){const $i=Qr.array.slice(Qr.offset.value,Qr.offset.value+Qr.size),ns=unzlibSync($i),ds=new Uint8Array(ns.length);return Zi(ns),Zr(ns,ds),new DataView(ds.buffer)}function as(Qr){const $i=Qr.viewer,ns={value:Qr.offset.value},ds=new Uint16Array(Qr.columns*Qr.lines*(Qr.inputChannels.length*Qr.type)),ps=new Uint8Array(8192);let ys=0;const Ts=new Array(Qr.inputChannels.length);for(let qs=0,Xs=Qr.inputChannels.length;qs<Xs;qs++)Ts[qs]={},Ts[qs].start=ys,Ts[qs].end=Ts[qs].start,Ts[qs].nx=Qr.columns,Ts[qs].ny=Qr.lines,Ts[qs].size=Qr.type,ys+=Ts[qs].nx*Ts[qs].ny*Ts[qs].size;const Ds=Ss($i,ns),Ms=Ss($i,ns);if(Ms>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(Ds<=Ms)for(let qs=0;qs<Ms-Ds+1;qs++)ps[qs+Ds]=Vs($i,ns);const Cs=new Uint16Array(65536),Is=Ir(ps,Cs),Fs=Ps($i,ns);Ji(Qr.array,$i,ns,Fs,ds,ys);for(let qs=0;qs<Qr.inputChannels.length;++qs){const Xs=Ts[qs];for(let $s=0;$s<Ts[qs].size;++$s)ji(ds,Xs.start+$s,Xs.nx,Xs.size,Xs.ny,Xs.nx*Xs.size,Is)}Ki(Cs,ds,ys);let Ws=0;const js=new Uint8Array(ds.buffer.byteLength);for(let qs=0;qs<Qr.lines;qs++)for(let Xs=0;Xs<Qr.inputChannels.length;Xs++){const $s=Ts[Xs],zs=$s.nx*$s.size,Sa=new Uint8Array(ds.buffer,$s.end*2,zs*2);js.set(Sa,Ws),Ws+=zs*2,$s.end+=zs}return new DataView(js.buffer)}function us(Qr){const $i=Qr.array.slice(Qr.offset.value,Qr.offset.value+Qr.size),ns=unzlibSync($i),ds=Qr.inputChannels.length*Qr.lines*Qr.columns*Qr.totalBytes,ps=new ArrayBuffer(ds),ys=new DataView(ps);let Ts=0,Ds=0;const Ms=new Array(4);for(let Cs=0;Cs<Qr.lines;Cs++)for(let Is=0;Is<Qr.inputChannels.length;Is++){let Fs=0;switch(Qr.inputChannels[Is].pixelType){case 1:Ms[0]=Ts,Ms[1]=Ms[0]+Qr.columns,Ts=Ms[1]+Qr.columns;for(let js=0;js<Qr.columns;++js){const qs=ns[Ms[0]++]<<8|ns[Ms[1]++];Fs+=qs,ys.setUint16(Ds,Fs,!0),Ds+=2}break;case 2:Ms[0]=Ts,Ms[1]=Ms[0]+Qr.columns,Ms[2]=Ms[1]+Qr.columns,Ts=Ms[2]+Qr.columns;for(let js=0;js<Qr.columns;++js){const qs=ns[Ms[0]++]<<24|ns[Ms[1]++]<<16|ns[Ms[2]++]<<8;Fs+=qs,ys.setUint32(Ds,Fs,!0),Ds+=4}break}}return ys}function gs(Qr){const $i=Qr.viewer,ns={value:Qr.offset.value},ds=new Uint8Array(Qr.columns*Qr.lines*(Qr.inputChannels.length*Qr.type*2)),ps={version:Us($i,ns),unknownUncompressedSize:Us($i,ns),unknownCompressedSize:Us($i,ns),acCompressedSize:Us($i,ns),dcCompressedSize:Us($i,ns),rleCompressedSize:Us($i,ns),rleUncompressedSize:Us($i,ns),rleRawSize:Us($i,ns),totalAcUncompressedCount:Us($i,ns),totalDcUncompressedCount:Us($i,ns),acCompression:Us($i,ns)};if(ps.version<2)throw new Error("EXRLoader.parse: "+qa.compression+" version "+ps.version+" is unsupported");const ys=new Array;let Ts=Ss($i,ns)-2;for(;Ts>0;){const Xs=vs($i.buffer,ns),$s=Vs($i,ns),zs=$s>>2&3,Sa=($s>>4)-1,ma=new Int8Array([Sa])[0],Oa=Vs($i,ns);ys.push({name:Xs,index:ma,type:Oa,compression:zs}),Ts-=Xs.length+3}const Ds=qa.channels,Ms=new Array(Qr.inputChannels.length);for(let Xs=0;Xs<Qr.inputChannels.length;++Xs){const $s=Ms[Xs]={},zs=Ds[Xs];$s.name=zs.name,$s.compression=0,$s.decoded=!1,$s.type=zs.pixelType,$s.pLinear=zs.pLinear,$s.width=Qr.columns,$s.height=Qr.lines}const Cs={idx:new Array(3)};for(let Xs=0;Xs<Qr.inputChannels.length;++Xs){const $s=Ms[Xs];for(let zs=0;zs<ys.length;++zs){const Sa=ys[zs];$s.name==Sa.name&&($s.compression=Sa.compression,Sa.index>=0&&(Cs.idx[Sa.index]=Xs),$s.offset=Xs)}}let Is,Fs,Ws;if(ps.acCompressedSize>0)switch(ps.acCompression){case 0:Is=new Uint16Array(ps.totalAcUncompressedCount),Ji(Qr.array,$i,ns,ps.acCompressedSize,Is,ps.totalAcUncompressedCount);break;case 1:const Xs=Qr.array.slice(ns.value,ns.value+ps.totalAcUncompressedCount),$s=unzlibSync(Xs);Is=new Uint16Array($s.buffer),ns.value+=ps.totalAcUncompressedCount;break}if(ps.dcCompressedSize>0){const Xs={array:Qr.array,offset:ns,size:ps.dcCompressedSize};Fs=new Uint16Array(qi(Xs).buffer),ns.value+=ps.dcCompressedSize}if(ps.rleRawSize>0){const Xs=Qr.array.slice(ns.value,ns.value+ps.rleCompressedSize),$s=unzlibSync(Xs);Ws=is($s.buffer),ns.value+=ps.rleCompressedSize}let js=0;const qs=new Array(Ms.length);for(let Xs=0;Xs<qs.length;++Xs)qs[Xs]=new Array;for(let Xs=0;Xs<Qr.lines;++Xs)for(let $s=0;$s<Ms.length;++$s)qs[$s].push(js),js+=Ms[$s].width*Qr.type*2;os(Cs,qs,Ms,Is,Fs,ds);for(let Xs=0;Xs<Ms.length;++Xs){const $s=Ms[Xs];if(!$s.decoded)switch($s.compression){case 2:let zs=0,Sa=0;for(let ma=0;ma<Qr.lines;++ma){let Oa=qs[Xs][zs];for(let Ma=0;Ma<$s.width;++Ma){for(let ya=0;ya<2*$s.type;++ya)ds[Oa++]=Ws[Sa+ya*$s.width*$s.height];Sa++}zs++}break;case 1:default:throw new Error("EXRLoader.parse: unsupported channel compression")}}return new DataView(ds.buffer)}function vs(Qr,$i){const ns=new Uint8Array(Qr);let ds=0;for(;ns[$i.value+ds]!=0;)ds+=1;const ps=new TextDecoder().decode(ns.slice($i.value,$i.value+ds));return $i.value=$i.value+ds+1,ps}function _s(Qr,$i,ns){const ds=new TextDecoder().decode(new Uint8Array(Qr).slice($i.value,$i.value+ns));return $i.value=$i.value+ns,ds}function As(Qr,$i){const ns=Es(Qr,$i),ds=Ps(Qr,$i);return[ns,ds]}function xs(Qr,$i){const ns=Ps(Qr,$i),ds=Ps(Qr,$i);return[ns,ds]}function Es(Qr,$i){const ns=Qr.getInt32($i.value,!0);return $i.value=$i.value+4,ns}function Ps(Qr,$i){const ns=Qr.getUint32($i.value,!0);return $i.value=$i.value+4,ns}function Ns(Qr,$i){const ns=Qr[$i.value];return $i.value=$i.value+1,ns}function Vs(Qr,$i){const ns=Qr.getUint8($i.value);return $i.value=$i.value+1,ns}const Us=function(Qr,$i){let ns;return"getBigInt64"in DataView.prototype?ns=Number(Qr.getBigInt64($i.value,!0)):ns=Qr.getUint32($i.value+4,!0)+Number(Qr.getUint32($i.value,!0)<<32),$i.value+=8,ns};function Os(Qr,$i){const ns=Qr.getFloat32($i.value,!0);return $i.value+=4,ns}function ws(Qr,$i){return DataUtils.toHalfFloat(Os(Qr,$i))}function bs(Qr){const $i=(Qr&31744)>>10,ns=Qr&1023;return(Qr>>15?-1:1)*($i?$i===31?ns?NaN:1/0:Math.pow(2,$i-15)*(1+ns/1024):6103515625e-14*(ns/1024))}function Ss(Qr,$i){const ns=Qr.getUint16($i.value,!0);return $i.value+=2,ns}function Rs(Qr,$i){return bs(Ss(Qr,$i))}function Hs(Qr,$i,ns,ds){const ps=ns.value,ys=[];for(;ns.value<ps+ds-1;){const Ts=vs($i,ns),Ds=Es(Qr,ns),Ms=Vs(Qr,ns);ns.value+=3;const Cs=Es(Qr,ns),Is=Es(Qr,ns);ys.push({name:Ts,pixelType:Ds,pLinear:Ms,xSampling:Cs,ySampling:Is})}return ns.value+=1,ys}function ks(Qr,$i){const ns=Os(Qr,$i),ds=Os(Qr,$i),ps=Os(Qr,$i),ys=Os(Qr,$i),Ts=Os(Qr,$i),Ds=Os(Qr,$i),Ms=Os(Qr,$i),Cs=Os(Qr,$i);return{redX:ns,redY:ds,greenX:ps,greenY:ys,blueX:Ts,blueY:Ds,whiteX:Ms,whiteY:Cs}}function na(Qr,$i){const ns=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],ds=Vs(Qr,$i);return ns[ds]}function xa(Qr,$i){const ns=Es(Qr,$i),ds=Es(Qr,$i),ps=Es(Qr,$i),ys=Es(Qr,$i);return{xMin:ns,yMin:ds,xMax:ps,yMax:ys}}function fa(Qr,$i){const ns=["INCREASING_Y","DECREASING_Y","RANDOM_Y"],ds=Vs(Qr,$i);return ns[ds]}function Gs(Qr,$i){const ns=["ENVMAP_LATLONG","ENVMAP_CUBE"],ds=Vs(Qr,$i);return ns[ds]}function Zs(Qr,$i){const ns=["ONE_LEVEL","MIPMAP_LEVELS","RIPMAP_LEVELS"],ds=["ROUND_DOWN","ROUND_UP"],ps=Ps(Qr,$i),ys=Ps(Qr,$i),Ts=Vs(Qr,$i);return{xSize:ps,ySize:ys,levelMode:ns[Ts&15],roundingMode:ds[Ts>>4]}}function Ys(Qr,$i){const ns=Os(Qr,$i),ds=Os(Qr,$i);return[ns,ds]}function Js(Qr,$i){const ns=Os(Qr,$i),ds=Os(Qr,$i),ps=Os(Qr,$i);return[ns,ds,ps]}function aa(Qr,$i,ns,ds,ps){if(ds==="string"||ds==="stringvector"||ds==="iccProfile")return _s($i,ns,ps);if(ds==="chlist")return Hs(Qr,$i,ns,ps);if(ds==="chromaticities")return ks(Qr,ns);if(ds==="compression")return na(Qr,ns);if(ds==="box2i")return xa(Qr,ns);if(ds==="envmap")return Gs(Qr,ns);if(ds==="tiledesc")return Zs(Qr,ns);if(ds==="lineOrder")return fa(Qr,ns);if(ds==="float")return Os(Qr,ns);if(ds==="v2f")return Ys(Qr,ns);if(ds==="v3f")return Js(Qr,ns);if(ds==="int")return Es(Qr,ns);if(ds==="rational")return As(Qr,ns);if(ds==="timecode")return xs(Qr,ns);if(ds==="preview")return ns.value+=ps,"skipped";ns.value+=ps}function Ta(Qr,$i){const ns=Math.log2(Qr);return $i=="ROUND_DOWN"?Math.floor(ns):Math.ceil(ns)}function za(Qr,$i,ns){let ds=0;switch(Qr.levelMode){case"ONE_LEVEL":ds=1;break;case"MIPMAP_LEVELS":ds=Ta(Math.max($i,ns),Qr.roundingMode)+1;break;case"RIPMAP_LEVELS":throw new Error("THREE.EXRLoader: RIPMAP_LEVELS tiles currently unsupported.")}return ds}function Ga(Qr,$i,ns,ds){const ps=new Array(Qr);for(let ys=0;ys<Qr;ys++){const Ts=1<<ys;let Ds=$i/Ts|0;ds=="ROUND_UP"&&Ds*Ts<$i&&(Ds+=1);const Ms=Math.max(Ds,1);ps[ys]=(Ms+ns-1)/ns|0}return ps}function Qa(){const Qr=this,$i=Qr.offset,ns={value:0};for(let ds=0;ds<Qr.tileCount;ds++){const ps=Es(Qr.viewer,$i),ys=Es(Qr.viewer,$i);$i.value+=8,Qr.size=Ps(Qr.viewer,$i);const Ts=ps*Qr.blockWidth,Ds=ys*Qr.blockHeight;Qr.columns=Ts+Qr.blockWidth>Qr.width?Qr.width-Ts:Qr.blockWidth,Qr.lines=Ds+Qr.blockHeight>Qr.height?Qr.height-Ds:Qr.blockHeight;const Ms=Qr.columns*Qr.totalBytes,Is=Qr.size<Qr.lines*Ms?Qr.uncompress(Qr):Ni(Qr);$i.value+=Qr.size;for(let Fs=0;Fs<Qr.lines;Fs++){const Ws=Fs*Qr.columns*Qr.totalBytes;for(let js=0;js<Qr.inputChannels.length;js++){const qs=qa.channels[js].name,Xs=Qr.channelByteOffsets[qs]*Qr.columns,$s=Qr.decodeChannels[qs];if($s===void 0)continue;ns.value=Ws+Xs;const zs=(Qr.height-(1+Ds+Fs))*Qr.outLineWidth;for(let Sa=0;Sa<Qr.columns;Sa++){const ma=zs+(Sa+Ts)*Qr.outputChannels+$s;Qr.byteArray[ma]=Qr.getter(Is,ns)}}}}}function $a(){const Qr=this,$i=Qr.offset,ns={value:0};for(let ds=0;ds<Qr.height/Qr.blockHeight;ds++){const ps=Es(Qr.viewer,$i)-qa.dataWindow.yMin;Qr.size=Ps(Qr.viewer,$i),Qr.lines=ps+Qr.blockHeight>Qr.height?Qr.height-ps:Qr.blockHeight;const ys=Qr.columns*Qr.totalBytes,Ds=Qr.size<Qr.lines*ys?Qr.uncompress(Qr):Ni(Qr);$i.value+=Qr.size;for(let Ms=0;Ms<Qr.blockHeight;Ms++){const Cs=ds*Qr.blockHeight,Is=Ms+Qr.scanOrder(Cs);if(Is>=Qr.height)continue;const Fs=Ms*ys,Ws=(Qr.height-1-Is)*Qr.outLineWidth;for(let js=0;js<Qr.inputChannels.length;js++){const qs=qa.channels[js].name,Xs=Qr.channelByteOffsets[qs]*Qr.columns,$s=Qr.decodeChannels[qs];if($s!==void 0){ns.value=Fs+Xs;for(let zs=0;zs<Qr.columns;zs++){const Sa=Ws+zs*Qr.outputChannels+$s;Qr.byteArray[Sa]=Qr.getter(Ds,ns)}}}}}}function Ya(Qr,$i,ns){const ds={};if(Qr.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: Provided file doesn't appear to be in OpenEXR format.");ds.version=Qr.getUint8(4);const ps=Qr.getUint8(5);ds.spec={singleTile:!!(ps&2),longName:!!(ps&4),deepFormat:!!(ps&8),multiPart:!!(ps&16)},ns.value=8;let ys=!0;for(;ys;){const Ts=vs($i,ns);if(Ts==0)ys=!1;else{const Ds=vs($i,ns),Ms=Ps(Qr,ns),Cs=aa(Qr,$i,ns,Ds,Ms);Cs===void 0?console.warn(`THREE.EXRLoader: Skipped unknown header attribute type '${Ds}'.`):ds[Ts]=Cs}}if(ps&-7)throw console.error("THREE.EXRHeader:",ds),new Error("THREE.EXRLoader: Provided file is currently unsupported.");return ds}function Xa(Qr,$i,ns,ds,ps){const ys={size:0,viewer:$i,array:ns,offset:ds,width:Qr.dataWindow.xMax-Qr.dataWindow.xMin+1,height:Qr.dataWindow.yMax-Qr.dataWindow.yMin+1,inputChannels:Qr.channels,channelByteOffsets:{},scanOrder:null,totalBytes:null,columns:null,lines:null,type:null,uncompress:null,getter:null,format:null,colorSpace:LinearSRGBColorSpace};switch(Qr.compression){case"NO_COMPRESSION":ys.blockHeight=1,ys.uncompress=Ni;break;case"RLE_COMPRESSION":ys.blockHeight=1,ys.uncompress=Ri;break;case"ZIPS_COMPRESSION":ys.blockHeight=1,ys.uncompress=qi;break;case"ZIP_COMPRESSION":ys.blockHeight=16,ys.uncompress=qi;break;case"PIZ_COMPRESSION":ys.blockHeight=32,ys.uncompress=as;break;case"PXR24_COMPRESSION":ys.blockHeight=16,ys.uncompress=us;break;case"DWAA_COMPRESSION":ys.blockHeight=32,ys.uncompress=gs;break;case"DWAB_COMPRESSION":ys.blockHeight=256,ys.uncompress=gs;break;default:throw new Error("EXRLoader.parse: "+Qr.compression+" is unsupported")}const Ts={};for(const Is of Qr.channels)switch(Is.name){case"Y":case"R":case"G":case"B":case"A":Ts[Is.name]=!0,ys.type=Is.pixelType}let Ds=!1;if(Ts.R&&Ts.G&&Ts.B)Ds=!Ts.A,ys.outputChannels=4,ys.decodeChannels={R:0,G:1,B:2,A:3};else if(Ts.Y)ys.outputChannels=1,ys.decodeChannels={Y:0};else throw new Error("EXRLoader.parse: file contains unsupported data channels.");if(ys.type==1)switch(ps){case FloatType:ys.getter=Rs;break;case HalfFloatType:ys.getter=Ss;break}else if(ys.type==2)switch(ps){case FloatType:ys.getter=Os;break;case HalfFloatType:ys.getter=ws}else throw new Error("EXRLoader.parse: unsupported pixelType "+ys.type+" for "+Qr.compression+".");ys.columns=ys.width;const Ms=ys.width*ys.height*ys.outputChannels;switch(ps){case FloatType:ys.byteArray=new Float32Array(Ms),Ds&&ys.byteArray.fill(1,0,Ms);break;case HalfFloatType:ys.byteArray=new Uint16Array(Ms),Ds&&ys.byteArray.fill(15360,0,Ms);break;default:console.error("THREE.EXRLoader: unsupported type: ",ps);break}let Cs=0;for(const Is of Qr.channels)ys.decodeChannels[Is.name]!==void 0&&(ys.channelByteOffsets[Is.name]=Cs),Cs+=Is.pixelType*2;if(ys.totalBytes=Cs,ys.outLineWidth=ys.width*ys.outputChannels,Qr.lineOrder==="INCREASING_Y"?ys.scanOrder=Is=>Is:ys.scanOrder=Is=>ys.height-1-Is,ys.outputChannels==4?(ys.format=RGBAFormat,ys.colorSpace=LinearSRGBColorSpace):(ys.format=RedFormat,ys.colorSpace=NoColorSpace),Qr.spec.singleTile){ys.blockHeight=Qr.tiles.ySize,ys.blockWidth=Qr.tiles.xSize;const Is=za(Qr.tiles,ys.width,ys.height),Fs=Ga(Is,ys.width,Qr.tiles.xSize,Qr.tiles.roundingMode),Ws=Ga(Is,ys.height,Qr.tiles.ySize,Qr.tiles.roundingMode);ys.tileCount=Fs[0]*Ws[0];for(let js=0;js<Is;js++)for(let qs=0;qs<Ws[js];qs++)for(let Xs=0;Xs<Fs[js];Xs++)Us($i,ds);ys.decode=Qa.bind(ys)}else{ys.blockWidth=ys.width;const Is=Math.ceil(ys.height/ys.blockHeight);for(let Fs=0;Fs<Is;Fs++)Us($i,ds);ys.decode=$a.bind(ys)}return ys}const eo={value:0},to=new DataView(er),no=new Uint8Array(er),qa=Ya(to,er,eo),Ka=Xa(qa,to,no,eo,this.type);return Ka.decode(),{header:qa,width:Ka.width,height:Ka.height,data:Ka.byteArray,format:Ka.format,colorSpace:Ka.colorSpace,type:this.type}}setDataType(er){return this.type=er,this}load(er,tr,ir,nr){function sr(ar,or){ar.colorSpace=or.colorSpace,ar.minFilter=LinearFilter,ar.magFilter=LinearFilter,ar.generateMipmaps=!1,ar.flipY=!1,tr&&tr(ar,or)}return super.load(er,sr,ir,nr)}}const _taskCache$2=new WeakMap;class Rhino3dmLoader extends Loader{constructor(er){super(er),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(er){return this.libraryPath=er,this}setWorkerLimit(er){return this.workerLimit=er,this}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("arraybuffer"),sr.setRequestHeader(this.requestHeader),this.url=er,sr.load(er,ar=>{if(_taskCache$2.has(ar))return _taskCache$2.get(ar).promise.then(tr).catch(nr);this.decodeObjects(ar,er).then(or=>{or.userData.warnings=this.warnings,tr(or)}).catch(or=>nr(or))},ir,nr)}debug(){console.log("Task load: ",this.workerPool.map(er=>er._taskLoad))}decodeObjects(er,tr){let ir,nr;const sr=er.byteLength,ar=this._getWorker(sr).then(or=>(ir=or,nr=this.workerNextTaskID++,new Promise((lr,cr)=>{ir._callbacks[nr]={resolve:lr,reject:cr},ir.postMessage({type:"decode",id:nr,buffer:er},[er])}))).then(or=>this._createGeometry(or.data)).catch(or=>{throw or});return ar.catch(()=>!0).then(()=>{ir&&nr&&this._releaseTask(ir,nr)}),_taskCache$2.set(er,{url:tr,promise:ar}),ar}parse(er,tr,ir){this.decodeObjects(er,"").then(nr=>{nr.userData.warnings=this.warnings,tr(nr)}).catch(nr=>ir(nr))}_compareMaterials(er){const tr={};tr.name=er.name,tr.color={},tr.color.r=er.color.r,tr.color.g=er.color.g,tr.color.b=er.color.b,tr.type=er.type,tr.vertexColors=er.vertexColors;const ir=JSON.stringify(tr);for(let nr=0;nr<this.materials.length;nr++){const sr=this.materials[nr],ar={};if(ar.name=sr.name,ar.color={},ar.color.r=sr.color.r,ar.color.g=sr.color.g,ar.color.b=sr.color.b,ar.type=sr.type,ar.vertexColors=sr.vertexColors,JSON.stringify(ar)===ir)return sr}return this.materials.push(er),er}_createMaterial(er,tr){if(er===void 0)return new MeshStandardMaterial({color:new Color(1,1,1),metalness:.8,name:Loader.DEFAULT_MATERIAL_NAME,side:DoubleSide});const ir=new MeshPhysicalMaterial({color:new Color(er.diffuseColor.r/255,er.diffuseColor.g/255,er.diffuseColor.b/255),emissive:new Color(er.emissionColor.r,er.emissionColor.g,er.emissionColor.b),flatShading:er.disableLighting,ior:er.indexOfRefraction,name:er.name,reflectivity:er.reflectivity,opacity:1-er.transparency,side:DoubleSide,specularColor:er.specularColor,transparent:er.transparency>0});if(ir.userData.id=er.id,er.pbrSupported){const sr=er.pbr;ir.anisotropy=sr.anisotropic,ir.anisotropyRotation=sr.anisotropicRotation,ir.color=new Color(sr.baseColor.r,sr.baseColor.g,sr.baseColor.b),ir.clearcoat=sr.clearcoat,ir.clearcoatRoughness=sr.clearcoatRoughness,ir.metalness=sr.metallic,ir.transmission=1-sr.opacity,ir.roughness=sr.roughness,ir.sheen=sr.sheen,ir.specularIntensity=sr.specular,ir.thickness=sr.subsurface}er.pbrSupported&&er.pbr.opacity===0&&er.transparency===1&&(ir.opacity=.2,ir.transmission=1);const nr=new TextureLoader;for(let sr=0;sr<er.textures.length;sr++){const ar=er.textures[sr];if(ar.image!==null){const or=nr.load(ar.image);switch(ar.type){case"Bump":ir.bumpMap=or;break;case"Diffuse":ir.map=or;break;case"Emap":ir.envMap=or;break;case"Opacity":ir.transmissionMap=or;break;case"Transparency":ir.alphaMap=or,ir.transparent=!0;break;case"PBR_Alpha":ir.alphaMap=or,ir.transparent=!0;break;case"PBR_AmbientOcclusion":ir.aoMap=or;break;case"PBR_Anisotropic":ir.anisotropyMap=or;break;case"PBR_BaseColor":ir.map=or;break;case"PBR_Clearcoat":ir.clearcoatMap=or;break;case"PBR_ClearcoatBump":ir.clearcoatNormalMap=or;break;case"PBR_ClearcoatRoughness":ir.clearcoatRoughnessMap=or;break;case"PBR_Displacement":ir.displacementMap=or;break;case"PBR_Emission":ir.emissiveMap=or;break;case"PBR_Metallic":ir.metalnessMap=or;break;case"PBR_Roughness":ir.roughnessMap=or;break;case"PBR_Sheen":ir.sheenColorMap=or;break;case"PBR_Specular":ir.specularColorMap=or;break;case"PBR_Subsurface":ir.thicknessMap=or;break;default:this.warnings.push({message:`THREE.3DMLoader: No conversion exists for 3dm ${ar.type}.`,type:"no conversion"});break}or.wrapS=ar.wrapU===0?RepeatWrapping:ClampToEdgeWrapping,or.wrapT=ar.wrapV===0?RepeatWrapping:ClampToEdgeWrapping,ar.repeat&&or.repeat.set(ar.repeat[0],ar.repeat[1])}}return tr&&new EXRLoader().load(tr.image,function(sr){sr.mapping=THREE.EquirectangularReflectionMapping,ir.envMap=sr}),ir}_createGeometry(er){const tr=new Object3D,ir=[],nr=[],sr=[];tr.userData.layers=er.layers,tr.userData.groups=er.groups,tr.userData.settings=er.settings,tr.userData.settings.renderSettings=er.renderSettings,tr.userData.objectType="File3dm",tr.userData.materials=null,tr.name=this.url;let ar=er.objects;const or=er.materials;for(let lr=0;lr<ar.length;lr++){const cr=ar[lr],ur=cr.attributes;switch(cr.objectType){case"InstanceDefinition":nr.push(cr);break;case"InstanceReference":sr.push(cr);break;default:let dr=null;switch(ur.materialSource.name){case"ObjectMaterialSource_MaterialFromLayer":ur.layerIndex>=0&&(dr=er.layers[ur.layerIndex].renderMaterialIndex);break;case"ObjectMaterialSource_MaterialFromObject":ur.materialIndex>=0&&(dr=ur.materialIndex);break}let hr=null;if(dr>=0){const vr=or[dr];hr=this._createMaterial(vr,er.renderEnvironment)}const pr=this._createObject(cr,hr);if(pr===void 0)continue;const gr=er.layers[ur.layerIndex];pr.visible=gr?er.layers[ur.layerIndex].visible:!0,ur.isInstanceDefinitionObject?ir.push(pr):tr.add(pr);break}}for(let lr=0;lr<nr.length;lr++){const cr=nr[lr];ar=[];for(let ur=0;ur<cr.attributes.objectIds.length;ur++){const dr=cr.attributes.objectIds[ur];for(let hr=0;hr<ir.length;hr++){const pr=ir[hr].userData.attributes.id;dr===pr&&ar.push(ir[hr])}}for(let ur=0;ur<sr.length;ur++){const dr=sr[ur];if(dr.geometry.parentIdefId===cr.attributes.id){const hr=new Object3D,pr=dr.geometry.xform.array,gr=new Matrix4;gr.set(...pr),hr.applyMatrix4(gr);for(let vr=0;vr<ar.length;vr++)hr.add(ar[vr].clone(!0));tr.add(hr)}}}return tr.userData.materials=this.materials,tr.name="",tr}_createObject(er,tr){const ir=new BufferGeometryLoader,nr=er.attributes;let sr,ar,or,lr;switch(er.objectType){case"Point":case"PointSet":sr=ir.parse(er.geometry),sr.attributes.hasOwnProperty("color")?ar=new PointsMaterial({vertexColors:!0,sizeAttenuation:!1,size:2}):(or=nr.drawColor,lr=new Color(or.r/255,or.g/255,or.b/255),ar=new PointsMaterial({color:lr,sizeAttenuation:!1,size:2})),ar=this._compareMaterials(ar);const cr=new Points(sr,ar);return cr.userData.attributes=nr,cr.userData.objectType=er.objectType,nr.name&&(cr.name=nr.name),cr;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(er.geometry===null)return;sr=ir.parse(er.geometry),tr===null&&(tr=this._createMaterial()),sr.attributes.hasOwnProperty("color")&&(tr.vertexColors=!0),tr=this._compareMaterials(tr);const ur=new Mesh(sr,tr);return ur.castShadow=nr.castsShadows,ur.receiveShadow=nr.receivesShadows,ur.userData.attributes=nr,ur.userData.objectType=er.objectType,nr.name&&(ur.name=nr.name),ur;case"Curve":sr=ir.parse(er.geometry),or=nr.drawColor,lr=new Color(or.r/255,or.g/255,or.b/255),ar=new LineBasicMaterial({color:lr}),ar=this._compareMaterials(ar);const dr=new Line(sr,ar);return dr.userData.attributes=nr,dr.userData.objectType=er.objectType,nr.name&&(dr.name=nr.name),dr;case"TextDot":sr=er.geometry;const hr=document.createElement("canvas").getContext("2d"),pr=`${sr.fontHeight}px ${sr.fontFace}`;hr.font=pr;const gr=hr.measureText(sr.text).width+10,vr=sr.fontHeight+10,mr=window.devicePixelRatio;hr.canvas.width=gr*mr,hr.canvas.height=vr*mr,hr.canvas.style.width=gr+"px",hr.canvas.style.height=vr+"px",hr.setTransform(mr,0,0,mr,0,0),hr.font=pr,hr.textBaseline="middle",hr.textAlign="center",lr=nr.drawColor,hr.fillStyle=`rgba(${lr.r},${lr.g},${lr.b},${lr.a})`,hr.fillRect(0,0,gr,vr),hr.fillStyle="white",hr.fillText(sr.text,gr/2,vr/2);const fr=new CanvasTexture(hr.canvas);fr.minFilter=LinearFilter,fr.generateMipmaps=!1,fr.wrapS=ClampToEdgeWrapping,fr.wrapT=ClampToEdgeWrapping,ar=new SpriteMaterial({map:fr,depthTest:!1});const _r=new Sprite(ar);return _r.position.set(sr.point[0],sr.point[1],sr.point[2]),_r.scale.set(gr/10,vr/10,1),_r.userData.attributes=nr,_r.userData.objectType=er.objectType,nr.name&&(_r.name=nr.name),_r;case"Light":sr=er.geometry;let Ar;switch(sr.lightStyle.name){case"LightStyle_WorldPoint":Ar=new PointLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":Ar=new SpotLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.target.position.set(sr.direction[0],sr.direction[1],sr.direction[2]),Ar.angle=sr.spotAngleRadians,Ar.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":Ar=new RectAreaLight;const yr=Math.abs(sr.width[2]),wr=Math.abs(sr.length[0]);Ar.position.set(sr.location[0]-wr/2,sr.location[1],sr.location[2]-yr/2),Ar.height=wr,Ar.width=yr,Ar.lookAt(sr.direction[0],sr.direction[1],sr.direction[2]);break;case"LightStyle_WorldDirectional":Ar=new DirectionalLight,Ar.castShadow=nr.castsShadows,Ar.position.set(sr.location[0],sr.location[1],sr.location[2]),Ar.target.position.set(sr.direction[0],sr.direction[1],sr.direction[2]),Ar.shadow.normalBias=.1;break;case"LightStyle_WorldLinear":break;default:break}return Ar&&(Ar.intensity=sr.intensity,or=sr.diffuse,lr=new Color(or.r/255,or.g/255,or.b/255),Ar.color=lr,Ar.userData.attributes=nr,Ar.userData.objectType=er.objectType),Ar}}_initLibrary(){if(!this.libraryPending){const er=new FileLoader(this.manager);er.setPath(this.libraryPath);const tr=new Promise((sr,ar)=>{er.load("rhino3dm.js",sr,void 0,ar)}),ir=new FileLoader(this.manager);ir.setPath(this.libraryPath),ir.setResponseType("arraybuffer");const nr=new Promise((sr,ar)=>{ir.load("rhino3dm.wasm",sr,void 0,ar)});this.libraryPending=Promise.all([tr,nr]).then(([sr,ar])=>{this.libraryConfig.wasmBinary=ar;const or=Rhino3dmWorker.toString(),lr=["/* rhino3dm.js */",sr,"/* worker */",or.substring(or.indexOf("{")+1,or.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([lr]))})}return this.libraryPending}_getWorker(er){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const ir=new Worker(this.workerSourceURL);ir._callbacks={},ir._taskCosts={},ir._taskLoad=0,ir.postMessage({type:"init",libraryConfig:this.libraryConfig}),ir.onmessage=nr=>{const sr=nr.data;switch(sr.type){case"warning":this.warnings.push(sr.data),console.warn(sr.data);break;case"decode":ir._callbacks[sr.id].resolve(sr);break;case"error":ir._callbacks[sr.id].reject(sr);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+sr.type+'"')}},this.workerPool.push(ir)}else this.workerPool.sort(function(ir,nr){return ir._taskLoad>nr._taskLoad?-1:1});const tr=this.workerPool[this.workerPool.length-1];return tr._taskLoad+=er,tr})}_releaseTask(er,tr){er._taskLoad-=er._taskCosts[tr],delete er._callbacks[tr],delete er._taskCosts[tr]}dispose(){for(let er=0;er<this.workerPool.length;++er)this.workerPool[er].terminate();return this.workerPool.length=0,this}}function Rhino3dmWorker(){let rr,er,tr,ir;onmessage=function(ur){const dr=ur.data;switch(dr.type){case"init":er=dr.libraryConfig;const hr=er.wasmBinary;let pr;rr=new Promise(function(vr){pr={wasmBinary:hr,onRuntimeInitialized:vr},rhino3dm(pr)}).then(()=>{tr=pr});break;case"decode":ir=dr.id;const gr=dr.buffer;rr.then(()=>{try{const vr=nr(tr,gr);self.postMessage({type:"decode",id:dr.id,data:vr})}catch(vr){self.postMessage({type:"error",id:dr.id,error:vr})}});break}};function nr(ur,dr){const hr=new Uint8Array(dr),pr=ur.File3dm.fromByteArray(hr),gr=[],vr=[],mr=[],fr=[],_r=[],Ar=[],yr=[],wr=pr.objects(),xr=wr.count;for(let Or=0;Or<xr;Or++){const Nr=wr.get(Or),Ur=or(Nr,pr);Nr.delete(),Ur&&gr.push(Ur)}for(let Or=0;Or<pr.instanceDefinitions().count;Or++){const Nr=pr.instanceDefinitions().get(Or),Ur=lr(Nr);Ur.objectIds=Nr.getObjectIds(),gr.push({geometry:null,attributes:Ur,objectType:"InstanceDefinition"})}const Sr=[ur.TextureType.Diffuse,ur.TextureType.Bump,ur.TextureType.Transparency,ur.TextureType.Opacity,ur.TextureType.Emap],br=[ur.TextureType.PBR_BaseColor,ur.TextureType.PBR_Subsurface,ur.TextureType.PBR_SubsurfaceScattering,ur.TextureType.PBR_SubsurfaceScatteringRadius,ur.TextureType.PBR_Metallic,ur.TextureType.PBR_Specular,ur.TextureType.PBR_SpecularTint,ur.TextureType.PBR_Roughness,ur.TextureType.PBR_Anisotropic,ur.TextureType.PBR_Anisotropic_Rotation,ur.TextureType.PBR_Sheen,ur.TextureType.PBR_SheenTint,ur.TextureType.PBR_Clearcoat,ur.TextureType.PBR_ClearcoatBump,ur.TextureType.PBR_ClearcoatRoughness,ur.TextureType.PBR_OpacityIor,ur.TextureType.PBR_OpacityRoughness,ur.TextureType.PBR_Emission,ur.TextureType.PBR_AmbientOcclusion,ur.TextureType.PBR_Displacement];for(let Or=0;Or<pr.materials().count;Or++){const Nr=pr.materials().get(Or),Ur=lr(Nr),Br=[];Br.push(...sr(Nr,Sr,pr)),Ur.pbrSupported=Nr.physicallyBased().supported,Ur.pbrSupported&&(Br.push(...sr(Nr,br,pr)),Ur.pbr=lr(Nr.physicallyBased())),Ur.textures=Br,vr.push(Ur),Nr.delete()}for(let Or=0;Or<pr.layers().count;Or++){const Nr=pr.layers().get(Or),Ur=lr(Nr);mr.push(Ur),Nr.delete()}for(let Or=0;Or<pr.views().count;Or++){const Nr=pr.views().get(Or),Ur=lr(Nr);fr.push(Ur),Nr.delete()}for(let Or=0;Or<pr.namedViews().count;Or++){const Nr=pr.namedViews().get(Or),Ur=lr(Nr);_r.push(Ur),Nr.delete()}for(let Or=0;Or<pr.groups().count;Or++){const Nr=pr.groups().get(Or),Ur=lr(Nr);Ar.push(Ur),Nr.delete()}const Cr=lr(pr.settings()),Ir=pr.strings().count;for(let Or=0;Or<Ir;Or++)yr.push(pr.strings().get(Or));const Rr=pr.settings().renderSettings().renderEnvironments.reflectionId,Pr=pr.renderContent();let Dr=null;for(let Or=0;Or<Pr.count;Or++){const Nr=Pr.get(Or);switch(Nr.kind){case"environment":if(Nr.id!==Rr)break;const Wr=Nr.findChild("texture").fileName;for(let Xr=0;Xr<pr.embeddedFiles().count;Xr++){const Yr=pr.embeddedFiles().get(Xr).fileName;Wr===Yr&&(Dr={type:"renderEnvironment",image:"data:image/png;base64,"+pr.getEmbeddedFileAsBase64(Wr),name:Wr})}break}}const Fr={ambientLight:pr.settings().renderSettings().ambientLight,backgroundColorTop:pr.settings().renderSettings().backgroundColorTop,backgroundColorBottom:pr.settings().renderSettings().backgroundColorBottom,useHiddenLights:pr.settings().renderSettings().useHiddenLights,depthCue:pr.settings().renderSettings().depthCue,flatShade:pr.settings().renderSettings().flatShade,renderBackFaces:pr.settings().renderSettings().renderBackFaces,renderPoints:pr.settings().renderSettings().renderPoints,renderCurves:pr.settings().renderSettings().renderCurves,renderIsoParams:pr.settings().renderSettings().renderIsoParams,renderMeshEdges:pr.settings().renderSettings().renderMeshEdges,renderAnnotations:pr.settings().renderSettings().renderAnnotations,useViewportSize:pr.settings().renderSettings().useViewportSize,scaleBackgroundToFit:pr.settings().renderSettings().scaleBackgroundToFit,transparentBackground:pr.settings().renderSettings().transparentBackground,imageDpi:pr.settings().renderSettings().imageDpi,shadowMapLevel:pr.settings().renderSettings().shadowMapLevel,namedView:pr.settings().renderSettings().namedView,snapShot:pr.settings().renderSettings().snapShot,specificViewport:pr.settings().renderSettings().specificViewport,groundPlane:lr(pr.settings().renderSettings().groundPlane),safeFrame:lr(pr.settings().renderSettings().safeFrame),dithering:lr(pr.settings().renderSettings().dithering),skylight:lr(pr.settings().renderSettings().skylight),linearWorkflow:lr(pr.settings().renderSettings().linearWorkflow),renderChannels:lr(pr.settings().renderSettings().renderChannels),sun:lr(pr.settings().renderSettings().sun),renderEnvironments:lr(pr.settings().renderSettings().renderEnvironments),postEffects:lr(pr.settings().renderSettings().postEffects)};return pr.delete(),{objects:gr,materials:vr,layers:mr,views:fr,namedViews:_r,groups:Ar,strings:yr,settings:Cr,renderSettings:Fr,renderEnvironment:Dr}}function sr(ur,dr,hr){const pr=[];for(let gr=0;gr<dr.length;gr++){const vr=ur.getTexture(dr[gr]);if(vr){let mr=dr[gr].constructor.name;mr=mr.substring(12,mr.length);const fr=ar(vr,mr,hr);pr.push(fr),vr.delete()}}return pr}function ar(ur,dr,hr){const pr={type:dr},gr=hr.getEmbeddedFileAsBase64(ur.fileName);pr.wrapU=ur.wrapU,pr.wrapV=ur.wrapV,pr.wrapW=ur.wrapW;const vr=ur.uvwTransform.toFloatArray(!0);return pr.repeat=[vr[0],vr[5]],gr?pr.image="data:image/png;base64,"+gr:(self.postMessage({type:"warning",id:ir,data:{message:`THREE.3DMLoader: Image for ${dr} texture not embedded in file.`,type:"missing resource"}}),pr.image=null),pr}function or(ur,dr){const hr=ur.geometry(),pr=ur.attributes();let gr=hr.objectType,vr,mr,fr,_r,Ar;switch(gr){case tr.ObjectType.Curve:const yr=cr(hr,100);fr={},mr={},_r={},fr.itemSize=3,fr.type="Float32Array",fr.array=[];for(let Cr=0;Cr<yr.length;Cr++)fr.array.push(yr[Cr][0]),fr.array.push(yr[Cr][1]),fr.array.push(yr[Cr][2]);mr.position=fr,_r.attributes=mr,vr={data:_r};break;case tr.ObjectType.Point:const wr=hr.location;fr={};const xr={};mr={},_r={},fr.itemSize=3,fr.type="Float32Array",fr.array=[wr[0],wr[1],wr[2]];const Sr=pr.drawColor(dr);xr.itemSize=3,xr.type="Float32Array",xr.array=[Sr.r/255,Sr.g/255,Sr.b/255],mr.position=fr,mr.color=xr,_r.attributes=mr,vr={data:_r};break;case tr.ObjectType.PointSet:case tr.ObjectType.Mesh:vr=hr.toThreejsJSON();break;case tr.ObjectType.Brep:const br=hr.faces();Ar=new tr.Mesh;for(let Cr=0;Cr<br.count;Cr++){const Ir=br.get(Cr),Rr=Ir.getMesh(tr.MeshType.Any);Rr&&(Ar.append(Rr),Rr.delete()),Ir.delete()}Ar.faces().count>0&&(Ar.compact(),vr=Ar.toThreejsJSON(),br.delete()),Ar.delete();break;case tr.ObjectType.Extrusion:Ar=hr.getMesh(tr.MeshType.Any),Ar&&(vr=Ar.toThreejsJSON(),Ar.delete());break;case tr.ObjectType.TextDot:vr=lr(hr);break;case tr.ObjectType.Light:vr=lr(hr),vr.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:ir,data:{message:`THREE.3DMLoader: No conversion exists for ${gr.constructor.name} ${vr.lightStyle.name}`,type:"no conversion",guid:pr.id}});break;case tr.ObjectType.InstanceReference:vr=lr(hr),vr.xform=lr(hr.xform),vr.xform.array=hr.xform.toFloatArray(!0);break;case tr.ObjectType.SubD:hr.subdivide(3),Ar=tr.Mesh.createFromSubDControlNet(hr,!1),Ar&&(vr=Ar.toThreejsJSON(),Ar.delete());break;default:self.postMessage({type:"warning",id:ir,data:{message:`THREE.3DMLoader: Conversion not implemented for ${gr.constructor.name}`,type:"not implemented",guid:pr.id}});break}if(vr)return mr=lr(pr),mr.geometry=lr(hr),pr.groupCount>0&&(mr.groupIds=pr.getGroupList()),pr.userStringCount>0&&(mr.userStrings=pr.getUserStrings()),hr.userStringCount>0&&(mr.geometry.userStrings=hr.getUserStrings()),pr.decals().count>0&&self.postMessage({type:"warning",id:ir,data:{message:"THREE.3DMLoader: No conversion exists for the decals associated with this object.",type:"no conversion",guid:pr.id}}),mr.drawColor=pr.drawColor(dr),gr=gr.constructor.name,gr=gr.substring(11,gr.length),{geometry:vr,attributes:mr,objectType:gr};self.postMessage({type:"warning",id:ir,data:{message:`THREE.3DMLoader: ${gr.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:pr.id}})}function lr(ur){const dr={};for(const hr in ur){const pr=ur[hr];typeof pr!="function"&&(typeof pr=="object"&&pr!==null&&pr.hasOwnProperty("constructor")?dr[hr]={name:pr.constructor.name,value:pr.value}:typeof pr=="object"&&pr!==null?dr[hr]=lr(pr):dr[hr]=pr)}return dr}function cr(ur,dr){let hr=dr,pr=[];const gr=[];if(ur instanceof tr.LineCurve)return[ur.pointAtStart,ur.pointAtEnd];if(ur instanceof tr.PolylineCurve){hr=ur.pointCount;for(let fr=0;fr<hr;fr++)pr.push(ur.point(fr));return pr}if(ur instanceof tr.PolyCurve){const fr=ur.segmentCount;for(let _r=0;_r<fr;_r++){const Ar=ur.segmentCurve(_r),yr=cr(Ar,hr);pr=pr.concat(yr),Ar.delete()}return pr}if(ur instanceof tr.ArcCurve&&(hr=Math.floor(ur.angleDegrees/5),hr=hr<2?2:hr),ur instanceof tr.NurbsCurve&&ur.degree===1){const fr=ur.tryGetPolyline();for(let _r=0;_r<fr.count;_r++)pr.push(fr.get(_r));return fr.delete(),pr}const vr=ur.domain,mr=hr-1;for(let fr=0;fr<hr;fr++){const _r=vr[0]+fr/mr*(vr[1]-vr[0]);if(_r===vr[0]||_r===vr[1]){gr.push(_r);continue}const Ar=ur.tangentAt(_r),yr=ur.tangentAt(gr.slice(-1)[0]),wr=Ar[0]*Ar[0]+Ar[1]*Ar[1]+Ar[2]*Ar[2],xr=yr[0]*yr[0]+yr[1]*yr[1]+yr[2]*yr[2],Sr=Math.sqrt(wr*xr);let br;if(Sr===0)br=Math.PI/2;else{const Cr=(Ar.x*yr.x+Ar.y*yr.y+Ar.z*yr.z)/Sr;br=Math.acos(Math.max(-1,Math.min(1,Cr)))}br<.1||gr.push(_r)}return pr=gr.map(fr=>ur.pointAt(fr)),pr}}const COLOR_SPACE_3MF=SRGBColorSpace;class ThreeMFLoader extends Loader{constructor(er){super(er),this.availableExtensions=[]}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=this,ir=new TextureLoader(this.manager);function nr(Vr){let Gr=null,qr=null,ji,Jr;const Ji=[],Ki=[];let Zi;const Zr={},is={},os={},cs=new TextDecoder;try{Gr=unzipSync(new Uint8Array(Vr))}catch(Yi){if(Yi instanceof ReferenceError)return console.error("THREE.3MFLoader: fflate missing and file is compressed."),null}for(qr in Gr)qr.match(/\_rels\/.rels$/)?ji=qr:qr.match(/3D\/_rels\/.*\.model\.rels$/)?Jr=qr:qr.match(/^3D\/.*\.model$/)?Ji.push(qr):qr.match(/^3D\/Textures?\/.*/)&&Ki.push(qr);if(ji===void 0)throw new Error("THREE.ThreeMFLoader: Cannot find relationship file `rels` in 3MF archive.");const ss=Gr[ji],es=cs.decode(ss),ms=sr(es);if(Jr){const Yi=Gr[Jr],Gi=cs.decode(Yi);Zi=sr(Gi)}for(let Yi=0;Yi<Ji.length;Yi++){const Gi=Ji[Yi],Ni=Gr[Gi],Ri=cs.decode(Ni),qi=new DOMParser().parseFromString(Ri,"application/xml");qi.documentElement.nodeName.toLowerCase()!=="model"&&console.error("THREE.3MFLoader: Error loading 3MF - no 3MF document found: ",Gi);const as=qi.querySelector("model"),us={};for(let vs=0;vs<as.attributes.length;vs++){const _s=as.attributes[vs];_s.name.match(/^xmlns:(.+)$/)&&(us[_s.value]=RegExp.$1)}const gs=xr(as);gs.xml=as,0<Object.keys(us).length&&(gs.extensions=us),Zr[Gi]=gs}for(let Yi=0;Yi<Ki.length;Yi++){const Gi=Ki[Yi];os[Gi]=Gr[Gi].buffer}return{rels:ms,modelRels:Zi,model:Zr,printTicket:is,texture:os}}function sr(Vr){const Gr=[],ji=new DOMParser().parseFromString(Vr,"application/xml").querySelectorAll("Relationship");for(let Jr=0;Jr<ji.length;Jr++){const Ji=ji[Jr],Ki={target:Ji.getAttribute("Target"),id:Ji.getAttribute("Id"),type:Ji.getAttribute("Type")};Gr.push(Ki)}return Gr}function ar(Vr){const Gr={};for(let qr=0;qr<Vr.length;qr++){const ji=Vr[qr],Jr=ji.getAttribute("name");0<=["Title","Designer","Description","Copyright","LicenseTerms","Rating","CreationDate","ModificationDate"].indexOf(Jr)&&(Gr[Jr]=ji.textContent)}return Gr}function or(Vr){const Gr={id:Vr.getAttribute("id"),basematerials:[]},qr=Vr.querySelectorAll("base");for(let ji=0;ji<qr.length;ji++){const Jr=qr[ji],Ji=gr(Jr);Ji.index=ji,Gr.basematerials.push(Ji)}return Gr}function lr(Vr){return{id:Vr.getAttribute("id"),path:Vr.getAttribute("path"),contenttype:Vr.getAttribute("contenttype"),tilestyleu:Vr.getAttribute("tilestyleu"),tilestylev:Vr.getAttribute("tilestylev"),filter:Vr.getAttribute("filter")}}function cr(Vr){const Gr={id:Vr.getAttribute("id"),texid:Vr.getAttribute("texid"),displaypropertiesid:Vr.getAttribute("displaypropertiesid")},qr=Vr.querySelectorAll("tex2coord"),ji=[];for(let Jr=0;Jr<qr.length;Jr++){const Ji=qr[Jr],Ki=Ji.getAttribute("u"),Zi=Ji.getAttribute("v");ji.push(parseFloat(Ki),parseFloat(Zi))}return Gr.uvs=new Float32Array(ji),Gr}function ur(Vr){const Gr={id:Vr.getAttribute("id"),displaypropertiesid:Vr.getAttribute("displaypropertiesid")},qr=Vr.querySelectorAll("color"),ji=[],Jr=new Color;for(let Ji=0;Ji<qr.length;Ji++){const Zi=qr[Ji].getAttribute("color");Jr.setStyle(Zi.substring(0,7),COLOR_SPACE_3MF),ji.push(Jr.r,Jr.g,Jr.b)}return Gr.colors=new Float32Array(ji),Gr}function dr(Vr){const Gr=Vr.children,qr={};for(let ji=0;ji<Gr.length;ji++){const Jr={type:Gr[ji].nodeName.substring(2)};for(let Ji=0;Ji<Gr[ji].attributes.length;Ji++){const Ki=Gr[ji].attributes[Ji];Ki.specified&&(Jr[Ki.name]=Ki.value)}qr[Gr[ji].getAttribute("identifier")]=Jr}return qr}function hr(Vr){const Gr={id:Vr.getAttribute("id"),displayname:Vr.getAttribute("displayname")},qr=Vr.children,ji={};for(let Jr=0;Jr<qr.length;Jr++){const Ji=qr[Jr];if(Ji.nodeName==="i:in"||Ji.nodeName==="i:out")ji[Ji.nodeName==="i:in"?"inputs":"outputs"]=dr(Ji);else{const Ki=Ji.children;let Zi={op:Ji.nodeName.substring(2),identifier:Ji.getAttribute("identifier")};for(let Zr=0;Zr<Ki.length;Zr++)Zi[Ki[Zr].nodeName.substring(2)]=dr(Ki[Zr]);ji[Zi.identifier]=Zi}}return Gr.operations=ji,Gr}function pr(Vr){const Gr={id:Vr.getAttribute("id")},qr=Vr.querySelectorAll("pbmetallic"),ji=[];for(let Jr=0;Jr<qr.length;Jr++){const Ji=qr[Jr];ji.push({name:Ji.getAttribute("name"),metallicness:parseFloat(Ji.getAttribute("metallicness")),roughness:parseFloat(Ji.getAttribute("roughness"))})}return Gr.data=ji,Gr}function gr(Vr){const Gr={};return Gr.name=Vr.getAttribute("name"),Gr.displaycolor=Vr.getAttribute("displaycolor"),Gr.displaypropertiesid=Vr.getAttribute("displaypropertiesid"),Gr}function vr(Vr){const Gr={},qr=[],ji=Vr.querySelectorAll("vertices vertex");for(let Zi=0;Zi<ji.length;Zi++){const Zr=ji[Zi],is=Zr.getAttribute("x"),os=Zr.getAttribute("y"),cs=Zr.getAttribute("z");qr.push(parseFloat(is),parseFloat(os),parseFloat(cs))}Gr.vertices=new Float32Array(qr);const Jr=[],Ji=[],Ki=Vr.querySelectorAll("triangles triangle");for(let Zi=0;Zi<Ki.length;Zi++){const Zr=Ki[Zi],is=Zr.getAttribute("v1"),os=Zr.getAttribute("v2"),cs=Zr.getAttribute("v3"),ss=Zr.getAttribute("p1"),es=Zr.getAttribute("p2"),ms=Zr.getAttribute("p3"),Yi=Zr.getAttribute("pid"),Gi={};Gi.v1=parseInt(is,10),Gi.v2=parseInt(os,10),Gi.v3=parseInt(cs,10),Ji.push(Gi.v1,Gi.v2,Gi.v3),ss&&(Gi.p1=parseInt(ss,10)),es&&(Gi.p2=parseInt(es,10)),ms&&(Gi.p3=parseInt(ms,10)),Yi&&(Gi.pid=Yi),0<Object.keys(Gi).length&&Jr.push(Gi)}return Gr.triangleProperties=Jr,Gr.triangles=new Uint32Array(Ji),Gr}function mr(Vr){const Gr=[],qr=Vr.querySelectorAll("component");for(let ji=0;ji<qr.length;ji++){const Jr=qr[ji],Ji=fr(Jr);Gr.push(Ji)}return Gr}function fr(Vr){const Gr={};Gr.objectId=Vr.getAttribute("objectid");const qr=Vr.getAttribute("transform");return qr&&(Gr.transform=_r(qr)),Gr}function _r(Vr){const Gr=[];Vr.split(" ").forEach(function(ji){Gr.push(parseFloat(ji))});const qr=new Matrix4;return qr.set(Gr[0],Gr[3],Gr[6],Gr[9],Gr[1],Gr[4],Gr[7],Gr[10],Gr[2],Gr[5],Gr[8],Gr[11],0,0,0,1),qr}function Ar(Vr){const Gr={type:Vr.getAttribute("type")},qr=Vr.getAttribute("id");qr&&(Gr.id=qr);const ji=Vr.getAttribute("pid");ji&&(Gr.pid=ji);const Jr=Vr.getAttribute("pindex");Jr&&(Gr.pindex=Jr);const Ji=Vr.getAttribute("thumbnail");Ji&&(Gr.thumbnail=Ji);const Ki=Vr.getAttribute("partnumber");Ki&&(Gr.partnumber=Ki);const Zi=Vr.getAttribute("name");Zi&&(Gr.name=Zi);const Zr=Vr.querySelector("mesh");Zr&&(Gr.mesh=vr(Zr));const is=Vr.querySelector("components");return is&&(Gr.components=mr(is)),Gr}function yr(Vr){const Gr={};Gr.basematerials={};const qr=Vr.querySelectorAll("basematerials");for(let is=0;is<qr.length;is++){const os=qr[is],cs=or(os);Gr.basematerials[cs.id]=cs}Gr.texture2d={};const ji=Vr.querySelectorAll("texture2d");for(let is=0;is<ji.length;is++){const os=ji[is],cs=lr(os);Gr.texture2d[cs.id]=cs}Gr.colorgroup={};const Jr=Vr.querySelectorAll("colorgroup");for(let is=0;is<Jr.length;is++){const os=Jr[is],cs=ur(os);Gr.colorgroup[cs.id]=cs}const Ji=Vr.querySelectorAll("implicitfunction");Ji.length>0&&(Gr.implicitfunction={});for(let is=0;is<Ji.length;is++){const os=Ji[is],cs=hr(os);Gr.implicitfunction[cs.id]=cs}Gr.pbmetallicdisplayproperties={};const Ki=Vr.querySelectorAll("pbmetallicdisplayproperties");for(let is=0;is<Ki.length;is++){const os=Ki[is],cs=pr(os);Gr.pbmetallicdisplayproperties[cs.id]=cs}Gr.texture2dgroup={};const Zi=Vr.querySelectorAll("texture2dgroup");for(let is=0;is<Zi.length;is++){const os=Zi[is],cs=cr(os);Gr.texture2dgroup[cs.id]=cs}Gr.object={};const Zr=Vr.querySelectorAll("object");for(let is=0;is<Zr.length;is++){const os=Zr[is],cs=Ar(os);Gr.object[cs.id]=cs}return Gr}function wr(Vr){const Gr=[],qr=Vr.querySelectorAll("item");for(let ji=0;ji<qr.length;ji++){const Jr=qr[ji],Ji={objectId:Jr.getAttribute("objectid")},Ki=Jr.getAttribute("transform");Ki&&(Ji.transform=_r(Ki)),Gr.push(Ji)}return Gr}function xr(Vr){const Gr={unit:Vr.getAttribute("unit")||"millimeter"},qr=Vr.querySelectorAll("metadata");qr&&(Gr.metadata=ar(qr));const ji=Vr.querySelector("resources");ji&&(Gr.resources=yr(ji));const Jr=Vr.querySelector("build");return Jr&&(Gr.build=wr(Jr)),Gr}function Sr(Vr,Gr,qr,ji){const Jr=Vr.texid,Ki=qr.resources.texture2d[Jr];if(Ki){const Zi=ji[Ki.path],Zr=Ki.contenttype,is=new Blob([Zi],{type:Zr}),os=URL.createObjectURL(is),cs=ir.load(os,function(){URL.revokeObjectURL(os)});switch(cs.colorSpace=COLOR_SPACE_3MF,Ki.tilestyleu){case"wrap":cs.wrapS=RepeatWrapping;break;case"mirror":cs.wrapS=MirroredRepeatWrapping;break;case"none":case"clamp":cs.wrapS=ClampToEdgeWrapping;break;default:cs.wrapS=RepeatWrapping}switch(Ki.tilestylev){case"wrap":cs.wrapT=RepeatWrapping;break;case"mirror":cs.wrapT=MirroredRepeatWrapping;break;case"none":case"clamp":cs.wrapT=ClampToEdgeWrapping;break;default:cs.wrapT=RepeatWrapping}switch(Ki.filter){case"auto":cs.magFilter=LinearFilter,cs.minFilter=LinearMipmapLinearFilter;break;case"linear":cs.magFilter=LinearFilter,cs.minFilter=LinearFilter,cs.generateMipmaps=!1;break;case"nearest":cs.magFilter=NearestFilter,cs.minFilter=NearestFilter,cs.generateMipmaps=!1;break;default:cs.magFilter=LinearFilter,cs.minFilter=LinearMipmapLinearFilter}return cs}else return null}function br(Vr,Gr,qr,ji,Jr,Ji,Ki){const Zi=Ki.pindex,Zr={};for(let cs=0,ss=Gr.length;cs<ss;cs++){const es=Gr[cs],ms=es.p1!==void 0?es.p1:Zi;Zr[ms]===void 0&&(Zr[ms]=[]),Zr[ms].push(es)}const is=Object.keys(Zr),os=[];for(let cs=0,ss=is.length;cs<ss;cs++){const es=is[cs],ms=Zr[es],Yi=Vr.basematerials[es],Gi=Ur(Yi,ji,Jr,Ji,Ki,Br),Ni=new BufferGeometry,Ri=[],qi=qr.vertices;for(let us=0,gs=ms.length;us<gs;us++){const vs=ms[us];Ri.push(qi[vs.v1*3+0]),Ri.push(qi[vs.v1*3+1]),Ri.push(qi[vs.v1*3+2]),Ri.push(qi[vs.v2*3+0]),Ri.push(qi[vs.v2*3+1]),Ri.push(qi[vs.v2*3+2]),Ri.push(qi[vs.v3*3+0]),Ri.push(qi[vs.v3*3+1]),Ri.push(qi[vs.v3*3+2])}Ni.setAttribute("position",new Float32BufferAttribute(Ri,3));const as=new Mesh(Ni,Gi);os.push(as)}return os}function Cr(Vr,Gr,qr,ji,Jr,Ji,Ki){const Zi=new BufferGeometry,Zr=[],is=[],os=qr.vertices,cs=Vr.uvs;for(let Yi=0,Gi=Gr.length;Yi<Gi;Yi++){const Ni=Gr[Yi];Zr.push(os[Ni.v1*3+0]),Zr.push(os[Ni.v1*3+1]),Zr.push(os[Ni.v1*3+2]),Zr.push(os[Ni.v2*3+0]),Zr.push(os[Ni.v2*3+1]),Zr.push(os[Ni.v2*3+2]),Zr.push(os[Ni.v3*3+0]),Zr.push(os[Ni.v3*3+1]),Zr.push(os[Ni.v3*3+2]),is.push(cs[Ni.p1*2+0]),is.push(cs[Ni.p1*2+1]),is.push(cs[Ni.p2*2+0]),is.push(cs[Ni.p2*2+1]),is.push(cs[Ni.p3*2+0]),is.push(cs[Ni.p3*2+1])}Zi.setAttribute("position",new Float32BufferAttribute(Zr,3)),Zi.setAttribute("uv",new Float32BufferAttribute(is,2));const ss=Ur(Vr,ji,Jr,Ji,Ki,Sr),es=new MeshPhongMaterial({map:ss,flatShading:!0});return new Mesh(Zi,es)}function Ir(Vr,Gr,qr,ji){const Jr=new BufferGeometry,Ji=[],Ki=[],Zi=qr.vertices,Zr=Vr.colors;for(let cs=0,ss=Gr.length;cs<ss;cs++){const es=Gr[cs],ms=es.v1,Yi=es.v2,Gi=es.v3;Ji.push(Zi[ms*3+0]),Ji.push(Zi[ms*3+1]),Ji.push(Zi[ms*3+2]),Ji.push(Zi[Yi*3+0]),Ji.push(Zi[Yi*3+1]),Ji.push(Zi[Yi*3+2]),Ji.push(Zi[Gi*3+0]),Ji.push(Zi[Gi*3+1]),Ji.push(Zi[Gi*3+2]);const Ni=es.p1!==void 0?es.p1:ji.pindex,Ri=es.p2!==void 0?es.p2:Ni,qi=es.p3!==void 0?es.p3:Ni;Ki.push(Zr[Ni*3+0]),Ki.push(Zr[Ni*3+1]),Ki.push(Zr[Ni*3+2]),Ki.push(Zr[Ri*3+0]),Ki.push(Zr[Ri*3+1]),Ki.push(Zr[Ri*3+2]),Ki.push(Zr[qi*3+0]),Ki.push(Zr[qi*3+1]),Ki.push(Zr[qi*3+2])}Jr.setAttribute("position",new Float32BufferAttribute(Ji,3)),Jr.setAttribute("color",new Float32BufferAttribute(Ki,3));const is=new MeshPhongMaterial({vertexColors:!0,flatShading:!0});return new Mesh(Jr,is)}function Rr(Vr){const Gr=new BufferGeometry;Gr.setIndex(new BufferAttribute(Vr.triangles,1)),Gr.setAttribute("position",new BufferAttribute(Vr.vertices,3));const qr=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,flatShading:!0});return new Mesh(Gr,qr)}function Pr(Vr,Gr,qr,ji,Jr,Ji){const Ki=Object.keys(Vr),Zi=[];for(let Zr=0,is=Ki.length;Zr<is;Zr++){const os=Ki[Zr],cs=Vr[os];switch(Dr(os,ji)){case"material":const es=ji.resources.basematerials[os],ms=br(es,cs,Gr,qr,ji,Jr,Ji);for(let Ni=0,Ri=ms.length;Ni<Ri;Ni++)Zi.push(ms[Ni]);break;case"texture":const Yi=ji.resources.texture2dgroup[os];Zi.push(Cr(Yi,cs,Gr,qr,ji,Jr,Ji));break;case"vertexColors":const Gi=ji.resources.colorgroup[os];Zi.push(Ir(Gi,cs,Gr,Ji));break;case"default":Zi.push(Rr(Gr));break;default:console.error("THREE.3MFLoader: Unsupported resource type.")}}if(Ji.name)for(let Zr=0;Zr<Zi.length;Zr++)Zi[Zr].name=Ji.name;return Zi}function Dr(Vr,Gr){return Gr.resources.texture2dgroup[Vr]!==void 0?"texture":Gr.resources.basematerials[Vr]!==void 0?"material":Gr.resources.colorgroup[Vr]!==void 0?"vertexColors":Vr==="default"?"default":void 0}function Fr(Vr,Gr){const qr={},ji=Vr.triangleProperties,Jr=Gr.pid;for(let Ji=0,Ki=ji.length;Ji<Ki;Ji++){const Zi=ji[Ji];let Zr=Zi.pid!==void 0?Zi.pid:Jr;Zr===void 0&&(Zr="default"),qr[Zr]===void 0&&(qr[Zr]=[]),qr[Zr].push(Zi)}return qr}function Or(Vr,Gr,qr,ji,Jr){const Ji=new Group,Ki=Fr(Vr,Jr),Zi=Pr(Ki,Vr,Gr,qr,ji,Jr);for(let Zr=0,is=Zi.length;Zr<is;Zr++)Ji.add(Zi[Zr]);return Ji}function Nr(Vr,Gr,qr){if(!Vr)return;const ji=[],Jr=Object.keys(Vr);for(let Ji=0;Ji<Jr.length;Ji++){const Ki=Jr[Ji];for(let Zi=0;Zi<tr.availableExtensions.length;Zi++){const Zr=tr.availableExtensions[Zi];Zr.ns===Ki&&ji.push(Zr)}}for(let Ji=0;Ji<ji.length;Ji++){const Ki=ji[Ji];Ki.apply(qr,Vr[Ki.ns],Gr)}}function Ur(Vr,Gr,qr,ji,Jr,Ji){return Vr.build!==void 0||(Vr.build=Ji(Vr,Gr,qr,ji,Jr)),Vr.build}function Br(Vr,Gr,qr){let ji;const Jr=Vr.displaypropertiesid,Ji=qr.resources.pbmetallicdisplayproperties;if(Jr!==null&&Ji[Jr]!==void 0){const is=Ji[Jr].data[Vr.index];ji=new MeshStandardMaterial({flatShading:!0,roughness:is.roughness,metalness:is.metallicness})}else ji=new MeshPhongMaterial({flatShading:!0});ji.name=Vr.name;const Ki=Vr.displaycolor,Zi=Ki.substring(0,7);return ji.color.setStyle(Zi,COLOR_SPACE_3MF),Ki.length===9&&(ji.opacity=parseInt(Ki.charAt(7)+Ki.charAt(8),16)/255),ji}function Wr(Vr,Gr,qr,ji){const Jr=new Group;for(let Ji=0;Ji<Vr.length;Ji++){const Ki=Vr[Ji];let Zi=Gr[Ki.objectId];Zi===void 0&&(Xr(Ki.objectId,Gr,qr,ji),Zi=Gr[Ki.objectId]);const Zr=Zi.clone(),is=Ki.transform;is&&Zr.applyMatrix4(is),Jr.add(Zr)}return Jr}function Xr(Vr,Gr,qr,ji){const Jr=qr.resources.object[Vr];if(Jr.mesh){const Ji=Jr.mesh,Ki=qr.extensions,Zi=qr.xml;Nr(Ki,Ji,Zi),Gr[Jr.id]=Ur(Ji,Gr,qr,ji,Jr,Or)}else{const Ji=Jr.components;Gr[Jr.id]=Ur(Ji,Gr,qr,ji,Jr,Wr)}Jr.name&&(Gr[Jr.id].name=Jr.name),qr.resources.implicitfunction&&console.warn("THREE.ThreeMFLoader: Implicit Functions are implemented in data-only.",qr.resources.implicitfunction)}function Yr(Vr){const Gr=Vr.model,qr=Vr.modelRels,ji={},Jr=Object.keys(Gr),Ji={};if(qr)for(let Ki=0,Zi=qr.length;Ki<Zi;Ki++){const Zr=qr[Ki],is=Zr.target.substring(1);Vr.texture[is]&&(Ji[Zr.target]=Vr.texture[is])}for(let Ki=0;Ki<Jr.length;Ki++){const Zi=Jr[Ki],Zr=Gr[Zi],is=Object.keys(Zr.resources.object);for(let os=0;os<is.length;os++){const cs=is[os];Xr(cs,ji,Zr,Ji)}}return ji}function Qi(Vr){for(let Gr=0;Gr<Vr.length;Gr++){const qr=Vr[Gr];if(qr.target.split(".").pop().toLowerCase()==="model")return qr}}function Xi(Vr,Gr){const qr=new Group,ji=Qi(Gr.rels),Jr=Gr.model[ji.target.substring(1)].build;for(let Ji=0;Ji<Jr.length;Ji++){const Ki=Jr[Ji],Zi=Vr[Ki.objectId].clone(),Zr=Ki.transform;Zr&&Zi.applyMatrix4(Zr),qr.add(Zi)}return qr}const Kr=nr(er),$r=Yr(Kr);return Xi($r,Kr)}addExtension(er){this.availableExtensions.push(er)}}class AMFLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(yr){let wr=new DataView(yr);if(String.fromCharCode(wr.getUint8(0),wr.getUint8(1))==="PK"){let Cr=null,Ir=null;console.log("THREE.AMFLoader: Loading Zip");try{Cr=unzipSync(new Uint8Array(yr))}catch(Rr){if(Rr instanceof ReferenceError)return console.log("THREE.AMFLoader: fflate missing and file is compressed."),null}for(Ir in Cr)if(Ir.toLowerCase().slice(-4)===".amf")break;console.log("THREE.AMFLoader: Trying to load file asset: "+Ir),wr=new DataView(Cr[Ir].buffer)}const Sr=new TextDecoder().decode(wr),br=new DOMParser().parseFromString(Sr,"application/xml");return br.documentElement.nodeName.toLowerCase()!=="amf"?(console.log("THREE.AMFLoader: Error loading AMF - no AMF document found."),null):br}function ir(yr){let wr=1,xr="millimeter";yr.documentElement.attributes.unit!==void 0&&(xr=yr.documentElement.attributes.unit.value.toLowerCase());const Sr={millimeter:1,inch:25.4,feet:304.8,meter:1e3,micron:.001};return Sr[xr]!==void 0&&(wr=Sr[xr]),console.log("THREE.AMFLoader: Unit scale: "+wr),wr}function nr(yr){let wr="AMF Material";const xr=yr.attributes.id.textContent;let Sr={r:1,g:1,b:1,a:1},br=null;for(let Cr=0;Cr<yr.childNodes.length;Cr++){const Ir=yr.childNodes[Cr];Ir.nodeName==="metadata"&&Ir.attributes.type!==void 0?Ir.attributes.type.value==="name"&&(wr=Ir.textContent):Ir.nodeName==="color"&&(Sr=sr(Ir))}return br=new MeshPhongMaterial({flatShading:!0,color:new Color(Sr.r,Sr.g,Sr.b),name:wr}),Sr.a!==1&&(br.transparent=!0,br.opacity=Sr.a),{id:xr,material:br}}function sr(yr){const wr={r:1,g:1,b:1,a:1};for(let xr=0;xr<yr.childNodes.length;xr++){const Sr=yr.childNodes[xr];Sr.nodeName==="r"?wr.r=Sr.textContent:Sr.nodeName==="g"?wr.g=Sr.textContent:Sr.nodeName==="b"?wr.b=Sr.textContent:Sr.nodeName==="a"&&(wr.a=Sr.textContent)}return wr}function ar(yr){const wr={name:"",triangles:[],materialid:null};let xr=yr.firstElementChild;for(yr.attributes.materialid!==void 0&&(wr.materialId=yr.attributes.materialid.nodeValue);xr;){if(xr.nodeName==="metadata")xr.attributes.type!==void 0&&xr.attributes.type.value==="name"&&(wr.name=xr.textContent);else if(xr.nodeName==="triangle"){const Sr=xr.getElementsByTagName("v1")[0].textContent,br=xr.getElementsByTagName("v2")[0].textContent,Cr=xr.getElementsByTagName("v3")[0].textContent;wr.triangles.push(Sr,br,Cr)}xr=xr.nextElementSibling}return wr}function or(yr){const wr=[],xr=[];let Sr=yr.firstElementChild;for(;Sr;){if(Sr.nodeName==="vertex"){let br=Sr.firstElementChild;for(;br;){if(br.nodeName==="coordinates"){const Cr=br.getElementsByTagName("x")[0].textContent,Ir=br.getElementsByTagName("y")[0].textContent,Rr=br.getElementsByTagName("z")[0].textContent;wr.push(Cr,Ir,Rr)}else if(br.nodeName==="normal"){const Cr=br.getElementsByTagName("nx")[0].textContent,Ir=br.getElementsByTagName("ny")[0].textContent,Rr=br.getElementsByTagName("nz")[0].textContent;xr.push(Cr,Ir,Rr)}br=br.nextElementSibling}}Sr=Sr.nextElementSibling}return{vertices:wr,normals:xr}}function lr(yr){const wr=yr.attributes.id.textContent,xr={name:"amfobject",meshes:[]};let Sr=null,br=yr.firstElementChild;for(;br;){if(br.nodeName==="metadata")br.attributes.type!==void 0&&br.attributes.type.value==="name"&&(xr.name=br.textContent);else if(br.nodeName==="color")Sr=sr(br);else if(br.nodeName==="mesh"){let Cr=br.firstElementChild;const Ir={vertices:[],normals:[],volumes:[],color:Sr};for(;Cr;){if(Cr.nodeName==="vertices"){const Rr=or(Cr);Ir.normals=Ir.normals.concat(Rr.normals),Ir.vertices=Ir.vertices.concat(Rr.vertices)}else Cr.nodeName==="volume"&&Ir.volumes.push(ar(Cr));Cr=Cr.nextElementSibling}xr.meshes.push(Ir)}br=br.nextElementSibling}return{id:wr,obj:xr}}const cr=tr(er);let ur="",dr="";const hr=ir(cr),pr={},gr={},vr=cr.documentElement.childNodes;let mr,fr;for(mr=0;mr<vr.length;mr++){const yr=vr[mr];if(yr.nodeName==="metadata")yr.attributes.type!==void 0&&(yr.attributes.type.value==="name"?ur=yr.textContent:yr.attributes.type.value==="author"&&(dr=yr.textContent));else if(yr.nodeName==="material"){const wr=nr(yr);pr[wr.id]=wr.material}else if(yr.nodeName==="object"){const wr=lr(yr);gr[wr.id]=wr.obj}}const _r=new Group,Ar=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:11184895,flatShading:!0});_r.name=ur,_r.userData.author=dr,_r.userData.loader="AMF";for(const yr in gr){const wr=gr[yr],xr=wr.meshes,Sr=new Group;for(Sr.name=wr.name||"",mr=0;mr<xr.length;mr++){let br=Ar;const Cr=xr[mr],Ir=new Float32BufferAttribute(Cr.vertices,3);let Rr=null;if(Cr.normals.length&&(Rr=new Float32BufferAttribute(Cr.normals,3)),Cr.color){const Dr=Cr.color;br=Ar.clone(),br.color=new Color(Dr.r,Dr.g,Dr.b),Dr.a!==1&&(br.transparent=!0,br.opacity=Dr.a)}const Pr=Cr.volumes;for(fr=0;fr<Pr.length;fr++){const Dr=Pr[fr],Fr=new BufferGeometry;let Or=br;Fr.setIndex(Dr.triangles),Fr.setAttribute("position",Ir.clone()),Rr&&Fr.setAttribute("normal",Rr.clone()),pr[Dr.materialId]!==void 0&&(Or=pr[Dr.materialId]),Fr.scale(hr,hr,hr),Sr.add(new Mesh(Fr,Or.clone()))}}_r.add(Sr)}return _r}}class BVHLoader extends Loader{constructor(er){super(er),this.animateBonePositions=!0,this.animateBoneRotations=!0}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(pr){or(pr)!=="HIERARCHY"&&console.error("THREE.BVHLoader: HIERARCHY expected.");const gr=[],vr=nr(pr,or(pr),gr);or(pr)!=="MOTION"&&console.error("THREE.BVHLoader: MOTION expected.");let mr=or(pr).split(/[\s]+/);const fr=parseInt(mr[1]);isNaN(fr)&&console.error("THREE.BVHLoader: Failed to read number of frames."),mr=or(pr).split(/[\s]+/);const _r=parseFloat(mr[2]);isNaN(_r)&&console.error("THREE.BVHLoader: Failed to read frame time.");for(let Ar=0;Ar<fr;Ar++)mr=or(pr).split(/[\s]+/),ir(mr,Ar*_r,vr);return gr}function ir(pr,gr,vr){if(vr.type==="ENDSITE")return;const mr={time:gr,position:new Vector3$1,rotation:new Quaternion$1};vr.frames.push(mr);const fr=new Quaternion$1,_r=new Vector3$1(1,0,0),Ar=new Vector3$1(0,1,0),yr=new Vector3$1(0,0,1);for(let wr=0;wr<vr.channels.length;wr++)switch(vr.channels[wr]){case"Xposition":mr.position.x=parseFloat(pr.shift().trim());break;case"Yposition":mr.position.y=parseFloat(pr.shift().trim());break;case"Zposition":mr.position.z=parseFloat(pr.shift().trim());break;case"Xrotation":fr.setFromAxisAngle(_r,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(fr);break;case"Yrotation":fr.setFromAxisAngle(Ar,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(fr);break;case"Zrotation":fr.setFromAxisAngle(yr,parseFloat(pr.shift().trim())*Math.PI/180),mr.rotation.multiply(fr);break;default:console.warn("THREE.BVHLoader: Invalid channel type.")}for(let wr=0;wr<vr.children.length;wr++)ir(pr,gr,vr.children[wr])}function nr(pr,gr,vr){const mr={name:"",type:"",frames:[]};vr.push(mr);let fr=gr.split(/[\s]+/);fr[0].toUpperCase()==="END"&&fr[1].toUpperCase()==="SITE"?(mr.type="ENDSITE",mr.name="ENDSITE"):(mr.name=fr[1],mr.type=fr[0].toUpperCase()),or(pr)!=="{"&&console.error("THREE.BVHLoader: Expected opening { after type & name"),fr=or(pr).split(/[\s]+/),fr[0]!=="OFFSET"&&console.error("THREE.BVHLoader: Expected OFFSET but got: "+fr[0]),fr.length!==4&&console.error("THREE.BVHLoader: Invalid number of values for OFFSET.");const _r=new Vector3$1(parseFloat(fr[1]),parseFloat(fr[2]),parseFloat(fr[3]));if((isNaN(_r.x)||isNaN(_r.y)||isNaN(_r.z))&&console.error("THREE.BVHLoader: Invalid values of OFFSET."),mr.offset=_r,mr.type!=="ENDSITE"){fr=or(pr).split(/[\s]+/),fr[0]!=="CHANNELS"&&console.error("THREE.BVHLoader: Expected CHANNELS definition.");const Ar=parseInt(fr[1]);mr.channels=fr.splice(2,Ar),mr.children=[]}for(;;){const Ar=or(pr);if(Ar==="}")return mr;mr.children.push(nr(pr,Ar,vr))}}function sr(pr,gr){const vr=new Bone;if(gr.push(vr),vr.position.add(pr.offset),vr.name=pr.name,pr.type!=="ENDSITE")for(let mr=0;mr<pr.children.length;mr++)vr.add(sr(pr.children[mr],gr));return vr}function ar(pr){const gr=[];for(let vr=0;vr<pr.length;vr++){const mr=pr[vr];if(mr.type==="ENDSITE")continue;const fr=[],_r=[],Ar=[];for(let yr=0;yr<mr.frames.length;yr++){const wr=mr.frames[yr];fr.push(wr.time),_r.push(wr.position.x+mr.offset.x),_r.push(wr.position.y+mr.offset.y),_r.push(wr.position.z+mr.offset.z),Ar.push(wr.rotation.x),Ar.push(wr.rotation.y),Ar.push(wr.rotation.z),Ar.push(wr.rotation.w)}lr.animateBonePositions&&gr.push(new VectorKeyframeTrack(mr.name+".position",fr,_r)),lr.animateBoneRotations&&gr.push(new QuaternionKeyframeTrack(mr.name+".quaternion",fr,Ar))}return new AnimationClip("animation",-1,gr)}function or(pr){let gr;for(;(gr=pr.shift().trim()).length===0;);return gr}const lr=this,cr=er.split(/[\r\n]+/g),ur=tr(cr),dr=[];sr(ur[0],dr);const hr=ar(ur);return{skeleton:new Skeleton(dr),clip:hr}}}class TGALoader extends DataTextureLoader{constructor(er){super(er)}parse(er){function tr(Nr){switch(Nr.image_type){case hr:case vr:if(Nr.colormap_length>256||Nr.colormap_size!==24||Nr.colormap_type!==1)throw new Error("THREE.TGALoader: Invalid type colormap data for indexed type.");break;case pr:case gr:case mr:case fr:if(Nr.colormap_type)throw new Error("THREE.TGALoader: Invalid type colormap data for colormap type.");break;case dr:throw new Error("THREE.TGALoader: No data.");default:throw new Error("THREE.TGALoader: Invalid type "+Nr.image_type)}if(Nr.width<=0||Nr.height<=0)throw new Error("THREE.TGALoader: Invalid image size.");if(Nr.pixel_size!==8&&Nr.pixel_size!==16&&Nr.pixel_size!==24&&Nr.pixel_size!==32)throw new Error("THREE.TGALoader: Invalid pixel size "+Nr.pixel_size)}function ir(Nr,Ur,Br,Wr,Xr){let Yr,Qi;const Xi=Br.pixel_size>>3,Kr=Br.width*Br.height*Xi;if(Ur&&(Qi=Xr.subarray(Wr,Wr+=Br.colormap_length*(Br.colormap_size>>3))),Nr){Yr=new Uint8Array(Kr);let $r,Vr,Gr,qr=0;const ji=new Uint8Array(Xi);for(;qr<Kr;)if($r=Xr[Wr++],Vr=($r&127)+1,$r&128){for(Gr=0;Gr<Xi;++Gr)ji[Gr]=Xr[Wr++];for(Gr=0;Gr<Vr;++Gr)Yr.set(ji,qr+Gr*Xi);qr+=Xi*Vr}else{for(Vr*=Xi,Gr=0;Gr<Vr;++Gr)Yr[qr+Gr]=Xr[Wr++];qr+=Vr}}else Yr=Xr.subarray(Wr,Wr+=Ur?Br.width*Br.height:Kr);return{pixel_data:Yr,palettes:Qi}}function nr(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi,Kr){const $r=Kr;let Vr,Gr=0,qr,ji;const Jr=Ir.width;for(ji=Ur;ji!==Wr;ji+=Br)for(qr=Xr;qr!==Qi;qr+=Yr,Gr++)Vr=Xi[Gr],Nr[(qr+Jr*ji)*4+3]=255,Nr[(qr+Jr*ji)*4+2]=$r[Vr*3+0],Nr[(qr+Jr*ji)*4+1]=$r[Vr*3+1],Nr[(qr+Jr*ji)*4+0]=$r[Vr*3+2];return Nr}function sr(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi){let Kr,$r=0,Vr,Gr;const qr=Ir.width;for(Gr=Ur;Gr!==Wr;Gr+=Br)for(Vr=Xr;Vr!==Qi;Vr+=Yr,$r+=2)Kr=Xi[$r+0]+(Xi[$r+1]<<8),Nr[(Vr+qr*Gr)*4+0]=(Kr&31744)>>7,Nr[(Vr+qr*Gr)*4+1]=(Kr&992)>>2,Nr[(Vr+qr*Gr)*4+2]=(Kr&31)<<3,Nr[(Vr+qr*Gr)*4+3]=Kr&32768?0:255;return Nr}function ar(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi){let Kr=0,$r,Vr;const Gr=Ir.width;for(Vr=Ur;Vr!==Wr;Vr+=Br)for($r=Xr;$r!==Qi;$r+=Yr,Kr+=3)Nr[($r+Gr*Vr)*4+3]=255,Nr[($r+Gr*Vr)*4+2]=Xi[Kr+0],Nr[($r+Gr*Vr)*4+1]=Xi[Kr+1],Nr[($r+Gr*Vr)*4+0]=Xi[Kr+2];return Nr}function or(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi){let Kr=0,$r,Vr;const Gr=Ir.width;for(Vr=Ur;Vr!==Wr;Vr+=Br)for($r=Xr;$r!==Qi;$r+=Yr,Kr+=4)Nr[($r+Gr*Vr)*4+2]=Xi[Kr+0],Nr[($r+Gr*Vr)*4+1]=Xi[Kr+1],Nr[($r+Gr*Vr)*4+0]=Xi[Kr+2],Nr[($r+Gr*Vr)*4+3]=Xi[Kr+3];return Nr}function lr(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi){let Kr,$r=0,Vr,Gr;const qr=Ir.width;for(Gr=Ur;Gr!==Wr;Gr+=Br)for(Vr=Xr;Vr!==Qi;Vr+=Yr,$r++)Kr=Xi[$r],Nr[(Vr+qr*Gr)*4+0]=Kr,Nr[(Vr+qr*Gr)*4+1]=Kr,Nr[(Vr+qr*Gr)*4+2]=Kr,Nr[(Vr+qr*Gr)*4+3]=255;return Nr}function cr(Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi){let Kr=0,$r,Vr;const Gr=Ir.width;for(Vr=Ur;Vr!==Wr;Vr+=Br)for($r=Xr;$r!==Qi;$r+=Yr,Kr+=2)Nr[($r+Gr*Vr)*4+0]=Xi[Kr+0],Nr[($r+Gr*Vr)*4+1]=Xi[Kr+0],Nr[($r+Gr*Vr)*4+2]=Xi[Kr+0],Nr[($r+Gr*Vr)*4+3]=Xi[Kr+1];return Nr}function ur(Nr,Ur,Br,Wr,Xr){let Yr,Qi,Xi,Kr,$r,Vr;switch((Ir.flags&_r)>>Ar){default:case xr:Yr=0,Xi=1,$r=Ur,Qi=0,Kr=1,Vr=Br;break;case yr:Yr=0,Xi=1,$r=Ur,Qi=Br-1,Kr=-1,Vr=-1;break;case Sr:Yr=Ur-1,Xi=-1,$r=-1,Qi=0,Kr=1,Vr=Br;break;case wr:Yr=Ur-1,Xi=-1,$r=-1,Qi=Br-1,Kr=-1,Vr=-1;break}if(Dr)switch(Ir.pixel_size){case 8:lr(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr);break;case 16:cr(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr);break;default:throw new Error("THREE.TGALoader: Format not supported.")}else switch(Ir.pixel_size){case 8:nr(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr,Xr);break;case 16:sr(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr);break;case 24:ar(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr);break;case 32:or(Nr,Qi,Kr,Vr,Yr,Xi,$r,Wr);break;default:throw new Error("THREE.TGALoader: Format not supported.")}return Nr}const dr=0,hr=1,pr=2,gr=3,vr=9,mr=10,fr=11,_r=48,Ar=4,yr=0,wr=1,xr=2,Sr=3;if(er.length<19)throw new Error("THREE.TGALoader: Not enough data to contain header.");let br=0;const Cr=new Uint8Array(er),Ir={id_length:Cr[br++],colormap_type:Cr[br++],image_type:Cr[br++],colormap_index:Cr[br++]|Cr[br++]<<8,colormap_length:Cr[br++]|Cr[br++]<<8,colormap_size:Cr[br++],origin:[Cr[br++]|Cr[br++]<<8,Cr[br++]|Cr[br++]<<8],width:Cr[br++]|Cr[br++]<<8,height:Cr[br++]|Cr[br++]<<8,pixel_size:Cr[br++],flags:Cr[br++]};if(tr(Ir),Ir.id_length+br>er.length)throw new Error("THREE.TGALoader: No data.");br+=Ir.id_length;let Rr=!1,Pr=!1,Dr=!1;switch(Ir.image_type){case vr:Rr=!0,Pr=!0;break;case hr:Pr=!0;break;case mr:Rr=!0;break;case pr:break;case fr:Rr=!0,Dr=!0;break;case gr:Dr=!0;break}const Fr=new Uint8Array(Ir.width*Ir.height*4),Or=ir(Rr,Pr,Ir,br,Cr);return ur(Fr,Ir.width,Ir.height,Or.pixel_data,Or.palettes),{data:Fr,width:Ir.width,height:Ir.height,flipY:!0,generateMipmaps:!0,minFilter:LinearMipmapLinearFilter}}}class ColladaLoader extends Loader{load(er,tr,ir,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(sr.manager);or.setPath(sr.path),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},ir,nr)}parse(er,tr){function ir(rs,ts){const hs=[],ls=rs.childNodes;for(let fs=0,Bs=ls.length;fs<Bs;fs++){const Ls=ls[fs];Ls.nodeName===ts&&hs.push(Ls)}return hs}function nr(rs){if(rs.length===0)return[];const ts=rs.trim().split(/\s+/),hs=new Array(ts.length);for(let ls=0,fs=ts.length;ls<fs;ls++)hs[ls]=ts[ls];return hs}function sr(rs){if(rs.length===0)return[];const ts=rs.trim().split(/\s+/),hs=new Array(ts.length);for(let ls=0,fs=ts.length;ls<fs;ls++)hs[ls]=parseFloat(ts[ls]);return hs}function ar(rs){if(rs.length===0)return[];const ts=rs.trim().split(/\s+/),hs=new Array(ts.length);for(let ls=0,fs=ts.length;ls<fs;ls++)hs[ls]=parseInt(ts[ls]);return hs}function or(rs){return rs.substring(1)}function lr(){return"three_default_"+po++}function cr(rs){return Object.keys(rs).length===0}function ur(rs){return{unit:dr(ir(rs,"unit")[0]),upAxis:hr(ir(rs,"up_axis")[0])}}function dr(rs){return rs!==void 0&&rs.hasAttribute("meter")===!0?parseFloat(rs.getAttribute("meter")):1}function hr(rs){return rs!==void 0?rs.textContent:"Y_UP"}function pr(rs,ts,hs,ls){const fs=ir(rs,ts)[0];if(fs!==void 0){const Bs=ir(fs,hs);for(let Ls=0;Ls<Bs.length;Ls++)ls(Bs[Ls])}}function gr(rs,ts){for(const hs in rs){const ls=rs[hs];ls.build=ts(rs[hs])}}function vr(rs,ts){return rs.build!==void 0||(rs.build=ts(rs)),rs.build}function mr(rs){const ts={sources:{},samplers:{},channels:{}};let hs=!1;for(let ls=0,fs=rs.childNodes.length;ls<fs;ls++){const Bs=rs.childNodes[ls];if(Bs.nodeType!==1)continue;let Ls;switch(Bs.nodeName){case"source":Ls=Bs.getAttribute("id"),ts.sources[Ls]=Ss(Bs);break;case"sampler":Ls=Bs.getAttribute("id"),ts.samplers[Ls]=fr(Bs);break;case"channel":Ls=Bs.getAttribute("target"),ts.channels[Ls]=_r(Bs);break;case"animation":mr(Bs),hs=!0;break;default:console.log(Bs)}}hs===!1&&(wa.animations[rs.getAttribute("id")||MathUtils.generateUUID()]=ts)}function fr(rs){const ts={inputs:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Bs=or(fs.getAttribute("source")),Ls=fs.getAttribute("semantic");ts.inputs[Ls]=Bs;break}}return ts}function _r(rs){const ts={};let ls=rs.getAttribute("target").split("/");const fs=ls.shift();let Bs=ls.shift();const Ls=Bs.indexOf("(")!==-1,sa=Bs.indexOf(".")!==-1;if(sa)ls=Bs.split("."),Bs=ls.shift(),ts.member=ls.shift();else if(Ls){const Ks=Bs.split("(");Bs=Ks.shift();for(let ta=0;ta<Ks.length;ta++)Ks[ta]=parseInt(Ks[ta].replace(/\)/,""));ts.indices=Ks}return ts.id=fs,ts.sid=Bs,ts.arraySyntax=Ls,ts.memberSyntax=sa,ts.sampler=or(rs.getAttribute("source")),ts}function Ar(rs){const ts=[],hs=rs.channels,ls=rs.samplers,fs=rs.sources;for(const Bs in hs)if(hs.hasOwnProperty(Bs)){const Ls=hs[Bs],sa=ls[Ls.sampler],Ks=sa.inputs.INPUT,ta=sa.inputs.OUTPUT,da=fs[Ks],Qs=fs[ta],ua=wr(Ls,da,Qs);Ir(ua,ts)}return ts}function yr(rs){return vr(wa.animations[rs],Ar)}function wr(rs,ts,hs){const ls=wa.nodes[rs.id],fs=Xs(ls.id),Bs=ls.transforms[rs.sid],Ls=ls.matrix.clone().transpose();let sa,Ks,ta,da,Qs,ua;const ca={};switch(Bs){case"matrix":for(ta=0,da=ts.array.length;ta<da;ta++)if(sa=ts.array[ta],Ks=ta*hs.stride,ca[sa]===void 0&&(ca[sa]={}),rs.arraySyntax===!0){const ka=hs.array[Ks],Ba=rs.indices[0]+4*rs.indices[1];ca[sa][Ba]=ka}else for(Qs=0,ua=hs.stride;Qs<ua;Qs++)ca[sa][Qs]=hs.array[Ks+Qs];break;case"translate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Bs);break;case"rotate":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Bs);break;case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',Bs);break}const Aa=xr(ca,Ls);return{name:fs.uuid,keyframes:Aa}}function xr(rs,ts){const hs=[];for(const fs in rs)hs.push({time:parseFloat(fs),value:rs[fs]});hs.sort(ls);for(let fs=0;fs<16;fs++)Rr(hs,fs,ts.elements[fs]);return hs;function ls(fs,Bs){return fs.time-Bs.time}}const Sr=new Vector3$1,br=new Vector3$1,Cr=new Quaternion$1;function Ir(rs,ts){const hs=rs.keyframes,ls=rs.name,fs=[],Bs=[],Ls=[],sa=[];for(let Ks=0,ta=hs.length;Ks<ta;Ks++){const da=hs[Ks],Qs=da.time,ua=da.value;ps.fromArray(ua).transpose(),ps.decompose(Sr,Cr,br),fs.push(Qs),Bs.push(Sr.x,Sr.y,Sr.z),Ls.push(Cr.x,Cr.y,Cr.z,Cr.w),sa.push(br.x,br.y,br.z)}return Bs.length>0&&ts.push(new VectorKeyframeTrack(ls+".position",fs,Bs)),Ls.length>0&&ts.push(new QuaternionKeyframeTrack(ls+".quaternion",fs,Ls)),sa.length>0&&ts.push(new VectorKeyframeTrack(ls+".scale",fs,sa)),ts}function Rr(rs,ts,hs){let ls,fs=!0,Bs,Ls;for(Bs=0,Ls=rs.length;Bs<Ls;Bs++)ls=rs[Bs],ls.value[ts]===void 0?ls.value[ts]=null:fs=!1;if(fs===!0)for(Bs=0,Ls=rs.length;Bs<Ls;Bs++)ls=rs[Bs],ls.value[ts]=hs;else Pr(rs,ts)}function Pr(rs,ts){let hs,ls;for(let fs=0,Bs=rs.length;fs<Bs;fs++){const Ls=rs[fs];if(Ls.value[ts]===null){if(hs=Dr(rs,fs,ts),ls=Fr(rs,fs,ts),hs===null){Ls.value[ts]=ls.value[ts];continue}if(ls===null){Ls.value[ts]=hs.value[ts];continue}Or(Ls,hs,ls,ts)}}}function Dr(rs,ts,hs){for(;ts>=0;){const ls=rs[ts];if(ls.value[hs]!==null)return ls;ts--}return null}function Fr(rs,ts,hs){for(;ts<rs.length;){const ls=rs[ts];if(ls.value[hs]!==null)return ls;ts++}return null}function Or(rs,ts,hs,ls){if(hs.time-ts.time===0){rs.value[ls]=ts.value[ls];return}rs.value[ls]=(rs.time-ts.time)*(hs.value[ls]-ts.value[ls])/(hs.time-ts.time)+ts.value[ls]}function Nr(rs){const ts={name:rs.getAttribute("id")||"default",start:parseFloat(rs.getAttribute("start")||0),end:parseFloat(rs.getAttribute("end")||0),animations:[]};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"instance_animation":ts.animations.push(or(fs.getAttribute("url")));break}}wa.clips[rs.getAttribute("id")]=ts}function Ur(rs){const ts=[],hs=rs.name,ls=rs.end-rs.start||-1,fs=rs.animations;for(let Bs=0,Ls=fs.length;Bs<Ls;Bs++){const sa=yr(fs[Bs]);for(let Ks=0,ta=sa.length;Ks<ta;Ks++)ts.push(sa[Ks])}return new AnimationClip(hs,ls,ts)}function Br(rs){return vr(wa.clips[rs],Ur)}function Wr(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"skin":ts.id=or(fs.getAttribute("source")),ts.skin=Xr(fs);break;case"morph":ts.id=or(fs.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break}}wa.controllers[rs.getAttribute("id")]=ts}function Xr(rs){const ts={sources:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"bind_shape_matrix":ts.bindShapeMatrix=sr(fs.textContent);break;case"source":const Bs=fs.getAttribute("id");ts.sources[Bs]=Ss(fs);break;case"joints":ts.joints=Yr(fs);break;case"vertex_weights":ts.vertexWeights=Qi(fs);break}}return ts}function Yr(rs){const ts={inputs:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Bs=fs.getAttribute("semantic"),Ls=or(fs.getAttribute("source"));ts.inputs[Bs]=Ls;break}}return ts}function Qi(rs){const ts={inputs:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Bs=fs.getAttribute("semantic"),Ls=or(fs.getAttribute("source")),sa=parseInt(fs.getAttribute("offset"));ts.inputs[Bs]={id:Ls,offset:sa};break;case"vcount":ts.vcount=ar(fs.textContent);break;case"v":ts.v=ar(fs.textContent);break}}return ts}function Xi(rs){const ts={id:rs.id},hs=wa.geometries[ts.id];return rs.skin!==void 0&&(ts.skin=Kr(rs.skin),hs.sources.skinIndices=ts.skin.indices,hs.sources.skinWeights=ts.skin.weights),ts}function Kr(rs){const hs={joints:[],indices:{array:[],stride:4},weights:{array:[],stride:4}},ls=rs.sources,fs=rs.vertexWeights,Bs=fs.vcount,Ls=fs.v,sa=fs.inputs.JOINT.offset,Ks=fs.inputs.WEIGHT.offset,ta=rs.sources[rs.joints.inputs.JOINT],da=rs.sources[rs.joints.inputs.INV_BIND_MATRIX],Qs=ls[fs.inputs.WEIGHT.id].array;let ua=0,ca,Aa,ga;for(ca=0,ga=Bs.length;ca<ga;ca++){const Ba=Bs[ca],Pa=[];for(Aa=0;Aa<Ba;Aa++){const Da=Ls[ua+sa],Ja=Ls[ua+Ks],ja=Qs[Ja];Pa.push({index:Da,weight:ja}),ua+=2}for(Pa.sort(ka),Aa=0;Aa<4;Aa++){const Da=Pa[Aa];Da!==void 0?(hs.indices.array.push(Da.index),hs.weights.array.push(Da.weight)):(hs.indices.array.push(0),hs.weights.array.push(0))}}for(rs.bindShapeMatrix?hs.bindMatrix=new Matrix4().fromArray(rs.bindShapeMatrix).transpose():hs.bindMatrix=new Matrix4().identity(),ca=0,ga=ta.array.length;ca<ga;ca++){const Ba=ta.array[ca],Pa=new Matrix4().fromArray(da.array,ca*da.stride).transpose();hs.joints.push({name:Ba,boneInverse:Pa})}return hs;function ka(Ba,Pa){return Pa.weight-Ba.weight}}function $r(rs){return vr(wa.controllers[rs],Xi)}function Vr(rs){const ts={init_from:ir(rs,"init_from")[0].textContent};wa.images[rs.getAttribute("id")]=ts}function Gr(rs){return rs.build!==void 0?rs.build:rs.init_from}function qr(rs){const ts=wa.images[rs];return ts!==void 0?vr(ts,Gr):(console.warn("THREE.ColladaLoader: Couldn't find image with ID:",rs),null)}function ji(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"profile_COMMON":ts.profile=Jr(fs);break}}wa.effects[rs.getAttribute("id")]=ts}function Jr(rs){const ts={surfaces:{},samplers:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"newparam":Ji(fs,ts);break;case"technique":ts.technique=Zr(fs);break;case"extra":ts.extra=ms(fs);break}}return ts}function Ji(rs,ts){const hs=rs.getAttribute("sid");for(let ls=0,fs=rs.childNodes.length;ls<fs;ls++){const Bs=rs.childNodes[ls];if(Bs.nodeType===1)switch(Bs.nodeName){case"surface":ts.surfaces[hs]=Ki(Bs);break;case"sampler2D":ts.samplers[hs]=Zi(Bs);break}}}function Ki(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"init_from":ts.init_from=fs.textContent;break}}return ts}function Zi(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"source":ts.source=fs.textContent;break}}return ts}function Zr(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"constant":case"lambert":case"blinn":case"phong":ts.type=fs.nodeName,ts.parameters=is(fs);break;case"extra":ts.extra=ms(fs);break}}return ts}function is(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"emission":case"diffuse":case"specular":case"bump":case"ambient":case"shininess":case"transparency":ts[fs.nodeName]=os(fs);break;case"transparent":ts[fs.nodeName]={opaque:fs.hasAttribute("opaque")?fs.getAttribute("opaque"):"A_ONE",data:os(fs)};break}}return ts}function os(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"color":ts[fs.nodeName]=sr(fs.textContent);break;case"float":ts[fs.nodeName]=parseFloat(fs.textContent);break;case"texture":ts[fs.nodeName]={id:fs.getAttribute("texture"),extra:cs(fs)};break}}return ts}function cs(rs){const ts={technique:{}};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"extra":ss(fs,ts);break}}return ts}function ss(rs,ts){for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique":es(fs,ts);break}}}function es(rs,ts){for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":ts.technique[fs.nodeName]=parseFloat(fs.textContent);break;case"wrapU":case"wrapV":fs.textContent.toUpperCase()==="TRUE"?ts.technique[fs.nodeName]=1:fs.textContent.toUpperCase()==="FALSE"?ts.technique[fs.nodeName]=0:ts.technique[fs.nodeName]=parseInt(fs.textContent);break;case"bump":ts[fs.nodeName]=Gi(fs);break}}}function ms(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique":ts.technique=Yi(fs);break}}return ts}function Yi(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"double_sided":ts[fs.nodeName]=parseInt(fs.textContent);break;case"bump":ts[fs.nodeName]=Gi(fs);break}}return ts}function Gi(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"texture":ts[fs.nodeName]={id:fs.getAttribute("texture"),texcoord:fs.getAttribute("texcoord"),extra:cs(fs)};break}}return ts}function Ni(rs){return rs}function Ri(rs){return vr(wa.effects[rs],Ni)}function qi(rs){const ts={name:rs.getAttribute("name")};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"instance_effect":ts.url=or(fs.getAttribute("url"));break}}wa.materials[rs.getAttribute("id")]=ts}function as(rs){let ts,hs=rs.slice((rs.lastIndexOf(".")-1>>>0)+2);switch(hs=hs.toLowerCase(),hs){case"tga":ts=Ha;break;default:ts=Va}return ts}function us(rs){const ts=Ri(rs.url),hs=ts.profile.technique;let ls;switch(hs.type){case"phong":case"blinn":ls=new MeshPhongMaterial;break;case"lambert":ls=new MeshLambertMaterial;break;default:ls=new MeshBasicMaterial;break}ls.name=rs.name||"";function fs(Ks,ta=null){const da=ts.profile.samplers[Ks.id];let Qs=null;if(da!==void 0){const ua=ts.profile.surfaces[da.source];Qs=qr(ua.init_from)}else console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530)."),Qs=qr(Ks.id);if(Qs!==null){const ua=as(Qs);if(ua!==void 0){const ca=ua.load(Qs),Aa=Ks.extra;if(Aa!==void 0&&Aa.technique!==void 0&&cr(Aa.technique)===!1){const ga=Aa.technique;ca.wrapS=ga.wrapU?RepeatWrapping:ClampToEdgeWrapping,ca.wrapT=ga.wrapV?RepeatWrapping:ClampToEdgeWrapping,ca.offset.set(ga.offsetU||0,ga.offsetV||0),ca.repeat.set(ga.repeatU||1,ga.repeatV||1)}else ca.wrapS=RepeatWrapping,ca.wrapT=RepeatWrapping;return ta!==null&&(ca.colorSpace=ta),ca}else return console.warn("THREE.ColladaLoader: Loader for texture %s not found.",Qs),null}else return console.warn("THREE.ColladaLoader: Couldn't create texture with ID:",Ks.id),null}const Bs=hs.parameters;for(const Ks in Bs){const ta=Bs[Ks];switch(Ks){case"diffuse":ta.color&&ls.color.fromArray(ta.color),ta.texture&&(ls.map=fs(ta.texture,SRGBColorSpace));break;case"specular":ta.color&&ls.specular&&ls.specular.fromArray(ta.color),ta.texture&&(ls.specularMap=fs(ta.texture));break;case"bump":ta.texture&&(ls.normalMap=fs(ta.texture));break;case"ambient":ta.texture&&(ls.lightMap=fs(ta.texture,SRGBColorSpace));break;case"shininess":ta.float&&ls.shininess&&(ls.shininess=ta.float);break;case"emission":ta.color&&ls.emissive&&ls.emissive.fromArray(ta.color),ta.texture&&(ls.emissiveMap=fs(ta.texture,SRGBColorSpace));break}}ColorManagement.toWorkingColorSpace(ls.color,SRGBColorSpace),ls.specular&&ColorManagement.toWorkingColorSpace(ls.specular,SRGBColorSpace),ls.emissive&&ColorManagement.toWorkingColorSpace(ls.emissive,SRGBColorSpace);let Ls=Bs.transparent,sa=Bs.transparency;if(sa===void 0&&Ls&&(sa={float:1}),Ls===void 0&&sa&&(Ls={opaque:"A_ONE",data:{color:[1,1,1,1]}}),Ls&&sa)if(Ls.data.texture)ls.transparent=!0;else{const Ks=Ls.data.color;switch(Ls.opaque){case"A_ONE":ls.opacity=Ks[3]*sa.float;break;case"RGB_ZERO":ls.opacity=1-Ks[0]*sa.float;break;case"A_ZERO":ls.opacity=1-Ks[3]*sa.float;break;case"RGB_ONE":ls.opacity=Ks[0]*sa.float;break;default:console.warn('THREE.ColladaLoader: Invalid opaque type "%s" of transparent tag.',Ls.opaque)}ls.opacity<1&&(ls.transparent=!0)}if(hs.extra!==void 0&&hs.extra.technique!==void 0){const Ks=hs.extra.technique;for(const ta in Ks){const da=Ks[ta];switch(ta){case"double_sided":ls.side=da===1?DoubleSide:FrontSide;break;case"bump":ls.normalMap=fs(da.texture),ls.normalScale=new Vector2(1,1);break}}}return ls}function gs(rs){return vr(wa.materials[rs],us)}function vs(rs){const ts={name:rs.getAttribute("name")};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"optics":ts.optics=_s(fs);break}}wa.cameras[rs.getAttribute("id")]=ts}function _s(rs){for(let ts=0;ts<rs.childNodes.length;ts++){const hs=rs.childNodes[ts];switch(hs.nodeName){case"technique_common":return As(hs)}}return{}}function As(rs){const ts={};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];switch(ls.nodeName){case"perspective":case"orthographic":ts.technique=ls.nodeName,ts.parameters=xs(ls);break}}return ts}function xs(rs){const ts={};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];switch(ls.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":ts[ls.nodeName]=parseFloat(ls.textContent);break}}return ts}function Es(rs){let ts;switch(rs.optics.technique){case"perspective":ts=new PerspectiveCamera(rs.optics.parameters.yfov,rs.optics.parameters.aspect_ratio,rs.optics.parameters.znear,rs.optics.parameters.zfar);break;case"orthographic":let hs=rs.optics.parameters.ymag,ls=rs.optics.parameters.xmag;const fs=rs.optics.parameters.aspect_ratio;ls=ls===void 0?hs*fs:ls,hs=hs===void 0?ls/fs:hs,ls*=.5,hs*=.5,ts=new OrthographicCamera(-ls,ls,hs,-hs,rs.optics.parameters.znear,rs.optics.parameters.zfar);break;default:ts=new PerspectiveCamera;break}return ts.name=rs.name||"",ts}function Ps(rs){const ts=wa.cameras[rs];return ts!==void 0?vr(ts,Es):(console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",rs),null)}function Ns(rs){let ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"technique_common":ts=Vs(fs);break}}wa.lights[rs.getAttribute("id")]=ts}function Vs(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"directional":case"point":case"spot":case"ambient":ts.technique=fs.nodeName,ts.parameters=Us(fs)}}return ts}function Us(rs){const ts={};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"color":const Bs=sr(fs.textContent);ts.color=new Color().fromArray(Bs),ColorManagement.toWorkingColorSpace(ts.color,SRGBColorSpace);break;case"falloff_angle":ts.falloffAngle=parseFloat(fs.textContent);break;case"quadratic_attenuation":const Ls=parseFloat(fs.textContent);ts.distance=Ls?Math.sqrt(1/Ls):0;break}}return ts}function Os(rs){let ts;switch(rs.technique){case"directional":ts=new DirectionalLight;break;case"point":ts=new PointLight;break;case"spot":ts=new SpotLight;break;case"ambient":ts=new AmbientLight;break}return rs.parameters.color&&ts.color.copy(rs.parameters.color),rs.parameters.distance&&(ts.distance=rs.parameters.distance),ts}function ws(rs){const ts=wa.lights[rs];return ts!==void 0?vr(ts,Os):(console.warn("THREE.ColladaLoader: Couldn't find light with ID:",rs),null)}function bs(rs){const ts={name:rs.getAttribute("name"),sources:{},vertices:{},primitives:[]},hs=ir(rs,"mesh")[0];if(hs!==void 0){for(let ls=0;ls<hs.childNodes.length;ls++){const fs=hs.childNodes[ls];if(fs.nodeType!==1)continue;const Bs=fs.getAttribute("id");switch(fs.nodeName){case"source":ts.sources[Bs]=Ss(fs);break;case"vertices":ts.vertices=Rs(fs);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",fs.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":ts.primitives.push(Hs(fs));break;default:console.log(fs)}}wa.geometries[rs.getAttribute("id")]=ts}}function Ss(rs){const ts={array:[],stride:3};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"float_array":ts.array=sr(ls.textContent);break;case"Name_array":ts.array=nr(ls.textContent);break;case"technique_common":const fs=ir(ls,"accessor")[0];fs!==void 0&&(ts.stride=parseInt(fs.getAttribute("stride")));break}}return ts}function Rs(rs){const ts={};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];ls.nodeType===1&&(ts[ls.getAttribute("semantic")]=or(ls.getAttribute("source")))}return ts}function Hs(rs){const ts={type:rs.nodeName,material:rs.getAttribute("material"),count:parseInt(rs.getAttribute("count")),inputs:{},stride:0,hasUV:!1};for(let hs=0,ls=rs.childNodes.length;hs<ls;hs++){const fs=rs.childNodes[hs];if(fs.nodeType===1)switch(fs.nodeName){case"input":const Bs=or(fs.getAttribute("source")),Ls=fs.getAttribute("semantic"),sa=parseInt(fs.getAttribute("offset")),Ks=parseInt(fs.getAttribute("set")),ta=Ks>0?Ls+Ks:Ls;ts.inputs[ta]={id:Bs,offset:sa},ts.stride=Math.max(ts.stride,sa+1),Ls==="TEXCOORD"&&(ts.hasUV=!0);break;case"vcount":ts.vcount=ar(fs.textContent);break;case"p":ts.p=ar(fs.textContent);break}}return ts}function ks(rs){const ts={};for(let hs=0;hs<rs.length;hs++){const ls=rs[hs];ts[ls.type]===void 0&&(ts[ls.type]=[]),ts[ls.type].push(ls)}return ts}function na(rs){let ts=0;for(let hs=0,ls=rs.length;hs<ls;hs++)rs[hs].hasUV===!0&&ts++;ts>0&&ts<rs.length&&(rs.uvsNeedsFix=!0)}function xa(rs){const ts={},hs=rs.sources,ls=rs.vertices,fs=rs.primitives;if(fs.length===0)return{};const Bs=ks(fs);for(const Ls in Bs){const sa=Bs[Ls];na(sa),ts[Ls]=fa(sa,hs,ls)}return ts}function fa(rs,ts,hs){const ls={},fs={array:[],stride:0},Bs={array:[],stride:0},Ls={array:[],stride:0},sa={array:[],stride:0},Ks={array:[],stride:0},ta={array:[],stride:4},da={array:[],stride:4},Qs=new BufferGeometry,ua=[];let ca=0;for(let Aa=0;Aa<rs.length;Aa++){const ga=rs[Aa],ka=ga.inputs;let Ba=0;switch(ga.type){case"lines":case"linestrips":Ba=ga.count*2;break;case"triangles":Ba=ga.count*3;break;case"polylist":for(let Pa=0;Pa<ga.count;Pa++){const Da=ga.vcount[Pa];switch(Da){case 3:Ba+=3;break;case 4:Ba+=6;break;default:Ba+=(Da-2)*3;break}}break;default:console.warn("THREE.ColladaLoader: Unknow primitive type:",ga.type)}Qs.addGroup(ca,Ba,Aa),ca+=Ba,ga.material&&ua.push(ga.material);for(const Pa in ka){const Da=ka[Pa];switch(Pa){case"VERTEX":for(const Ja in hs){const ja=hs[Ja];switch(Ja){case"POSITION":const ro=fs.array.length;if(Gs(ga,ts[ja],Da.offset,fs.array),fs.stride=ts[ja].stride,ts.skinWeights&&ts.skinIndices&&(Gs(ga,ts.skinIndices,Da.offset,ta.array),Gs(ga,ts.skinWeights,Da.offset,da.array)),ga.hasUV===!1&&rs.uvsNeedsFix===!0){const mo=(fs.array.length-ro)/fs.stride;for(let co=0;co<mo;co++)Ls.array.push(0,0)}break;case"NORMAL":Gs(ga,ts[ja],Da.offset,Bs.array),Bs.stride=ts[ja].stride;break;case"COLOR":Gs(ga,ts[ja],Da.offset,Ks.array),Ks.stride=ts[ja].stride;break;case"TEXCOORD":Gs(ga,ts[ja],Da.offset,Ls.array),Ls.stride=ts[ja].stride;break;case"TEXCOORD1":Gs(ga,ts[ja],Da.offset,sa.array),Ls.stride=ts[ja].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',Ja)}}break;case"NORMAL":Gs(ga,ts[Da.id],Da.offset,Bs.array),Bs.stride=ts[Da.id].stride;break;case"COLOR":Gs(ga,ts[Da.id],Da.offset,Ks.array,!0),Ks.stride=ts[Da.id].stride;break;case"TEXCOORD":Gs(ga,ts[Da.id],Da.offset,Ls.array),Ls.stride=ts[Da.id].stride;break;case"TEXCOORD1":Gs(ga,ts[Da.id],Da.offset,sa.array),sa.stride=ts[Da.id].stride;break}}}return fs.array.length>0&&Qs.setAttribute("position",new Float32BufferAttribute(fs.array,fs.stride)),Bs.array.length>0&&Qs.setAttribute("normal",new Float32BufferAttribute(Bs.array,Bs.stride)),Ks.array.length>0&&Qs.setAttribute("color",new Float32BufferAttribute(Ks.array,Ks.stride)),Ls.array.length>0&&Qs.setAttribute("uv",new Float32BufferAttribute(Ls.array,Ls.stride)),sa.array.length>0&&Qs.setAttribute("uv1",new Float32BufferAttribute(sa.array,sa.stride)),ta.array.length>0&&Qs.setAttribute("skinIndex",new Float32BufferAttribute(ta.array,ta.stride)),da.array.length>0&&Qs.setAttribute("skinWeight",new Float32BufferAttribute(da.array,da.stride)),ls.data=Qs,ls.type=rs[0].type,ls.materialKeys=ua,ls}function Gs(rs,ts,hs,ls,fs=!1){const Bs=rs.p,Ls=rs.stride,sa=rs.vcount;function Ks(Qs){let ua=Bs[Qs+hs]*da;const ca=ua+da;for(;ua<ca;ua++)ls.push(ta[ua]);if(fs){const Aa=ls.length-da-1;Wa.setRGB(ls[Aa+0],ls[Aa+1],ls[Aa+2],SRGBColorSpace),ls[Aa+0]=Wa.r,ls[Aa+1]=Wa.g,ls[Aa+2]=Wa.b}}const ta=ts.array,da=ts.stride;if(rs.vcount!==void 0){let Qs=0;for(let ua=0,ca=sa.length;ua<ca;ua++){const Aa=sa[ua];if(Aa===4){const ga=Qs+Ls*0,ka=Qs+Ls*1,Ba=Qs+Ls*2,Pa=Qs+Ls*3;Ks(ga),Ks(ka),Ks(Pa),Ks(ka),Ks(Ba),Ks(Pa)}else if(Aa===3){const ga=Qs+Ls*0,ka=Qs+Ls*1,Ba=Qs+Ls*2;Ks(ga),Ks(ka),Ks(Ba)}else if(Aa>4)for(let ga=1,ka=Aa-2;ga<=ka;ga++){const Ba=Qs+Ls*0,Pa=Qs+Ls*ga,Da=Qs+Ls*(ga+1);Ks(Ba),Ks(Pa),Ks(Da)}Qs+=Ls*Aa}}else for(let Qs=0,ua=Bs.length;Qs<ua;Qs+=Ls)Ks(Qs)}function Zs(rs){return vr(wa.geometries[rs],xa)}function Ys(rs){const ts={name:rs.getAttribute("name")||"",joints:{},links:[]};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"technique_common":Ta(ls,ts);break}}wa.kinematicsModels[rs.getAttribute("id")]=ts}function Js(rs){return rs.build!==void 0?rs.build:rs}function aa(rs){return vr(wa.kinematicsModels[rs],Js)}function Ta(rs,ts){for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"joint":ts.joints[ls.getAttribute("sid")]=za(ls);break;case"link":ts.links.push(Qa(ls));break}}}function za(rs){let ts;for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"prismatic":case"revolute":ts=Ga(ls);break}}return ts}function Ga(rs){const ts={sid:rs.getAttribute("sid"),name:rs.getAttribute("name")||"",axis:new Vector3$1,limits:{min:0,max:0},type:rs.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"axis":const fs=sr(ls.textContent);ts.axis.fromArray(fs);break;case"limits":const Bs=ls.getElementsByTagName("max")[0],Ls=ls.getElementsByTagName("min")[0];ts.limits.max=parseFloat(Bs.textContent),ts.limits.min=parseFloat(Ls.textContent);break}}return ts.limits.min>=ts.limits.max&&(ts.static=!0),ts.middlePosition=(ts.limits.min+ts.limits.max)/2,ts}function Qa(rs){const ts={sid:rs.getAttribute("sid"),name:rs.getAttribute("name")||"",attachments:[],transforms:[]};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"attachment_full":ts.attachments.push($a(ls));break;case"matrix":case"translate":case"rotate":ts.transforms.push(Ya(ls));break}}return ts}function $a(rs){const ts={joint:rs.getAttribute("joint").split("/").pop(),transforms:[],links:[]};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"link":ts.links.push(Qa(ls));break;case"matrix":case"translate":case"rotate":ts.transforms.push(Ya(ls));break}}return ts}function Ya(rs){const ts={type:rs.nodeName},hs=sr(rs.textContent);switch(ts.type){case"matrix":ts.obj=new Matrix4,ts.obj.fromArray(hs).transpose();break;case"translate":ts.obj=new Vector3$1,ts.obj.fromArray(hs);break;case"rotate":ts.obj=new Vector3$1,ts.obj.fromArray(hs),ts.angle=MathUtils.degToRad(hs[3]);break}return ts}function Xa(rs){const ts={name:rs.getAttribute("name")||"",rigidBodies:{}};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"rigid_body":ts.rigidBodies[ls.getAttribute("name")]={},eo(ls,ts.rigidBodies[ls.getAttribute("name")]);break}}wa.physicsModels[rs.getAttribute("id")]=ts}function eo(rs,ts){for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"technique_common":to(ls,ts);break}}}function to(rs,ts){for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"inertia":ts.inertia=sr(ls.textContent);break;case"mass":ts.mass=sr(ls.textContent)[0];break}}}function no(rs){const ts={bindJointAxis:[]};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"bind_joint_axis":ts.bindJointAxis.push(qa(ls));break}}wa.kinematicsScenes[or(rs.getAttribute("url"))]=ts}function qa(rs){const ts={target:rs.getAttribute("target").split("/").pop()};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType===1)switch(ls.nodeName){case"axis":const fs=ls.getElementsByTagName("param")[0];ts.axis=fs.textContent;const Bs=ts.axis.split("inst_").pop().split("axis")[0];ts.jointIndex=Bs.substring(0,Bs.length-1);break}}return ts}function Ka(rs){return rs.build!==void 0?rs.build:rs}function Qr(rs){return vr(wa.kinematicsScenes[rs],Ka)}function $i(){const rs=Object.keys(wa.kinematicsModels)[0],ts=Object.keys(wa.kinematicsScenes)[0],hs=Object.keys(wa.visualScenes)[0];if(rs===void 0||ts===void 0)return;const ls=aa(rs),fs=Qr(ts),Bs=ma(hs),Ls=fs.bindJointAxis,sa={};for(let da=0,Qs=Ls.length;da<Qs;da++){const ua=Ls[da],ca=ha.querySelector('[sid="'+ua.target+'"]');if(ca){const Aa=ca.parentElement;Ks(ua.jointIndex,Aa)}}function Ks(da,Qs){const ua=Qs.getAttribute("name"),ca=ls.joints[da];Bs.traverse(function(Aa){Aa.name===ua&&(sa[da]={object:Aa,transforms:ns(Qs),joint:ca,position:ca.zeroPosition})})}const ta=new Matrix4;lo={joints:ls&&ls.joints,getJointValue:function(da){const Qs=sa[da];if(Qs)return Qs.position;console.warn("THREE.ColladaLoader: Joint "+da+" doesn't exist.")},setJointValue:function(da,Qs){const ua=sa[da];if(ua){const ca=ua.joint;if(Qs>ca.limits.max||Qs<ca.limits.min)console.warn("THREE.ColladaLoader: Joint "+da+" value "+Qs+" outside of limits (min: "+ca.limits.min+", max: "+ca.limits.max+").");else if(ca.static)console.warn("THREE.ColladaLoader: Joint "+da+" is static.");else{const Aa=ua.object,ga=ca.axis,ka=ua.transforms;ps.identity();for(let Ba=0;Ba<ka.length;Ba++){const Pa=ka[Ba];if(Pa.sid&&Pa.sid.indexOf(da)!==-1)switch(ca.type){case"revolute":ps.multiply(ta.makeRotationAxis(ga,MathUtils.degToRad(Qs)));break;case"prismatic":ps.multiply(ta.makeTranslation(ga.x*Qs,ga.y*Qs,ga.z*Qs));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+ca.type);break}else switch(Pa.type){case"matrix":ps.multiply(Pa.obj);break;case"translate":ps.multiply(ta.makeTranslation(Pa.obj.x,Pa.obj.y,Pa.obj.z));break;case"scale":ps.scale(Pa.obj);break;case"rotate":ps.multiply(ta.makeRotationAxis(Pa.obj,Pa.angle));break}}Aa.matrix.copy(ps),Aa.matrix.decompose(Aa.position,Aa.quaternion,Aa.scale),sa[da].position=Qs}}else console.log("THREE.ColladaLoader: "+da+" does not exist.")}}}function ns(rs){const ts=[],hs=ha.querySelector('[id="'+rs.id+'"]');for(let ls=0;ls<hs.childNodes.length;ls++){const fs=hs.childNodes[ls];if(fs.nodeType!==1)continue;let Bs,Ls;switch(fs.nodeName){case"matrix":Bs=sr(fs.textContent);const sa=new Matrix4().fromArray(Bs).transpose();ts.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:sa});break;case"translate":case"scale":Bs=sr(fs.textContent),Ls=new Vector3$1().fromArray(Bs),ts.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:Ls});break;case"rotate":Bs=sr(fs.textContent),Ls=new Vector3$1().fromArray(Bs);const Ks=MathUtils.degToRad(Bs[3]);ts.push({sid:fs.getAttribute("sid"),type:fs.nodeName,obj:Ls,angle:Ks});break}}return ts}function ds(rs){const ts=rs.getElementsByTagName("node");for(let hs=0;hs<ts.length;hs++){const ls=ts[hs];ls.hasAttribute("id")===!1&&ls.setAttribute("id",lr())}}const ps=new Matrix4,ys=new Vector3$1;function Ts(rs){const ts={name:rs.getAttribute("name")||"",type:rs.getAttribute("type"),id:rs.getAttribute("id"),sid:rs.getAttribute("sid"),matrix:new Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];if(ls.nodeType!==1)continue;let fs;switch(ls.nodeName){case"node":ts.nodes.push(ls.getAttribute("id")),Ts(ls);break;case"instance_camera":ts.instanceCameras.push(or(ls.getAttribute("url")));break;case"instance_controller":ts.instanceControllers.push(Ds(ls));break;case"instance_light":ts.instanceLights.push(or(ls.getAttribute("url")));break;case"instance_geometry":ts.instanceGeometries.push(Ds(ls));break;case"instance_node":ts.instanceNodes.push(or(ls.getAttribute("url")));break;case"matrix":fs=sr(ls.textContent),ts.matrix.multiply(ps.fromArray(fs).transpose()),ts.transforms[ls.getAttribute("sid")]=ls.nodeName;break;case"translate":fs=sr(ls.textContent),ys.fromArray(fs),ts.matrix.multiply(ps.makeTranslation(ys.x,ys.y,ys.z)),ts.transforms[ls.getAttribute("sid")]=ls.nodeName;break;case"rotate":fs=sr(ls.textContent);const Bs=MathUtils.degToRad(fs[3]);ts.matrix.multiply(ps.makeRotationAxis(ys.fromArray(fs),Bs)),ts.transforms[ls.getAttribute("sid")]=ls.nodeName;break;case"scale":fs=sr(ls.textContent),ts.matrix.scale(ys.fromArray(fs)),ts.transforms[ls.getAttribute("sid")]=ls.nodeName;break;case"extra":break;default:console.log(ls)}}return qs(ts.id)?console.warn("THREE.ColladaLoader: There is already a node with ID %s. Exclude current node from further processing.",ts.id):wa.nodes[ts.id]=ts,ts}function Ds(rs){const ts={id:or(rs.getAttribute("url")),materials:{},skeletons:[]};for(let hs=0;hs<rs.childNodes.length;hs++){const ls=rs.childNodes[hs];switch(ls.nodeName){case"bind_material":const fs=ls.getElementsByTagName("instance_material");for(let Bs=0;Bs<fs.length;Bs++){const Ls=fs[Bs],sa=Ls.getAttribute("symbol"),Ks=Ls.getAttribute("target");ts.materials[sa]=or(Ks)}break;case"skeleton":ts.skeletons.push(or(ls.textContent));break;default:break}}return ts}function Ms(rs,ts){const hs=[],ls=[];let fs,Bs,Ls;for(fs=0;fs<rs.length;fs++){const ta=rs[fs];let da;if(qs(ta))da=Xs(ta),Cs(da,ts,hs);else if(Sa(ta)){const ua=wa.visualScenes[ta].children;for(let ca=0;ca<ua.length;ca++){const Aa=ua[ca];if(Aa.type==="JOINT"){const ga=Xs(Aa.id);Cs(ga,ts,hs)}}}else console.error("THREE.ColladaLoader: Unable to find root bone of skeleton with ID:",ta)}for(fs=0;fs<ts.length;fs++)for(Bs=0;Bs<hs.length;Bs++)if(Ls=hs[Bs],Ls.bone.name===ts[fs].name){ls[fs]=Ls,Ls.processed=!0;break}for(fs=0;fs<hs.length;fs++)Ls=hs[fs],Ls.processed===!1&&(ls.push(Ls),Ls.processed=!0);const sa=[],Ks=[];for(fs=0;fs<ls.length;fs++)Ls=ls[fs],sa.push(Ls.bone),Ks.push(Ls.boneInverse);return new Skeleton(sa,Ks)}function Cs(rs,ts,hs){rs.traverse(function(ls){if(ls.isBone===!0){let fs;for(let Bs=0;Bs<ts.length;Bs++){const Ls=ts[Bs];if(Ls.name===ls.name){fs=Ls.boneInverse;break}}fs===void 0&&(fs=new Matrix4),hs.push({bone:ls,boneInverse:fs,processed:!1})}})}function Is(rs){const ts=[],hs=rs.matrix,ls=rs.nodes,fs=rs.type,Bs=rs.instanceCameras,Ls=rs.instanceControllers,sa=rs.instanceLights,Ks=rs.instanceGeometries,ta=rs.instanceNodes;for(let Qs=0,ua=ls.length;Qs<ua;Qs++)ts.push(Xs(ls[Qs]));for(let Qs=0,ua=Bs.length;Qs<ua;Qs++){const ca=Ps(Bs[Qs]);ca!==null&&ts.push(ca.clone())}for(let Qs=0,ua=Ls.length;Qs<ua;Qs++){const ca=Ls[Qs],Aa=$r(ca.id),ga=Zs(Aa.id),ka=js(ga,ca.materials),Ba=ca.skeletons,Pa=Aa.skin.joints,Da=Ms(Ba,Pa);for(let Ja=0,ja=ka.length;Ja<ja;Ja++){const ro=ka[Ja];ro.isSkinnedMesh&&(ro.bind(Da,Aa.skin.bindMatrix),ro.normalizeSkinWeights()),ts.push(ro)}}for(let Qs=0,ua=sa.length;Qs<ua;Qs++){const ca=ws(sa[Qs]);ca!==null&&ts.push(ca.clone())}for(let Qs=0,ua=Ks.length;Qs<ua;Qs++){const ca=Ks[Qs],Aa=Zs(ca.id),ga=js(Aa,ca.materials);for(let ka=0,Ba=ga.length;ka<Ba;ka++)ts.push(ga[ka])}for(let Qs=0,ua=ta.length;Qs<ua;Qs++)ts.push(Xs(ta[Qs]).clone());let da;if(ls.length===0&&ts.length===1)da=ts[0];else{da=fs==="JOINT"?new Bone:new Group;for(let Qs=0;Qs<ts.length;Qs++)da.add(ts[Qs])}return da.name=fs==="JOINT"?rs.sid:rs.name,da.matrix.copy(hs),da.matrix.decompose(da.position,da.quaternion,da.scale),da}const Fs=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935});function Ws(rs,ts){const hs=[];for(let ls=0,fs=rs.length;ls<fs;ls++){const Bs=ts[rs[ls]];Bs===void 0?(console.warn("THREE.ColladaLoader: Material with key %s not found. Apply fallback material.",rs[ls]),hs.push(Fs)):hs.push(gs(Bs))}return hs}function js(rs,ts){const hs=[];for(const ls in rs){const fs=rs[ls],Bs=Ws(fs.materialKeys,ts);if(Bs.length===0&&(ls==="lines"||ls==="linestrips"?Bs.push(new LineBasicMaterial):Bs.push(new MeshPhongMaterial)),ls==="lines"||ls==="linestrips")for(let ta=0,da=Bs.length;ta<da;ta++){const Qs=Bs[ta];if(Qs.isMeshPhongMaterial===!0||Qs.isMeshLambertMaterial===!0){const ua=new LineBasicMaterial;ua.color.copy(Qs.color),ua.opacity=Qs.opacity,ua.transparent=Qs.transparent,Bs[ta]=ua}}const Ls=fs.data.attributes.skinIndex!==void 0,sa=Bs.length===1?Bs[0]:Bs;let Ks;switch(ls){case"lines":Ks=new LineSegments(fs.data,sa);break;case"linestrips":Ks=new Line(fs.data,sa);break;case"triangles":case"polylist":Ls?Ks=new SkinnedMesh(fs.data,sa):Ks=new Mesh(fs.data,sa);break}hs.push(Ks)}return hs}function qs(rs){return wa.nodes[rs]!==void 0}function Xs(rs){return vr(wa.nodes[rs],Is)}function $s(rs){const ts={name:rs.getAttribute("name"),children:[]};ds(rs);const hs=ir(rs,"node");for(let ls=0;ls<hs.length;ls++)ts.children.push(Ts(hs[ls]));wa.visualScenes[rs.getAttribute("id")]=ts}function zs(rs){const ts=new Group;ts.name=rs.name;const hs=rs.children;for(let ls=0;ls<hs.length;ls++){const fs=hs[ls];ts.add(Xs(fs.id))}return ts}function Sa(rs){return wa.visualScenes[rs]!==void 0}function ma(rs){return vr(wa.visualScenes[rs],zs)}function Oa(rs){const ts=ir(rs,"instance_visual_scene")[0];return ma(or(ts.getAttribute("url")))}function Ma(){const rs=wa.clips;if(cr(rs)===!0){if(cr(wa.animations)===!1){const ts=[];for(const hs in wa.animations){const ls=yr(hs);for(let fs=0,Bs=ls.length;fs<Bs;fs++)ts.push(ls[fs])}Za.push(new AnimationClip("default",-1,ts))}}else for(const ts in rs)Za.push(Br(ts))}function ya(rs){let ts="";const hs=[rs];for(;hs.length;){const ls=hs.shift();ls.nodeType===Node.TEXT_NODE?ts+=ls.textContent:(ts+=`
`,hs.push.apply(hs,ls.childNodes))}return ts.trim()}if(er.length===0)return{scene:new Scene};const Ua=new DOMParser().parseFromString(er,"application/xml"),ha=ir(Ua,"COLLADA")[0],Ca=Ua.getElementsByTagName("parsererror")[0];if(Ca!==void 0){const rs=ir(Ca,"div")[0];let ts;return rs?ts=rs.textContent:ts=ya(Ca),console.error(`THREE.ColladaLoader: Failed to parse collada file.
`,ts),null}const Ea=ha.getAttribute("version");console.debug("THREE.ColladaLoader: File version",Ea);const ba=ur(ir(ha,"asset")[0]),Va=new TextureLoader(this.manager);Va.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);let Ha;TGALoader&&(Ha=new TGALoader(this.manager),Ha.setPath(this.resourcePath||tr));const Wa=new Color,Za=[];let lo={},po=0;const wa={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},physicsModels:{},kinematicsScenes:{}};pr(ha,"library_animations","animation",mr),pr(ha,"library_animation_clips","animation_clip",Nr),pr(ha,"library_controllers","controller",Wr),pr(ha,"library_images","image",Vr),pr(ha,"library_effects","effect",ji),pr(ha,"library_materials","material",qi),pr(ha,"library_cameras","camera",vs),pr(ha,"library_lights","light",Ns),pr(ha,"library_geometries","geometry",bs),pr(ha,"library_nodes","node",Ts),pr(ha,"library_visual_scenes","visual_scene",$s),pr(ha,"library_kinematics_models","kinematics_model",Ys),pr(ha,"library_physics_models","physics_model",Xa),pr(ha,"scene","instance_kinematics_scene",no),gr(wa.animations,Ar),gr(wa.clips,Ur),gr(wa.controllers,Xi),gr(wa.images,Gr),gr(wa.effects,Ni),gr(wa.materials,us),gr(wa.cameras,Es),gr(wa.lights,Os),gr(wa.geometries,xa),gr(wa.visualScenes,zs),Ma(),$i();const so=Oa(ir(ha,"scene")[0]);return so.animations=Za,ba.upAxis==="Z_UP"&&(console.warn("THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system. The loader just rotates the asset to transform it into Y-UP. The vertex data are not converted, see #24289."),so.rotation.set(-Math.PI/2,0,0)),so.scale.multiplyScalar(ba.unit),{get animations(){return console.warn("THREE.ColladaLoader: Please access animations over scene.animations now."),Za},kinematics:lo,library:wa,scene:so}}}class DDSLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const ir={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},nr=542327876,sr=131072,ar=512,or=1024,lr=2048,cr=4096,ur=8192,dr=16384,hr=32768,pr=95,gr=96;function vr(Jr){return Jr.charCodeAt(0)+(Jr.charCodeAt(1)<<8)+(Jr.charCodeAt(2)<<16)+(Jr.charCodeAt(3)<<24)}function mr(Jr){return String.fromCharCode(Jr&255,Jr>>8&255,Jr>>16&255,Jr>>24&255)}function fr(Jr,Ji,Ki,Zi){const Zr=Ki*Zi*4,is=new Uint8Array(Jr,Ji,Zr),os=new Uint8Array(Zr);let cs=0,ss=0;for(let es=0;es<Zi;es++)for(let ms=0;ms<Ki;ms++){const Yi=is[ss];ss++;const Gi=is[ss];ss++;const Ni=is[ss];ss++;const Ri=is[ss];ss++,os[cs]=Ni,cs++,os[cs]=Gi,cs++,os[cs]=Yi,cs++,os[cs]=Ri,cs++}return os}const _r=vr("DXT1"),Ar=vr("DXT3"),yr=vr("DXT5"),wr=vr("ETC1"),xr=vr("DX10"),Sr=31,br=5,Cr=0,Ir=1,Rr=2,Pr=3,Dr=4,Fr=7,Or=21,Nr=22,Ur=23,Br=24,Wr=25,Xr=26,Yr=28,Qi=0,Xi=new Int32Array(er,0,Sr);if(Xi[Cr]!==nr)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),ir;let Kr;const $r=Xi[Or];let Vr=!1,Gr=Xi[Ir]+4;switch($r){case _r:Kr=8,ir.format=RGB_S3TC_DXT1_Format;break;case Ar:Kr=16,ir.format=RGBA_S3TC_DXT3_Format;break;case yr:Kr=16,ir.format=RGBA_S3TC_DXT5_Format;break;case wr:Kr=8,ir.format=RGB_ETC1_Format;break;case xr:Gr+=br*4;const Ji=new Int32Array(er,(Sr+1)*4,br)[Qi];switch(Ji){case gr:{Kr=16,ir.format=RGB_BPTC_SIGNED_Format;break}case pr:{Kr=16,ir.format=RGB_BPTC_UNSIGNED_Format;break}default:return console.error("THREE.DDSLoader.parse: Unsupported DXGI_FORMAT code ",Ji),ir}break;default:if(Xi[Nr]===32&&Xi[Ur]&16711680&&Xi[Br]&65280&&Xi[Wr]&255&&Xi[Xr]&4278190080)Vr=!0,Kr=64,ir.format=RGBAFormat;else return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",mr($r)),ir}ir.mipmapCount=1,Xi[Rr]&sr&&tr!==!1&&(ir.mipmapCount=Math.max(1,Xi[Fr]));const qr=Xi[Yr];if(ir.isCubemap=!!(qr&ar),ir.isCubemap&&(!(qr&or)||!(qr&lr)||!(qr&cr)||!(qr&ur)||!(qr&dr)||!(qr&hr)))return console.error("THREE.DDSLoader.parse: Incomplete cubemap faces"),ir;ir.width=Xi[Dr],ir.height=Xi[Pr];const ji=ir.isCubemap?6:1;for(let Jr=0;Jr<ji;Jr++){let Ji=ir.width,Ki=ir.height;for(let Zi=0;Zi<ir.mipmapCount;Zi++){let Zr,is;Vr?(Zr=fr(er,Gr,Ji,Ki),is=Zr.length):(is=Math.max(4,Ji)/4*Math.max(4,Ki)/4*Kr,Zr=new Uint8Array(er,Gr,is));const os={data:Zr,width:Ji,height:Ki};ir.mipmaps.push(os),Gr+=is,Ji=Math.max(Ji>>1,1),Ki=Math.max(Ki>>1,1)}}return ir}}const _taskCache$1=new WeakMap;class DRACOLoader extends Loader{constructor(er){super(er),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(er){return this.decoderPath=er,this}setDecoderConfig(er){return this.decoderConfig=er,this}setWorkerLimit(er){return this.workerLimit=er,this}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("arraybuffer"),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.parse(ar,tr,nr)},ir,nr)}parse(er,tr,ir=()=>{}){this.decodeDracoFile(er,tr,null,null,SRGBColorSpace,ir).catch(ir)}decodeDracoFile(er,tr,ir,nr,sr=LinearSRGBColorSpace,ar=()=>{}){const or={attributeIDs:ir||this.defaultAttributeIDs,attributeTypes:nr||this.defaultAttributeTypes,useUniqueIDs:!!ir,vertexColorSpace:sr};return this.decodeGeometry(er,or).then(tr).catch(ar)}decodeGeometry(er,tr){const ir=JSON.stringify(tr);if(_taskCache$1.has(er)){const lr=_taskCache$1.get(er);if(lr.key===ir)return lr.promise;if(er.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let nr;const sr=this.workerNextTaskID++,ar=er.byteLength,or=this._getWorker(sr,ar).then(lr=>(nr=lr,new Promise((cr,ur)=>{nr._callbacks[sr]={resolve:cr,reject:ur},nr.postMessage({type:"decode",id:sr,taskConfig:tr,buffer:er},[er])}))).then(lr=>this._createGeometry(lr.geometry));return or.catch(()=>!0).then(()=>{nr&&sr&&this._releaseTask(nr,sr)}),_taskCache$1.set(er,{key:ir,promise:or}),or}_createGeometry(er){const tr=new BufferGeometry;er.index&&tr.setIndex(new BufferAttribute(er.index.array,1));for(let ir=0;ir<er.attributes.length;ir++){const nr=er.attributes[ir],sr=nr.name,ar=nr.array,or=nr.itemSize,lr=new BufferAttribute(ar,or);sr==="color"&&(this._assignVertexColorSpace(lr,nr.vertexColorSpace),lr.normalized=!(ar instanceof Float32Array)),tr.setAttribute(sr,lr)}return tr}_assignVertexColorSpace(er,tr){if(tr!==SRGBColorSpace)return;const ir=new Color;for(let nr=0,sr=er.count;nr<sr;nr++)ir.fromBufferAttribute(er,nr),ColorManagement.toWorkingColorSpace(ir,SRGBColorSpace),er.setXYZ(nr,ir.r,ir.g,ir.b)}_loadLibrary(er,tr){const ir=new FileLoader(this.manager);return ir.setPath(this.decoderPath),ir.setResponseType(tr),ir.setWithCredentials(this.withCredentials),new Promise((nr,sr)=>{ir.load(er,nr,void 0,sr)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const er=typeof WebAssembly!="object"||this.decoderConfig.type==="js",tr=[];return er?tr.push(this._loadLibrary("draco_decoder.js","text")):(tr.push(this._loadLibrary("draco_wasm_wrapper.js","text")),tr.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(tr).then(ir=>{const nr=ir[0];er||(this.decoderConfig.wasmBinary=ir[1]);const sr=DRACOWorker.toString(),ar=["/* draco decoder */",nr,"","/* worker */",sr.substring(sr.indexOf("{")+1,sr.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([ar]))}),this.decoderPending}_getWorker(er,tr){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const nr=new Worker(this.workerSourceURL);nr._callbacks={},nr._taskCosts={},nr._taskLoad=0,nr.postMessage({type:"init",decoderConfig:this.decoderConfig}),nr.onmessage=function(sr){const ar=sr.data;switch(ar.type){case"decode":nr._callbacks[ar.id].resolve(ar);break;case"error":nr._callbacks[ar.id].reject(ar);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+ar.type+'"')}},this.workerPool.push(nr)}else this.workerPool.sort(function(nr,sr){return nr._taskLoad>sr._taskLoad?-1:1});const ir=this.workerPool[this.workerPool.length-1];return ir._taskCosts[er]=tr,ir._taskLoad+=tr,ir})}_releaseTask(er,tr){er._taskLoad-=er._taskCosts[tr],delete er._callbacks[tr],delete er._taskCosts[tr]}debug(){console.log("Task load: ",this.workerPool.map(er=>er._taskLoad))}dispose(){for(let er=0;er<this.workerPool.length;++er)this.workerPool[er].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function DRACOWorker(){let rr,er;onmessage=function(ar){const or=ar.data;switch(or.type){case"init":rr=or.decoderConfig,er=new Promise(function(ur){rr.onModuleLoaded=function(dr){ur({draco:dr})},DracoDecoderModule(rr)});break;case"decode":const lr=or.buffer,cr=or.taskConfig;er.then(ur=>{const dr=ur.draco,hr=new dr.Decoder;try{const pr=tr(dr,hr,new Int8Array(lr),cr),gr=pr.attributes.map(vr=>vr.array.buffer);pr.index&&gr.push(pr.index.array.buffer),self.postMessage({type:"decode",id:or.id,geometry:pr},gr)}catch(pr){console.error(pr),self.postMessage({type:"error",id:or.id,error:pr.message})}finally{dr.destroy(hr)}});break}};function tr(ar,or,lr,cr){const ur=cr.attributeIDs,dr=cr.attributeTypes;let hr,pr;const gr=or.GetEncodedGeometryType(lr);if(gr===ar.TRIANGULAR_MESH)hr=new ar.Mesh,pr=or.DecodeArrayToMesh(lr,lr.byteLength,hr);else if(gr===ar.POINT_CLOUD)hr=new ar.PointCloud,pr=or.DecodeArrayToPointCloud(lr,lr.byteLength,hr);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!pr.ok()||hr.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+pr.error_msg());const vr={index:null,attributes:[]};for(const mr in ur){const fr=self[dr[mr]];let _r,Ar;if(cr.useUniqueIDs)Ar=ur[mr],_r=or.GetAttributeByUniqueId(hr,Ar);else{if(Ar=or.GetAttributeId(hr,ar[ur[mr]]),Ar===-1)continue;_r=or.GetAttribute(hr,Ar)}const yr=nr(ar,or,hr,mr,fr,_r);mr==="color"&&(yr.vertexColorSpace=cr.vertexColorSpace),vr.attributes.push(yr)}return gr===ar.TRIANGULAR_MESH&&(vr.index=ir(ar,or,hr)),ar.destroy(hr),vr}function ir(ar,or,lr){const ur=lr.num_faces()*3,dr=ur*4,hr=ar._malloc(dr);or.GetTrianglesUInt32Array(lr,dr,hr);const pr=new Uint32Array(ar.HEAPF32.buffer,hr,ur).slice();return ar._free(hr),{array:pr,itemSize:1}}function nr(ar,or,lr,cr,ur,dr){const hr=dr.num_components(),gr=lr.num_points()*hr,vr=gr*ur.BYTES_PER_ELEMENT,mr=sr(ar,ur),fr=ar._malloc(vr);or.GetAttributeDataArrayForAllPoints(lr,dr,mr,vr,fr);const _r=new ur(ar.HEAPF32.buffer,fr,gr).slice();return ar._free(fr),{name:cr,array:_r,itemSize:hr}}function sr(ar,or){switch(or){case Float32Array:return ar.DT_FLOAT32;case Int8Array:return ar.DT_INT8;case Int16Array:return ar.DT_INT16;case Int32Array:return ar.DT_INT32;case Uint8Array:return ar.DT_UINT8;case Uint16Array:return ar.DT_UINT16;case Uint32Array:return ar.DT_UINT32}}}let fbxTree,connections,sceneGraph;class FBXLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(this.manager);or.setPath(sr.path),or.setResponseType("arraybuffer"),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},ir,nr)}parse(er,tr){if(isFbxFormatBinary(er))fbxTree=new BinaryParser().parse(er);else{const nr=convertArrayBufferToString(er);if(!isFbxFormatASCII(nr))throw new Error("THREE.FBXLoader: Unknown format.");if(getFbxVersion(nr)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+getFbxVersion(nr));fbxTree=new TextParser().parse(nr)}const ir=new TextureLoader(this.manager).setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);return new FBXTreeParser(ir,this.manager).parse(fbxTree)}}class FBXTreeParser{constructor(er,tr){this.textureLoader=er,this.manager=tr}parse(){connections=this.parseConnections();const er=this.parseImages(),tr=this.parseTextures(er),ir=this.parseMaterials(tr),nr=this.parseDeformers(),sr=new GeometryParser$1().parse(nr);return this.parseScene(nr,sr,ir),sceneGraph}parseConnections(){const er=new Map;return"Connections"in fbxTree&&fbxTree.Connections.connections.forEach(function(ir){const nr=ir[0],sr=ir[1],ar=ir[2];er.has(nr)||er.set(nr,{parents:[],children:[]});const or={ID:sr,relationship:ar};er.get(nr).parents.push(or),er.has(sr)||er.set(sr,{parents:[],children:[]});const lr={ID:nr,relationship:ar};er.get(sr).children.push(lr)}),er}parseImages(){const er={},tr={};if("Video"in fbxTree.Objects){const ir=fbxTree.Objects.Video;for(const nr in ir){const sr=ir[nr],ar=parseInt(nr);if(er[ar]=sr.RelativeFilename||sr.Filename,"Content"in sr){const or=sr.Content instanceof ArrayBuffer&&sr.Content.byteLength>0,lr=typeof sr.Content=="string"&&sr.Content!=="";if(or||lr){const cr=this.parseImage(ir[nr]);tr[sr.RelativeFilename||sr.Filename]=cr}}}}for(const ir in er){const nr=er[ir];tr[nr]!==void 0?er[ir]=tr[nr]:er[ir]=er[ir].split("\\").pop()}return er}parseImage(er){const tr=er.Content,ir=er.RelativeFilename||er.Filename,nr=ir.slice(ir.lastIndexOf(".")+1).toLowerCase();let sr;switch(nr){case"bmp":sr="image/bmp";break;case"jpg":case"jpeg":sr="image/jpeg";break;case"png":sr="image/png";break;case"tif":sr="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",ir),sr="image/tga";break;default:console.warn('FBXLoader: Image type "'+nr+'" is not supported.');return}if(typeof tr=="string")return"data:"+sr+";base64,"+tr;{const ar=new Uint8Array(tr);return window.URL.createObjectURL(new Blob([ar],{type:sr}))}}parseTextures(er){const tr=new Map;if("Texture"in fbxTree.Objects){const ir=fbxTree.Objects.Texture;for(const nr in ir){const sr=this.parseTexture(ir[nr],er);tr.set(parseInt(nr),sr)}}return tr}parseTexture(er,tr){const ir=this.loadTexture(er,tr);ir.ID=er.id,ir.name=er.attrName;const nr=er.WrapModeU,sr=er.WrapModeV,ar=nr!==void 0?nr.value:0,or=sr!==void 0?sr.value:0;if(ir.wrapS=ar===0?RepeatWrapping:ClampToEdgeWrapping,ir.wrapT=or===0?RepeatWrapping:ClampToEdgeWrapping,"Scaling"in er){const lr=er.Scaling.value;ir.repeat.x=lr[0],ir.repeat.y=lr[1]}if("Translation"in er){const lr=er.Translation.value;ir.offset.x=lr[0],ir.offset.y=lr[1]}return ir}loadTexture(er,tr){const ir=new Set(["tga","tif","tiff","exr","dds","hdr","ktx2"]),nr=er.FileName.split(".").pop().toLowerCase(),sr=ir.has(nr)?this.manager.getHandler(`.${nr}`):this.textureLoader;if(!sr)return console.warn(`FBXLoader: ${nr.toUpperCase()} loader not found, creating placeholder texture for`,er.RelativeFilename),new Texture;const ar=sr.path;ar||sr.setPath(this.textureLoader.path);const or=connections.get(er.id).children;let lr;or!==void 0&&or.length>0&&tr[or[0].ID]!==void 0&&(lr=tr[or[0].ID],(lr.indexOf("blob:")===0||lr.indexOf("data:")===0)&&sr.setPath(void 0));const cr=sr.load(lr);return sr.setPath(ar),cr}parseMaterials(er){const tr=new Map;if("Material"in fbxTree.Objects){const ir=fbxTree.Objects.Material;for(const nr in ir){const sr=this.parseMaterial(ir[nr],er);sr!==null&&tr.set(parseInt(nr),sr)}}return tr}parseMaterial(er,tr){const ir=er.id,nr=er.attrName;let sr=er.ShadingModel;if(typeof sr=="object"&&(sr=sr.value),!connections.has(ir))return null;const ar=this.parseParameters(er,tr,ir);let or;switch(sr.toLowerCase()){case"phong":or=new MeshPhongMaterial;break;case"lambert":or=new MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',sr),or=new MeshPhongMaterial;break}return or.setValues(ar),or.name=nr,or}parseParameters(er,tr,ir){const nr={};er.BumpFactor&&(nr.bumpScale=er.BumpFactor.value),er.Diffuse?nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Diffuse.value),SRGBColorSpace):er.DiffuseColor&&(er.DiffuseColor.type==="Color"||er.DiffuseColor.type==="ColorRGB")&&(nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.DiffuseColor.value),SRGBColorSpace)),er.DisplacementFactor&&(nr.displacementScale=er.DisplacementFactor.value),er.Emissive?nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Emissive.value),SRGBColorSpace):er.EmissiveColor&&(er.EmissiveColor.type==="Color"||er.EmissiveColor.type==="ColorRGB")&&(nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.EmissiveColor.value),SRGBColorSpace)),er.EmissiveFactor&&(nr.emissiveIntensity=parseFloat(er.EmissiveFactor.value)),nr.opacity=1-(er.TransparencyFactor?parseFloat(er.TransparencyFactor.value):0),(nr.opacity===1||nr.opacity===0)&&(nr.opacity=er.Opacity?parseFloat(er.Opacity.value):null,nr.opacity===null&&(nr.opacity=1-(er.TransparentColor?parseFloat(er.TransparentColor.value[0]):0))),nr.opacity<1&&(nr.transparent=!0),er.ReflectionFactor&&(nr.reflectivity=er.ReflectionFactor.value),er.Shininess&&(nr.shininess=er.Shininess.value),er.Specular?nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.Specular.value),SRGBColorSpace):er.SpecularColor&&er.SpecularColor.type==="Color"&&(nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(er.SpecularColor.value),SRGBColorSpace));const sr=this;return connections.get(ir).children.forEach(function(ar){const or=ar.relationship;switch(or){case"Bump":nr.bumpMap=sr.getTexture(tr,ar.ID);break;case"Maya|TEX_ao_map":nr.aoMap=sr.getTexture(tr,ar.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":nr.map=sr.getTexture(tr,ar.ID),nr.map!==void 0&&(nr.map.colorSpace=SRGBColorSpace);break;case"DisplacementColor":nr.displacementMap=sr.getTexture(tr,ar.ID);break;case"EmissiveColor":nr.emissiveMap=sr.getTexture(tr,ar.ID),nr.emissiveMap!==void 0&&(nr.emissiveMap.colorSpace=SRGBColorSpace);break;case"NormalMap":case"Maya|TEX_normal_map":nr.normalMap=sr.getTexture(tr,ar.ID);break;case"ReflectionColor":nr.envMap=sr.getTexture(tr,ar.ID),nr.envMap!==void 0&&(nr.envMap.mapping=EquirectangularReflectionMapping,nr.envMap.colorSpace=SRGBColorSpace);break;case"SpecularColor":nr.specularMap=sr.getTexture(tr,ar.ID),nr.specularMap!==void 0&&(nr.specularMap.colorSpace=SRGBColorSpace);break;case"TransparentColor":case"TransparencyFactor":nr.alphaMap=sr.getTexture(tr,ar.ID),nr.transparent=!0;break;case"AmbientColor":case"ShininessExponent":case"SpecularFactor":case"VectorDisplacementColor":default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",or);break}}),nr}getTexture(er,tr){return"LayeredTexture"in fbxTree.Objects&&tr in fbxTree.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),tr=connections.get(tr).children[0].ID),er.get(tr)}parseDeformers(){const er={},tr={};if("Deformer"in fbxTree.Objects){const ir=fbxTree.Objects.Deformer;for(const nr in ir){const sr=ir[nr],ar=connections.get(parseInt(nr));if(sr.attrType==="Skin"){const or=this.parseSkeleton(ar,ir);or.ID=nr,ar.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),or.geometryID=ar.parents[0].ID,er[nr]=or}else if(sr.attrType==="BlendShape"){const or={id:nr};or.rawTargets=this.parseMorphTargets(ar,ir),or.id=nr,ar.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),tr[nr]=or}}}return{skeletons:er,morphTargets:tr}}parseSkeleton(er,tr){const ir=[];return er.children.forEach(function(nr){const sr=tr[nr.ID];if(sr.attrType!=="Cluster")return;const ar={ID:nr.ID,indices:[],weights:[],transformLink:new Matrix4().fromArray(sr.TransformLink.a)};"Indexes"in sr&&(ar.indices=sr.Indexes.a,ar.weights=sr.Weights.a),ir.push(ar)}),{rawBones:ir,bones:[]}}parseMorphTargets(er,tr){const ir=[];for(let nr=0;nr<er.children.length;nr++){const sr=er.children[nr],ar=tr[sr.ID],or={name:ar.attrName,initialWeight:ar.DeformPercent,id:ar.id,fullWeights:ar.FullWeights.a};if(ar.attrType!=="BlendShapeChannel")return;or.geoID=connections.get(parseInt(sr.ID)).children.filter(function(lr){return lr.relationship===void 0})[0].ID,ir.push(or)}return ir}parseScene(er,tr,ir){sceneGraph=new Group;const nr=this.parseModels(er.skeletons,tr,ir),sr=fbxTree.Objects.Model,ar=this;nr.forEach(function(lr){const cr=sr[lr.ID];ar.setLookAtProperties(lr,cr),connections.get(lr.ID).parents.forEach(function(dr){const hr=nr.get(dr.ID);hr!==void 0&&hr.add(lr)}),lr.parent===null&&sceneGraph.add(lr)}),this.bindSkeleton(er.skeletons,tr,nr),this.addGlobalSceneSettings(),sceneGraph.traverse(function(lr){if(lr.userData.transformData){lr.parent&&(lr.userData.transformData.parentMatrix=lr.parent.matrix,lr.userData.transformData.parentMatrixWorld=lr.parent.matrixWorld);const cr=generateTransform(lr.userData.transformData);lr.applyMatrix4(cr),lr.updateWorldMatrix()}});const or=new AnimationParser().parse();sceneGraph.children.length===1&&sceneGraph.children[0].isGroup&&(sceneGraph.children[0].animations=or,sceneGraph=sceneGraph.children[0]),sceneGraph.animations=or}parseModels(er,tr,ir){const nr=new Map,sr=fbxTree.Objects.Model;for(const ar in sr){const or=parseInt(ar),lr=sr[ar],cr=connections.get(or);let ur=this.buildSkeleton(cr,er,or,lr.attrName);if(!ur){switch(lr.attrType){case"Camera":ur=this.createCamera(cr);break;case"Light":ur=this.createLight(cr);break;case"Mesh":ur=this.createMesh(cr,tr,ir);break;case"NurbsCurve":ur=this.createCurve(cr,tr);break;case"LimbNode":case"Root":ur=new Bone;break;case"Null":default:ur=new Group;break}ur.name=lr.attrName?PropertyBinding.sanitizeNodeName(lr.attrName):"",ur.userData.originalName=lr.attrName,ur.ID=or}this.getTransformData(ur,lr),nr.set(or,ur)}return nr}buildSkeleton(er,tr,ir,nr){let sr=null;return er.parents.forEach(function(ar){for(const or in tr){const lr=tr[or];lr.rawBones.forEach(function(cr,ur){if(cr.ID===ar.ID){const dr=sr;sr=new Bone,sr.matrixWorld.copy(cr.transformLink),sr.name=nr?PropertyBinding.sanitizeNodeName(nr):"",sr.userData.originalName=nr,sr.ID=ir,lr.bones[ur]=sr,dr!==null&&sr.add(dr)}})}}),sr}createCamera(er){let tr,ir;if(er.children.forEach(function(nr){const sr=fbxTree.Objects.NodeAttribute[nr.ID];sr!==void 0&&(ir=sr)}),ir===void 0)tr=new Object3D;else{let nr=0;ir.CameraProjectionType!==void 0&&ir.CameraProjectionType.value===1&&(nr=1);let sr=1;ir.NearPlane!==void 0&&(sr=ir.NearPlane.value/1e3);let ar=1e3;ir.FarPlane!==void 0&&(ar=ir.FarPlane.value/1e3);let or=window.innerWidth,lr=window.innerHeight;ir.AspectWidth!==void 0&&ir.AspectHeight!==void 0&&(or=ir.AspectWidth.value,lr=ir.AspectHeight.value);const cr=or/lr;let ur=45;ir.FieldOfView!==void 0&&(ur=ir.FieldOfView.value);const dr=ir.FocalLength?ir.FocalLength.value:null;switch(nr){case 0:tr=new PerspectiveCamera(ur,cr,sr,ar),dr!==null&&tr.setFocalLength(dr);break;case 1:console.warn("THREE.FBXLoader: Orthographic cameras not supported yet."),tr=new Object3D;break;default:console.warn("THREE.FBXLoader: Unknown camera type "+nr+"."),tr=new Object3D;break}}return tr}createLight(er){let tr,ir;if(er.children.forEach(function(nr){const sr=fbxTree.Objects.NodeAttribute[nr.ID];sr!==void 0&&(ir=sr)}),ir===void 0)tr=new Object3D;else{let nr;ir.LightType===void 0?nr=0:nr=ir.LightType.value;let sr=16777215;ir.Color!==void 0&&(sr=ColorManagement.toWorkingColorSpace(new Color().fromArray(ir.Color.value),SRGBColorSpace));let ar=ir.Intensity===void 0?1:ir.Intensity.value/100;ir.CastLightOnObject!==void 0&&ir.CastLightOnObject.value===0&&(ar=0);let or=0;ir.FarAttenuationEnd!==void 0&&(ir.EnableFarAttenuation!==void 0&&ir.EnableFarAttenuation.value===0?or=0:or=ir.FarAttenuationEnd.value);const lr=1;switch(nr){case 0:tr=new PointLight(sr,ar,or,lr);break;case 1:tr=new DirectionalLight(sr,ar);break;case 2:let cr=Math.PI/3;ir.InnerAngle!==void 0&&(cr=MathUtils.degToRad(ir.InnerAngle.value));let ur=0;ir.OuterAngle!==void 0&&(ur=MathUtils.degToRad(ir.OuterAngle.value),ur=Math.max(ur,1)),tr=new SpotLight(sr,ar,or,cr,ur,lr);break;default:console.warn("THREE.FBXLoader: Unknown light type "+ir.LightType.value+", defaulting to a PointLight."),tr=new PointLight(sr,ar);break}ir.CastShadows!==void 0&&ir.CastShadows.value===1&&(tr.castShadow=!0)}return tr}createMesh(er,tr,ir){let nr,sr=null,ar=null;const or=[];return er.children.forEach(function(lr){tr.has(lr.ID)&&(sr=tr.get(lr.ID)),ir.has(lr.ID)&&or.push(ir.get(lr.ID))}),or.length>1?ar=or:or.length>0?ar=or[0]:(ar=new MeshPhongMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:13421772}),or.push(ar)),"color"in sr.attributes&&or.forEach(function(lr){lr.vertexColors=!0}),sr.FBX_Deformer?(nr=new SkinnedMesh(sr,ar),nr.normalizeSkinWeights()):nr=new Mesh(sr,ar),nr}createCurve(er,tr){const ir=er.children.reduce(function(sr,ar){return tr.has(ar.ID)&&(sr=tr.get(ar.ID)),sr},null),nr=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:3342591,linewidth:1});return new Line(ir,nr)}getTransformData(er,tr){const ir={};"InheritType"in tr&&(ir.inheritType=parseInt(tr.InheritType.value)),"RotationOrder"in tr?ir.eulerOrder=getEulerOrder(tr.RotationOrder.value):ir.eulerOrder=getEulerOrder(0),"Lcl_Translation"in tr&&(ir.translation=tr.Lcl_Translation.value),"PreRotation"in tr&&(ir.preRotation=tr.PreRotation.value),"Lcl_Rotation"in tr&&(ir.rotation=tr.Lcl_Rotation.value),"PostRotation"in tr&&(ir.postRotation=tr.PostRotation.value),"Lcl_Scaling"in tr&&(ir.scale=tr.Lcl_Scaling.value),"ScalingOffset"in tr&&(ir.scalingOffset=tr.ScalingOffset.value),"ScalingPivot"in tr&&(ir.scalingPivot=tr.ScalingPivot.value),"RotationOffset"in tr&&(ir.rotationOffset=tr.RotationOffset.value),"RotationPivot"in tr&&(ir.rotationPivot=tr.RotationPivot.value),er.userData.transformData=ir}setLookAtProperties(er,tr){"LookAtProperty"in tr&&connections.get(er.ID).children.forEach(function(nr){if(nr.relationship==="LookAtProperty"){const sr=fbxTree.Objects.Model[nr.ID];if("Lcl_Translation"in sr){const ar=sr.Lcl_Translation.value;er.target!==void 0?(er.target.position.fromArray(ar),sceneGraph.add(er.target)):er.lookAt(new Vector3$1().fromArray(ar))}}})}bindSkeleton(er,tr,ir){const nr=this.parsePoseNodes();for(const sr in er){const ar=er[sr];connections.get(parseInt(ar.ID)).parents.forEach(function(lr){if(tr.has(lr.ID)){const cr=lr.ID;connections.get(cr).parents.forEach(function(dr){ir.has(dr.ID)&&ir.get(dr.ID).bind(new Skeleton(ar.bones),nr[dr.ID])})}})}}parsePoseNodes(){const er={};if("Pose"in fbxTree.Objects){const tr=fbxTree.Objects.Pose;for(const ir in tr)if(tr[ir].attrType==="BindPose"&&tr[ir].NbPoseNodes>0){const nr=tr[ir].PoseNode;Array.isArray(nr)?nr.forEach(function(sr){er[sr.Node]=new Matrix4().fromArray(sr.Matrix.a)}):er[nr.Node]=new Matrix4().fromArray(nr.Matrix.a)}}return er}addGlobalSceneSettings(){if("GlobalSettings"in fbxTree){if("AmbientColor"in fbxTree.GlobalSettings){const er=fbxTree.GlobalSettings.AmbientColor.value,tr=er[0],ir=er[1],nr=er[2];if(tr!==0||ir!==0||nr!==0){const sr=new Color().setRGB(tr,ir,nr,SRGBColorSpace);sceneGraph.add(new AmbientLight(sr,1))}}"UnitScaleFactor"in fbxTree.GlobalSettings&&(sceneGraph.userData.unitScaleFactor=fbxTree.GlobalSettings.UnitScaleFactor.value)}}}let GeometryParser$1=class{constructor(){this.negativeMaterialIndices=!1}parse(er){const tr=new Map;if("Geometry"in fbxTree.Objects){const ir=fbxTree.Objects.Geometry;for(const nr in ir){const sr=connections.get(parseInt(nr)),ar=this.parseGeometry(sr,ir[nr],er);tr.set(parseInt(nr),ar)}}return this.negativeMaterialIndices===!0&&console.warn("THREE.FBXLoader: The FBX file contains invalid (negative) material indices. The asset might not render as expected."),tr}parseGeometry(er,tr,ir){switch(tr.attrType){case"Mesh":return this.parseMeshGeometry(er,tr,ir);case"NurbsCurve":return this.parseNurbsGeometry(tr)}}parseMeshGeometry(er,tr,ir){const nr=ir.skeletons,sr=[],ar=er.parents.map(function(dr){return fbxTree.Objects.Model[dr.ID]});if(ar.length===0)return;const or=er.children.reduce(function(dr,hr){return nr[hr.ID]!==void 0&&(dr=nr[hr.ID]),dr},null);er.children.forEach(function(dr){ir.morphTargets[dr.ID]!==void 0&&sr.push(ir.morphTargets[dr.ID])});const lr=ar[0],cr={};"RotationOrder"in lr&&(cr.eulerOrder=getEulerOrder(lr.RotationOrder.value)),"InheritType"in lr&&(cr.inheritType=parseInt(lr.InheritType.value)),"GeometricTranslation"in lr&&(cr.translation=lr.GeometricTranslation.value),"GeometricRotation"in lr&&(cr.rotation=lr.GeometricRotation.value),"GeometricScaling"in lr&&(cr.scale=lr.GeometricScaling.value);const ur=generateTransform(cr);return this.genGeometry(tr,or,sr,ur)}genGeometry(er,tr,ir,nr){const sr=new BufferGeometry;er.attrName&&(sr.name=er.attrName);const ar=this.parseGeoNode(er,tr),or=this.genBuffers(ar),lr=new Float32BufferAttribute(or.vertex,3);if(lr.applyMatrix4(nr),sr.setAttribute("position",lr),or.colors.length>0&&sr.setAttribute("color",new Float32BufferAttribute(or.colors,3)),tr&&(sr.setAttribute("skinIndex",new Uint16BufferAttribute(or.weightsIndices,4)),sr.setAttribute("skinWeight",new Float32BufferAttribute(or.vertexWeights,4)),sr.FBX_Deformer=tr),or.normal.length>0){const cr=new Matrix3().getNormalMatrix(nr),ur=new Float32BufferAttribute(or.normal,3);ur.applyNormalMatrix(cr),sr.setAttribute("normal",ur)}if(or.uvs.forEach(function(cr,ur){const dr=ur===0?"uv":`uv${ur}`;sr.setAttribute(dr,new Float32BufferAttribute(or.uvs[ur],2))}),ar.material&&ar.material.mappingType!=="AllSame"){let cr=or.materialIndex[0],ur=0;if(or.materialIndex.forEach(function(dr,hr){dr!==cr&&(sr.addGroup(ur,hr-ur,cr),cr=dr,ur=hr)}),sr.groups.length>0){const dr=sr.groups[sr.groups.length-1],hr=dr.start+dr.count;hr!==or.materialIndex.length&&sr.addGroup(hr,or.materialIndex.length-hr,cr)}sr.groups.length===0&&sr.addGroup(0,or.materialIndex.length,or.materialIndex[0])}return this.addMorphTargets(sr,er,ir,nr),sr}parseGeoNode(er,tr){const ir={};if(ir.vertexPositions=er.Vertices!==void 0?er.Vertices.a:[],ir.vertexIndices=er.PolygonVertexIndex!==void 0?er.PolygonVertexIndex.a:[],er.LayerElementColor&&(ir.color=this.parseVertexColors(er.LayerElementColor[0])),er.LayerElementMaterial&&(ir.material=this.parseMaterialIndices(er.LayerElementMaterial[0])),er.LayerElementNormal&&(ir.normal=this.parseNormals(er.LayerElementNormal[0])),er.LayerElementUV){ir.uv=[];let nr=0;for(;er.LayerElementUV[nr];)er.LayerElementUV[nr].UV&&ir.uv.push(this.parseUVs(er.LayerElementUV[nr])),nr++}return ir.weightTable={},tr!==null&&(ir.skeleton=tr,tr.rawBones.forEach(function(nr,sr){nr.indices.forEach(function(ar,or){ir.weightTable[ar]===void 0&&(ir.weightTable[ar]=[]),ir.weightTable[ar].push({id:sr,weight:nr.weights[or]})})})),ir}genBuffers(er){const tr={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let ir=0,nr=0,sr=!1,ar=[],or=[],lr=[],cr=[],ur=[],dr=[];const hr=this;return er.vertexIndices.forEach(function(pr,gr){let vr,mr=!1;pr<0&&(pr=pr^-1,mr=!0);let fr=[],_r=[];if(ar.push(pr*3,pr*3+1,pr*3+2),er.color){const Ar=getData(gr,ir,pr,er.color);lr.push(Ar[0],Ar[1],Ar[2])}if(er.skeleton){if(er.weightTable[pr]!==void 0&&er.weightTable[pr].forEach(function(Ar){_r.push(Ar.weight),fr.push(Ar.id)}),_r.length>4){sr||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),sr=!0);const Ar=[0,0,0,0],yr=[0,0,0,0];_r.forEach(function(wr,xr){let Sr=wr,br=fr[xr];yr.forEach(function(Cr,Ir,Rr){if(Sr>Cr){Rr[Ir]=Sr,Sr=Cr;const Pr=Ar[Ir];Ar[Ir]=br,br=Pr}})}),fr=Ar,_r=yr}for(;_r.length<4;)_r.push(0),fr.push(0);for(let Ar=0;Ar<4;++Ar)ur.push(_r[Ar]),dr.push(fr[Ar])}if(er.normal){const Ar=getData(gr,ir,pr,er.normal);or.push(Ar[0],Ar[1],Ar[2])}er.material&&er.material.mappingType!=="AllSame"&&(vr=getData(gr,ir,pr,er.material)[0],vr<0&&(hr.negativeMaterialIndices=!0,vr=0)),er.uv&&er.uv.forEach(function(Ar,yr){const wr=getData(gr,ir,pr,Ar);cr[yr]===void 0&&(cr[yr]=[]),cr[yr].push(wr[0]),cr[yr].push(wr[1])}),nr++,mr&&(hr.genFace(tr,er,ar,vr,or,lr,cr,ur,dr,nr),ir++,nr=0,ar=[],or=[],lr=[],cr=[],ur=[],dr=[])}),tr}getNormalNewell(er){const tr=new Vector3$1(0,0,0);for(let ir=0;ir<er.length;ir++){const nr=er[ir],sr=er[(ir+1)%er.length];tr.x+=(nr.y-sr.y)*(nr.z+sr.z),tr.y+=(nr.z-sr.z)*(nr.x+sr.x),tr.z+=(nr.x-sr.x)*(nr.y+sr.y)}return tr.normalize(),tr}getNormalTangentAndBitangent(er){const tr=this.getNormalNewell(er),nr=(Math.abs(tr.z)>.5?new Vector3$1(0,1,0):new Vector3$1(0,0,1)).cross(tr).normalize(),sr=tr.clone().cross(nr).normalize();return{normal:tr,tangent:nr,bitangent:sr}}flattenVertex(er,tr,ir){return new Vector2(er.dot(tr),er.dot(ir))}genFace(er,tr,ir,nr,sr,ar,or,lr,cr,ur){let dr;if(ur>3){const hr=[],pr=tr.baseVertexPositions||tr.vertexPositions;for(let fr=0;fr<ir.length;fr+=3)hr.push(new Vector3$1(pr[ir[fr]],pr[ir[fr+1]],pr[ir[fr+2]]));const{tangent:gr,bitangent:vr}=this.getNormalTangentAndBitangent(hr),mr=[];for(const fr of hr)mr.push(this.flattenVertex(fr,gr,vr));dr=ShapeUtils.triangulateShape(mr,[])}else dr=[[0,1,2]];for(const[hr,pr,gr]of dr)er.vertex.push(tr.vertexPositions[ir[hr*3]]),er.vertex.push(tr.vertexPositions[ir[hr*3+1]]),er.vertex.push(tr.vertexPositions[ir[hr*3+2]]),er.vertex.push(tr.vertexPositions[ir[pr*3]]),er.vertex.push(tr.vertexPositions[ir[pr*3+1]]),er.vertex.push(tr.vertexPositions[ir[pr*3+2]]),er.vertex.push(tr.vertexPositions[ir[gr*3]]),er.vertex.push(tr.vertexPositions[ir[gr*3+1]]),er.vertex.push(tr.vertexPositions[ir[gr*3+2]]),tr.skeleton&&(er.vertexWeights.push(lr[hr*4]),er.vertexWeights.push(lr[hr*4+1]),er.vertexWeights.push(lr[hr*4+2]),er.vertexWeights.push(lr[hr*4+3]),er.vertexWeights.push(lr[pr*4]),er.vertexWeights.push(lr[pr*4+1]),er.vertexWeights.push(lr[pr*4+2]),er.vertexWeights.push(lr[pr*4+3]),er.vertexWeights.push(lr[gr*4]),er.vertexWeights.push(lr[gr*4+1]),er.vertexWeights.push(lr[gr*4+2]),er.vertexWeights.push(lr[gr*4+3]),er.weightsIndices.push(cr[hr*4]),er.weightsIndices.push(cr[hr*4+1]),er.weightsIndices.push(cr[hr*4+2]),er.weightsIndices.push(cr[hr*4+3]),er.weightsIndices.push(cr[pr*4]),er.weightsIndices.push(cr[pr*4+1]),er.weightsIndices.push(cr[pr*4+2]),er.weightsIndices.push(cr[pr*4+3]),er.weightsIndices.push(cr[gr*4]),er.weightsIndices.push(cr[gr*4+1]),er.weightsIndices.push(cr[gr*4+2]),er.weightsIndices.push(cr[gr*4+3])),tr.color&&(er.colors.push(ar[hr*3]),er.colors.push(ar[hr*3+1]),er.colors.push(ar[hr*3+2]),er.colors.push(ar[pr*3]),er.colors.push(ar[pr*3+1]),er.colors.push(ar[pr*3+2]),er.colors.push(ar[gr*3]),er.colors.push(ar[gr*3+1]),er.colors.push(ar[gr*3+2])),tr.material&&tr.material.mappingType!=="AllSame"&&(er.materialIndex.push(nr),er.materialIndex.push(nr),er.materialIndex.push(nr)),tr.normal&&(er.normal.push(sr[hr*3]),er.normal.push(sr[hr*3+1]),er.normal.push(sr[hr*3+2]),er.normal.push(sr[pr*3]),er.normal.push(sr[pr*3+1]),er.normal.push(sr[pr*3+2]),er.normal.push(sr[gr*3]),er.normal.push(sr[gr*3+1]),er.normal.push(sr[gr*3+2])),tr.uv&&tr.uv.forEach(function(vr,mr){er.uvs[mr]===void 0&&(er.uvs[mr]=[]),er.uvs[mr].push(or[mr][hr*2]),er.uvs[mr].push(or[mr][hr*2+1]),er.uvs[mr].push(or[mr][pr*2]),er.uvs[mr].push(or[mr][pr*2+1]),er.uvs[mr].push(or[mr][gr*2]),er.uvs[mr].push(or[mr][gr*2+1])})}addMorphTargets(er,tr,ir,nr){if(ir.length===0)return;er.morphTargetsRelative=!0,er.morphAttributes.position=[];const sr=this;ir.forEach(function(ar){ar.rawTargets.forEach(function(or){const lr=fbxTree.Objects.Geometry[or.geoID];lr!==void 0&&sr.genMorphGeometry(er,tr,lr,nr,or.name)})})}genMorphGeometry(er,tr,ir,nr,sr){const ar=tr.Vertices!==void 0?tr.Vertices.a:[],or=tr.PolygonVertexIndex!==void 0?tr.PolygonVertexIndex.a:[],lr=ir.Vertices!==void 0?ir.Vertices.a:[],cr=ir.Indexes!==void 0?ir.Indexes.a:[],ur=er.attributes.position.count*3,dr=new Float32Array(ur);for(let vr=0;vr<cr.length;vr++){const mr=cr[vr]*3;dr[mr]=lr[vr*3],dr[mr+1]=lr[vr*3+1],dr[mr+2]=lr[vr*3+2]}const hr={vertexIndices:or,vertexPositions:dr,baseVertexPositions:ar},pr=this.genBuffers(hr),gr=new Float32BufferAttribute(pr.vertex,3);gr.name=sr||ir.attrName,gr.applyMatrix4(nr),er.morphAttributes.position.push(gr)}parseNormals(er){const tr=er.MappingInformationType,ir=er.ReferenceInformationType,nr=er.Normals.a;let sr=[];return ir==="IndexToDirect"&&("NormalIndex"in er?sr=er.NormalIndex.a:"NormalsIndex"in er&&(sr=er.NormalsIndex.a)),{dataSize:3,buffer:nr,indices:sr,mappingType:tr,referenceType:ir}}parseUVs(er){const tr=er.MappingInformationType,ir=er.ReferenceInformationType,nr=er.UV.a;let sr=[];return ir==="IndexToDirect"&&(sr=er.UVIndex.a),{dataSize:2,buffer:nr,indices:sr,mappingType:tr,referenceType:ir}}parseVertexColors(er){const tr=er.MappingInformationType,ir=er.ReferenceInformationType,nr=er.Colors.a;let sr=[];ir==="IndexToDirect"&&(sr=er.ColorIndex.a);for(let ar=0,or=new Color;ar<nr.length;ar+=4)or.fromArray(nr,ar),ColorManagement.toWorkingColorSpace(or,SRGBColorSpace),or.toArray(nr,ar);return{dataSize:4,buffer:nr,indices:sr,mappingType:tr,referenceType:ir}}parseMaterialIndices(er){const tr=er.MappingInformationType,ir=er.ReferenceInformationType;if(tr==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:ir};const nr=er.Materials.a,sr=[];for(let ar=0;ar<nr.length;++ar)sr.push(ar);return{dataSize:1,buffer:nr,indices:sr,mappingType:tr,referenceType:ir}}parseNurbsGeometry(er){const tr=parseInt(er.Order);if(isNaN(tr))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",er.Order,er.id),new BufferGeometry;const ir=tr-1,nr=er.KnotVector.a,sr=[],ar=er.Points.a;for(let dr=0,hr=ar.length;dr<hr;dr+=4)sr.push(new Vector4().fromArray(ar,dr));let or,lr;if(er.Form==="Closed")sr.push(sr[0]);else if(er.Form==="Periodic"){or=ir,lr=nr.length-1-or;for(let dr=0;dr<ir;++dr)sr.push(sr[dr])}const ur=new NURBSCurve(ir,nr,sr,or,lr).getPoints(sr.length*12);return new BufferGeometry().setFromPoints(ur)}};class AnimationParser{parse(){const er=[],tr=this.parseClips();if(tr!==void 0)for(const ir in tr){const nr=tr[ir],sr=this.addClip(nr);er.push(sr)}return er}parseClips(){if(fbxTree.Objects.AnimationCurve===void 0)return;const er=this.parseAnimationCurveNodes();this.parseAnimationCurves(er);const tr=this.parseAnimationLayers(er);return this.parseAnimStacks(tr)}parseAnimationCurveNodes(){const er=fbxTree.Objects.AnimationCurveNode,tr=new Map;for(const ir in er){const nr=er[ir];if(nr.attrName.match(/S|R|T|DeformPercent/)!==null){const sr={id:nr.id,attr:nr.attrName,curves:{}};tr.set(sr.id,sr)}}return tr}parseAnimationCurves(er){const tr=fbxTree.Objects.AnimationCurve;for(const ir in tr){const nr={id:tr[ir].id,times:tr[ir].KeyTime.a.map(convertFBXTimeToSeconds),values:tr[ir].KeyValueFloat.a},sr=connections.get(nr.id);if(sr!==void 0){const ar=sr.parents[0].ID,or=sr.parents[0].relationship;or.match(/X/)?er.get(ar).curves.x=nr:or.match(/Y/)?er.get(ar).curves.y=nr:or.match(/Z/)?er.get(ar).curves.z=nr:or.match(/DeformPercent/)&&er.has(ar)&&(er.get(ar).curves.morph=nr)}}}parseAnimationLayers(er){const tr=fbxTree.Objects.AnimationLayer,ir=new Map;for(const nr in tr){const sr=[],ar=connections.get(parseInt(nr));ar!==void 0&&(ar.children.forEach(function(lr,cr){if(er.has(lr.ID)){const ur=er.get(lr.ID);if(ur.curves.x!==void 0||ur.curves.y!==void 0||ur.curves.z!==void 0){if(sr[cr]===void 0){const dr=connections.get(lr.ID).parents.filter(function(hr){return hr.relationship!==void 0})[0].ID;if(dr!==void 0){const hr=fbxTree.Objects.Model[dr.toString()];if(hr===void 0){console.warn("THREE.FBXLoader: Encountered a unused curve.",lr);return}const pr={modelName:hr.attrName?PropertyBinding.sanitizeNodeName(hr.attrName):"",ID:hr.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};sceneGraph.traverse(function(gr){gr.ID===hr.id&&(pr.transform=gr.matrix,gr.userData.transformData&&(pr.eulerOrder=gr.userData.transformData.eulerOrder))}),pr.transform||(pr.transform=new Matrix4),"PreRotation"in hr&&(pr.preRotation=hr.PreRotation.value),"PostRotation"in hr&&(pr.postRotation=hr.PostRotation.value),sr[cr]=pr}}sr[cr]&&(sr[cr][ur.attr]=ur)}else if(ur.curves.morph!==void 0){if(sr[cr]===void 0){const dr=connections.get(lr.ID).parents.filter(function(fr){return fr.relationship!==void 0})[0].ID,hr=connections.get(dr).parents[0].ID,pr=connections.get(hr).parents[0].ID,gr=connections.get(pr).parents[0].ID,vr=fbxTree.Objects.Model[gr],mr={modelName:vr.attrName?PropertyBinding.sanitizeNodeName(vr.attrName):"",morphName:fbxTree.Objects.Deformer[dr].attrName};sr[cr]=mr}sr[cr][ur.attr]=ur}}}),ir.set(parseInt(nr),sr))}return ir}parseAnimStacks(er){const tr=fbxTree.Objects.AnimationStack,ir={};for(const nr in tr){const sr=connections.get(parseInt(nr)).children;sr.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const ar=er.get(sr[0].ID);ir[nr]={name:tr[nr].attrName,layer:ar}}return ir}addClip(er){let tr=[];const ir=this;return er.layer.forEach(function(nr){tr=tr.concat(ir.generateTracks(nr))}),new AnimationClip(er.name,-1,tr)}generateTracks(er){const tr=[];let ir=new Vector3$1,nr=new Vector3$1;if(er.transform&&er.transform.decompose(ir,new Quaternion$1,nr),ir=ir.toArray(),nr=nr.toArray(),er.T!==void 0&&Object.keys(er.T.curves).length>0){const sr=this.generateVectorTrack(er.modelName,er.T.curves,ir,"position");sr!==void 0&&tr.push(sr)}if(er.R!==void 0&&Object.keys(er.R.curves).length>0){const sr=this.generateRotationTrack(er.modelName,er.R.curves,er.preRotation,er.postRotation,er.eulerOrder);sr!==void 0&&tr.push(sr)}if(er.S!==void 0&&Object.keys(er.S.curves).length>0){const sr=this.generateVectorTrack(er.modelName,er.S.curves,nr,"scale");sr!==void 0&&tr.push(sr)}if(er.DeformPercent!==void 0){const sr=this.generateMorphTrack(er);sr!==void 0&&tr.push(sr)}return tr}generateVectorTrack(er,tr,ir,nr){const sr=this.getTimesForAllAxes(tr),ar=this.getKeyframeTrackValues(sr,tr,ir);return new VectorKeyframeTrack(er+"."+nr,sr,ar)}generateRotationTrack(er,tr,ir,nr,sr){let ar,or;if(tr.x!==void 0&&tr.y!==void 0&&tr.z!==void 0){const hr=this.interpolateRotations(tr.x,tr.y,tr.z,sr);ar=hr[0],or=hr[1]}const lr=getEulerOrder(0);ir!==void 0&&(ir=ir.map(MathUtils.degToRad),ir.push(lr),ir=new Euler().fromArray(ir),ir=new Quaternion$1().setFromEuler(ir)),nr!==void 0&&(nr=nr.map(MathUtils.degToRad),nr.push(lr),nr=new Euler().fromArray(nr),nr=new Quaternion$1().setFromEuler(nr).invert());const cr=new Quaternion$1,ur=new Euler,dr=[];if(!or||!ar)return new QuaternionKeyframeTrack(er+".quaternion",[0],[0]);for(let hr=0;hr<or.length;hr+=3)ur.set(or[hr],or[hr+1],or[hr+2],sr),cr.setFromEuler(ur),ir!==void 0&&cr.premultiply(ir),nr!==void 0&&cr.multiply(nr),hr>2&&new Quaternion$1().fromArray(dr,(hr-3)/3*4).dot(cr)<0&&cr.set(-cr.x,-cr.y,-cr.z,-cr.w),cr.toArray(dr,hr/3*4);return new QuaternionKeyframeTrack(er+".quaternion",ar,dr)}generateMorphTrack(er){const tr=er.DeformPercent.curves.morph,ir=tr.values.map(function(sr){return sr/100}),nr=sceneGraph.getObjectByName(er.modelName).morphTargetDictionary[er.morphName];return new NumberKeyframeTrack(er.modelName+".morphTargetInfluences["+nr+"]",tr.times,ir)}getTimesForAllAxes(er){let tr=[];if(er.x!==void 0&&(tr=tr.concat(er.x.times)),er.y!==void 0&&(tr=tr.concat(er.y.times)),er.z!==void 0&&(tr=tr.concat(er.z.times)),tr=tr.sort(function(ir,nr){return ir-nr}),tr.length>1){let ir=1,nr=tr[0];for(let sr=1;sr<tr.length;sr++){const ar=tr[sr];ar!==nr&&(tr[ir]=ar,nr=ar,ir++)}tr=tr.slice(0,ir)}return tr}getKeyframeTrackValues(er,tr,ir){const nr=ir,sr=[];let ar=-1,or=-1,lr=-1;return er.forEach(function(cr){if(tr.x&&(ar=tr.x.times.indexOf(cr)),tr.y&&(or=tr.y.times.indexOf(cr)),tr.z&&(lr=tr.z.times.indexOf(cr)),ar!==-1){const ur=tr.x.values[ar];sr.push(ur),nr[0]=ur}else sr.push(nr[0]);if(or!==-1){const ur=tr.y.values[or];sr.push(ur),nr[1]=ur}else sr.push(nr[1]);if(lr!==-1){const ur=tr.z.values[lr];sr.push(ur),nr[2]=ur}else sr.push(nr[2])}),sr}interpolateRotations(er,tr,ir,nr){const sr=[],ar=[];sr.push(er.times[0]),ar.push(MathUtils.degToRad(er.values[0])),ar.push(MathUtils.degToRad(tr.values[0])),ar.push(MathUtils.degToRad(ir.values[0]));for(let or=1;or<er.values.length;or++){const lr=[er.values[or-1],tr.values[or-1],ir.values[or-1]];if(isNaN(lr[0])||isNaN(lr[1])||isNaN(lr[2]))continue;const cr=lr.map(MathUtils.degToRad),ur=[er.values[or],tr.values[or],ir.values[or]];if(isNaN(ur[0])||isNaN(ur[1])||isNaN(ur[2]))continue;const dr=ur.map(MathUtils.degToRad),hr=[ur[0]-lr[0],ur[1]-lr[1],ur[2]-lr[2]],pr=[Math.abs(hr[0]),Math.abs(hr[1]),Math.abs(hr[2])];if(pr[0]>=180||pr[1]>=180||pr[2]>=180){const vr=Math.max(...pr)/180,mr=new Euler(...cr,nr),fr=new Euler(...dr,nr),_r=new Quaternion$1().setFromEuler(mr),Ar=new Quaternion$1().setFromEuler(fr);_r.dot(Ar)&&Ar.set(-Ar.x,-Ar.y,-Ar.z,-Ar.w);const yr=er.times[or-1],wr=er.times[or]-yr,xr=new Quaternion$1,Sr=new Euler;for(let br=0;br<1;br+=1/vr)xr.copy(_r.clone().slerp(Ar.clone(),br)),sr.push(yr+br*wr),Sr.setFromQuaternion(xr,nr),ar.push(Sr.x),ar.push(Sr.y),ar.push(Sr.z)}else sr.push(er.times[or]),ar.push(MathUtils.degToRad(er.values[or])),ar.push(MathUtils.degToRad(tr.values[or])),ar.push(MathUtils.degToRad(ir.values[or]))}return[sr,ar]}}class TextParser{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(er){this.nodeStack.push(er),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(er,tr){this.currentProp=er,this.currentPropName=tr}parse(er){this.currentIndent=0,this.allNodes=new FBXTree,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const tr=this,ir=er.split(/[\r\n]+/);return ir.forEach(function(nr,sr){const ar=nr.match(/^[\s\t]*;/),or=nr.match(/^[\s\t]*$/);if(ar||or)return;const lr=nr.match("^\\t{"+tr.currentIndent+"}(\\w+):(.*){",""),cr=nr.match("^\\t{"+tr.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),ur=nr.match("^\\t{"+(tr.currentIndent-1)+"}}");lr?tr.parseNodeBegin(nr,lr):cr?tr.parseNodeProperty(nr,cr,ir[++sr]):ur?tr.popStack():nr.match(/^[^\s\t}]/)&&tr.parseNodePropertyContinued(nr)}),this.allNodes}parseNodeBegin(er,tr){const ir=tr[1].trim().replace(/^"/,"").replace(/"$/,""),nr=tr[2].split(",").map(function(lr){return lr.trim().replace(/^"/,"").replace(/"$/,"")}),sr={name:ir},ar=this.parseNodeAttr(nr),or=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(ir,sr):ir in or?(ir==="PoseNode"?or.PoseNode.push(sr):or[ir].id!==void 0&&(or[ir]={},or[ir][or[ir].id]=or[ir]),ar.id!==""&&(or[ir][ar.id]=sr)):typeof ar.id=="number"?(or[ir]={},or[ir][ar.id]=sr):ir!=="Properties70"&&(ir==="PoseNode"?or[ir]=[sr]:or[ir]=sr),typeof ar.id=="number"&&(sr.id=ar.id),ar.name!==""&&(sr.attrName=ar.name),ar.type!==""&&(sr.attrType=ar.type),this.pushStack(sr)}parseNodeAttr(er){let tr=er[0];er[0]!==""&&(tr=parseInt(er[0]),isNaN(tr)&&(tr=er[0]));let ir="",nr="";return er.length>1&&(ir=er[1].replace(/^(\w+)::/,""),nr=er[2]),{id:tr,name:ir,type:nr}}parseNodeProperty(er,tr,ir){let nr=tr[1].replace(/^"/,"").replace(/"$/,"").trim(),sr=tr[2].replace(/^"/,"").replace(/"$/,"").trim();nr==="Content"&&sr===","&&(sr=ir.replace(/"/g,"").replace(/,$/,"").trim());const ar=this.getCurrentNode();if(ar.name==="Properties70"){this.parseNodeSpecialProperty(er,nr,sr);return}if(nr==="C"){const lr=sr.split(",").slice(1),cr=parseInt(lr[0]),ur=parseInt(lr[1]);let dr=sr.split(",").slice(3);dr=dr.map(function(hr){return hr.trim().replace(/^"/,"")}),nr="connections",sr=[cr,ur],append(sr,dr),ar[nr]===void 0&&(ar[nr]=[])}nr==="Node"&&(ar.id=sr),nr in ar&&Array.isArray(ar[nr])?ar[nr].push(sr):nr!=="a"?ar[nr]=sr:ar.a=sr,this.setCurrentProp(ar,nr),nr==="a"&&sr.slice(-1)!==","&&(ar.a=parseNumberArray(sr))}parseNodePropertyContinued(er){const tr=this.getCurrentNode();tr.a+=er,er.slice(-1)!==","&&(tr.a=parseNumberArray(tr.a))}parseNodeSpecialProperty(er,tr,ir){const nr=ir.split('",').map(function(ur){return ur.trim().replace(/^\"/,"").replace(/\s/,"_")}),sr=nr[0],ar=nr[1],or=nr[2],lr=nr[3];let cr=nr[4];switch(ar){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":cr=parseFloat(cr);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":cr=parseNumberArray(cr);break}this.getPrevNode()[sr]={type:ar,type2:or,flag:lr,value:cr},this.setCurrentProp(this.getPrevNode(),sr)}}class BinaryParser{parse(er){const tr=new BinaryReader(er);tr.skip(23);const ir=tr.getUint32();if(ir<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+ir);const nr=new FBXTree;for(;!this.endOfContent(tr);){const sr=this.parseNode(tr,ir);sr!==null&&nr.add(sr.name,sr)}return nr}endOfContent(er){return er.size()%16===0?(er.getOffset()+160+16&-16)>=er.size():er.getOffset()+160+16>=er.size()}parseNode(er,tr){const ir={},nr=tr>=7500?er.getUint64():er.getUint32(),sr=tr>=7500?er.getUint64():er.getUint32();tr>=7500?er.getUint64():er.getUint32();const ar=er.getUint8(),or=er.getString(ar);if(nr===0)return null;const lr=[];for(let hr=0;hr<sr;hr++)lr.push(this.parseProperty(er));const cr=lr.length>0?lr[0]:"",ur=lr.length>1?lr[1]:"",dr=lr.length>2?lr[2]:"";for(ir.singleProperty=sr===1&&er.getOffset()===nr;nr>er.getOffset();){const hr=this.parseNode(er,tr);hr!==null&&this.parseSubNode(or,ir,hr)}return ir.propertyList=lr,typeof cr=="number"&&(ir.id=cr),ur!==""&&(ir.attrName=ur),dr!==""&&(ir.attrType=dr),or!==""&&(ir.name=or),ir}parseSubNode(er,tr,ir){if(ir.singleProperty===!0){const nr=ir.propertyList[0];Array.isArray(nr)?(tr[ir.name]=ir,ir.a=nr):tr[ir.name]=nr}else if(er==="Connections"&&ir.name==="C"){const nr=[];ir.propertyList.forEach(function(sr,ar){ar!==0&&nr.push(sr)}),tr.connections===void 0&&(tr.connections=[]),tr.connections.push(nr)}else if(ir.name==="Properties70")Object.keys(ir).forEach(function(sr){tr[sr]=ir[sr]});else if(er==="Properties70"&&ir.name==="P"){let nr=ir.propertyList[0],sr=ir.propertyList[1];const ar=ir.propertyList[2],or=ir.propertyList[3];let lr;nr.indexOf("Lcl ")===0&&(nr=nr.replace("Lcl ","Lcl_")),sr.indexOf("Lcl ")===0&&(sr=sr.replace("Lcl ","Lcl_")),sr==="Color"||sr==="ColorRGB"||sr==="Vector"||sr==="Vector3D"||sr.indexOf("Lcl_")===0?lr=[ir.propertyList[4],ir.propertyList[5],ir.propertyList[6]]:lr=ir.propertyList[4],tr[nr]={type:sr,type2:ar,flag:or,value:lr}}else tr[ir.name]===void 0?typeof ir.id=="number"?(tr[ir.name]={},tr[ir.name][ir.id]=ir):tr[ir.name]=ir:ir.name==="PoseNode"?(Array.isArray(tr[ir.name])||(tr[ir.name]=[tr[ir.name]]),tr[ir.name].push(ir)):tr[ir.name][ir.id]===void 0&&(tr[ir.name][ir.id]=ir)}parseProperty(er){const tr=er.getString(1);let ir;switch(tr){case"C":return er.getBoolean();case"D":return er.getFloat64();case"F":return er.getFloat32();case"I":return er.getInt32();case"L":return er.getInt64();case"R":return ir=er.getUint32(),er.getArrayBuffer(ir);case"S":return ir=er.getUint32(),er.getString(ir);case"Y":return er.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const nr=er.getUint32(),sr=er.getUint32(),ar=er.getUint32();if(sr===0)switch(tr){case"b":case"c":return er.getBooleanArray(nr);case"d":return er.getFloat64Array(nr);case"f":return er.getFloat32Array(nr);case"i":return er.getInt32Array(nr);case"l":return er.getInt64Array(nr)}const or=unzlibSync(new Uint8Array(er.getArrayBuffer(ar))),lr=new BinaryReader(or.buffer);switch(tr){case"b":case"c":return lr.getBooleanArray(nr);case"d":return lr.getFloat64Array(nr);case"f":return lr.getFloat32Array(nr);case"i":return lr.getInt32Array(nr);case"l":return lr.getInt64Array(nr)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+tr)}}}class BinaryReader{constructor(er,tr){this.dv=new DataView(er),this.offset=0,this.littleEndian=tr!==void 0?tr:!0,this._textDecoder=new TextDecoder}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(er){this.offset+=er}getBoolean(){return(this.getUint8()&1)===1}getBooleanArray(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(this.getBoolean());return tr}getUint8(){const er=this.dv.getUint8(this.offset);return this.offset+=1,er}getInt16(){const er=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,er}getInt32(){const er=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,er}getInt32Array(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(this.getInt32());return tr}getUint32(){const er=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,er}getInt64(){let er,tr;return this.littleEndian?(er=this.getUint32(),tr=this.getUint32()):(tr=this.getUint32(),er=this.getUint32()),tr&2147483648?(tr=~tr&4294967295,er=~er&4294967295,er===4294967295&&(tr=tr+1&4294967295),er=er+1&4294967295,-(tr*4294967296+er)):tr*4294967296+er}getInt64Array(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(this.getInt64());return tr}getUint64(){let er,tr;return this.littleEndian?(er=this.getUint32(),tr=this.getUint32()):(tr=this.getUint32(),er=this.getUint32()),tr*4294967296+er}getFloat32(){const er=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,er}getFloat32Array(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(this.getFloat32());return tr}getFloat64(){const er=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,er}getFloat64Array(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(this.getFloat64());return tr}getArrayBuffer(er){const tr=this.dv.buffer.slice(this.offset,this.offset+er);return this.offset+=er,tr}getString(er){const tr=this.offset;let ir=new Uint8Array(this.dv.buffer,tr,er);this.skip(er);const nr=ir.indexOf(0);return nr>=0&&(ir=new Uint8Array(this.dv.buffer,tr,nr)),this._textDecoder.decode(ir)}}class FBXTree{add(er,tr){this[er]=tr}}function isFbxFormatBinary(rr){const er="Kaydara FBX Binary  \0";return rr.byteLength>=er.length&&er===convertArrayBufferToString(rr,0,er.length)}function isFbxFormatASCII(rr){const er=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let tr=0;function ir(nr){const sr=rr[nr-1];return rr=rr.slice(tr+nr),tr++,sr}for(let nr=0;nr<er.length;++nr)if(ir(1)===er[nr])return!1;return!0}function getFbxVersion(rr){const er=/FBXVersion: (\d+)/,tr=rr.match(er);if(tr)return parseInt(tr[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function convertFBXTimeToSeconds(rr){return rr/46186158e3}const dataArray=[];function getData(rr,er,tr,ir){let nr;switch(ir.mappingType){case"ByPolygonVertex":nr=rr;break;case"ByPolygon":nr=er;break;case"ByVertice":nr=tr;break;case"AllSame":nr=ir.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+ir.mappingType)}ir.referenceType==="IndexToDirect"&&(nr=ir.indices[nr]);const sr=nr*ir.dataSize,ar=sr+ir.dataSize;return slice(dataArray,ir.buffer,sr,ar)}const tempEuler=new Euler,tempVec=new Vector3$1;function generateTransform(rr){const er=new Matrix4,tr=new Matrix4,ir=new Matrix4,nr=new Matrix4,sr=new Matrix4,ar=new Matrix4,or=new Matrix4,lr=new Matrix4,cr=new Matrix4,ur=new Matrix4,dr=new Matrix4,hr=new Matrix4,pr=rr.inheritType?rr.inheritType:0;rr.translation&&er.setPosition(tempVec.fromArray(rr.translation));const gr=getEulerOrder(0);if(rr.preRotation){const Rr=rr.preRotation.map(MathUtils.degToRad);Rr.push(gr),tr.makeRotationFromEuler(tempEuler.fromArray(Rr))}if(rr.rotation){const Rr=rr.rotation.map(MathUtils.degToRad);Rr.push(rr.eulerOrder||gr),ir.makeRotationFromEuler(tempEuler.fromArray(Rr))}if(rr.postRotation){const Rr=rr.postRotation.map(MathUtils.degToRad);Rr.push(gr),nr.makeRotationFromEuler(tempEuler.fromArray(Rr)),nr.invert()}rr.scale&&sr.scale(tempVec.fromArray(rr.scale)),rr.scalingOffset&&or.setPosition(tempVec.fromArray(rr.scalingOffset)),rr.scalingPivot&&ar.setPosition(tempVec.fromArray(rr.scalingPivot)),rr.rotationOffset&&lr.setPosition(tempVec.fromArray(rr.rotationOffset)),rr.rotationPivot&&cr.setPosition(tempVec.fromArray(rr.rotationPivot)),rr.parentMatrixWorld&&(dr.copy(rr.parentMatrix),ur.copy(rr.parentMatrixWorld));const vr=tr.clone().multiply(ir).multiply(nr),mr=new Matrix4;mr.extractRotation(ur);const fr=new Matrix4;fr.copyPosition(ur);const _r=fr.clone().invert().multiply(ur),Ar=mr.clone().invert().multiply(_r),yr=sr,wr=new Matrix4;if(pr===0)wr.copy(mr).multiply(vr).multiply(Ar).multiply(yr);else if(pr===1)wr.copy(mr).multiply(Ar).multiply(vr).multiply(yr);else{const Pr=new Matrix4().scale(new Vector3$1().setFromMatrixScale(dr)).clone().invert(),Dr=Ar.clone().multiply(Pr);wr.copy(mr).multiply(vr).multiply(Dr).multiply(yr)}const xr=cr.clone().invert(),Sr=ar.clone().invert();let br=er.clone().multiply(lr).multiply(cr).multiply(tr).multiply(ir).multiply(nr).multiply(xr).multiply(or).multiply(ar).multiply(sr).multiply(Sr);const Cr=new Matrix4().copyPosition(br),Ir=ur.clone().multiply(Cr);return hr.copyPosition(Ir),br=hr.clone().multiply(wr),br.premultiply(ur.invert()),br}function getEulerOrder(rr){rr=rr||0;const er=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return rr===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),er[0]):er[rr]}function parseNumberArray(rr){return rr.split(",").map(function(tr){return parseFloat(tr)})}function convertArrayBufferToString(rr,er,tr){return er===void 0&&(er=0),tr===void 0&&(tr=rr.byteLength),new TextDecoder().decode(new Uint8Array(rr,er,tr))}function append(rr,er){for(let tr=0,ir=rr.length,nr=er.length;tr<nr;tr++,ir++)rr[ir]=er[tr]}function slice(rr,er,tr,ir){for(let nr=tr,sr=0;nr<ir;nr++,sr++)rr[sr]=er[nr];return rr}class FontLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){const lr=sr.parse(JSON.parse(or));tr&&tr(lr)},ir,nr)}parse(er){return new Font$1(er)}}let Font$1=class{constructor(er){this.isFont=!0,this.type="Font",this.data=er}generateShapes(er,tr=100){const ir=[],nr=createPaths(er,tr,this.data);for(let sr=0,ar=nr.length;sr<ar;sr++)ir.push(...nr[sr].toShapes());return ir}};function createPaths(rr,er,tr){const ir=Array.from(rr),nr=er/tr.resolution,sr=(tr.boundingBox.yMax-tr.boundingBox.yMin+tr.underlineThickness)*nr,ar=[];let or=0,lr=0;for(let cr=0;cr<ir.length;cr++){const ur=ir[cr];if(ur===`
`)or=0,lr-=sr;else{const dr=createPath(ur,nr,or,lr,tr);or+=dr.offsetX,ar.push(dr.path)}}return ar}function createPath(rr,er,tr,ir,nr){const sr=nr.glyphs[rr]||nr.glyphs["?"];if(!sr){console.error('THREE.Font: character "'+rr+'" does not exists in font family '+nr.familyName+".");return}const ar=new ShapePath;let or,lr,cr,ur,dr,hr,pr,gr;if(sr.o){const vr=sr._cachedOutline||(sr._cachedOutline=sr.o.split(" "));for(let mr=0,fr=vr.length;mr<fr;)switch(vr[mr++]){case"m":or=vr[mr++]*er+tr,lr=vr[mr++]*er+ir,ar.moveTo(or,lr);break;case"l":or=vr[mr++]*er+tr,lr=vr[mr++]*er+ir,ar.lineTo(or,lr);break;case"q":cr=vr[mr++]*er+tr,ur=vr[mr++]*er+ir,dr=vr[mr++]*er+tr,hr=vr[mr++]*er+ir,ar.quadraticCurveTo(dr,hr,cr,ur);break;case"b":cr=vr[mr++]*er+tr,ur=vr[mr++]*er+ir,dr=vr[mr++]*er+tr,hr=vr[mr++]*er+ir,pr=vr[mr++]*er+tr,gr=vr[mr++]*er+ir,ar.bezierCurveTo(dr,hr,pr,gr,cr,ur);break}}return{offsetX:sr.ha*er,path:ar}}class GCodeLoader extends Loader{constructor(er){super(er),this.splitLayer=!1}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){let tr={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1};const ir=[];let nr;const sr=new LineBasicMaterial({color:16711680});sr.name="path";const ar=new LineBasicMaterial({color:65280});ar.name="extruded";function or(gr){nr={vertex:[],pathVertex:[],z:gr.z},ir.push(nr)}function lr(gr,vr){nr===void 0&&or(gr),tr.extruding?(nr.vertex.push(gr.x,gr.y,gr.z),nr.vertex.push(vr.x,vr.y,vr.z)):(nr.pathVertex.push(gr.x,gr.y,gr.z),nr.pathVertex.push(vr.x,vr.y,vr.z))}function cr(gr,vr){return tr.relative?vr:vr-gr}function ur(gr,vr){return tr.relative?gr+vr:vr}const dr=er.replace(/;.+/g,"").split(`
`);for(let gr=0;gr<dr.length;gr++){const vr=dr[gr].split(" "),mr=vr[0].toUpperCase(),fr={};if(vr.splice(1).forEach(function(_r){if(_r[0]!==void 0){const Ar=_r[0].toLowerCase(),yr=parseFloat(_r.substring(1));fr[Ar]=yr}}),mr==="G0"||mr==="G1"){const _r={x:fr.x!==void 0?ur(tr.x,fr.x):tr.x,y:fr.y!==void 0?ur(tr.y,fr.y):tr.y,z:fr.z!==void 0?ur(tr.z,fr.z):tr.z,e:fr.e!==void 0?ur(tr.e,fr.e):tr.e,f:fr.f!==void 0?ur(tr.f,fr.f):tr.f};cr(tr.e,_r.e)>0&&(tr.extruding=cr(tr.e,_r.e)>0,(nr==null||_r.z!=nr.z)&&or(_r)),lr(tr,_r),tr=_r}else if(!(mr==="G2"||mr==="G3")){if(mr==="G90")tr.relative=!1;else if(mr==="G91")tr.relative=!0;else if(mr==="G92"){const _r=tr;_r.x=fr.x!==void 0?fr.x:_r.x,_r.y=fr.y!==void 0?fr.y:_r.y,_r.z=fr.z!==void 0?fr.z:_r.z,_r.e=fr.e!==void 0?fr.e:_r.e}}}function hr(gr,vr,mr){const fr=new BufferGeometry;fr.setAttribute("position",new Float32BufferAttribute(gr,3));const _r=new LineSegments(fr,vr?ar:sr);_r.name="layer"+mr,pr.add(_r)}const pr=new Group;if(pr.name="gcode",this.splitLayer)for(let gr=0;gr<ir.length;gr++){const vr=ir[gr];hr(vr.vertex,!0,gr),hr(vr.pathVertex,!1,gr)}else{const gr=[],vr=[];for(let mr=0;mr<ir.length;mr++){const fr=ir[mr],_r=fr.vertex,Ar=fr.pathVertex;for(let yr=0;yr<_r.length;yr++)gr.push(_r[yr]);for(let yr=0;yr<Ar.length;yr++)vr.push(Ar[yr])}hr(gr,!0,ir.length),hr(vr,!1,ir.length)}return pr.rotation.set(-Math.PI/2,0,0),pr}}class GLTFLoader extends Loader{constructor(er){super(er),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(tr){return new GLTFMaterialsClearcoatExtension(tr)}),this.register(function(tr){return new GLTFMaterialsDispersionExtension(tr)}),this.register(function(tr){return new GLTFTextureBasisUExtension(tr)}),this.register(function(tr){return new GLTFTextureWebPExtension(tr)}),this.register(function(tr){return new GLTFTextureAVIFExtension(tr)}),this.register(function(tr){return new GLTFMaterialsSheenExtension(tr)}),this.register(function(tr){return new GLTFMaterialsTransmissionExtension(tr)}),this.register(function(tr){return new GLTFMaterialsVolumeExtension(tr)}),this.register(function(tr){return new GLTFMaterialsIorExtension(tr)}),this.register(function(tr){return new GLTFMaterialsEmissiveStrengthExtension(tr)}),this.register(function(tr){return new GLTFMaterialsSpecularExtension(tr)}),this.register(function(tr){return new GLTFMaterialsIridescenceExtension(tr)}),this.register(function(tr){return new GLTFMaterialsAnisotropyExtension(tr)}),this.register(function(tr){return new GLTFMaterialsBumpExtension(tr)}),this.register(function(tr){return new GLTFLightsExtension(tr)}),this.register(function(tr){return new GLTFMeshoptCompression(tr)}),this.register(function(tr){return new GLTFMeshGpuInstancing(tr)})}load(er,tr,ir,nr){const sr=this;let ar;if(this.resourcePath!=="")ar=this.resourcePath;else if(this.path!==""){const cr=LoaderUtils.extractUrlBase(er);ar=LoaderUtils.resolveURL(cr,this.path)}else ar=LoaderUtils.extractUrlBase(er);this.manager.itemStart(er);const or=function(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er),sr.manager.itemEnd(er)},lr=new FileLoader(this.manager);lr.setPath(this.path),lr.setResponseType("arraybuffer"),lr.setRequestHeader(this.requestHeader),lr.setWithCredentials(this.withCredentials),lr.load(er,function(cr){try{sr.parse(cr,ar,function(ur){tr(ur),sr.manager.itemEnd(er)},or)}catch(ur){or(ur)}},ir,or)}setDRACOLoader(er){return this.dracoLoader=er,this}setKTX2Loader(er){return this.ktx2Loader=er,this}setMeshoptDecoder(er){return this.meshoptDecoder=er,this}register(er){return this.pluginCallbacks.indexOf(er)===-1&&this.pluginCallbacks.push(er),this}unregister(er){return this.pluginCallbacks.indexOf(er)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(er),1),this}parse(er,tr,ir,nr){let sr;const ar={},or={},lr=new TextDecoder;if(typeof er=="string")sr=JSON.parse(er);else if(er instanceof ArrayBuffer)if(lr.decode(new Uint8Array(er,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{ar[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(er)}catch(dr){nr&&nr(dr);return}sr=JSON.parse(ar[EXTENSIONS.KHR_BINARY_GLTF].content)}else sr=JSON.parse(lr.decode(er));else sr=er;if(sr.asset===void 0||sr.asset.version[0]<2){nr&&nr(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const cr=new GLTFParser(sr,{path:tr||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});cr.fileLoader.setRequestHeader(this.requestHeader);for(let ur=0;ur<this.pluginCallbacks.length;ur++){const dr=this.pluginCallbacks[ur](cr);dr.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),or[dr.name]=dr,ar[dr.name]=!0}if(sr.extensionsUsed)for(let ur=0;ur<sr.extensionsUsed.length;++ur){const dr=sr.extensionsUsed[ur],hr=sr.extensionsRequired||[];switch(dr){case EXTENSIONS.KHR_MATERIALS_UNLIT:ar[dr]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:ar[dr]=new GLTFDracoMeshCompressionExtension(sr,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:ar[dr]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:ar[dr]=new GLTFMeshQuantizationExtension;break;default:hr.indexOf(dr)>=0&&or[dr]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+dr+'".')}}cr.setExtensions(ar),cr.setPlugins(or),cr.parse(ir,nr)}parseAsync(er,tr){const ir=this;return new Promise(function(nr,sr){ir.parse(er,tr,nr,sr)})}}function GLTFRegistry(){let rr={};return{get:function(er){return rr[er]},add:function(er,tr){rr[er]=tr},remove:function(er){delete rr[er]},removeAll:function(){rr={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const er=this.parser,tr=this.parser.json.nodes||[];for(let ir=0,nr=tr.length;ir<nr;ir++){const sr=tr[ir];sr.extensions&&sr.extensions[this.name]&&sr.extensions[this.name].light!==void 0&&er._addNodeRef(this.cache,sr.extensions[this.name].light)}}_loadLight(er){const tr=this.parser,ir="light:"+er;let nr=tr.cache.get(ir);if(nr)return nr;const sr=tr.json,lr=((sr.extensions&&sr.extensions[this.name]||{}).lights||[])[er];let cr;const ur=new Color(16777215);lr.color!==void 0&&ur.setRGB(lr.color[0],lr.color[1],lr.color[2],LinearSRGBColorSpace);const dr=lr.range!==void 0?lr.range:0;switch(lr.type){case"directional":cr=new DirectionalLight(ur),cr.target.position.set(0,0,-1),cr.add(cr.target);break;case"point":cr=new PointLight(ur),cr.distance=dr;break;case"spot":cr=new SpotLight(ur),cr.distance=dr,lr.spot=lr.spot||{},lr.spot.innerConeAngle=lr.spot.innerConeAngle!==void 0?lr.spot.innerConeAngle:0,lr.spot.outerConeAngle=lr.spot.outerConeAngle!==void 0?lr.spot.outerConeAngle:Math.PI/4,cr.angle=lr.spot.outerConeAngle,cr.penumbra=1-lr.spot.innerConeAngle/lr.spot.outerConeAngle,cr.target.position.set(0,0,-1),cr.add(cr.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+lr.type)}return cr.position.set(0,0,0),cr.decay=2,assignExtrasToUserData(cr,lr),lr.intensity!==void 0&&(cr.intensity=lr.intensity),cr.name=tr.createUniqueName(lr.name||"light_"+er),nr=Promise.resolve(cr),tr.cache.add(ir,nr),nr}getDependency(er,tr){if(er==="light")return this._loadLight(tr)}createNodeAttachment(er){const tr=this,ir=this.parser,sr=ir.json.nodes[er],or=(sr.extensions&&sr.extensions[this.name]||{}).light;return or===void 0?null:this._loadLight(or).then(function(lr){return ir._getNodeRef(tr.cache,or,lr)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(er,tr,ir){const nr=[];er.color=new Color(1,1,1),er.opacity=1;const sr=tr.pbrMetallicRoughness;if(sr){if(Array.isArray(sr.baseColorFactor)){const ar=sr.baseColorFactor;er.color.setRGB(ar[0],ar[1],ar[2],LinearSRGBColorSpace),er.opacity=ar[3]}sr.baseColorTexture!==void 0&&nr.push(ir.assignTexture(er,"map",sr.baseColorTexture,SRGBColorSpace))}return Promise.all(nr)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name].emissiveStrength;return sr!==void 0&&(tr.emissiveIntensity=sr),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];if(ar.clearcoatFactor!==void 0&&(tr.clearcoat=ar.clearcoatFactor),ar.clearcoatTexture!==void 0&&sr.push(ir.assignTexture(tr,"clearcoatMap",ar.clearcoatTexture)),ar.clearcoatRoughnessFactor!==void 0&&(tr.clearcoatRoughness=ar.clearcoatRoughnessFactor),ar.clearcoatRoughnessTexture!==void 0&&sr.push(ir.assignTexture(tr,"clearcoatRoughnessMap",ar.clearcoatRoughnessTexture)),ar.clearcoatNormalTexture!==void 0&&(sr.push(ir.assignTexture(tr,"clearcoatNormalMap",ar.clearcoatNormalTexture)),ar.clearcoatNormalTexture.scale!==void 0)){const or=ar.clearcoatNormalTexture.scale;tr.clearcoatNormalScale=new Vector2(or,or)}return Promise.all(sr)}}class GLTFMaterialsDispersionExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name];return tr.dispersion=sr.dispersion!==void 0?sr.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.iridescenceFactor!==void 0&&(tr.iridescence=ar.iridescenceFactor),ar.iridescenceTexture!==void 0&&sr.push(ir.assignTexture(tr,"iridescenceMap",ar.iridescenceTexture)),ar.iridescenceIor!==void 0&&(tr.iridescenceIOR=ar.iridescenceIor),tr.iridescenceThicknessRange===void 0&&(tr.iridescenceThicknessRange=[100,400]),ar.iridescenceThicknessMinimum!==void 0&&(tr.iridescenceThicknessRange[0]=ar.iridescenceThicknessMinimum),ar.iridescenceThicknessMaximum!==void 0&&(tr.iridescenceThicknessRange[1]=ar.iridescenceThicknessMaximum),ar.iridescenceThicknessTexture!==void 0&&sr.push(ir.assignTexture(tr,"iridescenceThicknessMap",ar.iridescenceThicknessTexture)),Promise.all(sr)}}class GLTFMaterialsSheenExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[];tr.sheenColor=new Color(0,0,0),tr.sheenRoughness=0,tr.sheen=1;const ar=nr.extensions[this.name];if(ar.sheenColorFactor!==void 0){const or=ar.sheenColorFactor;tr.sheenColor.setRGB(or[0],or[1],or[2],LinearSRGBColorSpace)}return ar.sheenRoughnessFactor!==void 0&&(tr.sheenRoughness=ar.sheenRoughnessFactor),ar.sheenColorTexture!==void 0&&sr.push(ir.assignTexture(tr,"sheenColorMap",ar.sheenColorTexture,SRGBColorSpace)),ar.sheenRoughnessTexture!==void 0&&sr.push(ir.assignTexture(tr,"sheenRoughnessMap",ar.sheenRoughnessTexture)),Promise.all(sr)}}class GLTFMaterialsTransmissionExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.transmissionFactor!==void 0&&(tr.transmission=ar.transmissionFactor),ar.transmissionTexture!==void 0&&sr.push(ir.assignTexture(tr,"transmissionMap",ar.transmissionTexture)),Promise.all(sr)}}class GLTFMaterialsVolumeExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];tr.thickness=ar.thicknessFactor!==void 0?ar.thicknessFactor:0,ar.thicknessTexture!==void 0&&sr.push(ir.assignTexture(tr,"thicknessMap",ar.thicknessTexture)),tr.attenuationDistance=ar.attenuationDistance||1/0;const or=ar.attenuationColor||[1,1,1];return tr.attenuationColor=new Color().setRGB(or[0],or[1],or[2],LinearSRGBColorSpace),Promise.all(sr)}}class GLTFMaterialsIorExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const nr=this.parser.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=nr.extensions[this.name];return tr.ior=sr.ior!==void 0?sr.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];tr.specularIntensity=ar.specularFactor!==void 0?ar.specularFactor:1,ar.specularTexture!==void 0&&sr.push(ir.assignTexture(tr,"specularIntensityMap",ar.specularTexture));const or=ar.specularColorFactor||[1,1,1];return tr.specularColor=new Color().setRGB(or[0],or[1],or[2],LinearSRGBColorSpace),ar.specularColorTexture!==void 0&&sr.push(ir.assignTexture(tr,"specularColorMap",ar.specularColorTexture,SRGBColorSpace)),Promise.all(sr)}}class GLTFMaterialsBumpExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return tr.bumpScale=ar.bumpFactor!==void 0?ar.bumpFactor:1,ar.bumpTexture!==void 0&&sr.push(ir.assignTexture(tr,"bumpMap",ar.bumpTexture)),Promise.all(sr)}}class GLTFMaterialsAnisotropyExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(er){const ir=this.parser.json.materials[er];return!ir.extensions||!ir.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(er,tr){const ir=this.parser,nr=ir.json.materials[er];if(!nr.extensions||!nr.extensions[this.name])return Promise.resolve();const sr=[],ar=nr.extensions[this.name];return ar.anisotropyStrength!==void 0&&(tr.anisotropy=ar.anisotropyStrength),ar.anisotropyRotation!==void 0&&(tr.anisotropyRotation=ar.anisotropyRotation),ar.anisotropyTexture!==void 0&&sr.push(ir.assignTexture(tr,"anisotropyMap",ar.anisotropyTexture)),Promise.all(sr)}}class GLTFTextureBasisUExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(er){const tr=this.parser,ir=tr.json,nr=ir.textures[er];if(!nr.extensions||!nr.extensions[this.name])return null;const sr=nr.extensions[this.name],ar=tr.options.ktx2Loader;if(!ar){if(ir.extensionsRequired&&ir.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return tr.loadTextureImage(er,sr.source,ar)}}class GLTFTextureWebPExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(er){const tr=this.name,ir=this.parser,nr=ir.json,sr=nr.textures[er];if(!sr.extensions||!sr.extensions[tr])return null;const ar=sr.extensions[tr],or=nr.images[ar.source];let lr=ir.textureLoader;if(or.uri){const cr=ir.options.manager.getHandler(or.uri);cr!==null&&(lr=cr)}return this.detectSupport().then(function(cr){if(cr)return ir.loadTextureImage(er,ar.source,lr);if(nr.extensionsRequired&&nr.extensionsRequired.indexOf(tr)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return ir.loadTexture(er)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(er){const tr=new Image;tr.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",tr.onload=tr.onerror=function(){er(tr.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(er){this.parser=er,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(er){const tr=this.name,ir=this.parser,nr=ir.json,sr=nr.textures[er];if(!sr.extensions||!sr.extensions[tr])return null;const ar=sr.extensions[tr],or=nr.images[ar.source];let lr=ir.textureLoader;if(or.uri){const cr=ir.options.manager.getHandler(or.uri);cr!==null&&(lr=cr)}return this.detectSupport().then(function(cr){if(cr)return ir.loadTextureImage(er,ar.source,lr);if(nr.extensionsRequired&&nr.extensionsRequired.indexOf(tr)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return ir.loadTexture(er)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(er){const tr=new Image;tr.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",tr.onload=tr.onerror=function(){er(tr.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(er){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=er}loadBufferView(er){const tr=this.parser.json,ir=tr.bufferViews[er];if(ir.extensions&&ir.extensions[this.name]){const nr=ir.extensions[this.name],sr=this.parser.getDependency("buffer",nr.buffer),ar=this.parser.options.meshoptDecoder;if(!ar||!ar.supported){if(tr.extensionsRequired&&tr.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return sr.then(function(or){const lr=nr.byteOffset||0,cr=nr.byteLength||0,ur=nr.count,dr=nr.byteStride,hr=new Uint8Array(or,lr,cr);return ar.decodeGltfBufferAsync?ar.decodeGltfBufferAsync(ur,dr,hr,nr.mode,nr.filter).then(function(pr){return pr.buffer}):ar.ready.then(function(){const pr=new ArrayBuffer(ur*dr);return ar.decodeGltfBuffer(new Uint8Array(pr),ur,dr,hr,nr.mode,nr.filter),pr})})}else return null}}class GLTFMeshGpuInstancing{constructor(er){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=er}createNodeMesh(er){const tr=this.parser.json,ir=tr.nodes[er];if(!ir.extensions||!ir.extensions[this.name]||ir.mesh===void 0)return null;const nr=tr.meshes[ir.mesh];for(const cr of nr.primitives)if(cr.mode!==WEBGL_CONSTANTS.TRIANGLES&&cr.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&cr.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&cr.mode!==void 0)return null;const ar=ir.extensions[this.name].attributes,or=[],lr={};for(const cr in ar)or.push(this.parser.getDependency("accessor",ar[cr]).then(ur=>(lr[cr]=ur,lr[cr])));return or.length<1?null:(or.push(this.parser.createNodeMesh(er)),Promise.all(or).then(cr=>{const ur=cr.pop(),dr=ur.isGroup?ur.children:[ur],hr=cr[0].count,pr=[];for(const gr of dr){const vr=new Matrix4,mr=new Vector3$1,fr=new Quaternion$1,_r=new Vector3$1(1,1,1),Ar=new InstancedMesh(gr.geometry,gr.material,hr);for(let yr=0;yr<hr;yr++)lr.TRANSLATION&&mr.fromBufferAttribute(lr.TRANSLATION,yr),lr.ROTATION&&fr.fromBufferAttribute(lr.ROTATION,yr),lr.SCALE&&_r.fromBufferAttribute(lr.SCALE,yr),Ar.setMatrixAt(yr,vr.compose(mr,fr,_r));for(const yr in lr)if(yr==="_COLOR_0"){const wr=lr[yr];Ar.instanceColor=new InstancedBufferAttribute(wr.array,wr.itemSize,wr.normalized)}else yr!=="TRANSLATION"&&yr!=="ROTATION"&&yr!=="SCALE"&&gr.geometry.setAttribute(yr,lr[yr]);Object3D.prototype.copy.call(Ar,gr),this.parser.assignFinalMaterial(Ar),pr.push(Ar)}return ur.isGroup?(ur.clear(),ur.add(...pr),ur):pr[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(er){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const tr=new DataView(er,0,BINARY_EXTENSION_HEADER_LENGTH),ir=new TextDecoder;if(this.header={magic:ir.decode(new Uint8Array(er.slice(0,4))),version:tr.getUint32(4,!0),length:tr.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const nr=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,sr=new DataView(er,BINARY_EXTENSION_HEADER_LENGTH);let ar=0;for(;ar<nr;){const or=sr.getUint32(ar,!0);ar+=4;const lr=sr.getUint32(ar,!0);if(ar+=4,lr===BINARY_EXTENSION_CHUNK_TYPES.JSON){const cr=new Uint8Array(er,BINARY_EXTENSION_HEADER_LENGTH+ar,or);this.content=ir.decode(cr)}else if(lr===BINARY_EXTENSION_CHUNK_TYPES.BIN){const cr=BINARY_EXTENSION_HEADER_LENGTH+ar;this.body=er.slice(cr,cr+or)}ar+=or}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(er,tr){if(!tr)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=er,this.dracoLoader=tr,this.dracoLoader.preload()}decodePrimitive(er,tr){const ir=this.json,nr=this.dracoLoader,sr=er.extensions[this.name].bufferView,ar=er.extensions[this.name].attributes,or={},lr={},cr={};for(const ur in ar){const dr=ATTRIBUTES[ur]||ur.toLowerCase();or[dr]=ar[ur]}for(const ur in er.attributes){const dr=ATTRIBUTES[ur]||ur.toLowerCase();if(ar[ur]!==void 0){const hr=ir.accessors[er.attributes[ur]],pr=WEBGL_COMPONENT_TYPES[hr.componentType];cr[dr]=pr.name,lr[dr]=hr.normalized===!0}}return tr.getDependency("bufferView",sr).then(function(ur){return new Promise(function(dr,hr){nr.decodeDracoFile(ur,function(pr){for(const gr in pr.attributes){const vr=pr.attributes[gr],mr=lr[gr];mr!==void 0&&(vr.normalized=mr)}dr(pr)},or,cr,LinearSRGBColorSpace,hr)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(er,tr){return(tr.texCoord===void 0||tr.texCoord===er.channel)&&tr.offset===void 0&&tr.rotation===void 0&&tr.scale===void 0||(er=er.clone(),tr.texCoord!==void 0&&(er.channel=tr.texCoord),tr.offset!==void 0&&er.offset.fromArray(tr.offset),tr.rotation!==void 0&&(er.rotation=tr.rotation),tr.scale!==void 0&&er.repeat.fromArray(tr.scale),er.needsUpdate=!0),er}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(er,tr,ir,nr){super(er,tr,ir,nr)}copySampleValue_(er){const tr=this.resultBuffer,ir=this.sampleValues,nr=this.valueSize,sr=er*nr*3+nr;for(let ar=0;ar!==nr;ar++)tr[ar]=ir[sr+ar];return tr}interpolate_(er,tr,ir,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=or*2,cr=or*3,ur=nr-tr,dr=(ir-tr)/ur,hr=dr*dr,pr=hr*dr,gr=er*cr,vr=gr-cr,mr=-2*pr+3*hr,fr=pr-hr,_r=1-mr,Ar=fr-hr+dr;for(let yr=0;yr!==or;yr++){const wr=ar[vr+yr+or],xr=ar[vr+yr+lr]*ur,Sr=ar[gr+yr+or],br=ar[gr+yr]*ur;sr[yr]=_r*wr+Ar*xr+mr*Sr+fr*br}return sr}}const _q=new Quaternion$1;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(er,tr,ir,nr){const sr=super.interpolate_(er,tr,ir,nr);return _q.fromArray(sr).normalize().toArray(sr),sr}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(rr){return rr.DefaultMaterial===void 0&&(rr.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),rr.DefaultMaterial}function addUnknownExtensionsToUserData(rr,er,tr){for(const ir in tr.extensions)rr[ir]===void 0&&(er.userData.gltfExtensions=er.userData.gltfExtensions||{},er.userData.gltfExtensions[ir]=tr.extensions[ir])}function assignExtrasToUserData(rr,er){er.extras!==void 0&&(typeof er.extras=="object"?Object.assign(rr.userData,er.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+er.extras))}function addMorphTargets(rr,er,tr){let ir=!1,nr=!1,sr=!1;for(let cr=0,ur=er.length;cr<ur;cr++){const dr=er[cr];if(dr.POSITION!==void 0&&(ir=!0),dr.NORMAL!==void 0&&(nr=!0),dr.COLOR_0!==void 0&&(sr=!0),ir&&nr&&sr)break}if(!ir&&!nr&&!sr)return Promise.resolve(rr);const ar=[],or=[],lr=[];for(let cr=0,ur=er.length;cr<ur;cr++){const dr=er[cr];if(ir){const hr=dr.POSITION!==void 0?tr.getDependency("accessor",dr.POSITION):rr.attributes.position;ar.push(hr)}if(nr){const hr=dr.NORMAL!==void 0?tr.getDependency("accessor",dr.NORMAL):rr.attributes.normal;or.push(hr)}if(sr){const hr=dr.COLOR_0!==void 0?tr.getDependency("accessor",dr.COLOR_0):rr.attributes.color;lr.push(hr)}}return Promise.all([Promise.all(ar),Promise.all(or),Promise.all(lr)]).then(function(cr){const ur=cr[0],dr=cr[1],hr=cr[2];return ir&&(rr.morphAttributes.position=ur),nr&&(rr.morphAttributes.normal=dr),sr&&(rr.morphAttributes.color=hr),rr.morphTargetsRelative=!0,rr})}function updateMorphTargets(rr,er){if(rr.updateMorphTargets(),er.weights!==void 0)for(let tr=0,ir=er.weights.length;tr<ir;tr++)rr.morphTargetInfluences[tr]=er.weights[tr];if(er.extras&&Array.isArray(er.extras.targetNames)){const tr=er.extras.targetNames;if(rr.morphTargetInfluences.length===tr.length){rr.morphTargetDictionary={};for(let ir=0,nr=tr.length;ir<nr;ir++)rr.morphTargetDictionary[tr[ir]]=ir}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(rr){let er;const tr=rr.extensions&&rr.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(tr?er="draco:"+tr.bufferView+":"+tr.indices+":"+createAttributesKey(tr.attributes):er=rr.indices+":"+createAttributesKey(rr.attributes)+":"+rr.mode,rr.targets!==void 0)for(let ir=0,nr=rr.targets.length;ir<nr;ir++)er+=":"+createAttributesKey(rr.targets[ir]);return er}function createAttributesKey(rr){let er="";const tr=Object.keys(rr).sort();for(let ir=0,nr=tr.length;ir<nr;ir++)er+=tr[ir]+":"+rr[tr[ir]]+";";return er}function getNormalizedComponentScale(rr){switch(rr){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(rr){return rr.search(/\.jpe?g($|\?)/i)>0||rr.search(/^data\:image\/jpeg/)===0?"image/jpeg":rr.search(/\.webp($|\?)/i)>0||rr.search(/^data\:image\/webp/)===0?"image/webp":rr.search(/\.ktx2($|\?)/i)>0||rr.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const _identityMatrix=new Matrix4;class GLTFParser{constructor(er={},tr={}){this.json=er,this.extensions={},this.plugins={},this.options=tr,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let ir=!1,nr=-1,sr=!1,ar=-1;if(typeof navigator<"u"){const or=navigator.userAgent;ir=/^((?!chrome|android).)*safari/i.test(or)===!0;const lr=or.match(/Version\/(\d+)/);nr=ir&&lr?parseInt(lr[1],10):-1,sr=or.indexOf("Firefox")>-1,ar=sr?or.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||ir&&nr<17||sr&&ar<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(er){this.extensions=er}setPlugins(er){this.plugins=er}parse(er,tr){const ir=this,nr=this.json,sr=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(ar){return ar._markDefs&&ar._markDefs()}),Promise.all(this._invokeAll(function(ar){return ar.beforeRoot&&ar.beforeRoot()})).then(function(){return Promise.all([ir.getDependencies("scene"),ir.getDependencies("animation"),ir.getDependencies("camera")])}).then(function(ar){const or={scene:ar[0][nr.scene||0],scenes:ar[0],animations:ar[1],cameras:ar[2],asset:nr.asset,parser:ir,userData:{}};return addUnknownExtensionsToUserData(sr,or,nr),assignExtrasToUserData(or,nr),Promise.all(ir._invokeAll(function(lr){return lr.afterRoot&&lr.afterRoot(or)})).then(function(){for(const lr of or.scenes)lr.updateMatrixWorld();er(or)})}).catch(tr)}_markDefs(){const er=this.json.nodes||[],tr=this.json.skins||[],ir=this.json.meshes||[];for(let nr=0,sr=tr.length;nr<sr;nr++){const ar=tr[nr].joints;for(let or=0,lr=ar.length;or<lr;or++)er[ar[or]].isBone=!0}for(let nr=0,sr=er.length;nr<sr;nr++){const ar=er[nr];ar.mesh!==void 0&&(this._addNodeRef(this.meshCache,ar.mesh),ar.skin!==void 0&&(ir[ar.mesh].isSkinnedMesh=!0)),ar.camera!==void 0&&this._addNodeRef(this.cameraCache,ar.camera)}}_addNodeRef(er,tr){tr!==void 0&&(er.refs[tr]===void 0&&(er.refs[tr]=er.uses[tr]=0),er.refs[tr]++)}_getNodeRef(er,tr,ir){if(er.refs[tr]<=1)return ir;const nr=ir.clone(),sr=(ar,or)=>{const lr=this.associations.get(ar);lr!=null&&this.associations.set(or,lr);for(const[cr,ur]of ar.children.entries())sr(ur,or.children[cr])};return sr(ir,nr),nr.name+="_instance_"+er.uses[tr]++,nr}_invokeOne(er){const tr=Object.values(this.plugins);tr.push(this);for(let ir=0;ir<tr.length;ir++){const nr=er(tr[ir]);if(nr)return nr}return null}_invokeAll(er){const tr=Object.values(this.plugins);tr.unshift(this);const ir=[];for(let nr=0;nr<tr.length;nr++){const sr=er(tr[nr]);sr&&ir.push(sr)}return ir}getDependency(er,tr){const ir=er+":"+tr;let nr=this.cache.get(ir);if(!nr){switch(er){case"scene":nr=this.loadScene(tr);break;case"node":nr=this._invokeOne(function(sr){return sr.loadNode&&sr.loadNode(tr)});break;case"mesh":nr=this._invokeOne(function(sr){return sr.loadMesh&&sr.loadMesh(tr)});break;case"accessor":nr=this.loadAccessor(tr);break;case"bufferView":nr=this._invokeOne(function(sr){return sr.loadBufferView&&sr.loadBufferView(tr)});break;case"buffer":nr=this.loadBuffer(tr);break;case"material":nr=this._invokeOne(function(sr){return sr.loadMaterial&&sr.loadMaterial(tr)});break;case"texture":nr=this._invokeOne(function(sr){return sr.loadTexture&&sr.loadTexture(tr)});break;case"skin":nr=this.loadSkin(tr);break;case"animation":nr=this._invokeOne(function(sr){return sr.loadAnimation&&sr.loadAnimation(tr)});break;case"camera":nr=this.loadCamera(tr);break;default:if(nr=this._invokeOne(function(sr){return sr!=this&&sr.getDependency&&sr.getDependency(er,tr)}),!nr)throw new Error("Unknown type: "+er);break}this.cache.add(ir,nr)}return nr}getDependencies(er){let tr=this.cache.get(er);if(!tr){const ir=this,nr=this.json[er+(er==="mesh"?"es":"s")]||[];tr=Promise.all(nr.map(function(sr,ar){return ir.getDependency(er,ar)})),this.cache.add(er,tr)}return tr}loadBuffer(er){const tr=this.json.buffers[er],ir=this.fileLoader;if(tr.type&&tr.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+tr.type+" buffer type is not supported.");if(tr.uri===void 0&&er===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const nr=this.options;return new Promise(function(sr,ar){ir.load(LoaderUtils.resolveURL(tr.uri,nr.path),sr,void 0,function(){ar(new Error('THREE.GLTFLoader: Failed to load buffer "'+tr.uri+'".'))})})}loadBufferView(er){const tr=this.json.bufferViews[er];return this.getDependency("buffer",tr.buffer).then(function(ir){const nr=tr.byteLength||0,sr=tr.byteOffset||0;return ir.slice(sr,sr+nr)})}loadAccessor(er){const tr=this,ir=this.json,nr=this.json.accessors[er];if(nr.bufferView===void 0&&nr.sparse===void 0){const ar=WEBGL_TYPE_SIZES[nr.type],or=WEBGL_COMPONENT_TYPES[nr.componentType],lr=nr.normalized===!0,cr=new or(nr.count*ar);return Promise.resolve(new BufferAttribute(cr,ar,lr))}const sr=[];return nr.bufferView!==void 0?sr.push(this.getDependency("bufferView",nr.bufferView)):sr.push(null),nr.sparse!==void 0&&(sr.push(this.getDependency("bufferView",nr.sparse.indices.bufferView)),sr.push(this.getDependency("bufferView",nr.sparse.values.bufferView))),Promise.all(sr).then(function(ar){const or=ar[0],lr=WEBGL_TYPE_SIZES[nr.type],cr=WEBGL_COMPONENT_TYPES[nr.componentType],ur=cr.BYTES_PER_ELEMENT,dr=ur*lr,hr=nr.byteOffset||0,pr=nr.bufferView!==void 0?ir.bufferViews[nr.bufferView].byteStride:void 0,gr=nr.normalized===!0;let vr,mr;if(pr&&pr!==dr){const fr=Math.floor(hr/pr),_r="InterleavedBuffer:"+nr.bufferView+":"+nr.componentType+":"+fr+":"+nr.count;let Ar=tr.cache.get(_r);Ar||(vr=new cr(or,fr*pr,nr.count*pr/ur),Ar=new InterleavedBuffer(vr,pr/ur),tr.cache.add(_r,Ar)),mr=new InterleavedBufferAttribute(Ar,lr,hr%pr/ur,gr)}else or===null?vr=new cr(nr.count*lr):vr=new cr(or,hr,nr.count*lr),mr=new BufferAttribute(vr,lr,gr);if(nr.sparse!==void 0){const fr=WEBGL_TYPE_SIZES.SCALAR,_r=WEBGL_COMPONENT_TYPES[nr.sparse.indices.componentType],Ar=nr.sparse.indices.byteOffset||0,yr=nr.sparse.values.byteOffset||0,wr=new _r(ar[1],Ar,nr.sparse.count*fr),xr=new cr(ar[2],yr,nr.sparse.count*lr);or!==null&&(mr=new BufferAttribute(mr.array.slice(),mr.itemSize,mr.normalized)),mr.normalized=!1;for(let Sr=0,br=wr.length;Sr<br;Sr++){const Cr=wr[Sr];if(mr.setX(Cr,xr[Sr*lr]),lr>=2&&mr.setY(Cr,xr[Sr*lr+1]),lr>=3&&mr.setZ(Cr,xr[Sr*lr+2]),lr>=4&&mr.setW(Cr,xr[Sr*lr+3]),lr>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}mr.normalized=gr}return mr})}loadTexture(er){const tr=this.json,ir=this.options,sr=tr.textures[er].source,ar=tr.images[sr];let or=this.textureLoader;if(ar.uri){const lr=ir.manager.getHandler(ar.uri);lr!==null&&(or=lr)}return this.loadTextureImage(er,sr,or)}loadTextureImage(er,tr,ir){const nr=this,sr=this.json,ar=sr.textures[er],or=sr.images[tr],lr=(or.uri||or.bufferView)+":"+ar.sampler;if(this.textureCache[lr])return this.textureCache[lr];const cr=this.loadImageSource(tr,ir).then(function(ur){ur.flipY=!1,ur.name=ar.name||or.name||"",ur.name===""&&typeof or.uri=="string"&&or.uri.startsWith("data:image/")===!1&&(ur.name=or.uri);const hr=(sr.samplers||{})[ar.sampler]||{};return ur.magFilter=WEBGL_FILTERS[hr.magFilter]||LinearFilter,ur.minFilter=WEBGL_FILTERS[hr.minFilter]||LinearMipmapLinearFilter,ur.wrapS=WEBGL_WRAPPINGS[hr.wrapS]||RepeatWrapping,ur.wrapT=WEBGL_WRAPPINGS[hr.wrapT]||RepeatWrapping,ur.generateMipmaps=!ur.isCompressedTexture&&ur.minFilter!==NearestFilter&&ur.minFilter!==LinearFilter,nr.associations.set(ur,{textures:er}),ur}).catch(function(){return null});return this.textureCache[lr]=cr,cr}loadImageSource(er,tr){const ir=this,nr=this.json,sr=this.options;if(this.sourceCache[er]!==void 0)return this.sourceCache[er].then(dr=>dr.clone());const ar=nr.images[er],or=self.URL||self.webkitURL;let lr=ar.uri||"",cr=!1;if(ar.bufferView!==void 0)lr=ir.getDependency("bufferView",ar.bufferView).then(function(dr){cr=!0;const hr=new Blob([dr],{type:ar.mimeType});return lr=or.createObjectURL(hr),lr});else if(ar.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+er+" is missing URI and bufferView");const ur=Promise.resolve(lr).then(function(dr){return new Promise(function(hr,pr){let gr=hr;tr.isImageBitmapLoader===!0&&(gr=function(vr){const mr=new Texture(vr);mr.needsUpdate=!0,hr(mr)}),tr.load(LoaderUtils.resolveURL(dr,sr.path),gr,void 0,pr)})}).then(function(dr){return cr===!0&&or.revokeObjectURL(lr),assignExtrasToUserData(dr,ar),dr.userData.mimeType=ar.mimeType||getImageURIMimeType(ar.uri),dr}).catch(function(dr){throw console.error("THREE.GLTFLoader: Couldn't load texture",lr),dr});return this.sourceCache[er]=ur,ur}assignTexture(er,tr,ir,nr){const sr=this;return this.getDependency("texture",ir.index).then(function(ar){if(!ar)return null;if(ir.texCoord!==void 0&&ir.texCoord>0&&(ar=ar.clone(),ar.channel=ir.texCoord),sr.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const or=ir.extensions!==void 0?ir.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(or){const lr=sr.associations.get(ar);ar=sr.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(ar,or),sr.associations.set(ar,lr)}}return nr!==void 0&&(ar.colorSpace=nr),er[tr]=ar,ar})}assignFinalMaterial(er){const tr=er.geometry;let ir=er.material;const nr=tr.attributes.tangent===void 0,sr=tr.attributes.color!==void 0,ar=tr.attributes.normal===void 0;if(er.isPoints){const or="PointsMaterial:"+ir.uuid;let lr=this.cache.get(or);lr||(lr=new PointsMaterial,Material.prototype.copy.call(lr,ir),lr.color.copy(ir.color),lr.map=ir.map,lr.sizeAttenuation=!1,this.cache.add(or,lr)),ir=lr}else if(er.isLine){const or="LineBasicMaterial:"+ir.uuid;let lr=this.cache.get(or);lr||(lr=new LineBasicMaterial,Material.prototype.copy.call(lr,ir),lr.color.copy(ir.color),lr.map=ir.map,this.cache.add(or,lr)),ir=lr}if(nr||sr||ar){let or="ClonedMaterial:"+ir.uuid+":";nr&&(or+="derivative-tangents:"),sr&&(or+="vertex-colors:"),ar&&(or+="flat-shading:");let lr=this.cache.get(or);lr||(lr=ir.clone(),sr&&(lr.vertexColors=!0),ar&&(lr.flatShading=!0),nr&&(lr.normalScale&&(lr.normalScale.y*=-1),lr.clearcoatNormalScale&&(lr.clearcoatNormalScale.y*=-1)),this.cache.add(or,lr),this.associations.set(lr,this.associations.get(ir))),ir=lr}er.material=ir}getMaterialType(){return MeshStandardMaterial}loadMaterial(er){const tr=this,ir=this.json,nr=this.extensions,sr=ir.materials[er];let ar;const or={},lr=sr.extensions||{},cr=[];if(lr[EXTENSIONS.KHR_MATERIALS_UNLIT]){const dr=nr[EXTENSIONS.KHR_MATERIALS_UNLIT];ar=dr.getMaterialType(),cr.push(dr.extendParams(or,sr,tr))}else{const dr=sr.pbrMetallicRoughness||{};if(or.color=new Color(1,1,1),or.opacity=1,Array.isArray(dr.baseColorFactor)){const hr=dr.baseColorFactor;or.color.setRGB(hr[0],hr[1],hr[2],LinearSRGBColorSpace),or.opacity=hr[3]}dr.baseColorTexture!==void 0&&cr.push(tr.assignTexture(or,"map",dr.baseColorTexture,SRGBColorSpace)),or.metalness=dr.metallicFactor!==void 0?dr.metallicFactor:1,or.roughness=dr.roughnessFactor!==void 0?dr.roughnessFactor:1,dr.metallicRoughnessTexture!==void 0&&(cr.push(tr.assignTexture(or,"metalnessMap",dr.metallicRoughnessTexture)),cr.push(tr.assignTexture(or,"roughnessMap",dr.metallicRoughnessTexture))),ar=this._invokeOne(function(hr){return hr.getMaterialType&&hr.getMaterialType(er)}),cr.push(Promise.all(this._invokeAll(function(hr){return hr.extendMaterialParams&&hr.extendMaterialParams(er,or)})))}sr.doubleSided===!0&&(or.side=DoubleSide);const ur=sr.alphaMode||ALPHA_MODES.OPAQUE;if(ur===ALPHA_MODES.BLEND?(or.transparent=!0,or.depthWrite=!1):(or.transparent=!1,ur===ALPHA_MODES.MASK&&(or.alphaTest=sr.alphaCutoff!==void 0?sr.alphaCutoff:.5)),sr.normalTexture!==void 0&&ar!==MeshBasicMaterial&&(cr.push(tr.assignTexture(or,"normalMap",sr.normalTexture)),or.normalScale=new Vector2(1,1),sr.normalTexture.scale!==void 0)){const dr=sr.normalTexture.scale;or.normalScale.set(dr,dr)}if(sr.occlusionTexture!==void 0&&ar!==MeshBasicMaterial&&(cr.push(tr.assignTexture(or,"aoMap",sr.occlusionTexture)),sr.occlusionTexture.strength!==void 0&&(or.aoMapIntensity=sr.occlusionTexture.strength)),sr.emissiveFactor!==void 0&&ar!==MeshBasicMaterial){const dr=sr.emissiveFactor;or.emissive=new Color().setRGB(dr[0],dr[1],dr[2],LinearSRGBColorSpace)}return sr.emissiveTexture!==void 0&&ar!==MeshBasicMaterial&&cr.push(tr.assignTexture(or,"emissiveMap",sr.emissiveTexture,SRGBColorSpace)),Promise.all(cr).then(function(){const dr=new ar(or);return sr.name&&(dr.name=sr.name),assignExtrasToUserData(dr,sr),tr.associations.set(dr,{materials:er}),sr.extensions&&addUnknownExtensionsToUserData(nr,dr,sr),dr})}createUniqueName(er){const tr=PropertyBinding.sanitizeNodeName(er||"");return tr in this.nodeNamesUsed?tr+"_"+ ++this.nodeNamesUsed[tr]:(this.nodeNamesUsed[tr]=0,tr)}loadGeometries(er){const tr=this,ir=this.extensions,nr=this.primitiveCache;function sr(or){return ir[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(or,tr).then(function(lr){return addPrimitiveAttributes(lr,or,tr)})}const ar=[];for(let or=0,lr=er.length;or<lr;or++){const cr=er[or],ur=createPrimitiveKey(cr),dr=nr[ur];if(dr)ar.push(dr.promise);else{let hr;cr.extensions&&cr.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?hr=sr(cr):hr=addPrimitiveAttributes(new BufferGeometry,cr,tr),nr[ur]={primitive:cr,promise:hr},ar.push(hr)}}return Promise.all(ar)}loadMesh(er){const tr=this,ir=this.json,nr=this.extensions,sr=ir.meshes[er],ar=sr.primitives,or=[];for(let lr=0,cr=ar.length;lr<cr;lr++){const ur=ar[lr].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",ar[lr].material);or.push(ur)}return or.push(tr.loadGeometries(ar)),Promise.all(or).then(function(lr){const cr=lr.slice(0,lr.length-1),ur=lr[lr.length-1],dr=[];for(let pr=0,gr=ur.length;pr<gr;pr++){const vr=ur[pr],mr=ar[pr];let fr;const _r=cr[pr];if(mr.mode===WEBGL_CONSTANTS.TRIANGLES||mr.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||mr.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||mr.mode===void 0)fr=sr.isSkinnedMesh===!0?new SkinnedMesh(vr,_r):new Mesh(vr,_r),fr.isSkinnedMesh===!0&&fr.normalizeSkinWeights(),mr.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?fr.geometry=toTrianglesDrawMode(fr.geometry,TriangleStripDrawMode):mr.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(fr.geometry=toTrianglesDrawMode(fr.geometry,TriangleFanDrawMode));else if(mr.mode===WEBGL_CONSTANTS.LINES)fr=new LineSegments(vr,_r);else if(mr.mode===WEBGL_CONSTANTS.LINE_STRIP)fr=new Line(vr,_r);else if(mr.mode===WEBGL_CONSTANTS.LINE_LOOP)fr=new LineLoop(vr,_r);else if(mr.mode===WEBGL_CONSTANTS.POINTS)fr=new Points(vr,_r);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+mr.mode);Object.keys(fr.geometry.morphAttributes).length>0&&updateMorphTargets(fr,sr),fr.name=tr.createUniqueName(sr.name||"mesh_"+er),assignExtrasToUserData(fr,sr),mr.extensions&&addUnknownExtensionsToUserData(nr,fr,mr),tr.assignFinalMaterial(fr),dr.push(fr)}for(let pr=0,gr=dr.length;pr<gr;pr++)tr.associations.set(dr[pr],{meshes:er,primitives:pr});if(dr.length===1)return sr.extensions&&addUnknownExtensionsToUserData(nr,dr[0],sr),dr[0];const hr=new Group;sr.extensions&&addUnknownExtensionsToUserData(nr,hr,sr),tr.associations.set(hr,{meshes:er});for(let pr=0,gr=dr.length;pr<gr;pr++)hr.add(dr[pr]);return hr})}loadCamera(er){let tr;const ir=this.json.cameras[er],nr=ir[ir.type];if(!nr){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return ir.type==="perspective"?tr=new PerspectiveCamera(MathUtils.radToDeg(nr.yfov),nr.aspectRatio||1,nr.znear||1,nr.zfar||2e6):ir.type==="orthographic"&&(tr=new OrthographicCamera(-nr.xmag,nr.xmag,nr.ymag,-nr.ymag,nr.znear,nr.zfar)),ir.name&&(tr.name=this.createUniqueName(ir.name)),assignExtrasToUserData(tr,ir),Promise.resolve(tr)}loadSkin(er){const tr=this.json.skins[er],ir=[];for(let nr=0,sr=tr.joints.length;nr<sr;nr++)ir.push(this._loadNodeShallow(tr.joints[nr]));return tr.inverseBindMatrices!==void 0?ir.push(this.getDependency("accessor",tr.inverseBindMatrices)):ir.push(null),Promise.all(ir).then(function(nr){const sr=nr.pop(),ar=nr,or=[],lr=[];for(let cr=0,ur=ar.length;cr<ur;cr++){const dr=ar[cr];if(dr){or.push(dr);const hr=new Matrix4;sr!==null&&hr.fromArray(sr.array,cr*16),lr.push(hr)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',tr.joints[cr])}return new Skeleton(or,lr)})}loadAnimation(er){const tr=this.json,ir=this,nr=tr.animations[er],sr=nr.name?nr.name:"animation_"+er,ar=[],or=[],lr=[],cr=[],ur=[];for(let dr=0,hr=nr.channels.length;dr<hr;dr++){const pr=nr.channels[dr],gr=nr.samplers[pr.sampler],vr=pr.target,mr=vr.node,fr=nr.parameters!==void 0?nr.parameters[gr.input]:gr.input,_r=nr.parameters!==void 0?nr.parameters[gr.output]:gr.output;vr.node!==void 0&&(ar.push(this.getDependency("node",mr)),or.push(this.getDependency("accessor",fr)),lr.push(this.getDependency("accessor",_r)),cr.push(gr),ur.push(vr))}return Promise.all([Promise.all(ar),Promise.all(or),Promise.all(lr),Promise.all(cr),Promise.all(ur)]).then(function(dr){const hr=dr[0],pr=dr[1],gr=dr[2],vr=dr[3],mr=dr[4],fr=[];for(let _r=0,Ar=hr.length;_r<Ar;_r++){const yr=hr[_r],wr=pr[_r],xr=gr[_r],Sr=vr[_r],br=mr[_r];if(yr===void 0)continue;yr.updateMatrix&&yr.updateMatrix();const Cr=ir._createAnimationTracks(yr,wr,xr,Sr,br);if(Cr)for(let Ir=0;Ir<Cr.length;Ir++)fr.push(Cr[Ir])}return new AnimationClip(sr,void 0,fr)})}createNodeMesh(er){const tr=this.json,ir=this,nr=tr.nodes[er];return nr.mesh===void 0?null:ir.getDependency("mesh",nr.mesh).then(function(sr){const ar=ir._getNodeRef(ir.meshCache,nr.mesh,sr);return nr.weights!==void 0&&ar.traverse(function(or){if(or.isMesh)for(let lr=0,cr=nr.weights.length;lr<cr;lr++)or.morphTargetInfluences[lr]=nr.weights[lr]}),ar})}loadNode(er){const tr=this.json,ir=this,nr=tr.nodes[er],sr=ir._loadNodeShallow(er),ar=[],or=nr.children||[];for(let cr=0,ur=or.length;cr<ur;cr++)ar.push(ir.getDependency("node",or[cr]));const lr=nr.skin===void 0?Promise.resolve(null):ir.getDependency("skin",nr.skin);return Promise.all([sr,Promise.all(ar),lr]).then(function(cr){const ur=cr[0],dr=cr[1],hr=cr[2];hr!==null&&ur.traverse(function(pr){pr.isSkinnedMesh&&pr.bind(hr,_identityMatrix)});for(let pr=0,gr=dr.length;pr<gr;pr++)ur.add(dr[pr]);return ur})}_loadNodeShallow(er){const tr=this.json,ir=this.extensions,nr=this;if(this.nodeCache[er]!==void 0)return this.nodeCache[er];const sr=tr.nodes[er],ar=sr.name?nr.createUniqueName(sr.name):"",or=[],lr=nr._invokeOne(function(cr){return cr.createNodeMesh&&cr.createNodeMesh(er)});return lr&&or.push(lr),sr.camera!==void 0&&or.push(nr.getDependency("camera",sr.camera).then(function(cr){return nr._getNodeRef(nr.cameraCache,sr.camera,cr)})),nr._invokeAll(function(cr){return cr.createNodeAttachment&&cr.createNodeAttachment(er)}).forEach(function(cr){or.push(cr)}),this.nodeCache[er]=Promise.all(or).then(function(cr){let ur;if(sr.isBone===!0?ur=new Bone:cr.length>1?ur=new Group:cr.length===1?ur=cr[0]:ur=new Object3D,ur!==cr[0])for(let dr=0,hr=cr.length;dr<hr;dr++)ur.add(cr[dr]);if(sr.name&&(ur.userData.name=sr.name,ur.name=ar),assignExtrasToUserData(ur,sr),sr.extensions&&addUnknownExtensionsToUserData(ir,ur,sr),sr.matrix!==void 0){const dr=new Matrix4;dr.fromArray(sr.matrix),ur.applyMatrix4(dr)}else sr.translation!==void 0&&ur.position.fromArray(sr.translation),sr.rotation!==void 0&&ur.quaternion.fromArray(sr.rotation),sr.scale!==void 0&&ur.scale.fromArray(sr.scale);return nr.associations.has(ur)||nr.associations.set(ur,{}),nr.associations.get(ur).nodes=er,ur}),this.nodeCache[er]}loadScene(er){const tr=this.extensions,ir=this.json.scenes[er],nr=this,sr=new Group;ir.name&&(sr.name=nr.createUniqueName(ir.name)),assignExtrasToUserData(sr,ir),ir.extensions&&addUnknownExtensionsToUserData(tr,sr,ir);const ar=ir.nodes||[],or=[];for(let lr=0,cr=ar.length;lr<cr;lr++)or.push(nr.getDependency("node",ar[lr]));return Promise.all(or).then(function(lr){for(let ur=0,dr=lr.length;ur<dr;ur++)sr.add(lr[ur]);const cr=ur=>{const dr=new Map;for(const[hr,pr]of nr.associations)(hr instanceof Material||hr instanceof Texture)&&dr.set(hr,pr);return ur.traverse(hr=>{const pr=nr.associations.get(hr);pr!=null&&dr.set(hr,pr)}),dr};return nr.associations=cr(sr),sr})}_createAnimationTracks(er,tr,ir,nr,sr){const ar=[],or=er.name?er.name:er.uuid,lr=[];PATH_PROPERTIES[sr.path]===PATH_PROPERTIES.weights?er.traverse(function(hr){hr.morphTargetInfluences&&lr.push(hr.name?hr.name:hr.uuid)}):lr.push(or);let cr;switch(PATH_PROPERTIES[sr.path]){case PATH_PROPERTIES.weights:cr=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:cr=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:cr=VectorKeyframeTrack;break;default:switch(ir.itemSize){case 1:cr=NumberKeyframeTrack;break;case 2:case 3:default:cr=VectorKeyframeTrack;break}break}const ur=nr.interpolation!==void 0?INTERPOLATION[nr.interpolation]:InterpolateLinear,dr=this._getArrayFromAccessor(ir);for(let hr=0,pr=lr.length;hr<pr;hr++){const gr=new cr(lr[hr]+"."+PATH_PROPERTIES[sr.path],tr.array,dr,ur);nr.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(gr),ar.push(gr)}return ar}_getArrayFromAccessor(er){let tr=er.array;if(er.normalized){const ir=getNormalizedComponentScale(tr.constructor),nr=new Float32Array(tr.length);for(let sr=0,ar=tr.length;sr<ar;sr++)nr[sr]=tr[sr]*ir;tr=nr}return tr}_createCubicSplineTrackInterpolant(er){er.createInterpolant=function(ir){const nr=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new nr(this.times,this.values,this.getValueSize()/3,ir)},er.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(rr,er,tr){const ir=er.attributes,nr=new Box3;if(ir.POSITION!==void 0){const or=tr.json.accessors[ir.POSITION],lr=or.min,cr=or.max;if(lr!==void 0&&cr!==void 0){if(nr.set(new Vector3$1(lr[0],lr[1],lr[2]),new Vector3$1(cr[0],cr[1],cr[2])),or.normalized){const ur=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[or.componentType]);nr.min.multiplyScalar(ur),nr.max.multiplyScalar(ur)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const sr=er.targets;if(sr!==void 0){const or=new Vector3$1,lr=new Vector3$1;for(let cr=0,ur=sr.length;cr<ur;cr++){const dr=sr[cr];if(dr.POSITION!==void 0){const hr=tr.json.accessors[dr.POSITION],pr=hr.min,gr=hr.max;if(pr!==void 0&&gr!==void 0){if(lr.setX(Math.max(Math.abs(pr[0]),Math.abs(gr[0]))),lr.setY(Math.max(Math.abs(pr[1]),Math.abs(gr[1]))),lr.setZ(Math.max(Math.abs(pr[2]),Math.abs(gr[2]))),hr.normalized){const vr=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[hr.componentType]);lr.multiplyScalar(vr)}or.max(lr)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}nr.expandByVector(or)}rr.boundingBox=nr;const ar=new Sphere;nr.getCenter(ar.center),ar.radius=nr.min.distanceTo(nr.max)/2,rr.boundingSphere=ar}function addPrimitiveAttributes(rr,er,tr){const ir=er.attributes,nr=[];function sr(ar,or){return tr.getDependency("accessor",ar).then(function(lr){rr.setAttribute(or,lr)})}for(const ar in ir){const or=ATTRIBUTES[ar]||ar.toLowerCase();or in rr.attributes||nr.push(sr(ir[ar],or))}if(er.indices!==void 0&&!rr.index){const ar=tr.getDependency("accessor",er.indices).then(function(or){rr.setIndex(or)});nr.push(ar)}return ColorManagement.workingColorSpace!==LinearSRGBColorSpace&&"COLOR_0"in ir&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(rr,er),computeBounds(rr,er,tr),Promise.all(nr).then(function(){return er.targets!==void 0?addMorphTargets(rr,er.targets,tr):rr})}class RGBELoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType}parse(er){const ar=function(br,Cr){switch(br){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(Cr||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(Cr||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(Cr||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(Cr||""))}},ur=`
`,dr=function(br,Cr,Ir){Cr=Cr||1024;let Pr=br.pos,Dr=-1,Fr=0,Or="",Nr=String.fromCharCode.apply(null,new Uint16Array(br.subarray(Pr,Pr+128)));for(;0>(Dr=Nr.indexOf(ur))&&Fr<Cr&&Pr<br.byteLength;)Or+=Nr,Fr+=Nr.length,Pr+=128,Nr+=String.fromCharCode.apply(null,new Uint16Array(br.subarray(Pr,Pr+128)));return-1<Dr?(Ir!==!1&&(br.pos+=Fr+Dr+1),Or+Nr.slice(0,Dr)):!1},hr=function(br){const Cr=/^#\?(\S+)/,Ir=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,Rr=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,Pr=/^\s*FORMAT=(\S+)\s*$/,Dr=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,Fr={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let Or,Nr;for((br.pos>=br.byteLength||!(Or=dr(br)))&&ar(1,"no header found"),(Nr=Or.match(Cr))||ar(3,"bad initial token"),Fr.valid|=1,Fr.programtype=Nr[1],Fr.string+=Or+`
`;Or=dr(br),Or!==!1;){if(Fr.string+=Or+`
`,Or.charAt(0)==="#"){Fr.comments+=Or+`
`;continue}if((Nr=Or.match(Ir))&&(Fr.gamma=parseFloat(Nr[1])),(Nr=Or.match(Rr))&&(Fr.exposure=parseFloat(Nr[1])),(Nr=Or.match(Pr))&&(Fr.valid|=2,Fr.format=Nr[1]),(Nr=Or.match(Dr))&&(Fr.valid|=4,Fr.height=parseInt(Nr[1],10),Fr.width=parseInt(Nr[2],10)),Fr.valid&2&&Fr.valid&4)break}return Fr.valid&2||ar(3,"missing format specifier"),Fr.valid&4||ar(3,"missing image size specifier"),Fr},pr=function(br,Cr,Ir){const Rr=Cr;if(Rr<8||Rr>32767||br[0]!==2||br[1]!==2||br[2]&128)return new Uint8Array(br);Rr!==(br[2]<<8|br[3])&&ar(3,"wrong scanline width");const Pr=new Uint8Array(4*Cr*Ir);Pr.length||ar(4,"unable to allocate buffer space");let Dr=0,Fr=0;const Or=4*Rr,Nr=new Uint8Array(4),Ur=new Uint8Array(Or);let Br=Ir;for(;Br>0&&Fr<br.byteLength;){Fr+4>br.byteLength&&ar(1),Nr[0]=br[Fr++],Nr[1]=br[Fr++],Nr[2]=br[Fr++],Nr[3]=br[Fr++],(Nr[0]!=2||Nr[1]!=2||(Nr[2]<<8|Nr[3])!=Rr)&&ar(3,"bad rgbe scanline format");let Wr=0,Xr;for(;Wr<Or&&Fr<br.byteLength;){Xr=br[Fr++];const Qi=Xr>128;if(Qi&&(Xr-=128),(Xr===0||Wr+Xr>Or)&&ar(3,"bad scanline data"),Qi){const Xi=br[Fr++];for(let Kr=0;Kr<Xr;Kr++)Ur[Wr++]=Xi}else Ur.set(br.subarray(Fr,Fr+Xr),Wr),Wr+=Xr,Fr+=Xr}const Yr=Rr;for(let Qi=0;Qi<Yr;Qi++){let Xi=0;Pr[Dr]=Ur[Qi+Xi],Xi+=Rr,Pr[Dr+1]=Ur[Qi+Xi],Xi+=Rr,Pr[Dr+2]=Ur[Qi+Xi],Xi+=Rr,Pr[Dr+3]=Ur[Qi+Xi],Dr+=4}Br--}return Pr},gr=function(br,Cr,Ir,Rr){const Pr=br[Cr+3],Dr=Math.pow(2,Pr-128)/255;Ir[Rr+0]=br[Cr+0]*Dr,Ir[Rr+1]=br[Cr+1]*Dr,Ir[Rr+2]=br[Cr+2]*Dr,Ir[Rr+3]=1},vr=function(br,Cr,Ir,Rr){const Pr=br[Cr+3],Dr=Math.pow(2,Pr-128)/255;Ir[Rr+0]=DataUtils.toHalfFloat(Math.min(br[Cr+0]*Dr,65504)),Ir[Rr+1]=DataUtils.toHalfFloat(Math.min(br[Cr+1]*Dr,65504)),Ir[Rr+2]=DataUtils.toHalfFloat(Math.min(br[Cr+2]*Dr,65504)),Ir[Rr+3]=DataUtils.toHalfFloat(1)},mr=new Uint8Array(er);mr.pos=0;const fr=hr(mr),_r=fr.width,Ar=fr.height,yr=pr(mr.subarray(mr.pos),_r,Ar);let wr,xr,Sr;switch(this.type){case FloatType:Sr=yr.length/4;const br=new Float32Array(Sr*4);for(let Ir=0;Ir<Sr;Ir++)gr(yr,Ir*4,br,Ir*4);wr=br,xr=FloatType;break;case HalfFloatType:Sr=yr.length/4;const Cr=new Uint16Array(Sr*4);for(let Ir=0;Ir<Sr;Ir++)vr(yr,Ir*4,Cr,Ir*4);wr=Cr,xr=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:_r,height:Ar,data:wr,header:fr.string,gamma:fr.gamma,exposure:fr.exposure,type:xr}}setDataType(er){return this.type=er,this}load(er,tr,ir,nr){function sr(ar,or){switch(ar.type){case FloatType:case HalfFloatType:ar.colorSpace=LinearSRGBColorSpace,ar.minFilter=LinearFilter,ar.magFilter=LinearFilter,ar.generateMipmaps=!1,ar.flipY=!0;break}tr&&tr(ar,or)}return super.load(er,sr,ir,nr)}}class HDRCubeTextureLoader extends Loader{constructor(er){super(er),this.hdrLoader=new RGBELoader,this.type=HalfFloatType}load(er,tr,ir,nr){const sr=new CubeTexture;switch(sr.type=this.type,sr.type){case FloatType:sr.colorSpace=LinearSRGBColorSpace,sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.generateMipmaps=!1;break;case HalfFloatType:sr.colorSpace=LinearSRGBColorSpace,sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.generateMipmaps=!1;break}const ar=this;let or=0;function lr(cr,ur,dr,hr){new FileLoader(ar.manager).setPath(ar.path).setResponseType("arraybuffer").setWithCredentials(ar.withCredentials).load(er[cr],function(pr){or++;const gr=ar.hdrLoader.parse(pr);if(gr){if(gr.data!==void 0){const vr=new DataTexture(gr.data,gr.width,gr.height);vr.type=sr.type,vr.colorSpace=sr.colorSpace,vr.format=sr.format,vr.minFilter=sr.minFilter,vr.magFilter=sr.magFilter,vr.generateMipmaps=sr.generateMipmaps,sr.images[cr]=vr}or===6&&(sr.needsUpdate=!0,ur&&ur(sr))}},dr,hr)}for(let cr=0;cr<er.length;cr++)lr(cr,tr,ir,nr);return sr}setDataType(er){return this.type=er,this.hdrLoader.setDataType(er),this}}class IESLoader extends Loader{constructor(er){super(er),this.type=HalfFloatType}_getIESValues(er,tr){const ar=new Array(64800);function or(dr,hr){let pr=0,gr=0,vr=0,mr=0,fr=0,_r=0;for(let Rr=0;Rr<er.numHorAngles-1;++Rr)if(hr<er.horAngles[Rr+1]||Rr==er.numHorAngles-2){gr=Rr,vr=er.horAngles[Rr],mr=er.horAngles[Rr+1];break}for(let Rr=0;Rr<er.numVerAngles-1;++Rr)if(dr<er.verAngles[Rr+1]||Rr==er.numVerAngles-2){pr=Rr,fr=er.verAngles[Rr],_r=er.verAngles[Rr+1];break}const Ar=mr-vr,yr=_r-fr;if(yr===0)return 0;const wr=Ar===0?0:(hr-vr)/Ar,xr=(dr-fr)/yr,Sr=Ar===0?gr:gr+1,br=MathUtils.lerp(er.candelaValues[gr][pr],er.candelaValues[Sr][pr],wr),Cr=MathUtils.lerp(er.candelaValues[gr][pr+1],er.candelaValues[Sr][pr+1],wr);return MathUtils.lerp(br,Cr,xr)}const lr=er.horAngles[0],cr=er.horAngles[er.numHorAngles-1];for(let dr=0;dr<64800;++dr){let hr=dr%360;const pr=Math.floor(dr/360);cr-lr!==0&&(hr<lr||hr>=cr)&&(hr%=cr*2,hr>cr&&(hr=cr*2-hr)),ar[pr+hr*180]=or(pr,hr)}let ur=null;return tr===UnsignedByteType?ur=Uint8Array.from(ar.map(dr=>Math.min(dr*255,255))):tr===HalfFloatType?ur=Uint16Array.from(ar.map(dr=>DataUtils.toHalfFloat(dr))):tr===FloatType?ur=Float32Array.from(ar):console.error("IESLoader: Unsupported type:",tr),ur}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setResponseType("text"),sr.setCrossOrigin(this.crossOrigin),sr.setWithCredentials(this.withCredentials),sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.load(er,ar=>{tr(this.parse(ar))},ir,nr)}parse(er){const tr=this.type,ir=new IESLamp(er),nr=this._getIESValues(ir,tr),sr=new DataTexture(nr,180,1,RedFormat,tr);return sr.minFilter=LinearFilter,sr.magFilter=LinearFilter,sr.needsUpdate=!0,sr}}function IESLamp(rr){const er=this,tr=rr.split(`
`);let ir=0,nr;er.verAngles=[],er.horAngles=[],er.candelaValues=[],er.tiltData={},er.tiltData.angles=[],er.tiltData.mulFactors=[];function sr(hr){return hr=hr.replace(/^\s+|\s+$/g,""),hr=hr.replace(/,/g," "),hr=hr.replace(/\s\s+/g," "),hr.split(" ")}function ar(hr,pr){for(;;){const gr=tr[ir++],vr=sr(gr);for(let mr=0;mr<vr.length;++mr)pr.push(Number(vr[mr]));if(pr.length===hr)break}}function or(){let hr=tr[ir++],pr=sr(hr);er.tiltData.lampToLumGeometry=Number(pr[0]),hr=tr[ir++],pr=sr(hr),er.tiltData.numAngles=Number(pr[0]),ar(er.tiltData.numAngles,er.tiltData.angles),ar(er.tiltData.numAngles,er.tiltData.mulFactors)}function lr(){const hr=[];ar(10,hr),er.count=Number(hr[0]),er.lumens=Number(hr[1]),er.multiplier=Number(hr[2]),er.numVerAngles=Number(hr[3]),er.numHorAngles=Number(hr[4]),er.gonioType=Number(hr[5]),er.units=Number(hr[6]),er.width=Number(hr[7]),er.length=Number(hr[8]),er.height=Number(hr[9])}function cr(){const hr=[];ar(3,hr),er.ballFactor=Number(hr[0]),er.blpFactor=Number(hr[1]),er.inputWatts=Number(hr[2])}for(;nr=tr[ir++],!nr.includes("TILT"););nr.includes("NONE")||nr.includes("INCLUDE")&&or(),lr(),cr();for(let hr=0;hr<er.numHorAngles;++hr)er.candelaValues.push([]);ar(er.numVerAngles,er.verAngles),ar(er.numHorAngles,er.horAngles);for(let hr=0;hr<er.numHorAngles;++hr)ar(er.numVerAngles,er.candelaValues[hr]);for(let hr=0;hr<er.numHorAngles;++hr)for(let pr=0;pr<er.numVerAngles;++pr)er.candelaValues[hr][pr]*=er.candelaValues[hr][pr]*er.multiplier*er.ballFactor*er.blpFactor;let ur=-1;for(let hr=0;hr<er.numHorAngles;++hr)for(let pr=0;pr<er.numVerAngles;++pr){const gr=er.candelaValues[hr][pr];ur=ur<gr?gr:ur}if(!0&&ur>0)for(let hr=0;hr<er.numHorAngles;++hr)for(let pr=0;pr<er.numVerAngles;++pr)er.candelaValues[hr][pr]/=ur}class KMZLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(sr){for(const ar in nr)if(ar.slice(-sr.length)===sr)return nr[ar]}const ir=new LoadingManager;ir.setURLModifier(function(sr){const ar=tr(sr);if(ar){console.log("Loading",sr);const or=new Blob([ar.buffer],{type:"application/octet-stream"});return URL.createObjectURL(or)}return sr});const nr=unzipSync(new Uint8Array(er));if(nr["doc.kml"]){const ar=new DOMParser().parseFromString(strFromU8(nr["doc.kml"]),"application/xml").querySelector("Placemark Model Link href");if(ar)return new ColladaLoader(ir).parse(strFromU8(nr[ar.textContent]))}else{console.warn("KMZLoader: Missing doc.kml file.");for(const sr in nr)if(sr.split(".").pop().toLowerCase()==="dae")return new ColladaLoader(ir).parse(strFromU8(nr[sr]))}return console.error("KMZLoader: Couldn't find .dae file."),{scene:new Group}}}class WorkerPool{constructor(er=4){this.pool=er,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(er){if(!this.workers[er]){const tr=this.workerCreator();tr.addEventListener("message",this._onMessage.bind(this,er)),this.workers[er]=tr}}_getIdleWorker(){for(let er=0;er<this.pool;er++)if(!(this.workerStatus&1<<er))return er;return-1}_onMessage(er,tr){const ir=this.workersResolve[er];if(ir&&ir(tr),this.queue.length){const{resolve:nr,msg:sr,transfer:ar}=this.queue.shift();this.workersResolve[er]=nr,this.workers[er].postMessage(sr,ar)}else this.workerStatus^=1<<er}setWorkerCreator(er){this.workerCreator=er}setWorkerLimit(er){this.pool=er}postMessage(er,tr){return new Promise(ir=>{const nr=this._getIdleWorker();nr!==-1?(this._initWorker(nr),this.workerStatus|=1<<nr,this.workersResolve[nr]=ir,this.workers[nr].postMessage(er,tr)):this.queue.push({resolve:ir,msg:er,transfer:tr})})}dispose(){this.workers.forEach(er=>er.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}let A,I,B;const g={env:{emscripten_notify_memory_growth:function(rr){B=new Uint8Array(I.exports.memory.buffer)}}};class Q{init(){return A||(A=typeof fetch<"u"?fetch("data:application/wasm;base64,"+C$1).then(er=>er.arrayBuffer()).then(er=>WebAssembly.instantiate(er,g)).then(this._init):WebAssembly.instantiate(Buffer.from(C$1,"base64"),g).then(this._init),A)}_init(er){I=er.instance,g.env.emscripten_notify_memory_growth(0)}decode(er,tr=0){if(!I)throw new Error("ZSTDDecoder: Await .init() before decoding.");const ir=er.byteLength,nr=I.exports.malloc(ir);B.set(er,nr),tr=tr||Number(I.exports.ZSTD_findDecompressedSize(nr,ir));const sr=I.exports.malloc(tr),ar=I.exports.ZSTD_decompress(sr,tr,nr,ir),or=B.slice(sr,sr+ar);return I.exports.free(nr),I.exports.free(sr),or}}const C$1="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",P3_PRIMARIES=[.68,.32,.265,.69,.15,.06],P3_LUMINANCE_COEFFICIENTS=[.2289,.6917,.0793],REC2020_PRIMARIES=[.708,.292,.17,.797,.131,.046],REC2020_LUMINANCE_COEFFICIENTS=[.2627,.678,.0593],D65=[.3127,.329],LINEAR_DISPLAY_P3_TO_XYZ=new Matrix3().set(.4865709,.2656677,.1982173,.2289746,.6917385,.0792869,0,.0451134,1.0439444),XYZ_TO_LINEAR_DISPLAY_P3=new Matrix3().set(2.4934969,-.9313836,-.4027108,-.829489,1.7626641,.0236247,.0358458,-.0761724,.9568845),DisplayP3ColorSpace="display-p3",LinearDisplayP3ColorSpace="display-p3-linear",DisplayP3ColorSpaceImpl={primaries:P3_PRIMARIES,whitePoint:D65,transfer:SRGBTransfer,toXYZ:LINEAR_DISPLAY_P3_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_DISPLAY_P3,luminanceCoefficients:P3_LUMINANCE_COEFFICIENTS,outputColorSpaceConfig:{drawingBufferColorSpace:DisplayP3ColorSpace}},LinearDisplayP3ColorSpaceImpl={primaries:P3_PRIMARIES,whitePoint:D65,transfer:LinearTransfer,toXYZ:LINEAR_DISPLAY_P3_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_DISPLAY_P3,luminanceCoefficients:P3_LUMINANCE_COEFFICIENTS,workingColorSpaceConfig:{unpackColorSpace:DisplayP3ColorSpace},outputColorSpaceConfig:{drawingBufferColorSpace:DisplayP3ColorSpace}},LINEAR_REC2020_TO_XYZ=new Matrix3().set(.636958,.1446169,.168881,.2627002,.6779981,.0593017,0,.0280727,1.0609851),XYZ_TO_LINEAR_REC2020=new Matrix3().set(1.7166512,-.3556708,-.2533663,-.6666844,1.6164812,.0157685,.0176399,-.0427706,.9421031),LinearRec2020ColorSpace="rec2020-linear",LinearRec2020ColorSpaceImpl={primaries:REC2020_PRIMARIES,whitePoint:D65,transfer:LinearTransfer,toXYZ:LINEAR_REC2020_TO_XYZ,fromXYZ:XYZ_TO_LINEAR_REC2020,luminanceCoefficients:REC2020_LUMINANCE_COEFFICIENTS},_taskCache=new WeakMap;let _activeLoaders=0,_zstd;class KTX2Loader extends Loader{constructor(er){super(er),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new WorkerPool,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(er){return this.transcoderPath=er,this}setWorkerLimit(er){return this.workerPool.setWorkerLimit(er),this}async detectSupportAsync(er){return this.workerConfig={astcSupported:await er.hasFeatureAsync("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:await er.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await er.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await er.hasFeatureAsync("texture-compression-bc"),bptcSupported:await er.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await er.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(er){return er.isWebGPURenderer===!0?this.workerConfig={astcSupported:er.hasFeature("texture-compression-astc"),astcHDRSupported:!1,etc1Supported:er.hasFeature("texture-compression-etc1"),etc2Supported:er.hasFeature("texture-compression-etc2"),dxtSupported:er.hasFeature("texture-compression-bc"),bptcSupported:er.hasFeature("texture-compression-bptc"),pvrtcSupported:er.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:er.extensions.has("WEBGL_compressed_texture_astc"),astcHDRSupported:er.extensions.has("WEBGL_compressed_texture_astc")&&er.extensions.get("WEBGL_compressed_texture_astc").getSupportedProfiles().includes("hdr"),etc1Supported:er.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:er.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:er.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:er.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:er.extensions.has("WEBGL_compressed_texture_pvrtc")||er.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const er=new FileLoader(this.manager);er.setPath(this.transcoderPath),er.setWithCredentials(this.withCredentials);const tr=er.loadAsync("basis_transcoder.js"),ir=new FileLoader(this.manager);ir.setPath(this.transcoderPath),ir.setResponseType("arraybuffer"),ir.setWithCredentials(this.withCredentials);const nr=ir.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([tr,nr]).then(([sr,ar])=>{const or=KTX2Loader.BasisWorker.toString(),lr=["/* constants */","let _EngineFormat = "+JSON.stringify(KTX2Loader.EngineFormat),"let _EngineType = "+JSON.stringify(KTX2Loader.EngineType),"let _TranscoderFormat = "+JSON.stringify(KTX2Loader.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(KTX2Loader.BasisFormat),"/* basis_transcoder.js */",sr,"/* worker */",or.substring(or.indexOf("{")+1,or.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([lr])),this.transcoderBinary=ar,this.workerPool.setWorkerCreator(()=>{const cr=new Worker(this.workerSourceURL),ur=this.transcoderBinary.slice(0);return cr.postMessage({type:"init",config:this.workerConfig,transcoderBinary:ur},[ur]),cr})}),_activeLoaders>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),_activeLoaders++}return this.transcoderPending}load(er,tr,ir,nr){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const sr=new FileLoader(this.manager);sr.setResponseType("arraybuffer"),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.parse(ar,tr,nr)},ir,nr)}parse(er,tr,ir){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");if(_taskCache.has(er))return _taskCache.get(er).promise.then(tr).catch(ir);this._createTexture(er).then(nr=>tr?tr(nr):null).catch(ir)}_createTextureFrom(er,tr){const{type:ir,error:nr,data:{faces:sr,width:ar,height:or,format:lr,type:cr,dfdFlags:ur}}=er;if(ir==="error")return Promise.reject(nr);let dr;if(tr.faceCount===6)dr=new CompressedCubeTexture(sr,lr,cr);else{const hr=sr[0].mipmaps;dr=tr.layerCount>1?new CompressedArrayTexture(hr,ar,or,tr.layerCount,lr,cr):new CompressedTexture(hr,ar,or,lr,cr)}return dr.minFilter=sr[0].mipmaps.length===1?LinearFilter:LinearMipmapLinearFilter,dr.magFilter=LinearFilter,dr.generateMipmaps=!1,dr.needsUpdate=!0,dr.colorSpace=parseColorSpace(tr),dr.premultiplyAlpha=!!(ur&g$1),dr}async _createTexture(er,tr={}){const ir=Pi(new Uint8Array(er)),nr=ir.vkFormat===pi$1&&ir.dataFormatDescriptor[0].colorModel===167;if(!(ir.vkFormat===it||nr&&!this.workerConfig.astcHDRSupported))return createRawTexture(ir);const ar=tr,or=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:er,taskConfig:ar},[er])).then(lr=>this._createTextureFrom(lr.data,ir));return _taskCache.set(er,{promise:or}),or}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),_activeLoaders--,this}}KTX2Loader.BasisFormat={ETC1S:0,UASTC:1,UASTC_HDR:2};KTX2Loader.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16,BC6H:22,RGB_HALF:24,RGBA_HALF:25};KTX2Loader.EngineFormat={RGBAFormat,RGBA_ASTC_4x4_Format,RGB_BPTC_UNSIGNED_Format,RGBA_BPTC_Format,RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format,RGB_ETC1_Format,RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT1_Format};KTX2Loader.EngineType={UnsignedByteType,HalfFloatType,FloatType};KTX2Loader.BasisWorker=function(){let rr,er,tr;const ir=_EngineFormat,nr=_EngineType,sr=_TranscoderFormat,ar=_BasisFormat;self.addEventListener("message",function(gr){const vr=gr.data;switch(vr.type){case"init":rr=vr.config,or(vr.transcoderBinary);break;case"transcode":er.then(()=>{try{const{faces:mr,buffers:fr,width:_r,height:Ar,hasAlpha:yr,format:wr,type:xr,dfdFlags:Sr}=lr(vr.buffer);self.postMessage({type:"transcode",id:vr.id,data:{faces:mr,width:_r,height:Ar,hasAlpha:yr,format:wr,type:xr,dfdFlags:Sr}},fr)}catch(mr){console.error(mr),self.postMessage({type:"error",id:vr.id,error:mr.message})}});break}});function or(gr){er=new Promise(vr=>{tr={wasmBinary:gr,onRuntimeInitialized:vr},BASIS(tr)}).then(()=>{tr.initializeBasis(),tr.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")})}function lr(gr){const vr=new tr.KTX2File(new Uint8Array(gr));function mr(){vr.close(),vr.delete()}if(!vr.isValid())throw mr(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let fr;if(vr.isUASTC())fr=ar.UASTC;else if(vr.isETC1S())fr=ar.ETC1S;else if(vr.isHDR())fr=ar.UASTC_HDR;else throw new Error("THREE.KTX2Loader: Unknown Basis encoding");const _r=vr.getWidth(),Ar=vr.getHeight(),yr=vr.getLayers()||1,wr=vr.getLevels(),xr=vr.getFaces(),Sr=vr.getHasAlpha(),br=vr.getDFDFlags(),{transcoderFormat:Cr,engineFormat:Ir,engineType:Rr}=dr(fr,_r,Ar,Sr);if(!_r||!Ar||!wr)throw mr(),new Error("THREE.KTX2Loader:	Invalid texture");if(!vr.startTranscoding())throw mr(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Pr=[],Dr=[];for(let Fr=0;Fr<xr;Fr++){const Or=[];for(let Nr=0;Nr<wr;Nr++){const Ur=[];let Br,Wr;for(let Yr=0;Yr<yr;Yr++){const Qi=vr.getImageLevelInfo(Nr,Yr,Fr);Fr===0&&Nr===0&&Yr===0&&(Qi.origWidth%4!==0||Qi.origHeight%4!==0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),wr>1?(Br=Qi.origWidth,Wr=Qi.origHeight):(Br=Qi.width,Wr=Qi.height);let Xi=new Uint8Array(vr.getImageTranscodedSizeInBytes(Nr,Yr,0,Cr));const Kr=vr.transcodeImage(Xi,Nr,Yr,Fr,Cr,0,-1,-1);if(Rr===nr.HalfFloatType&&(Xi=new Uint16Array(Xi.buffer,Xi.byteOffset,Xi.byteLength/Uint16Array.BYTES_PER_ELEMENT)),!Kr)throw mr(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Ur.push(Xi)}const Xr=pr(Ur);Or.push({data:Xr,width:Br,height:Wr}),Dr.push(Xr.buffer)}Pr.push({mipmaps:Or,width:_r,height:Ar,format:Ir,type:Rr})}return mr(),{faces:Pr,buffers:Dr,width:_r,height:Ar,hasAlpha:Sr,dfdFlags:br,format:Ir,type:Rr}}const cr=[{if:"astcSupported",basisFormat:[ar.UASTC],transcoderFormat:[sr.ASTC_4x4,sr.ASTC_4x4],engineFormat:[ir.RGBA_ASTC_4x4_Format,ir.RGBA_ASTC_4x4_Format],engineType:[nr.UnsignedByteType],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.BC7_M5,sr.BC7_M5],engineFormat:[ir.RGBA_BPTC_Format,ir.RGBA_BPTC_Format],engineType:[nr.UnsignedByteType],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.BC1,sr.BC3],engineFormat:[ir.RGBA_S3TC_DXT1_Format,ir.RGBA_S3TC_DXT5_Format],engineType:[nr.UnsignedByteType],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.ETC1,sr.ETC2],engineFormat:[ir.RGB_ETC2_Format,ir.RGBA_ETC2_EAC_Format],engineType:[nr.UnsignedByteType],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.ETC1],engineFormat:[ir.RGB_ETC1_Format],engineType:[nr.UnsignedByteType],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.PVRTC1_4_RGB,sr.PVRTC1_4_RGBA],engineFormat:[ir.RGB_PVRTC_4BPPV1_Format,ir.RGBA_PVRTC_4BPPV1_Format],engineType:[nr.UnsignedByteType],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0},{if:"bptcSupported",basisFormat:[ar.UASTC_HDR],transcoderFormat:[sr.BC6H],engineFormat:[ir.RGB_BPTC_UNSIGNED_Format],engineType:[nr.HalfFloatType],priorityHDR:1,needsPowerOfTwo:!1},{basisFormat:[ar.ETC1S,ar.UASTC],transcoderFormat:[sr.RGBA32,sr.RGBA32],engineFormat:[ir.RGBAFormat,ir.RGBAFormat],engineType:[nr.UnsignedByteType,nr.UnsignedByteType],priorityETC1S:100,priorityUASTC:100,needsPowerOfTwo:!1},{basisFormat:[ar.UASTC_HDR],transcoderFormat:[sr.RGBA_HALF],engineFormat:[ir.RGBAFormat],engineType:[nr.HalfFloatType],priorityHDR:100,needsPowerOfTwo:!1}],ur={[ar.ETC1S]:cr.filter(gr=>gr.basisFormat.includes(ar.ETC1S)).sort((gr,vr)=>gr.priorityUASTC-vr.priorityUASTC),[ar.UASTC]:cr.filter(gr=>gr.basisFormat.includes(ar.UASTC)).sort((gr,vr)=>gr.priorityUASTC-vr.priorityUASTC),[ar.UASTC_HDR]:cr.filter(gr=>gr.basisFormat.includes(ar.UASTC_HDR)).sort((gr,vr)=>gr.priorityHDR-vr.priorityHDR)};function dr(gr,vr,mr,fr){const _r=ur[gr];for(let Ar=0;Ar<_r.length;Ar++){const yr=_r[Ar];if(yr.if&&!rr[yr.if]||!yr.basisFormat.includes(gr)||fr&&yr.transcoderFormat.length<2||yr.needsPowerOfTwo&&!(hr(vr)&&hr(mr)))continue;const wr=yr.transcoderFormat[fr?1:0],xr=yr.engineFormat[fr?1:0],Sr=yr.engineType[0];return{transcoderFormat:wr,engineFormat:xr,engineType:Sr}}throw new Error("THREE.KTX2Loader: Failed to identify transcoding target.")}function hr(gr){return gr<=2?!0:(gr&gr-1)===0&&gr!==0}function pr(gr){if(gr.length===1)return gr[0];let vr=0;for(let _r=0;_r<gr.length;_r++){const Ar=gr[_r];vr+=Ar.byteLength}const mr=new Uint8Array(vr);let fr=0;for(let _r=0;_r<gr.length;_r++){const Ar=gr[_r];mr.set(Ar,fr),fr+=Ar.byteLength}return mr}};const UNCOMPRESSED_FORMATS=new Set([RGBAFormat,RGFormat,RedFormat]),FORMAT_MAP={[Ae]:RGBAFormat,[ge]:RGBAFormat,[Ft]:RGBAFormat,[Ct]:RGBAFormat,[we]:RGFormat,[ae]:RGFormat,[xt$1]:RGFormat,[wt]:RGFormat,[ue]:RedFormat,[te]:RedFormat,[yt$1]:RedFormat,[ct]:RedFormat,[pi$1]:RGBA_ASTC_4x4_Format,[Sn]:RGBA_ASTC_6x6_Format,[In]:RGBA_ASTC_6x6_Format},TYPE_MAP={[Ae]:FloatType,[ge]:HalfFloatType,[Ft]:UnsignedByteType,[Ct]:UnsignedByteType,[we]:FloatType,[ae]:HalfFloatType,[xt$1]:UnsignedByteType,[wt]:UnsignedByteType,[ue]:FloatType,[te]:HalfFloatType,[yt$1]:UnsignedByteType,[ct]:UnsignedByteType,[pi$1]:HalfFloatType,[Sn]:UnsignedByteType,[In]:UnsignedByteType};async function createRawTexture(rr){const{vkFormat:er}=rr;if(FORMAT_MAP[er]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let tr;rr.supercompressionScheme===n&&(_zstd||(_zstd=new Promise(async sr=>{const ar=new Q;await ar.init(),sr(ar)})),tr=await _zstd);const ir=[];for(let sr=0;sr<rr.levels.length;sr++){const ar=Math.max(1,rr.pixelWidth>>sr),or=Math.max(1,rr.pixelHeight>>sr),lr=rr.pixelDepth?Math.max(1,rr.pixelDepth>>sr):0,cr=rr.levels[sr];let ur;if(rr.supercompressionScheme===t$1)ur=cr.levelData;else if(rr.supercompressionScheme===n)ur=tr.decode(cr.levelData,cr.uncompressedByteLength);else throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");let dr;TYPE_MAP[er]===FloatType?dr=new Float32Array(ur.buffer,ur.byteOffset,ur.byteLength/Float32Array.BYTES_PER_ELEMENT):TYPE_MAP[er]===HalfFloatType?dr=new Uint16Array(ur.buffer,ur.byteOffset,ur.byteLength/Uint16Array.BYTES_PER_ELEMENT):dr=ur,ir.push({data:dr,width:ar,height:or,depth:lr})}let nr;if(UNCOMPRESSED_FORMATS.has(FORMAT_MAP[er]))nr=rr.pixelDepth===0?new DataTexture(ir[0].data,rr.pixelWidth,rr.pixelHeight):new Data3DTexture(ir[0].data,rr.pixelWidth,rr.pixelHeight,rr.pixelDepth);else{if(rr.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");nr=new CompressedTexture(ir,rr.pixelWidth,rr.pixelHeight)}return nr.mipmaps=ir,nr.type=TYPE_MAP[er],nr.format=FORMAT_MAP[er],nr.colorSpace=parseColorSpace(rr),nr.needsUpdate=!0,Promise.resolve(nr)}function parseColorSpace(rr){const er=rr.dataFormatDescriptor[0];return er.colorPrimaries===C$2?er.transferFunction===u?SRGBColorSpace:LinearSRGBColorSpace:er.colorPrimaries===R$2?er.transferFunction===u?DisplayP3ColorSpace:LinearDisplayP3ColorSpace:(er.colorPrimaries===T$1||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${er.colorPrimaries}"`),NoColorSpace)}class KTXLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const ir=new KhronosTextureContainer(er,1);return{mipmaps:ir.mipmaps(tr),width:ir.pixelWidth,height:ir.pixelHeight,format:ir.glInternalFormat,isCubemap:ir.numberOfFaces===6,mipmapCount:ir.numberOfMipmapLevels}}}const HEADER_LEN=12+13*4,COMPRESSED_2D=0;class KhronosTextureContainer{constructor(er,tr){this.arrayBuffer=er;const ir=new Uint8Array(this.arrayBuffer,0,12);if(ir[0]!==171||ir[1]!==75||ir[2]!==84||ir[3]!==88||ir[4]!==32||ir[5]!==49||ir[6]!==49||ir[7]!==187||ir[8]!==13||ir[9]!==10||ir[10]!==26||ir[11]!==10){console.error("texture missing KTX identifier");return}const nr=Uint32Array.BYTES_PER_ELEMENT,sr=new DataView(this.arrayBuffer,12,13*nr),or=sr.getUint32(0,!0)===67305985;if(this.glType=sr.getUint32(1*nr,or),this.glTypeSize=sr.getUint32(2*nr,or),this.glFormat=sr.getUint32(3*nr,or),this.glInternalFormat=sr.getUint32(4*nr,or),this.glBaseInternalFormat=sr.getUint32(5*nr,or),this.pixelWidth=sr.getUint32(6*nr,or),this.pixelHeight=sr.getUint32(7*nr,or),this.pixelDepth=sr.getUint32(8*nr,or),this.numberOfArrayElements=sr.getUint32(9*nr,or),this.numberOfFaces=sr.getUint32(10*nr,or),this.numberOfMipmapLevels=sr.getUint32(11*nr,or),this.bytesOfKeyValueData=sr.getUint32(12*nr,or),this.glType!==0){console.warn("only compressed formats currently supported");return}else this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels);if(this.pixelHeight===0||this.pixelDepth!==0){console.warn("only 2D textures currently supported");return}if(this.numberOfArrayElements!==0){console.warn("texture arrays not currently supported");return}if(this.numberOfFaces!==tr){console.warn("number of faces expected"+tr+", but found "+this.numberOfFaces);return}this.loadType=COMPRESSED_2D}mipmaps(er){const tr=[];let ir=HEADER_LEN+this.bytesOfKeyValueData,nr=this.pixelWidth,sr=this.pixelHeight;const ar=er?this.numberOfMipmapLevels:1;for(let or=0;or<ar;or++){const lr=new Int32Array(this.arrayBuffer,ir,1)[0];ir+=4;for(let cr=0;cr<this.numberOfFaces;cr++){const ur=new Uint8Array(this.arrayBuffer,ir,lr);tr.push({data:ur,width:nr,height:sr}),ir+=lr,ir+=3-(lr+3)%4}nr=Math.max(1,nr*.5),sr=Math.max(1,sr*.5)}return tr}}const FINISH_TYPE_DEFAULT=0,FINISH_TYPE_CHROME=1,FINISH_TYPE_PEARLESCENT=2,FINISH_TYPE_RUBBER=3,FINISH_TYPE_MATTE_METALLIC=4,FINISH_TYPE_METAL=5,FILE_LOCATION_TRY_PARTS=0,FILE_LOCATION_TRY_P=1,FILE_LOCATION_TRY_MODELS=2,FILE_LOCATION_AS_IS=3,FILE_LOCATION_TRY_RELATIVE=4,FILE_LOCATION_TRY_ABSOLUTE=5,FILE_LOCATION_NOT_FOUND=6,MAIN_COLOUR_CODE="16",MAIN_EDGE_COLOUR_CODE="24",COLOR_SPACE_LDRAW=SRGBColorSpace,_tempVec0=new Vector3$1,_tempVec1=new Vector3$1;class ConditionalLineSegments extends LineSegments{constructor(er,tr){super(er,tr),this.isConditionalLine=!0}}function generateFaceNormals(rr){for(let er=0,tr=rr.length;er<tr;er++){const ir=rr[er],nr=ir.vertices,sr=nr[0],ar=nr[1],or=nr[2];_tempVec0.subVectors(ar,sr),_tempVec1.subVectors(or,ar),ir.faceNormal=new Vector3$1().crossVectors(_tempVec0,_tempVec1).normalize()}}const _ray=new Ray$1;function smoothNormals(rr,er,tr=!1){const ir=100.00000001000001;function nr(hr){const pr=~~(hr.x*ir),gr=~~(hr.y*ir),vr=~~(hr.z*ir);return`${pr},${gr},${vr}`}function sr(hr,pr){return`${nr(hr)}_${nr(pr)}`}function ar(hr,pr,gr){gr.direction.subVectors(pr,hr).normalize();const vr=hr.dot(gr.direction);return gr.origin.copy(hr).addScaledVector(gr.direction,-vr),gr}function or(hr){return sr(hr.origin,hr.direction)}const lr=new Set,cr=new Map,ur={},dr=[];for(let hr=0,pr=er.length;hr<pr;hr++){const vr=er[hr].vertices,mr=vr[0],fr=vr[1];if(lr.add(sr(mr,fr)),lr.add(sr(fr,mr)),tr){const _r=ar(mr,fr,new Ray$1),Ar=or(_r);if(!cr.has(Ar)){ar(fr,mr,_r);const Sr=or(_r),br={ray:_r,distances:[]};cr.set(Ar,br),cr.set(Sr,br)}const yr=cr.get(Ar);let wr=yr.ray.direction.dot(mr),xr=yr.ray.direction.dot(fr);wr>xr&&([wr,xr]=[xr,wr]),yr.distances.push(wr,xr)}}for(let hr=0,pr=rr.length;hr<pr;hr++){const gr=rr[hr],vr=gr.vertices,mr=vr.length;for(let fr=0;fr<mr;fr++){const _r=fr,Ar=(fr+1)%mr,yr=vr[_r],wr=vr[Ar],xr=sr(yr,wr);if(lr.has(xr))continue;if(tr){ar(yr,wr,_ray);const br=or(_ray);if(cr.has(br)){const Cr=cr.get(br),{ray:Ir,distances:Rr}=Cr;let Pr=Ir.direction.dot(yr),Dr=Ir.direction.dot(wr);Pr>Dr&&([Pr,Dr]=[Dr,Pr]);let Fr=!1;for(let Or=0,Nr=Rr.length;Or<Nr;Or+=2)if(Pr>=Rr[Or]&&Dr<=Rr[Or+1]){Fr=!0;break}if(Fr)continue}}const Sr={index:_r,tri:gr};ur[xr]=Sr}}for(;;){let hr=null;for(const gr in ur){hr=ur[gr];break}if(hr===null)break;const pr=[hr];for(;pr.length>0;){const gr=pr.pop().tri,vr=gr.vertices,mr=gr.normals,fr=gr.faceNormal,_r=vr.length;for(let Ar=0;Ar<_r;Ar++){const yr=Ar,wr=(Ar+1)%_r,xr=vr[yr],Sr=vr[wr],br=sr(xr,Sr);delete ur[br];const Cr=sr(Sr,xr),Ir=ur[Cr];if(Ir){const Rr=Ir.tri,Pr=Ir.index,Dr=Rr.normals,Fr=Dr.length,Or=Rr.faceNormal;if(Math.abs(Rr.faceNormal.dot(gr.faceNormal))<.25)continue;Cr in ur&&(pr.push(Ir),delete ur[Cr]);const Nr=(Pr+1)%Fr;mr[yr]&&Dr[Nr]&&mr[yr]!==Dr[Nr]&&(Dr[Nr].norm.add(mr[yr].norm),mr[yr].norm=Dr[Nr].norm);let Ur=mr[yr]||Dr[Nr];Ur===null&&(Ur={norm:new Vector3$1},dr.push(Ur.norm)),mr[yr]===null&&(mr[yr]=Ur,Ur.norm.add(fr)),Dr[Nr]===null&&(Dr[Nr]=Ur,Ur.norm.add(Or)),mr[wr]&&Dr[Pr]&&mr[wr]!==Dr[Pr]&&(Dr[Pr].norm.add(mr[wr].norm),mr[wr].norm=Dr[Pr].norm);let Br=mr[wr]||Dr[Pr];Br===null&&(Br={norm:new Vector3$1},dr.push(Br.norm)),mr[wr]===null&&(mr[wr]=Br,Br.norm.add(fr)),Dr[Pr]===null&&(Dr[Pr]=Br,Br.norm.add(Or))}}}}for(let hr=0,pr=dr.length;hr<pr;hr++)dr[hr].normalize()}function isPartType(rr){return rr==="Part"||rr==="Unofficial_Part"}function isPrimitiveType(rr){return/primitive/i.test(rr)||rr==="Subpart"}class LineParser{constructor(er,tr){this.line=er,this.lineLength=er.length,this.currentCharIndex=0,this.currentChar=" ",this.lineNumber=tr}seekNonSpace(){for(;this.currentCharIndex<this.lineLength;){if(this.currentChar=this.line.charAt(this.currentCharIndex),this.currentChar!==" "&&this.currentChar!=="	")return;this.currentCharIndex++}}getToken(){const er=this.currentCharIndex++;for(;this.currentCharIndex<this.lineLength&&(this.currentChar=this.line.charAt(this.currentCharIndex),!(this.currentChar===" "||this.currentChar==="	"));)this.currentCharIndex++;const tr=this.currentCharIndex;return this.seekNonSpace(),this.line.substring(er,tr)}getVector(){return new Vector3$1(parseFloat(this.getToken()),parseFloat(this.getToken()),parseFloat(this.getToken()))}getRemainingString(){return this.line.substring(this.currentCharIndex,this.lineLength)}isAtTheEnd(){return this.currentCharIndex>=this.lineLength}setToEnd(){this.currentCharIndex=this.lineLength}getLineNumberString(){return this.lineNumber>=0?" at line "+this.lineNumber:""}}class LDrawParsedCache{constructor(er){this.loader=er,this._cache={}}cloneResult(er){const tr={};return tr.faces=er.faces.map(ir=>({colorCode:ir.colorCode,material:ir.material,vertices:ir.vertices.map(nr=>nr.clone()),normals:ir.normals.map(()=>null),faceNormal:null})),tr.conditionalSegments=er.conditionalSegments.map(ir=>({colorCode:ir.colorCode,material:ir.material,vertices:ir.vertices.map(nr=>nr.clone()),controlPoints:ir.controlPoints.map(nr=>nr.clone())})),tr.lineSegments=er.lineSegments.map(ir=>({colorCode:ir.colorCode,material:ir.material,vertices:ir.vertices.map(nr=>nr.clone())})),tr.type=er.type,tr.category=er.category,tr.keywords=er.keywords,tr.author=er.author,tr.subobjects=er.subobjects,tr.fileName=er.fileName,tr.totalFaces=er.totalFaces,tr.startingBuildingStep=er.startingBuildingStep,tr.materials=er.materials,tr.group=null,tr}async fetchData(er){let tr=!1,ir=FILE_LOCATION_TRY_PARTS;for(;ir!==FILE_LOCATION_NOT_FOUND;){let nr=er;switch(ir){case FILE_LOCATION_AS_IS:ir=ir+1;break;case FILE_LOCATION_TRY_PARTS:nr="parts/"+nr,ir=ir+1;break;case FILE_LOCATION_TRY_P:nr="p/"+nr,ir=ir+1;break;case FILE_LOCATION_TRY_MODELS:nr="models/"+nr,ir=ir+1;break;case FILE_LOCATION_TRY_RELATIVE:nr=er.substring(0,er.lastIndexOf("/")+1)+nr,ir=ir+1;break;case FILE_LOCATION_TRY_ABSOLUTE:tr?ir=FILE_LOCATION_NOT_FOUND:(er=er.toLowerCase(),nr=er,tr=!0,ir=FILE_LOCATION_TRY_PARTS);break}const sr=this.loader,ar=new FileLoader(sr.manager);ar.setPath(sr.partsLibraryPath),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials);try{return await ar.loadAsync(nr)}catch{continue}}throw new Error('LDrawLoader: Subobject "'+er+'" could not be loaded.')}parse(er,tr=null){const ir=this.loader,nr=[],sr=[],ar=[],or=[],lr={},cr=Cr=>lr[Cr]||null;let ur="Model",dr=null,hr=null,pr=null,gr=0;er.indexOf(`\r
`)!==-1&&(er=er.replace(/\r\n/g,`
`));const vr=er.split(`
`),mr=vr.length;let fr=!1,_r=null,Ar=null,yr=!1,wr=!0,xr=!1,Sr=!0,br=!1;for(let Cr=0;Cr<mr;Cr++){const Ir=vr[Cr];if(Ir.length===0)continue;if(fr){Ir.startsWith("0 FILE ")?(this.setData(_r,Ar),_r=Ir.substring(7),Ar=""):Ar+=Ir+`
`;continue}const Rr=new LineParser(Ir,Cr+1);if(Rr.seekNonSpace(),Rr.isAtTheEnd())continue;const Pr=Rr.getToken();let Dr,Fr,Or,Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi;switch(Pr){case"0":const Kr=Rr.getToken();if(Kr)switch(Kr){case"!LDRAW_ORG":ur=Rr.getToken();break;case"!COLOUR":Dr=ir.parseColorMetaDirective(Rr),Dr?lr[Dr.userData.code]=Dr:console.warn("LDrawLoader: Error parsing material"+Rr.getLineNumberString());break;case"!CATEGORY":dr=Rr.getToken();break;case"!KEYWORDS":const es=Rr.getRemainingString().split(",");es.length>0&&(hr||(hr=[]),es.forEach(function(ms){hr.push(ms.trim())}));break;case"FILE":Cr>0&&(fr=!0,_r=Rr.getRemainingString(),Ar="",yr=!1,wr=!0);break;case"BFC":for(;!Rr.isAtTheEnd();){const ms=Rr.getToken();switch(ms){case"CERTIFY":case"NOCERTIFY":yr=ms==="CERTIFY",wr=!0;break;case"CW":case"CCW":wr=ms==="CCW";break;case"INVERTNEXT":xr=!0;break;case"CLIP":case"NOCLIP":Sr=ms==="CLIP";break;default:console.warn('THREE.LDrawLoader: BFC directive "'+ms+'" is unknown.');break}}break;case"STEP":br=!0;break;case"Author:":pr=Rr.getToken();break;default:break}break;case"1":Fr=Rr.getToken(),Dr=cr(Fr);const $r=parseFloat(Rr.getToken()),Vr=parseFloat(Rr.getToken()),Gr=parseFloat(Rr.getToken()),qr=parseFloat(Rr.getToken()),ji=parseFloat(Rr.getToken()),Jr=parseFloat(Rr.getToken()),Ji=parseFloat(Rr.getToken()),Ki=parseFloat(Rr.getToken()),Zi=parseFloat(Rr.getToken()),Zr=parseFloat(Rr.getToken()),is=parseFloat(Rr.getToken()),os=parseFloat(Rr.getToken()),cs=new Matrix4().set(qr,ji,Jr,$r,Ji,Ki,Zi,Vr,Zr,is,os,Gr,0,0,0,1);let ss=Rr.getRemainingString().trim().replace(/\\/g,"/");ir.fileMap[ss]?ss=ir.fileMap[ss]:ss.startsWith("s/")?ss="parts/"+ss:ss.startsWith("48/")&&(ss="p/"+ss),or.push({material:Dr,colorCode:Fr,matrix:cs,fileName:ss,inverted:xr,startingBuildingStep:br}),br=!1,xr=!1;break;case"2":Fr=Rr.getToken(),Dr=cr(Fr),Br=Rr.getVector(),Wr=Rr.getVector(),Or={material:Dr,colorCode:Fr,vertices:[Br,Wr]},sr.push(Or);break;case"5":Fr=Rr.getToken(),Dr=cr(Fr),Br=Rr.getVector(),Wr=Rr.getVector(),Qi=Rr.getVector(),Xi=Rr.getVector(),Or={material:Dr,colorCode:Fr,vertices:[Br,Wr],controlPoints:[Qi,Xi]},ar.push(Or);break;case"3":Fr=Rr.getToken(),Dr=cr(Fr),Nr=wr,Ur=!yr||!Sr,Nr===!0?(Br=Rr.getVector(),Wr=Rr.getVector(),Xr=Rr.getVector()):(Xr=Rr.getVector(),Wr=Rr.getVector(),Br=Rr.getVector()),nr.push({material:Dr,colorCode:Fr,faceNormal:null,vertices:[Br,Wr,Xr],normals:[null,null,null]}),gr++,Ur===!0&&(nr.push({material:Dr,colorCode:Fr,faceNormal:null,vertices:[Xr,Wr,Br],normals:[null,null,null]}),gr++);break;case"4":Fr=Rr.getToken(),Dr=cr(Fr),Nr=wr,Ur=!yr||!Sr,Nr===!0?(Br=Rr.getVector(),Wr=Rr.getVector(),Xr=Rr.getVector(),Yr=Rr.getVector()):(Yr=Rr.getVector(),Xr=Rr.getVector(),Wr=Rr.getVector(),Br=Rr.getVector()),nr.push({material:Dr,colorCode:Fr,faceNormal:null,vertices:[Br,Wr,Xr,Yr],normals:[null,null,null,null]}),gr+=2,Ur===!0&&(nr.push({material:Dr,colorCode:Fr,faceNormal:null,vertices:[Yr,Xr,Wr,Br],normals:[null,null,null,null]}),gr+=2);break;default:throw new Error('LDrawLoader: Unknown line type "'+Pr+'"'+Rr.getLineNumberString()+".")}}return fr&&this.setData(_r,Ar),{faces:nr,conditionalSegments:ar,lineSegments:sr,type:ur,category:dr,keywords:hr,author:pr,subobjects:or,totalFaces:gr,startingBuildingStep:br,materials:lr,fileName:tr,group:null}}getData(er,tr=!0){const ir=er.toLowerCase(),nr=this._cache[ir];return nr===null||nr instanceof Promise?null:tr?this.cloneResult(nr):nr}async ensureDataLoaded(er){const tr=er.toLowerCase();tr in this._cache||(this._cache[tr]=this.fetchData(er).then(ir=>{const nr=this.parse(ir,er);return this._cache[tr]=nr,nr})),await this._cache[tr]}setData(er,tr){const ir=er.toLowerCase();this._cache[ir]=this.parse(tr,er)}}function getMaterialFromCode(rr,er,tr,ir){return(!ir&&rr===MAIN_COLOUR_CODE||ir&&rr===MAIN_EDGE_COLOUR_CODE)&&(rr=er),tr[rr]||null}class LDrawPartsGeometryCache{constructor(er){this.loader=er,this.parseCache=new LDrawParsedCache(er),this._cache={}}async processIntoMesh(er){const tr=this.loader,ir=this.parseCache,nr=new Set,sr=async(or,lr=null)=>{const cr=or.subobjects,ur=[];for(let pr=0,gr=cr.length;pr<gr;pr++){const vr=cr[pr],mr=ir.ensureDataLoaded(vr.fileName).then(()=>{const fr=ir.getData(vr.fileName,!1);return isPrimitiveType(fr.type)?sr(ir.getData(vr.fileName),vr):this.loadModel(vr.fileName).catch(_r=>(console.warn(_r),null))});ur.push(mr)}const dr=new Group;dr.userData.category=or.category,dr.userData.keywords=or.keywords,dr.userData.author=or.author,dr.userData.type=or.type,dr.userData.fileName=or.fileName,or.group=dr;const hr=await Promise.all(ur);for(let pr=0,gr=hr.length;pr<gr;pr++){const vr=or.subobjects[pr],mr=hr[pr];if(mr===null)continue;if(mr.isGroup){const Pr=mr;vr.matrix.decompose(Pr.position,Pr.quaternion,Pr.scale),Pr.userData.startingBuildingStep=vr.startingBuildingStep,Pr.name=vr.fileName,tr.applyMaterialsToMesh(Pr,vr.colorCode,or.materials),Pr.userData.colorCode=vr.colorCode,dr.add(Pr);continue}mr.group.children.length&&dr.add(mr.group);const fr=or.lineSegments,_r=or.conditionalSegments,Ar=or.faces,yr=mr.lineSegments,wr=mr.conditionalSegments,xr=mr.faces,Sr=vr.matrix,br=vr.inverted,Cr=Sr.determinant()<0,Ir=vr.colorCode,Rr=Ir===MAIN_COLOUR_CODE?MAIN_EDGE_COLOUR_CODE:Ir;for(let Pr=0,Dr=yr.length;Pr<Dr;Pr++){const Fr=yr[Pr],Or=Fr.vertices;Or[0].applyMatrix4(Sr),Or[1].applyMatrix4(Sr),Fr.colorCode=Fr.colorCode===MAIN_EDGE_COLOUR_CODE?Rr:Fr.colorCode,Fr.material=Fr.material||getMaterialFromCode(Fr.colorCode,Fr.colorCode,or.materials,!0),fr.push(Fr)}for(let Pr=0,Dr=wr.length;Pr<Dr;Pr++){const Fr=wr[Pr],Or=Fr.vertices,Nr=Fr.controlPoints;Or[0].applyMatrix4(Sr),Or[1].applyMatrix4(Sr),Nr[0].applyMatrix4(Sr),Nr[1].applyMatrix4(Sr),Fr.colorCode=Fr.colorCode===MAIN_EDGE_COLOUR_CODE?Rr:Fr.colorCode,Fr.material=Fr.material||getMaterialFromCode(Fr.colorCode,Fr.colorCode,or.materials,!0),_r.push(Fr)}for(let Pr=0,Dr=xr.length;Pr<Dr;Pr++){const Fr=xr[Pr],Or=Fr.vertices;for(let Nr=0,Ur=Or.length;Nr<Ur;Nr++)Or[Nr].applyMatrix4(Sr);Fr.colorCode=Fr.colorCode===MAIN_COLOUR_CODE?Ir:Fr.colorCode,Fr.material=Fr.material||getMaterialFromCode(Fr.colorCode,Ir,or.materials,!1),nr.add(Fr.colorCode),Cr!==br&&Or.reverse(),Ar.push(Fr)}or.totalFaces+=mr.totalFaces}return lr&&(tr.applyMaterialsToMesh(dr,lr.colorCode,or.materials),dr.userData.colorCode=lr.colorCode),or};for(let or=0,lr=er.faces;or<lr;or++)nr.add(er.faces[or].colorCode);if(await sr(er),tr.smoothNormals){const or=nr.size>1;generateFaceNormals(er.faces),smoothNormals(er.faces,er.lineSegments,or)}const ar=er.group;return er.faces.length>0&&ar.add(createObject(this.loader,er.faces,3,!1,er.totalFaces)),er.lineSegments.length>0&&ar.add(createObject(this.loader,er.lineSegments,2)),er.conditionalSegments.length>0&&ar.add(createObject(this.loader,er.conditionalSegments,2,!0)),ar}hasCachedModel(er){return er!==null&&er.toLowerCase()in this._cache}async getCachedModel(er){if(er!==null&&this.hasCachedModel(er)){const tr=er.toLowerCase();return(await this._cache[tr]).clone()}else return null}async loadModel(er){const tr=this.parseCache,ir=er.toLowerCase();if(this.hasCachedModel(er))return this.getCachedModel(er);{await tr.ensureDataLoaded(er);const nr=tr.getData(er),sr=this.processIntoMesh(nr);return this.hasCachedModel(er)?this.getCachedModel(er):(isPartType(nr.type)&&(this._cache[ir]=sr),(await sr).clone())}}async parseModel(er){const ir=this.parseCache.parse(er);return isPartType(ir.type)&&this.hasCachedModel(ir.fileName)?this.getCachedModel(ir.fileName):this.processIntoMesh(ir)}}function sortByMaterial(rr,er){return rr.colorCode===er.colorCode?0:rr.colorCode<er.colorCode?-1:1}function createObject(rr,er,tr,ir=!1,nr=null){er.sort(sortByMaterial),nr===null&&(nr=er.length);const sr=new Float32Array(tr*nr*3),ar=tr===3?new Float32Array(tr*nr*3):null,or=[],lr=new Array(6),cr=new BufferGeometry;let ur=null,dr=0,hr=0,pr=0;for(let vr=0,mr=er.length;vr<mr;vr++){const fr=er[vr];let _r=fr.vertices;_r.length===4&&(lr[0]=_r[0],lr[1]=_r[1],lr[2]=_r[2],lr[3]=_r[0],lr[4]=_r[2],lr[5]=_r[3],_r=lr);for(let Ar=0,yr=_r.length;Ar<yr;Ar++){const wr=_r[Ar],xr=pr+Ar*3;sr[xr+0]=wr.x,sr[xr+1]=wr.y,sr[xr+2]=wr.z}if(tr===3){if(!fr.faceNormal){const yr=_r[0],wr=_r[1],xr=_r[2];_tempVec0.subVectors(wr,yr),_tempVec1.subVectors(xr,wr),fr.faceNormal=new Vector3$1().crossVectors(_tempVec0,_tempVec1).normalize()}let Ar=fr.normals;Ar.length===4&&(lr[0]=Ar[0],lr[1]=Ar[1],lr[2]=Ar[2],lr[3]=Ar[0],lr[4]=Ar[2],lr[5]=Ar[3],Ar=lr);for(let yr=0,wr=Ar.length;yr<wr;yr++){let xr=fr.faceNormal;Ar[yr]&&(xr=Ar[yr].norm);const Sr=pr+yr*3;ar[Sr+0]=xr.x,ar[Sr+1]=xr.y,ar[Sr+2]=xr.z}}if(ur!==fr.colorCode){ur!==null&&cr.addGroup(dr,hr,or.length-1);const Ar=fr.material;if(Ar!==null){if(tr===3)or.push(Ar);else if(tr===2)if(ir){const yr=rr.edgeMaterialCache.get(Ar);or.push(rr.conditionalEdgeMaterialCache.get(yr))}else or.push(rr.edgeMaterialCache.get(Ar))}else or.push(fr.colorCode);ur=fr.colorCode,dr=pr/3,hr=_r.length}else hr+=_r.length;pr+=3*_r.length}hr>0&&cr.addGroup(dr,1/0,or.length-1),cr.setAttribute("position",new BufferAttribute(sr,3)),ar!==null&&cr.setAttribute("normal",new BufferAttribute(ar,3));let gr=null;if(tr===2?ir?gr=new ConditionalLineSegments(cr,or.length===1?or[0]:or):gr=new LineSegments(cr,or.length===1?or[0]:or):tr===3&&(gr=new Mesh(cr,or.length===1?or[0]:or)),ir){gr.isConditionalLine=!0;const vr=new Float32Array(er.length*3*2),mr=new Float32Array(er.length*3*2),fr=new Float32Array(er.length*3*2);for(let _r=0,Ar=er.length;_r<Ar;_r++){const yr=er[_r],wr=yr.vertices,xr=yr.controlPoints,Sr=xr[0],br=xr[1],Cr=wr[0],Ir=wr[1],Rr=_r*3*2;vr[Rr+0]=Sr.x,vr[Rr+1]=Sr.y,vr[Rr+2]=Sr.z,vr[Rr+3]=Sr.x,vr[Rr+4]=Sr.y,vr[Rr+5]=Sr.z,mr[Rr+0]=br.x,mr[Rr+1]=br.y,mr[Rr+2]=br.z,mr[Rr+3]=br.x,mr[Rr+4]=br.y,mr[Rr+5]=br.z,fr[Rr+0]=Ir.x-Cr.x,fr[Rr+1]=Ir.y-Cr.y,fr[Rr+2]=Ir.z-Cr.z,fr[Rr+3]=Ir.x-Cr.x,fr[Rr+4]=Ir.y-Cr.y,fr[Rr+5]=Ir.z-Cr.z}cr.setAttribute("control0",new BufferAttribute(vr,3,!1)),cr.setAttribute("control1",new BufferAttribute(mr,3,!1)),cr.setAttribute("direction",new BufferAttribute(fr,3,!1))}return gr}class LDrawLoader extends Loader{constructor(er){super(er),this.materials=[],this.materialLibrary={},this.edgeMaterialCache=new WeakMap,this.conditionalEdgeMaterialCache=new WeakMap,this.partsCache=new LDrawPartsGeometryCache(this),this.fileMap={},this.smoothNormals=!0,this.partsLibraryPath="",this.ConditionalLineMaterial=null,this.missingColorMaterial=new MeshStandardMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935,roughness:.3,metalness:0}),this.missingEdgeColorMaterial=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16711935}),this.missingConditionalEdgeColorMaterial=null,this.edgeMaterialCache.set(this.missingColorMaterial,this.missingEdgeColorMaterial),this.conditionalEdgeMaterialCache.set(this.missingEdgeColorMaterial,this.missingConditionalEdgeColorMaterial)}setPartsLibraryPath(er){return this.partsLibraryPath=er,this}setConditionalLineMaterial(er){return this.ConditionalLineMaterial=er,this.missingConditionalEdgeColorMaterial=new this.ConditionalLineMaterial({name:Loader.DEFAULT_MATERIAL_NAME,fog:!0,color:16711935}),this}async preloadMaterials(er){const tr=new FileLoader(this.manager);tr.setPath(this.path),tr.setRequestHeader(this.requestHeader),tr.setWithCredentials(this.withCredentials);const ir=await tr.loadAsync(er),nr=/^0 !COLOUR/,sr=ir.split(/[\n\r]/g),ar=[];for(let or=0,lr=sr.length;or<lr;or++){const cr=sr[or];if(nr.test(cr)){const ur=cr.replace(nr,""),dr=this.parseColorMetaDirective(new LineParser(ur));ar.push(dr)}}this.setMaterials(ar)}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setRequestHeader(this.requestHeader),sr.setWithCredentials(this.withCredentials),sr.load(er,ar=>{this.setMaterials([]),this.partsCache.parseModel(ar,this.materialLibrary).then(or=>{this.applyMaterialsToMesh(or,MAIN_COLOUR_CODE,this.materialLibrary,!0),this.computeBuildingSteps(or),or.userData.fileName=er,tr(or)}).catch(nr)},ir,nr)}parse(er,tr,ir){this.partsCache.parseModel(er,this.materialLibrary).then(nr=>{this.applyMaterialsToMesh(nr,MAIN_COLOUR_CODE,this.materialLibrary,!0),this.computeBuildingSteps(nr),nr.userData.fileName="",tr(nr)}).catch(ir)}setMaterials(er){this.materialLibrary={},this.materials=[];for(let tr=0,ir=er.length;tr<ir;tr++)this.addMaterial(er[tr]);return this.addMaterial(this.parseColorMetaDirective(new LineParser("Main_Colour CODE 16 VALUE #FF8080 EDGE #333333"))),this.addMaterial(this.parseColorMetaDirective(new LineParser("Edge_Colour CODE 24 VALUE #A0A0A0 EDGE #333333"))),this}setFileMap(er){return this.fileMap=er,this}addMaterial(er){const tr=this.materialLibrary;return tr[er.userData.code]||(this.materials.push(er),tr[er.userData.code]=er),this}getMaterial(er){if(er.startsWith("0x2")){const tr=er.substring(3);return this.parseColorMetaDirective(new LineParser("Direct_Color_"+tr+" CODE -1 VALUE #"+tr+" EDGE #"+tr))}return this.materialLibrary[er]||null}applyMaterialsToMesh(er,tr,ir,nr=!1){const sr=this,ar=tr===MAIN_COLOUR_CODE;er.traverse(lr=>{if(lr.isMesh||lr.isLineSegments)if(Array.isArray(lr.material))for(let cr=0,ur=lr.material.length;cr<ur;cr++)lr.material[cr].isMaterial||(lr.material[cr]=or(lr,lr.material[cr]));else lr.material.isMaterial||(lr.material=or(lr,lr.material))});function or(lr,cr){if(ar&&!(cr in ir)&&!nr)return cr;const ur=lr.isLineSegments||lr.isConditionalLine;(!ur&&cr===MAIN_COLOUR_CODE||ur&&cr===MAIN_EDGE_COLOUR_CODE)&&(cr=tr);let hr=null;if(cr in ir)hr=ir[cr];else if(nr)hr=sr.getMaterial(cr),hr===null&&(console.warn(`LDrawLoader: Material properties for code ${cr} not available.`),hr=sr.missingColorMaterial);else return cr;return lr.isLineSegments&&(hr=sr.edgeMaterialCache.get(hr),lr.isConditionalLine&&(hr=sr.conditionalEdgeMaterialCache.get(hr))),hr}}getMainMaterial(){return this.getMaterial(MAIN_COLOUR_CODE)}getMainEdgeMaterial(){const er=this.getMaterial(MAIN_EDGE_COLOUR_CODE);return er?this.edgeMaterialCache.get(er):null}parseColorMetaDirective(er){let tr=null,ir="#FF00FF",nr="#FF00FF",sr=1,ar=!1,or=0,lr=FINISH_TYPE_DEFAULT,cr=null;const ur=er.getToken();if(!ur)throw new Error('LDrawLoader: Material name was expected after "!COLOUR tag'+er.getLineNumberString()+".");let dr=null;for(;dr=er.getToken(),!!dr;)if(!pr(dr))switch(dr.toUpperCase()){case"CODE":tr=er.getToken();break;case"VALUE":if(ir=er.getToken(),ir.startsWith("0x"))ir="#"+ir.substring(2);else if(!ir.startsWith("#"))throw new Error("LDrawLoader: Invalid color while parsing material"+er.getLineNumberString()+".");break;case"EDGE":if(nr=er.getToken(),nr.startsWith("0x"))nr="#"+nr.substring(2);else if(!nr.startsWith("#")){if(cr=this.getMaterial(nr),!cr)throw new Error("LDrawLoader: Invalid edge color while parsing material"+er.getLineNumberString()+".");cr=this.edgeMaterialCache.get(cr)}break;case"ALPHA":if(sr=parseInt(er.getToken()),isNaN(sr))throw new Error("LDrawLoader: Invalid alpha value in material definition"+er.getLineNumberString()+".");sr=Math.max(0,Math.min(1,sr/255)),sr<1&&(ar=!0);break;case"LUMINANCE":if(!pr(er.getToken()))throw new Error("LDrawLoader: Invalid luminance value in material definition"+LineParser.getLineNumberString()+".");break;case"CHROME":lr=FINISH_TYPE_CHROME;break;case"PEARLESCENT":lr=FINISH_TYPE_PEARLESCENT;break;case"RUBBER":lr=FINISH_TYPE_RUBBER;break;case"MATTE_METALLIC":lr=FINISH_TYPE_MATTE_METALLIC;break;case"METAL":lr=FINISH_TYPE_METAL;break;case"MATERIAL":er.setToEnd();break;default:throw new Error('LDrawLoader: Unknown token "'+dr+'" while parsing material'+er.getLineNumberString()+".")}let hr=null;switch(lr){case FINISH_TYPE_DEFAULT:hr=new MeshStandardMaterial({roughness:.3,metalness:0});break;case FINISH_TYPE_PEARLESCENT:hr=new MeshStandardMaterial({roughness:.3,metalness:.25});break;case FINISH_TYPE_CHROME:hr=new MeshStandardMaterial({roughness:0,metalness:1});break;case FINISH_TYPE_RUBBER:hr=new MeshStandardMaterial({roughness:.9,metalness:0});break;case FINISH_TYPE_MATTE_METALLIC:hr=new MeshStandardMaterial({roughness:.8,metalness:.4});break;case FINISH_TYPE_METAL:hr=new MeshStandardMaterial({roughness:.2,metalness:.85});break;default:break}if(hr.color.setStyle(ir,COLOR_SPACE_LDRAW),hr.transparent=ar,hr.premultipliedAlpha=!0,hr.opacity=sr,hr.depthWrite=!ar,hr.polygonOffset=!0,hr.polygonOffsetFactor=1,or!==0&&hr.emissive.setStyle(ir,COLOR_SPACE_LDRAW).multiplyScalar(or),!cr){if(cr=new LineBasicMaterial({color:new Color().setStyle(nr,COLOR_SPACE_LDRAW),transparent:ar,opacity:sr,depthWrite:!ar}),cr.color,cr.userData.code=tr,cr.name=ur+" - Edge",this.ConditionalLineMaterial===null)throw new Error("THREE.LDrawLoader: ConditionalLineMaterial type must be specificed via .setConditionalLineMaterial().");const gr=new this.ConditionalLineMaterial({fog:!0,transparent:ar,depthWrite:!ar,color:new Color().setStyle(nr,COLOR_SPACE_LDRAW),opacity:sr});gr.userData.code=tr,gr.name=ur+" - Conditional Edge",this.conditionalEdgeMaterialCache.set(cr,gr)}return hr.userData.code=tr,hr.name=ur,this.edgeMaterialCache.set(hr,cr),this.addMaterial(hr),hr;function pr(gr){let vr;return gr.startsWith("LUMINANCE")?vr=parseInt(gr.substring(9)):vr=parseInt(gr),isNaN(vr)?!1:(or=Math.max(0,Math.min(1,vr/255)),!0)}}computeBuildingSteps(er){let tr=0;er.traverse(ir=>{ir.isGroup&&(ir.userData.startingBuildingStep&&tr++,ir.userData.buildingStep=tr)}),er.userData.numBuildingSteps=tr+1}}let LUT3dlLoader$1=class extends Loader{constructor(er){super(er),this.type=UnsignedByteType}setType(er){if(er!==UnsignedByteType&&er!==FloatType)throw new Error("LUT3dlLoader: Unsupported type");return this.type=er,this}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("text"),sr.load(er,ar=>{try{tr(this.parse(ar))}catch(or){nr?nr(or):console.error(or),this.manager.itemError(er)}},ir,nr)}parse(er){const tr=/^[\d ]+$/m,ir=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let nr=tr.exec(er);if(nr===null)throw new Error("LUT3dlLoader: Missing grid information");const sr=nr[0].trim().split(/\s+/g).map(Number),ar=sr[1]-sr[0],or=sr.length,lr=or**2;for(let fr=1,_r=sr.length;fr<_r;++fr)if(ar!==sr[fr]-sr[fr-1])throw new Error("LUT3dlLoader: Inconsistent grid size");const cr=new Float32Array(or**3*4);let ur=0,dr=0;for(;(nr=ir.exec(er))!==null;){const fr=Number(nr[1]),_r=Number(nr[2]),Ar=Number(nr[3]);ur=Math.max(ur,fr,_r,Ar);const yr=dr%or,wr=Math.floor(dr/or)%or,xr=Math.floor(dr/lr)%or,Sr=(yr*lr+wr*or+xr)*4;cr[Sr+0]=fr,cr[Sr+1]=_r,cr[Sr+2]=Ar,++dr}const hr=Math.ceil(Math.log2(ur)),pr=Math.pow(2,hr),gr=this.type===UnsignedByteType?new Uint8Array(cr.length):cr,vr=this.type===UnsignedByteType?255:1;for(let fr=0,_r=gr.length;fr<_r;fr+=4){const Ar=fr+1,yr=fr+2,wr=fr+3;gr[fr]=cr[fr]/pr*vr,gr[Ar]=cr[Ar]/pr*vr,gr[yr]=cr[yr]/pr*vr,gr[wr]=vr}const mr=new Data3DTexture;return mr.image.data=gr,mr.image.width=or,mr.image.height=or,mr.image.depth=or,mr.format=RGBAFormat,mr.type=this.type,mr.magFilter=LinearFilter,mr.minFilter=LinearFilter,mr.wrapS=ClampToEdgeWrapping,mr.wrapT=ClampToEdgeWrapping,mr.wrapR=ClampToEdgeWrapping,mr.generateMipmaps=!1,mr.needsUpdate=!0,{size:or,texture3D:mr}}},LUTCubeLoader$1=class extends Loader{constructor(er){super(er),this.type=UnsignedByteType}setType(er){if(er!==UnsignedByteType&&er!==FloatType)throw new Error("LUTCubeLoader: Unsupported type");return this.type=er,this}load(er,tr,ir,nr){const sr=new FileLoader(this.manager);sr.setPath(this.path),sr.setResponseType("text"),sr.load(er,ar=>{try{tr(this.parse(ar))}catch(or){nr?nr(or):console.error(or),this.manager.itemError(er)}},ir,nr)}parse(er){const tr=/TITLE +"([^"]*)"/,ir=/LUT_3D_SIZE +(\d+)/,nr=/DOMAIN_MIN +([\d.]+) +([\d.]+) +([\d.]+)/,sr=/DOMAIN_MAX +([\d.]+) +([\d.]+) +([\d.]+)/,ar=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let or=tr.exec(er);const lr=or!==null?or[1]:null;if(or=ir.exec(er),or===null)throw new Error("LUTCubeLoader: Missing LUT_3D_SIZE information");const cr=Number(or[1]),ur=cr**3*4,dr=this.type===UnsignedByteType?new Uint8Array(ur):new Float32Array(ur),hr=new Vector3$1(0,0,0),pr=new Vector3$1(1,1,1);if(or=nr.exec(er),or!==null&&hr.set(Number(or[1]),Number(or[2]),Number(or[3])),or=sr.exec(er),or!==null&&pr.set(Number(or[1]),Number(or[2]),Number(or[3])),hr.x>pr.x||hr.y>pr.y||hr.z>pr.z)throw new Error("LUTCubeLoader: Invalid input domain");const gr=this.type===UnsignedByteType?255:1;let vr=0;for(;(or=ar.exec(er))!==null;)dr[vr++]=Number(or[1])*gr,dr[vr++]=Number(or[2])*gr,dr[vr++]=Number(or[3])*gr,dr[vr++]=gr;const mr=new Data3DTexture;return mr.image.data=dr,mr.image.width=cr,mr.image.height=cr,mr.image.depth=cr,mr.type=this.type,mr.magFilter=LinearFilter,mr.minFilter=LinearFilter,mr.wrapS=ClampToEdgeWrapping,mr.wrapT=ClampToEdgeWrapping,mr.wrapR=ClampToEdgeWrapping,mr.generateMipmaps=!1,mr.needsUpdate=!0,{title:lr,size:cr,domainMin:hr,domainMax:pr,texture3D:mr}}};class LWO2Parser{constructor(er){this.IFF=er}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();const er=this.IFF.reader.getIDTag();let tr=this.IFF.reader.getUint32();switch(tr>this.IFF.reader.dv.byteLength-this.IFF.reader.offset&&(this.IFF.reader.offset-=4,tr=this.IFF.reader.getUint16()),this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=tr,er){case"FORM":this.IFF.parseForm(tr);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"AUVO":case"STCK":case"PROC":case"VALU":case"FUNC":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NVSK":case"NCRD":case"WRPW":case"WRPH":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"NODS":case"VERS":case"ENUM":case"TAG ":case"OPAC":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"GLOW":case"GVAL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"SURF":this.IFF.parseSurfaceLwo2(tr);break;case"CLIP":this.IFF.parseClipLwo2(tr);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":tr===4?this.IFF.currentNode[er]=this.IFF.reader.getInt32():this.IFF.reader.skip(tr);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(tr);break;case"PNTS":this.IFF.parsePoints(tr);break;case"VMAP":this.IFF.parseVertexMapping(tr);break;case"AUVU":case"AUVN":this.IFF.reader.skip(tr-1),this.IFF.reader.getVariableLengthIndex();break;case"POLS":this.IFF.parsePolygonList(tr);break;case"TAGS":this.IFF.parseTagStrings(tr);break;case"PTAG":this.IFF.parsePolygonTagMapping(tr);break;case"VMAD":this.IFF.parseVertexMapping(tr,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":const ir=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=ir;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":tr===4?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(tr);break;case"SMAN":const nr=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(nr<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.reader.skip(2);break;case"TMAP":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(tr);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;case"BLOK":break;default:this.IFF.parseUnknownCHUNK(er,tr)}er!="FORM"&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=er,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class LWO3Parser{constructor(er){this.IFF=er}parseBlock(){this.IFF.debugger.offset=this.IFF.reader.offset,this.IFF.debugger.closeForms();const er=this.IFF.reader.getIDTag(),tr=this.IFF.reader.getUint32();switch(this.IFF.debugger.dataOffset=this.IFF.reader.offset,this.IFF.debugger.length=tr,er){case"FORM":this.IFF.parseForm(tr);break;case"ICON":case"VMPA":case"BBOX":case"NORM":case"PRE ":case"POST":case"KEY ":case"SPAN":case"TIME":case"CLRS":case"CLRA":case"FILT":case"DITH":case"CONT":case"BRIT":case"SATR":case"HUE ":case"GAMM":case"NEGA":case"IFLT":case"PFLT":case"PROJ":case"AXIS":case"AAST":case"PIXB":case"STCK":case"VALU":case"PNAM":case"INAM":case"GRST":case"GREN":case"GRPT":case"FKEY":case"IKEY":case"CSYS":case"OPAQ":case"CMAP":case"NLOC":case"NZOM":case"NVER":case"NSRV":case"NCRD":case"NMOD":case"NSEL":case"NPRW":case"NPLA":case"VERS":case"ENUM":case"TAG ":case"CGMD":case"CGTY":case"CGST":case"CGEN":case"CGTS":case"CGTE":case"OSMP":case"OMDE":case"OUTR":case"FLAG":case"TRNL":case"SHRP":case"RFOP":case"RSAN":case"TROP":case"RBLR":case"TBLR":case"CLRH":case"CLRF":case"ADTR":case"GLOW":case"LINE":case"ALPH":case"VCOL":case"ENAB":this.IFF.debugger.skipped=!0,this.IFF.reader.skip(tr);break;case"IPIX":case"IMIP":case"IMOD":case"AMOD":case"IINV":case"INCR":case"IAXS":case"IFOT":case"ITIM":case"IWRL":case"IUTI":case"IINX":case"IINY":case"IINZ":case"IREF":tr===4?this.IFF.currentNode[er]=this.IFF.reader.getInt32():this.IFF.reader.skip(tr);break;case"OTAG":this.IFF.parseObjectTag();break;case"LAYR":this.IFF.parseLayer(tr);break;case"PNTS":this.IFF.parsePoints(tr);break;case"VMAP":this.IFF.parseVertexMapping(tr);break;case"POLS":this.IFF.parsePolygonList(tr);break;case"TAGS":this.IFF.parseTagStrings(tr);break;case"PTAG":this.IFF.parsePolygonTagMapping(tr);break;case"VMAD":this.IFF.parseVertexMapping(tr,!0);break;case"DESC":this.IFF.currentForm.description=this.IFF.reader.getString();break;case"TEXT":case"CMNT":case"NCOM":this.IFF.currentForm.comment=this.IFF.reader.getString();break;case"NAME":this.IFF.currentForm.channelName=this.IFF.reader.getString();break;case"WRAP":this.IFF.currentForm.wrap={w:this.IFF.reader.getUint16(),h:this.IFF.reader.getUint16()};break;case"IMAG":const ir=this.IFF.reader.getVariableLengthIndex();this.IFF.currentForm.imageIndex=ir;break;case"OREF":this.IFF.currentForm.referenceObject=this.IFF.reader.getString();break;case"ROID":this.IFF.currentForm.referenceObjectID=this.IFF.reader.getUint32();break;case"SSHN":this.IFF.currentSurface.surfaceShaderName=this.IFF.reader.getString();break;case"AOVN":this.IFF.currentSurface.surfaceCustomAOVName=this.IFF.reader.getString();break;case"NSTA":this.IFF.currentForm.disabled=this.IFF.reader.getUint16();break;case"NRNM":this.IFF.currentForm.realName=this.IFF.reader.getString();break;case"NNME":this.IFF.currentForm.refName=this.IFF.reader.getString(),this.IFF.currentSurface.nodes[this.IFF.currentForm.refName]=this.IFF.currentForm;break;case"INME":this.IFF.currentForm.nodeName||(this.IFF.currentForm.nodeName=[]),this.IFF.currentForm.nodeName.push(this.IFF.reader.getString());break;case"IINN":this.IFF.currentForm.inputNodeName||(this.IFF.currentForm.inputNodeName=[]),this.IFF.currentForm.inputNodeName.push(this.IFF.reader.getString());break;case"IINM":this.IFF.currentForm.inputName||(this.IFF.currentForm.inputName=[]),this.IFF.currentForm.inputName.push(this.IFF.reader.getString());break;case"IONM":this.IFF.currentForm.inputOutputName||(this.IFF.currentForm.inputOutputName=[]),this.IFF.currentForm.inputOutputName.push(this.IFF.reader.getString());break;case"FNAM":this.IFF.currentForm.fileName=this.IFF.reader.getString();break;case"CHAN":tr===4?this.IFF.currentForm.textureChannel=this.IFF.reader.getIDTag():this.IFF.reader.skip(tr);break;case"SMAN":const nr=this.IFF.reader.getFloat32();this.IFF.currentSurface.attributes.smooth=!(nr<0);break;case"COLR":this.IFF.currentSurface.attributes.Color={value:this.IFF.reader.getFloat32Array(3)},this.IFF.reader.skip(2);break;case"LUMI":this.IFF.currentSurface.attributes.Luminosity={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"SPEC":this.IFF.currentSurface.attributes.Specular={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"DIFF":this.IFF.currentSurface.attributes.Diffuse={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"REFL":this.IFF.currentSurface.attributes.Reflection={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"GLOS":this.IFF.currentSurface.attributes.Glossiness={value:this.IFF.reader.getFloat32()},this.IFF.reader.skip(2);break;case"TRAN":this.IFF.currentSurface.attributes.opacity=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"BUMP":this.IFF.currentSurface.attributes.bumpStrength=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"SIDE":this.IFF.currentSurface.attributes.side=this.IFF.reader.getUint16();break;case"RIMG":this.IFF.currentSurface.attributes.reflectionMap=this.IFF.reader.getVariableLengthIndex();break;case"RIND":this.IFF.currentSurface.attributes.refractiveIndex=this.IFF.reader.getFloat32(),this.IFF.reader.skip(2);break;case"TIMG":this.IFF.currentSurface.attributes.refractionMap=this.IFF.reader.getVariableLengthIndex();break;case"IMAP":this.IFF.currentSurface.attributes.imageMapIndex=this.IFF.reader.getUint32();break;case"IUVI":this.IFF.currentNode.UVChannel=this.IFF.reader.getString(tr);break;case"IUTL":this.IFF.currentNode.widthWrappingMode=this.IFF.reader.getUint32();break;case"IVTL":this.IFF.currentNode.heightWrappingMode=this.IFF.reader.getUint32();break;default:this.IFF.parseUnknownCHUNK(er,tr)}er!="FORM"&&(this.IFF.debugger.node=1,this.IFF.debugger.nodeID=er,this.IFF.debugger.log()),this.IFF.reader.offset>=this.IFF.currentFormEnd&&(this.IFF.currentForm=this.IFF.parentForm)}}class IFFParser{constructor(){this.debugger=new Debugger}parse(er){if(this.reader=new DataViewReader(er),this.tree={materials:{},layers:[],tags:[],textures:[]},this.currentLayer=this.tree,this.currentForm=this.tree,this.parseTopForm(),this.tree.format!==void 0){if(this.tree.format==="LWO2")for(this.parser=new LWO2Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();else if(this.tree.format==="LWO3")for(this.parser=new LWO3Parser(this);!this.reader.endOfFile();)this.parser.parseBlock();return this.debugger.offset=this.reader.offset,this.debugger.closeForms(),this.tree}}parseTopForm(){this.debugger.offset=this.reader.offset;var er=this.reader.getIDTag();if(er!=="FORM"){console.warn("LWOLoader: Top-level FORM missing.");return}var tr=this.reader.getUint32();this.debugger.dataOffset=this.reader.offset,this.debugger.length=tr;var ir=this.reader.getIDTag();ir==="LWO2"?this.tree.format=ir:ir==="LWO3"&&(this.tree.format=ir),this.debugger.node=0,this.debugger.nodeID=ir,this.debugger.log()}parseForm(er){var tr=this.reader.getIDTag();switch(tr){case"ISEQ":case"ANIM":case"STCC":case"VPVL":case"VPRM":case"NROT":case"WRPW":case"WRPH":case"FUNC":case"FALL":case"OPAC":case"GRAD":case"ENVS":case"VMOP":case"VMBG":case"OMAX":case"STEX":case"CKBG":case"CKEY":case"VMLA":case"VMLB":this.debugger.skipped=!0,this.skipForm(er);break;case"META":case"NNDS":case"NODS":case"NDTA":case"ADAT":case"AOVS":case"BLOK":case"IBGC":case"IOPC":case"IIMG":case"TXTR":this.debugger.length=4,this.debugger.skipped=!0;break;case"IFAL":case"ISCL":case"IPOS":case"IROT":case"IBMP":case"IUTD":case"IVTD":this.parseTextureNodeAttribute(tr);break;case"ENVL":this.parseEnvelope(er);break;case"CLIP":this.tree.format==="LWO2"?this.parseForm(er):this.parseClip(er);break;case"STIL":this.parseImage();break;case"XREF":this.reader.skip(8),this.currentForm.referenceTexture={index:this.reader.getUint32(),refName:this.reader.getString()};break;case"IMST":this.parseImageStateForm(er);break;case"SURF":this.parseSurfaceForm(er);break;case"VALU":this.parseValueForm(er);break;case"NTAG":this.parseSubNode(er);break;case"ATTR":case"SATR":this.setupForm("attributes",er);break;case"NCON":this.parseConnections(er);break;case"SSHA":this.parentForm=this.currentForm,this.currentForm=this.currentSurface,this.setupForm("surfaceShader",er);break;case"SSHD":this.setupForm("surfaceShaderData",er);break;case"ENTR":this.parseEntryForm(er);break;case"IMAP":this.parseImageMap(er);break;case"TAMP":this.parseXVAL("amplitude",er);break;case"TMAP":this.setupForm("textureMap",er);break;case"CNTR":this.parseXVAL3("center",er);break;case"SIZE":this.parseXVAL3("scale",er);break;case"ROTA":this.parseXVAL3("rotation",er);break;default:this.parseUnknownForm(tr,er)}this.debugger.node=0,this.debugger.nodeID=tr,this.debugger.log()}setupForm(er,tr){this.currentForm||(this.currentForm=this.currentNode),this.currentFormEnd=this.reader.offset+tr,this.parentForm=this.currentForm,this.currentForm[er]?(console.warn("LWOLoader: form already exists on parent: ",er,this.currentForm),this.currentForm=this.currentForm[er]):(this.currentForm[er]={},this.currentForm=this.currentForm[er])}skipForm(er){this.reader.skip(er-4)}parseUnknownForm(er,tr){console.warn("LWOLoader: unknown FORM encountered: "+er,tr),printBuffer(this.reader.dv.buffer,this.reader.offset,tr-4),this.reader.skip(tr-4)}parseSurfaceForm(er){this.reader.skip(8);var tr=this.reader.getString(),ir={attributes:{},connections:{},name:tr,inputName:tr,nodes:{},source:this.reader.getString()};this.tree.materials[tr]=ir,this.currentSurface=ir,this.parentForm=this.tree.materials,this.currentForm=ir,this.currentFormEnd=this.reader.offset+er}parseSurfaceLwo2(er){var tr=this.reader.getString(),ir={attributes:{},connections:{},name:tr,nodes:{},source:this.reader.getString()};this.tree.materials[tr]=ir,this.currentSurface=ir,this.parentForm=this.tree.materials,this.currentForm=ir,this.currentFormEnd=this.reader.offset+er}parseSubNode(er){this.reader.skip(8);var tr=this.reader.getString(),ir={name:tr};this.currentForm=ir,this.currentNode=ir,this.currentFormEnd=this.reader.offset+er}parseConnections(er){this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.currentForm=this.currentSurface.connections}parseEntryForm(er){this.reader.skip(8);var tr=this.reader.getString();this.currentForm=this.currentNode.attributes,this.setupForm(tr,er)}parseValueForm(){this.reader.skip(8);var er=this.reader.getString();er==="double"?this.currentForm.value=this.reader.getUint64():er==="int"?this.currentForm.value=this.reader.getUint32():er==="vparam"?(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64()):er==="vparam3"&&(this.reader.skip(24),this.currentForm.value=this.reader.getFloat64Array(3))}parseImageStateForm(){this.reader.skip(8),this.currentForm.mipMapLevel=this.reader.getFloat32()}parseImageMap(er){this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.currentForm.maps||(this.currentForm.maps=[]);var tr={};this.currentForm.maps.push(tr),this.currentForm=tr,this.reader.skip(10)}parseTextureNodeAttribute(er){switch(this.reader.skip(28),this.reader.skip(20),er){case"ISCL":this.currentNode.scale=this.reader.getFloat32Array(3);break;case"IPOS":this.currentNode.position=this.reader.getFloat32Array(3);break;case"IROT":this.currentNode.rotation=this.reader.getFloat32Array(3);break;case"IFAL":this.currentNode.falloff=this.reader.getFloat32Array(3);break;case"IBMP":this.currentNode.amplitude=this.reader.getFloat32();break;case"IUTD":this.currentNode.uTiles=this.reader.getFloat32();break;case"IVTD":this.currentNode.vTiles=this.reader.getFloat32();break}this.reader.skip(2)}parseEnvelope(er){this.reader.skip(er-4)}parseClip(er){var tr=this.reader.getIDTag();if(tr==="FORM"){this.reader.skip(16),this.currentNode.fileName=this.reader.getString();return}this.reader.setOffset(this.reader.offset-4),this.currentFormEnd=this.reader.offset+er,this.parentForm=this.currentForm,this.reader.skip(8);var ir={index:this.reader.getUint32()};this.tree.textures.push(ir),this.currentForm=ir}parseClipLwo2(er){for(var tr={index:this.reader.getUint32(),fileName:""};;){var ir=this.reader.getIDTag(),nr=this.reader.getUint16();if(ir==="STIL"){tr.fileName=this.reader.getString();break}if(nr>=er)break}this.tree.textures.push(tr),this.currentForm=tr}parseImage(){this.reader.skip(8),this.currentForm.fileName=this.reader.getString()}parseXVAL(er,tr){var ir=this.reader.offset+tr-4;this.reader.skip(8),this.currentForm[er]=this.reader.getFloat32(),this.reader.setOffset(ir)}parseXVAL3(er,tr){var ir=this.reader.offset+tr-4;this.reader.skip(8),this.currentForm[er]={x:this.reader.getFloat32(),y:this.reader.getFloat32(),z:this.reader.getFloat32()},this.reader.setOffset(ir)}parseObjectTag(){this.tree.objectTags||(this.tree.objectTags={}),this.tree.objectTags[this.reader.getIDTag()]={tagString:this.reader.getString()}}parseLayer(er){var tr=this.reader.getUint16(),ir=this.reader.getUint16(),nr=this.reader.getFloat32Array(3),sr={number:tr,flags:ir,pivot:[-nr[0],nr[1],nr[2]],name:this.reader.getString()};this.tree.layers.push(sr),this.currentLayer=sr;var ar=16+stringOffset(this.currentLayer.name);this.currentLayer.parent=ar<er?this.reader.getUint16():-1}parsePoints(er){this.currentPoints=[];for(var tr=0;tr<er/4;tr+=3)this.currentPoints.push(-this.reader.getFloat32(),this.reader.getFloat32(),this.reader.getFloat32())}parseVertexMapping(er,tr){var ir=this.reader.offset+er,nr=this.reader.getString();if(this.reader.offset===ir){this.currentForm.UVChannel=nr;return}this.reader.setOffset(this.reader.offset-stringOffset(nr));var sr=this.reader.getIDTag();this.reader.getUint16();var ar=this.reader.getString(),or=er-6-stringOffset(ar);switch(sr){case"TXUV":this.parseUVMapping(ar,ir,tr);break;case"MORF":case"SPOT":this.parseMorphTargets(ar,ir,sr);break;case"APSL":case"NORM":case"WGHT":case"MNVW":case"PICK":case"RGB ":case"RGBA":this.reader.skip(or);break;default:console.warn("LWOLoader: unknown vertex map type: "+sr),this.reader.skip(or)}}parseUVMapping(er,tr,ir){for(var nr=[],sr=[],ar=[];this.reader.offset<tr;)nr.push(this.reader.getVariableLengthIndex()),ir&&sr.push(this.reader.getVariableLengthIndex()),ar.push(this.reader.getFloat32(),this.reader.getFloat32());ir?(this.currentLayer.discontinuousUVs||(this.currentLayer.discontinuousUVs={}),this.currentLayer.discontinuousUVs[er]={uvIndices:nr,polyIndices:sr,uvs:ar}):(this.currentLayer.uvs||(this.currentLayer.uvs={}),this.currentLayer.uvs[er]={uvIndices:nr,uvs:ar})}parseMorphTargets(er,tr,ir){var nr=[],sr=[];for(ir=ir==="MORF"?"relative":"absolute";this.reader.offset<tr;)nr.push(this.reader.getVariableLengthIndex()),sr.push(this.reader.getFloat32(),this.reader.getFloat32(),-this.reader.getFloat32());this.currentLayer.morphTargets||(this.currentLayer.morphTargets={}),this.currentLayer.morphTargets[er]={indices:nr,points:sr,type:ir}}parsePolygonList(er){for(var tr=this.reader.offset+er,ir=this.reader.getIDTag(),nr=[],sr=[];this.reader.offset<tr;){var ar=this.reader.getUint16();ar=ar&1023,sr.push(ar);for(var or=0;or<ar;or++)nr.push(this.reader.getVariableLengthIndex())}var lr={type:ir,vertexIndices:nr,polygonDimensions:sr,points:this.currentPoints};sr[0]===1?lr.type="points":sr[0]===2&&(lr.type="lines"),this.currentLayer.geometry=lr}parseTagStrings(er){this.tree.tags=this.reader.getStringArray(er)}parsePolygonTagMapping(er){var tr=this.reader.offset+er,ir=this.reader.getIDTag();ir==="SURF"?this.parseMaterialIndices(tr):this.reader.skip(er-4)}parseMaterialIndices(er){for(this.currentLayer.geometry.materialIndices=[];this.reader.offset<er;){var tr=this.reader.getVariableLengthIndex(),ir=this.reader.getUint16();this.currentLayer.geometry.materialIndices.push(tr,ir)}}parseUnknownCHUNK(er,tr){console.warn("LWOLoader: unknown chunk type: "+er+" length: "+tr);var ir=this.reader.getString(tr);this.currentForm[er]=ir}}class DataViewReader{constructor(er){this.dv=new DataView(er),this.offset=0,this._textDecoder=new TextDecoder,this._bytes=new Uint8Array(er)}size(){return this.dv.buffer.byteLength}setOffset(er){er>0&&er<this.dv.buffer.byteLength?this.offset=er:console.error("LWOLoader: invalid buffer offset")}endOfFile(){return this.offset>=this.size()}skip(er){this.offset+=er}getUint8(){var er=this.dv.getUint8(this.offset);return this.offset+=1,er}getUint16(){var er=this.dv.getUint16(this.offset);return this.offset+=2,er}getInt32(){var er=this.dv.getInt32(this.offset,!1);return this.offset+=4,er}getUint32(){var er=this.dv.getUint32(this.offset,!1);return this.offset+=4,er}getUint64(){var er,tr;return tr=this.getUint32(),er=this.getUint32(),tr*4294967296+er}getFloat32(){var er=this.dv.getFloat32(this.offset,!1);return this.offset+=4,er}getFloat32Array(er){for(var tr=[],ir=0;ir<er;ir++)tr.push(this.getFloat32());return tr}getFloat64(){var er=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,er}getFloat64Array(er){for(var tr=[],ir=0;ir<er;ir++)tr.push(this.getFloat64());return tr}getVariableLengthIndex(){var er=this.getUint8();return er===255?this.getUint8()*65536+this.getUint8()*256+this.getUint8():er*256+this.getUint8()}getIDTag(){return this.getString(4)}getString(er){if(er===0)return;const tr=this.offset;let ir,nr;return er?(nr=er,ir=this._textDecoder.decode(new Uint8Array(this.dv.buffer,tr,er))):(nr=this._bytes.indexOf(0,tr)-tr,ir=this._textDecoder.decode(new Uint8Array(this.dv.buffer,tr,nr)),nr++,nr+=nr%2),this.skip(nr),ir}getStringArray(er){var tr=this.getString(er);return tr=tr.split("\0"),tr.filter(Boolean)}}class Debugger{constructor(){this.active=!1,this.depth=0,this.formList=[]}enable(){this.active=!0}log(){if(this.active){var er;switch(this.node){case 0:er="FORM";break;case 1:er="CHK";break;case 2:er="S-CHK";break}console.log("| ".repeat(this.depth)+er,this.nodeID,`( ${this.offset} ) -> ( ${this.dataOffset+this.length} )`,this.node==0?" {":"",this.skipped?"SKIPPED":"",this.node==0&&this.skipped?"}":""),this.node==0&&!this.skipped&&(this.depth+=1,this.formList.push(this.dataOffset+this.length)),this.skipped=!1}}closeForms(){if(this.active)for(var er=this.formList.length-1;er>=0;er--)this.offset>=this.formList[er]&&(this.depth-=1,console.log("| ".repeat(this.depth)+"}"),this.formList.splice(-1,1))}}function isEven(rr){return rr%2}function stringOffset(rr){return rr.length+1+(isEven(rr.length+1)?1:0)}function printBuffer(rr,er,tr){console.log(new TextDecoder().decode(new Uint8Array(rr,er,tr)))}let _lwoTree;class LWOLoader extends Loader{constructor(er,tr={}){super(er),this.resourcePath=tr.resourcePath!==void 0?tr.resourcePath:""}load(er,tr,ir,nr){const sr=this,ar=sr.path===""?extractParentUrl(er,"Objects"):sr.path,or=er.split(ar).pop().split(".")[0],lr=new FileLoader(this.manager);lr.setPath(sr.path),lr.setResponseType("arraybuffer"),lr.load(er,function(cr){try{tr(sr.parse(cr,ar,or))}catch(ur){nr?nr(ur):console.error(ur),sr.manager.itemError(er)}},ir,nr)}parse(er,tr,ir){_lwoTree=new IFFParser().parse(er);const nr=new TextureLoader(this.manager).setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);return new LWOTreeParser(nr).parse(ir)}}class LWOTreeParser{constructor(er){this.textureLoader=er}parse(er){return this.materials=new MaterialParser(this.textureLoader).parse(),this.defaultLayerName=er,this.meshes=this.parseLayers(),{materials:this.materials,meshes:this.meshes}}parseLayers(){const er=[],tr=[],ir=new GeometryParser,nr=this;return _lwoTree.layers.forEach(function(sr){const ar=ir.parse(sr.geometry,sr),or=nr.parseMesh(ar,sr);er[sr.number]=or,sr.parent===-1?tr.push(or):er[sr.parent].add(or)}),this.applyPivots(tr),tr}parseMesh(er,tr){let ir;const nr=this.getMaterials(er.userData.matNames,tr.geometry.type);return tr.geometry.type==="points"?ir=new Points(er,nr):tr.geometry.type==="lines"?ir=new LineSegments(er,nr):ir=new Mesh(er,nr),tr.name?ir.name=tr.name:ir.name=this.defaultLayerName+"_layer_"+tr.number,ir.userData.pivot=tr.pivot,ir}applyPivots(er){er.forEach(function(tr){tr.traverse(function(ir){const nr=ir.userData.pivot;if(ir.position.x+=nr[0],ir.position.y+=nr[1],ir.position.z+=nr[2],ir.parent){const sr=ir.parent.userData.pivot;ir.position.x-=sr[0],ir.position.y-=sr[1],ir.position.z-=sr[2]}})})}getMaterials(er,tr){const ir=[],nr=this;er.forEach(function(ar,or){ir[or]=nr.getMaterialByName(ar)}),(tr==="points"||tr==="lines")&&ir.forEach(function(ar,or){const lr={color:ar.color};tr==="points"?(lr.size=.1,lr.map=ar.map,ir[or]=new PointsMaterial(lr)):tr==="lines"&&(ir[or]=new LineBasicMaterial(lr))});const sr=ir.filter(Boolean);return sr.length===1?sr[0]:ir}getMaterialByName(er){return this.materials.filter(function(tr){return tr.name===er})[0]}}class MaterialParser{constructor(er){this.textureLoader=er}parse(){const er=[];this.textures={};for(const tr in _lwoTree.materials)_lwoTree.format==="LWO3"?er.push(this.parseMaterial(_lwoTree.materials[tr],tr,_lwoTree.textures)):_lwoTree.format==="LWO2"&&er.push(this.parseMaterialLwo2(_lwoTree.materials[tr],tr,_lwoTree.textures));return er}parseMaterial(er,tr,ir){let nr={name:tr,side:this.getSide(er.attributes),flatShading:this.getSmooth(er.attributes)};const sr=this.parseConnections(er.connections,er.nodes),ar=this.parseTextureNodes(sr.maps);this.parseAttributeImageMaps(sr.attributes,ir,ar,er.maps);const or=this.parseAttributes(sr.attributes,ar);this.parseEnvMap(sr,ar,or),nr=Object.assign(ar,nr),nr=Object.assign(nr,or);const lr=this.getMaterialType(sr.attributes);return lr!==MeshPhongMaterial&&delete nr.refractionRatio,new lr(nr)}parseMaterialLwo2(er,tr){let ir={name:tr,side:this.getSide(er.attributes),flatShading:this.getSmooth(er.attributes)};const nr=this.parseAttributes(er.attributes,{});return ir=Object.assign(ir,nr),new MeshPhongMaterial(ir)}getSide(er){if(!er.side)return BackSide;switch(er.side){case 0:case 1:return BackSide;case 2:return FrontSide;case 3:return DoubleSide}}getSmooth(er){return er.smooth?!er.smooth:!0}parseConnections(er,tr){const ir={maps:{}},nr=er.inputName,sr=er.inputNodeName,ar=er.nodeName,or=this;return nr.forEach(function(lr,cr){if(lr==="Material"){const ur=or.getNodeByRefName(sr[cr],tr);ir.attributes=ur.attributes,ir.envMap=ur.fileName,ir.name=sr[cr]}}),ar.forEach(function(lr,cr){lr===ir.name&&(ir.maps[nr[cr]]=or.getNodeByRefName(sr[cr],tr))}),ir}getNodeByRefName(er,tr){for(const ir in tr)if(tr[ir].refName===er)return tr[ir]}parseTextureNodes(er){const tr={};for(const ir in er){const nr=er[ir],sr=nr.fileName;if(!sr)return;const ar=this.loadTexture(sr);switch(nr.widthWrappingMode!==void 0&&(ar.wrapS=this.getWrappingType(nr.widthWrappingMode)),nr.heightWrappingMode!==void 0&&(ar.wrapT=this.getWrappingType(nr.heightWrappingMode)),ir){case"Color":tr.map=ar,tr.map.colorSpace=SRGBColorSpace;break;case"Roughness":tr.roughnessMap=ar,tr.roughness=1;break;case"Specular":tr.specularMap=ar,tr.specularMap.colorSpace=SRGBColorSpace,tr.specular=16777215;break;case"Luminous":tr.emissiveMap=ar,tr.emissiveMap.colorSpace=SRGBColorSpace,tr.emissive=8421504;break;case"Luminous Color":tr.emissive=8421504;break;case"Metallic":tr.metalnessMap=ar,tr.metalness=1;break;case"Transparency":case"Alpha":tr.alphaMap=ar,tr.transparent=!0;break;case"Normal":tr.normalMap=ar,nr.amplitude!==void 0&&(tr.normalScale=new Vector2(nr.amplitude,nr.amplitude));break;case"Bump":tr.bumpMap=ar;break}}return tr.roughnessMap&&tr.specularMap&&delete tr.specularMap,tr}parseAttributeImageMaps(er,tr,ir){for(const nr in er){const sr=er[nr];if(sr.maps){const ar=sr.maps[0],or=this.getTexturePathByIndex(ar.imageIndex,tr);if(!or)return;const lr=this.loadTexture(or);switch(ar.wrap!==void 0&&(lr.wrapS=this.getWrappingType(ar.wrap.w)),ar.wrap!==void 0&&(lr.wrapT=this.getWrappingType(ar.wrap.h)),nr){case"Color":ir.map=lr,ir.map.colorSpace=SRGBColorSpace;break;case"Diffuse":ir.aoMap=lr;break;case"Roughness":ir.roughnessMap=lr,ir.roughness=1;break;case"Specular":ir.specularMap=lr,ir.specularMap.colorSpace=SRGBColorSpace,ir.specular=16777215;break;case"Luminosity":ir.emissiveMap=lr,ir.emissiveMap.colorSpace=SRGBColorSpace,ir.emissive=8421504;break;case"Metallic":ir.metalnessMap=lr,ir.metalness=1;break;case"Transparency":case"Alpha":ir.alphaMap=lr,ir.transparent=!0;break;case"Normal":ir.normalMap=lr;break;case"Bump":ir.bumpMap=lr;break}}}}parseAttributes(er,tr){const ir={};return er.Color&&!tr.map?ir.color=new Color().fromArray(er.Color.value):ir.color=new Color,er.Transparency&&er.Transparency.value!==0&&(ir.opacity=1-er.Transparency.value,ir.transparent=!0),er["Bump Height"]&&(ir.bumpScale=er["Bump Height"].value*.1),this.parsePhysicalAttributes(ir,er,tr),this.parseStandardAttributes(ir,er,tr),this.parsePhongAttributes(ir,er,tr),ir}parsePhysicalAttributes(er,tr){tr.Clearcoat&&tr.Clearcoat.value>0&&(er.clearcoat=tr.Clearcoat.value,tr["Clearcoat Gloss"]&&(er.clearcoatRoughness=.5*(1-tr["Clearcoat Gloss"].value)))}parseStandardAttributes(er,tr,ir){tr.Luminous&&(er.emissiveIntensity=tr.Luminous.value,tr["Luminous Color"]&&!ir.emissive?er.emissive=new Color().fromArray(tr["Luminous Color"].value):er.emissive=new Color(8421504)),tr.Roughness&&!ir.roughnessMap&&(er.roughness=tr.Roughness.value),tr.Metallic&&!ir.metalnessMap&&(er.metalness=tr.Metallic.value)}parsePhongAttributes(er,tr,ir){tr["Refraction Index"]&&(er.refractionRatio=.98/tr["Refraction Index"].value),tr.Diffuse&&er.color.multiplyScalar(tr.Diffuse.value),tr.Reflection&&(er.reflectivity=tr.Reflection.value,er.combine=AddOperation),tr.Luminosity&&(er.emissiveIntensity=tr.Luminosity.value,!ir.emissiveMap&&!ir.map?er.emissive=er.color:er.emissive=new Color(8421504)),!tr.Roughness&&tr.Specular&&!ir.specularMap&&(tr["Color Highlight"]?er.specular=new Color().setScalar(tr.Specular.value).lerp(er.color.clone().multiplyScalar(tr.Specular.value),tr["Color Highlight"].value):er.specular=new Color().setScalar(tr.Specular.value)),er.specular&&tr.Glossiness&&(er.shininess=7+Math.pow(2,tr.Glossiness.value*12+2))}parseEnvMap(er,tr,ir){if(er.envMap){const nr=this.loadTexture(er.envMap);ir.transparent&&ir.opacity<.999?(nr.mapping=EquirectangularRefractionMapping,ir.reflectivity!==void 0&&(delete ir.reflectivity,delete ir.combine),ir.metalness!==void 0&&(ir.metalness=1),ir.opacity=1):nr.mapping=EquirectangularReflectionMapping,tr.envMap=nr}}getTexturePathByIndex(er){let tr="";return _lwoTree.textures&&_lwoTree.textures.forEach(function(ir){ir.index===er&&(tr=ir.fileName)}),tr}loadTexture(er){return er?this.textureLoader.load(er,void 0,void 0,function(){console.warn("LWOLoader: non-standard resource hierarchy. Use `resourcePath` parameter to specify root content directory.")}):null}getWrappingType(er){switch(er){case 0:return console.warn('LWOLoader: "Reset" texture wrapping type is not supported in three.js'),ClampToEdgeWrapping;case 1:return RepeatWrapping;case 2:return MirroredRepeatWrapping;case 3:return ClampToEdgeWrapping}}getMaterialType(er){return er.Clearcoat&&er.Clearcoat.value>0?MeshPhysicalMaterial:er.Roughness?MeshStandardMaterial:MeshPhongMaterial}}class GeometryParser{parse(er,tr){const ir=new BufferGeometry;ir.setAttribute("position",new Float32BufferAttribute(er.points,3));const nr=this.splitIndices(er.vertexIndices,er.polygonDimensions);return ir.setIndex(nr),this.parseGroups(ir,er),ir.computeVertexNormals(),this.parseUVs(ir,tr,nr),this.parseMorphTargets(ir,tr,nr),ir.translate(-tr.pivot[0],-tr.pivot[1],-tr.pivot[2]),ir}splitIndices(er,tr){const ir=[];let nr=0;return tr.forEach(function(sr){if(sr<4)for(let ar=0;ar<sr;ar++)ir.push(er[nr+ar]);else if(sr===4)ir.push(er[nr],er[nr+1],er[nr+2],er[nr],er[nr+2],er[nr+3]);else if(sr>4){for(let ar=1;ar<sr-1;ar++)ir.push(er[nr],er[nr+ar],er[nr+ar+1]);console.warn("LWOLoader: polygons with greater than 4 sides are not supported")}nr+=sr}),ir}parseGroups(er,tr){const ir=_lwoTree.tags,nr=[];let sr=3;tr.type==="lines"&&(sr=2),tr.type==="points"&&(sr=1);const ar=this.splitMaterialIndices(tr.polygonDimensions,tr.materialIndices);let or=0;const lr={};let cr,ur,dr=0,hr=0;for(let pr=0;pr<ar.length;pr+=2){if(ur=ar[pr+1],pr===0&&(nr[or]=ir[ur]),cr===void 0&&(cr=ur),ur!==cr){let gr;lr[ir[cr]]?gr=lr[ir[cr]]:(gr=or,lr[ir[cr]]=or,nr[or]=ir[cr],or++),er.addGroup(dr,hr,gr),dr+=hr,cr=ur,hr=0}hr+=sr}if(er.groups.length>0){let pr;lr[ir[ur]]?pr=lr[ir[ur]]:(pr=or,lr[ir[ur]]=or,nr[or]=ir[ur]),er.addGroup(dr,hr,pr)}er.userData.matNames=nr}splitMaterialIndices(er,tr){const ir=[];return er.forEach(function(nr,sr){if(nr<=3)ir.push(tr[sr*2],tr[sr*2+1]);else if(nr===4)ir.push(tr[sr*2],tr[sr*2+1],tr[sr*2],tr[sr*2+1]);else for(let ar=0;ar<nr-2;ar++)ir.push(tr[sr*2],tr[sr*2+1])}),ir}parseUVs(er,tr){const ir=Array.from(Array(er.attributes.position.count*2),function(){return 0});for(const nr in tr.uvs){const sr=tr.uvs[nr].uvs;tr.uvs[nr].uvIndices.forEach(function(or,lr){ir[or*2]=sr[lr*2],ir[or*2+1]=sr[lr*2+1]})}er.setAttribute("uv",new Float32BufferAttribute(ir,2))}parseMorphTargets(er,tr){let ir=0;for(const nr in tr.morphTargets){const sr=er.attributes.position.array.slice();er.morphAttributes.position||(er.morphAttributes.position=[]);const ar=tr.morphTargets[nr].points,or=tr.morphTargets[nr].indices,lr=tr.morphTargets[nr].type;or.forEach(function(cr,ur){lr==="relative"?(sr[cr*3]+=ar[ur*3],sr[cr*3+1]+=ar[ur*3+1],sr[cr*3+2]+=ar[ur*3+2]):(sr[cr*3]=ar[ur*3],sr[cr*3+1]=ar[ur*3+1],sr[cr*3+2]=ar[ur*3+2])}),er.morphAttributes.position[ir]=new Float32BufferAttribute(sr,3),er.morphAttributes.position[ir].name=nr,ir++}er.morphTargetsRelative=!1}}function extractParentUrl(rr,er){const tr=rr.indexOf(er);return tr===-1?"./":rr.slice(0,tr)}const lottie={};if(typeof document<"u"){function createTag(rr){return document.createElement(rr)}function extendPrototype(rr,er){var tr,ir=rr.length,nr;for(tr=0;tr<ir;tr+=1){nr=rr[tr].prototype;for(var sr in nr)Object.prototype.hasOwnProperty.call(nr,sr)&&(er.prototype[sr]=nr[sr])}}function getDescriptor(rr,er){return Object.getOwnPropertyDescriptor(rr,er)}function createProxyFunction(rr){function er(){}return er.prototype=rr,er}function createSizedArray(rr){return Array.apply(null,{length:rr})}function ProjectInterface$1(){return{}}function roundValues(rr){_shouldRoundValues=!!rr}function bmRnd(rr){return _shouldRoundValues?Math.round(rr):rr}function styleDiv(rr){rr.style.position="absolute",rr.style.top=0,rr.style.left=0,rr.style.display="block",rr.style.transformOrigin="0 0",rr.style.webkitTransformOrigin="0 0",rr.style.backfaceVisibility="visible",rr.style.webkitBackfaceVisibility="visible",rr.style.transformStyle="preserve-3d",rr.style.webkitTransformStyle="preserve-3d",rr.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(rr,er,tr,ir){this.type=rr,this.currentTime=er,this.totalTime=tr,this.direction=ir<0?-1:1}function BMCompleteEvent(rr,er){this.type=rr,this.direction=er<0?-1:1}function BMCompleteLoopEvent(rr,er,tr,ir){this.type=rr,this.currentLoop=tr,this.totalLoops=er,this.direction=ir<0?-1:1}function BMSegmentStartEvent(rr,er,tr){this.type=rr,this.firstFrame=er,this.totalFrames=tr}function BMDestroyEvent(rr,er){this.type=rr,this.target=er}function BMRenderFrameErrorEvent(rr,er){this.type="renderFrameError",this.nativeError=rr,this.currentTime=er}function BMConfigErrorEvent(rr){this.type="configError",this.nativeError=rr}function BMAnimationConfigErrorEvent(rr,er){this.type=rr,this.nativeError=er}function HSVtoRGB(rr,er,tr){var ir,nr,sr,ar,or,lr,cr,ur;switch(ar=Math.floor(rr*6),or=rr*6-ar,lr=tr*(1-er),cr=tr*(1-or*er),ur=tr*(1-(1-or)*er),ar%6){case 0:ir=tr,nr=ur,sr=lr;break;case 1:ir=cr,nr=tr,sr=lr;break;case 2:ir=lr,nr=tr,sr=ur;break;case 3:ir=lr,nr=cr,sr=tr;break;case 4:ir=ur,nr=lr,sr=tr;break;case 5:ir=tr,nr=lr,sr=cr;break;default:break}return[ir,nr,sr]}function RGBtoHSV(rr,er,tr){var ir=Math.max(rr,er,tr),nr=Math.min(rr,er,tr),sr=ir-nr,ar,or=ir===0?0:sr/ir,lr=ir/255;switch(ir){case nr:ar=0;break;case rr:ar=er-tr+sr*(er<tr?6:0),ar/=6*sr;break;case er:ar=tr-rr+sr*2,ar/=6*sr;break;case tr:ar=rr-er+sr*4,ar/=6*sr;break;default:break}return[ar,or,lr]}function addSaturationToRGB(rr,er){var tr=RGBtoHSV(rr[0]*255,rr[1]*255,rr[2]*255);return tr[1]+=er,tr[1]>1?tr[1]=1:tr[1]<=0&&(tr[1]=0),HSVtoRGB(tr[0],tr[1],tr[2])}function addBrightnessToRGB(rr,er){var tr=RGBtoHSV(rr[0]*255,rr[1]*255,rr[2]*255);return tr[2]+=er,tr[2]>1?tr[2]=1:tr[2]<0&&(tr[2]=0),HSVtoRGB(tr[0],tr[1],tr[2])}function addHueToRGB(rr,er){var tr=RGBtoHSV(rr[0]*255,rr[1]*255,rr[2]*255);return tr[0]+=er/360,tr[0]>1?tr[0]-=1:tr[0]<0&&(tr[0]+=1),HSVtoRGB(tr[0],tr[1],tr[2])}function createNS(rr){return document.createElementNS(svgNS,rr)}function BaseEvent(){}function getRenderer(rr){return renderers[rr]}function bezFunction(){var rr=Math;function er(hr,pr,gr,vr,mr,fr){var _r=hr*vr+pr*mr+gr*fr-mr*vr-fr*hr-gr*pr;return _r>-.001&&_r<.001}function tr(hr,pr,gr,vr,mr,fr,_r,Ar,yr){if(gr===0&&fr===0&&yr===0)return er(hr,pr,vr,mr,_r,Ar);var wr=rr.sqrt(rr.pow(vr-hr,2)+rr.pow(mr-pr,2)+rr.pow(fr-gr,2)),xr=rr.sqrt(rr.pow(_r-hr,2)+rr.pow(Ar-pr,2)+rr.pow(yr-gr,2)),Sr=rr.sqrt(rr.pow(_r-vr,2)+rr.pow(Ar-mr,2)+rr.pow(yr-fr,2)),br;return wr>xr?wr>Sr?br=wr-xr-Sr:br=Sr-xr-wr:Sr>xr?br=Sr-xr-wr:br=xr-wr-Sr,br>-1e-4&&br<1e-4}var ir=function(){return function(hr,pr,gr,vr){var mr=getDefaultCurveSegments(),fr,_r,Ar,yr,wr,xr=0,Sr,br=[],Cr=[],Ir=bezierLengthPool.newElement();for(Ar=gr.length,fr=0;fr<mr;fr+=1){for(wr=fr/(mr-1),Sr=0,_r=0;_r<Ar;_r+=1)yr=bmPow(1-wr,3)*hr[_r]+3*bmPow(1-wr,2)*wr*gr[_r]+3*(1-wr)*bmPow(wr,2)*vr[_r]+bmPow(wr,3)*pr[_r],br[_r]=yr,Cr[_r]!==null&&(Sr+=bmPow(br[_r]-Cr[_r],2)),Cr[_r]=br[_r];Sr&&(Sr=bmSqrt(Sr),xr+=Sr),Ir.percents[fr]=wr,Ir.lengths[fr]=xr}return Ir.addedLength=xr,Ir}}();function nr(hr){var pr=segmentsLengthPool.newElement(),gr=hr.c,vr=hr.v,mr=hr.o,fr=hr.i,_r,Ar=hr._length,yr=pr.lengths,wr=0;for(_r=0;_r<Ar-1;_r+=1)yr[_r]=ir(vr[_r],vr[_r+1],mr[_r],fr[_r+1]),wr+=yr[_r].addedLength;return gr&&Ar&&(yr[_r]=ir(vr[_r],vr[0],mr[_r],fr[0]),wr+=yr[_r].addedLength),pr.totalLength=wr,pr}function sr(hr){this.segmentLength=0,this.points=new Array(hr)}function ar(hr,pr){this.partialLength=hr,this.point=pr}var or=function(){var hr={};return function(pr,gr,vr,mr){var fr=(pr[0]+"_"+pr[1]+"_"+gr[0]+"_"+gr[1]+"_"+vr[0]+"_"+vr[1]+"_"+mr[0]+"_"+mr[1]).replace(/\./g,"p");if(!hr[fr]){var _r=getDefaultCurveSegments(),Ar,yr,wr,xr,Sr,br=0,Cr,Ir,Rr=null;pr.length===2&&(pr[0]!==gr[0]||pr[1]!==gr[1])&&er(pr[0],pr[1],gr[0],gr[1],pr[0]+vr[0],pr[1]+vr[1])&&er(pr[0],pr[1],gr[0],gr[1],gr[0]+mr[0],gr[1]+mr[1])&&(_r=2);var Pr=new sr(_r);for(wr=vr.length,Ar=0;Ar<_r;Ar+=1){for(Ir=createSizedArray(wr),Sr=Ar/(_r-1),Cr=0,yr=0;yr<wr;yr+=1)xr=bmPow(1-Sr,3)*pr[yr]+3*bmPow(1-Sr,2)*Sr*(pr[yr]+vr[yr])+3*(1-Sr)*bmPow(Sr,2)*(gr[yr]+mr[yr])+bmPow(Sr,3)*gr[yr],Ir[yr]=xr,Rr!==null&&(Cr+=bmPow(Ir[yr]-Rr[yr],2));Cr=bmSqrt(Cr),br+=Cr,Pr.points[Ar]=new ar(Cr,Ir),Rr=Ir}Pr.segmentLength=br,hr[fr]=Pr}return hr[fr]}}();function lr(hr,pr){var gr=pr.percents,vr=pr.lengths,mr=gr.length,fr=bmFloor((mr-1)*hr),_r=hr*pr.addedLength,Ar=0;if(fr===mr-1||fr===0||_r===vr[fr])return gr[fr];for(var yr=vr[fr]>_r?-1:1,wr=!0;wr;)if(vr[fr]<=_r&&vr[fr+1]>_r?(Ar=(_r-vr[fr])/(vr[fr+1]-vr[fr]),wr=!1):fr+=yr,fr<0||fr>=mr-1){if(fr===mr-1)return gr[fr];wr=!1}return gr[fr]+(gr[fr+1]-gr[fr])*Ar}function cr(hr,pr,gr,vr,mr,fr){var _r=lr(mr,fr),Ar=1-_r,yr=rr.round((Ar*Ar*Ar*hr[0]+(_r*Ar*Ar+Ar*_r*Ar+Ar*Ar*_r)*gr[0]+(_r*_r*Ar+Ar*_r*_r+_r*Ar*_r)*vr[0]+_r*_r*_r*pr[0])*1e3)/1e3,wr=rr.round((Ar*Ar*Ar*hr[1]+(_r*Ar*Ar+Ar*_r*Ar+Ar*Ar*_r)*gr[1]+(_r*_r*Ar+Ar*_r*_r+_r*Ar*_r)*vr[1]+_r*_r*_r*pr[1])*1e3)/1e3;return[yr,wr]}var ur=createTypedArray("float32",8);function dr(hr,pr,gr,vr,mr,fr,_r){mr<0?mr=0:mr>1&&(mr=1);var Ar=lr(mr,_r);fr=fr>1?1:fr;var yr=lr(fr,_r),wr,xr=hr.length,Sr=1-Ar,br=1-yr,Cr=Sr*Sr*Sr,Ir=Ar*Sr*Sr*3,Rr=Ar*Ar*Sr*3,Pr=Ar*Ar*Ar,Dr=Sr*Sr*br,Fr=Ar*Sr*br+Sr*Ar*br+Sr*Sr*yr,Or=Ar*Ar*br+Sr*Ar*yr+Ar*Sr*yr,Nr=Ar*Ar*yr,Ur=Sr*br*br,Br=Ar*br*br+Sr*yr*br+Sr*br*yr,Wr=Ar*yr*br+Sr*yr*yr+Ar*br*yr,Xr=Ar*yr*yr,Yr=br*br*br,Qi=yr*br*br+br*yr*br+br*br*yr,Xi=yr*yr*br+br*yr*yr+yr*br*yr,Kr=yr*yr*yr;for(wr=0;wr<xr;wr+=1)ur[wr*4]=rr.round((Cr*hr[wr]+Ir*gr[wr]+Rr*vr[wr]+Pr*pr[wr])*1e3)/1e3,ur[wr*4+1]=rr.round((Dr*hr[wr]+Fr*gr[wr]+Or*vr[wr]+Nr*pr[wr])*1e3)/1e3,ur[wr*4+2]=rr.round((Ur*hr[wr]+Br*gr[wr]+Wr*vr[wr]+Xr*pr[wr])*1e3)/1e3,ur[wr*4+3]=rr.round((Yr*hr[wr]+Qi*gr[wr]+Xi*vr[wr]+Kr*pr[wr])*1e3)/1e3;return ur}return{getSegmentsLength:nr,getNewSegment:dr,getPointInSegment:cr,buildBezierData:or,pointOnLine2D:er,pointOnLine3D:tr}}function DynamicPropertyContainer(){}function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}function setLocation(rr){setLocationHref(rr)}function searchAnimations(){standalone===!0?animationManager.searchAnimations(animationData,standalone,renderer$1):animationManager.searchAnimations()}function setSubframeRendering(rr){setSubframeEnabled(rr)}function setPrefix(rr){setIdPrefix(rr)}function loadAnimation(rr){return standalone===!0&&(rr.animationData=JSON.parse(animationData)),animationManager.loadAnimation(rr)}function setQuality(rr){if(typeof rr=="string")switch(rr){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(rr)&&rr>1&&setDefaultCurveSegments(rr);getDefaultCurveSegments()>=50?roundValues(!1):roundValues(!0)}function inBrowser(){return typeof navigator<"u"}function installPlugin(rr,er){rr==="expressions"&&setExpressionsPlugin(er)}function getFactory(rr){switch(rr){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(rr){for(var er=queryString.split("&"),tr=0;tr<er.length;tr+=1){var ir=er[tr].split("=");if(decodeURIComponent(ir[0])==rr)return decodeURIComponent(ir[1])}return null}function ShapeModifier(){}function TrimModifier(){}function PuckerAndBloatModifier(){}function RepeaterModifier(){}function RoundCornersModifier(){}function getFontProperties(rr){for(var er=rr.fStyle?rr.fStyle.split(" "):[],tr="normal",ir="normal",nr=er.length,sr,ar=0;ar<nr;ar+=1)switch(sr=er[ar].toLowerCase(),sr){case"italic":ir="italic";break;case"bold":tr="700";break;case"black":tr="900";break;case"medium":tr="500";break;case"regular":case"normal":tr="400";break;case"light":case"thin":tr="200";break;default:break}return{style:ir,weight:rr.fWeight||tr}}function RenderableElement(){}function SliderEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,0,0,tr)}function AngleEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,0,0,tr)}function ColorEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,1,0,tr)}function PointEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,1,0,tr)}function LayerIndexEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,0,0,tr)}function MaskIndexEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,0,0,tr)}function CheckboxEffect(rr,er,tr){this.p=PropertyFactory.getProp(er,rr.v,0,0,tr)}function NoValueEffect(){this.p={}}function EffectsManager(rr,er){var tr=rr.ef||[];this.effectElements=[];var ir,nr=tr.length,sr;for(ir=0;ir<nr;ir+=1)sr=new GroupEffect(tr[ir],er),this.effectElements.push(sr)}function GroupEffect(rr,er){this.init(rr,er)}function BaseElement(){}function FrameElement(){}function FootageElement(rr,er,tr){this.initFrame(),this.initRenderable(),this.assetData=er.getAssetData(rr.refId),this.footageData=er.imageLoader.getAsset(this.assetData),this.initBaseData(rr,er,tr)}function AudioElement(rr,er,tr){this.initFrame(),this.initRenderable(),this.assetData=er.getAssetData(rr.refId),this.initBaseData(rr,er,tr),this._isPlaying=!1,this._canPlay=!1;var ir=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(ir),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=rr.tm?PropertyFactory.getProp(this,rr.tm,0,er.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,rr.au&&rr.au.lv?rr.au.lv:{k:[100]},1,.01,this)}function BaseRenderer(){}function TransformElement(){}function MaskElement(rr,er,tr){this.data=rr,this.element=er,this.globalData=tr,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var ir=this.globalData.defs,nr,sr=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(sr),this.solidPath="";var ar,or=this.masksProperties,lr=0,cr=[],ur,dr,hr=createElementID(),pr,gr,vr,mr,fr="clipPath",_r="clip-path";for(nr=0;nr<sr;nr+=1)if((or[nr].mode!=="a"&&or[nr].mode!=="n"||or[nr].inv||or[nr].o.k!==100||or[nr].o.x)&&(fr="mask",_r="mask"),(or[nr].mode==="s"||or[nr].mode==="i")&&lr===0?(pr=createNS("rect"),pr.setAttribute("fill","#ffffff"),pr.setAttribute("width",this.element.comp.data.w||0),pr.setAttribute("height",this.element.comp.data.h||0),cr.push(pr)):pr=null,ar=createNS("path"),or[nr].mode==="n")this.viewData[nr]={op:PropertyFactory.getProp(this.element,or[nr].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,or[nr],3),elem:ar,lastPath:""},ir.appendChild(ar);else{lr+=1,ar.setAttribute("fill",or[nr].mode==="s"?"#000000":"#ffffff"),ar.setAttribute("clip-rule","nonzero");var Ar;if(or[nr].x.k!==0?(fr="mask",_r="mask",mr=PropertyFactory.getProp(this.element,or[nr].x,0,null,this.element),Ar=createElementID(),gr=createNS("filter"),gr.setAttribute("id",Ar),vr=createNS("feMorphology"),vr.setAttribute("operator","erode"),vr.setAttribute("in","SourceGraphic"),vr.setAttribute("radius","0"),gr.appendChild(vr),ir.appendChild(gr),ar.setAttribute("stroke",or[nr].mode==="s"?"#000000":"#ffffff")):(vr=null,mr=null),this.storedData[nr]={elem:ar,x:mr,expan:vr,lastPath:"",lastOperator:"",filterId:Ar,lastRadius:0},or[nr].mode==="i"){dr=cr.length;var yr=createNS("g");for(ur=0;ur<dr;ur+=1)yr.appendChild(cr[ur]);var wr=createNS("mask");wr.setAttribute("mask-type","alpha"),wr.setAttribute("id",hr+"_"+lr),wr.appendChild(ar),ir.appendChild(wr),yr.setAttribute("mask","url("+getLocationHref()+"#"+hr+"_"+lr+")"),cr.length=0,cr.push(yr)}else cr.push(ar);or[nr].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[nr]={elem:ar,lastPath:"",op:PropertyFactory.getProp(this.element,or[nr].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,or[nr],3),invRect:pr},this.viewData[nr].prop.k||this.drawPath(or[nr],this.viewData[nr].prop.v,this.viewData[nr])}for(this.maskElement=createNS(fr),sr=cr.length,nr=0;nr<sr;nr+=1)this.maskElement.appendChild(cr[nr]);lr>0&&(this.maskElement.setAttribute("id",hr),this.element.maskedElement.setAttribute(_r,"url("+getLocationHref()+"#"+hr+")"),ir.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}function SVGEffects(rr){var er,tr="SourceGraphic",ir=rr.data.ef?rr.data.ef.length:0,nr=createElementID(),sr=filtersFactory.createFilter(nr,!0),ar=0;this.filters=[];var or;for(er=0;er<ir;er+=1){or=null;var lr=rr.data.ef[er].ty;if(registeredEffects[lr]){var cr=registeredEffects[lr].effect;or=new cr(sr,rr.effectsManager.effectElements[er],rr,idPrefix+ar,tr),tr=idPrefix+ar,registeredEffects[lr].countsAsEffect&&(ar+=1)}or&&this.filters.push(or)}ar&&(rr.globalData.defs.appendChild(sr),rr.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+nr+")")),this.filters.length&&rr.addRenderableComponent(this)}function registerEffect(rr,er,tr){registeredEffects[rr]={effect:er,countsAsEffect:tr}}function SVGBaseElement(){}function HierarchyElement(){}function RenderableDOMElement(){}function IImageElement(rr,er,tr){this.assetData=er.getAssetData(rr.refId),this.initElement(rr,er,tr),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}function ProcessedElement(rr,er){this.elem=rr,this.pos=er}function IShapeElement(){}function SVGShapeData(rr,er,tr){this.caches=[],this.styles=[],this.transformers=rr,this.lStr="",this.sh=tr,this.lvl=er,this._isAnimated=!!tr.k;for(var ir=0,nr=rr.length;ir<nr;){if(rr[ir].mProps.dynamicProperties.length){this._isAnimated=!0;break}ir+=1}}function SVGStyleData(rr,er){this.data=rr,this.type=rr.ty,this.d="",this.lvl=er,this._mdf=!1,this.closed=rr.hd===!0,this.pElem=createNS("path"),this.msElem=null}function DashProperty(rr,er,tr,ir){this.elem=rr,this.frameId=-1,this.dataProps=createSizedArray(er.length),this.renderer=tr,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",er.length?er.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(ir);var nr,sr=er.length||0,ar;for(nr=0;nr<sr;nr+=1)ar=PropertyFactory.getProp(rr,er[nr].v,0,0,this),this.k=ar.k||this.k,this.dataProps[nr]={n:er[nr].n,p:ar};this.k||this.getValue(!0),this._isAnimated=this.k}function SVGStrokeStyleData(rr,er,tr){this.initDynamicPropertyContainer(rr),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(rr,er.o,0,.01,this),this.w=PropertyFactory.getProp(rr,er.w,0,null,this),this.d=new DashProperty(rr,er.d||{},"svg",this),this.c=PropertyFactory.getProp(rr,er.c,1,255,this),this.style=tr,this._isAnimated=!!this._isAnimated}function SVGFillStyleData(rr,er,tr){this.initDynamicPropertyContainer(rr),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(rr,er.o,0,.01,this),this.c=PropertyFactory.getProp(rr,er.c,1,255,this),this.style=tr}function SVGNoStyleData(rr,er,tr){this.initDynamicPropertyContainer(rr),this.getValue=this.iterateDynamicProperties,this.style=tr}function GradientProperty(rr,er,tr){this.data=er,this.c=createTypedArray("uint8c",er.p*4);var ir=er.k.k[0].s?er.k.k[0].s.length-er.p*4:er.k.k.length-er.p*4;this.o=createTypedArray("float32",ir),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=ir,this.initDynamicPropertyContainer(tr),this.prop=PropertyFactory.getProp(rr,er.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}function SVGGradientFillStyleData(rr,er,tr){this.initDynamicPropertyContainer(rr),this.getValue=this.iterateDynamicProperties,this.initGradientData(rr,er,tr)}function SVGGradientStrokeStyleData(rr,er,tr){this.initDynamicPropertyContainer(rr),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(rr,er.w,0,null,this),this.d=new DashProperty(rr,er.d||{},"svg",this),this.initGradientData(rr,er,tr),this._isAnimated=!!this._isAnimated}function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(rr,er,tr){this.transform={mProps:rr,op:er,container:tr},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}function SVGShapeElement(rr,er,tr){this.shapes=[],this.shapesData=rr.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(rr,er,tr),this.prevViewData=[]}function LetterProps(rr,er,tr,ir,nr,sr){this.o=rr,this.sw=er,this.sc=tr,this.fc=ir,this.m=nr,this.p=sr,this._mdf={o:!0,sw:!!er,sc:!!tr,fc:!!ir,m:!0,p:!0}}function TextProperty(rr,er){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,this.data=er,this.elem=rr,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}function TextAnimatorDataProperty(rr,er,tr){var ir={propType:!1},nr=PropertyFactory.getProp,sr=er.a;this.a={r:sr.r?nr(rr,sr.r,0,degToRads,tr):ir,rx:sr.rx?nr(rr,sr.rx,0,degToRads,tr):ir,ry:sr.ry?nr(rr,sr.ry,0,degToRads,tr):ir,sk:sr.sk?nr(rr,sr.sk,0,degToRads,tr):ir,sa:sr.sa?nr(rr,sr.sa,0,degToRads,tr):ir,s:sr.s?nr(rr,sr.s,1,.01,tr):ir,a:sr.a?nr(rr,sr.a,1,0,tr):ir,o:sr.o?nr(rr,sr.o,0,.01,tr):ir,p:sr.p?nr(rr,sr.p,1,0,tr):ir,sw:sr.sw?nr(rr,sr.sw,0,0,tr):ir,sc:sr.sc?nr(rr,sr.sc,1,0,tr):ir,fc:sr.fc?nr(rr,sr.fc,1,0,tr):ir,fh:sr.fh?nr(rr,sr.fh,0,0,tr):ir,fs:sr.fs?nr(rr,sr.fs,0,.01,tr):ir,fb:sr.fb?nr(rr,sr.fb,0,.01,tr):ir,t:sr.t?nr(rr,sr.t,0,0,tr):ir},this.s=TextSelectorProp.getTextSelectorProp(rr,er.s,tr),this.s.t=er.s.t}function TextAnimatorProperty(rr,er,tr){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=rr,this._renderType=er,this._elem=tr,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(tr)}function ITextElement(){}function SVGTextLottieElement(rr,er,tr){this.textSpans=[],this.renderType="svg",this.initElement(rr,er,tr)}function ISolidElement(rr,er,tr){this.initElement(rr,er,tr)}function NullElement(rr,er,tr){this.initFrame(),this.initBaseData(rr,er,tr),this.initFrame(),this.initTransform(rr,er,tr),this.initHierarchy()}function SVGRendererBase(){}function ICompElement(){}function SVGCompElement(rr,er,tr){this.layers=rr.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(rr,er,tr),this.tm=rr.tm?PropertyFactory.getProp(this,rr.tm,0,er.frameRate,this):{_placeholder:!0}}function SVGRenderer(rr,er){this.animationItem=rr,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var tr="";if(er&&er.title){var ir=createNS("title"),nr=createElementID();ir.setAttribute("id",nr),ir.textContent=er.title,this.svgElement.appendChild(ir),tr+=nr}if(er&&er.description){var sr=createNS("desc"),ar=createElementID();sr.setAttribute("id",ar),sr.textContent=er.description,this.svgElement.appendChild(sr),tr+=" "+ar}tr&&this.svgElement.setAttribute("aria-labelledby",tr);var or=createNS("defs");this.svgElement.appendChild(or);var lr=createNS("g");this.svgElement.appendChild(lr),this.layerElement=lr,this.renderConfig={preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",progressiveLoad:er&&er.progressiveLoad||!1,hideOnTransparent:!(er&&er.hideOnTransparent===!1),viewBoxOnly:er&&er.viewBoxOnly||!1,viewBoxSize:er&&er.viewBoxSize||!1,className:er&&er.className||"",id:er&&er.id||"",focusable:er&&er.focusable,filterSize:{width:er&&er.filterSize&&er.filterSize.width||"100%",height:er&&er.filterSize&&er.filterSize.height||"100%",x:er&&er.filterSize&&er.filterSize.x||"0%",y:er&&er.filterSize&&er.filterSize.y||"0%"},width:er&&er.width,height:er&&er.height},this.globalData={_mdf:!1,frameNum:-1,defs:or,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}function CVContextData(){this.saved=[],this.cArrPos=0,this.cTr=new Matrix,this.cO=1;var rr,er=15;for(this.savedOp=createTypedArray("float32",er),rr=0;rr<er;rr+=1)this.saved[rr]=createTypedArray("float32",16);this._length=er}function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}function CVEffects(){}function CVMaskElement(rr,er){this.data=rr,this.element=er,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var tr,ir=this.masksProperties.length,nr=!1;for(tr=0;tr<ir;tr+=1)this.masksProperties[tr].mode!=="n"&&(nr=!0),this.viewData[tr]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[tr],3);this.hasMasks=nr,nr&&this.element.addRenderableComponent(this)}function CVBaseElement(){}function CVShapeData(rr,er,tr,ir){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var nr=4;er.ty==="rc"?nr=5:er.ty==="el"?nr=6:er.ty==="sr"&&(nr=7),this.sh=ShapePropertyFactory.getShapeProp(rr,er,nr,rr);var sr,ar=tr.length,or;for(sr=0;sr<ar;sr+=1)tr[sr].closed||(or={transforms:ir.addTransformSequence(tr[sr].transforms),trNodes:[]},this.styledShapes.push(or),tr[sr].elements.push(or))}function CVShapeElement(rr,er,tr){this.shapes=[],this.shapesData=rr.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(rr,er,tr)}function CVTextElement(rr,er,tr){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(rr,er,tr)}function CVImageElement(rr,er,tr){this.assetData=er.getAssetData(rr.refId),this.img=er.imageLoader.getAsset(this.assetData),this.initElement(rr,er,tr)}function CVSolidElement(rr,er,tr){this.initElement(rr,er,tr)}function CanvasRendererBase(rr,er){this.animationItem=rr,this.renderConfig={clearCanvas:er&&er.clearCanvas!==void 0?er.clearCanvas:!0,context:er&&er.context||null,progressiveLoad:er&&er.progressiveLoad||!1,preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",className:er&&er.className||"",id:er&&er.id||""},this.renderConfig.dpr=er&&er.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=er&&er.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas"}function CVCompElement(rr,er,tr){this.completeLayers=!1,this.layers=rr.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(rr,er,tr),this.tm=rr.tm?PropertyFactory.getProp(this,rr.tm,0,er.frameRate,this):{_placeholder:!0}}function CanvasRenderer(rr,er){this.animationItem=rr,this.renderConfig={clearCanvas:er&&er.clearCanvas!==void 0?er.clearCanvas:!0,context:er&&er.context||null,progressiveLoad:er&&er.progressiveLoad||!1,preserveAspectRatio:er&&er.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:er&&er.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:er&&er.contentVisibility||"visible",className:er&&er.className||"",id:er&&er.id||""},this.renderConfig.dpr=er&&er.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=er&&er.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas"}function seedRandom(rr,er){var tr=this,ir=256,nr=6,sr=52,ar="random",or=er.pow(ir,nr),lr=er.pow(2,sr),cr=lr*2,ur=ir-1,dr;function hr(Ar,yr,wr){var xr=[];yr=yr===!0?{entropy:!0}:yr||{};var Sr=mr(vr(yr.entropy?[Ar,_r(rr)]:Ar===null?fr():Ar,3),xr),br=new pr(xr),Cr=function(){for(var Ir=br.g(nr),Rr=or,Pr=0;Ir<lr;)Ir=(Ir+Pr)*ir,Rr*=ir,Pr=br.g(1);for(;Ir>=cr;)Ir/=2,Rr/=2,Pr>>>=1;return(Ir+Pr)/Rr};return Cr.int32=function(){return br.g(4)|0},Cr.quick=function(){return br.g(4)/4294967296},Cr.double=Cr,mr(_r(br.S),rr),(yr.pass||wr||function(Ir,Rr,Pr,Dr){return Dr&&(Dr.S&&gr(Dr,br),Ir.state=function(){return gr(br,{})}),Pr?(er[ar]=Ir,Rr):Ir})(Cr,Sr,"global"in yr?yr.global:this==er,yr.state)}er["seed"+ar]=hr;function pr(Ar){var yr,wr=Ar.length,xr=this,Sr=0,br=xr.i=xr.j=0,Cr=xr.S=[];for(wr||(Ar=[wr++]);Sr<ir;)Cr[Sr]=Sr++;for(Sr=0;Sr<ir;Sr++)Cr[Sr]=Cr[br=ur&br+Ar[Sr%wr]+(yr=Cr[Sr])],Cr[br]=yr;xr.g=function(Ir){for(var Rr,Pr=0,Dr=xr.i,Fr=xr.j,Or=xr.S;Ir--;)Rr=Or[Dr=ur&Dr+1],Pr=Pr*ir+Or[ur&(Or[Dr]=Or[Fr=ur&Fr+Rr])+(Or[Fr]=Rr)];return xr.i=Dr,xr.j=Fr,Pr}}function gr(Ar,yr){return yr.i=Ar.i,yr.j=Ar.j,yr.S=Ar.S.slice(),yr}function vr(Ar,yr){var wr=[],xr=typeof Ar,Sr;if(yr&&xr=="object")for(Sr in Ar)try{wr.push(vr(Ar[Sr],yr-1))}catch{}return wr.length?wr:xr=="string"?Ar:Ar+"\0"}function mr(Ar,yr){for(var wr=Ar+"",xr,Sr=0;Sr<wr.length;)yr[ur&Sr]=ur&(xr^=yr[ur&Sr]*19)+wr.charCodeAt(Sr++);return _r(yr)}function fr(){try{if(dr)return _r(dr.randomBytes(ir));var Ar=new Uint8Array(ir);return(tr.crypto||tr.msCrypto).getRandomValues(Ar),_r(Ar)}catch{var yr=tr.navigator,wr=yr&&yr.plugins;return[+new Date,tr,wr,tr.screen,_r(rr)]}}function _r(Ar){return String.fromCharCode.apply(0,Ar)}mr(er.random(),rr)}function initialize$2(rr){seedRandom([],rr)}function addPropertyDecorator(){function rr(hr,pr,gr){if(!this.k||!this.keyframes)return this.pv;hr=hr?hr.toLowerCase():"";var vr=this.comp.renderedFrame,mr=this.keyframes,fr=mr[mr.length-1].t;if(vr<=fr)return this.pv;var _r,Ar;gr?(pr?_r=Math.abs(fr-this.elem.comp.globalData.frameRate*pr):_r=Math.max(0,fr-this.elem.data.ip),Ar=fr-_r):((!pr||pr>mr.length-1)&&(pr=mr.length-1),Ar=mr[mr.length-1-pr].t,_r=fr-Ar);var yr,wr,xr;if(hr==="pingpong"){var Sr=Math.floor((vr-Ar)/_r);if(Sr%2!==0)return this.getValueAtTime((_r-(vr-Ar)%_r+Ar)/this.comp.globalData.frameRate,0)}else if(hr==="offset"){var br=this.getValueAtTime(Ar/this.comp.globalData.frameRate,0),Cr=this.getValueAtTime(fr/this.comp.globalData.frameRate,0),Ir=this.getValueAtTime(((vr-Ar)%_r+Ar)/this.comp.globalData.frameRate,0),Rr=Math.floor((vr-Ar)/_r);if(this.pv.length){for(xr=new Array(br.length),wr=xr.length,yr=0;yr<wr;yr+=1)xr[yr]=(Cr[yr]-br[yr])*Rr+Ir[yr];return xr}return(Cr-br)*Rr+Ir}else if(hr==="continue"){var Pr=this.getValueAtTime(fr/this.comp.globalData.frameRate,0),Dr=this.getValueAtTime((fr-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(xr=new Array(Pr.length),wr=xr.length,yr=0;yr<wr;yr+=1)xr[yr]=Pr[yr]+(Pr[yr]-Dr[yr])*((vr-fr)/this.comp.globalData.frameRate)/5e-4;return xr}return Pr+(Pr-Dr)*((vr-fr)/.001)}return this.getValueAtTime(((vr-Ar)%_r+Ar)/this.comp.globalData.frameRate,0)}function er(hr,pr,gr){if(!this.k)return this.pv;hr=hr?hr.toLowerCase():"";var vr=this.comp.renderedFrame,mr=this.keyframes,fr=mr[0].t;if(vr>=fr)return this.pv;var _r,Ar;gr?(pr?_r=Math.abs(this.elem.comp.globalData.frameRate*pr):_r=Math.max(0,this.elem.data.op-fr),Ar=fr+_r):((!pr||pr>mr.length-1)&&(pr=mr.length-1),Ar=mr[pr].t,_r=Ar-fr);var yr,wr,xr;if(hr==="pingpong"){var Sr=Math.floor((fr-vr)/_r);if(Sr%2===0)return this.getValueAtTime(((fr-vr)%_r+fr)/this.comp.globalData.frameRate,0)}else if(hr==="offset"){var br=this.getValueAtTime(fr/this.comp.globalData.frameRate,0),Cr=this.getValueAtTime(Ar/this.comp.globalData.frameRate,0),Ir=this.getValueAtTime((_r-(fr-vr)%_r+fr)/this.comp.globalData.frameRate,0),Rr=Math.floor((fr-vr)/_r)+1;if(this.pv.length){for(xr=new Array(br.length),wr=xr.length,yr=0;yr<wr;yr+=1)xr[yr]=Ir[yr]-(Cr[yr]-br[yr])*Rr;return xr}return Ir-(Cr-br)*Rr}else if(hr==="continue"){var Pr=this.getValueAtTime(fr/this.comp.globalData.frameRate,0),Dr=this.getValueAtTime((fr+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(xr=new Array(Pr.length),wr=xr.length,yr=0;yr<wr;yr+=1)xr[yr]=Pr[yr]+(Pr[yr]-Dr[yr])*(fr-vr)/.001;return xr}return Pr+(Pr-Dr)*(fr-vr)/.001}return this.getValueAtTime((_r-((fr-vr)%_r+fr))/this.comp.globalData.frameRate,0)}function tr(hr,pr){if(!this.k)return this.pv;if(hr=(hr||.4)*.5,pr=Math.floor(pr||5),pr<=1)return this.pv;var gr=this.comp.renderedFrame/this.comp.globalData.frameRate,vr=gr-hr,mr=gr+hr,fr=pr>1?(mr-vr)/(pr-1):1,_r=0,Ar=0,yr;this.pv.length?yr=createTypedArray("float32",this.pv.length):yr=0;for(var wr;_r<pr;){if(wr=this.getValueAtTime(vr+_r*fr),this.pv.length)for(Ar=0;Ar<this.pv.length;Ar+=1)yr[Ar]+=wr[Ar];else yr+=wr;_r+=1}if(this.pv.length)for(Ar=0;Ar<this.pv.length;Ar+=1)yr[Ar]/=pr;else yr/=pr;return yr}function ir(hr){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var pr=this._transformCachingAtTime.v;if(pr.cloneFromProps(this.pre.props),this.appliedTransformations<1){var gr=this.a.getValueAtTime(hr);pr.translate(-gr[0]*this.a.mult,-gr[1]*this.a.mult,gr[2]*this.a.mult)}if(this.appliedTransformations<2){var vr=this.s.getValueAtTime(hr);pr.scale(vr[0]*this.s.mult,vr[1]*this.s.mult,vr[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var mr=this.sk.getValueAtTime(hr),fr=this.sa.getValueAtTime(hr);pr.skewFromAxis(-mr*this.sk.mult,fr*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var _r=this.r.getValueAtTime(hr);pr.rotate(-_r*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Ar=this.rz.getValueAtTime(hr),yr=this.ry.getValueAtTime(hr),wr=this.rx.getValueAtTime(hr),xr=this.or.getValueAtTime(hr);pr.rotateZ(-Ar*this.rz.mult).rotateY(yr*this.ry.mult).rotateX(wr*this.rx.mult).rotateZ(-xr[2]*this.or.mult).rotateY(xr[1]*this.or.mult).rotateX(xr[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var Sr=this.px.getValueAtTime(hr),br=this.py.getValueAtTime(hr);if(this.data.p.z){var Cr=this.pz.getValueAtTime(hr);pr.translate(Sr*this.px.mult,br*this.py.mult,-Cr*this.pz.mult)}else pr.translate(Sr*this.px.mult,br*this.py.mult,0)}else{var Ir=this.p.getValueAtTime(hr);pr.translate(Ir[0]*this.p.mult,Ir[1]*this.p.mult,-Ir[2]*this.p.mult)}return pr}function nr(){return this.v.clone(new Matrix)}var sr=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(hr,pr,gr){var vr=sr(hr,pr,gr);return vr.dynamicProperties.length?vr.getValueAtTime=ir.bind(vr):vr.getValueAtTime=nr.bind(vr),vr.setGroupProperty=expressionHelpers.setGroupProperty,vr};var ar=PropertyFactory.getProp;PropertyFactory.getProp=function(hr,pr,gr,vr,mr){var fr=ar(hr,pr,gr,vr,mr);fr.kf?fr.getValueAtTime=expressionHelpers.getValueAtTime.bind(fr):fr.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(fr),fr.setGroupProperty=expressionHelpers.setGroupProperty,fr.loopOut=rr,fr.loopIn=er,fr.smooth=tr,fr.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(fr),fr.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(fr),fr.numKeys=pr.a===1?pr.k.length:0,fr.propertyIndex=pr.ix;var _r=0;return gr!==0&&(_r=createTypedArray("float32",pr.a===1?pr.k[0].s.length:pr.k.length)),fr._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:_r},expressionHelpers.searchExpressions(hr,pr,fr),fr.k&&mr.addDynamicProperty(fr),fr};function or(hr){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),hr*=this.elem.globalData.frameRate,hr-=this.offsetTime,hr!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<hr?this._caching.lastIndex:0,this._cachingAtTime.lastTime=hr,this.interpolateShape(hr,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var lr=ShapePropertyFactory.getConstructorFunction(),cr=ShapePropertyFactory.getKeyframedConstructorFunction();function ur(){}ur.prototype={vertices:function(hr,pr){this.k&&this.getValue();var gr=this.v;pr!==void 0&&(gr=this.getValueAtTime(pr,0));var vr,mr=gr._length,fr=gr[hr],_r=gr.v,Ar=createSizedArray(mr);for(vr=0;vr<mr;vr+=1)hr==="i"||hr==="o"?Ar[vr]=[fr[vr][0]-_r[vr][0],fr[vr][1]-_r[vr][1]]:Ar[vr]=[fr[vr][0],fr[vr][1]];return Ar},points:function(hr){return this.vertices("v",hr)},inTangents:function(hr){return this.vertices("i",hr)},outTangents:function(hr){return this.vertices("o",hr)},isClosed:function(){return this.v.c},pointOnPath:function(hr,pr){var gr=this.v;pr!==void 0&&(gr=this.getValueAtTime(pr,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(gr));for(var vr=this._segmentsLength,mr=vr.lengths,fr=vr.totalLength*hr,_r=0,Ar=mr.length,yr=0,wr;_r<Ar;){if(yr+mr[_r].addedLength>fr){var xr=_r,Sr=gr.c&&_r===Ar-1?0:_r+1,br=(fr-yr)/mr[_r].addedLength;wr=bez.getPointInSegment(gr.v[xr],gr.v[Sr],gr.o[xr],gr.i[Sr],br,mr[_r]);break}else yr+=mr[_r].addedLength;_r+=1}return wr||(wr=gr.c?[gr.v[0][0],gr.v[0][1]]:[gr.v[gr._length-1][0],gr.v[gr._length-1][1]]),wr},vectorOnPath:function(hr,pr,gr){hr==1?hr=this.v.c:hr==0&&(hr=.999);var vr=this.pointOnPath(hr,pr),mr=this.pointOnPath(hr+.001,pr),fr=mr[0]-vr[0],_r=mr[1]-vr[1],Ar=Math.sqrt(Math.pow(fr,2)+Math.pow(_r,2));if(Ar===0)return[0,0];var yr=gr==="tangent"?[fr/Ar,_r/Ar]:[-_r/Ar,fr/Ar];return yr},tangentOnPath:function(hr,pr){return this.vectorOnPath(hr,pr,"tangent")},normalOnPath:function(hr,pr){return this.vectorOnPath(hr,pr,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([ur],lr),extendPrototype([ur],cr),cr.prototype.getValueAtTime=or,cr.prototype.initiateExpression=ExpressionManager.initiateExpression;var dr=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(hr,pr,gr,vr,mr){var fr=dr(hr,pr,gr,vr,mr);return fr.propertyIndex=pr.ix,fr.lock=!1,gr===3?expressionHelpers.searchExpressions(hr,pr.pt,fr):gr===4&&expressionHelpers.searchExpressions(hr,pr.ks,fr),fr.k&&hr.addDynamicProperty(fr),fr}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function rr(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(er,tr){var ir=this.calculateExpression(tr);if(er.t!==ir){var nr={};return this.copyData(nr,er),nr.t=ir.toString(),nr.__complete=!1,nr}return er},TextProperty.prototype.searchProperty=function(){var er=this.searchKeyframes(),tr=this.searchExpressions();return this.kf=er||tr,this.kf},TextProperty.prototype.searchExpressions=rr}function initialize(){addDecorator()}const svgNS="http://www.w3.org/2000/svg";let locationHref="",_useWebWorker=!1;const initialDefaultFrame=-999999,setWebWorker=rr=>{_useWebWorker=!!rr},getWebWorker=()=>_useWebWorker,setLocationHref=rr=>{locationHref=rr},getLocationHref=()=>locationHref,audioControllerFactory=function(){function rr(er){this.audios=[],this.audioFactory=er,this._volume=1,this._isMuted=!1}return rr.prototype={addAudio:function(er){this.audios.push(er)},pause:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].pause()},resume:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].resume()},setRate:function(er){var tr,ir=this.audios.length;for(tr=0;tr<ir;tr+=1)this.audios[tr].setRate(er)},createAudio:function(er){return this.audioFactory?this.audioFactory(er):window.Howl?new window.Howl({src:[er]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(er){this.audioFactory=er},setVolume:function(er){this._volume=er,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var er,tr=this.audios.length;for(er=0;er<tr;er+=1)this.audios[er].volume(this._volume*(this._isMuted?0:1))}},function(){return new rr}}(),createTypedArray=function(){function rr(tr,ir){var nr=0,sr=[],ar;switch(tr){case"int16":case"uint8c":ar=1;break;default:ar=1.1;break}for(nr=0;nr<ir;nr+=1)sr.push(ar);return sr}function er(tr,ir){return tr==="float32"?new Float32Array(ir):tr==="int16"?new Int16Array(ir):tr==="uint8c"?new Uint8ClampedArray(ir):rr(tr,ir)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?er:rr}();let subframeEnabled=!0,expressionsPlugin=null,idPrefix$1="";const isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);let _shouldRoundValues=!1;const bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var rr=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],er,tr=rr.length;for(er=0;er<tr;er+=1)BMMath[rr[er]]=Math[rr[er]]})(),BMMath.random=Math.random,BMMath.abs=function(rr){var er=typeof rr;if(er==="object"&&rr.length){var tr=createSizedArray(rr.length),ir,nr=rr.length;for(ir=0;ir<nr;ir+=1)tr[ir]=Math.abs(rr[ir]);return tr}return Math.abs(rr)};let defaultCurveSegments=150;const degToRads=Math.PI/180,roundCorner=.5519,createElementID=function(){var rr=0;return function(){return rr+=1,idPrefix$1+"__lottie_element_"+rr}}(),rgbToHex=function(){var rr=[],er,tr;for(er=0;er<256;er+=1)tr=er.toString(16),rr[er]=tr.length===1?"0"+tr:tr;return function(ir,nr,sr){return ir<0&&(ir=0),nr<0&&(nr=0),sr<0&&(sr=0),"#"+rr[ir]+rr[nr]+rr[sr]}}(),setSubframeEnabled=rr=>{subframeEnabled=!!rr},getSubframeEnabled=()=>subframeEnabled,setExpressionsPlugin=rr=>{expressionsPlugin=rr},getExpressionsPlugin=()=>expressionsPlugin,setDefaultCurveSegments=rr=>{defaultCurveSegments=rr},getDefaultCurveSegments=()=>defaultCurveSegments,setIdPrefix=rr=>{idPrefix$1=rr},getIdPrefix=()=>idPrefix$1,dataManager=function(){var rr=1,er=[],tr,ir,nr={onmessage:function(){},postMessage:function(hr){tr({data:hr})}},sr={postMessage:function(hr){nr.onmessage({data:hr})}};function ar(hr){if(window.Worker&&window.Blob&&getWebWorker()){var pr=new Blob(["var _workerSelf = self; self.onmessage = ",hr.toString()],{type:"text/javascript"}),gr=URL.createObjectURL(pr);return new Worker(gr)}return tr=hr,nr}function or(){ir||(ir=ar(function(pr){function gr(){function mr(Or,Nr){var Ur,Br,Wr=Or.length,Xr,Yr,Qi,Xi;for(Br=0;Br<Wr;Br+=1)if(Ur=Or[Br],"ks"in Ur&&!Ur.completed){if(Ur.completed=!0,Ur.tt&&(Or[Br-1].td=Ur.tt),Ur.hasMask){var Kr=Ur.masksProperties;for(Yr=Kr.length,Xr=0;Xr<Yr;Xr+=1)if(Kr[Xr].pt.k.i)wr(Kr[Xr].pt.k);else for(Xi=Kr[Xr].pt.k.length,Qi=0;Qi<Xi;Qi+=1)Kr[Xr].pt.k[Qi].s&&wr(Kr[Xr].pt.k[Qi].s[0]),Kr[Xr].pt.k[Qi].e&&wr(Kr[Xr].pt.k[Qi].e[0])}Ur.ty===0?(Ur.layers=Ar(Ur.refId,Nr),mr(Ur.layers,Nr)):Ur.ty===4?yr(Ur.shapes):Ur.ty===5&&Dr(Ur)}}function fr(Or,Nr){if(Or){var Ur=0,Br=Or.length;for(Ur=0;Ur<Br;Ur+=1)Or[Ur].t===1&&(Or[Ur].data.layers=Ar(Or[Ur].data.refId,Nr),mr(Or[Ur].data.layers,Nr))}}function _r(Or,Nr){for(var Ur=0,Br=Nr.length;Ur<Br;){if(Nr[Ur].id===Or)return Nr[Ur];Ur+=1}return null}function Ar(Or,Nr){var Ur=_r(Or,Nr);return Ur?Ur.layers.__used?JSON.parse(JSON.stringify(Ur.layers)):(Ur.layers.__used=!0,Ur.layers):null}function yr(Or){var Nr,Ur=Or.length,Br,Wr;for(Nr=Ur-1;Nr>=0;Nr-=1)if(Or[Nr].ty==="sh")if(Or[Nr].ks.k.i)wr(Or[Nr].ks.k);else for(Wr=Or[Nr].ks.k.length,Br=0;Br<Wr;Br+=1)Or[Nr].ks.k[Br].s&&wr(Or[Nr].ks.k[Br].s[0]),Or[Nr].ks.k[Br].e&&wr(Or[Nr].ks.k[Br].e[0]);else Or[Nr].ty==="gr"&&yr(Or[Nr].it)}function wr(Or){var Nr,Ur=Or.i.length;for(Nr=0;Nr<Ur;Nr+=1)Or.i[Nr][0]+=Or.v[Nr][0],Or.i[Nr][1]+=Or.v[Nr][1],Or.o[Nr][0]+=Or.v[Nr][0],Or.o[Nr][1]+=Or.v[Nr][1]}function xr(Or,Nr){var Ur=Nr?Nr.split("."):[100,100,100];return Or[0]>Ur[0]?!0:Ur[0]>Or[0]?!1:Or[1]>Ur[1]?!0:Ur[1]>Or[1]?!1:Or[2]>Ur[2]?!0:Ur[2]>Or[2]?!1:null}var Sr=function(){var Or=[4,4,14];function Nr(Br){var Wr=Br.t.d;Br.t.d={k:[{s:Wr,t:0}]}}function Ur(Br){var Wr,Xr=Br.length;for(Wr=0;Wr<Xr;Wr+=1)Br[Wr].ty===5&&Nr(Br[Wr])}return function(Br){if(xr(Or,Br.v)&&(Ur(Br.layers),Br.assets)){var Wr,Xr=Br.assets.length;for(Wr=0;Wr<Xr;Wr+=1)Br.assets[Wr].layers&&Ur(Br.assets[Wr].layers)}}}(),br=function(){var Or=[4,7,99];return function(Nr){if(Nr.chars&&!xr(Or,Nr.v)){var Ur,Br=Nr.chars.length;for(Ur=0;Ur<Br;Ur+=1){var Wr=Nr.chars[Ur];Wr.data&&Wr.data.shapes&&(yr(Wr.data.shapes),Wr.data.ip=0,Wr.data.op=99999,Wr.data.st=0,Wr.data.sr=1,Wr.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},Nr.chars[Ur].t||(Wr.data.shapes.push({ty:"no"}),Wr.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Cr=function(){var Or=[5,7,15];function Nr(Br){var Wr=Br.t.p;typeof Wr.a=="number"&&(Wr.a={a:0,k:Wr.a}),typeof Wr.p=="number"&&(Wr.p={a:0,k:Wr.p}),typeof Wr.r=="number"&&(Wr.r={a:0,k:Wr.r})}function Ur(Br){var Wr,Xr=Br.length;for(Wr=0;Wr<Xr;Wr+=1)Br[Wr].ty===5&&Nr(Br[Wr])}return function(Br){if(xr(Or,Br.v)&&(Ur(Br.layers),Br.assets)){var Wr,Xr=Br.assets.length;for(Wr=0;Wr<Xr;Wr+=1)Br.assets[Wr].layers&&Ur(Br.assets[Wr].layers)}}}(),Ir=function(){var Or=[4,1,9];function Nr(Br){var Wr,Xr=Br.length,Yr,Qi;for(Wr=0;Wr<Xr;Wr+=1)if(Br[Wr].ty==="gr")Nr(Br[Wr].it);else if(Br[Wr].ty==="fl"||Br[Wr].ty==="st")if(Br[Wr].c.k&&Br[Wr].c.k[0].i)for(Qi=Br[Wr].c.k.length,Yr=0;Yr<Qi;Yr+=1)Br[Wr].c.k[Yr].s&&(Br[Wr].c.k[Yr].s[0]/=255,Br[Wr].c.k[Yr].s[1]/=255,Br[Wr].c.k[Yr].s[2]/=255,Br[Wr].c.k[Yr].s[3]/=255),Br[Wr].c.k[Yr].e&&(Br[Wr].c.k[Yr].e[0]/=255,Br[Wr].c.k[Yr].e[1]/=255,Br[Wr].c.k[Yr].e[2]/=255,Br[Wr].c.k[Yr].e[3]/=255);else Br[Wr].c.k[0]/=255,Br[Wr].c.k[1]/=255,Br[Wr].c.k[2]/=255,Br[Wr].c.k[3]/=255}function Ur(Br){var Wr,Xr=Br.length;for(Wr=0;Wr<Xr;Wr+=1)Br[Wr].ty===4&&Nr(Br[Wr].shapes)}return function(Br){if(xr(Or,Br.v)&&(Ur(Br.layers),Br.assets)){var Wr,Xr=Br.assets.length;for(Wr=0;Wr<Xr;Wr+=1)Br.assets[Wr].layers&&Ur(Br.assets[Wr].layers)}}}(),Rr=function(){var Or=[4,4,18];function Nr(Br){var Wr,Xr=Br.length,Yr,Qi;for(Wr=Xr-1;Wr>=0;Wr-=1)if(Br[Wr].ty==="sh")if(Br[Wr].ks.k.i)Br[Wr].ks.k.c=Br[Wr].closed;else for(Qi=Br[Wr].ks.k.length,Yr=0;Yr<Qi;Yr+=1)Br[Wr].ks.k[Yr].s&&(Br[Wr].ks.k[Yr].s[0].c=Br[Wr].closed),Br[Wr].ks.k[Yr].e&&(Br[Wr].ks.k[Yr].e[0].c=Br[Wr].closed);else Br[Wr].ty==="gr"&&Nr(Br[Wr].it)}function Ur(Br){var Wr,Xr,Yr=Br.length,Qi,Xi,Kr,$r;for(Xr=0;Xr<Yr;Xr+=1){if(Wr=Br[Xr],Wr.hasMask){var Vr=Wr.masksProperties;for(Xi=Vr.length,Qi=0;Qi<Xi;Qi+=1)if(Vr[Qi].pt.k.i)Vr[Qi].pt.k.c=Vr[Qi].cl;else for($r=Vr[Qi].pt.k.length,Kr=0;Kr<$r;Kr+=1)Vr[Qi].pt.k[Kr].s&&(Vr[Qi].pt.k[Kr].s[0].c=Vr[Qi].cl),Vr[Qi].pt.k[Kr].e&&(Vr[Qi].pt.k[Kr].e[0].c=Vr[Qi].cl)}Wr.ty===4&&Nr(Wr.shapes)}}return function(Br){if(xr(Or,Br.v)&&(Ur(Br.layers),Br.assets)){var Wr,Xr=Br.assets.length;for(Wr=0;Wr<Xr;Wr+=1)Br.assets[Wr].layers&&Ur(Br.assets[Wr].layers)}}}();function Pr(Or){Or.__complete||(Ir(Or),Sr(Or),br(Or),Cr(Or),Rr(Or),mr(Or.layers,Or.assets),fr(Or.chars,Or.assets),Or.__complete=!0)}function Dr(Or){Or.t.a.length===0&&"m"in Or.t.p}var Fr={};return Fr.completeData=Pr,Fr.checkColors=Ir,Fr.checkChars=br,Fr.checkPathProperties=Cr,Fr.checkShapes=Rr,Fr.completeLayers=mr,Fr}if(sr.dataManager||(sr.dataManager=gr()),sr.assetLoader||(sr.assetLoader=function(){function mr(_r){var Ar=_r.getResponseHeader("content-type");return Ar&&_r.responseType==="json"&&Ar.indexOf("json")!==-1||_r.response&&typeof _r.response=="object"?_r.response:_r.response&&typeof _r.response=="string"?JSON.parse(_r.response):_r.responseText?JSON.parse(_r.responseText):null}function fr(_r,Ar,yr,wr){var xr,Sr=new XMLHttpRequest;try{Sr.responseType="json"}catch{}Sr.onreadystatechange=function(){if(Sr.readyState===4)if(Sr.status===200)xr=mr(Sr),yr(xr);else try{xr=mr(Sr),yr(xr)}catch(br){wr&&wr(br)}};try{Sr.open("GET",_r,!0)}catch{Sr.open("GET",Ar+"/"+_r,!0)}Sr.send()}return{load:fr}}()),pr.data.type==="loadAnimation")sr.assetLoader.load(pr.data.path,pr.data.fullPath,function(mr){sr.dataManager.completeData(mr),sr.postMessage({id:pr.data.id,payload:mr,status:"success"})},function(){sr.postMessage({id:pr.data.id,status:"error"})});else if(pr.data.type==="complete"){var vr=pr.data.animation;sr.dataManager.completeData(vr),sr.postMessage({id:pr.data.id,payload:vr,status:"success"})}else pr.data.type==="loadData"&&sr.assetLoader.load(pr.data.path,pr.data.fullPath,function(mr){sr.postMessage({id:pr.data.id,payload:mr,status:"success"})},function(){sr.postMessage({id:pr.data.id,status:"error"})})}),ir.onmessage=function(hr){var pr=hr.data,gr=pr.id,vr=er[gr];er[gr]=null,pr.status==="success"?vr.onComplete(pr.payload):vr.onError&&vr.onError()})}function lr(hr,pr){rr+=1;var gr="processId_"+rr;return er[gr]={onComplete:hr,onError:pr},gr}function cr(hr,pr,gr){or();var vr=lr(pr,gr);ir.postMessage({type:"loadAnimation",path:hr,fullPath:window.location.origin+window.location.pathname,id:vr})}function ur(hr,pr,gr){or();var vr=lr(pr,gr);ir.postMessage({type:"loadData",path:hr,fullPath:window.location.origin+window.location.pathname,id:vr})}function dr(hr,pr,gr){or();var vr=lr(pr,gr);ir.postMessage({type:"complete",animation:hr,id:vr})}return{loadAnimation:cr,loadData:ur,completeAnimation:dr}}(),ImagePreloader=function(){var rr=function(){var fr=createTag("canvas");fr.width=1,fr.height=1;var _r=fr.getContext("2d");return _r.fillStyle="rgba(0,0,0,0)",_r.fillRect(0,0,1,1),fr}();function er(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function tr(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function ir(fr,_r,Ar){var yr="";if(fr.e)yr=fr.p;else if(_r){var wr=fr.p;wr.indexOf("images/")!==-1&&(wr=wr.split("/")[1]),yr=_r+wr}else yr=Ar,yr+=fr.u?fr.u:"",yr+=fr.p;return yr}function nr(fr){var _r=0,Ar=setInterval(function(){var yr=fr.getBBox();(yr.width||_r>500)&&(this._imageLoaded(),clearInterval(Ar)),_r+=1}.bind(this),50)}function sr(fr){var _r=ir(fr,this.assetsPath,this.path),Ar=createNS("image");isSafari?this.testImageLoaded(Ar):Ar.addEventListener("load",this._imageLoaded,!1),Ar.addEventListener("error",function(){yr.img=rr,this._imageLoaded()}.bind(this),!1),Ar.setAttributeNS("http://www.w3.org/1999/xlink","href",_r),this._elementHelper.append?this._elementHelper.append(Ar):this._elementHelper.appendChild(Ar);var yr={img:Ar,assetData:fr};return yr}function ar(fr){var _r=ir(fr,this.assetsPath,this.path),Ar=createTag("img");Ar.crossOrigin="anonymous",Ar.addEventListener("load",this._imageLoaded,!1),Ar.addEventListener("error",function(){yr.img=rr,this._imageLoaded()}.bind(this),!1),Ar.src=_r;var yr={img:Ar,assetData:fr};return yr}function or(fr){var _r={assetData:fr},Ar=ir(fr,this.assetsPath,this.path);return dataManager.loadData(Ar,function(yr){_r.img=yr,this._footageLoaded()}.bind(this),function(){_r.img={},this._footageLoaded()}.bind(this)),_r}function lr(fr,_r){this.imagesLoadedCb=_r;var Ar,yr=fr.length;for(Ar=0;Ar<yr;Ar+=1)fr[Ar].layers||(!fr[Ar].t||fr[Ar].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(fr[Ar]))):fr[Ar].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(fr[Ar]))))}function cr(fr){this.path=fr||""}function ur(fr){this.assetsPath=fr||""}function dr(fr){for(var _r=0,Ar=this.images.length;_r<Ar;){if(this.images[_r].assetData===fr)return this.images[_r].img;_r+=1}return null}function hr(){this.imagesLoadedCb=null,this.images.length=0}function pr(){return this.totalImages===this.loadedAssets}function gr(){return this.totalFootages===this.loadedFootagesCount}function vr(fr,_r){fr==="svg"?(this._elementHelper=_r,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function mr(){this._imageLoaded=er.bind(this),this._footageLoaded=tr.bind(this),this.testImageLoaded=nr.bind(this),this.createFootageData=or.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return mr.prototype={loadAssets:lr,setAssetsPath:ur,setPath:cr,loadedImages:pr,loadedFootages:gr,destroy:hr,getAsset:dr,createImgData:ar,createImageData:sr,imageLoaded:er,footageLoaded:tr,setCacheType:vr},mr}();BaseEvent.prototype={triggerEvent:function(rr,er){if(this._cbs[rr])for(var tr=this._cbs[rr],ir=0;ir<tr.length;ir+=1)tr[ir](er)},addEventListener:function(rr,er){return this._cbs[rr]||(this._cbs[rr]=[]),this._cbs[rr].push(er),function(){this.removeEventListener(rr,er)}.bind(this)},removeEventListener:function(rr,er){if(!er)this._cbs[rr]=null;else if(this._cbs[rr]){for(var tr=0,ir=this._cbs[rr].length;tr<ir;)this._cbs[rr][tr]===er&&(this._cbs[rr].splice(tr,1),tr-=1,ir-=1),tr+=1;this._cbs[rr].length||(this._cbs[rr]=null)}}};const markerParser=function(){function rr(er){for(var tr=er.split(`\r
`),ir={},nr,sr=0,ar=0;ar<tr.length;ar+=1)nr=tr[ar].split(":"),nr.length===2&&(ir[nr[0]]=nr[1].trim(),sr+=1);if(sr===0)throw new Error;return ir}return function(er){for(var tr=[],ir=0;ir<er.length;ir+=1){var nr=er[ir],sr={time:nr.tm,duration:nr.dr};try{sr.payload=JSON.parse(er[ir].cm)}catch{try{sr.payload=rr(er[ir].cm)}catch{sr.payload={name:er[ir].cm}}}tr.push(sr)}return tr}}(),ProjectInterface=function(){function rr(er){this.compositions.push(er)}return function(){function er(tr){for(var ir=0,nr=this.compositions.length;ir<nr;){if(this.compositions[ir].data&&this.compositions[ir].data.nm===tr)return this.compositions[ir].prepareFrame&&this.compositions[ir].data.xt&&this.compositions[ir].prepareFrame(this.currentFrame),this.compositions[ir].compInterface;ir+=1}return null}return er.compositions=[],er.currentFrame=0,er.registerComposition=rr,er}}(),renderers={},registerRenderer=(rr,er)=>{renderers[rr]=er},AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0)};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(rr){(rr.wrapper||rr.container)&&(this.wrapper=rr.wrapper||rr.container);var er="svg";rr.animType?er=rr.animType:rr.renderer&&(er=rr.renderer);const tr=getRenderer(er);this.renderer=new tr(this,rr.rendererSettings),this.imagePreloader.setCacheType(er,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=er,rr.loop===""||rr.loop===null||rr.loop===void 0||rr.loop===!0?this.loop=!0:rr.loop===!1?this.loop=!1:this.loop=parseInt(rr.loop,10),this.autoplay="autoplay"in rr?rr.autoplay:!0,this.name=rr.name?rr.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(rr,"autoloadSegments")?rr.autoloadSegments:!0,this.assetsPath=rr.assetsPath,this.initialSegment=rr.initialSegment,rr.audioFactory&&this.audioController.setAudioFactory(rr.audioFactory),rr.animationData?this.setupAnimation(rr.animationData):rr.path&&(rr.path.lastIndexOf("\\")!==-1?this.path=rr.path.substr(0,rr.path.lastIndexOf("\\")+1):this.path=rr.path.substr(0,rr.path.lastIndexOf("/")+1),this.fileName=rr.path.substr(rr.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(rr.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(rr){dataManager.completeAnimation(rr,this.configAnimation)},AnimationItem.prototype.setData=function(rr,er){er&&typeof er!="object"&&(er=JSON.parse(er));var tr={wrapper:rr,animationData:er},ir=rr.attributes;tr.path=ir.getNamedItem("data-animation-path")?ir.getNamedItem("data-animation-path").value:ir.getNamedItem("data-bm-path")?ir.getNamedItem("data-bm-path").value:ir.getNamedItem("bm-path")?ir.getNamedItem("bm-path").value:"",tr.animType=ir.getNamedItem("data-anim-type")?ir.getNamedItem("data-anim-type").value:ir.getNamedItem("data-bm-type")?ir.getNamedItem("data-bm-type").value:ir.getNamedItem("bm-type")?ir.getNamedItem("bm-type").value:ir.getNamedItem("data-bm-renderer")?ir.getNamedItem("data-bm-renderer").value:ir.getNamedItem("bm-renderer")?ir.getNamedItem("bm-renderer").value:"canvas";var nr=ir.getNamedItem("data-anim-loop")?ir.getNamedItem("data-anim-loop").value:ir.getNamedItem("data-bm-loop")?ir.getNamedItem("data-bm-loop").value:ir.getNamedItem("bm-loop")?ir.getNamedItem("bm-loop").value:"";nr==="false"?tr.loop=!1:nr==="true"?tr.loop=!0:nr!==""&&(tr.loop=parseInt(nr,10));var sr=ir.getNamedItem("data-anim-autoplay")?ir.getNamedItem("data-anim-autoplay").value:ir.getNamedItem("data-bm-autoplay")?ir.getNamedItem("data-bm-autoplay").value:ir.getNamedItem("bm-autoplay")?ir.getNamedItem("bm-autoplay").value:!0;tr.autoplay=sr!=="false",tr.name=ir.getNamedItem("data-name")?ir.getNamedItem("data-name").value:ir.getNamedItem("data-bm-name")?ir.getNamedItem("data-bm-name").value:ir.getNamedItem("bm-name")?ir.getNamedItem("bm-name").value:"";var ar=ir.getNamedItem("data-anim-prerender")?ir.getNamedItem("data-anim-prerender").value:ir.getNamedItem("data-bm-prerender")?ir.getNamedItem("data-bm-prerender").value:ir.getNamedItem("bm-prerender")?ir.getNamedItem("bm-prerender").value:"";ar==="false"&&(tr.prerender=!1),this.setParams(tr)},AnimationItem.prototype.includeLayers=function(rr){rr.op>this.animationData.op&&(this.animationData.op=rr.op,this.totalFrames=Math.floor(rr.op-this.animationData.ip));var er=this.animationData.layers,tr,ir=er.length,nr=rr.layers,sr,ar=nr.length;for(sr=0;sr<ar;sr+=1)for(tr=0;tr<ir;){if(er[tr].id===nr[sr].id){er[tr]=nr[sr];break}tr+=1}if((rr.chars||rr.fonts)&&(this.renderer.globalData.fontManager.addChars(rr.chars),this.renderer.globalData.fontManager.addFonts(rr.fonts,this.renderer.globalData.defs)),rr.assets)for(ir=rr.assets.length,tr=0;tr<ir;tr+=1)this.animationData.assets.push(rr.assets[tr]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(rr){this.animationData=rr;var er=getExpressionsPlugin();er&&er.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var rr=this.animationData.segments;if(!rr||rr.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var er=rr.shift();this.timeCompleted=er.time*this.frameRate;var tr=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(tr,this.includeLayers.bind(this),function(){this.trigger("data_failed")}.bind(this))},AnimationItem.prototype.loadSegments=function(){var rr=this.animationData.segments;rr||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(rr){if(this.renderer)try{this.animationData=rr,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(rr),rr.assets||(rr.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(rr.assets),this.markers=markerParser(rr.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(er){this.triggerConfigError(er)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var rr=getExpressionsPlugin();rr&&rr.initExpressions(this),this.renderer.initItems(),setTimeout(function(){this.trigger("DOMLoaded")}.bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(){this.renderer.updateContainerSize()},AnimationItem.prototype.setSubframe=function(rr){this.isSubframeEnabled=!!rr},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(rr){this.triggerRenderFrameError(rr)}},AnimationItem.prototype.play=function(rr){rr&&this.name!==rr||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_pause"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(rr){rr&&this.name!==rr||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_play"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(rr){rr&&this.name!==rr||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(rr){rr&&this.name!==rr||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(rr){for(var er,tr=0;tr<this.markers.length;tr+=1)if(er=this.markers[tr],er.payload&&er.payload.name===rr)return er;return null},AnimationItem.prototype.goToAndStop=function(rr,er,tr){if(!(tr&&this.name!==tr)){var ir=Number(rr);if(isNaN(ir)){var nr=this.getMarkerData(rr);nr&&this.goToAndStop(nr.time,!0)}else er?this.setCurrentRawFrameValue(rr):this.setCurrentRawFrameValue(rr*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(rr,er,tr){if(!(tr&&this.name!==tr)){var ir=Number(rr);if(isNaN(ir)){var nr=this.getMarkerData(rr);nr&&(nr.duration?this.playSegments([nr.time,nr.time+nr.duration],!0):this.goToAndStop(nr.time,!0))}else this.goToAndStop(ir,er,tr);this.play()}},AnimationItem.prototype.advanceTime=function(rr){if(!(this.isPaused===!0||this.isLoaded===!1)){var er=this.currentRawFrame+rr*this.frameModifier,tr=!1;er>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(er>this.totalFrames?er%this.totalFrames:0)||(tr=!0,er=this.totalFrames-1):er>=this.totalFrames?(this.playCount+=1,this.checkSegments(er%this.totalFrames)||(this.setCurrentRawFrameValue(er%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(er):er<0?this.checkSegments(er%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+er%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(tr=!0,er=0)):this.setCurrentRawFrameValue(er),tr&&(this.setCurrentRawFrameValue(er),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(rr,er){this.playCount=0,rr[1]<rr[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=rr[0]-rr[1],this.timeCompleted=this.totalFrames,this.firstFrame=rr[1],this.setCurrentRawFrameValue(this.totalFrames-.001-er)):rr[1]>rr[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=rr[1]-rr[0],this.timeCompleted=this.totalFrames,this.firstFrame=rr[0],this.setCurrentRawFrameValue(.001+er)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(rr,er){var tr=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<rr?tr=rr:this.currentRawFrame+this.firstFrame>er&&(tr=er-rr)),this.firstFrame=rr,this.totalFrames=er-rr,this.timeCompleted=this.totalFrames,tr!==-1&&this.goToAndStop(tr,!0)},AnimationItem.prototype.playSegments=function(rr,er){if(er&&(this.segments.length=0),typeof rr[0]=="object"){var tr,ir=rr.length;for(tr=0;tr<ir;tr+=1)this.segments.push(rr[tr])}else this.segments.push(rr);this.segments.length&&er&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(rr){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),rr&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(rr){return this.segments.length?(this.adjustSegment(this.segments.shift(),rr),!0):!1},AnimationItem.prototype.destroy=function(rr){rr&&this.name!==rr||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.renderer=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(rr){this.currentRawFrame=rr,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(rr){this.playSpeed=rr,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(rr){this.playDirection=rr<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setVolume=function(rr,er){er&&this.name!==er||this.audioController.setVolume(rr)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(rr){rr&&this.name!==rr||this.audioController.mute()},AnimationItem.prototype.unmute=function(rr){rr&&this.name!==rr||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(rr){var er="";if(rr.e)er=rr.p;else if(this.assetsPath){var tr=rr.p;tr.indexOf("images/")!==-1&&(tr=tr.split("/")[1]),er=this.assetsPath+tr}else er=this.path,er+=rr.u?rr.u:"",er+=rr.p;return er},AnimationItem.prototype.getAssetData=function(rr){for(var er=0,tr=this.assets.length;er<tr;){if(rr===this.assets[er].id)return this.assets[er];er+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(rr){return rr?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(rr,er,tr){try{var ir=this.renderer.getElementByPath(rr);ir.updateDocumentData(er,tr)}catch{}},AnimationItem.prototype.trigger=function(rr){if(this._cbs&&this._cbs[rr])switch(rr){case"enterFrame":this.triggerEvent(rr,new BMEnterFrameEvent(rr,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(rr,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(rr,new BMCompleteLoopEvent(rr,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(rr,new BMCompleteEvent(rr,this.frameMult));break;case"segmentStart":this.triggerEvent(rr,new BMSegmentStartEvent(rr,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(rr,new BMDestroyEvent(rr,this));break;default:this.triggerEvent(rr)}rr==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(rr,this.currentFrame,this.totalFrames,this.frameMult)),rr==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(rr,this.loop,this.playCount,this.frameMult)),rr==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(rr,this.frameMult)),rr==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(rr,this.firstFrame,this.totalFrames)),rr==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(rr,this))},AnimationItem.prototype.triggerRenderFrameError=function(rr){var er=new BMRenderFrameErrorEvent(rr,this.currentFrame);this.triggerEvent("error",er),this.onError&&this.onError.call(this,er)},AnimationItem.prototype.triggerConfigError=function(rr){var er=new BMConfigErrorEvent(rr,this.currentFrame);this.triggerEvent("error",er),this.onError&&this.onError.call(this,er)};const animationManager=function(){var rr={},er=[],tr=0,ir=0,nr=0,sr=!0,ar=!1;function or(Nr){for(var Ur=0,Br=Nr.target;Ur<ir;)er[Ur].animation===Br&&(er.splice(Ur,1),Ur-=1,ir-=1,Br.isPaused||dr()),Ur+=1}function lr(Nr,Ur){if(!Nr)return null;for(var Br=0;Br<ir;){if(er[Br].elem===Nr&&er[Br].elem!==null)return er[Br].animation;Br+=1}var Wr=new AnimationItem;return hr(Wr,Nr),Wr.setData(Nr,Ur),Wr}function cr(){var Nr,Ur=er.length,Br=[];for(Nr=0;Nr<Ur;Nr+=1)Br.push(er[Nr].animation);return Br}function ur(){nr+=1,Ir()}function dr(){nr-=1}function hr(Nr,Ur){Nr.addEventListener("destroy",or),Nr.addEventListener("_active",ur),Nr.addEventListener("_idle",dr),er.push({elem:Ur,animation:Nr}),ir+=1}function pr(Nr){var Ur=new AnimationItem;return hr(Ur,null),Ur.setParams(Nr),Ur}function gr(Nr,Ur){var Br;for(Br=0;Br<ir;Br+=1)er[Br].animation.setSpeed(Nr,Ur)}function vr(Nr,Ur){var Br;for(Br=0;Br<ir;Br+=1)er[Br].animation.setDirection(Nr,Ur)}function mr(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.play(Nr)}function fr(Nr){var Ur=Nr-tr,Br;for(Br=0;Br<ir;Br+=1)er[Br].animation.advanceTime(Ur);tr=Nr,nr&&!ar?window.requestAnimationFrame(fr):sr=!0}function _r(Nr){tr=Nr,window.requestAnimationFrame(fr)}function Ar(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.pause(Nr)}function yr(Nr,Ur,Br){var Wr;for(Wr=0;Wr<ir;Wr+=1)er[Wr].animation.goToAndStop(Nr,Ur,Br)}function wr(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.stop(Nr)}function xr(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.togglePause(Nr)}function Sr(Nr){var Ur;for(Ur=ir-1;Ur>=0;Ur-=1)er[Ur].animation.destroy(Nr)}function br(Nr,Ur,Br){var Wr=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),Xr,Yr=Wr.length;for(Xr=0;Xr<Yr;Xr+=1)Br&&Wr[Xr].setAttribute("data-bm-type",Br),lr(Wr[Xr],Nr);if(Ur&&Yr===0){Br||(Br="svg");var Qi=document.getElementsByTagName("body")[0];Qi.innerText="";var Xi=createTag("div");Xi.style.width="100%",Xi.style.height="100%",Xi.setAttribute("data-bm-type",Br),Qi.appendChild(Xi),lr(Xi,Nr)}}function Cr(){var Nr;for(Nr=0;Nr<ir;Nr+=1)er[Nr].animation.resize()}function Ir(){!ar&&nr&&sr&&(window.requestAnimationFrame(_r),sr=!1)}function Rr(){ar=!0}function Pr(){ar=!1,Ir()}function Dr(Nr,Ur){var Br;for(Br=0;Br<ir;Br+=1)er[Br].animation.setVolume(Nr,Ur)}function Fr(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.mute(Nr)}function Or(Nr){var Ur;for(Ur=0;Ur<ir;Ur+=1)er[Ur].animation.unmute(Nr)}return rr.registerAnimation=lr,rr.loadAnimation=pr,rr.setSpeed=gr,rr.setDirection=vr,rr.play=mr,rr.pause=Ar,rr.stop=wr,rr.togglePause=xr,rr.searchAnimations=br,rr.resize=Cr,rr.goToAndStop=yr,rr.destroy=Sr,rr.freeze=Rr,rr.unfreeze=Pr,rr.setVolume=Dr,rr.mute=Fr,rr.unmute=Or,rr.getRegisteredAnimations=cr,rr}(),BezierFactory=function(){var rr={};rr.getBezierEasing=tr;var er={};function tr(_r,Ar,yr,wr,xr){var Sr=xr||("bez_"+_r+"_"+Ar+"_"+yr+"_"+wr).replace(/\./g,"p");if(er[Sr])return er[Sr];var br=new fr([_r,Ar,yr,wr]);return er[Sr]=br,br}var ir=4,nr=.001,sr=1e-7,ar=10,or=11,lr=1/(or-1),cr=typeof Float32Array=="function";function ur(_r,Ar){return 1-3*Ar+3*_r}function dr(_r,Ar){return 3*Ar-6*_r}function hr(_r){return 3*_r}function pr(_r,Ar,yr){return((ur(Ar,yr)*_r+dr(Ar,yr))*_r+hr(Ar))*_r}function gr(_r,Ar,yr){return 3*ur(Ar,yr)*_r*_r+2*dr(Ar,yr)*_r+hr(Ar)}function vr(_r,Ar,yr,wr,xr){var Sr,br,Cr=0;do br=Ar+(yr-Ar)/2,Sr=pr(br,wr,xr)-_r,Sr>0?yr=br:Ar=br;while(Math.abs(Sr)>sr&&++Cr<ar);return br}function mr(_r,Ar,yr,wr){for(var xr=0;xr<ir;++xr){var Sr=gr(Ar,yr,wr);if(Sr===0)return Ar;var br=pr(Ar,yr,wr)-_r;Ar-=br/Sr}return Ar}function fr(_r){this._p=_r,this._mSampleValues=cr?new Float32Array(or):new Array(or),this._precomputed=!1,this.get=this.get.bind(this)}return fr.prototype={get:function(_r){var Ar=this._p[0],yr=this._p[1],wr=this._p[2],xr=this._p[3];return this._precomputed||this._precompute(),Ar===yr&&wr===xr?_r:_r===0?0:_r===1?1:pr(this._getTForX(_r),yr,xr)},_precompute:function(){var _r=this._p[0],Ar=this._p[1],yr=this._p[2],wr=this._p[3];this._precomputed=!0,(_r!==Ar||yr!==wr)&&this._calcSampleValues()},_calcSampleValues:function(){for(var _r=this._p[0],Ar=this._p[2],yr=0;yr<or;++yr)this._mSampleValues[yr]=pr(yr*lr,_r,Ar)},_getTForX:function(_r){for(var Ar=this._p[0],yr=this._p[2],wr=this._mSampleValues,xr=0,Sr=1,br=or-1;Sr!==br&&wr[Sr]<=_r;++Sr)xr+=lr;--Sr;var Cr=(_r-wr[Sr])/(wr[Sr+1]-wr[Sr]),Ir=xr+Cr*lr,Rr=gr(Ir,Ar,yr);return Rr>=nr?mr(_r,Ir,Ar,yr):Rr===0?Ir:vr(_r,xr,xr+lr,Ar,yr)}},rr}(),pooling=function(){function rr(er){return er.concat(createSizedArray(er.length))}return{double:rr}}(),poolFactory=function(){return function(rr,er,tr){var ir=0,nr=rr,sr=createSizedArray(nr),ar={newElement:or,release:lr};function or(){var cr;return ir?(ir-=1,cr=sr[ir]):cr=er(),cr}function lr(cr){ir===nr&&(sr=pooling.double(sr),nr*=2),tr&&tr(cr),sr[ir]=cr,ir+=1}return ar}}(),bezierLengthPool=function(){function rr(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,rr)}(),segmentsLengthPool=function(){function rr(){return{lengths:[],totalLength:0}}function er(tr){var ir,nr=tr.lengths.length;for(ir=0;ir<nr;ir+=1)bezierLengthPool.release(tr.lengths[ir]);tr.lengths.length=0}return poolFactory(8,rr,er)}(),bez=bezFunction(),PropertyFactory=function(){var rr=initialDefaultFrame,er=Math.abs;function tr(mr,fr){var _r=this.offsetTime,Ar;this.propType==="multidimensional"&&(Ar=createTypedArray("float32",this.pv.length));for(var yr=fr.lastIndex,wr=yr,xr=this.keyframes.length-1,Sr=!0,br,Cr,Ir;Sr;){if(br=this.keyframes[wr],Cr=this.keyframes[wr+1],wr===xr-1&&mr>=Cr.t-_r){br.h&&(br=Cr),yr=0;break}if(Cr.t-_r>mr){yr=wr;break}wr<xr-1?wr+=1:(yr=0,Sr=!1)}Ir=this.keyframesMetadata[wr]||{};var Rr,Pr,Dr,Fr,Or,Nr,Ur=Cr.t-_r,Br=br.t-_r,Wr;if(br.to){Ir.bezierData||(Ir.bezierData=bez.buildBezierData(br.s,Cr.s||br.e,br.to,br.ti));var Xr=Ir.bezierData;if(mr>=Ur||mr<Br){var Yr=mr>=Ur?Xr.points.length-1:0;for(Pr=Xr.points[Yr].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=Xr.points[Yr].point[Rr]}else{Ir.__fnct?Nr=Ir.__fnct:(Nr=BezierFactory.getBezierEasing(br.o.x,br.o.y,br.i.x,br.i.y,br.n).get,Ir.__fnct=Nr),Dr=Nr((mr-Br)/(Ur-Br));var Qi=Xr.segmentLength*Dr,Xi,Kr=fr.lastFrame<mr&&fr._lastKeyframeIndex===wr?fr._lastAddedLength:0;for(Or=fr.lastFrame<mr&&fr._lastKeyframeIndex===wr?fr._lastPoint:0,Sr=!0,Fr=Xr.points.length;Sr;){if(Kr+=Xr.points[Or].partialLength,Qi===0||Dr===0||Or===Xr.points.length-1){for(Pr=Xr.points[Or].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=Xr.points[Or].point[Rr];break}else if(Qi>=Kr&&Qi<Kr+Xr.points[Or+1].partialLength){for(Xi=(Qi-Kr)/Xr.points[Or+1].partialLength,Pr=Xr.points[Or].point.length,Rr=0;Rr<Pr;Rr+=1)Ar[Rr]=Xr.points[Or].point[Rr]+(Xr.points[Or+1].point[Rr]-Xr.points[Or].point[Rr])*Xi;break}Or<Fr-1?Or+=1:Sr=!1}fr._lastPoint=Or,fr._lastAddedLength=Kr-Xr.points[Or].partialLength,fr._lastKeyframeIndex=wr}}else{var $r,Vr,Gr,qr,ji;if(xr=br.s.length,Wr=Cr.s||br.e,this.sh&&br.h!==1)if(mr>=Ur)Ar[0]=Wr[0],Ar[1]=Wr[1],Ar[2]=Wr[2];else if(mr<=Br)Ar[0]=br.s[0],Ar[1]=br.s[1],Ar[2]=br.s[2];else{var Jr=sr(br.s),Ji=sr(Wr),Ki=(mr-Br)/(Ur-Br);nr(Ar,ir(Jr,Ji,Ki))}else for(wr=0;wr<xr;wr+=1)br.h!==1&&(mr>=Ur?Dr=1:mr<Br?Dr=0:(br.o.x.constructor===Array?(Ir.__fnct||(Ir.__fnct=[]),Ir.__fnct[wr]?Nr=Ir.__fnct[wr]:($r=br.o.x[wr]===void 0?br.o.x[0]:br.o.x[wr],Vr=br.o.y[wr]===void 0?br.o.y[0]:br.o.y[wr],Gr=br.i.x[wr]===void 0?br.i.x[0]:br.i.x[wr],qr=br.i.y[wr]===void 0?br.i.y[0]:br.i.y[wr],Nr=BezierFactory.getBezierEasing($r,Vr,Gr,qr).get,Ir.__fnct[wr]=Nr)):Ir.__fnct?Nr=Ir.__fnct:($r=br.o.x,Vr=br.o.y,Gr=br.i.x,qr=br.i.y,Nr=BezierFactory.getBezierEasing($r,Vr,Gr,qr).get,br.keyframeMetadata=Nr),Dr=Nr((mr-Br)/(Ur-Br)))),Wr=Cr.s||br.e,ji=br.h===1?br.s[wr]:br.s[wr]+(Wr[wr]-br.s[wr])*Dr,this.propType==="multidimensional"?Ar[wr]=ji:Ar=ji}return fr.lastIndex=yr,Ar}function ir(mr,fr,_r){var Ar=[],yr=mr[0],wr=mr[1],xr=mr[2],Sr=mr[3],br=fr[0],Cr=fr[1],Ir=fr[2],Rr=fr[3],Pr,Dr,Fr,Or,Nr;return Dr=yr*br+wr*Cr+xr*Ir+Sr*Rr,Dr<0&&(Dr=-Dr,br=-br,Cr=-Cr,Ir=-Ir,Rr=-Rr),1-Dr>1e-6?(Pr=Math.acos(Dr),Fr=Math.sin(Pr),Or=Math.sin((1-_r)*Pr)/Fr,Nr=Math.sin(_r*Pr)/Fr):(Or=1-_r,Nr=_r),Ar[0]=Or*yr+Nr*br,Ar[1]=Or*wr+Nr*Cr,Ar[2]=Or*xr+Nr*Ir,Ar[3]=Or*Sr+Nr*Rr,Ar}function nr(mr,fr){var _r=fr[0],Ar=fr[1],yr=fr[2],wr=fr[3],xr=Math.atan2(2*Ar*wr-2*_r*yr,1-2*Ar*Ar-2*yr*yr),Sr=Math.asin(2*_r*Ar+2*yr*wr),br=Math.atan2(2*_r*wr-2*Ar*yr,1-2*_r*_r-2*yr*yr);mr[0]=xr/degToRads,mr[1]=Sr/degToRads,mr[2]=br/degToRads}function sr(mr){var fr=mr[0]*degToRads,_r=mr[1]*degToRads,Ar=mr[2]*degToRads,yr=Math.cos(fr/2),wr=Math.cos(_r/2),xr=Math.cos(Ar/2),Sr=Math.sin(fr/2),br=Math.sin(_r/2),Cr=Math.sin(Ar/2),Ir=yr*wr*xr-Sr*br*Cr,Rr=Sr*br*xr+yr*wr*Cr,Pr=Sr*wr*xr+yr*br*Cr,Dr=yr*br*xr-Sr*wr*Cr;return[Rr,Pr,Dr,Ir]}function ar(){var mr=this.comp.renderedFrame-this.offsetTime,fr=this.keyframes[0].t-this.offsetTime,_r=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(mr===this._caching.lastFrame||this._caching.lastFrame!==rr&&(this._caching.lastFrame>=_r&&mr>=_r||this._caching.lastFrame<fr&&mr<fr))){this._caching.lastFrame>=mr&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var Ar=this.interpolateValue(mr,this._caching);this.pv=Ar}return this._caching.lastFrame=mr,this.pv}function or(mr){var fr;if(this.propType==="unidimensional")fr=mr*this.mult,er(this.v-fr)>1e-5&&(this.v=fr,this._mdf=!0);else for(var _r=0,Ar=this.v.length;_r<Ar;)fr=mr[_r]*this.mult,er(this.v[_r]-fr)>1e-5&&(this.v[_r]=fr,this._mdf=!0),_r+=1}function lr(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var mr,fr=this.effectsSequence.length,_r=this.kf?this.pv:this.data.k;for(mr=0;mr<fr;mr+=1)_r=this.effectsSequence[mr](_r);this.setVValue(_r),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function cr(mr){this.effectsSequence.push(mr),this.container.addDynamicProperty(this)}function ur(mr,fr,_r,Ar){this.propType="unidimensional",this.mult=_r||1,this.data=fr,this.v=_r?fr.k*_r:fr.k,this.pv=fr.k,this._mdf=!1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=lr,this.setVValue=or,this.addEffect=cr}function dr(mr,fr,_r,Ar){this.propType="multidimensional",this.mult=_r||1,this.data=fr,this._mdf=!1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.k=!1,this.kf=!1,this.frameId=-1;var yr,wr=fr.k.length;for(this.v=createTypedArray("float32",wr),this.pv=createTypedArray("float32",wr),this.vel=createTypedArray("float32",wr),yr=0;yr<wr;yr+=1)this.v[yr]=fr.k[yr]*this.mult,this.pv[yr]=fr.k[yr];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=lr,this.setVValue=or,this.addEffect=cr}function hr(mr,fr,_r,Ar){this.propType="unidimensional",this.keyframes=fr.k,this.keyframesMetadata=[],this.offsetTime=mr.data.st,this.frameId=-1,this._caching={lastFrame:rr,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=fr,this.mult=_r||1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.v=rr,this.pv=rr,this._isFirstFrame=!0,this.getValue=lr,this.setVValue=or,this.interpolateValue=tr,this.effectsSequence=[ar.bind(this)],this.addEffect=cr}function pr(mr,fr,_r,Ar){this.propType="multidimensional";var yr,wr=fr.k.length,xr,Sr,br,Cr;for(yr=0;yr<wr-1;yr+=1)fr.k[yr].to&&fr.k[yr].s&&fr.k[yr+1]&&fr.k[yr+1].s&&(xr=fr.k[yr].s,Sr=fr.k[yr+1].s,br=fr.k[yr].to,Cr=fr.k[yr].ti,(xr.length===2&&!(xr[0]===Sr[0]&&xr[1]===Sr[1])&&bez.pointOnLine2D(xr[0],xr[1],Sr[0],Sr[1],xr[0]+br[0],xr[1]+br[1])&&bez.pointOnLine2D(xr[0],xr[1],Sr[0],Sr[1],Sr[0]+Cr[0],Sr[1]+Cr[1])||xr.length===3&&!(xr[0]===Sr[0]&&xr[1]===Sr[1]&&xr[2]===Sr[2])&&bez.pointOnLine3D(xr[0],xr[1],xr[2],Sr[0],Sr[1],Sr[2],xr[0]+br[0],xr[1]+br[1],xr[2]+br[2])&&bez.pointOnLine3D(xr[0],xr[1],xr[2],Sr[0],Sr[1],Sr[2],Sr[0]+Cr[0],Sr[1]+Cr[1],Sr[2]+Cr[2]))&&(fr.k[yr].to=null,fr.k[yr].ti=null),xr[0]===Sr[0]&&xr[1]===Sr[1]&&br[0]===0&&br[1]===0&&Cr[0]===0&&Cr[1]===0&&(xr.length===2||xr[2]===Sr[2]&&br[2]===0&&Cr[2]===0)&&(fr.k[yr].to=null,fr.k[yr].ti=null));this.effectsSequence=[ar.bind(this)],this.data=fr,this.keyframes=fr.k,this.keyframesMetadata=[],this.offsetTime=mr.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=_r||1,this.elem=mr,this.container=Ar,this.comp=mr.comp,this.getValue=lr,this.setVValue=or,this.interpolateValue=tr,this.frameId=-1;var Ir=fr.k[0].s.length;for(this.v=createTypedArray("float32",Ir),this.pv=createTypedArray("float32",Ir),yr=0;yr<Ir;yr+=1)this.v[yr]=rr,this.pv[yr]=rr;this._caching={lastFrame:rr,lastIndex:0,value:createTypedArray("float32",Ir)},this.addEffect=cr}function gr(mr,fr,_r,Ar,yr){var wr;if(!fr.k.length)wr=new ur(mr,fr,Ar,yr);else if(typeof fr.k[0]=="number")wr=new dr(mr,fr,Ar,yr);else switch(_r){case 0:wr=new hr(mr,fr,Ar,yr);break;case 1:wr=new pr(mr,fr,Ar,yr);break;default:break}return wr.effectsSequence.length&&yr.addDynamicProperty(wr),wr}var vr={getProp:gr};return vr}();DynamicPropertyContainer.prototype={addDynamicProperty:function(rr){this.dynamicProperties.indexOf(rr)===-1&&(this.dynamicProperties.push(rr),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var rr,er=this.dynamicProperties.length;for(rr=0;rr<er;rr+=1)this.dynamicProperties[rr].getValue(),this.dynamicProperties[rr]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(rr){this.container=rr,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};const pointPool=function(){function rr(){return createTypedArray("float32",2)}return poolFactory(8,rr)}();ShapePath.prototype.setPathData=function(rr,er){this.c=rr,this.setLength(er);for(var tr=0;tr<er;)this.v[tr]=pointPool.newElement(),this.o[tr]=pointPool.newElement(),this.i[tr]=pointPool.newElement(),tr+=1},ShapePath.prototype.setLength=function(rr){for(;this._maxLength<rr;)this.doubleArrayLength();this._length=rr},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(rr,er,tr,ir,nr){var sr;switch(this._length=Math.max(this._length,ir+1),this._length>=this._maxLength&&this.doubleArrayLength(),tr){case"v":sr=this.v;break;case"i":sr=this.i;break;case"o":sr=this.o;break;default:sr=[];break}(!sr[ir]||sr[ir]&&!nr)&&(sr[ir]=pointPool.newElement()),sr[ir][0]=rr,sr[ir][1]=er},ShapePath.prototype.setTripleAt=function(rr,er,tr,ir,nr,sr,ar,or){this.setXYAt(rr,er,"v",ar,or),this.setXYAt(tr,ir,"o",ar,or),this.setXYAt(nr,sr,"i",ar,or)},ShapePath.prototype.reverse=function(){var rr=new ShapePath;rr.setPathData(this.c,this._length);var er=this.v,tr=this.o,ir=this.i,nr=0;this.c&&(rr.setTripleAt(er[0][0],er[0][1],ir[0][0],ir[0][1],tr[0][0],tr[0][1],0,!1),nr=1);var sr=this._length-1,ar=this._length,or;for(or=nr;or<ar;or+=1)rr.setTripleAt(er[sr][0],er[sr][1],ir[sr][0],ir[sr][1],tr[sr][0],tr[sr][1],or,!1),sr-=1;return rr};const shapePool=function(){function rr(){return new ShapePath}function er(nr){var sr=nr._length,ar;for(ar=0;ar<sr;ar+=1)pointPool.release(nr.v[ar]),pointPool.release(nr.i[ar]),pointPool.release(nr.o[ar]),nr.v[ar]=null,nr.i[ar]=null,nr.o[ar]=null;nr._length=0,nr.c=!1}function tr(nr){var sr=ir.newElement(),ar,or=nr._length===void 0?nr.v.length:nr._length;for(sr.setLength(or),sr.c=nr.c,ar=0;ar<or;ar+=1)sr.setTripleAt(nr.v[ar][0],nr.v[ar][1],nr.o[ar][0],nr.o[ar][1],nr.i[ar][0],nr.i[ar][1],ar);return sr}var ir=poolFactory(4,rr,er);return ir.clone=tr,ir}();ShapeCollection.prototype.addShape=function(rr){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=rr,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var rr;for(rr=0;rr<this._length;rr+=1)shapePool.release(this.shapes[rr]);this._length=0};const shapeCollectionPool=function(){var rr={newShapeCollection:nr,release:sr},er=0,tr=4,ir=createSizedArray(tr);function nr(){var ar;return er?(er-=1,ar=ir[er]):ar=new ShapeCollection,ar}function sr(ar){var or,lr=ar._length;for(or=0;or<lr;or+=1)shapePool.release(ar.shapes[or]);ar._length=0,er===tr&&(ir=pooling.double(ir),tr*=2),ir[er]=ar,er+=1}return rr}(),ShapePropertyFactory=function(){var rr=-999999;function er(fr,_r,Ar){var yr=Ar.lastIndex,wr,xr,Sr,br,Cr,Ir,Rr,Pr,Dr,Fr=this.keyframes;if(fr<Fr[0].t-this.offsetTime)wr=Fr[0].s[0],Sr=!0,yr=0;else if(fr>=Fr[Fr.length-1].t-this.offsetTime)wr=Fr[Fr.length-1].s?Fr[Fr.length-1].s[0]:Fr[Fr.length-2].e[0],Sr=!0;else{for(var Or=yr,Nr=Fr.length-1,Ur=!0,Br,Wr,Xr;Ur&&(Br=Fr[Or],Wr=Fr[Or+1],!(Wr.t-this.offsetTime>fr));)Or<Nr-1?Or+=1:Ur=!1;if(Xr=this.keyframesMetadata[Or]||{},Sr=Br.h===1,yr=Or,!Sr){if(fr>=Wr.t-this.offsetTime)Pr=1;else if(fr<Br.t-this.offsetTime)Pr=0;else{var Yr;Xr.__fnct?Yr=Xr.__fnct:(Yr=BezierFactory.getBezierEasing(Br.o.x,Br.o.y,Br.i.x,Br.i.y).get,Xr.__fnct=Yr),Pr=Yr((fr-(Br.t-this.offsetTime))/(Wr.t-this.offsetTime-(Br.t-this.offsetTime)))}xr=Wr.s?Wr.s[0]:Br.e[0]}wr=Br.s[0]}for(Ir=_r._length,Rr=wr.i[0].length,Ar.lastIndex=yr,br=0;br<Ir;br+=1)for(Cr=0;Cr<Rr;Cr+=1)Dr=Sr?wr.i[br][Cr]:wr.i[br][Cr]+(xr.i[br][Cr]-wr.i[br][Cr])*Pr,_r.i[br][Cr]=Dr,Dr=Sr?wr.o[br][Cr]:wr.o[br][Cr]+(xr.o[br][Cr]-wr.o[br][Cr])*Pr,_r.o[br][Cr]=Dr,Dr=Sr?wr.v[br][Cr]:wr.v[br][Cr]+(xr.v[br][Cr]-wr.v[br][Cr])*Pr,_r.v[br][Cr]=Dr}function tr(){var fr=this.comp.renderedFrame-this.offsetTime,_r=this.keyframes[0].t-this.offsetTime,Ar=this.keyframes[this.keyframes.length-1].t-this.offsetTime,yr=this._caching.lastFrame;return yr!==rr&&(yr<_r&&fr<_r||yr>Ar&&fr>Ar)||(this._caching.lastIndex=yr<fr?this._caching.lastIndex:0,this.interpolateShape(fr,this.pv,this._caching)),this._caching.lastFrame=fr,this.pv}function ir(){this.paths=this.localShapeCollection}function nr(fr,_r){if(fr._length!==_r._length||fr.c!==_r.c)return!1;var Ar,yr=fr._length;for(Ar=0;Ar<yr;Ar+=1)if(fr.v[Ar][0]!==_r.v[Ar][0]||fr.v[Ar][1]!==_r.v[Ar][1]||fr.o[Ar][0]!==_r.o[Ar][0]||fr.o[Ar][1]!==_r.o[Ar][1]||fr.i[Ar][0]!==_r.i[Ar][0]||fr.i[Ar][1]!==_r.i[Ar][1])return!1;return!0}function sr(fr){nr(this.v,fr)||(this.v=shapePool.clone(fr),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function ar(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var fr;this.kf?fr=this.pv:this.data.ks?fr=this.data.ks.k:fr=this.data.pt.k;var _r,Ar=this.effectsSequence.length;for(_r=0;_r<Ar;_r+=1)fr=this.effectsSequence[_r](fr);this.setVValue(fr),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function or(fr,_r,Ar){this.propType="shape",this.comp=fr.comp,this.container=fr,this.elem=fr,this.data=_r,this.k=!1,this.kf=!1,this._mdf=!1;var yr=Ar===3?_r.pt.k:_r.ks.k;this.v=shapePool.clone(yr),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=ir,this.effectsSequence=[]}function lr(fr){this.effectsSequence.push(fr),this.container.addDynamicProperty(this)}or.prototype.interpolateShape=er,or.prototype.getValue=ar,or.prototype.setVValue=sr,or.prototype.addEffect=lr;function cr(fr,_r,Ar){this.propType="shape",this.comp=fr.comp,this.elem=fr,this.container=fr,this.offsetTime=fr.data.st,this.keyframes=Ar===3?_r.pt.k:_r.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var yr=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,yr),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=rr,this.reset=ir,this._caching={lastFrame:rr,lastIndex:0},this.effectsSequence=[tr.bind(this)]}cr.prototype.getValue=ar,cr.prototype.interpolateShape=er,cr.prototype.setVValue=sr,cr.prototype.addEffect=lr;var ur=function(){var fr=roundCorner;function _r(Ar,yr){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=yr.d,this.elem=Ar,this.comp=Ar.comp,this.frameId=-1,this.initDynamicPropertyContainer(Ar),this.p=PropertyFactory.getProp(Ar,yr.p,1,0,this),this.s=PropertyFactory.getProp(Ar,yr.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return _r.prototype={reset:ir,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Ar=this.p.v[0],yr=this.p.v[1],wr=this.s.v[0]/2,xr=this.s.v[1]/2,Sr=this.d!==3,br=this.v;br.v[0][0]=Ar,br.v[0][1]=yr-xr,br.v[1][0]=Sr?Ar+wr:Ar-wr,br.v[1][1]=yr,br.v[2][0]=Ar,br.v[2][1]=yr+xr,br.v[3][0]=Sr?Ar-wr:Ar+wr,br.v[3][1]=yr,br.i[0][0]=Sr?Ar-wr*fr:Ar+wr*fr,br.i[0][1]=yr-xr,br.i[1][0]=Sr?Ar+wr:Ar-wr,br.i[1][1]=yr-xr*fr,br.i[2][0]=Sr?Ar+wr*fr:Ar-wr*fr,br.i[2][1]=yr+xr,br.i[3][0]=Sr?Ar-wr:Ar+wr,br.i[3][1]=yr+xr*fr,br.o[0][0]=Sr?Ar+wr*fr:Ar-wr*fr,br.o[0][1]=yr-xr,br.o[1][0]=Sr?Ar+wr:Ar-wr,br.o[1][1]=yr+xr*fr,br.o[2][0]=Sr?Ar-wr*fr:Ar+wr*fr,br.o[2][1]=yr+xr,br.o[3][0]=Sr?Ar-wr:Ar+wr,br.o[3][1]=yr-xr*fr}},extendPrototype([DynamicPropertyContainer],_r),_r}(),dr=function(){function fr(_r,Ar){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=_r,this.comp=_r.comp,this.data=Ar,this.frameId=-1,this.d=Ar.d,this.initDynamicPropertyContainer(_r),Ar.sy===1?(this.ir=PropertyFactory.getProp(_r,Ar.ir,0,0,this),this.is=PropertyFactory.getProp(_r,Ar.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(_r,Ar.pt,0,0,this),this.p=PropertyFactory.getProp(_r,Ar.p,1,0,this),this.r=PropertyFactory.getProp(_r,Ar.r,0,degToRads,this),this.or=PropertyFactory.getProp(_r,Ar.or,0,0,this),this.os=PropertyFactory.getProp(_r,Ar.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return fr.prototype={reset:ir,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var _r=Math.floor(this.pt.v)*2,Ar=Math.PI*2/_r,yr=!0,wr=this.or.v,xr=this.ir.v,Sr=this.os.v,br=this.is.v,Cr=2*Math.PI*wr/(_r*2),Ir=2*Math.PI*xr/(_r*2),Rr,Pr,Dr,Fr,Or=-Math.PI/2;Or+=this.r.v;var Nr=this.data.d===3?-1:1;for(this.v._length=0,Rr=0;Rr<_r;Rr+=1){Pr=yr?wr:xr,Dr=yr?Sr:br,Fr=yr?Cr:Ir;var Ur=Pr*Math.cos(Or),Br=Pr*Math.sin(Or),Wr=Ur===0&&Br===0?0:Br/Math.sqrt(Ur*Ur+Br*Br),Xr=Ur===0&&Br===0?0:-Ur/Math.sqrt(Ur*Ur+Br*Br);Ur+=+this.p.v[0],Br+=+this.p.v[1],this.v.setTripleAt(Ur,Br,Ur-Wr*Fr*Dr*Nr,Br-Xr*Fr*Dr*Nr,Ur+Wr*Fr*Dr*Nr,Br+Xr*Fr*Dr*Nr,Rr,!0),yr=!yr,Or+=Ar*Nr}},convertPolygonToPath:function(){var _r=Math.floor(this.pt.v),Ar=Math.PI*2/_r,yr=this.or.v,wr=this.os.v,xr=2*Math.PI*yr/(_r*4),Sr,br=-Math.PI*.5,Cr=this.data.d===3?-1:1;for(br+=this.r.v,this.v._length=0,Sr=0;Sr<_r;Sr+=1){var Ir=yr*Math.cos(br),Rr=yr*Math.sin(br),Pr=Ir===0&&Rr===0?0:Rr/Math.sqrt(Ir*Ir+Rr*Rr),Dr=Ir===0&&Rr===0?0:-Ir/Math.sqrt(Ir*Ir+Rr*Rr);Ir+=+this.p.v[0],Rr+=+this.p.v[1],this.v.setTripleAt(Ir,Rr,Ir-Pr*xr*wr*Cr,Rr-Dr*xr*wr*Cr,Ir+Pr*xr*wr*Cr,Rr+Dr*xr*wr*Cr,Sr,!0),br+=Ar*Cr}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],fr),fr}(),hr=function(){function fr(_r,Ar){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=_r,this.comp=_r.comp,this.frameId=-1,this.d=Ar.d,this.initDynamicPropertyContainer(_r),this.p=PropertyFactory.getProp(_r,Ar.p,1,0,this),this.s=PropertyFactory.getProp(_r,Ar.s,1,0,this),this.r=PropertyFactory.getProp(_r,Ar.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return fr.prototype={convertRectToPath:function(){var _r=this.p.v[0],Ar=this.p.v[1],yr=this.s.v[0]/2,wr=this.s.v[1]/2,xr=bmMin(yr,wr,this.r.v),Sr=xr*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(_r+yr,Ar-wr+xr,_r+yr,Ar-wr+xr,_r+yr,Ar-wr+Sr,0,!0),this.v.setTripleAt(_r+yr,Ar+wr-xr,_r+yr,Ar+wr-Sr,_r+yr,Ar+wr-xr,1,!0),xr!==0?(this.v.setTripleAt(_r+yr-xr,Ar+wr,_r+yr-xr,Ar+wr,_r+yr-Sr,Ar+wr,2,!0),this.v.setTripleAt(_r-yr+xr,Ar+wr,_r-yr+Sr,Ar+wr,_r-yr+xr,Ar+wr,3,!0),this.v.setTripleAt(_r-yr,Ar+wr-xr,_r-yr,Ar+wr-xr,_r-yr,Ar+wr-Sr,4,!0),this.v.setTripleAt(_r-yr,Ar-wr+xr,_r-yr,Ar-wr+Sr,_r-yr,Ar-wr+xr,5,!0),this.v.setTripleAt(_r-yr+xr,Ar-wr,_r-yr+xr,Ar-wr,_r-yr+Sr,Ar-wr,6,!0),this.v.setTripleAt(_r+yr-xr,Ar-wr,_r+yr-Sr,Ar-wr,_r+yr-xr,Ar-wr,7,!0)):(this.v.setTripleAt(_r-yr,Ar+wr,_r-yr+Sr,Ar+wr,_r-yr,Ar+wr,2),this.v.setTripleAt(_r-yr,Ar-wr,_r-yr,Ar-wr+Sr,_r-yr,Ar-wr,3))):(this.v.setTripleAt(_r+yr,Ar-wr+xr,_r+yr,Ar-wr+Sr,_r+yr,Ar-wr+xr,0,!0),xr!==0?(this.v.setTripleAt(_r+yr-xr,Ar-wr,_r+yr-xr,Ar-wr,_r+yr-Sr,Ar-wr,1,!0),this.v.setTripleAt(_r-yr+xr,Ar-wr,_r-yr+Sr,Ar-wr,_r-yr+xr,Ar-wr,2,!0),this.v.setTripleAt(_r-yr,Ar-wr+xr,_r-yr,Ar-wr+xr,_r-yr,Ar-wr+Sr,3,!0),this.v.setTripleAt(_r-yr,Ar+wr-xr,_r-yr,Ar+wr-Sr,_r-yr,Ar+wr-xr,4,!0),this.v.setTripleAt(_r-yr+xr,Ar+wr,_r-yr+xr,Ar+wr,_r-yr+Sr,Ar+wr,5,!0),this.v.setTripleAt(_r+yr-xr,Ar+wr,_r+yr-Sr,Ar+wr,_r+yr-xr,Ar+wr,6,!0),this.v.setTripleAt(_r+yr,Ar+wr-xr,_r+yr,Ar+wr-xr,_r+yr,Ar+wr-Sr,7,!0)):(this.v.setTripleAt(_r-yr,Ar-wr,_r-yr+Sr,Ar-wr,_r-yr,Ar-wr,1,!0),this.v.setTripleAt(_r-yr,Ar+wr,_r-yr,Ar+wr-Sr,_r-yr,Ar+wr,2,!0),this.v.setTripleAt(_r+yr,Ar+wr,_r+yr-Sr,Ar+wr,_r+yr,Ar+wr,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:ir},extendPrototype([DynamicPropertyContainer],fr),fr}();function pr(fr,_r,Ar){var yr;if(Ar===3||Ar===4){var wr=Ar===3?_r.pt:_r.ks,xr=wr.k;xr.length?yr=new cr(fr,_r,Ar):yr=new or(fr,_r,Ar)}else Ar===5?yr=new hr(fr,_r):Ar===6?yr=new ur(fr,_r):Ar===7&&(yr=new dr(fr,_r));return yr.k&&fr.addDynamicProperty(yr),yr}function gr(){return or}function vr(){return cr}var mr={};return mr.getShapeProp=pr,mr.getConstructorFunction=gr,mr.getKeyframedConstructorFunction=vr,mr}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */const Matrix=function(){var rr=Math.cos,er=Math.sin,tr=Math.tan,ir=Math.round;function nr(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function sr(Ur){if(Ur===0)return this;var Br=rr(Ur),Wr=er(Ur);return this._t(Br,-Wr,0,0,Wr,Br,0,0,0,0,1,0,0,0,0,1)}function ar(Ur){if(Ur===0)return this;var Br=rr(Ur),Wr=er(Ur);return this._t(1,0,0,0,0,Br,-Wr,0,0,Wr,Br,0,0,0,0,1)}function or(Ur){if(Ur===0)return this;var Br=rr(Ur),Wr=er(Ur);return this._t(Br,0,Wr,0,0,1,0,0,-Wr,0,Br,0,0,0,0,1)}function lr(Ur){if(Ur===0)return this;var Br=rr(Ur),Wr=er(Ur);return this._t(Br,-Wr,0,0,Wr,Br,0,0,0,0,1,0,0,0,0,1)}function cr(Ur,Br){return this._t(1,Br,Ur,1,0,0)}function ur(Ur,Br){return this.shear(tr(Ur),tr(Br))}function dr(Ur,Br){var Wr=rr(Br),Xr=er(Br);return this._t(Wr,Xr,0,0,-Xr,Wr,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,tr(Ur),1,0,0,0,0,1,0,0,0,0,1)._t(Wr,-Xr,0,0,Xr,Wr,0,0,0,0,1,0,0,0,0,1)}function hr(Ur,Br,Wr){return!Wr&&Wr!==0&&(Wr=1),Ur===1&&Br===1&&Wr===1?this:this._t(Ur,0,0,0,0,Br,0,0,0,0,Wr,0,0,0,0,1)}function pr(Ur,Br,Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr,Gr,qr,ji,Jr,Ji,Ki){return this.props[0]=Ur,this.props[1]=Br,this.props[2]=Wr,this.props[3]=Xr,this.props[4]=Yr,this.props[5]=Qi,this.props[6]=Xi,this.props[7]=Kr,this.props[8]=$r,this.props[9]=Vr,this.props[10]=Gr,this.props[11]=qr,this.props[12]=ji,this.props[13]=Jr,this.props[14]=Ji,this.props[15]=Ki,this}function gr(Ur,Br,Wr){return Wr=Wr||0,Ur!==0||Br!==0||Wr!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,Ur,Br,Wr,1):this}function vr(Ur,Br,Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr,Gr,qr,ji,Jr,Ji,Ki){var Zi=this.props;if(Ur===1&&Br===0&&Wr===0&&Xr===0&&Yr===0&&Qi===1&&Xi===0&&Kr===0&&$r===0&&Vr===0&&Gr===1&&qr===0)return Zi[12]=Zi[12]*Ur+Zi[15]*ji,Zi[13]=Zi[13]*Qi+Zi[15]*Jr,Zi[14]=Zi[14]*Gr+Zi[15]*Ji,Zi[15]*=Ki,this._identityCalculated=!1,this;var Zr=Zi[0],is=Zi[1],os=Zi[2],cs=Zi[3],ss=Zi[4],es=Zi[5],ms=Zi[6],Yi=Zi[7],Gi=Zi[8],Ni=Zi[9],Ri=Zi[10],qi=Zi[11],as=Zi[12],us=Zi[13],gs=Zi[14],vs=Zi[15];return Zi[0]=Zr*Ur+is*Yr+os*$r+cs*ji,Zi[1]=Zr*Br+is*Qi+os*Vr+cs*Jr,Zi[2]=Zr*Wr+is*Xi+os*Gr+cs*Ji,Zi[3]=Zr*Xr+is*Kr+os*qr+cs*Ki,Zi[4]=ss*Ur+es*Yr+ms*$r+Yi*ji,Zi[5]=ss*Br+es*Qi+ms*Vr+Yi*Jr,Zi[6]=ss*Wr+es*Xi+ms*Gr+Yi*Ji,Zi[7]=ss*Xr+es*Kr+ms*qr+Yi*Ki,Zi[8]=Gi*Ur+Ni*Yr+Ri*$r+qi*ji,Zi[9]=Gi*Br+Ni*Qi+Ri*Vr+qi*Jr,Zi[10]=Gi*Wr+Ni*Xi+Ri*Gr+qi*Ji,Zi[11]=Gi*Xr+Ni*Kr+Ri*qr+qi*Ki,Zi[12]=as*Ur+us*Yr+gs*$r+vs*ji,Zi[13]=as*Br+us*Qi+gs*Vr+vs*Jr,Zi[14]=as*Wr+us*Xi+gs*Gr+vs*Ji,Zi[15]=as*Xr+us*Kr+gs*qr+vs*Ki,this._identityCalculated=!1,this}function mr(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function fr(Ur){for(var Br=0;Br<16;){if(Ur.props[Br]!==this.props[Br])return!1;Br+=1}return!0}function _r(Ur){var Br;for(Br=0;Br<16;Br+=1)Ur.props[Br]=this.props[Br];return Ur}function Ar(Ur){var Br;for(Br=0;Br<16;Br+=1)this.props[Br]=Ur[Br]}function yr(Ur,Br,Wr){return{x:Ur*this.props[0]+Br*this.props[4]+Wr*this.props[8]+this.props[12],y:Ur*this.props[1]+Br*this.props[5]+Wr*this.props[9]+this.props[13],z:Ur*this.props[2]+Br*this.props[6]+Wr*this.props[10]+this.props[14]}}function wr(Ur,Br,Wr){return Ur*this.props[0]+Br*this.props[4]+Wr*this.props[8]+this.props[12]}function xr(Ur,Br,Wr){return Ur*this.props[1]+Br*this.props[5]+Wr*this.props[9]+this.props[13]}function Sr(Ur,Br,Wr){return Ur*this.props[2]+Br*this.props[6]+Wr*this.props[10]+this.props[14]}function br(){var Ur=this.props[0]*this.props[5]-this.props[1]*this.props[4],Br=this.props[5]/Ur,Wr=-this.props[1]/Ur,Xr=-this.props[4]/Ur,Yr=this.props[0]/Ur,Qi=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/Ur,Xi=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/Ur,Kr=new Matrix;return Kr.props[0]=Br,Kr.props[1]=Wr,Kr.props[4]=Xr,Kr.props[5]=Yr,Kr.props[12]=Qi,Kr.props[13]=Xi,Kr}function Cr(Ur){var Br=this.getInverseMatrix();return Br.applyToPointArray(Ur[0],Ur[1],Ur[2]||0)}function Ir(Ur){var Br,Wr=Ur.length,Xr=[];for(Br=0;Br<Wr;Br+=1)Xr[Br]=Cr(Ur[Br]);return Xr}function Rr(Ur,Br,Wr){var Xr=createTypedArray("float32",6);if(this.isIdentity())Xr[0]=Ur[0],Xr[1]=Ur[1],Xr[2]=Br[0],Xr[3]=Br[1],Xr[4]=Wr[0],Xr[5]=Wr[1];else{var Yr=this.props[0],Qi=this.props[1],Xi=this.props[4],Kr=this.props[5],$r=this.props[12],Vr=this.props[13];Xr[0]=Ur[0]*Yr+Ur[1]*Xi+$r,Xr[1]=Ur[0]*Qi+Ur[1]*Kr+Vr,Xr[2]=Br[0]*Yr+Br[1]*Xi+$r,Xr[3]=Br[0]*Qi+Br[1]*Kr+Vr,Xr[4]=Wr[0]*Yr+Wr[1]*Xi+$r,Xr[5]=Wr[0]*Qi+Wr[1]*Kr+Vr}return Xr}function Pr(Ur,Br,Wr){var Xr;return this.isIdentity()?Xr=[Ur,Br,Wr]:Xr=[Ur*this.props[0]+Br*this.props[4]+Wr*this.props[8]+this.props[12],Ur*this.props[1]+Br*this.props[5]+Wr*this.props[9]+this.props[13],Ur*this.props[2]+Br*this.props[6]+Wr*this.props[10]+this.props[14]],Xr}function Dr(Ur,Br){if(this.isIdentity())return Ur+","+Br;var Wr=this.props;return Math.round((Ur*Wr[0]+Br*Wr[4]+Wr[12])*100)/100+","+Math.round((Ur*Wr[1]+Br*Wr[5]+Wr[13])*100)/100}function Fr(){for(var Ur=0,Br=this.props,Wr="matrix3d(",Xr=1e4;Ur<16;)Wr+=ir(Br[Ur]*Xr)/Xr,Wr+=Ur===15?")":",",Ur+=1;return Wr}function Or(Ur){var Br=1e4;return Ur<1e-6&&Ur>0||Ur>-1e-6&&Ur<0?ir(Ur*Br)/Br:Ur}function Nr(){var Ur=this.props,Br=Or(Ur[0]),Wr=Or(Ur[1]),Xr=Or(Ur[4]),Yr=Or(Ur[5]),Qi=Or(Ur[12]),Xi=Or(Ur[13]);return"matrix("+Br+","+Wr+","+Xr+","+Yr+","+Qi+","+Xi+")"}return function(){this.reset=nr,this.rotate=sr,this.rotateX=ar,this.rotateY=or,this.rotateZ=lr,this.skew=ur,this.skewFromAxis=dr,this.shear=cr,this.scale=hr,this.setTransform=pr,this.translate=gr,this.transform=vr,this.applyToPoint=yr,this.applyToX=wr,this.applyToY=xr,this.applyToZ=Sr,this.applyToPointArray=Pr,this.applyToTriplePoints=Rr,this.applyToPointStringified=Dr,this.toCSS=Fr,this.to2dCSS=Nr,this.clone=_r,this.cloneFromProps=Ar,this.equals=fr,this.inversePoints=Ir,this.inversePoint=Cr,this.getInverseMatrix=br,this._t=this.transform,this.isIdentity=mr,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();var standalone="__[STANDALONE]__",animationData="__[ANIMATIONDATA]__",renderer$1="";lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="[[BM_VERSION]]";var queryString="";if(standalone){var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",renderer$1=getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{!(typeof exports=="object"&&typeof module<"u")&&!(typeof define=="function"&&define.amd)&&(window.bodymovin=lottie)}catch(rr){}const ShapeModifiers=function(){var rr={},er={};rr.registerModifier=tr,rr.getModifier=ir;function tr(nr,sr){er[nr]||(er[nr]=sr)}function ir(nr,sr,ar){return new er[nr](sr,ar)}return rr}();ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(rr){if(!this.closed){rr.sh.container.addDynamicProperty(rr.sh);var er={shape:rr.sh,data:rr,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(er),this.addShapeToModifier(er),this._isAnimated&&rr.setAsAnimated()}},ShapeModifier.prototype.init=function(rr,er){this.shapes=[],this.elem=rr,this.initDynamicPropertyContainer(rr),this.initModifierProperties(rr,er),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier),extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(rr,er){this.s=PropertyFactory.getProp(rr,er.s,0,.01,this),this.e=PropertyFactory.getProp(rr,er.e,0,.01,this),this.o=PropertyFactory.getProp(rr,er.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=er.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(rr){rr.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(rr,er,tr,ir,nr){var sr=[];er<=1?sr.push({s:rr,e:er}):rr>=1?sr.push({s:rr-1,e:er-1}):(sr.push({s:rr,e:1}),sr.push({s:0,e:er-1}));var ar=[],or,lr=sr.length,cr;for(or=0;or<lr;or+=1)if(cr=sr[or],!(cr.e*nr<ir||cr.s*nr>ir+tr)){var ur,dr;cr.s*nr<=ir?ur=0:ur=(cr.s*nr-ir)/tr,cr.e*nr>=ir+tr?dr=1:dr=(cr.e*nr-ir)/tr,ar.push([ur,dr])}return ar.length||ar.push([0,0]),ar},TrimModifier.prototype.releasePathsData=function(rr){var er,tr=rr.length;for(er=0;er<tr;er+=1)segmentsLengthPool.release(rr[er]);return rr.length=0,rr},TrimModifier.prototype.processShapes=function(rr){var er,tr;if(this._mdf||rr){var ir=this.o.v%360/360;if(ir<0&&(ir+=1),this.s.v>1?er=1+ir:this.s.v<0?er=0+ir:er=this.s.v+ir,this.e.v>1?tr=1+ir:this.e.v<0?tr=0+ir:tr=this.e.v+ir,er>tr){var nr=er;er=tr,tr=nr}er=Math.round(er*1e4)*1e-4,tr=Math.round(tr*1e4)*1e-4,this.sValue=er,this.eValue=tr}else er=this.sValue,tr=this.eValue;var sr,ar,or=this.shapes.length,lr,cr,ur,dr,hr,pr=0;if(tr===er)for(ar=0;ar<or;ar+=1)this.shapes[ar].localShapeCollection.releaseShapes(),this.shapes[ar].shape._mdf=!0,this.shapes[ar].shape.paths=this.shapes[ar].localShapeCollection,this._mdf&&(this.shapes[ar].pathsData.length=0);else if(tr===1&&er===0||tr===0&&er===1){if(this._mdf)for(ar=0;ar<or;ar+=1)this.shapes[ar].pathsData.length=0,this.shapes[ar].shape._mdf=!0}else{var gr=[],vr,mr;for(ar=0;ar<or;ar+=1)if(vr=this.shapes[ar],!vr.shape._mdf&&!this._mdf&&!rr&&this.m!==2)vr.shape.paths=vr.localShapeCollection;else{if(sr=vr.shape.paths,cr=sr._length,hr=0,!vr.shape._mdf&&vr.pathsData.length)hr=vr.totalShapeLength;else{for(ur=this.releasePathsData(vr.pathsData),lr=0;lr<cr;lr+=1)dr=bez.getSegmentsLength(sr.shapes[lr]),ur.push(dr),hr+=dr.totalLength;vr.totalShapeLength=hr,vr.pathsData=ur}pr+=hr,vr.shape._mdf=!0}var fr=er,_r=tr,Ar=0,yr;for(ar=or-1;ar>=0;ar-=1)if(vr=this.shapes[ar],vr.shape._mdf){for(mr=vr.localShapeCollection,mr.releaseShapes(),this.m===2&&or>1?(yr=this.calculateShapeEdges(er,tr,vr.totalShapeLength,Ar,pr),Ar+=vr.totalShapeLength):yr=[[fr,_r]],cr=yr.length,lr=0;lr<cr;lr+=1){fr=yr[lr][0],_r=yr[lr][1],gr.length=0,_r<=1?gr.push({s:vr.totalShapeLength*fr,e:vr.totalShapeLength*_r}):fr>=1?gr.push({s:vr.totalShapeLength*(fr-1),e:vr.totalShapeLength*(_r-1)}):(gr.push({s:vr.totalShapeLength*fr,e:vr.totalShapeLength}),gr.push({s:0,e:vr.totalShapeLength*(_r-1)}));var wr=this.addShapes(vr,gr[0]);if(gr[0].s!==gr[0].e){if(gr.length>1){var xr=vr.shape.paths.shapes[vr.shape.paths._length-1];if(xr.c){var Sr=wr.pop();this.addPaths(wr,mr),wr=this.addShapes(vr,gr[1],Sr)}else this.addPaths(wr,mr),wr=this.addShapes(vr,gr[1])}this.addPaths(wr,mr)}}vr.shape.paths=mr}}},TrimModifier.prototype.addPaths=function(rr,er){var tr,ir=rr.length;for(tr=0;tr<ir;tr+=1)er.addShape(rr[tr])},TrimModifier.prototype.addSegment=function(rr,er,tr,ir,nr,sr,ar){nr.setXYAt(er[0],er[1],"o",sr),nr.setXYAt(tr[0],tr[1],"i",sr+1),ar&&nr.setXYAt(rr[0],rr[1],"v",sr),nr.setXYAt(ir[0],ir[1],"v",sr+1)},TrimModifier.prototype.addSegmentFromArray=function(rr,er,tr,ir){er.setXYAt(rr[1],rr[5],"o",tr),er.setXYAt(rr[2],rr[6],"i",tr+1),ir&&er.setXYAt(rr[0],rr[4],"v",tr),er.setXYAt(rr[3],rr[7],"v",tr+1)},TrimModifier.prototype.addShapes=function(rr,er,tr){var ir=rr.pathsData,nr=rr.shape.paths.shapes,sr,ar=rr.shape.paths._length,or,lr,cr=0,ur,dr,hr,pr,gr=[],vr,mr=!0;for(tr?(dr=tr._length,vr=tr._length):(tr=shapePool.newElement(),dr=0,vr=0),gr.push(tr),sr=0;sr<ar;sr+=1){for(hr=ir[sr].lengths,tr.c=nr[sr].c,lr=nr[sr].c?hr.length:hr.length+1,or=1;or<lr;or+=1)if(ur=hr[or-1],cr+ur.addedLength<er.s)cr+=ur.addedLength,tr.c=!1;else if(cr>er.e){tr.c=!1;break}else er.s<=cr&&er.e>=cr+ur.addedLength?(this.addSegment(nr[sr].v[or-1],nr[sr].o[or-1],nr[sr].i[or],nr[sr].v[or],tr,dr,mr),mr=!1):(pr=bez.getNewSegment(nr[sr].v[or-1],nr[sr].v[or],nr[sr].o[or-1],nr[sr].i[or],(er.s-cr)/ur.addedLength,(er.e-cr)/ur.addedLength,hr[or-1]),this.addSegmentFromArray(pr,tr,dr,mr),mr=!1,tr.c=!1),cr+=ur.addedLength,dr+=1;if(nr[sr].c&&hr.length){if(ur=hr[or-1],cr<=er.e){var fr=hr[or-1].addedLength;er.s<=cr&&er.e>=cr+fr?(this.addSegment(nr[sr].v[or-1],nr[sr].o[or-1],nr[sr].i[0],nr[sr].v[0],tr,dr,mr),mr=!1):(pr=bez.getNewSegment(nr[sr].v[or-1],nr[sr].v[0],nr[sr].o[or-1],nr[sr].i[0],(er.s-cr)/fr,(er.e-cr)/fr,hr[or-1]),this.addSegmentFromArray(pr,tr,dr,mr),mr=!1,tr.c=!1)}else tr.c=!1;cr+=ur.addedLength,dr+=1}if(tr._length&&(tr.setXYAt(tr.v[vr][0],tr.v[vr][1],"i",vr),tr.setXYAt(tr.v[tr._length-1][0],tr.v[tr._length-1][1],"o",tr._length-1)),cr>er.e)break;sr<ar-1&&(tr=shapePool.newElement(),mr=!0,gr.push(tr),dr=0)}return gr},extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(rr,er){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(rr,er.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(rr,er){var tr=er/100,ir=[0,0],nr=rr._length,sr=0;for(sr=0;sr<nr;sr+=1)ir[0]+=rr.v[sr][0],ir[1]+=rr.v[sr][1];ir[0]/=nr,ir[1]/=nr;var ar=shapePool.newElement();ar.c=rr.c;var or,lr,cr,ur,dr,hr;for(sr=0;sr<nr;sr+=1)or=rr.v[sr][0]+(ir[0]-rr.v[sr][0])*tr,lr=rr.v[sr][1]+(ir[1]-rr.v[sr][1])*tr,cr=rr.o[sr][0]+(ir[0]-rr.o[sr][0])*-tr,ur=rr.o[sr][1]+(ir[1]-rr.o[sr][1])*-tr,dr=rr.i[sr][0]+(ir[0]-rr.i[sr][0])*-tr,hr=rr.i[sr][1]+(ir[1]-rr.i[sr][1])*-tr,ar.setTripleAt(or,lr,cr,ur,dr,hr,sr);return ar},PuckerAndBloatModifier.prototype.processShapes=function(rr){var er,tr,ir=this.shapes.length,nr,sr,ar=this.amount.v;if(ar!==0){var or,lr;for(tr=0;tr<ir;tr+=1){if(or=this.shapes[tr],lr=or.localShapeCollection,!(!or.shape._mdf&&!this._mdf&&!rr))for(lr.releaseShapes(),or.shape._mdf=!0,er=or.shape.paths.shapes,sr=or.shape.paths._length,nr=0;nr<sr;nr+=1)lr.addShape(this.processPath(er[nr],ar));or.shape.paths=or.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};const TransformPropertyFactory=function(){var rr=[0,0];function er(lr){var cr=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||cr,this.a&&lr.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&lr.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&lr.skewFromAxis(-this.sk.v,this.sa.v),this.r?lr.rotate(-this.r.v):lr.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?lr.translate(this.px.v,this.py.v,-this.pz.v):lr.translate(this.px.v,this.py.v,0):lr.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function tr(lr){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||lr){var cr;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var ur,dr;if(cr=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(ur=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/cr,0),dr=this.p.getValueAtTime(this.p.keyframes[0].t/cr,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(ur=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/cr,0),dr=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/cr,0)):(ur=this.p.pv,dr=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/cr,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){ur=[],dr=[];var hr=this.px,pr=this.py;hr._caching.lastFrame+hr.offsetTime<=hr.keyframes[0].t?(ur[0]=hr.getValueAtTime((hr.keyframes[0].t+.01)/cr,0),ur[1]=pr.getValueAtTime((pr.keyframes[0].t+.01)/cr,0),dr[0]=hr.getValueAtTime(hr.keyframes[0].t/cr,0),dr[1]=pr.getValueAtTime(pr.keyframes[0].t/cr,0)):hr._caching.lastFrame+hr.offsetTime>=hr.keyframes[hr.keyframes.length-1].t?(ur[0]=hr.getValueAtTime(hr.keyframes[hr.keyframes.length-1].t/cr,0),ur[1]=pr.getValueAtTime(pr.keyframes[pr.keyframes.length-1].t/cr,0),dr[0]=hr.getValueAtTime((hr.keyframes[hr.keyframes.length-1].t-.01)/cr,0),dr[1]=pr.getValueAtTime((pr.keyframes[pr.keyframes.length-1].t-.01)/cr,0)):(ur=[hr.pv,pr.pv],dr[0]=hr.getValueAtTime((hr._caching.lastFrame+hr.offsetTime-.01)/cr,hr.offsetTime),dr[1]=pr.getValueAtTime((pr._caching.lastFrame+pr.offsetTime-.01)/cr,pr.offsetTime))}else dr=rr,ur=dr;this.v.rotate(-Math.atan2(ur[1]-dr[1],ur[0]-dr[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function ir(){if(!this.a.k)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function nr(){}function sr(lr){this._addDynamicProperty(lr),this.elem.addDynamicProperty(lr),this._isDirty=!0}function ar(lr,cr,ur){if(this.elem=lr,this.frameId=-1,this.propType="transform",this.data=cr,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(ur||lr),cr.p&&cr.p.s?(this.px=PropertyFactory.getProp(lr,cr.p.x,0,0,this),this.py=PropertyFactory.getProp(lr,cr.p.y,0,0,this),cr.p.z&&(this.pz=PropertyFactory.getProp(lr,cr.p.z,0,0,this))):this.p=PropertyFactory.getProp(lr,cr.p||{k:[0,0,0]},1,0,this),cr.rx){if(this.rx=PropertyFactory.getProp(lr,cr.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(lr,cr.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(lr,cr.rz,0,degToRads,this),cr.or.k[0].ti){var dr,hr=cr.or.k.length;for(dr=0;dr<hr;dr+=1)cr.or.k[dr].to=null,cr.or.k[dr].ti=null}this.or=PropertyFactory.getProp(lr,cr.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(lr,cr.r||{k:0},0,degToRads,this);cr.sk&&(this.sk=PropertyFactory.getProp(lr,cr.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(lr,cr.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(lr,cr.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(lr,cr.s||{k:[100,100,100]},1,.01,this),cr.o?this.o=PropertyFactory.getProp(lr,cr.o,0,.01,lr):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}ar.prototype={applyToMatrix:er,getValue:tr,precalculateMatrix:ir,autoOrient:nr},extendPrototype([DynamicPropertyContainer],ar),ar.prototype.addDynamicProperty=sr,ar.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function or(lr,cr,ur){return new ar(lr,cr,ur)}return{getTransformProperty:or}}();extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(rr,er){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(rr,er.c,0,null,this),this.o=PropertyFactory.getProp(rr,er.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(rr,er.tr,this),this.so=PropertyFactory.getProp(rr,er.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(rr,er.tr.eo,0,.01,this),this.data=er,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(rr,er,tr,ir,nr,sr){var ar=sr?-1:1,or=ir.s.v[0]+(1-ir.s.v[0])*(1-nr),lr=ir.s.v[1]+(1-ir.s.v[1])*(1-nr);rr.translate(ir.p.v[0]*ar*nr,ir.p.v[1]*ar*nr,ir.p.v[2]),er.translate(-ir.a.v[0],-ir.a.v[1],ir.a.v[2]),er.rotate(-ir.r.v*ar*nr),er.translate(ir.a.v[0],ir.a.v[1],ir.a.v[2]),tr.translate(-ir.a.v[0],-ir.a.v[1],ir.a.v[2]),tr.scale(sr?1/or:or,sr?1/lr:lr),tr.translate(ir.a.v[0],ir.a.v[1],ir.a.v[2])},RepeaterModifier.prototype.init=function(rr,er,tr,ir){for(this.elem=rr,this.arr=er,this.pos=tr,this.elemsData=ir,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(rr),this.initModifierProperties(rr,er[tr]);tr>0;)tr-=1,this._elements.unshift(er[tr]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(rr){var er,tr=rr.length;for(er=0;er<tr;er+=1)rr[er]._processed=!1,rr[er].ty==="gr"&&this.resetElements(rr[er].it)},RepeaterModifier.prototype.cloneElements=function(rr){var er=JSON.parse(JSON.stringify(rr));return this.resetElements(er),er},RepeaterModifier.prototype.changeGroupRender=function(rr,er){var tr,ir=rr.length;for(tr=0;tr<ir;tr+=1)rr[tr]._render=er,rr[tr].ty==="gr"&&this.changeGroupRender(rr[tr].it,er)},RepeaterModifier.prototype.processShapes=function(rr){var er,tr,ir,nr,sr,ar=!1;if(this._mdf||rr){var or=Math.ceil(this.c.v);if(this._groups.length<or){for(;this._groups.length<or;){var lr={it:this.cloneElements(this._elements),ty:"gr"};lr.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,lr),this._groups.splice(0,0,lr),this._currentCopies+=1}this.elem.reloadShapes(),ar=!0}sr=0;var cr;for(ir=0;ir<=this._groups.length-1;ir+=1){if(cr=sr<or,this._groups[ir]._render=cr,this.changeGroupRender(this._groups[ir].it,cr),!cr){var ur=this.elemsData[ir].it,dr=ur[ur.length-1];dr.transform.op.v!==0?(dr.transform.op._mdf=!0,dr.transform.op.v=0):dr.transform.op._mdf=!1}sr+=1}this._currentCopies=or;var hr=this.o.v,pr=hr%1,gr=hr>0?Math.floor(hr):Math.ceil(hr),vr=this.pMatrix.props,mr=this.rMatrix.props,fr=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var _r=0;if(hr>0){for(;_r<gr;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),_r+=1;pr&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,pr,!1),_r+=pr)}else if(hr<0){for(;_r>gr;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),_r-=1;pr&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-pr,!0),_r-=pr)}ir=this.data.m===1?0:this._currentCopies-1,nr=this.data.m===1?1:-1,sr=this._currentCopies;for(var Ar,yr;sr;){if(er=this.elemsData[ir].it,tr=er[er.length-1].transform.mProps.v.props,yr=tr.length,er[er.length-1].transform.mProps._mdf=!0,er[er.length-1].transform.op._mdf=!0,er[er.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(ir/(this._currentCopies-1)),_r!==0){for((ir!==0&&nr===1||ir!==this._currentCopies-1&&nr===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(mr[0],mr[1],mr[2],mr[3],mr[4],mr[5],mr[6],mr[7],mr[8],mr[9],mr[10],mr[11],mr[12],mr[13],mr[14],mr[15]),this.matrix.transform(fr[0],fr[1],fr[2],fr[3],fr[4],fr[5],fr[6],fr[7],fr[8],fr[9],fr[10],fr[11],fr[12],fr[13],fr[14],fr[15]),this.matrix.transform(vr[0],vr[1],vr[2],vr[3],vr[4],vr[5],vr[6],vr[7],vr[8],vr[9],vr[10],vr[11],vr[12],vr[13],vr[14],vr[15]),Ar=0;Ar<yr;Ar+=1)tr[Ar]=this.matrix.props[Ar];this.matrix.reset()}else for(this.matrix.reset(),Ar=0;Ar<yr;Ar+=1)tr[Ar]=this.matrix.props[Ar];_r+=1,sr-=1,ir+=nr}}else for(sr=this._currentCopies,ir=0,nr=1;sr;)er=this.elemsData[ir].it,tr=er[er.length-1].transform.mProps.v.props,er[er.length-1].transform.mProps._mdf=!1,er[er.length-1].transform.op._mdf=!1,sr-=1,ir+=nr;return ar},RepeaterModifier.prototype.addShape=function(){},extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(rr,er){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(rr,er.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(rr,er){var tr=shapePool.newElement();tr.c=rr.c;var ir,nr=rr._length,sr,ar,or,lr,cr,ur,dr=0,hr,pr,gr,vr,mr,fr;for(ir=0;ir<nr;ir+=1)sr=rr.v[ir],or=rr.o[ir],ar=rr.i[ir],sr[0]===or[0]&&sr[1]===or[1]&&sr[0]===ar[0]&&sr[1]===ar[1]?(ir===0||ir===nr-1)&&!rr.c?(tr.setTripleAt(sr[0],sr[1],or[0],or[1],ar[0],ar[1],dr),dr+=1):(ir===0?lr=rr.v[nr-1]:lr=rr.v[ir-1],cr=Math.sqrt(Math.pow(sr[0]-lr[0],2)+Math.pow(sr[1]-lr[1],2)),ur=cr?Math.min(cr/2,er)/cr:0,mr=sr[0]+(lr[0]-sr[0])*ur,hr=mr,fr=sr[1]-(sr[1]-lr[1])*ur,pr=fr,gr=hr-(hr-sr[0])*roundCorner,vr=pr-(pr-sr[1])*roundCorner,tr.setTripleAt(hr,pr,gr,vr,mr,fr,dr),dr+=1,ir===nr-1?lr=rr.v[0]:lr=rr.v[ir+1],cr=Math.sqrt(Math.pow(sr[0]-lr[0],2)+Math.pow(sr[1]-lr[1],2)),ur=cr?Math.min(cr/2,er)/cr:0,gr=sr[0]+(lr[0]-sr[0])*ur,hr=gr,vr=sr[1]+(lr[1]-sr[1])*ur,pr=vr,mr=hr-(hr-sr[0])*roundCorner,fr=pr-(pr-sr[1])*roundCorner,tr.setTripleAt(hr,pr,gr,vr,mr,fr,dr),dr+=1):(tr.setTripleAt(rr.v[ir][0],rr.v[ir][1],rr.o[ir][0],rr.o[ir][1],rr.i[ir][0],rr.i[ir][1],dr),dr+=1);return tr},RoundCornersModifier.prototype.processShapes=function(rr){var er,tr,ir=this.shapes.length,nr,sr,ar=this.rd.v;if(ar!==0){var or,lr;for(tr=0;tr<ir;tr+=1){if(or=this.shapes[tr],lr=or.localShapeCollection,!(!or.shape._mdf&&!this._mdf&&!rr))for(lr.releaseShapes(),or.shape._mdf=!0,er=or.shape.paths.shapes,sr=or.shape.paths._length,nr=0;nr<sr;nr+=1)lr.addShape(this.processPath(er[nr],ar));or.shape.paths=or.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};const FontManager=function(){var rr=5e3,er={w:0,size:0,shapes:[],data:{shapes:[]}},tr=[];tr=tr.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var ir=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"],nr=[65039,8205];function sr(yr){var wr=yr.split(","),xr,Sr=wr.length,br=[];for(xr=0;xr<Sr;xr+=1)wr[xr]!=="sans-serif"&&wr[xr]!=="monospace"&&br.push(wr[xr]);return br.join(",")}function ar(yr,wr){var xr=createTag("span");xr.setAttribute("aria-hidden",!0),xr.style.fontFamily=wr;var Sr=createTag("span");Sr.innerText="giItT1WQy@!-/#",xr.style.position="absolute",xr.style.left="-10000px",xr.style.top="-10000px",xr.style.fontSize="300px",xr.style.fontVariant="normal",xr.style.fontStyle="normal",xr.style.fontWeight="normal",xr.style.letterSpacing="0",xr.appendChild(Sr),document.body.appendChild(xr);var br=Sr.offsetWidth;return Sr.style.fontFamily=sr(yr)+", "+wr,{node:Sr,w:br,parent:xr}}function or(){var yr,wr=this.fonts.length,xr,Sr,br=wr;for(yr=0;yr<wr;yr+=1)this.fonts[yr].loaded?br-=1:this.fonts[yr].fOrigin==="n"||this.fonts[yr].origin===0?this.fonts[yr].loaded=!0:(xr=this.fonts[yr].monoCase.node,Sr=this.fonts[yr].monoCase.w,xr.offsetWidth!==Sr?(br-=1,this.fonts[yr].loaded=!0):(xr=this.fonts[yr].sansCase.node,Sr=this.fonts[yr].sansCase.w,xr.offsetWidth!==Sr&&(br-=1,this.fonts[yr].loaded=!0)),this.fonts[yr].loaded&&(this.fonts[yr].sansCase.parent.parentNode.removeChild(this.fonts[yr].sansCase.parent),this.fonts[yr].monoCase.parent.parentNode.removeChild(this.fonts[yr].monoCase.parent)));br!==0&&Date.now()-this.initTime<rr?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function lr(yr,wr){var xr=document.body&&wr?"svg":"canvas",Sr,br=getFontProperties(yr);if(xr==="svg"){var Cr=createNS("text");Cr.style.fontSize="100px",Cr.setAttribute("font-family",yr.fFamily),Cr.setAttribute("font-style",br.style),Cr.setAttribute("font-weight",br.weight),Cr.textContent="1",yr.fClass?(Cr.style.fontFamily="inherit",Cr.setAttribute("class",yr.fClass)):Cr.style.fontFamily=yr.fFamily,wr.appendChild(Cr),Sr=Cr}else{var Ir=new OffscreenCanvas(500,500).getContext("2d");Ir.font=br.style+" "+br.weight+" 100px "+yr.fFamily,Sr=Ir}function Rr(Pr){return xr==="svg"?(Sr.textContent=Pr,Sr.getComputedTextLength()):Sr.measureText(Pr).width}return{measureText:Rr}}function cr(yr,wr){if(!yr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=yr.list;return}if(!document.body){this.isLoaded=!0,yr.list.forEach(Nr=>{Nr.helper=lr(Nr),Nr.cache={}}),this.fonts=yr.list;return}var xr=yr.list,Sr,br=xr.length,Cr=br;for(Sr=0;Sr<br;Sr+=1){var Ir=!0,Rr,Pr;if(xr[Sr].loaded=!1,xr[Sr].monoCase=ar(xr[Sr].fFamily,"monospace"),xr[Sr].sansCase=ar(xr[Sr].fFamily,"sans-serif"),!xr[Sr].fPath)xr[Sr].loaded=!0,Cr-=1;else if(xr[Sr].fOrigin==="p"||xr[Sr].origin===3){if(Rr=document.querySelectorAll('style[f-forigin="p"][f-family="'+xr[Sr].fFamily+'"], style[f-origin="3"][f-family="'+xr[Sr].fFamily+'"]'),Rr.length>0&&(Ir=!1),Ir){var Dr=createTag("style");Dr.setAttribute("f-forigin",xr[Sr].fOrigin),Dr.setAttribute("f-origin",xr[Sr].origin),Dr.setAttribute("f-family",xr[Sr].fFamily),Dr.type="text/css",Dr.innerText="@font-face {font-family: "+xr[Sr].fFamily+"; font-style: normal; src: url('"+xr[Sr].fPath+"');}",wr.appendChild(Dr)}}else if(xr[Sr].fOrigin==="g"||xr[Sr].origin===1){for(Rr=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Pr=0;Pr<Rr.length;Pr+=1)Rr[Pr].href.indexOf(xr[Sr].fPath)!==-1&&(Ir=!1);if(Ir){var Fr=createTag("link");Fr.setAttribute("f-forigin",xr[Sr].fOrigin),Fr.setAttribute("f-origin",xr[Sr].origin),Fr.type="text/css",Fr.rel="stylesheet",Fr.href=xr[Sr].fPath,document.body.appendChild(Fr)}}else if(xr[Sr].fOrigin==="t"||xr[Sr].origin===2){for(Rr=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Pr=0;Pr<Rr.length;Pr+=1)xr[Sr].fPath===Rr[Pr].src&&(Ir=!1);if(Ir){var Or=createTag("link");Or.setAttribute("f-forigin",xr[Sr].fOrigin),Or.setAttribute("f-origin",xr[Sr].origin),Or.setAttribute("rel","stylesheet"),Or.setAttribute("href",xr[Sr].fPath),wr.appendChild(Or)}}xr[Sr].helper=lr(xr[Sr],wr),xr[Sr].cache={},this.fonts.push(xr[Sr])}Cr===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function ur(yr){if(yr){this.chars||(this.chars=[]);var wr,xr=yr.length,Sr,br=this.chars.length,Cr;for(wr=0;wr<xr;wr+=1){for(Sr=0,Cr=!1;Sr<br;)this.chars[Sr].style===yr[wr].style&&this.chars[Sr].fFamily===yr[wr].fFamily&&this.chars[Sr].ch===yr[wr].ch&&(Cr=!0),Sr+=1;Cr||(this.chars.push(yr[wr]),br+=1)}}}function dr(yr,wr,xr){for(var Sr=0,br=this.chars.length;Sr<br;){if(this.chars[Sr].ch===yr&&this.chars[Sr].style===wr&&this.chars[Sr].fFamily===xr)return this.chars[Sr];Sr+=1}return(typeof yr=="string"&&yr.charCodeAt(0)!==13||!yr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",yr,wr,xr)),er}function hr(yr,wr,xr){var Sr=this.getFontByName(wr),br=yr.charCodeAt(0);if(!Sr.cache[br+1]){var Cr=Sr.helper;if(yr===" "){var Ir=Cr.measureText("|"+yr+"|"),Rr=Cr.measureText("||");Sr.cache[br+1]=(Ir-Rr)/100}else Sr.cache[br+1]=Cr.measureText(yr)/100}return Sr.cache[br+1]*xr}function pr(yr){for(var wr=0,xr=this.fonts.length;wr<xr;){if(this.fonts[wr].fName===yr)return this.fonts[wr];wr+=1}return this.fonts[0]}function gr(yr,wr){var xr=yr.toString(16)+wr.toString(16);return ir.indexOf(xr)!==-1}function vr(yr,wr){return wr?yr===nr[0]&&wr===nr[1]:yr===nr[1]}function mr(yr){return tr.indexOf(yr)!==-1}function fr(){this.isLoaded=!0}var _r=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};_r.isModifier=gr,_r.isZeroWidthJoiner=vr,_r.isCombinedCharacter=mr;var Ar={addChars:ur,addFonts:cr,getCharData:dr,getFontByName:pr,measureText:hr,checkLoadedFonts:or,setIsLoaded:fr};return _r.prototype=Ar,_r}();RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(rr){this.renderableComponents.indexOf(rr)===-1&&this.renderableComponents.push(rr)},removeRenderableComponent:function(rr){this.renderableComponents.indexOf(rr)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(rr),1)},prepareRenderableFrame:function(rr){this.checkLayerLimits(rr)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(rr){this.data.ip-this.data.st<=rr&&this.data.op-this.data.st>rr?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var rr,er=this.renderableComponents.length;for(rr=0;rr<er;rr+=1)this.renderableComponents[rr].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};const MaskManagerInterface=function(){function rr(tr,ir){this._mask=tr,this._data=ir}Object.defineProperty(rr.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(rr.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var er=function(tr){var ir=createSizedArray(tr.viewData.length),nr,sr=tr.viewData.length;for(nr=0;nr<sr;nr+=1)ir[nr]=new rr(tr.viewData[nr],tr.masksProperties[nr]);var ar=function(or){for(nr=0;nr<sr;){if(tr.masksProperties[nr].nm===or)return ir[nr];nr+=1}return null};return ar};return er}(),ExpressionPropertyInterface=function(){var rr={pv:0,v:0,mult:1},er={pv:[0,0,0],v:[0,0,0],mult:1};function tr(ar,or,lr){Object.defineProperty(ar,"velocity",{get:function(){return or.getVelocityAtTime(or.comp.currentFrame)}}),ar.numKeys=or.keyframes?or.keyframes.length:0,ar.key=function(cr){if(!ar.numKeys)return 0;var ur="";"s"in or.keyframes[cr-1]?ur=or.keyframes[cr-1].s:"e"in or.keyframes[cr-2]?ur=or.keyframes[cr-2].e:ur=or.keyframes[cr-2].s;var dr=lr==="unidimensional"?new Number(ur):Object.assign({},ur);return dr.time=or.keyframes[cr-1].t/or.elem.comp.globalData.frameRate,dr.value=lr==="unidimensional"?ur[0]:ur,dr},ar.valueAtTime=or.getValueAtTime,ar.speedAtTime=or.getSpeedAtTime,ar.velocityAtTime=or.getVelocityAtTime,ar.propertyGroup=or.propertyGroup}function ir(ar){(!ar||!("pv"in ar))&&(ar=rr);var or=1/ar.mult,lr=ar.pv*or,cr=new Number(lr);return cr.value=lr,tr(cr,ar,"unidimensional"),function(){return ar.k&&ar.getValue(),lr=ar.v*or,cr.value!==lr&&(cr=new Number(lr),cr.value=lr,tr(cr,ar,"unidimensional")),cr}}function nr(ar){(!ar||!("pv"in ar))&&(ar=er);var or=1/ar.mult,lr=ar.data&&ar.data.l||ar.pv.length,cr=createTypedArray("float32",lr),ur=createTypedArray("float32",lr);return cr.value=ur,tr(cr,ar,"multidimensional"),function(){ar.k&&ar.getValue();for(var dr=0;dr<lr;dr+=1)ur[dr]=ar.v[dr]*or,cr[dr]=ur[dr];return cr}}function sr(){return rr}return function(ar){return ar?ar.propType==="unidimensional"?ir(ar):nr(ar):sr}}(),TransformExpressionInterface=function(){return function(rr){function er(ar){switch(ar){case"scale":case"Scale":case"ADBE Scale":case 6:return er.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return er.rotation;case"ADBE Rotate X":return er.xRotation;case"ADBE Rotate Y":return er.yRotation;case"position":case"Position":case"ADBE Position":case 2:return er.position;case"ADBE Position_0":return er.xPosition;case"ADBE Position_1":return er.yPosition;case"ADBE Position_2":return er.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return er.anchorPoint;case"opacity":case"Opacity":case 11:return er.opacity;default:return null}}Object.defineProperty(er,"rotation",{get:ExpressionPropertyInterface(rr.r||rr.rz)}),Object.defineProperty(er,"zRotation",{get:ExpressionPropertyInterface(rr.rz||rr.r)}),Object.defineProperty(er,"xRotation",{get:ExpressionPropertyInterface(rr.rx)}),Object.defineProperty(er,"yRotation",{get:ExpressionPropertyInterface(rr.ry)}),Object.defineProperty(er,"scale",{get:ExpressionPropertyInterface(rr.s)});var tr,ir,nr,sr;return rr.p?sr=ExpressionPropertyInterface(rr.p):(tr=ExpressionPropertyInterface(rr.px),ir=ExpressionPropertyInterface(rr.py),rr.pz&&(nr=ExpressionPropertyInterface(rr.pz))),Object.defineProperty(er,"position",{get:function(){return rr.p?sr():[tr(),ir(),nr?nr():0]}}),Object.defineProperty(er,"xPosition",{get:ExpressionPropertyInterface(rr.px)}),Object.defineProperty(er,"yPosition",{get:ExpressionPropertyInterface(rr.py)}),Object.defineProperty(er,"zPosition",{get:ExpressionPropertyInterface(rr.pz)}),Object.defineProperty(er,"anchorPoint",{get:ExpressionPropertyInterface(rr.a)}),Object.defineProperty(er,"opacity",{get:ExpressionPropertyInterface(rr.o)}),Object.defineProperty(er,"skew",{get:ExpressionPropertyInterface(rr.sk)}),Object.defineProperty(er,"skewAxis",{get:ExpressionPropertyInterface(rr.sa)}),Object.defineProperty(er,"orientation",{get:ExpressionPropertyInterface(rr.or)}),er}}(),LayerExpressionInterface=function(){function rr(cr){var ur=new Matrix;if(cr!==void 0){var dr=this._elem.finalTransform.mProp.getValueAtTime(cr);dr.clone(ur)}else{var hr=this._elem.finalTransform.mProp;hr.applyToMatrix(ur)}return ur}function er(cr,ur){var dr=this.getMatrix(ur);return dr.props[12]=0,dr.props[13]=0,dr.props[14]=0,this.applyPoint(dr,cr)}function tr(cr,ur){var dr=this.getMatrix(ur);return this.applyPoint(dr,cr)}function ir(cr,ur){var dr=this.getMatrix(ur);return dr.props[12]=0,dr.props[13]=0,dr.props[14]=0,this.invertPoint(dr,cr)}function nr(cr,ur){var dr=this.getMatrix(ur);return this.invertPoint(dr,cr)}function sr(cr,ur){if(this._elem.hierarchy&&this._elem.hierarchy.length){var dr,hr=this._elem.hierarchy.length;for(dr=0;dr<hr;dr+=1)this._elem.hierarchy[dr].finalTransform.mProp.applyToMatrix(cr)}return cr.applyToPointArray(ur[0],ur[1],ur[2]||0)}function ar(cr,ur){if(this._elem.hierarchy&&this._elem.hierarchy.length){var dr,hr=this._elem.hierarchy.length;for(dr=0;dr<hr;dr+=1)this._elem.hierarchy[dr].finalTransform.mProp.applyToMatrix(cr)}return cr.inversePoint(ur)}function or(cr){var ur=new Matrix;if(ur.reset(),this._elem.finalTransform.mProp.applyToMatrix(ur),this._elem.hierarchy&&this._elem.hierarchy.length){var dr,hr=this._elem.hierarchy.length;for(dr=0;dr<hr;dr+=1)this._elem.hierarchy[dr].finalTransform.mProp.applyToMatrix(ur);return ur.inversePoint(cr)}return ur.inversePoint(cr)}function lr(){return[1,1,1,1]}return function(cr){var ur;function dr(vr){pr.mask=new MaskManagerInterface(vr,cr)}function hr(vr){pr.effect=vr}function pr(vr){switch(vr){case"ADBE Root Vectors Group":case"Contents":case 2:return pr.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return ur;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return pr.effect;case"ADBE Text Properties":return pr.textInterface;default:return null}}pr.getMatrix=rr,pr.invertPoint=ar,pr.applyPoint=sr,pr.toWorld=tr,pr.toWorldVec=er,pr.fromWorld=nr,pr.fromWorldVec=ir,pr.toComp=tr,pr.fromComp=or,pr.sampleImage=lr,pr.sourceRectAtTime=cr.sourceRectAtTime.bind(cr),pr._elem=cr,ur=TransformExpressionInterface(cr.finalTransform.mProp);var gr=getDescriptor(ur,"anchorPoint");return Object.defineProperties(pr,{hasParent:{get:function(){return cr.hierarchy.length}},parent:{get:function(){return cr.hierarchy[0].layerInterface}},rotation:getDescriptor(ur,"rotation"),scale:getDescriptor(ur,"scale"),position:getDescriptor(ur,"position"),opacity:getDescriptor(ur,"opacity"),anchorPoint:gr,anchor_point:gr,transform:{get:function(){return ur}},active:{get:function(){return cr.isInRange}}}),pr.startTime=cr.data.st,pr.index=cr.data.ind,pr.source=cr.data.refId,pr.height=cr.data.ty===0?cr.data.h:100,pr.width=cr.data.ty===0?cr.data.w:100,pr.inPoint=cr.data.ip/cr.comp.globalData.frameRate,pr.outPoint=cr.data.op/cr.comp.globalData.frameRate,pr._name=cr.data.nm,pr.registerMaskInterface=dr,pr.registerEffectsInterface=hr,pr}}(),propertyGroupFactory=function(){return function(rr,er){return function(tr){return tr=tr===void 0?1:tr,tr<=0?rr:er(tr-1)}}}(),PropertyInterface=function(){return function(rr,er){var tr={_name:rr};function ir(nr){return nr=nr===void 0?1:nr,nr<=0?tr:er(nr-1)}return ir}}(),EffectsExpressionInterface=function(){var rr={createEffectsInterface:er};function er(nr,sr){if(nr.effectsManager){var ar=[],or=nr.data.ef,lr,cr=nr.effectsManager.effectElements.length;for(lr=0;lr<cr;lr+=1)ar.push(tr(or[lr],nr.effectsManager.effectElements[lr],sr,nr));var ur=nr.data.ef||[],dr=function(hr){for(lr=0,cr=ur.length;lr<cr;){if(hr===ur[lr].nm||hr===ur[lr].mn||hr===ur[lr].ix)return ar[lr];lr+=1}return null};return Object.defineProperty(dr,"numProperties",{get:function(){return ur.length}}),dr}return null}function tr(nr,sr,ar,or){function lr(pr){for(var gr=nr.ef,vr=0,mr=gr.length;vr<mr;){if(pr===gr[vr].nm||pr===gr[vr].mn||pr===gr[vr].ix)return gr[vr].ty===5?ur[vr]:ur[vr]();vr+=1}throw new Error}var cr=propertyGroupFactory(lr,ar),ur=[],dr,hr=nr.ef.length;for(dr=0;dr<hr;dr+=1)nr.ef[dr].ty===5?ur.push(tr(nr.ef[dr],sr.effectElements[dr],sr.effectElements[dr].propertyGroup,or)):ur.push(ir(sr.effectElements[dr],nr.ef[dr].ty,or,cr));return nr.mn==="ADBE Color Control"&&Object.defineProperty(lr,"color",{get:function(){return ur[0]()}}),Object.defineProperties(lr,{numProperties:{get:function(){return nr.np}},_name:{value:nr.nm},propertyGroup:{value:cr}}),lr.enabled=nr.en!==0,lr.active=lr.enabled,lr}function ir(nr,sr,ar,or){var lr=ExpressionPropertyInterface(nr.p);function cr(){return sr===10?ar.comp.compInterface(nr.p.v):lr()}return nr.p.setGroupProperty&&nr.p.setGroupProperty(PropertyInterface("",or)),cr}return rr}(),CompExpressionInterface=function(){return function(rr){function er(tr){for(var ir=0,nr=rr.layers.length;ir<nr;){if(rr.layers[ir].nm===tr||rr.layers[ir].ind===tr)return rr.elements[ir].layerInterface;ir+=1}return null}return Object.defineProperty(er,"_name",{value:rr.data.nm}),er.layer=er,er.pixelAspect=1,er.height=rr.data.h||rr.globalData.compSize.h,er.width=rr.data.w||rr.globalData.compSize.w,er.pixelAspect=1,er.frameDuration=1/rr.globalData.frameRate,er.displayStartTime=0,er.numLayers=rr.layers.length,er}}(),ShapePathInterface=function(){return function(er,tr,ir){var nr=tr.sh;function sr(or){return or==="Shape"||or==="shape"||or==="Path"||or==="path"||or==="ADBE Vector Shape"||or===2?sr.path:null}var ar=propertyGroupFactory(sr,ir);return nr.setGroupProperty(PropertyInterface("Path",ar)),Object.defineProperties(sr,{path:{get:function(){return nr.k&&nr.getValue(),nr}},shape:{get:function(){return nr.k&&nr.getValue(),nr}},_name:{value:er.nm},ix:{value:er.ix},propertyIndex:{value:er.ix},mn:{value:er.mn},propertyGroup:{value:ir}}),sr}}(),ShapeExpressionInterface=function(){function rr(gr,vr,mr){var fr=[],_r,Ar=gr?gr.length:0;for(_r=0;_r<Ar;_r+=1)gr[_r].ty==="gr"?fr.push(tr(gr[_r],vr[_r],mr)):gr[_r].ty==="fl"?fr.push(ir(gr[_r],vr[_r],mr)):gr[_r].ty==="st"?fr.push(ar(gr[_r],vr[_r],mr)):gr[_r].ty==="tm"?fr.push(or(gr[_r],vr[_r],mr)):gr[_r].ty==="tr"||(gr[_r].ty==="el"?fr.push(cr(gr[_r],vr[_r],mr)):gr[_r].ty==="sr"?fr.push(ur(gr[_r],vr[_r],mr)):gr[_r].ty==="sh"?fr.push(ShapePathInterface(gr[_r],vr[_r],mr)):gr[_r].ty==="rc"?fr.push(dr(gr[_r],vr[_r],mr)):gr[_r].ty==="rd"?fr.push(hr(gr[_r],vr[_r],mr)):gr[_r].ty==="rp"?fr.push(pr(gr[_r],vr[_r],mr)):gr[_r].ty==="gf"?fr.push(nr(gr[_r],vr[_r],mr)):fr.push(sr(gr[_r],vr[_r],mr)));return fr}function er(gr,vr,mr){var fr,_r=function(wr){for(var xr=0,Sr=fr.length;xr<Sr;){if(fr[xr]._name===wr||fr[xr].mn===wr||fr[xr].propertyIndex===wr||fr[xr].ix===wr||fr[xr].ind===wr)return fr[xr];xr+=1}return typeof wr=="number"?fr[wr-1]:null};_r.propertyGroup=propertyGroupFactory(_r,mr),fr=rr(gr.it,vr.it,_r.propertyGroup),_r.numProperties=fr.length;var Ar=lr(gr.it[gr.it.length-1],vr.it[vr.it.length-1],_r.propertyGroup);return _r.transform=Ar,_r.propertyIndex=gr.cix,_r._name=gr.nm,_r}function tr(gr,vr,mr){var fr=function(wr){switch(wr){case"ADBE Vectors Group":case"Contents":case 2:return fr.content;default:return fr.transform}};fr.propertyGroup=propertyGroupFactory(fr,mr);var _r=er(gr,vr,fr.propertyGroup),Ar=lr(gr.it[gr.it.length-1],vr.it[vr.it.length-1],fr.propertyGroup);return fr.content=_r,fr.transform=Ar,Object.defineProperty(fr,"_name",{get:function(){return gr.nm}}),fr.numProperties=gr.np,fr.propertyIndex=gr.ix,fr.nm=gr.nm,fr.mn=gr.mn,fr}function ir(gr,vr,mr){function fr(_r){return _r==="Color"||_r==="color"?fr.color:_r==="Opacity"||_r==="opacity"?fr.opacity:null}return Object.defineProperties(fr,{color:{get:ExpressionPropertyInterface(vr.c)},opacity:{get:ExpressionPropertyInterface(vr.o)},_name:{value:gr.nm},mn:{value:gr.mn}}),vr.c.setGroupProperty(PropertyInterface("Color",mr)),vr.o.setGroupProperty(PropertyInterface("Opacity",mr)),fr}function nr(gr,vr,mr){function fr(_r){return _r==="Start Point"||_r==="start point"?fr.startPoint:_r==="End Point"||_r==="end point"?fr.endPoint:_r==="Opacity"||_r==="opacity"?fr.opacity:null}return Object.defineProperties(fr,{startPoint:{get:ExpressionPropertyInterface(vr.s)},endPoint:{get:ExpressionPropertyInterface(vr.e)},opacity:{get:ExpressionPropertyInterface(vr.o)},type:{get:function(){return"a"}},_name:{value:gr.nm},mn:{value:gr.mn}}),vr.s.setGroupProperty(PropertyInterface("Start Point",mr)),vr.e.setGroupProperty(PropertyInterface("End Point",mr)),vr.o.setGroupProperty(PropertyInterface("Opacity",mr)),fr}function sr(){function gr(){return null}return gr}function ar(gr,vr,mr){var fr=propertyGroupFactory(Sr,mr),_r=propertyGroupFactory(xr,fr);function Ar(br){Object.defineProperty(xr,gr.d[br].nm,{get:ExpressionPropertyInterface(vr.d.dataProps[br].p)})}var yr,wr=gr.d?gr.d.length:0,xr={};for(yr=0;yr<wr;yr+=1)Ar(yr),vr.d.dataProps[yr].p.setGroupProperty(_r);function Sr(br){return br==="Color"||br==="color"?Sr.color:br==="Opacity"||br==="opacity"?Sr.opacity:br==="Stroke Width"||br==="stroke width"?Sr.strokeWidth:null}return Object.defineProperties(Sr,{color:{get:ExpressionPropertyInterface(vr.c)},opacity:{get:ExpressionPropertyInterface(vr.o)},strokeWidth:{get:ExpressionPropertyInterface(vr.w)},dash:{get:function(){return xr}},_name:{value:gr.nm},mn:{value:gr.mn}}),vr.c.setGroupProperty(PropertyInterface("Color",fr)),vr.o.setGroupProperty(PropertyInterface("Opacity",fr)),vr.w.setGroupProperty(PropertyInterface("Stroke Width",fr)),Sr}function or(gr,vr,mr){function fr(Ar){return Ar===gr.e.ix||Ar==="End"||Ar==="end"?fr.end:Ar===gr.s.ix?fr.start:Ar===gr.o.ix?fr.offset:null}var _r=propertyGroupFactory(fr,mr);return fr.propertyIndex=gr.ix,vr.s.setGroupProperty(PropertyInterface("Start",_r)),vr.e.setGroupProperty(PropertyInterface("End",_r)),vr.o.setGroupProperty(PropertyInterface("Offset",_r)),fr.propertyIndex=gr.ix,fr.propertyGroup=mr,Object.defineProperties(fr,{start:{get:ExpressionPropertyInterface(vr.s)},end:{get:ExpressionPropertyInterface(vr.e)},offset:{get:ExpressionPropertyInterface(vr.o)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}function lr(gr,vr,mr){function fr(Ar){return gr.a.ix===Ar||Ar==="Anchor Point"?fr.anchorPoint:gr.o.ix===Ar||Ar==="Opacity"?fr.opacity:gr.p.ix===Ar||Ar==="Position"?fr.position:gr.r.ix===Ar||Ar==="Rotation"||Ar==="ADBE Vector Rotation"?fr.rotation:gr.s.ix===Ar||Ar==="Scale"?fr.scale:gr.sk&&gr.sk.ix===Ar||Ar==="Skew"?fr.skew:gr.sa&&gr.sa.ix===Ar||Ar==="Skew Axis"?fr.skewAxis:null}var _r=propertyGroupFactory(fr,mr);return vr.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",_r)),vr.transform.mProps.p.setGroupProperty(PropertyInterface("Position",_r)),vr.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",_r)),vr.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",_r)),vr.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",_r)),vr.transform.mProps.sk&&(vr.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",_r)),vr.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",_r))),vr.transform.op.setGroupProperty(PropertyInterface("Opacity",_r)),Object.defineProperties(fr,{opacity:{get:ExpressionPropertyInterface(vr.transform.mProps.o)},position:{get:ExpressionPropertyInterface(vr.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(vr.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(vr.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(vr.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(vr.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(vr.transform.mProps.sa)},_name:{value:gr.nm}}),fr.ty="tr",fr.mn=gr.mn,fr.propertyGroup=mr,fr}function cr(gr,vr,mr){function fr(yr){return gr.p.ix===yr?fr.position:gr.s.ix===yr?fr.size:null}var _r=propertyGroupFactory(fr,mr);fr.propertyIndex=gr.ix;var Ar=vr.sh.ty==="tm"?vr.sh.prop:vr.sh;return Ar.s.setGroupProperty(PropertyInterface("Size",_r)),Ar.p.setGroupProperty(PropertyInterface("Position",_r)),Object.defineProperties(fr,{size:{get:ExpressionPropertyInterface(Ar.s)},position:{get:ExpressionPropertyInterface(Ar.p)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}function ur(gr,vr,mr){function fr(yr){return gr.p.ix===yr?fr.position:gr.r.ix===yr?fr.rotation:gr.pt.ix===yr?fr.points:gr.or.ix===yr||yr==="ADBE Vector Star Outer Radius"?fr.outerRadius:gr.os.ix===yr?fr.outerRoundness:gr.ir&&(gr.ir.ix===yr||yr==="ADBE Vector Star Inner Radius")?fr.innerRadius:gr.is&&gr.is.ix===yr?fr.innerRoundness:null}var _r=propertyGroupFactory(fr,mr),Ar=vr.sh.ty==="tm"?vr.sh.prop:vr.sh;return fr.propertyIndex=gr.ix,Ar.or.setGroupProperty(PropertyInterface("Outer Radius",_r)),Ar.os.setGroupProperty(PropertyInterface("Outer Roundness",_r)),Ar.pt.setGroupProperty(PropertyInterface("Points",_r)),Ar.p.setGroupProperty(PropertyInterface("Position",_r)),Ar.r.setGroupProperty(PropertyInterface("Rotation",_r)),gr.ir&&(Ar.ir.setGroupProperty(PropertyInterface("Inner Radius",_r)),Ar.is.setGroupProperty(PropertyInterface("Inner Roundness",_r))),Object.defineProperties(fr,{position:{get:ExpressionPropertyInterface(Ar.p)},rotation:{get:ExpressionPropertyInterface(Ar.r)},points:{get:ExpressionPropertyInterface(Ar.pt)},outerRadius:{get:ExpressionPropertyInterface(Ar.or)},outerRoundness:{get:ExpressionPropertyInterface(Ar.os)},innerRadius:{get:ExpressionPropertyInterface(Ar.ir)},innerRoundness:{get:ExpressionPropertyInterface(Ar.is)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}function dr(gr,vr,mr){function fr(yr){return gr.p.ix===yr?fr.position:gr.r.ix===yr?fr.roundness:gr.s.ix===yr||yr==="Size"||yr==="ADBE Vector Rect Size"?fr.size:null}var _r=propertyGroupFactory(fr,mr),Ar=vr.sh.ty==="tm"?vr.sh.prop:vr.sh;return fr.propertyIndex=gr.ix,Ar.p.setGroupProperty(PropertyInterface("Position",_r)),Ar.s.setGroupProperty(PropertyInterface("Size",_r)),Ar.r.setGroupProperty(PropertyInterface("Rotation",_r)),Object.defineProperties(fr,{position:{get:ExpressionPropertyInterface(Ar.p)},roundness:{get:ExpressionPropertyInterface(Ar.r)},size:{get:ExpressionPropertyInterface(Ar.s)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}function hr(gr,vr,mr){function fr(yr){return gr.r.ix===yr||yr==="Round Corners 1"?fr.radius:null}var _r=propertyGroupFactory(fr,mr),Ar=vr;return fr.propertyIndex=gr.ix,Ar.rd.setGroupProperty(PropertyInterface("Radius",_r)),Object.defineProperties(fr,{radius:{get:ExpressionPropertyInterface(Ar.rd)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}function pr(gr,vr,mr){function fr(yr){return gr.c.ix===yr||yr==="Copies"?fr.copies:gr.o.ix===yr||yr==="Offset"?fr.offset:null}var _r=propertyGroupFactory(fr,mr),Ar=vr;return fr.propertyIndex=gr.ix,Ar.c.setGroupProperty(PropertyInterface("Copies",_r)),Ar.o.setGroupProperty(PropertyInterface("Offset",_r)),Object.defineProperties(fr,{copies:{get:ExpressionPropertyInterface(Ar.c)},offset:{get:ExpressionPropertyInterface(Ar.o)},_name:{value:gr.nm}}),fr.mn=gr.mn,fr}return function(gr,vr,mr){var fr;function _r(yr){if(typeof yr=="number")return yr=yr===void 0?1:yr,yr===0?mr:fr[yr-1];for(var wr=0,xr=fr.length;wr<xr;){if(fr[wr]._name===yr)return fr[wr];wr+=1}return null}function Ar(){return mr}return _r.propertyGroup=propertyGroupFactory(_r,Ar),fr=rr(gr,vr,_r.propertyGroup),_r.numProperties=fr.length,_r._name="Contents",_r}}(),TextExpressionInterface=function(){return function(rr){var er,tr;function ir(nr){switch(nr){case"ADBE Text Document":return ir.sourceText;default:return null}}return Object.defineProperty(ir,"sourceText",{get:function(){rr.textProperty.getValue();var nr=rr.textProperty.currentData.t;return nr!==er&&(rr.textProperty.currentData.t=er,tr=new String(nr),tr.value=nr||new String(nr)),tr}}),ir}}(),getBlendMode=function(){var rr={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(er){return rr[er]||""}}();extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(rr,er){this.data=rr,this.effectElements=[],this.initDynamicPropertyContainer(er);var tr,ir=this.data.ef.length,nr,sr=this.data.ef;for(tr=0;tr<ir;tr+=1){switch(nr=null,sr[tr].ty){case 0:nr=new SliderEffect(sr[tr],er,this);break;case 1:nr=new AngleEffect(sr[tr],er,this);break;case 2:nr=new ColorEffect(sr[tr],er,this);break;case 3:nr=new PointEffect(sr[tr],er,this);break;case 4:case 7:nr=new CheckboxEffect(sr[tr],er,this);break;case 10:nr=new LayerIndexEffect(sr[tr],er,this);break;case 11:nr=new MaskIndexEffect(sr[tr],er,this);break;case 5:nr=new EffectsManager(sr[tr],er,this);break;default:nr=new NoValueEffect(sr[tr],er,this);break}nr&&this.effectElements.push(nr)}},BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var rr=0,er=this.data.masksProperties.length;rr<er;){if(this.data.masksProperties[rr].mode!=="n"&&this.data.masksProperties[rr].cl!==!1)return!0;rr+=1}return!1},initExpressions:function(){this.layerInterface=LayerExpressionInterface(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var rr=EffectsExpressionInterface.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(rr),this.data.ty===0||this.data.xt?this.compInterface=CompExpressionInterface(this):this.data.ty===4?(this.layerInterface.shapeInterface=ShapeExpressionInterface(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=TextExpressionInterface(this),this.layerInterface.text=this.layerInterface.textInterface)},setBlendMode:function(){var rr=getBlendMode(this.data.bm),er=this.baseElement||this.layerElement;er.style["mix-blend-mode"]=rr},initBaseData:function(rr,er,tr){this.globalData=er,this.comp=tr,this.data=rr,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}},FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(rr,er){var tr,ir=this.dynamicProperties.length;for(tr=0;tr<ir;tr+=1)(er||this._isParent&&this.dynamicProperties[tr].propType==="transform")&&(this.dynamicProperties[tr].getValue(),this.dynamicProperties[tr]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(rr){this.dynamicProperties.indexOf(rr)===-1&&this.dynamicProperties.push(rr)}};const FootageInterface=function(){var rr=function(tr){var ir="",nr=tr.getFootageData();function sr(){return ir="",nr=tr.getFootageData(),ar}function ar(or){if(nr[or])return ir=or,nr=nr[or],typeof nr=="object"?ar:nr;var lr=or.indexOf(ir);if(lr!==-1){var cr=parseInt(or.substr(lr+ir.length),10);return nr=nr[cr],typeof nr=="object"?ar:nr}return""}return sr},er=function(tr){function ir(nr){return nr==="Outline"?ir.outlineInterface():null}return ir._name="Outline",ir.outlineInterface=rr(tr),ir};return function(tr){function ir(nr){return nr==="Data"?ir.dataInterface:null}return ir._name="Data",ir.dataInterface=er(tr),ir}}();FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){this.layerInterface=FootageInterface(this)},FootageElement.prototype.getFootageData=function(){return this.footageData},AudioElement.prototype.prepareFrame=function(rr){if(this.prepareRenderableFrame(rr,!0),this.prepareProperties(rr,!0),this.tm._placeholder)this._currentTime=rr/this.data.sr;else{var er=this.tm.v;this._currentTime=er}this._volume=this.lv.v[0];var tr=this._volume*this._volumeMultiplier;this._previousVolume!==tr&&(this._previousVolume=tr,this.audio.volume(tr))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(rr){this.audio.rate(rr)},AudioElement.prototype.volume=function(rr){this._volumeMultiplier=rr,this._previousVolume=rr*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){},BaseRenderer.prototype.checkLayers=function(rr){var er,tr=this.layers.length,ir;for(this.completeLayers=!0,er=tr-1;er>=0;er-=1)this.elements[er]||(ir=this.layers[er],ir.ip-ir.st<=rr-this.layers[er].st&&ir.op-ir.st>rr-this.layers[er].st&&this.buildItem(er)),this.completeLayers=this.elements[er]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(rr){switch(rr.ty){case 2:return this.createImage(rr);case 0:return this.createComp(rr);case 1:return this.createSolid(rr);case 3:return this.createNull(rr);case 4:return this.createShape(rr);case 5:return this.createText(rr);case 6:return this.createAudio(rr);case 13:return this.createCamera(rr);case 15:return this.createFootage(rr);default:return this.createNull(rr)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(rr){return new AudioElement(rr,this.globalData,this)},BaseRenderer.prototype.createFootage=function(rr){return new FootageElement(rr,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var rr,er=this.layers.length;for(rr=0;rr<er;rr+=1)this.buildItem(rr);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(rr){this.completeLayers=!1;var er,tr=rr.length,ir,nr=this.layers.length;for(er=0;er<tr;er+=1)for(ir=0;ir<nr;){if(this.layers[ir].id===rr[er].id){this.layers[ir]=rr[er];break}ir+=1}},BaseRenderer.prototype.setProjectInterface=function(rr){this.globalData.projectInterface=rr},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(rr,er,tr){for(var ir=this.elements,nr=this.layers,sr=0,ar=nr.length;sr<ar;)nr[sr].ind==er&&(!ir[sr]||ir[sr]===!0?(this.buildItem(sr),this.addPendingElement(rr)):(tr.push(ir[sr]),ir[sr].setAsParent(),nr[sr].parent!==void 0?this.buildElementParenting(rr,nr[sr].parent,tr):rr.setHierarchy(tr))),sr+=1},BaseRenderer.prototype.addPendingElement=function(rr){this.pendingElements.push(rr)},BaseRenderer.prototype.searchExtraCompositions=function(rr){var er,tr=rr.length;for(er=0;er<tr;er+=1)if(rr[er].xt){var ir=this.createComp(rr[er]);ir.initExpressions(),this.globalData.projectInterface.registerComposition(ir)}},BaseRenderer.prototype.getElementByPath=function(rr){var er=rr.shift(),tr;if(typeof er=="number")tr=this.elements[er];else{var ir,nr=this.elements.length;for(ir=0;ir<nr;ir+=1)if(this.elements[ir].data.nm===er){tr=this.elements[ir];break}}return rr.length===0?tr:tr.getElementByPath(rr)},BaseRenderer.prototype.setupGlobalData=function(rr,er){this.globalData.fontManager=new FontManager,this.globalData.fontManager.addChars(rr.chars),this.globalData.fontManager.addFonts(rr.fonts,er),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=rr.fr,this.globalData.nm=rr.nm,this.globalData.compSize={w:rr.w,h:rr.h}},TransformElement.prototype={initTransform:function(){this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_opMdf:!1,mat:new Matrix},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var rr,er=this.finalTransform.mat,tr=0,ir=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;tr<ir;){if(this.hierarchy[tr].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}tr+=1}if(this.finalTransform._matMdf)for(rr=this.finalTransform.mProp.v.props,er.cloneFromProps(rr),tr=0;tr<ir;tr+=1)rr=this.hierarchy[tr].finalTransform.mProp.v.props,er.transform(rr[0],rr[1],rr[2],rr[3],rr[4],rr[5],rr[6],rr[7],rr[8],rr[9],rr[10],rr[11],rr[12],rr[13],rr[14],rr[15])}},globalToLocal:function(rr){var er=[];er.push(this.finalTransform);for(var tr=!0,ir=this.comp;tr;)ir.finalTransform?(ir.data.hasMask&&er.splice(0,0,ir.finalTransform),ir=ir.comp):tr=!1;var nr,sr=er.length,ar;for(nr=0;nr<sr;nr+=1)ar=er[nr].mat.applyToPointArray(0,0,0),rr=[rr[0]-ar[0],rr[1]-ar[1],0];return rr},mHelper:new Matrix},MaskElement.prototype.getMaskProperty=function(rr){return this.viewData[rr].prop},MaskElement.prototype.renderFrame=function(rr){var er=this.element.finalTransform.mat,tr,ir=this.masksProperties.length;for(tr=0;tr<ir;tr+=1)if((this.viewData[tr].prop._mdf||rr)&&this.drawPath(this.masksProperties[tr],this.viewData[tr].prop.v,this.viewData[tr]),(this.viewData[tr].op._mdf||rr)&&this.viewData[tr].elem.setAttribute("fill-opacity",this.viewData[tr].op.v),this.masksProperties[tr].mode!=="n"&&(this.viewData[tr].invRect&&(this.element.finalTransform.mProp._mdf||rr)&&this.viewData[tr].invRect.setAttribute("transform",er.getInverseMatrix().to2dCSS()),this.storedData[tr].x&&(this.storedData[tr].x._mdf||rr))){var nr=this.storedData[tr].expan;this.storedData[tr].x.v<0?(this.storedData[tr].lastOperator!=="erode"&&(this.storedData[tr].lastOperator="erode",this.storedData[tr].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[tr].filterId+")")),nr.setAttribute("radius",-this.storedData[tr].x.v)):(this.storedData[tr].lastOperator!=="dilate"&&(this.storedData[tr].lastOperator="dilate",this.storedData[tr].elem.setAttribute("filter",null)),this.storedData[tr].elem.setAttribute("stroke-width",this.storedData[tr].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var rr="M0,0 ";return rr+=" h"+this.globalData.compSize.w,rr+=" v"+this.globalData.compSize.h,rr+=" h-"+this.globalData.compSize.w,rr+=" v-"+this.globalData.compSize.h+" ",rr},MaskElement.prototype.drawPath=function(rr,er,tr){var ir=" M"+er.v[0][0]+","+er.v[0][1],nr,sr;for(sr=er._length,nr=1;nr<sr;nr+=1)ir+=" C"+er.o[nr-1][0]+","+er.o[nr-1][1]+" "+er.i[nr][0]+","+er.i[nr][1]+" "+er.v[nr][0]+","+er.v[nr][1];if(er.c&&sr>1&&(ir+=" C"+er.o[nr-1][0]+","+er.o[nr-1][1]+" "+er.i[0][0]+","+er.i[0][1]+" "+er.v[0][0]+","+er.v[0][1]),tr.lastPath!==ir){var ar="";tr.elem&&(er.c&&(ar=rr.inv?this.solidPath+ir:ir),tr.elem.setAttribute("d",ar)),tr.lastPath=ir}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};const filtersFactory=function(){var rr={};rr.createFilter=er,rr.createAlphaToLuminanceFilter=tr;function er(ir,nr){var sr=createNS("filter");return sr.setAttribute("id",ir),nr!==!0&&(sr.setAttribute("filterUnits","objectBoundingBox"),sr.setAttribute("x","0%"),sr.setAttribute("y","0%"),sr.setAttribute("width","100%"),sr.setAttribute("height","100%")),sr}function tr(){var ir=createNS("feColorMatrix");return ir.setAttribute("type","matrix"),ir.setAttribute("color-interpolation-filters","sRGB"),ir.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),ir}return rr}(),featureSupport=function(){var rr={maskType:!0};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(rr.maskType=!1),rr}();var registeredEffects={},idPrefix="filter_result_";SVGEffects.prototype.renderFrame=function(rr){var er,tr=this.filters.length;for(er=0;er<tr;er+=1)this.filters[er].renderFrame(rr)},SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var rr=null,er,tr,ir;if(this.data.td){if(this.data.td==3||this.data.td==1){var nr=createNS("mask");nr.setAttribute("id",this.layerId),nr.setAttribute("mask-type",this.data.td==3?"luminance":"alpha"),nr.appendChild(this.layerElement),rr=nr,this.globalData.defs.appendChild(nr),!featureSupport.maskType&&this.data.td==1&&(nr.setAttribute("mask-type","luminance"),er=createElementID(),tr=filtersFactory.createFilter(er),this.globalData.defs.appendChild(tr),tr.appendChild(filtersFactory.createAlphaToLuminanceFilter()),ir=createNS("g"),ir.appendChild(this.layerElement),rr=ir,nr.appendChild(ir),ir.setAttribute("filter","url("+getLocationHref()+"#"+er+")"))}else if(this.data.td==2){var sr=createNS("mask");sr.setAttribute("id",this.layerId),sr.setAttribute("mask-type","alpha");var ar=createNS("g");sr.appendChild(ar),er=createElementID(),tr=filtersFactory.createFilter(er);var or=createNS("feComponentTransfer");or.setAttribute("in","SourceGraphic"),tr.appendChild(or);var lr=createNS("feFuncA");lr.setAttribute("type","table"),lr.setAttribute("tableValues","1.0 0.0"),or.appendChild(lr),this.globalData.defs.appendChild(tr);var cr=createNS("rect");cr.setAttribute("width",this.comp.data.w),cr.setAttribute("height",this.comp.data.h),cr.setAttribute("x","0"),cr.setAttribute("y","0"),cr.setAttribute("fill","#ffffff"),cr.setAttribute("opacity","0"),ar.setAttribute("filter","url("+getLocationHref()+"#"+er+")"),ar.appendChild(cr),ar.appendChild(this.layerElement),rr=ar,featureSupport.maskType||(sr.setAttribute("mask-type","luminance"),tr.appendChild(filtersFactory.createAlphaToLuminanceFilter()),ir=createNS("g"),ar.appendChild(cr),ir.appendChild(this.layerElement),rr=ir,ar.appendChild(ir)),this.globalData.defs.appendChild(sr)}}else this.data.tt?(this.matteElement.appendChild(this.layerElement),rr=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var ur=createNS("clipPath"),dr=createNS("path");dr.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var hr=createElementID();if(ur.setAttribute("id",hr),ur.appendChild(dr),this.globalData.defs.appendChild(ur),this.checkMasks()){var pr=createNS("g");pr.setAttribute("clip-path","url("+getLocationHref()+"#"+hr+")"),pr.appendChild(this.layerElement),this.transformedElement=pr,rr?rr.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+hr+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._matMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.mat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.mProp.o.v)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this)},setMatte:function(rr){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+rr+")")}},HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(rr){this.hierarchy=rr},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}},function(){var rr={initElement:function(er,tr,ir){this.initFrame(),this.initBaseData(er,tr,ir),this.initTransform(er,tr,ir),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var er=this.baseElement||this.layerElement;er.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var er=this.baseElement||this.layerElement;er.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(er){this._mdf=!1,this.prepareRenderableFrame(er),this.prepareProperties(er,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(rr)],RenderableDOMElement)}(),extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var rr=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",rr),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect},IShapeElement.prototype={addShapeToModifiers:function(rr){var er,tr=this.shapeModifiers.length;for(er=0;er<tr;er+=1)this.shapeModifiers[er].addShape(rr)},isShapeInAnimatedModifiers:function(rr){for(var er=0,tr=this.shapeModifiers.length;er<tr;)if(this.shapeModifiers[er].isAnimatedWithShape(rr))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var rr,er=this.shapes.length;for(rr=0;rr<er;rr+=1)this.shapes[rr].sh.reset();er=this.shapeModifiers.length;var tr;for(rr=er-1;rr>=0&&(tr=this.shapeModifiers[rr].processShapes(this._isFirstFrame),!tr);rr-=1);}},searchProcessedElement:function(rr){for(var er=this.processedElements,tr=0,ir=er.length;tr<ir;){if(er[tr].elem===rr)return er[tr].pos;tr+=1}return 0},addProcessedElement:function(rr,er){for(var tr=this.processedElements,ir=tr.length;ir;)if(ir-=1,tr[ir].elem===rr){tr[ir].pos=er;return}tr.push(new ProcessedElement(rr,er))},prepareFrame:function(rr){this.prepareRenderableFrame(rr),this.prepareProperties(rr,this.isInRange)}};const lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0},SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1},DashProperty.prototype.getValue=function(rr){if(!(this.elem.globalData.frameId===this.frameId&&!rr)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||rr,this._mdf)){var er=0,tr=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),er=0;er<tr;er+=1)this.dataProps[er].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[er].p.v:this.dashArray[er]=this.dataProps[er].p.v:this.dashoffset[0]=this.dataProps[er].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty),extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData),extendPrototype([DynamicPropertyContainer],SVGFillStyleData),extendPrototype([DynamicPropertyContainer],SVGNoStyleData),GradientProperty.prototype.comparePoints=function(rr,er){for(var tr=0,ir=this.o.length/2,nr;tr<ir;){if(nr=Math.abs(rr[tr*4]-rr[er*4+tr*2]),nr>.01)return!1;tr+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var rr=0,er=this.data.k.k.length;rr<er;){if(!this.comparePoints(this.data.k.k[rr].s,this.data.p))return!1;rr+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(rr){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||rr){var er,tr=this.data.p*4,ir,nr;for(er=0;er<tr;er+=1)ir=er%4===0?100:255,nr=Math.round(this.prop.v[er]*ir),this.c[er]!==nr&&(this.c[er]=nr,this._cmdf=!rr);if(this.o.length)for(tr=this.prop.v.length,er=this.data.p*4;er<tr;er+=1)ir=er%2===0?100:1,nr=er%2===0?Math.round(this.prop.v[er]*100):this.prop.v[er],this.o[er-this.data.p*4]!==nr&&(this.o[er-this.data.p*4]=nr,this._omdf=!rr);this._mdf=!rr}},extendPrototype([DynamicPropertyContainer],GradientProperty),SVGGradientFillStyleData.prototype.initGradientData=function(rr,er,tr){this.o=PropertyFactory.getProp(rr,er.o,0,.01,this),this.s=PropertyFactory.getProp(rr,er.s,1,null,this),this.e=PropertyFactory.getProp(rr,er.e,1,null,this),this.h=PropertyFactory.getProp(rr,er.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(rr,er.a||{k:0},0,degToRads,this),this.g=new GradientProperty(rr,er.g,this),this.style=tr,this.stops=[],this.setGradientData(tr.pElem,er),this.setGradientOpacity(er,tr),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(rr,er){var tr=createElementID(),ir=createNS(er.t===1?"linearGradient":"radialGradient");ir.setAttribute("id",tr),ir.setAttribute("spreadMethod","pad"),ir.setAttribute("gradientUnits","userSpaceOnUse");var nr=[],sr,ar,or;for(or=er.g.p*4,ar=0;ar<or;ar+=4)sr=createNS("stop"),ir.appendChild(sr),nr.push(sr);rr.setAttribute(er.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+tr+")"),this.gf=ir,this.cst=nr},SVGGradientFillStyleData.prototype.setGradientOpacity=function(rr,er){if(this.g._hasOpacity&&!this.g._collapsable){var tr,ir,nr,sr=createNS("mask"),ar=createNS("path");sr.appendChild(ar);var or=createElementID(),lr=createElementID();sr.setAttribute("id",lr);var cr=createNS(rr.t===1?"linearGradient":"radialGradient");cr.setAttribute("id",or),cr.setAttribute("spreadMethod","pad"),cr.setAttribute("gradientUnits","userSpaceOnUse"),nr=rr.g.k.k[0].s?rr.g.k.k[0].s.length:rr.g.k.k.length;var ur=this.stops;for(ir=rr.g.p*4;ir<nr;ir+=2)tr=createNS("stop"),tr.setAttribute("stop-color","rgb(255,255,255)"),cr.appendChild(tr),ur.push(tr);ar.setAttribute(rr.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+or+")"),rr.ty==="gs"&&(ar.setAttribute("stroke-linecap",lineCapEnum[rr.lc||2]),ar.setAttribute("stroke-linejoin",lineJoinEnum[rr.lj||2]),rr.lj===1&&ar.setAttribute("stroke-miterlimit",rr.ml)),this.of=cr,this.ms=sr,this.ost=ur,this.maskId=lr,er.msElem=ar}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData),extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);const buildShapeString=function(rr,er,tr,ir){if(er===0)return"";var nr=rr.o,sr=rr.i,ar=rr.v,or,lr=" M"+ir.applyToPointStringified(ar[0][0],ar[0][1]);for(or=1;or<er;or+=1)lr+=" C"+ir.applyToPointStringified(nr[or-1][0],nr[or-1][1])+" "+ir.applyToPointStringified(sr[or][0],sr[or][1])+" "+ir.applyToPointStringified(ar[or][0],ar[or][1]);return tr&&er&&(lr+=" C"+ir.applyToPointStringified(nr[or-1][0],nr[or-1][1])+" "+ir.applyToPointStringified(sr[0][0],sr[0][1])+" "+ir.applyToPointStringified(ar[0][0],ar[0][1]),lr+="z"),lr},SVGElementsRenderer=function(){var rr=new Matrix,er=new Matrix,tr={createRenderFunction:ir};function ir(dr){switch(dr.ty){case"fl":return or;case"gf":return cr;case"gs":return lr;case"st":return ur;case"sh":case"el":case"rc":case"sr":return ar;case"tr":return nr;case"no":return sr;default:return null}}function nr(dr,hr,pr){(pr||hr.transform.op._mdf)&&hr.transform.container.setAttribute("opacity",hr.transform.op.v),(pr||hr.transform.mProps._mdf)&&hr.transform.container.setAttribute("transform",hr.transform.mProps.v.to2dCSS())}function sr(){}function ar(dr,hr,pr){var gr,vr,mr,fr,_r,Ar,yr=hr.styles.length,wr=hr.lvl,xr,Sr,br,Cr,Ir;for(Ar=0;Ar<yr;Ar+=1){if(fr=hr.sh._mdf||pr,hr.styles[Ar].lvl<wr){for(Sr=er.reset(),Cr=wr-hr.styles[Ar].lvl,Ir=hr.transformers.length-1;!fr&&Cr>0;)fr=hr.transformers[Ir].mProps._mdf||fr,Cr-=1,Ir-=1;if(fr)for(Cr=wr-hr.styles[Ar].lvl,Ir=hr.transformers.length-1;Cr>0;)br=hr.transformers[Ir].mProps.v.props,Sr.transform(br[0],br[1],br[2],br[3],br[4],br[5],br[6],br[7],br[8],br[9],br[10],br[11],br[12],br[13],br[14],br[15]),Cr-=1,Ir-=1}else Sr=rr;if(xr=hr.sh.paths,vr=xr._length,fr){for(mr="",gr=0;gr<vr;gr+=1)_r=xr.shapes[gr],_r&&_r._length&&(mr+=buildShapeString(_r,_r._length,_r.c,Sr));hr.caches[Ar]=mr}else mr=hr.caches[Ar];hr.styles[Ar].d+=dr.hd===!0?"":mr,hr.styles[Ar]._mdf=fr||hr.styles[Ar]._mdf}}function or(dr,hr,pr){var gr=hr.style;(hr.c._mdf||pr)&&gr.pElem.setAttribute("fill","rgb("+bmFloor(hr.c.v[0])+","+bmFloor(hr.c.v[1])+","+bmFloor(hr.c.v[2])+")"),(hr.o._mdf||pr)&&gr.pElem.setAttribute("fill-opacity",hr.o.v)}function lr(dr,hr,pr){cr(dr,hr,pr),ur(dr,hr,pr)}function cr(dr,hr,pr){var gr=hr.gf,vr=hr.g._hasOpacity,mr=hr.s.v,fr=hr.e.v;if(hr.o._mdf||pr){var _r=dr.ty==="gf"?"fill-opacity":"stroke-opacity";hr.style.pElem.setAttribute(_r,hr.o.v)}if(hr.s._mdf||pr){var Ar=dr.t===1?"x1":"cx",yr=Ar==="x1"?"y1":"cy";gr.setAttribute(Ar,mr[0]),gr.setAttribute(yr,mr[1]),vr&&!hr.g._collapsable&&(hr.of.setAttribute(Ar,mr[0]),hr.of.setAttribute(yr,mr[1]))}var wr,xr,Sr,br;if(hr.g._cmdf||pr){wr=hr.cst;var Cr=hr.g.c;for(Sr=wr.length,xr=0;xr<Sr;xr+=1)br=wr[xr],br.setAttribute("offset",Cr[xr*4]+"%"),br.setAttribute("stop-color","rgb("+Cr[xr*4+1]+","+Cr[xr*4+2]+","+Cr[xr*4+3]+")")}if(vr&&(hr.g._omdf||pr)){var Ir=hr.g.o;for(hr.g._collapsable?wr=hr.cst:wr=hr.ost,Sr=wr.length,xr=0;xr<Sr;xr+=1)br=wr[xr],hr.g._collapsable||br.setAttribute("offset",Ir[xr*2]+"%"),br.setAttribute("stop-opacity",Ir[xr*2+1])}if(dr.t===1)(hr.e._mdf||pr)&&(gr.setAttribute("x2",fr[0]),gr.setAttribute("y2",fr[1]),vr&&!hr.g._collapsable&&(hr.of.setAttribute("x2",fr[0]),hr.of.setAttribute("y2",fr[1])));else{var Rr;if((hr.s._mdf||hr.e._mdf||pr)&&(Rr=Math.sqrt(Math.pow(mr[0]-fr[0],2)+Math.pow(mr[1]-fr[1],2)),gr.setAttribute("r",Rr),vr&&!hr.g._collapsable&&hr.of.setAttribute("r",Rr)),hr.e._mdf||hr.h._mdf||hr.a._mdf||pr){Rr||(Rr=Math.sqrt(Math.pow(mr[0]-fr[0],2)+Math.pow(mr[1]-fr[1],2)));var Pr=Math.atan2(fr[1]-mr[1],fr[0]-mr[0]),Dr=hr.h.v;Dr>=1?Dr=.99:Dr<=-1&&(Dr=-.99);var Fr=Rr*Dr,Or=Math.cos(Pr+hr.a.v)*Fr+mr[0],Nr=Math.sin(Pr+hr.a.v)*Fr+mr[1];gr.setAttribute("fx",Or),gr.setAttribute("fy",Nr),vr&&!hr.g._collapsable&&(hr.of.setAttribute("fx",Or),hr.of.setAttribute("fy",Nr))}}}function ur(dr,hr,pr){var gr=hr.style,vr=hr.d;vr&&(vr._mdf||pr)&&vr.dashStr&&(gr.pElem.setAttribute("stroke-dasharray",vr.dashStr),gr.pElem.setAttribute("stroke-dashoffset",vr.dashoffset[0])),hr.c&&(hr.c._mdf||pr)&&gr.pElem.setAttribute("stroke","rgb("+bmFloor(hr.c.v[0])+","+bmFloor(hr.c.v[1])+","+bmFloor(hr.c.v[2])+")"),(hr.o._mdf||pr)&&gr.pElem.setAttribute("stroke-opacity",hr.o.v),(hr.w._mdf||pr)&&(gr.pElem.setAttribute("stroke-width",hr.w.v),gr.msElem&&gr.msElem.setAttribute("stroke-width",hr.w.v))}return tr}();extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var rr,er=this.shapes.length,tr,ir,nr=this.stylesList.length,sr,ar=[],or=!1;for(ir=0;ir<nr;ir+=1){for(sr=this.stylesList[ir],or=!1,ar.length=0,rr=0;rr<er;rr+=1)tr=this.shapes[rr],tr.styles.indexOf(sr)!==-1&&(ar.push(tr),or=tr._isAnimated||or);ar.length>1&&or&&this.setShapesAsAnimated(ar)}},SVGShapeElement.prototype.setShapesAsAnimated=function(rr){var er,tr=rr.length;for(er=0;er<tr;er+=1)rr[er].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(rr,er){var tr,ir=new SVGStyleData(rr,er),nr=ir.pElem;if(rr.ty==="st")tr=new SVGStrokeStyleData(this,rr,ir);else if(rr.ty==="fl")tr=new SVGFillStyleData(this,rr,ir);else if(rr.ty==="gf"||rr.ty==="gs"){var sr=rr.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;tr=new sr(this,rr,ir),this.globalData.defs.appendChild(tr.gf),tr.maskId&&(this.globalData.defs.appendChild(tr.ms),this.globalData.defs.appendChild(tr.of),nr.setAttribute("mask","url("+getLocationHref()+"#"+tr.maskId+")"))}else rr.ty==="no"&&(tr=new SVGNoStyleData(this,rr,ir));return(rr.ty==="st"||rr.ty==="gs")&&(nr.setAttribute("stroke-linecap",lineCapEnum[rr.lc||2]),nr.setAttribute("stroke-linejoin",lineJoinEnum[rr.lj||2]),nr.setAttribute("fill-opacity","0"),rr.lj===1&&nr.setAttribute("stroke-miterlimit",rr.ml)),rr.r===2&&nr.setAttribute("fill-rule","evenodd"),rr.ln&&nr.setAttribute("id",rr.ln),rr.cl&&nr.setAttribute("class",rr.cl),rr.bm&&(nr.style["mix-blend-mode"]=getBlendMode(rr.bm)),this.stylesList.push(ir),this.addToAnimatedContents(rr,tr),tr},SVGShapeElement.prototype.createGroupElement=function(rr){var er=new ShapeGroupData;return rr.ln&&er.gr.setAttribute("id",rr.ln),rr.cl&&er.gr.setAttribute("class",rr.cl),rr.bm&&(er.gr.style["mix-blend-mode"]=getBlendMode(rr.bm)),er},SVGShapeElement.prototype.createTransformElement=function(rr,er){var tr=TransformPropertyFactory.getTransformProperty(this,rr,this),ir=new SVGTransformData(tr,tr.o,er);return this.addToAnimatedContents(rr,ir),ir},SVGShapeElement.prototype.createShapeElement=function(rr,er,tr){var ir=4;rr.ty==="rc"?ir=5:rr.ty==="el"?ir=6:rr.ty==="sr"&&(ir=7);var nr=ShapePropertyFactory.getShapeProp(this,rr,ir,this),sr=new SVGShapeData(er,tr,nr);return this.shapes.push(sr),this.addShapeToModifiers(sr),this.addToAnimatedContents(rr,sr),sr},SVGShapeElement.prototype.addToAnimatedContents=function(rr,er){for(var tr=0,ir=this.animatedContents.length;tr<ir;){if(this.animatedContents[tr].element===er)return;tr+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(rr),element:er,data:rr})},SVGShapeElement.prototype.setElementStyles=function(rr){var er=rr.styles,tr,ir=this.stylesList.length;for(tr=0;tr<ir;tr+=1)this.stylesList[tr].closed||er.push(this.stylesList[tr])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var rr,er=this.itemsData.length;for(rr=0;rr<er;rr+=1)this.prevViewData[rr]=this.itemsData[rr];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),er=this.dynamicProperties.length,rr=0;rr<er;rr+=1)this.dynamicProperties[rr].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(rr,er,tr,ir,nr,sr,ar){var or=[].concat(sr),lr,cr=rr.length-1,ur,dr,hr=[],pr=[],gr,vr,mr;for(lr=cr;lr>=0;lr-=1){if(mr=this.searchProcessedElement(rr[lr]),mr?er[lr]=tr[mr-1]:rr[lr]._render=ar,rr[lr].ty==="fl"||rr[lr].ty==="st"||rr[lr].ty==="gf"||rr[lr].ty==="gs"||rr[lr].ty==="no")mr?er[lr].style.closed=!1:er[lr]=this.createStyleElement(rr[lr],nr),rr[lr]._render&&er[lr].style.pElem.parentNode!==ir&&ir.appendChild(er[lr].style.pElem),hr.push(er[lr].style);else if(rr[lr].ty==="gr"){if(!mr)er[lr]=this.createGroupElement(rr[lr]);else for(dr=er[lr].it.length,ur=0;ur<dr;ur+=1)er[lr].prevViewData[ur]=er[lr].it[ur];this.searchShapes(rr[lr].it,er[lr].it,er[lr].prevViewData,er[lr].gr,nr+1,or,ar),rr[lr]._render&&er[lr].gr.parentNode!==ir&&ir.appendChild(er[lr].gr)}else rr[lr].ty==="tr"?(mr||(er[lr]=this.createTransformElement(rr[lr],ir)),gr=er[lr].transform,or.push(gr)):rr[lr].ty==="sh"||rr[lr].ty==="rc"||rr[lr].ty==="el"||rr[lr].ty==="sr"?(mr||(er[lr]=this.createShapeElement(rr[lr],or,nr)),this.setElementStyles(er[lr])):rr[lr].ty==="tm"||rr[lr].ty==="rd"||rr[lr].ty==="ms"||rr[lr].ty==="pb"?(mr?(vr=er[lr],vr.closed=!1):(vr=ShapeModifiers.getModifier(rr[lr].ty),vr.init(this,rr[lr]),er[lr]=vr,this.shapeModifiers.push(vr)),pr.push(vr)):rr[lr].ty==="rp"&&(mr?(vr=er[lr],vr.closed=!0):(vr=ShapeModifiers.getModifier(rr[lr].ty),er[lr]=vr,vr.init(this,rr,lr,er),this.shapeModifiers.push(vr),ar=!1),pr.push(vr));this.addProcessedElement(rr[lr],lr+1)}for(cr=hr.length,lr=0;lr<cr;lr+=1)hr[lr].closed=!0;for(cr=pr.length,lr=0;lr<cr;lr+=1)pr[lr].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var rr,er=this.stylesList.length;for(rr=0;rr<er;rr+=1)this.stylesList[rr].reset();for(this.renderShape(),rr=0;rr<er;rr+=1)(this.stylesList[rr]._mdf||this._isFirstFrame)&&(this.stylesList[rr].msElem&&(this.stylesList[rr].msElem.setAttribute("d",this.stylesList[rr].d),this.stylesList[rr].d="M0 0"+this.stylesList[rr].d),this.stylesList[rr].pElem.setAttribute("d",this.stylesList[rr].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var rr,er=this.animatedContents.length,tr;for(rr=0;rr<er;rr+=1)tr=this.animatedContents[rr],(this._isFirstFrame||tr.element._isAnimated)&&tr.data!==!0&&tr.fn(tr.data,tr.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null},LetterProps.prototype.update=function(rr,er,tr,ir,nr,sr){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var ar=!1;return this.o!==rr&&(this.o=rr,this._mdf.o=!0,ar=!0),this.sw!==er&&(this.sw=er,this._mdf.sw=!0,ar=!0),this.sc!==tr&&(this.sc=tr,this._mdf.sc=!0,ar=!0),this.fc!==ir&&(this.fc=ir,this._mdf.fc=!0,ar=!0),this.m!==nr&&(this.m=nr,this._mdf.m=!0,ar=!0),sr.length&&(this.p[0]!==sr[0]||this.p[1]!==sr[1]||this.p[4]!==sr[4]||this.p[5]!==sr[5]||this.p[12]!==sr[12]||this.p[13]!==sr[13])&&(this.p=sr,this._mdf.p=!0,ar=!0),ar},TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(rr,er){for(var tr in er)Object.prototype.hasOwnProperty.call(er,tr)&&(rr[tr]=er[tr]);return rr},TextProperty.prototype.setCurrentData=function(rr){rr.__complete||this.completeTextData(rr),this.currentData=rr,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(rr){this.effectsSequence.push(rr),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(rr){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!rr)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var er=this.currentData,tr=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var ir,nr=this.effectsSequence.length,sr=rr||this.data.d.k[this.keysIndex].s;for(ir=0;ir<nr;ir+=1)tr!==this.keysIndex?sr=this.effectsSequence[ir](sr,sr.t):sr=this.effectsSequence[ir](this.currentData,sr.t);er!==sr&&this.setCurrentData(sr),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var rr=this.data.d.k,er=this.elem.comp.renderedFrame,tr=0,ir=rr.length;tr<=ir-1&&!(tr===ir-1||rr[tr+1].t>er);)tr+=1;return this.keysIndex!==tr&&(this.keysIndex=tr),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(rr){for(var er=[],tr=0,ir=rr.length,nr,sr,ar=!1;tr<ir;)nr=rr.charCodeAt(tr),FontManager.isCombinedCharacter(nr)?er[er.length-1]+=rr.charAt(tr):nr>=55296&&nr<=56319?(sr=rr.charCodeAt(tr+1),sr>=56320&&sr<=57343?(ar||FontManager.isModifier(nr,sr)?(er[er.length-1]+=rr.substr(tr,2),ar=!1):er.push(rr.substr(tr,2)),tr+=1):er.push(rr.charAt(tr))):nr>56319?(sr=rr.charCodeAt(tr+1),FontManager.isZeroWidthJoiner(nr,sr)?(ar=!0,er[er.length-1]+=rr.substr(tr,2),tr+=1):er.push(rr.charAt(tr))):FontManager.isZeroWidthJoiner(nr)?(er[er.length-1]+=rr.charAt(tr),ar=!0):er.push(rr.charAt(tr)),tr+=1;return er},TextProperty.prototype.completeTextData=function(rr){rr.__complete=!0;var er=this.elem.globalData.fontManager,tr=this.data,ir=[],nr,sr,ar,or=0,lr,cr=tr.m.g,ur=0,dr=0,hr=0,pr=[],gr=0,vr=0,mr,fr,_r=er.getFontByName(rr.f),Ar,yr=0,wr=getFontProperties(_r);rr.fWeight=wr.weight,rr.fStyle=wr.style,rr.finalSize=rr.s,rr.finalText=this.buildFinalText(rr.t),sr=rr.finalText.length,rr.finalLineHeight=rr.lh;var xr=rr.tr/1e3*rr.finalSize,Sr;if(rr.sz)for(var br=!0,Cr=rr.sz[0],Ir=rr.sz[1],Rr,Pr;br;){Pr=this.buildFinalText(rr.t),Rr=0,gr=0,sr=Pr.length,xr=rr.tr/1e3*rr.finalSize;var Dr=-1;for(nr=0;nr<sr;nr+=1)Sr=Pr[nr].charCodeAt(0),ar=!1,Pr[nr]===" "?Dr=nr:(Sr===13||Sr===3)&&(gr=0,ar=!0,Rr+=rr.finalLineHeight||rr.finalSize*1.2),er.chars?(Ar=er.getCharData(Pr[nr],_r.fStyle,_r.fFamily),yr=ar?0:Ar.w*rr.finalSize/100):yr=er.measureText(Pr[nr],rr.f,rr.finalSize),gr+yr>Cr&&Pr[nr]!==" "?(Dr===-1?sr+=1:nr=Dr,Rr+=rr.finalLineHeight||rr.finalSize*1.2,Pr.splice(nr,Dr===nr?1:0,"\r"),Dr=-1,gr=0):(gr+=yr,gr+=xr);Rr+=_r.ascent*rr.finalSize/100,this.canResize&&rr.finalSize>this.minimumFontSize&&Ir<Rr?(rr.finalSize-=1,rr.finalLineHeight=rr.finalSize*rr.lh/rr.s):(rr.finalText=Pr,sr=rr.finalText.length,br=!1)}gr=-xr,yr=0;var Fr=0,Or;for(nr=0;nr<sr;nr+=1)if(ar=!1,Or=rr.finalText[nr],Sr=Or.charCodeAt(0),Sr===13||Sr===3?(Fr=0,pr.push(gr),vr=gr>vr?gr:vr,gr=-2*xr,lr="",ar=!0,hr+=1):lr=Or,er.chars?(Ar=er.getCharData(Or,_r.fStyle,er.getFontByName(rr.f).fFamily),yr=ar?0:Ar.w*rr.finalSize/100):yr=er.measureText(lr,rr.f,rr.finalSize),Or===" "?Fr+=yr+xr:(gr+=yr+xr+Fr,Fr=0),ir.push({l:yr,an:yr,add:ur,n:ar,anIndexes:[],val:lr,line:hr,animatorJustifyOffset:0}),cr==2){if(ur+=yr,lr===""||lr===" "||nr===sr-1){for((lr===""||lr===" ")&&(ur-=yr);dr<=nr;)ir[dr].an=ur,ir[dr].ind=or,ir[dr].extra=yr,dr+=1;or+=1,ur=0}}else if(cr==3){if(ur+=yr,lr===""||nr===sr-1){for(lr===""&&(ur-=yr);dr<=nr;)ir[dr].an=ur,ir[dr].ind=or,ir[dr].extra=yr,dr+=1;ur=0,or+=1}}else ir[or].ind=or,ir[or].extra=0,or+=1;if(rr.l=ir,vr=gr>vr?gr:vr,pr.push(gr),rr.sz)rr.boxWidth=rr.sz[0],rr.justifyOffset=0;else switch(rr.boxWidth=vr,rr.j){case 1:rr.justifyOffset=-rr.boxWidth;break;case 2:rr.justifyOffset=-rr.boxWidth/2;break;default:rr.justifyOffset=0}rr.lineWidths=pr;var Nr=tr.a,Ur,Br;fr=Nr.length;var Wr,Xr,Yr=[];for(mr=0;mr<fr;mr+=1){for(Ur=Nr[mr],Ur.a.sc&&(rr.strokeColorAnim=!0),Ur.a.sw&&(rr.strokeWidthAnim=!0),(Ur.a.fc||Ur.a.fh||Ur.a.fs||Ur.a.fb)&&(rr.fillColorAnim=!0),Xr=0,Wr=Ur.s.b,nr=0;nr<sr;nr+=1)Br=ir[nr],Br.anIndexes[mr]=Xr,(Wr==1&&Br.val!==""||Wr==2&&Br.val!==""&&Br.val!==" "||Wr==3&&(Br.n||Br.val==" "||nr==sr-1)||Wr==4&&(Br.n||nr==sr-1))&&(Ur.s.rn===1&&Yr.push(Xr),Xr+=1);tr.a[mr].s.totalChars=Xr;var Qi=-1,Xi;if(Ur.s.rn===1)for(nr=0;nr<sr;nr+=1)Br=ir[nr],Qi!=Br.anIndexes[mr]&&(Qi=Br.anIndexes[mr],Xi=Yr.splice(Math.floor(Math.random()*Yr.length),1)[0]),Br.anIndexes[mr]=Xi}rr.yOffset=rr.finalLineHeight||rr.finalSize*1.2,rr.ls=rr.ls||0,rr.ascent=_r.ascent*rr.finalSize/100},TextProperty.prototype.updateDocumentData=function(rr,er){er=er===void 0?this.keysIndex:er;var tr=this.copyData({},this.data.d.k[er].s);tr=this.copyData(tr,rr),this.data.d.k[er].s=tr,this.recalculate(er),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(rr){var er=this.data.d.k[rr].s;er.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(er)},TextProperty.prototype.canResizeFont=function(rr){this.canResize=rr,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(rr){this.minimumFontSize=Math.floor(rr)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};const TextSelectorProp=function(){var rr=Math.max,er=Math.min,tr=Math.floor;function ir(sr,ar){this._currentTextLength=-1,this.k=!1,this.data=ar,this.elem=sr,this.comp=sr.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(sr),this.s=PropertyFactory.getProp(sr,ar.s||{k:0},0,0,this),"e"in ar?this.e=PropertyFactory.getProp(sr,ar.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(sr,ar.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(sr,ar.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(sr,ar.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(sr,ar.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(sr,ar.a,0,.01,this),this.dynamicProperties.length||this.getValue()}ir.prototype={getMult:function(sr){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var ar=0,or=0,lr=1,cr=1;this.ne.v>0?ar=this.ne.v/100:or=-this.ne.v/100,this.xe.v>0?lr=1-this.xe.v/100:cr=1+this.xe.v/100;var ur=BezierFactory.getBezierEasing(ar,or,lr,cr).get,dr=0,hr=this.finalS,pr=this.finalE,gr=this.data.sh;if(gr===2)pr===hr?dr=sr>=pr?1:0:dr=rr(0,er(.5/(pr-hr)+(sr-hr)/(pr-hr),1)),dr=ur(dr);else if(gr===3)pr===hr?dr=sr>=pr?0:1:dr=1-rr(0,er(.5/(pr-hr)+(sr-hr)/(pr-hr),1)),dr=ur(dr);else if(gr===4)pr===hr?dr=0:(dr=rr(0,er(.5/(pr-hr)+(sr-hr)/(pr-hr),1)),dr<.5?dr*=2:dr=1-2*(dr-.5)),dr=ur(dr);else if(gr===5){if(pr===hr)dr=0;else{var vr=pr-hr;sr=er(rr(0,sr+.5-hr),pr-hr);var mr=-vr/2+sr,fr=vr/2;dr=Math.sqrt(1-mr*mr/(fr*fr))}dr=ur(dr)}else gr===6?(pr===hr?dr=0:(sr=er(rr(0,sr+.5-hr),pr-hr),dr=(1+Math.cos(Math.PI+Math.PI*2*sr/(pr-hr)))/2),dr=ur(dr)):(sr>=tr(hr)&&(sr-hr<0?dr=rr(0,er(er(pr,1)-(hr-sr),1)):dr=rr(0,er(pr-sr,1))),dr=ur(dr));if(this.sm.v!==100){var _r=this.sm.v*.01;_r===0&&(_r=1e-8);var Ar=.5-_r*.5;dr<Ar?dr=0:(dr=(dr-Ar)/_r,dr>1&&(dr=1))}return dr*this.a.v},getValue:function(sr){this.iterateDynamicProperties(),this._mdf=sr||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,sr&&this.data.r===2&&(this.e.v=this._currentTextLength);var ar=this.data.r===2?1:100/this.data.totalChars,or=this.o.v/ar,lr=this.s.v/ar+or,cr=this.e.v/ar+or;if(lr>cr){var ur=lr;lr=cr,cr=ur}this.finalS=lr,this.finalE=cr}},extendPrototype([DynamicPropertyContainer],ir);function nr(sr,ar,or){return new ir(sr,ar,or)}return{getTextSelectorProp:nr}}();TextAnimatorProperty.prototype.searchProperties=function(){var rr,er=this._textData.a.length,tr,ir=PropertyFactory.getProp;for(rr=0;rr<er;rr+=1)tr=this._textData.a[rr],this._animatorsData[rr]=new TextAnimatorDataProperty(this._elem,tr,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:ir(this._elem,this._textData.p.a,0,0,this),f:ir(this._elem,this._textData.p.f,0,0,this),l:ir(this._elem,this._textData.p.l,0,0,this),r:ir(this._elem,this._textData.p.r,0,0,this),p:ir(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=ir(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(rr,er){if(this.lettersChangedFlag=er,!(!this._mdf&&!this._isFirstFrame&&!er&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var tr=this._moreOptions.alignment.v,ir=this._animatorsData,nr=this._textData,sr=this.mHelper,ar=this._renderType,or=this.renderedLetters.length,lr,cr,ur,dr,hr=rr.l,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr,Ir,Rr;if(this._hasMaskedPath){if(Rr=this._pathData.m,!this._pathData.n||this._pathData._mdf){var Pr=Rr.v;this._pathData.r.v&&(Pr=Pr.reverse()),pr={tLength:0,segments:[]},dr=Pr._length-1;var Dr;for(br=0,ur=0;ur<dr;ur+=1)Dr=bez.buildBezierData(Pr.v[ur],Pr.v[ur+1],[Pr.o[ur][0]-Pr.v[ur][0],Pr.o[ur][1]-Pr.v[ur][1]],[Pr.i[ur+1][0]-Pr.v[ur+1][0],Pr.i[ur+1][1]-Pr.v[ur+1][1]]),pr.tLength+=Dr.segmentLength,pr.segments.push(Dr),br+=Dr.segmentLength;ur=dr,Rr.v.c&&(Dr=bez.buildBezierData(Pr.v[ur],Pr.v[0],[Pr.o[ur][0]-Pr.v[ur][0],Pr.o[ur][1]-Pr.v[ur][1]],[Pr.i[0][0]-Pr.v[0][0],Pr.i[0][1]-Pr.v[0][1]]),pr.tLength+=Dr.segmentLength,pr.segments.push(Dr),br+=Dr.segmentLength),this._pathData.pi=pr}if(pr=this._pathData.pi,gr=this._pathData.f.v,Ar=0,_r=1,mr=0,fr=!0,xr=pr.segments,gr<0&&Rr.v.c)for(pr.tLength<Math.abs(gr)&&(gr=-Math.abs(gr)%pr.tLength),Ar=xr.length-1,wr=xr[Ar].points,_r=wr.length-1;gr<0;)gr+=wr[_r].partialLength,_r-=1,_r<0&&(Ar-=1,wr=xr[Ar].points,_r=wr.length-1);wr=xr[Ar].points,yr=wr[_r-1],vr=wr[_r],Sr=vr.partialLength}dr=hr.length,lr=0,cr=0;var Fr=rr.finalSize*1.2*.714,Or=!0,Nr,Ur,Br,Wr,Xr;Wr=ir.length;var Yr,Qi=-1,Xi,Kr,$r,Vr=gr,Gr=Ar,qr=_r,ji=-1,Jr,Ji,Ki,Zi,Zr,is,os,cs,ss="",es=this.defaultPropsArray,ms;if(rr.j===2||rr.j===1){var Yi=0,Gi=0,Ni=rr.j===2?-.5:-1,Ri=0,qi=!0;for(ur=0;ur<dr;ur+=1)if(hr[ur].n){for(Yi&&(Yi+=Gi);Ri<ur;)hr[Ri].animatorJustifyOffset=Yi,Ri+=1;Yi=0,qi=!0}else{for(Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.t.propType&&(qi&&rr.j===2&&(Gi+=Nr.t.v*Ni),Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Yr.length?Yi+=Nr.t.v*Yr[0]*Ni:Yi+=Nr.t.v*Yr*Ni);qi=!1}for(Yi&&(Yi+=Gi);Ri<ur;)hr[Ri].animatorJustifyOffset=Yi,Ri+=1}for(ur=0;ur<dr;ur+=1){if(sr.reset(),Jr=1,hr[ur].n)lr=0,cr+=rr.yOffset,cr+=Or?1:0,gr=Vr,Or=!1,this._hasMaskedPath&&(Ar=Gr,_r=qr,wr=xr[Ar].points,yr=wr[_r-1],vr=wr[_r],Sr=vr.partialLength,mr=0),ss="",cs="",is="",ms="",es=this.defaultPropsArray;else{if(this._hasMaskedPath){if(ji!==hr[ur].line){switch(rr.j){case 1:gr+=br-rr.lineWidths[hr[ur].line];break;case 2:gr+=(br-rr.lineWidths[hr[ur].line])/2;break;default:break}ji=hr[ur].line}Qi!==hr[ur].ind&&(hr[Qi]&&(gr+=hr[Qi].extra),gr+=hr[ur].an/2,Qi=hr[ur].ind),gr+=tr[0]*hr[ur].an*.005;var as=0;for(Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.p.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Yr.length?as+=Nr.p.v[0]*Yr[0]:as+=Nr.p.v[0]*Yr),Nr.a.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Yr.length?as+=Nr.a.v[0]*Yr[0]:as+=Nr.a.v[0]*Yr);for(fr=!0,this._pathData.a.v&&(gr=hr[0].an*.5+(br-this._pathData.f.v-hr[0].an*.5-hr[hr.length-1].an*.5)*Qi/(dr-1),gr+=this._pathData.f.v);fr;)mr+Sr>=gr+as||!wr?(Cr=(gr+as-mr)/vr.partialLength,Kr=yr.point[0]+(vr.point[0]-yr.point[0])*Cr,$r=yr.point[1]+(vr.point[1]-yr.point[1])*Cr,sr.translate(-tr[0]*hr[ur].an*.005,-(tr[1]*Fr)*.01),fr=!1):wr&&(mr+=vr.partialLength,_r+=1,_r>=wr.length&&(_r=0,Ar+=1,xr[Ar]?wr=xr[Ar].points:Rr.v.c?(_r=0,Ar=0,wr=xr[Ar].points):(mr-=vr.partialLength,wr=null)),wr&&(yr=vr,vr=wr[_r],Sr=vr.partialLength));Xi=hr[ur].an/2-hr[ur].add,sr.translate(-Xi,0,0)}else Xi=hr[ur].an/2-hr[ur].add,sr.translate(-Xi,0,0),sr.translate(-tr[0]*hr[ur].an*.005,-tr[1]*Fr*.01,0);for(Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.t.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),(lr!==0||rr.j!==0)&&(this._hasMaskedPath?Yr.length?gr+=Nr.t.v*Yr[0]:gr+=Nr.t.v*Yr:Yr.length?lr+=Nr.t.v*Yr[0]:lr+=Nr.t.v*Yr));for(rr.strokeWidthAnim&&(Ki=rr.sw||0),rr.strokeColorAnim&&(rr.sc?Ji=[rr.sc[0],rr.sc[1],rr.sc[2]]:Ji=[0,0,0]),rr.fillColorAnim&&rr.fc&&(Zi=[rr.fc[0],rr.fc[1],rr.fc[2]]),Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.a.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Yr.length?sr.translate(-Nr.a.v[0]*Yr[0],-Nr.a.v[1]*Yr[1],Nr.a.v[2]*Yr[2]):sr.translate(-Nr.a.v[0]*Yr,-Nr.a.v[1]*Yr,Nr.a.v[2]*Yr));for(Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.s.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Yr.length?sr.scale(1+(Nr.s.v[0]-1)*Yr[0],1+(Nr.s.v[1]-1)*Yr[1],1):sr.scale(1+(Nr.s.v[0]-1)*Yr,1+(Nr.s.v[1]-1)*Yr,1));for(Br=0;Br<Wr;Br+=1){if(Nr=ir[Br].a,Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),Nr.sk.propType&&(Yr.length?sr.skewFromAxis(-Nr.sk.v*Yr[0],Nr.sa.v*Yr[1]):sr.skewFromAxis(-Nr.sk.v*Yr,Nr.sa.v*Yr)),Nr.r.propType&&(Yr.length?sr.rotateZ(-Nr.r.v*Yr[2]):sr.rotateZ(-Nr.r.v*Yr)),Nr.ry.propType&&(Yr.length?sr.rotateY(Nr.ry.v*Yr[1]):sr.rotateY(Nr.ry.v*Yr)),Nr.rx.propType&&(Yr.length?sr.rotateX(Nr.rx.v*Yr[0]):sr.rotateX(Nr.rx.v*Yr)),Nr.o.propType&&(Yr.length?Jr+=(Nr.o.v*Yr[0]-Jr)*Yr[0]:Jr+=(Nr.o.v*Yr-Jr)*Yr),rr.strokeWidthAnim&&Nr.sw.propType&&(Yr.length?Ki+=Nr.sw.v*Yr[0]:Ki+=Nr.sw.v*Yr),rr.strokeColorAnim&&Nr.sc.propType)for(Zr=0;Zr<3;Zr+=1)Yr.length?Ji[Zr]+=(Nr.sc.v[Zr]-Ji[Zr])*Yr[0]:Ji[Zr]+=(Nr.sc.v[Zr]-Ji[Zr])*Yr;if(rr.fillColorAnim&&rr.fc){if(Nr.fc.propType)for(Zr=0;Zr<3;Zr+=1)Yr.length?Zi[Zr]+=(Nr.fc.v[Zr]-Zi[Zr])*Yr[0]:Zi[Zr]+=(Nr.fc.v[Zr]-Zi[Zr])*Yr;Nr.fh.propType&&(Yr.length?Zi=addHueToRGB(Zi,Nr.fh.v*Yr[0]):Zi=addHueToRGB(Zi,Nr.fh.v*Yr)),Nr.fs.propType&&(Yr.length?Zi=addSaturationToRGB(Zi,Nr.fs.v*Yr[0]):Zi=addSaturationToRGB(Zi,Nr.fs.v*Yr)),Nr.fb.propType&&(Yr.length?Zi=addBrightnessToRGB(Zi,Nr.fb.v*Yr[0]):Zi=addBrightnessToRGB(Zi,Nr.fb.v*Yr))}}for(Br=0;Br<Wr;Br+=1)Nr=ir[Br].a,Nr.p.propType&&(Ur=ir[Br].s,Yr=Ur.getMult(hr[ur].anIndexes[Br],nr.a[Br].s.totalChars),this._hasMaskedPath?Yr.length?sr.translate(0,Nr.p.v[1]*Yr[0],-Nr.p.v[2]*Yr[1]):sr.translate(0,Nr.p.v[1]*Yr,-Nr.p.v[2]*Yr):Yr.length?sr.translate(Nr.p.v[0]*Yr[0],Nr.p.v[1]*Yr[1],-Nr.p.v[2]*Yr[2]):sr.translate(Nr.p.v[0]*Yr,Nr.p.v[1]*Yr,-Nr.p.v[2]*Yr));if(rr.strokeWidthAnim&&(is=Ki<0?0:Ki),rr.strokeColorAnim&&(os="rgb("+Math.round(Ji[0]*255)+","+Math.round(Ji[1]*255)+","+Math.round(Ji[2]*255)+")"),rr.fillColorAnim&&rr.fc&&(cs="rgb("+Math.round(Zi[0]*255)+","+Math.round(Zi[1]*255)+","+Math.round(Zi[2]*255)+")"),this._hasMaskedPath){if(sr.translate(0,-rr.ls),sr.translate(0,tr[1]*Fr*.01+cr,0),this._pathData.p.v){Ir=(vr.point[1]-yr.point[1])/(vr.point[0]-yr.point[0]);var us=Math.atan(Ir)*180/Math.PI;vr.point[0]<yr.point[0]&&(us+=180),sr.rotate(-us*Math.PI/180)}sr.translate(Kr,$r,0),gr-=tr[0]*hr[ur].an*.005,hr[ur+1]&&Qi!==hr[ur+1].ind&&(gr+=hr[ur].an/2,gr+=rr.tr*.001*rr.finalSize)}else{switch(sr.translate(lr,cr,0),rr.ps&&sr.translate(rr.ps[0],rr.ps[1]+rr.ascent,0),rr.j){case 1:sr.translate(hr[ur].animatorJustifyOffset+rr.justifyOffset+(rr.boxWidth-rr.lineWidths[hr[ur].line]),0,0);break;case 2:sr.translate(hr[ur].animatorJustifyOffset+rr.justifyOffset+(rr.boxWidth-rr.lineWidths[hr[ur].line])/2,0,0);break;default:break}sr.translate(0,-rr.ls),sr.translate(Xi,0,0),sr.translate(tr[0]*hr[ur].an*.005,tr[1]*Fr*.01,0),lr+=hr[ur].l+rr.tr*.001*rr.finalSize}ar==="html"?ss=sr.toCSS():ar==="svg"?ss=sr.to2dCSS():es=[sr.props[0],sr.props[1],sr.props[2],sr.props[3],sr.props[4],sr.props[5],sr.props[6],sr.props[7],sr.props[8],sr.props[9],sr.props[10],sr.props[11],sr.props[12],sr.props[13],sr.props[14],sr.props[15]],ms=Jr}or<=ur?(Xr=new LetterProps(ms,is,os,cs,ss,es),this.renderedLetters.push(Xr),or+=1,this.lettersChangedFlag=!0):(Xr=this.renderedLetters[ur],this.lettersChangedFlag=Xr.update(ms,is,os,cs,ss,es)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty),ITextElement.prototype.initElement=function(rr,er,tr){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(rr,er,tr),this.textProperty=new TextProperty(this,rr.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(rr.t,this.renderType,this),this.initTransform(rr,er,tr),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(rr){this._mdf=!1,this.prepareRenderableFrame(rr),this.prepareProperties(rr,this.isInRange),(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)},ITextElement.prototype.createPathShape=function(rr,er){var tr,ir=er.length,nr,sr="";for(tr=0;tr<ir;tr+=1)er[tr].ty==="sh"&&(nr=er[tr].ks.k,sr+=buildShapeString(nr,nr.i.length,!0,rr));return sr},ITextElement.prototype.updateDocumentData=function(rr,er){this.textProperty.updateDocumentData(rr,er)},ITextElement.prototype.canResizeFont=function(rr){this.textProperty.canResizeFont(rr)},ITextElement.prototype.setMinimumFontSize=function(rr){this.textProperty.setMinimumFontSize(rr)},ITextElement.prototype.applyTextPropertiesToMatrix=function(rr,er,tr,ir,nr){switch(rr.ps&&er.translate(rr.ps[0],rr.ps[1]+rr.ascent,0),er.translate(0,-rr.ls,0),rr.j){case 1:er.translate(rr.justifyOffset+(rr.boxWidth-rr.lineWidths[tr]),0,0);break;case 2:er.translate(rr.justifyOffset+(rr.boxWidth-rr.lineWidths[tr])/2,0,0);break;default:break}er.translate(ir,nr,0)},ITextElement.prototype.buildColor=function(rr){return"rgb("+Math.round(rr[0]*255)+","+Math.round(rr[1]*255)+","+Math.round(rr[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){};var emptyShapeData={shapes:[]};extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(rr){for(var er=0,tr=rr.length,ir=[],nr="";er<tr;)rr[er]==="\r"||rr[er]===""?(ir.push(nr),nr=""):nr+=rr[er],er+=1;return ir.push(nr),ir},SVGTextLottieElement.prototype.buildShapeData=function(rr,er){if(rr.shapes&&rr.shapes.length){var tr=rr.shapes[0];if(tr.it){var ir=tr.it[tr.it.length-1];ir.s&&(ir.s.k[0]=er,ir.s.k[1]=er)}}return rr},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var rr,er,tr=this.textProperty.currentData;this.renderedLetters=createSizedArray(tr?tr.l.length:0),tr.fc?this.layerElement.setAttribute("fill",this.buildColor(tr.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),tr.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(tr.sc)),this.layerElement.setAttribute("stroke-width",tr.sw)),this.layerElement.setAttribute("font-size",tr.finalSize);var ir=this.globalData.fontManager.getFontByName(tr.f);if(ir.fClass)this.layerElement.setAttribute("class",ir.fClass);else{this.layerElement.setAttribute("font-family",ir.fFamily);var nr=tr.fWeight,sr=tr.fStyle;this.layerElement.setAttribute("font-style",sr),this.layerElement.setAttribute("font-weight",nr)}this.layerElement.setAttribute("aria-label",tr.t);var ar=tr.l||[],or=!!this.globalData.fontManager.chars;er=ar.length;var lr,cr=this.mHelper,ur="",dr=this.data.singleShape,hr=0,pr=0,gr=!0,vr=tr.tr*.001*tr.finalSize;if(dr&&!or&&!tr.sz){var mr=this.textContainer,fr="start";switch(tr.j){case 1:fr="end";break;case 2:fr="middle";break;default:fr="start";break}mr.setAttribute("text-anchor",fr),mr.setAttribute("letter-spacing",vr);var _r=this.buildTextContents(tr.finalText);for(er=_r.length,pr=tr.ps?tr.ps[1]+tr.ascent:0,rr=0;rr<er;rr+=1)lr=this.textSpans[rr].span||createNS("tspan"),lr.textContent=_r[rr],lr.setAttribute("x",0),lr.setAttribute("y",pr),lr.style.display="inherit",mr.appendChild(lr),this.textSpans[rr]||(this.textSpans[rr]={span:null,glyph:null}),this.textSpans[rr].span=lr,pr+=tr.finalLineHeight;this.layerElement.appendChild(mr)}else{var Ar=this.textSpans.length,yr;for(rr=0;rr<er;rr+=1){if(this.textSpans[rr]||(this.textSpans[rr]={span:null,childSpan:null,glyph:null}),!or||!dr||rr===0){if(lr=Ar>rr?this.textSpans[rr].span:createNS(or?"g":"text"),Ar<=rr){if(lr.setAttribute("stroke-linecap","butt"),lr.setAttribute("stroke-linejoin","round"),lr.setAttribute("stroke-miterlimit","4"),this.textSpans[rr].span=lr,or){var wr=createNS("g");lr.appendChild(wr),this.textSpans[rr].childSpan=wr}this.textSpans[rr].span=lr,this.layerElement.appendChild(lr)}lr.style.display="inherit"}if(cr.reset(),dr&&(ar[rr].n&&(hr=-vr,pr+=tr.yOffset,pr+=gr?1:0,gr=!1),this.applyTextPropertiesToMatrix(tr,cr,ar[rr].line,hr,pr),hr+=ar[rr].l||0,hr+=vr),or){yr=this.globalData.fontManager.getCharData(tr.finalText[rr],ir.fStyle,this.globalData.fontManager.getFontByName(tr.f).fFamily);var xr;if(yr.t===1)xr=new SVGCompElement(yr.data,this.globalData,this);else{var Sr=emptyShapeData;yr.data&&yr.data.shapes&&(Sr=this.buildShapeData(yr.data,tr.finalSize)),xr=new SVGShapeElement(Sr,this.globalData,this)}if(this.textSpans[rr].glyph){var br=this.textSpans[rr].glyph;this.textSpans[rr].childSpan.removeChild(br.layerElement),br.destroy()}this.textSpans[rr].glyph=xr,xr._debug=!0,xr.prepareFrame(0),xr.renderFrame(),this.textSpans[rr].childSpan.appendChild(xr.layerElement),yr.t===1&&this.textSpans[rr].childSpan.setAttribute("transform","scale("+tr.finalSize/100+","+tr.finalSize/100+")")}else dr&&lr.setAttribute("transform","translate("+cr.props[12]+","+cr.props[13]+")"),lr.textContent=ar[rr].val,lr.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}dr&&lr&&lr.setAttribute("d",ur)}for(;rr<this.textSpans.length;)this.textSpans[rr].span.style.display="none",rr+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var rr=this.layerElement.getBBox();this.bbox={top:rr.y,left:rr.x,width:rr.width,height:rr.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var rr,er=this.textSpans.length,tr;for(this.renderedFrame=this.comp.renderedFrame,rr=0;rr<er;rr+=1)tr=this.textSpans[rr].glyph,tr&&(tr.prepareFrame(this.comp.renderedFrame-this.data.st),tr._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if((!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var rr,er,tr=this.textAnimator.renderedLetters,ir=this.textProperty.currentData.l;er=ir.length;var nr,sr,ar;for(rr=0;rr<er;rr+=1)ir[rr].n||(nr=tr[rr],sr=this.textSpans[rr].span,ar=this.textSpans[rr].glyph,ar&&ar.renderFrame(),nr._mdf.m&&sr.setAttribute("transform",nr.m),nr._mdf.o&&sr.setAttribute("opacity",nr.o),nr._mdf.sw&&sr.setAttribute("stroke-width",nr.sw),nr._mdf.sc&&sr.setAttribute("stroke",nr.sc),nr._mdf.fc&&sr.setAttribute("fill",nr.fc))}},extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var rr=createNS("rect");rr.setAttribute("width",this.data.sw),rr.setAttribute("height",this.data.sh),rr.setAttribute("fill",this.data.sc),this.layerElement.appendChild(rr)},NullElement.prototype.prepareFrame=function(rr){this.prepareProperties(rr,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement),extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(rr){return new NullElement(rr,this.globalData,this)},SVGRendererBase.prototype.createShape=function(rr){return new SVGShapeElement(rr,this.globalData,this)},SVGRendererBase.prototype.createText=function(rr){return new SVGTextLottieElement(rr,this.globalData,this)},SVGRendererBase.prototype.createImage=function(rr){return new IImageElement(rr,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(rr){return new ISolidElement(rr,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(rr){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+rr.w+" "+rr.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",rr.w),this.svgElement.setAttribute("height",rr.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var er=this.globalData.defs;this.setupGlobalData(rr,er),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=rr;var tr=createNS("clipPath"),ir=createNS("rect");ir.setAttribute("width",rr.w),ir.setAttribute("height",rr.h),ir.setAttribute("x",0),ir.setAttribute("y",0);var nr=createElementID();tr.setAttribute("id",nr),tr.appendChild(ir),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+nr+")"),er.appendChild(tr),this.layers=rr.layers,this.elements=createSizedArray(rr.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var rr,er=this.layers?this.layers.length:0;for(rr=0;rr<er;rr+=1)this.elements[rr]&&this.elements[rr].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.buildItem=function(rr){var er=this.elements;if(!(er[rr]||this.layers[rr].ty===99)){er[rr]=!0;var tr=this.createItem(this.layers[rr]);er[rr]=tr,getExpressionsPlugin()&&(this.layers[rr].ty===0&&this.globalData.projectInterface.registerComposition(tr),tr.initExpressions()),this.appendElementInPos(tr,rr),this.layers[rr].tt&&(!this.elements[rr-1]||this.elements[rr-1]===!0?(this.buildItem(rr-1),this.addPendingElement(tr)):tr.setMatte(er[rr-1].layerId))}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var rr=this.pendingElements.pop();if(rr.checkParenting(),rr.data.tt)for(var er=0,tr=this.elements.length;er<tr;){if(this.elements[er]===rr){rr.setMatte(this.elements[er-1].layerId);break}er+=1}}},SVGRendererBase.prototype.renderFrame=function(rr){if(!(this.renderedFrame===rr||this.destroyed)){rr===null?rr=this.renderedFrame:this.renderedFrame=rr,this.globalData.frameNum=rr,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=rr,this.globalData._mdf=!1;var er,tr=this.layers.length;for(this.completeLayers||this.checkLayers(rr),er=tr-1;er>=0;er-=1)(this.completeLayers||this.elements[er])&&this.elements[er].prepareFrame(rr-this.layers[er].st);if(this.globalData._mdf)for(er=0;er<tr;er+=1)(this.completeLayers||this.elements[er])&&this.elements[er].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(rr,er){var tr=rr.getBaseElement();if(tr){for(var ir=0,nr;ir<er;)this.elements[ir]&&this.elements[ir]!==!0&&this.elements[ir].getBaseElement()&&(nr=this.elements[ir].getBaseElement()),ir+=1;nr?this.layerElement.insertBefore(tr,nr):this.layerElement.appendChild(tr)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(rr,er,tr){this.initFrame(),this.initBaseData(rr,er,tr),this.initTransform(rr,er,tr),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!er.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(rr){if(this._mdf=!1,this.prepareRenderableFrame(rr),this.prepareProperties(rr,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=rr/this.data.sr;else{var er=this.tm.v;er===this.data.op&&(er=this.data.op-1),this.renderedFrame=er}var tr,ir=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),tr=ir-1;tr>=0;tr-=1)(this.completeLayers||this.elements[tr])&&(this.elements[tr].prepareFrame(this.renderedFrame-this.layers[tr].st),this.elements[tr]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var rr,er=this.layers.length;for(rr=0;rr<er;rr+=1)(this.completeLayers||this.elements[rr])&&this.elements[rr].renderFrame()},ICompElement.prototype.setElements=function(rr){this.elements=rr},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var rr,er=this.layers.length;for(rr=0;rr<er;rr+=1)this.elements[rr]&&this.elements[rr].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()},extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(rr){return new SVGCompElement(rr,this.globalData,this)},extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(rr){return new SVGCompElement(rr,this.globalData,this)},CVContextData.prototype.duplicate=function(){var rr=this._length*2,er=this.savedOp;this.savedOp=createTypedArray("float32",rr),this.savedOp.set(er);var tr=0;for(tr=this._length;tr<rr;tr+=1)this.saved[tr]=createTypedArray("float32",16);this._length=rr},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.cO=1},ShapeTransformManager.prototype={addTransformSequence:function(rr){var er,tr=rr.length,ir="_";for(er=0;er<tr;er+=1)ir+=rr[er].transform.key+"_";var nr=this.sequences[ir];return nr||(nr={transforms:[].concat(rr),finalTransform:new Matrix,_mdf:!1},this.sequences[ir]=nr,this.sequenceList.push(nr)),nr},processSequence:function(rr,er){for(var tr=0,ir=rr.transforms.length,nr=er;tr<ir&&!er;){if(rr.transforms[tr].transform.mProps._mdf){nr=!0;break}tr+=1}if(nr){var sr;for(rr.finalTransform.reset(),tr=ir-1;tr>=0;tr-=1)sr=rr.transforms[tr].transform.mProps.v.props,rr.finalTransform.transform(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5],sr[6],sr[7],sr[8],sr[9],sr[10],sr[11],sr[12],sr[13],sr[14],sr[15])}rr._mdf=nr},processSequences:function(rr){var er,tr=this.sequenceList.length;for(er=0;er<tr;er+=1)this.processSequence(this.sequenceList[er],rr)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}},CVEffects.prototype.renderFrame=function(){},CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var rr=this.element.finalTransform.mat,er=this.element.canvasContext,tr,ir=this.masksProperties.length,nr,sr,ar;for(er.beginPath(),tr=0;tr<ir;tr+=1)if(this.masksProperties[tr].mode!=="n"){this.masksProperties[tr].inv&&(er.moveTo(0,0),er.lineTo(this.element.globalData.compSize.w,0),er.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),er.lineTo(0,this.element.globalData.compSize.h),er.lineTo(0,0)),ar=this.viewData[tr].v,nr=rr.applyToPointArray(ar.v[0][0],ar.v[0][1],0),er.moveTo(nr[0],nr[1]);var or,lr=ar._length;for(or=1;or<lr;or+=1)sr=rr.applyToTriplePoints(ar.o[or-1],ar.i[or],ar.v[or]),er.bezierCurveTo(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5]);sr=rr.applyToTriplePoints(ar.o[or-1],ar.i[0],ar.v[0]),er.bezierCurveTo(sr[0],sr[1],sr[2],sr[3],sr[4],sr[5])}this.element.globalData.renderer.save(!0),er.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null},CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){this.canvasContext=this.globalData.canvasContext,this.renderableEffectsManager=new CVEffects(this)},createContent:function(){},setBlendMode:function(){var rr=this.globalData;if(rr.blendMode!==this.data.bm){rr.blendMode=this.data.bm;var er=getBlendMode(this.data.bm);rr.canvasContext.globalCompositeOperation=er}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},renderFrame:function(){if(!(this.hidden||this.data.hd)){this.renderTransform(),this.renderRenderable(),this.setBlendMode();var rr=this.data.ty===0;this.globalData.renderer.save(rr),this.globalData.renderer.ctxTransform(this.finalTransform.mat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.mProp.o.v),this.renderInnerContent(),this.globalData.renderer.restore(rr),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement,CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated,extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(rr,er){var tr={data:rr,type:rr.ty,preTransforms:this.transformsManager.addTransformSequence(er),transforms:[],elements:[],closed:rr.hd===!0},ir={};if(rr.ty==="fl"||rr.ty==="st"?(ir.c=PropertyFactory.getProp(this,rr.c,1,255,this),ir.c.k||(tr.co="rgb("+bmFloor(ir.c.v[0])+","+bmFloor(ir.c.v[1])+","+bmFloor(ir.c.v[2])+")")):(rr.ty==="gf"||rr.ty==="gs")&&(ir.s=PropertyFactory.getProp(this,rr.s,1,null,this),ir.e=PropertyFactory.getProp(this,rr.e,1,null,this),ir.h=PropertyFactory.getProp(this,rr.h||{k:0},0,.01,this),ir.a=PropertyFactory.getProp(this,rr.a||{k:0},0,degToRads,this),ir.g=new GradientProperty(this,rr.g,this)),ir.o=PropertyFactory.getProp(this,rr.o,0,.01,this),rr.ty==="st"||rr.ty==="gs"){if(tr.lc=lineCapEnum[rr.lc||2],tr.lj=lineJoinEnum[rr.lj||2],rr.lj==1&&(tr.ml=rr.ml),ir.w=PropertyFactory.getProp(this,rr.w,0,null,this),ir.w.k||(tr.wi=ir.w.v),rr.d){var nr=new DashProperty(this,rr.d,"canvas",this);ir.d=nr,ir.d.k||(tr.da=ir.d.dashArray,tr.do=ir.d.dashoffset[0])}}else tr.r=rr.r===2?"evenodd":"nonzero";return this.stylesList.push(tr),ir.style=tr,ir},CVShapeElement.prototype.createGroupElement=function(){var rr={it:[],prevViewData:[]};return rr},CVShapeElement.prototype.createTransformElement=function(rr){var er={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,rr.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,rr,this)}};return er},CVShapeElement.prototype.createShapeElement=function(rr){var er=new CVShapeData(this,rr,this.stylesList,this.transformsManager);return this.shapes.push(er),this.addShapeToModifiers(er),er},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var rr,er=this.itemsData.length;for(rr=0;rr<er;rr+=1)this.prevViewData[rr]=this.itemsData[rr];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),er=this.dynamicProperties.length,rr=0;rr<er;rr+=1)this.dynamicProperties[rr].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(rr){var er,tr=this.stylesList.length;for(er=0;er<tr;er+=1)this.stylesList[er].closed||this.stylesList[er].transforms.push(rr)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var rr,er=this.stylesList.length;for(rr=0;rr<er;rr+=1)this.stylesList[rr].closed||this.stylesList[rr].transforms.pop()},CVShapeElement.prototype.closeStyles=function(rr){var er,tr=rr.length;for(er=0;er<tr;er+=1)rr[er].closed=!0},CVShapeElement.prototype.searchShapes=function(rr,er,tr,ir,nr){var sr,ar=rr.length-1,or,lr,cr=[],ur=[],dr,hr,pr,gr=[].concat(nr);for(sr=ar;sr>=0;sr-=1){if(dr=this.searchProcessedElement(rr[sr]),dr?er[sr]=tr[dr-1]:rr[sr]._shouldRender=ir,rr[sr].ty==="fl"||rr[sr].ty==="st"||rr[sr].ty==="gf"||rr[sr].ty==="gs")dr?er[sr].style.closed=!1:er[sr]=this.createStyleElement(rr[sr],gr),cr.push(er[sr].style);else if(rr[sr].ty==="gr"){if(!dr)er[sr]=this.createGroupElement(rr[sr]);else for(lr=er[sr].it.length,or=0;or<lr;or+=1)er[sr].prevViewData[or]=er[sr].it[or];this.searchShapes(rr[sr].it,er[sr].it,er[sr].prevViewData,ir,gr)}else rr[sr].ty==="tr"?(dr||(pr=this.createTransformElement(rr[sr]),er[sr]=pr),gr.push(er[sr]),this.addTransformToStyleList(er[sr])):rr[sr].ty==="sh"||rr[sr].ty==="rc"||rr[sr].ty==="el"||rr[sr].ty==="sr"?dr||(er[sr]=this.createShapeElement(rr[sr])):rr[sr].ty==="tm"||rr[sr].ty==="rd"||rr[sr].ty==="pb"?(dr?(hr=er[sr],hr.closed=!1):(hr=ShapeModifiers.getModifier(rr[sr].ty),hr.init(this,rr[sr]),er[sr]=hr,this.shapeModifiers.push(hr)),ur.push(hr)):rr[sr].ty==="rp"&&(dr?(hr=er[sr],hr.closed=!0):(hr=ShapeModifiers.getModifier(rr[sr].ty),er[sr]=hr,hr.init(this,rr,sr,er),this.shapeModifiers.push(hr),ir=!1),ur.push(hr));this.addProcessedElement(rr[sr],sr+1)}for(this.removeTransformFromStyleList(),this.closeStyles(cr),ar=ur.length,sr=0;sr<ar;sr+=1)ur[sr].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(rr,er){(rr._opMdf||er.op._mdf||this._isFirstFrame)&&(er.opacity=rr.opacity,er.opacity*=er.op.v,er._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var rr,er=this.stylesList.length,tr,ir,nr,sr,ar,or,lr=this.globalData.renderer,cr=this.globalData.canvasContext,ur,dr;for(rr=0;rr<er;rr+=1)if(dr=this.stylesList[rr],ur=dr.type,!((ur==="st"||ur==="gs")&&dr.wi===0||!dr.data._shouldRender||dr.coOp===0||this.globalData.currentGlobalAlpha===0)){for(lr.save(),ar=dr.elements,ur==="st"||ur==="gs"?(cr.strokeStyle=ur==="st"?dr.co:dr.grd,cr.lineWidth=dr.wi,cr.lineCap=dr.lc,cr.lineJoin=dr.lj,cr.miterLimit=dr.ml||0):cr.fillStyle=ur==="fl"?dr.co:dr.grd,lr.ctxOpacity(dr.coOp),ur!=="st"&&ur!=="gs"&&cr.beginPath(),lr.ctxTransform(dr.preTransforms.finalTransform.props),ir=ar.length,tr=0;tr<ir;tr+=1){for((ur==="st"||ur==="gs")&&(cr.beginPath(),dr.da&&(cr.setLineDash(dr.da),cr.lineDashOffset=dr.do)),or=ar[tr].trNodes,sr=or.length,nr=0;nr<sr;nr+=1)or[nr].t==="m"?cr.moveTo(or[nr].p[0],or[nr].p[1]):or[nr].t==="c"?cr.bezierCurveTo(or[nr].pts[0],or[nr].pts[1],or[nr].pts[2],or[nr].pts[3],or[nr].pts[4],or[nr].pts[5]):cr.closePath();(ur==="st"||ur==="gs")&&(cr.stroke(),dr.da&&cr.setLineDash(this.dashResetter))}ur!=="st"&&ur!=="gs"&&cr.fill(dr.r),lr.restore()}},CVShapeElement.prototype.renderShape=function(rr,er,tr,ir){var nr,sr=er.length-1,ar;for(ar=rr,nr=sr;nr>=0;nr-=1)er[nr].ty==="tr"?(ar=tr[nr].transform,this.renderShapeTransform(rr,ar)):er[nr].ty==="sh"||er[nr].ty==="el"||er[nr].ty==="rc"||er[nr].ty==="sr"?this.renderPath(er[nr],tr[nr]):er[nr].ty==="fl"?this.renderFill(er[nr],tr[nr],ar):er[nr].ty==="st"?this.renderStroke(er[nr],tr[nr],ar):er[nr].ty==="gf"||er[nr].ty==="gs"?this.renderGradientFill(er[nr],tr[nr],ar):er[nr].ty==="gr"?this.renderShape(ar,er[nr].it,tr[nr].it):er[nr].ty;ir&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(rr,er){if(this._isFirstFrame||er._mdf||rr.transforms._mdf){var tr=rr.trNodes,ir=er.paths,nr,sr,ar,or=ir._length;tr.length=0;var lr=rr.transforms.finalTransform;for(ar=0;ar<or;ar+=1){var cr=ir.shapes[ar];if(cr&&cr.v){for(sr=cr._length,nr=1;nr<sr;nr+=1)nr===1&&tr.push({t:"m",p:lr.applyToPointArray(cr.v[0][0],cr.v[0][1],0)}),tr.push({t:"c",pts:lr.applyToTriplePoints(cr.o[nr-1],cr.i[nr],cr.v[nr])});sr===1&&tr.push({t:"m",p:lr.applyToPointArray(cr.v[0][0],cr.v[0][1],0)}),cr.c&&sr&&(tr.push({t:"c",pts:lr.applyToTriplePoints(cr.o[nr-1],cr.i[0],cr.v[0])}),tr.push({t:"z"}))}}rr.trNodes=tr}},CVShapeElement.prototype.renderPath=function(rr,er){if(rr.hd!==!0&&rr._shouldRender){var tr,ir=er.styledShapes.length;for(tr=0;tr<ir;tr+=1)this.renderStyledShape(er.styledShapes[tr],er.sh)}},CVShapeElement.prototype.renderFill=function(rr,er,tr){var ir=er.style;(er.c._mdf||this._isFirstFrame)&&(ir.co="rgb("+bmFloor(er.c.v[0])+","+bmFloor(er.c.v[1])+","+bmFloor(er.c.v[2])+")"),(er.o._mdf||tr._opMdf||this._isFirstFrame)&&(ir.coOp=er.o.v*tr.opacity)},CVShapeElement.prototype.renderGradientFill=function(rr,er,tr){var ir=er.style,nr;if(!ir.grd||er.g._mdf||er.s._mdf||er.e._mdf||rr.t!==1&&(er.h._mdf||er.a._mdf)){var sr=this.globalData.canvasContext,ar=er.s.v,or=er.e.v;if(rr.t===1)nr=sr.createLinearGradient(ar[0],ar[1],or[0],or[1]);else{var lr=Math.sqrt(Math.pow(ar[0]-or[0],2)+Math.pow(ar[1]-or[1],2)),cr=Math.atan2(or[1]-ar[1],or[0]-ar[0]),ur=er.h.v;ur>=1?ur=.99:ur<=-1&&(ur=-.99);var dr=lr*ur,hr=Math.cos(cr+er.a.v)*dr+ar[0],pr=Math.sin(cr+er.a.v)*dr+ar[1];nr=sr.createRadialGradient(hr,pr,0,ar[0],ar[1],lr)}var gr,vr=rr.g.p,mr=er.g.c,fr=1;for(gr=0;gr<vr;gr+=1)er.g._hasOpacity&&er.g._collapsable&&(fr=er.g.o[gr*2+1]),nr.addColorStop(mr[gr*4]/100,"rgba("+mr[gr*4+1]+","+mr[gr*4+2]+","+mr[gr*4+3]+","+fr+")");ir.grd=nr}ir.coOp=er.o.v*tr.opacity},CVShapeElement.prototype.renderStroke=function(rr,er,tr){var ir=er.style,nr=er.d;nr&&(nr._mdf||this._isFirstFrame)&&(ir.da=nr.dashArray,ir.do=nr.dashoffset[0]),(er.c._mdf||this._isFirstFrame)&&(ir.co="rgb("+bmFloor(er.c.v[0])+","+bmFloor(er.c.v[1])+","+bmFloor(er.c.v[2])+")"),(er.o._mdf||tr._opMdf||this._isFirstFrame)&&(ir.coOp=er.o.v*tr.opacity),(er.w._mdf||this._isFirstFrame)&&(ir.wi=er.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var rr=this.textProperty.currentData;this.renderedLetters=createSizedArray(rr.l?rr.l.length:0);var er=!1;rr.fc?(er=!0,this.values.fill=this.buildColor(rr.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=er;var tr=!1;rr.sc&&(tr=!0,this.values.stroke=this.buildColor(rr.sc),this.values.sWidth=rr.sw);var ir=this.globalData.fontManager.getFontByName(rr.f),nr,sr,ar=rr.l,or=this.mHelper;this.stroke=tr,this.values.fValue=rr.finalSize+"px "+this.globalData.fontManager.getFontByName(rr.f).fFamily,sr=rr.finalText.length;var lr,cr,ur,dr,hr,pr,gr,vr,mr,fr,_r=this.data.singleShape,Ar=rr.tr*.001*rr.finalSize,yr=0,wr=0,xr=!0,Sr=0;for(nr=0;nr<sr;nr+=1){lr=this.globalData.fontManager.getCharData(rr.finalText[nr],ir.fStyle,this.globalData.fontManager.getFontByName(rr.f).fFamily),cr=lr&&lr.data||{},or.reset(),_r&&ar[nr].n&&(yr=-Ar,wr+=rr.yOffset,wr+=xr?1:0,xr=!1),hr=cr.shapes?cr.shapes[0].it:[],gr=hr.length,or.scale(rr.finalSize/100,rr.finalSize/100),_r&&this.applyTextPropertiesToMatrix(rr,or,ar[nr].line,yr,wr),mr=createSizedArray(gr-1);var br=0;for(pr=0;pr<gr;pr+=1)if(hr[pr].ty==="sh"){for(dr=hr[pr].ks.k.i.length,vr=hr[pr].ks.k,fr=[],ur=1;ur<dr;ur+=1)ur===1&&fr.push(or.applyToX(vr.v[0][0],vr.v[0][1],0),or.applyToY(vr.v[0][0],vr.v[0][1],0)),fr.push(or.applyToX(vr.o[ur-1][0],vr.o[ur-1][1],0),or.applyToY(vr.o[ur-1][0],vr.o[ur-1][1],0),or.applyToX(vr.i[ur][0],vr.i[ur][1],0),or.applyToY(vr.i[ur][0],vr.i[ur][1],0),or.applyToX(vr.v[ur][0],vr.v[ur][1],0),or.applyToY(vr.v[ur][0],vr.v[ur][1],0));fr.push(or.applyToX(vr.o[ur-1][0],vr.o[ur-1][1],0),or.applyToY(vr.o[ur-1][0],vr.o[ur-1][1],0),or.applyToX(vr.i[0][0],vr.i[0][1],0),or.applyToY(vr.i[0][0],vr.i[0][1],0),or.applyToX(vr.v[0][0],vr.v[0][1],0),or.applyToY(vr.v[0][0],vr.v[0][1],0)),mr[br]=fr,br+=1}_r&&(yr+=ar[nr].l,yr+=Ar),this.textSpans[Sr]?this.textSpans[Sr].elem=mr:this.textSpans[Sr]={elem:mr},Sr+=1}},CVTextElement.prototype.renderInnerContent=function(){var rr=this.canvasContext;rr.font=this.values.fValue,rr.lineCap="butt",rr.lineJoin="miter",rr.miterLimit=4,this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var er,tr,ir,nr,sr,ar,or=this.textAnimator.renderedLetters,lr=this.textProperty.currentData.l;tr=lr.length;var cr,ur=null,dr=null,hr=null,pr,gr;for(er=0;er<tr;er+=1)if(!lr[er].n){if(cr=or[er],cr&&(this.globalData.renderer.save(),this.globalData.renderer.ctxTransform(cr.p),this.globalData.renderer.ctxOpacity(cr.o)),this.fill){for(cr&&cr.fc?ur!==cr.fc&&(ur=cr.fc,rr.fillStyle=cr.fc):ur!==this.values.fill&&(ur=this.values.fill,rr.fillStyle=this.values.fill),pr=this.textSpans[er].elem,nr=pr.length,this.globalData.canvasContext.beginPath(),ir=0;ir<nr;ir+=1)for(gr=pr[ir],ar=gr.length,this.globalData.canvasContext.moveTo(gr[0],gr[1]),sr=2;sr<ar;sr+=6)this.globalData.canvasContext.bezierCurveTo(gr[sr],gr[sr+1],gr[sr+2],gr[sr+3],gr[sr+4],gr[sr+5]);this.globalData.canvasContext.closePath(),this.globalData.canvasContext.fill()}if(this.stroke){for(cr&&cr.sw?hr!==cr.sw&&(hr=cr.sw,rr.lineWidth=cr.sw):hr!==this.values.sWidth&&(hr=this.values.sWidth,rr.lineWidth=this.values.sWidth),cr&&cr.sc?dr!==cr.sc&&(dr=cr.sc,rr.strokeStyle=cr.sc):dr!==this.values.stroke&&(dr=this.values.stroke,rr.strokeStyle=this.values.stroke),pr=this.textSpans[er].elem,nr=pr.length,this.globalData.canvasContext.beginPath(),ir=0;ir<nr;ir+=1)for(gr=pr[ir],ar=gr.length,this.globalData.canvasContext.moveTo(gr[0],gr[1]),sr=2;sr<ar;sr+=6)this.globalData.canvasContext.bezierCurveTo(gr[sr],gr[sr+1],gr[sr+2],gr[sr+3],gr[sr+4],gr[sr+5]);this.globalData.canvasContext.closePath(),this.globalData.canvasContext.stroke()}cr&&this.globalData.renderer.restore()}},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var rr=createTag("canvas");rr.width=this.assetData.w,rr.height=this.assetData.h;var er=rr.getContext("2d"),tr=this.img.width,ir=this.img.height,nr=tr/ir,sr=this.assetData.w/this.assetData.h,ar,or,lr=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;nr>sr&&lr==="xMidYMid slice"||nr<sr&&lr!=="xMidYMid slice"?(or=ir,ar=or*sr):(ar=tr,or=ar/sr),er.drawImage(this.img,(tr-ar)/2,(ir-or)/2,ar,or,0,0,this.assetData.w,this.assetData.h),this.img=rr}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null},extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){var rr=this.canvasContext;rr.fillStyle=this.data.sc,rr.fillRect(0,0,this.data.sw,this.data.sh)},extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(rr){return new CVShapeElement(rr,this.globalData,this)},CanvasRendererBase.prototype.createText=function(rr){return new CVTextElement(rr,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(rr){return new CVImageElement(rr,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(rr){return new CVSolidElement(rr,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(rr){if(!(rr[0]===1&&rr[1]===0&&rr[4]===0&&rr[5]===1&&rr[12]===0&&rr[13]===0)){if(!this.renderConfig.clearCanvas){this.canvasContext.transform(rr[0],rr[1],rr[4],rr[5],rr[12],rr[13]);return}this.transformMat.cloneFromProps(rr);var er=this.contextData.cTr.props;this.transformMat.transform(er[0],er[1],er[2],er[3],er[4],er[5],er[6],er[7],er[8],er[9],er[10],er[11],er[12],er[13],er[14],er[15]),this.contextData.cTr.cloneFromProps(this.transformMat.props);var tr=this.contextData.cTr.props;this.canvasContext.setTransform(tr[0],tr[1],tr[4],tr[5],tr[12],tr[13])}},CanvasRendererBase.prototype.ctxOpacity=function(rr){if(!this.renderConfig.clearCanvas){this.canvasContext.globalAlpha*=rr<0?0:rr,this.globalData.currentGlobalAlpha=this.contextData.cO;return}this.contextData.cO*=rr<0?0:rr,this.globalData.currentGlobalAlpha!==this.contextData.cO&&(this.canvasContext.globalAlpha=this.contextData.cO,this.globalData.currentGlobalAlpha=this.contextData.cO)},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(rr){if(!this.renderConfig.clearCanvas){this.canvasContext.save();return}rr&&this.canvasContext.save();var er=this.contextData.cTr.props;this.contextData._length<=this.contextData.cArrPos&&this.contextData.duplicate();var tr,ir=this.contextData.saved[this.contextData.cArrPos];for(tr=0;tr<16;tr+=1)ir[tr]=er[tr];this.contextData.savedOp[this.contextData.cArrPos]=this.contextData.cO,this.contextData.cArrPos+=1},CanvasRendererBase.prototype.restore=function(rr){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}rr&&(this.canvasContext.restore(),this.globalData.blendMode="source-over"),this.contextData.cArrPos-=1;var er=this.contextData.saved[this.contextData.cArrPos],tr,ir=this.contextData.cTr.props;for(tr=0;tr<16;tr+=1)ir[tr]=er[tr];this.canvasContext.setTransform(er[0],er[1],er[4],er[5],er[12],er[13]),er=this.contextData.savedOp[this.contextData.cArrPos],this.contextData.cO=er,this.globalData.currentGlobalAlpha!==er&&(this.canvasContext.globalAlpha=er,this.globalData.currentGlobalAlpha=er)},CanvasRendererBase.prototype.configAnimation=function(rr){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var er=this.animationItem.container.style;er.width="100%",er.height="100%";var tr="0px 0px 0px";er.transformOrigin=tr,er.mozTransformOrigin=tr,er.webkitTransformOrigin=tr,er["-webkit-transform"]=tr,er.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.data=rr,this.layers=rr.layers,this.transformCanvas={w:rr.w,h:rr.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(rr,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(rr.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(){this.reset();var rr,er;this.animationItem.wrapper&&this.animationItem.container?(rr=this.animationItem.wrapper.offsetWidth,er=this.animationItem.wrapper.offsetHeight,this.animationItem.container.setAttribute("width",rr*this.renderConfig.dpr),this.animationItem.container.setAttribute("height",er*this.renderConfig.dpr)):(rr=this.canvasContext.canvas.width*this.renderConfig.dpr,er=this.canvasContext.canvas.height*this.renderConfig.dpr);var tr,ir;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var nr=this.renderConfig.preserveAspectRatio.split(" "),sr=nr[1]||"meet",ar=nr[0]||"xMidYMid",or=ar.substr(0,4),lr=ar.substr(4);tr=rr/er,ir=this.transformCanvas.w/this.transformCanvas.h,ir>tr&&sr==="meet"||ir<tr&&sr==="slice"?(this.transformCanvas.sx=rr/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=rr/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=er/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=er/(this.transformCanvas.h/this.renderConfig.dpr)),or==="xMid"&&(ir<tr&&sr==="meet"||ir>tr&&sr==="slice")?this.transformCanvas.tx=(rr-this.transformCanvas.w*(er/this.transformCanvas.h))/2*this.renderConfig.dpr:or==="xMax"&&(ir<tr&&sr==="meet"||ir>tr&&sr==="slice")?this.transformCanvas.tx=(rr-this.transformCanvas.w*(er/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,lr==="YMid"&&(ir>tr&&sr==="meet"||ir<tr&&sr==="slice")?this.transformCanvas.ty=(er-this.transformCanvas.h*(rr/this.transformCanvas.w))/2*this.renderConfig.dpr:lr==="YMax"&&(ir>tr&&sr==="meet"||ir<tr&&sr==="slice")?this.transformCanvas.ty=(er-this.transformCanvas.h*(rr/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=rr/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=er/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var rr,er=this.layers?this.layers.length:0;for(rr=er-1;rr>=0;rr-=1)this.elements[rr]&&this.elements[rr].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(rr,er){if(!(this.renderedFrame===rr&&this.renderConfig.clearCanvas===!0&&!er||this.destroyed||rr===-1)){this.renderedFrame=rr,this.globalData.frameNum=rr-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||er,this.globalData.projectInterface.currentFrame=rr;var tr,ir=this.layers.length;for(this.completeLayers||this.checkLayers(rr),tr=0;tr<ir;tr+=1)(this.completeLayers||this.elements[tr])&&this.elements[tr].prepareFrame(rr-this.layers[tr].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),tr=ir-1;tr>=0;tr-=1)(this.completeLayers||this.elements[tr])&&this.elements[tr].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(rr){var er=this.elements;if(!(er[rr]||this.layers[rr].ty===99)){var tr=this.createItem(this.layers[rr],this,this.globalData);er[rr]=tr,tr.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var rr=this.pendingElements.pop();rr.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"},extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var rr=this.canvasContext;rr.beginPath(),rr.moveTo(0,0),rr.lineTo(this.data.w,0),rr.lineTo(this.data.w,this.data.h),rr.lineTo(0,this.data.h),rr.lineTo(0,0),rr.clip();var er,tr=this.layers.length;for(er=tr-1;er>=0;er-=1)(this.completeLayers||this.elements[er])&&this.elements[er].renderFrame()},CVCompElement.prototype.destroy=function(){var rr,er=this.layers.length;for(rr=er-1;rr>=0;rr-=1)this.elements[rr]&&this.elements[rr].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(rr){return new CVCompElement(rr,this.globalData,this)},extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(rr){return new CVCompElement(rr,this.globalData,this)},registerRenderer("canvas",CanvasRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier);const Expressions=function(){var rr={};rr.initExpressions=er;function er(tr){var ir=0,nr=[];function sr(){ir+=1}function ar(){ir-=1,ir===0&&lr()}function or(cr){nr.indexOf(cr)===-1&&nr.push(cr)}function lr(){var cr,ur=nr.length;for(cr=0;cr<ur;cr+=1)nr[cr].release();nr.length=0}tr.renderer.compInterface=CompExpressionInterface(tr.renderer),tr.renderer.globalData.projectInterface.registerComposition(tr.renderer),tr.renderer.globalData.pushExpression=sr,tr.renderer.globalData.popExpression=ar,tr.renderer.globalData.registerExpressionProperty=or}return rr}();var propTypes={SHAPE:"shape"};const ExpressionManager=function(){"use strict";var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null;initialize$2(BMMath);function $bm_isInstanceOfArray(rr){return rr.constructor===Array||rr.constructor===Float32Array}function isNumerable(rr,er){return rr==="number"||rr==="boolean"||rr==="string"||er instanceof Number}function $bm_neg(rr){var er=typeof rr;if(er==="number"||er==="boolean"||rr instanceof Number)return-rr;if($bm_isInstanceOfArray(rr)){var tr,ir=rr.length,nr=[];for(tr=0;tr<ir;tr+=1)nr[tr]=-rr[tr];return nr}return rr.propType?rr.v:-rr}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(rr,er){var tr=typeof rr,ir=typeof er;if(tr==="string"||ir==="string"||isNumerable(tr,rr)&&isNumerable(ir,er))return rr+er;if($bm_isInstanceOfArray(rr)&&isNumerable(ir,er))return rr=rr.slice(0),rr[0]+=er,rr;if(isNumerable(tr,rr)&&$bm_isInstanceOfArray(er))return er=er.slice(0),er[0]=rr+er[0],er;if($bm_isInstanceOfArray(rr)&&$bm_isInstanceOfArray(er)){for(var nr=0,sr=rr.length,ar=er.length,or=[];nr<sr||nr<ar;)(typeof rr[nr]=="number"||rr[nr]instanceof Number)&&(typeof er[nr]=="number"||er[nr]instanceof Number)?or[nr]=rr[nr]+er[nr]:or[nr]=er[nr]===void 0?rr[nr]:rr[nr]||er[nr],nr+=1;return or}return 0}var add=sum;function sub(rr,er){var tr=typeof rr,ir=typeof er;if(isNumerable(tr,rr)&&isNumerable(ir,er))return tr==="string"&&(rr=parseInt(rr,10)),ir==="string"&&(er=parseInt(er,10)),rr-er;if($bm_isInstanceOfArray(rr)&&isNumerable(ir,er))return rr=rr.slice(0),rr[0]-=er,rr;if(isNumerable(tr,rr)&&$bm_isInstanceOfArray(er))return er=er.slice(0),er[0]=rr-er[0],er;if($bm_isInstanceOfArray(rr)&&$bm_isInstanceOfArray(er)){for(var nr=0,sr=rr.length,ar=er.length,or=[];nr<sr||nr<ar;)(typeof rr[nr]=="number"||rr[nr]instanceof Number)&&(typeof er[nr]=="number"||er[nr]instanceof Number)?or[nr]=rr[nr]-er[nr]:or[nr]=er[nr]===void 0?rr[nr]:rr[nr]||er[nr],nr+=1;return or}return 0}function mul(rr,er){var tr=typeof rr,ir=typeof er,nr;if(isNumerable(tr,rr)&&isNumerable(ir,er))return rr*er;var sr,ar;if($bm_isInstanceOfArray(rr)&&isNumerable(ir,er)){for(ar=rr.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=rr[sr]*er;return nr}if(isNumerable(tr,rr)&&$bm_isInstanceOfArray(er)){for(ar=er.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=rr*er[sr];return nr}return 0}function div(rr,er){var tr=typeof rr,ir=typeof er,nr;if(isNumerable(tr,rr)&&isNumerable(ir,er))return rr/er;var sr,ar;if($bm_isInstanceOfArray(rr)&&isNumerable(ir,er)){for(ar=rr.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=rr[sr]/er;return nr}if(isNumerable(tr,rr)&&$bm_isInstanceOfArray(er)){for(ar=er.length,nr=createTypedArray("float32",ar),sr=0;sr<ar;sr+=1)nr[sr]=rr/er[sr];return nr}return 0}function mod(rr,er){return typeof rr=="string"&&(rr=parseInt(rr,10)),typeof er=="string"&&(er=parseInt(er,10)),rr%er}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(rr,er,tr){if(er>tr){var ir=tr;tr=er,er=ir}return Math.min(Math.max(rr,er),tr)}function radiansToDegrees(rr){return rr/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(rr){return rr*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(rr,er){if(typeof rr=="number"||rr instanceof Number)return er=er||0,Math.abs(rr-er);er||(er=helperLengthArray);var tr,ir=Math.min(rr.length,er.length),nr=0;for(tr=0;tr<ir;tr+=1)nr+=Math.pow(er[tr]-rr[tr],2);return Math.sqrt(nr)}function normalize(rr){return div(rr,length(rr))}function rgbToHsl(rr){var er=rr[0],tr=rr[1],ir=rr[2],nr=Math.max(er,tr,ir),sr=Math.min(er,tr,ir),ar,or,lr=(nr+sr)/2;if(nr===sr)ar=0,or=0;else{var cr=nr-sr;switch(or=lr>.5?cr/(2-nr-sr):cr/(nr+sr),nr){case er:ar=(tr-ir)/cr+(tr<ir?6:0);break;case tr:ar=(ir-er)/cr+2;break;case ir:ar=(er-tr)/cr+4;break;default:break}ar/=6}return[ar,or,lr,rr[3]]}function hue2rgb(rr,er,tr){return tr<0&&(tr+=1),tr>1&&(tr-=1),tr<1/6?rr+(er-rr)*6*tr:tr<1/2?er:tr<2/3?rr+(er-rr)*(2/3-tr)*6:rr}function hslToRgb(rr){var er=rr[0],tr=rr[1],ir=rr[2],nr,sr,ar;if(tr===0)nr=ir,ar=ir,sr=ir;else{var or=ir<.5?ir*(1+tr):ir+tr-ir*tr,lr=2*ir-or;nr=hue2rgb(lr,or,er+1/3),sr=hue2rgb(lr,or,er),ar=hue2rgb(lr,or,er-1/3)}return[nr,sr,ar,rr[3]]}function linear(rr,er,tr,ir,nr){if((ir===void 0||nr===void 0)&&(ir=er,nr=tr,er=0,tr=1),tr<er){var sr=tr;tr=er,er=sr}if(rr<=er)return ir;if(rr>=tr)return nr;var ar=tr===er?0:(rr-er)/(tr-er);if(!ir.length)return ir+(nr-ir)*ar;var or,lr=ir.length,cr=createTypedArray("float32",lr);for(or=0;or<lr;or+=1)cr[or]=ir[or]+(nr[or]-ir[or])*ar;return cr}function random(rr,er){if(er===void 0&&(rr===void 0?(rr=0,er=1):(er=rr,rr=void 0)),er.length){var tr,ir=er.length;rr||(rr=createTypedArray("float32",ir));var nr=createTypedArray("float32",ir),sr=BMMath.random();for(tr=0;tr<ir;tr+=1)nr[tr]=rr[tr]+sr*(er[tr]-rr[tr]);return nr}rr===void 0&&(rr=0);var ar=BMMath.random();return rr+ar*(er-rr)}function createPath(rr,er,tr,ir){var nr,sr=rr.length,ar=shapePool.newElement();ar.setPathData(!!ir,sr);var or=[0,0],lr,cr;for(nr=0;nr<sr;nr+=1)lr=er&&er[nr]?er[nr]:or,cr=tr&&tr[nr]?tr[nr]:or,ar.setTripleAt(rr[nr][0],rr[nr][1],cr[0]+rr[nr][0],cr[1]+rr[nr][1],lr[0]+rr[nr][0],lr[1]+rr[nr][1],nr,!0);return ar}function initiateExpression(elem,data,property){var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=function rr(er,tr){var ir,nr,sr=this.pv.length?this.pv.length:1,ar=createTypedArray("float32",sr);er=5;var or=Math.floor(time*er);for(ir=0,nr=0;ir<or;){for(nr=0;nr<sr;nr+=1)ar[nr]+=-tr+tr*2*BMMath.random();ir+=1}var lr=time*er,cr=lr-Math.floor(lr),ur=createTypedArray("float32",sr);if(sr>1){for(nr=0;nr<sr;nr+=1)ur[nr]=this.pv[nr]+ar[nr]+(-tr+tr*2*BMMath.random())*cr;return ur}return this.pv+ar[0]+(-tr+tr*2*BMMath.random())*cr}.bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(rr,er){return loopIn(rr,er,!0)}function loopOutDuration(rr,er){return loopOut(rr,er,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(rr,er){var tr=[er[0]-rr[0],er[1]-rr[1],er[2]-rr[2]],ir=Math.atan2(tr[0],Math.sqrt(tr[1]*tr[1]+tr[2]*tr[2]))/degToRads,nr=-Math.atan2(tr[1],tr[2])/degToRads;return[nr,ir,0]}function easeOut(rr,er,tr,ir,nr){return applyEase(easeOutBez,rr,er,tr,ir,nr)}function easeIn(rr,er,tr,ir,nr){return applyEase(easeInBez,rr,er,tr,ir,nr)}function ease(rr,er,tr,ir,nr){return applyEase(easeInOutBez,rr,er,tr,ir,nr)}function applyEase(rr,er,tr,ir,nr,sr){nr===void 0?(nr=tr,sr=ir):er=(er-tr)/(ir-tr),er>1?er=1:er<0&&(er=0);var ar=rr(er);if($bm_isInstanceOfArray(nr)){var or,lr=nr.length,cr=createTypedArray("float32",lr);for(or=0;or<lr;or+=1)cr[or]=(sr[or]-nr[or])*ar+nr[or];return cr}return(sr-nr)*ar+nr}function nearestKey(rr){var er,tr=data.k.length,ir,nr;if(!data.k.length||typeof data.k[0]=="number")ir=0,nr=0;else if(ir=-1,rr*=elem.comp.globalData.frameRate,rr<data.k[0].t)ir=1,nr=data.k[0].t;else{for(er=0;er<tr-1;er+=1)if(rr===data.k[er].t){ir=er+1,nr=data.k[er].t;break}else if(rr>data.k[er].t&&rr<data.k[er+1].t){rr-data.k[er].t>data.k[er+1].t-rr?(ir=er+2,nr=data.k[er+1].t):(ir=er+1,nr=data.k[er].t);break}ir===-1&&(ir=er+1,nr=data.k[er].t)}var sr={};return sr.index=ir,sr.time=nr/elem.comp.globalData.frameRate,sr}function key(rr){var er,tr,ir;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+rr);rr-=1,er={time:data.k[rr].t/elem.comp.globalData.frameRate,value:[]};var nr=Object.prototype.hasOwnProperty.call(data.k[rr],"s")?data.k[rr].s:data.k[rr-1].e;for(ir=nr.length,tr=0;tr<ir;tr+=1)er[tr]=nr[tr],er.value[tr]=nr[tr];return er}function framesToTime(rr,er){return er||(er=elem.comp.globalData.frameRate),rr/er}function timeToFrames(rr,er){return!rr&&rr!==0&&(rr=time),er||(er=elem.comp.globalData.frameRate),rr*er}function seedRandom(rr){BMMath.seedrandom(randSeed+rr)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(rr,er){return typeof value=="string"?er===void 0?value.substring(rr):value.substring(rr,er):""}function substr(rr,er){return typeof value=="string"?er===void 0?value.substr(rr):value.substr(rr,er):""}function posterizeTime(rr){time=rr===0?0:Math.floor(time*rr)/rr,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(rr){return value=rr,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath],ob}(),expressionHelpers=function(){function rr(ar,or,lr){or.x&&(lr.k=!0,lr.x=!0,lr.initiateExpression=ExpressionManager.initiateExpression,lr.effectsSequence.push(lr.initiateExpression(ar,or,lr).bind(lr)))}function er(ar){return ar*=this.elem.globalData.frameRate,ar-=this.offsetTime,ar!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<ar?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(ar,this._cachingAtTime),this._cachingAtTime.lastFrame=ar),this._cachingAtTime.value}function tr(ar){var or=-.01,lr=this.getValueAtTime(ar),cr=this.getValueAtTime(ar+or),ur=0;if(lr.length){var dr;for(dr=0;dr<lr.length;dr+=1)ur+=Math.pow(cr[dr]-lr[dr],2);ur=Math.sqrt(ur)*100}else ur=0;return ur}function ir(ar){if(this.vel!==void 0)return this.vel;var or=-.001,lr=this.getValueAtTime(ar),cr=this.getValueAtTime(ar+or),ur;if(lr.length){ur=createTypedArray("float32",lr.length);var dr;for(dr=0;dr<lr.length;dr+=1)ur[dr]=(cr[dr]-lr[dr])/or}else ur=(cr-lr)/or;return ur}function nr(){return this.pv}function sr(ar){this.propertyGroup=ar}return{searchExpressions:rr,getSpeedAtTime:tr,getVelocityAtTime:ir,getValueAtTime:er,getStaticValueAtTime:nr,setGroupProperty:sr}}();setExpressionsPlugin(Expressions),initialize$1(),initialize()}class LottieLoader extends Loader{setQuality(er){this._quality=er}load(er,tr,ir,nr){const sr=this._quality||1,ar=new CanvasTexture;ar.minFilter=NearestFilter,ar.generateMipmaps=!1,ar.colorSpace=SRGBColorSpace;const or=new FileLoader(this.manager);return or.setPath(this.path),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){const cr=JSON.parse(lr),ur=document.createElement("div");ur.style.width=cr.w+"px",ur.style.height=cr.h+"px",document.body.appendChild(ur);const dr=lottie.loadAnimation({container:ur,animType:"canvas",loop:!0,autoplay:!0,animationData:cr,rendererSettings:{dpr:sr}});ar.animation=dr,ar.image=dr.container,dr.addEventListener("enterFrame",function(){ar.needsUpdate=!0}),ur.style.display="none",tr!==void 0&&tr(ar)},ir,nr),ar}}const _normalData=[[-.525731,0,.850651],[-.442863,.238856,.864188],[-.295242,0,.955423],[-.309017,.5,.809017],[-.16246,.262866,.951056],[0,0,1],[0,.850651,.525731],[-.147621,.716567,.681718],[.147621,.716567,.681718],[0,.525731,.850651],[.309017,.5,.809017],[.525731,0,.850651],[.295242,0,.955423],[.442863,.238856,.864188],[.16246,.262866,.951056],[-.681718,.147621,.716567],[-.809017,.309017,.5],[-.587785,.425325,.688191],[-.850651,.525731,0],[-.864188,.442863,.238856],[-.716567,.681718,.147621],[-.688191,.587785,.425325],[-.5,.809017,.309017],[-.238856,.864188,.442863],[-.425325,.688191,.587785],[-.716567,.681718,-.147621],[-.5,.809017,-.309017],[-.525731,.850651,0],[0,.850651,-.525731],[-.238856,.864188,-.442863],[0,.955423,-.295242],[-.262866,.951056,-.16246],[0,1,0],[0,.955423,.295242],[-.262866,.951056,.16246],[.238856,.864188,.442863],[.262866,.951056,.16246],[.5,.809017,.309017],[.238856,.864188,-.442863],[.262866,.951056,-.16246],[.5,.809017,-.309017],[.850651,.525731,0],[.716567,.681718,.147621],[.716567,.681718,-.147621],[.525731,.850651,0],[.425325,.688191,.587785],[.864188,.442863,.238856],[.688191,.587785,.425325],[.809017,.309017,.5],[.681718,.147621,.716567],[.587785,.425325,.688191],[.955423,.295242,0],[1,0,0],[.951056,.16246,.262866],[.850651,-.525731,0],[.955423,-.295242,0],[.864188,-.442863,.238856],[.951056,-.16246,.262866],[.809017,-.309017,.5],[.681718,-.147621,.716567],[.850651,0,.525731],[.864188,.442863,-.238856],[.809017,.309017,-.5],[.951056,.16246,-.262866],[.525731,0,-.850651],[.681718,.147621,-.716567],[.681718,-.147621,-.716567],[.850651,0,-.525731],[.809017,-.309017,-.5],[.864188,-.442863,-.238856],[.951056,-.16246,-.262866],[.147621,.716567,-.681718],[.309017,.5,-.809017],[.425325,.688191,-.587785],[.442863,.238856,-.864188],[.587785,.425325,-.688191],[.688191,.587785,-.425325],[-.147621,.716567,-.681718],[-.309017,.5,-.809017],[0,.525731,-.850651],[-.525731,0,-.850651],[-.442863,.238856,-.864188],[-.295242,0,-.955423],[-.16246,.262866,-.951056],[0,0,-1],[.295242,0,-.955423],[.16246,.262866,-.951056],[-.442863,-.238856,-.864188],[-.309017,-.5,-.809017],[-.16246,-.262866,-.951056],[0,-.850651,-.525731],[-.147621,-.716567,-.681718],[.147621,-.716567,-.681718],[0,-.525731,-.850651],[.309017,-.5,-.809017],[.442863,-.238856,-.864188],[.16246,-.262866,-.951056],[.238856,-.864188,-.442863],[.5,-.809017,-.309017],[.425325,-.688191,-.587785],[.716567,-.681718,-.147621],[.688191,-.587785,-.425325],[.587785,-.425325,-.688191],[0,-.955423,-.295242],[0,-1,0],[.262866,-.951056,-.16246],[0,-.850651,.525731],[0,-.955423,.295242],[.238856,-.864188,.442863],[.262866,-.951056,.16246],[.5,-.809017,.309017],[.716567,-.681718,.147621],[.525731,-.850651,0],[-.238856,-.864188,-.442863],[-.5,-.809017,-.309017],[-.262866,-.951056,-.16246],[-.850651,-.525731,0],[-.716567,-.681718,-.147621],[-.716567,-.681718,.147621],[-.525731,-.850651,0],[-.5,-.809017,.309017],[-.238856,-.864188,.442863],[-.262866,-.951056,.16246],[-.864188,-.442863,.238856],[-.809017,-.309017,.5],[-.688191,-.587785,.425325],[-.681718,-.147621,.716567],[-.442863,-.238856,.864188],[-.587785,-.425325,.688191],[-.309017,-.5,.809017],[-.147621,-.716567,.681718],[-.425325,-.688191,.587785],[-.16246,-.262866,.951056],[.442863,-.238856,.864188],[.16246,-.262866,.951056],[.309017,-.5,.809017],[.147621,-.716567,.681718],[0,-.525731,.850651],[.425325,-.688191,.587785],[.587785,-.425325,.688191],[.688191,-.587785,.425325],[-.955423,.295242,0],[-.951056,.16246,.262866],[-1,0,0],[-.850651,0,.525731],[-.955423,-.295242,0],[-.951056,-.16246,.262866],[-.864188,.442863,-.238856],[-.951056,.16246,-.262866],[-.809017,.309017,-.5],[-.864188,-.442863,-.238856],[-.951056,-.16246,-.262866],[-.809017,-.309017,-.5],[-.681718,.147621,-.716567],[-.681718,-.147621,-.716567],[-.850651,0,-.525731],[-.688191,.587785,-.425325],[-.587785,.425325,-.688191],[-.425325,.688191,-.587785],[-.425325,-.688191,-.587785],[-.587785,-.425325,-.688191],[-.688191,-.587785,-.425325]];class MD2Loader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=new DataView(er),ir={},nr=["ident","version","skinwidth","skinheight","framesize","num_skins","num_vertices","num_st","num_tris","num_glcmds","num_frames","offset_skins","offset_st","offset_tris","offset_frames","offset_glcmds","offset_end"];for(let yr=0;yr<nr.length;yr++)ir[nr[yr]]=tr.getInt32(yr*4,!0);if(ir.ident!==844121161||ir.version!==8){console.error("Not a valid MD2 file");return}if(ir.offset_end!==tr.byteLength){console.error("Corrupted MD2 file");return}const sr=new BufferGeometry,ar=[];let or=ir.offset_st;for(let yr=0,wr=ir.num_st;yr<wr;yr++){const xr=tr.getInt16(or+0,!0),Sr=tr.getInt16(or+2,!0);ar.push(xr/ir.skinwidth,1-Sr/ir.skinheight),or+=4}or=ir.offset_tris;const lr=[],cr=[];for(let yr=0,wr=ir.num_tris;yr<wr;yr++)lr.push(tr.getUint16(or+0,!0),tr.getUint16(or+2,!0),tr.getUint16(or+4,!0)),cr.push(tr.getUint16(or+6,!0),tr.getUint16(or+8,!0),tr.getUint16(or+10,!0)),or+=12;const ur=new Vector3$1,dr=new Vector3$1,hr=[];or=ir.offset_frames;for(let yr=0,wr=ir.num_frames;yr<wr;yr++){dr.set(tr.getFloat32(or+0,!0),tr.getFloat32(or+4,!0),tr.getFloat32(or+8,!0)),ur.set(tr.getFloat32(or+12,!0),tr.getFloat32(or+16,!0),tr.getFloat32(or+20,!0)),or+=24;const xr=[];for(let br=0;br<16;br++){const Cr=tr.getUint8(or+br);if(Cr===0)break;xr[br]=Cr}const Sr={name:String.fromCharCode.apply(null,xr),vertices:[],normals:[]};or+=16;for(let br=0;br<ir.num_vertices;br++){let Cr=tr.getUint8(or++),Ir=tr.getUint8(or++),Rr=tr.getUint8(or++);const Pr=_normalData[tr.getUint8(or++)];Cr=Cr*dr.x+ur.x,Ir=Ir*dr.y+ur.y,Rr=Rr*dr.z+ur.z,Sr.vertices.push(Cr,Rr,Ir),Sr.normals.push(Pr[0],Pr[2],Pr[1])}hr.push(Sr)}const pr=[],gr=[],vr=[],mr=hr[0].vertices,fr=hr[0].normals;for(let yr=0,wr=lr.length;yr<wr;yr++){let Sr=lr[yr]*3;const br=mr[Sr],Cr=mr[Sr+1],Ir=mr[Sr+2];pr.push(br,Cr,Ir);const Rr=fr[Sr],Pr=fr[Sr+1],Dr=fr[Sr+2];gr.push(Rr,Pr,Dr),Sr=cr[yr]*2;const Or=ar[Sr],Nr=ar[Sr+1];vr.push(Or,Nr)}sr.setAttribute("position",new Float32BufferAttribute(pr,3)),sr.setAttribute("normal",new Float32BufferAttribute(gr,3)),sr.setAttribute("uv",new Float32BufferAttribute(vr,2));const _r=[],Ar=[];for(let yr=0,wr=hr.length;yr<wr;yr++){const xr=hr[yr],Sr=xr.name;if(xr.vertices.length>0){const br=[];for(let Ir=0,Rr=lr.length;Ir<Rr;Ir++){const Dr=lr[Ir]*3,Fr=xr.vertices[Dr],Or=xr.vertices[Dr+1],Nr=xr.vertices[Dr+2];br.push(Fr,Or,Nr)}const Cr=new Float32BufferAttribute(br,3);Cr.name=Sr,_r.push(Cr)}if(xr.normals.length>0){const br=[];for(let Ir=0,Rr=lr.length;Ir<Rr;Ir++){const Dr=lr[Ir]*3,Fr=xr.normals[Dr],Or=xr.normals[Dr+1],Nr=xr.normals[Dr+2];br.push(Fr,Or,Nr)}const Cr=new Float32BufferAttribute(br,3);Cr.name=Sr,Ar.push(Cr)}}return sr.morphAttributes.position=_r,sr.morphAttributes.normal=Ar,sr.morphTargetsRelative=!1,sr.animations=AnimationClip.CreateClipsFromMorphTargetSequences(hr,10),sr}}class MDDLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.load(er,function(or){tr(sr.parse(or))},ir,nr)}parse(er){const tr=new DataView(er),ir=tr.getUint32(0),nr=tr.getUint32(4);let sr=8;const ar=new Float32Array(ir),or=new Float32Array(ir*ir).fill(0);for(let dr=0;dr<ir;dr++)ar[dr]=tr.getFloat32(sr),sr+=4,or[ir*dr+dr]=1;const lr=new NumberKeyframeTrack(".morphTargetInfluences",ar,or),cr=new AnimationClip("default",ar[ar.length-1],[lr]),ur=[];for(let dr=0;dr<ir;dr++){const hr=new Float32Array(nr*3);for(let gr=0;gr<nr;gr++){const vr=gr*3;hr[vr+0]=tr.getFloat32(sr),sr+=4,hr[vr+1]=tr.getFloat32(sr),sr+=4,hr[vr+2]=tr.getFloat32(sr),sr+=4}const pr=new BufferAttribute(hr,3);pr.name="morph_"+dr,ur.push(pr)}return{morphTargets:ur,clip:cr}}}const lights_mmd_toon_pars_fragment=`
varying vec3 vViewPosition;

struct BlinnPhongMaterial {

	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;

};

void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;

	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;

}

void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {

	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

}

#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
`,mmd_toon_matcap_fragment=`
#ifdef USE_MATCAP

	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5; // 0.495 to remove artifacts caused by undersized matcap disks
	vec4 matcapColor = texture2D( matcap, uv );

	#ifdef MATCAP_BLENDING_MULTIPLY

		outgoingLight *= matcapColor.rgb;

	#elif defined( MATCAP_BLENDING_ADD )

		outgoingLight += matcapColor.rgb;

	#endif

#endif
`,MMDToonShader={name:"MMDToonShader",defines:{TOON:!0,MATCAP:!0,MATCAP_BLENDING_ADD:!0},uniforms:UniformsUtils.merge([ShaderLib.toon.uniforms,ShaderLib.phong.uniforms,ShaderLib.matcap.uniforms]),vertexShader:ShaderLib.phong.vertexShader.replace("#include <envmap_pars_vertex>","").replace("#include <envmap_vertex>",""),fragmentShader:ShaderLib.phong.fragmentShader.replace("#include <common>",`
					#ifdef USE_MATCAP
						uniform sampler2D matcap;
					#endif

					#include <common>
				`).replace("#include <envmap_common_pars_fragment>",`
					#include <gradientmap_pars_fragment>
				`).replace("#include <envmap_pars_fragment>","").replace("#include <lights_phong_pars_fragment>",lights_mmd_toon_pars_fragment).replace("#include <envmap_fragment>",`
					${mmd_toon_matcap_fragment}
				`)};class MMDLoader extends Loader{constructor(er){super(er),this.loader=new FileLoader(this.manager),this.parser=null,this.meshBuilder=new MeshBuilder(this.manager),this.animationBuilder=new AnimationBuilder,console.warn("THREE.MMDLoader: The module has been deprecated and will be removed with r172. Please migrate to https://github.com/takahirox/three-mmd-loader instead.")}setAnimationPath(er){return this.animationPath=er,this}load(er,tr,ir,nr){const sr=this.meshBuilder.setCrossOrigin(this.crossOrigin);let ar;this.resourcePath!==""?ar=this.resourcePath:this.path!==""?ar=this.path:ar=LoaderUtils.extractUrlBase(er);const or=this._getParser(),lr=this._extractModelExtension;this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(er,function(cr){try{const ur=lr(cr);if(ur!=="pmd"&&ur!=="pmx"){nr&&nr(new Error("THREE.MMDLoader: Unknown model file extension ."+ur+"."));return}const dr=ur==="pmd"?or.parsePmd(cr,!0):or.parsePmx(cr,!0);tr(sr.build(dr,ar,ir,nr))}catch(ur){nr&&nr(ur)}},ir,nr)}loadAnimation(er,tr,ir,nr,sr){const ar=this.animationBuilder;this.loadVMD(er,function(or){ir(tr.isCamera?ar.buildCameraAnimation(or):ar.build(or,tr))},nr,sr)}loadWithAnimation(er,tr,ir,nr,sr){const ar=this;this.load(er,function(or){ar.loadAnimation(tr,or,function(lr){ir({mesh:or,animation:lr})},nr,sr)},nr,sr)}loadPMD(er,tr,ir,nr){const sr=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(er,function(ar){try{tr(sr.parsePmd(ar,!0))}catch(or){nr&&nr(or)}},ir,nr)}loadPMX(er,tr,ir,nr){const sr=this._getParser();this.loader.setMimeType(void 0).setPath(this.path).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(er,function(ar){try{tr(sr.parsePmx(ar,!0))}catch(or){nr&&nr(or)}},ir,nr)}loadVMD(er,tr,ir,nr){const sr=Array.isArray(er)?er:[er],ar=[],or=sr.length,lr=this._getParser();this.loader.setMimeType(void 0).setPath(this.animationPath).setResponseType("arraybuffer").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials);for(let cr=0,ur=sr.length;cr<ur;cr++)this.loader.load(sr[cr],function(dr){try{ar.push(lr.parseVmd(dr,!0)),ar.length===or&&tr(lr.mergeVmds(ar))}catch(hr){nr&&nr(hr)}},ir,nr)}loadVPD(er,tr,ir,nr,sr){const ar=this._getParser();this.loader.setMimeType(tr?void 0:"text/plain; charset=shift_jis").setPath(this.animationPath).setResponseType("text").setRequestHeader(this.requestHeader).setWithCredentials(this.withCredentials).load(er,function(or){try{ir(ar.parseVpd(or,!0))}catch(lr){sr&&sr(lr)}},nr,sr)}_extractModelExtension(er){const tr=new TextDecoder("utf-8"),ir=new Uint8Array(er,0,3);return tr.decode(ir).toLowerCase()}_getParser(){return this.parser===null&&(this.parser=new MMDParser.Parser),this.parser}}const DEFAULT_TOON_TEXTURES=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/bWiiMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh8aBHZBl14e8wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOUlEQVRYR+3WMREAMAwDsYY/yoDI7MLwIiP40+RJklfcCCBAgAABAgTqArfb/QMCCBAgQIAAgbbAB3z/e0F3js2cAAAAAElFTkSuQmCC","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAN0lEQVRYR+3WQREAMBACsZ5/B5ilMvgEBTt5cW37hjsBBAgQIECAwFwgyfYPCCBAgAABAgTWAh81dWyx0gFwKAAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAOklEQVRYR+3WoREAMAwDsWb/UQtCy9wxTOQJ/oQ8SXKKGwEECBAgQIBAXeDt7f4BAQQIECBAgEBb4AOz8Hzx7WLY4wAAAABJRU5ErkJggg==","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABPUlEQVRYR+1XwW7CMAy1+f9fZOMysSEOEweEOPRNdm3HbdOyIhAcklPrOs/PLy9RygBALxzcCDQFmgJNgaZAU6Ap0BR4PwX8gsRMVLssMRH5HcpzJEaWL7EVg9F1IHRlyqQohgVr4FGUlUcMJSjcUlDw0zvjeun70cLWmneoyf7NgBTQSniBTQQSuJAZsOnnaczjIMb5hCiuHKxokCrJfVnrctyZL0PkJAJe1HMil4nxeyi3Ypfn1kX51jpPvo/JeCNC4PhVdHdJw2XjBR8brF8PEIhNVn12AgP7uHsTBguBn53MUZCqv7Lp07Pn5k1Ro+uWmUNn7D+M57rtk7aG0Vo73xyF/fbFf0bPJjDXngnGocDTdFhygZjwUQrMNrDcmZlQT50VJ/g/UwNyHpu778+yW+/ksOz/BFo54P4AsUXMfRq7XWsAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACMElEQVRYR+2Xv4pTQRTGf2dubhLdICiii2KnYKHVolhauKWPoGAnNr6BD6CvIVaihYuI2i1ia0BY0MZGRHQXjZj/mSPnnskfNWiWZUlzJ5k7M2cm833nO5Mziej2DWWJRUoCpQKlAntSQCqgw39/iUWAGmh37jrRnVsKlgpiqmkoGVABA7E57fvY+pJDdgKqF6HzFCSADkDq+F6AHABtQ+UMVE5D7zXod7fFNhTEckTbj5XQgHzNN+5tQvc5NG7C6BNkp6D3EmpXHDR+dQAjFLchW3VS9rlw3JBh+B7ys5Cf9z0GW1C/7P32AyBAOAz1q4jGliIH3YPuBnSfQX4OGreTIgEYQb/pBDtPnEQ4CivXYPAWBk13oHrB54yA9QuSn2H4AcKRpEILDt0BUzj+RLR1V5EqjD66NPRBVpLcQwjHoHYJOhsQv6U4mnzmrIXJCFr4LDwm/xBUoboG9XX4cc9VKdYoSA2yk5NQLJaKDUjTBoveG3Z2TElTxwjNK4M3LEZgUdDdruvcXzKBpStgp2NPiWi3ks9ZXxIoFVi+AvHLdc9TqtjL3/aYjpPlrzOcEnK62Szhimdd7xX232zFDTgtxezOu3WNMRLjiKgjtOhHVMd1loynVHvOgjuIIJMaELEqhJAV/RCSLbWTcfPFakFgFlALTRRvx+ok6Hlp/Q+v3fmx90bMyUzaEAhmM3KvHlXTL5DxnbGf/1M8RNNACLL5MNtPxP/mypJAqcDSFfgFhpYqWUzhTEAAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAL0lEQVRYR+3QQREAAAzCsOFfNJPBJ1XQS9r2hsUAAQIECBAgQIAAAQIECBAgsBZ4MUx/ofm2I/kAAAAASUVORK5CYII="],NON_ALPHA_CHANNEL_FORMATS=[RGB_S3TC_DXT1_Format,RGB_PVRTC_4BPPV1_Format,RGB_PVRTC_2BPPV1_Format,RGB_ETC1_Format,RGB_ETC2_Format];class MeshBuilder{constructor(er){this.crossOrigin="anonymous",this.geometryBuilder=new GeometryBuilder,this.materialBuilder=new MaterialBuilder(er)}setCrossOrigin(er){return this.crossOrigin=er,this}build(er,tr,ir,nr){const sr=this.geometryBuilder.build(er),ar=this.materialBuilder.setCrossOrigin(this.crossOrigin).setResourcePath(tr).build(er,sr,ir,nr),or=new SkinnedMesh(sr,ar),lr=new Skeleton(initBones(or));return or.bind(lr),or}}function initBones(rr){const er=rr.geometry,tr=[];if(er&&er.bones!==void 0){for(let ir=0,nr=er.bones.length;ir<nr;ir++){const sr=er.bones[ir],ar=new Bone;tr.push(ar),ar.name=sr.name,ar.position.fromArray(sr.pos),ar.quaternion.fromArray(sr.rotq),sr.scl!==void 0&&ar.scale.fromArray(sr.scl)}for(let ir=0,nr=er.bones.length;ir<nr;ir++){const sr=er.bones[ir];sr.parent!==-1&&sr.parent!==null&&tr[sr.parent]!==void 0?tr[sr.parent].add(tr[ir]):rr.add(tr[ir])}}return rr.updateMatrixWorld(!0),tr}class GeometryBuilder{build(er){const tr=[],ir=[],nr=[],sr=[],ar=[],or=[],lr=[],cr=[],ur=[],dr=[],hr=[],pr=[],gr=[],vr=[];let mr=0;const fr={};for(let yr=0;yr<er.metadata.vertexCount;yr++){const wr=er.vertices[yr];for(let xr=0,Sr=wr.position.length;xr<Sr;xr++)tr.push(wr.position[xr]);for(let xr=0,Sr=wr.normal.length;xr<Sr;xr++)nr.push(wr.normal[xr]);for(let xr=0,Sr=wr.uv.length;xr<Sr;xr++)ir.push(wr.uv[xr]);for(let xr=0;xr<4;xr++)lr.push(wr.skinIndices.length-1>=xr?wr.skinIndices[xr]:0);for(let xr=0;xr<4;xr++)cr.push(wr.skinWeights.length-1>=xr?wr.skinWeights[xr]:0)}for(let yr=0;yr<er.metadata.faceCount;yr++){const wr=er.faces[yr];for(let xr=0,Sr=wr.indices.length;xr<Sr;xr++)sr.push(wr.indices[xr])}for(let yr=0;yr<er.metadata.materialCount;yr++){const wr=er.materials[yr];ar.push({offset:mr*3,count:wr.faceCount*3}),mr+=wr.faceCount}for(let yr=0;yr<er.metadata.rigidBodyCount;yr++){const wr=er.rigidBodies[yr];let xr=fr[wr.boneIndex];xr=xr===void 0?wr.type:Math.max(wr.type,xr),fr[wr.boneIndex]=xr}for(let yr=0;yr<er.metadata.boneCount;yr++){const wr=er.bones[yr],xr={index:yr,transformationClass:wr.transformationClass,parent:wr.parentIndex,name:wr.name,pos:wr.position.slice(0,3),rotq:[0,0,0,1],scl:[1,1,1],rigidBodyType:fr[yr]!==void 0?fr[yr]:-1};xr.parent!==-1&&(xr.pos[0]-=er.bones[xr.parent].position[0],xr.pos[1]-=er.bones[xr.parent].position[1],xr.pos[2]-=er.bones[xr.parent].position[2]),or.push(xr)}if(er.metadata.format==="pmd")for(let yr=0;yr<er.metadata.ikCount;yr++){const wr=er.iks[yr],xr={target:wr.target,effector:wr.effector,iteration:wr.iteration,maxAngle:wr.maxAngle*4,links:[]};for(let Sr=0,br=wr.links.length;Sr<br;Sr++){const Cr={};Cr.index=wr.links[Sr].index,Cr.enabled=!0,er.bones[Cr.index].name.indexOf("")>=0&&(Cr.limitation=new Vector3$1(1,0,0)),xr.links.push(Cr)}hr.push(xr)}else for(let yr=0;yr<er.metadata.boneCount;yr++){const wr=er.bones[yr].ik;if(wr===void 0)continue;const xr={target:yr,effector:wr.effector,iteration:wr.iteration,maxAngle:wr.maxAngle,links:[]};for(let Sr=0,br=wr.links.length;Sr<br;Sr++){const Cr={};if(Cr.index=wr.links[Sr].index,Cr.enabled=!0,wr.links[Sr].angleLimitation===1){const Ir=wr.links[Sr].lowerLimitationAngle,Rr=wr.links[Sr].upperLimitationAngle,Pr=-Rr[0],Dr=-Rr[1];Rr[0]=-Ir[0],Rr[1]=-Ir[1],Ir[0]=Pr,Ir[1]=Dr,Cr.rotationMin=new Vector3$1().fromArray(Ir),Cr.rotationMax=new Vector3$1().fromArray(Rr)}xr.links.push(Cr)}hr.push(xr),or[yr].ik=xr}if(er.metadata.format==="pmx"){let xr=function(Sr){Sr.param&&(pr.push(Sr.param),or[Sr.param.index].grant=Sr.param),Sr.visited=!0;for(let br=0,Cr=Sr.children.length;br<Cr;br++){const Ir=Sr.children[br];Ir.visited||xr(Ir)}};const yr={};for(let Sr=0;Sr<er.metadata.boneCount;Sr++){const br=er.bones[Sr],Cr=br.grant;if(Cr===void 0)continue;const Ir={index:Sr,parentIndex:Cr.parentIndex,ratio:Cr.ratio,isLocal:Cr.isLocal,affectRotation:Cr.affectRotation,affectPosition:Cr.affectPosition,transformationClass:br.transformationClass};yr[Sr]={parent:null,children:[],param:Ir,visited:!1}}const wr={parent:null,children:[],param:null,visited:!1};for(const Sr in yr){const br=yr[Sr],Cr=yr[br.parentIndex]||wr;br.parent=Cr,Cr.children.push(br)}xr(wr)}function _r(yr,wr,xr){for(let Sr=0;Sr<wr.elementCount;Sr++){const br=wr.elements[Sr];let Cr;er.metadata.format==="pmd"?Cr=er.morphs[0].elements[br.index].index:Cr=br.index,yr.array[Cr*3+0]+=br.position[0]*xr,yr.array[Cr*3+1]+=br.position[1]*xr,yr.array[Cr*3+2]+=br.position[2]*xr}}for(let yr=0;yr<er.metadata.morphCount;yr++){const wr=er.morphs[yr],xr={name:wr.name},Sr=new Float32BufferAttribute(er.metadata.vertexCount*3,3);Sr.name=wr.name;for(let br=0;br<er.metadata.vertexCount*3;br++)Sr.array[br]=tr[br];if(er.metadata.format==="pmd")yr!==0&&_r(Sr,wr,1);else if(wr.type===0)for(let br=0;br<wr.elementCount;br++){const Cr=er.morphs[wr.elements[br].index],Ir=wr.elements[br].ratio;Cr.type===1&&_r(Sr,Cr,Ir)}else wr.type===1?_r(Sr,wr,1):wr.type===2||wr.type===3||wr.type===4||wr.type===5||wr.type===6||wr.type===7||wr.type;ur.push(xr),dr.push(Sr)}for(let yr=0;yr<er.metadata.rigidBodyCount;yr++){const wr=er.rigidBodies[yr],xr={};for(const Sr in wr)xr[Sr]=wr[Sr];if(er.metadata.format==="pmx"&&xr.boneIndex!==-1){const Sr=er.bones[xr.boneIndex];xr.position[0]-=Sr.position[0],xr.position[1]-=Sr.position[1],xr.position[2]-=Sr.position[2]}gr.push(xr)}for(let yr=0;yr<er.metadata.constraintCount;yr++){const wr=er.constraints[yr],xr={};for(const Cr in wr)xr[Cr]=wr[Cr];const Sr=gr[xr.rigidBodyIndex1],br=gr[xr.rigidBodyIndex2];Sr.type!==0&&br.type===2&&Sr.boneIndex!==-1&&br.boneIndex!==-1&&er.bones[br.boneIndex].parentIndex===Sr.boneIndex&&(br.type=1),vr.push(xr)}const Ar=new BufferGeometry;Ar.setAttribute("position",new Float32BufferAttribute(tr,3)),Ar.setAttribute("normal",new Float32BufferAttribute(nr,3)),Ar.setAttribute("uv",new Float32BufferAttribute(ir,2)),Ar.setAttribute("skinIndex",new Uint16BufferAttribute(lr,4)),Ar.setAttribute("skinWeight",new Float32BufferAttribute(cr,4)),Ar.setIndex(sr);for(let yr=0,wr=ar.length;yr<wr;yr++)Ar.addGroup(ar[yr].offset,ar[yr].count,yr);return Ar.bones=or,Ar.morphTargets=ur,Ar.morphAttributes.position=dr,Ar.morphTargetsRelative=!1,Ar.userData.MMD={bones:or,iks:hr,grants:pr,rigidBodies:gr,constraints:vr,format:er.metadata.format},Ar.computeBoundingSphere(),Ar}}class MaterialBuilder{constructor(er){this.manager=er,this.textureLoader=new TextureLoader(this.manager),this.tgaLoader=null,this.crossOrigin="anonymous",this.resourcePath=void 0}setCrossOrigin(er){return this.crossOrigin=er,this}setResourcePath(er){return this.resourcePath=er,this}build(er,tr){const ir=[],nr={};this.textureLoader.setCrossOrigin(this.crossOrigin);for(let sr=0;sr<er.metadata.materialCount;sr++){const ar=er.materials[sr],or={userData:{MMD:{}}};if(ar.name!==void 0&&(or.name=ar.name),or.diffuse=new Color().setRGB(ar.diffuse[0],ar.diffuse[1],ar.diffuse[2],SRGBColorSpace),or.opacity=ar.diffuse[3],or.specular=new Color().setRGB(...ar.specular,SRGBColorSpace),or.shininess=ar.shininess,or.emissive=new Color().setRGB(...ar.ambient,SRGBColorSpace),or.transparent=or.opacity!==1,or.fog=!0,or.blending=CustomBlending,or.blendSrc=SrcAlphaFactor,or.blendDst=OneMinusSrcAlphaFactor,or.blendSrcAlpha=SrcAlphaFactor,or.blendDstAlpha=DstAlphaFactor,er.metadata.format==="pmx"&&(ar.flag&1)===1?or.side=DoubleSide:or.side=or.opacity===1?FrontSide:DoubleSide,er.metadata.format==="pmd"){if(ar.fileName){const ur=ar.fileName.split("*");if(or.map=this._loadTexture(ur[0],nr),ur.length>1){const dr=ur[1].slice(-4).toLowerCase();or.matcap=this._loadTexture(ur[1],nr),or.matcapCombine=dr===".sph"?MultiplyOperation:AddOperation}}const lr=ar.toonIndex===-1?"toon00.bmp":er.toonTextures[ar.toonIndex].fileName;or.gradientMap=this._loadTexture(lr,nr,{isToonTexture:!0,isDefaultToonTexture:this._isDefaultToonTexture(lr)}),or.userData.outlineParameters={thickness:ar.edgeFlag===1?.003:0,color:[0,0,0],alpha:1,visible:ar.edgeFlag===1}}else{ar.textureIndex!==-1&&(or.map=this._loadTexture(er.textures[ar.textureIndex],nr),or.userData.MMD.mapFileName=er.textures[ar.textureIndex]),ar.envTextureIndex!==-1&&(ar.envFlag===1||ar.envFlag==2)&&(or.matcap=this._loadTexture(er.textures[ar.envTextureIndex],nr),or.userData.MMD.matcapFileName=er.textures[ar.envTextureIndex],or.matcapCombine=ar.envFlag===1?MultiplyOperation:AddOperation);let lr,cr;ar.toonIndex===-1||ar.toonFlag!==0?(lr="toon"+("0"+(ar.toonIndex+1)).slice(-2)+".bmp",cr=!0):(lr=er.textures[ar.toonIndex],cr=!1),or.gradientMap=this._loadTexture(lr,nr,{isToonTexture:!0,isDefaultToonTexture:cr}),or.userData.outlineParameters={thickness:ar.edgeSize/300,color:ar.edgeColor.slice(0,3),alpha:ar.edgeColor[3],visible:(ar.flag&16)!==0&&ar.edgeSize>0}}or.map!==void 0&&(or.transparent||this._checkImageTransparency(or.map,tr,sr),or.emissive.multiplyScalar(.2)),ir.push(new MMDToonMaterial(or))}if(er.metadata.format==="pmx"){let sr=function(ar,or){for(let lr=0,cr=ar.length;lr<cr;lr++){const ur=ar[lr];if(ur.index===-1)continue;const dr=or[ur.index];dr.opacity!==ur.diffuse[3]&&(dr.transparent=!0)}};for(let ar=0,or=er.morphs.length;ar<or;ar++){const lr=er.morphs[ar],cr=lr.elements;if(lr.type===0)for(let ur=0,dr=cr.length;ur<dr;ur++){const hr=er.morphs[cr[ur].index];hr.type===8&&sr(hr.elements,ir)}else lr.type===8&&sr(cr,ir)}}return ir}_getTGALoader(){if(this.tgaLoader===null){if(TGALoader===void 0)throw new Error("THREE.MMDLoader: Import TGALoader");this.tgaLoader=new TGALoader(this.manager)}return this.tgaLoader}_isDefaultToonTexture(er){return er.length!==10?!1:/toon(10|0[0-9])\.bmp/.test(er)}_loadTexture(er,tr,ir,nr,sr){ir=ir||{};const ar=this;let or;if(ir.isDefaultToonTexture===!0){let ur;try{ur=parseInt(er.match(/toon([0-9]{2})\.bmp$/)[1])}catch{console.warn("THREE.MMDLoader: "+er+" seems like a not right default texture path. Using toon00.bmp instead."),ur=0}or=DEFAULT_TOON_TEXTURES[ur]}else or=this.resourcePath+er;if(tr[or]!==void 0)return tr[or];let lr=this.manager.getHandler(or);lr===null&&(lr=er.slice(-4).toLowerCase()===".tga"?this._getTGALoader():this.textureLoader);const cr=lr.load(or,function(ur){ir.isToonTexture===!0&&(ur.image=ar._getRotatedImage(ur.image),ur.magFilter=NearestFilter,ur.minFilter=NearestFilter,ur.generateMipmaps=!1),ur.flipY=!1,ur.wrapS=RepeatWrapping,ur.wrapT=RepeatWrapping,ur.colorSpace=SRGBColorSpace;for(let dr=0;dr<cr.readyCallbacks.length;dr++)cr.readyCallbacks[dr](cr);delete cr.readyCallbacks},nr,sr);return cr.readyCallbacks=[],tr[or]=cr,cr}_getRotatedImage(er){const tr=document.createElement("canvas"),ir=tr.getContext("2d"),nr=er.width,sr=er.height;return tr.width=nr,tr.height=sr,ir.clearRect(0,0,nr,sr),ir.translate(nr/2,sr/2),ir.rotate(.5*Math.PI),ir.translate(-nr/2,-sr/2),ir.drawImage(er,0,0),ir.getImageData(0,0,nr,sr)}_checkImageTransparency(er,tr,ir){er.readyCallbacks.push(function(nr){function sr(ur){const dr=document.createElement("canvas");dr.width=ur.width,dr.height=ur.height;const hr=dr.getContext("2d");return hr.drawImage(ur,0,0),hr.getImageData(0,0,dr.width,dr.height)}function ar(ur,dr,hr){const pr=ur.width,gr=ur.height,vr=ur.data,mr=253;if(vr.length/(pr*gr)!==4)return!1;for(let fr=0;fr<hr.length;fr+=3){const _r={x:0,y:0};for(let Ar=0;Ar<3;Ar++){const yr=hr[fr*3+Ar],wr={x:dr[yr*2+0],y:dr[yr*2+1]};if(or(ur,wr)<mr)return!0;_r.x+=wr.x,_r.y+=wr.y}if(_r.x/=3,_r.y/=3,or(ur,_r)<mr)return!0}return!1}function or(ur,dr){const hr=ur.width,pr=ur.height;let gr=Math.round(dr.x*hr)%hr,vr=Math.round(dr.y*pr)%pr;gr<0&&(gr+=hr),vr<0&&(vr+=pr);const mr=vr*hr+gr;return ur.data[mr*4+3]}if(nr.isCompressedTexture===!0){NON_ALPHA_CHANNEL_FORMATS.includes(nr.format)?er.transparent=!1:er.transparent=!0;return}const lr=nr.image.data!==void 0?nr.image:sr(nr.image),cr=tr.groups[ir];ar(lr,tr.attributes.uv.array,tr.index.array.slice(cr.start,cr.start+cr.count))&&(er.transparent=!0)})}}class AnimationBuilder{build(er,tr){const ir=this.buildSkeletalAnimation(er,tr).tracks,nr=this.buildMorphAnimation(er,tr).tracks;for(let sr=0,ar=nr.length;sr<ar;sr++)ir.push(nr[sr]);return new AnimationClip("",-1,ir)}buildSkeletalAnimation(er,tr){function ir(lr,cr,ur){lr.push(cr[ur+0]/127),lr.push(cr[ur+8]/127),lr.push(cr[ur+4]/127),lr.push(cr[ur+12]/127)}const nr=[],sr={},ar=tr.skeleton.bones,or={};for(let lr=0,cr=ar.length;lr<cr;lr++)or[ar[lr].name]=!0;for(let lr=0;lr<er.metadata.motionCount;lr++){const cr=er.motions[lr],ur=cr.boneName;or[ur]!==void 0&&(sr[ur]=sr[ur]||[],sr[ur].push(cr))}for(const lr in sr){const cr=sr[lr];cr.sort(function(fr,_r){return fr.frameNum-_r.frameNum});const ur=[],dr=[],hr=[],pr=[],gr=[],vr=tr.skeleton.getBoneByName(lr).position.toArray();for(let fr=0,_r=cr.length;fr<_r;fr++){const Ar=cr[fr].frameNum/30,yr=cr[fr].position,wr=cr[fr].rotation,xr=cr[fr].interpolation;ur.push(Ar);for(let Sr=0;Sr<3;Sr++)dr.push(vr[Sr]+yr[Sr]);for(let Sr=0;Sr<4;Sr++)hr.push(wr[Sr]);for(let Sr=0;Sr<3;Sr++)ir(pr,xr,Sr);ir(gr,xr,3)}const mr=".bones["+lr+"]";nr.push(this._createTrack(mr+".position",VectorKeyframeTrack,ur,dr,pr)),nr.push(this._createTrack(mr+".quaternion",QuaternionKeyframeTrack,ur,hr,gr))}return new AnimationClip("",-1,nr)}buildMorphAnimation(er,tr){const ir=[],nr={},sr=tr.morphTargetDictionary;for(let ar=0;ar<er.metadata.morphCount;ar++){const or=er.morphs[ar],lr=or.morphName;sr[lr]!==void 0&&(nr[lr]=nr[lr]||[],nr[lr].push(or))}for(const ar in nr){const or=nr[ar];or.sort(function(ur,dr){return ur.frameNum-dr.frameNum});const lr=[],cr=[];for(let ur=0,dr=or.length;ur<dr;ur++)lr.push(or[ur].frameNum/30),cr.push(or[ur].weight);ir.push(new NumberKeyframeTrack(".morphTargetInfluences["+sr[ar]+"]",lr,cr))}return new AnimationClip("",-1,ir)}buildCameraAnimation(er){function tr(yr,wr){yr.push(wr.x),yr.push(wr.y),yr.push(wr.z)}function ir(yr,wr){yr.push(wr.x),yr.push(wr.y),yr.push(wr.z),yr.push(wr.w)}function nr(yr,wr,xr){yr.push(wr[xr*4+0]/127),yr.push(wr[xr*4+1]/127),yr.push(wr[xr*4+2]/127),yr.push(wr[xr*4+3]/127)}const sr=er.cameras===void 0?[]:er.cameras.slice();sr.sort(function(yr,wr){return yr.frameNum-wr.frameNum});const ar=[],or=[],lr=[],cr=[],ur=[],dr=[],hr=[],pr=[],gr=[],vr=new Quaternion$1,mr=new Euler,fr=new Vector3$1,_r=new Vector3$1;for(let yr=0,wr=sr.length;yr<wr;yr++){const xr=sr[yr],Sr=xr.frameNum/30,br=xr.position,Cr=xr.rotation,Ir=xr.distance,Rr=xr.fov,Pr=xr.interpolation;ar.push(Sr),fr.set(0,0,-Ir),_r.set(br[0],br[1],br[2]),mr.set(-Cr[0],-Cr[1],-Cr[2]),vr.setFromEuler(mr),fr.add(_r),fr.applyQuaternion(vr),tr(or,_r),ir(lr,vr),tr(cr,fr),ur.push(Rr);for(let Dr=0;Dr<3;Dr++)nr(dr,Pr,Dr);nr(hr,Pr,3);for(let Dr=0;Dr<3;Dr++)nr(pr,Pr,4);nr(gr,Pr,5)}const Ar=[];return Ar.push(this._createTrack("target.position",VectorKeyframeTrack,ar,or,dr)),Ar.push(this._createTrack(".quaternion",QuaternionKeyframeTrack,ar,lr,hr)),Ar.push(this._createTrack(".position",VectorKeyframeTrack,ar,cr,pr)),Ar.push(this._createTrack(".fov",NumberKeyframeTrack,ar,ur,gr)),new AnimationClip("",-1,Ar)}_createTrack(er,tr,ir,nr,sr){if(ir.length>2){ir=ir.slice(),nr=nr.slice(),sr=sr.slice();const or=nr.length/ir.length,lr=sr.length/ir.length;let cr=1;for(let ur=2,dr=ir.length;ur<dr;ur++){for(let hr=0;hr<or;hr++)if(nr[cr*or+hr]!==nr[(cr-1)*or+hr]||nr[cr*or+hr]!==nr[ur*or+hr]){cr++;break}if(ur>cr){ir[cr]=ir[ur];for(let hr=0;hr<or;hr++)nr[cr*or+hr]=nr[ur*or+hr];for(let hr=0;hr<lr;hr++)sr[cr*lr+hr]=sr[ur*lr+hr]}}ir.length=cr+1,nr.length=(cr+1)*or,sr.length=(cr+1)*lr}const ar=new tr(er,ir,nr);return ar.createInterpolant=function(lr){return new CubicBezierInterpolation(this.times,this.values,this.getValueSize(),lr,new Float32Array(sr))},ar}}class CubicBezierInterpolation extends Interpolant{constructor(er,tr,ir,nr,sr){super(er,tr,ir,nr),this.interpolationParams=sr}interpolate_(er,tr,ir,nr){const sr=this.resultBuffer,ar=this.sampleValues,or=this.valueSize,lr=this.interpolationParams,cr=er*or,ur=cr-or,dr=nr-tr<1/30*1.5?0:(ir-tr)/(nr-tr);if(or===4){const hr=lr[er*4+0],pr=lr[er*4+1],gr=lr[er*4+2],vr=lr[er*4+3],mr=this._calculate(hr,pr,gr,vr,dr);Quaternion$1.slerpFlat(sr,0,ar,ur,ar,cr,mr)}else if(or===3)for(let hr=0;hr!==or;++hr){const pr=lr[er*12+hr*4+0],gr=lr[er*12+hr*4+1],vr=lr[er*12+hr*4+2],mr=lr[er*12+hr*4+3],fr=this._calculate(pr,gr,vr,mr,dr);sr[hr]=ar[ur+hr]*(1-fr)+ar[cr+hr]*fr}else{const hr=lr[er*4+0],pr=lr[er*4+1],gr=lr[er*4+2],vr=lr[er*4+3],mr=this._calculate(hr,pr,gr,vr,dr);sr[0]=ar[ur]*(1-mr)+ar[cr]*mr}return sr}_calculate(er,tr,ir,nr,sr){let ar=.5,or=ar,lr=1-or;const cr=15,ur=1e-5,dr=Math;let hr,pr,gr;for(let vr=0;vr<cr;vr++){hr=3*lr*lr*or,pr=3*lr*or*or,gr=or*or*or;const mr=hr*er+pr*tr+gr-sr;if(dr.abs(mr)<ur)break;ar/=2,or+=mr<0?ar:-ar,lr=1-or}return hr*ir+pr*nr+gr}}class MMDToonMaterial extends ShaderMaterial{static get type(){return"MMDToonMaterial"}constructor(er){super(),this.isMMDToonMaterial=!0,this._matcapCombine=AddOperation,this.emissiveIntensity=1,this.normalMapType=TangentSpaceNormalMap,this.combine=MultiplyOperation,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.lights=!0,this.vertexShader=MMDToonShader.vertexShader,this.fragmentShader=MMDToonShader.fragmentShader,this.defines=Object.assign({},MMDToonShader.defines),Object.defineProperty(this,"matcapCombine",{get:function(){return this._matcapCombine},set:function(ir){switch(this._matcapCombine=ir,ir){case MultiplyOperation:this.defines.MATCAP_BLENDING_MULTIPLY=!0,delete this.defines.MATCAP_BLENDING_ADD;break;default:case AddOperation:this.defines.MATCAP_BLENDING_ADD=!0,delete this.defines.MATCAP_BLENDING_MULTIPLY;break}}}),this.uniforms=UniformsUtils.clone(MMDToonShader.uniforms);const tr=["specular","opacity","diffuse","map","matcap","gradientMap","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveMap","bumpMap","bumpScale","normalMap","normalScale","displacemantBias","displacemantMap","displacemantScale","specularMap","alphaMap","reflectivity","refractionRatio"];for(const ir of tr)Object.defineProperty(this,ir,{get:function(){return this.uniforms[ir].value},set:function(nr){this.uniforms[ir].value=nr}});this._shininess=30,Object.defineProperty(this,"shininess",{get:function(){return this._shininess},set:function(ir){this._shininess=ir,this.uniforms.shininess.value=Math.max(this._shininess,1e-4)}}),Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(er)}copy(er){return super.copy(er),this.matcapCombine=er.matcapCombine,this.emissiveIntensity=er.emissiveIntensity,this.normalMapType=er.normalMapType,this.combine=er.combine,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.flatShading=er.flatShading,this}}class MTLLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path,or=new FileLoader(this.manager);or.setPath(this.path),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},ir,nr)}setMaterialOptions(er){return this.materialOptions=er,this}parse(er,tr){const ir=er.split(`
`);let nr={};const sr=/\s+/,ar={};for(let lr=0;lr<ir.length;lr++){let cr=ir[lr];if(cr=cr.trim(),cr.length===0||cr.charAt(0)==="#")continue;const ur=cr.indexOf(" ");let dr=ur>=0?cr.substring(0,ur):cr;dr=dr.toLowerCase();let hr=ur>=0?cr.substring(ur+1):"";if(hr=hr.trim(),dr==="newmtl")nr={name:hr},ar[hr]=nr;else if(dr==="ka"||dr==="kd"||dr==="ks"||dr==="ke"){const pr=hr.split(sr,3);nr[dr]=[parseFloat(pr[0]),parseFloat(pr[1]),parseFloat(pr[2])]}else nr[dr]=hr}const or=new MaterialCreator(this.resourcePath||tr,this.materialOptions);return or.setCrossOrigin(this.crossOrigin),or.setManager(this.manager),or.setMaterials(ar),or}}class MaterialCreator{constructor(er="",tr={}){this.baseUrl=er,this.options=tr,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:FrontSide,this.wrap=this.options.wrap!==void 0?this.options.wrap:RepeatWrapping}setCrossOrigin(er){return this.crossOrigin=er,this}setManager(er){this.manager=er}setMaterials(er){this.materialsInfo=this.convert(er),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(er){if(!this.options)return er;const tr={};for(const ir in er){const nr=er[ir],sr={};tr[ir]=sr;for(const ar in nr){let or=!0,lr=nr[ar];const cr=ar.toLowerCase();switch(cr){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(lr=[lr[0]/255,lr[1]/255,lr[2]/255]),this.options&&this.options.ignoreZeroRGBs&&lr[0]===0&&lr[1]===0&&lr[2]===0&&(or=!1);break;default:break}or&&(sr[cr]=lr)}}return tr}preload(){for(const er in this.materialsInfo)this.create(er)}getIndex(er){return this.nameLookup[er]}getAsArray(){let er=0;for(const tr in this.materialsInfo)this.materialsArray[er]=this.create(tr),this.nameLookup[tr]=er,er++;return this.materialsArray}create(er){return this.materials[er]===void 0&&this.createMaterial_(er),this.materials[er]}createMaterial_(er){const tr=this,ir=this.materialsInfo[er],nr={name:er,side:this.side};function sr(or,lr){return typeof lr!="string"||lr===""?"":/^https?:\/\//i.test(lr)?lr:or+lr}function ar(or,lr){if(nr[or])return;const cr=tr.getTextureParams(lr,nr),ur=tr.loadTexture(sr(tr.baseUrl,cr.url));ur.repeat.copy(cr.scale),ur.offset.copy(cr.offset),ur.wrapS=tr.wrap,ur.wrapT=tr.wrap,(or==="map"||or==="emissiveMap")&&(ur.colorSpace=SRGBColorSpace),nr[or]=ur}for(const or in ir){const lr=ir[or];let cr;if(lr!=="")switch(or.toLowerCase()){case"kd":nr.color=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"ks":nr.specular=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"ke":nr.emissive=ColorManagement.toWorkingColorSpace(new Color().fromArray(lr),SRGBColorSpace);break;case"map_kd":ar("map",lr);break;case"map_ks":ar("specularMap",lr);break;case"map_ke":ar("emissiveMap",lr);break;case"norm":ar("normalMap",lr);break;case"map_bump":case"bump":ar("bumpMap",lr);break;case"map_d":ar("alphaMap",lr),nr.transparent=!0;break;case"ns":nr.shininess=parseFloat(lr);break;case"d":cr=parseFloat(lr),cr<1&&(nr.opacity=cr,nr.transparent=!0);break;case"tr":cr=parseFloat(lr),this.options&&this.options.invertTrProperty&&(cr=1-cr),cr>0&&(nr.opacity=1-cr,nr.transparent=!0);break;default:break}}return this.materials[er]=new MeshPhongMaterial(nr),this.materials[er]}getTextureParams(er,tr){const ir={scale:new Vector2(1,1),offset:new Vector2(0,0)},nr=er.split(/\s+/);let sr;return sr=nr.indexOf("-bm"),sr>=0&&(tr.bumpScale=parseFloat(nr[sr+1]),nr.splice(sr,2)),sr=nr.indexOf("-s"),sr>=0&&(ir.scale.set(parseFloat(nr[sr+1]),parseFloat(nr[sr+2])),nr.splice(sr,4)),sr=nr.indexOf("-o"),sr>=0&&(ir.offset.set(parseFloat(nr[sr+1]),parseFloat(nr[sr+2])),nr.splice(sr,4)),ir.url=nr.join(" ").trim(),ir}loadTexture(er,tr,ir,nr,sr){const ar=this.manager!==void 0?this.manager:DefaultLoadingManager;let or=ar.getHandler(er);or===null&&(or=new TextureLoader(ar)),or.setCrossOrigin&&or.setCrossOrigin(this.crossOrigin);const lr=or.load(er,ir,nr,sr);return tr!==void 0&&(lr.mapping=tr),lr}}class VolumeSlice{constructor(er,tr,ir){const nr=this;this.volume=er,tr=tr||0,Object.defineProperty(this,"index",{get:function(){return tr},set:function(or){return tr=or,nr.geometryNeedsUpdate=!0,tr}}),this.axis=ir||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();const sr=new Texture(this.canvas);sr.minFilter=LinearFilter,sr.generateMipmaps=!1,sr.wrapS=sr.wrapT=ClampToEdgeWrapping,sr.colorSpace=SRGBColorSpace;const ar=new MeshBasicMaterial({map:sr,side:DoubleSide,transparent:!0});this.mesh=new Mesh(this.geometry,ar),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}repaint(){this.geometryNeedsUpdate&&this.updateGeometry();const er=this.iLength,tr=this.jLength,ir=this.sliceAccess,nr=this.volume,sr=this.canvasBuffer,ar=this.ctxBuffer,or=ar.getImageData(0,0,er,tr),lr=or.data,cr=nr.data,ur=nr.upperThreshold,dr=nr.lowerThreshold,hr=nr.windowLow,pr=nr.windowHigh;let gr=0;if(nr.dataType==="label")for(let vr=0;vr<tr;vr++)for(let mr=0;mr<er;mr++){let fr=cr[ir(mr,vr)];fr=fr>=this.colorMap.length?fr%this.colorMap.length+1:fr;const _r=this.colorMap[fr];lr[4*gr]=_r>>24&255,lr[4*gr+1]=_r>>16&255,lr[4*gr+2]=_r>>8&255,lr[4*gr+3]=_r&255,gr++}else for(let vr=0;vr<tr;vr++)for(let mr=0;mr<er;mr++){let fr=cr[ir(mr,vr)],_r=255;_r=ur>=fr&&dr<=fr?_r:0,fr=Math.floor(255*(fr-hr)/(pr-hr)),fr=fr>255?255:fr<0?0:fr|0,lr[4*gr]=fr,lr[4*gr+1]=fr,lr[4*gr+2]=fr,lr[4*gr+3]=_r,gr++}ar.putImageData(or,0,0),this.ctx.drawImage(sr,0,0,er,tr,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0}updateGeometry(){const er=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=er.sliceAccess,this.jLength=er.jLength,this.iLength=er.iLength,this.matrix=er.matrix,this.canvas.width=er.planeWidth,this.canvas.height=er.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new PlaneGeometry(er.planeWidth,er.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}}class Volume{constructor(er,tr,ir,nr,sr){if(er!==void 0){switch(this.xLength=Number(er)||1,this.yLength=Number(tr)||1,this.zLength=Number(ir)||1,this.axisOrder=["x","y","z"],nr){case"Uint8":case"uint8":case"uchar":case"unsigned char":case"uint8_t":this.data=new Uint8Array(sr);break;case"Int8":case"int8":case"signed char":case"int8_t":this.data=new Int8Array(sr);break;case"Int16":case"int16":case"short":case"short int":case"signed short":case"signed short int":case"int16_t":this.data=new Int16Array(sr);break;case"Uint16":case"uint16":case"ushort":case"unsigned short":case"unsigned short int":case"uint16_t":this.data=new Uint16Array(sr);break;case"Int32":case"int32":case"int":case"signed int":case"int32_t":this.data=new Int32Array(sr);break;case"Uint32":case"uint32":case"uint":case"unsigned int":case"uint32_t":this.data=new Uint32Array(sr);break;case"longlong":case"long long":case"long long int":case"signed long long":case"signed long long int":case"int64":case"int64_t":case"ulonglong":case"unsigned long long":case"unsigned long long int":case"uint64":case"uint64_t":throw new Error("Error in Volume constructor : this type is not supported in JavaScript");case"Float32":case"float32":case"float":this.data=new Float32Array(sr);break;case"Float64":case"float64":case"double":this.data=new Float64Array(sr);break;default:this.data=new Uint8Array(sr)}if(this.data.length!==this.xLength*this.yLength*this.zLength)throw new Error("Error in Volume constructor, lengths are not matching arrayBuffer size")}this.spacing=[1,1,1],this.offset=[0,0,0],this.matrix=new Matrix3,this.matrix.identity();let ar=-1/0;Object.defineProperty(this,"lowerThreshold",{get:function(){return ar},set:function(lr){ar=lr,this.sliceList.forEach(function(cr){cr.geometryNeedsUpdate=!0})}});let or=1/0;Object.defineProperty(this,"upperThreshold",{get:function(){return or},set:function(lr){or=lr,this.sliceList.forEach(function(cr){cr.geometryNeedsUpdate=!0})}}),this.sliceList=[],this.segmentation=!1}getData(er,tr,ir){return this.data[ir*this.xLength*this.yLength+tr*this.xLength+er]}access(er,tr,ir){return ir*this.xLength*this.yLength+tr*this.xLength+er}reverseAccess(er){const tr=Math.floor(er/(this.yLength*this.xLength)),ir=Math.floor((er-tr*this.yLength*this.xLength)/this.xLength);return[er-tr*this.yLength*this.xLength-ir*this.xLength,ir,tr]}map(er,tr){const ir=this.data.length;tr=tr||this;for(let nr=0;nr<ir;nr++)this.data[nr]=er.call(tr,this.data[nr],nr,this.data);return this}extractPerpendicularPlane(er,tr){let ir,nr,sr,ar;const or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1,ur=new Matrix4().identity(),dr=this,hr=new Vector3$1(this.xLength,this.yLength,this.zLength);switch(er){case"x":or.set(1,0,0),lr.set(0,0,-1),cr.set(0,-1,0),ir=this.spacing[this.axisOrder.indexOf("z")],nr=this.spacing[this.axisOrder.indexOf("y")],ar=new Vector3$1(tr,0,0),ur.multiply(new Matrix4().makeRotationY(Math.PI/2)),sr=(dr.RASDimensions[0]-1)/2,ur.setPosition(new Vector3$1(tr-sr,0,0));break;case"y":or.set(0,1,0),lr.set(1,0,0),cr.set(0,0,1),ir=this.spacing[this.axisOrder.indexOf("x")],nr=this.spacing[this.axisOrder.indexOf("z")],ar=new Vector3$1(0,tr,0),ur.multiply(new Matrix4().makeRotationX(-Math.PI/2)),sr=(dr.RASDimensions[1]-1)/2,ur.setPosition(new Vector3$1(0,tr-sr,0));break;case"z":default:or.set(0,0,1),lr.set(1,0,0),cr.set(0,-1,0),ir=this.spacing[this.axisOrder.indexOf("x")],nr=this.spacing[this.axisOrder.indexOf("y")],ar=new Vector3$1(0,0,tr),sr=(dr.RASDimensions[2]-1)/2,ur.setPosition(new Vector3$1(0,0,tr-sr));break}this.segmentation||(lr.applyMatrix4(dr.inverseMatrix).normalize(),cr.applyMatrix4(dr.inverseMatrix).normalize(),or.applyMatrix4(dr.inverseMatrix).normalize()),lr.arglet="i",cr.arglet="j";const pr=Math.floor(Math.abs(lr.dot(hr))),gr=Math.floor(Math.abs(cr.dot(hr))),vr=Math.abs(pr*ir),mr=Math.abs(gr*nr);ar=Math.abs(Math.round(ar.applyMatrix4(dr.inverseMatrix).dot(or)));const fr=[new Vector3$1(1,0,0),new Vector3$1(0,1,0),new Vector3$1(0,0,1)],_r=[lr,cr,or].find(function(xr){return Math.abs(xr.dot(fr[0]))>.9}),Ar=[lr,cr,or].find(function(xr){return Math.abs(xr.dot(fr[1]))>.9}),yr=[lr,cr,or].find(function(xr){return Math.abs(xr.dot(fr[2]))>.9});function wr(xr,Sr){const br=_r===or?ar:_r.arglet==="i"?xr:Sr,Cr=Ar===or?ar:Ar.arglet==="i"?xr:Sr,Ir=yr===or?ar:yr.arglet==="i"?xr:Sr,Rr=_r.dot(fr[0])>0?br:dr.xLength-1-br,Pr=Ar.dot(fr[1])>0?Cr:dr.yLength-1-Cr,Dr=yr.dot(fr[2])>0?Ir:dr.zLength-1-Ir;return dr.access(Rr,Pr,Dr)}return{iLength:pr,jLength:gr,sliceAccess:wr,matrix:ur,planeWidth:vr,planeHeight:mr}}extractSlice(er,tr){const ir=new VolumeSlice(this,tr,er);return this.sliceList.push(ir),ir}repaintAllSlices(){return this.sliceList.forEach(function(er){er.repaint()}),this}computeMinMax(){let er=1/0,tr=-1/0;const ir=this.data.length;let nr=0;for(nr=0;nr<ir;nr++)if(!isNaN(this.data[nr])){const sr=this.data[nr];er=Math.min(er,sr),tr=Math.max(tr,sr)}return this.min=er,this.max=tr,[er,tr]}}class NRRDLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}setSegmentation(er){this.segmentation=er}parse(er){let tr=er,ir=0;const nr=new Int8Array(new Int16Array([1]).buffer)[0]>0,sr=!0,ar={};function or(br,Cr){let Ir=1,Rr=Uint8Array;switch(br){case"uchar":break;case"schar":Rr=Int8Array;break;case"ushort":Rr=Uint16Array,Ir=2;break;case"sshort":Rr=Int16Array,Ir=2;break;case"uint":Rr=Uint32Array,Ir=4;break;case"sint":Rr=Int32Array,Ir=4;break;case"float":Rr=Float32Array,Ir=4;break;case"complex":Rr=Float64Array,Ir=8;break;case"double":Rr=Float64Array,Ir=8;break}let Pr=new Rr(tr.slice(ir,ir+=Cr*Ir));return nr!=sr&&(Pr=lr(Pr,Ir)),Pr}function lr(br,Cr){const Ir=new Uint8Array(br.buffer,br.byteOffset,br.byteLength);for(let Rr=0;Rr<br.byteLength;Rr+=Cr)for(let Pr=Rr+Cr-1,Dr=Rr;Pr>Dr;Pr--,Dr++){const Fr=Ir[Dr];Ir[Dr]=Ir[Pr],Ir[Pr]=Fr}return br}function cr(br){let Cr,Ir,Rr,Pr,Dr,Fr,Or,Nr;const Ur=br.split(/\r?\n/);for(Or=0,Nr=Ur.length;Or<Nr;Or++)Dr=Ur[Or],Dr.match(/NRRD\d+/)?ar.isNrrd=!0:!Dr.match(/^#/)&&(Fr=Dr.match(/(.*):(.*)/))&&(Ir=Fr[1].trim(),Cr=Fr[2].trim(),Rr=_fieldFunctions[Ir],Rr?Rr.call(ar,Cr):ar[Ir]=Cr);if(!ar.isNrrd)throw new Error("Not an NRRD file");if(ar.encoding==="bz2"||ar.encoding==="bzip2")throw new Error("Bzip is not supported");if(!ar.vectors&&(ar.vectors=[],ar.vectors.push([1,0,0]),ar.vectors.push([0,1,0]),ar.vectors.push([0,0,1]),ar.spacings)){for(Pr=0;Pr<=2;Pr++)if(!isNaN(ar.spacings[Pr]))for(let Br=0;Br<=2;Br++)ar.vectors[Pr][Br]*=ar.spacings[Pr]}}function ur(br,Cr,Ir){let Rr="";Cr=Cr||0,Ir=Ir||br.length;let Pr;const Dr=ar.sizes.reduce(function(Br,Wr){return Br*Wr},1);let Fr=10;ar.encoding==="hex"&&(Fr=16);const Or=new ar.__array(Dr);let Nr=0,Ur=parseInt;(ar.__array===Float32Array||ar.__array===Float64Array)&&(Ur=parseFloat);for(let Br=Cr;Br<Ir;Br++)Pr=br[Br],(Pr<9||Pr>13)&&Pr!==32?Rr+=String.fromCharCode(Pr):(Rr!==""&&(Or[Nr]=Ur(Rr,Fr),Nr++),Rr="");return Rr!==""&&(Or[Nr]=Ur(Rr,Fr),Nr++),Or}const dr=or("uchar",er.byteLength),hr=dr.length;let pr=null,gr=0,vr;for(vr=1;vr<hr;vr++)if(dr[vr-1]==10&&dr[vr]==10){pr=this.parseChars(dr,0,vr-2),gr=vr+1;break}if(cr(pr),tr=dr.subarray(gr),ar.encoding.substring(0,2)==="gz")tr=gunzipSync(new Uint8Array(tr));else if(ar.encoding==="ascii"||ar.encoding==="text"||ar.encoding==="txt"||ar.encoding==="hex")tr=ur(tr);else if(ar.encoding==="raw"){const br=new Uint8Array(tr.length);for(let Cr=0;Cr<tr.length;Cr++)br[Cr]=tr[Cr];tr=br}tr=tr.buffer;const mr=new Volume;mr.header=ar,mr.segmentation=this.segmentation,mr.data=new ar.__array(tr);const fr=mr.computeMinMax(),_r=fr[0],Ar=fr[1];if(mr.windowLow=_r,mr.windowHigh=Ar,mr.dimensions=[ar.sizes[0],ar.sizes[1],ar.sizes[2]],mr.xLength=mr.dimensions[0],mr.yLength=mr.dimensions[1],mr.zLength=mr.dimensions[2],ar.vectors){const br=ar.vectors.findIndex(Pr=>Pr[0]!==0),Cr=ar.vectors.findIndex(Pr=>Pr[1]!==0),Ir=ar.vectors.findIndex(Pr=>Pr[2]!==0),Rr=[];br!==Cr&&br!==Ir&&Cr!==Ir?(Rr[br]="x",Rr[Cr]="y",Rr[Ir]="z"):(Rr[0]="x",Rr[1]="y",Rr[2]="z"),mr.axisOrder=Rr}else mr.axisOrder=["x","y","z"];const yr=new Vector3$1().fromArray(ar.vectors[0]).length(),wr=new Vector3$1().fromArray(ar.vectors[1]).length(),xr=new Vector3$1().fromArray(ar.vectors[2]).length();mr.spacing=[yr,wr,xr],mr.matrix=new Matrix4;const Sr=new Matrix4;if(ar.space==="left-posterior-superior"?Sr.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1):ar.space==="left-anterior-superior"&&Sr.set(1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1),!ar.vectors)mr.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);else{const br=ar.vectors,Cr=new Matrix4().set(br[0][0],br[1][0],br[2][0],0,br[0][1],br[1][1],br[2][1],0,br[0][2],br[1][2],br[2][2],0,0,0,0,1),Ir=new Matrix4().multiplyMatrices(Cr,Sr);mr.matrix=Ir}return mr.inverseMatrix=new Matrix4,mr.inverseMatrix.copy(mr.matrix).invert(),mr.RASDimensions=[Math.floor(mr.xLength*yr),Math.floor(mr.yLength*wr),Math.floor(mr.zLength*xr)],mr.lowerThreshold===-1/0&&(mr.lowerThreshold=_r),mr.upperThreshold===1/0&&(mr.upperThreshold=Ar),mr}parseChars(er,tr,ir){tr===void 0&&(tr=0),ir===void 0&&(ir=er.length);let nr="",sr=0;for(sr=tr;sr<ir;++sr)nr+=String.fromCharCode(er[sr]);return nr}}const _fieldFunctions={type:function(rr){switch(rr){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+rr)}return this.type=rr},endian:function(rr){return this.endian=rr},encoding:function(rr){return this.encoding=rr},dimension:function(rr){return this.dim=parseInt(rr,10)},sizes:function(rr){let er;return this.sizes=function(){const tr=rr.split(/\s+/),ir=[];for(let nr=0,sr=tr.length;nr<sr;nr++)er=tr[nr],ir.push(parseInt(er,10));return ir}()},space:function(rr){return this.space=rr},"space origin":function(rr){return this.space_origin=rr.split("(")[1].split(")")[0].split(",")},"space directions":function(rr){let er,tr;const ir=rr.match(/\(.*?\)/g);return this.vectors=function(){const nr=[];for(let sr=0,ar=ir.length;sr<ar;sr++)tr=ir[sr],nr.push(function(){const or=tr.slice(1,-1).split(/,/),lr=[];for(let cr=0,ur=or.length;cr<ur;cr++)er=or[cr],lr.push(parseFloat(er));return lr}());return nr}()},spacings:function(rr){let er;const tr=rr.split(/\s+/);return this.spacings=function(){const ir=[];for(let nr=0,sr=tr.length;nr<sr;nr++)er=tr[nr],ir.push(parseFloat(er));return ir}()}},_object_pattern=/^[og]\s*(.+)?/,_material_library_pattern=/^mtllib /,_material_use_pattern=/^usemtl /,_map_use_pattern=/^usemap /,_face_vertex_data_separator_pattern=/\s+/,_vA$1=new Vector3$1,_vB$1=new Vector3$1,_vC$1=new Vector3$1,_ab$1=new Vector3$1,_cb$1=new Vector3$1,_color$4=new Color;function ParserState(){const rr={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(er,tr){if(this.object&&this.object.fromDeclaration===!1){this.object.name=er,this.object.fromDeclaration=tr!==!1;return}const ir=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:er||"",fromDeclaration:tr!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(nr,sr){const ar=this._finalize(!1);ar&&(ar.inherited||ar.groupCount<=0)&&this.materials.splice(ar.index,1);const or={index:this.materials.length,name:nr||"",mtllib:Array.isArray(sr)&&sr.length>0?sr[sr.length-1]:"",smooth:ar!==void 0?ar.smooth:this.smooth,groupStart:ar!==void 0?ar.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(lr){const cr={index:typeof lr=="number"?lr:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return cr.clone=this.clone.bind(cr),cr}};return this.materials.push(or),or},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(nr){const sr=this.currentMaterial();if(sr&&sr.groupEnd===-1&&(sr.groupEnd=this.geometry.vertices.length/3,sr.groupCount=sr.groupEnd-sr.groupStart,sr.inherited=!1),nr&&this.materials.length>1)for(let ar=this.materials.length-1;ar>=0;ar--)this.materials[ar].groupCount<=0&&this.materials.splice(ar,1);return nr&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),sr}},ir&&ir.name&&typeof ir.clone=="function"){const nr=ir.clone(0);nr.inherited=!0,this.object.materials.push(nr)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(er,tr){const ir=parseInt(er,10);return(ir>=0?ir-1:ir+tr/3)*3},parseNormalIndex:function(er,tr){const ir=parseInt(er,10);return(ir>=0?ir-1:ir+tr/3)*3},parseUVIndex:function(er,tr){const ir=parseInt(er,10);return(ir>=0?ir-1:ir+tr/2)*2},addVertex:function(er,tr,ir){const nr=this.vertices,sr=this.object.geometry.vertices;sr.push(nr[er+0],nr[er+1],nr[er+2]),sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),sr.push(nr[ir+0],nr[ir+1],nr[ir+2])},addVertexPoint:function(er){const tr=this.vertices;this.object.geometry.vertices.push(tr[er+0],tr[er+1],tr[er+2])},addVertexLine:function(er){const tr=this.vertices;this.object.geometry.vertices.push(tr[er+0],tr[er+1],tr[er+2])},addNormal:function(er,tr,ir){const nr=this.normals,sr=this.object.geometry.normals;sr.push(nr[er+0],nr[er+1],nr[er+2]),sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),sr.push(nr[ir+0],nr[ir+1],nr[ir+2])},addFaceNormal:function(er,tr,ir){const nr=this.vertices,sr=this.object.geometry.normals;_vA$1.fromArray(nr,er),_vB$1.fromArray(nr,tr),_vC$1.fromArray(nr,ir),_cb$1.subVectors(_vC$1,_vB$1),_ab$1.subVectors(_vA$1,_vB$1),_cb$1.cross(_ab$1),_cb$1.normalize(),sr.push(_cb$1.x,_cb$1.y,_cb$1.z),sr.push(_cb$1.x,_cb$1.y,_cb$1.z),sr.push(_cb$1.x,_cb$1.y,_cb$1.z)},addColor:function(er,tr,ir){const nr=this.colors,sr=this.object.geometry.colors;nr[er]!==void 0&&sr.push(nr[er+0],nr[er+1],nr[er+2]),nr[tr]!==void 0&&sr.push(nr[tr+0],nr[tr+1],nr[tr+2]),nr[ir]!==void 0&&sr.push(nr[ir+0],nr[ir+1],nr[ir+2])},addUV:function(er,tr,ir){const nr=this.uvs,sr=this.object.geometry.uvs;sr.push(nr[er+0],nr[er+1]),sr.push(nr[tr+0],nr[tr+1]),sr.push(nr[ir+0],nr[ir+1])},addDefaultUV:function(){const er=this.object.geometry.uvs;er.push(0,0),er.push(0,0),er.push(0,0)},addUVLine:function(er){const tr=this.uvs;this.object.geometry.uvs.push(tr[er+0],tr[er+1])},addFace:function(er,tr,ir,nr,sr,ar,or,lr,cr){const ur=this.vertices.length;let dr=this.parseVertexIndex(er,ur),hr=this.parseVertexIndex(tr,ur),pr=this.parseVertexIndex(ir,ur);if(this.addVertex(dr,hr,pr),this.addColor(dr,hr,pr),or!==void 0&&or!==""){const gr=this.normals.length;dr=this.parseNormalIndex(or,gr),hr=this.parseNormalIndex(lr,gr),pr=this.parseNormalIndex(cr,gr),this.addNormal(dr,hr,pr)}else this.addFaceNormal(dr,hr,pr);if(nr!==void 0&&nr!==""){const gr=this.uvs.length;dr=this.parseUVIndex(nr,gr),hr=this.parseUVIndex(sr,gr),pr=this.parseUVIndex(ar,gr),this.addUV(dr,hr,pr),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(er){this.object.geometry.type="Points";const tr=this.vertices.length;for(let ir=0,nr=er.length;ir<nr;ir++){const sr=this.parseVertexIndex(er[ir],tr);this.addVertexPoint(sr),this.addColor(sr)}},addLineGeometry:function(er,tr){this.object.geometry.type="Line";const ir=this.vertices.length,nr=this.uvs.length;for(let sr=0,ar=er.length;sr<ar;sr++)this.addVertexLine(this.parseVertexIndex(er[sr],ir));for(let sr=0,ar=tr.length;sr<ar;sr++)this.addUVLine(this.parseUVIndex(tr[sr],nr))}};return rr.startObject("",!1),rr}class OBJLoader extends Loader{constructor(er){super(er),this.materials=null}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}setMaterials(er){return this.materials=er,this}parse(er){const tr=new ParserState;er.indexOf(`\r
`)!==-1&&(er=er.replace(/\r\n/g,`
`)),er.indexOf(`\\
`)!==-1&&(er=er.replace(/\\\n/g,""));const ir=er.split(`
`);let nr=[];for(let or=0,lr=ir.length;or<lr;or++){const cr=ir[or].trimStart();if(cr.length===0)continue;const ur=cr.charAt(0);if(ur!=="#")if(ur==="v"){const dr=cr.split(_face_vertex_data_separator_pattern);switch(dr[0]){case"v":tr.vertices.push(parseFloat(dr[1]),parseFloat(dr[2]),parseFloat(dr[3])),dr.length>=7?(_color$4.setRGB(parseFloat(dr[4]),parseFloat(dr[5]),parseFloat(dr[6]),SRGBColorSpace),tr.colors.push(_color$4.r,_color$4.g,_color$4.b)):tr.colors.push(void 0,void 0,void 0);break;case"vn":tr.normals.push(parseFloat(dr[1]),parseFloat(dr[2]),parseFloat(dr[3]));break;case"vt":tr.uvs.push(parseFloat(dr[1]),parseFloat(dr[2]));break}}else if(ur==="f"){const hr=cr.slice(1).trim().split(_face_vertex_data_separator_pattern),pr=[];for(let vr=0,mr=hr.length;vr<mr;vr++){const fr=hr[vr];if(fr.length>0){const _r=fr.split("/");pr.push(_r)}}const gr=pr[0];for(let vr=1,mr=pr.length-1;vr<mr;vr++){const fr=pr[vr],_r=pr[vr+1];tr.addFace(gr[0],fr[0],_r[0],gr[1],fr[1],_r[1],gr[2],fr[2],_r[2])}}else if(ur==="l"){const dr=cr.substring(1).trim().split(" ");let hr=[];const pr=[];if(cr.indexOf("/")===-1)hr=dr;else for(let gr=0,vr=dr.length;gr<vr;gr++){const mr=dr[gr].split("/");mr[0]!==""&&hr.push(mr[0]),mr[1]!==""&&pr.push(mr[1])}tr.addLineGeometry(hr,pr)}else if(ur==="p"){const hr=cr.slice(1).trim().split(" ");tr.addPointGeometry(hr)}else if((nr=_object_pattern.exec(cr))!==null){const dr=(" "+nr[0].slice(1).trim()).slice(1);tr.startObject(dr)}else if(_material_use_pattern.test(cr))tr.object.startMaterial(cr.substring(7).trim(),tr.materialLibraries);else if(_material_library_pattern.test(cr))tr.materialLibraries.push(cr.substring(7).trim());else if(_map_use_pattern.test(cr))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(ur==="s"){if(nr=cr.split(" "),nr.length>1){const hr=nr[1].trim().toLowerCase();tr.object.smooth=hr!=="0"&&hr!=="off"}else tr.object.smooth=!0;const dr=tr.object.currentMaterial();dr&&(dr.smooth=tr.object.smooth)}else{if(cr==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+cr+'"')}}tr.finalize();const sr=new Group;if(sr.materialLibraries=[].concat(tr.materialLibraries),!(tr.objects.length===1&&tr.objects[0].geometry.vertices.length===0)===!0)for(let or=0,lr=tr.objects.length;or<lr;or++){const cr=tr.objects[or],ur=cr.geometry,dr=cr.materials,hr=ur.type==="Line",pr=ur.type==="Points";let gr=!1;if(ur.vertices.length===0)continue;const vr=new BufferGeometry;vr.setAttribute("position",new Float32BufferAttribute(ur.vertices,3)),ur.normals.length>0&&vr.setAttribute("normal",new Float32BufferAttribute(ur.normals,3)),ur.colors.length>0&&(gr=!0,vr.setAttribute("color",new Float32BufferAttribute(ur.colors,3))),ur.hasUVIndices===!0&&vr.setAttribute("uv",new Float32BufferAttribute(ur.uvs,2));const mr=[];for(let _r=0,Ar=dr.length;_r<Ar;_r++){const yr=dr[_r],wr=yr.name+"_"+yr.smooth+"_"+gr;let xr=tr.materials[wr];if(this.materials!==null){if(xr=this.materials.create(yr.name),hr&&xr&&!(xr instanceof LineBasicMaterial)){const Sr=new LineBasicMaterial;Material.prototype.copy.call(Sr,xr),Sr.color.copy(xr.color),xr=Sr}else if(pr&&xr&&!(xr instanceof PointsMaterial)){const Sr=new PointsMaterial({size:10,sizeAttenuation:!1});Material.prototype.copy.call(Sr,xr),Sr.color.copy(xr.color),Sr.map=xr.map,xr=Sr}}xr===void 0&&(hr?xr=new LineBasicMaterial:pr?xr=new PointsMaterial({size:1,sizeAttenuation:!1}):xr=new MeshPhongMaterial,xr.name=yr.name,xr.flatShading=!yr.smooth,xr.vertexColors=gr,tr.materials[wr]=xr),mr.push(xr)}let fr;if(mr.length>1){for(let _r=0,Ar=dr.length;_r<Ar;_r++){const yr=dr[_r];vr.addGroup(yr.groupStart,yr.groupCount,_r)}hr?fr=new LineSegments(vr,mr):pr?fr=new Points(vr,mr):fr=new Mesh(vr,mr)}else hr?fr=new LineSegments(vr,mr[0]):pr?fr=new Points(vr,mr[0]):fr=new Mesh(vr,mr[0]);fr.name=cr.name,sr.add(fr)}else if(tr.vertices.length>0){const or=new PointsMaterial({size:1,sizeAttenuation:!1}),lr=new BufferGeometry;lr.setAttribute("position",new Float32BufferAttribute(tr.vertices,3)),tr.colors.length>0&&tr.colors[0]!==void 0&&(lr.setAttribute("color",new Float32BufferAttribute(tr.colors,3)),or.vertexColors=!0);const cr=new Points(lr,or);sr.add(cr)}return sr}}class PCDLoader extends Loader{constructor(er){super(er),this.littleEndian=!0}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(gr,vr){const mr=gr.length,fr=new Uint8Array(vr);let _r=0,Ar=0,yr,wr,xr;do if(yr=gr[_r++],yr<32){if(yr++,Ar+yr>vr)throw new Error("Output buffer is not large enough");if(_r+yr>mr)throw new Error("Invalid compressed data");do fr[Ar++]=gr[_r++];while(--yr)}else{if(wr=yr>>5,xr=Ar-((yr&31)<<8)-1,_r>=mr)throw new Error("Invalid compressed data");if(wr===7&&(wr+=gr[_r++],_r>=mr))throw new Error("Invalid compressed data");if(xr-=gr[_r++],Ar+wr+2>vr)throw new Error("Output buffer is not large enough");if(xr<0)throw new Error("Invalid compressed data");if(xr>=Ar)throw new Error("Invalid compressed data");do fr[Ar++]=fr[xr++];while(--wr+2)}while(_r<mr);return fr}function ir(gr){const vr={},mr=gr.search(/[\r\n]DATA\s(\S*)\s/i),fr=/[\r\n]DATA\s(\S*)\s/i.exec(gr.slice(mr-1));if(vr.data=fr[1],vr.headerLen=fr[0].length+mr,vr.str=gr.slice(0,vr.headerLen),vr.str=vr.str.replace(/#.*/gi,""),vr.version=/^VERSION (.*)/im.exec(vr.str),vr.fields=/^FIELDS (.*)/im.exec(vr.str),vr.size=/^SIZE (.*)/im.exec(vr.str),vr.type=/^TYPE (.*)/im.exec(vr.str),vr.count=/^COUNT (.*)/im.exec(vr.str),vr.width=/^WIDTH (.*)/im.exec(vr.str),vr.height=/^HEIGHT (.*)/im.exec(vr.str),vr.viewpoint=/^VIEWPOINT (.*)/im.exec(vr.str),vr.points=/^POINTS (.*)/im.exec(vr.str),vr.version!==null&&(vr.version=parseFloat(vr.version[1])),vr.fields=vr.fields!==null?vr.fields[1].split(" "):[],vr.type!==null&&(vr.type=vr.type[1].split(" ")),vr.width!==null&&(vr.width=parseInt(vr.width[1])),vr.height!==null&&(vr.height=parseInt(vr.height[1])),vr.viewpoint!==null&&(vr.viewpoint=vr.viewpoint[1]),vr.points!==null&&(vr.points=parseInt(vr.points[1],10)),vr.points===null&&(vr.points=vr.width*vr.height),vr.size!==null&&(vr.size=vr.size[1].split(" ").map(function(Ar){return parseInt(Ar,10)})),vr.count!==null)vr.count=vr.count[1].split(" ").map(function(Ar){return parseInt(Ar,10)});else{vr.count=[];for(let Ar=0,yr=vr.fields.length;Ar<yr;Ar++)vr.count.push(1)}vr.offset={};let _r=0;for(let Ar=0,yr=vr.fields.length;Ar<yr;Ar++)vr.data==="ascii"?vr.offset[vr.fields[Ar]]=Ar:(vr.offset[vr.fields[Ar]]=_r,_r+=vr.size[Ar]*vr.count[Ar]);return vr.rowSize=_r,vr}const nr=new TextDecoder().decode(er),sr=ir(nr),ar=[],or=[],lr=[],cr=[],ur=[],dr=new Color;if(sr.data==="ascii"){const gr=sr.offset,mr=nr.slice(sr.headerLen).split(`
`);for(let fr=0,_r=mr.length;fr<_r;fr++){if(mr[fr]==="")continue;const Ar=mr[fr].split(" ");if(gr.x!==void 0&&(ar.push(parseFloat(Ar[gr.x])),ar.push(parseFloat(Ar[gr.y])),ar.push(parseFloat(Ar[gr.z]))),gr.rgb!==void 0){const yr=sr.fields.findIndex(Rr=>Rr==="rgb"),wr=sr.type[yr],xr=parseFloat(Ar[gr.rgb]);let Sr=xr;if(wr==="F"){const Rr=new Float32Array(1);Rr[0]=xr,Sr=new Int32Array(Rr.buffer)[0]}const br=(Sr>>16&255)/255,Cr=(Sr>>8&255)/255,Ir=(Sr>>0&255)/255;dr.setRGB(br,Cr,Ir,SRGBColorSpace),lr.push(dr.r,dr.g,dr.b)}gr.normal_x!==void 0&&(or.push(parseFloat(Ar[gr.normal_x])),or.push(parseFloat(Ar[gr.normal_y])),or.push(parseFloat(Ar[gr.normal_z]))),gr.intensity!==void 0&&cr.push(parseFloat(Ar[gr.intensity])),gr.label!==void 0&&ur.push(parseInt(Ar[gr.label]))}}if(sr.data==="binary_compressed"){const gr=new Uint32Array(er.slice(sr.headerLen,sr.headerLen+8)),vr=gr[0],mr=gr[1],fr=tr(new Uint8Array(er,sr.headerLen+8,vr),mr),_r=new DataView(fr.buffer),Ar=sr.offset;for(let yr=0;yr<sr.points;yr++){if(Ar.x!==void 0){const wr=sr.fields.indexOf("x"),xr=sr.fields.indexOf("y"),Sr=sr.fields.indexOf("z");ar.push(_r.getFloat32(sr.points*Ar.x+sr.size[wr]*yr,this.littleEndian)),ar.push(_r.getFloat32(sr.points*Ar.y+sr.size[xr]*yr,this.littleEndian)),ar.push(_r.getFloat32(sr.points*Ar.z+sr.size[Sr]*yr,this.littleEndian))}if(Ar.rgb!==void 0){const wr=sr.fields.indexOf("rgb"),xr=_r.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+2)/255,Sr=_r.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+1)/255,br=_r.getUint8(sr.points*Ar.rgb+sr.size[wr]*yr+0)/255;dr.setRGB(xr,Sr,br,SRGBColorSpace),lr.push(dr.r,dr.g,dr.b)}if(Ar.normal_x!==void 0){const wr=sr.fields.indexOf("normal_x"),xr=sr.fields.indexOf("normal_y"),Sr=sr.fields.indexOf("normal_z");or.push(_r.getFloat32(sr.points*Ar.normal_x+sr.size[wr]*yr,this.littleEndian)),or.push(_r.getFloat32(sr.points*Ar.normal_y+sr.size[xr]*yr,this.littleEndian)),or.push(_r.getFloat32(sr.points*Ar.normal_z+sr.size[Sr]*yr,this.littleEndian))}if(Ar.intensity!==void 0){const wr=sr.fields.indexOf("intensity");cr.push(_r.getFloat32(sr.points*Ar.intensity+sr.size[wr]*yr,this.littleEndian))}if(Ar.label!==void 0){const wr=sr.fields.indexOf("label");ur.push(_r.getInt32(sr.points*Ar.label+sr.size[wr]*yr,this.littleEndian))}}}if(sr.data==="binary"){const gr=new DataView(er,sr.headerLen),vr=sr.offset;for(let mr=0,fr=0;mr<sr.points;mr++,fr+=sr.rowSize){if(vr.x!==void 0&&(ar.push(gr.getFloat32(fr+vr.x,this.littleEndian)),ar.push(gr.getFloat32(fr+vr.y,this.littleEndian)),ar.push(gr.getFloat32(fr+vr.z,this.littleEndian))),vr.rgb!==void 0){const _r=gr.getUint8(fr+vr.rgb+2)/255,Ar=gr.getUint8(fr+vr.rgb+1)/255,yr=gr.getUint8(fr+vr.rgb+0)/255;dr.setRGB(_r,Ar,yr,SRGBColorSpace),lr.push(dr.r,dr.g,dr.b)}vr.normal_x!==void 0&&(or.push(gr.getFloat32(fr+vr.normal_x,this.littleEndian)),or.push(gr.getFloat32(fr+vr.normal_y,this.littleEndian)),or.push(gr.getFloat32(fr+vr.normal_z,this.littleEndian))),vr.intensity!==void 0&&cr.push(gr.getFloat32(fr+vr.intensity,this.littleEndian)),vr.label!==void 0&&ur.push(gr.getInt32(fr+vr.label,this.littleEndian))}}const hr=new BufferGeometry;ar.length>0&&hr.setAttribute("position",new Float32BufferAttribute(ar,3)),or.length>0&&hr.setAttribute("normal",new Float32BufferAttribute(or,3)),lr.length>0&&hr.setAttribute("color",new Float32BufferAttribute(lr,3)),cr.length>0&&hr.setAttribute("intensity",new Float32BufferAttribute(cr,1)),ur.length>0&&hr.setAttribute("label",new Int32BufferAttribute(ur,1)),hr.computeBoundingSphere();const pr=new PointsMaterial({size:.005});return lr.length>0&&(pr.vertexColors=!0),new Points(hr,pr)}}class PDBLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(pr){return pr.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function ir(pr){return pr.charAt(0).toUpperCase()+pr.slice(1).toLowerCase()}function nr(pr,gr){return"s"+Math.min(pr,gr)+"e"+Math.max(pr,gr)}function sr(pr,gr,vr,mr){const fr=parseInt(hr[mr].slice(pr,pr+gr));if(fr){const _r=nr(vr,fr);ur[_r]===void 0&&(cr.push([vr-1,fr-1,1]),ur[_r]=cr.length-1)}}function ar(){const pr={geometryAtoms:new BufferGeometry,geometryBonds:new BufferGeometry,json:{atoms:lr}},gr=pr.geometryAtoms,vr=pr.geometryBonds,mr=[],fr=[],_r=[],Ar=new Color;for(let yr=0,wr=lr.length;yr<wr;yr++){const xr=lr[yr],Sr=xr[0],br=xr[1],Cr=xr[2];mr.push(Sr,br,Cr);const Ir=xr[3][0]/255,Rr=xr[3][1]/255,Pr=xr[3][2]/255;Ar.setRGB(Ir,Rr,Pr,SRGBColorSpace),fr.push(Ar.r,Ar.g,Ar.b)}for(let yr=0,wr=cr.length;yr<wr;yr++){const xr=cr[yr],Sr=xr[0],br=xr[1],Cr=dr[Sr],Ir=dr[br];let Rr=Cr[0],Pr=Cr[1],Dr=Cr[2];_r.push(Rr,Pr,Dr),Rr=Ir[0],Pr=Ir[1],Dr=Ir[2],_r.push(Rr,Pr,Dr)}return gr.setAttribute("position",new Float32BufferAttribute(mr,3)),gr.setAttribute("color",new Float32BufferAttribute(fr,3)),vr.setAttribute("position",new Float32BufferAttribute(_r,3)),pr}const or={h:[255,255,255],he:[217,255,255],li:[204,128,255],be:[194,255,0],b:[255,181,181],c:[144,144,144],n:[48,80,248],o:[255,13,13],f:[144,224,80],ne:[179,227,245],na:[171,92,242],mg:[138,255,0],al:[191,166,166],si:[240,200,160],p:[255,128,0],s:[255,255,48],cl:[31,240,31],ar:[128,209,227],k:[143,64,212],ca:[61,255,0],sc:[230,230,230],ti:[191,194,199],v:[166,166,171],cr:[138,153,199],mn:[156,122,199],fe:[224,102,51],co:[240,144,160],ni:[80,208,80],cu:[200,128,51],zn:[125,128,176],ga:[194,143,143],ge:[102,143,143],as:[189,128,227],se:[255,161,0],br:[166,41,41],kr:[92,184,209],rb:[112,46,176],sr:[0,255,0],y:[148,255,255],zr:[148,224,224],nb:[115,194,201],mo:[84,181,181],tc:[59,158,158],ru:[36,143,143],rh:[10,125,140],pd:[0,105,133],ag:[192,192,192],cd:[255,217,143],in:[166,117,115],sn:[102,128,128],sb:[158,99,181],te:[212,122,0],i:[148,0,148],xe:[66,158,176],cs:[87,23,143],ba:[0,201,0],la:[112,212,255],ce:[255,255,199],pr:[217,255,199],nd:[199,255,199],pm:[163,255,199],sm:[143,255,199],eu:[97,255,199],gd:[69,255,199],tb:[48,255,199],dy:[31,255,199],ho:[0,255,156],er:[0,230,117],tm:[0,212,82],yb:[0,191,56],lu:[0,171,36],hf:[77,194,255],ta:[77,166,255],w:[33,148,214],re:[38,125,171],os:[38,102,150],ir:[23,84,135],pt:[208,208,224],au:[255,209,35],hg:[184,184,208],tl:[166,84,77],pb:[87,89,97],bi:[158,79,181],po:[171,92,0],at:[117,79,69],rn:[66,130,150],fr:[66,0,102],ra:[0,125,0],ac:[112,171,250],th:[0,186,255],pa:[0,161,255],u:[0,143,255],np:[0,128,255],pu:[0,107,255],am:[84,92,242],cm:[120,92,227],bk:[138,79,227],cf:[161,54,212],es:[179,31,212],fm:[179,31,186],md:[179,13,166],no:[189,13,135],lr:[199,0,102],rf:[204,0,89],db:[209,0,79],sg:[217,0,69],bh:[224,0,56],hs:[230,0,46],mt:[235,0,38],ds:[235,0,38],rg:[235,0,38],cn:[235,0,38],uut:[235,0,38],uuq:[235,0,38],uup:[235,0,38],uuh:[235,0,38],uus:[235,0,38],uuo:[235,0,38]},lr=[],cr=[],ur={},dr={},hr=er.split(`
`);for(let pr=0,gr=hr.length;pr<gr;pr++)if(hr[pr].slice(0,4)==="ATOM"||hr[pr].slice(0,6)==="HETATM"){const vr=parseFloat(hr[pr].slice(30,37)),mr=parseFloat(hr[pr].slice(38,45)),fr=parseFloat(hr[pr].slice(46,53)),_r=parseInt(hr[pr].slice(6,11))-1;let Ar=tr(hr[pr].slice(76,78)).toLowerCase();Ar===""&&(Ar=tr(hr[pr].slice(12,14)).toLowerCase());const yr=[vr,mr,fr,or[Ar],ir(Ar)];lr.push(yr),dr[_r]=yr}else if(hr[pr].slice(0,6)==="CONECT"){const vr=parseInt(hr[pr].slice(6,11));sr(11,5,vr,pr),sr(16,5,vr,pr),sr(21,5,vr,pr),sr(26,5,vr,pr)}return ar()}}const _color$3=new Color;class PLYLoader extends Loader{constructor(er){super(er),this.propertyNameMapping={},this.customPropertyMapping={}}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}setPropertyNameMapping(er){this.propertyNameMapping=er}setCustomPropertyNameMapping(er){this.customPropertyMapping=er}parse(er){function tr(mr,fr=0){const _r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/;let Ar="";const yr=_r.exec(mr);yr!==null&&(Ar=yr[1]);const wr={comments:[],elements:[],headerLength:fr,objInfo:""},xr=Ar.split(/\r\n|\r|\n/);let Sr;function br(Cr,Ir){const Rr={type:Cr[0]};return Rr.type==="list"?(Rr.name=Cr[3],Rr.countType=Cr[1],Rr.itemType=Cr[2]):Rr.name=Cr[1],Rr.name in Ir&&(Rr.name=Ir[Rr.name]),Rr}for(let Cr=0;Cr<xr.length;Cr++){let Ir=xr[Cr];if(Ir=Ir.trim(),Ir==="")continue;const Rr=Ir.split(/\s+/),Pr=Rr.shift();switch(Ir=Rr.join(" "),Pr){case"format":wr.format=Rr[0],wr.version=Rr[1];break;case"comment":wr.comments.push(Ir);break;case"element":Sr!==void 0&&wr.elements.push(Sr),Sr={},Sr.name=Rr[0],Sr.count=parseInt(Rr[1]),Sr.properties=[];break;case"property":Sr.properties.push(br(Rr,vr.propertyNameMapping));break;case"obj_info":wr.objInfo=Ir;break;default:console.log("unhandled",Pr,Rr)}}return Sr!==void 0&&wr.elements.push(Sr),wr}function ir(mr,fr){switch(fr){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(mr);case"float":case"double":case"float32":case"float64":return parseFloat(mr)}}function nr(mr,fr){const _r={};for(let Ar=0;Ar<mr.length;Ar++){if(fr.empty())return null;if(mr[Ar].type==="list"){const yr=[],wr=ir(fr.next(),mr[Ar].countType);for(let xr=0;xr<wr;xr++){if(fr.empty())return null;yr.push(ir(fr.next(),mr[Ar].itemType))}_r[mr[Ar].name]=yr}else _r[mr[Ar].name]=ir(fr.next(),mr[Ar].type)}return _r}function sr(){const mr={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[],faceVertexColors:[]};for(const fr of Object.keys(vr.customPropertyMapping))mr[fr]=[];return mr}function ar(mr){const fr=mr.map(Ar=>Ar.name);function _r(Ar){for(let yr=0,wr=Ar.length;yr<wr;yr++){const xr=Ar[yr];if(fr.includes(xr))return xr}return null}return{attrX:_r(["x","px","posx"])||"x",attrY:_r(["y","py","posy"])||"y",attrZ:_r(["z","pz","posz"])||"z",attrNX:_r(["nx","normalx"]),attrNY:_r(["ny","normaly"]),attrNZ:_r(["nz","normalz"]),attrS:_r(["s","u","texture_u","tx"]),attrT:_r(["t","v","texture_v","ty"]),attrR:_r(["red","diffuse_red","r","diffuse_r"]),attrG:_r(["green","diffuse_green","g","diffuse_g"]),attrB:_r(["blue","diffuse_blue","b","diffuse_b"])}}function or(mr,fr){const _r=sr(),Ar=/end_header\s+(\S[\s\S]*\S|\S)\s*$/;let yr,wr;(wr=Ar.exec(mr))!==null?yr=wr[1].split(/\s+/):yr=[];const xr=new ArrayStream(yr);e:for(let Sr=0;Sr<fr.elements.length;Sr++){const br=fr.elements[Sr],Cr=ar(br.properties);for(let Ir=0;Ir<br.count;Ir++){const Rr=nr(br.properties,xr);if(!Rr)break e;cr(_r,br.name,Rr,Cr)}}return lr(_r)}function lr(mr){let fr=new BufferGeometry;mr.indices.length>0&&fr.setIndex(mr.indices),fr.setAttribute("position",new Float32BufferAttribute(mr.vertices,3)),mr.normals.length>0&&fr.setAttribute("normal",new Float32BufferAttribute(mr.normals,3)),mr.uvs.length>0&&fr.setAttribute("uv",new Float32BufferAttribute(mr.uvs,2)),mr.colors.length>0&&fr.setAttribute("color",new Float32BufferAttribute(mr.colors,3)),(mr.faceVertexUvs.length>0||mr.faceVertexColors.length>0)&&(fr=fr.toNonIndexed(),mr.faceVertexUvs.length>0&&fr.setAttribute("uv",new Float32BufferAttribute(mr.faceVertexUvs,2)),mr.faceVertexColors.length>0&&fr.setAttribute("color",new Float32BufferAttribute(mr.faceVertexColors,3)));for(const _r of Object.keys(vr.customPropertyMapping))mr[_r].length>0&&fr.setAttribute(_r,new Float32BufferAttribute(mr[_r],vr.customPropertyMapping[_r].length));return fr.computeBoundingSphere(),fr}function cr(mr,fr,_r,Ar){if(fr==="vertex"){mr.vertices.push(_r[Ar.attrX],_r[Ar.attrY],_r[Ar.attrZ]),Ar.attrNX!==null&&Ar.attrNY!==null&&Ar.attrNZ!==null&&mr.normals.push(_r[Ar.attrNX],_r[Ar.attrNY],_r[Ar.attrNZ]),Ar.attrS!==null&&Ar.attrT!==null&&mr.uvs.push(_r[Ar.attrS],_r[Ar.attrT]),Ar.attrR!==null&&Ar.attrG!==null&&Ar.attrB!==null&&(_color$3.setRGB(_r[Ar.attrR]/255,_r[Ar.attrG]/255,_r[Ar.attrB]/255,SRGBColorSpace),mr.colors.push(_color$3.r,_color$3.g,_color$3.b));for(const yr of Object.keys(vr.customPropertyMapping))for(const wr of vr.customPropertyMapping[yr])mr[yr].push(_r[wr])}else if(fr==="face"){const yr=_r.vertex_indices||_r.vertex_index,wr=_r.texcoord;yr.length===3?(mr.indices.push(yr[0],yr[1],yr[2]),wr&&wr.length===6&&(mr.faceVertexUvs.push(wr[0],wr[1]),mr.faceVertexUvs.push(wr[2],wr[3]),mr.faceVertexUvs.push(wr[4],wr[5]))):yr.length===4&&(mr.indices.push(yr[0],yr[1],yr[3]),mr.indices.push(yr[1],yr[2],yr[3])),Ar.attrR!==null&&Ar.attrG!==null&&Ar.attrB!==null&&(_color$3.setRGB(_r[Ar.attrR]/255,_r[Ar.attrG]/255,_r[Ar.attrB]/255,SRGBColorSpace),mr.faceVertexColors.push(_color$3.r,_color$3.g,_color$3.b),mr.faceVertexColors.push(_color$3.r,_color$3.g,_color$3.b),mr.faceVertexColors.push(_color$3.r,_color$3.g,_color$3.b))}}function ur(mr,fr){const _r={};let Ar=0;for(let yr=0;yr<fr.length;yr++){const wr=fr[yr],xr=wr.valueReader;if(wr.type==="list"){const Sr=[],br=wr.countReader.read(mr+Ar);Ar+=wr.countReader.size;for(let Cr=0;Cr<br;Cr++)Sr.push(xr.read(mr+Ar)),Ar+=xr.size;_r[wr.name]=Sr}else _r[wr.name]=xr.read(mr+Ar),Ar+=xr.size}return[_r,Ar]}function dr(mr,fr,_r){function Ar(yr,wr,xr){switch(wr){case"int8":case"char":return{read:Sr=>yr.getInt8(Sr),size:1};case"uint8":case"uchar":return{read:Sr=>yr.getUint8(Sr),size:1};case"int16":case"short":return{read:Sr=>yr.getInt16(Sr,xr),size:2};case"uint16":case"ushort":return{read:Sr=>yr.getUint16(Sr,xr),size:2};case"int32":case"int":return{read:Sr=>yr.getInt32(Sr,xr),size:4};case"uint32":case"uint":return{read:Sr=>yr.getUint32(Sr,xr),size:4};case"float32":case"float":return{read:Sr=>yr.getFloat32(Sr,xr),size:4};case"float64":case"double":return{read:Sr=>yr.getFloat64(Sr,xr),size:8}}}for(let yr=0,wr=mr.length;yr<wr;yr++){const xr=mr[yr];xr.type==="list"?(xr.countReader=Ar(fr,xr.countType,_r),xr.valueReader=Ar(fr,xr.itemType,_r)):xr.valueReader=Ar(fr,xr.type,_r)}}function hr(mr,fr){const _r=sr(),Ar=fr.format==="binary_little_endian",yr=new DataView(mr,fr.headerLength);let wr,xr=0;for(let Sr=0;Sr<fr.elements.length;Sr++){const br=fr.elements[Sr],Cr=br.properties,Ir=ar(Cr);dr(Cr,yr,Ar);for(let Rr=0;Rr<br.count;Rr++){wr=ur(xr,Cr),xr+=wr[1];const Pr=wr[0];cr(_r,br.name,Pr,Ir)}}return lr(_r)}function pr(mr){let fr=0,_r=!0,Ar="";const yr=[],wr=new TextDecoder().decode(mr.subarray(0,5)),xr=/^ply\r\n/.test(wr);do{const Sr=String.fromCharCode(mr[fr++]);Sr!==`
`&&Sr!=="\r"?Ar+=Sr:(Ar==="end_header"&&(_r=!1),Ar!==""&&(yr.push(Ar),Ar=""))}while(_r&&fr<mr.length);return xr===!0&&fr++,{headerText:yr.join("\r")+"\r",headerLength:fr}}let gr;const vr=this;if(er instanceof ArrayBuffer){const mr=new Uint8Array(er),{headerText:fr,headerLength:_r}=pr(mr),Ar=tr(fr,_r);if(Ar.format==="ascii"){const yr=new TextDecoder().decode(mr);gr=or(yr,Ar)}else gr=hr(er,Ar)}else gr=or(er,tr(er));return gr}}class ArrayStream{constructor(er){this.arr=er,this.i=0}empty(){return this.i>=this.arr.length}next(){return this.arr[this.i++]}}class PVRLoader extends CompressedTextureLoader{constructor(er){super(er)}parse(er,tr){const nr=new Uint32Array(er,0,13),sr={buffer:er,header:nr,loadMipmaps:tr};if(nr[0]===55727696)return _parseV3(sr);if(nr[11]===559044176)return _parseV2(sr);console.error("THREE.PVRLoader: Unknown PVR format.")}}function _parseV3(rr){const er=rr.header;let tr,ir;const nr=er[12],sr=er[2],ar=er[6],or=er[7],lr=er[10],cr=er[11];switch(sr){case 0:tr=2,ir=RGB_PVRTC_2BPPV1_Format;break;case 1:tr=2,ir=RGBA_PVRTC_2BPPV1_Format;break;case 2:tr=4,ir=RGB_PVRTC_4BPPV1_Format;break;case 3:tr=4,ir=RGBA_PVRTC_4BPPV1_Format;break;default:console.error("THREE.PVRLoader: Unsupported PVR format:",sr)}return rr.dataPtr=52+nr,rr.bpp=tr,rr.format=ir,rr.width=or,rr.height=ar,rr.numSurfaces=lr,rr.numMipmaps=cr,rr.isCubemap=lr===6,_extract(rr)}function _parseV2(rr){const er=rr.header,tr=er[0],ir=er[1],nr=er[2],sr=er[3],ar=er[4],or=er[10],lr=er[12],cr=255,ur=24,dr=25,hr=ar&cr;let pr,gr;const vr=or>0;return hr===dr?(gr=vr?RGBA_PVRTC_4BPPV1_Format:RGB_PVRTC_4BPPV1_Format,pr=4):hr===ur?(gr=vr?RGBA_PVRTC_2BPPV1_Format:RGB_PVRTC_2BPPV1_Format,pr=2):console.error("THREE.PVRLoader: Unknown PVR format:",hr),rr.dataPtr=tr,rr.bpp=pr,rr.format=gr,rr.width=nr,rr.height=ir,rr.numSurfaces=lr,rr.numMipmaps=sr+1,rr.isCubemap=lr===6,_extract(rr)}function _extract(rr){const er={mipmaps:[],width:rr.width,height:rr.height,format:rr.format,mipmapCount:rr.numMipmaps,isCubemap:rr.isCubemap},tr=rr.buffer;let ir=rr.dataPtr,nr=0,sr=0,ar=0,or=0,lr=0,cr=0;const ur=rr.bpp,dr=rr.numSurfaces;ur===2?(ar=8,or=4):(ar=4,or=4),sr=ar*or*ur/8,er.mipmaps.length=rr.numMipmaps*dr;let hr=0;for(;hr<rr.numMipmaps;){const pr=rr.width>>hr,gr=rr.height>>hr;lr=pr/ar,cr=gr/or,lr<2&&(lr=2),cr<2&&(cr=2),nr=lr*cr*sr;for(let vr=0;vr<dr;vr++){const fr={data:new Uint8Array(tr,ir,nr),width:pr,height:gr};er.mipmaps[vr*rr.numMipmaps+hr]=fr,ir+=nr}hr++}return er}const SRGB_TO_LINEAR=Array(1024).fill(0).map((rr,er)=>Math.pow(er/255*.9478672986+.0521327014,2.4));class UltraHDRLoader extends Loader{constructor(er){super(er),this.type=HalfFloatType}setDataType(er){return this.type=er,this}parse(er,tr){const ir={version:null,baseRenditionIsHDR:null,gainMapMin:null,gainMapMax:null,gamma:null,offsetSDR:null,offsetHDR:null,hdrCapacityMin:null,hdrCapacityMax:null},nr=new TextDecoder,sr=new DataView(er);let ar=0;const or=[];for(;ar<sr.byteLength;){const ur=sr.getUint8(ar);if(ur===255){const dr=sr.getUint8(ar+1);[216,224,225,226].includes(dr)?(or.push({sectionType:dr,section:[ur,dr],sectionOffset:ar+2}),ar+=2):(or[or.length-1].section.push(ur,dr),ar+=2)}else or[or.length-1].section.push(ur),ar++}let lr,cr;for(let ur=0;ur<or.length;ur++){const{sectionType:dr,section:hr,sectionOffset:pr}=or[ur];if(dr!==224){if(dr===225)this._parseXMPMetadata(nr.decode(new Uint8Array(hr)),ir);else if(dr===226){const gr=new DataView(new Uint8Array(hr.slice(2)).buffer);if(gr.getUint32(2,!1)===1297106432){const mr=gr.getUint32(6)===1229531648,fr=60,_r=gr.getUint32(fr,mr),Ar=gr.getUint32(fr+4,mr),yr=gr.getUint32(fr+16,mr),wr=gr.getUint32(fr+20,mr)+pr+6;lr=new Uint8Array(sr.buffer,Ar,_r),cr=new Uint8Array(sr.buffer,wr,yr)}}}}if(!ir.version)throw new Error("THREE.UltraHDRLoader: Not a valid UltraHDR image");if(lr&&cr)this._applyGainmapToSDR(ir,lr,cr,(ur,dr,hr)=>{tr({width:dr,height:hr,data:ur,format:RGBAFormat,type:this.type})},ur=>{throw new Error(ur)});else throw new Error("THREE.UltraHDRLoader: Could not parse UltraHDR images")}load(er,tr,ir,nr){const sr=new DataTexture(this.type===HalfFloatType?new Uint16Array:new Float32Array,0,0,RGBAFormat,this.type,UVMapping,ClampToEdgeWrapping,ClampToEdgeWrapping,LinearFilter,LinearMipMapLinearFilter,1,LinearSRGBColorSpace);sr.generateMipmaps=!0,sr.flipY=!0;const ar=new FileLoader(this.manager);return ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setPath(this.path),ar.setWithCredentials(this.withCredentials),ar.load(er,or=>{try{this.parse(or,lr=>{sr.image={data:lr.data,width:lr.width,height:lr.height},sr.needsUpdate=!0,tr&&tr(sr,lr)})}catch(lr){nr&&nr(lr),console.error(lr)}},ir,nr),sr}_parseXMPMetadata(er,tr){const nr=new DOMParser().parseFromString(er.substring(er.indexOf("<"),er.lastIndexOf(">")+1),"text/xml"),[sr]=nr.getElementsByTagName("Container:Directory");if(!sr){const[ar]=nr.getElementsByTagName("rdf:Description");tr.version=ar.getAttribute("hdrgm:Version"),tr.baseRenditionIsHDR=ar.getAttribute("hdrgm:BaseRenditionIsHDR")==="True",tr.gainMapMin=parseFloat(ar.getAttribute("hdrgm:GainMapMin")||0),tr.gainMapMax=parseFloat(ar.getAttribute("hdrgm:GainMapMax")||1),tr.gamma=parseFloat(ar.getAttribute("hdrgm:Gamma")||1),tr.offsetSDR=parseFloat(ar.getAttribute("hdrgm:OffsetSDR")/(1/64)),tr.offsetHDR=parseFloat(ar.getAttribute("hdrgm:OffsetHDR")/(1/64)),tr.hdrCapacityMin=parseFloat(ar.getAttribute("hdrgm:HDRCapacityMin")||0),tr.hdrCapacityMax=parseFloat(ar.getAttribute("hdrgm:HDRCapacityMax")||1)}}_srgbToLinear(er){return er/255<.04045?er/255*.0773993808:er<1024?SRGB_TO_LINEAR[~~er]:Math.pow(er/255*.9478672986+.0521327014,2.4)}_applyGainmapToSDR(er,tr,ir,nr,sr){const ar=or=>new Promise((lr,cr)=>{const ur=document.createElement("img");ur.onload=()=>{const dr={width:ur.naturalWidth,height:ur.naturalHeight,source:ur};URL.revokeObjectURL(ur.src),lr(dr)},ur.onerror=()=>{URL.revokeObjectURL(ur.src),cr()},ur.src=URL.createObjectURL(new Blob([or],{type:"image/jpeg"}))});Promise.all([ar(tr),ar(ir)]).then(([or,lr])=>{const cr=or.width/or.height,ur=lr.width/lr.height;if(cr!==ur){sr("THREE.UltraHDRLoader Error: Aspect ratio mismatch between SDR and Gainmap images");return}const dr=document.createElement("canvas"),hr=dr.getContext("2d",{willReadFrequently:!0,colorSpace:"srgb"});dr.width=or.width,dr.height=or.height,hr.drawImage(lr.source,0,0,lr.width,lr.height,0,0,or.width,or.height);const pr=hr.getImageData(0,0,or.width,or.height,{colorSpace:"srgb"});hr.drawImage(or.source,0,0);const gr=hr.getImageData(0,0,or.width,or.height,{colorSpace:"srgb"});let vr;this.type===HalfFloatType?vr=new Uint16Array(gr.data.length).fill(23544):vr=new Float32Array(gr.data.length).fill(255);const mr=Math.sqrt(Math.pow(1.8,er.hdrCapacityMax)),fr=(Math.log2(mr)-er.hdrCapacityMin)/(er.hdrCapacityMax-er.hdrCapacityMin),_r=Math.min(Math.max(fr,0),1),Ar=er.gamma===1;for(let yr=0;yr<gr.data.length;yr+=4){const wr=yr/4%or.width,xr=Math.floor(yr/4/or.width);for(let Sr=0;Sr<3;Sr++){const br=gr.data[yr+Sr],Cr=(xr*or.width+wr)*4+Sr,Ir=pr.data[Cr]/255,Rr=Ar?Ir:Math.pow(Ir,1/er.gamma),Pr=er.gainMapMin*(1-Rr)+er.gainMapMax*Rr,Dr=(br+er.offsetSDR)*(Pr*_r===0?1:Math.pow(2,Pr*_r))-er.offsetHDR,Fr=Math.min(Math.max(this._srgbToLinear(Dr),0),65504);vr[yr+Sr]=this.type===HalfFloatType?DataUtils.toHalfFloat(Fr):Fr}}nr(vr,or.width,or.height)}).catch(()=>{throw new Error("THREE.UltraHDRLoader Error: Could not parse UltraHDR images")})}}class RGBMLoader extends DataTextureLoader{constructor(er){super(er),this.type=HalfFloatType,this.maxRange=7}setDataType(er){return this.type=er,this}setMaxRange(er){return this.maxRange=er,this}loadCubemap(er,tr,ir,nr){const sr=new CubeTexture;for(let cr=0;cr<6;cr++)sr.images[cr]=void 0;let ar=0;const or=this;function lr(cr){or.load(er[cr],function(ur){sr.images[cr]=ur,ar++,ar===6&&(sr.needsUpdate=!0,tr&&tr(sr))},void 0,nr)}for(let cr=0;cr<er.length;++cr)lr(cr);return sr.type=this.type,sr.format=RGBAFormat,sr.minFilter=LinearFilter,sr.generateMipmaps=!1,sr}loadCubemapAsync(er,tr){return new Promise((ir,nr)=>{this.loadCubemap(er,ir,tr,nr)})}parse(er){const tr=UPNG.decode(er),ir=UPNG.toRGBA8(tr)[0],nr=new Uint8Array(ir),sr=tr.width*tr.height*4,ar=this.type===HalfFloatType?new Uint16Array(sr):new Float32Array(sr);for(let or=0;or<nr.length;or+=4){const lr=nr[or+0]/255,cr=nr[or+1]/255,ur=nr[or+2]/255,dr=nr[or+3]/255;this.type===HalfFloatType?(ar[or+0]=DataUtils.toHalfFloat(Math.min(lr*dr*this.maxRange,65504)),ar[or+1]=DataUtils.toHalfFloat(Math.min(cr*dr*this.maxRange,65504)),ar[or+2]=DataUtils.toHalfFloat(Math.min(ur*dr*this.maxRange,65504)),ar[or+3]=DataUtils.toHalfFloat(1)):(ar[or+0]=lr*dr*this.maxRange,ar[or+1]=cr*dr*this.maxRange,ar[or+2]=ur*dr*this.maxRange,ar[or+3]=1)}return{width:tr.width,height:tr.height,data:ar,format:RGBAFormat,type:this.type,flipY:!0}}}var UPNG={};UPNG.toRGBA8=function(rr){var er=rr.width,tr=rr.height;if(rr.tabs.acTL==null)return[UPNG.toRGBA8.decodeImage(rr.data,er,tr,rr).buffer];var ir=[];rr.frames[0].data==null&&(rr.frames[0].data=rr.data);for(var nr=er*tr*4,sr=new Uint8Array(nr),ar=new Uint8Array(nr),or=new Uint8Array(nr),lr=0;lr<rr.frames.length;lr++){var cr=rr.frames[lr],ur=cr.rect.x,dr=cr.rect.y,hr=cr.rect.width,pr=cr.rect.height,gr=UPNG.toRGBA8.decodeImage(cr.data,hr,pr,rr);if(lr!=0)for(var vr=0;vr<nr;vr++)or[vr]=sr[vr];if(cr.blend==0?UPNG._copyTile(gr,hr,pr,sr,er,tr,ur,dr,0):cr.blend==1&&UPNG._copyTile(gr,hr,pr,sr,er,tr,ur,dr,1),ir.push(sr.buffer.slice(0)),cr.dispose==1)UPNG._copyTile(ar,hr,pr,sr,er,tr,ur,dr,0);else if(cr.dispose==2)for(var vr=0;vr<nr;vr++)sr[vr]=or[vr]}return ir};UPNG.toRGBA8.decodeImage=function(rr,er,tr,ir){var nr=er*tr,sr=UPNG.decode._getBPP(ir),ar=Math.ceil(er*sr/8),or=new Uint8Array(nr*4),lr=new Uint32Array(or.buffer),cr=ir.ctype,ur=ir.depth,dr=UPNG._bin.readUshort;if(cr==6){var hr=nr<<2;if(ur==8)for(var pr=0;pr<hr;pr+=4)or[pr]=rr[pr],or[pr+1]=rr[pr+1],or[pr+2]=rr[pr+2],or[pr+3]=rr[pr+3];if(ur==16)for(var pr=0;pr<hr;pr++)or[pr]=rr[pr<<1]}else if(cr==2){var gr=ir.tabs.tRNS;if(gr==null){if(ur==8)for(var pr=0;pr<nr;pr++){var vr=pr*3;lr[pr]=255<<24|rr[vr+2]<<16|rr[vr+1]<<8|rr[vr]}if(ur==16)for(var pr=0;pr<nr;pr++){var vr=pr*6;lr[pr]=255<<24|rr[vr+4]<<16|rr[vr+2]<<8|rr[vr]}}else{var mr=gr[0],fr=gr[1],_r=gr[2];if(ur==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,vr=pr*3;lr[pr]=255<<24|rr[vr+2]<<16|rr[vr+1]<<8|rr[vr],rr[vr]==mr&&rr[vr+1]==fr&&rr[vr+2]==_r&&(or[Ar+3]=0)}if(ur==16)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,vr=pr*6;lr[pr]=255<<24|rr[vr+4]<<16|rr[vr+2]<<8|rr[vr],dr(rr,vr)==mr&&dr(rr,vr+2)==fr&&dr(rr,vr+4)==_r&&(or[Ar+3]=0)}}}else if(cr==3){var yr=ir.tabs.PLTE,wr=ir.tabs.tRNS,xr=wr?wr.length:0;if(ur==1)for(var Sr=0;Sr<tr;Sr++)for(var br=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=rr[br+(pr>>3)]>>7-((pr&7)<<0)&1,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<xr?wr[Ir]:255}if(ur==2)for(var Sr=0;Sr<tr;Sr++)for(var br=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=rr[br+(pr>>2)]>>6-((pr&3)<<1)&3,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<xr?wr[Ir]:255}if(ur==4)for(var Sr=0;Sr<tr;Sr++)for(var br=Sr*ar,Cr=Sr*er,pr=0;pr<er;pr++){var Ar=Cr+pr<<2,Ir=rr[br+(pr>>1)]>>4-((pr&1)<<2)&15,Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<xr?wr[Ir]:255}if(ur==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Ir=rr[pr],Rr=3*Ir;or[Ar]=yr[Rr],or[Ar+1]=yr[Rr+1],or[Ar+2]=yr[Rr+2],or[Ar+3]=Ir<xr?wr[Ir]:255}}else if(cr==4){if(ur==8)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Pr=pr<<1,Dr=rr[Pr];or[Ar]=Dr,or[Ar+1]=Dr,or[Ar+2]=Dr,or[Ar+3]=rr[Pr+1]}if(ur==16)for(var pr=0;pr<nr;pr++){var Ar=pr<<2,Pr=pr<<2,Dr=rr[Pr];or[Ar]=Dr,or[Ar+1]=Dr,or[Ar+2]=Dr,or[Ar+3]=rr[Pr+2]}}else if(cr==0)for(var mr=ir.tabs.tRNS?ir.tabs.tRNS:-1,Sr=0;Sr<tr;Sr++){var Fr=Sr*ar,Or=Sr*er;if(ur==1)for(var Nr=0;Nr<er;Nr++){var Dr=255*(rr[Fr+(Nr>>>3)]>>>7-(Nr&7)&1),Ur=Dr==mr*255?0:255;lr[Or+Nr]=Ur<<24|Dr<<16|Dr<<8|Dr}else if(ur==2)for(var Nr=0;Nr<er;Nr++){var Dr=85*(rr[Fr+(Nr>>>2)]>>>6-((Nr&3)<<1)&3),Ur=Dr==mr*85?0:255;lr[Or+Nr]=Ur<<24|Dr<<16|Dr<<8|Dr}else if(ur==4)for(var Nr=0;Nr<er;Nr++){var Dr=17*(rr[Fr+(Nr>>>1)]>>>4-((Nr&1)<<2)&15),Ur=Dr==mr*17?0:255;lr[Or+Nr]=Ur<<24|Dr<<16|Dr<<8|Dr}else if(ur==8)for(var Nr=0;Nr<er;Nr++){var Dr=rr[Fr+Nr],Ur=Dr==mr?0:255;lr[Or+Nr]=Ur<<24|Dr<<16|Dr<<8|Dr}else if(ur==16)for(var Nr=0;Nr<er;Nr++){var Dr=rr[Fr+(Nr<<1)],Ur=dr(rr,Fr+(Nr<<1))==mr?0:255;lr[Or+Nr]=Ur<<24|Dr<<16|Dr<<8|Dr}}return or};UPNG.decode=function(rr){for(var er=new Uint8Array(rr),tr=8,ir=UPNG._bin,nr=ir.readUshort,sr=ir.readUint,ar={tabs:{},frames:[]},or=new Uint8Array(er.length),lr=0,cr,ur=0,dr,hr,pr,gr=[137,80,78,71,13,10,26,10],vr=0;vr<8;vr++)if(er[vr]!=gr[vr])throw new Error("The input is not a PNG file!");for(;tr<er.length;){var mr=ir.readUint(er,tr);tr+=4;var fr=ir.readASCII(er,tr,4);if(tr+=4,fr=="IHDR")UPNG.decode._IHDR(er,tr,ar);else if(fr=="CgBI")ar.tabs[fr]=er.slice(tr,tr+4);else if(fr=="IDAT"){for(var vr=0;vr<mr;vr++)or[lr+vr]=er[tr+vr];lr+=mr}else if(fr=="acTL")ar.tabs[fr]={num_frames:sr(er,tr),num_plays:sr(er,tr+4)},cr=new Uint8Array(er.length);else if(fr=="fcTL"){if(ur!=0){var _r=ar.frames[ar.frames.length-1];_r.data=UPNG.decode._decompress(ar,cr.slice(0,ur),_r.rect.width,_r.rect.height),ur=0}var Ar={x:sr(er,tr+12),y:sr(er,tr+16),width:sr(er,tr+4),height:sr(er,tr+8)},yr=nr(er,tr+22);yr=nr(er,tr+20)/(yr==0?100:yr);var wr={rect:Ar,delay:Math.round(yr*1e3),dispose:er[tr+24],blend:er[tr+25]};ar.frames.push(wr)}else if(fr=="fdAT"){for(var vr=0;vr<mr-4;vr++)cr[ur+vr]=er[tr+vr+4];ur+=mr-4}else if(fr=="pHYs")ar.tabs[fr]=[ir.readUint(er,tr),ir.readUint(er,tr+4),er[tr+8]];else if(fr=="cHRM"){ar.tabs[fr]=[];for(var vr=0;vr<8;vr++)ar.tabs[fr].push(ir.readUint(er,tr+vr*4))}else if(fr=="tEXt"||fr=="zTXt"){ar.tabs[fr]==null&&(ar.tabs[fr]={});var xr=ir.nextZero(er,tr);hr=ir.readASCII(er,tr,xr-tr);var Sr=tr+mr-xr-1;fr=="tEXt"?dr=ir.readASCII(er,xr+1,Sr):(pr=UPNG.decode._inflate(er.slice(xr+2,xr+2+Sr)),dr=ir.readUTF8(pr,0,pr.length)),ar.tabs[fr][hr]=dr}else if(fr=="iTXt"){ar.tabs[fr]==null&&(ar.tabs[fr]={});var xr=0,br=tr;xr=ir.nextZero(er,br),hr=ir.readASCII(er,br,xr-br),br=xr+1;var Cr=er[br];br+=2,xr=ir.nextZero(er,br),ir.readASCII(er,br,xr-br),br=xr+1,xr=ir.nextZero(er,br),ir.readUTF8(er,br,xr-br),br=xr+1;var Sr=mr-(br-tr);Cr==0?dr=ir.readUTF8(er,br,Sr):(pr=UPNG.decode._inflate(er.slice(br,br+Sr)),dr=ir.readUTF8(pr,0,pr.length)),ar.tabs[fr][hr]=dr}else if(fr=="PLTE")ar.tabs[fr]=ir.readBytes(er,tr,mr);else if(fr=="hIST"){var Ir=ar.tabs.PLTE.length/3;ar.tabs[fr]=[];for(var vr=0;vr<Ir;vr++)ar.tabs[fr].push(nr(er,tr+vr*2))}else if(fr=="tRNS")ar.ctype==3?ar.tabs[fr]=ir.readBytes(er,tr,mr):ar.ctype==0?ar.tabs[fr]=nr(er,tr):ar.ctype==2&&(ar.tabs[fr]=[nr(er,tr),nr(er,tr+2),nr(er,tr+4)]);else if(fr=="gAMA")ar.tabs[fr]=ir.readUint(er,tr)/1e5;else if(fr=="sRGB")ar.tabs[fr]=er[tr];else if(fr=="bKGD")ar.ctype==0||ar.ctype==4?ar.tabs[fr]=[nr(er,tr)]:ar.ctype==2||ar.ctype==6?ar.tabs[fr]=[nr(er,tr),nr(er,tr+2),nr(er,tr+4)]:ar.ctype==3&&(ar.tabs[fr]=er[tr]);else if(fr=="IEND")break;tr+=mr,ir.readUint(er,tr),tr+=4}if(ur!=0){var _r=ar.frames[ar.frames.length-1];_r.data=UPNG.decode._decompress(ar,cr.slice(0,ur),_r.rect.width,_r.rect.height)}return ar.data=UPNG.decode._decompress(ar,or,ar.width,ar.height),delete ar.compress,delete ar.interlace,delete ar.filter,ar};UPNG.decode._decompress=function(rr,er,tr,ir){var nr=UPNG.decode._getBPP(rr),sr=Math.ceil(tr*nr/8),ar=new Uint8Array((sr+1+rr.interlace)*ir);return rr.tabs.CgBI?er=UPNG.inflateRaw(er,ar):er=UPNG.decode._inflate(er,ar),rr.interlace==0?er=UPNG.decode._filterZero(er,rr,0,tr,ir):rr.interlace==1&&(er=UPNG.decode._readInterlace(er,rr)),er};UPNG.decode._inflate=function(rr,er){var tr=UPNG.inflateRaw(new Uint8Array(rr.buffer,2,rr.length-6),er);return tr};UPNG.inflateRaw=function(){var rr={};return rr.H={},rr.H.N=function(er,tr){var ir=Uint8Array,nr=0,sr=0,ar=0,or=0,lr=0,cr=0,ur=0,dr=0,hr=0,pr,gr;if(er[0]==3&&er[1]==0)return tr||new ir(0);var vr=rr.H,mr=vr.b,fr=vr.e,_r=vr.R,Ar=vr.n,yr=vr.A,wr=vr.Z,xr=vr.m,Sr=tr==null;for(Sr&&(tr=new ir(er.length>>>2<<5));nr==0;){if(nr=mr(er,hr,1),sr=mr(er,hr+1,2),hr+=3,sr==0){hr&7&&(hr+=8-(hr&7));var br=(hr>>>3)+4,Cr=er[br-4]|er[br-3]<<8;Sr&&(tr=rr.H.W(tr,dr+Cr)),tr.set(new ir(er.buffer,er.byteOffset+br,Cr),dr),hr=br+Cr<<3,dr+=Cr;continue}if(Sr&&(tr=rr.H.W(tr,dr+(1<<17))),sr==1&&(pr=xr.J,gr=xr.h,cr=511,ur=31),sr==2){ar=fr(er,hr,5)+257,or=fr(er,hr+5,5)+1,lr=fr(er,hr+10,4)+4,hr+=14;for(var Ir=1,Rr=0;Rr<38;Rr+=2)xr.Q[Rr]=0,xr.Q[Rr+1]=0;for(var Rr=0;Rr<lr;Rr++){var Pr=fr(er,hr+Rr*3,3);xr.Q[(xr.X[Rr]<<1)+1]=Pr,Pr>Ir&&(Ir=Pr)}hr+=3*lr,Ar(xr.Q,Ir),yr(xr.Q,Ir,xr.u),pr=xr.w,gr=xr.d,hr=_r(xr.u,(1<<Ir)-1,ar+or,er,hr,xr.v);var Dr=vr.V(xr.v,0,ar,xr.C);cr=(1<<Dr)-1;var Fr=vr.V(xr.v,ar,or,xr.D);ur=(1<<Fr)-1,Ar(xr.C,Dr),yr(xr.C,Dr,pr),Ar(xr.D,Fr),yr(xr.D,Fr,gr)}for(;;){var Or=pr[wr(er,hr)&cr];hr+=Or&15;var Nr=Or>>>4;if(!(Nr>>>8))tr[dr++]=Nr;else{if(Nr==256)break;var Ur=dr+Nr-254;if(Nr>264){var Br=xr.q[Nr-257];Ur=dr+(Br>>>3)+fr(er,hr,Br&7),hr+=Br&7}var Wr=gr[wr(er,hr)&ur];hr+=Wr&15;var Xr=Wr>>>4,Yr=xr.c[Xr],Qi=(Yr>>>4)+mr(er,hr,Yr&15);for(hr+=Yr&15;dr<Ur;)tr[dr]=tr[dr++-Qi],tr[dr]=tr[dr++-Qi],tr[dr]=tr[dr++-Qi],tr[dr]=tr[dr++-Qi];dr=Ur}}}return tr.length==dr?tr:tr.slice(0,dr)},rr.H.W=function(er,tr){var ir=er.length;if(tr<=ir)return er;var nr=new Uint8Array(ir<<1);return nr.set(er,0),nr},rr.H.R=function(er,tr,ir,nr,sr,ar){for(var or=rr.H.e,lr=rr.H.Z,cr=0;cr<ir;){var ur=er[lr(nr,sr)&tr];sr+=ur&15;var dr=ur>>>4;if(dr<=15)ar[cr]=dr,cr++;else{var hr=0,pr=0;dr==16?(pr=3+or(nr,sr,2),sr+=2,hr=ar[cr-1]):dr==17?(pr=3+or(nr,sr,3),sr+=3):dr==18&&(pr=11+or(nr,sr,7),sr+=7);for(var gr=cr+pr;cr<gr;)ar[cr]=hr,cr++}}return sr},rr.H.V=function(er,tr,ir,nr){for(var sr=0,ar=0,or=nr.length>>>1;ar<ir;){var lr=er[ar+tr];nr[ar<<1]=0,nr[(ar<<1)+1]=lr,lr>sr&&(sr=lr),ar++}for(;ar<or;)nr[ar<<1]=0,nr[(ar<<1)+1]=0,ar++;return sr},rr.H.n=function(er,tr){for(var ir=rr.H.m,nr=er.length,sr,ar,or,lr,cr,ur=ir.j,lr=0;lr<=tr;lr++)ur[lr]=0;for(lr=1;lr<nr;lr+=2)ur[er[lr]]++;var dr=ir.K;for(sr=0,ur[0]=0,ar=1;ar<=tr;ar++)sr=sr+ur[ar-1]<<1,dr[ar]=sr;for(or=0;or<nr;or+=2)cr=er[or+1],cr!=0&&(er[or]=dr[cr],dr[cr]++)},rr.H.A=function(er,tr,ir){for(var nr=er.length,sr=rr.H.m,ar=sr.r,or=0;or<nr;or+=2)if(er[or+1]!=0)for(var lr=or>>1,cr=er[or+1],ur=lr<<4|cr,dr=tr-cr,hr=er[or]<<dr,pr=hr+(1<<dr);hr!=pr;){var gr=ar[hr]>>>15-tr;ir[gr]=ur,hr++}},rr.H.l=function(er,tr){for(var ir=rr.H.m.r,nr=15-tr,sr=0;sr<er.length;sr+=2){var ar=er[sr]<<tr-er[sr+1];er[sr]=ir[ar]>>>nr}},rr.H.M=function(er,tr,ir){ir=ir<<(tr&7);var nr=tr>>>3;er[nr]|=ir,er[nr+1]|=ir>>>8},rr.H.I=function(er,tr,ir){ir=ir<<(tr&7);var nr=tr>>>3;er[nr]|=ir,er[nr+1]|=ir>>>8,er[nr+2]|=ir>>>16},rr.H.e=function(er,tr,ir){return(er[tr>>>3]|er[(tr>>>3)+1]<<8)>>>(tr&7)&(1<<ir)-1},rr.H.b=function(er,tr,ir){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)&(1<<ir)-1},rr.H.Z=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)},rr.H.i=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16|er[(tr>>>3)+3]<<24)>>>(tr&7)},rr.H.m=function(){var er=Uint16Array,tr=Uint32Array;return{K:new er(16),j:new er(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new er(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new tr(32),J:new er(512),_:[],h:new er(32),$:[],w:new er(32768),C:[],v:[],d:new er(32768),D:[],u:new er(512),Q:[],r:new er(32768),s:new tr(286),Y:new tr(30),a:new tr(19),t:new tr(15e3),k:new er(65536),g:new er(32768)}}(),function(){for(var er=rr.H.m,tr=32768,ir=0;ir<tr;ir++){var nr=ir;nr=(nr&2863311530)>>>1|(nr&1431655765)<<1,nr=(nr&3435973836)>>>2|(nr&858993459)<<2,nr=(nr&4042322160)>>>4|(nr&252645135)<<4,nr=(nr&4278255360)>>>8|(nr&16711935)<<8,er.r[ir]=(nr>>>16|nr<<16)>>>17}function sr(ar,or,lr){for(;or--!=0;)ar.push(0,lr)}for(var ir=0;ir<32;ir++)er.q[ir]=er.S[ir]<<3|er.T[ir],er.c[ir]=er.p[ir]<<4|er.z[ir];sr(er._,144,8),sr(er._,112,9),sr(er._,24,7),sr(er._,8,8),rr.H.n(er._,9),rr.H.A(er._,9,er.J),rr.H.l(er._,9),sr(er.$,32,5),rr.H.n(er.$,5),rr.H.A(er.$,5,er.h),rr.H.l(er.$,5),sr(er.Q,19,0),sr(er.C,286,0),sr(er.D,30,0),sr(er.v,320,0)}(),rr.H.N}();UPNG.decode._readInterlace=function(rr,er){for(var tr=er.width,ir=er.height,nr=UPNG.decode._getBPP(er),sr=nr>>3,ar=Math.ceil(tr*nr/8),or=new Uint8Array(ir*ar),lr=0,cr=[0,0,4,0,2,0,1],ur=[0,4,0,2,0,1,0],dr=[8,8,8,4,4,2,2],hr=[8,8,4,4,2,2,1],pr=0;pr<7;){for(var gr=dr[pr],vr=hr[pr],mr=0,fr=0,_r=cr[pr];_r<ir;)_r+=gr,fr++;for(var Ar=ur[pr];Ar<tr;)Ar+=vr,mr++;var yr=Math.ceil(mr*nr/8);UPNG.decode._filterZero(rr,er,lr,mr,fr);for(var wr=0,xr=cr[pr],Sr;xr<ir;){for(var br=ur[pr],Cr=lr+wr*yr<<3;br<tr;){if(nr==1&&(Sr=rr[Cr>>3],Sr=Sr>>7-(Cr&7)&1,or[xr*ar+(br>>3)]|=Sr<<7-((br&7)<<0)),nr==2&&(Sr=rr[Cr>>3],Sr=Sr>>6-(Cr&7)&3,or[xr*ar+(br>>2)]|=Sr<<6-((br&3)<<1)),nr==4&&(Sr=rr[Cr>>3],Sr=Sr>>4-(Cr&7)&15,or[xr*ar+(br>>1)]|=Sr<<4-((br&1)<<2)),nr>=8)for(var Ir=xr*ar+br*sr,Rr=0;Rr<sr;Rr++)or[Ir+Rr]=rr[(Cr>>3)+Rr];Cr+=nr,br+=vr}wr++,xr+=gr}mr*fr!=0&&(lr+=fr*(1+yr)),pr=pr+1}return or};UPNG.decode._getBPP=function(rr){var er=[1,null,3,1,2,null,4][rr.ctype];return er*rr.depth};UPNG.decode._filterZero=function(rr,er,tr,ir,nr){var sr=UPNG.decode._getBPP(er),ar=Math.ceil(ir*sr/8),or=UPNG.decode._paeth;sr=Math.ceil(sr/8);var lr,cr,ur=rr[tr],dr=0;if(ur>1&&(rr[tr]=[0,0,1][ur-2]),ur==3)for(dr=sr;dr<ar;dr++)rr[dr+1]=rr[dr+1]+(rr[dr+1-sr]>>>1)&255;for(var hr=0;hr<nr;hr++)if(lr=tr+hr*ar,cr=lr+hr+1,ur=rr[cr-1],dr=0,ur==0)for(;dr<ar;dr++)rr[lr+dr]=rr[cr+dr];else if(ur==1){for(;dr<sr;dr++)rr[lr+dr]=rr[cr+dr];for(;dr<ar;dr++)rr[lr+dr]=rr[cr+dr]+rr[lr+dr-sr]}else if(ur==2)for(;dr<ar;dr++)rr[lr+dr]=rr[cr+dr]+rr[lr+dr-ar];else if(ur==3){for(;dr<sr;dr++)rr[lr+dr]=rr[cr+dr]+(rr[lr+dr-ar]>>>1);for(;dr<ar;dr++)rr[lr+dr]=rr[cr+dr]+(rr[lr+dr-ar]+rr[lr+dr-sr]>>>1)}else{for(;dr<sr;dr++)rr[lr+dr]=rr[cr+dr]+or(0,rr[lr+dr-ar],0);for(;dr<ar;dr++)rr[lr+dr]=rr[cr+dr]+or(rr[lr+dr-sr],rr[lr+dr-ar],rr[lr+dr-sr-ar])}return rr};UPNG.decode._paeth=function(rr,er,tr){var ir=rr+er-tr,nr=ir-rr,sr=ir-er,ar=ir-tr;return nr*nr<=sr*sr&&nr*nr<=ar*ar?rr:sr*sr<=ar*ar?er:tr};UPNG.decode._IHDR=function(rr,er,tr){var ir=UPNG._bin;tr.width=ir.readUint(rr,er),er+=4,tr.height=ir.readUint(rr,er),er+=4,tr.depth=rr[er],er++,tr.ctype=rr[er],er++,tr.compress=rr[er],er++,tr.filter=rr[er],er++,tr.interlace=rr[er],er++};UPNG._bin={nextZero:function(rr,er){for(;rr[er]!=0;)er++;return er},readUshort:function(rr,er){return rr[er]<<8|rr[er+1]},writeUshort:function(rr,er,tr){rr[er]=tr>>8&255,rr[er+1]=tr&255},readUint:function(rr,er){return rr[er]*(256*256*256)+(rr[er+1]<<16|rr[er+2]<<8|rr[er+3])},writeUint:function(rr,er,tr){rr[er]=tr>>24&255,rr[er+1]=tr>>16&255,rr[er+2]=tr>>8&255,rr[er+3]=tr&255},readASCII:function(rr,er,tr){for(var ir="",nr=0;nr<tr;nr++)ir+=String.fromCharCode(rr[er+nr]);return ir},writeASCII:function(rr,er,tr){for(var ir=0;ir<tr.length;ir++)rr[er+ir]=tr.charCodeAt(ir)},readBytes:function(rr,er,tr){for(var ir=[],nr=0;nr<tr;nr++)ir.push(rr[er+nr]);return ir},pad:function(rr){return rr.length<2?"0"+rr:rr},readUTF8:function(rr,er,tr){for(var ir="",nr,sr=0;sr<tr;sr++)ir+="%"+UPNG._bin.pad(rr[er+sr].toString(16));try{nr=decodeURIComponent(ir)}catch{return UPNG._bin.readASCII(rr,er,tr)}return nr}};UPNG._copyTile=function(rr,er,tr,ir,nr,sr,ar,or,lr){for(var cr=Math.min(er,nr),ur=Math.min(tr,sr),dr=0,hr=0,pr=0;pr<ur;pr++)for(var gr=0;gr<cr;gr++)if(ar>=0&&or>=0?(dr=pr*er+gr<<2,hr=(or+pr)*nr+ar+gr<<2):(dr=(-or+pr)*er-ar+gr<<2,hr=pr*nr+gr<<2),lr==0)ir[hr]=rr[dr],ir[hr+1]=rr[dr+1],ir[hr+2]=rr[dr+2],ir[hr+3]=rr[dr+3];else if(lr==1){var vr=rr[dr+3]*.00392156862745098,mr=rr[dr]*vr,fr=rr[dr+1]*vr,_r=rr[dr+2]*vr,Ar=ir[hr+3]*(1/255),yr=ir[hr]*Ar,wr=ir[hr+1]*Ar,xr=ir[hr+2]*Ar,Sr=1-vr,br=vr+Ar*Sr,Cr=br==0?0:1/br;ir[hr+3]=255*br,ir[hr+0]=(mr+yr*Sr)*Cr,ir[hr+1]=(fr+wr*Sr)*Cr,ir[hr+2]=(_r+xr*Sr)*Cr}else if(lr==2){var vr=rr[dr+3],mr=rr[dr],fr=rr[dr+1],_r=rr[dr+2],Ar=ir[hr+3],yr=ir[hr],wr=ir[hr+1],xr=ir[hr+2];vr==Ar&&mr==yr&&fr==wr&&_r==xr?(ir[hr]=0,ir[hr+1]=0,ir[hr+2]=0,ir[hr+3]=0):(ir[hr]=mr,ir[hr+1]=fr,ir[hr+2]=_r,ir[hr+3]=vr)}else if(lr==3){var vr=rr[dr+3],mr=rr[dr],fr=rr[dr+1],_r=rr[dr+2],Ar=ir[hr+3],yr=ir[hr],wr=ir[hr+1],xr=ir[hr+2];if(vr==Ar&&mr==yr&&fr==wr&&_r==xr)continue;if(vr<220&&Ar>20)return!1}return!0};class STLLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(cr){const ur=new DataView(cr),dr=32/8*3+32/8*3*3+16/8,hr=ur.getUint32(80,!0);if(80+32/8+hr*dr===ur.byteLength)return!0;const gr=[115,111,108,105,100];for(let vr=0;vr<5;vr++)if(ir(gr,ur,vr))return!1;return!0}function ir(cr,ur,dr){for(let hr=0,pr=cr.length;hr<pr;hr++)if(cr[hr]!==ur.getUint8(dr+hr))return!1;return!0}function nr(cr){const ur=new DataView(cr),dr=ur.getUint32(80,!0);let hr,pr,gr,vr=!1,mr,fr,_r,Ar,yr;for(let Rr=0;Rr<70;Rr++)ur.getUint32(Rr,!1)==1129270351&&ur.getUint8(Rr+4)==82&&ur.getUint8(Rr+5)==61&&(vr=!0,mr=new Float32Array(dr*3*3),fr=ur.getUint8(Rr+6)/255,_r=ur.getUint8(Rr+7)/255,Ar=ur.getUint8(Rr+8)/255,yr=ur.getUint8(Rr+9)/255);const wr=84,xr=12*4+2,Sr=new BufferGeometry,br=new Float32Array(dr*3*3),Cr=new Float32Array(dr*3*3),Ir=new Color;for(let Rr=0;Rr<dr;Rr++){const Pr=wr+Rr*xr,Dr=ur.getFloat32(Pr,!0),Fr=ur.getFloat32(Pr+4,!0),Or=ur.getFloat32(Pr+8,!0);if(vr){const Nr=ur.getUint16(Pr+48,!0);Nr&32768?(hr=fr,pr=_r,gr=Ar):(hr=(Nr&31)/31,pr=(Nr>>5&31)/31,gr=(Nr>>10&31)/31)}for(let Nr=1;Nr<=3;Nr++){const Ur=Pr+Nr*12,Br=Rr*3*3+(Nr-1)*3;br[Br]=ur.getFloat32(Ur,!0),br[Br+1]=ur.getFloat32(Ur+4,!0),br[Br+2]=ur.getFloat32(Ur+8,!0),Cr[Br]=Dr,Cr[Br+1]=Fr,Cr[Br+2]=Or,vr&&(Ir.setRGB(hr,pr,gr,SRGBColorSpace),mr[Br]=Ir.r,mr[Br+1]=Ir.g,mr[Br+2]=Ir.b)}}return Sr.setAttribute("position",new BufferAttribute(br,3)),Sr.setAttribute("normal",new BufferAttribute(Cr,3)),vr&&(Sr.setAttribute("color",new BufferAttribute(mr,3)),Sr.hasColors=!0,Sr.alpha=yr),Sr}function sr(cr){const ur=new BufferGeometry,dr=/solid([\s\S]*?)endsolid/g,hr=/facet([\s\S]*?)endfacet/g,pr=/solid\s(.+)/;let gr=0;const vr=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,mr=new RegExp("vertex"+vr+vr+vr,"g"),fr=new RegExp("normal"+vr+vr+vr,"g"),_r=[],Ar=[],yr=[],wr=new Vector3$1;let xr,Sr=0,br=0,Cr=0;for(;(xr=dr.exec(cr))!==null;){br=Cr;const Ir=xr[0],Rr=(xr=pr.exec(Ir))!==null?xr[1]:"";for(yr.push(Rr);(xr=hr.exec(Ir))!==null;){let Fr=0,Or=0;const Nr=xr[0];for(;(xr=fr.exec(Nr))!==null;)wr.x=parseFloat(xr[1]),wr.y=parseFloat(xr[2]),wr.z=parseFloat(xr[3]),Or++;for(;(xr=mr.exec(Nr))!==null;)_r.push(parseFloat(xr[1]),parseFloat(xr[2]),parseFloat(xr[3])),Ar.push(wr.x,wr.y,wr.z),Fr++,Cr++;Or!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+gr),Fr!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+gr),gr++}const Pr=br,Dr=Cr-br;ur.userData.groupNames=yr,ur.addGroup(Pr,Dr,Sr),Sr++}return ur.setAttribute("position",new Float32BufferAttribute(_r,3)),ur.setAttribute("normal",new Float32BufferAttribute(Ar,3)),ur}function ar(cr){return typeof cr!="string"?new TextDecoder().decode(cr):cr}function or(cr){if(typeof cr=="string"){const ur=new Uint8Array(cr.length);for(let dr=0;dr<cr.length;dr++)ur[dr]=cr.charCodeAt(dr)&255;return ur.buffer||ur}else return cr}const lr=or(er);return tr(lr)?nr(lr):sr(ar(er))}}const COLOR_SPACE_SVG=SRGBColorSpace;class SVGLoader extends Loader{constructor(er){super(er),this.defaultDPI=90,this.defaultUnit="px"}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=this;function ir(Kr,$r){if(Kr.nodeType!==1)return;const Vr=yr(Kr);let Gr=!1,qr=null;switch(Kr.nodeName){case"svg":$r=gr(Kr,$r);break;case"style":sr(Kr);break;case"g":$r=gr(Kr,$r);break;case"path":$r=gr(Kr,$r),Kr.hasAttribute("d")&&(qr=nr(Kr));break;case"rect":$r=gr(Kr,$r),qr=lr(Kr);break;case"polygon":$r=gr(Kr,$r),qr=cr(Kr);break;case"polyline":$r=gr(Kr,$r),qr=ur(Kr);break;case"circle":$r=gr(Kr,$r),qr=dr(Kr);break;case"ellipse":$r=gr(Kr,$r),qr=hr(Kr);break;case"line":$r=gr(Kr,$r),qr=pr(Kr);break;case"defs":Gr=!0;break;case"use":$r=gr(Kr,$r);const Ji=(Kr.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),Ki=Kr.viewportElement.getElementById(Ji);Ki?ir(Ki,$r):console.warn("SVGLoader: 'use node' references non-existent node id: "+Ji);break;default:}qr&&($r.fill!==void 0&&$r.fill!=="none"&&qr.color.setStyle($r.fill,COLOR_SPACE_SVG),xr(qr,Yr),Pr.push(qr),qr.userData={node:Kr,style:$r});const ji=Kr.childNodes;for(let Jr=0;Jr<ji.length;Jr++){const Ji=ji[Jr];Gr&&Ji.nodeName!=="style"&&Ji.nodeName!=="defs"||ir(Ji,$r)}Vr&&(Fr.pop(),Fr.length>0?Yr.copy(Fr[Fr.length-1]):Yr.identity())}function nr(Kr){const $r=new ShapePath,Vr=new Vector2,Gr=new Vector2,qr=new Vector2;let ji=!0,Jr=!1;const Ji=Kr.getAttribute("d");if(Ji===""||Ji==="none")return null;const Ki=Ji.match(/[a-df-z][^a-df-z]*/ig);for(let Zi=0,Zr=Ki.length;Zi<Zr;Zi++){const is=Ki[Zi],os=is.charAt(0),cs=is.slice(1).trim();ji===!0&&(Jr=!0,ji=!1);let ss;switch(os){case"M":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2)Vr.x=ss[es+0],Vr.y=ss[es+1],Gr.x=Vr.x,Gr.y=Vr.y,es===0?$r.moveTo(Vr.x,Vr.y):$r.lineTo(Vr.x,Vr.y),es===0&&qr.copy(Vr);break;case"H":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es++)Vr.x=ss[es],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"V":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es++)Vr.y=ss[es],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"L":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2)Vr.x=ss[es+0],Vr.y=ss[es+1],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"C":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=6)$r.bezierCurveTo(ss[es+0],ss[es+1],ss[es+2],ss[es+3],ss[es+4],ss[es+5]),Gr.x=ss[es+2],Gr.y=ss[es+3],Vr.x=ss[es+4],Vr.y=ss[es+5],es===0&&Jr===!0&&qr.copy(Vr);break;case"S":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=4)$r.bezierCurveTo(vr(Vr.x,Gr.x),vr(Vr.y,Gr.y),ss[es+0],ss[es+1],ss[es+2],ss[es+3]),Gr.x=ss[es+0],Gr.y=ss[es+1],Vr.x=ss[es+2],Vr.y=ss[es+3],es===0&&Jr===!0&&qr.copy(Vr);break;case"Q":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=4)$r.quadraticCurveTo(ss[es+0],ss[es+1],ss[es+2],ss[es+3]),Gr.x=ss[es+0],Gr.y=ss[es+1],Vr.x=ss[es+2],Vr.y=ss[es+3],es===0&&Jr===!0&&qr.copy(Vr);break;case"T":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2){const Yi=vr(Vr.x,Gr.x),Gi=vr(Vr.y,Gr.y);$r.quadraticCurveTo(Yi,Gi,ss[es+0],ss[es+1]),Gr.x=Yi,Gr.y=Gi,Vr.x=ss[es+0],Vr.y=ss[es+1],es===0&&Jr===!0&&qr.copy(Vr)}break;case"A":ss=mr(cs,[3,4],7);for(let es=0,ms=ss.length;es<ms;es+=7){if(ss[es+5]==Vr.x&&ss[es+6]==Vr.y)continue;const Yi=Vr.clone();Vr.x=ss[es+5],Vr.y=ss[es+6],Gr.x=Vr.x,Gr.y=Vr.y,ar($r,ss[es],ss[es+1],ss[es+2],ss[es+3],ss[es+4],Yi,Vr),es===0&&Jr===!0&&qr.copy(Vr)}break;case"m":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2)Vr.x+=ss[es+0],Vr.y+=ss[es+1],Gr.x=Vr.x,Gr.y=Vr.y,es===0?$r.moveTo(Vr.x,Vr.y):$r.lineTo(Vr.x,Vr.y),es===0&&qr.copy(Vr);break;case"h":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es++)Vr.x+=ss[es],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"v":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es++)Vr.y+=ss[es],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"l":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2)Vr.x+=ss[es+0],Vr.y+=ss[es+1],Gr.x=Vr.x,Gr.y=Vr.y,$r.lineTo(Vr.x,Vr.y),es===0&&Jr===!0&&qr.copy(Vr);break;case"c":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=6)$r.bezierCurveTo(Vr.x+ss[es+0],Vr.y+ss[es+1],Vr.x+ss[es+2],Vr.y+ss[es+3],Vr.x+ss[es+4],Vr.y+ss[es+5]),Gr.x=Vr.x+ss[es+2],Gr.y=Vr.y+ss[es+3],Vr.x+=ss[es+4],Vr.y+=ss[es+5],es===0&&Jr===!0&&qr.copy(Vr);break;case"s":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=4)$r.bezierCurveTo(vr(Vr.x,Gr.x),vr(Vr.y,Gr.y),Vr.x+ss[es+0],Vr.y+ss[es+1],Vr.x+ss[es+2],Vr.y+ss[es+3]),Gr.x=Vr.x+ss[es+0],Gr.y=Vr.y+ss[es+1],Vr.x+=ss[es+2],Vr.y+=ss[es+3],es===0&&Jr===!0&&qr.copy(Vr);break;case"q":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=4)$r.quadraticCurveTo(Vr.x+ss[es+0],Vr.y+ss[es+1],Vr.x+ss[es+2],Vr.y+ss[es+3]),Gr.x=Vr.x+ss[es+0],Gr.y=Vr.y+ss[es+1],Vr.x+=ss[es+2],Vr.y+=ss[es+3],es===0&&Jr===!0&&qr.copy(Vr);break;case"t":ss=mr(cs);for(let es=0,ms=ss.length;es<ms;es+=2){const Yi=vr(Vr.x,Gr.x),Gi=vr(Vr.y,Gr.y);$r.quadraticCurveTo(Yi,Gi,Vr.x+ss[es+0],Vr.y+ss[es+1]),Gr.x=Yi,Gr.y=Gi,Vr.x=Vr.x+ss[es+0],Vr.y=Vr.y+ss[es+1],es===0&&Jr===!0&&qr.copy(Vr)}break;case"a":ss=mr(cs,[3,4],7);for(let es=0,ms=ss.length;es<ms;es+=7){if(ss[es+5]==0&&ss[es+6]==0)continue;const Yi=Vr.clone();Vr.x+=ss[es+5],Vr.y+=ss[es+6],Gr.x=Vr.x,Gr.y=Vr.y,ar($r,ss[es],ss[es+1],ss[es+2],ss[es+3],ss[es+4],Yi,Vr),es===0&&Jr===!0&&qr.copy(Vr)}break;case"Z":case"z":$r.currentPath.autoClose=!0,$r.currentPath.curves.length>0&&(Vr.copy(qr),$r.currentPath.currentPoint.copy(Vr),ji=!0);break;default:console.warn(is)}Jr=!1}return $r}function sr(Kr){if(!(!Kr.sheet||!Kr.sheet.cssRules||!Kr.sheet.cssRules.length))for(let $r=0;$r<Kr.sheet.cssRules.length;$r++){const Vr=Kr.sheet.cssRules[$r];if(Vr.type!==1)continue;const Gr=Vr.selectorText.split(/,/gm).filter(Boolean).map(qr=>qr.trim());for(let qr=0;qr<Gr.length;qr++){const ji=Object.fromEntries(Object.entries(Vr.style).filter(([,Jr])=>Jr!==""));Dr[Gr[qr]]=Object.assign(Dr[Gr[qr]]||{},ji)}}}function ar(Kr,$r,Vr,Gr,qr,ji,Jr,Ji){if($r==0||Vr==0){Kr.lineTo(Ji.x,Ji.y);return}Gr=Gr*Math.PI/180,$r=Math.abs($r),Vr=Math.abs(Vr);const Ki=(Jr.x-Ji.x)/2,Zi=(Jr.y-Ji.y)/2,Zr=Math.cos(Gr)*Ki+Math.sin(Gr)*Zi,is=-Math.sin(Gr)*Ki+Math.cos(Gr)*Zi;let os=$r*$r,cs=Vr*Vr;const ss=Zr*Zr,es=is*is,ms=ss/os+es/cs;if(ms>1){const _s=Math.sqrt(ms);$r=_s*$r,Vr=_s*Vr,os=$r*$r,cs=Vr*Vr}const Yi=os*es+cs*ss,Gi=(os*cs-Yi)/Yi;let Ni=Math.sqrt(Math.max(0,Gi));qr===ji&&(Ni=-Ni);const Ri=Ni*$r*is/Vr,qi=-Ni*Vr*Zr/$r,as=Math.cos(Gr)*Ri-Math.sin(Gr)*qi+(Jr.x+Ji.x)/2,us=Math.sin(Gr)*Ri+Math.cos(Gr)*qi+(Jr.y+Ji.y)/2,gs=or(1,0,(Zr-Ri)/$r,(is-qi)/Vr),vs=or((Zr-Ri)/$r,(is-qi)/Vr,(-Zr-Ri)/$r,(-is-qi)/Vr)%(Math.PI*2);Kr.currentPath.absellipse(as,us,$r,Vr,gs,gs+vs,ji===0,Gr)}function or(Kr,$r,Vr,Gr){const qr=Kr*Vr+$r*Gr,ji=Math.sqrt(Kr*Kr+$r*$r)*Math.sqrt(Vr*Vr+Gr*Gr);let Jr=Math.acos(Math.max(-1,Math.min(1,qr/ji)));return Kr*Gr-$r*Vr<0&&(Jr=-Jr),Jr}function lr(Kr){const $r=Ar(Kr.getAttribute("x")||0),Vr=Ar(Kr.getAttribute("y")||0),Gr=Ar(Kr.getAttribute("rx")||Kr.getAttribute("ry")||0),qr=Ar(Kr.getAttribute("ry")||Kr.getAttribute("rx")||0),ji=Ar(Kr.getAttribute("width")),Jr=Ar(Kr.getAttribute("height")),Ji=1-.551915024494,Ki=new ShapePath;return Ki.moveTo($r+Gr,Vr),Ki.lineTo($r+ji-Gr,Vr),(Gr!==0||qr!==0)&&Ki.bezierCurveTo($r+ji-Gr*Ji,Vr,$r+ji,Vr+qr*Ji,$r+ji,Vr+qr),Ki.lineTo($r+ji,Vr+Jr-qr),(Gr!==0||qr!==0)&&Ki.bezierCurveTo($r+ji,Vr+Jr-qr*Ji,$r+ji-Gr*Ji,Vr+Jr,$r+ji-Gr,Vr+Jr),Ki.lineTo($r+Gr,Vr+Jr),(Gr!==0||qr!==0)&&Ki.bezierCurveTo($r+Gr*Ji,Vr+Jr,$r,Vr+Jr-qr*Ji,$r,Vr+Jr-qr),Ki.lineTo($r,Vr+qr),(Gr!==0||qr!==0)&&Ki.bezierCurveTo($r,Vr+qr*Ji,$r+Gr*Ji,Vr,$r+Gr,Vr),Ki}function cr(Kr){function $r(ji,Jr,Ji){const Ki=Ar(Jr),Zi=Ar(Ji);qr===0?Gr.moveTo(Ki,Zi):Gr.lineTo(Ki,Zi),qr++}const Vr=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Gr=new ShapePath;let qr=0;return Kr.getAttribute("points").replace(Vr,$r),Gr.currentPath.autoClose=!0,Gr}function ur(Kr){function $r(ji,Jr,Ji){const Ki=Ar(Jr),Zi=Ar(Ji);qr===0?Gr.moveTo(Ki,Zi):Gr.lineTo(Ki,Zi),qr++}const Vr=/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,Gr=new ShapePath;let qr=0;return Kr.getAttribute("points").replace(Vr,$r),Gr.currentPath.autoClose=!1,Gr}function dr(Kr){const $r=Ar(Kr.getAttribute("cx")||0),Vr=Ar(Kr.getAttribute("cy")||0),Gr=Ar(Kr.getAttribute("r")||0),qr=new Path$1;qr.absarc($r,Vr,Gr,0,Math.PI*2);const ji=new ShapePath;return ji.subPaths.push(qr),ji}function hr(Kr){const $r=Ar(Kr.getAttribute("cx")||0),Vr=Ar(Kr.getAttribute("cy")||0),Gr=Ar(Kr.getAttribute("rx")||0),qr=Ar(Kr.getAttribute("ry")||0),ji=new Path$1;ji.absellipse($r,Vr,Gr,qr,0,Math.PI*2);const Jr=new ShapePath;return Jr.subPaths.push(ji),Jr}function pr(Kr){const $r=Ar(Kr.getAttribute("x1")||0),Vr=Ar(Kr.getAttribute("y1")||0),Gr=Ar(Kr.getAttribute("x2")||0),qr=Ar(Kr.getAttribute("y2")||0),ji=new ShapePath;return ji.moveTo($r,Vr),ji.lineTo(Gr,qr),ji.currentPath.autoClose=!1,ji}function gr(Kr,$r){$r=Object.assign({},$r);let Vr={};if(Kr.hasAttribute("class")){const Jr=Kr.getAttribute("class").split(/\s/).filter(Boolean).map(Ji=>Ji.trim());for(let Ji=0;Ji<Jr.length;Ji++)Vr=Object.assign(Vr,Dr["."+Jr[Ji]])}Kr.hasAttribute("id")&&(Vr=Object.assign(Vr,Dr["#"+Kr.getAttribute("id")]));function Gr(Jr,Ji,Ki){Ki===void 0&&(Ki=function(Zr){return Zr.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),Zr}),Kr.hasAttribute(Jr)&&($r[Ji]=Ki(Kr.getAttribute(Jr))),Vr[Jr]&&($r[Ji]=Ki(Vr[Jr])),Kr.style&&Kr.style[Jr]!==""&&($r[Ji]=Ki(Kr.style[Jr]))}function qr(Jr){return Math.max(0,Math.min(1,Ar(Jr)))}function ji(Jr){return Math.max(0,Ar(Jr))}return Gr("fill","fill"),Gr("fill-opacity","fillOpacity",qr),Gr("fill-rule","fillRule"),Gr("opacity","opacity",qr),Gr("stroke","stroke"),Gr("stroke-opacity","strokeOpacity",qr),Gr("stroke-width","strokeWidth",ji),Gr("stroke-linejoin","strokeLineJoin"),Gr("stroke-linecap","strokeLineCap"),Gr("stroke-miterlimit","strokeMiterLimit",ji),Gr("visibility","visibility"),$r}function vr(Kr,$r){return Kr-($r-Kr)}function mr(Kr,$r,Vr){if(typeof Kr!="string")throw new TypeError("Invalid input: "+typeof Kr);const Gr={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},qr=0,ji=1,Jr=2,Ji=3;let Ki=qr,Zi=!0,Zr="",is="";const os=[];function cs(Yi,Gi,Ni){const Ri=new SyntaxError('Unexpected character "'+Yi+'" at index '+Gi+".");throw Ri.partial=Ni,Ri}function ss(){Zr!==""&&(is===""?os.push(Number(Zr)):os.push(Number(Zr)*Math.pow(10,Number(is)))),Zr="",is=""}let es;const ms=Kr.length;for(let Yi=0;Yi<ms;Yi++){if(es=Kr[Yi],Array.isArray($r)&&$r.includes(os.length%Vr)&&Gr.FLAGS.test(es)){Ki=ji,Zr=es,ss();continue}if(Ki===qr){if(Gr.WHITESPACE.test(es))continue;if(Gr.DIGIT.test(es)||Gr.SIGN.test(es)){Ki=ji,Zr=es;continue}if(Gr.POINT.test(es)){Ki=Jr,Zr=es;continue}Gr.COMMA.test(es)&&(Zi&&cs(es,Yi,os),Zi=!0)}if(Ki===ji){if(Gr.DIGIT.test(es)){Zr+=es;continue}if(Gr.POINT.test(es)){Zr+=es,Ki=Jr;continue}if(Gr.EXP.test(es)){Ki=Ji;continue}Gr.SIGN.test(es)&&Zr.length===1&&Gr.SIGN.test(Zr[0])&&cs(es,Yi,os)}if(Ki===Jr){if(Gr.DIGIT.test(es)){Zr+=es;continue}if(Gr.EXP.test(es)){Ki=Ji;continue}Gr.POINT.test(es)&&Zr[Zr.length-1]==="."&&cs(es,Yi,os)}if(Ki===Ji){if(Gr.DIGIT.test(es)){is+=es;continue}if(Gr.SIGN.test(es)){if(is===""){is+=es;continue}is.length===1&&Gr.SIGN.test(is)&&cs(es,Yi,os)}}Gr.WHITESPACE.test(es)?(ss(),Ki=qr,Zi=!1):Gr.COMMA.test(es)?(ss(),Ki=qr,Zi=!0):Gr.SIGN.test(es)?(ss(),Ki=ji,Zr=es):Gr.POINT.test(es)?(ss(),Ki=Jr,Zr=es):cs(es,Yi,os)}return ss(),os}const fr=["mm","cm","in","pt","pc","px"],_r={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:72/6,pc:1,px:-1},px:{px:1}};function Ar(Kr){let $r="px";if(typeof Kr=="string"||Kr instanceof String)for(let Gr=0,qr=fr.length;Gr<qr;Gr++){const ji=fr[Gr];if(Kr.endsWith(ji)){$r=ji,Kr=Kr.substring(0,Kr.length-ji.length);break}}let Vr;return $r==="px"&&tr.defaultUnit!=="px"?Vr=_r.in[tr.defaultUnit]/tr.defaultDPI:(Vr=_r[$r][tr.defaultUnit],Vr<0&&(Vr=_r[$r].in*tr.defaultDPI)),Vr*parseFloat(Kr)}function yr(Kr){if(!(Kr.hasAttribute("transform")||Kr.nodeName==="use"&&(Kr.hasAttribute("x")||Kr.hasAttribute("y"))))return null;const $r=wr(Kr);return Fr.length>0&&$r.premultiply(Fr[Fr.length-1]),Yr.copy($r),Fr.push($r),$r}function wr(Kr){const $r=new Matrix3,Vr=Or;if(Kr.nodeName==="use"&&(Kr.hasAttribute("x")||Kr.hasAttribute("y"))){const Gr=Ar(Kr.getAttribute("x")),qr=Ar(Kr.getAttribute("y"));$r.translate(Gr,qr)}if(Kr.hasAttribute("transform")){const Gr=Kr.getAttribute("transform").split(")");for(let qr=Gr.length-1;qr>=0;qr--){const ji=Gr[qr].trim();if(ji==="")continue;const Jr=ji.indexOf("("),Ji=ji.length;if(Jr>0&&Jr<Ji){const Ki=ji.slice(0,Jr),Zi=mr(ji.slice(Jr+1));switch(Vr.identity(),Ki){case"translate":if(Zi.length>=1){const Zr=Zi[0];let is=0;Zi.length>=2&&(is=Zi[1]),Vr.translate(Zr,is)}break;case"rotate":if(Zi.length>=1){let Zr=0,is=0,os=0;Zr=Zi[0]*Math.PI/180,Zi.length>=3&&(is=Zi[1],os=Zi[2]),Nr.makeTranslation(-is,-os),Ur.makeRotation(Zr),Br.multiplyMatrices(Ur,Nr),Nr.makeTranslation(is,os),Vr.multiplyMatrices(Nr,Br)}break;case"scale":if(Zi.length>=1){const Zr=Zi[0];let is=Zr;Zi.length>=2&&(is=Zi[1]),Vr.scale(Zr,is)}break;case"skewX":Zi.length===1&&Vr.set(1,Math.tan(Zi[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":Zi.length===1&&Vr.set(1,0,0,Math.tan(Zi[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":Zi.length===6&&Vr.set(Zi[0],Zi[2],Zi[4],Zi[1],Zi[3],Zi[5],0,0,1);break}}$r.premultiply(Vr)}}return $r}function xr(Kr,$r){function Vr(Jr){Xr.set(Jr.x,Jr.y,1).applyMatrix3($r),Jr.set(Xr.x,Xr.y)}function Gr(Jr){const Ji=Jr.xRadius,Ki=Jr.yRadius,Zi=Math.cos(Jr.aRotation),Zr=Math.sin(Jr.aRotation),is=new Vector3$1(Ji*Zi,Ji*Zr,0),os=new Vector3$1(-Ki*Zr,Ki*Zi,0),cs=is.applyMatrix3($r),ss=os.applyMatrix3($r),es=Or.set(cs.x,ss.x,0,cs.y,ss.y,0,0,0,1),ms=Nr.copy(es).invert(),Ni=Ur.copy(ms).transpose().multiply(ms).elements,Ri=Rr(Ni[0],Ni[1],Ni[4]),qi=Math.sqrt(Ri.rt1),as=Math.sqrt(Ri.rt2);if(Jr.xRadius=1/qi,Jr.yRadius=1/as,Jr.aRotation=Math.atan2(Ri.sn,Ri.cs),!((Jr.aEndAngle-Jr.aStartAngle)%(2*Math.PI)<Number.EPSILON)){const gs=Nr.set(qi,0,0,0,as,0,0,0,1),vs=Ur.set(Ri.cs,Ri.sn,0,-Ri.sn,Ri.cs,0,0,0,1),_s=gs.multiply(vs).multiply(es),As=xs=>{const{x:Es,y:Ps}=new Vector3$1(Math.cos(xs),Math.sin(xs),0).applyMatrix3(_s);return Math.atan2(Ps,Es)};Jr.aStartAngle=As(Jr.aStartAngle),Jr.aEndAngle=As(Jr.aEndAngle),Sr($r)&&(Jr.aClockwise=!Jr.aClockwise)}}function qr(Jr){const Ji=Cr($r),Ki=Ir($r);Jr.xRadius*=Ji,Jr.yRadius*=Ki;const Zi=Ji>Number.EPSILON?Math.atan2($r.elements[1],$r.elements[0]):Math.atan2(-$r.elements[3],$r.elements[4]);Jr.aRotation+=Zi,Sr($r)&&(Jr.aStartAngle*=-1,Jr.aEndAngle*=-1,Jr.aClockwise=!Jr.aClockwise)}const ji=Kr.subPaths;for(let Jr=0,Ji=ji.length;Jr<Ji;Jr++){const Zi=ji[Jr].curves;for(let Zr=0;Zr<Zi.length;Zr++){const is=Zi[Zr];is.isLineCurve?(Vr(is.v1),Vr(is.v2)):is.isCubicBezierCurve?(Vr(is.v0),Vr(is.v1),Vr(is.v2),Vr(is.v3)):is.isQuadraticBezierCurve?(Vr(is.v0),Vr(is.v1),Vr(is.v2)):is.isEllipseCurve&&(Wr.set(is.aX,is.aY),Vr(Wr),is.aX=Wr.x,is.aY=Wr.y,br($r)?Gr(is):qr(is))}}}function Sr(Kr){const $r=Kr.elements;return $r[0]*$r[4]-$r[1]*$r[3]<0}function br(Kr){const $r=Kr.elements,Vr=$r[0]*$r[3]+$r[1]*$r[4];if(Vr===0)return!1;const Gr=Cr(Kr),qr=Ir(Kr);return Math.abs(Vr/(Gr*qr))>Number.EPSILON}function Cr(Kr){const $r=Kr.elements;return Math.sqrt($r[0]*$r[0]+$r[1]*$r[1])}function Ir(Kr){const $r=Kr.elements;return Math.sqrt($r[3]*$r[3]+$r[4]*$r[4])}function Rr(Kr,$r,Vr){let Gr,qr,ji,Jr,Ji;const Ki=Kr+Vr,Zi=Kr-Vr,Zr=Math.sqrt(Zi*Zi+4*$r*$r);return Ki>0?(Gr=.5*(Ki+Zr),Ji=1/Gr,qr=Kr*Ji*Vr-$r*Ji*$r):Ki<0?qr=.5*(Ki-Zr):(Gr=.5*Zr,qr=-.5*Zr),Zi>0?ji=Zi+Zr:ji=Zi-Zr,Math.abs(ji)>2*Math.abs($r)?(Ji=-2*$r/ji,Jr=1/Math.sqrt(1+Ji*Ji),ji=Ji*Jr):Math.abs($r)===0?(ji=1,Jr=0):(Ji=-.5*ji/$r,ji=1/Math.sqrt(1+Ji*Ji),Jr=Ji*ji),Zi>0&&(Ji=ji,ji=-Jr,Jr=Ji),{rt1:Gr,rt2:qr,cs:ji,sn:Jr}}const Pr=[],Dr={},Fr=[],Or=new Matrix3,Nr=new Matrix3,Ur=new Matrix3,Br=new Matrix3,Wr=new Vector2,Xr=new Vector3$1,Yr=new Matrix3,Qi=new DOMParser().parseFromString(er,"image/svg+xml");return ir(Qi.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:Pr,xml:Qi.documentElement}}static createShapes(er){const ir={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},nr={loc:ir.ORIGIN,t:0};function sr(vr,mr,fr,_r){const Ar=vr.x,yr=mr.x,wr=fr.x,xr=_r.x,Sr=vr.y,br=mr.y,Cr=fr.y,Ir=_r.y,Rr=(xr-wr)*(Sr-Cr)-(Ir-Cr)*(Ar-wr),Pr=(yr-Ar)*(Sr-Cr)-(br-Sr)*(Ar-wr),Dr=(Ir-Cr)*(yr-Ar)-(xr-wr)*(br-Sr),Fr=Rr/Dr,Or=Pr/Dr;if(Dr===0&&Rr!==0||Fr<=0||Fr>=1||Or<0||Or>1)return null;if(Rr===0&&Dr===0){for(let Nr=0;Nr<2;Nr++)if(ar(Nr===0?fr:_r,vr,mr),nr.loc==ir.ORIGIN){const Ur=Nr===0?fr:_r;return{x:Ur.x,y:Ur.y,t:nr.t}}else if(nr.loc==ir.BETWEEN){const Ur=+(Ar+nr.t*(yr-Ar)).toPrecision(10),Br=+(Sr+nr.t*(br-Sr)).toPrecision(10);return{x:Ur,y:Br,t:nr.t}}return null}else{for(let Br=0;Br<2;Br++)if(ar(Br===0?fr:_r,vr,mr),nr.loc==ir.ORIGIN){const Wr=Br===0?fr:_r;return{x:Wr.x,y:Wr.y,t:nr.t}}const Nr=+(Ar+Fr*(yr-Ar)).toPrecision(10),Ur=+(Sr+Fr*(br-Sr)).toPrecision(10);return{x:Nr,y:Ur,t:Fr}}}function ar(vr,mr,fr){const _r=fr.x-mr.x,Ar=fr.y-mr.y,yr=vr.x-mr.x,wr=vr.y-mr.y,xr=_r*wr-yr*Ar;if(vr.x===mr.x&&vr.y===mr.y){nr.loc=ir.ORIGIN,nr.t=0;return}if(vr.x===fr.x&&vr.y===fr.y){nr.loc=ir.DESTINATION,nr.t=1;return}if(xr<-Number.EPSILON){nr.loc=ir.LEFT;return}if(xr>Number.EPSILON){nr.loc=ir.RIGHT;return}if(_r*yr<0||Ar*wr<0){nr.loc=ir.BEHIND;return}if(Math.sqrt(_r*_r+Ar*Ar)<Math.sqrt(yr*yr+wr*wr)){nr.loc=ir.BEYOND;return}let Sr;_r!==0?Sr=yr/_r:Sr=wr/Ar,nr.loc=ir.BETWEEN,nr.t=Sr}function or(vr,mr){const fr=[],_r=[];for(let Ar=1;Ar<vr.length;Ar++){const yr=vr[Ar-1],wr=vr[Ar];for(let xr=1;xr<mr.length;xr++){const Sr=mr[xr-1],br=mr[xr],Cr=sr(yr,wr,Sr,br);Cr!==null&&fr.find(Ir=>Ir.t<=Cr.t+Number.EPSILON&&Ir.t>=Cr.t-Number.EPSILON)===void 0&&(fr.push(Cr),_r.push(new Vector2(Cr.x,Cr.y)))}}return _r}function lr(vr,mr,fr){const _r=new Vector2;mr.getCenter(_r);const Ar=[];return fr.forEach(yr=>{yr.boundingBox.containsPoint(_r)&&or(vr,yr.points).forEach(xr=>{Ar.push({identifier:yr.identifier,isCW:yr.isCW,point:xr})})}),Ar.sort((yr,wr)=>yr.point.x-wr.point.x),Ar}function cr(vr,mr,fr,_r,Ar){(Ar==null||Ar==="")&&(Ar="nonzero");const yr=new Vector2;vr.boundingBox.getCenter(yr);const wr=[new Vector2(fr,yr.y),new Vector2(_r,yr.y)],xr=lr(wr,vr.boundingBox,mr);xr.sort((Pr,Dr)=>Pr.point.x-Dr.point.x);const Sr=[],br=[];xr.forEach(Pr=>{Pr.identifier===vr.identifier?Sr.push(Pr):br.push(Pr)});const Cr=Sr[0].point.x,Ir=[];let Rr=0;for(;Rr<br.length&&br[Rr].point.x<Cr;)Ir.length>0&&Ir[Ir.length-1]===br[Rr].identifier?Ir.pop():Ir.push(br[Rr].identifier),Rr++;if(Ir.push(vr.identifier),Ar==="evenodd"){const Pr=Ir.length%2===0,Dr=Ir[Ir.length-2];return{identifier:vr.identifier,isHole:Pr,for:Dr}}else if(Ar==="nonzero"){let Pr=!0,Dr=null,Fr=null;for(let Or=0;Or<Ir.length;Or++){const Nr=Ir[Or];Pr?(Fr=mr[Nr].isCW,Pr=!1,Dr=Nr):Fr!==mr[Nr].isCW&&(Fr=mr[Nr].isCW,Pr=!0)}return{identifier:vr.identifier,isHole:Pr,for:Dr}}else console.warn('fill-rule: "'+Ar+'" is currently not implemented.')}let ur=999999999,dr=-999999999,hr=er.subPaths.map(vr=>{const mr=vr.getPoints();let fr=-999999999,_r=999999999,Ar=-999999999,yr=999999999;for(let wr=0;wr<mr.length;wr++){const xr=mr[wr];xr.y>fr&&(fr=xr.y),xr.y<_r&&(_r=xr.y),xr.x>Ar&&(Ar=xr.x),xr.x<yr&&(yr=xr.x)}return dr<=Ar&&(dr=Ar+1),ur>=yr&&(ur=yr-1),{curves:vr.curves,points:mr,isCW:ShapeUtils.isClockWise(mr),identifier:-1,boundingBox:new Box2(new Vector2(yr,_r),new Vector2(Ar,fr))}});hr=hr.filter(vr=>vr.points.length>1);for(let vr=0;vr<hr.length;vr++)hr[vr].identifier=vr;const pr=hr.map(vr=>cr(vr,hr,ur,dr,er.userData?er.userData.style.fillRule:void 0)),gr=[];return hr.forEach(vr=>{if(!pr[vr.identifier].isHole){const fr=new Shape$1;fr.curves=vr.curves,pr.filter(Ar=>Ar.isHole&&Ar.for===vr.identifier).forEach(Ar=>{const yr=hr[Ar.identifier],wr=new Path$1;wr.curves=yr.curves,fr.holes.push(wr)}),gr.push(fr)}}),gr}static getStrokeStyle(er,tr,ir,nr,sr){return er=er!==void 0?er:1,tr=tr!==void 0?tr:"#000",ir=ir!==void 0?ir:"miter",nr=nr!==void 0?nr:"butt",sr=sr!==void 0?sr:4,{strokeColor:tr,strokeWidth:er,strokeLineJoin:ir,strokeLineCap:nr,strokeMiterLimit:sr}}static pointsToStroke(er,tr,ir,nr){const sr=[],ar=[],or=[];if(SVGLoader.pointsToStrokeWithBuffers(er,tr,ir,nr,sr,ar,or)===0)return null;const lr=new BufferGeometry;return lr.setAttribute("position",new Float32BufferAttribute(sr,3)),lr.setAttribute("normal",new Float32BufferAttribute(ar,3)),lr.setAttribute("uv",new Float32BufferAttribute(or,2)),lr}static pointsToStrokeWithBuffers(er,tr,ir,nr,sr,ar,or,lr){const cr=new Vector2,ur=new Vector2,dr=new Vector2,hr=new Vector2,pr=new Vector2,gr=new Vector2,vr=new Vector2,mr=new Vector2,fr=new Vector2,_r=new Vector2,Ar=new Vector2,yr=new Vector2,wr=new Vector2,xr=new Vector2,Sr=new Vector2,br=new Vector2,Cr=new Vector2;ir=ir!==void 0?ir:12,nr=nr!==void 0?nr:.001,lr=lr!==void 0?lr:0,er=Zi(er);const Ir=er.length;if(Ir<2)return 0;const Rr=er[0].equals(er[Ir-1]);let Pr,Dr=er[0],Fr;const Or=tr.strokeWidth/2,Nr=1/(Ir-1);let Ur=0,Br,Wr,Xr,Yr,Qi=!1,Xi=0,Kr=lr*3,$r=lr*2;Vr(er[0],er[1],cr).multiplyScalar(Or),mr.copy(er[0]).sub(cr),fr.copy(er[0]).add(cr),_r.copy(mr),Ar.copy(fr);for(let Zr=1;Zr<Ir;Zr++){Pr=er[Zr],Zr===Ir-1?Rr?Fr=er[1]:Fr=void 0:Fr=er[Zr+1];const is=cr;if(Vr(Dr,Pr,is),dr.copy(is).multiplyScalar(Or),yr.copy(Pr).sub(dr),wr.copy(Pr).add(dr),Br=Ur+Nr,Wr=!1,Fr!==void 0){Vr(Pr,Fr,ur),dr.copy(ur).multiplyScalar(Or),xr.copy(Pr).sub(dr),Sr.copy(Pr).add(dr),Xr=!0,dr.subVectors(Fr,Dr),is.dot(dr)<0&&(Xr=!1),Zr===1&&(Qi=Xr),dr.subVectors(Fr,Pr),dr.normalize();const os=Math.abs(is.dot(dr));if(os>Number.EPSILON){const cs=Or/os;dr.multiplyScalar(-cs),hr.subVectors(Pr,Dr),pr.copy(hr).setLength(cs).add(dr),br.copy(pr).negate();const ss=pr.length(),es=hr.length();hr.divideScalar(es),gr.subVectors(Fr,Pr);const ms=gr.length();switch(gr.divideScalar(ms),hr.dot(br)<es&&gr.dot(br)<ms&&(Wr=!0),Cr.copy(pr).add(Pr),br.add(Pr),Yr=!1,Wr?Xr?(Sr.copy(br),wr.copy(br)):(xr.copy(br),yr.copy(br)):ji(),tr.strokeLineJoin){case"bevel":Jr(Xr,Wr,Br);break;case"round":Ji(Xr,Wr),Xr?qr(Pr,yr,xr,Br,0):qr(Pr,Sr,wr,Br,1);break;case"miter":case"miter-clip":default:const Yi=Or*tr.strokeMiterLimit/ss;if(Yi<1)if(tr.strokeLineJoin!=="miter-clip"){Jr(Xr,Wr,Br);break}else Ji(Xr,Wr),Xr?(gr.subVectors(Cr,yr).multiplyScalar(Yi).add(yr),vr.subVectors(Cr,xr).multiplyScalar(Yi).add(xr),Gr(yr,Br,0),Gr(gr,Br,0),Gr(Pr,Br,.5),Gr(Pr,Br,.5),Gr(gr,Br,0),Gr(vr,Br,0),Gr(Pr,Br,.5),Gr(vr,Br,0),Gr(xr,Br,0)):(gr.subVectors(Cr,wr).multiplyScalar(Yi).add(wr),vr.subVectors(Cr,Sr).multiplyScalar(Yi).add(Sr),Gr(wr,Br,1),Gr(gr,Br,1),Gr(Pr,Br,.5),Gr(Pr,Br,.5),Gr(gr,Br,1),Gr(vr,Br,1),Gr(Pr,Br,.5),Gr(vr,Br,1),Gr(Sr,Br,1));else Wr?(Xr?(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(Cr,Br,0),Gr(fr,Ur,1),Gr(Cr,Br,0),Gr(br,Br,1)):(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(Cr,Br,1),Gr(mr,Ur,0),Gr(br,Br,0),Gr(Cr,Br,1)),Xr?xr.copy(Cr):Sr.copy(Cr)):Xr?(Gr(yr,Br,0),Gr(Cr,Br,0),Gr(Pr,Br,.5),Gr(Pr,Br,.5),Gr(Cr,Br,0),Gr(xr,Br,0)):(Gr(wr,Br,1),Gr(Cr,Br,1),Gr(Pr,Br,.5),Gr(Pr,Br,.5),Gr(Cr,Br,1),Gr(Sr,Br,1)),Yr=!0;break}}else ji()}else ji();!Rr&&Zr===Ir-1&&Ki(er[0],_r,Ar,Xr,!0,Ur),Ur=Br,Dr=Pr,mr.copy(xr),fr.copy(Sr)}if(!Rr)Ki(Pr,yr,wr,Xr,!1,Br);else if(Wr&&sr){let Zr=Cr,is=br;Qi!==Xr&&(Zr=br,is=Cr),Xr?(Yr||Qi)&&(is.toArray(sr,0*3),is.toArray(sr,3*3),Yr&&Zr.toArray(sr,1*3)):(Yr||!Qi)&&(is.toArray(sr,1*3),is.toArray(sr,3*3),Yr&&Zr.toArray(sr,0*3))}return Xi;function Vr(Zr,is,os){return os.subVectors(is,Zr),os.set(-os.y,os.x).normalize()}function Gr(Zr,is,os){sr&&(sr[Kr]=Zr.x,sr[Kr+1]=Zr.y,sr[Kr+2]=0,ar&&(ar[Kr]=0,ar[Kr+1]=0,ar[Kr+2]=1),Kr+=3,or&&(or[$r]=is,or[$r+1]=os,$r+=2)),Xi+=3}function qr(Zr,is,os,cs,ss){cr.copy(is).sub(Zr).normalize(),ur.copy(os).sub(Zr).normalize();let es=Math.PI;const ms=cr.dot(ur);Math.abs(ms)<1&&(es=Math.abs(Math.acos(ms))),es/=ir,dr.copy(is);for(let Yi=0,Gi=ir-1;Yi<Gi;Yi++)hr.copy(dr).rotateAround(Zr,es),Gr(dr,cs,ss),Gr(hr,cs,ss),Gr(Zr,cs,.5),dr.copy(hr);Gr(hr,cs,ss),Gr(os,cs,ss),Gr(Zr,cs,.5)}function ji(){Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(yr,Br,0),Gr(fr,Ur,1),Gr(yr,Br,0),Gr(wr,Br,1)}function Jr(Zr,is,os){is?Zr?(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(yr,Br,0),Gr(fr,Ur,1),Gr(yr,Br,0),Gr(br,Br,1),Gr(yr,os,0),Gr(xr,os,0),Gr(br,os,.5)):(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(wr,Br,1),Gr(mr,Ur,0),Gr(br,Br,0),Gr(wr,Br,1),Gr(wr,os,1),Gr(br,os,0),Gr(Sr,os,1)):Zr?(Gr(yr,os,0),Gr(xr,os,0),Gr(Pr,os,.5)):(Gr(wr,os,1),Gr(Sr,os,0),Gr(Pr,os,.5))}function Ji(Zr,is){is&&(Zr?(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(yr,Br,0),Gr(fr,Ur,1),Gr(yr,Br,0),Gr(br,Br,1),Gr(yr,Ur,0),Gr(Pr,Br,.5),Gr(br,Br,1),Gr(Pr,Br,.5),Gr(xr,Ur,0),Gr(br,Br,1)):(Gr(fr,Ur,1),Gr(mr,Ur,0),Gr(wr,Br,1),Gr(mr,Ur,0),Gr(br,Br,0),Gr(wr,Br,1),Gr(wr,Ur,1),Gr(br,Br,0),Gr(Pr,Br,.5),Gr(Pr,Br,.5),Gr(br,Br,0),Gr(Sr,Ur,1)))}function Ki(Zr,is,os,cs,ss,es){switch(tr.strokeLineCap){case"round":ss?qr(Zr,os,is,es,.5):qr(Zr,is,os,es,.5);break;case"square":if(ss)cr.subVectors(is,Zr),ur.set(cr.y,-cr.x),dr.addVectors(cr,ur).add(Zr),hr.subVectors(ur,cr).add(Zr),cs?(dr.toArray(sr,1*3),hr.toArray(sr,0*3),hr.toArray(sr,3*3)):(dr.toArray(sr,1*3),or[3*2+1]===1?hr.toArray(sr,3*3):dr.toArray(sr,3*3),hr.toArray(sr,0*3));else{cr.subVectors(os,Zr),ur.set(cr.y,-cr.x),dr.addVectors(cr,ur).add(Zr),hr.subVectors(ur,cr).add(Zr);const ms=sr.length;cs?(dr.toArray(sr,ms-1*3),hr.toArray(sr,ms-2*3),hr.toArray(sr,ms-4*3)):(hr.toArray(sr,ms-2*3),dr.toArray(sr,ms-1*3),hr.toArray(sr,ms-4*3))}break;case"butt":default:break}}function Zi(Zr){let is=!1;for(let cs=1,ss=Zr.length-1;cs<ss;cs++)if(Zr[cs].distanceTo(Zr[cs+1])<nr){is=!0;break}if(!is)return Zr;const os=[];os.push(Zr[0]);for(let cs=1,ss=Zr.length-1;cs<ss;cs++)Zr[cs].distanceTo(Zr[cs+1])>=nr&&os.push(Zr[cs]);return os.push(Zr[Zr.length-1]),os}}}class TDSLoader extends Loader{constructor(er){super(er),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(er,tr,ir,nr){const sr=this,ar=this.path===""?LoaderUtils.extractUrlBase(er):this.path,or=new FileLoader(this.manager);or.setPath(this.path),or.setResponseType("arraybuffer"),or.setRequestHeader(this.requestHeader),or.setWithCredentials(this.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},ir,nr)}parse(er,tr){this.group=new Group,this.materials=[],this.meshes=[],this.readFile(er,tr);for(let ir=0;ir<this.meshes.length;ir++)this.group.add(this.meshes[ir]);return this.group}readFile(er,tr){const ir=new DataView(er),nr=new Chunk(ir,0,this.debugMessage);if(nr.id===MLIBMAGIC||nr.id===CMAGIC||nr.id===M3DMAGIC){let sr=nr.readChunk();for(;sr;){if(sr.id===M3D_VERSION){const ar=sr.readDWord();this.debugMessage("3DS file version: "+ar)}else sr.id===MDATA?this.readMeshData(sr,tr):this.debugMessage("Unknown main chunk: "+sr.hexId);sr=nr.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(er,tr){let ir=er.readChunk();for(;ir;){if(ir.id===MESH_VERSION){const nr=+ir.readDWord();this.debugMessage("Mesh Version: "+nr)}else if(ir.id===MASTER_SCALE){const nr=ir.readFloat();this.debugMessage("Master scale: "+nr),this.group.scale.set(nr,nr,nr)}else ir.id===NAMED_OBJECT?(this.debugMessage("Named Object"),this.readNamedObject(ir)):ir.id===MAT_ENTRY?(this.debugMessage("Material"),this.readMaterialEntry(ir,tr)):this.debugMessage("Unknown MDATA chunk: "+ir.hexId);ir=er.readChunk()}}readNamedObject(er){const tr=er.readString();let ir=er.readChunk();for(;ir;){if(ir.id===N_TRI_OBJECT){const nr=this.readMesh(ir);nr.name=tr,this.meshes.push(nr)}else this.debugMessage("Unknown named object chunk: "+ir.hexId);ir=er.readChunk()}}readMaterialEntry(er,tr){let ir=er.readChunk();const nr=new MeshPhongMaterial;for(;ir;){if(ir.id===MAT_NAME)nr.name=ir.readString(),this.debugMessage("   Name: "+nr.name);else if(ir.id===MAT_WIRE)this.debugMessage("   Wireframe"),nr.wireframe=!0;else if(ir.id===MAT_WIRE_SIZE){const sr=ir.readByte();nr.wireframeLinewidth=sr,this.debugMessage("   Wireframe Thickness: "+sr)}else if(ir.id===MAT_TWO_SIDE)nr.side=DoubleSide,this.debugMessage("   DoubleSided");else if(ir.id===MAT_ADDITIVE)this.debugMessage("   Additive Blending"),nr.blending=AdditiveBlending;else if(ir.id===MAT_DIFFUSE)this.debugMessage("   Diffuse Color"),nr.color=this.readColor(ir);else if(ir.id===MAT_SPECULAR)this.debugMessage("   Specular Color"),nr.specular=this.readColor(ir);else if(ir.id===MAT_AMBIENT)this.debugMessage("   Ambient color"),nr.color=this.readColor(ir);else if(ir.id===MAT_SHININESS){const sr=this.readPercentage(ir);nr.shininess=sr*100,this.debugMessage("   Shininess : "+sr)}else if(ir.id===MAT_TRANSPARENCY){const sr=this.readPercentage(ir);nr.opacity=1-sr,this.debugMessage("  Transparency : "+sr),nr.transparent=nr.opacity<1}else ir.id===MAT_TEXMAP?(this.debugMessage("   ColorMap"),nr.map=this.readMap(ir,tr)):ir.id===MAT_BUMPMAP?(this.debugMessage("   BumpMap"),nr.bumpMap=this.readMap(ir,tr)):ir.id===MAT_OPACMAP?(this.debugMessage("   OpacityMap"),nr.alphaMap=this.readMap(ir,tr)):ir.id===MAT_SPECMAP?(this.debugMessage("   SpecularMap"),nr.specularMap=this.readMap(ir,tr)):this.debugMessage("   Unknown material chunk: "+ir.hexId);ir=er.readChunk()}this.materials[nr.name]=nr}readMesh(er){let tr=er.readChunk();const ir=new BufferGeometry,nr=new MeshPhongMaterial,sr=new Mesh(ir,nr);for(sr.name="mesh";tr;){if(tr.id===POINT_ARRAY){const ar=tr.readWord();this.debugMessage("   Vertex: "+ar);const or=[];for(let lr=0;lr<ar;lr++)or.push(tr.readFloat()),or.push(tr.readFloat()),or.push(tr.readFloat());ir.setAttribute("position",new Float32BufferAttribute(or,3))}else if(tr.id===FACE_ARRAY)this.readFaceArray(tr,sr);else if(tr.id===TEX_VERTS){const ar=tr.readWord();this.debugMessage("   UV: "+ar);const or=[];for(let lr=0;lr<ar;lr++)or.push(tr.readFloat()),or.push(tr.readFloat());ir.setAttribute("uv",new Float32BufferAttribute(or,2))}else if(tr.id===MESH_MATRIX){this.debugMessage("   Tranformation Matrix (TODO)");const ar=[];for(let cr=0;cr<12;cr++)ar[cr]=tr.readFloat();const or=new Matrix4;or.elements[0]=ar[0],or.elements[1]=ar[6],or.elements[2]=ar[3],or.elements[3]=ar[9],or.elements[4]=ar[2],or.elements[5]=ar[8],or.elements[6]=ar[5],or.elements[7]=ar[11],or.elements[8]=ar[1],or.elements[9]=ar[7],or.elements[10]=ar[4],or.elements[11]=ar[10],or.elements[12]=0,or.elements[13]=0,or.elements[14]=0,or.elements[15]=1,or.transpose();const lr=new Matrix4;lr.copy(or).invert(),ir.applyMatrix4(lr),or.decompose(sr.position,sr.quaternion,sr.scale)}else this.debugMessage("   Unknown mesh chunk: "+tr.hexId);tr=er.readChunk()}return ir.computeVertexNormals(),sr}readFaceArray(er,tr){const ir=er.readWord();this.debugMessage("   Faces: "+ir);const nr=[];for(let or=0;or<ir;++or)nr.push(er.readWord(),er.readWord(),er.readWord()),er.readWord();tr.geometry.setIndex(nr);let sr=0,ar=0;for(;!er.endOfChunk;){const or=er.readChunk();if(or.id===MSH_MAT_GROUP){this.debugMessage("      Material Group");const lr=this.readMaterialGroup(or),cr=lr.index.length*3;tr.geometry.addGroup(ar,cr,sr),ar+=cr,sr++;const ur=this.materials[lr.name];Array.isArray(tr.material)===!1&&(tr.material=[]),ur!==void 0&&tr.material.push(ur)}else this.debugMessage("      Unknown face array chunk: "+or.hexId)}tr.material.length===1&&(tr.material=tr.material[0])}readMap(er,tr){let ir=er.readChunk(),nr={};const sr=new TextureLoader(this.manager);for(sr.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin);ir;){if(ir.id===MAT_MAPNAME){const ar=ir.readString();nr=sr.load(ar),this.debugMessage("      File: "+tr+ar)}else ir.id===MAT_MAP_UOFFSET?(nr.offset.x=ir.readFloat(),this.debugMessage("      OffsetX: "+nr.offset.x)):ir.id===MAT_MAP_VOFFSET?(nr.offset.y=ir.readFloat(),this.debugMessage("      OffsetY: "+nr.offset.y)):ir.id===MAT_MAP_USCALE?(nr.repeat.x=ir.readFloat(),this.debugMessage("      RepeatX: "+nr.repeat.x)):ir.id===MAT_MAP_VSCALE?(nr.repeat.y=ir.readFloat(),this.debugMessage("      RepeatY: "+nr.repeat.y)):this.debugMessage("      Unknown map chunk: "+ir.hexId);ir=er.readChunk()}return nr}readMaterialGroup(er){const tr=er.readString(),ir=er.readWord();this.debugMessage("         Name: "+tr),this.debugMessage("         Faces: "+ir);const nr=[];for(let sr=0;sr<ir;++sr)nr.push(er.readWord());return{name:tr,index:nr}}readColor(er){const tr=er.readChunk(),ir=new Color;if(tr.id===COLOR_24||tr.id===LIN_COLOR_24){const nr=tr.readByte(),sr=tr.readByte(),ar=tr.readByte();ir.setRGB(nr/255,sr/255,ar/255),this.debugMessage("      Color: "+ir.r+", "+ir.g+", "+ir.b)}else if(tr.id===COLOR_F||tr.id===LIN_COLOR_F){const nr=tr.readFloat(),sr=tr.readFloat(),ar=tr.readFloat();ir.setRGB(nr,sr,ar),this.debugMessage("      Color: "+ir.r+", "+ir.g+", "+ir.b)}else this.debugMessage("      Unknown color chunk: "+tr.hexId);return ir}readPercentage(er){const tr=er.readChunk();switch(tr.id){case INT_PERCENTAGE:return tr.readShort()/100;case FLOAT_PERCENTAGE:return tr.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+tr.hexId),0}}debugMessage(er){this.debug&&console.log(er)}}class Chunk{constructor(er,tr,ir){this.data=er,this.offset=tr,this.position=tr,this.debugMessage=ir,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>er.byteLength&&this.debugMessage("Bad chunk size for chunk at "+tr)}readChunk(){if(this.endOfChunk)return null;try{const er=new Chunk(this.data,this.position,this.debugMessage);return this.position+=er.size,er}catch{return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const er=this.data.getUint8(this.position,!0);return this.position+=1,er}readFloat(){try{const er=this.data.getFloat32(this.position,!0);return this.position+=4,er}catch(er){return this.debugMessage(er+" "+this.position+" "+this.data.byteLength),0}}readInt(){const er=this.data.getInt32(this.position,!0);return this.position+=4,er}readShort(){const er=this.data.getInt16(this.position,!0);return this.position+=2,er}readDWord(){const er=this.data.getUint32(this.position,!0);return this.position+=4,er}readWord(){const er=this.data.getUint16(this.position,!0);return this.position+=2,er}readString(){let er="",tr=this.readByte();for(;tr;)er+=String.fromCharCode(tr),tr=this.readByte();return er}}const M3DMAGIC=19789,MLIBMAGIC=15786,CMAGIC=49725,M3D_VERSION=2,COLOR_F=16,COLOR_24=17,LIN_COLOR_24=18,LIN_COLOR_F=19,INT_PERCENTAGE=48,FLOAT_PERCENTAGE=49,MDATA=15677,MESH_VERSION=15678,MASTER_SCALE=256,MAT_ENTRY=45055,MAT_NAME=40960,MAT_AMBIENT=40976,MAT_DIFFUSE=40992,MAT_SPECULAR=41008,MAT_SHININESS=41024,MAT_TRANSPARENCY=41040,MAT_TWO_SIDE=41089,MAT_ADDITIVE=41091,MAT_WIRE=41093,MAT_WIRE_SIZE=41095,MAT_TEXMAP=41472,MAT_OPACMAP=41488,MAT_BUMPMAP=41520,MAT_SPECMAP=41476,MAT_MAPNAME=41728,MAT_MAP_USCALE=41812,MAT_MAP_VSCALE=41814,MAT_MAP_UOFFSET=41816,MAT_MAP_VOFFSET=41818,NAMED_OBJECT=16384,N_TRI_OBJECT=16640,POINT_ARRAY=16656,FACE_ARRAY=16672,MSH_MAT_GROUP=16688,TEX_VERTS=16704,MESH_MATRIX=16736;var UTIF={};(function(){"use strict";var rr=function(){function ar(or){this.message="JPEG error: "+or}return ar.prototype=new Error,ar.prototype.name="JpegError",ar.constructor=ar,ar}(),er=function(){var ar=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),or=4017,lr=799,cr=3406,ur=2276,dr=1567,hr=3784,pr=5793,gr=2896;function vr(xr){xr==null&&(xr={}),xr.w==null&&(xr.w=-1),this.V=xr.n,this.N=xr.w}function mr(xr,Sr){for(var br=0,Cr=[],Ir,Rr,Pr=16,Dr;Pr>0&&!xr[Pr-1];)Pr--;Cr.push({children:[],index:0});var Fr=Cr[0];for(Ir=0;Ir<Pr;Ir++){for(Rr=0;Rr<xr[Ir];Rr++){for(Fr=Cr.pop(),Fr.children[Fr.index]=Sr[br];Fr.index>0;)Fr=Cr.pop();for(Fr.index++,Cr.push(Fr);Cr.length<=Ir;)Cr.push(Dr={children:[],index:0}),Fr.children[Fr.index]=Dr.children,Fr=Dr;br++}Ir+1<Pr&&(Cr.push(Dr={children:[],index:0}),Fr.children[Fr.index]=Dr.children,Fr=Dr)}return Cr[0].children}function fr(xr,Sr,br){return 64*((xr.P+1)*Sr+br)}function _r(xr,Sr,br,Cr,Ir,Rr,Pr,Dr,Fr,Or){Or==null&&(Or=!1);var Nr=br.m,Ur=br.Z,Br=Sr,Wr=0,Xr=0,Yr=0,Qi=0,Xi,Kr=0,$r,Vr,Gr,qr,ji,Jr,Ji=0,Ki,Zi,Zr,is;function os(){if(Xr>0)return Xr--,Wr>>Xr&1;if(Wr=xr[Sr++],Wr===255){var _s=xr[Sr++];if(_s){if(_s===220&&Or){Sr+=2;var As=ir(xr,Sr);if(Sr+=2,As>0&&As!==br.s)throw new DNLMarkerError("Found DNL marker (0xFFDC) while parsing scan data",As)}else if(_s===217){if(Or){var xs=Kr*8;if(xs>0&&xs<br.s/10)throw new DNLMarkerError("Found EOI marker (0xFFD9) while parsing scan data, possibly caused by incorrect `scanLines` parameter",xs)}throw new EOIMarkerError("Found EOI marker (0xFFD9) while parsing scan data")}throw new rr("unexpected marker")}}return Xr=7,Wr>>>7}function cs(_s){for(var As=_s;;){switch(As=As[os()],typeof As){case"number":return As;case"object":continue}throw new rr("invalid huffman sequence")}}function ss(_s){for(var As=0;_s>0;)As=As<<1|os(),_s--;return As}function es(_s){if(_s===1)return os()===1?1:-1;var As=ss(_s);return As>=1<<_s-1?As:As+(-1<<_s)+1}function ms(_s,As){var xs=cs(_s.J),Es=xs===0?0:es(xs),Ps=1;for(_s.D[As]=_s.Q+=Es;Ps<64;){var Ns=cs(_s.i),Vs=Ns&15,Us=Ns>>4;if(Vs===0){if(Us<15)break;Ps+=16;continue}Ps+=Us;var Os=ar[Ps];_s.D[As+Os]=es(Vs),Ps++}}function Yi(_s,As){var xs=cs(_s.J),Es=xs===0?0:es(xs)<<Fr;_s.D[As]=_s.Q+=Es}function Gi(_s,As){_s.D[As]|=os()<<Fr}function Ni(_s,As){if(Yr>0){Yr--;return}for(var xs=Rr,Es=Pr;xs<=Es;){var Ps=cs(_s.i),Ns=Ps&15,Vs=Ps>>4;if(Ns===0){if(Vs<15){Yr=ss(Vs)+(1<<Vs)-1;break}xs+=16;continue}xs+=Vs;var Us=ar[xs];_s.D[As+Us]=es(Ns)*(1<<Fr),xs++}}function Ri(_s,As){for(var xs=Rr,Es=Pr,Ps=0,Ns,Vs;xs<=Es;){var Us=As+ar[xs],Os=_s.D[Us]<0?-1:1;switch(Qi){case 0:if(Vs=cs(_s.i),Ns=Vs&15,Ps=Vs>>4,Ns===0)Ps<15?(Yr=ss(Ps)+(1<<Ps),Qi=4):(Ps=16,Qi=1);else{if(Ns!==1)throw new rr("invalid ACn encoding");Xi=es(Ns),Qi=Ps?2:3}continue;case 1:case 2:_s.D[Us]?_s.D[Us]+=Os*(os()<<Fr):(Ps--,Ps===0&&(Qi=Qi===2?3:0));break;case 3:_s.D[Us]?_s.D[Us]+=Os*(os()<<Fr):(_s.D[Us]=Xi<<Fr,Qi=0);break;case 4:_s.D[Us]&&(_s.D[Us]+=Os*(os()<<Fr));break}xs++}Qi===4&&(Yr--,Yr===0&&(Qi=0))}function qi(_s,As,xs,Es,Ps){var Ns=xs/Nr|0,Vs=xs%Nr;Kr=Ns*_s.A+Es;var Us=Vs*_s.h+Ps,Os=fr(_s,Kr,Us);As(_s,Os)}function as(_s,As,xs){Kr=xs/_s.P|0;var Es=xs%_s.P,Ps=fr(_s,Kr,Es);As(_s,Ps)}var us=Cr.length;for(Ur?Rr===0?Jr=Dr===0?Yi:Gi:Jr=Dr===0?Ni:Ri:Jr=ms,us===1?Zi=Cr[0].P*Cr[0].c:Zi=Nr*br.R;Ji<=Zi;){var gs=Ir?Math.min(Zi-Ji,Ir):Zi;if(gs>0){for(Vr=0;Vr<us;Vr++)Cr[Vr].Q=0;if(Yr=0,us===1)for($r=Cr[0],ji=0;ji<gs;ji++)as($r,Jr,Ji),Ji++;else for(ji=0;ji<gs;ji++){for(Vr=0;Vr<us;Vr++)for($r=Cr[Vr],Zr=$r.h,is=$r.A,Gr=0;Gr<is;Gr++)for(qr=0;qr<Zr;qr++)qi($r,Jr,Ji,Gr,qr);Ji++}}if(Xr=0,Ki=wr(xr,Sr),!Ki)break;if(Ki.u){var vs=gs>0?"unexpected":"excessive";Sr=Ki.offset}if(Ki.M>=65488&&Ki.M<=65495)Sr+=2;else break}return Sr-Br}function Ar(xr,Sr,br){var Cr=xr.$,Ir=xr.D,Rr,Pr,Dr,Fr,Or,Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr,Gr;if(!Cr)throw new rr("missing required Quantization Table.");for(var qr=0;qr<64;qr+=8){if(Wr=Ir[Sr+qr],Xr=Ir[Sr+qr+1],Yr=Ir[Sr+qr+2],Qi=Ir[Sr+qr+3],Xi=Ir[Sr+qr+4],Kr=Ir[Sr+qr+5],$r=Ir[Sr+qr+6],Vr=Ir[Sr+qr+7],Wr*=Cr[qr],!(Xr|Yr|Qi|Xi|Kr|$r|Vr)){Gr=pr*Wr+512>>10,br[qr]=Gr,br[qr+1]=Gr,br[qr+2]=Gr,br[qr+3]=Gr,br[qr+4]=Gr,br[qr+5]=Gr,br[qr+6]=Gr,br[qr+7]=Gr;continue}Xr*=Cr[qr+1],Yr*=Cr[qr+2],Qi*=Cr[qr+3],Xi*=Cr[qr+4],Kr*=Cr[qr+5],$r*=Cr[qr+6],Vr*=Cr[qr+7],Rr=pr*Wr+128>>8,Pr=pr*Xi+128>>8,Dr=Yr,Fr=$r,Or=gr*(Xr-Vr)+128>>8,Br=gr*(Xr+Vr)+128>>8,Nr=Qi<<4,Ur=Kr<<4,Rr=Rr+Pr+1>>1,Pr=Rr-Pr,Gr=Dr*hr+Fr*dr+128>>8,Dr=Dr*dr-Fr*hr+128>>8,Fr=Gr,Or=Or+Ur+1>>1,Ur=Or-Ur,Br=Br+Nr+1>>1,Nr=Br-Nr,Rr=Rr+Fr+1>>1,Fr=Rr-Fr,Pr=Pr+Dr+1>>1,Dr=Pr-Dr,Gr=Or*ur+Br*cr+2048>>12,Or=Or*cr-Br*ur+2048>>12,Br=Gr,Gr=Nr*lr+Ur*or+2048>>12,Nr=Nr*or-Ur*lr+2048>>12,Ur=Gr,br[qr]=Rr+Br,br[qr+7]=Rr-Br,br[qr+1]=Pr+Ur,br[qr+6]=Pr-Ur,br[qr+2]=Dr+Nr,br[qr+5]=Dr-Nr,br[qr+3]=Fr+Or,br[qr+4]=Fr-Or}for(var ji=0;ji<8;++ji){if(Wr=br[ji],Xr=br[ji+8],Yr=br[ji+16],Qi=br[ji+24],Xi=br[ji+32],Kr=br[ji+40],$r=br[ji+48],Vr=br[ji+56],!(Xr|Yr|Qi|Xi|Kr|$r|Vr)){Gr=pr*Wr+8192>>14,Gr<-2040?Gr=0:Gr>=2024?Gr=255:Gr=Gr+2056>>4,Ir[Sr+ji]=Gr,Ir[Sr+ji+8]=Gr,Ir[Sr+ji+16]=Gr,Ir[Sr+ji+24]=Gr,Ir[Sr+ji+32]=Gr,Ir[Sr+ji+40]=Gr,Ir[Sr+ji+48]=Gr,Ir[Sr+ji+56]=Gr;continue}Rr=pr*Wr+2048>>12,Pr=pr*Xi+2048>>12,Dr=Yr,Fr=$r,Or=gr*(Xr-Vr)+2048>>12,Br=gr*(Xr+Vr)+2048>>12,Nr=Qi,Ur=Kr,Rr=(Rr+Pr+1>>1)+4112,Pr=Rr-Pr,Gr=Dr*hr+Fr*dr+2048>>12,Dr=Dr*dr-Fr*hr+2048>>12,Fr=Gr,Or=Or+Ur+1>>1,Ur=Or-Ur,Br=Br+Nr+1>>1,Nr=Br-Nr,Rr=Rr+Fr+1>>1,Fr=Rr-Fr,Pr=Pr+Dr+1>>1,Dr=Pr-Dr,Gr=Or*ur+Br*cr+2048>>12,Or=Or*cr-Br*ur+2048>>12,Br=Gr,Gr=Nr*lr+Ur*or+2048>>12,Nr=Nr*or-Ur*lr+2048>>12,Ur=Gr,Wr=Rr+Br,Vr=Rr-Br,Xr=Pr+Ur,$r=Pr-Ur,Yr=Dr+Nr,Kr=Dr-Nr,Qi=Fr+Or,Xi=Fr-Or,Wr<16?Wr=0:Wr>=4080?Wr=255:Wr>>=4,Xr<16?Xr=0:Xr>=4080?Xr=255:Xr>>=4,Yr<16?Yr=0:Yr>=4080?Yr=255:Yr>>=4,Qi<16?Qi=0:Qi>=4080?Qi=255:Qi>>=4,Xi<16?Xi=0:Xi>=4080?Xi=255:Xi>>=4,Kr<16?Kr=0:Kr>=4080?Kr=255:Kr>>=4,$r<16?$r=0:$r>=4080?$r=255:$r>>=4,Vr<16?Vr=0:Vr>=4080?Vr=255:Vr>>=4,Ir[Sr+ji]=Wr,Ir[Sr+ji+8]=Xr,Ir[Sr+ji+16]=Yr,Ir[Sr+ji+24]=Qi,Ir[Sr+ji+32]=Xi,Ir[Sr+ji+40]=Kr,Ir[Sr+ji+48]=$r,Ir[Sr+ji+56]=Vr}}function yr(xr,Sr){for(var br=Sr.P,Cr=Sr.c,Ir=new Int16Array(64),Rr=0;Rr<Cr;Rr++)for(var Pr=0;Pr<br;Pr++){var Dr=fr(Sr,Rr,Pr);Ar(Sr,Dr,Ir)}return Sr.D}function wr(xr,Sr,br){br==null&&(br=Sr);var Cr=xr.length-1,Ir=br<Sr?br:Sr;if(Sr>=Cr)return null;var Rr=ir(xr,Sr);if(Rr>=65472&&Rr<=65534)return{u:null,M:Rr,offset:Sr};for(var Pr=ir(xr,Ir);!(Pr>=65472&&Pr<=65534);){if(++Ir>=Cr)return null;Pr=ir(xr,Ir)}return{u:Rr.toString(16),M:Pr,offset:Ir}}return vr.prototype={parse(xr,Sr){Sr==null&&(Sr={});var br=Sr.F,Cr=0,Ir=null,Rr=null,Pr,Dr,Fr=0;function Or(){var Vs=ir(xr,Cr);Cr+=2;var Us=Cr+Vs-2,Os=wr(xr,Us,Cr);Os&&Os.u&&(Us=Os.offset);var ws=xr.subarray(Cr,Us);return Cr+=ws.length,ws}function Nr(Vs){for(var Us=Math.ceil(Vs.o/8/Vs.X),Os=Math.ceil(Vs.s/8/Vs.B),ws=0;ws<Vs.W.length;ws++){Ri=Vs.W[ws];var bs=Math.ceil(Math.ceil(Vs.o/8)*Ri.h/Vs.X),Ss=Math.ceil(Math.ceil(Vs.s/8)*Ri.A/Vs.B),Rs=Us*Ri.h,Hs=Os*Ri.A,ks=64*Hs*(Rs+1);Ri.D=new Int16Array(ks),Ri.P=bs,Ri.c=Ss}Vs.m=Us,Vs.R=Os}var Ur=[],Br=[],Wr=[],Xr=ir(xr,Cr);if(Cr+=2,Xr!==65496)throw new rr("SOI not found");Xr=ir(xr,Cr),Cr+=2;e:for(;Xr!==65497;){var Yr,Qi,Xi;switch(Xr){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var Kr=Or();Xr===65504&&Kr[0]===74&&Kr[1]===70&&Kr[2]===73&&Kr[3]===70&&Kr[4]===0&&(Ir={version:{d:Kr[5],T:Kr[6]},K:Kr[7],j:Kr[8]<<8|Kr[9],H:Kr[10]<<8|Kr[11],S:Kr[12],I:Kr[13],C:Kr.subarray(14,14+3*Kr[12]*Kr[13])}),Xr===65518&&Kr[0]===65&&Kr[1]===100&&Kr[2]===111&&Kr[3]===98&&Kr[4]===101&&(Rr={version:Kr[5]<<8|Kr[6],k:Kr[7]<<8|Kr[8],q:Kr[9]<<8|Kr[10],a:Kr[11]});break;case 65499:var $r=ir(xr,Cr),Vr;Cr+=2;for(var Gr=$r+Cr-2;Cr<Gr;){var qr=xr[Cr++],ji=new Uint16Array(64);if(qr>>4)if(qr>>4===1)for(Qi=0;Qi<64;Qi++)Vr=ar[Qi],ji[Vr]=ir(xr,Cr),Cr+=2;else throw new rr("DQT - invalid table spec");else for(Qi=0;Qi<64;Qi++)Vr=ar[Qi],ji[Vr]=xr[Cr++];Ur[qr&15]=ji}break;case 65472:case 65473:case 65474:if(Pr)throw new rr("Only single frame JPEGs supported");Cr+=2,Pr={},Pr.G=Xr===65473,Pr.Z=Xr===65474,Pr.precision=xr[Cr++];var Jr=ir(xr,Cr),Ji,Ki=0,Zi=0;Cr+=2,Pr.s=br||Jr,Pr.o=ir(xr,Cr),Cr+=2,Pr.W=[],Pr._={};var Zr=xr[Cr++];for(Yr=0;Yr<Zr;Yr++){Ji=xr[Cr];var is=xr[Cr+1]>>4,os=xr[Cr+1]&15;Ki<is&&(Ki=is),Zi<os&&(Zi=os);var cs=xr[Cr+2];Xi=Pr.W.push({h:is,A:os,L:cs,$:null}),Pr._[Ji]=Xi-1,Cr+=3}Pr.X=Ki,Pr.B=Zi,Nr(Pr);break;case 65476:var ss=ir(xr,Cr);for(Cr+=2,Yr=2;Yr<ss;){var es=xr[Cr++],ms=new Uint8Array(16),Yi=0;for(Qi=0;Qi<16;Qi++,Cr++)Yi+=ms[Qi]=xr[Cr];var Gi=new Uint8Array(Yi);for(Qi=0;Qi<Yi;Qi++,Cr++)Gi[Qi]=xr[Cr];Yr+=17+Yi,(es>>4?Br:Wr)[es&15]=mr(ms,Gi)}break;case 65501:Cr+=2,Dr=ir(xr,Cr),Cr+=2;break;case 65498:var Ni=++Fr===1&&!br,Ri;Cr+=2;var qi=xr[Cr++],as=[];for(Yr=0;Yr<qi;Yr++){var us=xr[Cr++],gs=Pr._[us];Ri=Pr.W[gs],Ri.index=us;var vs=xr[Cr++];Ri.J=Wr[vs>>4],Ri.i=Br[vs&15],as.push(Ri)}var _s=xr[Cr++],As=xr[Cr++],xs=xr[Cr++];try{var Es=_r(xr,Cr,Pr,as,Dr,_s,As,xs>>4,xs&15,Ni);Cr+=Es}catch(Vs){if(Vs instanceof DNLMarkerError)return this.parse(xr,{F:Vs.s});if(Vs instanceof EOIMarkerError)break e;throw Vs}break;case 65500:Cr+=4;break;case 65535:xr[Cr]!==255&&Cr--;break;default:var Ps=wr(xr,Cr-2,Cr-3);if(Ps&&Ps.u){Cr=Ps.offset;break}if(Cr>=xr.length-1)break e;throw new rr("JpegImage.parse - unknown marker: "+Xr.toString(16))}Xr=ir(xr,Cr),Cr+=2}for(this.width=Pr.o,this.height=Pr.s,this.g=Ir,this.b=Rr,this.W=[],Yr=0;Yr<Pr.W.length;Yr++){Ri=Pr.W[Yr];var Ns=Ur[Ri.L];Ns&&(Ri.$=Ns),this.W.push({index:Ri.index,e:yr(Pr,Ri),l:Ri.h/Pr.X,t:Ri.A/Pr.B,P:Ri.P,c:Ri.c})}this.p=this.W.length},Y(xr,Sr,br){br==null&&(br=!1);var Cr=this.width/xr,Ir=this.height/Sr,Rr,Pr,Dr,Fr,Or,Nr,Ur,Br,Wr,Xr,Yr=0,Qi,Xi=this.W.length,Kr=xr*Sr*Xi,$r=new Uint8ClampedArray(Kr),Vr=new Uint32Array(xr),Gr=4294967288,qr;for(Ur=0;Ur<Xi;Ur++){if(Rr=this.W[Ur],Pr=Rr.l*Cr,Dr=Rr.t*Ir,Yr=Ur,Qi=Rr.e,Fr=Rr.P+1<<3,Pr!==qr){for(Or=0;Or<xr;Or++)Br=0|Or*Pr,Vr[Or]=(Br&Gr)<<3|Br&7;qr=Pr}for(Nr=0;Nr<Sr;Nr++)for(Br=0|Nr*Dr,Xr=Fr*(Br&Gr)|(Br&7)<<3,Or=0;Or<xr;Or++)$r[Yr]=Qi[Xr+Vr[Or]],Yr+=Xi}var ji=this.V;if(!br&&Xi===4&&!ji&&(ji=new Int32Array([-256,255,-256,255,-256,255,-256,255])),ji)for(Ur=0;Ur<Kr;)for(Br=0,Wr=0;Br<Xi;Br++,Ur++,Wr+=2)$r[Ur]=($r[Ur]*ji[Wr]>>8)+ji[Wr+1];return $r},get f(){return this.b?!!this.b.a:this.p===3?this.N===0?!1:!(this.W[0].index===82&&this.W[1].index===71&&this.W[2].index===66):this.N===1},z:function(Sr){for(var br,Cr,Ir,Rr=0,Pr=Sr.length;Rr<Pr;Rr+=3)br=Sr[Rr],Cr=Sr[Rr+1],Ir=Sr[Rr+2],Sr[Rr]=br-179.456+1.402*Ir,Sr[Rr+1]=br+135.459-.344*Cr-.714*Ir,Sr[Rr+2]=br-226.816+1.772*Cr;return Sr},O:function(Sr){for(var br,Cr,Ir,Rr,Pr=0,Dr=0,Fr=Sr.length;Dr<Fr;Dr+=4)br=Sr[Dr],Cr=Sr[Dr+1],Ir=Sr[Dr+2],Rr=Sr[Dr+3],Sr[Pr++]=-122.67195406894+Cr*(-660635669420364e-19*Cr+.000437130475926232*Ir-54080610064599e-18*br+.00048449797120281*Rr-.154362151871126)+Ir*(-.000957964378445773*Ir+.000817076911346625*br-.00477271405408747*Rr+1.53380253221734)+br*(.000961250184130688*br-.00266257332283933*Rr+.48357088451265)+Rr*(-.000336197177618394*Rr+.484791561490776),Sr[Pr++]=107.268039397724+Cr*(219927104525741e-19*Cr-.000640992018297945*Ir+.000659397001245577*br+.000426105652938837*Rr-.176491792462875)+Ir*(-.000778269941513683*Ir+.00130872261408275*br+.000770482631801132*Rr-.151051492775562)+br*(.00126935368114843*br-.00265090189010898*Rr+.25802910206845)+Rr*(-.000318913117588328*Rr-.213742400323665),Sr[Pr++]=-20.810012546947+Cr*(-.000570115196973677*Cr-263409051004589e-19*Ir+.0020741088115012*br-.00288260236853442*Rr+.814272968359295)+Ir*(-153496057440975e-19*Ir-.000132689043961446*br+.000560833691242812*Rr-.195152027534049)+br*(.00174418132927582*br-.00255243321439347*Rr+.116935020465145)+Rr*(-.000343531996510555*Rr+.24165260232407);return Sr.subarray(0,Pr)},r:function(Sr){for(var br,Cr,Ir,Rr=0,Pr=Sr.length;Rr<Pr;Rr+=4)br=Sr[Rr],Cr=Sr[Rr+1],Ir=Sr[Rr+2],Sr[Rr]=434.456-br-1.402*Ir,Sr[Rr+1]=119.541-br+.344*Cr+.714*Ir,Sr[Rr+2]=481.816-br-1.772*Cr;return Sr},U:function(Sr){for(var br,Cr,Ir,Rr,Pr=0,Dr=0,Fr=Sr.length;Dr<Fr;Dr+=4)br=Sr[Dr],Cr=Sr[Dr+1],Ir=Sr[Dr+2],Rr=Sr[Dr+3],Sr[Pr++]=255+br*(-6747147073602441e-20*br+.0008379262121013727*Cr+.0002894718188643294*Ir+.003264231057537806*Rr-1.1185611867203937)+Cr*(26374107616089405e-21*Cr-8626949158638572e-20*Ir-.0002748769067499491*Rr-.02155688794978967)+Ir*(-3878099212869363e-20*Ir-.0003267808279485286*Rr+.0686742238595345)-Rr*(.0003361971776183937*Rr+.7430659151342254),Sr[Pr++]=255+br*(.00013596372813588848*br+.000924537132573585*Cr+.00010567359618683593*Ir+.0004791864687436512*Rr-.3109689587515875)+Cr*(-.00023545346108370344*Cr+.0002702845253534714*Ir+.0020200308977307156*Rr-.7488052167015494)+Ir*(6834815998235662e-20*Ir+.00015168452363460973*Rr-.09751927774728933)-Rr*(.0003189131175883281*Rr+.7364883807733168),Sr[Pr++]=255+br*(13598650411385307e-21*br+.00012423956175490851*Cr+.0004751985097583589*Ir-36729317476630422e-22*Rr-.05562186980264034)+Cr*(.00016141380598724676*Cr+.0009692239130725186*Ir+.0007782692450036253*Rr-.44015232367526463)+Ir*(5068882914068769e-22*Ir+.0017778369011375071*Rr-.7591454649749609)-Rr*(.0003435319965105553*Rr+.7063770186160144);return Sr.subarray(0,Pr)},getData:function(xr){var Sr=xr.width,br=xr.height,Cr=xr.forceRGB,Ir=xr.isSourcePDF;if(this.p>4)throw new rr("Unsupported color mode");var Rr=this.Y(Sr,br,Ir);if(this.p===1&&Cr){for(var Pr=Rr.length,Dr=new Uint8ClampedArray(Pr*3),Fr=0,Or=0;Or<Pr;Or++){var Nr=Rr[Or];Dr[Fr++]=Nr,Dr[Fr++]=Nr,Dr[Fr++]=Nr}return Dr}else{if(this.p===3&&this.f)return this.z(Rr);if(this.p===4){if(this.f)return Cr?this.O(Rr):this.r(Rr);if(Cr)return this.U(Rr)}}return Rr}},vr}();function tr(sr,ar){return sr[ar]<<24>>24}function ir(sr,ar){return sr[ar]<<8|sr[ar+1]}function nr(sr,ar){return(sr[ar]<<24|sr[ar+1]<<16|sr[ar+2]<<8|sr[ar+3])>>>0}UTIF.JpegDecoder=er})();UTIF.encodeImage=function(rr,er,tr,ir){var nr={t256:[er],t257:[tr],t258:[8,8,8,8],t259:[1],t262:[2],t273:[1e3],t277:[4],t278:[tr],t279:[er*tr*4],t282:[[72,1]],t283:[[72,1]],t284:[1],t286:[[0,1]],t287:[[0,1]],t296:[1],t305:["Photopea (UTIF.js)"],t338:[1]};if(ir)for(var sr in ir)nr[sr]=ir[sr];for(var ar=new Uint8Array(UTIF.encode([nr])),or=new Uint8Array(rr),lr=new Uint8Array(1e3+er*tr*4),sr=0;sr<ar.length;sr++)lr[sr]=ar[sr];for(var sr=0;sr<or.length;sr++)lr[1e3+sr]=or[sr];return lr.buffer};UTIF.encode=function(rr){var er=!1,tr=new Uint8Array(2e4),ir=4,nr=er?UTIF._binLE:UTIF._binBE;tr[0]=tr[1]=er?73:77,nr.writeUshort(tr,2,42);var sr=8;nr.writeUint(tr,ir,sr),ir+=4;for(var ar=0;ar<rr.length;ar++){var or=UTIF._writeIFD(nr,UTIF._types.basic,tr,sr,rr[ar]);sr=or[1],ar<rr.length-1&&(sr&3&&(sr+=4-(sr&3)),nr.writeUint(tr,or[0],sr))}return tr.slice(0,sr).buffer};UTIF.decode=function(rr,er){er==null&&(er={parseMN:!0,debug:!1});var tr=new Uint8Array(rr),ir=0,nr=UTIF._binBE.readASCII(tr,ir,2);ir+=2;var sr=nr=="II"?UTIF._binLE:UTIF._binBE,ar=sr.readUshort(tr,ir);ir+=2;var or=sr.readUint(tr,ir);ir+=4;for(var lr=[];;){var cr=sr.readUshort(tr,or),ur=sr.readUshort(tr,or+4);if(cr!=0&&(ur<1||13<ur)){log("error in TIFF");break}if(UTIF._readIFD(sr,tr,or,lr,0,er),or=sr.readUint(tr,or+2+cr*12),or==0)break}return lr};UTIF.decodeImage=function(rr,er,tr){if(!er.data){var ir=new Uint8Array(rr),nr=UTIF._binBE.readASCII(ir,0,2);if(er.t256!=null){er.isLE=nr=="II",er.width=er.t256[0],er.height=er.t257[0];var sr=er.t259?er.t259[0]:1,ar=er.t266?er.t266[0]:1;er.t284&&er.t284[0]==2&&log("PlanarConfiguration 2 should not be used!"),sr==7&&er.t258&&er.t258.length>3&&(er.t258=er.t258.slice(0,3));var or=er.t277?er.t277[0]:1,lr=er.t258?er.t258[0]:1,cr=lr*or;sr==1&&er.t279!=null&&er.t278&&er.t262[0]==32803&&(cr=Math.round(er.t279[0]*8/(er.width*er.t278[0]))),er.t50885&&er.t50885[0]==4&&(cr=er.t258[0]*3);var ur=Math.ceil(er.width*cr/8)*8,dr=er.t273;(dr==null||er.t322)&&(dr=er.t324);var hr=er.t279;sr==1&&dr.length==1&&(hr=[er.height*(ur>>>3)]),(hr==null||er.t322)&&(hr=er.t325);var pr=new Uint8Array(er.height*(ur>>>3)),gr=0;if(er.t322!=null){var vr=er.t322[0],mr=er.t323[0],fr=Math.floor((er.width+vr-1)/vr),_r=Math.floor((er.height+mr-1)/mr),Ar=new Uint8Array(Math.ceil(vr*mr*cr/8)|0);console.log("====",fr,_r);for(var yr=0;yr<_r;yr++)for(var wr=0;wr<fr;wr++){var xr=yr*fr+wr;Ar.fill(0),UTIF.decode._decompress(er,tr,ir,dr[xr],hr[xr],sr,Ar,0,ar,vr,mr),sr==6?pr=Ar:UTIF._copyTile(Ar,Math.ceil(vr*cr/8)|0,mr,pr,Math.ceil(er.width*cr/8)|0,er.height,Math.ceil(wr*vr*cr/8)|0,yr*mr)}gr=pr.length*8}else{if(dr==null)return;var Sr=er.t278?er.t278[0]:er.height;Sr=Math.min(Sr,er.height);for(var xr=0;xr<dr.length;xr++)UTIF.decode._decompress(er,tr,ir,dr[xr],hr[xr],sr,pr,Math.ceil(gr/8)|0,ar,er.width,Sr),gr+=ur*Sr;gr=Math.min(gr,pr.length*8)}er.data=new Uint8Array(pr.buffer,0,Math.ceil(gr/8)|0)}}};UTIF.decode._decompress=function(rr,er,tr,ir,nr,sr,ar,or,lr,cr,ur){if(rr.t271&&rr.t271[0]=="Panasonic"&&rr.t45&&rr.t45[0]==6&&(sr=34316),sr==1)for(var dr=0;dr<nr;dr++)ar[or+dr]=tr[ir+dr];else if(sr==2)UTIF.decode._decodeG2(tr,ir,nr,ar,or,cr,lr);else if(sr==3)UTIF.decode._decodeG3(tr,ir,nr,ar,or,cr,lr,rr.t292?(rr.t292[0]&1)==1:!1);else if(sr==4)UTIF.decode._decodeG4(tr,ir,nr,ar,or,cr,lr);else if(sr==5)UTIF.decode._decodeLZW(tr,ir,nr,ar,or,8);else if(sr==6)UTIF.decode._decodeOldJPEG(rr,tr,ir,nr,ar,or);else if(sr==7||sr==34892)UTIF.decode._decodeNewJPEG(rr,tr,ir,nr,ar,or);else if(sr==8||sr==32946){var hr=new Uint8Array(tr.buffer,ir+2,nr-6),pr=UTIF._inflateRaw(hr);or+pr.length<=ar.length&&ar.set(pr,or)}else sr==9?UTIF.decode._decodeVC5(tr,ir,nr,ar,or,rr.t33422):sr==32767?UTIF.decode._decodeARW(rr,tr,ir,nr,ar,or):sr==32773?UTIF.decode._decodePackBits(tr,ir,nr,ar,or):sr==32809?UTIF.decode._decodeThunder(tr,ir,nr,ar,or):sr==34316?UTIF.decode._decodePanasonic(rr,tr,ir,nr,ar,or):sr==34713?UTIF.decode._decodeNikon(rr,er,tr,ir,nr,ar,or):sr==34676?UTIF.decode._decodeLogLuv32(rr,tr,ir,nr,ar,or):log("Unknown compression",sr);var gr=rr.t258?Math.min(32,rr.t258[0]):1,vr=rr.t277?rr.t277[0]:1,mr=gr*vr>>>3,fr=Math.ceil(gr*vr*cr/8);if(gr==16&&!rr.isLE&&rr.t33422==null)for(var _r=0;_r<ur;_r++)for(var Ar=or+_r*fr,yr=1;yr<fr;yr+=2){var wr=ar[Ar+yr];ar[Ar+yr]=ar[Ar+yr-1],ar[Ar+yr-1]=wr}if(rr.t317&&rr.t317[0]==2)for(var _r=0;_r<ur;_r++){var xr=or+_r*fr;if(gr==16)for(var dr=mr;dr<fr;dr+=2){var Sr=(ar[xr+dr+1]<<8|ar[xr+dr])+(ar[xr+dr-mr+1]<<8|ar[xr+dr-mr]);ar[xr+dr]=Sr&255,ar[xr+dr+1]=Sr>>>8&255}else if(vr==3)for(var dr=3;dr<fr;dr+=3)ar[xr+dr]=ar[xr+dr]+ar[xr+dr-3]&255,ar[xr+dr+1]=ar[xr+dr+1]+ar[xr+dr-2]&255,ar[xr+dr+2]=ar[xr+dr+2]+ar[xr+dr-1]&255;else for(var dr=mr;dr<fr;dr++)ar[xr+dr]=ar[xr+dr]+ar[xr+dr-mr]&255}};UTIF.decode._decodePanasonic=function(rr,er,tr,ir,nr,sr){var ar=er.buffer,or=rr.t2[0],lr=rr.t3[0],cr=rr.t10[0],ur=rr.t45[0],dr=0,hr=0,pr=0,gr=0,vr,mr,fr=ur==6?new Uint32Array(18):new Uint8Array(16),_r,Ar,yr,wr=[0,0],xr=[0,0],Sr,br=0,Cr,Ir,Rr,Pr,Dr=new Uint8Array(16384),Fr=new Uint16Array(nr.buffer);function Or(os){if(pr==0){var cs=new Uint8Array(ar,tr+hr+8184,8200),ss=new Uint8Array(ar,tr+hr,8184);Dr.set(cs),Dr.set(ss,cs.length),hr+=16384}if(ur==5)for(_r=0;_r<16;_r++)fr[_r]=Dr[pr++],pr&=16383;else return pr=pr-os&131071,gr=pr>>3^16368,(Dr[gr]|Dr[gr+1]<<8)>>(pr&7)&~(-1<<os)}function Nr(os){return Dr[pr+15-os]}function Ur(){fr[0]=Nr(0)<<6|Nr(1)>>2,fr[1]=((Nr(1)&3)<<12|Nr(2)<<4|Nr(3)>>4)&16383,fr[2]=Nr(3)>>2&3,fr[3]=(Nr(3)&3)<<8|Nr(4),fr[4]=Nr(5)<<2|Nr(6)>>6,fr[5]=(Nr(6)&63)<<4|Nr(7)>>4,fr[6]=Nr(7)>>2&3,fr[7]=(Nr(7)&3)<<8|Nr(8),fr[8]=Nr(9)<<2&1020|Nr(10)>>6,fr[9]=(Nr(10)<<4|Nr(11)>>4)&1023,fr[10]=Nr(11)>>2&3,fr[11]=(Nr(11)&3)<<8|Nr(12),fr[12]=(Nr(13)<<2&1020|Nr(14)>>6)&1023,fr[13]=(Nr(14)<<4|Nr(15)>>4)&1023,pr+=16,gr=0}function Br(){fr[0]=Nr(0)<<4|Nr(1)>>4,fr[1]=((Nr(1)&15)<<8|Nr(2))&4095,fr[2]=Nr(3)>>6&3,fr[3]=(Nr(3)&63)<<2|Nr(4)>>6,fr[4]=(Nr(4)&63)<<2|Nr(5)>>6,fr[5]=(Nr(5)&63)<<2|Nr(6)>>6,fr[6]=Nr(6)>>4&3,fr[7]=(Nr(6)&15)<<4|Nr(7)>>4,fr[8]=(Nr(7)&15)<<4|Nr(8)>>4,fr[9]=(Nr(8)&15)<<4|Nr(9)>>4,fr[10]=Nr(9)>>2&3,fr[11]=(Nr(9)&3)<<6|Nr(10)>>2,fr[12]=(Nr(10)&3)<<6|Nr(11)>>2,fr[13]=(Nr(11)&3)<<6|Nr(12)>>2,fr[14]=Nr(12)&3,fr[15]=Nr(13),fr[16]=Nr(14),fr[17]=Nr(15),pr+=16,gr=0}function Wr(){wr[0]=0,wr[1]=0,xr[0]=0,xr[1]=0}if(ur==7)throw ur;if(ur==6){var Xr=cr==12,Yr=Xr?Br:Ur,Qi=Xr?14:11,Xi=Xr?128:512,Kr=Xr?2048:8192,$r=Xr?16383:65535,Vr=Xr?4095:16383,Gr=or/Qi,qr=Gr*16,ji=Xr?18:14;for(Ir=0;Ir<lr-15;Ir+=16){var Jr=Math.min(16,lr-Ir),Ji=qr*Jr;for(Dr=new Uint8Array(ar,tr+dr,Ji),pr=0,dr+=Ji,Pr=0,Rr=0;Pr<Jr;Pr++,Rr=0){br=(Ir+Pr)*or;for(var Ki=0;Ki<Gr;Ki++)for(Yr(),Wr(),yr=0,Cr=0,_r=0;_r<Qi;_r++){if(Sr=_r&1,_r%3==2){var Zi=gr<ji?fr[gr++]:0;Zi==3&&(Zi=4),Cr=Xi<<Zi,yr=1<<Zi}var Zr=gr<ji?fr[gr++]:0;wr[Sr]?(Zr*=yr,Cr<Kr&&xr[Sr]>Cr&&(Zr+=xr[Sr]-Cr),xr[Sr]=Zr):(wr[Sr]=Zr,Zr?xr[Sr]=Zr:Zr=xr[Sr]),Fr[br+Rr++]=Zr-15<=$r?Zr-15&$r:Zr+2147483633>>31&Vr}}}}else if(ur==5){var is=cr==12?10:9;for(Ir=0;Ir<lr;Ir++)for(Rr=0;Rr<or;Rr+=is)Or(0),cr==12?(Fr[br++]=((fr[1]&15)<<8)+fr[0],Fr[br++]=16*fr[2]+(fr[1]>>4),Fr[br++]=((fr[4]&15)<<8)+fr[3],Fr[br++]=16*fr[5]+(fr[4]>>4),Fr[br++]=((fr[7]&15)<<8)+fr[6],Fr[br++]=16*fr[8]+(fr[7]>>4),Fr[br++]=((fr[10]&15)<<8)+fr[9],Fr[br++]=16*fr[11]+(fr[10]>>4),Fr[br++]=((fr[13]&15)<<8)+fr[12],Fr[br++]=16*fr[14]+(fr[13]>>4)):cr==14&&(Fr[br++]=fr[0]+((fr[1]&63)<<8),Fr[br++]=(fr[1]>>6)+4*fr[2]+((fr[3]&15)<<10),Fr[br++]=(fr[3]>>4)+16*fr[4]+((fr[5]&3)<<12),Fr[br++]=((fr[5]&252)>>2)+(fr[6]<<6),Fr[br++]=fr[7]+((fr[8]&63)<<8),Fr[br++]=(fr[8]>>6)+4*fr[9]+((fr[10]&15)<<10),Fr[br++]=(fr[10]>>4)+16*fr[11]+((fr[12]&3)<<12),Fr[br++]=((fr[12]&252)>>2)+(fr[13]<<6),Fr[br++]=fr[14]+((fr[15]&63)<<8))}else if(ur==4)for(Ir=0;Ir<lr;Ir++)for(Rr=0;Rr<or;Rr++)_r=Rr%14,Sr=_r&1,_r==0&&Wr(),_r%3==2&&(yr=4>>3-Or(2)),xr[Sr]?(Ar=Or(8),Ar!=0&&(wr[Sr]-=128<<yr,(wr[Sr]<0||yr==4)&&(wr[Sr]&=~(-1<<yr)),wr[Sr]+=Ar<<yr)):(xr[Sr]=Or(8),(xr[Sr]||_r>11)&&(wr[Sr]=xr[Sr]<<4|Or(4))),Fr[br++]=wr[Rr&1];else throw ur};UTIF.decode._decodeVC5=function(){var rr=[1,0,1,0,2,2,1,1,3,7,1,2,5,25,1,3,6,48,1,4,6,54,1,5,7,111,1,8,7,99,1,6,7,105,12,0,7,107,1,7,8,209,20,0,8,212,1,9,8,220,1,10,9,393,1,11,9,394,32,0,9,416,1,12,9,427,1,13,10,887,1,18,10,784,1,14,10,790,1,15,10,835,60,0,10,852,1,16,10,885,1,17,11,1571,1,19,11,1668,1,20,11,1669,100,0,11,1707,1,21,11,1772,1,22,12,3547,1,29,12,3164,1,24,12,3166,1,25,12,3140,1,23,12,3413,1,26,12,3537,1,27,12,3539,1,28,13,7093,1,35,13,6283,1,30,13,6331,1,31,13,6335,180,0,13,6824,1,32,13,7072,1,33,13,7077,320,0,13,7076,1,34,14,12565,1,36,14,12661,1,37,14,12669,1,38,14,13651,1,39,14,14184,1,40,15,28295,1,46,15,28371,1,47,15,25320,1,42,15,25336,1,43,15,25128,1,41,15,27300,1,44,15,28293,1,45,16,50259,1,48,16,50643,1,49,16,50675,1,50,16,56740,1,53,16,56584,1,51,16,56588,1,52,17,113483,1,61,17,113482,1,60,17,101285,1,55,17,101349,1,56,17,109205,1,57,17,109207,1,58,17,100516,1,54,17,113171,1,59,18,202568,1,62,18,202696,1,63,18,218408,1,64,18,218412,1,65,18,226340,1,66,18,226356,1,67,18,226358,1,68,19,402068,1,69,19,405138,1,70,19,405394,1,71,19,436818,1,72,19,436826,1,73,19,452714,1,75,19,452718,1,76,19,452682,1,74,20,804138,1,77,20,810279,1,78,20,810790,1,79,20,873638,1,80,20,873654,1,81,20,905366,1,82,20,905430,1,83,20,905438,1,84,21,1608278,1,85,21,1620557,1,86,21,1621582,1,87,21,1621583,1,88,21,1747310,1,89,21,1810734,1,90,21,1810735,1,91,21,1810863,1,92,21,1810879,1,93,22,3621725,1,99,22,3621757,1,100,22,3241112,1,94,22,3494556,1,95,22,3494557,1,96,22,3494622,1,97,22,3494623,1,98,23,6482227,1,102,23,6433117,1,101,23,6989117,1,103,23,6989119,1,105,23,6989118,1,104,23,7243449,1,106,23,7243512,1,107,24,13978233,1,111,24,12964453,1,109,24,12866232,1,108,24,14486897,1,113,24,13978232,1,110,24,14486896,1,112,24,14487026,1,114,24,14487027,1,115,25,25732598,1,225,25,25732597,1,189,25,25732596,1,188,25,25732595,1,203,25,25732594,1,202,25,25732593,1,197,25,25732592,1,207,25,25732591,1,169,25,25732590,1,223,25,25732589,1,159,25,25732522,1,235,25,25732579,1,152,25,25732575,1,192,25,25732489,1,179,25,25732573,1,201,25,25732472,1,172,25,25732576,1,149,25,25732488,1,178,25,25732566,1,120,25,25732571,1,219,25,25732577,1,150,25,25732487,1,127,25,25732506,1,211,25,25732548,1,125,25,25732588,1,158,25,25732486,1,247,25,25732467,1,238,25,25732508,1,163,25,25732552,1,228,25,25732603,1,183,25,25732513,1,217,25,25732587,1,168,25,25732520,1,122,25,25732484,1,128,25,25732562,1,249,25,25732505,1,187,25,25732504,1,186,25,25732483,1,136,25,25928905,1,181,25,25732560,1,255,25,25732500,1,230,25,25732482,1,135,25,25732555,1,233,25,25732568,1,222,25,25732583,1,145,25,25732481,1,134,25,25732586,1,167,25,25732521,1,248,25,25732518,1,209,25,25732480,1,243,25,25732512,1,216,25,25732509,1,164,25,25732547,1,140,25,25732479,1,157,25,25732544,1,239,25,25732574,1,191,25,25732564,1,251,25,25732478,1,156,25,25732546,1,139,25,25732498,1,242,25,25732557,1,133,25,25732477,1,162,25,25732515,1,213,25,25732584,1,165,25,25732514,1,212,25,25732476,1,227,25,25732494,1,198,25,25732531,1,236,25,25732530,1,234,25,25732529,1,117,25,25732528,1,215,25,25732527,1,124,25,25732526,1,123,25,25732525,1,254,25,25732524,1,253,25,25732523,1,148,25,25732570,1,218,25,25732580,1,146,25,25732581,1,147,25,25732569,1,224,25,25732533,1,143,25,25732540,1,184,25,25732541,1,185,25,25732585,1,166,25,25732556,1,132,25,25732485,1,129,25,25732563,1,250,25,25732578,1,151,25,25732501,1,119,25,25732502,1,193,25,25732536,1,176,25,25732496,1,245,25,25732553,1,229,25,25732516,1,206,25,25732582,1,144,25,25732517,1,208,25,25732558,1,137,25,25732543,1,241,25,25732466,1,237,25,25732507,1,190,25,25732542,1,240,25,25732551,1,131,25,25732554,1,232,25,25732565,1,252,25,25732475,1,171,25,25732493,1,205,25,25732492,1,204,25,25732491,1,118,25,25732490,1,214,25,25928904,1,180,25,25732549,1,126,25,25732602,1,182,25,25732539,1,175,25,25732545,1,141,25,25732559,1,138,25,25732537,1,177,25,25732534,1,153,25,25732503,1,194,25,25732606,1,160,25,25732567,1,121,25,25732538,1,174,25,25732497,1,246,25,25732550,1,130,25,25732572,1,200,25,25732474,1,170,25,25732511,1,221,25,25732601,1,196,25,25732532,1,142,25,25732519,1,210,25,25732495,1,199,25,25732605,1,155,25,25732535,1,154,25,25732499,1,244,25,25732510,1,220,25,25732600,1,195,25,25732607,1,161,25,25732604,1,231,25,25732473,1,173,25,25732599,1,226,26,51465122,1,116,26,51465123,0,1],er,tr,ir,nr=[3,3,3,3,2,2,2,1,1,1],sr=24576,ar=16384,or=8192,lr=ar|or;function cr(_r){var Ar=_r[1],yr=_r[0][Ar>>>3]>>>7-(Ar&7)&1;return _r[1]++,yr}function ur(_r,Ar){if(er==null){er={};for(var yr=0;yr<rr.length;yr+=4)er[rr[yr+1]]=rr.slice(yr,yr+4)}for(var wr=cr(_r),xr=er[wr];xr==null;)wr=wr<<1|cr(_r),xr=er[wr];var Sr=xr[3];Sr!=0&&(Sr=cr(_r)==0?Sr:-Sr),Ar[0]=xr[2],Ar[1]=Sr}function dr(_r,Ar){for(var yr=0;yr<Ar;yr++)(_r&1)==1&&_r++,_r=_r>>>1;return _r}function hr(_r,Ar){return _r>>Ar}function pr(_r,Ar,yr,wr,xr,Sr){Ar[yr]=hr(hr(11*_r[xr]-4*_r[xr+Sr]+_r[xr+Sr+Sr]+4,3)+_r[wr],1),Ar[yr+Sr]=hr(hr(5*_r[xr]+4*_r[xr+Sr]-_r[xr+Sr+Sr]+4,3)-_r[wr],1)}function gr(_r,Ar,yr,wr,xr,Sr){var br=_r[xr-Sr]-_r[xr+Sr],Cr=_r[xr],Ir=_r[wr];Ar[yr]=hr(hr(br+4,3)+Cr+Ir,1),Ar[yr+Sr]=hr(hr(-br+4,3)+Cr-Ir,1)}function vr(_r,Ar,yr,wr,xr,Sr){Ar[yr]=hr(hr(5*_r[xr]+4*_r[xr-Sr]-_r[xr-Sr-Sr]+4,3)+_r[wr],1),Ar[yr+Sr]=hr(hr(11*_r[xr]-4*_r[xr-Sr]+_r[xr-Sr-Sr]+4,3)-_r[wr],1)}function mr(_r){return _r=_r<0?0:_r>4095?4095:_r,_r=ir[_r]>>>2,_r}function fr(_r,Ar,yr,wr,xr,Sr){wr=new Uint16Array(wr.buffer);var br=Date.now(),Cr=UTIF._binBE,Ir=Ar+yr,Rr,Pr,Dr,Fr,Or,Nr,Ur,Br,Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr,Gr,qr;Ar+=4;for(var ji=Sr[0]==1;Ar<Ir;){var Jr=Cr.readShort(_r,Ar),Ji=Cr.readUshort(_r,Ar+2);if(Ar+=4,Jr==12)Rr=Ji;else if(Jr==20)Pr=Ji;else if(Jr==21)Dr=Ji;else if(Jr==48)Fr=Ji;else if(Jr==53)Or=Ji;else if(Jr==35)Nr=Ji;else if(Jr==62)Ur=Ji;else if(Jr==101)Br=Ji;else if(Jr==109)Wr=Ji;else if(Jr==84)Xr=Ji;else if(Jr==106)Yr=Ji;else if(Jr==107)Qi=Ji;else if(Jr==108)Xi=Ji;else if(Jr==102)Kr=Ji;else if(Jr==104)$r=Ji;else if(Jr==105)Vr=Ji;else{var Ki=Jr<0?-Jr:Jr,Zi=Ki&65280,Zr=0;if(Ki&lr&&(Ki&or?(Zr=Ji&65535,Zr+=(Ki&255)<<16):Zr=Ji&65535),(Ki&sr)==sr){if(Gr==null){Gr=[];for(var is=0;is<4;is++)Gr[is]=new Int16Array((Pr>>>1)*(Dr>>>1));qr=new Int16Array((Pr>>>1)*(Dr>>>1)),tr=new Int16Array(1024);for(var is=0;is<1024;is++){var os=is-512,cs=Math.abs(os),Rr=Math.floor(768*cs*cs*cs/(255*255*255))+cs;tr[is]=Math.sign(os)*Rr}ir=new Uint16Array(4096);for(var ss=65535,is=0;is<4096;is++){var es=is,ms=ss*(Math.pow(113,es/4095)-1)/112;ir[is]=Math.min(ms,ss)}}var Yi=Gr[Ur],Gi=dr(Pr,1+nr[Fr]),Ni=dr(Dr,1+nr[Fr]);if(Fr==0)for(var Ri=0;Ri<Ni;Ri++)for(var qi=0;qi<Gi;qi++){var as=Ar+(Ri*Gi+qi)*2;Yi[Ri*(Pr>>>1)+qi]=_r[as]<<8|_r[as+1]}else{for(var us=[_r,Ar*8],gs=[],vs=0,_s=Gi*Ni,As=[0,0],xs=0,Ji=0;vs<_s;)for(ur(us,As),xs=As[0],Ji=As[1];xs>0;)gs[vs++]=Ji,xs--;for(var Es=(Fr-1)%3,Ps=Es!=1?Gi:0,Ns=Es!=0?Ni:0,Ri=0;Ri<Ni;Ri++)for(var Vs=(Ri+Ns)*(Pr>>>1)+Ps,Us=Ri*Gi,qi=0;qi<Gi;qi++)Yi[Vs+qi]=tr[gs[Us+qi]+512]*Or;if(Es==2){for(var $r=Pr>>>1,Os=Gi*2,ws=Ni*2,Ri=0;Ri<Ni;Ri++)for(var qi=0;qi<Os;qi++){var is=Ri*2*$r+qi,bs=Ri*$r+qi,Ss=Ni*$r+bs;Ri==0?pr(Yi,qr,is,Ss,bs,$r):Ri==Ni-1?vr(Yi,qr,is,Ss,bs,$r):gr(Yi,qr,is,Ss,bs,$r)}var Rs=Yi;Yi=qr,qr=Rs;for(var Ri=0;Ri<ws;Ri++)for(var qi=0;qi<Gi;qi++){var is=Ri*$r+2*qi,bs=Ri*$r+qi,Ss=Gi+bs;qi==0?pr(Yi,qr,is,Ss,bs,1):qi==Gi-1?vr(Yi,qr,is,Ss,bs,1):gr(Yi,qr,is,Ss,bs,1)}var Rs=Yi;Yi=qr,qr=Rs;for(var Hs=[],ks=2-~~((Fr-1)/3),na=0;na<3;na++)Hs[na]=Wr>>14-na*2&3;var xa=Hs[ks];if(xa!=0)for(var Ri=0;Ri<ws;Ri++)for(var qi=0;qi<Os;qi++){var is=Ri*$r+qi;Yi[is]=Yi[is]<<xa}}}if(Fr==9&&Ur==3)for(var fa=Gr[0],Gs=Gr[1],Zs=Gr[2],Ys=Gr[3],Ri=0;Ri<Dr;Ri+=2)for(var qi=0;qi<Pr;qi+=2){var Js=Ri*Pr+qi,as=(Ri>>>1)*(Pr>>>1)+(qi>>>1),aa=fa[as],Ta=Gs[as]-2048,za=Zs[as]-2048,Ga=Ys[as]-2048,Qa=(Ta<<1)+aa,$a=(za<<1)+aa,Ya=aa+Ga,Xa=aa-Ga;ji?(wr[Js]=mr(Ya),wr[Js+1]=mr($a),wr[Js+Pr]=mr(Qa),wr[Js+Pr+1]=mr(Xa)):(wr[Js]=mr(Qa),wr[Js+1]=mr(Ya),wr[Js+Pr]=mr(Xa),wr[Js+Pr+1]=mr($a))}Ar+=Zr*4}else if(Ki==16388)Ar+=Zr*4;else if(!(Zi==8192||Zi==8448||Zi==9216))throw Ki.toString(16)}}console.log(Date.now()-br)}return fr}();UTIF.decode._decodeLogLuv32=function(rr,er,tr,ir,nr,sr){for(var ar=rr.width,or=ar*4,lr=0,cr=new Uint8Array(or);lr<ir;){for(var ur=0;ur<or;){var dr=er[tr+lr];if(lr++,dr<128){for(var hr=0;hr<dr;hr++)cr[ur+hr]=er[tr+lr+hr];ur+=dr,lr+=dr}else{dr=dr-126;for(var hr=0;hr<dr;hr++)cr[ur+hr]=er[tr+lr];ur+=dr,lr++}}for(var pr=0;pr<ar;pr++)nr[sr+0]=cr[pr],nr[sr+1]=cr[pr+ar],nr[sr+2]=cr[pr+ar*2],nr[sr+4]=cr[pr+ar*3],sr+=6}};UTIF.decode._ljpeg_diff=function(rr,er,tr){var ir=UTIF.decode._getbithuff,nr,sr;return nr=ir(rr,er,tr[0],tr),sr=ir(rr,er,nr,0),sr&1<<nr-1||(sr-=(1<<nr)-1),sr};UTIF.decode._decodeARW=function(rr,er,tr,ir,nr,sr){var ar=rr.t256[0],or=rr.t257[0],lr=rr.t258[0],cr=rr.isLE?UTIF._binLE:UTIF._binBE,ur=ar*or==ir||ar*or*1.5==ir;if(!ur){or+=8;var dr=[tr,0,0,0],hr=new Uint16Array(32770),pr=[3857,3856,3599,3342,3085,2828,2571,2314,2057,1800,1543,1286,1029,772,771,768,514,513],Ur,gr,vr,Cr,br,mr=0,fr=UTIF.decode._ljpeg_diff;for(hr[0]=15,vr=Ur=0;Ur<18;Ur++)for(var _r=32768>>>(pr[Ur]>>>8),gr=0;gr<_r;gr++)hr[++vr]=pr[Ur];for(Cr=ar;Cr--;)for(br=0;br<or+1;br+=2)if(br==or&&(br=1),mr+=fr(er,dr,hr),br<or){var Ar=mr&4095;UTIF.decode._putsF(nr,(br*ar+Cr)*lr,Ar<<16-lr)}return}if(ar*or*1.5==ir){for(var Ur=0;Ur<ir;Ur+=3){var yr=er[tr+Ur+0],wr=er[tr+Ur+1],xr=er[tr+Ur+2];nr[sr+Ur]=wr<<4|yr>>>4,nr[sr+Ur+1]=yr<<4|xr>>>4,nr[sr+Ur+2]=xr<<4|wr>>>4}return}var Sr=new Uint16Array(16),br,Cr,Ir,Rr,Pr,Dr,Fr,Or,Nr,Ur,Br,Wr=new Uint8Array(ar+1);for(br=0;br<or;br++){for(var Xr=0;Xr<ar;Xr++)Wr[Xr]=er[tr++];for(Br=0,Cr=0;Cr<ar-30;Br+=16){for(Rr=2047&(Ir=cr.readUint(Wr,Br)),Pr=2047&Ir>>>11,Dr=15&Ir>>>22,Fr=15&Ir>>>26,Or=0;Or<4&&128<<Or<=Rr-Pr;Or++);for(Nr=30,Ur=0;Ur<16;Ur++)Ur==Dr?Sr[Ur]=Rr:Ur==Fr?Sr[Ur]=Pr:(Sr[Ur]=((cr.readUshort(Wr,Br+(Nr>>3))>>>(Nr&7)&127)<<Or)+Pr,Sr[Ur]>2047&&(Sr[Ur]=2047),Nr+=7);for(Ur=0;Ur<16;Ur++,Cr+=2){var Ar=Sr[Ur]<<1;UTIF.decode._putsF(nr,(br*ar+Cr)*lr,Ar<<16-lr)}Cr-=Cr&1?1:31}}};UTIF.decode._decodeNikon=function(rr,er,tr,ir,nr,sr,ar){var or=[[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,5,4,3,6,2,7,1,0,8,9,11,10,12],[0,0,1,5,1,1,1,1,1,1,2,0,0,0,0,0,0,57,90,56,39,22,5,4,3,2,1,0,11,12,12],[0,0,1,4,2,3,1,2,0,0,0,0,0,0,0,0,0,5,4,6,3,7,2,8,1,9,0,10,11,12],[0,0,1,4,3,1,1,1,1,1,2,0,0,0,0,0,0,5,6,4,7,8,3,9,2,1,0,10,11,12,13,14],[0,0,1,5,1,1,1,1,1,1,1,2,0,0,0,0,0,8,92,75,58,41,7,6,5,4,3,2,1,0,13,14],[0,0,1,4,2,2,3,1,2,0,0,0,0,0,0,0,0,7,6,8,5,9,4,10,3,11,12,2,0,1,13,14]],lr=rr.t256[0],cr=rr.t257[0],ur=rr.t258[0],dr=0,hr=0,pr=UTIF.decode._make_decoder,gr=UTIF.decode._getbithuff,vr=er[0].exifIFD.makerNote,mr=vr.t150?vr.t150:vr.t140,fr=0,_r=mr[fr++],Ar=mr[fr++];(_r==73||Ar==88)&&(fr+=2110),_r==70&&(dr=2),ur==14&&(dr+=3);for(var yr=[[0,0],[0,0]],wr=rr.isLE?UTIF._binLE:UTIF._binBE,Ir=0;Ir<2;Ir++)for(var xr=0;xr<2;xr++)yr[Ir][xr]=wr.readShort(mr,fr),fr+=2;var Sr=1<<ur&32767,br=0,Cr=wr.readShort(mr,fr);fr+=2,Cr>1&&(br=Math.floor(Sr/(Cr-1))),_r==68&&Ar==32&&br>0&&(hr=wr.readShort(mr,562));var Ir,Rr,Pr,Dr,Fr,Or,Nr=0,Ur=[0,0],Br=pr(or[dr]),Wr=[ir,0,0,0];for(Nr=Rr=0;Rr<cr;Rr++)for(hr&&Rr==hr&&(Br=pr(or[dr+1])),Pr=0;Pr<lr;Pr++){Ir=gr(tr,Wr,Br[0],Br),Dr=Ir&15,Fr=Ir>>>4,Or=(gr(tr,Wr,Dr-Fr,0)<<1)+1<<Fr>>>1,Or&1<<Dr-1||(Or-=(1<<Dr)-(Fr==0?1:0)),Pr<2?Ur[Pr]=yr[Rr&1][Pr]+=Or:Ur[Pr&1]+=Or;var Xr=Math.min(Math.max(Ur[Pr&1],0),(1<<ur)-1),Yr=(Rr*lr+Pr)*ur;UTIF.decode._putsF(sr,Yr,Xr<<16-ur)}};UTIF.decode._putsF=function(rr,er,tr){tr=tr<<8-(er&7);var ir=er>>>3;rr[ir]|=tr>>>16,rr[ir+1]|=tr>>>8,rr[ir+2]|=tr};UTIF.decode._getbithuff=function(rr,er,tr,ir){var nr=0,sr=UTIF.decode._get_byte,ar,or=er[0],lr=er[1],cr=er[2],ur=er[3];if(tr==0||cr<0)return 0;for(;!ur&&cr<tr&&(ar=rr[or++])!=-1&&!(ur=nr&&ar==255&&rr[or++]);)lr=(lr<<8)+ar,cr+=8;if(ar=lr<<32-cr>>>32-tr,ir?(cr-=ir[ar+1]>>>8,ar=ir[ar+1]&255):cr-=tr,cr<0)throw"e";return er[0]=or,er[1]=lr,er[2]=cr,er[3]=ur,ar};UTIF.decode._make_decoder=function(rr){var er,tr,ir,nr,sr,ar=[];for(er=16;er!=0&&!rr[er];er--);var or=17;for(ar[0]=er,ir=tr=1;tr<=er;tr++)for(nr=0;nr<rr[tr];nr++,++or)for(sr=0;sr<1<<er-tr;sr++)ir<=1<<er&&(ar[ir++]=tr<<8|rr[or]);return ar};UTIF.decode._decodeNewJPEG=function(rr,er,tr,ir,nr,sr){ir=Math.min(ir,er.length-tr);var ar=rr.t347,or=ar?ar.length:0,lr=new Uint8Array(or+ir);if(ar){for(var cr=216,ur=217,dr=0,hr=0;hr<or-1&&!(ar[hr]==255&&ar[hr+1]==ur);hr++)lr[dr++]=ar[hr];var pr=er[tr],gr=er[tr+1];(pr!=255||gr!=cr)&&(lr[dr++]=pr,lr[dr++]=gr);for(var hr=2;hr<ir;hr++)lr[dr++]=er[tr+hr]}else for(var hr=0;hr<ir;hr++)lr[hr]=er[tr+hr];if(rr.t262[0]==32803||rr.t259[0]==7&&rr.t262[0]==34892){var vr=rr.t258[0],mr=UTIF.LosslessJpegDecode(lr),fr=mr.length;if(vr==16)if(rr.isLE)for(var hr=0;hr<fr;hr++)nr[sr+(hr<<1)]=mr[hr]&255,nr[sr+(hr<<1)+1]=mr[hr]>>>8;else for(var hr=0;hr<fr;hr++)nr[sr+(hr<<1)]=mr[hr]>>>8,nr[sr+(hr<<1)+1]=mr[hr]&255;else if(vr==14||vr==12||vr==10)for(var _r=16-vr,hr=0;hr<fr;hr++)UTIF.decode._putsF(nr,hr*vr,mr[hr]<<_r);else if(vr==8)for(var hr=0;hr<fr;hr++)nr[sr+hr]=mr[hr];else throw new Error("unsupported bit depth "+vr)}else{var Ar=new UTIF.JpegDecoder;Ar.parse(lr);for(var yr=Ar.getData({width:Ar.width,height:Ar.height,forceRGB:!0,isSourcePDF:!1}),hr=0;hr<yr.length;hr++)nr[sr+hr]=yr[hr]}rr.t262[0]==6&&(rr.t262[0]=2)};UTIF.decode._decodeOldJPEGInit=function(rr,er,tr,ir){var nr=216,sr=217,ar=219,or=196,lr=221,cr=192,ur=218,dr=0,hr=0,pr,gr,vr=!1,mr,fr,_r,Ar=rr.t513,yr=Ar?Ar[0]:0,wr=rr.t514,xr=wr?wr[0]:0,Sr=rr.t324||rr.t273||Ar,br=rr.t530,Cr=0,Ir=0,Rr=rr.t277?rr.t277[0]:1,Pr=rr.t515;if(Sr&&(hr=Sr[0],vr=Sr.length>1),!vr){if(er[tr]==255&&er[tr+1]==nr)return{jpegOffset:tr};if(Ar!=null&&(er[tr+yr]==255&&er[tr+yr+1]==nr?dr=tr+yr:log("JPEGInterchangeFormat does not point to SOI"),wr==null?log("JPEGInterchangeFormatLength field is missing"):(yr>=hr||yr+xr<=hr)&&log("JPEGInterchangeFormatLength field value is invalid"),dr!=null))return{jpegOffset:dr}}if(br!=null&&(Cr=br[0],Ir=br[1]),Ar!=null&&wr!=null)if(xr>=2&&yr+xr<=hr){for(er[tr+yr+xr-2]==255&&er[tr+yr+xr-1]==nr?pr=new Uint8Array(xr-2):pr=new Uint8Array(xr),mr=0;mr<pr.length;mr++)pr[mr]=er[tr+yr+mr];log("Incorrect JPEG interchange format: using JPEGInterchangeFormat offset to derive tables")}else log("JPEGInterchangeFormat+JPEGInterchangeFormatLength > offset to first strip or tile");if(pr==null){var Dr=0,Fr=[];Fr[Dr++]=255,Fr[Dr++]=nr;var Or=rr.t519;if(Or==null)throw new Error("JPEGQTables tag is missing");for(mr=0;mr<Or.length;mr++)for(Fr[Dr++]=255,Fr[Dr++]=ar,Fr[Dr++]=0,Fr[Dr++]=67,Fr[Dr++]=mr,fr=0;fr<64;fr++)Fr[Dr++]=er[tr+Or[mr]+fr];for(_r=0;_r<2;_r++){var Nr=rr[_r==0?"t520":"t521"];if(Nr==null)throw new Error((_r==0?"JPEGDCTables":"JPEGACTables")+" tag is missing");for(mr=0;mr<Nr.length;mr++){Fr[Dr++]=255,Fr[Dr++]=or;var Ur=19;for(fr=0;fr<16;fr++)Ur+=er[tr+Nr[mr]+fr];for(Fr[Dr++]=Ur>>>8,Fr[Dr++]=Ur&255,Fr[Dr++]=mr|_r<<4,fr=0;fr<16;fr++)Fr[Dr++]=er[tr+Nr[mr]+fr];for(fr=0;fr<Ur;fr++)Fr[Dr++]=er[tr+Nr[mr]+16+fr]}}if(Fr[Dr++]=255,Fr[Dr++]=cr,Fr[Dr++]=0,Fr[Dr++]=8+3*Rr,Fr[Dr++]=8,Fr[Dr++]=rr.height>>>8&255,Fr[Dr++]=rr.height&255,Fr[Dr++]=rr.width>>>8&255,Fr[Dr++]=rr.width&255,Fr[Dr++]=Rr,Rr==1)Fr[Dr++]=1,Fr[Dr++]=17,Fr[Dr++]=0;else for(mr=0;mr<3;mr++)Fr[Dr++]=mr+1,Fr[Dr++]=mr!=0?17:(Cr&15)<<4|Ir&15,Fr[Dr++]=mr;Pr!=null&&Pr[0]!=0&&(Fr[Dr++]=255,Fr[Dr++]=lr,Fr[Dr++]=0,Fr[Dr++]=4,Fr[Dr++]=Pr[0]>>>8&255,Fr[Dr++]=Pr[0]&255),pr=new Uint8Array(Fr)}var Br=-1;for(mr=0;mr<pr.length-1;){if(pr[mr]==255&&pr[mr+1]==cr){Br=mr;break}mr++}if(Br==-1){var Wr=new Uint8Array(pr.length+10+3*Rr);Wr.set(pr);var Xr=pr.length;if(Br=pr.length,pr=Wr,pr[Xr++]=255,pr[Xr++]=cr,pr[Xr++]=0,pr[Xr++]=8+3*Rr,pr[Xr++]=8,pr[Xr++]=rr.height>>>8&255,pr[Xr++]=rr.height&255,pr[Xr++]=rr.width>>>8&255,pr[Xr++]=rr.width&255,pr[Xr++]=Rr,Rr==1)pr[Xr++]=1,pr[Xr++]=17,pr[Xr++]=0;else for(mr=0;mr<3;mr++)pr[Xr++]=mr+1,pr[Xr++]=mr!=0?17:(Cr&15)<<4|Ir&15,pr[Xr++]=mr}if(er[hr]==255&&er[hr+1]==ur){var Yr=er[hr+2]<<8|er[hr+3];for(gr=new Uint8Array(Yr+2),gr[0]=er[hr],gr[1]=er[hr+1],gr[2]=er[hr+2],gr[3]=er[hr+3],mr=0;mr<Yr-2;mr++)gr[mr+4]=er[hr+mr+4]}else{gr=new Uint8Array(8+2*Rr);var Qi=0;if(gr[Qi++]=255,gr[Qi++]=ur,gr[Qi++]=0,gr[Qi++]=6+2*Rr,gr[Qi++]=Rr,Rr==1)gr[Qi++]=1,gr[Qi++]=0;else for(mr=0;mr<3;mr++)gr[Qi++]=mr+1,gr[Qi++]=mr<<4|mr;gr[Qi++]=0,gr[Qi++]=63,gr[Qi++]=0}return{jpegOffset:tr,tables:pr,sosMarker:gr,sofPosition:Br}};UTIF.decode._decodeOldJPEG=function(rr,er,tr,ir,nr,sr){var ar,or,lr,cr,ur,dr=UTIF.decode._decodeOldJPEGInit(rr,er,tr,ir);if(dr.jpegOffset!=null)for(or=tr+ir-dr.jpegOffset,cr=new Uint8Array(or),ar=0;ar<or;ar++)cr[ar]=er[dr.jpegOffset+ar];else{for(lr=dr.tables.length,cr=new Uint8Array(lr+dr.sosMarker.length+ir+2),cr.set(dr.tables),ur=lr,cr[dr.sofPosition+5]=rr.height>>>8&255,cr[dr.sofPosition+6]=rr.height&255,cr[dr.sofPosition+7]=rr.width>>>8&255,cr[dr.sofPosition+8]=rr.width&255,(er[tr]!=255||er[tr+1]!=SOS)&&(cr.set(dr.sosMarker,ur),ur+=sosMarker.length),ar=0;ar<ir;ar++)cr[ur++]=er[tr+ar];cr[ur++]=255,cr[ur++]=EOI}var hr=new UTIF.JpegDecoder;hr.parse(cr);for(var pr=hr.getData({width:hr.width,height:hr.height,forceRGB:!0,isSourcePDF:!1}),ar=0;ar<pr.length;ar++)nr[sr+ar]=pr[ar];rr.t262&&rr.t262[0]==6&&(rr.t262[0]=2)};UTIF.decode._decodePackBits=function(rr,er,tr,ir,nr){for(var sr=new Int8Array(rr.buffer),ar=new Int8Array(ir.buffer),or=er+tr;er<or;){var lr=sr[er];if(er++,lr>=0&&lr<128)for(var cr=0;cr<lr+1;cr++)ar[nr]=sr[er],nr++,er++;if(lr>=-127&&lr<0){for(var cr=0;cr<-lr+1;cr++)ar[nr]=sr[er],nr++;er++}}return nr};UTIF.decode._decodeThunder=function(rr,er,tr,ir,nr){for(var sr=[0,1,0,-1],ar=[0,1,2,3,0,-3,-2,-1],or=er+tr,lr=nr*2,cr=0;er<or;){var ur=rr[er],dr=ur>>>6,hr=ur&63;if(er++,dr==3&&(cr=hr&15,ir[lr>>>1]|=cr<<4*(1-lr&1),lr++),dr==0)for(var pr=0;pr<hr;pr++)ir[lr>>>1]|=cr<<4*(1-lr&1),lr++;if(dr==2)for(var pr=0;pr<2;pr++){var gr=hr>>>3*(1-pr)&7;gr!=4&&(cr+=ar[gr],ir[lr>>>1]|=cr<<4*(1-lr&1),lr++)}if(dr==1)for(var pr=0;pr<3;pr++){var gr=hr>>>2*(2-pr)&3;gr!=2&&(cr+=sr[gr],ir[lr>>>1]|=cr<<4*(1-lr&1),lr++)}}};UTIF.decode._dmap={1:0,"011":1,"000011":2,"0000011":3,"010":-1,"000010":-2,"0000010":-3};UTIF.decode._lens=function(){var rr=function(lr,cr,ur,dr){for(var hr=0;hr<cr.length;hr++)lr[cr[hr]]=ur+hr*dr},er="00110101,000111,0111,1000,1011,1100,1110,1111,10011,10100,00111,01000,001000,000011,110100,110101,101010,101011,0100111,0001100,0001000,0010111,0000011,0000100,0101000,0101011,0010011,0100100,0011000,00000010,00000011,00011010,00011011,00010010,00010011,00010100,00010101,00010110,00010111,00101000,00101001,00101010,00101011,00101100,00101101,00000100,00000101,00001010,00001011,01010010,01010011,01010100,01010101,00100100,00100101,01011000,01011001,01011010,01011011,01001010,01001011,00110010,00110011,00110100",tr="0000110111,010,11,10,011,0011,0010,00011,000101,000100,0000100,0000101,0000111,00000100,00000111,000011000,0000010111,0000011000,0000001000,00001100111,00001101000,00001101100,00000110111,00000101000,00000010111,00000011000,000011001010,000011001011,000011001100,000011001101,000001101000,000001101001,000001101010,000001101011,000011010010,000011010011,000011010100,000011010101,000011010110,000011010111,000001101100,000001101101,000011011010,000011011011,000001010100,000001010101,000001010110,000001010111,000001100100,000001100101,000001010010,000001010011,000000100100,000000110111,000000111000,000000100111,000000101000,000001011000,000001011001,000000101011,000000101100,000001011010,000001100110,000001100111",ir="11011,10010,010111,0110111,00110110,00110111,01100100,01100101,01101000,01100111,011001100,011001101,011010010,011010011,011010100,011010101,011010110,011010111,011011000,011011001,011011010,011011011,010011000,010011001,010011010,011000,010011011",nr="0000001111,000011001000,000011001001,000001011011,000000110011,000000110100,000000110101,0000001101100,0000001101101,0000001001010,0000001001011,0000001001100,0000001001101,0000001110010,0000001110011,0000001110100,0000001110101,0000001110110,0000001110111,0000001010010,0000001010011,0000001010100,0000001010101,0000001011010,0000001011011,0000001100100,0000001100101",sr="00000001000,00000001100,00000001101,000000010010,000000010011,000000010100,000000010101,000000010110,000000010111,000000011100,000000011101,000000011110,000000011111";er=er.split(","),tr=tr.split(","),ir=ir.split(","),nr=nr.split(","),sr=sr.split(",");var ar={},or={};return rr(ar,er,0,1),rr(ar,ir,64,64),rr(ar,sr,1792,64),rr(or,tr,0,1),rr(or,nr,64,64),rr(or,sr,1792,64),[ar,or]}();UTIF.decode._decodeG4=function(rr,er,tr,ir,nr,sr,ar){for(var or=UTIF.decode,lr=er<<3,cr=0,ur="",dr=[],hr=[],pr=0;pr<sr;pr++)hr.push(0);hr=or._makeDiff(hr);for(var gr=0,vr=0,mr=0,fr=0,_r=0,Ar=0,yr=0,wr="",xr=0,Sr=Math.ceil(sr/8)*8;lr>>>3<er+tr;){fr=or._findDiff(hr,gr+(gr==0?0:1),1-Ar),_r=or._findDiff(hr,fr,Ar);var br=0;if(ar==1&&(br=rr[lr>>>3]>>>7-(lr&7)&1),ar==2&&(br=rr[lr>>>3]>>>(lr&7)&1),lr++,ur+=br,wr=="H"){if(or._lens[Ar][ur]!=null){var Cr=or._lens[Ar][ur];ur="",cr+=Cr,Cr<64&&(or._addNtimes(dr,cr,Ar),gr+=cr,Ar=1-Ar,cr=0,xr--,xr==0&&(wr=""))}}else ur=="0001"&&(ur="",or._addNtimes(dr,_r-gr,Ar),gr=_r),ur=="001"&&(ur="",wr="H",xr=2),or._dmap[ur]!=null&&(vr=fr+or._dmap[ur],or._addNtimes(dr,vr-gr,Ar),gr=vr,ur="",Ar=1-Ar);dr.length==sr&&wr==""&&(or._writeBits(dr,ir,nr*8+yr*Sr),Ar=0,yr++,gr=0,hr=or._makeDiff(dr),dr=[])}};UTIF.decode._findDiff=function(rr,er,tr){for(var ir=0;ir<rr.length;ir+=2)if(rr[ir]>=er&&rr[ir+1]==tr)return rr[ir]};UTIF.decode._makeDiff=function(rr){var er=[];rr[0]==1&&er.push(0,1);for(var tr=1;tr<rr.length;tr++)rr[tr-1]!=rr[tr]&&er.push(tr,rr[tr]);return er.push(rr.length,0,rr.length,1),er};UTIF.decode._decodeG2=function(rr,er,tr,ir,nr,sr,ar){for(var or=UTIF.decode,lr=er<<3,cr=0,ur="",dr=[],hr=0,pr=0,gr=Math.ceil(sr/8)*8;lr>>>3<er+tr;){var vr=0;ar==1&&(vr=rr[lr>>>3]>>>7-(lr&7)&1),ar==2&&(vr=rr[lr>>>3]>>>(lr&7)&1),lr++,ur+=vr,cr=or._lens[hr][ur],cr!=null&&(or._addNtimes(dr,cr,hr),ur="",cr<64&&(hr=1-hr),dr.length==sr&&(or._writeBits(dr,ir,nr*8+pr*gr),dr=[],pr++,hr=0,lr&7&&(lr+=8-(lr&7)),cr>=64&&(lr+=8)))}};UTIF.decode._decodeG3=function(rr,er,tr,ir,nr,sr,ar,or){for(var lr=UTIF.decode,cr=er<<3,ur=0,dr="",hr=[],pr=[],gr=0;gr<sr;gr++)hr.push(0);for(var vr=0,mr=0,fr=0,_r=0,Ar=0,yr=0,wr=-1,xr="",Sr=0,br=!0,Cr=Math.ceil(sr/8)*8;cr>>>3<er+tr;){_r=lr._findDiff(pr,vr+(vr==0?0:1),1-yr),Ar=lr._findDiff(pr,_r,yr);var Ir=0;if(ar==1&&(Ir=rr[cr>>>3]>>>7-(cr&7)&1),ar==2&&(Ir=rr[cr>>>3]>>>(cr&7)&1),cr++,dr+=Ir,br){if(lr._lens[yr][dr]!=null){var Rr=lr._lens[yr][dr];dr="",ur+=Rr,Rr<64&&(lr._addNtimes(hr,ur,yr),yr=1-yr,ur=0)}}else if(xr=="H"){if(lr._lens[yr][dr]!=null){var Rr=lr._lens[yr][dr];dr="",ur+=Rr,Rr<64&&(lr._addNtimes(hr,ur,yr),vr+=ur,yr=1-yr,ur=0,Sr--,Sr==0&&(xr=""))}}else dr=="0001"&&(dr="",lr._addNtimes(hr,Ar-vr,yr),vr=Ar),dr=="001"&&(dr="",xr="H",Sr=2),lr._dmap[dr]!=null&&(mr=_r+lr._dmap[dr],lr._addNtimes(hr,mr-vr,yr),vr=mr,dr="",yr=1-yr);dr.endsWith("000000000001")&&(wr>=0&&lr._writeBits(hr,ir,nr*8+wr*Cr),or&&(ar==1&&(br=(rr[cr>>>3]>>>7-(cr&7)&1)==1),ar==2&&(br=(rr[cr>>>3]>>>(cr&7)&1)==1),cr++),dr="",yr=0,wr++,vr=0,pr=lr._makeDiff(hr),hr=[])}hr.length==sr&&lr._writeBits(hr,ir,nr*8+wr*Cr)};UTIF.decode._addNtimes=function(rr,er,tr){for(var ir=0;ir<er;ir++)rr.push(tr)};UTIF.decode._writeBits=function(rr,er,tr){for(var ir=0;ir<rr.length;ir++)er[tr+ir>>>3]|=rr[ir]<<7-(tr+ir&7)};UTIF.decode._decodeLZW=UTIF.decode._decodeLZW=function(){var rr,er,tr,ir,nr=0,sr=0,ar=0,or=0,lr=function(){var mr=rr>>>3,fr=er[mr]<<16|er[mr+1]<<8|er[mr+2],_r=fr>>>24-(rr&7)-sr&(1<<sr)-1;return rr+=sr,_r},cr=new Uint32Array(4096*4),ur=0,dr=function(mr){if(mr!=ur){ur=mr,ar=1<<mr,or=ar+1;for(var fr=0;fr<or+1;fr++)cr[4*fr]=cr[4*fr+3]=fr,cr[4*fr+1]=65535,cr[4*fr+2]=1}},hr=function(mr){sr=mr+1,nr=or+1},pr=function(mr){for(var fr=mr<<2,_r=cr[fr+2],Ar=ir+_r-1;fr!=65535;)tr[Ar--]=cr[fr],fr=cr[fr+1];ir+=_r},gr=function(mr,fr){var _r=nr<<2,Ar=mr<<2;cr[_r]=cr[(fr<<2)+3],cr[_r+1]=Ar,cr[_r+2]=cr[Ar+2]+1,cr[_r+3]=cr[Ar+3],nr++,nr+1==1<<sr&&sr!=12&&sr++},vr=function(mr,fr,_r,Ar,yr,wr){rr=fr<<3,er=mr,tr=Ar,ir=yr;var xr=fr+_r<<3,Sr=0,br=0;for(dr(wr),hr(wr);rr<xr&&(Sr=lr())!=or;){if(Sr==ar){if(hr(wr),Sr=lr(),Sr==or)break;pr(Sr)}else Sr<nr?(pr(Sr),gr(br,Sr)):(gr(br,br),pr(nr-1));br=Sr}return ir};return vr}();UTIF.tags={};UTIF._types=function(){var rr=new Array(250);rr.fill(0),rr=rr.concat([0,0,0,0,4,3,3,3,3,3,0,0,3,0,0,0,3,0,0,2,2,2,2,4,3,0,0,3,4,4,3,3,5,5,3,2,5,5,0,0,0,0,4,4,0,0,3,3,0,0,0,0,0,0,0,2,2,0,0,0,0,0,0,0,0,2,2,3,5,5,3,0,3,3,4,4,4,3,4,0,0,0,0,0,0,0,0,0,3,3,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);var er={33432:2,33434:5,33437:5,34665:4,34850:3,34853:4,34855:3,34864:3,34866:4,36864:7,36867:2,36868:2,37121:7,37377:10,37378:5,37380:10,37381:5,37383:3,37384:3,37385:3,37386:5,37510:7,37520:2,37521:2,37522:2,40960:7,40961:3,40962:4,40963:4,40965:4,41486:5,41487:5,41488:3,41985:3,41986:3,41987:3,41988:5,41989:3,41990:3,41993:3,41994:3,41995:7,41996:3,42032:2,42033:2,42034:5,42036:2,42037:2,59932:7};return{basic:{main:rr,rest:er},gps:{main:[1,2,5,2,5,1,5,5,0,9],rest:{18:2,29:2}}}}();UTIF._readIFD=function(rr,er,tr,ir,nr,sr){var ar=rr.readUshort(er,tr);tr+=2;var or={};sr.debug&&log("   ".repeat(nr),ir.length-1,">>>----------------");for(var lr=0;lr<ar;lr++){var cr=rr.readUshort(er,tr);tr+=2;var ur=rr.readUshort(er,tr);tr+=2;var dr=rr.readUint(er,tr);tr+=4;var hr=rr.readUint(er,tr);tr+=4;var pr=[];if(ur==1||ur==7){var gr=dr<5?tr-4:hr;gr+dr>er.buffer.byteLength&&(dr=er.buffer.byteLength-gr),pr=new Uint8Array(er.buffer,gr,dr)}if(ur==2){var vr=dr<5?tr-4:hr,mr=er[vr],fr=Math.max(0,Math.min(dr-1,er.length-vr));mr<128||fr==0?pr.push(rr.readASCII(er,vr,fr)):pr=new Uint8Array(er.buffer,vr,fr)}if(ur==3)for(var _r=0;_r<dr;_r++)pr.push(rr.readUshort(er,(dr<3?tr-4:hr)+2*_r));if(ur==4||ur==13)for(var _r=0;_r<dr;_r++)pr.push(rr.readUint(er,(dr<2?tr-4:hr)+4*_r));if(ur==5||ur==10)for(var Ar=ur==5?rr.readUint:rr.readInt,_r=0;_r<dr;_r++)pr.push([Ar(er,hr+_r*8),Ar(er,hr+_r*8+4)]);if(ur==8)for(var _r=0;_r<dr;_r++)pr.push(rr.readShort(er,(dr<3?tr-4:hr)+2*_r));if(ur==9)for(var _r=0;_r<dr;_r++)pr.push(rr.readInt(er,(dr<2?tr-4:hr)+4*_r));if(ur==11)for(var _r=0;_r<dr;_r++)pr.push(rr.readFloat(er,hr+_r*4));if(ur==12)for(var _r=0;_r<dr;_r++)pr.push(rr.readDouble(er,hr+_r*8));if(dr!=0&&pr.length==0){if(log(cr,"unknown TIFF tag type: ",ur,"num:",dr),lr==0)return;continue}if(sr.debug&&log("   ".repeat(nr),cr,ur,UTIF.tags[cr],pr),or["t"+cr]=pr,!(cr==330&&or.t272&&or.t272[0]=="DSLR-A100")){if(cr==330||cr==34665||cr==34853||cr==50740&&rr.readUshort(er,rr.readUint(pr,0))<300||cr==61440){for(var yr=cr==50740?[rr.readUint(pr,0)]:pr,wr=[],_r=0;_r<yr.length;_r++)UTIF._readIFD(rr,er,yr[_r],wr,nr+1,sr);cr==330&&(or.subIFD=wr),cr==34665&&(or.exifIFD=wr[0]),cr==34853&&(or.gpsiIFD=wr[0]),cr==50740&&(or.dngPrvt=wr[0]),cr==61440&&(or.fujiIFD=wr[0])}}if(cr==37500&&sr.parseMN){var xr=pr;if(rr.readASCII(xr,0,5)=="Nikon")or.makerNote=UTIF.decode(xr.slice(10).buffer)[0];else if(rr.readASCII(xr,0,5)=="OLYMP"||rr.readASCII(xr,0,9)=="OM SYSTEM"){var Sr=[8208,8224,8240,8256,8272],br=[];UTIF._readIFD(rr,xr,xr[1]==77?16:xr[5]==85?12:8,br,nr+1,sr);for(var Cr=or.makerNote=br.pop(),_r=0;_r<Sr.length;_r++){var Ir="t"+Sr[_r];Cr[Ir]!=null&&(UTIF._readIFD(rr,xr,Cr[Ir][0],br,nr+1,sr),Cr[Ir]=br.pop())}Cr.t12288&&(UTIF._readIFD(rr,Cr.t12288,0,br,nr+1,sr),Cr.t12288=br.pop())}else if(rr.readUshort(er,hr)<300&&rr.readUshort(er,hr+4)<=12){var br=[];UTIF._readIFD(rr,er,hr,br,nr+1,sr),or.makerNote=br[0]}}}return ir.push(or),sr.debug&&log("   ".repeat(nr),"<<<---------------"),tr};UTIF._writeIFD=function(rr,er,tr,ir,nr){var sr=Object.keys(nr),ar=sr.length;nr.exifIFD&&ar--,nr.gpsiIFD&&ar--,rr.writeUshort(tr,ir,ar),ir+=2;for(var or=ir+ar*12+4,lr=0;lr<sr.length;lr++){var cr=sr[lr];if(!(cr=="t34665"||cr=="t34853")){cr=="exifIFD"&&(cr="t34665"),cr=="gpsiIFD"&&(cr="t34853");var ur=parseInt(cr.slice(1)),dr=er.main[ur];if(dr==null&&(dr=er.rest[ur]),dr==null||dr==0)throw new Error("unknown type of tag: "+ur);var hr=nr[cr];if(ur==34665){var pr=UTIF._writeIFD(rr,er,tr,or,nr.exifIFD);hr=[or],or=pr[1]}if(ur==34853){var pr=UTIF._writeIFD(rr,UTIF._types.gps,tr,or,nr.gpsiIFD);hr=[or],or=pr[1]}dr==2&&(hr=hr[0]+"\0");var gr=hr.length;rr.writeUshort(tr,ir,ur),ir+=2,rr.writeUshort(tr,ir,dr),ir+=2,rr.writeUint(tr,ir,gr),ir+=4;var vr=[-1,1,1,2,4,8,0,1,0,4,8,0,8][dr]*gr,mr=ir;if(vr>4&&(rr.writeUint(tr,ir,or),mr=or),dr==1||dr==7)for(var fr=0;fr<gr;fr++)tr[mr+fr]=hr[fr];else if(dr==2)rr.writeASCII(tr,mr,hr);else if(dr==3)for(var fr=0;fr<gr;fr++)rr.writeUshort(tr,mr+2*fr,hr[fr]);else if(dr==4)for(var fr=0;fr<gr;fr++)rr.writeUint(tr,mr+4*fr,hr[fr]);else if(dr==5||dr==10)for(var _r=dr==5?rr.writeUint:rr.writeInt,fr=0;fr<gr;fr++){var Ar=hr[fr],yr=Ar[0],wr=Ar[1];if(yr==null)throw"e";_r(tr,mr+8*fr,yr),_r(tr,mr+8*fr+4,wr)}else if(dr==9)for(var fr=0;fr<gr;fr++)rr.writeInt(tr,mr+4*fr,hr[fr]);else if(dr==12)for(var fr=0;fr<gr;fr++)rr.writeDouble(tr,mr+8*fr,hr[fr]);else throw dr;vr>4&&(vr+=vr&1,or+=vr),ir+=4}}return[ir,or]};UTIF.toRGBA8=function(rr,er){function tr(Yi){return Yi<.0031308?12.92*Yi:1.055*Math.pow(Yi,1/2.4)-.055}var ir=rr.width,nr=rr.height,sr=ir*nr,ar=sr*4,or=rr.data,lr=new Uint8Array(sr*4),cr=rr.t262?rr.t262[0]:2,ur=rr.t258?Math.min(32,rr.t258[0]):1;rr.t262==null&&ur==1&&(cr=0);var dr=rr.t277?rr.t277[0]:rr.t258?rr.t258.length:[1,1,3,1,1,4,3][cr],hr=rr.t339?rr.t339[0]:null;if(cr==1&&ur==32&&hr!=3)throw"e";var pr=Math.ceil(dr*ur*ir/8);if(cr==0){er=1/256;for(var gr=0;gr<nr;gr++){var vr=gr*pr,mr=gr*ir;if(ur==1)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+(fr>>3)]>>7-(fr&7)&1;lr[_r]=lr[_r+1]=lr[_r+2]=(1-Ar)*255,lr[_r+3]=255}if(ur==4)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+(fr>>1)]>>4-4*(fr&1)&15;lr[_r]=lr[_r+1]=lr[_r+2]=(15-Ar)*17,lr[_r+3]=255}if(ur==8)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+fr];lr[_r]=lr[_r+1]=lr[_r+2]=255-Ar,lr[_r+3]=255}if(ur==16)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,yr=vr+2*fr,Ar=or[yr+1]<<8|or[yr];lr[_r]=lr[_r+1]=lr[_r+2]=Math.min(255,255-~~(Ar*er)),lr[_r+3]=255}}}else if(cr==1){er==null&&(er=1/256);for(var wr=or.length&3?null:new Float32Array(or.buffer),gr=0;gr<nr;gr++){var vr=gr*pr,mr=gr*ir;if(ur==1)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+(fr>>3)]>>7-(fr&7)&1;lr[_r]=lr[_r+1]=lr[_r+2]=Ar*255,lr[_r+3]=255}if(ur==2)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+(fr>>2)]>>6-2*(fr&3)&3;lr[_r]=lr[_r+1]=lr[_r+2]=Ar*85,lr[_r+3]=255}if(ur==8)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,Ar=or[vr+fr*dr];lr[_r]=lr[_r+1]=lr[_r+2]=Ar,lr[_r+3]=255}if(ur==16)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,yr=vr+2*fr,Ar=or[yr+1]<<8|or[yr];lr[_r]=lr[_r+1]=lr[_r+2]=Math.min(255,~~(Ar*er)),lr[_r+3]=255}if(ur==32)for(var fr=0;fr<ir;fr++){var _r=mr+fr<<2,yr=(vr>>>2)+fr,Ar=wr[yr];lr[_r]=lr[_r+1]=lr[_r+2]=~~(.5+255*Ar),lr[_r+3]=255}}}else if(cr==2)if(ur==8){if(dr==1)for(var fr=0;fr<sr;fr++)lr[4*fr]=lr[4*fr+1]=lr[4*fr+2]=or[fr],lr[4*fr+3]=255;if(dr==3)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*3;lr[_r]=or[xr],lr[_r+1]=or[xr+1],lr[_r+2]=or[xr+2],lr[_r+3]=255}if(dr>=4)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*dr;lr[_r]=or[xr],lr[_r+1]=or[xr+1],lr[_r+2]=or[xr+2],lr[_r+3]=or[xr+3]}}else if(ur==16){if(dr==4)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*8+1;lr[_r]=or[xr],lr[_r+1]=or[xr+2],lr[_r+2]=or[xr+4],lr[_r+3]=or[xr+6]}if(dr==3)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*6+1;lr[_r]=or[xr],lr[_r+1]=or[xr+2],lr[_r+2]=or[xr+4],lr[_r+3]=255}}else if(ur==32){for(var Sr=new Float32Array(or.buffer),br=0,fr=0;fr<Sr.length;fr++)br=Math.min(br,Sr[fr]);if(br<0)for(var fr=0;fr<or.length;fr+=4){var Cr=or[fr];or[fr]=or[fr+3],or[fr+3]=Cr,Cr=or[fr+1],or[fr+1]=or[fr+2],or[fr+2]=Cr}for(var Ir=[],fr=0;fr<65536;fr++)Ir.push(tr(fr/65535));for(var fr=0;fr<Sr.length;fr++){var Rr=Math.max(0,Math.min(1,Sr[fr]));Sr[fr]=Ir[~~(.5+Rr*65535)]}if(dr==3)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*3;lr[_r]=~~(.5+Sr[xr]*255),lr[_r+1]=~~(.5+Sr[xr+1]*255),lr[_r+2]=~~(.5+Sr[xr+2]*255),lr[_r+3]=255}else if(dr==4)for(var fr=0;fr<sr;fr++){var _r=fr<<2,xr=fr*4;lr[_r]=~~(.5+Sr[xr]*255),lr[_r+1]=~~(.5+Sr[xr+1]*255),lr[_r+2]=~~(.5+Sr[xr+2]*255),lr[_r+3]=~~(.5+Sr[xr+3]*255)}else throw dr}else throw ur;else if(cr==3)for(var Pr=rr.t320,Dr=1<<ur,Fr=ur==8&&dr>1&&rr.t338&&rr.t338[0]!=0,gr=0;gr<nr;gr++)for(var Or=0;Or<ir;Or++){var fr=gr*ir+Or,_r=fr<<2,Nr=0,Ur=gr*pr;if(ur==1)Nr=or[Ur+(Or>>>3)]>>>7-(Or&7)&1;else if(ur==2)Nr=or[Ur+(Or>>>2)]>>>6-2*(Or&3)&3;else if(ur==4)Nr=or[Ur+(Or>>>1)]>>>4-4*(Or&1)&15;else if(ur==8)Nr=or[Ur+Or*dr];else throw ur;lr[_r]=Pr[Nr]>>8,lr[_r+1]=Pr[Dr+Nr]>>8,lr[_r+2]=Pr[Dr+Dr+Nr]>>8,lr[_r+3]=Fr?or[Ur+Or*dr+1]:255}else if(cr==5)for(var Br=dr>4?1:0,fr=0;fr<sr;fr++){var _r=fr<<2,Wr=fr*dr;if(window.UDOC){var Xr=or[Wr],Yr=or[Wr+1],Qi=or[Wr+2],Xi=or[Wr+3],Kr=UDOC.C.cmykToRgb([Xr*(1/255),Yr*(1/255),Qi*(1/255),Xi*(1/255)]);lr[_r]=~~(.5+255*Kr[0]),lr[_r+1]=~~(.5+255*Kr[1]),lr[_r+2]=~~(.5+255*Kr[2])}else{var Xr=255-or[Wr],Yr=255-or[Wr+1],Qi=255-or[Wr+2],Xi=(255-or[Wr+3])*(1/255);lr[_r]=~~(Xr*Xi+.5),lr[_r+1]=~~(Yr*Xi+.5),lr[_r+2]=~~(Qi*Xi+.5)}lr[_r+3]=255*(1-Br)+or[Wr+4]*Br}else if(cr==6&&rr.t278)for(var $r=rr.t278[0],gr=0;gr<nr;gr+=$r)for(var fr=gr*ir,Vr=$r*ir,Gr=0;Gr<Vr;Gr++){var _r=4*(fr+Gr),Wr=3*fr+4*(Gr>>>1),Qi=or[Wr+(Gr&1)],qr=or[Wr+2]-128,ji=or[Wr+3]-128,Jr=Qi+((ji>>2)+(ji>>3)+(ji>>5)),Ji=Qi-((qr>>2)+(qr>>4)+(qr>>5))-((ji>>1)+(ji>>3)+(ji>>4)+(ji>>5)),Ki=Qi+(qr+(qr>>1)+(qr>>2)+(qr>>6));lr[_r]=Math.max(0,Math.min(255,Jr)),lr[_r+1]=Math.max(0,Math.min(255,Ji)),lr[_r+2]=Math.max(0,Math.min(255,Ki)),lr[_r+3]=255}else if(cr==32845)for(var gr=0;gr<nr;gr++)for(var Or=0;Or<ir;Or++){var Wr=(gr*ir+Or)*6,_r=(gr*ir+Or)*4,Zi=or[Wr+1]<<8|or[Wr],Zi=Math.pow(2,(Zi+.5)/256-64),Zr=(or[Wr+3]+.5)/410,is=(or[Wr+5]+.5)/410,os=9*Zr/(6*Zr-16*is+12),cs=4*is/(6*Zr-16*is+12),ss=Zi,es=os*ss/cs,Qi=ss,ms=(1-os-cs)*ss/cs,Jr=2.69*es-1.276*Qi-.414*ms,Ji=-1.022*es+1.978*Qi+.044*ms,Ki=.061*es-.224*Qi+1.163*ms;lr[_r]=tr(Math.min(Jr,1))*255,lr[_r+1]=tr(Math.min(Ji,1))*255,lr[_r+2]=tr(Math.min(Ki,1))*255,lr[_r+3]=255}else log("Unknown Photometric interpretation: "+cr);return lr};UTIF.replaceIMG=function(rr){rr==null&&(rr=document.getElementsByTagName("img"));for(var er=["tif","tiff","dng","cr2","nef"],tr=0;tr<rr.length;tr++){var ir=rr[tr],nr=ir.getAttribute("src");if(nr!=null){var sr=nr.split(".").pop().toLowerCase();if(er.indexOf(sr)!=-1){var ar=new XMLHttpRequest;UTIF._xhrs.push(ar),UTIF._imgs.push(ir),ar.open("GET",nr),ar.responseType="arraybuffer",ar.onload=UTIF._imgLoaded,ar.send()}}}};UTIF._xhrs=[];UTIF._imgs=[];UTIF._imgLoaded=function(rr){var er=UTIF._xhrs.indexOf(rr.target),tr=UTIF._imgs[er];UTIF._xhrs.splice(er,1),UTIF._imgs.splice(er,1),tr.setAttribute("src",UTIF.bufferToURI(rr.target.response))};UTIF.bufferToURI=function(rr){var er=UTIF.decode(rr),tr=er,ir=0,nr=tr[0];er[0].subIFD&&(tr=tr.concat(er[0].subIFD));for(var sr=0;sr<tr.length;sr++){var ar=tr[sr];if(!(ar.t258==null||ar.t258.length<3)){var or=ar.t256*ar.t257;or>ir&&(ir=or,nr=ar)}}UTIF.decodeImage(rr,nr,er);var lr=UTIF.toRGBA8(nr),cr=nr.width,ur=nr.height,dr=document.createElement("canvas");dr.width=cr,dr.height=ur;var hr=dr.getContext("2d"),pr=new ImageData(new Uint8ClampedArray(lr.buffer),cr,ur);return hr.putImageData(pr,0,0),dr.toDataURL()};UTIF._binBE={nextZero:function(rr,er){for(;rr[er]!=0;)er++;return er},readUshort:function(rr,er){return rr[er]<<8|rr[er+1]},readShort:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+1],tr[1]=rr[er+0],UTIF._binBE.i16[0]},readInt:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+3],tr[1]=rr[er+2],tr[2]=rr[er+1],tr[3]=rr[er+0],UTIF._binBE.i32[0]},readUint:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+3],tr[1]=rr[er+2],tr[2]=rr[er+1],tr[3]=rr[er+0],UTIF._binBE.ui32[0]},readASCII:function(rr,er,tr){for(var ir="",nr=0;nr<tr;nr++)ir+=String.fromCharCode(rr[er+nr]);return ir},readFloat:function(rr,er){for(var tr=UTIF._binBE.ui8,ir=0;ir<4;ir++)tr[ir]=rr[er+3-ir];return UTIF._binBE.fl32[0]},readDouble:function(rr,er){for(var tr=UTIF._binBE.ui8,ir=0;ir<8;ir++)tr[ir]=rr[er+7-ir];return UTIF._binBE.fl64[0]},writeUshort:function(rr,er,tr){rr[er]=tr>>8&255,rr[er+1]=tr&255},writeInt:function(rr,er,tr){var ir=UTIF._binBE.ui8;UTIF._binBE.i32[0]=tr,rr[er+3]=ir[0],rr[er+2]=ir[1],rr[er+1]=ir[2],rr[er+0]=ir[3]},writeUint:function(rr,er,tr){rr[er]=tr>>24&255,rr[er+1]=tr>>16&255,rr[er+2]=tr>>8&255,rr[er+3]=tr>>0&255},writeASCII:function(rr,er,tr){for(var ir=0;ir<tr.length;ir++)rr[er+ir]=tr.charCodeAt(ir)},writeDouble:function(rr,er,tr){UTIF._binBE.fl64[0]=tr;for(var ir=0;ir<8;ir++)rr[er+ir]=UTIF._binBE.ui8[7-ir]}};UTIF._binBE.ui8=new Uint8Array(8);UTIF._binBE.i16=new Int16Array(UTIF._binBE.ui8.buffer);UTIF._binBE.i32=new Int32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.ui32=new Uint32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.fl32=new Float32Array(UTIF._binBE.ui8.buffer);UTIF._binBE.fl64=new Float64Array(UTIF._binBE.ui8.buffer);UTIF._binLE={nextZero:UTIF._binBE.nextZero,readUshort:function(rr,er){return rr[er+1]<<8|rr[er]},readShort:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+0],tr[1]=rr[er+1],UTIF._binBE.i16[0]},readInt:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+0],tr[1]=rr[er+1],tr[2]=rr[er+2],tr[3]=rr[er+3],UTIF._binBE.i32[0]},readUint:function(rr,er){var tr=UTIF._binBE.ui8;return tr[0]=rr[er+0],tr[1]=rr[er+1],tr[2]=rr[er+2],tr[3]=rr[er+3],UTIF._binBE.ui32[0]},readASCII:UTIF._binBE.readASCII,readFloat:function(rr,er){for(var tr=UTIF._binBE.ui8,ir=0;ir<4;ir++)tr[ir]=rr[er+ir];return UTIF._binBE.fl32[0]},readDouble:function(rr,er){for(var tr=UTIF._binBE.ui8,ir=0;ir<8;ir++)tr[ir]=rr[er+ir];return UTIF._binBE.fl64[0]},writeUshort:function(rr,er,tr){rr[er]=tr&255,rr[er+1]=tr>>8&255},writeInt:function(rr,er,tr){var ir=UTIF._binBE.ui8;UTIF._binBE.i32[0]=tr,rr[er+0]=ir[0],rr[er+1]=ir[1],rr[er+2]=ir[2],rr[er+3]=ir[3]},writeUint:function(rr,er,tr){rr[er]=tr>>>0&255,rr[er+1]=tr>>>8&255,rr[er+2]=tr>>>16&255,rr[er+3]=tr>>>24&255},writeASCII:UTIF._binBE.writeASCII};UTIF._copyTile=function(rr,er,tr,ir,nr,sr,ar,or){for(var lr=Math.min(er,nr-ar),cr=Math.min(tr,sr-or),ur=0;ur<cr;ur++)for(var dr=(or+ur)*nr+ar,hr=ur*er,pr=0;pr<lr;pr++)ir[dr+pr]=rr[hr+pr]};UTIF._inflateRaw=function(){var rr={};return rr.H={},rr.H.N=function(er,tr){var ir=Uint8Array,nr=0,sr=0,ar=0,or=0,lr=0,cr=0,ur=0,dr=0,hr=0,pr,gr;if(er[0]==3&&er[1]==0)return tr||new ir(0);var vr=rr.H,mr=vr.b,fr=vr.e,_r=vr.R,Ar=vr.n,yr=vr.A,wr=vr.Z,xr=vr.m,Sr=tr==null;for(Sr&&(tr=new ir(er.length>>>2<<5));nr==0;){if(nr=mr(er,hr,1),sr=mr(er,hr+1,2),hr+=3,sr==0){hr&7&&(hr+=8-(hr&7));var br=(hr>>>3)+4,Cr=er[br-4]|er[br-3]<<8;Sr&&(tr=rr.H.W(tr,dr+Cr)),tr.set(new ir(er.buffer,er.byteOffset+br,Cr),dr),hr=br+Cr<<3,dr+=Cr;continue}if(Sr&&(tr=rr.H.W(tr,dr+(1<<17))),sr==1&&(pr=xr.J,gr=xr.h,cr=511,ur=31),sr==2){ar=fr(er,hr,5)+257,or=fr(er,hr+5,5)+1,lr=fr(er,hr+10,4)+4,hr+=14;for(var Ir=hr,Rr=1,Pr=0;Pr<38;Pr+=2)xr.Q[Pr]=0,xr.Q[Pr+1]=0;for(var Pr=0;Pr<lr;Pr++){var Dr=fr(er,hr+Pr*3,3);xr.Q[(xr.X[Pr]<<1)+1]=Dr,Dr>Rr&&(Rr=Dr)}hr+=3*lr,Ar(xr.Q,Rr),yr(xr.Q,Rr,xr.u),pr=xr.w,gr=xr.d,hr=_r(xr.u,(1<<Rr)-1,ar+or,er,hr,xr.v);var Fr=vr.V(xr.v,0,ar,xr.C);cr=(1<<Fr)-1;var Or=vr.V(xr.v,ar,or,xr.D);ur=(1<<Or)-1,Ar(xr.C,Fr),yr(xr.C,Fr,pr),Ar(xr.D,Or),yr(xr.D,Or,gr)}for(;;){var Nr=pr[wr(er,hr)&cr];hr+=Nr&15;var Ur=Nr>>>4;if(!(Ur>>>8))tr[dr++]=Ur;else{if(Ur==256)break;var Br=dr+Ur-254;if(Ur>264){var Wr=xr.q[Ur-257];Br=dr+(Wr>>>3)+fr(er,hr,Wr&7),hr+=Wr&7}var Xr=gr[wr(er,hr)&ur];hr+=Xr&15;var Yr=Xr>>>4,Qi=xr.c[Yr],Xi=(Qi>>>4)+mr(er,hr,Qi&15);for(hr+=Qi&15;dr<Br;)tr[dr]=tr[dr++-Xi],tr[dr]=tr[dr++-Xi],tr[dr]=tr[dr++-Xi],tr[dr]=tr[dr++-Xi];dr=Br}}}return tr.length==dr?tr:tr.slice(0,dr)},rr.H.W=function(er,tr){var ir=er.length;if(tr<=ir)return er;var nr=new Uint8Array(ir<<1);return nr.set(er,0),nr},rr.H.R=function(er,tr,ir,nr,sr,ar){for(var or=rr.H.e,lr=rr.H.Z,cr=0;cr<ir;){var ur=er[lr(nr,sr)&tr];sr+=ur&15;var dr=ur>>>4;if(dr<=15)ar[cr]=dr,cr++;else{var hr=0,pr=0;dr==16?(pr=3+or(nr,sr,2),sr+=2,hr=ar[cr-1]):dr==17?(pr=3+or(nr,sr,3),sr+=3):dr==18&&(pr=11+or(nr,sr,7),sr+=7);for(var gr=cr+pr;cr<gr;)ar[cr]=hr,cr++}}return sr},rr.H.V=function(er,tr,ir,nr){for(var sr=0,ar=0,or=nr.length>>>1;ar<ir;){var lr=er[ar+tr];nr[ar<<1]=0,nr[(ar<<1)+1]=lr,lr>sr&&(sr=lr),ar++}for(;ar<or;)nr[ar<<1]=0,nr[(ar<<1)+1]=0,ar++;return sr},rr.H.n=function(er,tr){for(var ir=rr.H.m,nr=er.length,sr,ar,or,lr,cr,ur=ir.j,lr=0;lr<=tr;lr++)ur[lr]=0;for(lr=1;lr<nr;lr+=2)ur[er[lr]]++;var dr=ir.K;for(sr=0,ur[0]=0,ar=1;ar<=tr;ar++)sr=sr+ur[ar-1]<<1,dr[ar]=sr;for(or=0;or<nr;or+=2)cr=er[or+1],cr!=0&&(er[or]=dr[cr],dr[cr]++)},rr.H.A=function(er,tr,ir){for(var nr=er.length,sr=rr.H.m,ar=sr.r,or=0;or<nr;or+=2)if(er[or+1]!=0)for(var lr=or>>1,cr=er[or+1],ur=lr<<4|cr,dr=tr-cr,hr=er[or]<<dr,pr=hr+(1<<dr);hr!=pr;){var gr=ar[hr]>>>15-tr;ir[gr]=ur,hr++}},rr.H.l=function(er,tr){for(var ir=rr.H.m.r,nr=15-tr,sr=0;sr<er.length;sr+=2){var ar=er[sr]<<tr-er[sr+1];er[sr]=ir[ar]>>>nr}},rr.H.M=function(er,tr,ir){ir=ir<<(tr&7);var nr=tr>>>3;er[nr]|=ir,er[nr+1]|=ir>>>8},rr.H.I=function(er,tr,ir){ir=ir<<(tr&7);var nr=tr>>>3;er[nr]|=ir,er[nr+1]|=ir>>>8,er[nr+2]|=ir>>>16},rr.H.e=function(er,tr,ir){return(er[tr>>>3]|er[(tr>>>3)+1]<<8)>>>(tr&7)&(1<<ir)-1},rr.H.b=function(er,tr,ir){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)&(1<<ir)-1},rr.H.Z=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16)>>>(tr&7)},rr.H.i=function(er,tr){return(er[tr>>>3]|er[(tr>>>3)+1]<<8|er[(tr>>>3)+2]<<16|er[(tr>>>3)+3]<<24)>>>(tr&7)},rr.H.m=function(){var er=Uint16Array,tr=Uint32Array;return{K:new er(16),j:new er(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new er(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new tr(32),J:new er(512),_:[],h:new er(32),$:[],w:new er(32768),C:[],v:[],d:new er(32768),D:[],u:new er(512),Q:[],r:new er(32768),s:new tr(286),Y:new tr(30),a:new tr(19),t:new tr(15e3),k:new er(65536),g:new er(32768)}}(),function(){for(var er=rr.H.m,tr=32768,ir=0;ir<tr;ir++){var nr=ir;nr=(nr&2863311530)>>>1|(nr&1431655765)<<1,nr=(nr&3435973836)>>>2|(nr&858993459)<<2,nr=(nr&4042322160)>>>4|(nr&252645135)<<4,nr=(nr&4278255360)>>>8|(nr&16711935)<<8,er.r[ir]=(nr>>>16|nr<<16)>>>17}function sr(ar,or,lr){for(;or--!=0;)ar.push(0,lr)}for(var ir=0;ir<32;ir++)er.q[ir]=er.S[ir]<<3|er.T[ir],er.c[ir]=er.p[ir]<<4|er.z[ir];sr(er._,144,8),sr(er._,112,9),sr(er._,24,7),sr(er._,8,8),rr.H.n(er._,9),rr.H.A(er._,9,er.J),rr.H.l(er._,9),sr(er.$,32,5),rr.H.n(er.$,5),rr.H.A(er.$,5,er.h),rr.H.l(er.$,5),sr(er.Q,19,0),sr(er.C,286,0),sr(er.D,30,0),sr(er.v,320,0)}(),rr.H.N}();UTIF.LosslessJpegDecode=function(){var rr,er;function tr(){return rr[er++]}function ir(){return rr[er++]<<8|rr[er++]}function nr(mr){for(var fr=tr(),_r=[0,0,0,255],Ar=[],yr=8,wr=0;wr<16;wr++)Ar[wr]=tr();for(var wr=0;wr<16;wr++)for(var xr=0;xr<Ar[wr];xr++){var Sr=sr(_r,0,wr+1,1);_r[Sr+3]=tr()}var br=new Uint8Array(1<<yr);mr[fr]=[new Uint8Array(_r),br];for(var wr=0;wr<1<<yr;wr++){for(var Cr=yr,Ir=wr,Rr=0,Pr=0;_r[Rr+3]==255&&Cr!=0;)Pr=Ir>>--Cr&1,Rr=_r[Rr+Pr];br[wr]=Rr}}function sr(mr,fr,_r,Ar){if(mr[fr+3]!=255)return 0;if(_r==0)return fr;for(var yr=0;yr<2;yr++){mr[fr+yr]==0&&(mr[fr+yr]=mr.length,mr.push(0,0,Ar,255));var wr=sr(mr,mr[fr+yr],_r-1,Ar+1);if(wr!=0)return wr}return 0}function ar(mr){for(var fr=mr.b,_r=mr.f;fr<25&&mr.a<mr.d;){var Ar=mr.data[mr.a++];Ar==255&&!mr.c&&mr.a++,_r=_r<<8|Ar,fr+=8}if(fr<0)throw"e";mr.b=fr,mr.f=_r}function or(mr,fr){return fr.b<mr&&ar(fr),fr.f>>(fr.b-=mr)&65535>>16-mr}function lr(mr,fr){var _r=mr[0],Ar=0,yr=255,wr=0;fr.b<16&&ar(fr);var xr=fr.f>>fr.b-8&255;for(Ar=mr[1][xr],yr=_r[Ar+3],fr.b-=_r[Ar+2];yr==255;)wr=fr.f>>--fr.b&1,Ar=_r[Ar+wr],yr=_r[Ar+3];return yr}function cr(mr,fr){return mr<32768>>16-fr&&(mr+=-(1<<fr)+1),mr}function ur(mr,fr){var _r=lr(mr,fr);if(_r==0)return 0;if(_r==16)return-32768;var Ar=or(_r,fr);return cr(Ar,_r)}function dr(mr,fr,_r,Ar,yr,wr){for(var xr=0,Sr=0;Sr<wr;Sr++){for(var br=Sr*fr,Cr=0;Cr<fr;Cr+=yr){xr++;for(var Ir=0;Ir<yr;Ir++)mr[br+Cr+Ir]=ur(Ar[Ir],_r)}if(_r.e!=0&&xr%_r.e==0&&Sr!=0){for(var Rr=_r.a,Pr=_r.data;Pr[Rr]!=255||!(208<=Pr[Rr+1]&&Pr[Rr+1]<=215);)Rr--;_r.a=Rr+2,_r.f=0,_r.b=0}}}function hr(mr,fr){return cr(or(mr,fr),mr)}function pr(mr,fr,_r,Ar,yr){for(var wr=rr.length-er,xr=0;xr<wr;xr+=4){var Sr=rr[er+xr];rr[er+xr]=rr[er+xr+3],rr[er+xr+3]=Sr;var Sr=rr[er+xr+1];rr[er+xr+1]=rr[er+xr+2],rr[er+xr+2]=Sr}for(var br=0;br<yr;br++)for(var Cr=32768,Ir=32768,Rr=0;Rr<fr;Rr+=2){var Pr=lr(Ar,_r),Dr=lr(Ar,_r);Pr!=0&&(Cr+=hr(Pr,_r)),Dr!=0&&(Ir+=hr(Dr,_r)),mr[br*fr+Rr]=Cr&65535,mr[br*fr+Rr+1]=Ir&65535}}function gr(mr){if(rr=mr,er=0,ir()!=65496)throw"e";for(var fr=[],_r=0,Ar=0,yr=0,wr=[],xr=[],Sr=[],br=0,Cr=0,Ir=0;;){var Rr=ir();if(Rr==65535){er--;continue}var Pr=ir();if(Rr==65475){Ar=tr(),Cr=ir(),Ir=ir(),br=tr();for(var Dr=0;Dr<br;Dr++){var Fr=tr(),Or=tr(),Nr=tr();if(Nr!=0)throw"e";fr[Fr]=[Dr,Or>>4,Or&15]}}else if(Rr==65476)for(var Ur=er+Pr-2;er<Ur;)nr(xr);else if(Rr==65498){er++;for(var Dr=0;Dr<br;Dr++){var Br=tr(),Wr=fr[Br];Sr[Wr[0]]=xr[tr()>>>4],wr[Wr[0]]=Wr.slice(1)}_r=tr(),er+=2;break}else Rr==65501?yr=ir():er+=Pr-2}var Xr=Ar>8?Uint16Array:Uint8Array,Yr=new Xr(Cr*Ir*br),Qi={b:0,f:0,c:_r==8,a:er,data:rr,d:rr.length,e:yr};if(Qi.c)pr(Yr,Ir*br,Qi,Sr[0],Cr);else{for(var Xi=[],Kr=0,$r=0,Dr=0;Dr<br;Dr++){var Vr=wr[Dr],Gr=Vr[0],qr=Vr[1];Gr>Kr&&(Kr=Gr),qr>$r&&($r=qr),Xi.push(Gr*qr)}if(Kr!=1||$r!=1){if(br!=3||Xi[1]!=1||Xi[2]!=1||Kr!=2||$r!=1&&$r!=2)throw"e";for(var ji=[],Jr=0,Dr=0;Dr<br;Dr++){for(var Ji=0;Ji<Xi[Dr];Ji++)ji.push(Sr[Dr]);Jr+=Xi[Dr]}var Ki=Ir/Kr,Zi=Cr/$r,Zr=Ki*Zi;dr(Yr,Ki*Jr,Qi,ji,Jr,Zi),vr(Yr,_r,Ki,Zi,Jr-2,Jr,Jr,Ar);var is=new Uint16Array(Zr*Xi[0]);if(Kr==2&&$r==2){for(var Dr=0;Dr<Zr;Dr++)is[4*Dr]=Yr[6*Dr],is[4*Dr+1]=Yr[6*Dr+1],is[4*Dr+2]=Yr[6*Dr+2],is[4*Dr+3]=Yr[6*Dr+3];vr(is,_r,Ki*4,Zi,0,1,1,Ar);for(var Dr=0;Dr<Zr;Dr++)Yr[6*Dr]=is[4*Dr],Yr[6*Dr+1]=is[4*Dr+1],Yr[6*Dr+2]=is[4*Dr+2],Yr[6*Dr+3]=is[4*Dr+3]}if(Kr==2&&$r==1){for(var Dr=0;Dr<Zr;Dr++)is[2*Dr]=Yr[4*Dr],is[2*Dr+1]=Yr[4*Dr+1];vr(is,_r,Ki*2,Zi,0,1,1,Ar);for(var Dr=0;Dr<Zr;Dr++)Yr[4*Dr]=is[2*Dr],Yr[4*Dr+1]=is[2*Dr+1]}for(var os=Yr.slice(0),qr=0;qr<Cr;qr++)if($r==2)for(var Gr=0;Gr<Ir;Gr++){var cs=(qr*Ir+Gr)*br,ss=((qr>>>1)*Ki+(Gr>>>1))*Jr,es=(qr&1)*2+(Gr&1);Yr[cs]=os[ss+es],Yr[cs+1]=os[ss+4],Yr[cs+2]=os[ss+5]}else for(var Gr=0;Gr<Ir;Gr++){var cs=(qr*Ir+Gr)*br,ss=(qr*Ki+(Gr>>>1))*Jr,es=Gr&1;Yr[cs]=os[ss+es],Yr[cs+1]=os[ss+2],Yr[cs+2]=os[ss+3]}}else if(dr(Yr,Ir*br,Qi,Sr,br,Cr),yr==0)vr(Yr,_r,Ir,Cr,0,br,br,Ar);else for(var ms=Math.floor(yr/Ir),qr=0;qr<Cr;qr+=ms){var Yi=Yr.slice(qr*Ir*br,(qr+ms)*Ir*br);vr(Yi,_r,Ir,ms,0,br,br,Ar),Yr.set(Yi,qr*Ir*br)}}return Yr}function vr(mr,fr,_r,Ar,yr,wr,xr,Sr){for(var br=_r*xr,Cr=yr;Cr<wr;Cr++)mr[Cr]+=1<<Sr-1;for(var Ir=xr;Ir<br;Ir+=xr)for(var Cr=yr;Cr<wr;Cr++)mr[Ir+Cr]+=mr[Ir+Cr-xr];for(var Rr=1;Rr<Ar;Rr++){for(var Pr=Rr*br,Cr=yr;Cr<wr;Cr++)mr[Pr+Cr]+=mr[Pr+Cr-br];for(var Ir=xr;Ir<br;Ir+=xr)for(var Cr=yr;Cr<wr;Cr++){var Dr=Pr+Ir+Cr,Fr=Dr-br,Or=mr[Dr-xr],Nr=0;if(fr==0)Nr=0;else if(fr==1)Nr=Or;else if(fr==2)Nr=mr[Fr];else if(fr==3)Nr=mr[Fr-xr];else if(fr==4)Nr=Or+(mr[Fr]-mr[Fr-xr]);else if(fr==5)Nr=Or+(mr[Fr]-mr[Fr-xr]>>>1);else if(fr==6)Nr=mr[Fr]+(Or-mr[Fr-xr]>>>1);else if(fr==7)Nr=Or+mr[Fr]>>>1;else throw fr;mr[Dr]+=Nr}}}return gr}();(function(){var rr=0,er=1,tr=2,ir=3,nr=4,sr=5,ar=6,or=7,lr=8,cr=9,ur=10,dr=11,hr=12,pr=13,gr=14,vr=15,mr=16,fr=17,_r=18;function Ar(Br){var Wr=UTIF._binBE.readUshort,Xr={b:Wr(Br,0),i:Br[2],C:Br[3],u:Br[4],q:Wr(Br,5),k:Wr(Br,7),e:Wr(Br,9),l:Wr(Br,11),s:Br[13],d:Wr(Br,14)};if(Xr.b!=18771||Xr.i>1||Xr.q<6||Xr.q%6||Xr.e<768||Xr.e%24||Xr.l!=768||Xr.k<Xr.l||Xr.k%Xr.l||Xr.k-Xr.e>=Xr.l||Xr.s>16||Xr.s!=Xr.k/Xr.l||Xr.s!=Math.ceil(Xr.e/Xr.l)||Xr.d!=Xr.q/6||Xr.u!=12&&Xr.u!=14&&Xr.u!=16||Xr.C!=16&&Xr.C!=0)throw"Invalid data";if(Xr.i==0)throw"Not implemented. We need this file!";return Xr.h=Xr.C==16,Xr.m=(Xr.h?Xr.l*2/3:Xr.l>>>1)|0,Xr.A=Xr.m+2,Xr.f=64,Xr.g=(1<<Xr.u)-1,Xr.n=4*Xr.u,Xr}function yr(Br,Wr){var Xr=new Array(Wr.s),Yr=4*Wr.s,Qi=16+Yr;Yr&12&&(Qi+=16-(Yr&12));for(var Xi=0,Kr=16;Xi<Wr.s;Kr+=4){var $r=UTIF._binBE.readUint(Br,Kr);Xr[Xi]=Br.slice(Qi,Qi+$r),Xr[Xi].j=0,Xr[Xi].a=0,Qi+=$r,Xi++}if(Qi!=Br.length)throw"Invalid data";return Xr}function wr(Br,Wr){for(var Xr=-Wr[4],Yr=0;Xr<=Wr[4];Yr++,Xr++)Br[Yr]=Xr<=-Wr[3]?-4:Xr<=-Wr[2]?-3:Xr<=-Wr[1]?-2:Xr<-Wr[0]?-1:Xr<=Wr[0]?0:Xr<Wr[1]?1:Xr<Wr[2]?2:Xr<Wr[3]?3:4}function xr(Br,Wr,Xr){var Yr=[Wr,3*Wr+18,5*Wr+67,7*Wr+276,Xr];Br.o=Wr,Br.w=(Yr[4]+2*Wr)/(2*Wr+1)+1|0,Br.v=Math.ceil(Math.log2(Br.w)),Br.t=9,wr(Br.c,Yr)}function Sr(Br){var Wr={c:new Int8Array(2<<Br.u)};return xr(Wr,0,Br.g),Wr}function br(Br){for(var Wr=[[],[],[]],Xr=Math.max(2,Br.w+32>>>6),Yr=0;Yr<3;Yr++)for(var Qi=0;Qi<41;Qi++)Wr[Yr][Qi]=[Xr,1];return Wr}function Cr(Br){for(var Wr=-1,Xr=0;!Xr;Wr++)Xr=Br[Br.j]>>>7-Br.a&1,Br.a++,Br.a&=7,Br.a||Br.j++;return Wr}function Ir(Br,Wr){var Xr=0,Yr=8-Br.a,Qi=Br.j,Xi=Br.a;if(Wr){if(Wr>=Yr)do Xr<<=Yr,Wr-=Yr,Xr|=Br[Br.j]&(1<<Yr)-1,Br.j++,Yr=8;while(Wr>=8);Wr&&(Xr<<=Wr,Yr-=Wr,Xr|=Br[Br.j]>>>Yr&(1<<Wr)-1),Br.a=8-Yr}return Xr}function Rr(Br,Wr){var Xr=0;if(Wr<Br)for(;Xr<=14&&Wr<<++Xr<Br;);return Xr}function Pr(Br,Wr,Xr,Yr,Qi,Xi,Kr,$r){$r==null&&($r=0);var Vr=Xi+1,Gr=Vr%2,qr=0,ji=0,Jr=0,Ji,Ki,Zi=Yr[Qi],Zr=Yr[Qi-1],is=Yr[Qi-2][Vr],os=Zr[Vr-1],cs=Zr[Vr],ss=Zr[Vr+1],es=Zi[Vr-1],ms=Zi[Vr+1],Yi=Math.abs,Gi,Ni,Ri,qi;if(Gr&&(Gi=Yi(ss-cs),Ni=Yi(is-cs),Ri=Yi(os-cs)),Gr){if(qi=Gi>Ri&&Ni<Gi?is+os:Gi<Ri&&Ni<Ri?is+ss:ss+os,qi=qi+2*cs>>>2,$r){Zi[Vr]=qi;return}Ji=Wr.t*Wr.c[Br.g+cs-is]+Wr.c[Br.g+os-cs]}else qi=cs>os&&cs>ss||cs<os&&cs<ss?ms+es+2*cs>>>2:es+ms>>>1,Ji=Wr.t*Wr.c[Br.g+cs-os]+Wr.c[Br.g+os-es];Ki=Yi(Ji);var as=Cr(Xr);if(as<Br.n-Wr.v-1){var us=Rr(Kr[Ki][0],Kr[Ki][1]);Jr=Ir(Xr,us)+(as<<us)}else Jr=Ir(Xr,Wr.v)+1;Jr=Jr&1?-1-(Jr>>>1):Jr>>>1,Kr[Ki][0]+=Yi(Jr),Kr[Ki][1]==Br.f&&(Kr[Ki][0]>>>=1,Kr[Ki][1]>>>=1),Kr[Ki][1]++,qi=Ji<0?qi-Jr:qi+Jr,Br.i&&(qi<0?qi+=Wr.w:qi>Br.g&&(qi-=Wr.w)),Zi[Vr]=qi>=0?Math.min(qi,Br.g):0}function Dr(Br,Wr,Xr){for(var Yr=Br[0].length,Qi=Wr;Qi<=Xr;Qi++)Br[Qi][0]=Br[Qi-1][1],Br[Qi][Yr-1]=Br[Qi-1][Yr-2]}function Fr(Br){Dr(Br,or,hr),Dr(Br,tr,nr),Dr(Br,vr,fr)}function Or(Br,Wr,Xr,Yr,Qi,Xi,Kr,$r,Vr,Gr,qr,ji,Jr){for(var Ji=0,Ki=1,Zi=Qi<pr&&Qi>nr;Ki<Br.m;)Ji<Br.m&&(Pr(Br,Wr,Xr,Yr,Qi,Ji,Kr[Vr],Br.h&&(Zi&&Gr||!Zi&&(qr||(Ji&ji)==Jr))),Pr(Br,Wr,Xr,Yr,Xi,Ji,Kr[Vr],Br.h&&(!Zi&&Gr||Zi&&(qr||(Ji&ji)==Jr))),Ji+=2),Ji>8&&(Pr(Br,Wr,Xr,Yr,Qi,Ki,$r[Vr]),Pr(Br,Wr,Xr,Yr,Xi,Ki,$r[Vr]),Ki+=2);Fr(Yr)}function Nr(Br,Wr,Xr,Yr,Qi,Xi){Or(Br,Wr,Xr,Yr,tr,or,Qi,Xi,0,0,1,0,8),Or(Br,Wr,Xr,Yr,lr,vr,Qi,Xi,1,0,1,0,8),Or(Br,Wr,Xr,Yr,ir,cr,Qi,Xi,2,1,0,3,0),Or(Br,Wr,Xr,Yr,ur,mr,Qi,Xi,0,0,0,3,2),Or(Br,Wr,Xr,Yr,nr,dr,Qi,Xi,1,0,0,3,2),Or(Br,Wr,Xr,Yr,hr,fr,Qi,Xi,2,1,0,3,0)}function Ur(Br,Wr,Xr,Yr,Qi,Xi){var Kr=Xi.length,$r=Br.l;Qi+1==Br.s&&($r=Br.e-Qi*Br.l);for(var Vr=6*Br.e*Yr+Qi*Br.l,Gr=0;Gr<6;Gr++){for(var qr=0;qr<$r;qr++){var ji=Xi[Gr%Kr][qr%Kr],Jr;ji==0?Jr=tr+(Gr>>>1):ji==2?Jr=vr+(Gr>>>1):Jr=or+Gr;var Ji=Br.h?(qr*2/3&2147483646|qr%3&1)+(qr%3>>>1):qr>>>1;Wr[Vr+qr]=Xr[Jr][Ji+1]}Vr+=Br.e}}UTIF._decompressRAF=function(Br,Wr){var Xr=Ar(Br),Yr=yr(Br,Xr),Qi=Sr(Xr),Xi=new Int16Array(Xr.e*Xr.q);Wr==null&&(Wr=Xr.h?[[1,1,0,1,1,2],[1,1,2,1,1,0],[2,0,1,0,2,1],[1,1,2,1,1,0],[1,1,0,1,1,2],[0,2,1,2,0,1]]:[[0,1],[3,2]]);for(var Kr=[[rr,ir],[er,nr],[sr,dr],[ar,hr],[pr,mr],[gr,fr]],$r=[],Vr=0;Vr<_r;Vr++)$r[Vr]=new Uint16Array(Xr.A);for(var Gr=0;Gr<Xr.s;Gr++){for(var qr=br(Qi),ji=br(Qi),Vr=0;Vr<_r;Vr++)for(var Jr=0;Jr<Xr.A;Jr++)$r[Vr][Jr]=0;for(var Ji=0;Ji<Xr.d;Ji++){Nr(Xr,Qi,Yr[Gr],$r,qr,ji);for(var Vr=0;Vr<6;Vr++)for(var Jr=0;Jr<Xr.A;Jr++)$r[Kr[Vr][0]][Jr]=$r[Kr[Vr][1]][Jr];Ur(Xr,Xi,$r,Ji,Gr,Wr);for(var Vr=tr;Vr<_r;Vr++)if([sr,ar,pr,gr].indexOf(Vr)==-1)for(var Jr=0;Jr<Xr.A;Jr++)$r[Vr][Jr]=0;Fr($r)}}return Xi}})();class TIFFLoader extends DataTextureLoader{constructor(er){super(er)}parse(er){const tr=UTIF.decode(er);UTIF.decodeImage(er,tr[0]);const ir=UTIF.toRGBA8(tr[0]);return{width:tr[0].width,height:tr[0].height,data:ir,flipY:!0,magFilter:LinearFilter,minFilter:LinearMipmapLinearFilter}}}/*! https://mths.be/codepointat v0.2.0 by @mathias */String.prototype.codePointAt||function(){var rr=function(){try{var tr={},ir=Object.defineProperty,nr=ir(tr,tr,tr)&&ir}catch{}return nr}(),er=function(tr){if(this==null)throw TypeError();var ir=String(this),nr=ir.length,sr=tr?Number(tr):0;if(sr!=sr&&(sr=0),!(sr<0||sr>=nr)){var ar=ir.charCodeAt(sr),or;return ar>=55296&&ar<=56319&&nr>sr+1&&(or=ir.charCodeAt(sr+1),or>=56320&&or<=57343)?(ar-55296)*1024+or-56320+65536:ar}};rr?rr(String.prototype,"codePointAt",{value:er,configurable:!0,writable:!0}):String.prototype.codePointAt=er}();var TINF_OK=0,TINF_DATA_ERROR=-3;function Tree(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function Data(rr,er){this.source=rr,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=er,this.destLen=0,this.ltree=new Tree,this.dtree=new Tree}var sltree=new Tree,sdtree=new Tree,length_bits=new Uint8Array(30),length_base=new Uint16Array(30),dist_bits=new Uint8Array(30),dist_base=new Uint16Array(30),clcidx=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),code_tree=new Tree,lengths=new Uint8Array(320);function tinf_build_bits_base(rr,er,tr,ir){var nr,sr;for(nr=0;nr<tr;++nr)rr[nr]=0;for(nr=0;nr<30-tr;++nr)rr[nr+tr]=nr/tr|0;for(sr=ir,nr=0;nr<30;++nr)er[nr]=sr,sr+=1<<rr[nr]}function tinf_build_fixed_trees(rr,er){var tr;for(tr=0;tr<7;++tr)rr.table[tr]=0;for(rr.table[7]=24,rr.table[8]=152,rr.table[9]=112,tr=0;tr<24;++tr)rr.trans[tr]=256+tr;for(tr=0;tr<144;++tr)rr.trans[24+tr]=tr;for(tr=0;tr<8;++tr)rr.trans[168+tr]=280+tr;for(tr=0;tr<112;++tr)rr.trans[176+tr]=144+tr;for(tr=0;tr<5;++tr)er.table[tr]=0;for(er.table[5]=32,tr=0;tr<32;++tr)er.trans[tr]=tr}var offs=new Uint16Array(16);function tinf_build_tree(rr,er,tr,ir){var nr,sr;for(nr=0;nr<16;++nr)rr.table[nr]=0;for(nr=0;nr<ir;++nr)rr.table[er[tr+nr]]++;for(rr.table[0]=0,sr=0,nr=0;nr<16;++nr)offs[nr]=sr,sr+=rr.table[nr];for(nr=0;nr<ir;++nr)er[tr+nr]&&(rr.trans[offs[er[tr+nr]]++]=nr)}function tinf_getbit(rr){rr.bitcount--||(rr.tag=rr.source[rr.sourceIndex++],rr.bitcount=7);var er=rr.tag&1;return rr.tag>>>=1,er}function tinf_read_bits(rr,er,tr){if(!er)return tr;for(;rr.bitcount<24;)rr.tag|=rr.source[rr.sourceIndex++]<<rr.bitcount,rr.bitcount+=8;var ir=rr.tag&65535>>>16-er;return rr.tag>>>=er,rr.bitcount-=er,ir+tr}function tinf_decode_symbol(rr,er){for(;rr.bitcount<24;)rr.tag|=rr.source[rr.sourceIndex++]<<rr.bitcount,rr.bitcount+=8;var tr=0,ir=0,nr=0,sr=rr.tag;do ir=2*ir+(sr&1),sr>>>=1,++nr,tr+=er.table[nr],ir-=er.table[nr];while(ir>=0);return rr.tag=sr,rr.bitcount-=nr,er.trans[tr+ir]}function tinf_decode_trees(rr,er,tr){var ir,nr,sr,ar,or,lr;for(ir=tinf_read_bits(rr,5,257),nr=tinf_read_bits(rr,5,1),sr=tinf_read_bits(rr,4,4),ar=0;ar<19;++ar)lengths[ar]=0;for(ar=0;ar<sr;++ar){var cr=tinf_read_bits(rr,3,0);lengths[clcidx[ar]]=cr}for(tinf_build_tree(code_tree,lengths,0,19),or=0;or<ir+nr;){var ur=tinf_decode_symbol(rr,code_tree);switch(ur){case 16:var dr=lengths[or-1];for(lr=tinf_read_bits(rr,2,3);lr;--lr)lengths[or++]=dr;break;case 17:for(lr=tinf_read_bits(rr,3,3);lr;--lr)lengths[or++]=0;break;case 18:for(lr=tinf_read_bits(rr,7,11);lr;--lr)lengths[or++]=0;break;default:lengths[or++]=ur;break}}tinf_build_tree(er,lengths,0,ir),tinf_build_tree(tr,lengths,ir,nr)}function tinf_inflate_block_data(rr,er,tr){for(;;){var ir=tinf_decode_symbol(rr,er);if(ir===256)return TINF_OK;if(ir<256)rr.dest[rr.destLen++]=ir;else{var nr,sr,ar,or;for(ir-=257,nr=tinf_read_bits(rr,length_bits[ir],length_base[ir]),sr=tinf_decode_symbol(rr,tr),ar=rr.destLen-tinf_read_bits(rr,dist_bits[sr],dist_base[sr]),or=ar;or<ar+nr;++or)rr.dest[rr.destLen++]=rr.dest[or]}}}function tinf_inflate_uncompressed_block(rr){for(var er,tr,ir;rr.bitcount>8;)rr.sourceIndex--,rr.bitcount-=8;if(er=rr.source[rr.sourceIndex+1],er=256*er+rr.source[rr.sourceIndex],tr=rr.source[rr.sourceIndex+3],tr=256*tr+rr.source[rr.sourceIndex+2],er!==(~tr&65535))return TINF_DATA_ERROR;for(rr.sourceIndex+=4,ir=er;ir;--ir)rr.dest[rr.destLen++]=rr.source[rr.sourceIndex++];return rr.bitcount=0,TINF_OK}function tinf_uncompress(rr,er){var tr=new Data(rr,er),ir,nr,sr;do{switch(ir=tinf_getbit(tr),nr=tinf_read_bits(tr,2,0),nr){case 0:sr=tinf_inflate_uncompressed_block(tr);break;case 1:sr=tinf_inflate_block_data(tr,sltree,sdtree);break;case 2:tinf_decode_trees(tr,tr.ltree,tr.dtree),sr=tinf_inflate_block_data(tr,tr.ltree,tr.dtree);break;default:sr=TINF_DATA_ERROR}if(sr!==TINF_OK)throw new Error("Data error")}while(!ir);return tr.destLen<tr.dest.length?typeof tr.dest.slice=="function"?tr.dest.slice(0,tr.destLen):tr.dest.subarray(0,tr.destLen):tr.dest}tinf_build_fixed_trees(sltree,sdtree);tinf_build_bits_base(length_bits,length_base,4,3);tinf_build_bits_base(dist_bits,dist_base,2,1);length_bits[28]=0;length_base[28]=258;var tinyInflate=tinf_uncompress;function derive(rr,er,tr,ir,nr){return Math.pow(1-nr,3)*rr+3*Math.pow(1-nr,2)*nr*er+3*(1-nr)*Math.pow(nr,2)*tr+Math.pow(nr,3)*ir}function BoundingBox(){this.x1=Number.NaN,this.y1=Number.NaN,this.x2=Number.NaN,this.y2=Number.NaN}BoundingBox.prototype.isEmpty=function(){return isNaN(this.x1)||isNaN(this.y1)||isNaN(this.x2)||isNaN(this.y2)};BoundingBox.prototype.addPoint=function(rr,er){typeof rr=="number"&&((isNaN(this.x1)||isNaN(this.x2))&&(this.x1=rr,this.x2=rr),rr<this.x1&&(this.x1=rr),rr>this.x2&&(this.x2=rr)),typeof er=="number"&&((isNaN(this.y1)||isNaN(this.y2))&&(this.y1=er,this.y2=er),er<this.y1&&(this.y1=er),er>this.y2&&(this.y2=er))};BoundingBox.prototype.addX=function(rr){this.addPoint(rr,null)};BoundingBox.prototype.addY=function(rr){this.addPoint(null,rr)};BoundingBox.prototype.addBezier=function(rr,er,tr,ir,nr,sr,ar,or){var lr=[rr,er],cr=[tr,ir],ur=[nr,sr],dr=[ar,or];this.addPoint(rr,er),this.addPoint(ar,or);for(var hr=0;hr<=1;hr++){var pr=6*lr[hr]-12*cr[hr]+6*ur[hr],gr=-3*lr[hr]+9*cr[hr]-9*ur[hr]+3*dr[hr],vr=3*cr[hr]-3*lr[hr];if(gr===0){if(pr===0)continue;var mr=-vr/pr;0<mr&&mr<1&&(hr===0&&this.addX(derive(lr[hr],cr[hr],ur[hr],dr[hr],mr)),hr===1&&this.addY(derive(lr[hr],cr[hr],ur[hr],dr[hr],mr)));continue}var fr=Math.pow(pr,2)-4*vr*gr;if(!(fr<0)){var _r=(-pr+Math.sqrt(fr))/(2*gr);0<_r&&_r<1&&(hr===0&&this.addX(derive(lr[hr],cr[hr],ur[hr],dr[hr],_r)),hr===1&&this.addY(derive(lr[hr],cr[hr],ur[hr],dr[hr],_r)));var Ar=(-pr-Math.sqrt(fr))/(2*gr);0<Ar&&Ar<1&&(hr===0&&this.addX(derive(lr[hr],cr[hr],ur[hr],dr[hr],Ar)),hr===1&&this.addY(derive(lr[hr],cr[hr],ur[hr],dr[hr],Ar)))}}};BoundingBox.prototype.addQuad=function(rr,er,tr,ir,nr,sr){var ar=rr+.6666666666666666*(tr-rr),or=er+2/3*(ir-er),lr=ar+1/3*(nr-rr),cr=or+1/3*(sr-er);this.addBezier(rr,er,ar,or,lr,cr,nr,sr)};function Path(){this.commands=[],this.fill="black",this.stroke=null,this.strokeWidth=1}Path.prototype.moveTo=function(rr,er){this.commands.push({type:"M",x:rr,y:er})};Path.prototype.lineTo=function(rr,er){this.commands.push({type:"L",x:rr,y:er})};Path.prototype.curveTo=Path.prototype.bezierCurveTo=function(rr,er,tr,ir,nr,sr){this.commands.push({type:"C",x1:rr,y1:er,x2:tr,y2:ir,x:nr,y:sr})};Path.prototype.quadTo=Path.prototype.quadraticCurveTo=function(rr,er,tr,ir){this.commands.push({type:"Q",x1:rr,y1:er,x:tr,y:ir})};Path.prototype.close=Path.prototype.closePath=function(){this.commands.push({type:"Z"})};Path.prototype.extend=function(rr){if(rr.commands)rr=rr.commands;else if(rr instanceof BoundingBox){var er=rr;this.moveTo(er.x1,er.y1),this.lineTo(er.x2,er.y1),this.lineTo(er.x2,er.y2),this.lineTo(er.x1,er.y2),this.close();return}Array.prototype.push.apply(this.commands,rr)};Path.prototype.getBoundingBox=function(){for(var rr=new BoundingBox,er=0,tr=0,ir=0,nr=0,sr=0;sr<this.commands.length;sr++){var ar=this.commands[sr];switch(ar.type){case"M":rr.addPoint(ar.x,ar.y),er=ir=ar.x,tr=nr=ar.y;break;case"L":rr.addPoint(ar.x,ar.y),ir=ar.x,nr=ar.y;break;case"Q":rr.addQuad(ir,nr,ar.x1,ar.y1,ar.x,ar.y),ir=ar.x,nr=ar.y;break;case"C":rr.addBezier(ir,nr,ar.x1,ar.y1,ar.x2,ar.y2,ar.x,ar.y),ir=ar.x,nr=ar.y;break;case"Z":ir=er,nr=tr;break;default:throw new Error("Unexpected path command "+ar.type)}}return rr.isEmpty()&&rr.addPoint(0,0),rr};Path.prototype.draw=function(rr){rr.beginPath();for(var er=0;er<this.commands.length;er+=1){var tr=this.commands[er];tr.type==="M"?rr.moveTo(tr.x,tr.y):tr.type==="L"?rr.lineTo(tr.x,tr.y):tr.type==="C"?rr.bezierCurveTo(tr.x1,tr.y1,tr.x2,tr.y2,tr.x,tr.y):tr.type==="Q"?rr.quadraticCurveTo(tr.x1,tr.y1,tr.x,tr.y):tr.type==="Z"&&rr.closePath()}this.fill&&(rr.fillStyle=this.fill,rr.fill()),this.stroke&&(rr.strokeStyle=this.stroke,rr.lineWidth=this.strokeWidth,rr.stroke())};Path.prototype.toPathData=function(rr){rr=rr!==void 0?rr:2;function er(ar){return Math.round(ar)===ar?""+Math.round(ar):ar.toFixed(rr)}function tr(){for(var ar=arguments,or="",lr=0;lr<arguments.length;lr+=1){var cr=ar[lr];cr>=0&&lr>0&&(or+=" "),or+=er(cr)}return or}for(var ir="",nr=0;nr<this.commands.length;nr+=1){var sr=this.commands[nr];sr.type==="M"?ir+="M"+tr(sr.x,sr.y):sr.type==="L"?ir+="L"+tr(sr.x,sr.y):sr.type==="C"?ir+="C"+tr(sr.x1,sr.y1,sr.x2,sr.y2,sr.x,sr.y):sr.type==="Q"?ir+="Q"+tr(sr.x1,sr.y1,sr.x,sr.y):sr.type==="Z"&&(ir+="Z")}return ir};Path.prototype.toSVG=function(rr){var er='<path d="';return er+=this.toPathData(rr),er+='"',this.fill&&this.fill!=="black"&&(this.fill===null?er+=' fill="none"':er+=' fill="'+this.fill+'"'),this.stroke&&(er+=' stroke="'+this.stroke+'" stroke-width="'+this.strokeWidth+'"'),er+="/>",er};Path.prototype.toDOMElement=function(rr){var er=this.toPathData(rr),tr=document.createElementNS("http://www.w3.org/2000/svg","path");return tr.setAttribute("d",er),tr};function fail(rr){throw new Error(rr)}function argument(rr,er){rr||fail(er)}var check={fail,argument,assert:argument},LIMIT16=32768,LIMIT32=2147483648,decode={},encode={},sizeOf={};function constant(rr){return function(){return rr}}encode.BYTE=function(rr){return check.argument(rr>=0&&rr<=255,"Byte value should be between 0 and 255."),[rr]};sizeOf.BYTE=constant(1);encode.CHAR=function(rr){return[rr.charCodeAt(0)]};sizeOf.CHAR=constant(1);encode.CHARARRAY=function(rr){typeof rr>"u"&&(rr="",console.warn("Undefined CHARARRAY encountered and treated as an empty string. This is probably caused by a missing glyph name."));for(var er=[],tr=0;tr<rr.length;tr+=1)er[tr]=rr.charCodeAt(tr);return er};sizeOf.CHARARRAY=function(rr){return typeof rr>"u"?0:rr.length};encode.USHORT=function(rr){return[rr>>8&255,rr&255]};sizeOf.USHORT=constant(2);encode.SHORT=function(rr){return rr>=LIMIT16&&(rr=-(2*LIMIT16-rr)),[rr>>8&255,rr&255]};sizeOf.SHORT=constant(2);encode.UINT24=function(rr){return[rr>>16&255,rr>>8&255,rr&255]};sizeOf.UINT24=constant(3);encode.ULONG=function(rr){return[rr>>24&255,rr>>16&255,rr>>8&255,rr&255]};sizeOf.ULONG=constant(4);encode.LONG=function(rr){return rr>=LIMIT32&&(rr=-(2*LIMIT32-rr)),[rr>>24&255,rr>>16&255,rr>>8&255,rr&255]};sizeOf.LONG=constant(4);encode.FIXED=encode.ULONG;sizeOf.FIXED=sizeOf.ULONG;encode.FWORD=encode.SHORT;sizeOf.FWORD=sizeOf.SHORT;encode.UFWORD=encode.USHORT;sizeOf.UFWORD=sizeOf.USHORT;encode.LONGDATETIME=function(rr){return[0,0,0,0,rr>>24&255,rr>>16&255,rr>>8&255,rr&255]};sizeOf.LONGDATETIME=constant(8);encode.TAG=function(rr){return check.argument(rr.length===4,"Tag should be exactly 4 ASCII characters."),[rr.charCodeAt(0),rr.charCodeAt(1),rr.charCodeAt(2),rr.charCodeAt(3)]};sizeOf.TAG=constant(4);encode.Card8=encode.BYTE;sizeOf.Card8=sizeOf.BYTE;encode.Card16=encode.USHORT;sizeOf.Card16=sizeOf.USHORT;encode.OffSize=encode.BYTE;sizeOf.OffSize=sizeOf.BYTE;encode.SID=encode.USHORT;sizeOf.SID=sizeOf.USHORT;encode.NUMBER=function(rr){return rr>=-107&&rr<=107?[rr+139]:rr>=108&&rr<=1131?(rr=rr-108,[(rr>>8)+247,rr&255]):rr>=-1131&&rr<=-108?(rr=-rr-108,[(rr>>8)+251,rr&255]):rr>=-32768&&rr<=32767?encode.NUMBER16(rr):encode.NUMBER32(rr)};sizeOf.NUMBER=function(rr){return encode.NUMBER(rr).length};encode.NUMBER16=function(rr){return[28,rr>>8&255,rr&255]};sizeOf.NUMBER16=constant(3);encode.NUMBER32=function(rr){return[29,rr>>24&255,rr>>16&255,rr>>8&255,rr&255]};sizeOf.NUMBER32=constant(5);encode.REAL=function(rr){var er=rr.toString(),tr=/\.(\d*?)(?:9{5,20}|0{5,20})\d{0,2}(?:e(.+)|$)/.exec(er);if(tr){var ir=parseFloat("1e"+((tr[2]?+tr[2]:0)+tr[1].length));er=(Math.round(rr*ir)/ir).toString()}for(var nr="",sr=0,ar=er.length;sr<ar;sr+=1){var or=er[sr];or==="e"?nr+=er[++sr]==="-"?"c":"b":or==="."?nr+="a":or==="-"?nr+="e":nr+=or}nr+=nr.length&1?"f":"ff";for(var lr=[30],cr=0,ur=nr.length;cr<ur;cr+=2)lr.push(parseInt(nr.substr(cr,2),16));return lr};sizeOf.REAL=function(rr){return encode.REAL(rr).length};encode.NAME=encode.CHARARRAY;sizeOf.NAME=sizeOf.CHARARRAY;encode.STRING=encode.CHARARRAY;sizeOf.STRING=sizeOf.CHARARRAY;decode.UTF8=function(rr,er,tr){for(var ir=[],nr=tr,sr=0;sr<nr;sr++,er+=1)ir[sr]=rr.getUint8(er);return String.fromCharCode.apply(null,ir)};decode.UTF16=function(rr,er,tr){for(var ir=[],nr=tr/2,sr=0;sr<nr;sr++,er+=2)ir[sr]=rr.getUint16(er);return String.fromCharCode.apply(null,ir)};encode.UTF16=function(rr){for(var er=[],tr=0;tr<rr.length;tr+=1){var ir=rr.charCodeAt(tr);er[er.length]=ir>>8&255,er[er.length]=ir&255}return er};sizeOf.UTF16=function(rr){return rr.length*2};var eightBitMacEncodings={"x-mac-croatian":"","x-mac-cyrillic":"","x-mac-gaelic":"","x-mac-greek":"","x-mac-icelandic":"","x-mac-inuit":"","x-mac-ce":"",macintosh:"","x-mac-romanian":"","x-mac-turkish":""};decode.MACSTRING=function(rr,er,tr,ir){var nr=eightBitMacEncodings[ir];if(nr!==void 0){for(var sr="",ar=0;ar<tr;ar++){var or=rr.getUint8(er+ar);or<=127?sr+=String.fromCharCode(or):sr+=nr[or&127]}return sr}};var macEncodingTableCache=typeof WeakMap=="function"&&new WeakMap,macEncodingCacheKeys,getMacEncodingTable=function(rr){if(!macEncodingCacheKeys){macEncodingCacheKeys={};for(var er in eightBitMacEncodings)macEncodingCacheKeys[er]=new String(er)}var tr=macEncodingCacheKeys[rr];if(tr!==void 0){if(macEncodingTableCache){var ir=macEncodingTableCache.get(tr);if(ir!==void 0)return ir}var nr=eightBitMacEncodings[rr];if(nr!==void 0){for(var sr={},ar=0;ar<nr.length;ar++)sr[nr.charCodeAt(ar)]=ar+128;return macEncodingTableCache&&macEncodingTableCache.set(tr,sr),sr}}};encode.MACSTRING=function(rr,er){var tr=getMacEncodingTable(er);if(tr!==void 0){for(var ir=[],nr=0;nr<rr.length;nr++){var sr=rr.charCodeAt(nr);if(sr>=128&&(sr=tr[sr],sr===void 0))return;ir[nr]=sr}return ir}};sizeOf.MACSTRING=function(rr,er){var tr=encode.MACSTRING(rr,er);return tr!==void 0?tr.length:0};function isByteEncodable(rr){return rr>=-128&&rr<=127}function encodeVarDeltaRunAsZeroes(rr,er,tr){for(var ir=0,nr=rr.length;er<nr&&ir<64&&rr[er]===0;)++er,++ir;return tr.push(128|ir-1),er}function encodeVarDeltaRunAsBytes(rr,er,tr){for(var ir=0,nr=rr.length,sr=er;sr<nr&&ir<64;){var ar=rr[sr];if(!isByteEncodable(ar)||ar===0&&sr+1<nr&&rr[sr+1]===0)break;++sr,++ir}tr.push(ir-1);for(var or=er;or<sr;++or)tr.push(rr[or]+256&255);return sr}function encodeVarDeltaRunAsWords(rr,er,tr){for(var ir=0,nr=rr.length,sr=er;sr<nr&&ir<64;){var ar=rr[sr];if(ar===0||isByteEncodable(ar)&&sr+1<nr&&isByteEncodable(rr[sr+1]))break;++sr,++ir}tr.push(64|ir-1);for(var or=er;or<sr;++or){var lr=rr[or];tr.push(lr+65536>>8&255,lr+256&255)}return sr}encode.VARDELTAS=function(rr){for(var er=0,tr=[];er<rr.length;){var ir=rr[er];ir===0?er=encodeVarDeltaRunAsZeroes(rr,er,tr):ir>=-128&&ir<=127?er=encodeVarDeltaRunAsBytes(rr,er,tr):er=encodeVarDeltaRunAsWords(rr,er,tr)}return tr};encode.INDEX=function(rr){for(var er=1,tr=[er],ir=[],nr=0;nr<rr.length;nr+=1){var sr=encode.OBJECT(rr[nr]);Array.prototype.push.apply(ir,sr),er+=sr.length,tr.push(er)}if(ir.length===0)return[0,0];for(var ar=[],or=1+Math.floor(Math.log(er)/Math.log(2))/8|0,lr=[void 0,encode.BYTE,encode.USHORT,encode.UINT24,encode.ULONG][or],cr=0;cr<tr.length;cr+=1){var ur=lr(tr[cr]);Array.prototype.push.apply(ar,ur)}return Array.prototype.concat(encode.Card16(rr.length),encode.OffSize(or),ar,ir)};sizeOf.INDEX=function(rr){return encode.INDEX(rr).length};encode.DICT=function(rr){for(var er=[],tr=Object.keys(rr),ir=tr.length,nr=0;nr<ir;nr+=1){var sr=parseInt(tr[nr],0),ar=rr[sr];er=er.concat(encode.OPERAND(ar.value,ar.type)),er=er.concat(encode.OPERATOR(sr))}return er};sizeOf.DICT=function(rr){return encode.DICT(rr).length};encode.OPERATOR=function(rr){return rr<1200?[rr]:[12,rr-1200]};encode.OPERAND=function(rr,er){var tr=[];if(Array.isArray(er))for(var ir=0;ir<er.length;ir+=1)check.argument(rr.length===er.length,"Not enough arguments given for type"+er),tr=tr.concat(encode.OPERAND(rr[ir],er[ir]));else if(er==="SID")tr=tr.concat(encode.NUMBER(rr));else if(er==="offset")tr=tr.concat(encode.NUMBER32(rr));else if(er==="number")tr=tr.concat(encode.NUMBER(rr));else if(er==="real")tr=tr.concat(encode.REAL(rr));else throw new Error("Unknown operand type "+er);return tr};encode.OP=encode.BYTE;sizeOf.OP=sizeOf.BYTE;var wmm=typeof WeakMap=="function"&&new WeakMap;encode.CHARSTRING=function(rr){if(wmm){var er=wmm.get(rr);if(er!==void 0)return er}for(var tr=[],ir=rr.length,nr=0;nr<ir;nr+=1){var sr=rr[nr];tr=tr.concat(encode[sr.type](sr.value))}return wmm&&wmm.set(rr,tr),tr};sizeOf.CHARSTRING=function(rr){return encode.CHARSTRING(rr).length};encode.OBJECT=function(rr){var er=encode[rr.type];return check.argument(er!==void 0,"No encoding function for type "+rr.type),er(rr.value)};sizeOf.OBJECT=function(rr){var er=sizeOf[rr.type];return check.argument(er!==void 0,"No sizeOf function for type "+rr.type),er(rr.value)};encode.TABLE=function(rr){for(var er=[],tr=rr.fields.length,ir=[],nr=[],sr=0;sr<tr;sr+=1){var ar=rr.fields[sr],or=encode[ar.type];check.argument(or!==void 0,"No encoding function for field type "+ar.type+" ("+ar.name+")");var lr=rr[ar.name];lr===void 0&&(lr=ar.value);var cr=or(lr);ar.type==="TABLE"?(nr.push(er.length),er=er.concat([0,0]),ir.push(cr)):er=er.concat(cr)}for(var ur=0;ur<ir.length;ur+=1){var dr=nr[ur],hr=er.length;check.argument(hr<65536,"Table "+rr.tableName+" too big."),er[dr]=hr>>8,er[dr+1]=hr&255,er=er.concat(ir[ur])}return er};sizeOf.TABLE=function(rr){for(var er=0,tr=rr.fields.length,ir=0;ir<tr;ir+=1){var nr=rr.fields[ir],sr=sizeOf[nr.type];check.argument(sr!==void 0,"No sizeOf function for field type "+nr.type+" ("+nr.name+")");var ar=rr[nr.name];ar===void 0&&(ar=nr.value),er+=sr(ar),nr.type==="TABLE"&&(er+=2)}return er};encode.RECORD=encode.TABLE;sizeOf.RECORD=sizeOf.TABLE;encode.LITERAL=function(rr){return rr};sizeOf.LITERAL=function(rr){return rr.length};function Table(rr,er,tr){if(er.length&&(er[0].name!=="coverageFormat"||er[0].value===1))for(var ir=0;ir<er.length;ir+=1){var nr=er[ir];this[nr.name]=nr.value}if(this.tableName=rr,this.fields=er,tr)for(var sr=Object.keys(tr),ar=0;ar<sr.length;ar+=1){var or=sr[ar],lr=tr[or];this[or]!==void 0&&(this[or]=lr)}}Table.prototype.encode=function(){return encode.TABLE(this)};Table.prototype.sizeOf=function(){return sizeOf.TABLE(this)};function ushortList(rr,er,tr){tr===void 0&&(tr=er.length);var ir=new Array(er.length+1);ir[0]={name:rr+"Count",type:"USHORT",value:tr};for(var nr=0;nr<er.length;nr++)ir[nr+1]={name:rr+nr,type:"USHORT",value:er[nr]};return ir}function tableList(rr,er,tr){var ir=er.length,nr=new Array(ir+1);nr[0]={name:rr+"Count",type:"USHORT",value:ir};for(var sr=0;sr<ir;sr++)nr[sr+1]={name:rr+sr,type:"TABLE",value:tr(er[sr],sr)};return nr}function recordList(rr,er,tr){var ir=er.length,nr=[];nr[0]={name:rr+"Count",type:"USHORT",value:ir};for(var sr=0;sr<ir;sr++)nr=nr.concat(tr(er[sr],sr));return nr}function Coverage(rr){rr.format===1?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:1}].concat(ushortList("glyph",rr.glyphs))):rr.format===2?Table.call(this,"coverageTable",[{name:"coverageFormat",type:"USHORT",value:2}].concat(recordList("rangeRecord",rr.ranges,function(er){return[{name:"startGlyphID",type:"USHORT",value:er.start},{name:"endGlyphID",type:"USHORT",value:er.end},{name:"startCoverageIndex",type:"USHORT",value:er.index}]}))):check.assert(!1,"Coverage format must be 1 or 2.")}Coverage.prototype=Object.create(Table.prototype);Coverage.prototype.constructor=Coverage;function ScriptList(rr){Table.call(this,"scriptListTable",recordList("scriptRecord",rr,function(er,tr){var ir=er.script,nr=ir.defaultLangSys;return check.assert(!!nr,"Unable to write GSUB: script "+er.tag+" has no default language system."),[{name:"scriptTag"+tr,type:"TAG",value:er.tag},{name:"script"+tr,type:"TABLE",value:new Table("scriptTable",[{name:"defaultLangSys",type:"TABLE",value:new Table("defaultLangSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:nr.reqFeatureIndex}].concat(ushortList("featureIndex",nr.featureIndexes)))}].concat(recordList("langSys",ir.langSysRecords,function(sr,ar){var or=sr.langSys;return[{name:"langSysTag"+ar,type:"TAG",value:sr.tag},{name:"langSys"+ar,type:"TABLE",value:new Table("langSys",[{name:"lookupOrder",type:"USHORT",value:0},{name:"reqFeatureIndex",type:"USHORT",value:or.reqFeatureIndex}].concat(ushortList("featureIndex",or.featureIndexes)))}]})))}]}))}ScriptList.prototype=Object.create(Table.prototype);ScriptList.prototype.constructor=ScriptList;function FeatureList(rr){Table.call(this,"featureListTable",recordList("featureRecord",rr,function(er,tr){var ir=er.feature;return[{name:"featureTag"+tr,type:"TAG",value:er.tag},{name:"feature"+tr,type:"TABLE",value:new Table("featureTable",[{name:"featureParams",type:"USHORT",value:ir.featureParams}].concat(ushortList("lookupListIndex",ir.lookupListIndexes)))}]}))}FeatureList.prototype=Object.create(Table.prototype);FeatureList.prototype.constructor=FeatureList;function LookupList(rr,er){Table.call(this,"lookupListTable",tableList("lookup",rr,function(tr){var ir=er[tr.lookupType];return check.assert(!!ir,"Unable to write GSUB lookup type "+tr.lookupType+" tables."),new Table("lookupTable",[{name:"lookupType",type:"USHORT",value:tr.lookupType},{name:"lookupFlag",type:"USHORT",value:tr.lookupFlag}].concat(tableList("subtable",tr.subtables,ir)))}))}LookupList.prototype=Object.create(Table.prototype);LookupList.prototype.constructor=LookupList;var table={Table,Record:Table,Coverage,ScriptList,FeatureList,LookupList,ushortList,tableList,recordList};function getByte(rr,er){return rr.getUint8(er)}function getUShort(rr,er){return rr.getUint16(er,!1)}function getShort(rr,er){return rr.getInt16(er,!1)}function getULong(rr,er){return rr.getUint32(er,!1)}function getFixed(rr,er){var tr=rr.getInt16(er,!1),ir=rr.getUint16(er+2,!1);return tr+ir/65535}function getTag(rr,er){for(var tr="",ir=er;ir<er+4;ir+=1)tr+=String.fromCharCode(rr.getInt8(ir));return tr}function getOffset(rr,er,tr){for(var ir=0,nr=0;nr<tr;nr+=1)ir<<=8,ir+=rr.getUint8(er+nr);return ir}function getBytes(rr,er,tr){for(var ir=[],nr=er;nr<tr;nr+=1)ir.push(rr.getUint8(nr));return ir}function bytesToString(rr){for(var er="",tr=0;tr<rr.length;tr+=1)er+=String.fromCharCode(rr[tr]);return er}var typeOffsets={byte:1,uShort:2,short:2,uLong:4,fixed:4,longDateTime:8,tag:4};function Parser(rr,er){this.data=rr,this.offset=er,this.relativeOffset=0}Parser.prototype.parseByte=function(){var rr=this.data.getUint8(this.offset+this.relativeOffset);return this.relativeOffset+=1,rr};Parser.prototype.parseChar=function(){var rr=this.data.getInt8(this.offset+this.relativeOffset);return this.relativeOffset+=1,rr};Parser.prototype.parseCard8=Parser.prototype.parseByte;Parser.prototype.parseUShort=function(){var rr=this.data.getUint16(this.offset+this.relativeOffset);return this.relativeOffset+=2,rr};Parser.prototype.parseCard16=Parser.prototype.parseUShort;Parser.prototype.parseSID=Parser.prototype.parseUShort;Parser.prototype.parseOffset16=Parser.prototype.parseUShort;Parser.prototype.parseShort=function(){var rr=this.data.getInt16(this.offset+this.relativeOffset);return this.relativeOffset+=2,rr};Parser.prototype.parseF2Dot14=function(){var rr=this.data.getInt16(this.offset+this.relativeOffset)/16384;return this.relativeOffset+=2,rr};Parser.prototype.parseULong=function(){var rr=getULong(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,rr};Parser.prototype.parseOffset32=Parser.prototype.parseULong;Parser.prototype.parseFixed=function(){var rr=getFixed(this.data,this.offset+this.relativeOffset);return this.relativeOffset+=4,rr};Parser.prototype.parseString=function(rr){var er=this.data,tr=this.offset+this.relativeOffset,ir="";this.relativeOffset+=rr;for(var nr=0;nr<rr;nr++)ir+=String.fromCharCode(er.getUint8(tr+nr));return ir};Parser.prototype.parseTag=function(){return this.parseString(4)};Parser.prototype.parseLongDateTime=function(){var rr=getULong(this.data,this.offset+this.relativeOffset+4);return rr-=2082844800,this.relativeOffset+=8,rr};Parser.prototype.parseVersion=function(rr){var er=getUShort(this.data,this.offset+this.relativeOffset),tr=getUShort(this.data,this.offset+this.relativeOffset+2);return this.relativeOffset+=4,rr===void 0&&(rr=4096),er+tr/rr/10};Parser.prototype.skip=function(rr,er){er===void 0&&(er=1),this.relativeOffset+=typeOffsets[rr]*er};Parser.prototype.parseULongList=function(rr){rr===void 0&&(rr=this.parseULong());for(var er=new Array(rr),tr=this.data,ir=this.offset+this.relativeOffset,nr=0;nr<rr;nr++)er[nr]=tr.getUint32(ir),ir+=4;return this.relativeOffset+=rr*4,er};Parser.prototype.parseOffset16List=Parser.prototype.parseUShortList=function(rr){rr===void 0&&(rr=this.parseUShort());for(var er=new Array(rr),tr=this.data,ir=this.offset+this.relativeOffset,nr=0;nr<rr;nr++)er[nr]=tr.getUint16(ir),ir+=2;return this.relativeOffset+=rr*2,er};Parser.prototype.parseShortList=function(rr){for(var er=new Array(rr),tr=this.data,ir=this.offset+this.relativeOffset,nr=0;nr<rr;nr++)er[nr]=tr.getInt16(ir),ir+=2;return this.relativeOffset+=rr*2,er};Parser.prototype.parseByteList=function(rr){for(var er=new Array(rr),tr=this.data,ir=this.offset+this.relativeOffset,nr=0;nr<rr;nr++)er[nr]=tr.getUint8(ir++);return this.relativeOffset+=rr,er};Parser.prototype.parseList=function(rr,er){er||(er=rr,rr=this.parseUShort());for(var tr=new Array(rr),ir=0;ir<rr;ir++)tr[ir]=er.call(this);return tr};Parser.prototype.parseList32=function(rr,er){er||(er=rr,rr=this.parseULong());for(var tr=new Array(rr),ir=0;ir<rr;ir++)tr[ir]=er.call(this);return tr};Parser.prototype.parseRecordList=function(rr,er){er||(er=rr,rr=this.parseUShort());for(var tr=new Array(rr),ir=Object.keys(er),nr=0;nr<rr;nr++){for(var sr={},ar=0;ar<ir.length;ar++){var or=ir[ar],lr=er[or];sr[or]=lr.call(this)}tr[nr]=sr}return tr};Parser.prototype.parseRecordList32=function(rr,er){er||(er=rr,rr=this.parseULong());for(var tr=new Array(rr),ir=Object.keys(er),nr=0;nr<rr;nr++){for(var sr={},ar=0;ar<ir.length;ar++){var or=ir[ar],lr=er[or];sr[or]=lr.call(this)}tr[nr]=sr}return tr};Parser.prototype.parseStruct=function(rr){if(typeof rr=="function")return rr.call(this);for(var er=Object.keys(rr),tr={},ir=0;ir<er.length;ir++){var nr=er[ir],sr=rr[nr];tr[nr]=sr.call(this)}return tr};Parser.prototype.parseValueRecord=function(rr){if(rr===void 0&&(rr=this.parseUShort()),rr!==0){var er={};return rr&1&&(er.xPlacement=this.parseShort()),rr&2&&(er.yPlacement=this.parseShort()),rr&4&&(er.xAdvance=this.parseShort()),rr&8&&(er.yAdvance=this.parseShort()),rr&16&&(er.xPlaDevice=void 0,this.parseShort()),rr&32&&(er.yPlaDevice=void 0,this.parseShort()),rr&64&&(er.xAdvDevice=void 0,this.parseShort()),rr&128&&(er.yAdvDevice=void 0,this.parseShort()),er}};Parser.prototype.parseValueRecordList=function(){for(var rr=this.parseUShort(),er=this.parseUShort(),tr=new Array(er),ir=0;ir<er;ir++)tr[ir]=this.parseValueRecord(rr);return tr};Parser.prototype.parsePointer=function(rr){var er=this.parseOffset16();if(er>0)return new Parser(this.data,this.offset+er).parseStruct(rr)};Parser.prototype.parsePointer32=function(rr){var er=this.parseOffset32();if(er>0)return new Parser(this.data,this.offset+er).parseStruct(rr)};Parser.prototype.parseListOfLists=function(rr){for(var er=this.parseOffset16List(),tr=er.length,ir=this.relativeOffset,nr=new Array(tr),sr=0;sr<tr;sr++){var ar=er[sr];if(ar===0){nr[sr]=void 0;continue}if(this.relativeOffset=ar,rr){for(var or=this.parseOffset16List(),lr=new Array(or.length),cr=0;cr<or.length;cr++)this.relativeOffset=ar+or[cr],lr[cr]=rr.call(this);nr[sr]=lr}else nr[sr]=this.parseUShortList()}return this.relativeOffset=ir,nr};Parser.prototype.parseCoverage=function(){var rr=this.offset+this.relativeOffset,er=this.parseUShort(),tr=this.parseUShort();if(er===1)return{format:1,glyphs:this.parseUShortList(tr)};if(er===2){for(var ir=new Array(tr),nr=0;nr<tr;nr++)ir[nr]={start:this.parseUShort(),end:this.parseUShort(),index:this.parseUShort()};return{format:2,ranges:ir}}throw new Error("0x"+rr.toString(16)+": Coverage format must be 1 or 2.")};Parser.prototype.parseClassDef=function(){var rr=this.offset+this.relativeOffset,er=this.parseUShort();if(er===1)return{format:1,startGlyph:this.parseUShort(),classes:this.parseUShortList()};if(er===2)return{format:2,ranges:this.parseRecordList({start:Parser.uShort,end:Parser.uShort,classId:Parser.uShort})};throw new Error("0x"+rr.toString(16)+": ClassDef format must be 1 or 2.")};Parser.list=function(rr,er){return function(){return this.parseList(rr,er)}};Parser.list32=function(rr,er){return function(){return this.parseList32(rr,er)}};Parser.recordList=function(rr,er){return function(){return this.parseRecordList(rr,er)}};Parser.recordList32=function(rr,er){return function(){return this.parseRecordList32(rr,er)}};Parser.pointer=function(rr){return function(){return this.parsePointer(rr)}};Parser.pointer32=function(rr){return function(){return this.parsePointer32(rr)}};Parser.tag=Parser.prototype.parseTag;Parser.byte=Parser.prototype.parseByte;Parser.uShort=Parser.offset16=Parser.prototype.parseUShort;Parser.uShortList=Parser.prototype.parseUShortList;Parser.uLong=Parser.offset32=Parser.prototype.parseULong;Parser.uLongList=Parser.prototype.parseULongList;Parser.struct=Parser.prototype.parseStruct;Parser.coverage=Parser.prototype.parseCoverage;Parser.classDef=Parser.prototype.parseClassDef;var langSysTable={reserved:Parser.uShort,reqFeatureIndex:Parser.uShort,featureIndexes:Parser.uShortList};Parser.prototype.parseScriptList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,script:Parser.pointer({defaultLangSys:Parser.pointer(langSysTable),langSysRecords:Parser.recordList({tag:Parser.tag,langSys:Parser.pointer(langSysTable)})})}))||[]};Parser.prototype.parseFeatureList=function(){return this.parsePointer(Parser.recordList({tag:Parser.tag,feature:Parser.pointer({featureParams:Parser.offset16,lookupListIndexes:Parser.uShortList})}))||[]};Parser.prototype.parseLookupList=function(rr){return this.parsePointer(Parser.list(Parser.pointer(function(){var er=this.parseUShort();check.argument(1<=er&&er<=9,"GPOS/GSUB lookup type "+er+" unknown.");var tr=this.parseUShort(),ir=tr&16;return{lookupType:er,lookupFlag:tr,subtables:this.parseList(Parser.pointer(rr[er])),markFilteringSet:ir?this.parseUShort():void 0}})))||[]};Parser.prototype.parseFeatureVariationsList=function(){return this.parsePointer32(function(){var rr=this.parseUShort(),er=this.parseUShort();check.argument(rr===1&&er<1,"GPOS/GSUB feature variations table unknown.");var tr=this.parseRecordList32({conditionSetOffset:Parser.offset32,featureTableSubstitutionOffset:Parser.offset32});return tr})||[]};var parse={getByte,getCard8:getByte,getUShort,getCard16:getUShort,getShort,getULong,getFixed,getTag,getOffset,getBytes,bytesToString,Parser};function parseCmapTableFormat12(rr,er){er.parseUShort(),rr.length=er.parseULong(),rr.language=er.parseULong();var tr;rr.groupCount=tr=er.parseULong(),rr.glyphIndexMap={};for(var ir=0;ir<tr;ir+=1)for(var nr=er.parseULong(),sr=er.parseULong(),ar=er.parseULong(),or=nr;or<=sr;or+=1)rr.glyphIndexMap[or]=ar,ar++}function parseCmapTableFormat4(rr,er,tr,ir,nr){rr.length=er.parseUShort(),rr.language=er.parseUShort();var sr;rr.segCount=sr=er.parseUShort()>>1,er.skip("uShort",3),rr.glyphIndexMap={};for(var ar=new parse.Parser(tr,ir+nr+14),or=new parse.Parser(tr,ir+nr+16+sr*2),lr=new parse.Parser(tr,ir+nr+16+sr*4),cr=new parse.Parser(tr,ir+nr+16+sr*6),ur=ir+nr+16+sr*8,dr=0;dr<sr-1;dr+=1)for(var hr=void 0,pr=ar.parseUShort(),gr=or.parseUShort(),vr=lr.parseShort(),mr=cr.parseUShort(),fr=gr;fr<=pr;fr+=1)mr!==0?(ur=cr.offset+cr.relativeOffset-2,ur+=mr,ur+=(fr-gr)*2,hr=parse.getUShort(tr,ur),hr!==0&&(hr=hr+vr&65535)):hr=fr+vr&65535,rr.glyphIndexMap[fr]=hr}function parseCmapTable(rr,er){var tr={};tr.version=parse.getUShort(rr,er),check.argument(tr.version===0,"cmap table version should be 0."),tr.numTables=parse.getUShort(rr,er+2);for(var ir=-1,nr=tr.numTables-1;nr>=0;nr-=1){var sr=parse.getUShort(rr,er+4+nr*8),ar=parse.getUShort(rr,er+4+nr*8+2);if(sr===3&&(ar===0||ar===1||ar===10)||sr===0&&(ar===0||ar===1||ar===2||ar===3||ar===4)){ir=parse.getULong(rr,er+4+nr*8+4);break}}if(ir===-1)throw new Error("No valid cmap sub-tables found.");var or=new parse.Parser(rr,er+ir);if(tr.format=or.parseUShort(),tr.format===12)parseCmapTableFormat12(tr,or);else if(tr.format===4)parseCmapTableFormat4(tr,or,rr,er,ir);else throw new Error("Only format 4 and 12 cmap tables are supported (found format "+tr.format+").");return tr}function addSegment(rr,er,tr){rr.segments.push({end:er,start:er,delta:-(er-tr),offset:0,glyphIndex:tr})}function addTerminatorSegment(rr){rr.segments.push({end:65535,start:65535,delta:1,offset:0})}function makeCmapTable(rr){var er=!0,tr;for(tr=rr.length-1;tr>0;tr-=1){var ir=rr.get(tr);if(ir.unicode>65535){console.log("Adding CMAP format 12 (needed!)"),er=!1;break}}var nr=[{name:"version",type:"USHORT",value:0},{name:"numTables",type:"USHORT",value:er?1:2},{name:"platformID",type:"USHORT",value:3},{name:"encodingID",type:"USHORT",value:1},{name:"offset",type:"ULONG",value:er?12:20}];er||(nr=nr.concat([{name:"cmap12PlatformID",type:"USHORT",value:3},{name:"cmap12EncodingID",type:"USHORT",value:10},{name:"cmap12Offset",type:"ULONG",value:0}])),nr=nr.concat([{name:"format",type:"USHORT",value:4},{name:"cmap4Length",type:"USHORT",value:0},{name:"language",type:"USHORT",value:0},{name:"segCountX2",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);var sr=new table.Table("cmap",nr);for(sr.segments=[],tr=0;tr<rr.length;tr+=1){for(var ar=rr.get(tr),or=0;or<ar.unicodes.length;or+=1)addSegment(sr,ar.unicodes[or],tr);sr.segments=sr.segments.sort(function(_r,Ar){return _r.start-Ar.start})}addTerminatorSegment(sr);var lr=sr.segments.length,cr=0,ur=[],dr=[],hr=[],pr=[],gr=[],vr=[];for(tr=0;tr<lr;tr+=1){var mr=sr.segments[tr];mr.end<=65535&&mr.start<=65535?(ur=ur.concat({name:"end_"+tr,type:"USHORT",value:mr.end}),dr=dr.concat({name:"start_"+tr,type:"USHORT",value:mr.start}),hr=hr.concat({name:"idDelta_"+tr,type:"SHORT",value:mr.delta}),pr=pr.concat({name:"idRangeOffset_"+tr,type:"USHORT",value:mr.offset}),mr.glyphId!==void 0&&(gr=gr.concat({name:"glyph_"+tr,type:"USHORT",value:mr.glyphId}))):cr+=1,!er&&mr.glyphIndex!==void 0&&(vr=vr.concat({name:"cmap12Start_"+tr,type:"ULONG",value:mr.start}),vr=vr.concat({name:"cmap12End_"+tr,type:"ULONG",value:mr.end}),vr=vr.concat({name:"cmap12Glyph_"+tr,type:"ULONG",value:mr.glyphIndex}))}if(sr.segCountX2=(lr-cr)*2,sr.searchRange=Math.pow(2,Math.floor(Math.log(lr-cr)/Math.log(2)))*2,sr.entrySelector=Math.log(sr.searchRange/2)/Math.log(2),sr.rangeShift=sr.segCountX2-sr.searchRange,sr.fields=sr.fields.concat(ur),sr.fields.push({name:"reservedPad",type:"USHORT",value:0}),sr.fields=sr.fields.concat(dr),sr.fields=sr.fields.concat(hr),sr.fields=sr.fields.concat(pr),sr.fields=sr.fields.concat(gr),sr.cmap4Length=14+ur.length*2+2+dr.length*2+hr.length*2+pr.length*2+gr.length*2,!er){var fr=16+vr.length*4;sr.cmap12Offset=12+2*2+4+sr.cmap4Length,sr.fields=sr.fields.concat([{name:"cmap12Format",type:"USHORT",value:12},{name:"cmap12Reserved",type:"USHORT",value:0},{name:"cmap12Length",type:"ULONG",value:fr},{name:"cmap12Language",type:"ULONG",value:0},{name:"cmap12nGroups",type:"ULONG",value:vr.length/3}]),sr.fields=sr.fields.concat(vr)}return sr}var cmap={parse:parseCmapTable,make:makeCmapTable},cffStandardStrings=[".notdef","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","endash","dagger","daggerdbl","periodcentered","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","questiondown","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","ring","cedilla","hungarumlaut","ogonek","caron","emdash","AE","ordfeminine","Lslash","Oslash","OE","ordmasculine","ae","dotlessi","lslash","oslash","oe","germandbls","onesuperior","logicalnot","mu","trademark","Eth","onehalf","plusminus","Thorn","onequarter","divide","brokenbar","degree","thorn","threequarters","twosuperior","registered","minus","eth","multiply","threesuperior","copyright","Aacute","Acircumflex","Adieresis","Agrave","Aring","Atilde","Ccedilla","Eacute","Ecircumflex","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Ntilde","Oacute","Ocircumflex","Odieresis","Ograve","Otilde","Scaron","Uacute","Ucircumflex","Udieresis","Ugrave","Yacute","Ydieresis","Zcaron","aacute","acircumflex","adieresis","agrave","aring","atilde","ccedilla","eacute","ecircumflex","edieresis","egrave","iacute","icircumflex","idieresis","igrave","ntilde","oacute","ocircumflex","odieresis","ograve","otilde","scaron","uacute","ucircumflex","udieresis","ugrave","yacute","ydieresis","zcaron","exclamsmall","Hungarumlautsmall","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","266 ff","onedotenleader","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","commasuperior","threequartersemdash","periodsuperior","questionsmall","asuperior","bsuperior","centsuperior","dsuperior","esuperior","isuperior","lsuperior","msuperior","nsuperior","osuperior","rsuperior","ssuperior","tsuperior","ff","ffi","ffl","parenleftinferior","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","exclamdownsmall","centoldstyle","Lslashsmall","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","Dotaccentsmall","Macronsmall","figuredash","hypheninferior","Ogoneksmall","Ringsmall","Cedillasmall","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","zerosuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall","001.000","001.001","001.002","001.003","Black","Bold","Book","Light","Medium","Regular","Roman","Semibold"],cffStandardEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quoteright","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","quoteleft","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdown","cent","sterling","fraction","yen","florin","section","currency","quotesingle","quotedblleft","guillemotleft","guilsinglleft","guilsinglright","fi","fl","","endash","dagger","daggerdbl","periodcentered","","paragraph","bullet","quotesinglbase","quotedblbase","quotedblright","guillemotright","ellipsis","perthousand","","questiondown","","grave","acute","circumflex","tilde","macron","breve","dotaccent","dieresis","","ring","cedilla","","hungarumlaut","ogonek","caron","emdash","","","","","","","","","","","","","","","","","AE","","ordfeminine","","","","","Lslash","Oslash","OE","ordmasculine","","","","","","ae","","","","dotlessi","","","lslash","oslash","oe","germandbls"],cffExpertEncoding=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","space","exclamsmall","Hungarumlautsmall","","dollaroldstyle","dollarsuperior","ampersandsmall","Acutesmall","parenleftsuperior","parenrightsuperior","twodotenleader","onedotenleader","comma","hyphen","period","fraction","zerooldstyle","oneoldstyle","twooldstyle","threeoldstyle","fouroldstyle","fiveoldstyle","sixoldstyle","sevenoldstyle","eightoldstyle","nineoldstyle","colon","semicolon","commasuperior","threequartersemdash","periodsuperior","questionsmall","","asuperior","bsuperior","centsuperior","dsuperior","esuperior","","","isuperior","","","lsuperior","msuperior","nsuperior","osuperior","","","rsuperior","ssuperior","tsuperior","","ff","fi","fl","ffi","ffl","parenleftinferior","","parenrightinferior","Circumflexsmall","hyphensuperior","Gravesmall","Asmall","Bsmall","Csmall","Dsmall","Esmall","Fsmall","Gsmall","Hsmall","Ismall","Jsmall","Ksmall","Lsmall","Msmall","Nsmall","Osmall","Psmall","Qsmall","Rsmall","Ssmall","Tsmall","Usmall","Vsmall","Wsmall","Xsmall","Ysmall","Zsmall","colonmonetary","onefitted","rupiah","Tildesmall","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","exclamdownsmall","centoldstyle","Lslashsmall","","","Scaronsmall","Zcaronsmall","Dieresissmall","Brevesmall","Caronsmall","","Dotaccentsmall","","","Macronsmall","","","figuredash","hypheninferior","","","Ogoneksmall","Ringsmall","Cedillasmall","","","","onequarter","onehalf","threequarters","questiondownsmall","oneeighth","threeeighths","fiveeighths","seveneighths","onethird","twothirds","","","zerosuperior","onesuperior","twosuperior","threesuperior","foursuperior","fivesuperior","sixsuperior","sevensuperior","eightsuperior","ninesuperior","zeroinferior","oneinferior","twoinferior","threeinferior","fourinferior","fiveinferior","sixinferior","seveninferior","eightinferior","nineinferior","centinferior","dollarinferior","periodinferior","commainferior","Agravesmall","Aacutesmall","Acircumflexsmall","Atildesmall","Adieresissmall","Aringsmall","AEsmall","Ccedillasmall","Egravesmall","Eacutesmall","Ecircumflexsmall","Edieresissmall","Igravesmall","Iacutesmall","Icircumflexsmall","Idieresissmall","Ethsmall","Ntildesmall","Ogravesmall","Oacutesmall","Ocircumflexsmall","Otildesmall","Odieresissmall","OEsmall","Oslashsmall","Ugravesmall","Uacutesmall","Ucircumflexsmall","Udieresissmall","Yacutesmall","Thornsmall","Ydieresissmall"],standardNames=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function DefaultEncoding(rr){this.font=rr}DefaultEncoding.prototype.charToGlyphIndex=function(rr){var er=rr.codePointAt(0),tr=this.font.glyphs;if(tr){for(var ir=0;ir<tr.length;ir+=1)for(var nr=tr.get(ir),sr=0;sr<nr.unicodes.length;sr+=1)if(nr.unicodes[sr]===er)return ir}return null};function CmapEncoding(rr){this.cmap=rr}CmapEncoding.prototype.charToGlyphIndex=function(rr){return this.cmap.glyphIndexMap[rr.codePointAt(0)]||0};function CffEncoding(rr,er){this.encoding=rr,this.charset=er}CffEncoding.prototype.charToGlyphIndex=function(rr){var er=rr.codePointAt(0),tr=this.encoding[er];return this.charset.indexOf(tr)};function GlyphNames(rr){switch(rr.version){case 1:this.names=standardNames.slice();break;case 2:this.names=new Array(rr.numberOfGlyphs);for(var er=0;er<rr.numberOfGlyphs;er++)rr.glyphNameIndex[er]<standardNames.length?this.names[er]=standardNames[rr.glyphNameIndex[er]]:this.names[er]=rr.names[rr.glyphNameIndex[er]-standardNames.length];break;case 2.5:this.names=new Array(rr.numberOfGlyphs);for(var tr=0;tr<rr.numberOfGlyphs;tr++)this.names[tr]=standardNames[tr+rr.glyphNameIndex[tr]];break;case 3:this.names=[];break;default:this.names=[];break}}GlyphNames.prototype.nameToGlyphIndex=function(rr){return this.names.indexOf(rr)};GlyphNames.prototype.glyphIndexToName=function(rr){return this.names[rr]};function addGlyphNamesAll(rr){for(var er,tr=rr.tables.cmap.glyphIndexMap,ir=Object.keys(tr),nr=0;nr<ir.length;nr+=1){var sr=ir[nr],ar=tr[sr];er=rr.glyphs.get(ar),er.addUnicode(parseInt(sr))}for(var or=0;or<rr.glyphs.length;or+=1)er=rr.glyphs.get(or),rr.cffEncoding?rr.isCIDFont?er.name="gid"+or:er.name=rr.cffEncoding.charset[or]:rr.glyphNames.names&&(er.name=rr.glyphNames.glyphIndexToName(or))}function addGlyphNamesToUnicodeMap(rr){rr._IndexToUnicodeMap={};for(var er=rr.tables.cmap.glyphIndexMap,tr=Object.keys(er),ir=0;ir<tr.length;ir+=1){var nr=tr[ir],sr=er[nr];rr._IndexToUnicodeMap[sr]===void 0?rr._IndexToUnicodeMap[sr]={unicodes:[parseInt(nr)]}:rr._IndexToUnicodeMap[sr].unicodes.push(parseInt(nr))}}function addGlyphNames(rr,er){er.lowMemory?addGlyphNamesToUnicodeMap(rr):addGlyphNamesAll(rr)}function line(rr,er,tr,ir,nr){rr.beginPath(),rr.moveTo(er,tr),rr.lineTo(ir,nr),rr.stroke()}var draw={line};function getPathDefinition(rr,er){var tr=er||new Path;return{configurable:!0,get:function(){return typeof tr=="function"&&(tr=tr()),tr},set:function(ir){tr=ir}}}function Glyph(rr){this.bindConstructorValues(rr)}Glyph.prototype.bindConstructorValues=function(rr){this.index=rr.index||0,this.name=rr.name||null,this.unicode=rr.unicode||void 0,this.unicodes=rr.unicodes||rr.unicode!==void 0?[rr.unicode]:[],"xMin"in rr&&(this.xMin=rr.xMin),"yMin"in rr&&(this.yMin=rr.yMin),"xMax"in rr&&(this.xMax=rr.xMax),"yMax"in rr&&(this.yMax=rr.yMax),"advanceWidth"in rr&&(this.advanceWidth=rr.advanceWidth),Object.defineProperty(this,"path",getPathDefinition(this,rr.path))};Glyph.prototype.addUnicode=function(rr){this.unicodes.length===0&&(this.unicode=rr),this.unicodes.push(rr)};Glyph.prototype.getBoundingBox=function(){return this.path.getBoundingBox()};Glyph.prototype.getPath=function(rr,er,tr,ir,nr){rr=rr!==void 0?rr:0,er=er!==void 0?er:0,tr=tr!==void 0?tr:72;var sr,ar;ir||(ir={});var or=ir.xScale,lr=ir.yScale;if(ir.hinting&&nr&&nr.hinting&&(ar=this.path&&nr.hinting.exec(this,tr)),ar)sr=nr.hinting.getCommands(ar),rr=Math.round(rr),er=Math.round(er),or=lr=1;else{sr=this.path.commands;var cr=1/(this.path.unitsPerEm||1e3)*tr;or===void 0&&(or=cr),lr===void 0&&(lr=cr)}for(var ur=new Path,dr=0;dr<sr.length;dr+=1){var hr=sr[dr];hr.type==="M"?ur.moveTo(rr+hr.x*or,er+-hr.y*lr):hr.type==="L"?ur.lineTo(rr+hr.x*or,er+-hr.y*lr):hr.type==="Q"?ur.quadraticCurveTo(rr+hr.x1*or,er+-hr.y1*lr,rr+hr.x*or,er+-hr.y*lr):hr.type==="C"?ur.curveTo(rr+hr.x1*or,er+-hr.y1*lr,rr+hr.x2*or,er+-hr.y2*lr,rr+hr.x*or,er+-hr.y*lr):hr.type==="Z"&&ur.closePath()}return ur};Glyph.prototype.getContours=function(){if(this.points===void 0)return[];for(var rr=[],er=[],tr=0;tr<this.points.length;tr+=1){var ir=this.points[tr];er.push(ir),ir.lastPointOfContour&&(rr.push(er),er=[])}return check.argument(er.length===0,"There are still points left in the current contour."),rr};Glyph.prototype.getMetrics=function(){for(var rr=this.path.commands,er=[],tr=[],ir=0;ir<rr.length;ir+=1){var nr=rr[ir];nr.type!=="Z"&&(er.push(nr.x),tr.push(nr.y)),(nr.type==="Q"||nr.type==="C")&&(er.push(nr.x1),tr.push(nr.y1)),nr.type==="C"&&(er.push(nr.x2),tr.push(nr.y2))}var sr={xMin:Math.min.apply(null,er),yMin:Math.min.apply(null,tr),xMax:Math.max.apply(null,er),yMax:Math.max.apply(null,tr),leftSideBearing:this.leftSideBearing};return isFinite(sr.xMin)||(sr.xMin=0),isFinite(sr.xMax)||(sr.xMax=this.advanceWidth),isFinite(sr.yMin)||(sr.yMin=0),isFinite(sr.yMax)||(sr.yMax=0),sr.rightSideBearing=this.advanceWidth-sr.leftSideBearing-(sr.xMax-sr.xMin),sr};Glyph.prototype.draw=function(rr,er,tr,ir,nr){this.getPath(er,tr,ir,nr).draw(rr)};Glyph.prototype.drawPoints=function(rr,er,tr,ir){function nr(dr,hr,pr,gr){rr.beginPath();for(var vr=0;vr<dr.length;vr+=1)rr.moveTo(hr+dr[vr].x*gr,pr+dr[vr].y*gr),rr.arc(hr+dr[vr].x*gr,pr+dr[vr].y*gr,2,0,Math.PI*2,!1);rr.closePath(),rr.fill()}er=er!==void 0?er:0,tr=tr!==void 0?tr:0,ir=ir!==void 0?ir:24;for(var sr=1/this.path.unitsPerEm*ir,ar=[],or=[],lr=this.path,cr=0;cr<lr.commands.length;cr+=1){var ur=lr.commands[cr];ur.x!==void 0&&ar.push({x:ur.x,y:-ur.y}),ur.x1!==void 0&&or.push({x:ur.x1,y:-ur.y1}),ur.x2!==void 0&&or.push({x:ur.x2,y:-ur.y2})}rr.fillStyle="blue",nr(ar,er,tr,sr),rr.fillStyle="red",nr(or,er,tr,sr)};Glyph.prototype.drawMetrics=function(rr,er,tr,ir){var nr;er=er!==void 0?er:0,tr=tr!==void 0?tr:0,ir=ir!==void 0?ir:24,nr=1/this.path.unitsPerEm*ir,rr.lineWidth=1,rr.strokeStyle="black",draw.line(rr,er,-1e4,er,1e4),draw.line(rr,-1e4,tr,1e4,tr);var sr=this.xMin||0,ar=this.yMin||0,or=this.xMax||0,lr=this.yMax||0,cr=this.advanceWidth||0;rr.strokeStyle="blue",draw.line(rr,er+sr*nr,-1e4,er+sr*nr,1e4),draw.line(rr,er+or*nr,-1e4,er+or*nr,1e4),draw.line(rr,-1e4,tr+-ar*nr,1e4,tr+-ar*nr),draw.line(rr,-1e4,tr+-lr*nr,1e4,tr+-lr*nr),rr.strokeStyle="green",draw.line(rr,er+cr*nr,-1e4,er+cr*nr,1e4)};function defineDependentProperty(rr,er,tr){Object.defineProperty(rr,er,{get:function(){return rr.path,rr[tr]},set:function(ir){rr[tr]=ir},enumerable:!0,configurable:!0})}function GlyphSet(rr,er){if(this.font=rr,this.glyphs={},Array.isArray(er))for(var tr=0;tr<er.length;tr++){var ir=er[tr];ir.path.unitsPerEm=rr.unitsPerEm,this.glyphs[tr]=ir}this.length=er&&er.length||0}GlyphSet.prototype.get=function(rr){if(this.glyphs[rr]===void 0){this.font._push(rr),typeof this.glyphs[rr]=="function"&&(this.glyphs[rr]=this.glyphs[rr]());var er=this.glyphs[rr],tr=this.font._IndexToUnicodeMap[rr];if(tr)for(var ir=0;ir<tr.unicodes.length;ir++)er.addUnicode(tr.unicodes[ir]);this.font.cffEncoding?this.font.isCIDFont?er.name="gid"+rr:er.name=this.font.cffEncoding.charset[rr]:this.font.glyphNames.names&&(er.name=this.font.glyphNames.glyphIndexToName(rr)),this.glyphs[rr].advanceWidth=this.font._hmtxTableData[rr].advanceWidth,this.glyphs[rr].leftSideBearing=this.font._hmtxTableData[rr].leftSideBearing}else typeof this.glyphs[rr]=="function"&&(this.glyphs[rr]=this.glyphs[rr]());return this.glyphs[rr]};GlyphSet.prototype.push=function(rr,er){this.glyphs[rr]=er,this.length++};function glyphLoader(rr,er){return new Glyph({index:er,font:rr})}function ttfGlyphLoader(rr,er,tr,ir,nr,sr){return function(){var ar=new Glyph({index:er,font:rr});return ar.path=function(){tr(ar,ir,nr);var or=sr(rr.glyphs,ar);return or.unitsPerEm=rr.unitsPerEm,or},defineDependentProperty(ar,"xMin","_xMin"),defineDependentProperty(ar,"xMax","_xMax"),defineDependentProperty(ar,"yMin","_yMin"),defineDependentProperty(ar,"yMax","_yMax"),ar}}function cffGlyphLoader(rr,er,tr,ir){return function(){var nr=new Glyph({index:er,font:rr});return nr.path=function(){var sr=tr(rr,nr,ir);return sr.unitsPerEm=rr.unitsPerEm,sr},nr}}var glyphset={GlyphSet,glyphLoader,ttfGlyphLoader,cffGlyphLoader};function equals(rr,er){if(rr===er)return!0;if(Array.isArray(rr)&&Array.isArray(er)){if(rr.length!==er.length)return!1;for(var tr=0;tr<rr.length;tr+=1)if(!equals(rr[tr],er[tr]))return!1;return!0}else return!1}function calcCFFSubroutineBias(rr){var er;return rr.length<1240?er=107:rr.length<33900?er=1131:er=32768,er}function parseCFFIndex(rr,er,tr){var ir=[],nr=[],sr=parse.getCard16(rr,er),ar,or;if(sr!==0){var lr=parse.getByte(rr,er+2);ar=er+(sr+1)*lr+2;for(var cr=er+3,ur=0;ur<sr+1;ur+=1)ir.push(parse.getOffset(rr,cr,lr)),cr+=lr;or=ar+ir[sr]}else or=er+2;for(var dr=0;dr<ir.length-1;dr+=1){var hr=parse.getBytes(rr,ar+ir[dr],ar+ir[dr+1]);tr&&(hr=tr(hr)),nr.push(hr)}return{objects:nr,startOffset:er,endOffset:or}}function parseCFFIndexLowMemory(rr,er){var tr=[],ir=parse.getCard16(rr,er),nr,sr;if(ir!==0){var ar=parse.getByte(rr,er+2);nr=er+(ir+1)*ar+2;for(var or=er+3,lr=0;lr<ir+1;lr+=1)tr.push(parse.getOffset(rr,or,ar)),or+=ar;sr=nr+tr[ir]}else sr=er+2;return{offsets:tr,startOffset:er,endOffset:sr}}function getCffIndexObject(rr,er,tr,ir,nr){var sr=parse.getCard16(tr,ir),ar=0;if(sr!==0){var or=parse.getByte(tr,ir+2);ar=ir+(sr+1)*or+2}var lr=parse.getBytes(tr,ar+er[rr],ar+er[rr+1]);return nr&&(lr=nr(lr)),lr}function parseFloatOperand(rr){for(var er="",tr=15,ir=["0","1","2","3","4","5","6","7","8","9",".","E","E-",null,"-"];;){var nr=rr.parseByte(),sr=nr>>4,ar=nr&15;if(sr===tr||(er+=ir[sr],ar===tr))break;er+=ir[ar]}return parseFloat(er)}function parseOperand(rr,er){var tr,ir,nr,sr;if(er===28)return tr=rr.parseByte(),ir=rr.parseByte(),tr<<8|ir;if(er===29)return tr=rr.parseByte(),ir=rr.parseByte(),nr=rr.parseByte(),sr=rr.parseByte(),tr<<24|ir<<16|nr<<8|sr;if(er===30)return parseFloatOperand(rr);if(er>=32&&er<=246)return er-139;if(er>=247&&er<=250)return tr=rr.parseByte(),(er-247)*256+tr+108;if(er>=251&&er<=254)return tr=rr.parseByte(),-(er-251)*256-tr-108;throw new Error("Invalid b0 "+er)}function entriesToObject(rr){for(var er={},tr=0;tr<rr.length;tr+=1){var ir=rr[tr][0],nr=rr[tr][1],sr=void 0;if(nr.length===1?sr=nr[0]:sr=nr,er.hasOwnProperty(ir)&&!isNaN(er[ir]))throw new Error("Object "+er+" already has key "+ir);er[ir]=sr}return er}function parseCFFDict(rr,er,tr){er=er!==void 0?er:0;var ir=new parse.Parser(rr,er),nr=[],sr=[];for(tr=tr!==void 0?tr:rr.length;ir.relativeOffset<tr;){var ar=ir.parseByte();ar<=21?(ar===12&&(ar=1200+ir.parseByte()),nr.push([ar,sr]),sr=[]):sr.push(parseOperand(ir,ar))}return entriesToObject(nr)}function getCFFString(rr,er){return er<=390?er=cffStandardStrings[er]:er=rr[er-391],er}function interpretDict(rr,er,tr){for(var ir={},nr,sr=0;sr<er.length;sr+=1){var ar=er[sr];if(Array.isArray(ar.type)){var or=[];or.length=ar.type.length;for(var lr=0;lr<ar.type.length;lr++)nr=rr[ar.op]!==void 0?rr[ar.op][lr]:void 0,nr===void 0&&(nr=ar.value!==void 0&&ar.value[lr]!==void 0?ar.value[lr]:null),ar.type[lr]==="SID"&&(nr=getCFFString(tr,nr)),or[lr]=nr;ir[ar.name]=or}else nr=rr[ar.op],nr===void 0&&(nr=ar.value!==void 0?ar.value:null),ar.type==="SID"&&(nr=getCFFString(tr,nr)),ir[ar.name]=nr}return ir}function parseCFFHeader(rr,er){var tr={};return tr.formatMajor=parse.getCard8(rr,er),tr.formatMinor=parse.getCard8(rr,er+1),tr.size=parse.getCard8(rr,er+2),tr.offsetSize=parse.getCard8(rr,er+3),tr.startOffset=er,tr.endOffset=er+4,tr}var TOP_DICT_META=[{name:"version",op:0,type:"SID"},{name:"notice",op:1,type:"SID"},{name:"copyright",op:1200,type:"SID"},{name:"fullName",op:2,type:"SID"},{name:"familyName",op:3,type:"SID"},{name:"weight",op:4,type:"SID"},{name:"isFixedPitch",op:1201,type:"number",value:0},{name:"italicAngle",op:1202,type:"number",value:0},{name:"underlinePosition",op:1203,type:"number",value:-100},{name:"underlineThickness",op:1204,type:"number",value:50},{name:"paintType",op:1205,type:"number",value:0},{name:"charstringType",op:1206,type:"number",value:2},{name:"fontMatrix",op:1207,type:["real","real","real","real","real","real"],value:[.001,0,0,.001,0,0]},{name:"uniqueId",op:13,type:"number"},{name:"fontBBox",op:5,type:["number","number","number","number"],value:[0,0,0,0]},{name:"strokeWidth",op:1208,type:"number",value:0},{name:"xuid",op:14,type:[],value:null},{name:"charset",op:15,type:"offset",value:0},{name:"encoding",op:16,type:"offset",value:0},{name:"charStrings",op:17,type:"offset",value:0},{name:"private",op:18,type:["number","offset"],value:[0,0]},{name:"ros",op:1230,type:["SID","SID","number"]},{name:"cidFontVersion",op:1231,type:"number",value:0},{name:"cidFontRevision",op:1232,type:"number",value:0},{name:"cidFontType",op:1233,type:"number",value:0},{name:"cidCount",op:1234,type:"number",value:8720},{name:"uidBase",op:1235,type:"number"},{name:"fdArray",op:1236,type:"offset"},{name:"fdSelect",op:1237,type:"offset"},{name:"fontName",op:1238,type:"SID"}],PRIVATE_DICT_META=[{name:"subrs",op:19,type:"offset",value:0},{name:"defaultWidthX",op:20,type:"number",value:0},{name:"nominalWidthX",op:21,type:"number",value:0}];function parseCFFTopDict(rr,er){var tr=parseCFFDict(rr,0,rr.byteLength);return interpretDict(tr,TOP_DICT_META,er)}function parseCFFPrivateDict(rr,er,tr,ir){var nr=parseCFFDict(rr,er,tr);return interpretDict(nr,PRIVATE_DICT_META,ir)}function gatherCFFTopDicts(rr,er,tr,ir){for(var nr=[],sr=0;sr<tr.length;sr+=1){var ar=new DataView(new Uint8Array(tr[sr]).buffer),or=parseCFFTopDict(ar,ir);or._subrs=[],or._subrsBias=0,or._defaultWidthX=0,or._nominalWidthX=0;var lr=or.private[0],cr=or.private[1];if(lr!==0&&cr!==0){var ur=parseCFFPrivateDict(rr,cr+er,lr,ir);if(or._defaultWidthX=ur.defaultWidthX,or._nominalWidthX=ur.nominalWidthX,ur.subrs!==0){var dr=cr+ur.subrs,hr=parseCFFIndex(rr,dr+er);or._subrs=hr.objects,or._subrsBias=calcCFFSubroutineBias(or._subrs)}or._privateDict=ur}nr.push(or)}return nr}function parseCFFCharset(rr,er,tr,ir){var nr,sr,ar=new parse.Parser(rr,er);tr-=1;var or=[".notdef"],lr=ar.parseCard8();if(lr===0)for(var cr=0;cr<tr;cr+=1)nr=ar.parseSID(),or.push(getCFFString(ir,nr));else if(lr===1)for(;or.length<=tr;){nr=ar.parseSID(),sr=ar.parseCard8();for(var ur=0;ur<=sr;ur+=1)or.push(getCFFString(ir,nr)),nr+=1}else if(lr===2)for(;or.length<=tr;){nr=ar.parseSID(),sr=ar.parseCard16();for(var dr=0;dr<=sr;dr+=1)or.push(getCFFString(ir,nr)),nr+=1}else throw new Error("Unknown charset format "+lr);return or}function parseCFFEncoding(rr,er,tr){var ir,nr={},sr=new parse.Parser(rr,er),ar=sr.parseCard8();if(ar===0)for(var or=sr.parseCard8(),lr=0;lr<or;lr+=1)ir=sr.parseCard8(),nr[ir]=lr;else if(ar===1){var cr=sr.parseCard8();ir=1;for(var ur=0;ur<cr;ur+=1)for(var dr=sr.parseCard8(),hr=sr.parseCard8(),pr=dr;pr<=dr+hr;pr+=1)nr[pr]=ir,ir+=1}else throw new Error("Unknown encoding format "+ar);return new CffEncoding(nr,tr)}function parseCFFCharstring(rr,er,tr){var ir,nr,sr,ar,or=new Path,lr=[],cr=0,ur=!1,dr=!1,hr=0,pr=0,gr,vr,mr,fr;if(rr.isCIDFont){var _r=rr.tables.cff.topDict._fdSelect[er.index],Ar=rr.tables.cff.topDict._fdArray[_r];gr=Ar._subrs,vr=Ar._subrsBias,mr=Ar._defaultWidthX,fr=Ar._nominalWidthX}else gr=rr.tables.cff.topDict._subrs,vr=rr.tables.cff.topDict._subrsBias,mr=rr.tables.cff.topDict._defaultWidthX,fr=rr.tables.cff.topDict._nominalWidthX;var yr=mr;function wr(br,Cr){dr&&or.closePath(),or.moveTo(br,Cr),dr=!0}function xr(){var br;br=lr.length%2!==0,br&&!ur&&(yr=lr.shift()+fr),cr+=lr.length>>1,lr.length=0,ur=!0}function Sr(br){for(var Cr,Ir,Rr,Pr,Dr,Fr,Or,Nr,Ur,Br,Wr,Xr,Yr=0;Yr<br.length;){var Qi=br[Yr];switch(Yr+=1,Qi){case 1:xr();break;case 3:xr();break;case 4:lr.length>1&&!ur&&(yr=lr.shift()+fr,ur=!0),pr+=lr.pop(),wr(hr,pr);break;case 5:for(;lr.length>0;)hr+=lr.shift(),pr+=lr.shift(),or.lineTo(hr,pr);break;case 6:for(;lr.length>0&&(hr+=lr.shift(),or.lineTo(hr,pr),lr.length!==0);)pr+=lr.shift(),or.lineTo(hr,pr);break;case 7:for(;lr.length>0&&(pr+=lr.shift(),or.lineTo(hr,pr),lr.length!==0);)hr+=lr.shift(),or.lineTo(hr,pr);break;case 8:for(;lr.length>0;)ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(ir,nr,sr,ar,hr,pr);break;case 10:Dr=lr.pop()+vr,Fr=gr[Dr],Fr&&Sr(Fr);break;case 11:return;case 12:switch(Qi=br[Yr],Yr+=1,Qi){case 35:ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),Or=sr+lr.shift(),Nr=ar+lr.shift(),Ur=Or+lr.shift(),Br=Nr+lr.shift(),Wr=Ur+lr.shift(),Xr=Br+lr.shift(),hr=Wr+lr.shift(),pr=Xr+lr.shift(),lr.shift(),or.curveTo(ir,nr,sr,ar,Or,Nr),or.curveTo(Ur,Br,Wr,Xr,hr,pr);break;case 34:ir=hr+lr.shift(),nr=pr,sr=ir+lr.shift(),ar=nr+lr.shift(),Or=sr+lr.shift(),Nr=ar,Ur=Or+lr.shift(),Br=ar,Wr=Ur+lr.shift(),Xr=pr,hr=Wr+lr.shift(),or.curveTo(ir,nr,sr,ar,Or,Nr),or.curveTo(Ur,Br,Wr,Xr,hr,pr);break;case 36:ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),Or=sr+lr.shift(),Nr=ar,Ur=Or+lr.shift(),Br=ar,Wr=Ur+lr.shift(),Xr=Br+lr.shift(),hr=Wr+lr.shift(),or.curveTo(ir,nr,sr,ar,Or,Nr),or.curveTo(Ur,Br,Wr,Xr,hr,pr);break;case 37:ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),Or=sr+lr.shift(),Nr=ar+lr.shift(),Ur=Or+lr.shift(),Br=Nr+lr.shift(),Wr=Ur+lr.shift(),Xr=Br+lr.shift(),Math.abs(Wr-hr)>Math.abs(Xr-pr)?hr=Wr+lr.shift():pr=Xr+lr.shift(),or.curveTo(ir,nr,sr,ar,Or,Nr),or.curveTo(Ur,Br,Wr,Xr,hr,pr);break;default:console.log("Glyph "+er.index+": unknown operator 1200"+Qi),lr.length=0}break;case 14:lr.length>0&&!ur&&(yr=lr.shift()+fr,ur=!0),dr&&(or.closePath(),dr=!1);break;case 18:xr();break;case 19:case 20:xr(),Yr+=cr+7>>3;break;case 21:lr.length>2&&!ur&&(yr=lr.shift()+fr,ur=!0),pr+=lr.pop(),hr+=lr.pop(),wr(hr,pr);break;case 22:lr.length>1&&!ur&&(yr=lr.shift()+fr,ur=!0),hr+=lr.pop(),wr(hr,pr);break;case 23:xr();break;case 24:for(;lr.length>2;)ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(ir,nr,sr,ar,hr,pr);hr+=lr.shift(),pr+=lr.shift(),or.lineTo(hr,pr);break;case 25:for(;lr.length>6;)hr+=lr.shift(),pr+=lr.shift(),or.lineTo(hr,pr);ir=hr+lr.shift(),nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar+lr.shift(),or.curveTo(ir,nr,sr,ar,hr,pr);break;case 26:for(lr.length%2&&(hr+=lr.shift());lr.length>0;)ir=hr,nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr,pr=ar+lr.shift(),or.curveTo(ir,nr,sr,ar,hr,pr);break;case 27:for(lr.length%2&&(pr+=lr.shift());lr.length>0;)ir=hr+lr.shift(),nr=pr,sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar,or.curveTo(ir,nr,sr,ar,hr,pr);break;case 28:Cr=br[Yr],Ir=br[Yr+1],lr.push((Cr<<24|Ir<<16)>>16),Yr+=2;break;case 29:Dr=lr.pop()+rr.gsubrsBias,Fr=rr.gsubrs[Dr],Fr&&Sr(Fr);break;case 30:for(;lr.length>0&&(ir=hr,nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar+(lr.length===1?lr.shift():0),or.curveTo(ir,nr,sr,ar,hr,pr),lr.length!==0);)ir=hr+lr.shift(),nr=pr,sr=ir+lr.shift(),ar=nr+lr.shift(),pr=ar+lr.shift(),hr=sr+(lr.length===1?lr.shift():0),or.curveTo(ir,nr,sr,ar,hr,pr);break;case 31:for(;lr.length>0&&(ir=hr+lr.shift(),nr=pr,sr=ir+lr.shift(),ar=nr+lr.shift(),pr=ar+lr.shift(),hr=sr+(lr.length===1?lr.shift():0),or.curveTo(ir,nr,sr,ar,hr,pr),lr.length!==0);)ir=hr,nr=pr+lr.shift(),sr=ir+lr.shift(),ar=nr+lr.shift(),hr=sr+lr.shift(),pr=ar+(lr.length===1?lr.shift():0),or.curveTo(ir,nr,sr,ar,hr,pr);break;default:Qi<32?console.log("Glyph "+er.index+": unknown operator "+Qi):Qi<247?lr.push(Qi-139):Qi<251?(Cr=br[Yr],Yr+=1,lr.push((Qi-247)*256+Cr+108)):Qi<255?(Cr=br[Yr],Yr+=1,lr.push(-(Qi-251)*256-Cr-108)):(Cr=br[Yr],Ir=br[Yr+1],Rr=br[Yr+2],Pr=br[Yr+3],Yr+=4,lr.push((Cr<<24|Ir<<16|Rr<<8|Pr)/65536))}}}return Sr(tr),er.advanceWidth=yr,or}function parseCFFFDSelect(rr,er,tr,ir){var nr=[],sr,ar=new parse.Parser(rr,er),or=ar.parseCard8();if(or===0)for(var lr=0;lr<tr;lr++){if(sr=ar.parseCard8(),sr>=ir)throw new Error("CFF table CID Font FDSelect has bad FD index value "+sr+" (FD count "+ir+")");nr.push(sr)}else if(or===3){var cr=ar.parseCard16(),ur=ar.parseCard16();if(ur!==0)throw new Error("CFF Table CID Font FDSelect format 3 range has bad initial GID "+ur);for(var dr,hr=0;hr<cr;hr++){if(sr=ar.parseCard8(),dr=ar.parseCard16(),sr>=ir)throw new Error("CFF table CID Font FDSelect has bad FD index value "+sr+" (FD count "+ir+")");if(dr>tr)throw new Error("CFF Table CID Font FDSelect format 3 range has bad GID "+dr);for(;ur<dr;ur++)nr.push(sr);ur=dr}if(dr!==tr)throw new Error("CFF Table CID Font FDSelect format 3 range has bad final GID "+dr)}else throw new Error("CFF Table CID Font FDSelect table has unsupported format "+or);return nr}function parseCFFTable(rr,er,tr,ir){tr.tables.cff={};var nr=parseCFFHeader(rr,er),sr=parseCFFIndex(rr,nr.endOffset,parse.bytesToString),ar=parseCFFIndex(rr,sr.endOffset),or=parseCFFIndex(rr,ar.endOffset,parse.bytesToString),lr=parseCFFIndex(rr,or.endOffset);tr.gsubrs=lr.objects,tr.gsubrsBias=calcCFFSubroutineBias(tr.gsubrs);var cr=gatherCFFTopDicts(rr,er,ar.objects,or.objects);if(cr.length!==1)throw new Error("CFF table has too many fonts in 'FontSet' - count of fonts NameIndex.length = "+cr.length);var ur=cr[0];if(tr.tables.cff.topDict=ur,ur._privateDict&&(tr.defaultWidthX=ur._privateDict.defaultWidthX,tr.nominalWidthX=ur._privateDict.nominalWidthX),ur.ros[0]!==void 0&&ur.ros[1]!==void 0&&(tr.isCIDFont=!0),tr.isCIDFont){var dr=ur.fdArray,hr=ur.fdSelect;if(dr===0||hr===0)throw new Error("Font is marked as a CID font, but FDArray and/or FDSelect information is missing");dr+=er;var pr=parseCFFIndex(rr,dr),gr=gatherCFFTopDicts(rr,er,pr.objects,or.objects);ur._fdArray=gr,hr+=er,ur._fdSelect=parseCFFFDSelect(rr,hr,tr.numGlyphs,gr.length)}var vr=er+ur.private[1],mr=parseCFFPrivateDict(rr,vr,ur.private[0],or.objects);if(tr.defaultWidthX=mr.defaultWidthX,tr.nominalWidthX=mr.nominalWidthX,mr.subrs!==0){var fr=vr+mr.subrs,_r=parseCFFIndex(rr,fr);tr.subrs=_r.objects,tr.subrsBias=calcCFFSubroutineBias(tr.subrs)}else tr.subrs=[],tr.subrsBias=0;var Ar;ir.lowMemory?(Ar=parseCFFIndexLowMemory(rr,er+ur.charStrings),tr.nGlyphs=Ar.offsets.length):(Ar=parseCFFIndex(rr,er+ur.charStrings),tr.nGlyphs=Ar.objects.length);var yr=parseCFFCharset(rr,er+ur.charset,tr.nGlyphs,or.objects);if(ur.encoding===0?tr.cffEncoding=new CffEncoding(cffStandardEncoding,yr):ur.encoding===1?tr.cffEncoding=new CffEncoding(cffExpertEncoding,yr):tr.cffEncoding=parseCFFEncoding(rr,er+ur.encoding,yr),tr.encoding=tr.encoding||tr.cffEncoding,tr.glyphs=new glyphset.GlyphSet(tr),ir.lowMemory)tr._push=function(Sr){var br=getCffIndexObject(Sr,Ar.offsets,rr,er+ur.charStrings);tr.glyphs.push(Sr,glyphset.cffGlyphLoader(tr,Sr,parseCFFCharstring,br))};else for(var wr=0;wr<tr.nGlyphs;wr+=1){var xr=Ar.objects[wr];tr.glyphs.push(wr,glyphset.cffGlyphLoader(tr,wr,parseCFFCharstring,xr))}}function encodeString(rr,er){var tr,ir=cffStandardStrings.indexOf(rr);return ir>=0&&(tr=ir),ir=er.indexOf(rr),ir>=0?tr=ir+cffStandardStrings.length:(tr=cffStandardStrings.length+er.length,er.push(rr)),tr}function makeHeader(){return new table.Record("Header",[{name:"major",type:"Card8",value:1},{name:"minor",type:"Card8",value:0},{name:"hdrSize",type:"Card8",value:4},{name:"major",type:"Card8",value:1}])}function makeNameIndex(rr){var er=new table.Record("Name INDEX",[{name:"names",type:"INDEX",value:[]}]);er.names=[];for(var tr=0;tr<rr.length;tr+=1)er.names.push({name:"name_"+tr,type:"NAME",value:rr[tr]});return er}function makeDict(rr,er,tr){for(var ir={},nr=0;nr<rr.length;nr+=1){var sr=rr[nr],ar=er[sr.name];ar!==void 0&&!equals(ar,sr.value)&&(sr.type==="SID"&&(ar=encodeString(ar,tr)),ir[sr.op]={name:sr.name,type:sr.type,value:ar})}return ir}function makeTopDict(rr,er){var tr=new table.Record("Top DICT",[{name:"dict",type:"DICT",value:{}}]);return tr.dict=makeDict(TOP_DICT_META,rr,er),tr}function makeTopDictIndex(rr){var er=new table.Record("Top DICT INDEX",[{name:"topDicts",type:"INDEX",value:[]}]);return er.topDicts=[{name:"topDict_0",type:"TABLE",value:rr}],er}function makeStringIndex(rr){var er=new table.Record("String INDEX",[{name:"strings",type:"INDEX",value:[]}]);er.strings=[];for(var tr=0;tr<rr.length;tr+=1)er.strings.push({name:"string_"+tr,type:"STRING",value:rr[tr]});return er}function makeGlobalSubrIndex(){return new table.Record("Global Subr INDEX",[{name:"subrs",type:"INDEX",value:[]}])}function makeCharsets(rr,er){for(var tr=new table.Record("Charsets",[{name:"format",type:"Card8",value:0}]),ir=0;ir<rr.length;ir+=1){var nr=rr[ir],sr=encodeString(nr,er);tr.fields.push({name:"glyph_"+ir,type:"SID",value:sr})}return tr}function glyphToOps(rr){var er=[],tr=rr.path;er.push({name:"width",type:"NUMBER",value:rr.advanceWidth});for(var ir=0,nr=0,sr=0;sr<tr.commands.length;sr+=1){var ar=void 0,or=void 0,lr=tr.commands[sr];if(lr.type==="Q"){var cr=.3333333333333333,ur=2/3;lr={type:"C",x:lr.x,y:lr.y,x1:Math.round(cr*ir+ur*lr.x1),y1:Math.round(cr*nr+ur*lr.y1),x2:Math.round(cr*lr.x+ur*lr.x1),y2:Math.round(cr*lr.y+ur*lr.y1)}}if(lr.type==="M")ar=Math.round(lr.x-ir),or=Math.round(lr.y-nr),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rmoveto",type:"OP",value:21}),ir=Math.round(lr.x),nr=Math.round(lr.y);else if(lr.type==="L")ar=Math.round(lr.x-ir),or=Math.round(lr.y-nr),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rlineto",type:"OP",value:5}),ir=Math.round(lr.x),nr=Math.round(lr.y);else if(lr.type==="C"){var dr=Math.round(lr.x1-ir),hr=Math.round(lr.y1-nr),pr=Math.round(lr.x2-lr.x1),gr=Math.round(lr.y2-lr.y1);ar=Math.round(lr.x-lr.x2),or=Math.round(lr.y-lr.y2),er.push({name:"dx1",type:"NUMBER",value:dr}),er.push({name:"dy1",type:"NUMBER",value:hr}),er.push({name:"dx2",type:"NUMBER",value:pr}),er.push({name:"dy2",type:"NUMBER",value:gr}),er.push({name:"dx",type:"NUMBER",value:ar}),er.push({name:"dy",type:"NUMBER",value:or}),er.push({name:"rrcurveto",type:"OP",value:8}),ir=Math.round(lr.x),nr=Math.round(lr.y)}}return er.push({name:"endchar",type:"OP",value:14}),er}function makeCharStringsIndex(rr){for(var er=new table.Record("CharStrings INDEX",[{name:"charStrings",type:"INDEX",value:[]}]),tr=0;tr<rr.length;tr+=1){var ir=rr.get(tr),nr=glyphToOps(ir);er.charStrings.push({name:ir.name,type:"CHARSTRING",value:nr})}return er}function makePrivateDict(rr,er){var tr=new table.Record("Private DICT",[{name:"dict",type:"DICT",value:{}}]);return tr.dict=makeDict(PRIVATE_DICT_META,rr,er),tr}function makeCFFTable(rr,er){for(var tr=new table.Table("CFF ",[{name:"header",type:"RECORD"},{name:"nameIndex",type:"RECORD"},{name:"topDictIndex",type:"RECORD"},{name:"stringIndex",type:"RECORD"},{name:"globalSubrIndex",type:"RECORD"},{name:"charsets",type:"RECORD"},{name:"charStringsIndex",type:"RECORD"},{name:"privateDict",type:"RECORD"}]),ir=1/er.unitsPerEm,nr={version:er.version,fullName:er.fullName,familyName:er.familyName,weight:er.weightName,fontBBox:er.fontBBox||[0,0,0,0],fontMatrix:[ir,0,0,ir,0,0],charset:999,encoding:0,charStrings:999,private:[0,999]},sr={},ar=[],or,lr=1;lr<rr.length;lr+=1)or=rr.get(lr),ar.push(or.name);var cr=[];tr.header=makeHeader(),tr.nameIndex=makeNameIndex([er.postScriptName]);var ur=makeTopDict(nr,cr);tr.topDictIndex=makeTopDictIndex(ur),tr.globalSubrIndex=makeGlobalSubrIndex(),tr.charsets=makeCharsets(ar,cr),tr.charStringsIndex=makeCharStringsIndex(rr),tr.privateDict=makePrivateDict(sr,cr),tr.stringIndex=makeStringIndex(cr);var dr=tr.header.sizeOf()+tr.nameIndex.sizeOf()+tr.topDictIndex.sizeOf()+tr.stringIndex.sizeOf()+tr.globalSubrIndex.sizeOf();return nr.charset=dr,nr.encoding=0,nr.charStrings=nr.charset+tr.charsets.sizeOf(),nr.private[1]=nr.charStrings+tr.charStringsIndex.sizeOf(),ur=makeTopDict(nr,cr),tr.topDictIndex=makeTopDictIndex(ur),tr}var cff={parse:parseCFFTable,make:makeCFFTable};function parseHeadTable(rr,er){var tr={},ir=new parse.Parser(rr,er);return tr.version=ir.parseVersion(),tr.fontRevision=Math.round(ir.parseFixed()*1e3)/1e3,tr.checkSumAdjustment=ir.parseULong(),tr.magicNumber=ir.parseULong(),check.argument(tr.magicNumber===1594834165,"Font header has wrong magic number."),tr.flags=ir.parseUShort(),tr.unitsPerEm=ir.parseUShort(),tr.created=ir.parseLongDateTime(),tr.modified=ir.parseLongDateTime(),tr.xMin=ir.parseShort(),tr.yMin=ir.parseShort(),tr.xMax=ir.parseShort(),tr.yMax=ir.parseShort(),tr.macStyle=ir.parseUShort(),tr.lowestRecPPEM=ir.parseUShort(),tr.fontDirectionHint=ir.parseShort(),tr.indexToLocFormat=ir.parseShort(),tr.glyphDataFormat=ir.parseShort(),tr}function makeHeadTable(rr){var er=Math.round(new Date().getTime()/1e3)+2082844800,tr=er;return rr.createdTimestamp&&(tr=rr.createdTimestamp+2082844800),new table.Table("head",[{name:"version",type:"FIXED",value:65536},{name:"fontRevision",type:"FIXED",value:65536},{name:"checkSumAdjustment",type:"ULONG",value:0},{name:"magicNumber",type:"ULONG",value:1594834165},{name:"flags",type:"USHORT",value:0},{name:"unitsPerEm",type:"USHORT",value:1e3},{name:"created",type:"LONGDATETIME",value:tr},{name:"modified",type:"LONGDATETIME",value:er},{name:"xMin",type:"SHORT",value:0},{name:"yMin",type:"SHORT",value:0},{name:"xMax",type:"SHORT",value:0},{name:"yMax",type:"SHORT",value:0},{name:"macStyle",type:"USHORT",value:0},{name:"lowestRecPPEM",type:"USHORT",value:0},{name:"fontDirectionHint",type:"SHORT",value:2},{name:"indexToLocFormat",type:"SHORT",value:0},{name:"glyphDataFormat",type:"SHORT",value:0}],rr)}var head={parse:parseHeadTable,make:makeHeadTable};function parseHheaTable(rr,er){var tr={},ir=new parse.Parser(rr,er);return tr.version=ir.parseVersion(),tr.ascender=ir.parseShort(),tr.descender=ir.parseShort(),tr.lineGap=ir.parseShort(),tr.advanceWidthMax=ir.parseUShort(),tr.minLeftSideBearing=ir.parseShort(),tr.minRightSideBearing=ir.parseShort(),tr.xMaxExtent=ir.parseShort(),tr.caretSlopeRise=ir.parseShort(),tr.caretSlopeRun=ir.parseShort(),tr.caretOffset=ir.parseShort(),ir.relativeOffset+=8,tr.metricDataFormat=ir.parseShort(),tr.numberOfHMetrics=ir.parseUShort(),tr}function makeHheaTable(rr){return new table.Table("hhea",[{name:"version",type:"FIXED",value:65536},{name:"ascender",type:"FWORD",value:0},{name:"descender",type:"FWORD",value:0},{name:"lineGap",type:"FWORD",value:0},{name:"advanceWidthMax",type:"UFWORD",value:0},{name:"minLeftSideBearing",type:"FWORD",value:0},{name:"minRightSideBearing",type:"FWORD",value:0},{name:"xMaxExtent",type:"FWORD",value:0},{name:"caretSlopeRise",type:"SHORT",value:1},{name:"caretSlopeRun",type:"SHORT",value:0},{name:"caretOffset",type:"SHORT",value:0},{name:"reserved1",type:"SHORT",value:0},{name:"reserved2",type:"SHORT",value:0},{name:"reserved3",type:"SHORT",value:0},{name:"reserved4",type:"SHORT",value:0},{name:"metricDataFormat",type:"SHORT",value:0},{name:"numberOfHMetrics",type:"USHORT",value:0}],rr)}var hhea={parse:parseHheaTable,make:makeHheaTable};function parseHmtxTableAll(rr,er,tr,ir,nr){for(var sr,ar,or=new parse.Parser(rr,er),lr=0;lr<ir;lr+=1){lr<tr&&(sr=or.parseUShort(),ar=or.parseShort());var cr=nr.get(lr);cr.advanceWidth=sr,cr.leftSideBearing=ar}}function parseHmtxTableOnLowMemory(rr,er,tr,ir,nr){rr._hmtxTableData={};for(var sr,ar,or=new parse.Parser(er,tr),lr=0;lr<nr;lr+=1)lr<ir&&(sr=or.parseUShort(),ar=or.parseShort()),rr._hmtxTableData[lr]={advanceWidth:sr,leftSideBearing:ar}}function parseHmtxTable(rr,er,tr,ir,nr,sr,ar){ar.lowMemory?parseHmtxTableOnLowMemory(rr,er,tr,ir,nr):parseHmtxTableAll(er,tr,ir,nr,sr)}function makeHmtxTable(rr){for(var er=new table.Table("hmtx",[]),tr=0;tr<rr.length;tr+=1){var ir=rr.get(tr),nr=ir.advanceWidth||0,sr=ir.leftSideBearing||0;er.fields.push({name:"advanceWidth_"+tr,type:"USHORT",value:nr}),er.fields.push({name:"leftSideBearing_"+tr,type:"SHORT",value:sr})}return er}var hmtx={parse:parseHmtxTable,make:makeHmtxTable};function makeLtagTable(rr){for(var er=new table.Table("ltag",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"numTags",type:"ULONG",value:rr.length}]),tr="",ir=12+rr.length*4,nr=0;nr<rr.length;++nr){var sr=tr.indexOf(rr[nr]);sr<0&&(sr=tr.length,tr+=rr[nr]),er.fields.push({name:"offset "+nr,type:"USHORT",value:ir+sr}),er.fields.push({name:"length "+nr,type:"USHORT",value:rr[nr].length})}return er.fields.push({name:"stringPool",type:"CHARARRAY",value:tr}),er}function parseLtagTable(rr,er){var tr=new parse.Parser(rr,er),ir=tr.parseULong();check.argument(ir===1,"Unsupported ltag table version."),tr.skip("uLong",1);for(var nr=tr.parseULong(),sr=[],ar=0;ar<nr;ar++){for(var or="",lr=er+tr.parseUShort(),cr=tr.parseUShort(),ur=lr;ur<lr+cr;++ur)or+=String.fromCharCode(rr.getInt8(ur));sr.push(or)}return sr}var ltag={make:makeLtagTable,parse:parseLtagTable};function parseMaxpTable(rr,er){var tr={},ir=new parse.Parser(rr,er);return tr.version=ir.parseVersion(),tr.numGlyphs=ir.parseUShort(),tr.version===1&&(tr.maxPoints=ir.parseUShort(),tr.maxContours=ir.parseUShort(),tr.maxCompositePoints=ir.parseUShort(),tr.maxCompositeContours=ir.parseUShort(),tr.maxZones=ir.parseUShort(),tr.maxTwilightPoints=ir.parseUShort(),tr.maxStorage=ir.parseUShort(),tr.maxFunctionDefs=ir.parseUShort(),tr.maxInstructionDefs=ir.parseUShort(),tr.maxStackElements=ir.parseUShort(),tr.maxSizeOfInstructions=ir.parseUShort(),tr.maxComponentElements=ir.parseUShort(),tr.maxComponentDepth=ir.parseUShort()),tr}function makeMaxpTable(rr){return new table.Table("maxp",[{name:"version",type:"FIXED",value:20480},{name:"numGlyphs",type:"USHORT",value:rr}])}var maxp={parse:parseMaxpTable,make:makeMaxpTable},nameTableNames=["copyright","fontFamily","fontSubfamily","uniqueID","fullName","version","postScriptName","trademark","manufacturer","designer","description","manufacturerURL","designerURL","license","licenseURL","reserved","preferredFamily","preferredSubfamily","compatibleFullName","sampleText","postScriptFindFontName","wwsFamily","wwsSubfamily"],macLanguages={0:"en",1:"fr",2:"de",3:"it",4:"nl",5:"sv",6:"es",7:"da",8:"pt",9:"no",10:"he",11:"ja",12:"ar",13:"fi",14:"el",15:"is",16:"mt",17:"tr",18:"hr",19:"zh-Hant",20:"ur",21:"hi",22:"th",23:"ko",24:"lt",25:"pl",26:"hu",27:"es",28:"lv",29:"se",30:"fo",31:"fa",32:"ru",33:"zh",34:"nl-BE",35:"ga",36:"sq",37:"ro",38:"cz",39:"sk",40:"si",41:"yi",42:"sr",43:"mk",44:"bg",45:"uk",46:"be",47:"uz",48:"kk",49:"az-Cyrl",50:"az-Arab",51:"hy",52:"ka",53:"mo",54:"ky",55:"tg",56:"tk",57:"mn-CN",58:"mn",59:"ps",60:"ks",61:"ku",62:"sd",63:"bo",64:"ne",65:"sa",66:"mr",67:"bn",68:"as",69:"gu",70:"pa",71:"or",72:"ml",73:"kn",74:"ta",75:"te",76:"si",77:"my",78:"km",79:"lo",80:"vi",81:"id",82:"tl",83:"ms",84:"ms-Arab",85:"am",86:"ti",87:"om",88:"so",89:"sw",90:"rw",91:"rn",92:"ny",93:"mg",94:"eo",128:"cy",129:"eu",130:"ca",131:"la",132:"qu",133:"gn",134:"ay",135:"tt",136:"ug",137:"dz",138:"jv",139:"su",140:"gl",141:"af",142:"br",143:"iu",144:"gd",145:"gv",146:"ga",147:"to",148:"el-polyton",149:"kl",150:"az",151:"nn"},macLanguageToScript={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:5,11:1,12:4,13:0,14:6,15:0,16:0,17:0,18:0,19:2,20:4,21:9,22:21,23:3,24:29,25:29,26:29,27:29,28:29,29:0,30:0,31:4,32:7,33:25,34:0,35:0,36:0,37:0,38:29,39:29,40:0,41:5,42:7,43:7,44:7,45:7,46:7,47:7,48:7,49:7,50:4,51:24,52:23,53:7,54:7,55:7,56:7,57:27,58:7,59:4,60:4,61:4,62:4,63:26,64:9,65:9,66:9,67:13,68:13,69:11,70:10,71:12,72:17,73:16,74:14,75:15,76:18,77:19,78:20,79:22,80:30,81:0,82:0,83:0,84:4,85:28,86:28,87:28,88:0,89:0,90:0,91:0,92:0,93:0,94:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:7,136:4,137:26,138:0,139:0,140:0,141:0,142:0,143:28,144:0,145:0,146:0,147:0,148:6,149:0,150:0,151:0},windowsLanguages={1078:"af",1052:"sq",1156:"gsw",1118:"am",5121:"ar-DZ",15361:"ar-BH",3073:"ar",2049:"ar-IQ",11265:"ar-JO",13313:"ar-KW",12289:"ar-LB",4097:"ar-LY",6145:"ary",8193:"ar-OM",16385:"ar-QA",1025:"ar-SA",10241:"ar-SY",7169:"aeb",14337:"ar-AE",9217:"ar-YE",1067:"hy",1101:"as",2092:"az-Cyrl",1068:"az",1133:"ba",1069:"eu",1059:"be",2117:"bn",1093:"bn-IN",8218:"bs-Cyrl",5146:"bs",1150:"br",1026:"bg",1027:"ca",3076:"zh-HK",5124:"zh-MO",2052:"zh",4100:"zh-SG",1028:"zh-TW",1155:"co",1050:"hr",4122:"hr-BA",1029:"cs",1030:"da",1164:"prs",1125:"dv",2067:"nl-BE",1043:"nl",3081:"en-AU",10249:"en-BZ",4105:"en-CA",9225:"en-029",16393:"en-IN",6153:"en-IE",8201:"en-JM",17417:"en-MY",5129:"en-NZ",13321:"en-PH",18441:"en-SG",7177:"en-ZA",11273:"en-TT",2057:"en-GB",1033:"en",12297:"en-ZW",1061:"et",1080:"fo",1124:"fil",1035:"fi",2060:"fr-BE",3084:"fr-CA",1036:"fr",5132:"fr-LU",6156:"fr-MC",4108:"fr-CH",1122:"fy",1110:"gl",1079:"ka",3079:"de-AT",1031:"de",5127:"de-LI",4103:"de-LU",2055:"de-CH",1032:"el",1135:"kl",1095:"gu",1128:"ha",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig",1057:"id",1117:"iu",2141:"iu-Latn",2108:"ga",1076:"xh",1077:"zu",1040:"it",2064:"it-CH",1041:"ja",1099:"kn",1087:"kk",1107:"km",1158:"quc",1159:"rw",1089:"sw",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1062:"lv",1063:"lt",2094:"dsb",1134:"lb",1071:"mk",2110:"ms-BN",1086:"ms",1100:"ml",1082:"mt",1153:"mi",1146:"arn",1102:"mr",1148:"moh",1104:"mn",2128:"mn-CN",1121:"ne",1044:"nb",2068:"nn",1154:"oc",1096:"or",1123:"ps",1045:"pl",1046:"pt",2070:"pt-PT",1094:"pa",1131:"qu-BO",2155:"qu-EC",3179:"qu",1048:"ro",1047:"rm",1049:"ru",9275:"smn",4155:"smj-NO",5179:"smj",3131:"se-FI",1083:"se",2107:"se-SE",8251:"sms",6203:"sma-NO",7227:"sms",1103:"sa",7194:"sr-Cyrl-BA",3098:"sr",6170:"sr-Latn-BA",2074:"sr-Latn",1132:"nso",1074:"tn",1115:"si",1051:"sk",1060:"sl",11274:"es-AR",16394:"es-BO",13322:"es-CL",9226:"es-CO",5130:"es-CR",7178:"es-DO",12298:"es-EC",17418:"es-SV",4106:"es-GT",18442:"es-HN",2058:"es-MX",19466:"es-NI",6154:"es-PA",15370:"es-PY",10250:"es-PE",20490:"es-PR",3082:"es",1034:"es",21514:"es-US",14346:"es-UY",8202:"es-VE",2077:"sv-FI",1053:"sv",1114:"syr",1064:"tg",2143:"tzm",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1055:"tr",1090:"tk",1152:"ug",1058:"uk",1070:"hsb",1056:"ur",2115:"uz-Cyrl",1091:"uz",1066:"vi",1106:"cy",1160:"wo",1157:"sah",1144:"ii",1130:"yo"};function getLanguageCode(rr,er,tr){switch(rr){case 0:if(er===65535)return"und";if(tr)return tr[er];break;case 1:return macLanguages[er];case 3:return windowsLanguages[er]}}var utf16="utf-16",macScriptEncodings={0:"macintosh",1:"x-mac-japanese",2:"x-mac-chinesetrad",3:"x-mac-korean",6:"x-mac-greek",7:"x-mac-cyrillic",9:"x-mac-devanagai",10:"x-mac-gurmukhi",11:"x-mac-gujarati",12:"x-mac-oriya",13:"x-mac-bengali",14:"x-mac-tamil",15:"x-mac-telugu",16:"x-mac-kannada",17:"x-mac-malayalam",18:"x-mac-sinhalese",19:"x-mac-burmese",20:"x-mac-khmer",21:"x-mac-thai",22:"x-mac-lao",23:"x-mac-georgian",24:"x-mac-armenian",25:"x-mac-chinesesimp",26:"x-mac-tibetan",27:"x-mac-mongolian",28:"x-mac-ethiopic",29:"x-mac-ce",30:"x-mac-vietnamese",31:"x-mac-extarabic"},macLanguageEncodings={15:"x-mac-icelandic",17:"x-mac-turkish",18:"x-mac-croatian",24:"x-mac-ce",25:"x-mac-ce",26:"x-mac-ce",27:"x-mac-ce",28:"x-mac-ce",30:"x-mac-icelandic",37:"x-mac-romanian",38:"x-mac-ce",39:"x-mac-ce",40:"x-mac-ce",143:"x-mac-inuit",146:"x-mac-gaelic"};function getEncoding(rr,er,tr){switch(rr){case 0:return utf16;case 1:return macLanguageEncodings[tr]||macScriptEncodings[er];case 3:if(er===1||er===10)return utf16;break}}function parseNameTable(rr,er,tr){for(var ir={},nr=new parse.Parser(rr,er),sr=nr.parseUShort(),ar=nr.parseUShort(),or=nr.offset+nr.parseUShort(),lr=0;lr<ar;lr++){var cr=nr.parseUShort(),ur=nr.parseUShort(),dr=nr.parseUShort(),hr=nr.parseUShort(),pr=nameTableNames[hr]||hr,gr=nr.parseUShort(),vr=nr.parseUShort(),mr=getLanguageCode(cr,dr,tr),fr=getEncoding(cr,ur,dr);if(fr!==void 0&&mr!==void 0){var _r=void 0;if(fr===utf16?_r=decode.UTF16(rr,or+vr,gr):_r=decode.MACSTRING(rr,or+vr,gr,fr),_r){var Ar=ir[pr];Ar===void 0&&(Ar=ir[pr]={}),Ar[mr]=_r}}}var yr=0;return sr===1&&(yr=nr.parseUShort()),ir}function reverseDict(rr){var er={};for(var tr in rr)er[rr[tr]]=parseInt(tr);return er}function makeNameRecord(rr,er,tr,ir,nr,sr){return new table.Record("NameRecord",[{name:"platformID",type:"USHORT",value:rr},{name:"encodingID",type:"USHORT",value:er},{name:"languageID",type:"USHORT",value:tr},{name:"nameID",type:"USHORT",value:ir},{name:"length",type:"USHORT",value:nr},{name:"offset",type:"USHORT",value:sr}])}function findSubArray(rr,er){var tr=rr.length,ir=er.length-tr+1;e:for(var nr=0;nr<ir;nr++)for(;nr<ir;nr++){for(var sr=0;sr<tr;sr++)if(er[nr+sr]!==rr[sr])continue e;return nr}return-1}function addStringToPool(rr,er){var tr=findSubArray(rr,er);if(tr<0){tr=er.length;for(var ir=0,nr=rr.length;ir<nr;++ir)er.push(rr[ir])}return tr}function makeNameTable(rr,er){var tr,ir=[],nr={},sr=reverseDict(nameTableNames);for(var ar in rr){var or=sr[ar];if(or===void 0&&(or=ar),tr=parseInt(or),isNaN(tr))throw new Error('Name table entry "'+ar+'" does not exist, see nameTableNames for complete list.');nr[tr]=rr[ar],ir.push(tr)}for(var lr=reverseDict(macLanguages),cr=reverseDict(windowsLanguages),ur=[],dr=[],hr=0;hr<ir.length;hr++){tr=ir[hr];var pr=nr[tr];for(var gr in pr){var vr=pr[gr],mr=1,fr=lr[gr],_r=macLanguageToScript[fr],Ar=getEncoding(mr,_r,fr),yr=encode.MACSTRING(vr,Ar);yr===void 0&&(mr=0,fr=er.indexOf(gr),fr<0&&(fr=er.length,er.push(gr)),_r=4,yr=encode.UTF16(vr));var wr=addStringToPool(yr,dr);ur.push(makeNameRecord(mr,_r,fr,tr,yr.length,wr));var xr=cr[gr];if(xr!==void 0){var Sr=encode.UTF16(vr),br=addStringToPool(Sr,dr);ur.push(makeNameRecord(3,1,xr,tr,Sr.length,br))}}}ur.sort(function(Rr,Pr){return Rr.platformID-Pr.platformID||Rr.encodingID-Pr.encodingID||Rr.languageID-Pr.languageID||Rr.nameID-Pr.nameID});for(var Cr=new table.Table("name",[{name:"format",type:"USHORT",value:0},{name:"count",type:"USHORT",value:ur.length},{name:"stringOffset",type:"USHORT",value:6+ur.length*12}]),Ir=0;Ir<ur.length;Ir++)Cr.fields.push({name:"record_"+Ir,type:"RECORD",value:ur[Ir]});return Cr.fields.push({name:"strings",type:"LITERAL",value:dr}),Cr}var _name={parse:parseNameTable,make:makeNameTable},unicodeRanges=[{begin:0,end:127},{begin:128,end:255},{begin:256,end:383},{begin:384,end:591},{begin:592,end:687},{begin:688,end:767},{begin:768,end:879},{begin:880,end:1023},{begin:11392,end:11519},{begin:1024,end:1279},{begin:1328,end:1423},{begin:1424,end:1535},{begin:42240,end:42559},{begin:1536,end:1791},{begin:1984,end:2047},{begin:2304,end:2431},{begin:2432,end:2559},{begin:2560,end:2687},{begin:2688,end:2815},{begin:2816,end:2943},{begin:2944,end:3071},{begin:3072,end:3199},{begin:3200,end:3327},{begin:3328,end:3455},{begin:3584,end:3711},{begin:3712,end:3839},{begin:4256,end:4351},{begin:6912,end:7039},{begin:4352,end:4607},{begin:7680,end:7935},{begin:7936,end:8191},{begin:8192,end:8303},{begin:8304,end:8351},{begin:8352,end:8399},{begin:8400,end:8447},{begin:8448,end:8527},{begin:8528,end:8591},{begin:8592,end:8703},{begin:8704,end:8959},{begin:8960,end:9215},{begin:9216,end:9279},{begin:9280,end:9311},{begin:9312,end:9471},{begin:9472,end:9599},{begin:9600,end:9631},{begin:9632,end:9727},{begin:9728,end:9983},{begin:9984,end:10175},{begin:12288,end:12351},{begin:12352,end:12447},{begin:12448,end:12543},{begin:12544,end:12591},{begin:12592,end:12687},{begin:43072,end:43135},{begin:12800,end:13055},{begin:13056,end:13311},{begin:44032,end:55215},{begin:55296,end:57343},{begin:67840,end:67871},{begin:19968,end:40959},{begin:57344,end:63743},{begin:12736,end:12783},{begin:64256,end:64335},{begin:64336,end:65023},{begin:65056,end:65071},{begin:65040,end:65055},{begin:65104,end:65135},{begin:65136,end:65279},{begin:65280,end:65519},{begin:65520,end:65535},{begin:3840,end:4095},{begin:1792,end:1871},{begin:1920,end:1983},{begin:3456,end:3583},{begin:4096,end:4255},{begin:4608,end:4991},{begin:5024,end:5119},{begin:5120,end:5759},{begin:5760,end:5791},{begin:5792,end:5887},{begin:6016,end:6143},{begin:6144,end:6319},{begin:10240,end:10495},{begin:40960,end:42127},{begin:5888,end:5919},{begin:66304,end:66351},{begin:66352,end:66383},{begin:66560,end:66639},{begin:118784,end:119039},{begin:119808,end:120831},{begin:1044480,end:1048573},{begin:65024,end:65039},{begin:917504,end:917631},{begin:6400,end:6479},{begin:6480,end:6527},{begin:6528,end:6623},{begin:6656,end:6687},{begin:11264,end:11359},{begin:11568,end:11647},{begin:19904,end:19967},{begin:43008,end:43055},{begin:65536,end:65663},{begin:65856,end:65935},{begin:66432,end:66463},{begin:66464,end:66527},{begin:66640,end:66687},{begin:66688,end:66735},{begin:67584,end:67647},{begin:68096,end:68191},{begin:119552,end:119647},{begin:73728,end:74751},{begin:119648,end:119679},{begin:7040,end:7103},{begin:7168,end:7247},{begin:7248,end:7295},{begin:43136,end:43231},{begin:43264,end:43311},{begin:43312,end:43359},{begin:43520,end:43615},{begin:65936,end:65999},{begin:66e3,end:66047},{begin:66208,end:66271},{begin:127024,end:127135}];function getUnicodeRange(rr){for(var er=0;er<unicodeRanges.length;er+=1){var tr=unicodeRanges[er];if(rr>=tr.begin&&rr<tr.end)return er}return-1}function parseOS2Table(rr,er){var tr={},ir=new parse.Parser(rr,er);tr.version=ir.parseUShort(),tr.xAvgCharWidth=ir.parseShort(),tr.usWeightClass=ir.parseUShort(),tr.usWidthClass=ir.parseUShort(),tr.fsType=ir.parseUShort(),tr.ySubscriptXSize=ir.parseShort(),tr.ySubscriptYSize=ir.parseShort(),tr.ySubscriptXOffset=ir.parseShort(),tr.ySubscriptYOffset=ir.parseShort(),tr.ySuperscriptXSize=ir.parseShort(),tr.ySuperscriptYSize=ir.parseShort(),tr.ySuperscriptXOffset=ir.parseShort(),tr.ySuperscriptYOffset=ir.parseShort(),tr.yStrikeoutSize=ir.parseShort(),tr.yStrikeoutPosition=ir.parseShort(),tr.sFamilyClass=ir.parseShort(),tr.panose=[];for(var nr=0;nr<10;nr++)tr.panose[nr]=ir.parseByte();return tr.ulUnicodeRange1=ir.parseULong(),tr.ulUnicodeRange2=ir.parseULong(),tr.ulUnicodeRange3=ir.parseULong(),tr.ulUnicodeRange4=ir.parseULong(),tr.achVendID=String.fromCharCode(ir.parseByte(),ir.parseByte(),ir.parseByte(),ir.parseByte()),tr.fsSelection=ir.parseUShort(),tr.usFirstCharIndex=ir.parseUShort(),tr.usLastCharIndex=ir.parseUShort(),tr.sTypoAscender=ir.parseShort(),tr.sTypoDescender=ir.parseShort(),tr.sTypoLineGap=ir.parseShort(),tr.usWinAscent=ir.parseUShort(),tr.usWinDescent=ir.parseUShort(),tr.version>=1&&(tr.ulCodePageRange1=ir.parseULong(),tr.ulCodePageRange2=ir.parseULong()),tr.version>=2&&(tr.sxHeight=ir.parseShort(),tr.sCapHeight=ir.parseShort(),tr.usDefaultChar=ir.parseUShort(),tr.usBreakChar=ir.parseUShort(),tr.usMaxContent=ir.parseUShort()),tr}function makeOS2Table(rr){return new table.Table("OS/2",[{name:"version",type:"USHORT",value:3},{name:"xAvgCharWidth",type:"SHORT",value:0},{name:"usWeightClass",type:"USHORT",value:0},{name:"usWidthClass",type:"USHORT",value:0},{name:"fsType",type:"USHORT",value:0},{name:"ySubscriptXSize",type:"SHORT",value:650},{name:"ySubscriptYSize",type:"SHORT",value:699},{name:"ySubscriptXOffset",type:"SHORT",value:0},{name:"ySubscriptYOffset",type:"SHORT",value:140},{name:"ySuperscriptXSize",type:"SHORT",value:650},{name:"ySuperscriptYSize",type:"SHORT",value:699},{name:"ySuperscriptXOffset",type:"SHORT",value:0},{name:"ySuperscriptYOffset",type:"SHORT",value:479},{name:"yStrikeoutSize",type:"SHORT",value:49},{name:"yStrikeoutPosition",type:"SHORT",value:258},{name:"sFamilyClass",type:"SHORT",value:0},{name:"bFamilyType",type:"BYTE",value:0},{name:"bSerifStyle",type:"BYTE",value:0},{name:"bWeight",type:"BYTE",value:0},{name:"bProportion",type:"BYTE",value:0},{name:"bContrast",type:"BYTE",value:0},{name:"bStrokeVariation",type:"BYTE",value:0},{name:"bArmStyle",type:"BYTE",value:0},{name:"bLetterform",type:"BYTE",value:0},{name:"bMidline",type:"BYTE",value:0},{name:"bXHeight",type:"BYTE",value:0},{name:"ulUnicodeRange1",type:"ULONG",value:0},{name:"ulUnicodeRange2",type:"ULONG",value:0},{name:"ulUnicodeRange3",type:"ULONG",value:0},{name:"ulUnicodeRange4",type:"ULONG",value:0},{name:"achVendID",type:"CHARARRAY",value:"XXXX"},{name:"fsSelection",type:"USHORT",value:0},{name:"usFirstCharIndex",type:"USHORT",value:0},{name:"usLastCharIndex",type:"USHORT",value:0},{name:"sTypoAscender",type:"SHORT",value:0},{name:"sTypoDescender",type:"SHORT",value:0},{name:"sTypoLineGap",type:"SHORT",value:0},{name:"usWinAscent",type:"USHORT",value:0},{name:"usWinDescent",type:"USHORT",value:0},{name:"ulCodePageRange1",type:"ULONG",value:0},{name:"ulCodePageRange2",type:"ULONG",value:0},{name:"sxHeight",type:"SHORT",value:0},{name:"sCapHeight",type:"SHORT",value:0},{name:"usDefaultChar",type:"USHORT",value:0},{name:"usBreakChar",type:"USHORT",value:0},{name:"usMaxContext",type:"USHORT",value:0}],rr)}var os2={parse:parseOS2Table,make:makeOS2Table,unicodeRanges,getUnicodeRange};function parsePostTable(rr,er){var tr={},ir=new parse.Parser(rr,er);switch(tr.version=ir.parseVersion(),tr.italicAngle=ir.parseFixed(),tr.underlinePosition=ir.parseShort(),tr.underlineThickness=ir.parseShort(),tr.isFixedPitch=ir.parseULong(),tr.minMemType42=ir.parseULong(),tr.maxMemType42=ir.parseULong(),tr.minMemType1=ir.parseULong(),tr.maxMemType1=ir.parseULong(),tr.version){case 1:tr.names=standardNames.slice();break;case 2:tr.numberOfGlyphs=ir.parseUShort(),tr.glyphNameIndex=new Array(tr.numberOfGlyphs);for(var nr=0;nr<tr.numberOfGlyphs;nr++)tr.glyphNameIndex[nr]=ir.parseUShort();tr.names=[];for(var sr=0;sr<tr.numberOfGlyphs;sr++)if(tr.glyphNameIndex[sr]>=standardNames.length){var ar=ir.parseChar();tr.names.push(ir.parseString(ar))}break;case 2.5:tr.numberOfGlyphs=ir.parseUShort(),tr.offset=new Array(tr.numberOfGlyphs);for(var or=0;or<tr.numberOfGlyphs;or++)tr.offset[or]=ir.parseChar();break}return tr}function makePostTable(){return new table.Table("post",[{name:"version",type:"FIXED",value:196608},{name:"italicAngle",type:"FIXED",value:0},{name:"underlinePosition",type:"FWORD",value:0},{name:"underlineThickness",type:"FWORD",value:0},{name:"isFixedPitch",type:"ULONG",value:0},{name:"minMemType42",type:"ULONG",value:0},{name:"maxMemType42",type:"ULONG",value:0},{name:"minMemType1",type:"ULONG",value:0},{name:"maxMemType1",type:"ULONG",value:0}])}var post={parse:parsePostTable,make:makePostTable},subtableParsers=new Array(9);subtableParsers[1]=function rr(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),deltaGlyphId:this.parseUShort()};if(tr===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),substitute:this.parseOffset16List()};check.assert(!1,"0x"+er.toString(16)+": lookup type 1 format must be 1 or 2.")};subtableParsers[2]=function rr(){var er=this.parseUShort();return check.argument(er===1,"GSUB Multiple Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),sequences:this.parseListOfLists()}};subtableParsers[3]=function rr(){var er=this.parseUShort();return check.argument(er===1,"GSUB Alternate Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),alternateSets:this.parseListOfLists()}};subtableParsers[4]=function rr(){var er=this.parseUShort();return check.argument(er===1,"GSUB ligature table identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),ligatureSets:this.parseListOfLists(function(){return{ligGlyph:this.parseUShort(),components:this.parseUShortList(this.parseUShort()-1)}})}};var lookupRecordDesc={sequenceIndex:Parser.uShort,lookupListIndex:Parser.uShort};subtableParsers[5]=function rr(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:tr,coverage:this.parsePointer(Parser.coverage),ruleSets:this.parseListOfLists(function(){var sr=this.parseUShort(),ar=this.parseUShort();return{input:this.parseUShortList(sr-1),lookupRecords:this.parseRecordList(ar,lookupRecordDesc)}})};if(tr===2)return{substFormat:tr,coverage:this.parsePointer(Parser.coverage),classDef:this.parsePointer(Parser.classDef),classSets:this.parseListOfLists(function(){var sr=this.parseUShort(),ar=this.parseUShort();return{classes:this.parseUShortList(sr-1),lookupRecords:this.parseRecordList(ar,lookupRecordDesc)}})};if(tr===3){var ir=this.parseUShort(),nr=this.parseUShort();return{substFormat:tr,coverages:this.parseList(ir,Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(nr,lookupRecordDesc)}}check.assert(!1,"0x"+er.toString(16)+": lookup type 5 format must be 1, 2 or 3.")};subtableParsers[6]=function rr(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{substFormat:1,coverage:this.parsePointer(Parser.coverage),chainRuleSets:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(tr===2)return{substFormat:2,coverage:this.parsePointer(Parser.coverage),backtrackClassDef:this.parsePointer(Parser.classDef),inputClassDef:this.parsePointer(Parser.classDef),lookaheadClassDef:this.parsePointer(Parser.classDef),chainClassSet:this.parseListOfLists(function(){return{backtrack:this.parseUShortList(),input:this.parseUShortList(this.parseShort()-1),lookahead:this.parseUShortList(),lookupRecords:this.parseRecordList(lookupRecordDesc)}})};if(tr===3)return{substFormat:3,backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),inputCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookupRecords:this.parseRecordList(lookupRecordDesc)};check.assert(!1,"0x"+er.toString(16)+": lookup type 6 format must be 1, 2 or 3.")};subtableParsers[7]=function rr(){var er=this.parseUShort();check.argument(er===1,"GSUB Extension Substitution subtable identifier-format must be 1");var tr=this.parseUShort(),ir=new Parser(this.data,this.offset+this.parseULong());return{substFormat:1,lookupType:tr,extension:subtableParsers[tr].call(ir)}};subtableParsers[8]=function rr(){var er=this.parseUShort();return check.argument(er===1,"GSUB Reverse Chaining Contextual Single Substitution Subtable identifier-format must be 1"),{substFormat:er,coverage:this.parsePointer(Parser.coverage),backtrackCoverage:this.parseList(Parser.pointer(Parser.coverage)),lookaheadCoverage:this.parseList(Parser.pointer(Parser.coverage)),substitutes:this.parseUShortList()}};function parseGsubTable(rr,er){er=er||0;var tr=new Parser(rr,er),ir=tr.parseVersion(1);return check.argument(ir===1||ir===1.1,"Unsupported GSUB table version."),ir===1?{version:ir,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers)}:{version:ir,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers),variations:tr.parseFeatureVariationsList()}}var subtableMakers=new Array(9);subtableMakers[1]=function rr(er){return er.substFormat===1?new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)},{name:"deltaGlyphID",type:"USHORT",value:er.deltaGlyphId}]):new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:2},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.ushortList("substitute",er.substitute)))};subtableMakers[2]=function rr(er){return check.assert(er.substFormat===1,"Lookup type 2 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("seqSet",er.sequences,function(tr){return new table.Table("sequenceSetTable",table.ushortList("sequence",tr))})))};subtableMakers[3]=function rr(er){return check.assert(er.substFormat===1,"Lookup type 3 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("altSet",er.alternateSets,function(tr){return new table.Table("alternateSetTable",table.ushortList("alternate",tr))})))};subtableMakers[4]=function rr(er){return check.assert(er.substFormat===1,"Lookup type 4 substFormat must be 1."),new table.Table("substitutionTable",[{name:"substFormat",type:"USHORT",value:1},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("ligSet",er.ligatureSets,function(tr){return new table.Table("ligatureSetTable",table.tableList("ligature",tr,function(ir){return new table.Table("ligatureTable",[{name:"ligGlyph",type:"USHORT",value:ir.ligGlyph}].concat(table.ushortList("component",ir.components,ir.components.length+1)))}))})))};subtableMakers[6]=function rr(er){if(er.substFormat===1){var tr=new table.Table("chainContextTable",[{name:"substFormat",type:"USHORT",value:er.substFormat},{name:"coverage",type:"TABLE",value:new table.Coverage(er.coverage)}].concat(table.tableList("chainRuleSet",er.chainRuleSets,function(sr){return new table.Table("chainRuleSetTable",table.tableList("chainRule",sr,function(ar){var or=table.ushortList("backtrackGlyph",ar.backtrack,ar.backtrack.length).concat(table.ushortList("inputGlyph",ar.input,ar.input.length+1)).concat(table.ushortList("lookaheadGlyph",ar.lookahead,ar.lookahead.length)).concat(table.ushortList("substitution",[],ar.lookupRecords.length));return ar.lookupRecords.forEach(function(lr,cr){or=or.concat({name:"sequenceIndex"+cr,type:"USHORT",value:lr.sequenceIndex}).concat({name:"lookupListIndex"+cr,type:"USHORT",value:lr.lookupListIndex})}),new table.Table("chainRuleTable",or)}))})));return tr}else if(er.substFormat===2)check.assert(!1,"lookup type 6 format 2 is not yet supported.");else if(er.substFormat===3){var ir=[{name:"substFormat",type:"USHORT",value:er.substFormat}];ir.push({name:"backtrackGlyphCount",type:"USHORT",value:er.backtrackCoverage.length}),er.backtrackCoverage.forEach(function(sr,ar){ir.push({name:"backtrackCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),ir.push({name:"inputGlyphCount",type:"USHORT",value:er.inputCoverage.length}),er.inputCoverage.forEach(function(sr,ar){ir.push({name:"inputCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),ir.push({name:"lookaheadGlyphCount",type:"USHORT",value:er.lookaheadCoverage.length}),er.lookaheadCoverage.forEach(function(sr,ar){ir.push({name:"lookaheadCoverage"+ar,type:"TABLE",value:new table.Coverage(sr)})}),ir.push({name:"substitutionCount",type:"USHORT",value:er.lookupRecords.length}),er.lookupRecords.forEach(function(sr,ar){ir=ir.concat({name:"sequenceIndex"+ar,type:"USHORT",value:sr.sequenceIndex}).concat({name:"lookupListIndex"+ar,type:"USHORT",value:sr.lookupListIndex})});var nr=new table.Table("chainContextTable",ir);return nr}check.assert(!1,"lookup type 6 format must be 1, 2 or 3.")};function makeGsubTable(rr){return new table.Table("GSUB",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(rr.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(rr.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(rr.lookups,subtableMakers)}])}var gsub={parse:parseGsubTable,make:makeGsubTable};function parseMetaTable(rr,er){var tr=new parse.Parser(rr,er),ir=tr.parseULong();check.argument(ir===1,"Unsupported META table version."),tr.parseULong(),tr.parseULong();for(var nr=tr.parseULong(),sr={},ar=0;ar<nr;ar++){var or=tr.parseTag(),lr=tr.parseULong(),cr=tr.parseULong(),ur=decode.UTF8(rr,er+lr,cr);sr[or]=ur}return sr}function makeMetaTable(rr){var er=Object.keys(rr).length,tr="",ir=16+er*12,nr=new table.Table("meta",[{name:"version",type:"ULONG",value:1},{name:"flags",type:"ULONG",value:0},{name:"offset",type:"ULONG",value:ir},{name:"numTags",type:"ULONG",value:er}]);for(var sr in rr){var ar=tr.length;tr+=rr[sr],nr.fields.push({name:"tag "+sr,type:"TAG",value:sr}),nr.fields.push({name:"offset "+sr,type:"ULONG",value:ir+ar}),nr.fields.push({name:"length "+sr,type:"ULONG",value:rr[sr].length})}return nr.fields.push({name:"stringPool",type:"CHARARRAY",value:tr}),nr}var meta={parse:parseMetaTable,make:makeMetaTable};function parseColrTable(rr,er){var tr=new Parser(rr,er),ir=tr.parseUShort();check.argument(ir===0,"Only COLRv0 supported.");var nr=tr.parseUShort(),sr=tr.parseOffset32(),ar=tr.parseOffset32(),or=tr.parseUShort();tr.relativeOffset=sr;var lr=tr.parseRecordList(nr,{glyphID:Parser.uShort,firstLayerIndex:Parser.uShort,numLayers:Parser.uShort});tr.relativeOffset=ar;var cr=tr.parseRecordList(or,{glyphID:Parser.uShort,paletteIndex:Parser.uShort});return{version:ir,baseGlyphRecords:lr,layerRecords:cr}}function makeColrTable(rr){var er=rr.version;er===void 0&&(er=0);var tr=rr.baseGlyphRecords;tr===void 0&&(tr=[]);var ir=rr.layerRecords;ir===void 0&&(ir=[]),check.argument(er===0,"Only COLRv0 supported.");var nr=14,sr=nr+tr.length*6;return new table.Table("COLR",[{name:"version",type:"USHORT",value:er},{name:"numBaseGlyphRecords",type:"USHORT",value:tr.length},{name:"baseGlyphRecordsOffset",type:"ULONG",value:nr},{name:"layerRecordsOffset",type:"ULONG",value:sr},{name:"numLayerRecords",type:"USHORT",value:ir.length}].concat(tr.map(function(ar,or){return[{name:"glyphID_"+or,type:"USHORT",value:ar.glyphID},{name:"firstLayerIndex_"+or,type:"USHORT",value:ar.firstLayerIndex},{name:"numLayers_"+or,type:"USHORT",value:ar.numLayers}]}).flat(),ir.map(function(ar,or){return[{name:"LayerGlyphID_"+or,type:"USHORT",value:ar.glyphID},{name:"paletteIndex_"+or,type:"USHORT",value:ar.paletteIndex}]}).flat()))}var colr={parse:parseColrTable,make:makeColrTable};function parseCpalTable(rr,er){var tr=new Parser(rr,er),ir=tr.parseShort(),nr=tr.parseShort(),sr=tr.parseShort(),ar=tr.parseShort(),or=tr.parseOffset32(),lr=tr.parseUShortList(sr);tr.relativeOffset=or;var cr=tr.parseULongList(ar);return{version:ir,numPaletteEntries:nr,colorRecords:cr,colorRecordIndices:lr}}function makeCpalTable(rr){var er=rr.version;er===void 0&&(er=0);var tr=rr.numPaletteEntries;tr===void 0&&(tr=0);var ir=rr.colorRecords;ir===void 0&&(ir=[]);var nr=rr.colorRecordIndices;return nr===void 0&&(nr=[0]),check.argument(er===0,"Only CPALv0 are supported."),check.argument(ir.length,"No colorRecords given."),check.argument(nr.length,"No colorRecordIndices given."),check.argument(!tr&&nr.length==1,"Can't infer numPaletteEntries on multiple colorRecordIndices"),new table.Table("CPAL",[{name:"version",type:"USHORT",value:er},{name:"numPaletteEntries",type:"USHORT",value:tr||ir.length},{name:"numPalettes",type:"USHORT",value:nr.length},{name:"numColorRecords",type:"USHORT",value:ir.length},{name:"colorRecordsArrayOffset",type:"ULONG",value:12+2*nr.length}].concat(nr.map(function(sr,ar){return{name:"colorRecordIndices_"+ar,type:"USHORT",value:sr}}),ir.map(function(sr,ar){return{name:"colorRecords_"+ar,type:"ULONG",value:sr}})))}var cpal={parse:parseCpalTable,make:makeCpalTable};function log2(rr){return Math.log(rr)/Math.log(2)|0}function computeCheckSum(rr){for(;rr.length%4!==0;)rr.push(0);for(var er=0,tr=0;tr<rr.length;tr+=4)er+=(rr[tr]<<24)+(rr[tr+1]<<16)+(rr[tr+2]<<8)+rr[tr+3];return er%=Math.pow(2,32),er}function makeTableRecord(rr,er,tr,ir){return new table.Record("Table Record",[{name:"tag",type:"TAG",value:rr!==void 0?rr:""},{name:"checkSum",type:"ULONG",value:er!==void 0?er:0},{name:"offset",type:"ULONG",value:tr!==void 0?tr:0},{name:"length",type:"ULONG",value:ir!==void 0?ir:0}])}function makeSfntTable(rr){var er=new table.Table("sfnt",[{name:"version",type:"TAG",value:"OTTO"},{name:"numTables",type:"USHORT",value:0},{name:"searchRange",type:"USHORT",value:0},{name:"entrySelector",type:"USHORT",value:0},{name:"rangeShift",type:"USHORT",value:0}]);er.tables=rr,er.numTables=rr.length;var tr=Math.pow(2,log2(er.numTables));er.searchRange=16*tr,er.entrySelector=log2(tr),er.rangeShift=er.numTables*16-er.searchRange;for(var ir=[],nr=[],sr=er.sizeOf()+makeTableRecord().sizeOf()*er.numTables;sr%4!==0;)sr+=1,nr.push({name:"padding",type:"BYTE",value:0});for(var ar=0;ar<rr.length;ar+=1){var or=rr[ar];check.argument(or.tableName.length===4,"Table name"+or.tableName+" is invalid.");var lr=or.sizeOf(),cr=makeTableRecord(or.tableName,computeCheckSum(or.encode()),sr,lr);for(ir.push({name:cr.tag+" Table Record",type:"RECORD",value:cr}),nr.push({name:or.tableName+" table",type:"RECORD",value:or}),sr+=lr,check.argument(!isNaN(sr),"Something went wrong calculating the offset.");sr%4!==0;)sr+=1,nr.push({name:"padding",type:"BYTE",value:0})}return ir.sort(function(ur,dr){return ur.value.tag>dr.value.tag?1:-1}),er.fields=er.fields.concat(ir),er.fields=er.fields.concat(nr),er}function metricsForChar(rr,er,tr){for(var ir=0;ir<er.length;ir+=1){var nr=rr.charToGlyphIndex(er[ir]);if(nr>0){var sr=rr.glyphs.get(nr);return sr.getMetrics()}}return tr}function average(rr){for(var er=0,tr=0;tr<rr.length;tr+=1)er+=rr[tr];return er/rr.length}function fontToSfntTable(rr){for(var er=[],tr=[],ir=[],nr=[],sr=[],ar=[],or=[],lr,cr=0,ur=0,dr=0,hr=0,pr=0,gr=0;gr<rr.glyphs.length;gr+=1){var vr=rr.glyphs.get(gr),mr=vr.unicode|0;if(isNaN(vr.advanceWidth))throw new Error("Glyph "+vr.name+" ("+gr+"): advanceWidth is not a number.");(lr>mr||lr===void 0)&&mr>0&&(lr=mr),cr<mr&&(cr=mr);var fr=os2.getUnicodeRange(mr);if(fr<32)ur|=1<<fr;else if(fr<64)dr|=1<<fr-32;else if(fr<96)hr|=1<<fr-64;else if(fr<123)pr|=1<<fr-96;else throw new Error("Unicode ranges bits > 123 are reserved for internal usage");if(vr.name!==".notdef"){var _r=vr.getMetrics();er.push(_r.xMin),tr.push(_r.yMin),ir.push(_r.xMax),nr.push(_r.yMax),ar.push(_r.leftSideBearing),or.push(_r.rightSideBearing),sr.push(vr.advanceWidth)}}var Ar={xMin:Math.min.apply(null,er),yMin:Math.min.apply(null,tr),xMax:Math.max.apply(null,ir),yMax:Math.max.apply(null,nr),advanceWidthMax:Math.max.apply(null,sr),advanceWidthAvg:average(sr),minLeftSideBearing:Math.min.apply(null,ar),maxLeftSideBearing:Math.max.apply(null,ar),minRightSideBearing:Math.min.apply(null,or)};Ar.ascender=rr.ascender,Ar.descender=rr.descender;var yr=head.make({flags:3,unitsPerEm:rr.unitsPerEm,xMin:Ar.xMin,yMin:Ar.yMin,xMax:Ar.xMax,yMax:Ar.yMax,lowestRecPPEM:3,createdTimestamp:rr.createdTimestamp}),wr=hhea.make({ascender:Ar.ascender,descender:Ar.descender,advanceWidthMax:Ar.advanceWidthMax,minLeftSideBearing:Ar.minLeftSideBearing,minRightSideBearing:Ar.minRightSideBearing,xMaxExtent:Ar.maxLeftSideBearing+(Ar.xMax-Ar.xMin),numberOfHMetrics:rr.glyphs.length}),xr=maxp.make(rr.glyphs.length),Sr=os2.make(Object.assign({xAvgCharWidth:Math.round(Ar.advanceWidthAvg),usFirstCharIndex:lr,usLastCharIndex:cr,ulUnicodeRange1:ur,ulUnicodeRange2:dr,ulUnicodeRange3:hr,ulUnicodeRange4:pr,sTypoAscender:Ar.ascender,sTypoDescender:Ar.descender,sTypoLineGap:0,usWinAscent:Ar.yMax,usWinDescent:Math.abs(Ar.yMin),ulCodePageRange1:1,sxHeight:metricsForChar(rr,"xyvw",{yMax:Math.round(Ar.ascender/2)}).yMax,sCapHeight:metricsForChar(rr,"HIKLEFJMNTZBDPRAGOQSUVWXY",Ar).yMax,usDefaultChar:rr.hasChar(" ")?32:0,usBreakChar:rr.hasChar(" ")?32:0},rr.tables.os2)),br=hmtx.make(rr.glyphs),Cr=cmap.make(rr.glyphs),Ir=rr.getEnglishName("fontFamily"),Rr=rr.getEnglishName("fontSubfamily"),Pr=Ir+" "+Rr,Dr=rr.getEnglishName("postScriptName");Dr||(Dr=Ir.replace(/\s/g,"")+"-"+Rr);var Fr={};for(var Or in rr.names)Fr[Or]=rr.names[Or];Fr.uniqueID||(Fr.uniqueID={en:rr.getEnglishName("manufacturer")+":"+Pr}),Fr.postScriptName||(Fr.postScriptName={en:Dr}),Fr.preferredFamily||(Fr.preferredFamily=rr.names.fontFamily),Fr.preferredSubfamily||(Fr.preferredSubfamily=rr.names.fontSubfamily);var Nr=[],Ur=_name.make(Fr,Nr),Br=Nr.length>0?ltag.make(Nr):void 0,Wr=post.make(),Xr=cff.make(rr.glyphs,{version:rr.getEnglishName("version"),fullName:Pr,familyName:Ir,weightName:Rr,postScriptName:Dr,unitsPerEm:rr.unitsPerEm,fontBBox:[0,Ar.yMin,Ar.ascender,Ar.advanceWidthMax]}),Yr=rr.metas&&Object.keys(rr.metas).length>0?meta.make(rr.metas):void 0,Qi=[yr,wr,xr,Sr,Ur,Cr,Wr,Xr,br];Br&&Qi.push(Br),rr.tables.gsub&&Qi.push(gsub.make(rr.tables.gsub)),rr.tables.cpal&&Qi.push(cpal.make(rr.tables.cpal)),rr.tables.colr&&Qi.push(colr.make(rr.tables.colr)),Yr&&Qi.push(Yr);for(var Xi=makeSfntTable(Qi),Kr=Xi.encode(),$r=computeCheckSum(Kr),Vr=Xi.fields,Gr=!1,qr=0;qr<Vr.length;qr+=1)if(Vr[qr].name==="head table"){Vr[qr].value.checkSumAdjustment=2981146554-$r,Gr=!0;break}if(!Gr)throw new Error("Could not find head table with checkSum to adjust.");return Xi}var sfnt={make:makeSfntTable,fontToTable:fontToSfntTable,computeCheckSum};function searchTag(rr,er){for(var tr=0,ir=rr.length-1;tr<=ir;){var nr=tr+ir>>>1,sr=rr[nr].tag;if(sr===er)return nr;sr<er?tr=nr+1:ir=nr-1}return-tr-1}function binSearch(rr,er){for(var tr=0,ir=rr.length-1;tr<=ir;){var nr=tr+ir>>>1,sr=rr[nr];if(sr===er)return nr;sr<er?tr=nr+1:ir=nr-1}return-tr-1}function searchRange(rr,er){for(var tr,ir=0,nr=rr.length-1;ir<=nr;){var sr=ir+nr>>>1;tr=rr[sr];var ar=tr.start;if(ar===er)return tr;ar<er?ir=sr+1:nr=sr-1}if(ir>0)return tr=rr[ir-1],er>tr.end?0:tr}function Layout(rr,er){this.font=rr,this.tableName=er}Layout.prototype={searchTag,binSearch,getTable:function(rr){var er=this.font.tables[this.tableName];return!er&&rr&&(er=this.font.tables[this.tableName]=this.createDefaultTable()),er},getScriptNames:function(){var rr=this.getTable();return rr?rr.scripts.map(function(er){return er.tag}):[]},getDefaultScriptName:function(){var rr=this.getTable();if(rr){for(var er=!1,tr=0;tr<rr.scripts.length;tr++){var ir=rr.scripts[tr].tag;if(ir==="DFLT")return ir;ir==="latn"&&(er=!0)}if(er)return"latn"}},getScriptTable:function(rr,er){var tr=this.getTable(er);if(tr){rr=rr||"DFLT";var ir=tr.scripts,nr=searchTag(tr.scripts,rr);if(nr>=0)return ir[nr].script;if(er){var sr={tag:rr,script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}};return ir.splice(-1-nr,0,sr),sr.script}}},getLangSysTable:function(rr,er,tr){var ir=this.getScriptTable(rr,tr);if(ir){if(!er||er==="dflt"||er==="DFLT")return ir.defaultLangSys;var nr=searchTag(ir.langSysRecords,er);if(nr>=0)return ir.langSysRecords[nr].langSys;if(tr){var sr={tag:er,langSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]}};return ir.langSysRecords.splice(-1-nr,0,sr),sr.langSys}}},getFeatureTable:function(rr,er,tr,ir){var nr=this.getLangSysTable(rr,er,ir);if(nr){for(var sr,ar=nr.featureIndexes,or=this.font.tables[this.tableName].features,lr=0;lr<ar.length;lr++)if(sr=or[ar[lr]],sr.tag===tr)return sr.feature;if(ir){var cr=or.length;return check.assert(cr===0||tr>=or[cr-1].tag,"Features must be added in alphabetical order."),sr={tag:tr,feature:{params:0,lookupListIndexes:[]}},or.push(sr),ar.push(cr),sr.feature}}},getLookupTables:function(rr,er,tr,ir,nr){var sr=this.getFeatureTable(rr,er,tr,nr),ar=[];if(sr){for(var or,lr=sr.lookupListIndexes,cr=this.font.tables[this.tableName].lookups,ur=0;ur<lr.length;ur++)or=cr[lr[ur]],or.lookupType===ir&&ar.push(or);if(ar.length===0&&nr){or={lookupType:ir,lookupFlag:0,subtables:[],markFilteringSet:void 0};var dr=cr.length;return cr.push(or),lr.push(dr),[or]}}return ar},getGlyphClass:function(rr,er){switch(rr.format){case 1:return rr.startGlyph<=er&&er<rr.startGlyph+rr.classes.length?rr.classes[er-rr.startGlyph]:0;case 2:var tr=searchRange(rr.ranges,er);return tr?tr.classId:0}},getCoverageIndex:function(rr,er){switch(rr.format){case 1:var tr=binSearch(rr.glyphs,er);return tr>=0?tr:-1;case 2:var ir=searchRange(rr.ranges,er);return ir?ir.index+er-ir.start:-1}},expandCoverage:function(rr){if(rr.format===1)return rr.glyphs;for(var er=[],tr=rr.ranges,ir=0;ir<tr.length;ir++)for(var nr=tr[ir],sr=nr.start,ar=nr.end,or=sr;or<=ar;or++)er.push(or);return er}};function Position(rr){Layout.call(this,rr,"gpos")}Position.prototype=Layout.prototype;Position.prototype.init=function(){var rr=this.getDefaultScriptName();this.defaultKerningTables=this.getKerningTables(rr)};Position.prototype.getKerningValue=function(rr,er,tr){for(var ir=0;ir<rr.length;ir++)for(var nr=rr[ir].subtables,sr=0;sr<nr.length;sr++){var ar=nr[sr],or=this.getCoverageIndex(ar.coverage,er);if(!(or<0))switch(ar.posFormat){case 1:for(var lr=ar.pairSets[or],cr=0;cr<lr.length;cr++){var ur=lr[cr];if(ur.secondGlyph===tr)return ur.value1&&ur.value1.xAdvance||0}break;case 2:var dr=this.getGlyphClass(ar.classDef1,er),hr=this.getGlyphClass(ar.classDef2,tr),pr=ar.classRecords[dr][hr];return pr.value1&&pr.value1.xAdvance||0}}return 0};Position.prototype.getKerningTables=function(rr,er){if(this.font.tables.gpos)return this.getLookupTables(rr,er,"kern",2)};function Substitution(rr){Layout.call(this,rr,"gsub")}function arraysEqual(rr,er){var tr=rr.length;if(tr!==er.length)return!1;for(var ir=0;ir<tr;ir++)if(rr[ir]!==er[ir])return!1;return!0}function getSubstFormat(rr,er,tr){for(var ir=rr.subtables,nr=0;nr<ir.length;nr++){var sr=ir[nr];if(sr.substFormat===er)return sr}if(tr)return ir.push(tr),tr}Substitution.prototype=Layout.prototype;Substitution.prototype.createDefaultTable=function(){return{version:1,scripts:[{tag:"DFLT",script:{defaultLangSys:{reserved:0,reqFeatureIndex:65535,featureIndexes:[]},langSysRecords:[]}}],features:[],lookups:[]}};Substitution.prototype.getSingle=function(rr,er,tr){for(var ir=[],nr=this.getLookupTables(er,tr,rr,1),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++){var lr=ar[or],cr=this.expandCoverage(lr.coverage),ur=void 0;if(lr.substFormat===1){var dr=lr.deltaGlyphId;for(ur=0;ur<cr.length;ur++){var hr=cr[ur];ir.push({sub:hr,by:hr+dr})}}else{var pr=lr.substitute;for(ur=0;ur<cr.length;ur++)ir.push({sub:cr[ur],by:pr[ur]})}}return ir};Substitution.prototype.getMultiple=function(rr,er,tr){for(var ir=[],nr=this.getLookupTables(er,tr,rr,2),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++){var lr=ar[or],cr=this.expandCoverage(lr.coverage),ur=void 0;for(ur=0;ur<cr.length;ur++){var dr=cr[ur],hr=lr.sequences[ur];ir.push({sub:dr,by:hr})}}return ir};Substitution.prototype.getAlternates=function(rr,er,tr){for(var ir=[],nr=this.getLookupTables(er,tr,rr,3),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++)for(var lr=ar[or],cr=this.expandCoverage(lr.coverage),ur=lr.alternateSets,dr=0;dr<cr.length;dr++)ir.push({sub:cr[dr],by:ur[dr]});return ir};Substitution.prototype.getLigatures=function(rr,er,tr){for(var ir=[],nr=this.getLookupTables(er,tr,rr,4),sr=0;sr<nr.length;sr++)for(var ar=nr[sr].subtables,or=0;or<ar.length;or++)for(var lr=ar[or],cr=this.expandCoverage(lr.coverage),ur=lr.ligatureSets,dr=0;dr<cr.length;dr++)for(var hr=cr[dr],pr=ur[dr],gr=0;gr<pr.length;gr++){var vr=pr[gr];ir.push({sub:[hr].concat(vr.components),by:vr.ligGlyph})}return ir};Substitution.prototype.addSingle=function(rr,er,tr,ir){var nr=this.getLookupTables(tr,ir,rr,1,!0)[0],sr=getSubstFormat(nr,2,{substFormat:2,coverage:{format:1,glyphs:[]},substitute:[]});check.assert(sr.coverage.format===1,"Single: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.substitute.splice(or,0,0)),sr.substitute[or]=er.by};Substitution.prototype.addMultiple=function(rr,er,tr,ir){check.assert(er.by instanceof Array&&er.by.length>1,'Multiple: "by" must be an array of two or more ids');var nr=this.getLookupTables(tr,ir,rr,2,!0)[0],sr=getSubstFormat(nr,1,{substFormat:1,coverage:{format:1,glyphs:[]},sequences:[]});check.assert(sr.coverage.format===1,"Multiple: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.sequences.splice(or,0,0)),sr.sequences[or]=er.by};Substitution.prototype.addAlternate=function(rr,er,tr,ir){var nr=this.getLookupTables(tr,ir,rr,3,!0)[0],sr=getSubstFormat(nr,1,{substFormat:1,coverage:{format:1,glyphs:[]},alternateSets:[]});check.assert(sr.coverage.format===1,"Alternate: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub,or=this.binSearch(sr.coverage.glyphs,ar);or<0&&(or=-1-or,sr.coverage.glyphs.splice(or,0,ar),sr.alternateSets.splice(or,0,0)),sr.alternateSets[or]=er.by};Substitution.prototype.addLigature=function(rr,er,tr,ir){var nr=this.getLookupTables(tr,ir,rr,4,!0)[0],sr=nr.subtables[0];sr||(sr={substFormat:1,coverage:{format:1,glyphs:[]},ligatureSets:[]},nr.subtables[0]=sr),check.assert(sr.coverage.format===1,"Ligature: unable to modify coverage table format "+sr.coverage.format);var ar=er.sub[0],or=er.sub.slice(1),lr={ligGlyph:er.by,components:or},cr=this.binSearch(sr.coverage.glyphs,ar);if(cr>=0){for(var ur=sr.ligatureSets[cr],dr=0;dr<ur.length;dr++)if(arraysEqual(ur[dr].components,or))return;ur.push(lr)}else cr=-1-cr,sr.coverage.glyphs.splice(cr,0,ar),sr.ligatureSets.splice(cr,0,[lr])};Substitution.prototype.getFeature=function(rr,er,tr){if(/ss\d\d/.test(rr))return this.getSingle(rr,er,tr);switch(rr){case"aalt":case"salt":return this.getSingle(rr,er,tr).concat(this.getAlternates(rr,er,tr));case"dlig":case"liga":case"rlig":return this.getLigatures(rr,er,tr);case"ccmp":return this.getMultiple(rr,er,tr).concat(this.getLigatures(rr,er,tr));case"stch":return this.getMultiple(rr,er,tr)}};Substitution.prototype.add=function(rr,er,tr,ir){if(/ss\d\d/.test(rr))return this.addSingle(rr,er,tr,ir);switch(rr){case"aalt":case"salt":return typeof er.by=="number"?this.addSingle(rr,er,tr,ir):this.addAlternate(rr,er,tr,ir);case"dlig":case"liga":case"rlig":return this.addLigature(rr,er,tr,ir);case"ccmp":return er.by instanceof Array?this.addMultiple(rr,er,tr,ir):this.addLigature(rr,er,tr,ir)}};function checkArgument(rr,er){if(!rr)throw er}function parseGlyphCoordinate(rr,er,tr,ir,nr){var sr;return(er&ir)>0?(sr=rr.parseByte(),er&nr||(sr=-sr),sr=tr+sr):(er&nr)>0?sr=tr:sr=tr+rr.parseShort(),sr}function parseGlyph(rr,er,tr){var ir=new parse.Parser(er,tr);rr.numberOfContours=ir.parseShort(),rr._xMin=ir.parseShort(),rr._yMin=ir.parseShort(),rr._xMax=ir.parseShort(),rr._yMax=ir.parseShort();var nr,sr;if(rr.numberOfContours>0){for(var ar=rr.endPointIndices=[],or=0;or<rr.numberOfContours;or+=1)ar.push(ir.parseUShort());rr.instructionLength=ir.parseUShort(),rr.instructions=[];for(var lr=0;lr<rr.instructionLength;lr+=1)rr.instructions.push(ir.parseByte());var cr=ar[ar.length-1]+1;nr=[];for(var ur=0;ur<cr;ur+=1)if(sr=ir.parseByte(),nr.push(sr),(sr&8)>0)for(var dr=ir.parseByte(),hr=0;hr<dr;hr+=1)nr.push(sr),ur+=1;if(check.argument(nr.length===cr,"Bad flags."),ar.length>0){var pr=[],gr;if(cr>0){for(var vr=0;vr<cr;vr+=1)sr=nr[vr],gr={},gr.onCurve=!!(sr&1),gr.lastPointOfContour=ar.indexOf(vr)>=0,pr.push(gr);for(var mr=0,fr=0;fr<cr;fr+=1)sr=nr[fr],gr=pr[fr],gr.x=parseGlyphCoordinate(ir,sr,mr,2,16),mr=gr.x;for(var _r=0,Ar=0;Ar<cr;Ar+=1)sr=nr[Ar],gr=pr[Ar],gr.y=parseGlyphCoordinate(ir,sr,_r,4,32),_r=gr.y}rr.points=pr}else rr.points=[]}else if(rr.numberOfContours===0)rr.points=[];else{rr.isComposite=!0,rr.points=[],rr.components=[];for(var yr=!0;yr;){nr=ir.parseUShort();var wr={glyphIndex:ir.parseUShort(),xScale:1,scale01:0,scale10:0,yScale:1,dx:0,dy:0};(nr&1)>0?(nr&2)>0?(wr.dx=ir.parseShort(),wr.dy=ir.parseShort()):wr.matchedPoints=[ir.parseUShort(),ir.parseUShort()]:(nr&2)>0?(wr.dx=ir.parseChar(),wr.dy=ir.parseChar()):wr.matchedPoints=[ir.parseByte(),ir.parseByte()],(nr&8)>0?wr.xScale=wr.yScale=ir.parseF2Dot14():(nr&64)>0?(wr.xScale=ir.parseF2Dot14(),wr.yScale=ir.parseF2Dot14()):(nr&128)>0&&(wr.xScale=ir.parseF2Dot14(),wr.scale01=ir.parseF2Dot14(),wr.scale10=ir.parseF2Dot14(),wr.yScale=ir.parseF2Dot14()),rr.components.push(wr),yr=!!(nr&32)}if(nr&256){rr.instructionLength=ir.parseUShort(),rr.instructions=[];for(var xr=0;xr<rr.instructionLength;xr+=1)rr.instructions.push(ir.parseByte())}}}function transformPoints(rr,er){for(var tr=[],ir=0;ir<rr.length;ir+=1){var nr=rr[ir],sr={x:er.xScale*nr.x+er.scale01*nr.y+er.dx,y:er.scale10*nr.x+er.yScale*nr.y+er.dy,onCurve:nr.onCurve,lastPointOfContour:nr.lastPointOfContour};tr.push(sr)}return tr}function getContours(rr){for(var er=[],tr=[],ir=0;ir<rr.length;ir+=1){var nr=rr[ir];tr.push(nr),nr.lastPointOfContour&&(er.push(tr),tr=[])}return check.argument(tr.length===0,"There are still points left in the current contour."),er}function getPath(rr){var er=new Path;if(!rr)return er;for(var tr=getContours(rr),ir=0;ir<tr.length;++ir){var nr=tr[ir],sr=null,ar=nr[nr.length-1],or=nr[0];if(ar.onCurve)er.moveTo(ar.x,ar.y);else if(or.onCurve)er.moveTo(or.x,or.y);else{var lr={x:(ar.x+or.x)*.5,y:(ar.y+or.y)*.5};er.moveTo(lr.x,lr.y)}for(var cr=0;cr<nr.length;++cr)if(sr=ar,ar=or,or=nr[(cr+1)%nr.length],ar.onCurve)er.lineTo(ar.x,ar.y);else{var ur=sr,dr=or;sr.onCurve||(ur={x:(ar.x+sr.x)*.5,y:(ar.y+sr.y)*.5}),or.onCurve||(dr={x:(ar.x+or.x)*.5,y:(ar.y+or.y)*.5}),er.quadraticCurveTo(ar.x,ar.y,dr.x,dr.y)}er.closePath()}return er}function buildPath(rr,er){if(er.isComposite)for(var tr=0;tr<er.components.length;tr+=1){var ir=er.components[tr],nr=rr.get(ir.glyphIndex);if(nr.getPath(),nr.points){var sr=void 0;if(ir.matchedPoints===void 0)sr=transformPoints(nr.points,ir);else{if(ir.matchedPoints[0]>er.points.length-1||ir.matchedPoints[1]>nr.points.length-1)throw Error("Matched points out of range in "+er.name);var ar=er.points[ir.matchedPoints[0]],or=nr.points[ir.matchedPoints[1]],lr={xScale:ir.xScale,scale01:ir.scale01,scale10:ir.scale10,yScale:ir.yScale,dx:0,dy:0};or=transformPoints([or],lr)[0],lr.dx=ar.x-or.x,lr.dy=ar.y-or.y,sr=transformPoints(nr.points,lr)}er.points=er.points.concat(sr)}}return getPath(er.points)}function parseGlyfTableAll(rr,er,tr,ir){for(var nr=new glyphset.GlyphSet(ir),sr=0;sr<tr.length-1;sr+=1){var ar=tr[sr],or=tr[sr+1];ar!==or?nr.push(sr,glyphset.ttfGlyphLoader(ir,sr,parseGlyph,rr,er+ar,buildPath)):nr.push(sr,glyphset.glyphLoader(ir,sr))}return nr}function parseGlyfTableOnLowMemory(rr,er,tr,ir){var nr=new glyphset.GlyphSet(ir);return ir._push=function(sr){var ar=tr[sr],or=tr[sr+1];ar!==or?nr.push(sr,glyphset.ttfGlyphLoader(ir,sr,parseGlyph,rr,er+ar,buildPath)):nr.push(sr,glyphset.glyphLoader(ir,sr))},nr}function parseGlyfTable(rr,er,tr,ir,nr){return nr.lowMemory?parseGlyfTableOnLowMemory(rr,er,tr,ir):parseGlyfTableAll(rr,er,tr,ir)}var glyf={getPath,parse:parseGlyfTable},instructionTable,exec,execGlyph,execComponent;function Hinting(rr){this.font=rr,this.getCommands=function(er){return glyf.getPath(er).commands},this._fpgmState=this._prepState=void 0,this._errorState=0}function roundOff(rr){return rr}function roundToGrid(rr){return Math.sign(rr)*Math.round(Math.abs(rr))}function roundToDoubleGrid(rr){return Math.sign(rr)*Math.round(Math.abs(rr*2))/2}function roundToHalfGrid(rr){return Math.sign(rr)*(Math.round(Math.abs(rr)+.5)-.5)}function roundUpToGrid(rr){return Math.sign(rr)*Math.ceil(Math.abs(rr))}function roundDownToGrid(rr){return Math.sign(rr)*Math.floor(Math.abs(rr))}var roundSuper=function(rr){var er=this.srPeriod,tr=this.srPhase,ir=this.srThreshold,nr=1;return rr<0&&(rr=-rr,nr=-1),rr+=ir-tr,rr=Math.trunc(rr/er)*er,rr+=tr,rr<0?tr*nr:rr*nr},xUnitVector={x:1,y:0,axis:"x",distance:function(rr,er,tr,ir){return(tr?rr.xo:rr.x)-(ir?er.xo:er.x)},interpolate:function(rr,er,tr,ir){var nr,sr,ar,or,lr,cr,ur;if(!ir||ir===this){if(nr=rr.xo-er.xo,sr=rr.xo-tr.xo,lr=er.x-er.xo,cr=tr.x-tr.xo,ar=Math.abs(nr),or=Math.abs(sr),ur=ar+or,ur===0){rr.x=rr.xo+(lr+cr)/2;return}rr.x=rr.xo+(lr*or+cr*ar)/ur;return}if(nr=ir.distance(rr,er,!0,!0),sr=ir.distance(rr,tr,!0,!0),lr=ir.distance(er,er,!1,!0),cr=ir.distance(tr,tr,!1,!0),ar=Math.abs(nr),or=Math.abs(sr),ur=ar+or,ur===0){xUnitVector.setRelative(rr,rr,(lr+cr)/2,ir,!0);return}xUnitVector.setRelative(rr,rr,(lr*or+cr*ar)/ur,ir,!0)},normalSlope:Number.NEGATIVE_INFINITY,setRelative:function(rr,er,tr,ir,nr){if(!ir||ir===this){rr.x=(nr?er.xo:er.x)+tr;return}var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*ir.x,lr=ar+tr*ir.y;rr.x=or+(rr.y-lr)/ir.normalSlope},slope:0,touch:function(rr){rr.xTouched=!0},touched:function(rr){return rr.xTouched},untouch:function(rr){rr.xTouched=!1}},yUnitVector={x:0,y:1,axis:"y",distance:function(rr,er,tr,ir){return(tr?rr.yo:rr.y)-(ir?er.yo:er.y)},interpolate:function(rr,er,tr,ir){var nr,sr,ar,or,lr,cr,ur;if(!ir||ir===this){if(nr=rr.yo-er.yo,sr=rr.yo-tr.yo,lr=er.y-er.yo,cr=tr.y-tr.yo,ar=Math.abs(nr),or=Math.abs(sr),ur=ar+or,ur===0){rr.y=rr.yo+(lr+cr)/2;return}rr.y=rr.yo+(lr*or+cr*ar)/ur;return}if(nr=ir.distance(rr,er,!0,!0),sr=ir.distance(rr,tr,!0,!0),lr=ir.distance(er,er,!1,!0),cr=ir.distance(tr,tr,!1,!0),ar=Math.abs(nr),or=Math.abs(sr),ur=ar+or,ur===0){yUnitVector.setRelative(rr,rr,(lr+cr)/2,ir,!0);return}yUnitVector.setRelative(rr,rr,(lr*or+cr*ar)/ur,ir,!0)},normalSlope:0,setRelative:function(rr,er,tr,ir,nr){if(!ir||ir===this){rr.y=(nr?er.yo:er.y)+tr;return}var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*ir.x,lr=ar+tr*ir.y;rr.y=lr+ir.normalSlope*(rr.x-or)},slope:Number.POSITIVE_INFINITY,touch:function(rr){rr.yTouched=!0},touched:function(rr){return rr.yTouched},untouch:function(rr){rr.yTouched=!1}};Object.freeze(xUnitVector);Object.freeze(yUnitVector);function UnitVector(rr,er){this.x=rr,this.y=er,this.axis=void 0,this.slope=er/rr,this.normalSlope=-rr/er,Object.freeze(this)}UnitVector.prototype.distance=function(rr,er,tr,ir){return this.x*xUnitVector.distance(rr,er,tr,ir)+this.y*yUnitVector.distance(rr,er,tr,ir)};UnitVector.prototype.interpolate=function(rr,er,tr,ir){var nr,sr,ar,or,lr,cr,ur;if(ar=ir.distance(rr,er,!0,!0),or=ir.distance(rr,tr,!0,!0),nr=ir.distance(er,er,!1,!0),sr=ir.distance(tr,tr,!1,!0),lr=Math.abs(ar),cr=Math.abs(or),ur=lr+cr,ur===0){this.setRelative(rr,rr,(nr+sr)/2,ir,!0);return}this.setRelative(rr,rr,(nr*cr+sr*lr)/ur,ir,!0)};UnitVector.prototype.setRelative=function(rr,er,tr,ir,nr){ir=ir||this;var sr=nr?er.xo:er.x,ar=nr?er.yo:er.y,or=sr+tr*ir.x,lr=ar+tr*ir.y,cr=ir.normalSlope,ur=this.slope,dr=rr.x,hr=rr.y;rr.x=(ur*dr-cr*or+lr-hr)/(ur-cr),rr.y=ur*(rr.x-dr)+hr};UnitVector.prototype.touch=function(rr){rr.xTouched=!0,rr.yTouched=!0};function getUnitVector(rr,er){var tr=Math.sqrt(rr*rr+er*er);return rr/=tr,er/=tr,rr===1&&er===0?xUnitVector:rr===0&&er===1?yUnitVector:new UnitVector(rr,er)}function HPoint(rr,er,tr,ir){this.x=this.xo=Math.round(rr*64)/64,this.y=this.yo=Math.round(er*64)/64,this.lastPointOfContour=tr,this.onCurve=ir,this.prevPointOnContour=void 0,this.nextPointOnContour=void 0,this.xTouched=!1,this.yTouched=!1,Object.preventExtensions(this)}HPoint.prototype.nextTouched=function(rr){for(var er=this.nextPointOnContour;!rr.touched(er)&&er!==this;)er=er.nextPointOnContour;return er};HPoint.prototype.prevTouched=function(rr){for(var er=this.prevPointOnContour;!rr.touched(er)&&er!==this;)er=er.prevPointOnContour;return er};var HPZero=Object.freeze(new HPoint(0,0)),defaultState={cvCutIn:17/16,deltaBase:9,deltaShift:.125,loop:1,minDis:1,autoFlip:!0};function State(rr,er){switch(this.env=rr,this.stack=[],this.prog=er,rr){case"glyf":this.zp0=this.zp1=this.zp2=1,this.rp0=this.rp1=this.rp2=0;case"prep":this.fv=this.pv=this.dpv=xUnitVector,this.round=roundToGrid}}Hinting.prototype.exec=function(rr,er){if(typeof er!="number")throw new Error("Point size is not a number!");if(!(this._errorState>2)){var tr=this.font,ir=this._prepState;if(!ir||ir.ppem!==er){var nr=this._fpgmState;if(!nr){State.prototype=defaultState,nr=this._fpgmState=new State("fpgm",tr.tables.fpgm),nr.funcs=[],nr.font=tr,exports.DEBUG&&(console.log("---EXEC FPGM---"),nr.step=-1);try{exec(nr)}catch(cr){console.log("Hinting error in FPGM:"+cr),this._errorState=3;return}}State.prototype=nr,ir=this._prepState=new State("prep",tr.tables.prep),ir.ppem=er;var sr=tr.tables.cvt;if(sr)for(var ar=ir.cvt=new Array(sr.length),or=er/tr.unitsPerEm,lr=0;lr<sr.length;lr++)ar[lr]=sr[lr]*or;else ir.cvt=[];exports.DEBUG&&(console.log("---EXEC PREP---"),ir.step=-1);try{exec(ir)}catch(cr){this._errorState<2&&console.log("Hinting error in PREP:"+cr),this._errorState=2}}if(!(this._errorState>1))try{return execGlyph(rr,ir)}catch(cr){this._errorState<1&&(console.log("Hinting error:"+cr),console.log("Note: further hinting errors are silenced")),this._errorState=1;return}}};execGlyph=function(rr,er){var tr=er.ppem/er.font.unitsPerEm,ir=tr,nr=rr.components,sr,ar,or;if(State.prototype=er,!nr)or=new State("glyf",rr.instructions),exports.DEBUG&&(console.log("---EXEC GLYPH---"),or.step=-1),execComponent(rr,or,tr,ir),ar=or.gZone;else{var lr=er.font;ar=[],sr=[];for(var cr=0;cr<nr.length;cr++){var ur=nr[cr],dr=lr.glyphs.get(ur.glyphIndex);or=new State("glyf",dr.instructions),exports.DEBUG&&(console.log("---EXEC COMP "+cr+"---"),or.step=-1),execComponent(dr,or,tr,ir);for(var hr=Math.round(ur.dx*tr),pr=Math.round(ur.dy*ir),gr=or.gZone,vr=or.contours,mr=0;mr<gr.length;mr++){var fr=gr[mr];fr.xTouched=fr.yTouched=!1,fr.xo=fr.x=fr.x+hr,fr.yo=fr.y=fr.y+pr}var _r=ar.length;ar.push.apply(ar,gr);for(var Ar=0;Ar<vr.length;Ar++)sr.push(vr[Ar]+_r)}rr.instructions&&!or.inhibitGridFit&&(or=new State("glyf",rr.instructions),or.gZone=or.z0=or.z1=or.z2=ar,or.contours=sr,ar.push(new HPoint(0,0),new HPoint(Math.round(rr.advanceWidth*tr),0)),exports.DEBUG&&(console.log("---EXEC COMPOSITE---"),or.step=-1),exec(or),ar.length-=2)}return ar};execComponent=function(rr,er,tr,ir){for(var nr=rr.points||[],sr=nr.length,ar=er.gZone=er.z0=er.z1=er.z2=[],or=er.contours=[],lr,cr=0;cr<sr;cr++)lr=nr[cr],ar[cr]=new HPoint(lr.x*tr,lr.y*ir,lr.lastPointOfContour,lr.onCurve);for(var ur,dr,hr=0;hr<sr;hr++)lr=ar[hr],ur||(ur=lr,or.push(hr)),lr.lastPointOfContour?(lr.nextPointOnContour=ur,ur.prevPointOnContour=lr,ur=void 0):(dr=ar[hr+1],lr.nextPointOnContour=dr,dr.prevPointOnContour=lr);if(!er.inhibitGridFit){if(exports.DEBUG){console.log("PROCESSING GLYPH",er.stack);for(var pr=0;pr<sr;pr++)console.log(pr,ar[pr].x,ar[pr].y)}if(ar.push(new HPoint(0,0),new HPoint(Math.round(rr.advanceWidth*tr),0)),exec(er),ar.length-=2,exports.DEBUG){console.log("FINISHED GLYPH",er.stack);for(var gr=0;gr<sr;gr++)console.log(gr,ar[gr].x,ar[gr].y)}}};exec=function(rr){var er=rr.prog;if(er){var tr=er.length,ir;for(rr.ip=0;rr.ip<tr;rr.ip++){if(exports.DEBUG&&rr.step++,ir=instructionTable[er[rr.ip]],!ir)throw new Error("unknown instruction: 0x"+Number(er[rr.ip]).toString(16));ir(rr)}}};function initTZone(rr){for(var er=rr.tZone=new Array(rr.gZone.length),tr=0;tr<er.length;tr++)er[tr]=new HPoint(0,0)}function skip(rr,er){var tr=rr.prog,ir=rr.ip,nr=1,sr;do if(sr=tr[++ir],sr===88)nr++;else if(sr===89)nr--;else if(sr===64)ir+=tr[ir+1]+1;else if(sr===65)ir+=2*tr[ir+1]+1;else if(sr>=176&&sr<=183)ir+=sr-176+1;else if(sr>=184&&sr<=191)ir+=(sr-184+1)*2;else if(er&&nr===1&&sr===27)break;while(nr>0);rr.ip=ir}function SVTCA(rr,er){exports.DEBUG&&console.log(er.step,"SVTCA["+rr.axis+"]"),er.fv=er.pv=er.dpv=rr}function SPVTCA(rr,er){exports.DEBUG&&console.log(er.step,"SPVTCA["+rr.axis+"]"),er.pv=er.dpv=rr}function SFVTCA(rr,er){exports.DEBUG&&console.log(er.step,"SFVTCA["+rr.axis+"]"),er.fv=rr}function SPVTL(rr,er){var tr=er.stack,ir=tr.pop(),nr=tr.pop(),sr=er.z2[ir],ar=er.z1[nr];exports.DEBUG&&console.log("SPVTL["+rr+"]",ir,nr);var or,lr;rr?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.pv=er.dpv=getUnitVector(or,lr)}function SFVTL(rr,er){var tr=er.stack,ir=tr.pop(),nr=tr.pop(),sr=er.z2[ir],ar=er.z1[nr];exports.DEBUG&&console.log("SFVTL["+rr+"]",ir,nr);var or,lr;rr?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.fv=getUnitVector(or,lr)}function SPVFS(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"SPVFS[]",tr,ir),rr.pv=rr.dpv=getUnitVector(ir,tr)}function SFVFS(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"SPVFS[]",tr,ir),rr.fv=getUnitVector(ir,tr)}function GPV(rr){var er=rr.stack,tr=rr.pv;exports.DEBUG&&console.log(rr.step,"GPV[]"),er.push(tr.x*16384),er.push(tr.y*16384)}function GFV(rr){var er=rr.stack,tr=rr.fv;exports.DEBUG&&console.log(rr.step,"GFV[]"),er.push(tr.x*16384),er.push(tr.y*16384)}function SFVTPV(rr){rr.fv=rr.pv,exports.DEBUG&&console.log(rr.step,"SFVTPV[]")}function ISECT(rr){var er=rr.stack,tr=er.pop(),ir=er.pop(),nr=er.pop(),sr=er.pop(),ar=er.pop(),or=rr.z0,lr=rr.z1,cr=or[tr],ur=or[ir],dr=lr[nr],hr=lr[sr],pr=rr.z2[ar];exports.DEBUG&&console.log("ISECT[], ",tr,ir,nr,sr,ar);var gr=cr.x,vr=cr.y,mr=ur.x,fr=ur.y,_r=dr.x,Ar=dr.y,yr=hr.x,wr=hr.y,xr=(gr-mr)*(Ar-wr)-(vr-fr)*(_r-yr),Sr=gr*fr-vr*mr,br=_r*wr-Ar*yr;pr.x=(Sr*(_r-yr)-br*(gr-mr))/xr,pr.y=(Sr*(Ar-wr)-br*(vr-fr))/xr}function SRP0(rr){rr.rp0=rr.stack.pop(),exports.DEBUG&&console.log(rr.step,"SRP0[]",rr.rp0)}function SRP1(rr){rr.rp1=rr.stack.pop(),exports.DEBUG&&console.log(rr.step,"SRP1[]",rr.rp1)}function SRP2(rr){rr.rp2=rr.stack.pop(),exports.DEBUG&&console.log(rr.step,"SRP2[]",rr.rp2)}function SZP0(rr){var er=rr.stack.pop();switch(exports.DEBUG&&console.log(rr.step,"SZP0[]",er),rr.zp0=er,er){case 0:rr.tZone||initTZone(rr),rr.z0=rr.tZone;break;case 1:rr.z0=rr.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP1(rr){var er=rr.stack.pop();switch(exports.DEBUG&&console.log(rr.step,"SZP1[]",er),rr.zp1=er,er){case 0:rr.tZone||initTZone(rr),rr.z1=rr.tZone;break;case 1:rr.z1=rr.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZP2(rr){var er=rr.stack.pop();switch(exports.DEBUG&&console.log(rr.step,"SZP2[]",er),rr.zp2=er,er){case 0:rr.tZone||initTZone(rr),rr.z2=rr.tZone;break;case 1:rr.z2=rr.gZone;break;default:throw new Error("Invalid zone pointer")}}function SZPS(rr){var er=rr.stack.pop();switch(exports.DEBUG&&console.log(rr.step,"SZPS[]",er),rr.zp0=rr.zp1=rr.zp2=er,er){case 0:rr.tZone||initTZone(rr),rr.z0=rr.z1=rr.z2=rr.tZone;break;case 1:rr.z0=rr.z1=rr.z2=rr.gZone;break;default:throw new Error("Invalid zone pointer")}}function SLOOP(rr){rr.loop=rr.stack.pop(),exports.DEBUG&&console.log(rr.step,"SLOOP[]",rr.loop)}function RTG(rr){exports.DEBUG&&console.log(rr.step,"RTG[]"),rr.round=roundToGrid}function RTHG(rr){exports.DEBUG&&console.log(rr.step,"RTHG[]"),rr.round=roundToHalfGrid}function SMD(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"SMD[]",er),rr.minDis=er/64}function ELSE(rr){exports.DEBUG&&console.log(rr.step,"ELSE[]"),skip(rr,!1)}function JMPR(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"JMPR[]",er),rr.ip+=er-1}function SCVTCI(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"SCVTCI[]",er),rr.cvCutIn=er/64}function DUP(rr){var er=rr.stack;exports.DEBUG&&console.log(rr.step,"DUP[]"),er.push(er[er.length-1])}function POP(rr){exports.DEBUG&&console.log(rr.step,"POP[]"),rr.stack.pop()}function CLEAR(rr){exports.DEBUG&&console.log(rr.step,"CLEAR[]"),rr.stack.length=0}function SWAP(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"SWAP[]"),er.push(tr),er.push(ir)}function DEPTH(rr){var er=rr.stack;exports.DEBUG&&console.log(rr.step,"DEPTH[]"),er.push(er.length)}function LOOPCALL(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"LOOPCALL[]",tr,ir);var nr=rr.ip,sr=rr.prog;rr.prog=rr.funcs[tr];for(var ar=0;ar<ir;ar++)exec(rr),exports.DEBUG&&console.log(++rr.step,ar+1<ir?"next loopcall":"done loopcall",ar);rr.ip=nr,rr.prog=sr}function CALL(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"CALL[]",er);var tr=rr.ip,ir=rr.prog;rr.prog=rr.funcs[er],exec(rr),rr.ip=tr,rr.prog=ir,exports.DEBUG&&console.log(++rr.step,"returning from",er)}function CINDEX(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"CINDEX[]",tr),er.push(er[er.length-tr])}function MINDEX(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"MINDEX[]",tr),er.push(er.splice(er.length-tr,1)[0])}function FDEF(rr){if(rr.env!=="fpgm")throw new Error("FDEF not allowed here");var er=rr.stack,tr=rr.prog,ir=rr.ip,nr=er.pop(),sr=ir;for(exports.DEBUG&&console.log(rr.step,"FDEF[]",nr);tr[++ir]!==45;);rr.ip=ir,rr.funcs[nr]=tr.slice(sr+1,ir)}function MDAP(rr,er){var tr=er.stack.pop(),ir=er.z0[tr],nr=er.fv,sr=er.pv;exports.DEBUG&&console.log(er.step,"MDAP["+rr+"]",tr);var ar=sr.distance(ir,HPZero);rr&&(ar=er.round(ar)),nr.setRelative(ir,HPZero,ar,sr),nr.touch(ir),er.rp0=er.rp1=tr}function IUP(rr,er){var tr=er.z2,ir=tr.length-2,nr,sr,ar;exports.DEBUG&&console.log(er.step,"IUP["+rr.axis+"]");for(var or=0;or<ir;or++)nr=tr[or],!rr.touched(nr)&&(sr=nr.prevTouched(rr),sr!==nr&&(ar=nr.nextTouched(rr),sr===ar&&rr.setRelative(nr,nr,rr.distance(sr,sr,!1,!0),rr,!0),rr.interpolate(nr,sr,ar,rr)))}function SHP(rr,er){for(var tr=er.stack,ir=rr?er.rp1:er.rp2,nr=(rr?er.z0:er.z1)[ir],sr=er.fv,ar=er.pv,or=er.loop,lr=er.z2;or--;){var cr=tr.pop(),ur=lr[cr],dr=ar.distance(nr,nr,!1,!0);sr.setRelative(ur,ur,dr,ar),sr.touch(ur),exports.DEBUG&&console.log(er.step,(er.loop>1?"loop "+(er.loop-or)+": ":"")+"SHP["+(rr?"rp1":"rp2")+"]",cr)}er.loop=1}function SHC(rr,er){var tr=er.stack,ir=rr?er.rp1:er.rp2,nr=(rr?er.z0:er.z1)[ir],sr=er.fv,ar=er.pv,or=tr.pop(),lr=er.z2[er.contours[or]],cr=lr;exports.DEBUG&&console.log(er.step,"SHC["+rr+"]",or);var ur=ar.distance(nr,nr,!1,!0);do cr!==nr&&sr.setRelative(cr,cr,ur,ar),cr=cr.nextPointOnContour;while(cr!==lr)}function SHZ(rr,er){var tr=er.stack,ir=rr?er.rp1:er.rp2,nr=(rr?er.z0:er.z1)[ir],sr=er.fv,ar=er.pv,or=tr.pop();exports.DEBUG&&console.log(er.step,"SHZ["+rr+"]",or);var lr;switch(or){case 0:lr=er.tZone;break;case 1:lr=er.gZone;break;default:throw new Error("Invalid zone")}for(var cr,ur=ar.distance(nr,nr,!1,!0),dr=lr.length-2,hr=0;hr<dr;hr++)cr=lr[hr],sr.setRelative(cr,cr,ur,ar)}function SHPIX(rr){for(var er=rr.stack,tr=rr.loop,ir=rr.fv,nr=er.pop()/64,sr=rr.z2;tr--;){var ar=er.pop(),or=sr[ar];exports.DEBUG&&console.log(rr.step,(rr.loop>1?"loop "+(rr.loop-tr)+": ":"")+"SHPIX[]",ar,nr),ir.setRelative(or,or,nr),ir.touch(or)}rr.loop=1}function IP(rr){for(var er=rr.stack,tr=rr.rp1,ir=rr.rp2,nr=rr.loop,sr=rr.z0[tr],ar=rr.z1[ir],or=rr.fv,lr=rr.dpv,cr=rr.z2;nr--;){var ur=er.pop(),dr=cr[ur];exports.DEBUG&&console.log(rr.step,(rr.loop>1?"loop "+(rr.loop-nr)+": ":"")+"IP[]",ur,tr,"<->",ir),or.interpolate(dr,sr,ar,lr),or.touch(dr)}rr.loop=1}function MSIRP(rr,er){var tr=er.stack,ir=tr.pop()/64,nr=tr.pop(),sr=er.z1[nr],ar=er.z0[er.rp0],or=er.fv,lr=er.pv;or.setRelative(sr,ar,ir,lr),or.touch(sr),exports.DEBUG&&console.log(er.step,"MSIRP["+rr+"]",ir,nr),er.rp1=er.rp0,er.rp2=nr,rr&&(er.rp0=nr)}function ALIGNRP(rr){for(var er=rr.stack,tr=rr.rp0,ir=rr.z0[tr],nr=rr.loop,sr=rr.fv,ar=rr.pv,or=rr.z1;nr--;){var lr=er.pop(),cr=or[lr];exports.DEBUG&&console.log(rr.step,(rr.loop>1?"loop "+(rr.loop-nr)+": ":"")+"ALIGNRP[]",lr),sr.setRelative(cr,ir,0,ar),sr.touch(cr)}rr.loop=1}function RTDG(rr){exports.DEBUG&&console.log(rr.step,"RTDG[]"),rr.round=roundToDoubleGrid}function MIAP(rr,er){var tr=er.stack,ir=tr.pop(),nr=tr.pop(),sr=er.z0[nr],ar=er.fv,or=er.pv,lr=er.cvt[ir];exports.DEBUG&&console.log(er.step,"MIAP["+rr+"]",ir,"(",lr,")",nr);var cr=or.distance(sr,HPZero);rr&&(Math.abs(cr-lr)<er.cvCutIn&&(cr=lr),cr=er.round(cr)),ar.setRelative(sr,HPZero,cr,or),er.zp0===0&&(sr.xo=sr.x,sr.yo=sr.y),ar.touch(sr),er.rp0=er.rp1=nr}function NPUSHB(rr){var er=rr.prog,tr=rr.ip,ir=rr.stack,nr=er[++tr];exports.DEBUG&&console.log(rr.step,"NPUSHB[]",nr);for(var sr=0;sr<nr;sr++)ir.push(er[++tr]);rr.ip=tr}function NPUSHW(rr){var er=rr.ip,tr=rr.prog,ir=rr.stack,nr=tr[++er];exports.DEBUG&&console.log(rr.step,"NPUSHW[]",nr);for(var sr=0;sr<nr;sr++){var ar=tr[++er]<<8|tr[++er];ar&32768&&(ar=-((ar^65535)+1)),ir.push(ar)}rr.ip=er}function WS(rr){var er=rr.stack,tr=rr.store;tr||(tr=rr.store=[]);var ir=er.pop(),nr=er.pop();exports.DEBUG&&console.log(rr.step,"WS",ir,nr),tr[nr]=ir}function RS(rr){var er=rr.stack,tr=rr.store,ir=er.pop();exports.DEBUG&&console.log(rr.step,"RS",ir);var nr=tr&&tr[ir]||0;er.push(nr)}function WCVTP(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"WCVTP",tr,ir),rr.cvt[ir]=tr/64}function RCVT(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"RCVT",tr),er.push(rr.cvt[tr]*64)}function GC(rr,er){var tr=er.stack,ir=tr.pop(),nr=er.z2[ir];exports.DEBUG&&console.log(er.step,"GC["+rr+"]",ir),tr.push(er.dpv.distance(nr,HPZero,rr,!1)*64)}function MD(rr,er){var tr=er.stack,ir=tr.pop(),nr=tr.pop(),sr=er.z1[ir],ar=er.z0[nr],or=er.dpv.distance(ar,sr,rr,rr);exports.DEBUG&&console.log(er.step,"MD["+rr+"]",ir,nr,"->",or),er.stack.push(Math.round(or*64))}function MPPEM(rr){exports.DEBUG&&console.log(rr.step,"MPPEM[]"),rr.stack.push(rr.ppem)}function FLIPON(rr){exports.DEBUG&&console.log(rr.step,"FLIPON[]"),rr.autoFlip=!0}function LT(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"LT[]",tr,ir),er.push(ir<tr?1:0)}function LTEQ(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"LTEQ[]",tr,ir),er.push(ir<=tr?1:0)}function GT(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"GT[]",tr,ir),er.push(ir>tr?1:0)}function GTEQ(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"GTEQ[]",tr,ir),er.push(ir>=tr?1:0)}function EQ(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"EQ[]",tr,ir),er.push(tr===ir?1:0)}function NEQ(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"NEQ[]",tr,ir),er.push(tr!==ir?1:0)}function ODD(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"ODD[]",tr),er.push(Math.trunc(tr)%2?1:0)}function EVEN(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"EVEN[]",tr),er.push(Math.trunc(tr)%2?0:1)}function IF(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"IF[]",er),er||(skip(rr,!0),exports.DEBUG&&console.log(rr.step,"EIF[]"))}function EIF(rr){exports.DEBUG&&console.log(rr.step,"EIF[]")}function AND(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"AND[]",tr,ir),er.push(tr&&ir?1:0)}function OR(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"OR[]",tr,ir),er.push(tr||ir?1:0)}function NOT(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"NOT[]",tr),er.push(tr?0:1)}function DELTAP123(rr,er){var tr=er.stack,ir=tr.pop(),nr=er.fv,sr=er.pv,ar=er.ppem,or=er.deltaBase+(rr-1)*16,lr=er.deltaShift,cr=er.z0;exports.DEBUG&&console.log(er.step,"DELTAP["+rr+"]",ir,tr);for(var ur=0;ur<ir;ur++){var dr=tr.pop(),hr=tr.pop(),pr=or+((hr&240)>>4);if(pr===ar){var gr=(hr&15)-8;gr>=0&&gr++,exports.DEBUG&&console.log(er.step,"DELTAPFIX",dr,"by",gr*lr);var vr=cr[dr];nr.setRelative(vr,vr,gr*lr,sr)}}}function SDB(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"SDB[]",tr),rr.deltaBase=tr}function SDS(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"SDS[]",tr),rr.deltaShift=Math.pow(.5,tr)}function ADD(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"ADD[]",tr,ir),er.push(ir+tr)}function SUB(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"SUB[]",tr,ir),er.push(ir-tr)}function DIV(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"DIV[]",tr,ir),er.push(ir*64/tr)}function MUL(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"MUL[]",tr,ir),er.push(ir*tr/64)}function ABS(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"ABS[]",tr),er.push(Math.abs(tr))}function NEG(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"NEG[]",tr),er.push(-tr)}function FLOOR(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"FLOOR[]",tr),er.push(Math.floor(tr/64)*64)}function CEILING(rr){var er=rr.stack,tr=er.pop();exports.DEBUG&&console.log(rr.step,"CEILING[]",tr),er.push(Math.ceil(tr/64)*64)}function ROUND(rr,er){var tr=er.stack,ir=tr.pop();exports.DEBUG&&console.log(er.step,"ROUND[]"),tr.push(er.round(ir/64)*64)}function WCVTF(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"WCVTF[]",tr,ir),rr.cvt[ir]=tr*rr.ppem/rr.font.unitsPerEm}function DELTAC123(rr,er){var tr=er.stack,ir=tr.pop(),nr=er.ppem,sr=er.deltaBase+(rr-1)*16,ar=er.deltaShift;exports.DEBUG&&console.log(er.step,"DELTAC["+rr+"]",ir,tr);for(var or=0;or<ir;or++){var lr=tr.pop(),cr=tr.pop(),ur=sr+((cr&240)>>4);if(ur===nr){var dr=(cr&15)-8;dr>=0&&dr++;var hr=dr*ar;exports.DEBUG&&console.log(er.step,"DELTACFIX",lr,"by",hr),er.cvt[lr]+=hr}}}function SROUND(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"SROUND[]",er),rr.round=roundSuper;var tr;switch(er&192){case 0:tr=.5;break;case 64:tr=1;break;case 128:tr=2;break;default:throw new Error("invalid SROUND value")}switch(rr.srPeriod=tr,er&48){case 0:rr.srPhase=0;break;case 16:rr.srPhase=.25*tr;break;case 32:rr.srPhase=.5*tr;break;case 48:rr.srPhase=.75*tr;break;default:throw new Error("invalid SROUND value")}er&=15,er===0?rr.srThreshold=0:rr.srThreshold=(er/8-.5)*tr}function S45ROUND(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"S45ROUND[]",er),rr.round=roundSuper;var tr;switch(er&192){case 0:tr=Math.sqrt(2)/2;break;case 64:tr=Math.sqrt(2);break;case 128:tr=2*Math.sqrt(2);break;default:throw new Error("invalid S45ROUND value")}switch(rr.srPeriod=tr,er&48){case 0:rr.srPhase=0;break;case 16:rr.srPhase=.25*tr;break;case 32:rr.srPhase=.5*tr;break;case 48:rr.srPhase=.75*tr;break;default:throw new Error("invalid S45ROUND value")}er&=15,er===0?rr.srThreshold=0:rr.srThreshold=(er/8-.5)*tr}function ROFF(rr){exports.DEBUG&&console.log(rr.step,"ROFF[]"),rr.round=roundOff}function RUTG(rr){exports.DEBUG&&console.log(rr.step,"RUTG[]"),rr.round=roundUpToGrid}function RDTG(rr){exports.DEBUG&&console.log(rr.step,"RDTG[]"),rr.round=roundDownToGrid}function SCANCTRL(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"SCANCTRL[]",er)}function SDPVTL(rr,er){var tr=er.stack,ir=tr.pop(),nr=tr.pop(),sr=er.z2[ir],ar=er.z1[nr];exports.DEBUG&&console.log(er.step,"SDPVTL["+rr+"]",ir,nr);var or,lr;rr?(or=sr.y-ar.y,lr=ar.x-sr.x):(or=ar.x-sr.x,lr=ar.y-sr.y),er.dpv=getUnitVector(or,lr)}function GETINFO(rr){var er=rr.stack,tr=er.pop(),ir=0;exports.DEBUG&&console.log(rr.step,"GETINFO[]",tr),tr&1&&(ir=35),tr&32&&(ir|=4096),er.push(ir)}function ROLL(rr){var er=rr.stack,tr=er.pop(),ir=er.pop(),nr=er.pop();exports.DEBUG&&console.log(rr.step,"ROLL[]"),er.push(ir),er.push(tr),er.push(nr)}function MAX(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"MAX[]",tr,ir),er.push(Math.max(ir,tr))}function MIN(rr){var er=rr.stack,tr=er.pop(),ir=er.pop();exports.DEBUG&&console.log(rr.step,"MIN[]",tr,ir),er.push(Math.min(ir,tr))}function SCANTYPE(rr){var er=rr.stack.pop();exports.DEBUG&&console.log(rr.step,"SCANTYPE[]",er)}function INSTCTRL(rr){var er=rr.stack.pop(),tr=rr.stack.pop();switch(exports.DEBUG&&console.log(rr.step,"INSTCTRL[]",er,tr),er){case 1:rr.inhibitGridFit=!!tr;return;case 2:rr.ignoreCvt=!!tr;return;default:throw new Error("invalid INSTCTRL[] selector")}}function PUSHB(rr,er){var tr=er.stack,ir=er.prog,nr=er.ip;exports.DEBUG&&console.log(er.step,"PUSHB["+rr+"]");for(var sr=0;sr<rr;sr++)tr.push(ir[++nr]);er.ip=nr}function PUSHW(rr,er){var tr=er.ip,ir=er.prog,nr=er.stack;exports.DEBUG&&console.log(er.ip,"PUSHW["+rr+"]");for(var sr=0;sr<rr;sr++){var ar=ir[++tr]<<8|ir[++tr];ar&32768&&(ar=-((ar^65535)+1)),nr.push(ar)}er.ip=tr}function MDRP_MIRP(rr,er,tr,ir,nr,sr){var ar=sr.stack,or=rr&&ar.pop(),lr=ar.pop(),cr=sr.rp0,ur=sr.z0[cr],dr=sr.z1[lr],hr=sr.minDis,pr=sr.fv,gr=sr.dpv,vr,mr,fr,_r;mr=vr=gr.distance(dr,ur,!0,!0),fr=mr>=0?1:-1,mr=Math.abs(mr),rr&&(_r=sr.cvt[or],ir&&Math.abs(mr-_r)<sr.cvCutIn&&(mr=_r)),tr&&mr<hr&&(mr=hr),ir&&(mr=sr.round(mr)),pr.setRelative(dr,ur,fr*mr,gr),pr.touch(dr),exports.DEBUG&&console.log(sr.step,(rr?"MIRP[":"MDRP[")+(er?"M":"m")+(tr?">":"_")+(ir?"R":"_")+(nr===0?"Gr":nr===1?"Bl":nr===2?"Wh":"")+"]",rr?or+"("+sr.cvt[or]+","+_r+")":"",lr,"(d =",vr,"->",fr*mr,")"),sr.rp1=sr.rp0,sr.rp2=lr,er&&(sr.rp0=lr)}instructionTable=[SVTCA.bind(void 0,yUnitVector),SVTCA.bind(void 0,xUnitVector),SPVTCA.bind(void 0,yUnitVector),SPVTCA.bind(void 0,xUnitVector),SFVTCA.bind(void 0,yUnitVector),SFVTCA.bind(void 0,xUnitVector),SPVTL.bind(void 0,0),SPVTL.bind(void 0,1),SFVTL.bind(void 0,0),SFVTL.bind(void 0,1),SPVFS,SFVFS,GPV,GFV,SFVTPV,ISECT,SRP0,SRP1,SRP2,SZP0,SZP1,SZP2,SZPS,SLOOP,RTG,RTHG,SMD,ELSE,JMPR,SCVTCI,void 0,void 0,DUP,POP,CLEAR,SWAP,DEPTH,CINDEX,MINDEX,void 0,void 0,void 0,LOOPCALL,CALL,FDEF,void 0,MDAP.bind(void 0,0),MDAP.bind(void 0,1),IUP.bind(void 0,yUnitVector),IUP.bind(void 0,xUnitVector),SHP.bind(void 0,0),SHP.bind(void 0,1),SHC.bind(void 0,0),SHC.bind(void 0,1),SHZ.bind(void 0,0),SHZ.bind(void 0,1),SHPIX,IP,MSIRP.bind(void 0,0),MSIRP.bind(void 0,1),ALIGNRP,RTDG,MIAP.bind(void 0,0),MIAP.bind(void 0,1),NPUSHB,NPUSHW,WS,RS,WCVTP,RCVT,GC.bind(void 0,0),GC.bind(void 0,1),void 0,MD.bind(void 0,0),MD.bind(void 0,1),MPPEM,void 0,FLIPON,void 0,void 0,LT,LTEQ,GT,GTEQ,EQ,NEQ,ODD,EVEN,IF,EIF,AND,OR,NOT,DELTAP123.bind(void 0,1),SDB,SDS,ADD,SUB,DIV,MUL,ABS,NEG,FLOOR,CEILING,ROUND.bind(void 0,0),ROUND.bind(void 0,1),ROUND.bind(void 0,2),ROUND.bind(void 0,3),void 0,void 0,void 0,void 0,WCVTF,DELTAP123.bind(void 0,2),DELTAP123.bind(void 0,3),DELTAC123.bind(void 0,1),DELTAC123.bind(void 0,2),DELTAC123.bind(void 0,3),SROUND,S45ROUND,void 0,void 0,ROFF,void 0,RUTG,RDTG,POP,POP,void 0,void 0,void 0,void 0,void 0,SCANCTRL,SDPVTL.bind(void 0,0),SDPVTL.bind(void 0,1),GETINFO,void 0,ROLL,MAX,MIN,SCANTYPE,INSTCTRL,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,PUSHB.bind(void 0,1),PUSHB.bind(void 0,2),PUSHB.bind(void 0,3),PUSHB.bind(void 0,4),PUSHB.bind(void 0,5),PUSHB.bind(void 0,6),PUSHB.bind(void 0,7),PUSHB.bind(void 0,8),PUSHW.bind(void 0,1),PUSHW.bind(void 0,2),PUSHW.bind(void 0,3),PUSHW.bind(void 0,4),PUSHW.bind(void 0,5),PUSHW.bind(void 0,6),PUSHW.bind(void 0,7),PUSHW.bind(void 0,8),MDRP_MIRP.bind(void 0,0,0,0,0,0),MDRP_MIRP.bind(void 0,0,0,0,0,1),MDRP_MIRP.bind(void 0,0,0,0,0,2),MDRP_MIRP.bind(void 0,0,0,0,0,3),MDRP_MIRP.bind(void 0,0,0,0,1,0),MDRP_MIRP.bind(void 0,0,0,0,1,1),MDRP_MIRP.bind(void 0,0,0,0,1,2),MDRP_MIRP.bind(void 0,0,0,0,1,3),MDRP_MIRP.bind(void 0,0,0,1,0,0),MDRP_MIRP.bind(void 0,0,0,1,0,1),MDRP_MIRP.bind(void 0,0,0,1,0,2),MDRP_MIRP.bind(void 0,0,0,1,0,3),MDRP_MIRP.bind(void 0,0,0,1,1,0),MDRP_MIRP.bind(void 0,0,0,1,1,1),MDRP_MIRP.bind(void 0,0,0,1,1,2),MDRP_MIRP.bind(void 0,0,0,1,1,3),MDRP_MIRP.bind(void 0,0,1,0,0,0),MDRP_MIRP.bind(void 0,0,1,0,0,1),MDRP_MIRP.bind(void 0,0,1,0,0,2),MDRP_MIRP.bind(void 0,0,1,0,0,3),MDRP_MIRP.bind(void 0,0,1,0,1,0),MDRP_MIRP.bind(void 0,0,1,0,1,1),MDRP_MIRP.bind(void 0,0,1,0,1,2),MDRP_MIRP.bind(void 0,0,1,0,1,3),MDRP_MIRP.bind(void 0,0,1,1,0,0),MDRP_MIRP.bind(void 0,0,1,1,0,1),MDRP_MIRP.bind(void 0,0,1,1,0,2),MDRP_MIRP.bind(void 0,0,1,1,0,3),MDRP_MIRP.bind(void 0,0,1,1,1,0),MDRP_MIRP.bind(void 0,0,1,1,1,1),MDRP_MIRP.bind(void 0,0,1,1,1,2),MDRP_MIRP.bind(void 0,0,1,1,1,3),MDRP_MIRP.bind(void 0,1,0,0,0,0),MDRP_MIRP.bind(void 0,1,0,0,0,1),MDRP_MIRP.bind(void 0,1,0,0,0,2),MDRP_MIRP.bind(void 0,1,0,0,0,3),MDRP_MIRP.bind(void 0,1,0,0,1,0),MDRP_MIRP.bind(void 0,1,0,0,1,1),MDRP_MIRP.bind(void 0,1,0,0,1,2),MDRP_MIRP.bind(void 0,1,0,0,1,3),MDRP_MIRP.bind(void 0,1,0,1,0,0),MDRP_MIRP.bind(void 0,1,0,1,0,1),MDRP_MIRP.bind(void 0,1,0,1,0,2),MDRP_MIRP.bind(void 0,1,0,1,0,3),MDRP_MIRP.bind(void 0,1,0,1,1,0),MDRP_MIRP.bind(void 0,1,0,1,1,1),MDRP_MIRP.bind(void 0,1,0,1,1,2),MDRP_MIRP.bind(void 0,1,0,1,1,3),MDRP_MIRP.bind(void 0,1,1,0,0,0),MDRP_MIRP.bind(void 0,1,1,0,0,1),MDRP_MIRP.bind(void 0,1,1,0,0,2),MDRP_MIRP.bind(void 0,1,1,0,0,3),MDRP_MIRP.bind(void 0,1,1,0,1,0),MDRP_MIRP.bind(void 0,1,1,0,1,1),MDRP_MIRP.bind(void 0,1,1,0,1,2),MDRP_MIRP.bind(void 0,1,1,0,1,3),MDRP_MIRP.bind(void 0,1,1,1,0,0),MDRP_MIRP.bind(void 0,1,1,1,0,1),MDRP_MIRP.bind(void 0,1,1,1,0,2),MDRP_MIRP.bind(void 0,1,1,1,0,3),MDRP_MIRP.bind(void 0,1,1,1,1,0),MDRP_MIRP.bind(void 0,1,1,1,1,1),MDRP_MIRP.bind(void 0,1,1,1,1,2),MDRP_MIRP.bind(void 0,1,1,1,1,3)];function Token(rr){this.char=rr,this.state={},this.activeState=null}function ContextRange(rr,er,tr){this.contextName=tr,this.startIndex=rr,this.endOffset=er}function ContextChecker(rr,er,tr){this.contextName=rr,this.openRange=null,this.ranges=[],this.checkStart=er,this.checkEnd=tr}function ContextParams(rr,er){this.context=rr,this.index=er,this.length=rr.length,this.current=rr[er],this.backtrack=rr.slice(0,er),this.lookahead=rr.slice(er+1)}function Event$1(rr){this.eventId=rr,this.subscribers=[]}function initializeCoreEvents(rr){var er=this,tr=["start","end","next","newToken","contextStart","contextEnd","insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD","updateContextsRanges"];tr.forEach(function(nr){Object.defineProperty(er.events,nr,{value:new Event$1(nr)})}),rr&&tr.forEach(function(nr){var sr=rr[nr];typeof sr=="function"&&er.events[nr].subscribe(sr)});var ir=["insertToken","removeToken","removeRange","replaceToken","replaceRange","composeRUD"];ir.forEach(function(nr){er.events[nr].subscribe(er.updateContextsRanges)})}function Tokenizer(rr){this.tokens=[],this.registeredContexts={},this.contextCheckers=[],this.events={},this.registeredModifiers=[],initializeCoreEvents.call(this,rr)}Token.prototype.setState=function(rr,er){return this.state[rr]=er,this.activeState={key:rr,value:this.state[rr]},this.activeState};Token.prototype.getState=function(rr){return this.state[rr]||null};Tokenizer.prototype.inboundIndex=function(rr){return rr>=0&&rr<this.tokens.length};Tokenizer.prototype.composeRUD=function(rr){var er=this,tr=!0,ir=rr.map(function(sr){return er[sr[0]].apply(er,sr.slice(1).concat(tr))}),nr=function(sr){return typeof sr=="object"&&sr.hasOwnProperty("FAIL")};if(ir.every(nr))return{FAIL:"composeRUD: one or more operations hasn't completed successfully",report:ir.filter(nr)};this.dispatch("composeRUD",[ir.filter(function(sr){return!nr(sr)})])};Tokenizer.prototype.replaceRange=function(rr,er,tr,ir){er=er!==null?er:this.tokens.length;var nr=tr.every(function(ar){return ar instanceof Token});if(!isNaN(rr)&&this.inboundIndex(rr)&&nr){var sr=this.tokens.splice.apply(this.tokens,[rr,er].concat(tr));return ir||this.dispatch("replaceToken",[rr,er,tr]),[sr,tr]}else return{FAIL:"replaceRange: invalid tokens or startIndex."}};Tokenizer.prototype.replaceToken=function(rr,er,tr){if(!isNaN(rr)&&this.inboundIndex(rr)&&er instanceof Token){var ir=this.tokens.splice(rr,1,er);return tr||this.dispatch("replaceToken",[rr,er]),[ir[0],er]}else return{FAIL:"replaceToken: invalid token or index."}};Tokenizer.prototype.removeRange=function(rr,er,tr){er=isNaN(er)?this.tokens.length:er;var ir=this.tokens.splice(rr,er);return tr||this.dispatch("removeRange",[ir,rr,er]),ir};Tokenizer.prototype.removeToken=function(rr,er){if(!isNaN(rr)&&this.inboundIndex(rr)){var tr=this.tokens.splice(rr,1);return er||this.dispatch("removeToken",[tr,rr]),tr}else return{FAIL:"removeToken: invalid token index."}};Tokenizer.prototype.insertToken=function(rr,er,tr){var ir=rr.every(function(nr){return nr instanceof Token});return ir?(this.tokens.splice.apply(this.tokens,[er,0].concat(rr)),tr||this.dispatch("insertToken",[rr,er]),rr):{FAIL:"insertToken: invalid token(s)."}};Tokenizer.prototype.registerModifier=function(rr,er,tr){this.events.newToken.subscribe(function(ir,nr){var sr=[ir,nr],ar=er===null||er.apply(this,sr)===!0,or=[ir,nr];if(ar){var lr=tr.apply(this,or);ir.setState(rr,lr)}}),this.registeredModifiers.push(rr)};Event$1.prototype.subscribe=function(rr){return typeof rr=="function"?this.subscribers.push(rr)-1:{FAIL:"invalid '"+this.eventId+"' event handler"}};Event$1.prototype.unsubscribe=function(rr){this.subscribers.splice(rr,1)};ContextParams.prototype.setCurrentIndex=function(rr){this.index=rr,this.current=this.context[rr],this.backtrack=this.context.slice(0,rr),this.lookahead=this.context.slice(rr+1)};ContextParams.prototype.get=function(rr){switch(!0){case rr===0:return this.current;case(rr<0&&Math.abs(rr)<=this.backtrack.length):return this.backtrack.slice(rr)[0];case(rr>0&&rr<=this.lookahead.length):return this.lookahead[rr-1];default:return null}};Tokenizer.prototype.rangeToText=function(rr){if(rr instanceof ContextRange)return this.getRangeTokens(rr).map(function(er){return er.char}).join("")};Tokenizer.prototype.getText=function(){return this.tokens.map(function(rr){return rr.char}).join("")};Tokenizer.prototype.getContext=function(rr){var er=this.registeredContexts[rr];return er||null};Tokenizer.prototype.on=function(rr,er){var tr=this.events[rr];return tr?tr.subscribe(er):null};Tokenizer.prototype.dispatch=function(rr,er){var tr=this,ir=this.events[rr];ir instanceof Event$1&&ir.subscribers.forEach(function(nr){nr.apply(tr,er||[])})};Tokenizer.prototype.registerContextChecker=function(rr,er,tr){if(this.getContext(rr))return{FAIL:"context name '"+rr+"' is already registered."};if(typeof er!="function")return{FAIL:"missing context start check."};if(typeof tr!="function")return{FAIL:"missing context end check."};var ir=new ContextChecker(rr,er,tr);return this.registeredContexts[rr]=ir,this.contextCheckers.push(ir),ir};Tokenizer.prototype.getRangeTokens=function(rr){var er=rr.startIndex+rr.endOffset;return[].concat(this.tokens.slice(rr.startIndex,er))};Tokenizer.prototype.getContextRanges=function(rr){var er=this.getContext(rr);return er?er.ranges:{FAIL:"context checker '"+rr+"' is not registered."}};Tokenizer.prototype.resetContextsRanges=function(){var rr=this.registeredContexts;for(var er in rr)if(rr.hasOwnProperty(er)){var tr=rr[er];tr.ranges=[]}};Tokenizer.prototype.updateContextsRanges=function(){this.resetContextsRanges();for(var rr=this.tokens.map(function(ir){return ir.char}),er=0;er<rr.length;er++){var tr=new ContextParams(rr,er);this.runContextCheck(tr)}this.dispatch("updateContextsRanges",[this.registeredContexts])};Tokenizer.prototype.setEndOffset=function(rr,er){var tr=this.getContext(er).openRange.startIndex,ir=new ContextRange(tr,rr,er),nr=this.getContext(er).ranges;return ir.rangeId=er+"."+nr.length,nr.push(ir),this.getContext(er).openRange=null,ir};Tokenizer.prototype.runContextCheck=function(rr){var er=this,tr=rr.index;this.contextCheckers.forEach(function(ir){var nr=ir.contextName,sr=er.getContext(nr).openRange;if(!sr&&ir.checkStart(rr)&&(sr=new ContextRange(tr,null,nr),er.getContext(nr).openRange=sr,er.dispatch("contextStart",[nr,tr])),sr&&ir.checkEnd(rr)){var ar=tr-sr.startIndex+1,or=er.setEndOffset(ar,nr);er.dispatch("contextEnd",[nr,or])}})};Tokenizer.prototype.tokenize=function(rr){this.tokens=[],this.resetContextsRanges();var er=Array.from(rr);this.dispatch("start");for(var tr=0;tr<er.length;tr++){var ir=er[tr],nr=new ContextParams(er,tr);this.dispatch("next",[nr]),this.runContextCheck(nr);var sr=new Token(ir);this.tokens.push(sr),this.dispatch("newToken",[sr,nr])}return this.dispatch("end",[this.tokens]),this.tokens};function isArabicChar(rr){return/[\u0600-\u065F\u066A-\u06D2\u06FA-\u06FF]/.test(rr)}function isIsolatedArabicChar(rr){return/[\u0630\u0690\u0621\u0631\u0661\u0671\u0622\u0632\u0672\u0692\u06C2\u0623\u0673\u0693\u06C3\u0624\u0694\u06C4\u0625\u0675\u0695\u06C5\u06E5\u0676\u0696\u06C6\u0627\u0677\u0697\u06C7\u0648\u0688\u0698\u06C8\u0689\u0699\u06C9\u068A\u06CA\u066B\u068B\u06CB\u068C\u068D\u06CD\u06FD\u068E\u06EE\u06FE\u062F\u068F\u06CF\u06EF]/.test(rr)}function isTashkeelArabicChar(rr){return/[\u0600-\u0605\u060C-\u060E\u0610-\u061B\u061E\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED]/.test(rr)}function isLatinChar(rr){return/[A-z]/.test(rr)}function isWhiteSpace(rr){return/\s/.test(rr)}function FeatureQuery(rr){this.font=rr,this.features={}}function SubstitutionAction(rr){this.id=rr.id,this.tag=rr.tag,this.substitution=rr.substitution}function lookupCoverage(rr,er){if(!rr)return-1;switch(er.format){case 1:return er.glyphs.indexOf(rr);case 2:for(var tr=er.ranges,ir=0;ir<tr.length;ir++){var nr=tr[ir];if(rr>=nr.start&&rr<=nr.end){var sr=rr-nr.start;return nr.index+sr}}break;default:return-1}return-1}function singleSubstitutionFormat1(rr,er){var tr=lookupCoverage(rr,er.coverage);return tr===-1?null:rr+er.deltaGlyphId}function singleSubstitutionFormat2(rr,er){var tr=lookupCoverage(rr,er.coverage);return tr===-1?null:er.substitute[tr]}function lookupCoverageList(rr,er){for(var tr=[],ir=0;ir<rr.length;ir++){var nr=rr[ir],sr=er.current;sr=Array.isArray(sr)?sr[0]:sr;var ar=lookupCoverage(sr,nr);ar!==-1&&tr.push(ar)}return tr.length!==rr.length?-1:tr}function chainingSubstitutionFormat3(rr,er){var tr=er.inputCoverage.length+er.lookaheadCoverage.length+er.backtrackCoverage.length;if(rr.context.length<tr)return[];var ir=lookupCoverageList(er.inputCoverage,rr);if(ir===-1)return[];var nr=er.inputCoverage.length-1;if(rr.lookahead.length<er.lookaheadCoverage.length)return[];for(var sr=rr.lookahead.slice(nr);sr.length&&isTashkeelArabicChar(sr[0].char);)sr.shift();var ar=new ContextParams(sr,0),or=lookupCoverageList(er.lookaheadCoverage,ar),lr=[].concat(rr.backtrack);for(lr.reverse();lr.length&&isTashkeelArabicChar(lr[0].char);)lr.shift();if(lr.length<er.backtrackCoverage.length)return[];var cr=new ContextParams(lr,0),ur=lookupCoverageList(er.backtrackCoverage,cr),dr=ir.length===er.inputCoverage.length&&or.length===er.lookaheadCoverage.length&&ur.length===er.backtrackCoverage.length,hr=[];if(dr)for(var pr=0;pr<er.lookupRecords.length;pr++)for(var gr=er.lookupRecords[pr],vr=gr.lookupListIndex,mr=this.getLookupByIndex(vr),fr=0;fr<mr.subtables.length;fr++){var _r=mr.subtables[fr],Ar=this.getLookupMethod(mr,_r),yr=this.getSubstitutionType(mr,_r);if(yr==="12")for(var wr=0;wr<ir.length;wr++){var xr=rr.get(wr),Sr=Ar(xr);Sr&&hr.push(Sr)}}return hr}function ligatureSubstitutionFormat1(rr,er){var tr=rr.current,ir=lookupCoverage(tr,er.coverage);if(ir===-1)return null;for(var nr,sr=er.ligatureSets[ir],ar=0;ar<sr.length;ar++){nr=sr[ar];for(var or=0;or<nr.components.length;or++){var lr=rr.lookahead[or],cr=nr.components[or];if(lr!==cr)break;if(or===nr.components.length-1)return nr}}return null}function decompositionSubstitutionFormat1(rr,er){var tr=lookupCoverage(rr,er.coverage);return tr===-1?null:er.sequences[tr]}FeatureQuery.prototype.getDefaultScriptFeaturesIndexes=function(){for(var rr=this.font.tables.gsub.scripts,er=0;er<rr.length;er++){var tr=rr[er];if(tr.tag==="DFLT")return tr.script.defaultLangSys.featureIndexes}return[]};FeatureQuery.prototype.getScriptFeaturesIndexes=function(rr){var er=this.font.tables;if(!er.gsub)return[];if(!rr)return this.getDefaultScriptFeaturesIndexes();for(var tr=this.font.tables.gsub.scripts,ir=0;ir<tr.length;ir++){var nr=tr[ir];if(nr.tag===rr&&nr.script.defaultLangSys)return nr.script.defaultLangSys.featureIndexes;var sr=nr.langSysRecords;if(sr)for(var ar=0;ar<sr.length;ar++){var or=sr[ar];if(or.tag===rr){var lr=or.langSys;return lr.featureIndexes}}}return this.getDefaultScriptFeaturesIndexes()};FeatureQuery.prototype.mapTagsToFeatures=function(rr,er){for(var tr={},ir=0;ir<rr.length;ir++){var nr=rr[ir].tag,sr=rr[ir].feature;tr[nr]=sr}this.features[er].tags=tr};FeatureQuery.prototype.getScriptFeatures=function(rr){var er=this.features[rr];if(this.features.hasOwnProperty(rr))return er;var tr=this.getScriptFeaturesIndexes(rr);if(!tr)return null;var ir=this.font.tables.gsub;return er=tr.map(function(nr){return ir.features[nr]}),this.features[rr]=er,this.mapTagsToFeatures(er,rr),er};FeatureQuery.prototype.getSubstitutionType=function(rr,er){var tr=rr.lookupType.toString(),ir=er.substFormat.toString();return tr+ir};FeatureQuery.prototype.getLookupMethod=function(rr,er){var tr=this,ir=this.getSubstitutionType(rr,er);switch(ir){case"11":return function(nr){return singleSubstitutionFormat1.apply(tr,[nr,er])};case"12":return function(nr){return singleSubstitutionFormat2.apply(tr,[nr,er])};case"63":return function(nr){return chainingSubstitutionFormat3.apply(tr,[nr,er])};case"41":return function(nr){return ligatureSubstitutionFormat1.apply(tr,[nr,er])};case"21":return function(nr){return decompositionSubstitutionFormat1.apply(tr,[nr,er])};default:throw new Error("lookupType: "+rr.lookupType+" - substFormat: "+er.substFormat+" is not yet supported")}};FeatureQuery.prototype.lookupFeature=function(rr){var er=rr.contextParams,tr=er.index,ir=this.getFeature({tag:rr.tag,script:rr.script});if(!ir)return new Error("font '"+this.font.names.fullName.en+"' doesn't support feature '"+rr.tag+"' for script '"+rr.script+"'.");for(var nr=this.getFeatureLookups(ir),sr=[].concat(er.context),ar=0;ar<nr.length;ar++)for(var or=nr[ar],lr=this.getLookupSubtables(or),cr=0;cr<lr.length;cr++){var ur=lr[cr],dr=this.getSubstitutionType(or,ur),hr=this.getLookupMethod(or,ur),pr=void 0;switch(dr){case"11":pr=hr(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:11,tag:rr.tag,substitution:pr}));break;case"12":pr=hr(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:12,tag:rr.tag,substitution:pr}));break;case"63":pr=hr(er),Array.isArray(pr)&&pr.length&&sr.splice(tr,1,new SubstitutionAction({id:63,tag:rr.tag,substitution:pr}));break;case"41":pr=hr(er),pr&&sr.splice(tr,1,new SubstitutionAction({id:41,tag:rr.tag,substitution:pr}));break;case"21":pr=hr(er.current),pr&&sr.splice(tr,1,new SubstitutionAction({id:21,tag:rr.tag,substitution:pr}));break}er=new ContextParams(sr,tr),!(Array.isArray(pr)&&!pr.length)&&(pr=null)}return sr.length?sr:null};FeatureQuery.prototype.supports=function(rr){if(!rr.script)return!1;this.getScriptFeatures(rr.script);var er=this.features.hasOwnProperty(rr.script);if(!rr.tag)return er;var tr=this.features[rr.script].some(function(ir){return ir.tag===rr.tag});return er&&tr};FeatureQuery.prototype.getLookupSubtables=function(rr){return rr.subtables||null};FeatureQuery.prototype.getLookupByIndex=function(rr){var er=this.font.tables.gsub.lookups;return er[rr]||null};FeatureQuery.prototype.getFeatureLookups=function(rr){return rr.lookupListIndexes.map(this.getLookupByIndex.bind(this))};FeatureQuery.prototype.getFeature=function rr(er){if(!this.font)return{FAIL:"No font was found"};this.features.hasOwnProperty(er.script)||this.getScriptFeatures(er.script);var tr=this.features[er.script];return tr?tr.tags[er.tag]?this.features[er.script].tags[er.tag]:null:{FAIL:"No feature for script "+er.script}};function arabicWordStartCheck(rr){var er=rr.current,tr=rr.get(-1);return tr===null&&isArabicChar(er)||!isArabicChar(tr)&&isArabicChar(er)}function arabicWordEndCheck(rr){var er=rr.get(1);return er===null||!isArabicChar(er)}var arabicWordCheck={startCheck:arabicWordStartCheck,endCheck:arabicWordEndCheck};function arabicSentenceStartCheck(rr){var er=rr.current,tr=rr.get(-1);return(isArabicChar(er)||isTashkeelArabicChar(er))&&!isArabicChar(tr)}function arabicSentenceEndCheck(rr){var er=rr.get(1);switch(!0){case er===null:return!0;case(!isArabicChar(er)&&!isTashkeelArabicChar(er)):var tr=isWhiteSpace(er);if(!tr)return!0;if(tr){var ir=!1;if(ir=rr.lookahead.some(function(nr){return isArabicChar(nr)||isTashkeelArabicChar(nr)}),!ir)return!0}break;default:return!1}}var arabicSentenceCheck={startCheck:arabicSentenceStartCheck,endCheck:arabicSentenceEndCheck};function singleSubstitutionFormat1$1(rr,er,tr){er[tr].setState(rr.tag,rr.substitution)}function singleSubstitutionFormat2$1(rr,er,tr){er[tr].setState(rr.tag,rr.substitution)}function chainingSubstitutionFormat3$1(rr,er,tr){rr.substitution.forEach(function(ir,nr){var sr=er[tr+nr];sr.setState(rr.tag,ir)})}function ligatureSubstitutionFormat1$1(rr,er,tr){var ir=er[tr];ir.setState(rr.tag,rr.substitution.ligGlyph);for(var nr=rr.substitution.components.length,sr=0;sr<nr;sr++)ir=er[tr+sr+1],ir.setState("deleted",!0)}var SUBSTITUTIONS={11:singleSubstitutionFormat1$1,12:singleSubstitutionFormat2$1,63:chainingSubstitutionFormat3$1,41:ligatureSubstitutionFormat1$1};function applySubstitution(rr,er,tr){rr instanceof SubstitutionAction&&SUBSTITUTIONS[rr.id]&&SUBSTITUTIONS[rr.id](rr,er,tr)}function willConnectPrev(rr){for(var er=[].concat(rr.backtrack),tr=er.length-1;tr>=0;tr--){var ir=er[tr],nr=isIsolatedArabicChar(ir),sr=isTashkeelArabicChar(ir);if(!nr&&!sr)return!0;if(nr)return!1}return!1}function willConnectNext(rr){if(isIsolatedArabicChar(rr.current))return!1;for(var er=0;er<rr.lookahead.length;er++){var tr=rr.lookahead[er],ir=isTashkeelArabicChar(tr);if(!ir)return!0}return!1}function arabicPresentationForms(rr){var er=this,tr="arab",ir=this.featuresTags[tr],nr=this.tokenizer.getRangeTokens(rr);if(nr.length!==1){var sr=new ContextParams(nr.map(function(or){return or.getState("glyphIndex")}),0),ar=new ContextParams(nr.map(function(or){return or.char}),0);nr.forEach(function(or,lr){if(!isTashkeelArabicChar(or.char)){sr.setCurrentIndex(lr),ar.setCurrentIndex(lr);var cr=0;willConnectPrev(ar)&&(cr|=1),willConnectNext(ar)&&(cr|=2);var ur;switch(cr){case 1:ur="fina";break;case 2:ur="init";break;case 3:ur="medi";break}if(ir.indexOf(ur)!==-1){var dr=er.query.lookupFeature({tag:ur,script:tr,contextParams:sr});if(dr instanceof Error)return console.info(dr.message);dr.forEach(function(hr,pr){hr instanceof SubstitutionAction&&(applySubstitution(hr,nr,pr),sr.context[pr]=hr.substitution)})}}})}}function getContextParams(rr,er){var tr=rr.map(function(ir){return ir.activeState.value});return new ContextParams(tr,er||0)}function arabicRequiredLigatures(rr){var er=this,tr="arab",ir=this.tokenizer.getRangeTokens(rr),nr=getContextParams(ir);nr.context.forEach(function(sr,ar){nr.setCurrentIndex(ar);var or=er.query.lookupFeature({tag:"rlig",script:tr,contextParams:nr});or.length&&(or.forEach(function(lr){return applySubstitution(lr,ir,ar)}),nr=getContextParams(ir))})}function latinWordStartCheck(rr){var er=rr.current,tr=rr.get(-1);return tr===null&&isLatinChar(er)||!isLatinChar(tr)&&isLatinChar(er)}function latinWordEndCheck(rr){var er=rr.get(1);return er===null||!isLatinChar(er)}var latinWordCheck={startCheck:latinWordStartCheck,endCheck:latinWordEndCheck};function getContextParams$1(rr,er){var tr=rr.map(function(ir){return ir.activeState.value});return new ContextParams(tr,er||0)}function latinLigature(rr){var er=this,tr="latn",ir=this.tokenizer.getRangeTokens(rr),nr=getContextParams$1(ir);nr.context.forEach(function(sr,ar){nr.setCurrentIndex(ar);var or=er.query.lookupFeature({tag:"liga",script:tr,contextParams:nr});or.length&&(or.forEach(function(lr){return applySubstitution(lr,ir,ar)}),nr=getContextParams$1(ir))})}function Bidi(rr){this.baseDir=rr||"ltr",this.tokenizer=new Tokenizer,this.featuresTags={}}Bidi.prototype.setText=function(rr){this.text=rr};Bidi.prototype.contextChecks={latinWordCheck,arabicWordCheck,arabicSentenceCheck};function registerContextChecker(rr){var er=this.contextChecks[rr+"Check"];return this.tokenizer.registerContextChecker(rr,er.startCheck,er.endCheck)}function tokenizeText(){return registerContextChecker.call(this,"latinWord"),registerContextChecker.call(this,"arabicWord"),registerContextChecker.call(this,"arabicSentence"),this.tokenizer.tokenize(this.text)}function reverseArabicSentences(){var rr=this,er=this.tokenizer.getContextRanges("arabicSentence");er.forEach(function(tr){var ir=rr.tokenizer.getRangeTokens(tr);rr.tokenizer.replaceRange(tr.startIndex,tr.endOffset,ir.reverse())})}Bidi.prototype.registerFeatures=function(rr,er){var tr=this,ir=er.filter(function(nr){return tr.query.supports({script:rr,tag:nr})});this.featuresTags.hasOwnProperty(rr)?this.featuresTags[rr]=this.featuresTags[rr].concat(ir):this.featuresTags[rr]=ir};Bidi.prototype.applyFeatures=function(rr,er){if(!rr)throw new Error("No valid font was provided to apply features");this.query||(this.query=new FeatureQuery(rr));for(var tr=0;tr<er.length;tr++){var ir=er[tr];this.query.supports({script:ir.script})&&this.registerFeatures(ir.script,ir.tags)}};Bidi.prototype.registerModifier=function(rr,er,tr){this.tokenizer.registerModifier(rr,er,tr)};function checkGlyphIndexStatus(){if(this.tokenizer.registeredModifiers.indexOf("glyphIndex")===-1)throw new Error("glyphIndex modifier is required to apply arabic presentation features.")}function applyArabicPresentationForms(){var rr=this,er="arab";if(this.featuresTags.hasOwnProperty(er)){checkGlyphIndexStatus.call(this);var tr=this.tokenizer.getContextRanges("arabicWord");tr.forEach(function(ir){arabicPresentationForms.call(rr,ir)})}}function applyArabicRequireLigatures(){var rr=this,er="arab";if(this.featuresTags.hasOwnProperty(er)){var tr=this.featuresTags[er];if(tr.indexOf("rlig")!==-1){checkGlyphIndexStatus.call(this);var ir=this.tokenizer.getContextRanges("arabicWord");ir.forEach(function(nr){arabicRequiredLigatures.call(rr,nr)})}}}function applyLatinLigatures(){var rr=this,er="latn";if(this.featuresTags.hasOwnProperty(er)){var tr=this.featuresTags[er];if(tr.indexOf("liga")!==-1){checkGlyphIndexStatus.call(this);var ir=this.tokenizer.getContextRanges("latinWord");ir.forEach(function(nr){latinLigature.call(rr,nr)})}}}Bidi.prototype.checkContextReady=function(rr){return!!this.tokenizer.getContext(rr)};Bidi.prototype.applyFeaturesToContexts=function(){this.checkContextReady("arabicWord")&&(applyArabicPresentationForms.call(this),applyArabicRequireLigatures.call(this)),this.checkContextReady("latinWord")&&applyLatinLigatures.call(this),this.checkContextReady("arabicSentence")&&reverseArabicSentences.call(this)};Bidi.prototype.processText=function(rr){(!this.text||this.text!==rr)&&(this.setText(rr),tokenizeText.call(this),this.applyFeaturesToContexts())};Bidi.prototype.getBidiText=function(rr){return this.processText(rr),this.tokenizer.getText()};Bidi.prototype.getTextGlyphs=function(rr){this.processText(rr);for(var er=[],tr=0;tr<this.tokenizer.tokens.length;tr++){var ir=this.tokenizer.tokens[tr];if(!ir.state.deleted){var nr=ir.activeState.value;er.push(Array.isArray(nr)?nr[0]:nr)}}return er};function Font(rr){rr=rr||{},rr.tables=rr.tables||{},rr.empty||(checkArgument(rr.familyName,"When creating a new Font object, familyName is required."),checkArgument(rr.styleName,"When creating a new Font object, styleName is required."),checkArgument(rr.unitsPerEm,"When creating a new Font object, unitsPerEm is required."),checkArgument(rr.ascender,"When creating a new Font object, ascender is required."),checkArgument(rr.descender<=0,"When creating a new Font object, negative descender value is required."),this.names={fontFamily:{en:rr.familyName||" "},fontSubfamily:{en:rr.styleName||" "},fullName:{en:rr.fullName||rr.familyName+" "+rr.styleName},postScriptName:{en:rr.postScriptName||(rr.familyName+rr.styleName).replace(/\s/g,"")},designer:{en:rr.designer||" "},designerURL:{en:rr.designerURL||" "},manufacturer:{en:rr.manufacturer||" "},manufacturerURL:{en:rr.manufacturerURL||" "},license:{en:rr.license||" "},licenseURL:{en:rr.licenseURL||" "},version:{en:rr.version||"Version 0.1"},description:{en:rr.description||" "},copyright:{en:rr.copyright||" "},trademark:{en:rr.trademark||" "}},this.unitsPerEm=rr.unitsPerEm||1e3,this.ascender=rr.ascender,this.descender=rr.descender,this.createdTimestamp=rr.createdTimestamp,this.tables=Object.assign(rr.tables,{os2:Object.assign({usWeightClass:rr.weightClass||this.usWeightClasses.MEDIUM,usWidthClass:rr.widthClass||this.usWidthClasses.MEDIUM,fsSelection:rr.fsSelection||this.fsSelectionValues.REGULAR},rr.tables.os2)})),this.supported=!0,this.glyphs=new glyphset.GlyphSet(this,rr.glyphs||[]),this.encoding=new DefaultEncoding(this),this.position=new Position(this),this.substitution=new Substitution(this),this.tables=this.tables||{},this._push=null,this._hmtxTableData={},Object.defineProperty(this,"hinting",{get:function(){if(this._hinting)return this._hinting;if(this.outlinesFormat==="truetype")return this._hinting=new Hinting(this)}})}Font.prototype.hasChar=function(rr){return this.encoding.charToGlyphIndex(rr)!==null};Font.prototype.charToGlyphIndex=function(rr){return this.encoding.charToGlyphIndex(rr)};Font.prototype.charToGlyph=function(rr){var er=this.charToGlyphIndex(rr),tr=this.glyphs.get(er);return tr||(tr=this.glyphs.get(0)),tr};Font.prototype.updateFeatures=function(rr){return this.defaultRenderOptions.features.map(function(er){return er.script==="latn"?{script:"latn",tags:er.tags.filter(function(tr){return rr[tr]})}:er})};Font.prototype.stringToGlyphs=function(rr,er){var tr=this,ir=new Bidi,nr=function(dr){return tr.charToGlyphIndex(dr.char)};ir.registerModifier("glyphIndex",null,nr);var sr=er?this.updateFeatures(er.features):this.defaultRenderOptions.features;ir.applyFeatures(this,sr);for(var ar=ir.getTextGlyphs(rr),or=ar.length,lr=new Array(or),cr=this.glyphs.get(0),ur=0;ur<or;ur+=1)lr[ur]=this.glyphs.get(ar[ur])||cr;return lr};Font.prototype.nameToGlyphIndex=function(rr){return this.glyphNames.nameToGlyphIndex(rr)};Font.prototype.nameToGlyph=function(rr){var er=this.nameToGlyphIndex(rr),tr=this.glyphs.get(er);return tr||(tr=this.glyphs.get(0)),tr};Font.prototype.glyphIndexToName=function(rr){return this.glyphNames.glyphIndexToName?this.glyphNames.glyphIndexToName(rr):""};Font.prototype.getKerningValue=function(rr,er){rr=rr.index||rr,er=er.index||er;var tr=this.position.defaultKerningTables;return tr?this.position.getKerningValue(tr,rr,er):this.kerningPairs[rr+","+er]||0};Font.prototype.defaultRenderOptions={kerning:!0,features:[{script:"arab",tags:["init","medi","fina","rlig"]},{script:"latn",tags:["liga","rlig"]}]};Font.prototype.forEachGlyph=function(rr,er,tr,ir,nr,sr){er=er!==void 0?er:0,tr=tr!==void 0?tr:0,ir=ir!==void 0?ir:72,nr=Object.assign({},this.defaultRenderOptions,nr);var ar=1/this.unitsPerEm*ir,or=this.stringToGlyphs(rr,nr),lr;if(nr.kerning){var cr=nr.script||this.position.getDefaultScriptName();lr=this.position.getKerningTables(cr,nr.language)}for(var ur=0;ur<or.length;ur+=1){var dr=or[ur];if(sr.call(this,dr,er,tr,ir,nr),dr.advanceWidth&&(er+=dr.advanceWidth*ar),nr.kerning&&ur<or.length-1){var hr=lr?this.position.getKerningValue(lr,dr.index,or[ur+1].index):this.getKerningValue(dr,or[ur+1]);er+=hr*ar}nr.letterSpacing?er+=nr.letterSpacing*ir:nr.tracking&&(er+=nr.tracking/1e3*ir)}return er};Font.prototype.getPath=function(rr,er,tr,ir,nr){var sr=new Path;return this.forEachGlyph(rr,er,tr,ir,nr,function(ar,or,lr,cr){var ur=ar.getPath(or,lr,cr,nr,this);sr.extend(ur)}),sr};Font.prototype.getPaths=function(rr,er,tr,ir,nr){var sr=[];return this.forEachGlyph(rr,er,tr,ir,nr,function(ar,or,lr,cr){var ur=ar.getPath(or,lr,cr,nr,this);sr.push(ur)}),sr};Font.prototype.getAdvanceWidth=function(rr,er,tr){return this.forEachGlyph(rr,0,0,er,tr,function(){})};Font.prototype.draw=function(rr,er,tr,ir,nr,sr){this.getPath(er,tr,ir,nr,sr).draw(rr)};Font.prototype.drawPoints=function(rr,er,tr,ir,nr,sr){this.forEachGlyph(er,tr,ir,nr,sr,function(ar,or,lr,cr){ar.drawPoints(rr,or,lr,cr)})};Font.prototype.drawMetrics=function(rr,er,tr,ir,nr,sr){this.forEachGlyph(er,tr,ir,nr,sr,function(ar,or,lr,cr){ar.drawMetrics(rr,or,lr,cr)})};Font.prototype.getEnglishName=function(rr){var er=this.names[rr];if(er)return er.en};Font.prototype.validate=function(){var rr=this;function er(ir,nr){}function tr(ir){var nr=rr.getEnglishName(ir);nr&&nr.trim().length>0}tr("fontFamily"),tr("weightName"),tr("manufacturer"),tr("copyright"),tr("version"),this.unitsPerEm>0};Font.prototype.toTables=function(){return sfnt.fontToTable(this)};Font.prototype.toBuffer=function(){return console.warn("Font.toBuffer is deprecated. Use Font.toArrayBuffer instead."),this.toArrayBuffer()};Font.prototype.toArrayBuffer=function(){for(var rr=this.toTables(),er=rr.encode(),tr=new ArrayBuffer(er.length),ir=new Uint8Array(tr),nr=0;nr<er.length;nr++)ir[nr]=er[nr];return tr};Font.prototype.download=function(rr){var er=this.getEnglishName("fontFamily"),tr=this.getEnglishName("fontSubfamily");rr=rr||er.replace(/\s/g,"")+"-"+tr+".otf";var ir=this.toArrayBuffer();if(window.URL=window.URL||window.webkitURL,window.URL){var nr=new DataView(ir),sr=new Blob([nr],{type:"font/opentype"}),ar=document.createElement("a");ar.href=window.URL.createObjectURL(sr),ar.download=rr;var or=document.createEvent("MouseEvents");or.initEvent("click",!0,!1),ar.dispatchEvent(or)}else console.warn("Font file could not be downloaded. Try using a different browser.")};Font.prototype.fsSelectionValues={ITALIC:1,UNDERSCORE:2,NEGATIVE:4,OUTLINED:8,STRIKEOUT:16,BOLD:32,REGULAR:64,USER_TYPO_METRICS:128,WWS:256,OBLIQUE:512};Font.prototype.usWidthClasses={ULTRA_CONDENSED:1,EXTRA_CONDENSED:2,CONDENSED:3,SEMI_CONDENSED:4,MEDIUM:5,SEMI_EXPANDED:6,EXPANDED:7,EXTRA_EXPANDED:8,ULTRA_EXPANDED:9};Font.prototype.usWeightClasses={THIN:100,EXTRA_LIGHT:200,LIGHT:300,NORMAL:400,MEDIUM:500,SEMI_BOLD:600,BOLD:700,EXTRA_BOLD:800,BLACK:900};function addName(rr,er){var tr=JSON.stringify(rr),ir=256;for(var nr in er){var sr=parseInt(nr);if(!(!sr||sr<256)){if(JSON.stringify(er[nr])===tr)return sr;ir<=sr&&(ir=sr+1)}}return er[ir]=rr,ir}function makeFvarAxis(rr,er,tr){var ir=addName(er.name,tr);return[{name:"tag_"+rr,type:"TAG",value:er.tag},{name:"minValue_"+rr,type:"FIXED",value:er.minValue<<16},{name:"defaultValue_"+rr,type:"FIXED",value:er.defaultValue<<16},{name:"maxValue_"+rr,type:"FIXED",value:er.maxValue<<16},{name:"flags_"+rr,type:"USHORT",value:0},{name:"nameID_"+rr,type:"USHORT",value:ir}]}function parseFvarAxis(rr,er,tr){var ir={},nr=new parse.Parser(rr,er);return ir.tag=nr.parseTag(),ir.minValue=nr.parseFixed(),ir.defaultValue=nr.parseFixed(),ir.maxValue=nr.parseFixed(),nr.skip("uShort",1),ir.name=tr[nr.parseUShort()]||{},ir}function makeFvarInstance(rr,er,tr,ir){for(var nr=addName(er.name,ir),sr=[{name:"nameID_"+rr,type:"USHORT",value:nr},{name:"flags_"+rr,type:"USHORT",value:0}],ar=0;ar<tr.length;++ar){var or=tr[ar].tag;sr.push({name:"axis_"+rr+" "+or,type:"FIXED",value:er.coordinates[or]<<16})}return sr}function parseFvarInstance(rr,er,tr,ir){var nr={},sr=new parse.Parser(rr,er);nr.name=ir[sr.parseUShort()]||{},sr.skip("uShort",1),nr.coordinates={};for(var ar=0;ar<tr.length;++ar)nr.coordinates[tr[ar].tag]=sr.parseFixed();return nr}function makeFvarTable(rr,er){var tr=new table.Table("fvar",[{name:"version",type:"ULONG",value:65536},{name:"offsetToData",type:"USHORT",value:0},{name:"countSizePairs",type:"USHORT",value:2},{name:"axisCount",type:"USHORT",value:rr.axes.length},{name:"axisSize",type:"USHORT",value:20},{name:"instanceCount",type:"USHORT",value:rr.instances.length},{name:"instanceSize",type:"USHORT",value:4+rr.axes.length*4}]);tr.offsetToData=tr.sizeOf();for(var ir=0;ir<rr.axes.length;ir++)tr.fields=tr.fields.concat(makeFvarAxis(ir,rr.axes[ir],er));for(var nr=0;nr<rr.instances.length;nr++)tr.fields=tr.fields.concat(makeFvarInstance(nr,rr.instances[nr],rr.axes,er));return tr}function parseFvarTable(rr,er,tr){var ir=new parse.Parser(rr,er),nr=ir.parseULong();check.argument(nr===65536,"Unsupported fvar table version.");var sr=ir.parseOffset16();ir.skip("uShort",1);for(var ar=ir.parseUShort(),or=ir.parseUShort(),lr=ir.parseUShort(),cr=ir.parseUShort(),ur=[],dr=0;dr<ar;dr++)ur.push(parseFvarAxis(rr,er+sr+dr*or,tr));for(var hr=[],pr=er+sr+ar*or,gr=0;gr<lr;gr++)hr.push(parseFvarInstance(rr,pr+gr*cr,ur,tr));return{axes:ur,instances:hr}}var fvar={make:makeFvarTable,parse:parseFvarTable},attachList=function(){return{coverage:this.parsePointer(Parser.coverage),attachPoints:this.parseList(Parser.pointer(Parser.uShortList))}},caretValue=function(){var rr=this.parseUShort();if(check.argument(rr===1||rr===2||rr===3,"Unsupported CaretValue table version."),rr===1)return{coordinate:this.parseShort()};if(rr===2)return{pointindex:this.parseShort()};if(rr===3)return{coordinate:this.parseShort()}},ligGlyph=function(){return this.parseList(Parser.pointer(caretValue))},ligCaretList=function(){return{coverage:this.parsePointer(Parser.coverage),ligGlyphs:this.parseList(Parser.pointer(ligGlyph))}},markGlyphSets=function(){return this.parseUShort(),this.parseList(Parser.pointer(Parser.coverage))};function parseGDEFTable(rr,er){er=er||0;var tr=new Parser(rr,er),ir=tr.parseVersion(1);check.argument(ir===1||ir===1.2||ir===1.3,"Unsupported GDEF table version.");var nr={version:ir,classDef:tr.parsePointer(Parser.classDef),attachList:tr.parsePointer(attachList),ligCaretList:tr.parsePointer(ligCaretList),markAttachClassDef:tr.parsePointer(Parser.classDef)};return ir>=1.2&&(nr.markGlyphSets=tr.parsePointer(markGlyphSets)),nr}var gdef={parse:parseGDEFTable},subtableParsers$1=new Array(10);subtableParsers$1[1]=function rr(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();if(tr===1)return{posFormat:1,coverage:this.parsePointer(Parser.coverage),value:this.parseValueRecord()};if(tr===2)return{posFormat:2,coverage:this.parsePointer(Parser.coverage),values:this.parseValueRecordList()};check.assert(!1,"0x"+er.toString(16)+": GPOS lookup type 1 format must be 1 or 2.")};subtableParsers$1[2]=function rr(){var er=this.offset+this.relativeOffset,tr=this.parseUShort();check.assert(tr===1||tr===2,"0x"+er.toString(16)+": GPOS lookup type 2 format must be 1 or 2.");var ir=this.parsePointer(Parser.coverage),nr=this.parseUShort(),sr=this.parseUShort();if(tr===1)return{posFormat:tr,coverage:ir,valueFormat1:nr,valueFormat2:sr,pairSets:this.parseList(Parser.pointer(Parser.list(function(){return{secondGlyph:this.parseUShort(),value1:this.parseValueRecord(nr),value2:this.parseValueRecord(sr)}})))};if(tr===2){var ar=this.parsePointer(Parser.classDef),or=this.parsePointer(Parser.classDef),lr=this.parseUShort(),cr=this.parseUShort();return{posFormat:tr,coverage:ir,valueFormat1:nr,valueFormat2:sr,classDef1:ar,classDef2:or,class1Count:lr,class2Count:cr,classRecords:this.parseList(lr,Parser.list(cr,function(){return{value1:this.parseValueRecord(nr),value2:this.parseValueRecord(sr)}}))}}};subtableParsers$1[3]=function rr(){return{error:"GPOS Lookup 3 not supported"}};subtableParsers$1[4]=function rr(){return{error:"GPOS Lookup 4 not supported"}};subtableParsers$1[5]=function rr(){return{error:"GPOS Lookup 5 not supported"}};subtableParsers$1[6]=function rr(){return{error:"GPOS Lookup 6 not supported"}};subtableParsers$1[7]=function rr(){return{error:"GPOS Lookup 7 not supported"}};subtableParsers$1[8]=function rr(){return{error:"GPOS Lookup 8 not supported"}};subtableParsers$1[9]=function rr(){return{error:"GPOS Lookup 9 not supported"}};function parseGposTable(rr,er){er=er||0;var tr=new Parser(rr,er),ir=tr.parseVersion(1);return check.argument(ir===1||ir===1.1,"Unsupported GPOS table version "+ir),ir===1?{version:ir,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers$1)}:{version:ir,scripts:tr.parseScriptList(),features:tr.parseFeatureList(),lookups:tr.parseLookupList(subtableParsers$1),variations:tr.parseFeatureVariationsList()}}var subtableMakers$1=new Array(10);function makeGposTable(rr){return new table.Table("GPOS",[{name:"version",type:"ULONG",value:65536},{name:"scripts",type:"TABLE",value:new table.ScriptList(rr.scripts)},{name:"features",type:"TABLE",value:new table.FeatureList(rr.features)},{name:"lookups",type:"TABLE",value:new table.LookupList(rr.lookups,subtableMakers$1)}])}var gpos={parse:parseGposTable,make:makeGposTable};function parseWindowsKernTable(rr){var er={};rr.skip("uShort");var tr=rr.parseUShort();check.argument(tr===0,"Unsupported kern sub-table version."),rr.skip("uShort",2);var ir=rr.parseUShort();rr.skip("uShort",3);for(var nr=0;nr<ir;nr+=1){var sr=rr.parseUShort(),ar=rr.parseUShort(),or=rr.parseShort();er[sr+","+ar]=or}return er}function parseMacKernTable(rr){var er={};rr.skip("uShort");var tr=rr.parseULong();tr>1&&console.warn("Only the first kern subtable is supported."),rr.skip("uLong");var ir=rr.parseUShort(),nr=ir&255;if(rr.skip("uShort"),nr===0){var sr=rr.parseUShort();rr.skip("uShort",3);for(var ar=0;ar<sr;ar+=1){var or=rr.parseUShort(),lr=rr.parseUShort(),cr=rr.parseShort();er[or+","+lr]=cr}}return er}function parseKernTable(rr,er){var tr=new parse.Parser(rr,er),ir=tr.parseUShort();if(ir===0)return parseWindowsKernTable(tr);if(ir===1)return parseMacKernTable(tr);throw new Error("Unsupported kern table version ("+ir+").")}var kern={parse:parseKernTable};function parseLocaTable(rr,er,tr,ir){for(var nr=new parse.Parser(rr,er),sr=ir?nr.parseUShort:nr.parseULong,ar=[],or=0;or<tr+1;or+=1){var lr=sr.call(nr);ir&&(lr*=2),ar.push(lr)}return ar}var loca={parse:parseLocaTable};function loadFromUrl(rr,er){var tr=new XMLHttpRequest;tr.open("get",rr,!0),tr.responseType="arraybuffer",tr.onload=function(){return tr.response?er(null,tr.response):er("Font could not be loaded: "+tr.statusText)},tr.onerror=function(){er("Font could not be loaded")},tr.send()}function parseOpenTypeTableEntries(rr,er){for(var tr=[],ir=12,nr=0;nr<er;nr+=1){var sr=parse.getTag(rr,ir),ar=parse.getULong(rr,ir+4),or=parse.getULong(rr,ir+8),lr=parse.getULong(rr,ir+12);tr.push({tag:sr,checksum:ar,offset:or,length:lr,compression:!1}),ir+=16}return tr}function parseWOFFTableEntries(rr,er){for(var tr=[],ir=44,nr=0;nr<er;nr+=1){var sr=parse.getTag(rr,ir),ar=parse.getULong(rr,ir+4),or=parse.getULong(rr,ir+8),lr=parse.getULong(rr,ir+12),cr=void 0;or<lr?cr="WOFF":cr=!1,tr.push({tag:sr,offset:ar,compression:cr,compressedLength:or,length:lr}),ir+=20}return tr}function uncompressTable(rr,er){if(er.compression==="WOFF"){var tr=new Uint8Array(rr.buffer,er.offset+2,er.compressedLength-2),ir=new Uint8Array(er.length);if(tinyInflate(tr,ir),ir.byteLength!==er.length)throw new Error("Decompression error: "+er.tag+" decompressed length doesn't match recorded length");var nr=new DataView(ir.buffer,0);return{data:nr,offset:0}}else return{data:rr,offset:er.offset}}function parseBuffer(rr,er){er=er??{};var tr,ir,nr=new Font({empty:!0}),sr=new DataView(rr,0),ar,or=[],lr=parse.getTag(sr,0);if(lr==="\0\0\0"||lr==="true"||lr==="typ1")nr.outlinesFormat="truetype",ar=parse.getUShort(sr,4),or=parseOpenTypeTableEntries(sr,ar);else if(lr==="OTTO")nr.outlinesFormat="cff",ar=parse.getUShort(sr,4),or=parseOpenTypeTableEntries(sr,ar);else if(lr==="wOFF"){var cr=parse.getTag(sr,4);if(cr==="\0\0\0")nr.outlinesFormat="truetype";else if(cr==="OTTO")nr.outlinesFormat="cff";else throw new Error("Unsupported OpenType flavor "+lr);ar=parse.getUShort(sr,12),or=parseWOFFTableEntries(sr,ar)}else throw new Error("Unsupported OpenType signature "+lr);for(var ur,dr,hr,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr=0;xr<ar;xr+=1){var Sr=or[xr],br=void 0;switch(Sr.tag){case"cmap":br=uncompressTable(sr,Sr),nr.tables.cmap=cmap.parse(br.data,br.offset),nr.encoding=new CmapEncoding(nr.tables.cmap);break;case"cvt ":br=uncompressTable(sr,Sr),wr=new parse.Parser(br.data,br.offset),nr.tables.cvt=wr.parseShortList(Sr.length/2);break;case"fvar":dr=Sr;break;case"fpgm":br=uncompressTable(sr,Sr),wr=new parse.Parser(br.data,br.offset),nr.tables.fpgm=wr.parseByteList(Sr.length);break;case"head":br=uncompressTable(sr,Sr),nr.tables.head=head.parse(br.data,br.offset),nr.unitsPerEm=nr.tables.head.unitsPerEm,tr=nr.tables.head.indexToLocFormat;break;case"hhea":br=uncompressTable(sr,Sr),nr.tables.hhea=hhea.parse(br.data,br.offset),nr.ascender=nr.tables.hhea.ascender,nr.descender=nr.tables.hhea.descender,nr.numberOfHMetrics=nr.tables.hhea.numberOfHMetrics;break;case"hmtx":mr=Sr;break;case"ltag":br=uncompressTable(sr,Sr),ir=ltag.parse(br.data,br.offset);break;case"COLR":br=uncompressTable(sr,Sr),nr.tables.colr=colr.parse(br.data,br.offset);break;case"CPAL":br=uncompressTable(sr,Sr),nr.tables.cpal=cpal.parse(br.data,br.offset);break;case"maxp":br=uncompressTable(sr,Sr),nr.tables.maxp=maxp.parse(br.data,br.offset),nr.numGlyphs=nr.tables.maxp.numGlyphs;break;case"name":Ar=Sr;break;case"OS/2":br=uncompressTable(sr,Sr),nr.tables.os2=os2.parse(br.data,br.offset);break;case"post":br=uncompressTable(sr,Sr),nr.tables.post=post.parse(br.data,br.offset),nr.glyphNames=new GlyphNames(nr.tables.post);break;case"prep":br=uncompressTable(sr,Sr),wr=new parse.Parser(br.data,br.offset),nr.tables.prep=wr.parseByteList(Sr.length);break;case"glyf":hr=Sr;break;case"loca":_r=Sr;break;case"CFF ":ur=Sr;break;case"kern":fr=Sr;break;case"GDEF":pr=Sr;break;case"GPOS":gr=Sr;break;case"GSUB":vr=Sr;break;case"meta":yr=Sr;break}}var Cr=uncompressTable(sr,Ar);if(nr.tables.name=_name.parse(Cr.data,Cr.offset,ir),nr.names=nr.tables.name,hr&&_r){var Ir=tr===0,Rr=uncompressTable(sr,_r),Pr=loca.parse(Rr.data,Rr.offset,nr.numGlyphs,Ir),Dr=uncompressTable(sr,hr);nr.glyphs=glyf.parse(Dr.data,Dr.offset,Pr,nr,er)}else if(ur){var Fr=uncompressTable(sr,ur);cff.parse(Fr.data,Fr.offset,nr,er)}else throw new Error("Font doesn't contain TrueType or CFF outlines.");var Or=uncompressTable(sr,mr);if(hmtx.parse(nr,Or.data,Or.offset,nr.numberOfHMetrics,nr.numGlyphs,nr.glyphs,er),addGlyphNames(nr,er),fr){var Nr=uncompressTable(sr,fr);nr.kerningPairs=kern.parse(Nr.data,Nr.offset)}else nr.kerningPairs={};if(pr){var Ur=uncompressTable(sr,pr);nr.tables.gdef=gdef.parse(Ur.data,Ur.offset)}if(gr){var Br=uncompressTable(sr,gr);nr.tables.gpos=gpos.parse(Br.data,Br.offset),nr.position.init()}if(vr){var Wr=uncompressTable(sr,vr);nr.tables.gsub=gsub.parse(Wr.data,Wr.offset)}if(dr){var Xr=uncompressTable(sr,dr);nr.tables.fvar=fvar.parse(Xr.data,Xr.offset,nr.names)}if(yr){var Yr=uncompressTable(sr,yr);nr.tables.meta=meta.parse(Yr.data,Yr.offset),nr.metas=nr.tables.meta}return nr}function load(rr,er,tr){return tr=tr??{},new Promise(function(ir,nr){loadFromUrl(rr,function(sr,ar){if(sr){if(er)return er(sr);nr(sr)}var or;try{or=parseBuffer(ar,tr)}catch(lr){if(er)return er(lr,null);nr(lr)}if(er)return er(null,or);ir(or)})})}var opentype=Object.freeze({__proto__:null,Font,Glyph,Path,BoundingBox,_parse:parse,parse:parseBuffer,load});class TTFLoader extends Loader{constructor(er){super(er),this.reversed=!1}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(nr,sr){const ar=Math.round,or={},lr=1e5/((nr.unitsPerEm||2048)*72),cr=nr.encoding.cmap.glyphIndexMap,ur=Object.keys(cr);for(let dr=0;dr<ur.length;dr++){const hr=ur[dr],pr=nr.glyphs.glyphs[cr[hr]];if(hr!==void 0){const gr={ha:ar(pr.advanceWidth*lr),x_min:ar(pr.xMin*lr),x_max:ar(pr.xMax*lr),o:""};sr&&(pr.path.commands=ir(pr.path.commands)),pr.path.commands.forEach(function(vr){vr.type.toLowerCase()==="c"&&(vr.type="b"),gr.o+=vr.type.toLowerCase()+" ",vr.x!==void 0&&vr.y!==void 0&&(gr.o+=ar(vr.x*lr)+" "+ar(vr.y*lr)+" "),vr.x1!==void 0&&vr.y1!==void 0&&(gr.o+=ar(vr.x1*lr)+" "+ar(vr.y1*lr)+" "),vr.x2!==void 0&&vr.y2!==void 0&&(gr.o+=ar(vr.x2*lr)+" "+ar(vr.y2*lr)+" ")}),or[String.fromCodePoint(pr.unicode)]=gr}}return{glyphs:or,familyName:nr.getEnglishName("fullName"),ascender:ar(nr.ascender*lr),descender:ar(nr.descender*lr),underlinePosition:nr.tables.post.underlinePosition,underlineThickness:nr.tables.post.underlineThickness,boundingBox:{xMin:nr.tables.head.xMin,xMax:nr.tables.head.xMax,yMin:nr.tables.head.yMin,yMax:nr.tables.head.yMax},resolution:1e3,original_font_information:nr.tables.name}}function ir(nr){const sr=[];let ar;nr.forEach(function(lr){lr.type.toLowerCase()==="m"?(ar=[lr],sr.push(ar)):lr.type.toLowerCase()!=="z"&&ar.push(lr)});const or=[];return sr.forEach(function(lr){const cr={type:"m",x:lr[lr.length-1].x,y:lr[lr.length-1].y};or.push(cr);for(let ur=lr.length-1;ur>0;ur--){const dr=lr[ur],hr={type:dr.type};dr.x2!==void 0&&dr.y2!==void 0?(hr.x1=dr.x2,hr.y1=dr.y2,hr.x2=dr.x1,hr.y2=dr.y1):dr.x1!==void 0&&dr.y1!==void 0&&(hr.x1=dr.x1,hr.y1=dr.y1),hr.x=lr[ur-1].x,hr.y=lr[ur-1].y,or.push(hr)}}),or}return tr(opentype.parse(er),this.reversed)}}class USDAParser{parse(er){const tr={},ir=er.split(`
`);let nr=null,sr=tr;const ar=[tr];for(const or of ir)if(or.includes("=")){const lr=or.split("="),cr=lr[0].trim(),ur=lr[1].trim();if(ur.endsWith("{")){const dr={};ar.push(dr),sr[cr]=dr,sr=dr}else if(ur.endsWith("(")){const dr=ur.slice(0,-1);sr[cr]=dr;const hr={};ar.push(hr),sr=hr}else sr[cr]=ur}else if(or.endsWith("{")){const lr=sr[nr]||{};ar.push(lr),sr[nr]=lr,sr=lr}else if(or.endsWith("}")){if(ar.pop(),ar.length===0)continue;sr=ar[ar.length-1]}else if(or.endsWith("(")){const lr={};ar.push(lr),nr=or.split("(")[0].trim()||nr,sr[nr]=lr,sr=lr}else or.endsWith(")")?(ar.pop(),sr=ar[ar.length-1]):nr=or.trim();return tr}}class USDZLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=new USDAParser;function ir(Cr){const Ir={};new FileLoader().setResponseType("arraybuffer");for(const Pr in Cr){if(Pr.endsWith("png")){const Dr=new Blob([Cr[Pr]],{type:{type:"image/png"}});Ir[Pr]=URL.createObjectURL(Dr)}if(Pr.endsWith("usd")||Pr.endsWith("usda")){if(nr(Cr[Pr]))throw Error("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.");const Dr=strFromU8(Cr[Pr]);Ir[Pr]=tr.parse(Dr)}}return Ir}function nr(Cr){const Ir=Cr.slice(0,7),Rr=new Uint8Array([80,88,82,45,85,83,68,67]);return Ir.every((Pr,Dr)=>Pr===Rr[Dr])}function sr(Cr){if(Cr.length<1)return;const Ir=Object.keys(Cr)[0];let Rr=!1;if(Ir.endsWith("usda"))return Cr[Ir];if(Ir.endsWith("usdc"))Rr=!0;else if(Ir.endsWith("usd"))if(nr(Cr[Ir]))Rr=!0;else return Cr[Ir];if(Rr)throw Error("THREE.USDZLoader: Crate files (.usdc or binary .usd) are not supported.")}const ar=unzipSync(new Uint8Array(er)),or=ir(ar),lr=sr(ar),cr=strFromU8(lr),ur=tr.parse(cr);function dr(Cr){if(Cr){if("prepend references"in Cr){const Rr=Cr["prepend references"].split("@"),Pr=Rr[1].replace(/^.\//,""),Dr=Rr[2].replace(/^<\//,"").replace(/>$/,"");return hr(or[Pr],Dr)}return hr(Cr)}}function hr(Cr,Ir){if(Cr){if(Ir!==void 0){const Rr=`def Mesh "${Ir}"`;if(Rr in Cr)return Cr[Rr]}for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith("def Mesh"))return Pr;if(typeof Pr=="object"){const Dr=hr(Pr);if(Dr)return Dr}}}}function pr(Cr){if(!Cr)return;const Ir=new BufferGeometry;let Rr=null,Pr=null,Dr=null,Fr=-1;if("int[] faceVertexIndices"in Cr&&(Rr=JSON.parse(Cr["int[] faceVertexIndices"])),"int[] faceVertexCounts"in Cr&&(Pr=JSON.parse(Cr["int[] faceVertexCounts"]),Rr=gr(Rr,Pr)),"point3f[] points"in Cr){const Or=JSON.parse(Cr["point3f[] points"].replace(/[()]*/g,""));Fr=Or.length;let Nr=new BufferAttribute(new Float32Array(Or),3);Rr!==null&&(Nr=vr(Nr,Rr)),Ir.setAttribute("position",Nr)}if("float2[] primvars:st"in Cr&&(Cr["texCoord2f[] primvars:st"]=Cr["float2[] primvars:st"]),"texCoord2f[] primvars:st"in Cr){Dr=JSON.parse(Cr["texCoord2f[] primvars:st"].replace(/[()]*/g,""));let Or=new BufferAttribute(new Float32Array(Dr),2);Rr!==null&&(Or=vr(Or,Rr)),Ir.setAttribute("uv",Or)}if("int[] primvars:st:indices"in Cr&&Dr!==null){const Or=new BufferAttribute(new Float32Array(Dr),2);let Nr=JSON.parse(Cr["int[] primvars:st:indices"]);Nr=gr(Nr,Pr),Ir.setAttribute("uv",vr(Or,Nr))}if("normal3f[] normals"in Cr){const Or=JSON.parse(Cr["normal3f[] normals"].replace(/[()]*/g,""));let Nr=new BufferAttribute(new Float32Array(Or),3);if(Or.length===Fr)Rr!==null&&(Nr=vr(Nr,Rr));else{let Ur=Array.from(Array(Or.length/3).keys());Ur=gr(Ur,Pr),Nr=vr(Nr,Ur)}Ir.setAttribute("normal",Nr)}else Ir.computeVertexNormals();return Ir}function gr(Cr,Ir){const Rr=[];for(let Pr=0;Pr<Ir.length;Pr++){const Dr=Ir[Pr],Fr=Pr*Dr;if(Dr===3){const Or=Cr[Fr+0],Nr=Cr[Fr+1],Ur=Cr[Fr+2];Rr.push(Or,Nr,Ur)}else if(Dr===4){const Or=Cr[Fr+0],Nr=Cr[Fr+1],Ur=Cr[Fr+2],Br=Cr[Fr+3];Rr.push(Or,Nr,Ur),Rr.push(Or,Ur,Br)}else console.warn("THREE.USDZLoader: Face vertex count of %s unsupported.",Dr)}return Rr}function vr(Cr,Ir){const Rr=Cr.array,Pr=Cr.itemSize,Dr=new Rr.constructor(Ir.length*Pr);let Fr=0,Or=0;for(let Nr=0,Ur=Ir.length;Nr<Ur;Nr++){Fr=Ir[Nr]*Pr;for(let Br=0;Br<Pr;Br++)Dr[Or++]=Rr[Fr++]}return new BufferAttribute(Dr,Pr)}function mr(Cr){if(Cr){if("rel material:binding"in Cr){const Pr=Cr["rel material:binding"].replace(/^<\//,"").replace(/>$/,"").split("/");return fr(ur,` "${Pr[1]}"`)}return fr(Cr)}}function fr(Cr,Ir=""){for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith("def Material"+Ir))return Pr;if(typeof Pr=="object"){const Dr=fr(Pr,Ir);if(Dr)return Dr}}}function _r(Cr,Ir){Ir["float inputs:rotation"]&&(Cr.rotation=parseFloat(Ir["float inputs:rotation"])),Ir["float2 inputs:scale"]&&(Cr.repeat=new Vector2().fromArray(JSON.parse("["+Ir["float2 inputs:scale"].replace(/[()]*/g,"")+"]"))),Ir["float2 inputs:translation"]&&(Cr.offset=new Vector2().fromArray(JSON.parse("["+Ir["float2 inputs:translation"].replace(/[()]*/g,"")+"]")))}function Ar(Cr){const Ir=new MeshPhysicalMaterial;if(Cr!==void 0){const Rr=Cr["token outputs:surface.connect"],Pr=/(\w+).output/.exec(Rr)[1],Dr=Cr[`def Shader "${Pr}"`];if(Dr!==void 0){if("color3f inputs:diffuseColor.connect"in Dr){const Fr=Dr["color3f inputs:diffuseColor.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.map=wr(Or),Ir.map.colorSpace=SRGBColorSpace,'def Shader "Transform2d_diffuse"'in Cr&&_r(Ir.map,Cr['def Shader "Transform2d_diffuse"'])}else if("color3f inputs:diffuseColor"in Dr){const Fr=Dr["color3f inputs:diffuseColor"].replace(/[()]*/g,"");Ir.color.fromArray(JSON.parse("["+Fr+"]"))}if("color3f inputs:emissiveColor.connect"in Dr){const Fr=Dr["color3f inputs:emissiveColor.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.emissiveMap=wr(Or),Ir.emissiveMap.colorSpace=SRGBColorSpace,Ir.emissive.set(16777215),'def Shader "Transform2d_emissive"'in Cr&&_r(Ir.emissiveMap,Cr['def Shader "Transform2d_emissive"'])}else if("color3f inputs:emissiveColor"in Dr){const Fr=Dr["color3f inputs:emissiveColor"].replace(/[()]*/g,"");Ir.emissive.fromArray(JSON.parse("["+Fr+"]"))}if("normal3f inputs:normal.connect"in Dr){const Fr=Dr["normal3f inputs:normal.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.normalMap=wr(Or),Ir.normalMap.colorSpace=NoColorSpace,'def Shader "Transform2d_normal"'in Cr&&_r(Ir.normalMap,Cr['def Shader "Transform2d_normal"'])}if("float inputs:roughness.connect"in Dr){const Fr=Dr["float inputs:roughness.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.roughness=1,Ir.roughnessMap=wr(Or),Ir.roughnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_roughness"'in Cr&&_r(Ir.roughnessMap,Cr['def Shader "Transform2d_roughness"'])}else"float inputs:roughness"in Dr&&(Ir.roughness=parseFloat(Dr["float inputs:roughness"]));if("float inputs:metallic.connect"in Dr){const Fr=Dr["float inputs:metallic.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.metalness=1,Ir.metalnessMap=wr(Or),Ir.metalnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_metallic"'in Cr&&_r(Ir.metalnessMap,Cr['def Shader "Transform2d_metallic"'])}else"float inputs:metallic"in Dr&&(Ir.metalness=parseFloat(Dr["float inputs:metallic"]));if("float inputs:clearcoat.connect"in Dr){const Fr=Dr["float inputs:clearcoat.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.clearcoat=1,Ir.clearcoatMap=wr(Or),Ir.clearcoatMap.colorSpace=NoColorSpace,'def Shader "Transform2d_clearcoat"'in Cr&&_r(Ir.clearcoatMap,Cr['def Shader "Transform2d_clearcoat"'])}else"float inputs:clearcoat"in Dr&&(Ir.clearcoat=parseFloat(Dr["float inputs:clearcoat"]));if("float inputs:clearcoatRoughness.connect"in Dr){const Fr=Dr["float inputs:clearcoatRoughness.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.clearcoatRoughness=1,Ir.clearcoatRoughnessMap=wr(Or),Ir.clearcoatRoughnessMap.colorSpace=NoColorSpace,'def Shader "Transform2d_clearcoatRoughness"'in Cr&&_r(Ir.clearcoatRoughnessMap,Cr['def Shader "Transform2d_clearcoatRoughness"'])}else"float inputs:clearcoatRoughness"in Dr&&(Ir.clearcoatRoughness=parseFloat(Dr["float inputs:clearcoatRoughness"]));if("float inputs:ior"in Dr&&(Ir.ior=parseFloat(Dr["float inputs:ior"])),"float inputs:occlusion.connect"in Dr){const Fr=Dr["float inputs:occlusion.connect"],Or=yr(ur,/(\w+).output/.exec(Fr)[1]);Ir.aoMap=wr(Or),Ir.aoMap.colorSpace=NoColorSpace,'def Shader "Transform2d_occlusion"'in Cr&&_r(Ir.aoMap,Cr['def Shader "Transform2d_occlusion"'])}}}return Ir}function yr(Cr,Ir){for(const Rr in Cr){const Pr=Cr[Rr];if(Rr.startsWith(`def Shader "${Ir}"`))return Pr;if(typeof Pr=="object"){const Dr=yr(Pr,Ir);if(Dr)return Dr}}}function wr(Cr){if("asset inputs:file"in Cr){const Ir=Cr["asset inputs:file"].replace(/@*/g,"").trim(),Pr=new TextureLoader().load(or[Ir]),Dr={'"clamp"':ClampToEdgeWrapping,'"mirror"':MirroredRepeatWrapping,'"repeat"':RepeatWrapping};return"token inputs:wrapS"in Cr&&(Pr.wrapS=Dr[Cr["token inputs:wrapS"]]),"token inputs:wrapT"in Cr&&(Pr.wrapT=Dr[Cr["token inputs:wrapT"]]),Pr}return null}function xr(Cr){const Ir=pr(dr(Cr)),Rr=Ar(mr(Cr)),Pr=Ir?new Mesh(Ir,Rr):new Object3D;if("matrix4d xformOp:transform"in Cr){const Dr=JSON.parse("["+Cr["matrix4d xformOp:transform"].replace(/[()]*/g,"")+"]");Pr.matrix.fromArray(Dr),Pr.matrix.decompose(Pr.position,Pr.quaternion,Pr.scale)}return Pr}function Sr(Cr,Ir){for(const Rr in Cr)if(Rr.startsWith("def Scope"))Sr(Cr[Rr],Ir);else if(Rr.startsWith("def Xform")){const Pr=xr(Cr[Rr]);/def Xform "(\w+)"/.test(Rr)&&(Pr.name=/def Xform "(\w+)"/.exec(Rr)[1]),Ir.add(Pr),Sr(Cr[Rr],Pr)}}const br=new Group;return Sr(ur,br),br}}class VOXLoader extends Loader{load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=new DataView(er),ir=tr.getUint32(0,!0),nr=tr.getUint32(4,!0);if(ir!==542658390){console.error("THREE.VOXLoader: Invalid VOX file.");return}if(nr!==150){console.error("THREE.VOXLoader: Invalid VOX file. Unsupported version:",nr);return}const sr=[0,4294967295,4291624959,4288282623,4284940287,4281597951,4278255615,4294954239,4291611903,4288269567,4284927231,4281584895,4278242559,4294941183,4291598847,4288256511,4284914175,4281571839,4278229503,4294928127,4291585791,4288243455,4284901119,4281558783,4278216447,4294915071,4291572735,4288230399,4284888063,4281545727,4278203391,4294902015,4291559679,4288217343,4284875007,4281532671,4278190335,4294967244,4291624908,4288282572,4284940236,4281597900,4278255564,4294954188,4291611852,4288269516,4284927180,4281584844,4278242508,4294941132,4291598796,4288256460,4284914124,4281571788,4278229452,4294928076,4291585740,4288243404,4284901068,4281558732,4278216396,4294915020,4291572684,4288230348,4284888012,4281545676,4278203340,4294901964,4291559628,4288217292,4284874956,4281532620,4278190284,4294967193,4291624857,4288282521,4284940185,4281597849,4278255513,4294954137,4291611801,4288269465,4284927129,4281584793,4278242457,4294941081,4291598745,4288256409,4284914073,4281571737,4278229401,4294928025,4291585689,4288243353,4284901017,4281558681,4278216345,4294914969,4291572633,4288230297,4284887961,4281545625,4278203289,4294901913,4291559577,4288217241,4284874905,4281532569,4278190233,4294967142,4291624806,4288282470,4284940134,4281597798,4278255462,4294954086,4291611750,4288269414,4284927078,4281584742,4278242406,4294941030,4291598694,4288256358,4284914022,4281571686,4278229350,4294927974,4291585638,4288243302,4284900966,4281558630,4278216294,4294914918,4291572582,4288230246,4284887910,4281545574,4278203238,4294901862,4291559526,4288217190,4284874854,4281532518,4278190182,4294967091,4291624755,4288282419,4284940083,4281597747,4278255411,4294954035,4291611699,4288269363,4284927027,4281584691,4278242355,4294940979,4291598643,4288256307,4284913971,4281571635,4278229299,4294927923,4291585587,4288243251,4284900915,4281558579,4278216243,4294914867,4291572531,4288230195,4284887859,4281545523,4278203187,4294901811,4291559475,4288217139,4284874803,4281532467,4278190131,4294967040,4291624704,4288282368,4284940032,4281597696,4278255360,4294953984,4291611648,4288269312,4284926976,4281584640,4278242304,4294940928,4291598592,4288256256,4284913920,4281571584,4278229248,4294927872,4291585536,4288243200,4284900864,4281558528,4278216192,4294914816,4291572480,4288230144,4284887808,4281545472,4278203136,4294901760,4291559424,4288217088,4284874752,4281532416,4278190318,4278190301,4278190267,4278190250,4278190216,4278190199,4278190165,4278190148,4278190114,4278190097,4278251008,4278246656,4278237952,4278233600,4278224896,4278220544,4278211840,4278207488,4278198784,4278194432,4293787648,4292673536,4290445312,4289331200,4287102976,4285988864,4283760640,4282646528,4280418304,4279304192,4293848814,4292730333,4290493371,4289374890,4287137928,4286019447,4283782485,4282664004,4280427042,4279308561];let ar=8,or;const lr=[];for(;ar<tr.byteLength;){let cr="";for(let dr=0;dr<4;dr++)cr+=String.fromCharCode(tr.getUint8(ar++));const ur=tr.getUint32(ar,!0);if(ar+=4,ar+=4,cr==="SIZE"){const dr=tr.getUint32(ar,!0);ar+=4;const hr=tr.getUint32(ar,!0);ar+=4;const pr=tr.getUint32(ar,!0);ar+=4,or={palette:sr,size:{x:dr,y:hr,z:pr}},lr.push(or),ar+=ur-3*4}else if(cr==="XYZI"){const dr=tr.getUint32(ar,!0);ar+=4,or.data=new Uint8Array(er,ar,dr*4),ar+=dr*4}else if(cr==="RGBA"){const dr=[0];for(let hr=0;hr<256;hr++)dr[hr+1]=tr.getUint32(ar,!0),ar+=4;or.palette=dr}else ar+=ur}return lr}}class VOXMesh extends Mesh{constructor(er){const tr=er.data,ir=er.size,nr=er.palette,sr=[],ar=[],or=[0,0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1],lr=[1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0],cr=[0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,1],ur=[0,0,0,0,1,0,1,0,0,1,1,0,1,0,0,0,1,0],dr=[0,0,1,0,0,0,1,0,1,1,0,0,1,0,1,0,0,0],hr=[0,1,1,1,1,1,0,1,0,1,1,0,0,1,0,1,1,1],pr=new Color;function gr(wr,xr,Sr,br,Cr,Ir,Rr){xr-=ir.x/2,Sr-=ir.z/2,br+=ir.y/2;for(let Pr=0;Pr<18;Pr+=3)pr.setRGB(Cr,Ir,Rr,SRGBColorSpace),sr.push(wr[Pr+0]+xr,wr[Pr+1]+Sr,wr[Pr+2]+br),ar.push(pr.r,pr.g,pr.b)}const vr=ir.x,mr=ir.x*ir.y,fr=new Uint8Array(ir.x*ir.y*ir.z);for(let wr=0;wr<tr.length;wr+=4){const xr=tr[wr+0],Sr=tr[wr+1],br=tr[wr+2],Cr=xr+Sr*vr+br*mr;fr[Cr]=255}let _r=!1;for(let wr=0;wr<tr.length;wr+=4){const xr=tr[wr+0],Sr=tr[wr+1],br=tr[wr+2],Cr=tr[wr+3],Ir=nr[Cr],Rr=(Ir>>0&255)/255,Pr=(Ir>>8&255)/255,Dr=(Ir>>16&255)/255;(Rr>0||Pr>0||Dr>0)&&(_r=!0);const Fr=xr+Sr*vr+br*mr;(fr[Fr+1]===0||xr===ir.x-1)&&gr(lr,xr,br,-Sr,Rr,Pr,Dr),(fr[Fr-1]===0||xr===0)&&gr(or,xr,br,-Sr,Rr,Pr,Dr),(fr[Fr+vr]===0||Sr===ir.y-1)&&gr(ur,xr,br,-Sr,Rr,Pr,Dr),(fr[Fr-vr]===0||Sr===0)&&gr(cr,xr,br,-Sr,Rr,Pr,Dr),(fr[Fr+mr]===0||br===ir.z-1)&&gr(hr,xr,br,-Sr,Rr,Pr,Dr),(fr[Fr-mr]===0||br===0)&&gr(dr,xr,br,-Sr,Rr,Pr,Dr)}const Ar=new BufferGeometry;Ar.setAttribute("position",new Float32BufferAttribute(sr,3)),Ar.computeVertexNormals();const yr=new MeshStandardMaterial;_r&&(Ar.setAttribute("color",new Float32BufferAttribute(ar,3)),yr.vertexColors=!0),super(Ar,yr)}}class VOXData3DTexture extends Data3DTexture{constructor(er){const tr=er.data,ir=er.size,nr=ir.x,sr=ir.x*ir.y,ar=new Uint8Array(ir.x*ir.y*ir.z);for(let or=0;or<tr.length;or+=4){const lr=tr[or+0],cr=tr[or+1],ur=tr[or+2],dr=lr+cr*nr+ur*sr;ar[dr]=255}super(ar,ir.x,ir.y,ir.z),this.format=RedFormat,this.minFilter=NearestFilter,this.magFilter=LinearFilter,this.unpackAlignment=1,this.needsUpdate=!0}}/*! chevrotain - v9.0.1 */var R$1=(rr,er)=>()=>(er||(er={exports:{}},rr(er.exports,er)),er.exports),Er=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.VERSION=void 0,rr.VERSION="9.0.1"}),k=R$1((exports,module)=>{"use strict";var __spreadArray=exports&&exports.__spreadArray||function(rr,er){for(var tr=0,ir=er.length,nr=rr.length;tr<ir;tr++,nr++)rr[nr]=er[tr];return rr};Object.defineProperty(exports,"__esModule",{value:!0}),exports.toFastProperties=exports.timer=exports.peek=exports.isES2015MapSupported=exports.PRINT_WARNING=exports.PRINT_ERROR=exports.packArray=exports.IDENTITY=exports.NOOP=exports.merge=exports.groupBy=exports.defaults=exports.assignNoOverwrite=exports.assign=exports.zipObject=exports.sortBy=exports.indexOf=exports.some=exports.difference=exports.every=exports.isObject=exports.isRegExp=exports.isArray=exports.partial=exports.uniq=exports.compact=exports.reduce=exports.findAll=exports.find=exports.cloneObj=exports.cloneArr=exports.contains=exports.has=exports.pick=exports.reject=exports.filter=exports.dropRight=exports.drop=exports.isFunction=exports.isUndefined=exports.isString=exports.forEach=exports.last=exports.first=exports.flatten=exports.map=exports.mapValues=exports.values=exports.keys=exports.isEmpty=void 0;function isEmpty(rr){return rr&&rr.length===0}exports.isEmpty=isEmpty;function keys(rr){return rr==null?[]:Object.keys(rr)}exports.keys=keys;function values(rr){for(var er=[],tr=Object.keys(rr),ir=0;ir<tr.length;ir++)er.push(rr[tr[ir]]);return er}exports.values=values;function mapValues(rr,er){for(var tr=[],ir=keys(rr),nr=0;nr<ir.length;nr++){var sr=ir[nr];tr.push(er.call(null,rr[sr],sr))}return tr}exports.mapValues=mapValues;function map(rr,er){for(var tr=[],ir=0;ir<rr.length;ir++)tr.push(er.call(null,rr[ir],ir));return tr}exports.map=map;function flatten(rr){for(var er=[],tr=0;tr<rr.length;tr++){var ir=rr[tr];Array.isArray(ir)?er=er.concat(flatten(ir)):er.push(ir)}return er}exports.flatten=flatten;function first(rr){return isEmpty(rr)?void 0:rr[0]}exports.first=first;function last(rr){var er=rr&&rr.length;return er?rr[er-1]:void 0}exports.last=last;function forEach(rr,er){if(Array.isArray(rr))for(var tr=0;tr<rr.length;tr++)er.call(null,rr[tr],tr);else if(isObject(rr))for(var ir=keys(rr),tr=0;tr<ir.length;tr++){var nr=ir[tr],sr=rr[nr];er.call(null,sr,nr)}else throw Error("non exhaustive match")}exports.forEach=forEach;function isString(rr){return typeof rr=="string"}exports.isString=isString;function isUndefined(rr){return rr===void 0}exports.isUndefined=isUndefined;function isFunction(rr){return rr instanceof Function}exports.isFunction=isFunction;function drop(rr,er){return er===void 0&&(er=1),rr.slice(er,rr.length)}exports.drop=drop;function dropRight(rr,er){return er===void 0&&(er=1),rr.slice(0,rr.length-er)}exports.dropRight=dropRight;function filter(rr,er){var tr=[];if(Array.isArray(rr))for(var ir=0;ir<rr.length;ir++){var nr=rr[ir];er.call(null,nr)&&tr.push(nr)}return tr}exports.filter=filter;function reject(rr,er){return filter(rr,function(tr){return!er(tr)})}exports.reject=reject;function pick(rr,er){for(var tr=Object.keys(rr),ir={},nr=0;nr<tr.length;nr++){var sr=tr[nr],ar=rr[sr];er(ar)&&(ir[sr]=ar)}return ir}exports.pick=pick;function has(rr,er){return isObject(rr)?rr.hasOwnProperty(er):!1}exports.has=has;function contains(rr,er){return find(rr,function(tr){return tr===er})!==void 0}exports.contains=contains;function cloneArr(rr){for(var er=[],tr=0;tr<rr.length;tr++)er.push(rr[tr]);return er}exports.cloneArr=cloneArr;function cloneObj(rr){var er={};for(var tr in rr)Object.prototype.hasOwnProperty.call(rr,tr)&&(er[tr]=rr[tr]);return er}exports.cloneObj=cloneObj;function find(rr,er){for(var tr=0;tr<rr.length;tr++){var ir=rr[tr];if(er.call(null,ir))return ir}}exports.find=find;function findAll(rr,er){for(var tr=[],ir=0;ir<rr.length;ir++){var nr=rr[ir];er.call(null,nr)&&tr.push(nr)}return tr}exports.findAll=findAll;function reduce(rr,er,tr){for(var ir=Array.isArray(rr),nr=ir?rr:values(rr),sr=ir?[]:keys(rr),ar=tr,or=0;or<nr.length;or++)ar=er.call(null,ar,nr[or],ir?or:sr[or]);return ar}exports.reduce=reduce;function compact(rr){return reject(rr,function(er){return er==null})}exports.compact=compact;function uniq(rr,er){er===void 0&&(er=function(ir){return ir});var tr=[];return reduce(rr,function(ir,nr){var sr=er(nr);return contains(tr,sr)?ir:(tr.push(sr),ir.concat(nr))},[])}exports.uniq=uniq;function partial(rr){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];var ir=[null],nr=ir.concat(er);return Function.bind.apply(rr,nr)}exports.partial=partial;function isArray(rr){return Array.isArray(rr)}exports.isArray=isArray;function isRegExp(rr){return rr instanceof RegExp}exports.isRegExp=isRegExp;function isObject(rr){return rr instanceof Object}exports.isObject=isObject;function every(rr,er){for(var tr=0;tr<rr.length;tr++)if(!er(rr[tr],tr))return!1;return!0}exports.every=every;function difference(rr,er){return reject(rr,function(tr){return contains(er,tr)})}exports.difference=difference;function some(rr,er){for(var tr=0;tr<rr.length;tr++)if(er(rr[tr]))return!0;return!1}exports.some=some;function indexOf(rr,er){for(var tr=0;tr<rr.length;tr++)if(rr[tr]===er)return tr;return-1}exports.indexOf=indexOf;function sortBy(rr,er){var tr=cloneArr(rr);return tr.sort(function(ir,nr){return er(ir)-er(nr)}),tr}exports.sortBy=sortBy;function zipObject(rr,er){if(rr.length!==er.length)throw Error("can't zipObject with different number of keys and values!");for(var tr={},ir=0;ir<rr.length;ir++)tr[rr[ir]]=er[ir];return tr}exports.zipObject=zipObject;function assign(rr){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];for(var ir=0;ir<er.length;ir++)for(var nr=er[ir],sr=keys(nr),ar=0;ar<sr.length;ar++){var or=sr[ar];rr[or]=nr[or]}return rr}exports.assign=assign;function assignNoOverwrite(rr){for(var er=[],tr=1;tr<arguments.length;tr++)er[tr-1]=arguments[tr];for(var ir=0;ir<er.length;ir++)for(var nr=er[ir],sr=keys(nr),ar=0;ar<sr.length;ar++){var or=sr[ar];has(rr,or)||(rr[or]=nr[or])}return rr}exports.assignNoOverwrite=assignNoOverwrite;function defaults(){for(var rr=[],er=0;er<arguments.length;er++)rr[er]=arguments[er];return assignNoOverwrite.apply(void 0,__spreadArray([{}],rr))}exports.defaults=defaults;function groupBy(rr,er){var tr={};return forEach(rr,function(ir){var nr=er(ir),sr=tr[nr];sr?sr.push(ir):tr[nr]=[ir]}),tr}exports.groupBy=groupBy;function merge(rr,er){for(var tr=cloneObj(rr),ir=keys(er),nr=0;nr<ir.length;nr++){var sr=ir[nr],ar=er[sr];tr[sr]=ar}return tr}exports.merge=merge;function NOOP(){}exports.NOOP=NOOP;function IDENTITY(rr){return rr}exports.IDENTITY=IDENTITY;function packArray(rr){for(var er=[],tr=0;tr<rr.length;tr++){var ir=rr[tr];er.push(ir!==void 0?ir:void 0)}return er}exports.packArray=packArray;function PRINT_ERROR(rr){console&&console.error&&console.error("Error: "+rr)}exports.PRINT_ERROR=PRINT_ERROR;function PRINT_WARNING(rr){console&&console.warn&&console.warn("Warning: "+rr)}exports.PRINT_WARNING=PRINT_WARNING;function isES2015MapSupported(){return typeof Map=="function"}exports.isES2015MapSupported=isES2015MapSupported;function peek(rr){return rr[rr.length-1]}exports.peek=peek;function timer(rr){var er=new Date().getTime(),tr=rr(),ir=new Date().getTime(),nr=ir-er;return{time:nr,value:tr}}exports.timer=timer;function toFastProperties(toBecomeFast){function FakeConstructor(){}FakeConstructor.prototype=toBecomeFast;var fakeInstance=new FakeConstructor;function fakeAccess(){return typeof fakeInstance.bar}return fakeAccess(),fakeAccess(),toBecomeFast}exports.toFastProperties=toFastProperties}),xt=R$1((rr,er)=>{(function(tr,ir){typeof define=="function"&&define.amd?define([],ir):typeof er=="object"&&er.exports?er.exports=ir():tr.regexpToAst=ir()})(typeof self<"u"?self:rr,function(){function tr(){}tr.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},tr.prototype.restoreState=function(mr){this.idx=mr.idx,this.input=mr.input,this.groupIdx=mr.groupIdx},tr.prototype.pattern=function(mr){this.idx=0,this.input=mr,this.groupIdx=0,this.consumeChar("/");var fr=this.disjunction();this.consumeChar("/");for(var _r={type:"Flags",loc:{begin:this.idx,end:mr.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case"g":lr(_r,"global");break;case"i":lr(_r,"ignoreCase");break;case"m":lr(_r,"multiLine");break;case"u":lr(_r,"unicode");break;case"y":lr(_r,"sticky");break}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:_r,value:fr,loc:this.loc(0)}},tr.prototype.disjunction=function(){var mr=[],fr=this.idx;for(mr.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),mr.push(this.alternative());return{type:"Disjunction",value:mr,loc:this.loc(fr)}},tr.prototype.alternative=function(){for(var mr=[],fr=this.idx;this.isTerm();)mr.push(this.term());return{type:"Alternative",value:mr,loc:this.loc(fr)}},tr.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},tr.prototype.assertion=function(){var mr=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(mr)};case"$":return{type:"EndAnchor",loc:this.loc(mr)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(mr)};case"B":return{type:"NonWordBoundary",loc:this.loc(mr)}}throw Error("Invalid Assertion Escape");case"(":this.consumeChar("?");var fr;switch(this.popChar()){case"=":fr="Lookahead";break;case"!":fr="NegativeLookahead";break}cr(fr);var _r=this.disjunction();return this.consumeChar(")"),{type:fr,value:_r,loc:this.loc(mr)}}ur()},tr.prototype.quantifier=function(mr){var fr,_r=this.idx;switch(this.popChar()){case"*":fr={atLeast:0,atMost:1/0};break;case"+":fr={atLeast:1,atMost:1/0};break;case"?":fr={atLeast:0,atMost:1};break;case"{":var Ar=this.integerIncludingZero();switch(this.popChar()){case"}":fr={atLeast:Ar,atMost:Ar};break;case",":var yr;this.isDigit()?(yr=this.integerIncludingZero(),fr={atLeast:Ar,atMost:yr}):fr={atLeast:Ar,atMost:1/0},this.consumeChar("}");break}if(mr===!0&&fr===void 0)return;cr(fr);break}if(!(mr===!0&&fr===void 0))return cr(fr),this.peekChar(0)==="?"?(this.consumeChar("?"),fr.greedy=!1):fr.greedy=!0,fr.type="Quantifier",fr.loc=this.loc(_r),fr},tr.prototype.atom=function(){var mr,fr=this.idx;switch(this.peekChar()){case".":mr=this.dotAll();break;case"\\":mr=this.atomEscape();break;case"[":mr=this.characterClass();break;case"(":mr=this.group();break}return mr===void 0&&this.isPatternCharacter()&&(mr=this.patternCharacter()),cr(mr),mr.loc=this.loc(fr),this.isQuantifier()&&(mr.quantifier=this.quantifier()),mr},tr.prototype.dotAll=function(){return this.consumeChar("."),{type:"Set",complement:!0,value:[ar(`
`),ar("\r"),ar("\u2028"),ar("\u2029")]}},tr.prototype.atomEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},tr.prototype.decimalEscapeAtom=function(){var mr=this.positiveInteger();return{type:"GroupBackReference",value:mr}},tr.prototype.characterClassEscape=function(){var mr,fr=!1;switch(this.popChar()){case"d":mr=hr;break;case"D":mr=hr,fr=!0;break;case"s":mr=gr;break;case"S":mr=gr,fr=!0;break;case"w":mr=pr;break;case"W":mr=pr,fr=!0;break}return cr(mr),{type:"Set",value:mr,complement:fr}},tr.prototype.controlEscapeAtom=function(){var mr;switch(this.popChar()){case"f":mr=ar("\f");break;case"n":mr=ar(`
`);break;case"r":mr=ar("\r");break;case"t":mr=ar("	");break;case"v":mr=ar("\v");break}return cr(mr),{type:"Character",value:mr}},tr.prototype.controlLetterEscapeAtom=function(){this.consumeChar("c");var mr=this.popChar();if(/[a-zA-Z]/.test(mr)===!1)throw Error("Invalid ");var fr=mr.toUpperCase().charCodeAt(0)-64;return{type:"Character",value:fr}},tr.prototype.nulCharacterAtom=function(){return this.consumeChar("0"),{type:"Character",value:ar("\0")}},tr.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar("x"),this.parseHexDigits(2)},tr.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar("u"),this.parseHexDigits(4)},tr.prototype.identityEscapeAtom=function(){var mr=this.popChar();return{type:"Character",value:ar(mr)}},tr.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:var mr=this.popChar();return{type:"Character",value:ar(mr)}}},tr.prototype.characterClass=function(){var mr=[],fr=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),fr=!0);this.isClassAtom();){var _r=this.classAtom(),Ar=_r.type==="Character";if(Ar&&this.isRangeDash()){this.consumeChar("-");var yr=this.classAtom(),wr=yr.type==="Character";if(wr){if(yr.value<_r.value)throw Error("Range out of order in character class");mr.push({from:_r.value,to:yr.value})}else or(_r.value,mr),mr.push(ar("-")),or(yr.value,mr)}else or(_r.value,mr)}return this.consumeChar("]"),{type:"Set",complement:fr,value:mr}},tr.prototype.classAtom=function(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}},tr.prototype.classEscape=function(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:ar("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},tr.prototype.group=function(){var mr=!0;switch(this.consumeChar("("),this.peekChar(0)){case"?":this.consumeChar("?"),this.consumeChar(":"),mr=!1;break;default:this.groupIdx++;break}var fr=this.disjunction();this.consumeChar(")");var _r={type:"Group",capturing:mr,value:fr};return mr&&(_r.idx=this.groupIdx),_r},tr.prototype.positiveInteger=function(){var mr=this.popChar();if(sr.test(mr)===!1)throw Error("Expecting a positive integer");for(;nr.test(this.peekChar(0));)mr+=this.popChar();return parseInt(mr,10)},tr.prototype.integerIncludingZero=function(){var mr=this.popChar();if(nr.test(mr)===!1)throw Error("Expecting an integer");for(;nr.test(this.peekChar(0));)mr+=this.popChar();return parseInt(mr,10)},tr.prototype.patternCharacter=function(){var mr=this.popChar();switch(mr){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:ar(mr)}}},tr.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}},tr.prototype.isRangeDash=function(){return this.peekChar()==="-"&&this.isClassAtom(1)},tr.prototype.isDigit=function(){return nr.test(this.peekChar(0))},tr.prototype.isClassAtom=function(mr){switch(mr===void 0&&(mr=0),this.peekChar(mr)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},tr.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},tr.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}},tr.prototype.isAssertion=function(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}},tr.prototype.isQuantifier=function(){var mr=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(mr)}},tr.prototype.isPatternCharacter=function(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}},tr.prototype.parseHexDigits=function(mr){for(var fr="",_r=0;_r<mr;_r++){var Ar=this.popChar();if(ir.test(Ar)===!1)throw Error("Expecting a HexDecimal digits");fr+=Ar}var yr=parseInt(fr,16);return{type:"Character",value:yr}},tr.prototype.peekChar=function(mr){return mr===void 0&&(mr=0),this.input[this.idx+mr]},tr.prototype.popChar=function(){var mr=this.peekChar(0);return this.consumeChar(),mr},tr.prototype.consumeChar=function(mr){if(mr!==void 0&&this.input[this.idx]!==mr)throw Error("Expected: '"+mr+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++},tr.prototype.loc=function(mr){return{begin:mr,end:this.idx}};var ir=/[0-9a-fA-F]/,nr=/[0-9]/,sr=/[1-9]/;function ar(mr){return mr.charCodeAt(0)}function or(mr,fr){mr.length!==void 0?mr.forEach(function(_r){fr.push(_r)}):fr.push(mr)}function lr(mr,fr){if(mr[fr]===!0)throw"duplicate flag "+fr;mr[fr]=!0}function cr(mr){if(mr===void 0)throw Error("Internal Error - Should never get here!")}function ur(){throw Error("Internal Error - Should never get here!")}var dr,hr=[];for(dr=ar("0");dr<=ar("9");dr++)hr.push(dr);var pr=[ar("_")].concat(hr);for(dr=ar("a");dr<=ar("z");dr++)pr.push(dr);for(dr=ar("A");dr<=ar("Z");dr++)pr.push(dr);var gr=[ar(" "),ar("\f"),ar(`
`),ar("\r"),ar("	"),ar("\v"),ar("	"),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar(""),ar("\u2028"),ar("\u2029"),ar(""),ar(""),ar(""),ar("\uFEFF")];function vr(){}return vr.prototype.visitChildren=function(mr){for(var fr in mr){var _r=mr[fr];mr.hasOwnProperty(fr)&&(_r.type!==void 0?this.visit(_r):Array.isArray(_r)&&_r.forEach(function(Ar){this.visit(Ar)},this))}},vr.prototype.visit=function(mr){switch(mr.type){case"Pattern":this.visitPattern(mr);break;case"Flags":this.visitFlags(mr);break;case"Disjunction":this.visitDisjunction(mr);break;case"Alternative":this.visitAlternative(mr);break;case"StartAnchor":this.visitStartAnchor(mr);break;case"EndAnchor":this.visitEndAnchor(mr);break;case"WordBoundary":this.visitWordBoundary(mr);break;case"NonWordBoundary":this.visitNonWordBoundary(mr);break;case"Lookahead":this.visitLookahead(mr);break;case"NegativeLookahead":this.visitNegativeLookahead(mr);break;case"Character":this.visitCharacter(mr);break;case"Set":this.visitSet(mr);break;case"Group":this.visitGroup(mr);break;case"GroupBackReference":this.visitGroupBackReference(mr);break;case"Quantifier":this.visitQuantifier(mr);break}this.visitChildren(mr)},vr.prototype.visitPattern=function(mr){},vr.prototype.visitFlags=function(mr){},vr.prototype.visitDisjunction=function(mr){},vr.prototype.visitAlternative=function(mr){},vr.prototype.visitStartAnchor=function(mr){},vr.prototype.visitEndAnchor=function(mr){},vr.prototype.visitWordBoundary=function(mr){},vr.prototype.visitNonWordBoundary=function(mr){},vr.prototype.visitLookahead=function(mr){},vr.prototype.visitNegativeLookahead=function(mr){},vr.prototype.visitCharacter=function(mr){},vr.prototype.visitSet=function(mr){},vr.prototype.visitGroup=function(mr){},vr.prototype.visitGroupBackReference=function(mr){},vr.prototype.visitQuantifier=function(mr){},{RegExpParser:tr,BaseRegExpVisitor:vr,VERSION:"0.5.0"}})}),Lt=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.clearRegExpParserCache=rr.getRegExpAst=void 0;var er=xt(),tr={},ir=new er.RegExpParser;function nr(ar){var or=ar.toString();if(tr.hasOwnProperty(or))return tr[or];var lr=ir.pattern(or);return tr[or]=lr,lr}rr.getRegExpAst=nr;function sr(){tr={}}rr.clearRegExpParserCache=sr}),pn=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var vr=function(mr,fr){return vr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_r,Ar){_r.__proto__=Ar}||function(_r,Ar){for(var yr in Ar)Object.prototype.hasOwnProperty.call(Ar,yr)&&(_r[yr]=Ar[yr])},vr(mr,fr)};return function(mr,fr){if(typeof fr!="function"&&fr!==null)throw new TypeError("Class extends value "+String(fr)+" is not a constructor or null");vr(mr,fr);function _r(){this.constructor=mr}mr.prototype=fr===null?Object.create(fr):(_r.prototype=fr.prototype,new _r)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.canMatchCharCode=rr.firstCharOptimizedIndices=rr.getOptimizedStartCodesIndices=rr.failedOptimizationPrefixMsg=void 0;var tr=xt(),ir=k(),nr=Lt(),sr=Tr(),ar="Complement Sets are not supported for first char optimization";rr.failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function or(vr,mr){mr===void 0&&(mr=!1);try{var fr=nr.getRegExpAst(vr),_r=lr(fr.value,{},fr.flags.ignoreCase);return _r}catch(yr){if(yr.message===ar)mr&&ir.PRINT_WARNING(""+rr.failedOptimizationPrefixMsg+("	Unable to optimize: < "+vr.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var Ar="";mr&&(Ar=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),ir.PRINT_ERROR(rr.failedOptimizationPrefixMsg+`
`+("	Failed parsing: < "+vr.toString()+` >
`)+("	Using the regexp-to-ast library version: "+tr.VERSION+`
`)+"	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues"+Ar)}}return[]}rr.getOptimizedStartCodesIndices=or;function lr(vr,mr,fr){switch(vr.type){case"Disjunction":for(var _r=0;_r<vr.value.length;_r++)lr(vr.value[_r],mr,fr);break;case"Alternative":for(var Ar=vr.value,_r=0;_r<Ar.length;_r++){var yr=Ar[_r];switch(yr.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}var wr=yr;switch(wr.type){case"Character":cr(wr.value,mr,fr);break;case"Set":if(wr.complement===!0)throw Error(ar);ir.forEach(wr.value,function(br){if(typeof br=="number")cr(br,mr,fr);else{var Cr=br;if(fr===!0)for(var Ir=Cr.from;Ir<=Cr.to;Ir++)cr(Ir,mr,fr);else{for(var Ir=Cr.from;Ir<=Cr.to&&Ir<sr.minOptimizationVal;Ir++)cr(Ir,mr,fr);if(Cr.to>=sr.minOptimizationVal)for(var Rr=Cr.from>=sr.minOptimizationVal?Cr.from:sr.minOptimizationVal,Pr=Cr.to,Dr=sr.charCodeToOptimizedIndex(Rr),Fr=sr.charCodeToOptimizedIndex(Pr),Or=Dr;Or<=Fr;Or++)mr[Or]=Or}}});break;case"Group":lr(wr.value,mr,fr);break;default:throw Error("Non Exhaustive Match")}var xr=wr.quantifier!==void 0&&wr.quantifier.atLeast===0;if(wr.type==="Group"&&hr(wr)===!1||wr.type!=="Group"&&xr===!1)break}break;default:throw Error("non exhaustive match!")}return ir.values(mr)}rr.firstCharOptimizedIndices=lr;function cr(vr,mr,fr){var _r=sr.charCodeToOptimizedIndex(vr);mr[_r]=_r,fr===!0&&ur(vr,mr)}function ur(vr,mr){var fr=String.fromCharCode(vr),_r=fr.toUpperCase();if(_r!==fr){var Ar=sr.charCodeToOptimizedIndex(_r.charCodeAt(0));mr[Ar]=Ar}else{var yr=fr.toLowerCase();if(yr!==fr){var Ar=sr.charCodeToOptimizedIndex(yr.charCodeAt(0));mr[Ar]=Ar}}}function dr(vr,mr){return ir.find(vr.value,function(fr){if(typeof fr=="number")return ir.contains(mr,fr);var _r=fr;return ir.find(mr,function(Ar){return _r.from<=Ar&&Ar<=_r.to})!==void 0})}function hr(vr){return vr.quantifier&&vr.quantifier.atLeast===0?!0:vr.value?ir.isArray(vr.value)?ir.every(vr.value,hr):hr(vr.value):!1}var pr=function(vr){er(mr,vr);function mr(fr){var _r=vr.call(this)||this;return _r.targetCharCodes=fr,_r.found=!1,_r}return mr.prototype.visitChildren=function(fr){if(this.found!==!0){switch(fr.type){case"Lookahead":this.visitLookahead(fr);return;case"NegativeLookahead":this.visitNegativeLookahead(fr);return}vr.prototype.visitChildren.call(this,fr)}},mr.prototype.visitCharacter=function(fr){ir.contains(this.targetCharCodes,fr.value)&&(this.found=!0)},mr.prototype.visitSet=function(fr){fr.complement?dr(fr,this.targetCharCodes)===void 0&&(this.found=!0):dr(fr,this.targetCharCodes)!==void 0&&(this.found=!0)},mr}(tr.BaseRegExpVisitor);function gr(vr,mr){if(mr instanceof RegExp){var fr=nr.getRegExpAst(mr),_r=new pr(vr);return _r.visit(fr),_r.found}else return ir.find(mr,function(Ar){return ir.contains(vr,Ar.charCodeAt(0))})!==void 0}rr.canMatchCharCode=gr}),Tr=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var $r=function(Vr,Gr){return $r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(qr,ji){qr.__proto__=ji}||function(qr,ji){for(var Jr in ji)Object.prototype.hasOwnProperty.call(ji,Jr)&&(qr[Jr]=ji[Jr])},$r(Vr,Gr)};return function(Vr,Gr){if(typeof Gr!="function"&&Gr!==null)throw new TypeError("Class extends value "+String(Gr)+" is not a constructor or null");$r(Vr,Gr);function qr(){this.constructor=Vr}Vr.prototype=Gr===null?Object.create(Gr):(qr.prototype=Gr.prototype,new qr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.charCodeToOptimizedIndex=rr.minOptimizationVal=rr.buildLineBreakIssueMessage=rr.LineTerminatorOptimizedTester=rr.isShortPattern=rr.isCustomPattern=rr.cloneEmptyGroups=rr.performWarningRuntimeChecks=rr.performRuntimeChecks=rr.addStickyFlag=rr.addStartOfInput=rr.findUnreachablePatterns=rr.findModesThatDoNotExist=rr.findInvalidGroupType=rr.findDuplicatePatterns=rr.findUnsupportedFlags=rr.findStartOfInputAnchor=rr.findEmptyMatchRegExps=rr.findEndOfInputAnchor=rr.findInvalidPatterns=rr.findMissingPatterns=rr.validatePatterns=rr.analyzeTokenTypes=rr.enableSticky=rr.disableSticky=rr.SUPPORT_STICKY=rr.MODES=rr.DEFAULT_MODE=void 0;var tr=xt(),ir=ft(),nr=k(),sr=pn(),ar=Lt(),or="PATTERN";rr.DEFAULT_MODE="defaultMode",rr.MODES="modes",rr.SUPPORT_STICKY=typeof new RegExp("(?:)").sticky=="boolean";function lr(){rr.SUPPORT_STICKY=!1}rr.disableSticky=lr;function cr(){rr.SUPPORT_STICKY=!0}rr.enableSticky=cr;function ur($r,Vr){Vr=nr.defaults(Vr,{useSticky:rr.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:function(Ni,Ri){return Ri()}});var Gr=Vr.tracer;Gr("initCharCodeToOptimizedIndexMap",function(){Kr()});var qr;Gr("Reject Lexer.NA",function(){qr=nr.reject($r,function(Ni){return Ni[or]===ir.Lexer.NA})});var ji=!1,Jr;Gr("Transform Patterns",function(){ji=!1,Jr=nr.map(qr,function(Ni){var Ri=Ni[or];if(nr.isRegExp(Ri)){var qi=Ri.source;return qi.length===1&&qi!=="^"&&qi!=="$"&&qi!=="."&&!Ri.ignoreCase?qi:qi.length===2&&qi[0]==="\\"&&!nr.contains(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],qi[1])?qi[1]:Vr.useSticky?Pr(Ri):Rr(Ri)}else{if(nr.isFunction(Ri))return ji=!0,{exec:Ri};if(nr.has(Ri,"exec"))return ji=!0,Ri;if(typeof Ri=="string"){if(Ri.length===1)return Ri;var as=Ri.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),us=new RegExp(as);return Vr.useSticky?Pr(us):Rr(us)}else throw Error("non exhaustive match")}})});var Ji,Ki,Zi,Zr,is;Gr("misc mapping",function(){Ji=nr.map(qr,function(Ni){return Ni.tokenTypeIdx}),Ki=nr.map(qr,function(Ni){var Ri=Ni.GROUP;if(Ri!==ir.Lexer.SKIPPED){if(nr.isString(Ri))return Ri;if(nr.isUndefined(Ri))return!1;throw Error("non exhaustive match")}}),Zi=nr.map(qr,function(Ni){var Ri=Ni.LONGER_ALT;if(Ri){var qi=nr.indexOf(qr,Ri);return qi}}),Zr=nr.map(qr,function(Ni){return Ni.PUSH_MODE}),is=nr.map(qr,function(Ni){return nr.has(Ni,"POP_MODE")})});var os;Gr("Line Terminator Handling",function(){var Ni=Xr(Vr.lineTerminatorCharacters);os=nr.map(qr,function(Ri){return!1}),Vr.positionTracking!=="onlyOffset"&&(os=nr.map(qr,function(Ri){if(nr.has(Ri,"LINE_BREAKS"))return Ri.LINE_BREAKS;if(Br(Ri,Ni)===!1)return sr.canMatchCharCode(Ni,Ri.PATTERN)}))});var cs,ss,es,ms;Gr("Misc Mapping #2",function(){cs=nr.map(qr,Nr),ss=nr.map(Jr,Ur),es=nr.reduce(qr,function(Ni,Ri){var qi=Ri.GROUP;return nr.isString(qi)&&qi!==ir.Lexer.SKIPPED&&(Ni[qi]=[]),Ni},{}),ms=nr.map(Jr,function(Ni,Ri){return{pattern:Jr[Ri],longerAlt:Zi[Ri],canLineTerminator:os[Ri],isCustom:cs[Ri],short:ss[Ri],group:Ki[Ri],push:Zr[Ri],pop:is[Ri],tokenTypeIdx:Ji[Ri],tokenType:qr[Ri]}})});var Yi=!0,Gi=[];return Vr.safeMode||Gr("First Char Optimization",function(){Gi=nr.reduce(qr,function(Ni,Ri,qi){if(typeof Ri.PATTERN=="string"){var as=Ri.PATTERN.charCodeAt(0),us=Xi(as);Yr(Ni,us,ms[qi])}else if(nr.isArray(Ri.START_CHARS_HINT)){var gs;nr.forEach(Ri.START_CHARS_HINT,function(_s){var As=typeof _s=="string"?_s.charCodeAt(0):_s,xs=Xi(As);gs!==xs&&(gs=xs,Yr(Ni,xs,ms[qi]))})}else if(nr.isRegExp(Ri.PATTERN))if(Ri.PATTERN.unicode)Yi=!1,Vr.ensureOptimizations&&nr.PRINT_ERROR(""+sr.failedOptimizationPrefixMsg+("	Unable to analyze < "+Ri.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var vs=sr.getOptimizedStartCodesIndices(Ri.PATTERN,Vr.ensureOptimizations);nr.isEmpty(vs)&&(Yi=!1),nr.forEach(vs,function(_s){Yr(Ni,_s,ms[qi])})}else Vr.ensureOptimizations&&nr.PRINT_ERROR(""+sr.failedOptimizationPrefixMsg+("	TokenType: <"+Ri.name+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),Yi=!1;return Ni},[])}),Gr("ArrayPacking",function(){Gi=nr.packArray(Gi)}),{emptyGroups:es,patternIdxToConfig:ms,charCodeToPatternIdxToConfig:Gi,hasCustom:ji,canBeOptimized:Yi}}rr.analyzeTokenTypes=ur;function dr($r,Vr){var Gr=[],qr=pr($r);Gr=Gr.concat(qr.errors);var ji=gr(qr.valid),Jr=ji.valid;return Gr=Gr.concat(ji.errors),Gr=Gr.concat(hr(Jr)),Gr=Gr.concat(xr(Jr)),Gr=Gr.concat(Sr(Jr,Vr)),Gr=Gr.concat(br(Jr)),Gr}rr.validatePatterns=dr;function hr($r){var Vr=[],Gr=nr.filter($r,function(qr){return nr.isRegExp(qr[or])});return Vr=Vr.concat(mr(Gr)),Vr=Vr.concat(Ar(Gr)),Vr=Vr.concat(yr(Gr)),Vr=Vr.concat(wr(Gr)),Vr=Vr.concat(fr(Gr)),Vr}function pr($r){var Vr=nr.filter($r,function(ji){return!nr.has(ji,or)}),Gr=nr.map(Vr,function(ji){return{message:"Token Type: ->"+ji.name+"<- missing static 'PATTERN' property",type:ir.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[ji]}}),qr=nr.difference($r,Vr);return{errors:Gr,valid:qr}}rr.findMissingPatterns=pr;function gr($r){var Vr=nr.filter($r,function(ji){var Jr=ji[or];return!nr.isRegExp(Jr)&&!nr.isFunction(Jr)&&!nr.has(Jr,"exec")&&!nr.isString(Jr)}),Gr=nr.map(Vr,function(ji){return{message:"Token Type: ->"+ji.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:ir.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[ji]}}),qr=nr.difference($r,Vr);return{errors:Gr,valid:qr}}rr.findInvalidPatterns=gr;var vr=/[^\\][\$]/;function mr($r){var Vr=function(ji){er(Jr,ji);function Jr(){var Ji=ji!==null&&ji.apply(this,arguments)||this;return Ji.found=!1,Ji}return Jr.prototype.visitEndAnchor=function(Ji){this.found=!0},Jr}(tr.BaseRegExpVisitor),Gr=nr.filter($r,function(ji){var Jr=ji[or];try{var Ji=ar.getRegExpAst(Jr),Ki=new Vr;return Ki.visit(Ji),Ki.found}catch{return vr.test(Jr.source)}}),qr=nr.map(Gr,function(ji){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+ji.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ir.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[ji]}});return qr}rr.findEndOfInputAnchor=mr;function fr($r){var Vr=nr.filter($r,function(qr){var ji=qr[or];return ji.test("")}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'PATTERN' must not match an empty string",type:ir.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[qr]}});return Gr}rr.findEmptyMatchRegExps=fr;var _r=/[^\\[][\^]|^\^/;function Ar($r){var Vr=function(ji){er(Jr,ji);function Jr(){var Ji=ji!==null&&ji.apply(this,arguments)||this;return Ji.found=!1,Ji}return Jr.prototype.visitStartAnchor=function(Ji){this.found=!0},Jr}(tr.BaseRegExpVisitor),Gr=nr.filter($r,function(ji){var Jr=ji[or];try{var Ji=ar.getRegExpAst(Jr),Ki=new Vr;return Ki.visit(Ji),Ki.found}catch{return _r.test(Jr.source)}}),qr=nr.map(Gr,function(ji){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+ji.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:ir.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[ji]}});return qr}rr.findStartOfInputAnchor=Ar;function yr($r){var Vr=nr.filter($r,function(qr){var ji=qr[or];return ji instanceof RegExp&&(ji.multiline||ji.global)}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:ir.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[qr]}});return Gr}rr.findUnsupportedFlags=yr;function wr($r){var Vr=[],Gr=nr.map($r,function(Jr){return nr.reduce($r,function(Ji,Ki){return Jr.PATTERN.source===Ki.PATTERN.source&&!nr.contains(Vr,Ki)&&Ki.PATTERN!==ir.Lexer.NA&&(Vr.push(Ki),Ji.push(Ki)),Ji},[])});Gr=nr.compact(Gr);var qr=nr.filter(Gr,function(Jr){return Jr.length>1}),ji=nr.map(qr,function(Jr){var Ji=nr.map(Jr,function(Zi){return Zi.name}),Ki=nr.first(Jr).PATTERN;return{message:"The same RegExp pattern ->"+Ki+"<-"+("has been used in all of the following Token Types: "+Ji.join(", ")+" <-"),type:ir.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:Jr}});return ji}rr.findDuplicatePatterns=wr;function xr($r){var Vr=nr.filter($r,function(qr){if(!nr.has(qr,"GROUP"))return!1;var ji=qr.GROUP;return ji!==ir.Lexer.SKIPPED&&ji!==ir.Lexer.NA&&!nr.isString(ji)}),Gr=nr.map(Vr,function(qr){return{message:"Token Type: ->"+qr.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:ir.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[qr]}});return Gr}rr.findInvalidGroupType=xr;function Sr($r,Vr){var Gr=nr.filter($r,function(ji){return ji.PUSH_MODE!==void 0&&!nr.contains(Vr,ji.PUSH_MODE)}),qr=nr.map(Gr,function(ji){var Jr="Token Type: ->"+ji.name+"<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->"+ji.PUSH_MODE+"<-which does not exist";return{message:Jr,type:ir.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[ji]}});return qr}rr.findModesThatDoNotExist=Sr;function br($r){var Vr=[],Gr=nr.reduce($r,function(qr,ji,Jr){var Ji=ji.PATTERN;return Ji===ir.Lexer.NA||(nr.isString(Ji)?qr.push({str:Ji,idx:Jr,tokenType:ji}):nr.isRegExp(Ji)&&Ir(Ji)&&qr.push({str:Ji.source,idx:Jr,tokenType:ji})),qr},[]);return nr.forEach($r,function(qr,ji){nr.forEach(Gr,function(Jr){var Ji=Jr.str,Ki=Jr.idx,Zi=Jr.tokenType;if(ji<Ki&&Cr(Ji,qr.PATTERN)){var Zr="Token: ->"+Zi.name+`<- can never be matched.
`+("Because it appears AFTER the Token Type ->"+qr.name+"<-")+`in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;Vr.push({message:Zr,type:ir.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[qr,Zi]})}})}),Vr}rr.findUnreachablePatterns=br;function Cr($r,Vr){if(nr.isRegExp(Vr)){var Gr=Vr.exec($r);return Gr!==null&&Gr.index===0}else{if(nr.isFunction(Vr))return Vr($r,0,[],{});if(nr.has(Vr,"exec"))return Vr.exec($r,0,[],{});if(typeof Vr=="string")return Vr===$r;throw Error("non exhaustive match")}}function Ir($r){var Vr=[".","\\","[","]","|","^","$","(",")","?","*","+","{"];return nr.find(Vr,function(Gr){return $r.source.indexOf(Gr)!==-1})===void 0}function Rr($r){var Vr=$r.ignoreCase?"i":"";return new RegExp("^(?:"+$r.source+")",Vr)}rr.addStartOfInput=Rr;function Pr($r){var Vr=$r.ignoreCase?"iy":"y";return new RegExp(""+$r.source,Vr)}rr.addStickyFlag=Pr;function Dr($r,Vr,Gr){var qr=[];return nr.has($r,rr.DEFAULT_MODE)||qr.push({message:"A MultiMode Lexer cannot be initialized without a <"+rr.DEFAULT_MODE+`> property in its definition
`,type:ir.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),nr.has($r,rr.MODES)||qr.push({message:"A MultiMode Lexer cannot be initialized without a <"+rr.MODES+`> property in its definition
`,type:ir.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),nr.has($r,rr.MODES)&&nr.has($r,rr.DEFAULT_MODE)&&!nr.has($r.modes,$r.defaultMode)&&qr.push({message:"A MultiMode Lexer cannot be initialized with a "+rr.DEFAULT_MODE+": <"+$r.defaultMode+`>which does not exist
`,type:ir.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),nr.has($r,rr.MODES)&&nr.forEach($r.modes,function(ji,Jr){nr.forEach(ji,function(Ji,Ki){nr.isUndefined(Ji)&&qr.push({message:"A Lexer cannot be initialized using an undefined Token Type. Mode:"+("<"+Jr+"> at index: <"+Ki+`>
`),type:ir.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),qr}rr.performRuntimeChecks=Dr;function Fr($r,Vr,Gr){var qr=[],ji=!1,Jr=nr.compact(nr.flatten(nr.mapValues($r.modes,function(Zi){return Zi}))),Ji=nr.reject(Jr,function(Zi){return Zi[or]===ir.Lexer.NA}),Ki=Xr(Gr);return Vr&&nr.forEach(Ji,function(Zi){var Zr=Br(Zi,Ki);if(Zr!==!1){var is=Wr(Zi,Zr),os={message:is,type:Zr.issue,tokenType:Zi};qr.push(os)}else nr.has(Zi,"LINE_BREAKS")?Zi.LINE_BREAKS===!0&&(ji=!0):sr.canMatchCharCode(Ki,Zi.PATTERN)&&(ji=!0)}),Vr&&!ji&&qr.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS
	for details.`,type:ir.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),qr}rr.performWarningRuntimeChecks=Fr;function Or($r){var Vr={},Gr=nr.keys($r);return nr.forEach(Gr,function(qr){var ji=$r[qr];if(nr.isArray(ji))Vr[qr]=[];else throw Error("non exhaustive match")}),Vr}rr.cloneEmptyGroups=Or;function Nr($r){var Vr=$r.PATTERN;if(nr.isRegExp(Vr))return!1;if(nr.isFunction(Vr)||nr.has(Vr,"exec"))return!0;if(nr.isString(Vr))return!1;throw Error("non exhaustive match")}rr.isCustomPattern=Nr;function Ur($r){return nr.isString($r)&&$r.length===1?$r.charCodeAt(0):!1}rr.isShortPattern=Ur,rr.LineTerminatorOptimizedTester={test:function($r){for(var Vr=$r.length,Gr=this.lastIndex;Gr<Vr;Gr++){var qr=$r.charCodeAt(Gr);if(qr===10)return this.lastIndex=Gr+1,!0;if(qr===13)return $r.charCodeAt(Gr+1)===10?this.lastIndex=Gr+2:this.lastIndex=Gr+1,!0}return!1},lastIndex:0};function Br($r,Vr){if(nr.has($r,"LINE_BREAKS"))return!1;if(nr.isRegExp($r.PATTERN)){try{sr.canMatchCharCode(Vr,$r.PATTERN)}catch(Gr){return{issue:ir.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:Gr.message}}return!1}else{if(nr.isString($r.PATTERN))return!1;if(Nr($r))return{issue:ir.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}}function Wr($r,Vr){if(Vr.issue===ir.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+("	The problem is in the <"+$r.name+`> Token Type
`)+("	 Root cause: "+Vr.errMsg+`.
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR";if(Vr.issue===ir.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+("	The problem is in the <"+$r.name+`> Token Type
`)+"	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK";throw Error("non exhaustive match")}rr.buildLineBreakIssueMessage=Wr;function Xr($r){var Vr=nr.map($r,function(Gr){return nr.isString(Gr)&&Gr.length>0?Gr.charCodeAt(0):Gr});return Vr}function Yr($r,Vr,Gr){$r[Vr]===void 0?$r[Vr]=[Gr]:$r[Vr].push(Gr)}rr.minOptimizationVal=256;var Qi=[];function Xi($r){return $r<rr.minOptimizationVal?$r:Qi[$r]}rr.charCodeToOptimizedIndex=Xi;function Kr(){if(nr.isEmpty(Qi)){Qi=new Array(65536);for(var $r=0;$r<65536;$r++)Qi[$r]=$r>255?255+~~($r/255):$r}}}),Xe=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.isTokenType=rr.hasExtendingTokensTypesMapProperty=rr.hasExtendingTokensTypesProperty=rr.hasCategoriesProperty=rr.hasShortKeyProperty=rr.singleAssignCategoriesToksMap=rr.assignCategoriesMapProp=rr.assignCategoriesTokensProp=rr.assignTokenDefaultProps=rr.expandCategories=rr.augmentTokenTypes=rr.tokenIdxToClass=rr.tokenShortNameIdx=rr.tokenStructuredMatcherNoCategories=rr.tokenStructuredMatcher=void 0;var er=k();function tr(vr,mr){var fr=vr.tokenTypeIdx;return fr===mr.tokenTypeIdx?!0:mr.isParent===!0&&mr.categoryMatchesMap[fr]===!0}rr.tokenStructuredMatcher=tr;function ir(vr,mr){return vr.tokenTypeIdx===mr.tokenTypeIdx}rr.tokenStructuredMatcherNoCategories=ir,rr.tokenShortNameIdx=1,rr.tokenIdxToClass={};function nr(vr){var mr=sr(vr);ar(mr),lr(mr),or(mr),er.forEach(mr,function(fr){fr.isParent=fr.categoryMatches.length>0})}rr.augmentTokenTypes=nr;function sr(vr){for(var mr=er.cloneArr(vr),fr=vr,_r=!0;_r;){fr=er.compact(er.flatten(er.map(fr,function(yr){return yr.CATEGORIES})));var Ar=er.difference(fr,mr);mr=mr.concat(Ar),er.isEmpty(Ar)?_r=!1:fr=Ar}return mr}rr.expandCategories=sr;function ar(vr){er.forEach(vr,function(mr){ur(mr)||(rr.tokenIdxToClass[rr.tokenShortNameIdx]=mr,mr.tokenTypeIdx=rr.tokenShortNameIdx++),dr(mr)&&!er.isArray(mr.CATEGORIES)&&(mr.CATEGORIES=[mr.CATEGORIES]),dr(mr)||(mr.CATEGORIES=[]),hr(mr)||(mr.categoryMatches=[]),pr(mr)||(mr.categoryMatchesMap={})})}rr.assignTokenDefaultProps=ar;function or(vr){er.forEach(vr,function(mr){mr.categoryMatches=[],er.forEach(mr.categoryMatchesMap,function(fr,_r){mr.categoryMatches.push(rr.tokenIdxToClass[_r].tokenTypeIdx)})})}rr.assignCategoriesTokensProp=or;function lr(vr){er.forEach(vr,function(mr){cr([],mr)})}rr.assignCategoriesMapProp=lr;function cr(vr,mr){er.forEach(vr,function(fr){mr.categoryMatchesMap[fr.tokenTypeIdx]=!0}),er.forEach(mr.CATEGORIES,function(fr){var _r=vr.concat(mr);er.contains(_r,fr)||cr(_r,fr)})}rr.singleAssignCategoriesToksMap=cr;function ur(vr){return er.has(vr,"tokenTypeIdx")}rr.hasShortKeyProperty=ur;function dr(vr){return er.has(vr,"CATEGORIES")}rr.hasCategoriesProperty=dr;function hr(vr){return er.has(vr,"categoryMatches")}rr.hasExtendingTokensTypesProperty=hr;function pr(vr){return er.has(vr,"categoryMatchesMap")}rr.hasExtendingTokensTypesMapProperty=pr;function gr(vr){return er.has(vr,"tokenTypeIdx")}rr.isTokenType=gr}),kr=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.defaultLexerErrorProvider=void 0,rr.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(er){return"Unable to pop Lexer Mode after encountering Token ->"+er.image+"<- The Mode Stack is empty"},buildUnexpectedCharactersMessage:function(er,tr,ir,nr,sr){return"unexpected character: ->"+er.charAt(tr)+"<- at offset: "+tr+","+(" skipped "+ir+" characters.")}}}),ft=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.Lexer=rr.LexerDefinitionErrorType=void 0;var er=Tr(),tr=k(),ir=Xe(),nr=kr(),sr=Lt(),ar;(function(cr){cr[cr.MISSING_PATTERN=0]="MISSING_PATTERN",cr[cr.INVALID_PATTERN=1]="INVALID_PATTERN",cr[cr.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",cr[cr.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",cr[cr.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",cr[cr.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",cr[cr.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",cr[cr.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",cr[cr.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",cr[cr.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",cr[cr.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",cr[cr.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",cr[cr.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",cr[cr.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",cr[cr.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",cr[cr.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",cr[cr.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK"})(ar=rr.LexerDefinitionErrorType||(rr.LexerDefinitionErrorType={}));var or={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:nr.defaultLexerErrorProvider,traceInitPerf:!1,skipValidations:!1};Object.freeze(or);var lr=function(){function cr(ur,dr){var hr=this;if(dr===void 0&&(dr=or),this.lexerDefinition=ur,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof dr=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=tr.merge(or,dr);var pr=this.config.traceInitPerf;pr===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof pr=="number"&&(this.traceInitMaxIdent=pr,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",function(){var gr,vr=!0;hr.TRACE_INIT("Lexer Config handling",function(){if(hr.config.lineTerminatorsPattern===or.lineTerminatorsPattern)hr.config.lineTerminatorsPattern=er.LineTerminatorOptimizedTester;else if(hr.config.lineTerminatorCharacters===or.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(dr.safeMode&&dr.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');hr.trackStartLines=/full|onlyStart/i.test(hr.config.positionTracking),hr.trackEndLines=/full/i.test(hr.config.positionTracking),tr.isArray(ur)?(gr={modes:{}},gr.modes[er.DEFAULT_MODE]=tr.cloneArr(ur),gr[er.DEFAULT_MODE]=er.DEFAULT_MODE):(vr=!1,gr=tr.cloneObj(ur))}),hr.config.skipValidations===!1&&(hr.TRACE_INIT("performRuntimeChecks",function(){hr.lexerDefinitionErrors=hr.lexerDefinitionErrors.concat(er.performRuntimeChecks(gr,hr.trackStartLines,hr.config.lineTerminatorCharacters))}),hr.TRACE_INIT("performWarningRuntimeChecks",function(){hr.lexerDefinitionWarning=hr.lexerDefinitionWarning.concat(er.performWarningRuntimeChecks(gr,hr.trackStartLines,hr.config.lineTerminatorCharacters))})),gr.modes=gr.modes?gr.modes:{},tr.forEach(gr.modes,function(Ar,yr){gr.modes[yr]=tr.reject(Ar,function(wr){return tr.isUndefined(wr)})});var mr=tr.keys(gr.modes);if(tr.forEach(gr.modes,function(Ar,yr){hr.TRACE_INIT("Mode: <"+yr+"> processing",function(){if(hr.modes.push(yr),hr.config.skipValidations===!1&&hr.TRACE_INIT("validatePatterns",function(){hr.lexerDefinitionErrors=hr.lexerDefinitionErrors.concat(er.validatePatterns(Ar,mr))}),tr.isEmpty(hr.lexerDefinitionErrors)){ir.augmentTokenTypes(Ar);var wr;hr.TRACE_INIT("analyzeTokenTypes",function(){wr=er.analyzeTokenTypes(Ar,{lineTerminatorCharacters:hr.config.lineTerminatorCharacters,positionTracking:dr.positionTracking,ensureOptimizations:dr.ensureOptimizations,safeMode:dr.safeMode,tracer:hr.TRACE_INIT.bind(hr)})}),hr.patternIdxToConfig[yr]=wr.patternIdxToConfig,hr.charCodeToPatternIdxToConfig[yr]=wr.charCodeToPatternIdxToConfig,hr.emptyGroups=tr.merge(hr.emptyGroups,wr.emptyGroups),hr.hasCustom=wr.hasCustom||hr.hasCustom,hr.canModeBeOptimized[yr]=wr.canBeOptimized}})}),hr.defaultMode=gr.defaultMode,!tr.isEmpty(hr.lexerDefinitionErrors)&&!hr.config.deferDefinitionErrorsHandling){var fr=tr.map(hr.lexerDefinitionErrors,function(Ar){return Ar.message}),_r=fr.join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+_r)}tr.forEach(hr.lexerDefinitionWarning,function(Ar){tr.PRINT_WARNING(Ar.message)}),hr.TRACE_INIT("Choosing sub-methods implementations",function(){if(er.SUPPORT_STICKY?(hr.chopInput=tr.IDENTITY,hr.match=hr.matchWithTest):(hr.updateLastIndex=tr.NOOP,hr.match=hr.matchWithExec),vr&&(hr.handleModes=tr.NOOP),hr.trackStartLines===!1&&(hr.computeNewColumn=tr.IDENTITY),hr.trackEndLines===!1&&(hr.updateTokenEndLineColumnLocation=tr.NOOP),/full/i.test(hr.config.positionTracking))hr.createTokenInstance=hr.createFullToken;else if(/onlyStart/i.test(hr.config.positionTracking))hr.createTokenInstance=hr.createStartOnlyToken;else if(/onlyOffset/i.test(hr.config.positionTracking))hr.createTokenInstance=hr.createOffsetOnlyToken;else throw Error('Invalid <positionTracking> config option: "'+hr.config.positionTracking+'"');hr.hasCustom?(hr.addToken=hr.addTokenUsingPush,hr.handlePayload=hr.handlePayloadWithCustom):(hr.addToken=hr.addTokenUsingMemberAccess,hr.handlePayload=hr.handlePayloadNoCustom)}),hr.TRACE_INIT("Failed Optimization Warnings",function(){var Ar=tr.reduce(hr.canModeBeOptimized,function(yr,wr,xr){return wr===!1&&yr.push(xr),yr},[]);if(dr.ensureOptimizations&&!tr.isEmpty(Ar))throw Error("Lexer Modes: < "+Ar.join(", ")+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),hr.TRACE_INIT("clearRegExpParserCache",function(){sr.clearRegExpParserCache()}),hr.TRACE_INIT("toFastProperties",function(){tr.toFastProperties(hr)})})}return cr.prototype.tokenize=function(ur,dr){if(dr===void 0&&(dr=this.defaultMode),!tr.isEmpty(this.lexerDefinitionErrors)){var hr=tr.map(this.lexerDefinitionErrors,function(vr){return vr.message}),pr=hr.join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+pr)}var gr=this.tokenizeInternal(ur,dr);return gr},cr.prototype.tokenizeInternal=function(ur,dr){var hr=this,pr,gr,vr,mr,fr,_r,Ar,yr,wr,xr,Sr,br,Cr,Ir,Rr,Pr=ur,Dr=Pr.length,Fr=0,Or=0,Nr=this.hasCustom?0:Math.floor(ur.length/10),Ur=new Array(Nr),Br=[],Wr=this.trackStartLines?1:void 0,Xr=this.trackStartLines?1:void 0,Yr=er.cloneEmptyGroups(this.emptyGroups),Qi=this.trackStartLines,Xi=this.config.lineTerminatorsPattern,Kr=0,$r=[],Vr=[],Gr=[],qr=[];Object.freeze(qr);var ji=void 0;function Jr(){return $r}function Ji(_s){var As=er.charCodeToOptimizedIndex(_s),xs=Vr[As];return xs===void 0?qr:xs}var Ki=function(_s){if(Gr.length===1&&_s.tokenType.PUSH_MODE===void 0){var As=hr.config.errorMessageProvider.buildUnableToPopLexerModeMessage(_s);Br.push({offset:_s.startOffset,line:_s.startLine!==void 0?_s.startLine:void 0,column:_s.startColumn!==void 0?_s.startColumn:void 0,length:_s.image.length,message:As})}else{Gr.pop();var xs=tr.last(Gr);$r=hr.patternIdxToConfig[xs],Vr=hr.charCodeToPatternIdxToConfig[xs],Kr=$r.length;var Es=hr.canModeBeOptimized[xs]&&hr.config.safeMode===!1;Vr&&Es?ji=Ji:ji=Jr}};function Zi(_s){Gr.push(_s),Vr=this.charCodeToPatternIdxToConfig[_s],$r=this.patternIdxToConfig[_s],Kr=$r.length,Kr=$r.length;var As=this.canModeBeOptimized[_s]&&this.config.safeMode===!1;Vr&&As?ji=Ji:ji=Jr}Zi.call(this,dr);for(var Zr;Fr<Dr;){fr=null;var is=Pr.charCodeAt(Fr),os=ji(is),cs=os.length;for(pr=0;pr<cs;pr++){Zr=os[pr];var ss=Zr.pattern;_r=null;var es=Zr.short;if(es!==!1?is===es&&(fr=ss):Zr.isCustom===!0?(Rr=ss.exec(Pr,Fr,Ur,Yr),Rr!==null?(fr=Rr[0],Rr.payload!==void 0&&(_r=Rr.payload)):fr=null):(this.updateLastIndex(ss,Fr),fr=this.match(ss,ur,Fr)),fr!==null){if(mr=Zr.longerAlt,mr!==void 0){var ms=$r[mr],Yi=ms.pattern;Ar=null,ms.isCustom===!0?(Rr=Yi.exec(Pr,Fr,Ur,Yr),Rr!==null?(vr=Rr[0],Rr.payload!==void 0&&(Ar=Rr.payload)):vr=null):(this.updateLastIndex(Yi,Fr),vr=this.match(Yi,ur,Fr)),vr&&vr.length>fr.length&&(fr=vr,_r=Ar,Zr=ms)}break}}if(fr!==null){if(yr=fr.length,wr=Zr.group,wr!==void 0&&(xr=Zr.tokenTypeIdx,Sr=this.createTokenInstance(fr,Fr,xr,Zr.tokenType,Wr,Xr,yr),this.handlePayload(Sr,_r),wr===!1?Or=this.addToken(Ur,Or,Sr):Yr[wr].push(Sr)),ur=this.chopInput(ur,yr),Fr=Fr+yr,Xr=this.computeNewColumn(Xr,yr),Qi===!0&&Zr.canLineTerminator===!0){var Gi=0,Ni=void 0,Ri=void 0;Xi.lastIndex=0;do Ni=Xi.test(fr),Ni===!0&&(Ri=Xi.lastIndex-1,Gi++);while(Ni===!0);Gi!==0&&(Wr=Wr+Gi,Xr=yr-Ri,this.updateTokenEndLineColumnLocation(Sr,wr,Ri,Gi,Wr,Xr,yr))}this.handleModes(Zr,Ki,Zi,Sr)}else{for(var qi=Fr,as=Wr,us=Xr,gs=!1;!gs&&Fr<Dr;)for(Cr=Pr.charCodeAt(Fr),ur=this.chopInput(ur,1),Fr++,gr=0;gr<Kr;gr++){var vs=$r[gr],ss=vs.pattern,es=vs.short;if(es!==!1?Pr.charCodeAt(Fr)===es&&(gs=!0):vs.isCustom===!0?gs=ss.exec(Pr,Fr,Ur,Yr)!==null:(this.updateLastIndex(ss,Fr),gs=ss.exec(ur)!==null),gs===!0)break}br=Fr-qi,Ir=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(Pr,qi,br,as,us),Br.push({offset:qi,line:as,column:us,length:br,message:Ir})}}return this.hasCustom||(Ur.length=Or),{tokens:Ur,groups:Yr,errors:Br}},cr.prototype.handleModes=function(ur,dr,hr,pr){if(ur.pop===!0){var gr=ur.push;dr(pr),gr!==void 0&&hr.call(this,gr)}else ur.push!==void 0&&hr.call(this,ur.push)},cr.prototype.chopInput=function(ur,dr){return ur.substring(dr)},cr.prototype.updateLastIndex=function(ur,dr){ur.lastIndex=dr},cr.prototype.updateTokenEndLineColumnLocation=function(ur,dr,hr,pr,gr,vr,mr){var fr,_r;dr!==void 0&&(fr=hr===mr-1,_r=fr?-1:0,pr===1&&fr===!0||(ur.endLine=gr+_r,ur.endColumn=vr-1+-_r))},cr.prototype.computeNewColumn=function(ur,dr){return ur+dr},cr.prototype.createTokenInstance=function(){for(var ur=[],dr=0;dr<arguments.length;dr++)ur[dr]=arguments[dr];return null},cr.prototype.createOffsetOnlyToken=function(ur,dr,hr,pr){return{image:ur,startOffset:dr,tokenTypeIdx:hr,tokenType:pr}},cr.prototype.createStartOnlyToken=function(ur,dr,hr,pr,gr,vr){return{image:ur,startOffset:dr,startLine:gr,startColumn:vr,tokenTypeIdx:hr,tokenType:pr}},cr.prototype.createFullToken=function(ur,dr,hr,pr,gr,vr,mr){return{image:ur,startOffset:dr,endOffset:dr+mr-1,startLine:gr,endLine:gr,startColumn:vr,endColumn:vr+mr-1,tokenTypeIdx:hr,tokenType:pr}},cr.prototype.addToken=function(ur,dr,hr){return 666},cr.prototype.addTokenUsingPush=function(ur,dr,hr){return ur.push(hr),dr},cr.prototype.addTokenUsingMemberAccess=function(ur,dr,hr){return ur[dr]=hr,dr++,dr},cr.prototype.handlePayload=function(ur,dr){},cr.prototype.handlePayloadNoCustom=function(ur,dr){},cr.prototype.handlePayloadWithCustom=function(ur,dr){dr!==null&&(ur.payload=dr)},cr.prototype.match=function(ur,dr,hr){return null},cr.prototype.matchWithTest=function(ur,dr,hr){var pr=ur.test(dr);return pr===!0?dr.substring(hr,ur.lastIndex):null},cr.prototype.matchWithExec=function(ur,dr){var hr=ur.exec(dr);return hr!==null?hr[0]:hr},cr.prototype.TRACE_INIT=function(ur,dr){if(this.traceInitPerf===!0){this.traceInitIndent++;var hr=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(hr+"--> <"+ur+">");var pr=tr.timer(dr),gr=pr.time,vr=pr.value,mr=gr>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&mr(hr+"<-- <"+ur+"> time: "+gr+"ms"),this.traceInitIndent--,vr}else return dr()},cr.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",cr.NA=/NOT_APPLICABLE/,cr}();rr.Lexer=lr}),Ue=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.tokenMatcher=rr.createTokenInstance=rr.EOF=rr.createToken=rr.hasTokenLabel=rr.tokenName=rr.tokenLabel=void 0;var er=k(),tr=ft(),ir=Xe();function nr(yr){return ar(yr)?yr.LABEL:yr.name}rr.tokenLabel=nr;function sr(yr){return yr.name}rr.tokenName=sr;function ar(yr){return er.isString(yr.LABEL)&&yr.LABEL!==""}rr.hasTokenLabel=ar;var or="parent",lr="categories",cr="label",ur="group",dr="push_mode",hr="pop_mode",pr="longer_alt",gr="line_breaks",vr="start_chars_hint";function mr(yr){return fr(yr)}rr.createToken=mr;function fr(yr){var wr=yr.pattern,xr={};if(xr.name=yr.name,er.isUndefined(wr)||(xr.PATTERN=wr),er.has(yr,or))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return er.has(yr,lr)&&(xr.CATEGORIES=yr[lr]),ir.augmentTokenTypes([xr]),er.has(yr,cr)&&(xr.LABEL=yr[cr]),er.has(yr,ur)&&(xr.GROUP=yr[ur]),er.has(yr,hr)&&(xr.POP_MODE=yr[hr]),er.has(yr,dr)&&(xr.PUSH_MODE=yr[dr]),er.has(yr,pr)&&(xr.LONGER_ALT=yr[pr]),er.has(yr,gr)&&(xr.LINE_BREAKS=yr[gr]),er.has(yr,vr)&&(xr.START_CHARS_HINT=yr[vr]),xr}rr.EOF=mr({name:"EOF",pattern:tr.Lexer.NA}),ir.augmentTokenTypes([rr.EOF]);function _r(yr,wr,xr,Sr,br,Cr,Ir,Rr){return{image:wr,startOffset:xr,endOffset:Sr,startLine:br,endLine:Cr,startColumn:Ir,endColumn:Rr,tokenTypeIdx:yr.tokenTypeIdx,tokenType:yr}}rr.createTokenInstance=_r;function Ar(yr,wr){return ir.tokenStructuredMatcher(yr,wr)}rr.tokenMatcher=Ar}),ne=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var fr=function(_r,Ar){return fr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(yr,wr){yr.__proto__=wr}||function(yr,wr){for(var xr in wr)Object.prototype.hasOwnProperty.call(wr,xr)&&(yr[xr]=wr[xr])},fr(_r,Ar)};return function(_r,Ar){if(typeof Ar!="function"&&Ar!==null)throw new TypeError("Class extends value "+String(Ar)+" is not a constructor or null");fr(_r,Ar);function yr(){this.constructor=_r}_r.prototype=Ar===null?Object.create(Ar):(yr.prototype=Ar.prototype,new yr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.serializeProduction=rr.serializeGrammar=rr.Terminal=rr.Alternation=rr.RepetitionWithSeparator=rr.Repetition=rr.RepetitionMandatoryWithSeparator=rr.RepetitionMandatory=rr.Option=rr.Alternative=rr.Rule=rr.NonTerminal=rr.AbstractProduction=void 0;var tr=k(),ir=Ue(),nr=function(){function fr(_r){this._definition=_r}return Object.defineProperty(fr.prototype,"definition",{get:function(){return this._definition},set:function(_r){this._definition=_r},enumerable:!1,configurable:!0}),fr.prototype.accept=function(_r){_r.visit(this),tr.forEach(this.definition,function(Ar){Ar.accept(_r)})},fr}();rr.AbstractProduction=nr;var sr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,[])||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return Object.defineProperty(_r.prototype,"definition",{get:function(){return this.referencedRule!==void 0?this.referencedRule.definition:[]},set:function(Ar){},enumerable:!1,configurable:!0}),_r.prototype.accept=function(Ar){Ar.visit(this)},_r}(nr);rr.NonTerminal=sr;var ar=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.orgText="",tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.Rule=ar;var or=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.ignoreAmbiguities=!1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.Alternative=or;var lr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.Option=lr;var cr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.RepetitionMandatory=cr;var ur=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.RepetitionMandatoryWithSeparator=ur;var dr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.Repetition=dr;var hr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return _r}(nr);rr.RepetitionWithSeparator=hr;var pr=function(fr){er(_r,fr);function _r(Ar){var yr=fr.call(this,Ar.definition)||this;return yr.idx=1,yr.ignoreAmbiguities=!1,yr.hasPredicates=!1,tr.assign(yr,tr.pick(Ar,function(wr){return wr!==void 0})),yr}return Object.defineProperty(_r.prototype,"definition",{get:function(){return this._definition},set:function(Ar){this._definition=Ar},enumerable:!1,configurable:!0}),_r}(nr);rr.Alternation=pr;var gr=function(){function fr(_r){this.idx=1,tr.assign(this,tr.pick(_r,function(Ar){return Ar!==void 0}))}return fr.prototype.accept=function(_r){_r.visit(this)},fr}();rr.Terminal=gr;function vr(fr){return tr.map(fr,mr)}rr.serializeGrammar=vr;function mr(fr){function _r(wr){return tr.map(wr,mr)}if(fr instanceof sr)return{type:"NonTerminal",name:fr.nonTerminalName,idx:fr.idx};if(fr instanceof or)return{type:"Alternative",definition:_r(fr.definition)};if(fr instanceof lr)return{type:"Option",idx:fr.idx,definition:_r(fr.definition)};if(fr instanceof cr)return{type:"RepetitionMandatory",idx:fr.idx,definition:_r(fr.definition)};if(fr instanceof ur)return{type:"RepetitionMandatoryWithSeparator",idx:fr.idx,separator:mr(new gr({terminalType:fr.separator})),definition:_r(fr.definition)};if(fr instanceof hr)return{type:"RepetitionWithSeparator",idx:fr.idx,separator:mr(new gr({terminalType:fr.separator})),definition:_r(fr.definition)};if(fr instanceof dr)return{type:"Repetition",idx:fr.idx,definition:_r(fr.definition)};if(fr instanceof pr)return{type:"Alternation",idx:fr.idx,definition:_r(fr.definition)};if(fr instanceof gr){var Ar={type:"Terminal",name:fr.terminalType.name,label:ir.tokenLabel(fr.terminalType),idx:fr.idx},yr=fr.terminalType.PATTERN;return fr.terminalType.PATTERN&&(Ar.pattern=tr.isRegExp(yr)?yr.source:yr),Ar}else{if(fr instanceof ar)return{type:"Rule",name:fr.name,orgText:fr.orgText,definition:_r(fr.definition)};throw Error("non exhaustive match")}}rr.serializeProduction=mr}),Gt=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.RestWalker=void 0;var er=k(),tr=ne(),ir=function(){function sr(){}return sr.prototype.walk=function(ar,or){var lr=this;or===void 0&&(or=[]),er.forEach(ar.definition,function(cr,ur){var dr=er.drop(ar.definition,ur+1);if(cr instanceof tr.NonTerminal)lr.walkProdRef(cr,dr,or);else if(cr instanceof tr.Terminal)lr.walkTerminal(cr,dr,or);else if(cr instanceof tr.Alternative)lr.walkFlat(cr,dr,or);else if(cr instanceof tr.Option)lr.walkOption(cr,dr,or);else if(cr instanceof tr.RepetitionMandatory)lr.walkAtLeastOne(cr,dr,or);else if(cr instanceof tr.RepetitionMandatoryWithSeparator)lr.walkAtLeastOneSep(cr,dr,or);else if(cr instanceof tr.RepetitionWithSeparator)lr.walkManySep(cr,dr,or);else if(cr instanceof tr.Repetition)lr.walkMany(cr,dr,or);else if(cr instanceof tr.Alternation)lr.walkOr(cr,dr,or);else throw Error("non exhaustive match")})},sr.prototype.walkTerminal=function(ar,or,lr){},sr.prototype.walkProdRef=function(ar,or,lr){},sr.prototype.walkFlat=function(ar,or,lr){var cr=or.concat(lr);this.walk(ar,cr)},sr.prototype.walkOption=function(ar,or,lr){var cr=or.concat(lr);this.walk(ar,cr)},sr.prototype.walkAtLeastOne=function(ar,or,lr){var cr=[new tr.Option({definition:ar.definition})].concat(or,lr);this.walk(ar,cr)},sr.prototype.walkAtLeastOneSep=function(ar,or,lr){var cr=nr(ar,or,lr);this.walk(ar,cr)},sr.prototype.walkMany=function(ar,or,lr){var cr=[new tr.Option({definition:ar.definition})].concat(or,lr);this.walk(ar,cr)},sr.prototype.walkManySep=function(ar,or,lr){var cr=nr(ar,or,lr);this.walk(ar,cr)},sr.prototype.walkOr=function(ar,or,lr){var cr=this,ur=or.concat(lr);er.forEach(ar.definition,function(dr){var hr=new tr.Alternative({definition:[dr]});cr.walk(hr,ur)})},sr}();rr.RestWalker=ir;function nr(sr,ar,or){var lr=[new tr.Option({definition:[new tr.Terminal({terminalType:sr.separator})].concat(sr.definition)})],cr=lr.concat(ar,or);return cr}}),$e=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.GAstVisitor=void 0;var er=ne(),tr=function(){function ir(){}return ir.prototype.visit=function(nr){var sr=nr;switch(sr.constructor){case er.NonTerminal:return this.visitNonTerminal(sr);case er.Alternative:return this.visitAlternative(sr);case er.Option:return this.visitOption(sr);case er.RepetitionMandatory:return this.visitRepetitionMandatory(sr);case er.RepetitionMandatoryWithSeparator:return this.visitRepetitionMandatoryWithSeparator(sr);case er.RepetitionWithSeparator:return this.visitRepetitionWithSeparator(sr);case er.Repetition:return this.visitRepetition(sr);case er.Alternation:return this.visitAlternation(sr);case er.Terminal:return this.visitTerminal(sr);case er.Rule:return this.visitRule(sr);default:throw Error("non exhaustive match")}},ir.prototype.visitNonTerminal=function(nr){},ir.prototype.visitAlternative=function(nr){},ir.prototype.visitOption=function(nr){},ir.prototype.visitRepetition=function(nr){},ir.prototype.visitRepetitionMandatory=function(nr){},ir.prototype.visitRepetitionMandatoryWithSeparator=function(nr){},ir.prototype.visitRepetitionWithSeparator=function(nr){},ir.prototype.visitAlternation=function(nr){},ir.prototype.visitTerminal=function(nr){},ir.prototype.visitRule=function(nr){},ir}();rr.GAstVisitor=tr}),vt=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var hr=function(pr,gr){return hr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(vr,mr){vr.__proto__=mr}||function(vr,mr){for(var fr in mr)Object.prototype.hasOwnProperty.call(mr,fr)&&(vr[fr]=mr[fr])},hr(pr,gr)};return function(pr,gr){if(typeof gr!="function"&&gr!==null)throw new TypeError("Class extends value "+String(gr)+" is not a constructor or null");hr(pr,gr);function vr(){this.constructor=pr}pr.prototype=gr===null?Object.create(gr):(vr.prototype=gr.prototype,new vr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.collectMethods=rr.DslMethodsCollectorVisitor=rr.getProductionDslName=rr.isBranchingProd=rr.isOptionalProd=rr.isSequenceProd=void 0;var tr=k(),ir=ne(),nr=$e();function sr(hr){return hr instanceof ir.Alternative||hr instanceof ir.Option||hr instanceof ir.Repetition||hr instanceof ir.RepetitionMandatory||hr instanceof ir.RepetitionMandatoryWithSeparator||hr instanceof ir.RepetitionWithSeparator||hr instanceof ir.Terminal||hr instanceof ir.Rule}rr.isSequenceProd=sr;function ar(hr,pr){pr===void 0&&(pr=[]);var gr=hr instanceof ir.Option||hr instanceof ir.Repetition||hr instanceof ir.RepetitionWithSeparator;return gr?!0:hr instanceof ir.Alternation?tr.some(hr.definition,function(vr){return ar(vr,pr)}):hr instanceof ir.NonTerminal&&tr.contains(pr,hr)?!1:hr instanceof ir.AbstractProduction?(hr instanceof ir.NonTerminal&&pr.push(hr),tr.every(hr.definition,function(vr){return ar(vr,pr)})):!1}rr.isOptionalProd=ar;function or(hr){return hr instanceof ir.Alternation}rr.isBranchingProd=or;function lr(hr){if(hr instanceof ir.NonTerminal)return"SUBRULE";if(hr instanceof ir.Option)return"OPTION";if(hr instanceof ir.Alternation)return"OR";if(hr instanceof ir.RepetitionMandatory)return"AT_LEAST_ONE";if(hr instanceof ir.RepetitionMandatoryWithSeparator)return"AT_LEAST_ONE_SEP";if(hr instanceof ir.RepetitionWithSeparator)return"MANY_SEP";if(hr instanceof ir.Repetition)return"MANY";if(hr instanceof ir.Terminal)return"CONSUME";throw Error("non exhaustive match")}rr.getProductionDslName=lr;var cr=function(hr){er(pr,hr);function pr(){var gr=hr!==null&&hr.apply(this,arguments)||this;return gr.separator="-",gr.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},gr}return pr.prototype.reset=function(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}},pr.prototype.visitTerminal=function(gr){var vr=gr.terminalType.name+this.separator+"Terminal";tr.has(this.dslMethods,vr)||(this.dslMethods[vr]=[]),this.dslMethods[vr].push(gr)},pr.prototype.visitNonTerminal=function(gr){var vr=gr.nonTerminalName+this.separator+"Terminal";tr.has(this.dslMethods,vr)||(this.dslMethods[vr]=[]),this.dslMethods[vr].push(gr)},pr.prototype.visitOption=function(gr){this.dslMethods.option.push(gr)},pr.prototype.visitRepetitionWithSeparator=function(gr){this.dslMethods.repetitionWithSeparator.push(gr)},pr.prototype.visitRepetitionMandatory=function(gr){this.dslMethods.repetitionMandatory.push(gr)},pr.prototype.visitRepetitionMandatoryWithSeparator=function(gr){this.dslMethods.repetitionMandatoryWithSeparator.push(gr)},pr.prototype.visitRepetition=function(gr){this.dslMethods.repetition.push(gr)},pr.prototype.visitAlternation=function(gr){this.dslMethods.alternation.push(gr)},pr}(nr.GAstVisitor);rr.DslMethodsCollectorVisitor=cr;var ur=new cr;function dr(hr){ur.reset(),hr.accept(ur);var pr=ur.dslMethods;return ur.reset(),pr}rr.collectMethods=dr}),Lr=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.firstForTerminal=rr.firstForBranching=rr.firstForSequence=rr.first=void 0;var er=k(),tr=ne(),ir=vt();function nr(lr){if(lr instanceof tr.NonTerminal)return nr(lr.referencedRule);if(lr instanceof tr.Terminal)return or(lr);if(ir.isSequenceProd(lr))return sr(lr);if(ir.isBranchingProd(lr))return ar(lr);throw Error("non exhaustive match")}rr.first=nr;function sr(lr){for(var cr=[],ur=lr.definition,dr=0,hr=ur.length>dr,pr,gr=!0;hr&&gr;)pr=ur[dr],gr=ir.isOptionalProd(pr),cr=cr.concat(nr(pr)),dr=dr+1,hr=ur.length>dr;return er.uniq(cr)}rr.firstForSequence=sr;function ar(lr){var cr=er.map(lr.definition,function(ur){return nr(ur)});return er.uniq(er.flatten(cr))}rr.firstForBranching=ar;function or(lr){return[lr.terminalType]}rr.firstForTerminal=or}),Mr=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.IN=void 0,rr.IN="_~IN~_"}),pi=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var dr=function(hr,pr){return dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(gr,vr){gr.__proto__=vr}||function(gr,vr){for(var mr in vr)Object.prototype.hasOwnProperty.call(vr,mr)&&(gr[mr]=vr[mr])},dr(hr,pr)};return function(hr,pr){if(typeof pr!="function"&&pr!==null)throw new TypeError("Class extends value "+String(pr)+" is not a constructor or null");dr(hr,pr);function gr(){this.constructor=hr}hr.prototype=pr===null?Object.create(pr):(gr.prototype=pr.prototype,new gr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.buildInProdFollowPrefix=rr.buildBetweenProdsFollowPrefix=rr.computeAllProdsFollows=rr.ResyncFollowsWalker=void 0;var tr=Gt(),ir=Lr(),nr=k(),sr=Mr(),ar=ne(),or=function(dr){er(hr,dr);function hr(pr){var gr=dr.call(this)||this;return gr.topProd=pr,gr.follows={},gr}return hr.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},hr.prototype.walkTerminal=function(pr,gr,vr){},hr.prototype.walkProdRef=function(pr,gr,vr){var mr=cr(pr.referencedRule,pr.idx)+this.topProd.name,fr=gr.concat(vr),_r=new ar.Alternative({definition:fr}),Ar=ir.first(_r);this.follows[mr]=Ar},hr}(tr.RestWalker);rr.ResyncFollowsWalker=or;function lr(dr){var hr={};return nr.forEach(dr,function(pr){var gr=new or(pr).startWalking();nr.assign(hr,gr)}),hr}rr.computeAllProdsFollows=lr;function cr(dr,hr){return dr.name+hr+sr.IN}rr.buildBetweenProdsFollowPrefix=cr;function ur(dr){var hr=dr.terminalType.name;return hr+dr.idx+sr.IN}rr.buildInProdFollowPrefix=ur}),mt=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.defaultGrammarValidatorErrorProvider=rr.defaultGrammarResolverErrorProvider=rr.defaultParserErrorProvider=void 0;var er=Ue(),tr=k(),ir=k(),nr=ne(),sr=vt();rr.defaultParserErrorProvider={buildMismatchTokenMessage:function(ar){var or=ar.expected,lr=ar.actual,cr=ar.previous,ur=ar.ruleName,dr=er.hasTokenLabel(or),hr=dr?"--> "+er.tokenLabel(or)+" <--":"token of type --> "+or.name+" <--",pr="Expecting "+hr+" but found --> '"+lr.image+"' <--";return pr},buildNotAllInputParsedMessage:function(ar){var or=ar.firstRedundant,lr=ar.ruleName;return"Redundant input, expecting EOF but found: "+or.image},buildNoViableAltMessage:function(ar){var or=ar.expectedPathsPerAlt,lr=ar.actual,cr=ar.previous,ur=ar.customUserDescription,dr=ar.ruleName,hr="Expecting: ",pr=ir.first(lr).image,gr=`
but found: '`+pr+"'";if(ur)return hr+ur+gr;var vr=ir.reduce(or,function(Ar,yr){return Ar.concat(yr)},[]),mr=ir.map(vr,function(Ar){return"["+ir.map(Ar,function(yr){return er.tokenLabel(yr)}).join(", ")+"]"}),fr=ir.map(mr,function(Ar,yr){return"  "+(yr+1)+". "+Ar}),_r=`one of these possible Token sequences:
`+fr.join(`
`);return hr+_r+gr},buildEarlyExitMessage:function(ar){var or=ar.expectedIterationPaths,lr=ar.actual,cr=ar.customUserDescription,ur=ar.ruleName,dr="Expecting: ",hr=ir.first(lr).image,pr=`
but found: '`+hr+"'";if(cr)return dr+cr+pr;var gr=ir.map(or,function(mr){return"["+ir.map(mr,function(fr){return er.tokenLabel(fr)}).join(",")+"]"}),vr=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+("<"+gr.join(" ,")+">");return dr+vr+pr}},Object.freeze(rr.defaultParserErrorProvider),rr.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(ar,or){var lr="Invalid grammar, reference to a rule which is not defined: ->"+or.nonTerminalName+`<-
inside top level rule: ->`+ar.name+"<-";return lr}},rr.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(ar,or){function lr(mr){return mr instanceof nr.Terminal?mr.terminalType.name:mr instanceof nr.NonTerminal?mr.nonTerminalName:""}var cr=ar.name,ur=ir.first(or),dr=ur.idx,hr=sr.getProductionDslName(ur),pr=lr(ur),gr=dr>0,vr="->"+hr+(gr?dr:"")+"<- "+(pr?"with argument: ->"+pr+"<-":"")+`
                  appears more than once (`+or.length+" times) in the top level rule: ->"+cr+`<-.
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES
                  `;return vr=vr.replace(/[ \t]+/g," "),vr=vr.replace(/\s\s+/g,`
`),vr},buildNamespaceConflictError:function(ar){var or=`Namespace conflict found in grammar.
`+("The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <"+ar.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`;return or},buildAlternationPrefixAmbiguityError:function(ar){var or=ir.map(ar.prefixPath,function(ur){return er.tokenLabel(ur)}).join(", "),lr=ar.alternation.idx===0?"":ar.alternation.idx,cr="Ambiguous alternatives: <"+ar.ambiguityIndices.join(" ,")+`> due to common lookahead prefix
`+("in <OR"+lr+"> inside <"+ar.topLevelRule.name+`> Rule,
`)+("<"+or+`> may appears as a prefix path in all these alternatives.
`)+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`;return cr},buildAlternationAmbiguityError:function(ar){var or=ir.map(ar.prefixPath,function(ur){return er.tokenLabel(ur)}).join(", "),lr=ar.alternation.idx===0?"":ar.alternation.idx,cr="Ambiguous Alternatives Detected: <"+ar.ambiguityIndices.join(" ,")+"> in <OR"+lr+">"+(" inside <"+ar.topLevelRule.name+`> Rule,
`)+("<"+or+`> may appears as a prefix path in all these alternatives.
`);return cr=cr+`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,cr},buildEmptyRepetitionError:function(ar){var or=sr.getProductionDslName(ar.repetition);ar.repetition.idx!==0&&(or+=ar.repetition.idx);var lr="The repetition <"+or+"> within Rule <"+ar.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`;return lr},buildTokenNameError:function(ar){return"deprecated"},buildEmptyAlternationError:function(ar){var or="Ambiguous empty alternative: <"+(ar.emptyChoiceIdx+1)+">"+(" in <OR"+ar.alternation.idx+"> inside <"+ar.topLevelRule.name+`> Rule.
`)+"Only the last alternative may be an empty alternative.";return or},buildTooManyAlternativesError:function(ar){var or=`An Alternation cannot have more than 256 alternatives:
`+("<OR"+ar.alternation.idx+"> inside <"+ar.topLevelRule.name+`> Rule.
 has `+(ar.alternation.definition.length+1)+" alternatives.");return or},buildLeftRecursionError:function(ar){var or=ar.topLevelRule.name,lr=tr.map(ar.leftRecursionPath,function(dr){return dr.name}),cr=or+" --> "+lr.concat([or]).join(" --> "),ur=`Left Recursion found in grammar.
`+("rule: <"+or+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is:
 `+cr+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`;return ur},buildInvalidRuleNameError:function(ar){return"deprecated"},buildDuplicateRuleNameError:function(ar){var or;ar.topLevelRule instanceof nr.Rule?or=ar.topLevelRule.name:or=ar.topLevelRule;var lr="Duplicate definition, rule: ->"+or+"<- is already defined in the grammar: ->"+ar.grammarName+"<-";return lr}}}),mi=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var or=function(lr,cr){return or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(ur,dr){ur.__proto__=dr}||function(ur,dr){for(var hr in dr)Object.prototype.hasOwnProperty.call(dr,hr)&&(ur[hr]=dr[hr])},or(lr,cr)};return function(lr,cr){if(typeof cr!="function"&&cr!==null)throw new TypeError("Class extends value "+String(cr)+" is not a constructor or null");or(lr,cr);function ur(){this.constructor=lr}lr.prototype=cr===null?Object.create(cr):(ur.prototype=cr.prototype,new ur)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.GastRefResolverVisitor=rr.resolveGrammar=void 0;var tr=ce(),ir=k(),nr=$e();function sr(or,lr){var cr=new ar(or,lr);return cr.resolveRefs(),cr.errors}rr.resolveGrammar=sr;var ar=function(or){er(lr,or);function lr(cr,ur){var dr=or.call(this)||this;return dr.nameToTopRule=cr,dr.errMsgProvider=ur,dr.errors=[],dr}return lr.prototype.resolveRefs=function(){var cr=this;ir.forEach(ir.values(this.nameToTopRule),function(ur){cr.currTopLevel=ur,ur.accept(cr)})},lr.prototype.visitNonTerminal=function(cr){var ur=this.nameToTopRule[cr.nonTerminalName];if(ur)cr.referencedRule=ur;else{var dr=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,cr);this.errors.push({message:dr,type:tr.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:cr.nonTerminalName})}},lr}(nr.GAstVisitor);rr.GastRefResolverVisitor=ar}),Tt=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var mr=function(fr,_r){return mr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ar,yr){Ar.__proto__=yr}||function(Ar,yr){for(var wr in yr)Object.prototype.hasOwnProperty.call(yr,wr)&&(Ar[wr]=yr[wr])},mr(fr,_r)};return function(fr,_r){if(typeof _r!="function"&&_r!==null)throw new TypeError("Class extends value "+String(_r)+" is not a constructor or null");mr(fr,_r);function Ar(){this.constructor=fr}fr.prototype=_r===null?Object.create(_r):(Ar.prototype=_r.prototype,new Ar)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.nextPossibleTokensAfter=rr.possiblePathsFrom=rr.NextTerminalAfterAtLeastOneSepWalker=rr.NextTerminalAfterAtLeastOneWalker=rr.NextTerminalAfterManySepWalker=rr.NextTerminalAfterManyWalker=rr.AbstractNextTerminalAfterProductionWalker=rr.NextAfterTokenWalker=rr.AbstractNextPossibleTokensWalker=void 0;var tr=Gt(),ir=k(),nr=Lr(),sr=ne(),ar=function(mr){er(fr,mr);function fr(_r,Ar){var yr=mr.call(this)||this;return yr.topProd=_r,yr.path=Ar,yr.possibleTokTypes=[],yr.nextProductionName="",yr.nextProductionOccurrence=0,yr.found=!1,yr.isAtEndOfPath=!1,yr}return fr.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=ir.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=ir.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},fr.prototype.walk=function(_r,Ar){Ar===void 0&&(Ar=[]),this.found||mr.prototype.walk.call(this,_r,Ar)},fr.prototype.walkProdRef=function(_r,Ar,yr){if(_r.referencedRule.name===this.nextProductionName&&_r.idx===this.nextProductionOccurrence){var wr=Ar.concat(yr);this.updateExpectedNext(),this.walk(_r.referencedRule,wr)}},fr.prototype.updateExpectedNext=function(){ir.isEmpty(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},fr}(tr.RestWalker);rr.AbstractNextPossibleTokensWalker=ar;var or=function(mr){er(fr,mr);function fr(_r,Ar){var yr=mr.call(this,_r,Ar)||this;return yr.path=Ar,yr.nextTerminalName="",yr.nextTerminalOccurrence=0,yr.nextTerminalName=yr.path.lastTok.name,yr.nextTerminalOccurrence=yr.path.lastTokOccurrence,yr}return fr.prototype.walkTerminal=function(_r,Ar,yr){if(this.isAtEndOfPath&&_r.terminalType.name===this.nextTerminalName&&_r.idx===this.nextTerminalOccurrence&&!this.found){var wr=Ar.concat(yr),xr=new sr.Alternative({definition:wr});this.possibleTokTypes=nr.first(xr),this.found=!0}},fr}(ar);rr.NextAfterTokenWalker=or;var lr=function(mr){er(fr,mr);function fr(_r,Ar){var yr=mr.call(this)||this;return yr.topRule=_r,yr.occurrence=Ar,yr.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},yr}return fr.prototype.startWalking=function(){return this.walk(this.topRule),this.result},fr}(tr.RestWalker);rr.AbstractNextTerminalAfterProductionWalker=lr;var cr=function(mr){er(fr,mr);function fr(){return mr!==null&&mr.apply(this,arguments)||this}return fr.prototype.walkMany=function(_r,Ar,yr){if(_r.idx===this.occurrence){var wr=ir.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkMany.call(this,_r,Ar,yr)},fr}(lr);rr.NextTerminalAfterManyWalker=cr;var ur=function(mr){er(fr,mr);function fr(){return mr!==null&&mr.apply(this,arguments)||this}return fr.prototype.walkManySep=function(_r,Ar,yr){if(_r.idx===this.occurrence){var wr=ir.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkManySep.call(this,_r,Ar,yr)},fr}(lr);rr.NextTerminalAfterManySepWalker=ur;var dr=function(mr){er(fr,mr);function fr(){return mr!==null&&mr.apply(this,arguments)||this}return fr.prototype.walkAtLeastOne=function(_r,Ar,yr){if(_r.idx===this.occurrence){var wr=ir.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkAtLeastOne.call(this,_r,Ar,yr)},fr}(lr);rr.NextTerminalAfterAtLeastOneWalker=dr;var hr=function(mr){er(fr,mr);function fr(){return mr!==null&&mr.apply(this,arguments)||this}return fr.prototype.walkAtLeastOneSep=function(_r,Ar,yr){if(_r.idx===this.occurrence){var wr=ir.first(Ar.concat(yr));this.result.isEndOfRule=wr===void 0,wr instanceof sr.Terminal&&(this.result.token=wr.terminalType,this.result.occurrence=wr.idx)}else mr.prototype.walkAtLeastOneSep.call(this,_r,Ar,yr)},fr}(lr);rr.NextTerminalAfterAtLeastOneSepWalker=hr;function pr(mr,fr,_r){_r===void 0&&(_r=[]),_r=ir.cloneArr(_r);var Ar=[],yr=0;function wr(Cr){return Cr.concat(ir.drop(mr,yr+1))}function xr(Cr){var Ir=pr(wr(Cr),fr,_r);return Ar.concat(Ir)}for(;_r.length<fr&&yr<mr.length;){var Sr=mr[yr];if(Sr instanceof sr.Alternative||Sr instanceof sr.NonTerminal)return xr(Sr.definition);if(Sr instanceof sr.Option)Ar=xr(Sr.definition);else if(Sr instanceof sr.RepetitionMandatory){var br=Sr.definition.concat([new sr.Repetition({definition:Sr.definition})]);return xr(br)}else if(Sr instanceof sr.RepetitionMandatoryWithSeparator){var br=[new sr.Alternative({definition:Sr.definition}),new sr.Repetition({definition:[new sr.Terminal({terminalType:Sr.separator})].concat(Sr.definition)})];return xr(br)}else if(Sr instanceof sr.RepetitionWithSeparator){var br=Sr.definition.concat([new sr.Repetition({definition:[new sr.Terminal({terminalType:Sr.separator})].concat(Sr.definition)})]);Ar=xr(br)}else if(Sr instanceof sr.Repetition){var br=Sr.definition.concat([new sr.Repetition({definition:Sr.definition})]);Ar=xr(br)}else{if(Sr instanceof sr.Alternation)return ir.forEach(Sr.definition,function(Cr){ir.isEmpty(Cr.definition)===!1&&(Ar=xr(Cr.definition))}),Ar;if(Sr instanceof sr.Terminal)_r.push(Sr.terminalType);else throw Error("non exhaustive match")}yr++}return Ar.push({partialPath:_r,suffixDef:ir.drop(mr,yr)}),Ar}rr.possiblePathsFrom=pr;function gr(mr,fr,_r,Ar){var yr="EXIT_NONE_TERMINAL",wr=[yr],xr="EXIT_ALTERNATIVE",Sr=!1,br=fr.length,Cr=br-Ar-1,Ir=[],Rr=[];for(Rr.push({idx:-1,def:mr,ruleStack:[],occurrenceStack:[]});!ir.isEmpty(Rr);){var Pr=Rr.pop();if(Pr===xr){Sr&&ir.last(Rr).idx<=Cr&&Rr.pop();continue}var Dr=Pr.def,Fr=Pr.idx,Or=Pr.ruleStack,Nr=Pr.occurrenceStack;if(!ir.isEmpty(Dr)){var Ur=Dr[0];if(Ur===yr){var Br={idx:Fr,def:ir.drop(Dr),ruleStack:ir.dropRight(Or),occurrenceStack:ir.dropRight(Nr)};Rr.push(Br)}else if(Ur instanceof sr.Terminal)if(Fr<br-1){var Wr=Fr+1,Xr=fr[Wr];if(_r(Xr,Ur.terminalType)){var Br={idx:Wr,def:ir.drop(Dr),ruleStack:Or,occurrenceStack:Nr};Rr.push(Br)}}else if(Fr===br-1)Ir.push({nextTokenType:Ur.terminalType,nextTokenOccurrence:Ur.idx,ruleStack:Or,occurrenceStack:Nr}),Sr=!0;else throw Error("non exhaustive match");else if(Ur instanceof sr.NonTerminal){var Yr=ir.cloneArr(Or);Yr.push(Ur.nonTerminalName);var Qi=ir.cloneArr(Nr);Qi.push(Ur.idx);var Br={idx:Fr,def:Ur.definition.concat(wr,ir.drop(Dr)),ruleStack:Yr,occurrenceStack:Qi};Rr.push(Br)}else if(Ur instanceof sr.Option){var Xi={idx:Fr,def:ir.drop(Dr),ruleStack:Or,occurrenceStack:Nr};Rr.push(Xi),Rr.push(xr);var Kr={idx:Fr,def:Ur.definition.concat(ir.drop(Dr)),ruleStack:Or,occurrenceStack:Nr};Rr.push(Kr)}else if(Ur instanceof sr.RepetitionMandatory){var $r=new sr.Repetition({definition:Ur.definition,idx:Ur.idx}),Vr=Ur.definition.concat([$r],ir.drop(Dr)),Br={idx:Fr,def:Vr,ruleStack:Or,occurrenceStack:Nr};Rr.push(Br)}else if(Ur instanceof sr.RepetitionMandatoryWithSeparator){var Gr=new sr.Terminal({terminalType:Ur.separator}),$r=new sr.Repetition({definition:[Gr].concat(Ur.definition),idx:Ur.idx}),Vr=Ur.definition.concat([$r],ir.drop(Dr)),Br={idx:Fr,def:Vr,ruleStack:Or,occurrenceStack:Nr};Rr.push(Br)}else if(Ur instanceof sr.RepetitionWithSeparator){var Xi={idx:Fr,def:ir.drop(Dr),ruleStack:Or,occurrenceStack:Nr};Rr.push(Xi),Rr.push(xr);var Gr=new sr.Terminal({terminalType:Ur.separator}),qr=new sr.Repetition({definition:[Gr].concat(Ur.definition),idx:Ur.idx}),Vr=Ur.definition.concat([qr],ir.drop(Dr)),Kr={idx:Fr,def:Vr,ruleStack:Or,occurrenceStack:Nr};Rr.push(Kr)}else if(Ur instanceof sr.Repetition){var Xi={idx:Fr,def:ir.drop(Dr),ruleStack:Or,occurrenceStack:Nr};Rr.push(Xi),Rr.push(xr);var qr=new sr.Repetition({definition:Ur.definition,idx:Ur.idx}),Vr=Ur.definition.concat([qr],ir.drop(Dr)),Kr={idx:Fr,def:Vr,ruleStack:Or,occurrenceStack:Nr};Rr.push(Kr)}else if(Ur instanceof sr.Alternation)for(var ji=Ur.definition.length-1;ji>=0;ji--){var Jr=Ur.definition[ji],Ji={idx:Fr,def:Jr.definition.concat(ir.drop(Dr)),ruleStack:Or,occurrenceStack:Nr};Rr.push(Ji),Rr.push(xr)}else if(Ur instanceof sr.Alternative)Rr.push({idx:Fr,def:Ur.definition.concat(ir.drop(Dr)),ruleStack:Or,occurrenceStack:Nr});else if(Ur instanceof sr.Rule)Rr.push(vr(Ur,Fr,Or,Nr));else throw Error("non exhaustive match")}}return Ir}rr.nextPossibleTokensAfter=gr;function vr(mr,fr,_r,Ar){var yr=ir.cloneArr(_r);yr.push(mr.name);var wr=ir.cloneArr(Ar);return wr.push(1),{idx:fr,def:mr.definition,ruleStack:yr,occurrenceStack:wr}}}),yt=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var Cr=function(Ir,Rr){return Cr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Pr,Dr){Pr.__proto__=Dr}||function(Pr,Dr){for(var Fr in Dr)Object.prototype.hasOwnProperty.call(Dr,Fr)&&(Pr[Fr]=Dr[Fr])},Cr(Ir,Rr)};return function(Ir,Rr){if(typeof Rr!="function"&&Rr!==null)throw new TypeError("Class extends value "+String(Rr)+" is not a constructor or null");Cr(Ir,Rr);function Pr(){this.constructor=Ir}Ir.prototype=Rr===null?Object.create(Rr):(Pr.prototype=Rr.prototype,new Pr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.areTokenCategoriesNotUsed=rr.isStrictPrefixOfPath=rr.containsPath=rr.getLookaheadPathsForOptionalProd=rr.getLookaheadPathsForOr=rr.lookAheadSequenceFromAlternatives=rr.buildSingleAlternativeLookaheadFunction=rr.buildAlternativesLookAheadFunc=rr.buildLookaheadFuncForOptionalProd=rr.buildLookaheadFuncForOr=rr.getProdType=rr.PROD_TYPE=void 0;var tr=k(),ir=Tt(),nr=Gt(),sr=Xe(),ar=ne(),or=$e(),lr;(function(Cr){Cr[Cr.OPTION=0]="OPTION",Cr[Cr.REPETITION=1]="REPETITION",Cr[Cr.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",Cr[Cr.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",Cr[Cr.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",Cr[Cr.ALTERNATION=5]="ALTERNATION"})(lr=rr.PROD_TYPE||(rr.PROD_TYPE={}));function cr(Cr){if(Cr instanceof ar.Option)return lr.OPTION;if(Cr instanceof ar.Repetition)return lr.REPETITION;if(Cr instanceof ar.RepetitionMandatory)return lr.REPETITION_MANDATORY;if(Cr instanceof ar.RepetitionMandatoryWithSeparator)return lr.REPETITION_MANDATORY_WITH_SEPARATOR;if(Cr instanceof ar.RepetitionWithSeparator)return lr.REPETITION_WITH_SEPARATOR;if(Cr instanceof ar.Alternation)return lr.ALTERNATION;throw Error("non exhaustive match")}rr.getProdType=cr;function ur(Cr,Ir,Rr,Pr,Dr,Fr){var Or=yr(Cr,Ir,Rr),Nr=br(Or)?sr.tokenStructuredMatcherNoCategories:sr.tokenStructuredMatcher;return Fr(Or,Pr,Nr,Dr)}rr.buildLookaheadFuncForOr=ur;function dr(Cr,Ir,Rr,Pr,Dr,Fr){var Or=wr(Cr,Ir,Dr,Rr),Nr=br(Or)?sr.tokenStructuredMatcherNoCategories:sr.tokenStructuredMatcher;return Fr(Or[0],Nr,Pr)}rr.buildLookaheadFuncForOptionalProd=dr;function hr(Cr,Ir,Rr,Pr){var Dr=Cr.length,Fr=tr.every(Cr,function(Ur){return tr.every(Ur,function(Br){return Br.length===1})});if(Ir)return function(Ur){for(var Br=tr.map(Ur,function(qr){return qr.GATE}),Wr=0;Wr<Dr;Wr++){var Xr=Cr[Wr],Yr=Xr.length,Qi=Br[Wr];if(!(Qi!==void 0&&Qi.call(this)===!1))e:for(var Xi=0;Xi<Yr;Xi++){for(var Kr=Xr[Xi],$r=Kr.length,Vr=0;Vr<$r;Vr++){var Gr=this.LA(Vr+1);if(Rr(Gr,Kr[Vr])===!1)continue e}return Wr}}};if(Fr&&!Pr){var Or=tr.map(Cr,function(Ur){return tr.flatten(Ur)}),Nr=tr.reduce(Or,function(Ur,Br,Wr){return tr.forEach(Br,function(Xr){tr.has(Ur,Xr.tokenTypeIdx)||(Ur[Xr.tokenTypeIdx]=Wr),tr.forEach(Xr.categoryMatches,function(Yr){tr.has(Ur,Yr)||(Ur[Yr]=Wr)})}),Ur},[]);return function(){var Ur=this.LA(1);return Nr[Ur.tokenTypeIdx]}}else return function(){for(var Ur=0;Ur<Dr;Ur++){var Br=Cr[Ur],Wr=Br.length;e:for(var Xr=0;Xr<Wr;Xr++){for(var Yr=Br[Xr],Qi=Yr.length,Xi=0;Xi<Qi;Xi++){var Kr=this.LA(Xi+1);if(Rr(Kr,Yr[Xi])===!1)continue e}return Ur}}}}rr.buildAlternativesLookAheadFunc=hr;function pr(Cr,Ir,Rr){var Pr=tr.every(Cr,function(Br){return Br.length===1}),Dr=Cr.length;if(Pr&&!Rr){var Fr=tr.flatten(Cr);if(Fr.length===1&&tr.isEmpty(Fr[0].categoryMatches)){var Or=Fr[0],Nr=Or.tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===Nr}}else{var Ur=tr.reduce(Fr,function(Br,Wr,Xr){return Br[Wr.tokenTypeIdx]=!0,tr.forEach(Wr.categoryMatches,function(Yr){Br[Yr]=!0}),Br},[]);return function(){var Br=this.LA(1);return Ur[Br.tokenTypeIdx]===!0}}}else return function(){e:for(var Br=0;Br<Dr;Br++){for(var Wr=Cr[Br],Xr=Wr.length,Yr=0;Yr<Xr;Yr++){var Qi=this.LA(Yr+1);if(Ir(Qi,Wr[Yr])===!1)continue e}return!0}return!1}}rr.buildSingleAlternativeLookaheadFunction=pr;var gr=function(Cr){er(Ir,Cr);function Ir(Rr,Pr,Dr){var Fr=Cr.call(this)||this;return Fr.topProd=Rr,Fr.targetOccurrence=Pr,Fr.targetProdType=Dr,Fr}return Ir.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},Ir.prototype.checkIsTarget=function(Rr,Pr,Dr,Fr){return Rr.idx===this.targetOccurrence&&this.targetProdType===Pr?(this.restDef=Dr.concat(Fr),!0):!1},Ir.prototype.walkOption=function(Rr,Pr,Dr){this.checkIsTarget(Rr,lr.OPTION,Pr,Dr)||Cr.prototype.walkOption.call(this,Rr,Pr,Dr)},Ir.prototype.walkAtLeastOne=function(Rr,Pr,Dr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY,Pr,Dr)||Cr.prototype.walkOption.call(this,Rr,Pr,Dr)},Ir.prototype.walkAtLeastOneSep=function(Rr,Pr,Dr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY_WITH_SEPARATOR,Pr,Dr)||Cr.prototype.walkOption.call(this,Rr,Pr,Dr)},Ir.prototype.walkMany=function(Rr,Pr,Dr){this.checkIsTarget(Rr,lr.REPETITION,Pr,Dr)||Cr.prototype.walkOption.call(this,Rr,Pr,Dr)},Ir.prototype.walkManySep=function(Rr,Pr,Dr){this.checkIsTarget(Rr,lr.REPETITION_WITH_SEPARATOR,Pr,Dr)||Cr.prototype.walkOption.call(this,Rr,Pr,Dr)},Ir}(nr.RestWalker),vr=function(Cr){er(Ir,Cr);function Ir(Rr,Pr,Dr){var Fr=Cr.call(this)||this;return Fr.targetOccurrence=Rr,Fr.targetProdType=Pr,Fr.targetRef=Dr,Fr.result=[],Fr}return Ir.prototype.checkIsTarget=function(Rr,Pr){Rr.idx===this.targetOccurrence&&this.targetProdType===Pr&&(this.targetRef===void 0||Rr===this.targetRef)&&(this.result=Rr.definition)},Ir.prototype.visitOption=function(Rr){this.checkIsTarget(Rr,lr.OPTION)},Ir.prototype.visitRepetition=function(Rr){this.checkIsTarget(Rr,lr.REPETITION)},Ir.prototype.visitRepetitionMandatory=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY)},Ir.prototype.visitRepetitionMandatoryWithSeparator=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_MANDATORY_WITH_SEPARATOR)},Ir.prototype.visitRepetitionWithSeparator=function(Rr){this.checkIsTarget(Rr,lr.REPETITION_WITH_SEPARATOR)},Ir.prototype.visitAlternation=function(Rr){this.checkIsTarget(Rr,lr.ALTERNATION)},Ir}(or.GAstVisitor);function mr(Cr){for(var Ir=new Array(Cr),Rr=0;Rr<Cr;Rr++)Ir[Rr]=[];return Ir}function fr(Cr){for(var Ir=[""],Rr=0;Rr<Cr.length;Rr++){for(var Pr=Cr[Rr],Dr=[],Fr=0;Fr<Ir.length;Fr++){var Or=Ir[Fr];Dr.push(Or+"_"+Pr.tokenTypeIdx);for(var Nr=0;Nr<Pr.categoryMatches.length;Nr++){var Ur="_"+Pr.categoryMatches[Nr];Dr.push(Or+Ur)}}Ir=Dr}return Ir}function _r(Cr,Ir,Rr){for(var Pr=0;Pr<Cr.length;Pr++)if(Pr!==Rr)for(var Dr=Cr[Pr],Fr=0;Fr<Ir.length;Fr++){var Or=Ir[Fr];if(Dr[Or]===!0)return!1}return!0}function Ar(Cr,Ir){for(var Rr=tr.map(Cr,function(Wr){return ir.possiblePathsFrom([Wr],1)}),Pr=mr(Rr.length),Dr=tr.map(Rr,function(Wr){var Xr={};return tr.forEach(Wr,function(Yr){var Qi=fr(Yr.partialPath);tr.forEach(Qi,function(Xi){Xr[Xi]=!0})}),Xr}),Fr=Rr,Or=1;Or<=Ir;Or++){var Nr=Fr;Fr=mr(Nr.length);for(var Ur=function(Wr){for(var Xr=Nr[Wr],Yr=0;Yr<Xr.length;Yr++){var Qi=Xr[Yr].partialPath,Xi=Xr[Yr].suffixDef,Kr=fr(Qi),$r=_r(Dr,Kr,Wr);if($r||tr.isEmpty(Xi)||Qi.length===Ir){var Vr=Pr[Wr];if(xr(Vr,Qi)===!1){Vr.push(Qi);for(var Gr=0;Gr<Kr.length;Gr++){var qr=Kr[Gr];Dr[Wr][qr]=!0}}}else{var ji=ir.possiblePathsFrom(Xi,Or+1,Qi);Fr[Wr]=Fr[Wr].concat(ji),tr.forEach(ji,function(Jr){var Ji=fr(Jr.partialPath);tr.forEach(Ji,function(Ki){Dr[Wr][Ki]=!0})})}}},Br=0;Br<Nr.length;Br++)Ur(Br)}return Pr}rr.lookAheadSequenceFromAlternatives=Ar;function yr(Cr,Ir,Rr,Pr){var Dr=new vr(Cr,lr.ALTERNATION,Pr);return Ir.accept(Dr),Ar(Dr.result,Rr)}rr.getLookaheadPathsForOr=yr;function wr(Cr,Ir,Rr,Pr){var Dr=new vr(Cr,Rr);Ir.accept(Dr);var Fr=Dr.result,Or=new gr(Ir,Cr,Rr),Nr=Or.startWalking(),Ur=new ar.Alternative({definition:Fr}),Br=new ar.Alternative({definition:Nr});return Ar([Ur,Br],Pr)}rr.getLookaheadPathsForOptionalProd=wr;function xr(Cr,Ir){e:for(var Rr=0;Rr<Cr.length;Rr++){var Pr=Cr[Rr];if(Pr.length===Ir.length){for(var Dr=0;Dr<Pr.length;Dr++){var Fr=Ir[Dr],Or=Pr[Dr],Nr=Fr===Or||Or.categoryMatchesMap[Fr.tokenTypeIdx]!==void 0;if(Nr===!1)continue e}return!0}}return!1}rr.containsPath=xr;function Sr(Cr,Ir){return Cr.length<Ir.length&&tr.every(Cr,function(Rr,Pr){var Dr=Ir[Pr];return Rr===Dr||Dr.categoryMatchesMap[Rr.tokenTypeIdx]})}rr.isStrictPrefixOfPath=Sr;function br(Cr){return tr.every(Cr,function(Ir){return tr.every(Ir,function(Rr){return tr.every(Rr,function(Pr){return tr.isEmpty(Pr.categoryMatches)})})})}rr.areTokenCategoriesNotUsed=br}),jr=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var Pr=function(Dr,Fr){return Pr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Or,Nr){Or.__proto__=Nr}||function(Or,Nr){for(var Ur in Nr)Object.prototype.hasOwnProperty.call(Nr,Ur)&&(Or[Ur]=Nr[Ur])},Pr(Dr,Fr)};return function(Dr,Fr){if(typeof Fr!="function"&&Fr!==null)throw new TypeError("Class extends value "+String(Fr)+" is not a constructor or null");Pr(Dr,Fr);function Or(){this.constructor=Dr}Dr.prototype=Fr===null?Object.create(Fr):(Or.prototype=Fr.prototype,new Or)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.checkPrefixAlternativesAmbiguities=rr.validateSomeNonEmptyLookaheadPath=rr.validateTooManyAlts=rr.RepetionCollector=rr.validateAmbiguousAlternationAlternatives=rr.validateEmptyOrAlternative=rr.getFirstNoneTerminal=rr.validateNoLeftRecursion=rr.validateRuleIsOverridden=rr.validateRuleDoesNotAlreadyExist=rr.OccurrenceValidationCollector=rr.identifyProductionForDuplicates=rr.validateGrammar=void 0;var tr=k(),ir=k(),nr=ce(),sr=vt(),ar=yt(),or=Tt(),lr=ne(),cr=$e();function ur(Pr,Dr,Fr,Or,Nr){var Ur=tr.map(Pr,function($r){return dr($r,Or)}),Br=tr.map(Pr,function($r){return fr($r,$r,Or)}),Wr=[],Xr=[],Yr=[];ir.every(Br,ir.isEmpty)&&(Wr=ir.map(Pr,function($r){return yr($r,Or)}),Xr=ir.map(Pr,function($r){return wr($r,Dr,Or)}),Yr=br(Pr,Dr,Or));var Qi=Rr(Pr,Fr,Or),Xi=ir.map(Pr,function($r){return Sr($r,Or)}),Kr=ir.map(Pr,function($r){return vr($r,Pr,Nr,Or)});return tr.flatten(Ur.concat(Yr,Br,Wr,Xr,Qi,Xi,Kr))}rr.validateGrammar=ur;function dr(Pr,Dr){var Fr=new gr;Pr.accept(Fr);var Or=Fr.allProductions,Nr=tr.groupBy(Or,hr),Ur=tr.pick(Nr,function(Wr){return Wr.length>1}),Br=tr.map(tr.values(Ur),function(Wr){var Xr=tr.first(Wr),Yr=Dr.buildDuplicateFoundError(Pr,Wr),Qi=sr.getProductionDslName(Xr),Xi={message:Yr,type:nr.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:Pr.name,dslName:Qi,occurrence:Xr.idx},Kr=pr(Xr);return Kr&&(Xi.parameter=Kr),Xi});return Br}function hr(Pr){return sr.getProductionDslName(Pr)+"_#_"+Pr.idx+"_#_"+pr(Pr)}rr.identifyProductionForDuplicates=hr;function pr(Pr){return Pr instanceof lr.Terminal?Pr.terminalType.name:Pr instanceof lr.NonTerminal?Pr.nonTerminalName:""}var gr=function(Pr){er(Dr,Pr);function Dr(){var Fr=Pr!==null&&Pr.apply(this,arguments)||this;return Fr.allProductions=[],Fr}return Dr.prototype.visitNonTerminal=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitOption=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetitionWithSeparator=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetitionMandatory=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetitionMandatoryWithSeparator=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetition=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitAlternation=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitTerminal=function(Fr){this.allProductions.push(Fr)},Dr}(cr.GAstVisitor);rr.OccurrenceValidationCollector=gr;function vr(Pr,Dr,Fr,Or){var Nr=[],Ur=ir.reduce(Dr,function(Wr,Xr){return Xr.name===Pr.name?Wr+1:Wr},0);if(Ur>1){var Br=Or.buildDuplicateRuleNameError({topLevelRule:Pr,grammarName:Fr});Nr.push({message:Br,type:nr.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:Pr.name})}return Nr}rr.validateRuleDoesNotAlreadyExist=vr;function mr(Pr,Dr,Fr){var Or=[],Nr;return tr.contains(Dr,Pr)||(Nr="Invalid rule override, rule: ->"+Pr+"<- cannot be overridden in the grammar: ->"+Fr+"<-as it is not defined in any of the super grammars ",Or.push({message:Nr,type:nr.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:Pr})),Or}rr.validateRuleIsOverridden=mr;function fr(Pr,Dr,Fr,Or){Or===void 0&&(Or=[]);var Nr=[],Ur=_r(Dr.definition);if(tr.isEmpty(Ur))return[];var Br=Pr.name,Wr=tr.contains(Ur,Pr);Wr&&Nr.push({message:Fr.buildLeftRecursionError({topLevelRule:Pr,leftRecursionPath:Or}),type:nr.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:Br});var Xr=tr.difference(Ur,Or.concat([Pr])),Yr=tr.map(Xr,function(Qi){var Xi=tr.cloneArr(Or);return Xi.push(Qi),fr(Pr,Qi,Fr,Xi)});return Nr.concat(tr.flatten(Yr))}rr.validateNoLeftRecursion=fr;function _r(Pr){var Dr=[];if(tr.isEmpty(Pr))return Dr;var Fr=tr.first(Pr);if(Fr instanceof lr.NonTerminal)Dr.push(Fr.referencedRule);else if(Fr instanceof lr.Alternative||Fr instanceof lr.Option||Fr instanceof lr.RepetitionMandatory||Fr instanceof lr.RepetitionMandatoryWithSeparator||Fr instanceof lr.RepetitionWithSeparator||Fr instanceof lr.Repetition)Dr=Dr.concat(_r(Fr.definition));else if(Fr instanceof lr.Alternation)Dr=tr.flatten(tr.map(Fr.definition,function(Br){return _r(Br.definition)}));else if(!(Fr instanceof lr.Terminal))throw Error("non exhaustive match");var Or=sr.isOptionalProd(Fr),Nr=Pr.length>1;if(Or&&Nr){var Ur=tr.drop(Pr);return Dr.concat(_r(Ur))}else return Dr}rr.getFirstNoneTerminal=_r;var Ar=function(Pr){er(Dr,Pr);function Dr(){var Fr=Pr!==null&&Pr.apply(this,arguments)||this;return Fr.alternations=[],Fr}return Dr.prototype.visitAlternation=function(Fr){this.alternations.push(Fr)},Dr}(cr.GAstVisitor);function yr(Pr,Dr){var Fr=new Ar;Pr.accept(Fr);var Or=Fr.alternations,Nr=tr.reduce(Or,function(Ur,Br){var Wr=tr.dropRight(Br.definition),Xr=tr.map(Wr,function(Yr,Qi){var Xi=or.nextPossibleTokensAfter([Yr],[],null,1);return tr.isEmpty(Xi)?{message:Dr.buildEmptyAlternationError({topLevelRule:Pr,alternation:Br,emptyChoiceIdx:Qi}),type:nr.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:Pr.name,occurrence:Br.idx,alternative:Qi+1}:null});return Ur.concat(tr.compact(Xr))},[]);return Nr}rr.validateEmptyOrAlternative=yr;function wr(Pr,Dr,Fr){var Or=new Ar;Pr.accept(Or);var Nr=Or.alternations;Nr=ir.reject(Nr,function(Br){return Br.ignoreAmbiguities===!0});var Ur=tr.reduce(Nr,function(Br,Wr){var Xr=Wr.idx,Yr=Wr.maxLookahead||Dr,Qi=ar.getLookaheadPathsForOr(Xr,Pr,Yr,Wr),Xi=Cr(Qi,Wr,Pr,Fr),Kr=Ir(Qi,Wr,Pr,Fr);return Br.concat(Xi,Kr)},[]);return Ur}rr.validateAmbiguousAlternationAlternatives=wr;var xr=function(Pr){er(Dr,Pr);function Dr(){var Fr=Pr!==null&&Pr.apply(this,arguments)||this;return Fr.allProductions=[],Fr}return Dr.prototype.visitRepetitionWithSeparator=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetitionMandatory=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetitionMandatoryWithSeparator=function(Fr){this.allProductions.push(Fr)},Dr.prototype.visitRepetition=function(Fr){this.allProductions.push(Fr)},Dr}(cr.GAstVisitor);rr.RepetionCollector=xr;function Sr(Pr,Dr){var Fr=new Ar;Pr.accept(Fr);var Or=Fr.alternations,Nr=tr.reduce(Or,function(Ur,Br){return Br.definition.length>255&&Ur.push({message:Dr.buildTooManyAlternativesError({topLevelRule:Pr,alternation:Br}),type:nr.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:Pr.name,occurrence:Br.idx}),Ur},[]);return Nr}rr.validateTooManyAlts=Sr;function br(Pr,Dr,Fr){var Or=[];return ir.forEach(Pr,function(Nr){var Ur=new xr;Nr.accept(Ur);var Br=Ur.allProductions;ir.forEach(Br,function(Wr){var Xr=ar.getProdType(Wr),Yr=Wr.maxLookahead||Dr,Qi=Wr.idx,Xi=ar.getLookaheadPathsForOptionalProd(Qi,Nr,Xr,Yr),Kr=Xi[0];if(ir.isEmpty(ir.flatten(Kr))){var $r=Fr.buildEmptyRepetitionError({topLevelRule:Nr,repetition:Wr});Or.push({message:$r,type:nr.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:Nr.name})}})}),Or}rr.validateSomeNonEmptyLookaheadPath=br;function Cr(Pr,Dr,Fr,Or){var Nr=[],Ur=ir.reduce(Pr,function(Wr,Xr,Yr){return Dr.definition[Yr].ignoreAmbiguities===!0||ir.forEach(Xr,function(Qi){var Xi=[Yr];ir.forEach(Pr,function(Kr,$r){Yr!==$r&&ar.containsPath(Kr,Qi)&&Dr.definition[$r].ignoreAmbiguities!==!0&&Xi.push($r)}),Xi.length>1&&!ar.containsPath(Nr,Qi)&&(Nr.push(Qi),Wr.push({alts:Xi,path:Qi}))}),Wr},[]),Br=tr.map(Ur,function(Wr){var Xr=ir.map(Wr.alts,function(Qi){return Qi+1}),Yr=Or.buildAlternationAmbiguityError({topLevelRule:Fr,alternation:Dr,ambiguityIndices:Xr,prefixPath:Wr.path});return{message:Yr,type:nr.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:Fr.name,occurrence:Dr.idx,alternatives:[Wr.alts]}});return Br}function Ir(Pr,Dr,Fr,Or){var Nr=[],Ur=ir.reduce(Pr,function(Br,Wr,Xr){var Yr=ir.map(Wr,function(Qi){return{idx:Xr,path:Qi}});return Br.concat(Yr)},[]);return ir.forEach(Ur,function(Br){var Wr=Dr.definition[Br.idx];if(Wr.ignoreAmbiguities!==!0){var Xr=Br.idx,Yr=Br.path,Qi=ir.findAll(Ur,function(Kr){return Dr.definition[Kr.idx].ignoreAmbiguities!==!0&&Kr.idx<Xr&&ar.isStrictPrefixOfPath(Kr.path,Yr)}),Xi=ir.map(Qi,function(Kr){var $r=[Kr.idx+1,Xr+1],Vr=Dr.idx===0?"":Dr.idx,Gr=Or.buildAlternationPrefixAmbiguityError({topLevelRule:Fr,alternation:Dr,ambiguityIndices:$r,prefixPath:Kr.path});return{message:Gr,type:nr.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:Fr.name,occurrence:Vr,alternatives:$r}});Nr=Nr.concat(Xi)}}),Nr}rr.checkPrefixAlternativesAmbiguities=Ir;function Rr(Pr,Dr,Fr){var Or=[],Nr=ir.map(Dr,function(Ur){return Ur.name});return ir.forEach(Pr,function(Ur){var Br=Ur.name;if(ir.contains(Nr,Br)){var Wr=Fr.buildNamespaceConflictError(Ur);Or.push({message:Wr,type:nr.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:Br})}}),Or}}),Ui=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.validateGrammar=rr.resolveGrammar=void 0;var er=k(),tr=mi(),ir=jr(),nr=mt();function sr(or){or=er.defaults(or,{errMsgProvider:nr.defaultGrammarResolverErrorProvider});var lr={};return er.forEach(or.rules,function(cr){lr[cr.name]=cr}),tr.resolveGrammar(lr,or.errMsgProvider)}rr.resolveGrammar=sr;function ar(or){return or=er.defaults(or,{errMsgProvider:nr.defaultGrammarValidatorErrorProvider}),ir.validateGrammar(or.rules,or.maxLookahead,or.tokenTypes,or.errMsgProvider,or.grammarName)}rr.validateGrammar=ar}),et=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var gr=function(vr,mr){return gr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(fr,_r){fr.__proto__=_r}||function(fr,_r){for(var Ar in _r)Object.prototype.hasOwnProperty.call(_r,Ar)&&(fr[Ar]=_r[Ar])},gr(vr,mr)};return function(vr,mr){if(typeof mr!="function"&&mr!==null)throw new TypeError("Class extends value "+String(mr)+" is not a constructor or null");gr(vr,mr);function fr(){this.constructor=vr}vr.prototype=mr===null?Object.create(mr):(fr.prototype=mr.prototype,new fr)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.EarlyExitException=rr.NotAllInputParsedException=rr.NoViableAltException=rr.MismatchedTokenException=rr.isRecognitionException=void 0;var tr=k(),ir="MismatchedTokenException",nr="NoViableAltException",sr="EarlyExitException",ar="NotAllInputParsedException",or=[ir,nr,sr,ar];Object.freeze(or);function lr(gr){return tr.contains(or,gr.name)}rr.isRecognitionException=lr;var cr=function(gr){er(vr,gr);function vr(mr,fr){var _r=this.constructor,Ar=gr.call(this,mr)||this;return Ar.token=fr,Ar.resyncedTokens=[],Object.setPrototypeOf(Ar,_r.prototype),Error.captureStackTrace&&Error.captureStackTrace(Ar,Ar.constructor),Ar}return vr}(Error),ur=function(gr){er(vr,gr);function vr(mr,fr,_r){var Ar=gr.call(this,mr,fr)||this;return Ar.previousToken=_r,Ar.name=ir,Ar}return vr}(cr);rr.MismatchedTokenException=ur;var dr=function(gr){er(vr,gr);function vr(mr,fr,_r){var Ar=gr.call(this,mr,fr)||this;return Ar.previousToken=_r,Ar.name=nr,Ar}return vr}(cr);rr.NoViableAltException=dr;var hr=function(gr){er(vr,gr);function vr(mr,fr){var _r=gr.call(this,mr,fr)||this;return _r.name=ar,_r}return vr}(cr);rr.NotAllInputParsedException=hr;var pr=function(gr){er(vr,gr);function vr(mr,fr,_r){var Ar=gr.call(this,mr,fr)||this;return Ar.previousToken=_r,Ar.name=sr,Ar}return vr}(cr);rr.EarlyExitException=pr}),zr=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.attemptInRepetitionRecovery=rr.Recoverable=rr.InRuleRecoveryException=rr.IN_RULE_RECOVERY_EXCEPTION=rr.EOF_FOLLOW_KEY=void 0;var er=Ue(),tr=k(),ir=et(),nr=Mr(),sr=ce();rr.EOF_FOLLOW_KEY={},rr.IN_RULE_RECOVERY_EXCEPTION="InRuleRecoveryException";function ar(cr){this.name=rr.IN_RULE_RECOVERY_EXCEPTION,this.message=cr}rr.InRuleRecoveryException=ar,ar.prototype=Error.prototype;var or=function(){function cr(){}return cr.prototype.initRecoverable=function(ur){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=tr.has(ur,"recoveryEnabled")?ur.recoveryEnabled:sr.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=lr)},cr.prototype.getTokenToInsert=function(ur){var dr=er.createTokenInstance(ur,"",NaN,NaN,NaN,NaN,NaN,NaN);return dr.isInsertedInRecovery=!0,dr},cr.prototype.canTokenTypeBeInsertedInRecovery=function(ur){return!0},cr.prototype.tryInRepetitionRecovery=function(ur,dr,hr,pr){for(var gr=this,vr=this.findReSyncTokenType(),mr=this.exportLexerState(),fr=[],_r=!1,Ar=this.LA(1),yr=this.LA(1),wr=function(){var xr=gr.LA(0),Sr=gr.errorMessageProvider.buildMismatchTokenMessage({expected:pr,actual:Ar,previous:xr,ruleName:gr.getCurrRuleFullName()}),br=new ir.MismatchedTokenException(Sr,Ar,gr.LA(0));br.resyncedTokens=tr.dropRight(fr),gr.SAVE_ERROR(br)};!_r;)if(this.tokenMatcher(yr,pr)){wr();return}else if(hr.call(this)){wr(),ur.apply(this,dr);return}else this.tokenMatcher(yr,vr)?_r=!0:(yr=this.SKIP_TOKEN(),this.addToResyncTokens(yr,fr));this.importLexerState(mr)},cr.prototype.shouldInRepetitionRecoveryBeTried=function(ur,dr,hr){return!(hr===!1||ur===void 0||dr===void 0||this.tokenMatcher(this.LA(1),ur)||this.isBackTracking()||this.canPerformInRuleRecovery(ur,this.getFollowsForInRuleRecovery(ur,dr)))},cr.prototype.getFollowsForInRuleRecovery=function(ur,dr){var hr=this.getCurrentGrammarPath(ur,dr),pr=this.getNextPossibleTokenTypes(hr);return pr},cr.prototype.tryInRuleRecovery=function(ur,dr){if(this.canRecoverWithSingleTokenInsertion(ur,dr)){var hr=this.getTokenToInsert(ur);return hr}if(this.canRecoverWithSingleTokenDeletion(ur)){var pr=this.SKIP_TOKEN();return this.consumeToken(),pr}throw new ar("sad sad panda")},cr.prototype.canPerformInRuleRecovery=function(ur,dr){return this.canRecoverWithSingleTokenInsertion(ur,dr)||this.canRecoverWithSingleTokenDeletion(ur)},cr.prototype.canRecoverWithSingleTokenInsertion=function(ur,dr){var hr=this;if(!this.canTokenTypeBeInsertedInRecovery(ur)||tr.isEmpty(dr))return!1;var pr=this.LA(1),gr=tr.find(dr,function(vr){return hr.tokenMatcher(pr,vr)})!==void 0;return gr},cr.prototype.canRecoverWithSingleTokenDeletion=function(ur){var dr=this.tokenMatcher(this.LA(2),ur);return dr},cr.prototype.isInCurrentRuleReSyncSet=function(ur){var dr=this.getCurrFollowKey(),hr=this.getFollowSetFromFollowKey(dr);return tr.contains(hr,ur)},cr.prototype.findReSyncTokenType=function(){for(var ur=this.flattenFollowSet(),dr=this.LA(1),hr=2;;){var pr=dr.tokenType;if(tr.contains(ur,pr))return pr;dr=this.LA(hr),hr++}},cr.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return rr.EOF_FOLLOW_KEY;var ur=this.getLastExplicitRuleShortName(),dr=this.getLastExplicitRuleOccurrenceIndex(),hr=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(ur),idxInCallingRule:dr,inRule:this.shortRuleNameToFullName(hr)}},cr.prototype.buildFullFollowKeyStack=function(){var ur=this,dr=this.RULE_STACK,hr=this.RULE_OCCURRENCE_STACK;return tr.map(dr,function(pr,gr){return gr===0?rr.EOF_FOLLOW_KEY:{ruleName:ur.shortRuleNameToFullName(pr),idxInCallingRule:hr[gr],inRule:ur.shortRuleNameToFullName(dr[gr-1])}})},cr.prototype.flattenFollowSet=function(){var ur=this,dr=tr.map(this.buildFullFollowKeyStack(),function(hr){return ur.getFollowSetFromFollowKey(hr)});return tr.flatten(dr)},cr.prototype.getFollowSetFromFollowKey=function(ur){if(ur===rr.EOF_FOLLOW_KEY)return[er.EOF];var dr=ur.ruleName+ur.idxInCallingRule+nr.IN+ur.inRule;return this.resyncFollows[dr]},cr.prototype.addToResyncTokens=function(ur,dr){return this.tokenMatcher(ur,er.EOF)||dr.push(ur),dr},cr.prototype.reSyncTo=function(ur){for(var dr=[],hr=this.LA(1);this.tokenMatcher(hr,ur)===!1;)hr=this.SKIP_TOKEN(),this.addToResyncTokens(hr,dr);return tr.dropRight(dr)},cr.prototype.attemptInRepetitionRecovery=function(ur,dr,hr,pr,gr,vr,mr){},cr.prototype.getCurrentGrammarPath=function(ur,dr){var hr=this.getHumanReadableRuleStack(),pr=tr.cloneArr(this.RULE_OCCURRENCE_STACK),gr={ruleStack:hr,occurrenceStack:pr,lastTok:ur,lastTokOccurrence:dr};return gr},cr.prototype.getHumanReadableRuleStack=function(){var ur=this;return tr.map(this.RULE_STACK,function(dr){return ur.shortRuleNameToFullName(dr)})},cr}();rr.Recoverable=or;function lr(cr,ur,dr,hr,pr,gr,vr){var mr=this.getKeyForAutomaticLookahead(hr,pr),fr=this.firstAfterRepMap[mr];if(fr===void 0){var _r=this.getCurrRuleFullName(),Ar=this.getGAstProductions()[_r],yr=new gr(Ar,pr);fr=yr.startWalking(),this.firstAfterRepMap[mr]=fr}var wr=fr.token,xr=fr.occurrence,Sr=fr.isEndOfRule;this.RULE_STACK.length===1&&Sr&&wr===void 0&&(wr=er.EOF,xr=1),this.shouldInRepetitionRecoveryBeTried(wr,xr,vr)&&this.tryInRepetitionRecovery(cr,ur,dr,wr)}rr.attemptInRepetitionRecovery=lr}),Yt=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.getKeyForAutomaticLookahead=rr.AT_LEAST_ONE_SEP_IDX=rr.MANY_SEP_IDX=rr.AT_LEAST_ONE_IDX=rr.MANY_IDX=rr.OPTION_IDX=rr.OR_IDX=rr.BITS_FOR_ALT_IDX=rr.BITS_FOR_RULE_IDX=rr.BITS_FOR_OCCURRENCE_IDX=rr.BITS_FOR_METHOD_TYPE=void 0,rr.BITS_FOR_METHOD_TYPE=4,rr.BITS_FOR_OCCURRENCE_IDX=8,rr.BITS_FOR_RULE_IDX=12,rr.BITS_FOR_ALT_IDX=8,rr.OR_IDX=1<<rr.BITS_FOR_OCCURRENCE_IDX,rr.OPTION_IDX=2<<rr.BITS_FOR_OCCURRENCE_IDX,rr.MANY_IDX=3<<rr.BITS_FOR_OCCURRENCE_IDX,rr.AT_LEAST_ONE_IDX=4<<rr.BITS_FOR_OCCURRENCE_IDX,rr.MANY_SEP_IDX=5<<rr.BITS_FOR_OCCURRENCE_IDX,rr.AT_LEAST_ONE_SEP_IDX=6<<rr.BITS_FOR_OCCURRENCE_IDX;function er(ir,nr,sr){return sr|nr|ir}rr.getKeyForAutomaticLookahead=er;var tr=32-rr.BITS_FOR_ALT_IDX}),zi=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.LooksAhead=void 0;var er=yt(),tr=k(),ir=ce(),nr=Yt(),sr=vt(),ar=function(){function or(){}return or.prototype.initLooksAhead=function(lr){this.dynamicTokensEnabled=tr.has(lr,"dynamicTokensEnabled")?lr.dynamicTokensEnabled:ir.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=tr.has(lr,"maxLookahead")?lr.maxLookahead:ir.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=tr.isES2015MapSupported()?new Map:[],tr.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},or.prototype.preComputeLookaheadFunctions=function(lr){var cr=this;tr.forEach(lr,function(ur){cr.TRACE_INIT(ur.name+" Rule Lookahead",function(){var dr=sr.collectMethods(ur),hr=dr.alternation,pr=dr.repetition,gr=dr.option,vr=dr.repetitionMandatory,mr=dr.repetitionMandatoryWithSeparator,fr=dr.repetitionWithSeparator;tr.forEach(hr,function(_r){var Ar=_r.idx===0?"":_r.idx;cr.TRACE_INIT(""+sr.getProductionDslName(_r)+Ar,function(){var yr=er.buildLookaheadFuncForOr(_r.idx,ur,_r.maxLookahead||cr.maxLookahead,_r.hasPredicates,cr.dynamicTokensEnabled,cr.lookAheadBuilderForAlternatives),wr=nr.getKeyForAutomaticLookahead(cr.fullRuleNameToShort[ur.name],nr.OR_IDX,_r.idx);cr.setLaFuncCache(wr,yr)})}),tr.forEach(pr,function(_r){cr.computeLookaheadFunc(ur,_r.idx,nr.MANY_IDX,er.PROD_TYPE.REPETITION,_r.maxLookahead,sr.getProductionDslName(_r))}),tr.forEach(gr,function(_r){cr.computeLookaheadFunc(ur,_r.idx,nr.OPTION_IDX,er.PROD_TYPE.OPTION,_r.maxLookahead,sr.getProductionDslName(_r))}),tr.forEach(vr,function(_r){cr.computeLookaheadFunc(ur,_r.idx,nr.AT_LEAST_ONE_IDX,er.PROD_TYPE.REPETITION_MANDATORY,_r.maxLookahead,sr.getProductionDslName(_r))}),tr.forEach(mr,function(_r){cr.computeLookaheadFunc(ur,_r.idx,nr.AT_LEAST_ONE_SEP_IDX,er.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,_r.maxLookahead,sr.getProductionDslName(_r))}),tr.forEach(fr,function(_r){cr.computeLookaheadFunc(ur,_r.idx,nr.MANY_SEP_IDX,er.PROD_TYPE.REPETITION_WITH_SEPARATOR,_r.maxLookahead,sr.getProductionDslName(_r))})})})},or.prototype.computeLookaheadFunc=function(lr,cr,ur,dr,hr,pr){var gr=this;this.TRACE_INIT(""+pr+(cr===0?"":cr),function(){var vr=er.buildLookaheadFuncForOptionalProd(cr,lr,hr||gr.maxLookahead,gr.dynamicTokensEnabled,dr,gr.lookAheadBuilderForOptional),mr=nr.getKeyForAutomaticLookahead(gr.fullRuleNameToShort[lr.name],ur,cr);gr.setLaFuncCache(mr,vr)})},or.prototype.lookAheadBuilderForOptional=function(lr,cr,ur){return er.buildSingleAlternativeLookaheadFunction(lr,cr,ur)},or.prototype.lookAheadBuilderForAlternatives=function(lr,cr,ur,dr){return er.buildAlternativesLookAheadFunc(lr,cr,ur,dr)},or.prototype.getKeyForAutomaticLookahead=function(lr,cr){var ur=this.getLastExplicitRuleShortName();return nr.getKeyForAutomaticLookahead(ur,lr,cr)},or.prototype.getLaFuncFromCache=function(lr){},or.prototype.getLaFuncFromMap=function(lr){return this.lookAheadFuncsCache.get(lr)},or.prototype.getLaFuncFromObj=function(lr){return this.lookAheadFuncsCache[lr]},or.prototype.setLaFuncCache=function(lr,cr){},or.prototype.setLaFuncCacheUsingMap=function(lr,cr){this.lookAheadFuncsCache.set(lr,cr)},or.prototype.setLaFuncUsingObj=function(lr,cr){this.lookAheadFuncsCache[lr]=cr},or}();rr.LooksAhead=ar}),Hi=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.addNoneTerminalToCst=rr.addTerminalToCst=rr.setNodeLocationFull=rr.setNodeLocationOnlyOffset=void 0;function er(sr,ar){isNaN(sr.startOffset)===!0?(sr.startOffset=ar.startOffset,sr.endOffset=ar.endOffset):sr.endOffset<ar.endOffset&&(sr.endOffset=ar.endOffset)}rr.setNodeLocationOnlyOffset=er;function tr(sr,ar){isNaN(sr.startOffset)===!0?(sr.startOffset=ar.startOffset,sr.startColumn=ar.startColumn,sr.startLine=ar.startLine,sr.endOffset=ar.endOffset,sr.endColumn=ar.endColumn,sr.endLine=ar.endLine):sr.endOffset<ar.endOffset&&(sr.endOffset=ar.endOffset,sr.endColumn=ar.endColumn,sr.endLine=ar.endLine)}rr.setNodeLocationFull=tr;function ir(sr,ar,or){sr.children[or]===void 0?sr.children[or]=[ar]:sr.children[or].push(ar)}rr.addTerminalToCst=ir;function nr(sr,ar,or){sr.children[ar]===void 0?sr.children[ar]=[or]:sr.children[ar].push(or)}rr.addNoneTerminalToCst=nr}),Hr=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.defineNameProp=rr.functionName=rr.classNameFromInstance=void 0;var er=k();function tr(ar){return nr(ar.constructor)}rr.classNameFromInstance=tr;var ir="name";function nr(ar){var or=ar.name;return or||"anonymous"}rr.functionName=nr;function sr(ar,or){var lr=Object.getOwnPropertyDescriptor(ar,ir);return er.isUndefined(lr)||lr.configurable?(Object.defineProperty(ar,ir,{enumerable:!1,configurable:!0,writable:!1,value:or}),!0):!1}rr.defineNameProp=sr}),ea=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.validateRedundantMethods=rr.validateMissingCstMethods=rr.validateVisitor=rr.CstVisitorDefinitionError=rr.createBaseVisitorConstructorWithDefaults=rr.createBaseSemanticVisitorConstructor=rr.defaultVisit=void 0;var er=k(),tr=Hr();function ir(dr,hr){for(var pr=er.keys(dr),gr=pr.length,vr=0;vr<gr;vr++)for(var mr=pr[vr],fr=dr[mr],_r=fr.length,Ar=0;Ar<_r;Ar++){var yr=fr[Ar];yr.tokenTypeIdx===void 0&&this[yr.name](yr.children,hr)}}rr.defaultVisit=ir;function nr(dr,hr){var pr=function(){};tr.defineNameProp(pr,dr+"BaseSemantics");var gr={visit:function(vr,mr){if(er.isArray(vr)&&(vr=vr[0]),!er.isUndefined(vr))return this[vr.name](vr.children,mr)},validateVisitor:function(){var vr=or(this,hr);if(!er.isEmpty(vr)){var mr=er.map(vr,function(fr){return fr.msg});throw Error("Errors Detected in CST Visitor <"+tr.functionName(this.constructor)+`>:
	`+(""+mr.join(`

`).replace(/\n/g,`
	`)))}}};return pr.prototype=gr,pr.prototype.constructor=pr,pr._RULE_NAMES=hr,pr}rr.createBaseSemanticVisitorConstructor=nr;function sr(dr,hr,pr){var gr=function(){};tr.defineNameProp(gr,dr+"BaseSemanticsWithDefaults");var vr=Object.create(pr.prototype);return er.forEach(hr,function(mr){vr[mr]=ir}),gr.prototype=vr,gr.prototype.constructor=gr,gr}rr.createBaseVisitorConstructorWithDefaults=sr;var ar;(function(dr){dr[dr.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",dr[dr.MISSING_METHOD=1]="MISSING_METHOD"})(ar=rr.CstVisitorDefinitionError||(rr.CstVisitorDefinitionError={}));function or(dr,hr){var pr=lr(dr,hr),gr=ur(dr,hr);return pr.concat(gr)}rr.validateVisitor=or;function lr(dr,hr){var pr=er.map(hr,function(gr){if(!er.isFunction(dr[gr]))return{msg:"Missing visitor method: <"+gr+"> on "+tr.functionName(dr.constructor)+" CST Visitor.",type:ar.MISSING_METHOD,methodName:gr}});return er.compact(pr)}rr.validateMissingCstMethods=lr;var cr=["constructor","visit","validateVisitor"];function ur(dr,hr){var pr=[];for(var gr in dr)er.isFunction(dr[gr])&&!er.contains(cr,gr)&&!er.contains(hr,gr)&&pr.push({msg:"Redundant visitor method: <"+gr+"> on "+tr.functionName(dr.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`,type:ar.REDUNDANT_METHOD,methodName:gr});return pr}rr.validateRedundantMethods=ur}),ra=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.TreeBuilder=void 0;var er=Hi(),tr=k(),ir=ea(),nr=ce(),sr=function(){function ar(){}return ar.prototype.initTreeBuilder=function(or){if(this.CST_STACK=[],this.outputCst=or.outputCst,this.nodeLocationTracking=tr.has(or,"nodeLocationTracking")?or.nodeLocationTracking:nr.DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=tr.NOOP,this.cstFinallyStateUpdate=tr.NOOP,this.cstPostTerminal=tr.NOOP,this.cstPostNonTerminal=tr.NOOP,this.cstPostRule=tr.NOOP;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=er.setNodeLocationFull,this.setNodeLocationFromNode=er.setNodeLocationFull,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=er.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=er.setNodeLocationOnlyOffset,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=tr.NOOP,this.setNodeLocationFromNode=tr.NOOP,this.cstPostRule=tr.NOOP,this.setInitialNodeLocation=tr.NOOP;else throw Error('Invalid <nodeLocationTracking> config option: "'+or.nodeLocationTracking+'"')},ar.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(or){or.location={startOffset:NaN,endOffset:NaN}},ar.prototype.setInitialNodeLocationOnlyOffsetRegular=function(or){or.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},ar.prototype.setInitialNodeLocationFullRecovery=function(or){or.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},ar.prototype.setInitialNodeLocationFullRegular=function(or){var lr=this.LA(1);or.location={startOffset:lr.startOffset,startLine:lr.startLine,startColumn:lr.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},ar.prototype.cstInvocationStateUpdate=function(or,lr){var cr={name:or,children:{}};this.setInitialNodeLocation(cr),this.CST_STACK.push(cr)},ar.prototype.cstFinallyStateUpdate=function(){this.CST_STACK.pop()},ar.prototype.cstPostRuleFull=function(or){var lr=this.LA(0),cr=or.location;cr.startOffset<=lr.startOffset?(cr.endOffset=lr.endOffset,cr.endLine=lr.endLine,cr.endColumn=lr.endColumn):(cr.startOffset=NaN,cr.startLine=NaN,cr.startColumn=NaN)},ar.prototype.cstPostRuleOnlyOffset=function(or){var lr=this.LA(0),cr=or.location;cr.startOffset<=lr.startOffset?cr.endOffset=lr.endOffset:cr.startOffset=NaN},ar.prototype.cstPostTerminal=function(or,lr){var cr=this.CST_STACK[this.CST_STACK.length-1];er.addTerminalToCst(cr,lr,or),this.setNodeLocationFromToken(cr.location,lr)},ar.prototype.cstPostNonTerminal=function(or,lr){var cr=this.CST_STACK[this.CST_STACK.length-1];er.addNoneTerminalToCst(cr,lr,or),this.setNodeLocationFromNode(cr.location,or.location)},ar.prototype.getBaseCstVisitorConstructor=function(){if(tr.isUndefined(this.baseCstVisitorConstructor)){var or=ir.createBaseSemanticVisitorConstructor(this.className,tr.keys(this.gastProductionsCache));return this.baseCstVisitorConstructor=or,or}return this.baseCstVisitorConstructor},ar.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(tr.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var or=ir.createBaseVisitorConstructorWithDefaults(this.className,tr.keys(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=or,or}return this.baseCstVisitorWithDefaultsConstructor},ar.prototype.getLastExplicitRuleShortName=function(){var or=this.RULE_STACK;return or[or.length-1]},ar.prototype.getPreviousExplicitRuleShortName=function(){var or=this.RULE_STACK;return or[or.length-2]},ar.prototype.getLastExplicitRuleOccurrenceIndex=function(){var or=this.RULE_OCCURRENCE_STACK;return or[or.length-1]},ar}();rr.TreeBuilder=sr}),ia=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.LexerAdapter=void 0;var er=ce(),tr=function(){function ir(){}return ir.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(ir.prototype,"input",{get:function(){return this.tokVector},set:function(nr){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=nr,this.tokVectorLength=nr.length},enumerable:!1,configurable:!0}),ir.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):er.END_OF_FILE},ir.prototype.LA=function(nr){var sr=this.currIdx+nr;return sr<0||this.tokVectorLength<=sr?er.END_OF_FILE:this.tokVector[sr]},ir.prototype.consumeToken=function(){this.currIdx++},ir.prototype.exportLexerState=function(){return this.currIdx},ir.prototype.importLexerState=function(nr){this.currIdx=nr},ir.prototype.resetLexerState=function(){this.currIdx=-1},ir.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},ir.prototype.getLexerPosition=function(){return this.exportLexerState()},ir}();rr.LexerAdapter=tr}),oa=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.RecognizerApi=void 0;var er=k(),tr=et(),ir=ce(),nr=mt(),sr=jr(),ar=ne(),or=function(){function lr(){}return lr.prototype.ACTION=function(cr){return cr.call(this)},lr.prototype.consume=function(cr,ur,dr){return this.consumeInternal(ur,cr,dr)},lr.prototype.subrule=function(cr,ur,dr){return this.subruleInternal(ur,cr,dr)},lr.prototype.option=function(cr,ur){return this.optionInternal(ur,cr)},lr.prototype.or=function(cr,ur){return this.orInternal(ur,cr)},lr.prototype.many=function(cr,ur){return this.manyInternal(cr,ur)},lr.prototype.atLeastOne=function(cr,ur){return this.atLeastOneInternal(cr,ur)},lr.prototype.CONSUME=function(cr,ur){return this.consumeInternal(cr,0,ur)},lr.prototype.CONSUME1=function(cr,ur){return this.consumeInternal(cr,1,ur)},lr.prototype.CONSUME2=function(cr,ur){return this.consumeInternal(cr,2,ur)},lr.prototype.CONSUME3=function(cr,ur){return this.consumeInternal(cr,3,ur)},lr.prototype.CONSUME4=function(cr,ur){return this.consumeInternal(cr,4,ur)},lr.prototype.CONSUME5=function(cr,ur){return this.consumeInternal(cr,5,ur)},lr.prototype.CONSUME6=function(cr,ur){return this.consumeInternal(cr,6,ur)},lr.prototype.CONSUME7=function(cr,ur){return this.consumeInternal(cr,7,ur)},lr.prototype.CONSUME8=function(cr,ur){return this.consumeInternal(cr,8,ur)},lr.prototype.CONSUME9=function(cr,ur){return this.consumeInternal(cr,9,ur)},lr.prototype.SUBRULE=function(cr,ur){return this.subruleInternal(cr,0,ur)},lr.prototype.SUBRULE1=function(cr,ur){return this.subruleInternal(cr,1,ur)},lr.prototype.SUBRULE2=function(cr,ur){return this.subruleInternal(cr,2,ur)},lr.prototype.SUBRULE3=function(cr,ur){return this.subruleInternal(cr,3,ur)},lr.prototype.SUBRULE4=function(cr,ur){return this.subruleInternal(cr,4,ur)},lr.prototype.SUBRULE5=function(cr,ur){return this.subruleInternal(cr,5,ur)},lr.prototype.SUBRULE6=function(cr,ur){return this.subruleInternal(cr,6,ur)},lr.prototype.SUBRULE7=function(cr,ur){return this.subruleInternal(cr,7,ur)},lr.prototype.SUBRULE8=function(cr,ur){return this.subruleInternal(cr,8,ur)},lr.prototype.SUBRULE9=function(cr,ur){return this.subruleInternal(cr,9,ur)},lr.prototype.OPTION=function(cr){return this.optionInternal(cr,0)},lr.prototype.OPTION1=function(cr){return this.optionInternal(cr,1)},lr.prototype.OPTION2=function(cr){return this.optionInternal(cr,2)},lr.prototype.OPTION3=function(cr){return this.optionInternal(cr,3)},lr.prototype.OPTION4=function(cr){return this.optionInternal(cr,4)},lr.prototype.OPTION5=function(cr){return this.optionInternal(cr,5)},lr.prototype.OPTION6=function(cr){return this.optionInternal(cr,6)},lr.prototype.OPTION7=function(cr){return this.optionInternal(cr,7)},lr.prototype.OPTION8=function(cr){return this.optionInternal(cr,8)},lr.prototype.OPTION9=function(cr){return this.optionInternal(cr,9)},lr.prototype.OR=function(cr){return this.orInternal(cr,0)},lr.prototype.OR1=function(cr){return this.orInternal(cr,1)},lr.prototype.OR2=function(cr){return this.orInternal(cr,2)},lr.prototype.OR3=function(cr){return this.orInternal(cr,3)},lr.prototype.OR4=function(cr){return this.orInternal(cr,4)},lr.prototype.OR5=function(cr){return this.orInternal(cr,5)},lr.prototype.OR6=function(cr){return this.orInternal(cr,6)},lr.prototype.OR7=function(cr){return this.orInternal(cr,7)},lr.prototype.OR8=function(cr){return this.orInternal(cr,8)},lr.prototype.OR9=function(cr){return this.orInternal(cr,9)},lr.prototype.MANY=function(cr){this.manyInternal(0,cr)},lr.prototype.MANY1=function(cr){this.manyInternal(1,cr)},lr.prototype.MANY2=function(cr){this.manyInternal(2,cr)},lr.prototype.MANY3=function(cr){this.manyInternal(3,cr)},lr.prototype.MANY4=function(cr){this.manyInternal(4,cr)},lr.prototype.MANY5=function(cr){this.manyInternal(5,cr)},lr.prototype.MANY6=function(cr){this.manyInternal(6,cr)},lr.prototype.MANY7=function(cr){this.manyInternal(7,cr)},lr.prototype.MANY8=function(cr){this.manyInternal(8,cr)},lr.prototype.MANY9=function(cr){this.manyInternal(9,cr)},lr.prototype.MANY_SEP=function(cr){this.manySepFirstInternal(0,cr)},lr.prototype.MANY_SEP1=function(cr){this.manySepFirstInternal(1,cr)},lr.prototype.MANY_SEP2=function(cr){this.manySepFirstInternal(2,cr)},lr.prototype.MANY_SEP3=function(cr){this.manySepFirstInternal(3,cr)},lr.prototype.MANY_SEP4=function(cr){this.manySepFirstInternal(4,cr)},lr.prototype.MANY_SEP5=function(cr){this.manySepFirstInternal(5,cr)},lr.prototype.MANY_SEP6=function(cr){this.manySepFirstInternal(6,cr)},lr.prototype.MANY_SEP7=function(cr){this.manySepFirstInternal(7,cr)},lr.prototype.MANY_SEP8=function(cr){this.manySepFirstInternal(8,cr)},lr.prototype.MANY_SEP9=function(cr){this.manySepFirstInternal(9,cr)},lr.prototype.AT_LEAST_ONE=function(cr){this.atLeastOneInternal(0,cr)},lr.prototype.AT_LEAST_ONE1=function(cr){return this.atLeastOneInternal(1,cr)},lr.prototype.AT_LEAST_ONE2=function(cr){this.atLeastOneInternal(2,cr)},lr.prototype.AT_LEAST_ONE3=function(cr){this.atLeastOneInternal(3,cr)},lr.prototype.AT_LEAST_ONE4=function(cr){this.atLeastOneInternal(4,cr)},lr.prototype.AT_LEAST_ONE5=function(cr){this.atLeastOneInternal(5,cr)},lr.prototype.AT_LEAST_ONE6=function(cr){this.atLeastOneInternal(6,cr)},lr.prototype.AT_LEAST_ONE7=function(cr){this.atLeastOneInternal(7,cr)},lr.prototype.AT_LEAST_ONE8=function(cr){this.atLeastOneInternal(8,cr)},lr.prototype.AT_LEAST_ONE9=function(cr){this.atLeastOneInternal(9,cr)},lr.prototype.AT_LEAST_ONE_SEP=function(cr){this.atLeastOneSepFirstInternal(0,cr)},lr.prototype.AT_LEAST_ONE_SEP1=function(cr){this.atLeastOneSepFirstInternal(1,cr)},lr.prototype.AT_LEAST_ONE_SEP2=function(cr){this.atLeastOneSepFirstInternal(2,cr)},lr.prototype.AT_LEAST_ONE_SEP3=function(cr){this.atLeastOneSepFirstInternal(3,cr)},lr.prototype.AT_LEAST_ONE_SEP4=function(cr){this.atLeastOneSepFirstInternal(4,cr)},lr.prototype.AT_LEAST_ONE_SEP5=function(cr){this.atLeastOneSepFirstInternal(5,cr)},lr.prototype.AT_LEAST_ONE_SEP6=function(cr){this.atLeastOneSepFirstInternal(6,cr)},lr.prototype.AT_LEAST_ONE_SEP7=function(cr){this.atLeastOneSepFirstInternal(7,cr)},lr.prototype.AT_LEAST_ONE_SEP8=function(cr){this.atLeastOneSepFirstInternal(8,cr)},lr.prototype.AT_LEAST_ONE_SEP9=function(cr){this.atLeastOneSepFirstInternal(9,cr)},lr.prototype.RULE=function(cr,ur,dr){if(dr===void 0&&(dr=ir.DEFAULT_RULE_CONFIG),er.contains(this.definedRulesNames,cr)){var hr=nr.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:cr,grammarName:this.className}),pr={message:hr,type:ir.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:cr};this.definitionErrors.push(pr)}this.definedRulesNames.push(cr);var gr=this.defineRule(cr,ur,dr);return this[cr]=gr,gr},lr.prototype.OVERRIDE_RULE=function(cr,ur,dr){dr===void 0&&(dr=ir.DEFAULT_RULE_CONFIG);var hr=[];hr=hr.concat(sr.validateRuleIsOverridden(cr,this.definedRulesNames,this.className)),this.definitionErrors=this.definitionErrors.concat(hr);var pr=this.defineRule(cr,ur,dr);return this[cr]=pr,pr},lr.prototype.BACKTRACK=function(cr,ur){return function(){this.isBackTrackingStack.push(1);var dr=this.saveRecogState();try{return cr.apply(this,ur),!0}catch(hr){if(tr.isRecognitionException(hr))return!1;throw hr}finally{this.reloadRecogState(dr),this.isBackTrackingStack.pop()}}},lr.prototype.getGAstProductions=function(){return this.gastProductionsCache},lr.prototype.getSerializedGastProductions=function(){return ar.serializeGrammar(er.values(this.gastProductionsCache))},lr}();rr.RecognizerApi=or}),la=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.RecognizerEngine=void 0;var er=k(),tr=Yt(),ir=et(),nr=yt(),sr=Tt(),ar=ce(),or=zr(),lr=Ue(),cr=Xe(),ur=Hr(),dr=function(){function hr(){}return hr.prototype.initRecognizerEngine=function(pr,gr){if(this.className=ur.classNameFromInstance(this),this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=cr.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},er.has(gr,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(er.isArray(pr)){if(er.isEmpty(pr))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof pr[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(er.isArray(pr))this.tokensMap=er.reduce(pr,function(_r,Ar){return _r[Ar.name]=Ar,_r},{});else if(er.has(pr,"modes")&&er.every(er.flatten(er.values(pr.modes)),cr.isTokenType)){var vr=er.flatten(er.values(pr.modes)),mr=er.uniq(vr);this.tokensMap=er.reduce(mr,function(_r,Ar){return _r[Ar.name]=Ar,_r},{})}else if(er.isObject(pr))this.tokensMap=er.cloneObj(pr);else throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap.EOF=lr.EOF;var fr=er.every(er.values(pr),function(_r){return er.isEmpty(_r.categoryMatches)});this.tokenMatcher=fr?cr.tokenStructuredMatcherNoCategories:cr.tokenStructuredMatcher,cr.augmentTokenTypes(er.values(this.tokensMap))},hr.prototype.defineRule=function(pr,gr,vr){if(this.selfAnalysisDone)throw Error("Grammar rule <"+pr+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var mr=er.has(vr,"resyncEnabled")?vr.resyncEnabled:ar.DEFAULT_RULE_CONFIG.resyncEnabled,fr=er.has(vr,"recoveryValueFunc")?vr.recoveryValueFunc:ar.DEFAULT_RULE_CONFIG.recoveryValueFunc,_r=this.ruleShortNameIdx<<tr.BITS_FOR_METHOD_TYPE+tr.BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull[_r]=pr,this.fullRuleNameToShort[pr]=_r;function Ar(xr){try{if(this.outputCst===!0){gr.apply(this,xr);var Sr=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(Sr),Sr}else return gr.apply(this,xr)}catch(br){return this.invokeRuleCatch(br,mr,fr)}finally{this.ruleFinallyStateUpdate()}}var yr=function(xr,Sr){return xr===void 0&&(xr=0),this.ruleInvocationStateUpdate(_r,pr,xr),Ar.call(this,Sr)},wr="ruleName";return yr[wr]=pr,yr.originalGrammarAction=gr,yr},hr.prototype.invokeRuleCatch=function(pr,gr,vr){var mr=this.RULE_STACK.length===1,fr=gr&&!this.isBackTracking()&&this.recoveryEnabled;if(ir.isRecognitionException(pr)){var _r=pr;if(fr){var Ar=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(Ar))if(_r.resyncedTokens=this.reSyncTo(Ar),this.outputCst){var yr=this.CST_STACK[this.CST_STACK.length-1];return yr.recoveredNode=!0,yr}else return vr();else{if(this.outputCst){var yr=this.CST_STACK[this.CST_STACK.length-1];yr.recoveredNode=!0,_r.partialCstResult=yr}throw _r}}else{if(mr)return this.moveToTerminatedState(),vr();throw _r}}else throw pr},hr.prototype.optionInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.OPTION_IDX,gr);return this.optionInternalLogic(pr,gr,vr)},hr.prototype.optionInternalLogic=function(pr,gr,vr){var mr=this,fr=this.getLaFuncFromCache(vr),_r,Ar;if(pr.DEF!==void 0){if(_r=pr.DEF,Ar=pr.GATE,Ar!==void 0){var yr=fr;fr=function(){return Ar.call(mr)&&yr.call(mr)}}}else _r=pr;if(fr.call(this)===!0)return _r.call(this)},hr.prototype.atLeastOneInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.AT_LEAST_ONE_IDX,pr);return this.atLeastOneInternalLogic(pr,gr,vr)},hr.prototype.atLeastOneInternalLogic=function(pr,gr,vr){var mr=this,fr=this.getLaFuncFromCache(vr),_r,Ar;if(gr.DEF!==void 0){if(_r=gr.DEF,Ar=gr.GATE,Ar!==void 0){var yr=fr;fr=function(){return Ar.call(mr)&&yr.call(mr)}}}else _r=gr;if(fr.call(this)===!0)for(var wr=this.doSingleRepetition(_r);fr.call(this)===!0&&wr===!0;)wr=this.doSingleRepetition(_r);else throw this.raiseEarlyExitException(pr,nr.PROD_TYPE.REPETITION_MANDATORY,gr.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[pr,gr],fr,tr.AT_LEAST_ONE_IDX,pr,sr.NextTerminalAfterAtLeastOneWalker)},hr.prototype.atLeastOneSepFirstInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.AT_LEAST_ONE_SEP_IDX,pr);this.atLeastOneSepFirstInternalLogic(pr,gr,vr)},hr.prototype.atLeastOneSepFirstInternalLogic=function(pr,gr,vr){var mr=this,fr=gr.DEF,_r=gr.SEP,Ar=this.getLaFuncFromCache(vr);if(Ar.call(this)===!0){fr.call(this);for(var yr=function(){return mr.tokenMatcher(mr.LA(1),_r)};this.tokenMatcher(this.LA(1),_r)===!0;)this.CONSUME(_r),fr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,_r,yr,fr,sr.NextTerminalAfterAtLeastOneSepWalker],yr,tr.AT_LEAST_ONE_SEP_IDX,pr,sr.NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(pr,nr.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,gr.ERR_MSG)},hr.prototype.manyInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.MANY_IDX,pr);return this.manyInternalLogic(pr,gr,vr)},hr.prototype.manyInternalLogic=function(pr,gr,vr){var mr=this,fr=this.getLaFuncFromCache(vr),_r,Ar;if(gr.DEF!==void 0){if(_r=gr.DEF,Ar=gr.GATE,Ar!==void 0){var yr=fr;fr=function(){return Ar.call(mr)&&yr.call(mr)}}}else _r=gr;for(var wr=!0;fr.call(this)===!0&&wr===!0;)wr=this.doSingleRepetition(_r);this.attemptInRepetitionRecovery(this.manyInternal,[pr,gr],fr,tr.MANY_IDX,pr,sr.NextTerminalAfterManyWalker,wr)},hr.prototype.manySepFirstInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.MANY_SEP_IDX,pr);this.manySepFirstInternalLogic(pr,gr,vr)},hr.prototype.manySepFirstInternalLogic=function(pr,gr,vr){var mr=this,fr=gr.DEF,_r=gr.SEP,Ar=this.getLaFuncFromCache(vr);if(Ar.call(this)===!0){fr.call(this);for(var yr=function(){return mr.tokenMatcher(mr.LA(1),_r)};this.tokenMatcher(this.LA(1),_r)===!0;)this.CONSUME(_r),fr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,_r,yr,fr,sr.NextTerminalAfterManySepWalker],yr,tr.MANY_SEP_IDX,pr,sr.NextTerminalAfterManySepWalker)}},hr.prototype.repetitionSepSecondInternal=function(pr,gr,vr,mr,fr){for(;vr();)this.CONSUME(gr),mr.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[pr,gr,vr,mr,fr],vr,tr.AT_LEAST_ONE_SEP_IDX,pr,fr)},hr.prototype.doSingleRepetition=function(pr){var gr=this.getLexerPosition();pr.call(this);var vr=this.getLexerPosition();return vr>gr},hr.prototype.orInternal=function(pr,gr){var vr=this.getKeyForAutomaticLookahead(tr.OR_IDX,gr),mr=er.isArray(pr)?pr:pr.DEF,fr=this.getLaFuncFromCache(vr),_r=fr.call(this,mr);if(_r!==void 0){var Ar=mr[_r];return Ar.ALT.call(this)}this.raiseNoAltException(gr,pr.ERR_MSG)},hr.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){var pr=this.LA(1),gr=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:pr,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new ir.NotAllInputParsedException(gr,pr))}},hr.prototype.subruleInternal=function(pr,gr,vr){var mr;try{var fr=vr!==void 0?vr.ARGS:void 0;return mr=pr.call(this,gr,fr),this.cstPostNonTerminal(mr,vr!==void 0&&vr.LABEL!==void 0?vr.LABEL:pr.ruleName),mr}catch(_r){this.subruleInternalError(_r,vr,pr.ruleName)}},hr.prototype.subruleInternalError=function(pr,gr,vr){throw ir.isRecognitionException(pr)&&pr.partialCstResult!==void 0&&(this.cstPostNonTerminal(pr.partialCstResult,gr!==void 0&&gr.LABEL!==void 0?gr.LABEL:vr),delete pr.partialCstResult),pr},hr.prototype.consumeInternal=function(pr,gr,vr){var mr;try{var fr=this.LA(1);this.tokenMatcher(fr,pr)===!0?(this.consumeToken(),mr=fr):this.consumeInternalError(pr,fr,vr)}catch(_r){mr=this.consumeInternalRecovery(pr,gr,_r)}return this.cstPostTerminal(vr!==void 0&&vr.LABEL!==void 0?vr.LABEL:pr.name,mr),mr},hr.prototype.consumeInternalError=function(pr,gr,vr){var mr,fr=this.LA(0);throw vr!==void 0&&vr.ERR_MSG?mr=vr.ERR_MSG:mr=this.errorMessageProvider.buildMismatchTokenMessage({expected:pr,actual:gr,previous:fr,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ir.MismatchedTokenException(mr,gr,fr))},hr.prototype.consumeInternalRecovery=function(pr,gr,vr){if(this.recoveryEnabled&&vr.name==="MismatchedTokenException"&&!this.isBackTracking()){var mr=this.getFollowsForInRuleRecovery(pr,gr);try{return this.tryInRuleRecovery(pr,mr)}catch(fr){throw fr.name===or.IN_RULE_RECOVERY_EXCEPTION?vr:fr}}else throw vr},hr.prototype.saveRecogState=function(){var pr=this.errors,gr=er.cloneArr(this.RULE_STACK);return{errors:pr,lexerState:this.exportLexerState(),RULE_STACK:gr,CST_STACK:this.CST_STACK}},hr.prototype.reloadRecogState=function(pr){this.errors=pr.errors,this.importLexerState(pr.lexerState),this.RULE_STACK=pr.RULE_STACK},hr.prototype.ruleInvocationStateUpdate=function(pr,gr,vr){this.RULE_OCCURRENCE_STACK.push(vr),this.RULE_STACK.push(pr),this.cstInvocationStateUpdate(gr,pr)},hr.prototype.isBackTracking=function(){return this.isBackTrackingStack.length!==0},hr.prototype.getCurrRuleFullName=function(){var pr=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[pr]},hr.prototype.shortRuleNameToFullName=function(pr){return this.shortRuleNameToFull[pr]},hr.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),lr.EOF)},hr.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},hr}();rr.RecognizerEngine=dr}),pa=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.ErrorHandler=void 0;var er=et(),tr=k(),ir=yt(),nr=ce(),sr=function(){function ar(){}return ar.prototype.initErrorHandler=function(or){this._errors=[],this.errorMessageProvider=tr.has(or,"errorMessageProvider")?or.errorMessageProvider:nr.DEFAULT_PARSER_CONFIG.errorMessageProvider},ar.prototype.SAVE_ERROR=function(or){if(er.isRecognitionException(or))return or.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:tr.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(or),or;throw Error("Trying to save an Error which is not a RecognitionException")},Object.defineProperty(ar.prototype,"errors",{get:function(){return tr.cloneArr(this._errors)},set:function(or){this._errors=or},enumerable:!1,configurable:!0}),ar.prototype.raiseEarlyExitException=function(or,lr,cr){for(var ur=this.getCurrRuleFullName(),dr=this.getGAstProductions()[ur],hr=ir.getLookaheadPathsForOptionalProd(or,dr,lr,this.maxLookahead),pr=hr[0],gr=[],vr=1;vr<=this.maxLookahead;vr++)gr.push(this.LA(vr));var mr=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:pr,actual:gr,previous:this.LA(0),customUserDescription:cr,ruleName:ur});throw this.SAVE_ERROR(new er.EarlyExitException(mr,this.LA(1),this.LA(0)))},ar.prototype.raiseNoAltException=function(or,lr){for(var cr=this.getCurrRuleFullName(),ur=this.getGAstProductions()[cr],dr=ir.getLookaheadPathsForOr(or,ur,this.maxLookahead),hr=[],pr=1;pr<=this.maxLookahead;pr++)hr.push(this.LA(pr));var gr=this.LA(0),vr=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:dr,actual:hr,previous:gr,customUserDescription:lr,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new er.NoViableAltException(vr,this.LA(1),gr))},ar}();rr.ErrorHandler=sr}),va=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.ContentAssist=void 0;var er=Tt(),tr=k(),ir=function(){function nr(){}return nr.prototype.initContentAssist=function(){},nr.prototype.computeContentAssist=function(sr,ar){var or=this.gastProductionsCache[sr];if(tr.isUndefined(or))throw Error("Rule ->"+sr+"<- does not exist in this grammar.");return er.nextPossibleTokensAfter([or],ar,this.tokenMatcher,this.maxLookahead)},nr.prototype.getNextPossibleTokenTypes=function(sr){var ar=tr.first(sr.ruleStack),or=this.getGAstProductions(),lr=or[ar],cr=new er.NextAfterTokenWalker(lr,sr).startWalking();return cr},nr}();rr.ContentAssist=ir}),Ra=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.GastRecorder=void 0;var er=k(),tr=ne(),ir=ft(),nr=Xe(),sr=Ue(),ar=ce(),or=Yt(),lr={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(lr);var cr=!0,ur=Math.pow(2,or.BITS_FOR_OCCURRENCE_IDX)-1,dr=sr.createToken({name:"RECORDING_PHASE_TOKEN",pattern:ir.Lexer.NA});nr.augmentTokenTypes([dr]);var hr=sr.createTokenInstance(dr,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(hr);var pr={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}},gr=function(){function Ar(){}return Ar.prototype.initGastRecorder=function(yr){this.recordingProdStack=[],this.RECORDING_PHASE=!1},Ar.prototype.enableRecording=function(){var yr=this;this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",function(){for(var wr=function(Sr){var br=Sr>0?Sr:"";yr["CONSUME"+br]=function(Cr,Ir){return this.consumeInternalRecord(Cr,Sr,Ir)},yr["SUBRULE"+br]=function(Cr,Ir){return this.subruleInternalRecord(Cr,Sr,Ir)},yr["OPTION"+br]=function(Cr){return this.optionInternalRecord(Cr,Sr)},yr["OR"+br]=function(Cr){return this.orInternalRecord(Cr,Sr)},yr["MANY"+br]=function(Cr){this.manyInternalRecord(Sr,Cr)},yr["MANY_SEP"+br]=function(Cr){this.manySepFirstInternalRecord(Sr,Cr)},yr["AT_LEAST_ONE"+br]=function(Cr){this.atLeastOneInternalRecord(Sr,Cr)},yr["AT_LEAST_ONE_SEP"+br]=function(Cr){this.atLeastOneSepFirstInternalRecord(Sr,Cr)}},xr=0;xr<10;xr++)wr(xr);yr.consume=function(Sr,br,Cr){return this.consumeInternalRecord(br,Sr,Cr)},yr.subrule=function(Sr,br,Cr){return this.subruleInternalRecord(br,Sr,Cr)},yr.option=function(Sr,br){return this.optionInternalRecord(br,Sr)},yr.or=function(Sr,br){return this.orInternalRecord(br,Sr)},yr.many=function(Sr,br){this.manyInternalRecord(Sr,br)},yr.atLeastOne=function(Sr,br){this.atLeastOneInternalRecord(Sr,br)},yr.ACTION=yr.ACTION_RECORD,yr.BACKTRACK=yr.BACKTRACK_RECORD,yr.LA=yr.LA_RECORD})},Ar.prototype.disableRecording=function(){var yr=this;this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",function(){for(var wr=0;wr<10;wr++){var xr=wr>0?wr:"";delete yr["CONSUME"+xr],delete yr["SUBRULE"+xr],delete yr["OPTION"+xr],delete yr["OR"+xr],delete yr["MANY"+xr],delete yr["MANY_SEP"+xr],delete yr["AT_LEAST_ONE"+xr],delete yr["AT_LEAST_ONE_SEP"+xr]}delete yr.consume,delete yr.subrule,delete yr.option,delete yr.or,delete yr.many,delete yr.atLeastOne,delete yr.ACTION,delete yr.BACKTRACK,delete yr.LA})},Ar.prototype.ACTION_RECORD=function(yr){},Ar.prototype.BACKTRACK_RECORD=function(yr,wr){return function(){return!0}},Ar.prototype.LA_RECORD=function(yr){return ar.END_OF_FILE},Ar.prototype.topLevelRuleRecord=function(yr,wr){try{var xr=new tr.Rule({definition:[],name:yr});return xr.name=yr,this.recordingProdStack.push(xr),wr.call(this),this.recordingProdStack.pop(),xr}catch(Sr){if(Sr.KNOWN_RECORDER_ERROR!==!0)try{Sr.message=Sr.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw Sr}throw Sr}},Ar.prototype.optionInternalRecord=function(yr,wr){return vr.call(this,tr.Option,yr,wr)},Ar.prototype.atLeastOneInternalRecord=function(yr,wr){vr.call(this,tr.RepetitionMandatory,wr,yr)},Ar.prototype.atLeastOneSepFirstInternalRecord=function(yr,wr){vr.call(this,tr.RepetitionMandatoryWithSeparator,wr,yr,cr)},Ar.prototype.manyInternalRecord=function(yr,wr){vr.call(this,tr.Repetition,wr,yr)},Ar.prototype.manySepFirstInternalRecord=function(yr,wr){vr.call(this,tr.RepetitionWithSeparator,wr,yr,cr)},Ar.prototype.orInternalRecord=function(yr,wr){return mr.call(this,yr,wr)},Ar.prototype.subruleInternalRecord=function(yr,wr,xr){if(_r(wr),!yr||er.has(yr,"ruleName")===!1){var Sr=new Error("<SUBRULE"+fr(wr)+"> argument is invalid"+(" expecting a Parser method reference but got: <"+JSON.stringify(yr)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw Sr.KNOWN_RECORDER_ERROR=!0,Sr}var br=er.peek(this.recordingProdStack),Cr=yr.ruleName,Ir=new tr.NonTerminal({idx:wr,nonTerminalName:Cr,referencedRule:void 0});return br.definition.push(Ir),this.outputCst?pr:lr},Ar.prototype.consumeInternalRecord=function(yr,wr,xr){if(_r(wr),!nr.hasShortKeyProperty(yr)){var Sr=new Error("<CONSUME"+fr(wr)+"> argument is invalid"+(" expecting a TokenType reference but got: <"+JSON.stringify(yr)+">")+(`
 inside top level rule: <`+this.recordingProdStack[0].name+">"));throw Sr.KNOWN_RECORDER_ERROR=!0,Sr}var br=er.peek(this.recordingProdStack),Cr=new tr.Terminal({idx:wr,terminalType:yr});return br.definition.push(Cr),hr},Ar}();rr.GastRecorder=gr;function vr(Ar,yr,wr,xr){xr===void 0&&(xr=!1),_r(wr);var Sr=er.peek(this.recordingProdStack),br=er.isFunction(yr)?yr:yr.DEF,Cr=new Ar({definition:[],idx:wr});return xr&&(Cr.separator=yr.SEP),er.has(yr,"MAX_LOOKAHEAD")&&(Cr.maxLookahead=yr.MAX_LOOKAHEAD),this.recordingProdStack.push(Cr),br.call(this),Sr.definition.push(Cr),this.recordingProdStack.pop(),lr}function mr(Ar,yr){var wr=this;_r(yr);var xr=er.peek(this.recordingProdStack),Sr=er.isArray(Ar)===!1,br=Sr===!1?Ar:Ar.DEF,Cr=new tr.Alternation({definition:[],idx:yr,ignoreAmbiguities:Sr&&Ar.IGNORE_AMBIGUITIES===!0});er.has(Ar,"MAX_LOOKAHEAD")&&(Cr.maxLookahead=Ar.MAX_LOOKAHEAD);var Ir=er.some(br,function(Rr){return er.isFunction(Rr.GATE)});return Cr.hasPredicates=Ir,xr.definition.push(Cr),er.forEach(br,function(Rr){var Pr=new tr.Alternative({definition:[]});Cr.definition.push(Pr),er.has(Rr,"IGNORE_AMBIGUITIES")?Pr.ignoreAmbiguities=Rr.IGNORE_AMBIGUITIES:er.has(Rr,"GATE")&&(Pr.ignoreAmbiguities=!0),wr.recordingProdStack.push(Pr),Rr.ALT.call(wr),wr.recordingProdStack.pop()}),lr}function fr(Ar){return Ar===0?"":""+Ar}function _r(Ar){if(Ar<0||Ar>ur){var yr=new Error("Invalid DSL Method idx value: <"+Ar+`>
	`+("Idx value must be a none negative value smaller than "+(ur+1)));throw yr.KNOWN_RECORDER_ERROR=!0,yr}}}),Na=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.PerformanceTracer=void 0;var er=k(),tr=ce(),ir=function(){function nr(){}return nr.prototype.initPerformanceTracer=function(sr){if(er.has(sr,"traceInitPerf")){var ar=sr.traceInitPerf,or=typeof ar=="number";this.traceInitMaxIdent=or?ar:1/0,this.traceInitPerf=or?ar>0:ar}else this.traceInitMaxIdent=0,this.traceInitPerf=tr.DEFAULT_PARSER_CONFIG.traceInitPerf;this.traceInitIndent=-1},nr.prototype.TRACE_INIT=function(sr,ar){if(this.traceInitPerf===!0){this.traceInitIndent++;var or=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(or+"--> <"+sr+">");var lr=er.timer(ar),cr=lr.time,ur=lr.value,dr=cr>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&dr(or+"<-- <"+sr+"> time: "+cr+"ms"),this.traceInitIndent--,ur}else return ar()},nr}();rr.PerformanceTracer=ir}),Ia=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.applyMixins=void 0;function er(tr,ir){ir.forEach(function(nr){var sr=nr.prototype;Object.getOwnPropertyNames(sr).forEach(function(ar){if(ar!=="constructor"){var or=Object.getOwnPropertyDescriptor(sr,ar);or&&(or.get||or.set)?Object.defineProperty(tr.prototype,ar,or):tr.prototype[ar]=nr.prototype[ar]}})})}rr.applyMixins=er}),ce=R$1(rr=>{"use strict";var er=rr&&rr.__extends||function(){var Sr=function(br,Cr){return Sr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Ir,Rr){Ir.__proto__=Rr}||function(Ir,Rr){for(var Pr in Rr)Object.prototype.hasOwnProperty.call(Rr,Pr)&&(Ir[Pr]=Rr[Pr])},Sr(br,Cr)};return function(br,Cr){if(typeof Cr!="function"&&Cr!==null)throw new TypeError("Class extends value "+String(Cr)+" is not a constructor or null");Sr(br,Cr);function Ir(){this.constructor=br}br.prototype=Cr===null?Object.create(Cr):(Ir.prototype=Cr.prototype,new Ir)}}();Object.defineProperty(rr,"__esModule",{value:!0}),rr.EmbeddedActionsParser=rr.CstParser=rr.Parser=rr.EMPTY_ALT=rr.ParserDefinitionErrorType=rr.DEFAULT_RULE_CONFIG=rr.DEFAULT_PARSER_CONFIG=rr.END_OF_FILE=void 0;var tr=k(),ir=pi(),nr=Ue(),sr=mt(),ar=Ui(),or=zr(),lr=zi(),cr=ra(),ur=ia(),dr=oa(),hr=la(),pr=pa(),gr=va(),vr=Ra(),mr=Na(),fr=Ia();rr.END_OF_FILE=nr.createTokenInstance(nr.EOF,"",NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(rr.END_OF_FILE),rr.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:sr.defaultParserErrorProvider,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),rr.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0});var _r;(function(Sr){Sr[Sr.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",Sr[Sr.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",Sr[Sr.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",Sr[Sr.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",Sr[Sr.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",Sr[Sr.LEFT_RECURSION=5]="LEFT_RECURSION",Sr[Sr.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",Sr[Sr.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",Sr[Sr.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",Sr[Sr.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",Sr[Sr.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",Sr[Sr.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",Sr[Sr.TOO_MANY_ALTS=12]="TOO_MANY_ALTS"})(_r=rr.ParserDefinitionErrorType||(rr.ParserDefinitionErrorType={}));function Ar(Sr){return Sr===void 0&&(Sr=void 0),function(){return Sr}}rr.EMPTY_ALT=Ar;var yr=function(){function Sr(br,Cr){this.definitionErrors=[],this.selfAnalysisDone=!1;var Ir=this;if(Ir.initErrorHandler(Cr),Ir.initLexerAdapter(),Ir.initLooksAhead(Cr),Ir.initRecognizerEngine(br,Cr),Ir.initRecoverable(Cr),Ir.initTreeBuilder(Cr),Ir.initContentAssist(),Ir.initGastRecorder(Cr),Ir.initPerformanceTracer(Cr),tr.has(Cr,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=tr.has(Cr,"skipValidations")?Cr.skipValidations:rr.DEFAULT_PARSER_CONFIG.skipValidations}return Sr.performSelfAnalysis=function(br){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")},Sr.prototype.performSelfAnalysis=function(){var br=this;this.TRACE_INIT("performSelfAnalysis",function(){var Cr;br.selfAnalysisDone=!0;var Ir=br.className;br.TRACE_INIT("toFastProps",function(){tr.toFastProperties(br)}),br.TRACE_INIT("Grammar Recording",function(){try{br.enableRecording(),tr.forEach(br.definedRulesNames,function(Pr){var Dr=br[Pr],Fr=Dr.originalGrammarAction,Or=void 0;br.TRACE_INIT(Pr+" Rule",function(){Or=br.topLevelRuleRecord(Pr,Fr)}),br.gastProductionsCache[Pr]=Or})}finally{br.disableRecording()}});var Rr=[];if(br.TRACE_INIT("Grammar Resolving",function(){Rr=ar.resolveGrammar({rules:tr.values(br.gastProductionsCache)}),br.definitionErrors=br.definitionErrors.concat(Rr)}),br.TRACE_INIT("Grammar Validations",function(){if(tr.isEmpty(Rr)&&br.skipValidations===!1){var Pr=ar.validateGrammar({rules:tr.values(br.gastProductionsCache),maxLookahead:br.maxLookahead,tokenTypes:tr.values(br.tokensMap),errMsgProvider:sr.defaultGrammarValidatorErrorProvider,grammarName:Ir});br.definitionErrors=br.definitionErrors.concat(Pr)}}),tr.isEmpty(br.definitionErrors)&&(br.recoveryEnabled&&br.TRACE_INIT("computeAllProdsFollows",function(){var Pr=ir.computeAllProdsFollows(tr.values(br.gastProductionsCache));br.resyncFollows=Pr}),br.TRACE_INIT("ComputeLookaheadFunctions",function(){br.preComputeLookaheadFunctions(tr.values(br.gastProductionsCache))})),!Sr.DEFER_DEFINITION_ERRORS_HANDLING&&!tr.isEmpty(br.definitionErrors))throw Cr=tr.map(br.definitionErrors,function(Pr){return Pr.message}),new Error(`Parser Definition Errors detected:
 `+Cr.join(`
-------------------------------
`))})},Sr.DEFER_DEFINITION_ERRORS_HANDLING=!1,Sr}();rr.Parser=yr,fr.applyMixins(yr,[or.Recoverable,lr.LooksAhead,cr.TreeBuilder,ur.LexerAdapter,hr.RecognizerEngine,dr.RecognizerApi,pr.ErrorHandler,gr.ContentAssist,vr.GastRecorder,mr.PerformanceTracer]);var wr=function(Sr){er(br,Sr);function br(Cr,Ir){Ir===void 0&&(Ir=rr.DEFAULT_PARSER_CONFIG);var Rr=this,Pr=tr.cloneObj(Ir);return Pr.outputCst=!0,Rr=Sr.call(this,Cr,Pr)||this,Rr}return br}(yr);rr.CstParser=wr;var xr=function(Sr){er(br,Sr);function br(Cr,Ir){Ir===void 0&&(Ir=rr.DEFAULT_PARSER_CONFIG);var Rr=this,Pr=tr.cloneObj(Ir);return Pr.outputCst=!1,Rr=Sr.call(this,Cr,Pr)||this,Rr}return br}(yr);rr.EmbeddedActionsParser=xr}),La=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.createSyntaxDiagramsCode=void 0;var er=Er();function tr(ir,nr){var sr=nr===void 0?{}:nr,ar=sr.resourceBase,or=ar===void 0?"https://unpkg.com/chevrotain@"+er.VERSION+"/diagrams/":ar,lr=sr.css,cr=lr===void 0?"https://unpkg.com/chevrotain@"+er.VERSION+"/diagrams/diagrams.css":lr,ur=`
<!-- This is a generated file -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    background-color: hsl(30, 20%, 95%)
  }
</style>

`,dr=`
<link rel='stylesheet' href='`+cr+`'>
`,hr=`
<script src='`+or+`vendor/railroad-diagrams.js'><\/script>
<script src='`+or+`src/diagrams_builder.js'><\/script>
<script src='`+or+`src/diagrams_behavior.js'><\/script>
<script src='`+or+`src/main.js'><\/script>
`,pr=`
<div id="diagrams" align="center"></div>
`,gr=`
<script>
    window.serializedGrammar = `+JSON.stringify(ir,null,"  ")+`;
<\/script>
`,vr=`
<script>
    var diagramsDiv = document.getElementById("diagrams");
    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);
<\/script>
`;return ur+dr+hr+pr+gr+vr}rr.createSyntaxDiagramsCode=tr}),Fa=R$1(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0}),rr.Parser=rr.createSyntaxDiagramsCode=rr.clearCache=rr.GAstVisitor=rr.serializeProduction=rr.serializeGrammar=rr.Terminal=rr.Rule=rr.RepetitionWithSeparator=rr.RepetitionMandatoryWithSeparator=rr.RepetitionMandatory=rr.Repetition=rr.Option=rr.NonTerminal=rr.Alternative=rr.Alternation=rr.defaultLexerErrorProvider=rr.NoViableAltException=rr.NotAllInputParsedException=rr.MismatchedTokenException=rr.isRecognitionException=rr.EarlyExitException=rr.defaultParserErrorProvider=rr.tokenName=rr.tokenMatcher=rr.tokenLabel=rr.EOF=rr.createTokenInstance=rr.createToken=rr.LexerDefinitionErrorType=rr.Lexer=rr.EMPTY_ALT=rr.ParserDefinitionErrorType=rr.EmbeddedActionsParser=rr.CstParser=rr.VERSION=void 0;var er=Er();Object.defineProperty(rr,"VERSION",{enumerable:!0,get:function(){return er.VERSION}});var tr=ce();Object.defineProperty(rr,"CstParser",{enumerable:!0,get:function(){return tr.CstParser}}),Object.defineProperty(rr,"EmbeddedActionsParser",{enumerable:!0,get:function(){return tr.EmbeddedActionsParser}}),Object.defineProperty(rr,"ParserDefinitionErrorType",{enumerable:!0,get:function(){return tr.ParserDefinitionErrorType}}),Object.defineProperty(rr,"EMPTY_ALT",{enumerable:!0,get:function(){return tr.EMPTY_ALT}});var ir=ft();Object.defineProperty(rr,"Lexer",{enumerable:!0,get:function(){return ir.Lexer}}),Object.defineProperty(rr,"LexerDefinitionErrorType",{enumerable:!0,get:function(){return ir.LexerDefinitionErrorType}});var nr=Ue();Object.defineProperty(rr,"createToken",{enumerable:!0,get:function(){return nr.createToken}}),Object.defineProperty(rr,"createTokenInstance",{enumerable:!0,get:function(){return nr.createTokenInstance}}),Object.defineProperty(rr,"EOF",{enumerable:!0,get:function(){return nr.EOF}}),Object.defineProperty(rr,"tokenLabel",{enumerable:!0,get:function(){return nr.tokenLabel}}),Object.defineProperty(rr,"tokenMatcher",{enumerable:!0,get:function(){return nr.tokenMatcher}}),Object.defineProperty(rr,"tokenName",{enumerable:!0,get:function(){return nr.tokenName}});var sr=mt();Object.defineProperty(rr,"defaultParserErrorProvider",{enumerable:!0,get:function(){return sr.defaultParserErrorProvider}});var ar=et();Object.defineProperty(rr,"EarlyExitException",{enumerable:!0,get:function(){return ar.EarlyExitException}}),Object.defineProperty(rr,"isRecognitionException",{enumerable:!0,get:function(){return ar.isRecognitionException}}),Object.defineProperty(rr,"MismatchedTokenException",{enumerable:!0,get:function(){return ar.MismatchedTokenException}}),Object.defineProperty(rr,"NotAllInputParsedException",{enumerable:!0,get:function(){return ar.NotAllInputParsedException}}),Object.defineProperty(rr,"NoViableAltException",{enumerable:!0,get:function(){return ar.NoViableAltException}});var or=kr();Object.defineProperty(rr,"defaultLexerErrorProvider",{enumerable:!0,get:function(){return or.defaultLexerErrorProvider}});var lr=ne();Object.defineProperty(rr,"Alternation",{enumerable:!0,get:function(){return lr.Alternation}}),Object.defineProperty(rr,"Alternative",{enumerable:!0,get:function(){return lr.Alternative}}),Object.defineProperty(rr,"NonTerminal",{enumerable:!0,get:function(){return lr.NonTerminal}}),Object.defineProperty(rr,"Option",{enumerable:!0,get:function(){return lr.Option}}),Object.defineProperty(rr,"Repetition",{enumerable:!0,get:function(){return lr.Repetition}}),Object.defineProperty(rr,"RepetitionMandatory",{enumerable:!0,get:function(){return lr.RepetitionMandatory}}),Object.defineProperty(rr,"RepetitionMandatoryWithSeparator",{enumerable:!0,get:function(){return lr.RepetitionMandatoryWithSeparator}}),Object.defineProperty(rr,"RepetitionWithSeparator",{enumerable:!0,get:function(){return lr.RepetitionWithSeparator}}),Object.defineProperty(rr,"Rule",{enumerable:!0,get:function(){return lr.Rule}}),Object.defineProperty(rr,"Terminal",{enumerable:!0,get:function(){return lr.Terminal}});var cr=ne();Object.defineProperty(rr,"serializeGrammar",{enumerable:!0,get:function(){return cr.serializeGrammar}}),Object.defineProperty(rr,"serializeProduction",{enumerable:!0,get:function(){return cr.serializeProduction}});var ur=$e();Object.defineProperty(rr,"GAstVisitor",{enumerable:!0,get:function(){return ur.GAstVisitor}});function dr(){console.warn(`The clearCache function was 'soft' removed from the Chevrotain API.
	 It performs no action other than printing this message.
	 Please avoid using it as it will be completely removed in the future`)}rr.clearCache=dr;var hr=La();Object.defineProperty(rr,"createSyntaxDiagramsCode",{enumerable:!0,get:function(){return hr.createSyntaxDiagramsCode}});var pr=function(){function gr(){throw new Error(`The Parser class has been deprecated, use CstParser or EmbeddedActionsParser instead.
See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_7-0-0`)}return gr}();rr.Parser=pr});const chevrotain=Fa();class VRMLLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=sr.path===""?LoaderUtils.extractUrlBase(er):sr.path,or=new FileLoader(sr.manager);or.setPath(sr.path),or.setRequestHeader(sr.requestHeader),or.setWithCredentials(sr.withCredentials),or.load(er,function(lr){try{tr(sr.parse(lr,ar))}catch(cr){nr?nr(cr):console.error(cr),sr.manager.itemError(er)}},ir,nr)}parse(er,tr){const ir={};function nr(Ni){const Ri=sr(),qi=new VRMLLexer(Ri.tokens),as=new VRMLParser(Ri.tokenVocabulary),us=ar(as.getBaseCstVisitorConstructor()),gs=qi.lex(Ni);as.input=gs.tokens;const vs=as.vrml();if(as.errors.length>0)throw console.error(as.errors),Error("THREE.VRMLLoader: Parsing errors detected.");return us.visit(vs)}function sr(){const Ni=chevrotain.createToken,Ri=Ni({name:"RouteIdentifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*[\.][^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d][^\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]*/}),qi=Ni({name:"Identifier",pattern:/[^\x30-\x39\0-\x20\x22\x27\x23\x2b\x2c\x2d\x2e\x5b\x5d\x5c\x7b\x7d]([^\0-\x20\x22\x27\x23\x2b\x2c\x2e\x5b\x5d\x5c\x7b\x7d])*/,longer_alt:Ri}),as=["Anchor","Billboard","Collision","Group","Transform","Inline","LOD","Switch","AudioClip","DirectionalLight","PointLight","Script","Shape","Sound","SpotLight","WorldInfo","CylinderSensor","PlaneSensor","ProximitySensor","SphereSensor","TimeSensor","TouchSensor","VisibilitySensor","Box","Cone","Cylinder","ElevationGrid","Extrusion","IndexedFaceSet","IndexedLineSet","PointSet","Sphere","Color","Coordinate","Normal","TextureCoordinate","Appearance","FontStyle","ImageTexture","Material","MovieTexture","PixelTexture","TextureTransform","ColorInterpolator","CoordinateInterpolator","NormalInterpolator","OrientationInterpolator","PositionInterpolator","ScalarInterpolator","Background","Fog","NavigationInfo","Viewpoint","Text"],us=Ni({name:"Version",pattern:/#VRML.*/,longer_alt:qi}),gs=Ni({name:"NodeName",pattern:new RegExp(as.join("|")),longer_alt:qi}),vs=Ni({name:"DEF",pattern:/DEF/,longer_alt:qi}),_s=Ni({name:"USE",pattern:/USE/,longer_alt:qi}),As=Ni({name:"ROUTE",pattern:/ROUTE/,longer_alt:qi}),xs=Ni({name:"TO",pattern:/TO/,longer_alt:qi}),Es=Ni({name:"StringLiteral",pattern:/"(?:[^\\"\n\r]|\\[bfnrtv"\\/]|\\u[0-9a-fA-F][0-9a-fA-F][0-9a-fA-F][0-9a-fA-F])*"/}),Ps=Ni({name:"HexLiteral",pattern:/0[xX][0-9a-fA-F]+/}),Ns=Ni({name:"NumberLiteral",pattern:/[-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?/}),Vs=Ni({name:"TrueLiteral",pattern:/TRUE/}),Us=Ni({name:"FalseLiteral",pattern:/FALSE/}),Os=Ni({name:"NullLiteral",pattern:/NULL/}),ws=Ni({name:"LSquare",pattern:/\[/}),bs=Ni({name:"RSquare",pattern:/]/}),Ss=Ni({name:"LCurly",pattern:/{/}),Rs=Ni({name:"RCurly",pattern:/}/}),Hs=Ni({name:"Comment",pattern:/#.*/,group:chevrotain.Lexer.SKIPPED}),na=[Ni({name:"WhiteSpace",pattern:/[ ,\s]/,group:chevrotain.Lexer.SKIPPED}),gs,vs,_s,As,xs,Vs,Us,Os,us,qi,Ri,Es,Ps,Ns,ws,bs,Ss,Rs,Hs],xa={};for(let fa=0,Gs=na.length;fa<Gs;fa++){const Zs=na[fa];xa[Zs.name]=Zs}return{tokens:na,tokenVocabulary:xa}}function ar(Ni){class Ri extends Ni{constructor(){super(),this.validateVisitor()}vrml(us){const gs={version:this.visit(us.version),nodes:[],routes:[]};for(let vs=0,_s=us.node.length;vs<_s;vs++){const As=us.node[vs];gs.nodes.push(this.visit(As))}if(us.route)for(let vs=0,_s=us.route.length;vs<_s;vs++){const As=us.route[vs];gs.routes.push(this.visit(As))}return gs}version(us){return us.Version[0].image}node(us){const gs={name:us.NodeName[0].image,fields:[]};if(us.field)for(let vs=0,_s=us.field.length;vs<_s;vs++){const As=us.field[vs];gs.fields.push(this.visit(As))}return us.def&&(gs.DEF=this.visit(us.def[0])),gs}field(us){const gs={name:us.Identifier[0].image,type:null,values:null};let vs;return us.singleFieldValue&&(vs=this.visit(us.singleFieldValue[0])),us.multiFieldValue&&(vs=this.visit(us.multiFieldValue[0])),gs.type=vs.type,gs.values=vs.values,gs}def(us){return(us.Identifier||us.NodeName)[0].image}use(us){return{USE:(us.Identifier||us.NodeName)[0].image}}singleFieldValue(us){return qi(this,us)}multiFieldValue(us){return qi(this,us)}route(us){return{FROM:us.RouteIdentifier[0].image,TO:us.RouteIdentifier[1].image}}}function qi(as,us){const gs={type:null,values:[]};if(us.node){gs.type="node";for(let vs=0,_s=us.node.length;vs<_s;vs++){const As=us.node[vs];gs.values.push(as.visit(As))}}if(us.use){gs.type="use";for(let vs=0,_s=us.use.length;vs<_s;vs++){const As=us.use[vs];gs.values.push(as.visit(As))}}if(us.StringLiteral){gs.type="string";for(let vs=0,_s=us.StringLiteral.length;vs<_s;vs++){const As=us.StringLiteral[vs];gs.values.push(As.image.replace(/'|"/g,""))}}if(us.NumberLiteral){gs.type="number";for(let vs=0,_s=us.NumberLiteral.length;vs<_s;vs++){const As=us.NumberLiteral[vs];gs.values.push(parseFloat(As.image))}}if(us.HexLiteral){gs.type="hex";for(let vs=0,_s=us.HexLiteral.length;vs<_s;vs++){const As=us.HexLiteral[vs];gs.values.push(As.image)}}if(us.TrueLiteral){gs.type="boolean";for(let vs=0,_s=us.TrueLiteral.length;vs<_s;vs++)us.TrueLiteral[vs].image==="TRUE"&&gs.values.push(!0)}if(us.FalseLiteral){gs.type="boolean";for(let vs=0,_s=us.FalseLiteral.length;vs<_s;vs++)us.FalseLiteral[vs].image==="FALSE"&&gs.values.push(!1)}return us.NullLiteral&&(gs.type="null",us.NullLiteral.forEach(function(){gs.values.push(null)})),gs}return new Ri}function or(Ni){const Ri=Ni.nodes,qi=new Scene;for(let as=0,us=Ri.length;as<us;as++){const gs=Ri[as];lr(gs)}for(let as=0,us=Ri.length;as<us;as++){const gs=Ri[as],vs=cr(gs);vs instanceof Object3D&&qi.add(vs),gs.name==="WorldInfo"&&(qi.userData.worldInfo=vs)}return qi}function lr(Ni){Ni.DEF&&(ir[Ni.DEF]=Ni);const Ri=Ni.fields;for(let qi=0,as=Ri.length;qi<as;qi++){const us=Ri[qi];if(us.type==="node"){const gs=us.values;for(let vs=0,_s=gs.length;vs<_s;vs++)lr(gs[vs])}}}function cr(Ni){return Ni.USE?Nr(Ni.USE):(Ni.build!==void 0||(Ni.build=ur(Ni)),Ni.build)}function ur(Ni){const Ri=Ni.name;let qi;switch(Ri){case"Anchor":case"Group":case"Transform":case"Collision":qi=dr(Ni);break;case"Background":qi=hr(Ni);break;case"Shape":qi=pr(Ni);break;case"Appearance":qi=gr(Ni);break;case"Material":qi=vr(Ni);break;case"ImageTexture":qi=Ar(Ni);break;case"PixelTexture":qi=_r(Ni);break;case"TextureTransform":qi=yr(Ni);break;case"IndexedFaceSet":qi=Sr(Ni);break;case"IndexedLineSet":qi=br(Ni);break;case"PointSet":qi=Cr(Ni);break;case"Box":qi=Ir(Ni);break;case"Cone":qi=Rr(Ni);break;case"Cylinder":qi=Pr(Ni);break;case"Sphere":qi=Dr(Ni);break;case"ElevationGrid":qi=Fr(Ni);break;case"Extrusion":qi=Or(Ni);break;case"Color":case"Coordinate":case"Normal":case"TextureCoordinate":qi=wr(Ni);break;case"WorldInfo":qi=xr(Ni);break;case"Billboard":case"Inline":case"LOD":case"Switch":case"AudioClip":case"DirectionalLight":case"PointLight":case"Script":case"Sound":case"SpotLight":case"CylinderSensor":case"PlaneSensor":case"ProximitySensor":case"SphereSensor":case"TimeSensor":case"TouchSensor":case"VisibilitySensor":case"Text":case"FontStyle":case"MovieTexture":case"ColorInterpolator":case"CoordinateInterpolator":case"NormalInterpolator":case"OrientationInterpolator":case"PositionInterpolator":case"ScalarInterpolator":case"Fog":case"NavigationInfo":case"Viewpoint":break;default:console.warn("THREE.VRMLLoader: Unknown node:",Ri);break}return qi!==void 0&&Ni.DEF!==void 0&&qi.hasOwnProperty("name")===!0&&(qi.name=Ni.DEF),qi}function dr(Ni){const Ri=new Group,qi=Ni.fields;for(let as=0,us=qi.length;as<us;as++){const gs=qi[as],vs=gs.name,_s=gs.values;switch(vs){case"bboxCenter":break;case"bboxSize":break;case"center":break;case"children":Ur(_s,Ri);break;case"description":break;case"collide":break;case"parameter":break;case"rotation":const As=new Vector3$1(_s[0],_s[1],_s[2]).normalize(),xs=_s[3];Ri.quaternion.setFromAxisAngle(As,xs);break;case"scale":Ri.scale.set(_s[0],_s[1],_s[2]);break;case"scaleOrientation":break;case"translation":Ri.position.set(_s[0],_s[1],_s[2]);break;case"proxy":break;case"url":break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return Ri}function hr(Ni){const Ri=new Group;let qi,as,us,gs;const vs=Ni.fields;for(let As=0,xs=vs.length;As<xs;As++){const Es=vs[As],Ps=Es.name,Ns=Es.values;switch(Ps){case"groundAngle":qi=Ns;break;case"groundColor":as=Ns;break;case"backUrl":break;case"bottomUrl":break;case"frontUrl":break;case"leftUrl":break;case"rightUrl":break;case"topUrl":break;case"skyAngle":us=Ns;break;case"skyColor":gs=Ns;break;default:console.warn("THREE.VRMLLoader: Unknown field:",Ps);break}}const _s=1e4;if(gs){const As=new SphereGeometry(_s,32,16),xs=new MeshBasicMaterial({fog:!1,side:BackSide,depthWrite:!1,depthTest:!1});gs.length>3?(es(As,_s,us,cs(gs),!0),xs.vertexColors=!0):xs.color.setRGB(gs[0],gs[1],gs[2],SRGBColorSpace);const Es=new Mesh(As,xs);Ri.add(Es)}if(as&&as.length>0){const As=new SphereGeometry(_s,32,16,0,2*Math.PI,.5*Math.PI,1.5*Math.PI),xs=new MeshBasicMaterial({fog:!1,side:BackSide,vertexColors:!0,depthWrite:!1,depthTest:!1});es(As,_s,qi,cs(as),!1);const Es=new Mesh(As,xs);Ri.add(Es)}return Ri.renderOrder=-1/0,Ri}function pr(Ni){const Ri=Ni.fields;let qi=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:0}),as;for(let gs=0,vs=Ri.length;gs<vs;gs++){const _s=Ri[gs],As=_s.name,xs=_s.values;switch(As){case"appearance":xs[0]!==null&&(qi=cr(xs[0]));break;case"geometry":xs[0]!==null&&(as=cr(xs[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}let us;if(as&&as.attributes.position){const gs=as._type;if(gs==="points"){const vs=new PointsMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,opacity:qi.opacity,transparent:qi.transparent});as.attributes.color!==void 0?vs.vertexColors=!0:qi.isMeshPhongMaterial&&vs.color.copy(qi.emissive),us=new Points(as,vs)}else if(gs==="line"){const vs=new LineBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:16777215,opacity:qi.opacity,transparent:qi.transparent});as.attributes.color!==void 0?vs.vertexColors=!0:qi.isMeshPhongMaterial&&vs.color.copy(qi.emissive),us=new LineSegments(as,vs)}else as._solid!==void 0&&(qi.side=as._solid?FrontSide:DoubleSide),as.attributes.color!==void 0&&(qi.vertexColors=!0),us=new Mesh(as,qi)}else us=new Object3D,us.visible=!1;return us}function gr(Ni){let Ri=new MeshPhongMaterial,qi;const as=Ni.fields;for(let us=0,gs=as.length;us<gs;us++){const vs=as[us],_s=vs.name,As=vs.values;switch(_s){case"material":if(As[0]!==null){const Es=cr(As[0]);Es.diffuseColor&&Ri.color.copy(Es.diffuseColor),Es.emissiveColor&&Ri.emissive.copy(Es.emissiveColor),Es.shininess&&(Ri.shininess=Es.shininess),Es.specularColor&&Ri.specular.copy(Es.specularColor),Es.transparency&&(Ri.opacity=1-Es.transparency),Es.transparency>0&&(Ri.transparent=!0)}else Ri=new MeshBasicMaterial({name:Loader.DEFAULT_MATERIAL_NAME,color:0});break;case"texture":const xs=As[0];xs!==null&&(xs.name==="ImageTexture"||xs.name==="PixelTexture")&&(Ri.map=cr(xs));break;case"textureTransform":As[0]!==null&&(qi=cr(As[0]));break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}if(Ri.map){if(Ri.map.__type){switch(Ri.map.__type){case TEXTURE_TYPE.INTENSITY_ALPHA:Ri.opacity=1;break;case TEXTURE_TYPE.RGB:Ri.color.set(16777215);break;case TEXTURE_TYPE.RGBA:Ri.color.set(16777215),Ri.opacity=1;break;default:}delete Ri.map.__type}qi&&(Ri.map.center.copy(qi.center),Ri.map.rotation=qi.rotation,Ri.map.repeat.copy(qi.scale),Ri.map.offset.copy(qi.translation))}return Ri}function vr(Ni){const Ri={},qi=Ni.fields;for(let as=0,us=qi.length;as<us;as++){const gs=qi[as],vs=gs.name,_s=gs.values;switch(vs){case"ambientIntensity":break;case"diffuseColor":Ri.diffuseColor=new Color().setRGB(_s[0],_s[1],_s[2],SRGBColorSpace);break;case"emissiveColor":Ri.emissiveColor=new Color().setRGB(_s[0],_s[1],_s[2],SRGBColorSpace);break;case"shininess":Ri.shininess=_s[0];break;case"specularColor":Ri.specularColor=new Color().setRGB(_s[0],_s[1],_s[2],SRGBColorSpace);break;case"transparency":Ri.transparency=_s[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return Ri}function mr(Ni,Ri,qi){let as;switch(Ri){case TEXTURE_TYPE.INTENSITY:as=parseInt(Ni),qi.r=as,qi.g=as,qi.b=as,qi.a=1;break;case TEXTURE_TYPE.INTENSITY_ALPHA:as=parseInt("0x"+Ni.substring(2,4)),qi.r=as,qi.g=as,qi.b=as,qi.a=parseInt("0x"+Ni.substring(4,6));break;case TEXTURE_TYPE.RGB:qi.r=parseInt("0x"+Ni.substring(2,4)),qi.g=parseInt("0x"+Ni.substring(4,6)),qi.b=parseInt("0x"+Ni.substring(6,8)),qi.a=1;break;case TEXTURE_TYPE.RGBA:qi.r=parseInt("0x"+Ni.substring(2,4)),qi.g=parseInt("0x"+Ni.substring(4,6)),qi.b=parseInt("0x"+Ni.substring(6,8)),qi.a=parseInt("0x"+Ni.substring(8,10));break;default:}}function fr(Ni){let Ri;switch(Ni){case 1:Ri=TEXTURE_TYPE.INTENSITY;break;case 2:Ri=TEXTURE_TYPE.INTENSITY_ALPHA;break;case 3:Ri=TEXTURE_TYPE.RGB;break;case 4:Ri=TEXTURE_TYPE.RGBA;break;default:}return Ri}function _r(Ni){let Ri,qi=RepeatWrapping,as=RepeatWrapping;const us=Ni.fields;for(let gs=0,vs=us.length;gs<vs;gs++){const _s=us[gs],As=_s.name,xs=_s.values;switch(As){case"image":const Es=xs[0],Ps=xs[1],Ns=xs[2],Vs=fr(Ns),Us=new Uint8Array(4*Es*Ps),Os={r:0,g:0,b:0,a:0};for(let ws=3,bs=0,Ss=xs.length;ws<Ss;ws++,bs++){mr(xs[ws],Vs,Os);const Rs=bs*4;Us[Rs+0]=Os.r,Us[Rs+1]=Os.g,Us[Rs+2]=Os.b,Us[Rs+3]=Os.a}Ri=new DataTexture(Us,Es,Ps),Ri.colorSpace=SRGBColorSpace,Ri.needsUpdate=!0,Ri.__type=Vs;break;case"repeatS":xs[0]===!1&&(qi=ClampToEdgeWrapping);break;case"repeatT":xs[0]===!1&&(as=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return Ri&&(Ri.wrapS=qi,Ri.wrapT=as),Ri}function Ar(Ni){let Ri,qi=RepeatWrapping,as=RepeatWrapping;const us=Ni.fields;for(let gs=0,vs=us.length;gs<vs;gs++){const _s=us[gs],As=_s.name,xs=_s.values;switch(As){case"url":const Es=xs[0];Es&&(Ri=ms.load(Es));break;case"repeatS":xs[0]===!1&&(qi=ClampToEdgeWrapping);break;case"repeatT":xs[0]===!1&&(as=ClampToEdgeWrapping);break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return Ri&&(Ri.wrapS=qi,Ri.wrapT=as,Ri.colorSpace=SRGBColorSpace),Ri}function yr(Ni){const Ri={center:new Vector2,rotation:new Vector2,scale:new Vector2,translation:new Vector2},qi=Ni.fields;for(let as=0,us=qi.length;as<us;as++){const gs=qi[as],vs=gs.name,_s=gs.values;switch(vs){case"center":Ri.center.set(_s[0],_s[1]);break;case"rotation":Ri.rotation=_s[0];break;case"scale":Ri.scale.set(_s[0],_s[1]);break;case"translation":Ri.translation.set(_s[0],_s[1]);break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return Ri}function wr(Ni){return Ni.fields[0].values}function xr(Ni){const Ri={},qi=Ni.fields;for(let as=0,us=qi.length;as<us;as++){const gs=qi[as],vs=gs.name,_s=gs.values;switch(vs){case"title":Ri.title=_s[0];break;case"info":Ri.info=_s;break;default:console.warn("THREE.VRMLLoader: Unknown field:",vs);break}}return Ri}function Sr(Ni){let Ri,qi,as,us,gs=!0,vs=!0,_s=0,As,xs,Es,Ps,Ns=!0,Vs=!0;const Us=Ni.fields;for(let ks=0,na=Us.length;ks<na;ks++){const xa=Us[ks],fa=xa.name,Gs=xa.values;switch(fa){case"color":const Zs=Gs[0];Zs!==null&&(Ri=cr(Zs));break;case"coord":const Ys=Gs[0];Ys!==null&&(qi=cr(Ys));break;case"normal":const Js=Gs[0];Js!==null&&(as=cr(Js));break;case"texCoord":const aa=Gs[0];aa!==null&&(us=cr(aa));break;case"ccw":gs=Gs[0];break;case"colorIndex":As=Gs;break;case"colorPerVertex":Ns=Gs[0];break;case"convex":break;case"coordIndex":xs=Gs;break;case"creaseAngle":_s=Gs[0];break;case"normalIndex":Es=Gs;break;case"normalPerVertex":Vs=Gs[0];break;case"solid":vs=Gs[0];break;case"texCoordIndex":Ps=Gs;break;default:console.warn("THREE.VRMLLoader: Unknown field:",fa);break}}if(xs===void 0)return console.warn("THREE.VRMLLoader: Missing coordIndex."),new BufferGeometry;const Os=Br(xs,gs);let ws,bs,Ss;if(Ri){if(Ns===!0)if(As&&As.length>0){const ks=Br(As,gs);ws=ji(Os,ks,Ri,3)}else ws=Ki(Os,new Float32BufferAttribute(Ri,3));else if(As&&As.length>0){const ks=Xr(Ri,As),na=Wr(ks,xs);ws=Jr(Os,na)}else{const ks=Wr(Ri,xs);ws=Jr(Os,ks)}ss(ws)}if(as)if(Vs===!0)if(Es&&Es.length>0){const ks=Br(Es,gs);bs=ji(Os,ks,as,3)}else bs=Ki(Os,new Float32BufferAttribute(as,3));else if(Es&&Es.length>0){const ks=Xr(as,Es),na=Wr(ks,xs);bs=Jr(Os,na)}else{const ks=Wr(as,xs);bs=Jr(Os,ks)}else bs=is(Os,qi,_s);if(us)if(Ps&&Ps.length>0){const ks=Br(Ps,gs);Ss=ji(Os,ks,us,2)}else Ss=Ki(Os,new Float32BufferAttribute(us,2));const Rs=new BufferGeometry,Hs=Ki(Os,new Float32BufferAttribute(qi,3));return Rs.setAttribute("position",Hs),Rs.setAttribute("normal",bs),ws&&Rs.setAttribute("color",ws),Ss&&Rs.setAttribute("uv",Ss),Rs._solid=vs,Rs._type="mesh",Rs}function br(Ni){let Ri,qi,as,us,gs=!0;const vs=Ni.fields;for(let Ps=0,Ns=vs.length;Ps<Ns;Ps++){const Vs=vs[Ps],Us=Vs.name,Os=Vs.values;switch(Us){case"color":const ws=Os[0];ws!==null&&(Ri=cr(ws));break;case"coord":const bs=Os[0];bs!==null&&(qi=cr(bs));break;case"colorIndex":as=Os;break;case"colorPerVertex":gs=Os[0];break;case"coordIndex":us=Os;break;default:console.warn("THREE.VRMLLoader: Unknown field:",Us);break}}let _s;const As=Yr(us);if(Ri){if(gs===!0)if(as.length>0){const Ps=Yr(as);_s=ji(As,Ps,Ri,3)}else _s=Ki(As,new Float32BufferAttribute(Ri,3));else if(as.length>0){const Ps=Xr(Ri,as),Ns=Qi(Ps,us);_s=Ji(As,Ns)}else{const Ps=Qi(Ri,us);_s=Ji(As,Ps)}ss(_s)}const xs=new BufferGeometry,Es=Ki(As,new Float32BufferAttribute(qi,3));return xs.setAttribute("position",Es),_s&&xs.setAttribute("color",_s),xs._type="line",xs}function Cr(Ni){let Ri,qi;const as=Ni.fields;for(let gs=0,vs=as.length;gs<vs;gs++){const _s=as[gs],As=_s.name,xs=_s.values;switch(As){case"color":const Es=xs[0];Es!==null&&(Ri=cr(Es));break;case"coord":const Ps=xs[0];Ps!==null&&(qi=cr(Ps));break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}const us=new BufferGeometry;if(us.setAttribute("position",new Float32BufferAttribute(qi,3)),Ri){const gs=new Float32BufferAttribute(Ri,3);ss(gs),us.setAttribute("color",gs)}return us._type="points",us}function Ir(Ni){const Ri=new Vector3$1(2,2,2),qi=Ni.fields;for(let us=0,gs=qi.length;us<gs;us++){const vs=qi[us],_s=vs.name,As=vs.values;switch(_s){case"size":Ri.x=As[0],Ri.y=As[1],Ri.z=As[2];break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return new BoxGeometry(Ri.x,Ri.y,Ri.z)}function Rr(Ni){let Ri=1,qi=2,as=!1;const us=Ni.fields;for(let vs=0,_s=us.length;vs<_s;vs++){const As=us[vs],xs=As.name,Es=As.values;switch(xs){case"bottom":as=!Es[0];break;case"bottomRadius":Ri=Es[0];break;case"height":qi=Es[0];break;case"side":break;default:console.warn("THREE.VRMLLoader: Unknown field:",xs);break}}return new ConeGeometry(Ri,qi,16,1,as)}function Pr(Ni){let Ri=1,qi=2;const as=Ni.fields;for(let gs=0,vs=as.length;gs<vs;gs++){const _s=as[gs],As=_s.name,xs=_s.values;switch(As){case"bottom":break;case"radius":Ri=xs[0];break;case"height":qi=xs[0];break;case"side":break;case"top":break;default:console.warn("THREE.VRMLLoader: Unknown field:",As);break}}return new CylinderGeometry(Ri,Ri,qi,16,1)}function Dr(Ni){let Ri=1;const qi=Ni.fields;for(let us=0,gs=qi.length;us<gs;us++){const vs=qi[us],_s=vs.name,As=vs.values;switch(_s){case"radius":Ri=As[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",_s);break}}return new SphereGeometry(Ri,16,16)}function Fr(Ni){let Ri,qi,as,us,gs=!0,vs=!0,_s=!0,As=!0,xs=0,Es=2,Ps=2,Ns=1,Vs=1;const Us=Ni.fields;for(let Gs=0,Zs=Us.length;Gs<Zs;Gs++){const Ys=Us[Gs],Js=Ys.name,aa=Ys.values;switch(Js){case"color":const Ta=aa[0];Ta!==null&&(Ri=cr(Ta));break;case"normal":const za=aa[0];za!==null&&(qi=cr(za));break;case"texCoord":const Ga=aa[0];Ga!==null&&(as=cr(Ga));break;case"height":us=aa;break;case"ccw":As=aa[0];break;case"colorPerVertex":gs=aa[0];break;case"creaseAngle":xs=aa[0];break;case"normalPerVertex":vs=aa[0];break;case"solid":_s=aa[0];break;case"xDimension":Es=aa[0];break;case"xSpacing":Ns=aa[0];break;case"zDimension":Ps=aa[0];break;case"zSpacing":Vs=aa[0];break;default:console.warn("THREE.VRMLLoader: Unknown field:",Js);break}}const Os=[],ws=[],bs=[],Ss=[];for(let Gs=0;Gs<Ps;Gs++)for(let Zs=0;Zs<Es;Zs++){const Ys=Gs*Es+Zs,Js=Ns*Gs,aa=us[Ys],Ta=Vs*Zs;if(Os.push(Js,aa,Ta),Ri&&gs===!0){const za=Ri[Ys*3+0],Ga=Ri[Ys*3+1],Qa=Ri[Ys*3+2];bs.push(za,Ga,Qa)}if(qi&&vs===!0){const za=qi[Ys*3+0],Ga=qi[Ys*3+1],Qa=qi[Ys*3+2];ws.push(za,Ga,Qa)}if(as){const za=as[Ys*2+0],Ga=as[Ys*2+1];Ss.push(za,Ga)}else Ss.push(Gs/(Es-1),Zs/(Ps-1))}const Rs=[];for(let Gs=0;Gs<Es-1;Gs++)for(let Zs=0;Zs<Ps-1;Zs++){const Ys=Gs+Zs*Es,Js=Gs+(Zs+1)*Es,aa=Gs+1+(Zs+1)*Es,Ta=Gs+1+Zs*Es;As===!0?(Rs.push(Ys,aa,Js),Rs.push(aa,Ys,Ta)):(Rs.push(Ys,Js,aa),Rs.push(aa,Ta,Ys))}const Hs=Ki(Rs,new Float32BufferAttribute(Os,3)),ks=Ki(Rs,new Float32BufferAttribute(Ss,2));let na,xa;if(Ri){if(gs===!1){for(let Gs=0;Gs<Es-1;Gs++)for(let Zs=0;Zs<Ps-1;Zs++){const Ys=Gs+Zs*(Es-1),Js=Ri[Ys*3+0],aa=Ri[Ys*3+1],Ta=Ri[Ys*3+2];bs.push(Js,aa,Ta),bs.push(Js,aa,Ta),bs.push(Js,aa,Ta),bs.push(Js,aa,Ta),bs.push(Js,aa,Ta),bs.push(Js,aa,Ta)}na=new Float32BufferAttribute(bs,3)}else na=Ki(Rs,new Float32BufferAttribute(bs,3));ss(na)}if(qi)if(vs===!1){for(let Gs=0;Gs<Es-1;Gs++)for(let Zs=0;Zs<Ps-1;Zs++){const Ys=Gs+Zs*(Es-1),Js=qi[Ys*3+0],aa=qi[Ys*3+1],Ta=qi[Ys*3+2];ws.push(Js,aa,Ta),ws.push(Js,aa,Ta),ws.push(Js,aa,Ta),ws.push(Js,aa,Ta),ws.push(Js,aa,Ta),ws.push(Js,aa,Ta)}xa=new Float32BufferAttribute(ws,3)}else xa=Ki(Rs,new Float32BufferAttribute(ws,3));else xa=is(Rs,Os,xs);const fa=new BufferGeometry;return fa.setAttribute("position",Hs),fa.setAttribute("normal",xa),fa.setAttribute("uv",ks),na&&fa.setAttribute("color",na),fa._solid=_s,fa._type="mesh",fa}function Or(Ni){let Ri=[1,1,1,-1,-1,-1,-1,1,1,1],qi=[0,0,0,0,1,0],as,us,gs=!0,vs=!0,_s=0,As=!0,xs=!0;const Es=Ni.fields;for(let fa=0,Gs=Es.length;fa<Gs;fa++){const Zs=Es[fa],Ys=Zs.name,Js=Zs.values;switch(Ys){case"beginCap":gs=Js[0];break;case"ccw":vs=Js[0];break;case"convex":break;case"creaseAngle":_s=Js[0];break;case"crossSection":Ri=Js;break;case"endCap":As=Js[0];break;case"orientation":us=Js;break;case"scale":as=Js;break;case"solid":xs=Js[0];break;case"spine":qi=Js;break;default:console.warn("THREE.VRMLLoader: Unknown field:",Ys);break}}const Ps=Ri[0]===Ri[Ri.length-2]&&Ri[1]===Ri[Ri.length-1],Ns=[],Vs=new Vector3$1,Us=new Vector3$1,Os=new Vector3$1,ws=new Vector3$1,bs=new Quaternion$1;for(let fa=0,Gs=0,Zs=0,Ys=qi.length;fa<Ys;fa+=3,Gs+=2,Zs+=4){Vs.fromArray(qi,fa),Us.x=as?as[Gs+0]:1,Us.y=1,Us.z=as?as[Gs+1]:1,Os.x=us?us[Zs+0]:0,Os.y=us?us[Zs+1]:0,Os.z=us?us[Zs+2]:1;const Js=us?us[Zs+3]:0;for(let aa=0,Ta=Ri.length;aa<Ta;aa+=2)ws.x=Ri[aa+0],ws.y=0,ws.z=Ri[aa+1],ws.multiply(Us),bs.setFromAxisAngle(Os,Js),ws.applyQuaternion(bs),ws.add(Vs),Ns.push(ws.x,ws.y,ws.z)}const Ss=[],Rs=qi.length/3,Hs=Ri.length/2;for(let fa=0;fa<Rs-1;fa++)for(let Gs=0;Gs<Hs-1;Gs++){const Zs=Gs+fa*Hs;let Ys=Gs+1+fa*Hs;const Js=Gs+(fa+1)*Hs;let aa=Gs+1+(fa+1)*Hs;Gs===Hs-2&&Ps===!0&&(Ys=fa*Hs,aa=(fa+1)*Hs),vs===!0?(Ss.push(Zs,Ys,Js),Ss.push(Js,Ys,aa)):(Ss.push(Zs,Js,Ys),Ss.push(Js,aa,Ys))}if(gs===!0||As===!0){const fa=[];for(let Ys=0,Js=Ri.length;Ys<Js;Ys+=2)fa.push(new Vector2(Ri[Ys],Ri[Ys+1]));const Gs=ShapeUtils.triangulateShape(fa,[]),Zs=[];for(let Ys=0,Js=Gs.length;Ys<Js;Ys++){const aa=Gs[Ys];Zs.push(aa[0],aa[1],aa[2])}if(gs===!0)for(let Ys=0,Js=Zs.length;Ys<Js;Ys+=3)vs===!0?Ss.push(Zs[Ys+0],Zs[Ys+1],Zs[Ys+2]):Ss.push(Zs[Ys+0],Zs[Ys+2],Zs[Ys+1]);if(As===!0){const Ys=Hs*(Rs-1);for(let Js=0,aa=Zs.length;Js<aa;Js+=3)vs===!0?Ss.push(Ys+Zs[Js+0],Ys+Zs[Js+2],Ys+Zs[Js+1]):Ss.push(Ys+Zs[Js+0],Ys+Zs[Js+1],Ys+Zs[Js+2])}}const ks=Ki(Ss,new Float32BufferAttribute(Ns,3)),na=is(Ss,Ns,_s),xa=new BufferGeometry;return xa.setAttribute("position",ks),xa.setAttribute("normal",na),xa._solid=xs,xa._type="mesh",xa}function Nr(Ni){const Ri=ir[Ni],qi=cr(Ri);return qi.isObject3D||qi.isMaterial?qi.clone():qi}function Ur(Ni,Ri){for(let qi=0,as=Ni.length;qi<as;qi++){const us=cr(Ni[qi]);us instanceof Object3D&&Ri.add(us)}}function Br(Ni,Ri){const qi=[];let as=0;for(let us=0,gs=Ni.length;us<gs;us++){const vs=Ni[as],_s=Ni[us+(Ri?1:2)],As=Ni[us+(Ri?2:1)];qi.push(vs,_s,As),(Ni[us+3]===-1||us+3>=gs)&&(us+=3,as=us+1)}return qi}function Wr(Ni,Ri){const qi=[];let as=0;for(let us=0,gs=Ri.length;us<gs;us++){const vs=as*3,_s=Ni[vs],As=Ni[vs+1],xs=Ni[vs+2];qi.push(_s,As,xs),(Ri[us+3]===-1||us+3>=gs)&&(us+=3,as++)}return qi}function Xr(Ni,Ri){const qi=[];for(let as=0,us=Ri.length;as<us;as++){const vs=Ri[as]*3,_s=Ni[vs],As=Ni[vs+1],xs=Ni[vs+2];qi.push(_s,As,xs)}return qi}function Yr(Ni){const Ri=[];for(let qi=0,as=Ni.length;qi<as;qi++){const us=Ni[qi],gs=Ni[qi+1];Ri.push(us,gs),(Ni[qi+2]===-1||qi+2>=as)&&(qi+=2)}return Ri}function Qi(Ni,Ri){const qi=[];let as=0;for(let us=0,gs=Ri.length;us<gs;us++){const vs=as*3,_s=Ni[vs],As=Ni[vs+1],xs=Ni[vs+2];qi.push(_s,As,xs),(Ri[us+2]===-1||us+2>=gs)&&(us+=2,as++)}return qi}const Xi=new Vector3$1,Kr=new Vector3$1,$r=new Vector3$1,Vr=new Vector2,Gr=new Vector2,qr=new Vector2;function ji(Ni,Ri,qi,as){const us=[];for(let gs=0,vs=Ni.length;gs<vs;gs+=3){const _s=Ri[gs],As=Ri[gs+1],xs=Ri[gs+2];as===2?(Vr.fromArray(qi,_s*as),Gr.fromArray(qi,As*as),qr.fromArray(qi,xs*as),us.push(Vr.x,Vr.y),us.push(Gr.x,Gr.y),us.push(qr.x,qr.y)):(Xi.fromArray(qi,_s*as),Kr.fromArray(qi,As*as),$r.fromArray(qi,xs*as),us.push(Xi.x,Xi.y,Xi.z),us.push(Kr.x,Kr.y,Kr.z),us.push($r.x,$r.y,$r.z))}return new Float32BufferAttribute(us,as)}function Jr(Ni,Ri){const qi=[];for(let as=0,us=0,gs=Ni.length;as<gs;as+=3,us++)Xi.fromArray(Ri,us*3),qi.push(Xi.x,Xi.y,Xi.z),qi.push(Xi.x,Xi.y,Xi.z),qi.push(Xi.x,Xi.y,Xi.z);return new Float32BufferAttribute(qi,3)}function Ji(Ni,Ri){const qi=[];for(let as=0,us=0,gs=Ni.length;as<gs;as+=2,us++)Xi.fromArray(Ri,us*3),qi.push(Xi.x,Xi.y,Xi.z),qi.push(Xi.x,Xi.y,Xi.z);return new Float32BufferAttribute(qi,3)}function Ki(Ni,Ri){const qi=Ri.array,as=Ri.itemSize,us=new qi.constructor(Ni.length*as);let gs=0,vs=0;for(let _s=0,As=Ni.length;_s<As;_s++){gs=Ni[_s]*as;for(let xs=0;xs<as;xs++)us[vs++]=qi[gs++]}return new Float32BufferAttribute(us,as)}const Zi=new Vector3$1,Zr=new Vector3$1;function is(Ni,Ri,qi){const as=[],us={};for(let vs=0,_s=Ni.length;vs<_s;vs+=3){const As=Ni[vs],xs=Ni[vs+1],Es=Ni[vs+2],Ps=new Face(As,xs,Es);Xi.fromArray(Ri,As*3),Kr.fromArray(Ri,xs*3),$r.fromArray(Ri,Es*3),Zr.subVectors($r,Kr),Zi.subVectors(Xi,Kr),Zr.cross(Zi),Zr.normalize(),Ps.normal.copy(Zr),us[As]===void 0&&(us[As]=[]),us[xs]===void 0&&(us[xs]=[]),us[Es]===void 0&&(us[Es]=[]),us[As].push(Ps.normal),us[xs].push(Ps.normal),us[Es].push(Ps.normal),as.push(Ps)}const gs=[];for(let vs=0,_s=as.length;vs<_s;vs++){const As=as[vs],xs=os(us[As.a],As.normal,qi),Es=os(us[As.b],As.normal,qi),Ps=os(us[As.c],As.normal,qi);Xi.fromArray(Ri,As.a*3),Kr.fromArray(Ri,As.b*3),$r.fromArray(Ri,As.c*3),gs.push(xs.x,xs.y,xs.z),gs.push(Es.x,Es.y,Es.z),gs.push(Ps.x,Ps.y,Ps.z)}return new Float32BufferAttribute(gs,3)}function os(Ni,Ri,qi){const as=new Vector3$1;if(qi===0)as.copy(Ri);else for(let us=0,gs=Ni.length;us<gs;us++)Ni[us].angleTo(Ri)<qi&&as.add(Ni[us]);return as.normalize()}function cs(Ni){const Ri=[];for(let qi=0,as=Ni.length;qi<as;qi+=3)Ri.push(new Color(Ni[qi],Ni[qi+1],Ni[qi+2]));return Ri}function ss(Ni){const Ri=new Color;for(let qi=0;qi<Ni.count;qi++)Ri.fromBufferAttribute(Ni,qi),ColorManagement.toWorkingColorSpace(Ri,SRGBColorSpace),Ni.setXYZ(qi,Ri.r,Ri.g,Ri.b)}function es(Ni,Ri,qi,as,us){const gs=[],vs=us===!0?0:Math.PI;for(let Ns=0,Vs=as.length;Ns<Vs;Ns++){let Us=Ns===0?0:qi[Ns-1];Us=us===!0?Us:vs-Us;const Os=new Vector3$1;Os.setFromSphericalCoords(Ri,Us,0),gs.push(Os)}const _s=Ni.index,As=Ni.attributes.position,xs=new BufferAttribute(new Float32Array(Ni.attributes.position.count*3),3),Es=new Vector3$1,Ps=new Color;for(let Ns=0;Ns<_s.count;Ns++){const Vs=_s.getX(Ns);Es.fromBufferAttribute(As,Vs);let Us,Os,ws=1;for(let Rs=1;Rs<gs.length;Rs++){Us=Rs-1,Os=Rs;const Hs=gs[Us],ks=gs[Os];if(us===!0){if(Es.y<=Hs.y&&Es.y>ks.y){ws=Math.abs(Hs.y-Es.y)/Math.abs(Hs.y-ks.y);break}}else if(Es.y>=Hs.y&&Es.y<ks.y){ws=Math.abs(Hs.y-Es.y)/Math.abs(Hs.y-ks.y);break}}const bs=as[Us],Ss=as[Os];Ps.copy(bs).lerp(Ss,ws),ColorManagement.toWorkingColorSpace(Ps,SRGBColorSpace),xs.setXYZ(Vs,Ps.r,Ps.g,Ps.b)}Ni.setAttribute("color",xs)}const ms=new TextureLoader(this.manager);if(ms.setPath(this.resourcePath||tr).setCrossOrigin(this.crossOrigin),er.indexOf("#VRML V2.0")===-1)throw Error("THREE.VRMLLexer: Version of VRML asset not supported.");const Yi=nr(er);return or(Yi)}}class VRMLLexer{constructor(er){this.lexer=new chevrotain.Lexer(er)}lex(er){const tr=this.lexer.tokenize(er);if(tr.errors.length>0)throw console.error(tr.errors),Error("THREE.VRMLLexer: Lexing errors detected.");return tr}}const CstParser=chevrotain.CstParser;class VRMLParser extends CstParser{constructor(er){super(er);const tr=this,ir=er.Version,nr=er.LCurly,sr=er.RCurly,ar=er.LSquare,or=er.RSquare,lr=er.Identifier,cr=er.RouteIdentifier,ur=er.StringLiteral,dr=er.HexLiteral,hr=er.NumberLiteral,pr=er.TrueLiteral,gr=er.FalseLiteral,vr=er.NullLiteral,mr=er.DEF,fr=er.USE,_r=er.ROUTE,Ar=er.TO,yr=er.NodeName;tr.RULE("vrml",function(){tr.SUBRULE(tr.version),tr.AT_LEAST_ONE(function(){tr.SUBRULE(tr.node)}),tr.MANY(function(){tr.SUBRULE(tr.route)})}),tr.RULE("version",function(){tr.CONSUME(ir)}),tr.RULE("node",function(){tr.OPTION(function(){tr.SUBRULE(tr.def)}),tr.CONSUME(yr),tr.CONSUME(nr),tr.MANY(function(){tr.SUBRULE(tr.field)}),tr.CONSUME(sr)}),tr.RULE("field",function(){tr.CONSUME(lr),tr.OR2([{ALT:function(){tr.SUBRULE(tr.singleFieldValue)}},{ALT:function(){tr.SUBRULE(tr.multiFieldValue)}}])}),tr.RULE("def",function(){tr.CONSUME(mr),tr.OR([{ALT:function(){tr.CONSUME(lr)}},{ALT:function(){tr.CONSUME(yr)}}])}),tr.RULE("use",function(){tr.CONSUME(fr),tr.OR([{ALT:function(){tr.CONSUME(lr)}},{ALT:function(){tr.CONSUME(yr)}}])}),tr.RULE("singleFieldValue",function(){tr.AT_LEAST_ONE(function(){tr.OR([{ALT:function(){tr.SUBRULE(tr.node)}},{ALT:function(){tr.SUBRULE(tr.use)}},{ALT:function(){tr.CONSUME(ur)}},{ALT:function(){tr.CONSUME(dr)}},{ALT:function(){tr.CONSUME(hr)}},{ALT:function(){tr.CONSUME(pr)}},{ALT:function(){tr.CONSUME(gr)}},{ALT:function(){tr.CONSUME(vr)}}])})}),tr.RULE("multiFieldValue",function(){tr.CONSUME(ar),tr.MANY(function(){tr.OR([{ALT:function(){tr.SUBRULE(tr.node)}},{ALT:function(){tr.SUBRULE(tr.use)}},{ALT:function(){tr.CONSUME(ur)}},{ALT:function(){tr.CONSUME(dr)}},{ALT:function(){tr.CONSUME(hr)}},{ALT:function(){tr.CONSUME(vr)}}])}),tr.CONSUME(or)}),tr.RULE("route",function(){tr.CONSUME(_r),tr.CONSUME(cr),tr.CONSUME(Ar),tr.CONSUME2(cr)}),this.performSelfAnalysis()}}class Face{constructor(er,tr,ir){this.a=er,this.b=tr,this.c=ir,this.normal=new Vector3$1}}const TEXTURE_TYPE={INTENSITY:1,INTENSITY_ALPHA:2,RGB:3,RGBA:4};class VTKLoader extends Loader{constructor(er){super(er)}load(er,tr,ir,nr){const sr=this,ar=new FileLoader(sr.manager);ar.setPath(sr.path),ar.setResponseType("arraybuffer"),ar.setRequestHeader(sr.requestHeader),ar.setWithCredentials(sr.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){function tr(cr){const ur=[],dr=[],hr=[],pr=[];let gr;const vr=/^[^\d.\s-]+/,mr=/(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)\s+(\-?\d+\.?[\d\-\+e]*)/g,fr=/^(\d+)\s+([\s\d]*)/,_r=/^POINTS /,Ar=/^POLYGONS /,yr=/^TRIANGLE_STRIPS /,wr=/^POINT_DATA[ ]+(\d+)/,xr=/^CELL_DATA[ ]+(\d+)/,Sr=/^COLOR_SCALARS[ ]+(\w+)[ ]+3/,br=/^NORMALS[ ]+(\w+)[ ]+(\w+)/;let Cr=!1,Ir=!1,Rr=!1,Pr=!1,Dr=!1,Fr=!1,Or=!1;const Nr=new Color,Ur=cr.split(`
`);for(const Wr in Ur){const Xr=Ur[Wr].trim();if(Xr.indexOf("DATASET")===0){const Yr=Xr.split(" ")[1];if(Yr!=="POLYDATA")throw new Error("Unsupported DATASET type: "+Yr)}else if(Cr)for(;(gr=mr.exec(Xr))!==null&&vr.exec(Xr)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),Xi=parseFloat(gr[3]);dr.push(Yr,Qi,Xi)}else if(Ir){if((gr=fr.exec(Xr))!==null){const Yr=parseInt(gr[1]),Qi=gr[2].split(/\s+/);if(Yr>=3){const Xi=parseInt(Qi[0]);let Kr=1;for(let $r=0;$r<Yr-2;++$r){const Vr=parseInt(Qi[Kr]),Gr=parseInt(Qi[Kr+1]);ur.push(Xi,Vr,Gr),Kr++}}}}else if(Rr){if((gr=fr.exec(Xr))!==null){const Yr=parseInt(gr[1]),Qi=gr[2].split(/\s+/);if(Yr>=3)for(let Xi=0;Xi<Yr-2;Xi++)if(Xi%2===1){const Kr=parseInt(Qi[Xi]),$r=parseInt(Qi[Xi+2]),Vr=parseInt(Qi[Xi+1]);ur.push(Kr,$r,Vr)}else{const Kr=parseInt(Qi[Xi]),$r=parseInt(Qi[Xi+1]),Vr=parseInt(Qi[Xi+2]);ur.push(Kr,$r,Vr)}}}else if(Pr||Dr){if(Fr)for(;(gr=mr.exec(Xr))!==null&&vr.exec(Xr)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),Xi=parseFloat(gr[3]);Nr.setRGB(Yr,Qi,Xi,SRGBColorSpace),hr.push(Nr.r,Nr.g,Nr.b)}else if(Or)for(;(gr=mr.exec(Xr))!==null&&vr.exec(Xr)===null;){const Yr=parseFloat(gr[1]),Qi=parseFloat(gr[2]),Xi=parseFloat(gr[3]);pr.push(Yr,Qi,Xi)}}Ar.exec(Xr)!==null?(Ir=!0,Cr=!1,Rr=!1):_r.exec(Xr)!==null?(Ir=!1,Cr=!0,Rr=!1):yr.exec(Xr)!==null?(Ir=!1,Cr=!1,Rr=!0):wr.exec(Xr)!==null?(Pr=!0,Cr=!1,Ir=!1,Rr=!1):xr.exec(Xr)!==null?(Dr=!0,Cr=!1,Ir=!1,Rr=!1):Sr.exec(Xr)!==null?(Fr=!0,Or=!1,Cr=!1,Ir=!1,Rr=!1):br.exec(Xr)!==null&&(Or=!0,Fr=!1,Cr=!1,Ir=!1,Rr=!1)}let Br=new BufferGeometry;if(Br.setIndex(ur),Br.setAttribute("position",new Float32BufferAttribute(dr,3)),pr.length===dr.length&&Br.setAttribute("normal",new Float32BufferAttribute(pr,3)),hr.length!==ur.length)hr.length===dr.length&&Br.setAttribute("color",new Float32BufferAttribute(hr,3));else{Br=Br.toNonIndexed();const Wr=Br.attributes.position.count/3;if(hr.length===Wr*3){const Xr=[];for(let Yr=0;Yr<Wr;Yr++){const Qi=hr[3*Yr+0],Xi=hr[3*Yr+1],Kr=hr[3*Yr+2];Nr.setRGB(Qi,Xi,Kr,SRGBColorSpace),Xr.push(Nr.r,Nr.g,Nr.b),Xr.push(Nr.r,Nr.g,Nr.b),Xr.push(Nr.r,Nr.g,Nr.b)}Br.setAttribute("color",new Float32BufferAttribute(Xr,3))}}return Br}function ir(cr){const ur=new Uint8Array(cr),dr=new DataView(cr);let hr=[],pr=[],gr=[],vr=0;function mr(yr,wr){let xr=wr,Sr=yr[xr];const br=[];for(;Sr!==10;)br.push(String.fromCharCode(Sr)),xr++,Sr=yr[xr];return{start:wr,end:xr,next:xr+1,parsedString:br.join("")}}let fr,_r;for(;;){if(fr=mr(ur,vr),_r=fr.parsedString,_r.indexOf("DATASET")===0){const yr=_r.split(" ")[1];if(yr!=="POLYDATA")throw new Error("Unsupported DATASET type: "+yr)}else if(_r.indexOf("POINTS")===0){const yr=parseInt(_r.split(" ")[1],10),wr=yr*4*3;hr=new Float32Array(yr*3);let xr=fr.next;for(let Sr=0;Sr<yr;Sr++)hr[3*Sr]=dr.getFloat32(xr,!1),hr[3*Sr+1]=dr.getFloat32(xr+4,!1),hr[3*Sr+2]=dr.getFloat32(xr+8,!1),xr=xr+12;fr.next=fr.next+wr+1}else if(_r.indexOf("TRIANGLE_STRIPS")===0){const yr=parseInt(_r.split(" ")[1],10),wr=parseInt(_r.split(" ")[2],10),xr=wr*4;gr=new Uint32Array(3*wr-9*yr);let Sr=0,br=fr.next;for(let Cr=0;Cr<yr;Cr++){const Ir=dr.getInt32(br,!1),Rr=[];br+=4;for(let Pr=0;Pr<Ir;Pr++)Rr.push(dr.getInt32(br,!1)),br+=4;for(let Pr=0;Pr<Ir-2;Pr++)Pr%2?(gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+2],gr[Sr++]=Rr[Pr+1]):(gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+1],gr[Sr++]=Rr[Pr+2])}fr.next=fr.next+xr+1}else if(_r.indexOf("POLYGONS")===0){const yr=parseInt(_r.split(" ")[1],10),wr=parseInt(_r.split(" ")[2],10),xr=wr*4;gr=new Uint32Array(3*wr-9*yr);let Sr=0,br=fr.next;for(let Cr=0;Cr<yr;Cr++){const Ir=dr.getInt32(br,!1),Rr=[];br+=4;for(let Pr=0;Pr<Ir;Pr++)Rr.push(dr.getInt32(br,!1)),br+=4;for(let Pr=1;Pr<Ir-1;Pr++)gr[Sr++]=Rr[0],gr[Sr++]=Rr[Pr],gr[Sr++]=Rr[Pr+1]}fr.next=fr.next+xr+1}else if(_r.indexOf("POINT_DATA")===0){const yr=parseInt(_r.split(" ")[1],10);fr=mr(ur,fr.next);const wr=yr*4*3;pr=new Float32Array(yr*3);let xr=fr.next;for(let Sr=0;Sr<yr;Sr++)pr[3*Sr]=dr.getFloat32(xr,!1),pr[3*Sr+1]=dr.getFloat32(xr+4,!1),pr[3*Sr+2]=dr.getFloat32(xr+8,!1),xr+=12;fr.next=fr.next+wr}if(vr=fr.next,vr>=ur.byteLength)break}const Ar=new BufferGeometry;return Ar.setIndex(new BufferAttribute(gr,1)),Ar.setAttribute("position",new BufferAttribute(hr,3)),pr.length===hr.length&&Ar.setAttribute("normal",new BufferAttribute(pr,3)),Ar}function nr(cr,ur){const dr=cr.length,hr=new Float32Array(dr+ur.length);return hr.set(cr),hr.set(ur,dr),hr}function sr(cr,ur){const dr=cr.length,hr=new Int32Array(dr+ur.length);return hr.set(cr),hr.set(ur,dr),hr}function ar(cr){function ur(Ar){let yr={};if(Ar.nodeType===1){if(Ar.attributes&&Ar.attributes.length>0){yr.attributes={};for(let wr=0;wr<Ar.attributes.length;wr++){const xr=Ar.attributes.item(wr);yr.attributes[xr.nodeName]=xr.nodeValue.trim()}}}else Ar.nodeType===3&&(yr=Ar.nodeValue.trim());if(Ar.hasChildNodes())for(let wr=0;wr<Ar.childNodes.length;wr++){const xr=Ar.childNodes.item(wr),Sr=xr.nodeName;if(typeof yr[Sr]>"u"){const br=ur(xr);br!==""&&(Array.isArray(br["#text"])&&(br["#text"]=br["#text"][0]),yr[Sr]=br)}else{if(typeof yr[Sr].push>"u"){const Cr=yr[Sr];yr[Sr]=[Cr]}const br=ur(xr);br!==""&&(Array.isArray(br["#text"])&&(br["#text"]=br["#text"][0]),yr[Sr].push(br))}}return yr}function dr(Ar){const yr=typeof Uint8Array<"u"?Uint8Array:Array,wr=[],xr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(let Fr=0,Or=xr.length;Fr<Or;++Fr)wr[xr.charCodeAt(Fr)]=Fr;wr[45]=62,wr[95]=63;const Sr=Ar.length;if(Sr%4>0)throw new Error("Invalid string. Length must be a multiple of 4");const br=Ar[Sr-2]==="="?2:Ar[Sr-1]==="="?1:0,Cr=new yr(Sr*3/4-br),Ir=br>0?Sr-4:Sr;let Rr=0,Pr,Dr;for(Pr=0,Dr=0;Pr<Ir;Pr+=4,Dr+=3){const Fr=wr[Ar.charCodeAt(Pr)]<<18|wr[Ar.charCodeAt(Pr+1)]<<12|wr[Ar.charCodeAt(Pr+2)]<<6|wr[Ar.charCodeAt(Pr+3)];Cr[Rr++]=(Fr&16711680)>>16,Cr[Rr++]=(Fr&65280)>>8,Cr[Rr++]=Fr&255}if(br===2){const Fr=wr[Ar.charCodeAt(Pr)]<<2|wr[Ar.charCodeAt(Pr+1)]>>4;Cr[Rr++]=Fr&255}else if(br===1){const Fr=wr[Ar.charCodeAt(Pr)]<<10|wr[Ar.charCodeAt(Pr+1)]<<4|wr[Ar.charCodeAt(Pr+2)]>>2;Cr[Rr++]=Fr>>8&255,Cr[Rr++]=Fr&255}return Cr}function hr(Ar,yr){let wr=0;vr.attributes.header_type==="UInt64"?wr=8:vr.attributes.header_type==="UInt32"&&(wr=4);let xr,Sr;if(Ar.attributes.format==="binary"&&yr){Ar.attributes.type==="Float32"?xr=new Float32Array:(Ar.attributes.type==="Int32"||Ar.attributes.type==="Int64")&&(xr=new Int32Array);const br=Ar["#text"],Cr=Array.isArray(br)?br[0]:br,Ir=dr(Cr),Rr=8;let Pr=Ir[0];for(let Br=1;Br<wr-1;Br++)Pr=Pr|Ir[Br]<<Br*Rr;let Dr=(Pr+3)*wr;const Fr=Dr%3>0?3-Dr%3:0;Dr=Dr+Fr;const Or=[];let Nr=Dr;Or.push(Nr);const Ur=3*wr;for(let Br=0;Br<Pr;Br++){let Wr=Ir[Br*wr+Ur];for(let Xr=1;Xr<wr-1;Xr++)Wr=Wr|Ir[Br*wr+Ur+Xr]<<Xr*Rr;Nr=Nr+Wr,Or.push(Nr)}for(let Br=0;Br<Or.length-1;Br++)Sr=unzlibSync(Ir.slice(Or[Br],Or[Br+1])).buffer,Ar.attributes.type==="Float32"?(Sr=new Float32Array(Sr),xr=nr(xr,Sr)):(Ar.attributes.type==="Int32"||Ar.attributes.type==="Int64")&&(Sr=new Int32Array(Sr),xr=sr(xr,Sr));delete Ar["#text"],Ar.attributes.type==="Int64"&&Ar.attributes.format==="binary"&&(xr=xr.filter(function(Br,Wr){if(Wr%2!==1)return!0}))}else Ar.attributes.format==="binary"&&!yr?(Sr=dr(Ar["#text"]),Sr=Sr.slice(wr).buffer):Ar["#text"]?Sr=Ar["#text"].split(/\s+/).filter(function(br){if(br!=="")return br}):Sr=new Int32Array(0).buffer,delete Ar["#text"],Ar.attributes.type==="Float32"?xr=new Float32Array(Sr):Ar.attributes.type==="Int32"?xr=new Int32Array(Sr):Ar.attributes.type==="Int64"&&(xr=new Int32Array(Sr),Ar.attributes.format==="binary"&&(xr=xr.filter(function(br,Cr){if(Cr%2!==1)return!0})));return xr}const gr=new DOMParser().parseFromString(cr,"application/xml").documentElement,vr=ur(gr);let mr=[],fr=[],_r=[];if(vr.AppendedData){const Ar=vr.AppendedData["#text"].slice(1),yr=vr.PolyData.Piece,wr=["PointData","CellData","Points","Verts","Lines","Strips","Polys"];let xr=0;const Sr=wr.map(br=>{const Cr=yr[br];return Cr&&Cr.DataArray?(Array.isArray(Cr.DataArray)?Cr.DataArray:[Cr.DataArray]).map(Rr=>Rr.attributes.offset):[]}).flat();for(const br of wr){const Cr=yr[br];if(Cr&&Cr.DataArray)if(Array.isArray(Cr.DataArray))for(const Ir of Cr.DataArray)Ir["#text"]=Ar.slice(Sr[xr],Sr[xr+1]),Ir.attributes.format="binary",xr++;else Cr.DataArray["#text"]=Ar.slice(Sr[xr],Sr[xr+1]),Cr.DataArray.attributes.format="binary",xr++}}if(vr.PolyData){const Ar=vr.PolyData.Piece,yr=vr.attributes.hasOwnProperty("compressor"),wr=["PointData","Points","Strips","Polys"];let xr=0;const Sr=wr.length;for(;xr<Sr;){const Cr=Ar[wr[xr]];if(Cr&&Cr.DataArray){let Ir;Array.isArray(Cr.DataArray)?Ir=Cr.DataArray:Ir=[Cr.DataArray];let Rr=0;const Pr=Ir.length;for(;Rr<Pr;)"#text"in Ir[Rr]&&Ir[Rr]["#text"].length>0&&(Ir[Rr].text=hr(Ir[Rr],yr)),Rr++;switch(wr[xr]){case"PointData":{const Dr=parseInt(Ar.attributes.NumberOfPoints),Fr=Cr.attributes.Normals;if(Dr>0){for(let Or=0,Nr=Ir.length;Or<Nr;Or++)if(Fr===Ir[Or].attributes.Name){const Ur=Ir[Or].attributes.NumberOfComponents;fr=new Float32Array(Dr*Ur),fr.set(Ir[Or].text,0)}}}break;case"Points":{const Dr=parseInt(Ar.attributes.NumberOfPoints);if(Dr>0){const Fr=Cr.DataArray.attributes.NumberOfComponents;mr=new Float32Array(Dr*Fr),mr.set(Cr.DataArray.text,0)}}break;case"Strips":{const Dr=parseInt(Ar.attributes.NumberOfStrips);if(Dr>0){const Fr=new Int32Array(Cr.DataArray[0].text.length),Or=new Int32Array(Cr.DataArray[1].text.length);Fr.set(Cr.DataArray[0].text,0),Or.set(Cr.DataArray[1].text,0);const Nr=Dr+Fr.length;_r=new Uint32Array(3*Nr-9*Dr);let Ur=0;for(let Br=0,Wr=Dr;Br<Wr;Br++){const Xr=[];for(let Yr=0,Qi=Or[Br],Xi=0;Yr<Qi-Xi;Yr++)Xr.push(Fr[Yr]),Br>0&&(Xi=Or[Br-1]);for(let Yr=0,Qi=Or[Br],Xi=0;Yr<Qi-Xi-2;Yr++)Yr%2?(_r[Ur++]=Xr[Yr],_r[Ur++]=Xr[Yr+2],_r[Ur++]=Xr[Yr+1]):(_r[Ur++]=Xr[Yr],_r[Ur++]=Xr[Yr+1],_r[Ur++]=Xr[Yr+2]),Br>0&&(Xi=Or[Br-1])}}}break;case"Polys":{const Dr=parseInt(Ar.attributes.NumberOfPolys);if(Dr>0){const Fr=new Int32Array(Cr.DataArray[0].text.length),Or=new Int32Array(Cr.DataArray[1].text.length);Fr.set(Cr.DataArray[0].text,0),Or.set(Cr.DataArray[1].text,0);const Nr=Dr+Fr.length;_r=new Uint32Array(3*Nr-9*Dr);let Ur=0,Br=0,Wr=0,Xr=0;const Yr=Dr;for(;Wr<Yr;){const Qi=[];let Xi=0;const Kr=Or[Wr];for(;Xi<Kr-Xr;)Qi.push(Fr[Br++]),Xi++;let $r=1;for(;$r<Kr-Xr-1;)_r[Ur++]=Qi[0],_r[Ur++]=Qi[$r],_r[Ur++]=Qi[$r+1],$r++;Wr++,Xr=Or[Wr-1]}}}break;default:break}}xr++}const br=new BufferGeometry;return br.setIndex(new BufferAttribute(_r,1)),br.setAttribute("position",new BufferAttribute(mr,3)),fr.length===mr.length&&br.setAttribute("normal",new BufferAttribute(fr,3)),br}else throw new Error("Unsupported DATASET type")}const or=new TextDecoder,lr=or.decode(new Uint8Array(er,0,250)).split(`
`);return lr[0].indexOf("xml")!==-1?ar(or.decode(er)):lr[2].includes("ASCII")?tr(or.decode(er)):ir(er)}}class XYZLoader extends Loader{load(er,tr,ir,nr){const sr=this,ar=new FileLoader(this.manager);ar.setPath(this.path),ar.setRequestHeader(this.requestHeader),ar.setWithCredentials(this.withCredentials),ar.load(er,function(or){try{tr(sr.parse(or))}catch(lr){nr?nr(lr):console.error(lr),sr.manager.itemError(er)}},ir,nr)}parse(er){const tr=er.split(`
`),ir=[],nr=[],sr=new Color;for(let or of tr){if(or=or.trim(),or.charAt(0)==="#")continue;const lr=or.split(/\s+/);if(lr.length===3&&(ir.push(parseFloat(lr[0])),ir.push(parseFloat(lr[1])),ir.push(parseFloat(lr[2]))),lr.length===6){ir.push(parseFloat(lr[0])),ir.push(parseFloat(lr[1])),ir.push(parseFloat(lr[2]));const cr=parseFloat(lr[3])/255,ur=parseFloat(lr[4])/255,dr=parseFloat(lr[5])/255;sr.setRGB(cr,ur,dr,SRGBColorSpace),nr.push(sr.r,sr.g,sr.b)}}const ar=new BufferGeometry;return ar.setAttribute("position",new Float32BufferAttribute(ir,3)),nr.length>0&&ar.setAttribute("color",new Float32BufferAttribute(nr,3)),ar}}const GouraudShader={name:"GouraudShader",uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:`

		#define GOURAUD

		varying vec3 vLightFront;
		varying vec3 vIndirectFront;

		#ifdef DOUBLE_SIDED
			varying vec3 vLightBack;
			varying vec3 vIndirectBack;
		#endif

		#include <common>
		#include <uv_pars_vertex>
		#include <envmap_pars_vertex>
		#include <bsdfs>
		#include <lights_pars_begin>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <morphtarget_pars_vertex>
		#include <skinning_pars_vertex>
		#include <shadowmap_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		void main() {

			#include <uv_vertex>
			#include <color_vertex>
			#include <morphcolor_vertex>

			#include <beginnormal_vertex>
			#include <morphnormal_vertex>
			#include <skinbase_vertex>
			#include <skinnormal_vertex>
			#include <defaultnormal_vertex>

			#include <begin_vertex>
			#include <morphtarget_vertex>
			#include <skinning_vertex>
			#include <project_vertex>
			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>

			#include <worldpos_vertex>
			#include <envmap_vertex>

			// inlining legacy <lights_lambert_vertex>

			vec3 diffuse = vec3( 1.0 );

			vec3 geometryPosition = mvPosition.xyz;
			vec3 geometryNormal = normalize( transformedNormal );
			vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );

			vec3 backGeometryNormal = - geometryNormal;

			vLightFront = vec3( 0.0 );
			vIndirectFront = vec3( 0.0 );
			#ifdef DOUBLE_SIDED
				vLightBack = vec3( 0.0 );
				vIndirectBack = vec3( 0.0 );
			#endif

			IncidentLight directLight;
			float dotNL;
			vec3 directLightColor_Diffuse;

			vIndirectFront += getAmbientLightIrradiance( ambientLightColor );

			#if defined( USE_LIGHT_PROBES )

				vIndirectFront += getLightProbeIrradiance( lightProbe, geometryNormal );

			#endif

			#ifdef DOUBLE_SIDED

				vIndirectBack += getAmbientLightIrradiance( ambientLightColor );

				#if defined( USE_LIGHT_PROBES )

					vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometryNormal );

				#endif

			#endif

			#if NUM_POINT_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

					getPointLightInfo( pointLights[ i ], geometryPosition, directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#if NUM_SPOT_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

					getSpotLightInfo( spotLights[ i ], geometryPosition, directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif
				}
				#pragma unroll_loop_end

			#endif

			#if NUM_DIR_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

					getDirectionalLightInfo( directionalLights[ i ], directLight );

					dotNL = dot( geometryNormal, directLight.direction );
					directLightColor_Diffuse = directLight.color;

					vLightFront += saturate( dotNL ) * directLightColor_Diffuse;

					#ifdef DOUBLE_SIDED

						vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#if NUM_HEMI_LIGHTS > 0

				#pragma unroll_loop_start
				for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

					vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );

					#ifdef DOUBLE_SIDED

						vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometryNormal );

					#endif

				}
				#pragma unroll_loop_end

			#endif

			#include <shadowmap_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#define GOURAUD

		uniform vec3 diffuse;
		uniform vec3 emissive;
		uniform float opacity;

		varying vec3 vLightFront;
		varying vec3 vIndirectFront;

		#ifdef DOUBLE_SIDED
			varying vec3 vLightBack;
			varying vec3 vIndirectBack;
		#endif

		#include <common>
		#include <packing>
		#include <dithering_pars_fragment>
		#include <color_pars_fragment>
		#include <uv_pars_fragment>
		#include <map_pars_fragment>
		#include <alphamap_pars_fragment>
		#include <alphatest_pars_fragment>
		#include <aomap_pars_fragment>
		#include <lightmap_pars_fragment>
		#include <emissivemap_pars_fragment>
		#include <envmap_common_pars_fragment>
		#include <envmap_pars_fragment>
		#include <bsdfs>
		#include <lights_pars_begin>
		#include <fog_pars_fragment>
		#include <shadowmap_pars_fragment>
		#include <shadowmask_pars_fragment>
		#include <specularmap_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		void main() {

			#include <clipping_planes_fragment>

			vec4 diffuseColor = vec4( diffuse, opacity );
			ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
			vec3 totalEmissiveRadiance = emissive;

			#include <logdepthbuf_fragment>
			#include <map_fragment>
			#include <color_fragment>
			#include <alphamap_fragment>
			#include <alphatest_fragment>
			#include <specularmap_fragment>
			#include <emissivemap_fragment>

			// accumulation

			#ifdef DOUBLE_SIDED

				reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;

			#else

				reflectedLight.indirectDiffuse += vIndirectFront;

			#endif

			#ifdef USE_LIGHTMAP

				vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
				vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
				reflectedLight.indirectDiffuse += lightMapIrradiance;

			#endif

			reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );

			#ifdef DOUBLE_SIDED

				reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;

			#else

				reflectedLight.directDiffuse = vLightFront;

			#endif

			reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();

			// modulation

			#include <aomap_fragment>

			vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;

			#include <envmap_fragment>

			#include <opaque_fragment>
			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>
			#include <dithering_fragment>

		}`};class MeshGouraudMaterial extends ShaderMaterial{static get type(){return"MeshGouraudMaterial"}constructor(er){super(),this.isMeshGouraudMaterial=!0,this.combine=MultiplyOperation,this.fog=!1,this.lights=!0,this.clipping=!1;const tr=GouraudShader;this.defines=Object.assign({},tr.defines),this.uniforms=UniformsUtils.clone(tr.uniforms),this.vertexShader=tr.vertexShader,this.fragmentShader=tr.fragmentShader;const ir=["map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","specularMap","alphaMap","envMap","reflectivity","refractionRatio","opacity","diffuse"];for(const nr of ir)Object.defineProperty(this,nr,{get:function(){return this.uniforms[nr].value},set:function(sr){this.uniforms[nr].value=sr}});Object.defineProperty(this,"color",Object.getOwnPropertyDescriptor(this,"diffuse")),this.setValues(er)}copy(er){return super.copy(er),this.color.copy(er.color),this.map=er.map,this.lightMap=er.lightMap,this.lightMapIntensity=er.lightMapIntensity,this.aoMap=er.aoMap,this.aoMapIntensity=er.aoMapIntensity,this.emissive.copy(er.emissive),this.emissiveMap=er.emissiveMap,this.emissiveIntensity=er.emissiveIntensity,this.specularMap=er.specularMap,this.alphaMap=er.alphaMap,this.envMap=er.envMap,this.combine=er.combine,this.reflectivity=er.reflectivity,this.refractionRatio=er.refractionRatio,this.wireframe=er.wireframe,this.wireframeLinewidth=er.wireframeLinewidth,this.wireframeLinecap=er.wireframeLinecap,this.wireframeLinejoin=er.wireframeLinejoin,this.fog=er.fog,this}}class LDrawConditionalLineMaterial extends ShaderMaterial{static get type(){return"LDrawConditionalLineMaterial"}constructor(er){super({uniforms:UniformsUtils.merge([UniformsLib.fog,{diffuse:{value:new Color},opacity:{value:1}}]),vertexShader:`
				attribute vec3 control0;
				attribute vec3 control1;
				attribute vec3 direction;
				varying float discardFlag;

				#include <common>
				#include <color_pars_vertex>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>
				void main() {
					#include <color_vertex>

					vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

					// Transform the line segment ends and control points into camera clip space
					vec4 c0 = projectionMatrix * modelViewMatrix * vec4( control0, 1.0 );
					vec4 c1 = projectionMatrix * modelViewMatrix * vec4( control1, 1.0 );
					vec4 p0 = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
					vec4 p1 = projectionMatrix * modelViewMatrix * vec4( position + direction, 1.0 );

					c0.xy /= c0.w;
					c1.xy /= c1.w;
					p0.xy /= p0.w;
					p1.xy /= p1.w;

					// Get the direction of the segment and an orthogonal vector
					vec2 dir = p1.xy - p0.xy;
					vec2 norm = vec2( -dir.y, dir.x );

					// Get control point directions from the line
					vec2 c0dir = c0.xy - p1.xy;
					vec2 c1dir = c1.xy - p1.xy;

					// If the vectors to the controls points are pointed in different directions away
					// from the line segment then the line should not be drawn.
					float d0 = dot( normalize( norm ), normalize( c0dir ) );
					float d1 = dot( normalize( norm ), normalize( c1dir ) );
					discardFlag = float( sign( d0 ) != sign( d1 ) );

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>
				}
			`,fragmentShader:`
			uniform vec3 diffuse;
			uniform float opacity;
			varying float discardFlag;

			#include <common>
			#include <color_pars_fragment>
			#include <fog_pars_fragment>
			#include <logdepthbuf_pars_fragment>
			#include <clipping_planes_pars_fragment>
			void main() {

				if ( discardFlag > 0.5 ) discard;

				#include <clipping_planes_fragment>
				vec3 outgoingLight = vec3( 0.0 );
				vec4 diffuseColor = vec4( diffuse, opacity );
				#include <logdepthbuf_fragment>
				#include <color_fragment>
				outgoingLight = diffuseColor.rgb; // simple shader
				gl_FragColor = vec4( outgoingLight, diffuseColor.a );
				#include <tonemapping_fragment>
				#include <colorspace_fragment>
				#include <fog_fragment>
				#include <premultiplied_alpha_fragment>
			}
			`}),Object.defineProperties(this,{opacity:{get:function(){return this.uniforms.opacity.value},set:function(tr){this.uniforms.opacity.value=tr}},color:{get:function(){return this.uniforms.diffuse.value}}}),this.setValues(er),this.isLDrawConditionalLineMaterial=!0}}class MeshPostProcessingMaterial extends MeshPhysicalMaterial{constructor(er){const tr=er.aoPassMap,ir=er.aoPassMapScale||1;delete er.aoPassMap,delete er.aoPassMapScale,super(er),this.onBeforeCompile=this._onBeforeCompile,this.customProgramCacheKey=this._customProgramCacheKey,this._aoPassMap=tr,this.aoPassMapScale=ir,this._shader=null}get aoPassMap(){return this._aoPassMap}set aoPassMap(er){this._aoPassMap=er,this.needsUpdate=!0,this._setUniforms()}_customProgramCacheKey(){return this._aoPassMap!==void 0&&this._aoPassMap!==null?"aoPassMap":""}_onBeforeCompile(er){this._shader=er,this._aoPassMap!==void 0&&this._aoPassMap!==null&&(er.fragmentShader=er.fragmentShader.replace("#include <aomap_pars_fragment>",aomap_pars_fragment_replacement),er.fragmentShader=er.fragmentShader.replace("#include <aomap_fragment>",aomap_fragment_replacement)),this._setUniforms()}_setUniforms(){this._shader&&(this._shader.uniforms.tAoPassMap={value:this._aoPassMap},this._shader.uniforms.aoPassMapScale={value:this.aoPassMapScale})}}const aomap_pars_fragment_replacement=`
#ifdef USE_AOMAP

	uniform sampler2D aoMap;
	uniform float aoMapIntensity;

#endif

	uniform sampler2D tAoPassMap;
	uniform float aoPassMapScale;
`,aomap_fragment_replacement=`
#ifndef AOPASSMAP_SWIZZLE
	#define AOPASSMAP_SWIZZLE r
#endif
	float ambientOcclusion = texelFetch( tAoPassMap, ivec2( gl_FragCoord.xy * aoPassMapScale ), 0 ).AOPASSMAP_SWIZZLE;

#ifdef USE_AOMAP

	// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture
	ambientOcclusion = min( ambientOcclusion, texture2D( aoMap, vAoMapUv ).r );
	ambientOcclusion *= ( ambientOcclusion - 1.0 ) * aoMapIntensity + 1.0;

#endif

	reflectedLight.indirectDiffuse *= ambientOcclusion;

	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif

	#if defined( USE_ENVMAP ) && defined( STANDARD )

		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );

		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );

	#endif
`;class Capsule{constructor(er=new Vector3$1(0,0,0),tr=new Vector3$1(0,1,0),ir=1){this.start=er,this.end=tr,this.radius=ir}clone(){return new Capsule(this.start.clone(),this.end.clone(),this.radius)}set(er,tr,ir){this.start.copy(er),this.end.copy(tr),this.radius=ir}copy(er){this.start.copy(er.start),this.end.copy(er.end),this.radius=er.radius}getCenter(er){return er.copy(this.end).add(this.start).multiplyScalar(.5)}translate(er){this.start.add(er),this.end.add(er)}checkAABBAxis(er,tr,ir,nr,sr,ar,or,lr,cr){return(sr-er<cr||sr-ir<cr)&&(er-ar<cr||ir-ar<cr)&&(or-tr<cr||or-nr<cr)&&(tr-lr<cr||nr-lr<cr)}intersectsBox(er){return this.checkAABBAxis(this.start.x,this.start.y,this.end.x,this.end.y,er.min.x,er.max.x,er.min.y,er.max.y,this.radius)&&this.checkAABBAxis(this.start.x,this.start.z,this.end.x,this.end.z,er.min.x,er.max.x,er.min.z,er.max.z,this.radius)&&this.checkAABBAxis(this.start.y,this.start.z,this.end.y,this.end.z,er.min.y,er.max.y,er.min.z,er.max.z,this.radius)}}const _hsl={};class ColorConverter{static setHSV(er,tr,ir,nr){return tr=MathUtils.euclideanModulo(tr,1),ir=MathUtils.clamp(ir,0,1),nr=MathUtils.clamp(nr,0,1),er.setHSL(tr,ir*nr/((tr=(2-ir)*nr)<1?tr:2-tr),tr*.5)}static getHSV(er,tr){return er.getHSL(_hsl),_hsl.s*=_hsl.l<.5?_hsl.l:1-_hsl.l,tr.h=_hsl.h,tr.s=2*_hsl.s/(_hsl.l+_hsl.s),tr.v=_hsl.l+_hsl.s,tr}}const _p=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180];for(let rr=0;rr<256;rr++)_p[256+rr]=_p[rr];function fade(rr){return rr*rr*rr*(rr*(rr*6-15)+10)}function lerp$1(rr,er,tr){return er+rr*(tr-er)}function grad(rr,er,tr,ir){const nr=rr&15,sr=nr<8?er:tr,ar=nr<4?tr:nr==12||nr==14?er:ir;return(nr&1?-sr:sr)+(nr&2?-ar:ar)}class ImprovedNoise{noise(er,tr,ir){const nr=Math.floor(er),sr=Math.floor(tr),ar=Math.floor(ir),or=nr&255,lr=sr&255,cr=ar&255;er-=nr,tr-=sr,ir-=ar;const ur=er-1,dr=tr-1,hr=ir-1,pr=fade(er),gr=fade(tr),vr=fade(ir),mr=_p[or]+lr,fr=_p[mr]+cr,_r=_p[mr+1]+cr,Ar=_p[or+1]+lr,yr=_p[Ar]+cr,wr=_p[Ar+1]+cr;return lerp$1(vr,lerp$1(gr,lerp$1(pr,grad(_p[fr],er,tr,ir),grad(_p[yr],ur,tr,ir)),lerp$1(pr,grad(_p[_r],er,dr,ir),grad(_p[wr],ur,dr,ir))),lerp$1(gr,lerp$1(pr,grad(_p[fr+1],er,tr,hr),grad(_p[yr+1],ur,tr,hr)),lerp$1(pr,grad(_p[_r+1],er,dr,hr),grad(_p[wr+1],ur,dr,hr))))}}class Lut{constructor(er,tr=32){this.isLut=!0,this.lut=[],this.map=[],this.n=0,this.minV=0,this.maxV=1,this.setColorMap(er,tr)}set(er){return er.isLut===!0&&this.copy(er),this}setMin(er){return this.minV=er,this}setMax(er){return this.maxV=er,this}setColorMap(er,tr=32){this.map=ColorMapKeywords[er]||ColorMapKeywords.rainbow,this.n=tr;const ir=1/this.n,nr=new Color,sr=new Color;this.lut.length=0,this.lut.push(new Color(this.map[0][1]));for(let ar=1;ar<tr;ar++){const or=ar*ir;for(let lr=0;lr<this.map.length-1;lr++)if(or>this.map[lr][0]&&or<=this.map[lr+1][0]){const cr=this.map[lr][0],ur=this.map[lr+1][0];nr.setHex(this.map[lr][1],LinearSRGBColorSpace),sr.setHex(this.map[lr+1][1],LinearSRGBColorSpace);const dr=new Color().lerpColors(nr,sr,(or-cr)/(ur-cr));this.lut.push(dr)}}return this.lut.push(new Color(this.map[this.map.length-1][1])),this}copy(er){return this.lut=er.lut,this.map=er.map,this.n=er.n,this.minV=er.minV,this.maxV=er.maxV,this}getColor(er){er=MathUtils.clamp(er,this.minV,this.maxV),er=(er-this.minV)/(this.maxV-this.minV);const tr=Math.round(er*this.n);return this.lut[tr]}addColorMap(er,tr){return ColorMapKeywords[er]=tr,this}createCanvas(){const er=document.createElement("canvas");return er.width=1,er.height=this.n,this.updateCanvas(er),er}updateCanvas(er){const tr=er.getContext("2d",{alpha:!1}),ir=tr.getImageData(0,0,1,this.n),nr=ir.data;let sr=0;const ar=1/this.n,or=new Color,lr=new Color,cr=new Color;for(let ur=1;ur>=0;ur-=ar)for(let dr=this.map.length-1;dr>=0;dr--)if(ur<this.map[dr][0]&&ur>=this.map[dr-1][0]){const hr=this.map[dr-1][0],pr=this.map[dr][0];or.setHex(this.map[dr-1][1],LinearSRGBColorSpace),lr.setHex(this.map[dr][1],LinearSRGBColorSpace),cr.lerpColors(or,lr,(ur-hr)/(pr-hr)),nr[sr*4]=Math.round(cr.r*255),nr[sr*4+1]=Math.round(cr.g*255),nr[sr*4+2]=Math.round(cr.b*255),nr[sr*4+3]=255,sr+=1}return tr.putImageData(ir,0,0),er}}const ColorMapKeywords={rainbow:[[0,255],[.2,65535],[.5,65280],[.8,16776960],[1,16711680]],cooltowarm:[[0,3952322],[.2,10206463],[.5,14474460],[.8,16163717],[1,11797542]],blackbody:[[0,0],[.2,7864320],[.5,15086080],[.8,16776960],[1,16777215]],grayscale:[[0,0],[.2,4210752],[.5,8355712],[.8,12566463],[1,16777215]]},_face=new Triangle$2,_color$2=new Vector3$1,_uva=new Vector2,_uvb=new Vector2,_uvc=new Vector2;class MeshSurfaceSampler{constructor(er){this.geometry=er.geometry,this.randomFunction=Math.random,this.indexAttribute=this.geometry.index,this.positionAttribute=this.geometry.getAttribute("position"),this.normalAttribute=this.geometry.getAttribute("normal"),this.colorAttribute=this.geometry.getAttribute("color"),this.uvAttribute=this.geometry.getAttribute("uv"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(er){return this.weightAttribute=er?this.geometry.getAttribute(er):null,this}build(){const er=this.indexAttribute,tr=this.positionAttribute,ir=this.weightAttribute,nr=er?er.count/3:tr.count/3,sr=new Float32Array(nr);for(let lr=0;lr<nr;lr++){let cr=1,ur=3*lr,dr=3*lr+1,hr=3*lr+2;er&&(ur=er.getX(ur),dr=er.getX(dr),hr=er.getX(hr)),ir&&(cr=ir.getX(ur)+ir.getX(dr)+ir.getX(hr)),_face.a.fromBufferAttribute(tr,ur),_face.b.fromBufferAttribute(tr,dr),_face.c.fromBufferAttribute(tr,hr),cr*=_face.getArea(),sr[lr]=cr}const ar=new Float32Array(nr);let or=0;for(let lr=0;lr<nr;lr++)or+=sr[lr],ar[lr]=or;return this.distribution=ar,this}setRandomGenerator(er){return this.randomFunction=er,this}sample(er,tr,ir,nr){const sr=this.sampleFaceIndex();return this.sampleFace(sr,er,tr,ir,nr)}sampleFaceIndex(){const er=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*er)}binarySearch(er){const tr=this.distribution;let ir=0,nr=tr.length-1,sr=-1;for(;ir<=nr;){const ar=Math.ceil((ir+nr)/2);if(ar===0||tr[ar-1]<=er&&tr[ar]>er){sr=ar;break}else er<tr[ar]?nr=ar-1:ir=ar+1}return sr}sampleFace(er,tr,ir,nr,sr){let ar=this.randomFunction(),or=this.randomFunction();ar+or>1&&(ar=1-ar,or=1-or);const lr=this.indexAttribute;let cr=er*3,ur=er*3+1,dr=er*3+2;return lr&&(cr=lr.getX(cr),ur=lr.getX(ur),dr=lr.getX(dr)),_face.a.fromBufferAttribute(this.positionAttribute,cr),_face.b.fromBufferAttribute(this.positionAttribute,ur),_face.c.fromBufferAttribute(this.positionAttribute,dr),tr.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)),ir!==void 0&&(this.normalAttribute!==void 0?(_face.a.fromBufferAttribute(this.normalAttribute,cr),_face.b.fromBufferAttribute(this.normalAttribute,ur),_face.c.fromBufferAttribute(this.normalAttribute,dr),ir.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)).normalize()):_face.getNormal(ir)),nr!==void 0&&this.colorAttribute!==void 0&&(_face.a.fromBufferAttribute(this.colorAttribute,cr),_face.b.fromBufferAttribute(this.colorAttribute,ur),_face.c.fromBufferAttribute(this.colorAttribute,dr),_color$2.set(0,0,0).addScaledVector(_face.a,ar).addScaledVector(_face.b,or).addScaledVector(_face.c,1-(ar+or)),nr.r=_color$2.x,nr.g=_color$2.y,nr.b=_color$2.z),sr!==void 0&&this.uvAttribute!==void 0&&(_uva.fromBufferAttribute(this.uvAttribute,cr),_uvb.fromBufferAttribute(this.uvAttribute,ur),_uvc.fromBufferAttribute(this.uvAttribute,dr),sr.set(0,0).addScaledVector(_uva,ar).addScaledVector(_uvb,or).addScaledVector(_uvc,1-(ar+or))),this}}const a={c:null,u:[new Vector3$1,new Vector3$1,new Vector3$1],e:[]},b={c:null,u:[new Vector3$1,new Vector3$1,new Vector3$1],e:[]},R=[[],[],[]],AbsR=[[],[],[]],t=[],xAxis=new Vector3$1,yAxis=new Vector3$1,zAxis=new Vector3$1,v1=new Vector3$1,size=new Vector3$1,closestPoint=new Vector3$1,rotationMatrix=new Matrix3,aabb=new Box3,matrix$2=new Matrix4,inverse=new Matrix4,localRay=new Ray$1;class OBB{constructor(er=new Vector3$1,tr=new Vector3$1,ir=new Matrix3){this.center=er,this.halfSize=tr,this.rotation=ir}set(er,tr,ir){return this.center=er,this.halfSize=tr,this.rotation=ir,this}copy(er){return this.center.copy(er.center),this.halfSize.copy(er.halfSize),this.rotation.copy(er.rotation),this}clone(){return new this.constructor().copy(this)}getSize(er){return er.copy(this.halfSize).multiplyScalar(2)}clampPoint(er,tr){const ir=this.halfSize;v1.subVectors(er,this.center),this.rotation.extractBasis(xAxis,yAxis,zAxis),tr.copy(this.center);const nr=MathUtils.clamp(v1.dot(xAxis),-ir.x,ir.x);tr.add(xAxis.multiplyScalar(nr));const sr=MathUtils.clamp(v1.dot(yAxis),-ir.y,ir.y);tr.add(yAxis.multiplyScalar(sr));const ar=MathUtils.clamp(v1.dot(zAxis),-ir.z,ir.z);return tr.add(zAxis.multiplyScalar(ar)),tr}containsPoint(er){return v1.subVectors(er,this.center),this.rotation.extractBasis(xAxis,yAxis,zAxis),Math.abs(v1.dot(xAxis))<=this.halfSize.x&&Math.abs(v1.dot(yAxis))<=this.halfSize.y&&Math.abs(v1.dot(zAxis))<=this.halfSize.z}intersectsBox3(er){return this.intersectsOBB(obb$5.fromBox3(er))}intersectsSphere(er){return this.clampPoint(er.center,closestPoint),closestPoint.distanceToSquared(er.center)<=er.radius*er.radius}intersectsOBB(er,tr=Number.EPSILON){a.c=this.center,a.e[0]=this.halfSize.x,a.e[1]=this.halfSize.y,a.e[2]=this.halfSize.z,this.rotation.extractBasis(a.u[0],a.u[1],a.u[2]),b.c=er.center,b.e[0]=er.halfSize.x,b.e[1]=er.halfSize.y,b.e[2]=er.halfSize.z,er.rotation.extractBasis(b.u[0],b.u[1],b.u[2]);for(let sr=0;sr<3;sr++)for(let ar=0;ar<3;ar++)R[sr][ar]=a.u[sr].dot(b.u[ar]);v1.subVectors(b.c,a.c),t[0]=v1.dot(a.u[0]),t[1]=v1.dot(a.u[1]),t[2]=v1.dot(a.u[2]);for(let sr=0;sr<3;sr++)for(let ar=0;ar<3;ar++)AbsR[sr][ar]=Math.abs(R[sr][ar])+tr;let ir,nr;for(let sr=0;sr<3;sr++)if(ir=a.e[sr],nr=b.e[0]*AbsR[sr][0]+b.e[1]*AbsR[sr][1]+b.e[2]*AbsR[sr][2],Math.abs(t[sr])>ir+nr)return!1;for(let sr=0;sr<3;sr++)if(ir=a.e[0]*AbsR[0][sr]+a.e[1]*AbsR[1][sr]+a.e[2]*AbsR[2][sr],nr=b.e[sr],Math.abs(t[0]*R[0][sr]+t[1]*R[1][sr]+t[2]*R[2][sr])>ir+nr)return!1;return ir=a.e[1]*AbsR[2][0]+a.e[2]*AbsR[1][0],nr=b.e[1]*AbsR[0][2]+b.e[2]*AbsR[0][1],!(Math.abs(t[2]*R[1][0]-t[1]*R[2][0])>ir+nr||(ir=a.e[1]*AbsR[2][1]+a.e[2]*AbsR[1][1],nr=b.e[0]*AbsR[0][2]+b.e[2]*AbsR[0][0],Math.abs(t[2]*R[1][1]-t[1]*R[2][1])>ir+nr)||(ir=a.e[1]*AbsR[2][2]+a.e[2]*AbsR[1][2],nr=b.e[0]*AbsR[0][1]+b.e[1]*AbsR[0][0],Math.abs(t[2]*R[1][2]-t[1]*R[2][2])>ir+nr)||(ir=a.e[0]*AbsR[2][0]+a.e[2]*AbsR[0][0],nr=b.e[1]*AbsR[1][2]+b.e[2]*AbsR[1][1],Math.abs(t[0]*R[2][0]-t[2]*R[0][0])>ir+nr)||(ir=a.e[0]*AbsR[2][1]+a.e[2]*AbsR[0][1],nr=b.e[0]*AbsR[1][2]+b.e[2]*AbsR[1][0],Math.abs(t[0]*R[2][1]-t[2]*R[0][1])>ir+nr)||(ir=a.e[0]*AbsR[2][2]+a.e[2]*AbsR[0][2],nr=b.e[0]*AbsR[1][1]+b.e[1]*AbsR[1][0],Math.abs(t[0]*R[2][2]-t[2]*R[0][2])>ir+nr)||(ir=a.e[0]*AbsR[1][0]+a.e[1]*AbsR[0][0],nr=b.e[1]*AbsR[2][2]+b.e[2]*AbsR[2][1],Math.abs(t[1]*R[0][0]-t[0]*R[1][0])>ir+nr)||(ir=a.e[0]*AbsR[1][1]+a.e[1]*AbsR[0][1],nr=b.e[0]*AbsR[2][2]+b.e[2]*AbsR[2][0],Math.abs(t[1]*R[0][1]-t[0]*R[1][1])>ir+nr)||(ir=a.e[0]*AbsR[1][2]+a.e[1]*AbsR[0][2],nr=b.e[0]*AbsR[2][1]+b.e[1]*AbsR[2][0],Math.abs(t[1]*R[0][2]-t[0]*R[1][2])>ir+nr))}intersectsPlane(er){this.rotation.extractBasis(xAxis,yAxis,zAxis);const tr=this.halfSize.x*Math.abs(er.normal.dot(xAxis))+this.halfSize.y*Math.abs(er.normal.dot(yAxis))+this.halfSize.z*Math.abs(er.normal.dot(zAxis)),ir=er.normal.dot(this.center)-er.constant;return Math.abs(ir)<=tr}intersectRay(er,tr){return this.getSize(size),aabb.setFromCenterAndSize(v1.set(0,0,0),size),matrix$2.setFromMatrix3(this.rotation),matrix$2.setPosition(this.center),inverse.copy(matrix$2).invert(),localRay.copy(er).applyMatrix4(inverse),localRay.intersectBox(aabb,tr)?tr.applyMatrix4(matrix$2):null}intersectsRay(er){return this.intersectRay(er,v1)!==null}fromBox3(er){return er.getCenter(this.center),er.getSize(this.halfSize).multiplyScalar(.5),this.rotation.identity(),this}equals(er){return er.center.equals(this.center)&&er.halfSize.equals(this.halfSize)&&er.rotation.equals(this.rotation)}applyMatrix4(er){const tr=er.elements;let ir=v1.set(tr[0],tr[1],tr[2]).length();const nr=v1.set(tr[4],tr[5],tr[6]).length(),sr=v1.set(tr[8],tr[9],tr[10]).length();er.determinant()<0&&(ir=-ir),rotationMatrix.setFromMatrix4(er);const or=1/ir,lr=1/nr,cr=1/sr;return rotationMatrix.elements[0]*=or,rotationMatrix.elements[1]*=or,rotationMatrix.elements[2]*=or,rotationMatrix.elements[3]*=lr,rotationMatrix.elements[4]*=lr,rotationMatrix.elements[5]*=lr,rotationMatrix.elements[6]*=cr,rotationMatrix.elements[7]*=cr,rotationMatrix.elements[8]*=cr,this.rotation.multiply(rotationMatrix),this.halfSize.x*=ir,this.halfSize.y*=nr,this.halfSize.z*=sr,v1.setFromMatrixPosition(er),this.center.add(v1),this}}const obb$5=new OBB,_v1$1=new Vector3$1,_v2=new Vector3$1,_point1=new Vector3$1,_point2=new Vector3$1,_plane=new Plane,_line1=new Line3,_line2=new Line3,_sphere=new Sphere,_capsule=new Capsule,_temp1=new Vector3$1,_temp2=new Vector3$1,_temp3=new Vector3$1,EPS=1e-10;function lineToLineClosestPoints(rr,er,tr=null,ir=null){const nr=_temp1.copy(rr.end).sub(rr.start),sr=_temp2.copy(er.end).sub(er.start),ar=_temp3.copy(er.start).sub(rr.start),or=nr.dot(sr),lr=nr.dot(nr),cr=sr.dot(sr),ur=sr.dot(ar),dr=nr.dot(ar);let hr,pr;const gr=lr*cr-or*or;if(Math.abs(gr)<EPS){const vr=-ur/cr,mr=(or-ur)/cr;Math.abs(vr-.5)<Math.abs(mr-.5)?(hr=0,pr=vr):(hr=1,pr=mr)}else hr=(ur*or+dr*cr)/gr,pr=(hr*or-ur)/cr;pr=Math.max(0,Math.min(1,pr)),hr=Math.max(0,Math.min(1,hr)),tr&&tr.copy(nr).multiplyScalar(hr).add(rr.start),ir&&ir.copy(sr).multiplyScalar(pr).add(er.start)}class Octree{constructor(er){this.box=er,this.bounds=new Box3,this.subTrees=[],this.triangles=[],this.layers=new Layers}addTriangle(er){return this.bounds.min.x=Math.min(this.bounds.min.x,er.a.x,er.b.x,er.c.x),this.bounds.min.y=Math.min(this.bounds.min.y,er.a.y,er.b.y,er.c.y),this.bounds.min.z=Math.min(this.bounds.min.z,er.a.z,er.b.z,er.c.z),this.bounds.max.x=Math.max(this.bounds.max.x,er.a.x,er.b.x,er.c.x),this.bounds.max.y=Math.max(this.bounds.max.y,er.a.y,er.b.y,er.c.y),this.bounds.max.z=Math.max(this.bounds.max.z,er.a.z,er.b.z,er.c.z),this.triangles.push(er),this}calcBox(){return this.box=this.bounds.clone(),this.box.min.x-=.01,this.box.min.y-=.01,this.box.min.z-=.01,this}split(er){if(!this.box)return;const tr=[],ir=_v2.copy(this.box.max).sub(this.box.min).multiplyScalar(.5);for(let sr=0;sr<2;sr++)for(let ar=0;ar<2;ar++)for(let or=0;or<2;or++){const lr=new Box3,cr=_v1$1.set(sr,ar,or);lr.min.copy(this.box.min).add(cr.multiply(ir)),lr.max.copy(lr.min).add(ir),tr.push(new Octree(lr))}let nr;for(;nr=this.triangles.pop();)for(let sr=0;sr<tr.length;sr++)tr[sr].box.intersectsTriangle(nr)&&tr[sr].triangles.push(nr);for(let sr=0;sr<tr.length;sr++){const ar=tr[sr].triangles.length;ar>8&&er<16&&tr[sr].split(er+1),ar!==0&&this.subTrees.push(tr[sr])}return this}build(){return this.calcBox(),this.split(0),this}getRayTriangles(er,tr){for(let ir=0;ir<this.subTrees.length;ir++){const nr=this.subTrees[ir];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getRayTriangles(er,tr)}return tr}triangleCapsuleIntersect(er,tr){tr.getPlane(_plane);const ir=_plane.distanceToPoint(er.start)-er.radius,nr=_plane.distanceToPoint(er.end)-er.radius;if(ir>0&&nr>0||ir<-er.radius&&nr<-er.radius)return!1;const sr=Math.abs(ir/(Math.abs(ir)+Math.abs(nr))),ar=_v1$1.copy(er.start).lerp(er.end,sr);if(tr.containsPoint(ar))return{normal:_plane.normal.clone(),point:ar.clone(),depth:Math.abs(Math.min(ir,nr))};const or=er.radius*er.radius,lr=_line1.set(er.start,er.end),cr=[[tr.a,tr.b],[tr.b,tr.c],[tr.c,tr.a]];for(let ur=0;ur<cr.length;ur++){const dr=_line2.set(cr[ur][0],cr[ur][1]);if(lineToLineClosestPoints(lr,dr,_point1,_point2),_point1.distanceToSquared(_point2)<or)return{normal:_point1.clone().sub(_point2).normalize(),point:_point2.clone(),depth:er.radius-_point1.distanceTo(_point2)}}return!1}triangleSphereIntersect(er,tr){if(tr.getPlane(_plane),!er.intersectsPlane(_plane))return!1;const ir=Math.abs(_plane.distanceToSphere(er)),nr=er.radius*er.radius-ir*ir,sr=_plane.projectPoint(er.center,_v1$1);if(tr.containsPoint(er.center))return{normal:_plane.normal.clone(),point:sr.clone(),depth:Math.abs(_plane.distanceToSphere(er))};const ar=[[tr.a,tr.b],[tr.b,tr.c],[tr.c,tr.a]];for(let or=0;or<ar.length;or++){_line1.set(ar[or][0],ar[or][1]),_line1.closestPointToPoint(sr,!0,_v2);const lr=_v2.distanceToSquared(er.center);if(lr<nr)return{normal:er.center.clone().sub(_v2).normalize(),point:_v2.clone(),depth:er.radius-Math.sqrt(lr)}}return!1}getSphereTriangles(er,tr){for(let ir=0;ir<this.subTrees.length;ir++){const nr=this.subTrees[ir];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getSphereTriangles(er,tr)}}getCapsuleTriangles(er,tr){for(let ir=0;ir<this.subTrees.length;ir++){const nr=this.subTrees[ir];if(er.intersectsBox(nr.box))if(nr.triangles.length>0)for(let sr=0;sr<nr.triangles.length;sr++)tr.indexOf(nr.triangles[sr])===-1&&tr.push(nr.triangles[sr]);else nr.getCapsuleTriangles(er,tr)}}sphereIntersect(er){_sphere.copy(er);const tr=[];let ir,nr=!1;this.getSphereTriangles(er,tr);for(let sr=0;sr<tr.length;sr++)(ir=this.triangleSphereIntersect(_sphere,tr[sr]))&&(nr=!0,_sphere.center.add(ir.normal.multiplyScalar(ir.depth)));if(nr){const sr=_sphere.center.clone().sub(er.center),ar=sr.length();return{normal:sr.normalize(),depth:ar}}return!1}capsuleIntersect(er){_capsule.copy(er);const tr=[];let ir,nr=!1;this.getCapsuleTriangles(_capsule,tr);for(let sr=0;sr<tr.length;sr++)(ir=this.triangleCapsuleIntersect(_capsule,tr[sr]))&&(nr=!0,_capsule.translate(ir.normal.multiplyScalar(ir.depth)));if(nr){const sr=_capsule.getCenter(new Vector3$1).sub(er.getCenter(_v1$1)),ar=sr.length();return{normal:sr.normalize(),depth:ar}}return!1}rayIntersect(er){if(er.direction.length()===0)return;const tr=[];let ir,nr,sr=1e100;this.getRayTriangles(er,tr);for(let ar=0;ar<tr.length;ar++){const or=er.intersectTriangle(tr[ar].a,tr[ar].b,tr[ar].c,!0,_v1$1);if(or){const lr=or.sub(er.origin).length();sr>lr&&(nr=or.clone().add(er.origin),sr=lr,ir=tr[ar])}}return sr<1e100?{distance:sr,triangle:ir,position:nr}:!1}fromGraphNode(er){return er.updateWorldMatrix(!0,!0),er.traverse(tr=>{if(tr.isMesh===!0&&this.layers.test(tr.layers)){let ir,nr=!1;tr.geometry.index!==null?(nr=!0,ir=tr.geometry.toNonIndexed()):ir=tr.geometry;const sr=ir.getAttribute("position");for(let ar=0;ar<sr.count;ar+=3){const or=new Vector3$1().fromBufferAttribute(sr,ar),lr=new Vector3$1().fromBufferAttribute(sr,ar+1),cr=new Vector3$1().fromBufferAttribute(sr,ar+2);or.applyMatrix4(tr.matrixWorld),lr.applyMatrix4(tr.matrixWorld),cr.applyMatrix4(tr.matrixWorld),this.addTriangle(new Triangle$2(or,lr,cr))}nr&&ir.dispose()}}),this.build(),this}clear(){return this.box=null,this.bounds.makeEmpty(),this.subTrees.length=0,this.triangles.length=0,this}}class SimplexNoise{constructor(er=Math){this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.grad4=[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]],this.p=[];for(let tr=0;tr<256;tr++)this.p[tr]=Math.floor(er.random()*256);this.perm=[];for(let tr=0;tr<512;tr++)this.perm[tr]=this.p[tr&255];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]}dot(er,tr,ir){return er[0]*tr+er[1]*ir}dot3(er,tr,ir,nr){return er[0]*tr+er[1]*ir+er[2]*nr}dot4(er,tr,ir,nr,sr){return er[0]*tr+er[1]*ir+er[2]*nr+er[3]*sr}noise(er,tr){let ir,nr,sr;const ar=.5*(Math.sqrt(3)-1),or=(er+tr)*ar,lr=Math.floor(er+or),cr=Math.floor(tr+or),ur=(3-Math.sqrt(3))/6,dr=(lr+cr)*ur,hr=lr-dr,pr=cr-dr,gr=er-hr,vr=tr-pr;let mr,fr;gr>vr?(mr=1,fr=0):(mr=0,fr=1);const _r=gr-mr+ur,Ar=vr-fr+ur,yr=gr-1+2*ur,wr=vr-1+2*ur,xr=lr&255,Sr=cr&255,br=this.perm[xr+this.perm[Sr]]%12,Cr=this.perm[xr+mr+this.perm[Sr+fr]]%12,Ir=this.perm[xr+1+this.perm[Sr+1]]%12;let Rr=.5-gr*gr-vr*vr;Rr<0?ir=0:(Rr*=Rr,ir=Rr*Rr*this.dot(this.grad3[br],gr,vr));let Pr=.5-_r*_r-Ar*Ar;Pr<0?nr=0:(Pr*=Pr,nr=Pr*Pr*this.dot(this.grad3[Cr],_r,Ar));let Dr=.5-yr*yr-wr*wr;return Dr<0?sr=0:(Dr*=Dr,sr=Dr*Dr*this.dot(this.grad3[Ir],yr,wr)),70*(ir+nr+sr)}noise3d(er,tr,ir){let nr,sr,ar,or;const cr=(er+tr+ir)*.3333333333333333,ur=Math.floor(er+cr),dr=Math.floor(tr+cr),hr=Math.floor(ir+cr),pr=1/6,gr=(ur+dr+hr)*pr,vr=ur-gr,mr=dr-gr,fr=hr-gr,_r=er-vr,Ar=tr-mr,yr=ir-fr;let wr,xr,Sr,br,Cr,Ir;_r>=Ar?Ar>=yr?(wr=1,xr=0,Sr=0,br=1,Cr=1,Ir=0):_r>=yr?(wr=1,xr=0,Sr=0,br=1,Cr=0,Ir=1):(wr=0,xr=0,Sr=1,br=1,Cr=0,Ir=1):Ar<yr?(wr=0,xr=0,Sr=1,br=0,Cr=1,Ir=1):_r<yr?(wr=0,xr=1,Sr=0,br=0,Cr=1,Ir=1):(wr=0,xr=1,Sr=0,br=1,Cr=1,Ir=0);const Rr=_r-wr+pr,Pr=Ar-xr+pr,Dr=yr-Sr+pr,Fr=_r-br+2*pr,Or=Ar-Cr+2*pr,Nr=yr-Ir+2*pr,Ur=_r-1+3*pr,Br=Ar-1+3*pr,Wr=yr-1+3*pr,Xr=ur&255,Yr=dr&255,Qi=hr&255,Xi=this.perm[Xr+this.perm[Yr+this.perm[Qi]]]%12,Kr=this.perm[Xr+wr+this.perm[Yr+xr+this.perm[Qi+Sr]]]%12,$r=this.perm[Xr+br+this.perm[Yr+Cr+this.perm[Qi+Ir]]]%12,Vr=this.perm[Xr+1+this.perm[Yr+1+this.perm[Qi+1]]]%12;let Gr=.6-_r*_r-Ar*Ar-yr*yr;Gr<0?nr=0:(Gr*=Gr,nr=Gr*Gr*this.dot3(this.grad3[Xi],_r,Ar,yr));let qr=.6-Rr*Rr-Pr*Pr-Dr*Dr;qr<0?sr=0:(qr*=qr,sr=qr*qr*this.dot3(this.grad3[Kr],Rr,Pr,Dr));let ji=.6-Fr*Fr-Or*Or-Nr*Nr;ji<0?ar=0:(ji*=ji,ar=ji*ji*this.dot3(this.grad3[$r],Fr,Or,Nr));let Jr=.6-Ur*Ur-Br*Br-Wr*Wr;return Jr<0?or=0:(Jr*=Jr,or=Jr*Jr*this.dot3(this.grad3[Vr],Ur,Br,Wr)),32*(nr+sr+ar+or)}noise4d(er,tr,ir,nr){const sr=this.grad4,ar=this.simplex,or=this.perm,lr=(Math.sqrt(5)-1)/4,cr=(5-Math.sqrt(5))/20;let ur,dr,hr,pr,gr;const vr=(er+tr+ir+nr)*lr,mr=Math.floor(er+vr),fr=Math.floor(tr+vr),_r=Math.floor(ir+vr),Ar=Math.floor(nr+vr),yr=(mr+fr+_r+Ar)*cr,wr=mr-yr,xr=fr-yr,Sr=_r-yr,br=Ar-yr,Cr=er-wr,Ir=tr-xr,Rr=ir-Sr,Pr=nr-br,Dr=Cr>Ir?32:0,Fr=Cr>Rr?16:0,Or=Ir>Rr?8:0,Nr=Cr>Pr?4:0,Ur=Ir>Pr?2:0,Br=Rr>Pr?1:0,Wr=Dr+Fr+Or+Nr+Ur+Br,Xr=ar[Wr][0]>=3?1:0,Yr=ar[Wr][1]>=3?1:0,Qi=ar[Wr][2]>=3?1:0,Xi=ar[Wr][3]>=3?1:0,Kr=ar[Wr][0]>=2?1:0,$r=ar[Wr][1]>=2?1:0,Vr=ar[Wr][2]>=2?1:0,Gr=ar[Wr][3]>=2?1:0,qr=ar[Wr][0]>=1?1:0,ji=ar[Wr][1]>=1?1:0,Jr=ar[Wr][2]>=1?1:0,Ji=ar[Wr][3]>=1?1:0,Ki=Cr-Xr+cr,Zi=Ir-Yr+cr,Zr=Rr-Qi+cr,is=Pr-Xi+cr,os=Cr-Kr+2*cr,cs=Ir-$r+2*cr,ss=Rr-Vr+2*cr,es=Pr-Gr+2*cr,ms=Cr-qr+3*cr,Yi=Ir-ji+3*cr,Gi=Rr-Jr+3*cr,Ni=Pr-Ji+3*cr,Ri=Cr-1+4*cr,qi=Ir-1+4*cr,as=Rr-1+4*cr,us=Pr-1+4*cr,gs=mr&255,vs=fr&255,_s=_r&255,As=Ar&255,xs=or[gs+or[vs+or[_s+or[As]]]]%32,Es=or[gs+Xr+or[vs+Yr+or[_s+Qi+or[As+Xi]]]]%32,Ps=or[gs+Kr+or[vs+$r+or[_s+Vr+or[As+Gr]]]]%32,Ns=or[gs+qr+or[vs+ji+or[_s+Jr+or[As+Ji]]]]%32,Vs=or[gs+1+or[vs+1+or[_s+1+or[As+1]]]]%32;let Us=.6-Cr*Cr-Ir*Ir-Rr*Rr-Pr*Pr;Us<0?ur=0:(Us*=Us,ur=Us*Us*this.dot4(sr[xs],Cr,Ir,Rr,Pr));let Os=.6-Ki*Ki-Zi*Zi-Zr*Zr-is*is;Os<0?dr=0:(Os*=Os,dr=Os*Os*this.dot4(sr[Es],Ki,Zi,Zr,is));let ws=.6-os*os-cs*cs-ss*ss-es*es;ws<0?hr=0:(ws*=ws,hr=ws*ws*this.dot4(sr[Ps],os,cs,ss,es));let bs=.6-ms*ms-Yi*Yi-Gi*Gi-Ni*Ni;bs<0?pr=0:(bs*=bs,pr=bs*bs*this.dot4(sr[Ns],ms,Yi,Gi,Ni));let Ss=.6-Ri*Ri-qi*qi-as*as-us*us;return Ss<0?gr=0:(Ss*=Ss,gr=Ss*Ss*this.dot4(sr[Vs],Ri,qi,as,us)),27*(ur+dr+hr+pr+gr)}}const _v1=new Vector3$1;class ConvexObjectBreaker{constructor(er=1.4,tr=1e-4){this.minSizeForBreak=er,this.smallDelta=tr,this.tempLine1=new Line3,this.tempPlane1=new Plane,this.tempPlane2=new Plane,this.tempPlane_Cut=new Plane,this.tempCM1=new Vector3$1,this.tempCM2=new Vector3$1,this.tempVector3=new Vector3$1,this.tempVector3_2=new Vector3$1,this.tempVector3_3=new Vector3$1,this.tempVector3_P0=new Vector3$1,this.tempVector3_P1=new Vector3$1,this.tempVector3_P2=new Vector3$1,this.tempVector3_N0=new Vector3$1,this.tempVector3_N1=new Vector3$1,this.tempVector3_AB=new Vector3$1,this.tempVector3_CB=new Vector3$1,this.tempResultObjects={object1:null,object2:null},this.segments=[];const ir=30*30;for(let nr=0;nr<ir;nr++)this.segments[nr]=!1}prepareBreakableObject(er,tr,ir,nr,sr){const ar=er.userData;ar.mass=tr,ar.velocity=ir.clone(),ar.angularVelocity=nr.clone(),ar.breakable=sr}subdivideByImpact(er,tr,ir,nr,sr){const ar=[],or=this.tempPlane1,lr=this.tempPlane2;this.tempVector3.addVectors(tr,ir),or.setFromCoplanarPoints(tr,er.position,this.tempVector3);const cr=sr+nr,ur=this;function dr(hr,pr,gr,vr){if(Math.random()<vr*.05||vr>cr){ar.push(hr);return}let mr=Math.PI;vr===0?(lr.normal.copy(or.normal),lr.constant=or.constant):vr<=nr?(mr=(gr-pr)*(.2+.6*Math.random())+pr,ur.tempVector3_2.copy(er.position).sub(tr).applyAxisAngle(ir,mr).add(tr),lr.setFromCoplanarPoints(tr,ur.tempVector3,ur.tempVector3_2)):(mr=(.5*(vr&1)+.2*(2-Math.random()))*Math.PI,ur.tempVector3_2.copy(tr).sub(hr.position).applyAxisAngle(ir,mr).add(hr.position),ur.tempVector3_3.copy(ir).add(hr.position),lr.setFromCoplanarPoints(hr.position,ur.tempVector3_3,ur.tempVector3_2)),ur.cutByPlane(hr,lr,ur.tempResultObjects);const fr=ur.tempResultObjects.object1,_r=ur.tempResultObjects.object2;fr&&dr(fr,pr,mr,vr+1),_r&&dr(_r,mr,gr,vr+1)}return dr(er,0,2*Math.PI,0),ar}cutByPlane(er,tr,ir){const nr=er.geometry,sr=nr.attributes.position.array,ar=nr.attributes.normal.array,or=sr.length/3;let lr=or/3,cr=nr.getIndex();cr&&(cr=cr.array,lr=cr.length/3);function ur(Pr,Dr){const Fr=Pr*3+Dr;return cr?cr[Fr]:Fr}const dr=[],hr=[],pr=this.smallDelta,gr=or*or;for(let Pr=0;Pr<gr;Pr++)this.segments[Pr]=!1;const vr=this.tempVector3_P0,mr=this.tempVector3_P1,fr=this.tempVector3_N0,_r=this.tempVector3_N1;for(let Pr=0;Pr<lr-1;Pr++){const Dr=ur(Pr,0),Fr=ur(Pr,1),Or=ur(Pr,2);fr.set(ar[Dr],ar[Dr]+1,ar[Dr]+2);for(let Nr=Pr+1;Nr<lr;Nr++){const Ur=ur(Nr,0),Br=ur(Nr,1),Wr=ur(Nr,2);_r.set(ar[Ur],ar[Ur]+1,ar[Ur]+2),1-fr.dot(_r)<pr&&(Dr===Ur||Dr===Br||Dr===Wr?Fr===Ur||Fr===Br||Fr===Wr?(this.segments[Dr*or+Fr]=!0,this.segments[Fr*or+Dr]=!0):(this.segments[Or*or+Dr]=!0,this.segments[Dr*or+Or]=!0):(Fr===Ur||Fr===Br||Fr===Wr)&&(this.segments[Or*or+Fr]=!0,this.segments[Fr*or+Or]=!0))}}const Ar=this.tempPlane_Cut;er.updateMatrix(),ConvexObjectBreaker.transformPlaneToLocalSpace(tr,er.matrix,Ar);for(let Pr=0;Pr<lr;Pr++){const Dr=ur(Pr,0),Fr=ur(Pr,1),Or=ur(Pr,2);for(let Nr=0;Nr<3;Nr++){const Ur=Nr===0?Dr:Nr===1?Fr:Or,Br=Nr===0?Fr:Nr===1?Or:Dr;if(this.segments[Ur*or+Br])continue;this.segments[Ur*or+Br]=!0,this.segments[Br*or+Ur]=!0,vr.set(sr[3*Ur],sr[3*Ur+1],sr[3*Ur+2]),mr.set(sr[3*Br],sr[3*Br+1],sr[3*Br+2]);let Xr=0,Yr=Ar.distanceToPoint(vr);Yr>pr?(Xr=2,hr.push(vr.clone())):Yr<-pr?(Xr=1,dr.push(vr.clone())):(Xr=3,dr.push(vr.clone()),hr.push(vr.clone()));let Qi=0;if(Yr=Ar.distanceToPoint(mr),Yr>pr?(Qi=2,hr.push(mr.clone())):Yr<-pr?(Qi=1,dr.push(mr.clone())):(Qi=3,dr.push(mr.clone()),hr.push(mr.clone())),Xr===1&&Qi===2||Xr===2&&Qi===1){this.tempLine1.start.copy(vr),this.tempLine1.end.copy(mr);let Xi=new Vector3$1;if(Xi=Ar.intersectLine(this.tempLine1,Xi),Xi===null)return console.error("Internal error: segment does not intersect plane."),ir.segmentedObject1=null,ir.segmentedObject2=null,0;dr.push(Xi),hr.push(Xi.clone())}}}const yr=er.userData.mass*.5;this.tempCM1.set(0,0,0);let wr=0;const xr=dr.length;if(xr>0){for(let Pr=0;Pr<xr;Pr++)this.tempCM1.add(dr[Pr]);this.tempCM1.divideScalar(xr);for(let Pr=0;Pr<xr;Pr++){const Dr=dr[Pr];Dr.sub(this.tempCM1),wr=Math.max(wr,Dr.x,Dr.y,Dr.z)}this.tempCM1.add(er.position)}this.tempCM2.set(0,0,0);let Sr=0;const br=hr.length;if(br>0){for(let Pr=0;Pr<br;Pr++)this.tempCM2.add(hr[Pr]);this.tempCM2.divideScalar(br);for(let Pr=0;Pr<br;Pr++){const Dr=hr[Pr];Dr.sub(this.tempCM2),Sr=Math.max(Sr,Dr.x,Dr.y,Dr.z)}this.tempCM2.add(er.position)}let Cr=null,Ir=null,Rr=0;return xr>4&&(Cr=new Mesh(new ConvexGeometry(dr),er.material),Cr.position.copy(this.tempCM1),Cr.quaternion.copy(er.quaternion),this.prepareBreakableObject(Cr,yr,er.userData.velocity,er.userData.angularVelocity,2*wr>this.minSizeForBreak),Rr++),br>4&&(Ir=new Mesh(new ConvexGeometry(hr),er.material),Ir.position.copy(this.tempCM2),Ir.quaternion.copy(er.quaternion),this.prepareBreakableObject(Ir,yr,er.userData.velocity,er.userData.angularVelocity,2*Sr>this.minSizeForBreak),Rr++),ir.object1=Cr,ir.object2=Ir,Rr}static transformFreeVector(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*ir+ar[4]*nr+ar[8]*sr,er.y=ar[1]*ir+ar[5]*nr+ar[9]*sr,er.z=ar[2]*ir+ar[6]*nr+ar[10]*sr,er}static transformFreeVectorInverse(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*ir+ar[1]*nr+ar[2]*sr,er.y=ar[4]*ir+ar[5]*nr+ar[6]*sr,er.z=ar[8]*ir+ar[9]*nr+ar[10]*sr,er}static transformTiedVectorInverse(er,tr){const ir=er.x,nr=er.y,sr=er.z,ar=tr.elements;return er.x=ar[0]*ir+ar[1]*nr+ar[2]*sr-ar[12],er.y=ar[4]*ir+ar[5]*nr+ar[6]*sr-ar[13],er.z=ar[8]*ir+ar[9]*nr+ar[10]*sr-ar[14],er}static transformPlaneToLocalSpace(er,tr,ir){ir.normal.copy(er.normal),ir.constant=er.constant;const nr=ConvexObjectBreaker.transformTiedVectorInverse(er.coplanarPoint(_v1),tr);ConvexObjectBreaker.transformFreeVectorInverse(ir.normal,tr),ir.constant=-nr.dot(ir.normal)}}class GPUComputationRenderer{constructor(er,tr,ir){this.variables=[],this.currentTextureIndex=0;let nr=FloatType;const sr={passThruTexture:{value:null}},ar=cr(dr(),sr),or=new FullScreenQuad(ar);this.setDataType=function(hr){return nr=hr,this},this.addVariable=function(hr,pr,gr){const vr=this.createShaderMaterial(pr),mr={name:hr,initialValueTexture:gr,material:vr,dependencies:null,renderTargets:[],wrapS:null,wrapT:null,minFilter:NearestFilter,magFilter:NearestFilter};return this.variables.push(mr),mr},this.setVariableDependencies=function(hr,pr){hr.dependencies=pr},this.init=function(){if(ir.capabilities.maxVertexTextures===0)return"No support for vertex shader textures.";for(let hr=0;hr<this.variables.length;hr++){const pr=this.variables[hr];pr.renderTargets[0]=this.createRenderTarget(er,tr,pr.wrapS,pr.wrapT,pr.minFilter,pr.magFilter),pr.renderTargets[1]=this.createRenderTarget(er,tr,pr.wrapS,pr.wrapT,pr.minFilter,pr.magFilter),this.renderTexture(pr.initialValueTexture,pr.renderTargets[0]),this.renderTexture(pr.initialValueTexture,pr.renderTargets[1]);const gr=pr.material,vr=gr.uniforms;if(pr.dependencies!==null)for(let mr=0;mr<pr.dependencies.length;mr++){const fr=pr.dependencies[mr];if(fr.name!==pr.name){let _r=!1;for(let Ar=0;Ar<this.variables.length;Ar++)if(fr.name===this.variables[Ar].name){_r=!0;break}if(!_r)return"Variable dependency not found. Variable="+pr.name+", dependency="+fr.name}vr[fr.name]={value:null},gr.fragmentShader=`
uniform sampler2D `+fr.name+`;
`+gr.fragmentShader}}return this.currentTextureIndex=0,null},this.compute=function(){const hr=this.currentTextureIndex,pr=this.currentTextureIndex===0?1:0;for(let gr=0,vr=this.variables.length;gr<vr;gr++){const mr=this.variables[gr];if(mr.dependencies!==null){const fr=mr.material.uniforms;for(let _r=0,Ar=mr.dependencies.length;_r<Ar;_r++){const yr=mr.dependencies[_r];fr[yr.name].value=yr.renderTargets[hr].texture}}this.doRenderTarget(mr.material,mr.renderTargets[pr])}this.currentTextureIndex=pr},this.getCurrentRenderTarget=function(hr){return hr.renderTargets[this.currentTextureIndex]},this.getAlternateRenderTarget=function(hr){return hr.renderTargets[this.currentTextureIndex===0?1:0]},this.dispose=function(){or.dispose();const hr=this.variables;for(let pr=0;pr<hr.length;pr++){const gr=hr[pr];gr.initialValueTexture&&gr.initialValueTexture.dispose();const vr=gr.renderTargets;for(let mr=0;mr<vr.length;mr++)vr[mr].dispose()}};function lr(hr){hr.defines.resolution="vec2( "+er.toFixed(1)+", "+tr.toFixed(1)+" )"}this.addResolutionDefine=lr;function cr(hr,pr){pr=pr||{};const gr=new ShaderMaterial({name:"GPUComputationShader",uniforms:pr,vertexShader:ur(),fragmentShader:hr});return lr(gr),gr}this.createShaderMaterial=cr,this.createRenderTarget=function(hr,pr,gr,vr,mr,fr){return hr=hr||er,pr=pr||tr,gr=gr||ClampToEdgeWrapping,vr=vr||ClampToEdgeWrapping,mr=mr||NearestFilter,fr=fr||NearestFilter,new WebGLRenderTarget(hr,pr,{wrapS:gr,wrapT:vr,minFilter:mr,magFilter:fr,format:RGBAFormat,type:nr,depthBuffer:!1})},this.createTexture=function(){const hr=new Float32Array(er*tr*4),pr=new DataTexture(hr,er,tr,RGBAFormat,FloatType);return pr.needsUpdate=!0,pr},this.renderTexture=function(hr,pr){sr.passThruTexture.value=hr,this.doRenderTarget(ar,pr),sr.passThruTexture.value=null},this.doRenderTarget=function(hr,pr){const gr=ir.getRenderTarget(),vr=ir.xr.enabled,mr=ir.shadowMap.autoUpdate;ir.xr.enabled=!1,ir.shadowMap.autoUpdate=!1,or.material=hr,ir.setRenderTarget(pr),or.render(ir),or.material=ar,ir.xr.enabled=vr,ir.shadowMap.autoUpdate=mr,ir.setRenderTarget(gr)};function ur(){return`void main()	{

	gl_Position = vec4( position, 1.0 );

}
`}function dr(){return`uniform sampler2D passThruTexture;

void main() {

	vec2 uv = gl_FragCoord.xy / resolution.xy;

	gl_FragColor = texture2D( passThruTexture, uv );

}
`}}}const _translationObject=new Vector3$1,_quaternionObject=new Quaternion$1,_scaleObject=new Vector3$1,_translationWorld=new Vector3$1,_quaternionWorld=new Quaternion$1,_scaleWorld=new Vector3$1;class Gyroscope extends Object3D{constructor(){super()}updateMatrixWorld(er){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||er)&&(this.parent!==null?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(_translationWorld,_quaternionWorld,_scaleWorld),this.matrix.decompose(_translationObject,_quaternionObject,_scaleObject),this.matrixWorld.compose(_translationWorld,_quaternionObject,_scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,er=!0);for(let tr=0,ir=this.children.length;tr<ir;tr++)this.children[tr].updateMatrixWorld(er)}}class MD2Character{constructor(){this.scale=1,this.animationFPS=6,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0}loadParts(er){const tr=this;function ir(cr,ur){const dr=new MeshLambertMaterial({color:16755200,wireframe:!0}),hr=new MeshLambertMaterial({color:16777215,wireframe:!1,map:ur}),pr=new Mesh(cr,hr);return pr.rotation.y=-Math.PI/2,pr.castShadow=!0,pr.receiveShadow=!0,pr.materialTexture=hr,pr.materialWireframe=dr,pr}function nr(cr,ur){const dr=new TextureLoader,hr=[];for(let pr=0;pr<ur.length;pr++)hr[pr]=dr.load(cr+ur[pr],sr),hr[pr].mapping=UVMapping,hr[pr].name=ur[pr],hr[pr].colorSpace=SRGBColorSpace;return hr}function sr(){tr.loadCounter-=1,tr.loadCounter===0&&tr.onLoadComplete()}this.loadCounter=er.weapons.length*2+er.skins.length+1;const ar=[];for(let cr=0;cr<er.weapons.length;cr++)ar[cr]=er.weapons[cr][1];this.skinsBody=nr(er.baseUrl+"skins/",er.skins),this.skinsWeapon=nr(er.baseUrl+"skins/",ar);const or=new MD2Loader;or.load(er.baseUrl+er.body,function(cr){const ur=new Box3;ur.setFromBufferAttribute(cr.attributes.position),tr.root.position.y=-tr.scale*ur.min.y;const dr=ir(cr,tr.skinsBody[0]);dr.scale.set(tr.scale,tr.scale,tr.scale),tr.root.add(dr),tr.meshBody=dr,tr.meshBody.clipOffset=0,tr.activeAnimationClipName=dr.geometry.animations[0].name,tr.mixer=new AnimationMixer(dr),sr()});const lr=function(cr,ur){return function(dr){const hr=ir(dr,tr.skinsWeapon[cr]);hr.scale.set(tr.scale,tr.scale,tr.scale),hr.visible=!1,hr.name=ur,tr.root.add(hr),tr.weapons[cr]=hr,tr.meshWeapon=hr,sr()}};for(let cr=0;cr<er.weapons.length;cr++)or.load(er.baseUrl+er.weapons[cr][0],lr(cr,er.weapons[cr][0]))}setPlaybackRate(er){er!==0?this.mixer.timeScale=1/er:this.mixer.timeScale=0}setWireframe(er){er?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(er){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[er])}setWeapon(er){for(let ir=0;ir<this.weapons.length;ir++)this.weapons[ir].visible=!1;const tr=this.weapons[er];tr&&(tr.visible=!0,this.meshWeapon=tr,this.syncWeaponAnimation())}setAnimation(er){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);const tr=this.mixer.clipAction(er,this.meshBody);tr&&(this.meshBody.activeAction=tr.play())}this.activeClipName=er,this.syncWeaponAnimation()}syncWeaponAnimation(){const er=this.activeClipName;if(this.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);const tr=this.mixer.clipAction(er,this.meshWeapon);tr&&(this.meshWeapon.activeAction=tr.syncWith(this.meshBody.activeAction).play())}}update(er){this.mixer&&this.mixer.update(er)}}class MorphBlendMesh extends Mesh{constructor(er,tr){super(er,tr),this.animationsMap={},this.animationsList=[];const ir=Object.keys(this.morphTargetDictionary).length,nr="__default",sr=0,ar=ir-1,or=ir/1;this.createAnimation(nr,sr,ar,or),this.setAnimationWeight(nr,1)}createAnimation(er,tr,ir,nr){const sr={start:tr,end:ir,length:ir-tr+1,fps:nr,duration:(ir-tr)/nr,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[er]=sr,this.animationsList.push(sr)}autoCreateAnimations(er){const tr=/([a-z]+)_?(\d+)/i;let ir;const nr={};let sr=0;for(const ar in this.morphTargetDictionary){const or=ar.match(tr);if(or&&or.length>1){const lr=or[1];nr[lr]||(nr[lr]={start:1/0,end:-1/0});const cr=nr[lr];sr<cr.start&&(cr.start=sr),sr>cr.end&&(cr.end=sr),ir||(ir=lr)}sr++}for(const ar in nr){const or=nr[ar];this.createAnimation(ar,or.start,or.end,er)}this.firstAnimation=ir}setAnimationDirectionForward(er){const tr=this.animationsMap[er];tr&&(tr.direction=1,tr.directionBackwards=!1)}setAnimationDirectionBackward(er){const tr=this.animationsMap[er];tr&&(tr.direction=-1,tr.directionBackwards=!0)}setAnimationFPS(er,tr){const ir=this.animationsMap[er];ir&&(ir.fps=tr,ir.duration=(ir.end-ir.start)/ir.fps)}setAnimationDuration(er,tr){const ir=this.animationsMap[er];ir&&(ir.duration=tr,ir.fps=(ir.end-ir.start)/ir.duration)}setAnimationWeight(er,tr){const ir=this.animationsMap[er];ir&&(ir.weight=tr)}setAnimationTime(er,tr){const ir=this.animationsMap[er];ir&&(ir.time=tr)}getAnimationTime(er){let tr=0;const ir=this.animationsMap[er];return ir&&(tr=ir.time),tr}getAnimationDuration(er){let tr=-1;const ir=this.animationsMap[er];return ir&&(tr=ir.duration),tr}playAnimation(er){const tr=this.animationsMap[er];tr?(tr.time=0,tr.active=!0):console.warn("THREE.MorphBlendMesh: animation["+er+"] undefined in .playAnimation()")}stopAnimation(er){const tr=this.animationsMap[er];tr&&(tr.active=!1)}update(er){for(let tr=0,ir=this.animationsList.length;tr<ir;tr++){const nr=this.animationsList[tr];if(!nr.active)continue;const sr=nr.duration/nr.length;nr.time+=nr.direction*er,nr.mirroredLoop?(nr.time>nr.duration||nr.time<0)&&(nr.direction*=-1,nr.time>nr.duration&&(nr.time=nr.duration,nr.directionBackwards=!0),nr.time<0&&(nr.time=0,nr.directionBackwards=!1)):(nr.time=nr.time%nr.duration,nr.time<0&&(nr.time+=nr.duration));const ar=nr.start+MathUtils.clamp(Math.floor(nr.time/sr),0,nr.length-1),or=nr.weight;ar!==nr.currentFrame&&(this.morphTargetInfluences[nr.lastFrame]=0,this.morphTargetInfluences[nr.currentFrame]=1*or,this.morphTargetInfluences[ar]=0,nr.lastFrame=nr.currentFrame,nr.currentFrame=ar);let lr=nr.time%sr/sr;nr.directionBackwards&&(lr=1-lr),nr.currentFrame!==nr.lastFrame?(this.morphTargetInfluences[nr.currentFrame]=lr*or,this.morphTargetInfluences[nr.lastFrame]=(1-lr)*or):this.morphTargetInfluences[nr.currentFrame]=or}}}class MD2CharacterComplex{constructor(){this.scale=1,this.animationFPS=6,this.transitionFrames=15,this.maxSpeed=275,this.maxReverseSpeed=-275,this.frontAcceleration=600,this.backAcceleration=600,this.frontDecceleration=600,this.angularSpeed=2.5,this.root=new Object3D,this.meshBody=null,this.meshWeapon=null,this.controls=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.currentSkin=void 0,this.onLoadComplete=function(){},this.meshes=[],this.animations={},this.loadCounter=0,this.speed=0,this.bodyOrientation=0,this.walkSpeed=this.maxSpeed,this.crouchSpeed=this.maxSpeed*.5,this.activeAnimation=null,this.oldAnimation=null}enableShadows(er){for(let tr=0;tr<this.meshes.length;tr++)this.meshes[tr].castShadow=er,this.meshes[tr].receiveShadow=er}setVisible(er){for(let tr=0;tr<this.meshes.length;tr++)this.meshes[tr].visible=er,this.meshes[tr].visible=er}shareParts(er){this.animations=er.animations,this.walkSpeed=er.walkSpeed,this.crouchSpeed=er.crouchSpeed,this.skinsBody=er.skinsBody,this.skinsWeapon=er.skinsWeapon;const tr=this._createPart(er.meshBody.geometry,this.skinsBody[0]);tr.scale.set(this.scale,this.scale,this.scale),this.root.position.y=er.root.position.y,this.root.add(tr),this.meshBody=tr,this.meshes.push(tr);for(let ir=0;ir<er.weapons.length;ir++){const nr=this._createPart(er.weapons[ir].geometry,this.skinsWeapon[ir]);nr.scale.set(this.scale,this.scale,this.scale),nr.visible=!1,nr.name=er.weapons[ir].name,this.root.add(nr),this.weapons[ir]=nr,this.meshWeapon=nr,this.meshes.push(nr)}}loadParts(er){const tr=this;function ir(lr,cr){const ur=new TextureLoader,dr=[];for(let hr=0;hr<cr.length;hr++)dr[hr]=ur.load(lr+cr[hr],nr),dr[hr].mapping=UVMapping,dr[hr].name=cr[hr],dr[hr].colorSpace=SRGBColorSpace;return dr}function nr(){tr.loadCounter-=1,tr.loadCounter===0&&tr.onLoadComplete()}this.animations=er.animations,this.walkSpeed=er.walkSpeed,this.crouchSpeed=er.crouchSpeed,this.loadCounter=er.weapons.length*2+er.skins.length+1;const sr=[];for(let lr=0;lr<er.weapons.length;lr++)sr[lr]=er.weapons[lr][1];this.skinsBody=ir(er.baseUrl+"skins/",er.skins),this.skinsWeapon=ir(er.baseUrl+"skins/",sr);const ar=new MD2Loader;ar.load(er.baseUrl+er.body,function(lr){const cr=new Box3;cr.setFromBufferAttribute(lr.attributes.position),tr.root.position.y=-tr.scale*cr.min.y;const ur=tr._createPart(lr,tr.skinsBody[0]);ur.scale.set(tr.scale,tr.scale,tr.scale),tr.root.add(ur),tr.meshBody=ur,tr.meshes.push(ur),nr()});const or=function(lr,cr){return function(ur){const dr=tr._createPart(ur,tr.skinsWeapon[lr]);dr.scale.set(tr.scale,tr.scale,tr.scale),dr.visible=!1,dr.name=cr,tr.root.add(dr),tr.weapons[lr]=dr,tr.meshWeapon=dr,tr.meshes.push(dr),nr()}};for(let lr=0;lr<er.weapons.length;lr++)ar.load(er.baseUrl+er.weapons[lr][0],or(lr,er.weapons[lr][0]))}setPlaybackRate(er){this.meshBody&&(this.meshBody.duration=this.meshBody.baseDuration/er),this.meshWeapon&&(this.meshWeapon.duration=this.meshWeapon.baseDuration/er)}setWireframe(er){er?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(er){this.meshBody&&this.meshBody.material.wireframe===!1&&(this.meshBody.material.map=this.skinsBody[er],this.currentSkin=er)}setWeapon(er){for(let ir=0;ir<this.weapons.length;ir++)this.weapons[ir].visible=!1;const tr=this.weapons[er];tr&&(tr.visible=!0,this.meshWeapon=tr,this.activeAnimation&&(tr.playAnimation(this.activeAnimation),this.meshWeapon.setAnimationTime(this.activeAnimation,this.meshBody.getAnimationTime(this.activeAnimation))))}setAnimation(er){er===this.activeAnimation||!er||(this.meshBody&&(this.meshBody.setAnimationWeight(er,0),this.meshBody.playAnimation(er),this.oldAnimation=this.activeAnimation,this.activeAnimation=er,this.blendCounter=this.transitionFrames),this.meshWeapon&&(this.meshWeapon.setAnimationWeight(er,0),this.meshWeapon.playAnimation(er)))}update(er){this.controls&&this.updateMovementModel(er),this.animations&&(this.updateBehaviors(),this.updateAnimations(er))}updateAnimations(er){let tr=1;this.blendCounter>0&&(tr=(this.transitionFrames-this.blendCounter)/this.transitionFrames,this.blendCounter-=1),this.meshBody&&(this.meshBody.update(er),this.meshBody.setAnimationWeight(this.activeAnimation,tr),this.meshBody.setAnimationWeight(this.oldAnimation,1-tr)),this.meshWeapon&&(this.meshWeapon.update(er),this.meshWeapon.setAnimationWeight(this.activeAnimation,tr),this.meshWeapon.setAnimationWeight(this.oldAnimation,1-tr))}updateBehaviors(){const er=this.controls,tr=this.animations;let ir,nr;er.crouch?(ir=tr.crouchMove,nr=tr.crouchIdle):(ir=tr.move,nr=tr.idle),er.jump&&(ir=tr.jump,nr=tr.jump),er.attack&&(er.crouch?(ir=tr.crouchAttack,nr=tr.crouchAttack):(ir=tr.attack,nr=tr.attack)),(er.moveForward||er.moveBackward||er.moveLeft||er.moveRight)&&this.activeAnimation!==ir&&this.setAnimation(ir),Math.abs(this.speed)<.2*this.maxSpeed&&!(er.moveLeft||er.moveRight||er.moveForward||er.moveBackward)&&this.activeAnimation!==nr&&this.setAnimation(nr),er.moveForward&&(this.meshBody&&(this.meshBody.setAnimationDirectionForward(this.activeAnimation),this.meshBody.setAnimationDirectionForward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionForward(this.activeAnimation),this.meshWeapon.setAnimationDirectionForward(this.oldAnimation))),er.moveBackward&&(this.meshBody&&(this.meshBody.setAnimationDirectionBackward(this.activeAnimation),this.meshBody.setAnimationDirectionBackward(this.oldAnimation)),this.meshWeapon&&(this.meshWeapon.setAnimationDirectionBackward(this.activeAnimation),this.meshWeapon.setAnimationDirectionBackward(this.oldAnimation)))}updateMovementModel(er){function tr(ar){return ar===1?1:-Math.pow(2,-10*ar)+1}const ir=this.controls;ir.crouch?this.maxSpeed=this.crouchSpeed:this.maxSpeed=this.walkSpeed,this.maxReverseSpeed=-this.maxSpeed,ir.moveForward&&(this.speed=MathUtils.clamp(this.speed+er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),ir.moveBackward&&(this.speed=MathUtils.clamp(this.speed-er*this.backAcceleration,this.maxReverseSpeed,this.maxSpeed));const nr=1;if(ir.moveLeft&&(this.bodyOrientation+=er*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+nr*er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),ir.moveRight&&(this.bodyOrientation-=er*this.angularSpeed,this.speed=MathUtils.clamp(this.speed+nr*er*this.frontAcceleration,this.maxReverseSpeed,this.maxSpeed)),!(ir.moveForward||ir.moveBackward))if(this.speed>0){const ar=tr(this.speed/this.maxSpeed);this.speed=MathUtils.clamp(this.speed-ar*er*this.frontDecceleration,0,this.maxSpeed)}else{const ar=tr(this.speed/this.maxReverseSpeed);this.speed=MathUtils.clamp(this.speed+ar*er*this.backAcceleration,this.maxReverseSpeed,0)}const sr=this.speed*er;this.root.position.x+=Math.sin(this.bodyOrientation)*sr,this.root.position.z+=Math.cos(this.bodyOrientation)*sr,this.root.rotation.y=this.bodyOrientation}_createPart(er,tr){const ir=new MeshLambertMaterial({color:16755200,wireframe:!0}),nr=new MeshLambertMaterial({color:16777215,wireframe:!1,map:tr}),sr=new MorphBlendMesh(er,nr);return sr.rotation.y=-Math.PI/2,sr.materialTexture=nr,sr.materialWireframe=ir,sr.autoCreateAnimations(this.animationFPS),sr}}class MorphAnimMesh extends Mesh{constructor(er,tr){super(er,tr),this.type="MorphAnimMesh",this.mixer=new AnimationMixer(this),this.activeAction=null}setDirectionForward(){this.mixer.timeScale=1}setDirectionBackward(){this.mixer.timeScale=-1}playAnimation(er,tr){this.activeAction&&(this.activeAction.stop(),this.activeAction=null);const ir=AnimationClip.findByName(this,er);if(ir){const nr=this.mixer.clipAction(ir);nr.timeScale=ir.tracks.length*tr/ir.duration,this.activeAction=nr.play()}else throw new Error("THREE.MorphAnimMesh: animations["+er+"] undefined in .playAnimation()")}updateAnimation(er){this.mixer.update(er)}copy(er,tr){return super.copy(er,tr),this.mixer=new AnimationMixer(this),this}}/**
 * potpack - by [@mourner](https://github.com/mourner)
 * 
 * A tiny JavaScript function for packing 2D rectangles into a near-square container, 
 * which is useful for generating CSS sprites and WebGL textures. Similar to 
 * [shelf-pack](https://github.com/mapbox/shelf-pack), but static (you can't add items 
 * once a layout is generated), and aims for maximal space utilization.
 *
 * A variation of algorithms used in [rectpack2D](https://github.com/TeamHypersomnia/rectpack2D)
 * and [bin-pack](https://github.com/bryanburgers/bin-pack), which are in turn based 
 * on [this article by Blackpawn](http://blackpawn.com/texts/lightmaps/default.html).
 * 
 * @license
 * ISC License
 * 
 * Copyright (c) 2018, Mapbox
 * 
 * Permission to use, copy, modify, and/or distribute this software for any purpose
 * with or without fee is hereby granted, provided that the above copyright notice
 * and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
 * REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
 * INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
 * OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
 * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
 * THIS SOFTWARE.
 */function potpack(rr){let er=0,tr=0;for(const or of rr)er+=or.w*or.h,tr=Math.max(tr,or.w);rr.sort((or,lr)=>lr.h-or.h);const nr=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(er/.95)),tr),h:1/0}];let sr=0,ar=0;for(const or of rr)for(let lr=nr.length-1;lr>=0;lr--){const cr=nr[lr];if(!(or.w>cr.w||or.h>cr.h)){if(or.x=cr.x,or.y=cr.y,ar=Math.max(ar,or.y+or.h),sr=Math.max(sr,or.x+or.w),or.w===cr.w&&or.h===cr.h){const ur=nr.pop();lr<nr.length&&(nr[lr]=ur)}else or.h===cr.h?(cr.x+=or.w,cr.w-=or.w):or.w===cr.w?(cr.y+=or.h,cr.h-=or.h):(nr.push({x:cr.x+or.w,y:cr.y,w:cr.w-or.w,h:or.h}),cr.y+=or.h,cr.h-=or.h);break}}return{w:sr,h:ar,fill:er/(sr*ar)||0}}class ProgressiveLightMap{constructor(er,tr=1024){this.renderer=er,this.res=tr,this.lightMapContainers=[],this.scene=new Scene,this.buffer1Active=!1,this.firstUpdate=!0,this.labelMesh=null,this.blurringPlane=null;const ir=/(Android|iPad|iPhone|iPod)/g.test(navigator.userAgent)?HalfFloatType:FloatType;this.progressiveLightMap1=new WebGLRenderTarget(this.res,this.res,{type:ir}),this.progressiveLightMap2=new WebGLRenderTarget(this.res,this.res,{type:ir}),this.progressiveLightMap2.texture.channel=1,this.uvMat=new MeshPhongMaterial,this.uvMat.uniforms={},this.uvMat.onBeforeCompile=nr=>{nr.vertexShader=`attribute vec2 uv1;
#define USE_LIGHTMAP
#define LIGHTMAP_UV uv1
`+nr.vertexShader.slice(0,-1)+"	gl_Position = vec4((LIGHTMAP_UV - 0.5) * 2.0, 1.0, 1.0); }";const sr=nr.fragmentShader.indexOf("void main() {");nr.fragmentShader=`#define USE_LIGHTMAP
`+nr.fragmentShader.slice(0,sr)+`	uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+nr.fragmentShader.slice(sr-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vLightMapUv).rgb;
				gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/averagingWindow);
			}`,nr.uniforms.previousShadowMap={value:this.progressiveLightMap1.texture},nr.uniforms.averagingWindow={value:100},this.uvMat.uniforms=nr.uniforms,this.uvMat.userData.shader=nr}}addObjectsToLightMap(er){this.uv_boxes=[];const tr=3/this.res;for(let nr=0;nr<er.length;nr++){const sr=er[nr];if(sr.isLight){this.scene.attach(sr);continue}if(sr.geometry.hasAttribute("uv")===!1){console.warn("THREE.ProgressiveLightMap: All lightmap objects need uvs.");continue}this.blurringPlane===null&&this._initializeBlurPlane(this.res,this.progressiveLightMap1),sr.material.lightMap=this.progressiveLightMap2.texture,sr.material.dithering=!0,sr.castShadow=!0,sr.receiveShadow=!0,sr.renderOrder=1e3+nr,this.uv_boxes.push({w:1+tr*2,h:1+tr*2,index:nr}),this.lightMapContainers.push({basicMat:sr.material,object:sr})}const ir=potpack(this.uv_boxes);this.uv_boxes.forEach(nr=>{const sr=er[nr.index].geometry.getAttribute("uv").clone();for(let ar=0;ar<sr.array.length;ar+=sr.itemSize)sr.array[ar]=(sr.array[ar]+nr.x+tr)/ir.w,sr.array[ar+1]=(sr.array[ar+1]+nr.y+tr)/ir.h;er[nr.index].geometry.setAttribute("uv1",sr),er[nr.index].geometry.getAttribute("uv1").needsUpdate=!0})}update(er,tr=100,ir=!0){if(this.blurringPlane===null)return;const nr=this.renderer.getRenderTarget();this.blurringPlane.visible=ir;for(let or=0;or<this.lightMapContainers.length;or++)this.lightMapContainers[or].object.oldScene=this.lightMapContainers[or].object.parent,this.scene.attach(this.lightMapContainers[or].object);this.firstUpdate===!0&&(this.renderer.compile(this.scene,er),this.firstUpdate=!1);for(let or=0;or<this.lightMapContainers.length;or++)this.uvMat.uniforms.averagingWindow={value:tr},this.lightMapContainers[or].object.material=this.uvMat,this.lightMapContainers[or].object.oldFrustumCulled=this.lightMapContainers[or].object.frustumCulled,this.lightMapContainers[or].object.frustumCulled=!1;const sr=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,ar=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1;this.renderer.setRenderTarget(sr),this.uvMat.uniforms.previousShadowMap={value:ar.texture},this.blurringPlane.material.uniforms.previousShadowMap={value:ar.texture},this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,er);for(let or=0;or<this.lightMapContainers.length;or++)this.lightMapContainers[or].object.frustumCulled=this.lightMapContainers[or].object.oldFrustumCulled,this.lightMapContainers[or].object.material=this.lightMapContainers[or].basicMat,this.lightMapContainers[or].object.oldScene.attach(this.lightMapContainers[or].object);this.renderer.setRenderTarget(nr)}showDebugLightmap(er,tr=void 0){if(this.lightMapContainers.length===0){console.warn("THREE.ProgressiveLightMap: Call .showDebugLightmap() after adding the objects.");return}if(this.labelMesh===null){const ir=new MeshBasicMaterial({map:this.progressiveLightMap1.texture,side:DoubleSide}),nr=new PlaneGeometry(100,100);this.labelMesh=new Mesh(nr,ir),this.labelMesh.position.y=250,this.lightMapContainers[0].object.parent.add(this.labelMesh)}tr!==void 0&&this.labelMesh.position.copy(tr),this.labelMesh.visible=er}_initializeBlurPlane(er,tr=null){const ir=new MeshBasicMaterial;ir.uniforms={previousShadowMap:{value:null},pixelOffset:{value:1/er},polygonOffset:!0,polygonOffsetFactor:-1,polygonOffsetUnits:3},ir.onBeforeCompile=nr=>{nr.vertexShader=`#define USE_UV
`+nr.vertexShader.slice(0,-1)+"	gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const sr=nr.fragmentShader.indexOf("void main() {");nr.fragmentShader=`#define USE_UV
`+nr.fragmentShader.slice(0,sr)+`	uniform sampler2D previousShadowMap;
	uniform float pixelOffset;
`+nr.fragmentShader.slice(sr-1,-1)+`	gl_FragColor.rgb = (
									texture2D(previousShadowMap, vUv + vec2( pixelOffset,  0.0        )).rgb +
									texture2D(previousShadowMap, vUv + vec2( 0.0        ,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2( 0.0        , -pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  0.0        )).rgb +
									texture2D(previousShadowMap, vUv + vec2( pixelOffset,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset,  pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2( pixelOffset, -pixelOffset)).rgb +
									texture2D(previousShadowMap, vUv + vec2(-pixelOffset, -pixelOffset)).rgb)/8.0;
				}`,nr.uniforms.previousShadowMap={value:tr.texture},nr.uniforms.pixelOffset={value:.5/er},ir.uniforms=nr.uniforms,ir.userData.shader=nr},this.blurringPlane=new Mesh(new PlaneGeometry(1,1),ir),this.blurringPlane.name="Blurring Plane",this.blurringPlane.frustumCulled=!1,this.blurringPlane.renderOrder=0,this.blurringPlane.material.depthWrite=!1,this.scene.add(this.blurringPlane)}dispose(){this.progressiveLightMap1.dispose(),this.progressiveLightMap2.dispose(),this.uvMat.dispose(),this.blurringPlane!==null&&(this.blurringPlane.geometry.dispose(),this.blurringPlane.material.dispose()),this.labelMesh!==null&&(this.labelMesh.geometry.dispose(),this.labelMesh.material.dispose())}}class RollerCoasterGeometry extends BufferGeometry{constructor(er,tr){super();const ir=[],nr=[],sr=[],ar=[1,1,1],or=[1,1,0],lr=new Vector3$1(0,1,0),cr=new Vector3$1,ur=new Vector3$1,dr=new Quaternion$1,hr=new Quaternion$1;hr.setFromAxisAngle(lr,Math.PI/2);const pr=new Vector3$1,gr=new Vector3$1;gr.copy(er.getPointAt(0));const vr=[new Vector3$1(-.225,0,0),new Vector3$1(0,-.05,0),new Vector3$1(0,-.175,0),new Vector3$1(0,-.05,0),new Vector3$1(.225,0,0),new Vector3$1(0,-.175,0)],mr=Math.PI*2;let fr=5;const _r=[];for(let Ur=0;Ur<fr;Ur++){const Br=Ur/fr*mr;_r.push(new Vector3$1(Math.sin(Br)*.06,Math.cos(Br)*.06,0))}fr=6;const Ar=[];for(let Ur=0;Ur<fr;Ur++){const Br=Ur/fr*mr;Ar.push(new Vector3$1(Math.sin(Br)*.025,Math.cos(Br)*.025,0))}const yr=new Vector3$1,wr=new Vector3$1;function xr(Ur,Br){wr.set(0,0,-1).applyQuaternion(dr);for(let Wr=0;Wr<Ur.length;Wr++)yr.copy(Ur[Wr]),yr.applyQuaternion(dr),yr.add(pr),ir.push(yr.x,yr.y,yr.z),nr.push(wr.x,wr.y,wr.z),sr.push(Br[0],Br[1],Br[2]);wr.set(0,0,1).applyQuaternion(dr);for(let Wr=Ur.length-1;Wr>=0;Wr--)yr.copy(Ur[Wr]),yr.applyQuaternion(dr),yr.add(pr),ir.push(yr.x,yr.y,yr.z),nr.push(wr.x,wr.y,wr.z),sr.push(Br[0],Br[1],Br[2])}const Sr=new Vector3$1,br=new Vector3$1,Cr=new Vector3$1,Ir=new Vector3$1,Rr=new Vector3$1,Pr=new Vector3$1,Dr=new Vector3$1,Fr=new Vector3$1;function Or(Ur,Br,Wr){for(let Xr=0,Yr=Ur.length;Xr<Yr;Xr++){const Qi=Ur[Xr],Xi=Ur[(Xr+1)%Yr];Sr.copy(Qi).add(Br),Sr.applyQuaternion(dr),Sr.add(pr),br.copy(Xi).add(Br),br.applyQuaternion(dr),br.add(pr),Cr.copy(Xi).add(Br),Cr.applyQuaternion(hr),Cr.add(gr),Ir.copy(Qi).add(Br),Ir.applyQuaternion(hr),Ir.add(gr),ir.push(Sr.x,Sr.y,Sr.z),ir.push(br.x,br.y,br.z),ir.push(Ir.x,Ir.y,Ir.z),ir.push(br.x,br.y,br.z),ir.push(Cr.x,Cr.y,Cr.z),ir.push(Ir.x,Ir.y,Ir.z),Rr.copy(Qi),Rr.applyQuaternion(dr),Rr.normalize(),Pr.copy(Xi),Pr.applyQuaternion(dr),Pr.normalize(),Dr.copy(Xi),Dr.applyQuaternion(hr),Dr.normalize(),Fr.copy(Qi),Fr.applyQuaternion(hr),Fr.normalize(),nr.push(Rr.x,Rr.y,Rr.z),nr.push(Pr.x,Pr.y,Pr.z),nr.push(Fr.x,Fr.y,Fr.z),nr.push(Pr.x,Pr.y,Pr.z),nr.push(Dr.x,Dr.y,Dr.z),nr.push(Fr.x,Fr.y,Fr.z),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2]),sr.push(Wr[0],Wr[1],Wr[2])}}const Nr=new Vector3$1;for(let Ur=1;Ur<=tr;Ur++){pr.copy(er.getPointAt(Ur/tr)),lr.set(0,1,0),cr.subVectors(pr,gr).normalize(),ur.crossVectors(lr,cr).normalize(),lr.crossVectors(cr,ur);const Br=Math.atan2(cr.x,cr.z);dr.setFromAxisAngle(lr,Br),Ur%2===0&&xr(vr,or),Or(_r,Nr.set(0,-.125,0),or),Or(Ar,Nr.set(.2,0,0),ar),Or(Ar,Nr.set(-.2,0,0),ar),gr.copy(pr),hr.copy(dr)}this.setAttribute("position",new BufferAttribute(new Float32Array(ir),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(nr),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(sr),3))}}class RollerCoasterLiftersGeometry extends BufferGeometry{constructor(er,tr){super();const ir=[],nr=[],sr=new Quaternion$1,ar=new Vector3$1(0,1,0),or=new Vector3$1,lr=new Vector3$1,cr=[new Vector3$1(0,.05,-.05),new Vector3$1(0,.05,.05),new Vector3$1(0,-.05,0)],ur=[new Vector3$1(-.05,0,.05),new Vector3$1(-.05,0,-.05),new Vector3$1(.05,0,0)],dr=[new Vector3$1(.05,0,-.05),new Vector3$1(.05,0,.05),new Vector3$1(-.05,0,0)],hr=new Vector3$1,pr=new Vector3$1,gr=new Vector3$1,vr=new Vector3$1,mr=new Vector3$1,fr=new Vector3$1,_r=new Vector3$1,Ar=new Vector3$1;function yr(Sr,br,Cr){for(let Ir=0,Rr=Sr.length;Ir<Rr;Ir++){const Pr=Sr[Ir],Dr=Sr[(Ir+1)%Rr];hr.copy(Pr),hr.applyQuaternion(sr),hr.add(br),pr.copy(Dr),pr.applyQuaternion(sr),pr.add(br),gr.copy(Dr),gr.applyQuaternion(sr),gr.add(Cr),vr.copy(Pr),vr.applyQuaternion(sr),vr.add(Cr),ir.push(hr.x,hr.y,hr.z),ir.push(pr.x,pr.y,pr.z),ir.push(vr.x,vr.y,vr.z),ir.push(pr.x,pr.y,pr.z),ir.push(gr.x,gr.y,gr.z),ir.push(vr.x,vr.y,vr.z),mr.copy(Pr),mr.applyQuaternion(sr),mr.normalize(),fr.copy(Dr),fr.applyQuaternion(sr),fr.normalize(),_r.copy(Dr),_r.applyQuaternion(sr),_r.normalize(),Ar.copy(Pr),Ar.applyQuaternion(sr),Ar.normalize(),nr.push(mr.x,mr.y,mr.z),nr.push(fr.x,fr.y,fr.z),nr.push(Ar.x,Ar.y,Ar.z),nr.push(fr.x,fr.y,fr.z),nr.push(_r.x,_r.y,_r.z),nr.push(Ar.x,Ar.y,Ar.z)}}const wr=new Vector3$1,xr=new Vector3$1;for(let Sr=1;Sr<=tr;Sr++){or.copy(er.getPointAt(Sr/tr)),lr.copy(er.getTangentAt(Sr/tr));const br=Math.atan2(lr.x,lr.z);sr.setFromAxisAngle(ar,br),or.y>10?(wr.set(-.75,-.35,0),wr.applyQuaternion(sr),wr.add(or),xr.set(.75,-.35,0),xr.applyQuaternion(sr),xr.add(or),yr(cr,wr,xr),wr.set(-.7,-.3,0),wr.applyQuaternion(sr),wr.add(or),xr.set(-.7,-or.y,0),xr.applyQuaternion(sr),xr.add(or),yr(ur,wr,xr),wr.set(.7,-.3,0),wr.applyQuaternion(sr),wr.add(or),xr.set(.7,-or.y,0),xr.applyQuaternion(sr),xr.add(or),yr(dr,wr,xr)):(wr.set(0,-.2,0),wr.applyQuaternion(sr),wr.add(or),xr.set(0,-or.y,0),xr.applyQuaternion(sr),xr.add(or),yr(dr,wr,xr))}this.setAttribute("position",new BufferAttribute(new Float32Array(ir),3)),this.setAttribute("normal",new BufferAttribute(new Float32Array(nr),3))}}class RollerCoasterShadowGeometry extends BufferGeometry{constructor(er,tr){super();const ir=[],nr=new Vector3$1(0,1,0),sr=new Vector3$1,ar=new Quaternion$1,or=new Quaternion$1;or.setFromAxisAngle(nr,Math.PI/2);const lr=new Vector3$1,cr=new Vector3$1;cr.copy(er.getPointAt(0)),cr.y=0;const ur=new Vector3$1,dr=new Vector3$1,hr=new Vector3$1,pr=new Vector3$1;for(let gr=1;gr<=tr;gr++){lr.copy(er.getPointAt(gr/tr)),lr.y=0,sr.subVectors(lr,cr);const vr=Math.atan2(sr.x,sr.z);ar.setFromAxisAngle(nr,vr),ur.set(-.3,0,0),ur.applyQuaternion(ar),ur.add(lr),dr.set(.3,0,0),dr.applyQuaternion(ar),dr.add(lr),hr.set(.3,0,0),hr.applyQuaternion(or),hr.add(cr),pr.set(-.3,0,0),pr.applyQuaternion(or),pr.add(cr),ir.push(ur.x,ur.y,ur.z),ir.push(dr.x,dr.y,dr.z),ir.push(pr.x,pr.y,pr.z),ir.push(dr.x,dr.y,dr.z),ir.push(hr.x,hr.y,hr.z),ir.push(pr.x,pr.y,pr.z),cr.copy(lr),or.copy(ar)}this.setAttribute("position",new BufferAttribute(new Float32Array(ir),3))}}class SkyGeometry extends BufferGeometry{constructor(){super();const er=[];for(let tr=0;tr<100;tr++){const ir=Math.random()*800-400,nr=Math.random()*50+50,sr=Math.random()*800-400,ar=Math.random()*40+20;er.push(ir-ar,nr,sr-ar),er.push(ir+ar,nr,sr-ar),er.push(ir-ar,nr,sr+ar),er.push(ir+ar,nr,sr-ar),er.push(ir+ar,nr,sr+ar),er.push(ir-ar,nr,sr+ar)}this.setAttribute("position",new BufferAttribute(new Float32Array(er),3))}}class TreesGeometry extends BufferGeometry{constructor(er){super();const tr=[],ir=[],nr=new Raycaster;nr.ray.direction.set(0,-1,0);const sr=new Color;for(let ar=0;ar<2e3;ar++){const or=Math.random()*500-250,lr=Math.random()*500-250;nr.ray.origin.set(or,50,lr);const cr=nr.intersectObject(er);if(cr.length===0)continue;const ur=cr[0].point.y,dr=Math.random()*5+.5;let hr=Math.random()*Math.PI*2;tr.push(or+Math.sin(hr),ur,lr+Math.cos(hr)),tr.push(or,ur+dr,lr),tr.push(or+Math.sin(hr+Math.PI),ur,lr+Math.cos(hr+Math.PI)),hr+=Math.PI/2,tr.push(or+Math.sin(hr),ur,lr+Math.cos(hr)),tr.push(or,ur+dr,lr),tr.push(or+Math.sin(hr+Math.PI),ur,lr+Math.cos(hr+Math.PI));const pr=Math.random()*.1;for(let gr=0;gr<6;gr++)sr.setRGB(.2+pr,.4+pr,0,SRGBColorSpace),ir.push(sr.r,sr.g,sr.b)}this.setAttribute("position",new BufferAttribute(new Float32Array(tr),3)),this.setAttribute("color",new BufferAttribute(new Float32Array(ir),3))}}let Timer$1=class{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=now(),this._delta=0,this._elapsed=0,this._timescale=1,this._usePageVisibilityAPI=typeof document<"u"&&document.hidden!==void 0,this._usePageVisibilityAPI===!0&&(this._pageVisibilityHandler=handleVisibilityChange.bind(this),document.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(er){return this._timescale=er,this}reset(){return this._currentTime=now()-this._startTime,this}dispose(){return this._usePageVisibilityAPI===!0&&document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this}update(er){return this._usePageVisibilityAPI===!0&&document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(er!==void 0?er:now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}};class FixedTimer extends Timer$1{constructor(er=60){super(),this._delta=1/er*1e3}update(){return this._elapsed+=this._delta*this._timescale,this}}function now(){return performance.now()}function handleVisibilityChange(){document.hidden===!1&&this.reset()}function TubePainter(){const er=new BufferAttribute(new Float32Array(3e6),3);er.usage=DynamicDrawUsage;const tr=new BufferAttribute(new Float32Array(3e6),3);tr.usage=DynamicDrawUsage;const ir=new BufferAttribute(new Float32Array(3e6),3);ir.usage=DynamicDrawUsage;const nr=new BufferGeometry;nr.setAttribute("position",er),nr.setAttribute("normal",tr),nr.setAttribute("color",ir),nr.drawRange.count=0;const sr=new MeshStandardMaterial({vertexColors:!0}),ar=new Mesh(nr,sr);ar.frustumCulled=!1;function or(Cr){const Ir=Math.PI*2,Rr=10,Pr=[],Dr=.01*Cr;for(let Fr=0;Fr<Rr;Fr++){const Or=Fr/Rr*Ir;Pr.push(new Vector3$1(Math.sin(Or)*Dr,Math.cos(Or)*Dr,0))}return Pr}const lr=new Vector3$1,cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1,hr=new Color(16777215);let pr=1;function gr(Cr,Ir,Rr,Pr){if(Cr.distanceToSquared(Ir)===0)return;let Dr=nr.drawRange.count;const Fr=or(pr);for(let Or=0,Nr=Fr.length;Or<Nr;Or++){const Ur=Fr[Or],Br=Fr[(Or+1)%Nr];lr.copy(Ur).applyMatrix4(Pr).add(Ir),cr.copy(Br).applyMatrix4(Pr).add(Ir),ur.copy(Br).applyMatrix4(Rr).add(Cr),dr.copy(Ur).applyMatrix4(Rr).add(Cr),lr.toArray(er.array,(Dr+0)*3),cr.toArray(er.array,(Dr+1)*3),dr.toArray(er.array,(Dr+2)*3),cr.toArray(er.array,(Dr+3)*3),ur.toArray(er.array,(Dr+4)*3),dr.toArray(er.array,(Dr+5)*3),lr.copy(Ur).applyMatrix4(Pr).normalize(),cr.copy(Br).applyMatrix4(Pr).normalize(),ur.copy(Br).applyMatrix4(Rr).normalize(),dr.copy(Ur).applyMatrix4(Rr).normalize(),lr.toArray(tr.array,(Dr+0)*3),cr.toArray(tr.array,(Dr+1)*3),dr.toArray(tr.array,(Dr+2)*3),cr.toArray(tr.array,(Dr+3)*3),ur.toArray(tr.array,(Dr+4)*3),dr.toArray(tr.array,(Dr+5)*3),hr.toArray(ir.array,(Dr+0)*3),hr.toArray(ir.array,(Dr+1)*3),hr.toArray(ir.array,(Dr+2)*3),hr.toArray(ir.array,(Dr+3)*3),hr.toArray(ir.array,(Dr+4)*3),hr.toArray(ir.array,(Dr+5)*3),Dr+=6}nr.drawRange.count=Dr}const vr=new Vector3$1(0,1,0),mr=new Vector3$1,fr=new Vector3$1,_r=new Matrix4,Ar=new Matrix4;function yr(Cr){mr.copy(Cr),_r.lookAt(fr,mr,vr),fr.copy(Cr),Ar.copy(_r)}function wr(Cr){mr.copy(Cr),_r.lookAt(fr,mr,vr),gr(mr,fr,_r,Ar),fr.copy(mr),Ar.copy(_r)}function xr(Cr){pr=Cr}let Sr=0;function br(){const Cr=Sr,Ir=nr.drawRange.count;Cr!==Ir&&(er.addUpdateRange(Cr*3,(Ir-Cr)*3),er.needsUpdate=!0,tr.addUpdateRange(Cr*3,(Ir-Cr)*3),tr.needsUpdate=!0,ir.addUpdateRange(Cr*3,(Ir-Cr)*3),ir.needsUpdate=!0,Sr=nr.drawRange.count)}return{mesh:ar,moveTo:yr,lineTo:wr,setSize:xr,update:br}}const CHANNELS=4,TEXTURE_WIDTH=1024,TEXTURE_HEIGHT=4;function initSplineTexture(rr=1){const er=new Uint16Array(TEXTURE_WIDTH*TEXTURE_HEIGHT*rr*CHANNELS),tr=new DataTexture(er,TEXTURE_WIDTH,TEXTURE_HEIGHT*rr,RGBAFormat,HalfFloatType);return tr.wrapS=RepeatWrapping,tr.wrapY=RepeatWrapping,tr.magFilter=LinearFilter,tr.minFilter=LinearFilter,tr.needsUpdate=!0,tr}function updateSplineTexture(rr,er,tr=0){const ir=Math.floor(TEXTURE_WIDTH*(TEXTURE_HEIGHT/4));er.arcLengthDivisions=ir/2,er.updateArcLengths();const nr=er.getSpacedPoints(ir),sr=er.computeFrenetFrames(ir,!0);for(let ar=0;ar<ir;ar++){const or=Math.floor(ar/TEXTURE_WIDTH),lr=ar%TEXTURE_WIDTH;let cr=nr[ar];setTextureValue(rr,lr,cr.x,cr.y,cr.z,0+or+TEXTURE_HEIGHT*tr),cr=sr.tangents[ar],setTextureValue(rr,lr,cr.x,cr.y,cr.z,1+or+TEXTURE_HEIGHT*tr),cr=sr.normals[ar],setTextureValue(rr,lr,cr.x,cr.y,cr.z,2+or+TEXTURE_HEIGHT*tr),cr=sr.binormals[ar],setTextureValue(rr,lr,cr.x,cr.y,cr.z,3+or+TEXTURE_HEIGHT*tr)}rr.needsUpdate=!0}function setTextureValue(rr,er,tr,ir,nr,sr){const ar=rr.image,{data:or}=ar,lr=CHANNELS*TEXTURE_WIDTH*sr;or[er*CHANNELS+lr+0]=DataUtils.toHalfFloat(tr),or[er*CHANNELS+lr+1]=DataUtils.toHalfFloat(ir),or[er*CHANNELS+lr+2]=DataUtils.toHalfFloat(nr),or[er*CHANNELS+lr+3]=DataUtils.toHalfFloat(1)}function getUniforms(rr){return{spineTexture:{value:rr},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}}}function modifyShader(rr,er,tr=1){rr.__ok||(rr.__ok=!0,rr.onBeforeCompile=ir=>{if(ir.__modified)return;ir.__modified=!0,Object.assign(ir.uniforms,er);const nr=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${TEXTURE_HEIGHT*tr}.;
		float textureStacks = ${TEXTURE_HEIGHT/4}.;

		${ir.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
void main() {
#include <beginnormal_vertex>

vec4 worldPos = modelMatrix * vec4(position, 1.);

bool bend = flow > 0;
float xWeight = bend ? 0. : 1.;

#ifdef USE_INSTANCING
float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
#else
float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
#endif

mt = mod(mt, textureStacks);
float rowOffset = floor(mt);

#ifdef USE_INSTANCING
rowOffset += instanceMatrix[3][1] * ${TEXTURE_HEIGHT}.;
#endif

vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
mat3 basis = mat3(a, b, c);

vec3 transformed = basis
	* vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
	+ spinePos;

vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);ir.vertexShader=nr})}class Flow{constructor(er,tr=1){const ir=er.clone(),nr=initSplineTexture(tr),sr=getUniforms(nr);ir.traverse(function(ar){if(ar instanceof Mesh||ar instanceof InstancedMesh)if(Array.isArray(ar.material)){const or=[];for(const lr of ar.material){const cr=lr.clone();modifyShader(cr,sr,tr),or.push(cr)}ar.material=or}else ar.material=ar.material.clone(),modifyShader(ar.material,sr,tr)}),this.curveArray=new Array(tr),this.curveLengthArray=new Array(tr),this.object3D=ir,this.splineTexure=nr,this.uniforms=sr}updateCurve(er,tr){if(er>=this.curveArray.length)throw Error("Index out of range for Flow");const ir=tr.getLength();this.uniforms.spineLength.value=ir,this.curveLengthArray[er]=ir,this.curveArray[er]=tr,updateSplineTexture(this.splineTexure,tr,er)}moveAlongCurve(er){this.uniforms.pathOffset.value+=er}}const matrix$1=new Matrix4;class InstancedFlow extends Flow{constructor(er,tr,ir,nr){const sr=new InstancedMesh(ir,nr,er);sr.instanceMatrix.setUsage(DynamicDrawUsage),sr.frustumCulled=!1,super(sr,tr),this.offsets=new Array(er).fill(0),this.whichCurve=new Array(er).fill(0)}writeChanges(er){matrix$1.makeTranslation(this.curveLengthArray[this.whichCurve[er]],this.whichCurve[er],this.offsets[er]),this.object3D.setMatrixAt(er,matrix$1),this.object3D.instanceMatrix.needsUpdate=!0}moveIndividualAlongCurve(er,tr){this.offsets[er]+=tr,this.writeChanges(er)}setCurve(er,tr){if(isNaN(tr))throw Error("curve index being set is Not a Number (NaN)");this.whichCurve[er]=tr,this.writeChanges(er)}}const _A=new Vector3$1,_B=new Vector3$1,_C=new Vector3$1;class EdgeSplitModifier{modify(er,tr,ir=!0){function nr(){hr=new Float32Array(ur.length*3);for(let fr=0;fr<ur.length;fr+=3){let _r=ur[fr];_A.set(dr[3*_r],dr[3*_r+1],dr[3*_r+2]),_r=ur[fr+1],_B.set(dr[3*_r],dr[3*_r+1],dr[3*_r+2]),_r=ur[fr+2],_C.set(dr[3*_r],dr[3*_r+1],dr[3*_r+2]),_C.sub(_B),_A.sub(_B);const Ar=_C.cross(_A).normalize();for(let yr=0;yr<3;yr++)hr[3*(fr+yr)]=Ar.x,hr[3*(fr+yr)+1]=Ar.y,hr[3*(fr+yr)+2]=Ar.z}}function sr(){pr=Array(dr.length/3);for(let fr=0;fr<ur.length;fr++){const _r=ur[fr];pr[_r]==null&&(pr[_r]=[]),pr[_r].push(fr)}}function ar(fr,_r,Ar){_A.set(hr[3*Ar],hr[3*Ar+1],hr[3*Ar+2]).normalize();const yr={splitGroup:[],currentGroup:[Ar]};for(const wr of fr)wr!==Ar&&(_B.set(hr[3*wr],hr[3*wr+1],hr[3*wr+2]).normalize(),_B.dot(_A)<_r?yr.splitGroup.push(wr):yr.currentGroup.push(wr));return yr}function or(fr,_r,Ar=null){if(fr.length===0)return;const yr=[];for(const xr of fr)yr.push(ar(fr,_r,xr));let wr=yr[0];for(const xr of yr)xr.currentGroup.length>wr.currentGroup.length&&(wr=xr);Ar!=null&&gr.push({original:Ar,indexes:wr.currentGroup}),wr.splitGroup.length&&or(wr.splitGroup,_r,Ar||wr.currentGroup[0])}let lr=!1,cr=null;er.attributes.normal&&(lr=!0,er=er.clone(),ir===!0&&er.index!==null&&(cr=er.attributes.normal.array),er.deleteAttribute("normal")),er.index==null&&(er=mergeVertices(er));const ur=er.index.array,dr=er.getAttribute("position").array;let hr,pr;nr(),sr();const gr=[];for(const fr of pr)or(fr,Math.cos(tr)-.001);const vr={};for(const fr of Object.keys(er.attributes)){const _r=er.attributes[fr],Ar=new _r.array.constructor((ur.length+gr.length)*_r.itemSize);Ar.set(_r.array),vr[fr]=new BufferAttribute(Ar,_r.itemSize,_r.normalized)}const mr=new Uint32Array(ur.length);mr.set(ur);for(let fr=0;fr<gr.length;fr++){const _r=gr[fr],Ar=ur[_r.original];for(const yr of Object.values(vr))for(let wr=0;wr<yr.itemSize;wr++)yr.array[(ur.length+fr)*yr.itemSize+wr]=yr.array[Ar*yr.itemSize+wr];for(const yr of _r.indexes)mr[yr]=ur.length+fr}er=new BufferGeometry,er.setIndex(new BufferAttribute(mr,1));for(const fr of Object.keys(vr))er.setAttribute(fr,vr[fr]);if(lr&&(er.computeVertexNormals(),cr!==null)){const fr=new Array(cr.length/3).fill(!1);for(const _r of gr)fr[_r.original]=!0;for(let _r=0;_r<fr.length;_r++)if(fr[_r]===!1)for(let Ar=0;Ar<3;Ar++)er.attributes.normal.array[3*_r+Ar]=cr[3*_r+Ar]}return er}}const _cb=new Vector3$1,_ab=new Vector3$1;class SimplifyModifier{modify(er,tr){er=er.clone(),delete er.morphAttributes.position,delete er.morphAttributes.normal;const ir=er.attributes;for(const br in ir)br!=="position"&&br!=="uv"&&br!=="normal"&&br!=="tangent"&&br!=="color"&&er.deleteAttribute(br);er=mergeVertices(er);const nr=[],sr=[],ar=er.getAttribute("position"),or=er.getAttribute("uv"),lr=er.getAttribute("normal"),cr=er.getAttribute("tangent"),ur=er.getAttribute("color");let dr=null,hr=null,pr=null,gr=null;for(let br=0;br<ar.count;br++){const Cr=new Vector3$1().fromBufferAttribute(ar,br);or&&(hr=new Vector2().fromBufferAttribute(or,br)),lr&&(pr=new Vector3$1().fromBufferAttribute(lr,br)),cr&&(dr=new Vector4().fromBufferAttribute(cr,br)),ur&&(gr=new Color().fromBufferAttribute(ur,br));const Ir=new Vertex(Cr,hr,pr,dr,gr);nr.push(Ir)}let vr=er.getIndex();if(vr!==null)for(let br=0;br<vr.count;br+=3){const Cr=vr.getX(br),Ir=vr.getX(br+1),Rr=vr.getX(br+2),Pr=new Triangle(nr[Cr],nr[Ir],nr[Rr],Cr,Ir,Rr);sr.push(Pr)}else for(let br=0;br<ar.count;br+=3){const Cr=br,Ir=br+1,Rr=br+2,Pr=new Triangle(nr[Cr],nr[Ir],nr[Rr],Cr,Ir,Rr);sr.push(Pr)}for(let br=0,Cr=nr.length;br<Cr;br++)computeEdgeCostAtVertex(nr[br]);let mr,fr=tr;for(;fr--;){if(mr=minimumCostEdge(nr),!mr){console.log("THREE.SimplifyModifier: No next vertex");break}collapse(nr,sr,mr,mr.collapseNeighbor)}const _r=new BufferGeometry,Ar=[],yr=[],wr=[],xr=[],Sr=[];vr=[];for(let br=0;br<nr.length;br++){const Cr=nr[br];Ar.push(Cr.position.x,Cr.position.y,Cr.position.z),Cr.uv&&yr.push(Cr.uv.x,Cr.uv.y),Cr.normal&&wr.push(Cr.normal.x,Cr.normal.y,Cr.normal.z),Cr.tangent&&xr.push(Cr.tangent.x,Cr.tangent.y,Cr.tangent.z,Cr.tangent.w),Cr.color&&Sr.push(Cr.color.r,Cr.color.g,Cr.color.b),Cr.id=br}for(let br=0;br<sr.length;br++){const Cr=sr[br];vr.push(Cr.v1.id,Cr.v2.id,Cr.v3.id)}return _r.setAttribute("position",new Float32BufferAttribute(Ar,3)),yr.length>0&&_r.setAttribute("uv",new Float32BufferAttribute(yr,2)),wr.length>0&&_r.setAttribute("normal",new Float32BufferAttribute(wr,3)),xr.length>0&&_r.setAttribute("tangent",new Float32BufferAttribute(xr,4)),Sr.length>0&&_r.setAttribute("color",new Float32BufferAttribute(Sr,3)),_r.setIndex(vr),_r}}function pushIfUnique(rr,er){rr.indexOf(er)===-1&&rr.push(er)}function removeFromArray(rr,er){const tr=rr.indexOf(er);tr>-1&&rr.splice(tr,1)}function computeEdgeCollapseCost(rr,er){const tr=er.position.distanceTo(rr.position);let ir=0;const nr=[];for(let or=0,lr=rr.faces.length;or<lr;or++){const cr=rr.faces[or];cr.hasVertex(er)&&nr.push(cr)}for(let or=0,lr=rr.faces.length;or<lr;or++){let cr=1;const ur=rr.faces[or];for(let dr=0;dr<nr.length;dr++){const hr=nr[dr],pr=ur.normal.dot(hr.normal);cr=Math.min(cr,(1.001-pr)/2)}ir=Math.max(ir,cr)}const sr=0;return nr.length<2&&(ir=1),tr*ir+sr}function computeEdgeCostAtVertex(rr){if(rr.neighbors.length===0){rr.collapseNeighbor=null,rr.collapseCost=-.01;return}rr.collapseCost=1e5,rr.collapseNeighbor=null;for(let er=0;er<rr.neighbors.length;er++){const tr=computeEdgeCollapseCost(rr,rr.neighbors[er]);rr.collapseNeighbor||(rr.collapseNeighbor=rr.neighbors[er],rr.collapseCost=tr,rr.minCost=tr,rr.totalCost=0,rr.costCount=0),rr.costCount++,rr.totalCost+=tr,tr<rr.minCost&&(rr.collapseNeighbor=rr.neighbors[er],rr.minCost=tr)}rr.collapseCost=rr.totalCost/rr.costCount}function removeVertex(rr,er){for(console.assert(rr.faces.length===0);rr.neighbors.length;){const tr=rr.neighbors.pop();removeFromArray(tr.neighbors,rr)}removeFromArray(er,rr)}function removeFace(rr,er){removeFromArray(er,rr),rr.v1&&removeFromArray(rr.v1.faces,rr),rr.v2&&removeFromArray(rr.v2.faces,rr),rr.v3&&removeFromArray(rr.v3.faces,rr);const tr=[rr.v1,rr.v2,rr.v3];for(let ir=0;ir<3;ir++){const nr=tr[ir],sr=tr[(ir+1)%3];!nr||!sr||(nr.removeIfNonNeighbor(sr),sr.removeIfNonNeighbor(nr))}}function collapse(rr,er,tr,ir){if(!ir){removeVertex(tr,rr);return}ir.uv&&tr.uv.copy(ir.uv),ir.normal&&ir.normal.add(tr.normal).normalize(),ir.tangent&&ir.tangent.add(tr.tangent).normalize();const nr=[];for(let sr=0;sr<tr.neighbors.length;sr++)nr.push(tr.neighbors[sr]);for(let sr=tr.faces.length-1;sr>=0;sr--)tr.faces[sr]&&tr.faces[sr].hasVertex(ir)&&removeFace(tr.faces[sr],er);for(let sr=tr.faces.length-1;sr>=0;sr--)tr.faces[sr].replaceVertex(tr,ir);removeVertex(tr,rr);for(let sr=0;sr<nr.length;sr++)computeEdgeCostAtVertex(nr[sr])}function minimumCostEdge(rr){let er=rr[0];for(let tr=0;tr<rr.length;tr++)rr[tr].collapseCost<er.collapseCost&&(er=rr[tr]);return er}class Triangle{constructor(er,tr,ir,nr,sr,ar){this.a=nr,this.b=sr,this.c=ar,this.v1=er,this.v2=tr,this.v3=ir,this.normal=new Vector3$1,this.computeNormal(),er.faces.push(this),er.addUniqueNeighbor(tr),er.addUniqueNeighbor(ir),tr.faces.push(this),tr.addUniqueNeighbor(er),tr.addUniqueNeighbor(ir),ir.faces.push(this),ir.addUniqueNeighbor(er),ir.addUniqueNeighbor(tr)}computeNormal(){const er=this.v1.position,tr=this.v2.position,ir=this.v3.position;_cb.subVectors(ir,tr),_ab.subVectors(er,tr),_cb.cross(_ab).normalize(),this.normal.copy(_cb)}hasVertex(er){return er===this.v1||er===this.v2||er===this.v3}replaceVertex(er,tr){er===this.v1?this.v1=tr:er===this.v2?this.v2=tr:er===this.v3&&(this.v3=tr),removeFromArray(er.faces,this),tr.faces.push(this),er.removeIfNonNeighbor(this.v1),this.v1.removeIfNonNeighbor(er),er.removeIfNonNeighbor(this.v2),this.v2.removeIfNonNeighbor(er),er.removeIfNonNeighbor(this.v3),this.v3.removeIfNonNeighbor(er),this.v1.addUniqueNeighbor(this.v2),this.v1.addUniqueNeighbor(this.v3),this.v2.addUniqueNeighbor(this.v1),this.v2.addUniqueNeighbor(this.v3),this.v3.addUniqueNeighbor(this.v1),this.v3.addUniqueNeighbor(this.v2),this.computeNormal()}}class Vertex{constructor(er,tr,ir,nr,sr){this.position=er,this.uv=tr,this.normal=ir,this.tangent=nr,this.color=sr,this.id=-1,this.faces=[],this.neighbors=[],this.collapseCost=0,this.collapseNeighbor=null}addUniqueNeighbor(er){pushIfUnique(this.neighbors,er)}removeIfNonNeighbor(er){const tr=this.neighbors,ir=this.faces,nr=tr.indexOf(er);if(nr!==-1){for(let sr=0;sr<ir.length;sr++)if(ir[sr].hasVertex(er))return;tr.splice(nr,1)}}}class TessellateModifier{constructor(er=.1,tr=6){this.maxEdgeLength=er,this.maxIterations=tr}modify(er){er.index!==null&&(er=er.toNonIndexed());const tr=this.maxIterations,ir=this.maxEdgeLength*this.maxEdgeLength,nr=new Vector3$1,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=[nr,sr,ar,or],cr=new Vector3$1,ur=new Vector3$1,dr=new Vector3$1,hr=new Vector3$1,pr=[cr,ur,dr,hr],gr=new Color,vr=new Color,mr=new Color,fr=new Color,_r=[gr,vr,mr,fr],Ar=new Vector2,yr=new Vector2,wr=new Vector2,xr=new Vector2,Sr=[Ar,yr,wr,xr],br=new Vector2,Cr=new Vector2,Ir=new Vector2,Rr=new Vector2,Pr=[br,Cr,Ir,Rr],Dr=er.attributes,Fr=Dr.normal!==void 0,Or=Dr.color!==void 0,Nr=Dr.uv!==void 0,Ur=Dr.uv1!==void 0;let Br=Dr.position.array,Wr=Fr?Dr.normal.array:null,Xr=Or?Dr.color.array:null,Yr=Nr?Dr.uv.array:null,Qi=Ur?Dr.uv1.array:null,Xi=Br,Kr=Wr,$r=Xr,Vr=Yr,Gr=Qi,qr=0,ji=!0;function Jr(Ki,Zi,Zr){const is=lr[Ki],os=lr[Zi],cs=lr[Zr];if(Xi.push(is.x,is.y,is.z),Xi.push(os.x,os.y,os.z),Xi.push(cs.x,cs.y,cs.z),Fr){const ss=pr[Ki],es=pr[Zi],ms=pr[Zr];Kr.push(ss.x,ss.y,ss.z),Kr.push(es.x,es.y,es.z),Kr.push(ms.x,ms.y,ms.z)}if(Or){const ss=_r[Ki],es=_r[Zi],ms=_r[Zr];$r.push(ss.r,ss.g,ss.b),$r.push(es.r,es.g,es.b),$r.push(ms.r,ms.g,ms.b)}if(Nr){const ss=Sr[Ki],es=Sr[Zi],ms=Sr[Zr];Vr.push(ss.x,ss.y),Vr.push(es.x,es.y),Vr.push(ms.x,ms.y)}if(Ur){const ss=Pr[Ki],es=Pr[Zi],ms=Pr[Zr];Gr.push(ss.x,ss.y),Gr.push(es.x,es.y),Gr.push(ms.x,ms.y)}}for(;ji&&qr<tr;){qr++,ji=!1,Br=Xi,Xi=[],Fr&&(Wr=Kr,Kr=[]),Or&&(Xr=$r,$r=[]),Nr&&(Yr=Vr,Vr=[]),Ur&&(Qi=Gr,Gr=[]);for(let Ki=0,Zi=0,Zr=Br.length;Ki<Zr;Ki+=9,Zi+=6){nr.fromArray(Br,Ki+0),sr.fromArray(Br,Ki+3),ar.fromArray(Br,Ki+6),Fr&&(cr.fromArray(Wr,Ki+0),ur.fromArray(Wr,Ki+3),dr.fromArray(Wr,Ki+6)),Or&&(gr.fromArray(Xr,Ki+0),vr.fromArray(Xr,Ki+3),mr.fromArray(Xr,Ki+6)),Nr&&(Ar.fromArray(Yr,Zi+0),yr.fromArray(Yr,Zi+2),wr.fromArray(Yr,Zi+4)),Ur&&(br.fromArray(Qi,Zi+0),Cr.fromArray(Qi,Zi+2),Ir.fromArray(Qi,Zi+4));const is=nr.distanceToSquared(sr),os=sr.distanceToSquared(ar),cs=nr.distanceToSquared(ar);is>ir||os>ir||cs>ir?(ji=!0,is>=os&&is>=cs?(or.lerpVectors(nr,sr,.5),Fr&&hr.lerpVectors(cr,ur,.5),Or&&fr.lerpColors(gr,vr,.5),Nr&&xr.lerpVectors(Ar,yr,.5),Ur&&Rr.lerpVectors(br,Cr,.5),Jr(0,3,2),Jr(3,1,2)):os>=is&&os>=cs?(or.lerpVectors(sr,ar,.5),Fr&&hr.lerpVectors(ur,dr,.5),Or&&fr.lerpColors(vr,mr,.5),Nr&&xr.lerpVectors(yr,wr,.5),Ur&&Rr.lerpVectors(Cr,Ir,.5),Jr(0,1,3),Jr(3,2,0)):(or.lerpVectors(nr,ar,.5),Fr&&hr.lerpVectors(cr,dr,.5),Or&&fr.lerpColors(gr,mr,.5),Nr&&xr.lerpVectors(Ar,wr,.5),Ur&&Rr.lerpVectors(br,Ir,.5),Jr(0,1,3),Jr(3,1,2))):Jr(0,1,2)}}const Ji=new BufferGeometry;return Ji.setAttribute("position",new Float32BufferAttribute(Xi,3)),Fr&&Ji.setAttribute("normal",new Float32BufferAttribute(Kr,3)),Or&&Ji.setAttribute("color",new Float32BufferAttribute($r,3)),Nr&&Ji.setAttribute("uv",new Float32BufferAttribute(Vr,2)),Ur&&Ji.setAttribute("uv1",new Float32BufferAttribute(Gr,2)),Ji}}class GroundedSkybox extends Mesh{constructor(er,tr,ir,nr=128){if(tr<=0||ir<=0||nr<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const sr=new SphereGeometry(ir,2*nr,nr);sr.scale(1,1,-1);const ar=sr.getAttribute("position"),or=new Vector3$1;for(let lr=0;lr<ar.count;++lr)if(or.fromBufferAttribute(ar,lr),or.y<0){const cr=-tr*3/2,ur=or.y<cr?-tr/or.y:1-or.y*or.y/(3*cr*cr);or.multiplyScalar(ur),or.toArray(ar.array,3*lr)}ar.needsUpdate=!0,super(sr,new MeshBasicMaterial({map:er,depthWrite:!1}))}}class Lensflare extends Mesh{constructor(){super(Lensflare.Geometry,new MeshBasicMaterial({opacity:0,transparent:!0})),this.isLensflare=!0,this.type="Lensflare",this.frustumCulled=!1,this.renderOrder=1/0;const er=new Vector3$1,tr=new Vector3$1,ir=new FramebufferTexture(16,16),nr=new FramebufferTexture(16,16);let sr=UnsignedByteType;const ar=Lensflare.Geometry,or=new RawShaderMaterial({uniforms:{scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;

				void main() {

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				void main() {

					gl_FragColor = vec4( 1.0, 0.0, 1.0, 1.0 );

				}`,depthTest:!0,depthWrite:!1,transparent:!1}),lr=new RawShaderMaterial({uniforms:{map:{value:ir},scale:{value:null},screenPosition:{value:null}},vertexShader:`

				precision highp float;

				uniform vec3 screenPosition;
				uniform vec2 scale;

				attribute vec3 position;
				attribute vec2 uv;

				varying vec2 vUV;

				void main() {

					vUV = uv;

					gl_Position = vec4( position.xy * scale + screenPosition.xy, screenPosition.z, 1.0 );

				}`,fragmentShader:`

				precision highp float;

				uniform sampler2D map;

				varying vec2 vUV;

				void main() {

					gl_FragColor = texture2D( map, vUV );

				}`,depthTest:!1,depthWrite:!1,transparent:!1}),cr=new Mesh(ar,or),ur=[],dr=LensflareElement.Shader,hr=new RawShaderMaterial({name:dr.name,uniforms:{map:{value:null},occlusionMap:{value:nr},color:{value:new Color(16777215)},scale:{value:new Vector2},screenPosition:{value:new Vector3$1}},vertexShader:dr.vertexShader,fragmentShader:dr.fragmentShader,blending:AdditiveBlending,transparent:!0,depthWrite:!1}),pr=new Mesh(ar,hr);this.addElement=function(_r){ur.push(_r)};const gr=new Vector2,vr=new Vector2,mr=new Box2,fr=new Vector4;this.onBeforeRender=function(_r,Ar,yr){_r.getCurrentViewport(fr);const wr=_r.getRenderTarget(),xr=wr!==null?wr.texture.type:UnsignedByteType;sr!==xr&&(ir.dispose(),nr.dispose(),ir.type=nr.type=xr,sr=xr);const Sr=fr.w/fr.z,br=fr.z/2,Cr=fr.w/2;let Ir=16/fr.w;if(gr.set(Ir*Sr,Ir),mr.min.set(fr.x,fr.y),mr.max.set(fr.x+(fr.z-16),fr.y+(fr.w-16)),tr.setFromMatrixPosition(this.matrixWorld),tr.applyMatrix4(yr.matrixWorldInverse),!(tr.z>0)&&(er.copy(tr).applyMatrix4(yr.projectionMatrix),vr.x=fr.x+er.x*br+br-8,vr.y=fr.y+er.y*Cr+Cr-8,mr.containsPoint(vr))){_r.copyFramebufferToTexture(ir,vr);let Rr=or.uniforms;Rr.scale.value=gr,Rr.screenPosition.value=er,_r.renderBufferDirect(yr,null,ar,or,cr,null),_r.copyFramebufferToTexture(nr,vr),Rr=lr.uniforms,Rr.scale.value=gr,Rr.screenPosition.value=er,_r.renderBufferDirect(yr,null,ar,lr,cr,null);const Pr=-er.x*2,Dr=-er.y*2;for(let Fr=0,Or=ur.length;Fr<Or;Fr++){const Nr=ur[Fr],Ur=hr.uniforms;Ur.color.value.copy(Nr.color),Ur.map.value=Nr.texture,Ur.screenPosition.value.x=er.x+Pr*Nr.distance,Ur.screenPosition.value.y=er.y+Dr*Nr.distance,Ir=Nr.size/fr.w;const Br=fr.w/fr.z;Ur.scale.value.set(Ir*Br,Ir),hr.uniformsNeedUpdate=!0,_r.renderBufferDirect(yr,null,ar,hr,pr,null)}}},this.dispose=function(){or.dispose(),lr.dispose(),hr.dispose(),ir.dispose(),nr.dispose();for(let _r=0,Ar=ur.length;_r<Ar;_r++)ur[_r].texture.dispose()}}}class LensflareElement{constructor(er,tr=1,ir=0,nr=new Color(16777215)){this.texture=er,this.size=tr,this.distance=ir,this.color=nr}}LensflareElement.Shader={name:"LensflareElementShader",uniforms:{map:{value:null},occlusionMap:{value:null},color:{value:null},scale:{value:null},screenPosition:{value:null}},vertexShader:`

		precision highp float;

		uniform vec3 screenPosition;
		uniform vec2 scale;

		uniform sampler2D occlusionMap;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vUV = uv;

			vec2 pos = position.xy;

			vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );
			visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );
			visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );

			vVisibility =        visibility.r / 9.0;
			vVisibility *= 1.0 - visibility.g / 9.0;
			vVisibility *=       visibility.b / 9.0;

			gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );

		}`,fragmentShader:`

		precision highp float;

		uniform sampler2D map;
		uniform vec3 color;

		varying vec2 vUV;
		varying float vVisibility;

		void main() {

			vec4 texture = texture2D( map, vUV );
			texture.a *= vVisibility;
			gl_FragColor = texture;
			gl_FragColor.rgb *= color;

		}`};Lensflare.Geometry=function(){const rr=new BufferGeometry,er=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,1,1,0,1,1,-1,1,0,0,1]),tr=new InterleavedBuffer(er,5);return rr.setIndex([0,1,2,0,2,3]),rr.setAttribute("position",new InterleavedBufferAttribute(tr,3,0,!1)),rr.setAttribute("uv",new InterleavedBufferAttribute(tr,2,3,!1)),rr}();class MarchingCubes extends Mesh{constructor(er,tr,ir=!1,nr=!1,sr=1e4){const ar=new BufferGeometry;super(ar,tr),this.isMarchingCubes=!0;const or=this,lr=new Float32Array(12*3),cr=new Float32Array(12*3),ur=new Float32Array(12*3);this.enableUvs=ir,this.enableColors=nr,this.init=function(_r){this.resolution=_r,this.isolation=80,this.size=_r,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(this.size3*3),this.palette=new Float32Array(this.size3*3),this.count=0;const Ar=sr*3;this.positionArray=new Float32Array(Ar*3);const yr=new BufferAttribute(this.positionArray,3);yr.setUsage(DynamicDrawUsage),ar.setAttribute("position",yr),this.normalArray=new Float32Array(Ar*3);const wr=new BufferAttribute(this.normalArray,3);if(wr.setUsage(DynamicDrawUsage),ar.setAttribute("normal",wr),this.enableUvs){this.uvArray=new Float32Array(Ar*2);const xr=new BufferAttribute(this.uvArray,2);xr.setUsage(DynamicDrawUsage),ar.setAttribute("uv",xr)}if(this.enableColors){this.colorArray=new Float32Array(Ar*3);const xr=new BufferAttribute(this.colorArray,3);xr.setUsage(DynamicDrawUsage),ar.setAttribute("color",xr)}ar.boundingSphere=new Sphere(new Vector3$1,1)};function dr(_r,Ar,yr){return _r+(Ar-_r)*yr}function hr(_r,Ar,yr,wr,xr,Sr,br,Cr,Ir,Rr){const Pr=(yr-br)/(Cr-br),Dr=or.normal_cache;lr[Ar+0]=wr+Pr*or.delta,lr[Ar+1]=xr,lr[Ar+2]=Sr,cr[Ar+0]=dr(Dr[_r+0],Dr[_r+3],Pr),cr[Ar+1]=dr(Dr[_r+1],Dr[_r+4],Pr),cr[Ar+2]=dr(Dr[_r+2],Dr[_r+5],Pr),ur[Ar+0]=dr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),ur[Ar+1]=dr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),ur[Ar+2]=dr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function pr(_r,Ar,yr,wr,xr,Sr,br,Cr,Ir,Rr){const Pr=(yr-br)/(Cr-br),Dr=or.normal_cache;lr[Ar+0]=wr,lr[Ar+1]=xr+Pr*or.delta,lr[Ar+2]=Sr;const Fr=_r+or.yd*3;cr[Ar+0]=dr(Dr[_r+0],Dr[Fr+0],Pr),cr[Ar+1]=dr(Dr[_r+1],Dr[Fr+1],Pr),cr[Ar+2]=dr(Dr[_r+2],Dr[Fr+2],Pr),ur[Ar+0]=dr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),ur[Ar+1]=dr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),ur[Ar+2]=dr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function gr(_r,Ar,yr,wr,xr,Sr,br,Cr,Ir,Rr){const Pr=(yr-br)/(Cr-br),Dr=or.normal_cache;lr[Ar+0]=wr,lr[Ar+1]=xr,lr[Ar+2]=Sr+Pr*or.delta;const Fr=_r+or.zd*3;cr[Ar+0]=dr(Dr[_r+0],Dr[Fr+0],Pr),cr[Ar+1]=dr(Dr[_r+1],Dr[Fr+1],Pr),cr[Ar+2]=dr(Dr[_r+2],Dr[Fr+2],Pr),ur[Ar+0]=dr(or.palette[Ir*3+0],or.palette[Rr*3+0],Pr),ur[Ar+1]=dr(or.palette[Ir*3+1],or.palette[Rr*3+1],Pr),ur[Ar+2]=dr(or.palette[Ir*3+2],or.palette[Rr*3+2],Pr)}function vr(_r){const Ar=_r*3;or.normal_cache[Ar]===0&&(or.normal_cache[Ar+0]=or.field[_r-1]-or.field[_r+1],or.normal_cache[Ar+1]=or.field[_r-or.yd]-or.field[_r+or.yd],or.normal_cache[Ar+2]=or.field[_r-or.zd]-or.field[_r+or.zd])}function mr(_r,Ar,yr,wr,xr){const Sr=wr+1,br=wr+or.yd,Cr=wr+or.zd,Ir=Sr+or.yd,Rr=Sr+or.zd,Pr=wr+or.yd+or.zd,Dr=Sr+or.yd+or.zd;let Fr=0;const Or=or.field[wr],Nr=or.field[Sr],Ur=or.field[br],Br=or.field[Ir],Wr=or.field[Cr],Xr=or.field[Rr],Yr=or.field[Pr],Qi=or.field[Dr];Or<xr&&(Fr|=1),Nr<xr&&(Fr|=2),Ur<xr&&(Fr|=8),Br<xr&&(Fr|=4),Wr<xr&&(Fr|=16),Xr<xr&&(Fr|=32),Yr<xr&&(Fr|=128),Qi<xr&&(Fr|=64);const Xi=edgeTable[Fr];if(Xi===0)return 0;const Kr=or.delta,$r=_r+Kr,Vr=Ar+Kr,Gr=yr+Kr;Xi&1&&(vr(wr),vr(Sr),hr(wr*3,0,xr,_r,Ar,yr,Or,Nr,wr,Sr)),Xi&2&&(vr(Sr),vr(Ir),pr(Sr*3,3,xr,$r,Ar,yr,Nr,Br,Sr,Ir)),Xi&4&&(vr(br),vr(Ir),hr(br*3,6,xr,_r,Vr,yr,Ur,Br,br,Ir)),Xi&8&&(vr(wr),vr(br),pr(wr*3,9,xr,_r,Ar,yr,Or,Ur,wr,br)),Xi&16&&(vr(Cr),vr(Rr),hr(Cr*3,12,xr,_r,Ar,Gr,Wr,Xr,Cr,Rr)),Xi&32&&(vr(Rr),vr(Dr),pr(Rr*3,15,xr,$r,Ar,Gr,Xr,Qi,Rr,Dr)),Xi&64&&(vr(Pr),vr(Dr),hr(Pr*3,18,xr,_r,Vr,Gr,Yr,Qi,Pr,Dr)),Xi&128&&(vr(Cr),vr(Pr),pr(Cr*3,21,xr,_r,Ar,Gr,Wr,Yr,Cr,Pr)),Xi&256&&(vr(wr),vr(Cr),gr(wr*3,24,xr,_r,Ar,yr,Or,Wr,wr,Cr)),Xi&512&&(vr(Sr),vr(Rr),gr(Sr*3,27,xr,$r,Ar,yr,Nr,Xr,Sr,Rr)),Xi&1024&&(vr(Ir),vr(Dr),gr(Ir*3,30,xr,$r,Vr,yr,Br,Qi,Ir,Dr)),Xi&2048&&(vr(br),vr(Pr),gr(br*3,33,xr,_r,Vr,yr,Ur,Yr,br,Pr)),Fr<<=4;let qr,ji,Jr,Ji=0,Ki=0;for(;triTable[Fr+Ki]!=-1;)qr=Fr+Ki,ji=qr+1,Jr=qr+2,fr(lr,cr,ur,3*triTable[qr],3*triTable[ji],3*triTable[Jr]),Ki+=3,Ji++;return Ji}function fr(_r,Ar,yr,wr,xr,Sr){const br=or.count*3;if(or.positionArray[br+0]=_r[wr],or.positionArray[br+1]=_r[wr+1],or.positionArray[br+2]=_r[wr+2],or.positionArray[br+3]=_r[xr],or.positionArray[br+4]=_r[xr+1],or.positionArray[br+5]=_r[xr+2],or.positionArray[br+6]=_r[Sr],or.positionArray[br+7]=_r[Sr+1],or.positionArray[br+8]=_r[Sr+2],or.material.flatShading===!0){const Cr=(Ar[wr+0]+Ar[xr+0]+Ar[Sr+0])/3,Ir=(Ar[wr+1]+Ar[xr+1]+Ar[Sr+1])/3,Rr=(Ar[wr+2]+Ar[xr+2]+Ar[Sr+2])/3;or.normalArray[br+0]=Cr,or.normalArray[br+1]=Ir,or.normalArray[br+2]=Rr,or.normalArray[br+3]=Cr,or.normalArray[br+4]=Ir,or.normalArray[br+5]=Rr,or.normalArray[br+6]=Cr,or.normalArray[br+7]=Ir,or.normalArray[br+8]=Rr}else or.normalArray[br+0]=Ar[wr+0],or.normalArray[br+1]=Ar[wr+1],or.normalArray[br+2]=Ar[wr+2],or.normalArray[br+3]=Ar[xr+0],or.normalArray[br+4]=Ar[xr+1],or.normalArray[br+5]=Ar[xr+2],or.normalArray[br+6]=Ar[Sr+0],or.normalArray[br+7]=Ar[Sr+1],or.normalArray[br+8]=Ar[Sr+2];if(or.enableUvs){const Cr=or.count*2;or.uvArray[Cr+0]=_r[wr+0],or.uvArray[Cr+1]=_r[wr+2],or.uvArray[Cr+2]=_r[xr+0],or.uvArray[Cr+3]=_r[xr+2],or.uvArray[Cr+4]=_r[Sr+0],or.uvArray[Cr+5]=_r[Sr+2]}or.enableColors&&(or.colorArray[br+0]=yr[wr+0],or.colorArray[br+1]=yr[wr+1],or.colorArray[br+2]=yr[wr+2],or.colorArray[br+3]=yr[xr+0],or.colorArray[br+4]=yr[xr+1],or.colorArray[br+5]=yr[xr+2],or.colorArray[br+6]=yr[Sr+0],or.colorArray[br+7]=yr[Sr+1],or.colorArray[br+8]=yr[Sr+2]),or.count+=3}this.addBall=function(_r,Ar,yr,wr,xr,Sr){const br=Math.sign(wr);wr=Math.abs(wr);const Cr=Sr!=null;let Ir=new Color(_r,Ar,yr);if(Cr)try{Ir=Sr instanceof Color?Sr:Array.isArray(Sr)?new Color(Math.min(Math.abs(Sr[0]),1),Math.min(Math.abs(Sr[1]),1),Math.min(Math.abs(Sr[2]),1)):new Color(Sr)}catch{Ir=new Color(_r,Ar,yr)}const Rr=this.size*Math.sqrt(wr/xr),Pr=yr*this.size,Dr=Ar*this.size,Fr=_r*this.size;let Or=Math.floor(Pr-Rr);Or<1&&(Or=1);let Nr=Math.floor(Pr+Rr);Nr>this.size-1&&(Nr=this.size-1);let Ur=Math.floor(Dr-Rr);Ur<1&&(Ur=1);let Br=Math.floor(Dr+Rr);Br>this.size-1&&(Br=this.size-1);let Wr=Math.floor(Fr-Rr);Wr<1&&(Wr=1);let Xr=Math.floor(Fr+Rr);Xr>this.size-1&&(Xr=this.size-1);let Yr,Qi,Xi,Kr,$r,Vr,Gr,qr,ji,Jr,Ji;for(Xi=Or;Xi<Nr;Xi++)for($r=this.size2*Xi,qr=Xi/this.size-yr,ji=qr*qr,Qi=Ur;Qi<Br;Qi++)for(Kr=$r+this.size*Qi,Gr=Qi/this.size-Ar,Jr=Gr*Gr,Yr=Wr;Yr<Xr;Yr++)if(Vr=Yr/this.size-_r,Ji=wr/(1e-6+Vr*Vr+Jr+ji)-xr,Ji>0){this.field[Kr+Yr]+=Ji*br;const Ki=Math.sqrt((Yr-Fr)*(Yr-Fr)+(Qi-Dr)*(Qi-Dr)+(Xi-Pr)*(Xi-Pr))/Rr,Zi=1-Ki*Ki*Ki*(Ki*(Ki*6-15)+10);this.palette[(Kr+Yr)*3+0]+=Ir.r*Zi,this.palette[(Kr+Yr)*3+1]+=Ir.g*Zi,this.palette[(Kr+Yr)*3+2]+=Ir.b*Zi}},this.addPlaneX=function(_r,Ar){const yr=this.size,wr=this.yd,xr=this.zd,Sr=this.field;let br,Cr,Ir,Rr,Pr,Dr,Fr,Or=yr*Math.sqrt(_r/Ar);for(Or>yr&&(Or=yr),br=0;br<Or;br++)if(Dr=br/yr,Rr=Dr*Dr,Pr=_r/(1e-4+Rr)-Ar,Pr>0)for(Cr=0;Cr<yr;Cr++)for(Fr=br+Cr*wr,Ir=0;Ir<yr;Ir++)Sr[xr*Ir+Fr]+=Pr},this.addPlaneY=function(_r,Ar){const yr=this.size,wr=this.yd,xr=this.zd,Sr=this.field;let br,Cr,Ir,Rr,Pr,Dr,Fr,Or,Nr=yr*Math.sqrt(_r/Ar);for(Nr>yr&&(Nr=yr),Cr=0;Cr<Nr;Cr++)if(Dr=Cr/yr,Rr=Dr*Dr,Pr=_r/(1e-4+Rr)-Ar,Pr>0)for(Fr=Cr*wr,br=0;br<yr;br++)for(Or=Fr+br,Ir=0;Ir<yr;Ir++)Sr[xr*Ir+Or]+=Pr},this.addPlaneZ=function(_r,Ar){const yr=this.size,wr=this.yd,xr=this.zd,Sr=this.field;let br,Cr,Ir,Rr,Pr,Dr,Fr,Or,Nr=yr*Math.sqrt(_r/Ar);for(Nr>yr&&(Nr=yr),Ir=0;Ir<Nr;Ir++)if(Dr=Ir/yr,Rr=Dr*Dr,Pr=_r/(1e-4+Rr)-Ar,Pr>0)for(Fr=xr*Ir,Cr=0;Cr<yr;Cr++)for(Or=Fr+Cr*wr,br=0;br<yr;br++)Sr[Or+br]+=Pr},this.setCell=function(_r,Ar,yr,wr){const xr=this.size2*yr+this.size*Ar+_r;this.field[xr]=wr},this.getCell=function(_r,Ar,yr){const wr=this.size2*yr+this.size*Ar+_r;return this.field[wr]},this.blur=function(_r=1){const Ar=this.field,yr=Ar.slice(),wr=this.size,xr=this.size2;for(let Sr=0;Sr<wr;Sr++)for(let br=0;br<wr;br++)for(let Cr=0;Cr<wr;Cr++){const Ir=xr*Cr+wr*br+Sr;let Rr=yr[Ir],Pr=1;for(let Dr=-1;Dr<=1;Dr+=2){const Fr=Dr+Sr;if(!(Fr<0||Fr>=wr))for(let Or=-1;Or<=1;Or+=2){const Nr=Or+br;if(!(Nr<0||Nr>=wr))for(let Ur=-1;Ur<=1;Ur+=2){const Br=Ur+Cr;if(Br<0||Br>=wr)continue;const Wr=xr*Br+wr*Nr+Fr,Xr=yr[Wr];Pr++,Rr+=_r*(Xr-Rr)/Pr}}}Ar[Ir]=Rr}},this.reset=function(){for(let _r=0;_r<this.size3;_r++)this.normal_cache[_r*3]=0,this.field[_r]=0,this.palette[_r*3]=this.palette[_r*3+1]=this.palette[_r*3+2]=0},this.update=function(){this.count=0;const _r=this.size-2;for(let Ar=1;Ar<_r;Ar++){const yr=this.size2*Ar,wr=(Ar-this.halfsize)/this.halfsize;for(let xr=1;xr<_r;xr++){const Sr=yr+this.size*xr,br=(xr-this.halfsize)/this.halfsize;for(let Cr=1;Cr<_r;Cr++){const Ir=(Cr-this.halfsize)/this.halfsize,Rr=Sr+Cr;mr(Ir,br,wr,Rr,this.isolation)}}}this.geometry.setDrawRange(0,this.count),ar.getAttribute("position").needsUpdate=!0,ar.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(ar.getAttribute("uv").needsUpdate=!0),this.enableColors&&(ar.getAttribute("color").needsUpdate=!0),this.count/3>sr&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(er)}}const edgeTable=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triTable=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]);class Reflector extends Mesh{constructor(er,tr={}){super(er),this.isReflector=!0,this.type="Reflector",this.camera=new PerspectiveCamera;const ir=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||Reflector.ReflectorShader,cr=tr.multisample!==void 0?tr.multisample:4,ur=new Plane,dr=new Vector3$1,hr=new Vector3$1,pr=new Vector3$1,gr=new Matrix4,vr=new Vector3$1(0,0,-1),mr=new Vector4,fr=new Vector3$1,_r=new Vector3$1,Ar=new Vector4,yr=new Matrix4,wr=this.camera,xr=new WebGLRenderTarget(sr,ar,{samples:cr,type:HalfFloatType}),Sr=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",uniforms:UniformsUtils.clone(lr.uniforms),fragmentShader:lr.fragmentShader,vertexShader:lr.vertexShader});Sr.uniforms.tDiffuse.value=xr.texture,Sr.uniforms.color.value=nr,Sr.uniforms.textureMatrix.value=yr,this.material=Sr,this.onBeforeRender=function(br,Cr,Ir){if(hr.setFromMatrixPosition(ir.matrixWorld),pr.setFromMatrixPosition(Ir.matrixWorld),gr.extractRotation(ir.matrixWorld),dr.set(0,0,1),dr.applyMatrix4(gr),fr.subVectors(hr,pr),fr.dot(dr)>0)return;fr.reflect(dr).negate(),fr.add(hr),gr.extractRotation(Ir.matrixWorld),vr.set(0,0,-1),vr.applyMatrix4(gr),vr.add(pr),_r.subVectors(hr,vr),_r.reflect(dr).negate(),_r.add(hr),wr.position.copy(fr),wr.up.set(0,1,0),wr.up.applyMatrix4(gr),wr.up.reflect(dr),wr.lookAt(_r),wr.far=Ir.far,wr.updateMatrixWorld(),wr.projectionMatrix.copy(Ir.projectionMatrix),yr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),yr.multiply(wr.projectionMatrix),yr.multiply(wr.matrixWorldInverse),yr.multiply(ir.matrixWorld),ur.setFromNormalAndCoplanarPoint(dr,hr),ur.applyMatrix4(wr.matrixWorldInverse),mr.set(ur.normal.x,ur.normal.y,ur.normal.z,ur.constant);const Rr=wr.projectionMatrix;Ar.x=(Math.sign(mr.x)+Rr.elements[8])/Rr.elements[0],Ar.y=(Math.sign(mr.y)+Rr.elements[9])/Rr.elements[5],Ar.z=-1,Ar.w=(1+Rr.elements[10])/Rr.elements[14],mr.multiplyScalar(2/mr.dot(Ar)),Rr.elements[2]=mr.x,Rr.elements[6]=mr.y,Rr.elements[10]=mr.z+1-or,Rr.elements[14]=mr.w,ir.visible=!1;const Pr=br.getRenderTarget(),Dr=br.xr.enabled,Fr=br.shadowMap.autoUpdate;br.xr.enabled=!1,br.shadowMap.autoUpdate=!1,br.setRenderTarget(xr),br.state.buffers.depth.setMask(!0),br.autoClear===!1&&br.clear(),br.render(Cr,wr),br.xr.enabled=Dr,br.shadowMap.autoUpdate=Fr,br.setRenderTarget(Pr);const Or=Ir.viewport;Or!==void 0&&br.state.viewport(Or),ir.visible=!0},this.getRenderTarget=function(){return xr},this.dispose=function(){xr.dispose(),ir.material.dispose()}}}Reflector.ReflectorShader={name:"ReflectorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		#include <common>
		#include <logdepthbuf_pars_vertex>

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

			#include <logdepthbuf_vertex>

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		varying vec4 vUv;

		#include <logdepthbuf_pars_fragment>

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			#include <logdepthbuf_fragment>

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class ReflectorForSSRPass extends Mesh{constructor(er,tr={}){super(er),this.isReflectorForSSRPass=!0,this.type="ReflectorForSSRPass";const ir=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||ReflectorForSSRPass.ReflectorShader,cr=tr.useDepthTexture===!0,ur=new Vector3$1(0,1,0),dr=new Vector3$1,hr=new Vector3$1;ir.needsUpdate=!1,ir.maxDistance=ReflectorForSSRPass.ReflectorShader.uniforms.maxDistance.value,ir.opacity=ReflectorForSSRPass.ReflectorShader.uniforms.opacity.value,ir.color=nr,ir.resolution=tr.resolution||new Vector2(window.innerWidth,window.innerHeight),ir._distanceAttenuation=ReflectorForSSRPass.ReflectorShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(ir,"distanceAttenuation",{get(){return ir._distanceAttenuation},set(Pr){ir._distanceAttenuation!==Pr&&(ir._distanceAttenuation=Pr,ir.material.defines.DISTANCE_ATTENUATION=Pr,ir.material.needsUpdate=!0)}}),ir._fresnel=ReflectorForSSRPass.ReflectorShader.defines.FRESNEL,Object.defineProperty(ir,"fresnel",{get(){return ir._fresnel},set(Pr){ir._fresnel!==Pr&&(ir._fresnel=Pr,ir.material.defines.FRESNEL=Pr,ir.material.needsUpdate=!0)}});const pr=new Vector3$1,gr=new Vector3$1,vr=new Vector3$1,mr=new Matrix4,fr=new Vector3$1(0,0,-1),_r=new Vector3$1,Ar=new Vector3$1,yr=new Matrix4,wr=new PerspectiveCamera;let xr;cr&&(xr=new DepthTexture,xr.type=UnsignedShortType,xr.minFilter=NearestFilter,xr.magFilter=NearestFilter);const Sr={depthTexture:cr?xr:null,type:HalfFloatType},br=new WebGLRenderTarget(sr,ar,Sr),Cr=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",transparent:cr,defines:Object.assign({},ReflectorForSSRPass.ReflectorShader.defines,{useDepthTexture:cr}),uniforms:UniformsUtils.clone(lr.uniforms),fragmentShader:lr.fragmentShader,vertexShader:lr.vertexShader});Cr.uniforms.tDiffuse.value=br.texture,Cr.uniforms.color.value=ir.color,Cr.uniforms.textureMatrix.value=yr,cr&&(Cr.uniforms.tDepth.value=br.depthTexture),this.material=Cr;const Rr=[new Plane(new Vector3$1(0,1,0),or)];this.doRender=function(Pr,Dr,Fr){if(Cr.uniforms.maxDistance.value=ir.maxDistance,Cr.uniforms.color.value=ir.color,Cr.uniforms.opacity.value=ir.opacity,dr.copy(Fr.position).normalize(),hr.copy(dr).reflect(ur),Cr.uniforms.fresnelCoe.value=(dr.dot(hr)+1)/2,gr.setFromMatrixPosition(ir.matrixWorld),vr.setFromMatrixPosition(Fr.matrixWorld),mr.extractRotation(ir.matrixWorld),pr.set(0,0,1),pr.applyMatrix4(mr),_r.subVectors(gr,vr),_r.dot(pr)>0)return;_r.reflect(pr).negate(),_r.add(gr),mr.extractRotation(Fr.matrixWorld),fr.set(0,0,-1),fr.applyMatrix4(mr),fr.add(vr),Ar.subVectors(gr,fr),Ar.reflect(pr).negate(),Ar.add(gr),wr.position.copy(_r),wr.up.set(0,1,0),wr.up.applyMatrix4(mr),wr.up.reflect(pr),wr.lookAt(Ar),wr.far=Fr.far,wr.updateMatrixWorld(),wr.projectionMatrix.copy(Fr.projectionMatrix),Cr.uniforms.virtualCameraNear.value=Fr.near,Cr.uniforms.virtualCameraFar.value=Fr.far,Cr.uniforms.virtualCameraMatrixWorld.value=wr.matrixWorld,Cr.uniforms.virtualCameraProjectionMatrix.value=Fr.projectionMatrix,Cr.uniforms.virtualCameraProjectionMatrixInverse.value=Fr.projectionMatrixInverse,Cr.uniforms.resolution.value=ir.resolution,yr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),yr.multiply(wr.projectionMatrix),yr.multiply(wr.matrixWorldInverse),yr.multiply(ir.matrixWorld);const Or=Pr.getRenderTarget(),Nr=Pr.xr.enabled,Ur=Pr.shadowMap.autoUpdate,Br=Pr.clippingPlanes;Pr.xr.enabled=!1,Pr.shadowMap.autoUpdate=!1,Pr.clippingPlanes=Rr,Pr.setRenderTarget(br),Pr.state.buffers.depth.setMask(!0),Pr.autoClear===!1&&Pr.clear(),Pr.render(Dr,wr),Pr.xr.enabled=Nr,Pr.shadowMap.autoUpdate=Ur,Pr.clippingPlanes=Br,Pr.setRenderTarget(Or);const Wr=Fr.viewport;Wr!==void 0&&Pr.state.viewport(Wr)},this.getRenderTarget=function(){return br}}}ReflectorForSSRPass.ReflectorShader={name:"ReflectorShader",defines:{DISTANCE_ATTENUATION:!0,FRESNEL:!0},uniforms:{color:{value:null},tDiffuse:{value:null},tDepth:{value:null},textureMatrix:{value:new Matrix4},maxDistance:{value:180},opacity:{value:.5},fresnelCoe:{value:null},virtualCameraNear:{value:null},virtualCameraFar:{value:null},virtualCameraProjectionMatrix:{value:new Matrix4},virtualCameraMatrixWorld:{value:new Matrix4},virtualCameraProjectionMatrixInverse:{value:new Matrix4},resolution:{value:new Vector2}},vertexShader:`
		uniform mat4 textureMatrix;
		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform vec3 color;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;
		uniform float maxDistance;
		uniform float opacity;
		uniform float fresnelCoe;
		uniform float virtualCameraNear;
		uniform float virtualCameraFar;
		uniform mat4 virtualCameraProjectionMatrix;
		uniform mat4 virtualCameraProjectionMatrixInverse;
		uniform mat4 virtualCameraMatrixWorld;
		uniform vec2 resolution;
		varying vec4 vUv;
		#include <packing>
		float blendOverlay( float base, float blend ) {
			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );
		}
		vec3 blendOverlay( vec3 base, vec3 blend ) {
			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			return perspectiveDepthToViewZ( depth, virtualCameraNear, virtualCameraFar );
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( virtualCameraProjectionMatrixInverse * clipPosition ).xyz;//view
		}
		void main() {
			vec4 base = texture2DProj( tDiffuse, vUv );
			#ifdef useDepthTexture
				vec2 uv=(gl_FragCoord.xy-.5)/resolution.xy;
				uv.x=1.-uv.x;
				float depth = texture2DProj( tDepth, vUv ).r;
				float viewZ = getViewZ( depth );
				float clipW = virtualCameraProjectionMatrix[2][3] * viewZ+virtualCameraProjectionMatrix[3][3];
				vec3 viewPosition=getViewPosition( uv, depth, clipW );
				vec3 worldPosition=(virtualCameraMatrixWorld*vec4(viewPosition,1)).xyz;
				if(worldPosition.y>maxDistance) discard;
				float op=opacity;
				#ifdef DISTANCE_ATTENUATION
					float ratio=1.-(worldPosition.y/maxDistance);
					float attenuation=ratio*ratio;
					op=opacity*attenuation;
				#endif
				#ifdef FRESNEL
					op*=fresnelCoe;
				#endif
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), op );
			#else
				gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );
			#endif
		}
	`};class Refractor extends Mesh{constructor(er,tr={}){super(er),this.isRefractor=!0,this.type="Refractor",this.camera=new PerspectiveCamera;const ir=this,nr=tr.color!==void 0?new Color(tr.color):new Color(8355711),sr=tr.textureWidth||512,ar=tr.textureHeight||512,or=tr.clipBias||0,lr=tr.shader||Refractor.RefractorShader,cr=tr.multisample!==void 0?tr.multisample:4,ur=this.camera;ur.matrixAutoUpdate=!1,ur.userData.refractor=!0;const dr=new Plane,hr=new Matrix4,pr=new WebGLRenderTarget(sr,ar,{samples:cr,type:HalfFloatType});this.material=new ShaderMaterial({name:lr.name!==void 0?lr.name:"unspecified",uniforms:UniformsUtils.clone(lr.uniforms),vertexShader:lr.vertexShader,fragmentShader:lr.fragmentShader,transparent:!0}),this.material.uniforms.color.value=nr,this.material.uniforms.tDiffuse.value=pr.texture,this.material.uniforms.textureMatrix.value=hr;const gr=function(){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Matrix4,xr=new Vector3$1,Sr=new Vector3$1;return function(Cr){return Ar.setFromMatrixPosition(ir.matrixWorld),yr.setFromMatrixPosition(Cr.matrixWorld),xr.subVectors(Ar,yr),wr.extractRotation(ir.matrixWorld),Sr.set(0,0,1),Sr.applyMatrix4(wr),xr.dot(Sr)<0}}(),vr=function(){const Ar=new Vector3$1,yr=new Vector3$1,wr=new Quaternion$1,xr=new Vector3$1;return function(){ir.matrixWorld.decompose(yr,wr,xr),Ar.set(0,0,1).applyQuaternion(wr).normalize(),Ar.negate(),dr.setFromNormalAndCoplanarPoint(Ar,yr)}}(),mr=function(){const Ar=new Plane,yr=new Vector4,wr=new Vector4;return function(Sr){ur.matrixWorld.copy(Sr.matrixWorld),ur.matrixWorldInverse.copy(ur.matrixWorld).invert(),ur.projectionMatrix.copy(Sr.projectionMatrix),ur.far=Sr.far,Ar.copy(dr),Ar.applyMatrix4(ur.matrixWorldInverse),yr.set(Ar.normal.x,Ar.normal.y,Ar.normal.z,Ar.constant);const br=ur.projectionMatrix;wr.x=(Math.sign(yr.x)+br.elements[8])/br.elements[0],wr.y=(Math.sign(yr.y)+br.elements[9])/br.elements[5],wr.z=-1,wr.w=(1+br.elements[10])/br.elements[14],yr.multiplyScalar(2/yr.dot(wr)),br.elements[2]=yr.x,br.elements[6]=yr.y,br.elements[10]=yr.z+1-or,br.elements[14]=yr.w}}();function fr(Ar){hr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),hr.multiply(Ar.projectionMatrix),hr.multiply(Ar.matrixWorldInverse),hr.multiply(ir.matrixWorld)}function _r(Ar,yr,wr){ir.visible=!1;const xr=Ar.getRenderTarget(),Sr=Ar.xr.enabled,br=Ar.shadowMap.autoUpdate;Ar.xr.enabled=!1,Ar.shadowMap.autoUpdate=!1,Ar.setRenderTarget(pr),Ar.autoClear===!1&&Ar.clear(),Ar.render(yr,ur),Ar.xr.enabled=Sr,Ar.shadowMap.autoUpdate=br,Ar.setRenderTarget(xr);const Cr=wr.viewport;Cr!==void 0&&Ar.state.viewport(Cr),ir.visible=!0}this.onBeforeRender=function(Ar,yr,wr){wr.userData.refractor!==!0&&gr(wr)&&(vr(),fr(wr),mr(wr),_r(Ar,yr,wr))},this.getRenderTarget=function(){return pr},this.dispose=function(){pr.dispose(),ir.material.dispose()}}}Refractor.RefractorShader={name:"RefractorShader",uniforms:{color:{value:null},tDiffuse:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec4 vUv;

		void main() {

			vUv = textureMatrix * vec4( position, 1.0 );
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec4 vUv;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ), blendOverlay( base.b, blend.b ) );

		}

		void main() {

			vec4 base = texture2DProj( tDiffuse, vUv );
			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};const _shadowMatrix=new Matrix4;class ShadowMesh extends Mesh{constructor(er){const tr=new MeshBasicMaterial({color:0,transparent:!0,opacity:.6,depthWrite:!1,stencilWrite:!0,stencilFunc:EqualStencilFunc,stencilRef:0,stencilZPass:IncrementStencilOp});super(er.geometry,tr),this.isShadowMesh=!0,this.meshMatrix=er.matrixWorld,this.frustumCulled=!1,this.matrixAutoUpdate=!1}update(er,tr){const ir=er.normal.x*tr.x+er.normal.y*tr.y+er.normal.z*tr.z+-er.constant*tr.w,nr=_shadowMatrix.elements;nr[0]=ir-tr.x*er.normal.x,nr[4]=-tr.x*er.normal.y,nr[8]=-tr.x*er.normal.z,nr[12]=-tr.x*-er.constant,nr[1]=-tr.y*er.normal.x,nr[5]=ir-tr.y*er.normal.y,nr[9]=-tr.y*er.normal.z,nr[13]=-tr.y*-er.constant,nr[2]=-tr.z*er.normal.x,nr[6]=-tr.z*er.normal.y,nr[10]=ir-tr.z*er.normal.z,nr[14]=-tr.z*-er.constant,nr[3]=-tr.w*er.normal.x,nr[7]=-tr.w*er.normal.y,nr[11]=-tr.w*er.normal.z,nr[15]=ir-tr.w*-er.constant,this.matrix.multiplyMatrices(_shadowMatrix,this.meshMatrix)}}class Sky extends Mesh{constructor(){const er=Sky.SkyShader,tr=new ShaderMaterial({name:er.name,uniforms:UniformsUtils.clone(er.uniforms),vertexShader:er.vertexShader,fragmentShader:er.fragmentShader,side:BackSide,depthWrite:!1});super(new BoxGeometry(1,1,1),tr),this.isSky=!0}}Sky.SkyShader={name:"SkyShader",uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new Vector3$1},up:{value:new Vector3$1(0,1,0)}},vertexShader:`
		uniform vec3 sunPosition;
		uniform float rayleigh;
		uniform float turbidity;
		uniform float mieCoefficient;
		uniform vec3 up;

		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		// constants for atmospheric scattering
		const float e = 2.71828182845904523536028747135266249775724709369995957;
		const float pi = 3.141592653589793238462643383279502884197169;

		// wavelength of used primaries, according to preetham
		const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
		// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
		// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
		const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

		// mie stuff
		// K coefficient for the primaries
		const float v = 4.0;
		const vec3 K = vec3( 0.686, 0.678, 0.666 );
		// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
		const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

		// earth shadow hack
		// cutoffAngle = pi / 1.95;
		const float cutoffAngle = 1.6110731556870734;
		const float steepness = 1.5;
		const float EE = 1000.0;

		float sunIntensity( float zenithAngleCos ) {
			zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
			return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
		}

		vec3 totalMie( float T ) {
			float c = ( 0.2 * T ) * 10E-18;
			return 0.434 * c * MieConst;
		}

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vWorldPosition = worldPosition.xyz;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			gl_Position.z = gl_Position.w; // set z to camera.far

			vSunDirection = normalize( sunPosition );

			vSunE = sunIntensity( dot( vSunDirection, up ) );

			vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

			float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

			// extinction (absorbtion + out scattering)
			// rayleigh coefficients
			vBetaR = totalRayleigh * rayleighCoefficient;

			// mie coefficients
			vBetaM = totalMie( turbidity ) * mieCoefficient;

		}`,fragmentShader:`
		varying vec3 vWorldPosition;
		varying vec3 vSunDirection;
		varying float vSunfade;
		varying vec3 vBetaR;
		varying vec3 vBetaM;
		varying float vSunE;

		uniform float mieDirectionalG;
		uniform vec3 up;

		// constants for atmospheric scattering
		const float pi = 3.141592653589793238462643383279502884197169;

		const float n = 1.0003; // refractive index of air
		const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

		// optical length at zenith for molecules
		const float rayleighZenithLength = 8.4E3;
		const float mieZenithLength = 1.25E3;
		// 66 arc seconds -> degrees, and the cosine of that
		const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

		// 3.0 / ( 16.0 * pi )
		const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
		// 1.0 / ( 4.0 * pi )
		const float ONE_OVER_FOURPI = 0.07957747154594767;

		float rayleighPhase( float cosTheta ) {
			return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
		}

		float hgPhase( float cosTheta, float g ) {
			float g2 = pow( g, 2.0 );
			float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
			return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
		}

		void main() {

			vec3 direction = normalize( vWorldPosition - cameraPosition );

			// optical length
			// cutoff angle at 90 to avoid singularity in next formula.
			float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
			float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
			float sR = rayleighZenithLength * inverse;
			float sM = mieZenithLength * inverse;

			// combined extinction factor
			vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

			// in scattering
			float cosTheta = dot( direction, vSunDirection );

			float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
			vec3 betaRTheta = vBetaR * rPhase;

			float mPhase = hgPhase( cosTheta, mieDirectionalG );
			vec3 betaMTheta = vBetaM * mPhase;

			vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
			Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

			// nightsky
			float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
			float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
			vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
			vec3 L0 = vec3( 0.1 ) * Fex;

			// composition + solar disc
			float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
			L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

			vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

			vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

			gl_FragColor = vec4( retColor, 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};let Water$1=class extends Mesh{constructor(er,tr={}){super(er),this.isWater=!0;const ir=this,nr=tr.textureWidth!==void 0?tr.textureWidth:512,sr=tr.textureHeight!==void 0?tr.textureHeight:512,ar=tr.clipBias!==void 0?tr.clipBias:0,or=tr.alpha!==void 0?tr.alpha:1,lr=tr.time!==void 0?tr.time:0,cr=tr.waterNormals!==void 0?tr.waterNormals:null,ur=tr.sunDirection!==void 0?tr.sunDirection:new Vector3$1(.70707,.70707,0),dr=new Color(tr.sunColor!==void 0?tr.sunColor:16777215),hr=new Color(tr.waterColor!==void 0?tr.waterColor:8355711),pr=tr.eye!==void 0?tr.eye:new Vector3$1(0,0,0),gr=tr.distortionScale!==void 0?tr.distortionScale:20,vr=tr.side!==void 0?tr.side:FrontSide,mr=tr.fog!==void 0?tr.fog:!1,fr=new Plane,_r=new Vector3$1,Ar=new Vector3$1,yr=new Vector3$1,wr=new Matrix4,xr=new Vector3$1(0,0,-1),Sr=new Vector4,br=new Vector3$1,Cr=new Vector3$1,Ir=new Vector4,Rr=new Matrix4,Pr=new PerspectiveCamera,Dr=new WebGLRenderTarget(nr,sr),Fr={name:"MirrorShader",uniforms:UniformsUtils.merge([UniformsLib.fog,UniformsLib.lights,{normalSampler:{value:null},mirrorSampler:{value:null},alpha:{value:1},time:{value:0},size:{value:1},distortionScale:{value:20},textureMatrix:{value:new Matrix4},sunColor:{value:new Color(8355711)},sunDirection:{value:new Vector3$1(.70707,.70707,0)},eye:{value:new Vector3$1},waterColor:{value:new Color(5592405)}}]),vertexShader:`
				uniform mat4 textureMatrix;
				uniform float time;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				#include <common>
				#include <fog_pars_vertex>
				#include <shadowmap_pars_vertex>
				#include <logdepthbuf_pars_vertex>

				void main() {
					mirrorCoord = modelMatrix * vec4( position, 1.0 );
					worldPosition = mirrorCoord.xyzw;
					mirrorCoord = textureMatrix * mirrorCoord;
					vec4 mvPosition =  modelViewMatrix * vec4( position, 1.0 );
					gl_Position = projectionMatrix * mvPosition;

				#include <beginnormal_vertex>
				#include <defaultnormal_vertex>
				#include <logdepthbuf_vertex>
				#include <fog_vertex>
				#include <shadowmap_vertex>
			}`,fragmentShader:`
				uniform sampler2D mirrorSampler;
				uniform float alpha;
				uniform float time;
				uniform float size;
				uniform float distortionScale;
				uniform sampler2D normalSampler;
				uniform vec3 sunColor;
				uniform vec3 sunDirection;
				uniform vec3 eye;
				uniform vec3 waterColor;

				varying vec4 mirrorCoord;
				varying vec4 worldPosition;

				vec4 getNoise( vec2 uv ) {
					vec2 uv0 = ( uv / 103.0 ) + vec2(time / 17.0, time / 29.0);
					vec2 uv1 = uv / 107.0-vec2( time / -19.0, time / 31.0 );
					vec2 uv2 = uv / vec2( 8907.0, 9803.0 ) + vec2( time / 101.0, time / 97.0 );
					vec2 uv3 = uv / vec2( 1091.0, 1027.0 ) - vec2( time / 109.0, time / -113.0 );
					vec4 noise = texture2D( normalSampler, uv0 ) +
						texture2D( normalSampler, uv1 ) +
						texture2D( normalSampler, uv2 ) +
						texture2D( normalSampler, uv3 );
					return noise * 0.5 - 1.0;
				}

				void sunLight( const vec3 surfaceNormal, const vec3 eyeDirection, float shiny, float spec, float diffuse, inout vec3 diffuseColor, inout vec3 specularColor ) {
					vec3 reflection = normalize( reflect( -sunDirection, surfaceNormal ) );
					float direction = max( 0.0, dot( eyeDirection, reflection ) );
					specularColor += pow( direction, shiny ) * sunColor * spec;
					diffuseColor += max( dot( sunDirection, surfaceNormal ), 0.0 ) * sunColor * diffuse;
				}

				#include <common>
				#include <packing>
				#include <bsdfs>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <lights_pars_begin>
				#include <shadowmap_pars_fragment>
				#include <shadowmask_pars_fragment>

				void main() {

					#include <logdepthbuf_fragment>
					vec4 noise = getNoise( worldPosition.xz * size );
					vec3 surfaceNormal = normalize( noise.xzy * vec3( 1.5, 1.0, 1.5 ) );

					vec3 diffuseLight = vec3(0.0);
					vec3 specularLight = vec3(0.0);

					vec3 worldToEye = eye-worldPosition.xyz;
					vec3 eyeDirection = normalize( worldToEye );
					sunLight( surfaceNormal, eyeDirection, 100.0, 2.0, 0.5, diffuseLight, specularLight );

					float distance = length(worldToEye);

					vec2 distortion = surfaceNormal.xz * ( 0.001 + 1.0 / distance ) * distortionScale;
					vec3 reflectionSample = vec3( texture2D( mirrorSampler, mirrorCoord.xy / mirrorCoord.w + distortion ) );

					float theta = max( dot( eyeDirection, surfaceNormal ), 0.0 );
					float rf0 = 0.3;
					float reflectance = rf0 + ( 1.0 - rf0 ) * pow( ( 1.0 - theta ), 5.0 );
					vec3 scatter = max( 0.0, dot( surfaceNormal, eyeDirection ) ) * waterColor;
					vec3 albedo = mix( ( sunColor * diffuseLight * 0.3 + scatter ) * getShadowMask(), ( vec3( 0.1 ) + reflectionSample * 0.9 + reflectionSample * specularLight ), reflectance);
					vec3 outgoingLight = albedo;
					gl_FragColor = vec4( outgoingLight, alpha );

					#include <tonemapping_fragment>
					#include <colorspace_fragment>
					#include <fog_fragment>	
				}`},Or=new ShaderMaterial({name:Fr.name,uniforms:UniformsUtils.clone(Fr.uniforms),vertexShader:Fr.vertexShader,fragmentShader:Fr.fragmentShader,lights:!0,side:vr,fog:mr});Or.uniforms.mirrorSampler.value=Dr.texture,Or.uniforms.textureMatrix.value=Rr,Or.uniforms.alpha.value=or,Or.uniforms.time.value=lr,Or.uniforms.normalSampler.value=cr,Or.uniforms.sunColor.value=dr,Or.uniforms.waterColor.value=hr,Or.uniforms.sunDirection.value=ur,Or.uniforms.distortionScale.value=gr,Or.uniforms.eye.value=pr,ir.material=Or,ir.onBeforeRender=function(Nr,Ur,Br){if(Ar.setFromMatrixPosition(ir.matrixWorld),yr.setFromMatrixPosition(Br.matrixWorld),wr.extractRotation(ir.matrixWorld),_r.set(0,0,1),_r.applyMatrix4(wr),br.subVectors(Ar,yr),br.dot(_r)>0)return;br.reflect(_r).negate(),br.add(Ar),wr.extractRotation(Br.matrixWorld),xr.set(0,0,-1),xr.applyMatrix4(wr),xr.add(yr),Cr.subVectors(Ar,xr),Cr.reflect(_r).negate(),Cr.add(Ar),Pr.position.copy(br),Pr.up.set(0,1,0),Pr.up.applyMatrix4(wr),Pr.up.reflect(_r),Pr.lookAt(Cr),Pr.far=Br.far,Pr.updateMatrixWorld(),Pr.projectionMatrix.copy(Br.projectionMatrix),Rr.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Rr.multiply(Pr.projectionMatrix),Rr.multiply(Pr.matrixWorldInverse),fr.setFromNormalAndCoplanarPoint(_r,Ar),fr.applyMatrix4(Pr.matrixWorldInverse),Sr.set(fr.normal.x,fr.normal.y,fr.normal.z,fr.constant);const Wr=Pr.projectionMatrix;Ir.x=(Math.sign(Sr.x)+Wr.elements[8])/Wr.elements[0],Ir.y=(Math.sign(Sr.y)+Wr.elements[9])/Wr.elements[5],Ir.z=-1,Ir.w=(1+Wr.elements[10])/Wr.elements[14],Sr.multiplyScalar(2/Sr.dot(Ir)),Wr.elements[2]=Sr.x,Wr.elements[6]=Sr.y,Wr.elements[10]=Sr.z+1-ar,Wr.elements[14]=Sr.w,pr.setFromMatrixPosition(Br.matrixWorld);const Xr=Nr.getRenderTarget(),Yr=Nr.xr.enabled,Qi=Nr.shadowMap.autoUpdate;ir.visible=!1,Nr.xr.enabled=!1,Nr.shadowMap.autoUpdate=!1,Nr.setRenderTarget(Dr),Nr.state.buffers.depth.setMask(!0),Nr.autoClear===!1&&Nr.clear(),Nr.render(Ur,Pr),ir.visible=!0,Nr.xr.enabled=Yr,Nr.shadowMap.autoUpdate=Qi,Nr.setRenderTarget(Xr);const Xi=Br.viewport;Xi!==void 0&&Nr.state.viewport(Xi)}}};class Water extends Mesh{constructor(er,tr={}){super(er),this.isWater=!0,this.type="Water";const ir=this,nr=tr.color!==void 0?new Color(tr.color):new Color(16777215),sr=tr.textureWidth!==void 0?tr.textureWidth:512,ar=tr.textureHeight!==void 0?tr.textureHeight:512,or=tr.clipBias!==void 0?tr.clipBias:0,lr=tr.flowDirection!==void 0?tr.flowDirection:new Vector2(1,0),cr=tr.flowSpeed!==void 0?tr.flowSpeed:.03,ur=tr.reflectivity!==void 0?tr.reflectivity:.02,dr=tr.scale!==void 0?tr.scale:1,hr=tr.shader!==void 0?tr.shader:Water.WaterShader,pr=new TextureLoader,gr=tr.flowMap||void 0,vr=tr.normalMap0||pr.load("textures/water/Water_1_M_Normal.jpg"),mr=tr.normalMap1||pr.load("textures/water/Water_2_M_Normal.jpg"),fr=.15,_r=fr*.5,Ar=new Matrix4,yr=new Clock;if(Reflector===void 0){console.error("THREE.Water: Required component Reflector not found.");return}if(Refractor===void 0){console.error("THREE.Water: Required component Refractor not found.");return}const wr=new Reflector(er,{textureWidth:sr,textureHeight:ar,clipBias:or}),xr=new Refractor(er,{textureWidth:sr,textureHeight:ar,clipBias:or});wr.matrixAutoUpdate=!1,xr.matrixAutoUpdate=!1,this.material=new ShaderMaterial({name:hr.name,uniforms:UniformsUtils.merge([UniformsLib.fog,hr.uniforms]),vertexShader:hr.vertexShader,fragmentShader:hr.fragmentShader,transparent:!0,fog:!0}),gr!==void 0?(this.material.defines.USE_FLOWMAP="",this.material.uniforms.tFlowMap={type:"t",value:gr}):this.material.uniforms.flowDirection={type:"v2",value:lr},vr.wrapS=vr.wrapT=RepeatWrapping,mr.wrapS=mr.wrapT=RepeatWrapping,this.material.uniforms.tReflectionMap.value=wr.getRenderTarget().texture,this.material.uniforms.tRefractionMap.value=xr.getRenderTarget().texture,this.material.uniforms.tNormalMap0.value=vr,this.material.uniforms.tNormalMap1.value=mr,this.material.uniforms.color.value=nr,this.material.uniforms.reflectivity.value=ur,this.material.uniforms.textureMatrix.value=Ar,this.material.uniforms.config.value.x=0,this.material.uniforms.config.value.y=_r,this.material.uniforms.config.value.z=_r,this.material.uniforms.config.value.w=dr;function Sr(Cr){Ar.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),Ar.multiply(Cr.projectionMatrix),Ar.multiply(Cr.matrixWorldInverse),Ar.multiply(ir.matrixWorld)}function br(){const Cr=yr.getDelta(),Ir=ir.material.uniforms.config;Ir.value.x+=cr*Cr,Ir.value.y=Ir.value.x+_r,Ir.value.x>=fr?(Ir.value.x=0,Ir.value.y=_r):Ir.value.y>=fr&&(Ir.value.y=Ir.value.y-fr)}this.onBeforeRender=function(Cr,Ir,Rr){Sr(Rr),br(),ir.visible=!1,wr.matrixWorld.copy(ir.matrixWorld),xr.matrixWorld.copy(ir.matrixWorld),wr.onBeforeRender(Cr,Ir,Rr),xr.onBeforeRender(Cr,Ir,Rr),ir.visible=!0}}}Water.WaterShader={name:"WaterShader",uniforms:{color:{type:"c",value:null},reflectivity:{type:"f",value:0},tReflectionMap:{type:"t",value:null},tRefractionMap:{type:"t",value:null},tNormalMap0:{type:"t",value:null},tNormalMap1:{type:"t",value:null},textureMatrix:{type:"m4",value:null},config:{type:"v4",value:new Vector4}},vertexShader:`

		#include <common>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>

		uniform mat4 textureMatrix;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			vUv = uv;
			vCoord = textureMatrix * vec4( position, 1.0 );

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vToEye = cameraPosition - worldPosition.xyz;

			vec4 mvPosition =  viewMatrix * worldPosition; // used in fog_vertex
			gl_Position = projectionMatrix * mvPosition;

			#include <logdepthbuf_vertex>
			#include <fog_vertex>

		}`,fragmentShader:`

		#include <common>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>

		uniform sampler2D tReflectionMap;
		uniform sampler2D tRefractionMap;
		uniform sampler2D tNormalMap0;
		uniform sampler2D tNormalMap1;

		#ifdef USE_FLOWMAP
			uniform sampler2D tFlowMap;
		#else
			uniform vec2 flowDirection;
		#endif

		uniform vec3 color;
		uniform float reflectivity;
		uniform vec4 config;

		varying vec4 vCoord;
		varying vec2 vUv;
		varying vec3 vToEye;

		void main() {

			#include <logdepthbuf_fragment>

			float flowMapOffset0 = config.x;
			float flowMapOffset1 = config.y;
			float halfCycle = config.z;
			float scale = config.w;

			vec3 toEye = normalize( vToEye );

			// determine flow direction
			vec2 flow;
			#ifdef USE_FLOWMAP
				flow = texture2D( tFlowMap, vUv ).rg * 2.0 - 1.0;
			#else
				flow = flowDirection;
			#endif
			flow.x *= - 1.0;

			// sample normal maps (distort uvs with flowdata)
			vec4 normalColor0 = texture2D( tNormalMap0, ( vUv * scale ) + flow * flowMapOffset0 );
			vec4 normalColor1 = texture2D( tNormalMap1, ( vUv * scale ) + flow * flowMapOffset1 );

			// linear interpolate to get the final normal color
			float flowLerp = abs( halfCycle - flowMapOffset0 ) / halfCycle;
			vec4 normalColor = mix( normalColor0, normalColor1, flowLerp );

			// calculate normal vector
			vec3 normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );

			// calculate the fresnel term to blend reflection and refraction maps
			float theta = max( dot( toEye, normal ), 0.0 );
			float reflectance = reflectivity + ( 1.0 - reflectivity ) * pow( ( 1.0 - theta ), 5.0 );

			// calculate final uv coords
			vec3 coord = vCoord.xyz / vCoord.w;
			vec2 uv = coord.xy + coord.z * normal.xz * 0.05;

			vec4 reflectColor = texture2D( tReflectionMap, vec2( 1.0 - uv.x, uv.y ) );
			vec4 refractColor = texture2D( tRefractionMap, uv );

			// multiply water color with the mix of both textures
			gl_FragColor = vec4( color, 1.0 ) * mix( refractColor, reflectColor, reflectance );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>

		}`};async function AmmoPhysics(){if(!("Ammo"in window)){console.error("AmmoPhysics: Couldn't find Ammo.js");return}const rr=await Ammo(),er=60,tr=new rr.btDefaultCollisionConfiguration,ir=new rr.btCollisionDispatcher(tr),nr=new rr.btDbvtBroadphase,sr=new rr.btSequentialImpulseConstraintSolver,ar=new rr.btDiscreteDynamicsWorld(ir,nr,sr,tr);ar.setGravity(new rr.btVector3(0,-9.8,0));const or=new rr.btTransform;function lr(_r){const Ar=_r.parameters;if(_r.type==="BoxGeometry"){const yr=Ar.width!==void 0?Ar.width/2:.5,wr=Ar.height!==void 0?Ar.height/2:.5,xr=Ar.depth!==void 0?Ar.depth/2:.5,Sr=new rr.btBoxShape(new rr.btVector3(yr,wr,xr));return Sr.setMargin(.05),Sr}else if(_r.type==="SphereGeometry"||_r.type==="IcosahedronGeometry"){const yr=Ar.radius!==void 0?Ar.radius:1,wr=new rr.btSphereShape(yr);return wr.setMargin(.05),wr}return null}const cr=[],ur=new WeakMap;function dr(_r){_r.traverse(function(Ar){if(Ar.isMesh){const yr=Ar.userData.physics;yr&&hr(Ar,yr.mass)}})}function hr(_r,Ar=0){const yr=lr(_r.geometry);yr!==null&&(_r.isInstancedMesh?gr(_r,Ar,yr):_r.isMesh&&pr(_r,Ar,yr))}function pr(_r,Ar,yr){const wr=_r.position,xr=_r.quaternion,Sr=new rr.btTransform;Sr.setIdentity(),Sr.setOrigin(new rr.btVector3(wr.x,wr.y,wr.z)),Sr.setRotation(new rr.btQuaternion(xr.x,xr.y,xr.z,xr.w));const br=new rr.btDefaultMotionState(Sr),Cr=new rr.btVector3(0,0,0);yr.calculateLocalInertia(Ar,Cr);const Ir=new rr.btRigidBodyConstructionInfo(Ar,br,yr,Cr),Rr=new rr.btRigidBody(Ir);ar.addRigidBody(Rr),Ar>0&&(cr.push(_r),ur.set(_r,Rr))}function gr(_r,Ar,yr){const wr=_r.instanceMatrix.array,xr=[];for(let Sr=0;Sr<_r.count;Sr++){const br=Sr*16,Cr=new rr.btTransform;Cr.setFromOpenGLMatrix(wr.slice(br,br+16));const Ir=new rr.btDefaultMotionState(Cr),Rr=new rr.btVector3(0,0,0);yr.calculateLocalInertia(Ar,Rr);const Pr=new rr.btRigidBodyConstructionInfo(Ar,Ir,yr,Rr),Dr=new rr.btRigidBody(Pr);ar.addRigidBody(Dr),xr.push(Dr)}Ar>0&&(cr.push(_r),ur.set(_r,xr))}function vr(_r,Ar,yr=0){if(_r.isInstancedMesh){const xr=ur.get(_r)[yr];xr.setAngularVelocity(new rr.btVector3(0,0,0)),xr.setLinearVelocity(new rr.btVector3(0,0,0)),or.setIdentity(),or.setOrigin(new rr.btVector3(Ar.x,Ar.y,Ar.z)),xr.setWorldTransform(or)}else if(_r.isMesh){const wr=ur.get(_r);wr.setAngularVelocity(new rr.btVector3(0,0,0)),wr.setLinearVelocity(new rr.btVector3(0,0,0)),or.setIdentity(),or.setOrigin(new rr.btVector3(Ar.x,Ar.y,Ar.z)),wr.setWorldTransform(or)}}let mr=0;function fr(){const _r=performance.now();if(mr>0){const Ar=(_r-mr)/1e3;ar.stepSimulation(Ar,10);for(let yr=0,wr=cr.length;yr<wr;yr++){const xr=cr[yr];if(xr.isInstancedMesh){const Sr=xr.instanceMatrix.array,br=ur.get(xr);for(let Cr=0;Cr<br.length;Cr++){br[Cr].getMotionState().getWorldTransform(or);const Pr=or.getOrigin(),Dr=or.getRotation();compose(Pr,Dr,Sr,Cr*16)}xr.instanceMatrix.needsUpdate=!0,xr.computeBoundingSphere()}else if(xr.isMesh){ur.get(xr).getMotionState().getWorldTransform(or);const Cr=or.getOrigin(),Ir=or.getRotation();xr.position.set(Cr.x(),Cr.y(),Cr.z()),xr.quaternion.set(Ir.x(),Ir.y(),Ir.z(),Ir.w())}}}mr=_r}return setInterval(fr,1e3/er),{addScene:dr,addMesh:hr,setMeshPosition:vr}}function compose(rr,er,tr,ir){const nr=er.x(),sr=er.y(),ar=er.z(),or=er.w(),lr=nr+nr,cr=sr+sr,ur=ar+ar,dr=nr*lr,hr=nr*cr,pr=nr*ur,gr=sr*cr,vr=sr*ur,mr=ar*ur,fr=or*lr,_r=or*cr,Ar=or*ur;tr[ir+0]=1-(gr+mr),tr[ir+1]=hr+Ar,tr[ir+2]=pr-_r,tr[ir+3]=0,tr[ir+4]=hr-Ar,tr[ir+5]=1-(dr+mr),tr[ir+6]=vr+fr,tr[ir+7]=0,tr[ir+8]=pr+_r,tr[ir+9]=vr-fr,tr[ir+10]=1-(dr+gr),tr[ir+11]=0,tr[ir+12]=rr.x(),tr[ir+13]=rr.y(),tr[ir+14]=rr.z(),tr[ir+15]=1}const scriptRel="modulepreload",assetsURL=function(rr){return"/"+rr},seen={},__vitePreload=function rr(er,tr,ir){let nr=Promise.resolve();if(tr&&tr.length>0){const ar=document.getElementsByTagName("link"),or=document.querySelector("meta[property=csp-nonce]"),lr=or?.nonce||or?.getAttribute("nonce");nr=Promise.allSettled(tr.map(cr=>{if(cr=assetsURL(cr,ir),cr in seen)return;seen[cr]=!0;const ur=cr.endsWith(".css"),dr=ur?'[rel="stylesheet"]':"";if(!!ir)for(let gr=ar.length-1;gr>=0;gr--){const vr=ar[gr];if(vr.href===cr&&(!ur||vr.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${cr}"]${dr}`))return;const pr=document.createElement("link");if(pr.rel=ur?"stylesheet":scriptRel,ur||(pr.as="script"),pr.crossOrigin="",pr.href=cr,lr&&pr.setAttribute("nonce",lr),document.head.appendChild(pr),ur)return new Promise((gr,vr)=>{pr.addEventListener("load",gr),pr.addEventListener("error",()=>vr(new Error(`Unable to preload CSS for ${cr}`)))})}))}function sr(ar){const or=new Event("vite:preloadError",{cancelable:!0});if(or.payload=ar,window.dispatchEvent(or),!or.defaultPrevented)throw ar}return nr.then(ar=>{for(const or of ar||[])or.status==="rejected"&&sr(or.reason);return er().catch(sr)})},RAPIER_PATH="https://cdn.skypack.dev/@dimforge/rapier3d-compat@0.12.0",frameRate=60,_scale$1=new Vector3$1(1,1,1),ZERO=new Vector3$1;let RAPIER=null;function getShape(rr){const er=rr.parameters;if(rr.type==="BoxGeometry"){const tr=er.width!==void 0?er.width/2:.5,ir=er.height!==void 0?er.height/2:.5,nr=er.depth!==void 0?er.depth/2:.5;return RAPIER.ColliderDesc.cuboid(tr,ir,nr)}else if(rr.type==="SphereGeometry"||rr.type==="IcosahedronGeometry"){const tr=er.radius!==void 0?er.radius:1;return RAPIER.ColliderDesc.ball(tr)}else if(rr.type==="BufferGeometry"){const tr=[],ir=new Vector3$1,nr=rr.getAttribute("position");for(let ar=0;ar<nr.count;ar++)ir.fromBufferAttribute(nr,ar),tr.push(ir.x,ir.y,ir.z);const sr=rr.getIndex()===null?Uint32Array.from(Array(parseInt(tr.length/3)).keys()):rr.getIndex().array;return RAPIER.ColliderDesc.trimesh(tr,sr)}return null}async function RapierPhysics(){RAPIER===null&&(RAPIER=await __vitePreload(()=>import(`${RAPIER_PATH}`),[]),await RAPIER.init());const rr=new Vector3$1(0,-9.81,0),er=new RAPIER.World(rr),tr=[],ir=new WeakMap,nr=new Vector3$1,sr=new Quaternion$1,ar=new Matrix4;function or(vr){vr.traverse(function(mr){if(mr.isMesh){const fr=mr.userData.physics;fr&&lr(mr,fr.mass,fr.restitution)}})}function lr(vr,mr=0,fr=0){const _r=getShape(vr.geometry);if(_r===null)return;_r.setMass(mr),_r.setRestitution(fr);const Ar=vr.isInstancedMesh?cr(vr,mr,_r):ur(vr.position,vr.quaternion,mr,_r);mr>0&&(tr.push(vr),ir.set(vr,Ar))}function cr(vr,mr,fr){const _r=vr.instanceMatrix.array,Ar=[];for(let yr=0;yr<vr.count;yr++){const wr=nr.fromArray(_r,yr*16+12);Ar.push(ur(wr,null,mr,fr))}return Ar}function ur(vr,mr,fr,_r){const Ar=fr>0?RAPIER.RigidBodyDesc.dynamic():RAPIER.RigidBodyDesc.fixed();Ar.setTranslation(...vr),mr!==null&&Ar.setRotation(mr);const yr=er.createRigidBody(Ar);return er.createCollider(_r,yr),yr}function dr(vr,mr,fr=0){let _r=ir.get(vr);vr.isInstancedMesh&&(_r=_r[fr]),_r.setAngvel(ZERO),_r.setLinvel(ZERO),_r.setTranslation(mr)}function hr(vr,mr,fr=0){let _r=ir.get(vr);vr.isInstancedMesh&&(_r=_r[fr]),_r.setLinvel(mr)}const pr=new Clock;function gr(){er.timestep=pr.getDelta(),er.step();for(let vr=0,mr=tr.length;vr<mr;vr++){const fr=tr[vr];if(fr.isInstancedMesh){const _r=fr.instanceMatrix.array,Ar=ir.get(fr);for(let yr=0;yr<Ar.length;yr++){const wr=Ar[yr],xr=wr.translation();sr.copy(wr.rotation()),ar.compose(xr,sr,_scale$1).toArray(_r,yr*16)}fr.instanceMatrix.needsUpdate=!0,fr.computeBoundingSphere()}else{const _r=ir.get(fr);fr.position.copy(_r.translation()),fr.quaternion.copy(_r.rotation())}}}return setInterval(gr,1e3/frameRate),{addScene:or,addMesh:lr,setMeshPosition:dr,setMeshVelocity:hr}}const CopyShader={name:"CopyShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = opacity * texel;


		}`},AfterimageShader={name:"AfterimageShader",uniforms:{damp:{value:.96},tOld:{value:null},tNew:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float damp;

		uniform sampler2D tOld;
		uniform sampler2D tNew;

		varying vec2 vUv;

		vec4 when_gt( vec4 x, float y ) {

			return max( sign( x - y ), 0.0 );

		}

		void main() {

			vec4 texelOld = texture2D( tOld, vUv );
			vec4 texelNew = texture2D( tNew, vUv );

			texelOld *= damp * when_gt( texelOld, 0.1 );

			gl_FragColor = max(texelNew, texelOld);

		}`};class AfterimagePass extends Pass$1{constructor(er=.96){super(),this.shader=AfterimageShader,this.uniforms=UniformsUtils.clone(this.shader.uniforms),this.uniforms.damp.value=er,this.textureComp=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{magFilter:NearestFilter,type:HalfFloatType}),this.textureOld=new WebGLRenderTarget(window.innerWidth,window.innerHeight,{magFilter:NearestFilter,type:HalfFloatType}),this.compFsMaterial=new ShaderMaterial({uniforms:this.uniforms,vertexShader:this.shader.vertexShader,fragmentShader:this.shader.fragmentShader}),this.compFsQuad=new FullScreenQuad(this.compFsMaterial);const tr=CopyShader;this.copyFsMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(tr.uniforms),vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.copyFsQuad=new FullScreenQuad(this.copyFsMaterial)}render(er,tr,ir){this.uniforms.tOld.value=this.textureOld.texture,this.uniforms.tNew.value=ir.texture,er.setRenderTarget(this.textureComp),this.compFsQuad.render(er),this.copyFsQuad.material.uniforms.tDiffuse.value=this.textureComp.texture,this.renderToScreen?(er.setRenderTarget(null),this.copyFsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.copyFsQuad.render(er));const nr=this.textureOld;this.textureOld=this.textureComp,this.textureComp=nr}setSize(er,tr){this.textureComp.setSize(er,tr),this.textureOld.setSize(er,tr)}dispose(){this.textureComp.dispose(),this.textureOld.dispose(),this.compFsMaterial.dispose(),this.copyFsMaterial.dispose(),this.compFsQuad.dispose(),this.copyFsQuad.dispose()}}const ConvolutionShader={name:"ConvolutionShader",defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{value:null},uImageIncrement:{value:new Vector2(.001953125,0)},cKernel:{value:[]}},vertexShader:`

		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float cKernel[ KERNEL_SIZE_INT ];

		uniform sampler2D tDiffuse;
		uniform vec2 uImageIncrement;

		varying vec2 vUv;

		void main() {

			vec2 imageCoord = vUv;
			vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );

			for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {

				sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];
				imageCoord += uImageIncrement;

			}

			gl_FragColor = sum;

		}`,buildKernel:function(rr){let tr=2*Math.ceil(rr*3)+1;tr>25&&(tr=25);const ir=(tr-1)*.5,nr=new Array(tr);let sr=0;for(let ar=0;ar<tr;++ar)nr[ar]=gauss(ar-ir,rr),sr+=nr[ar];for(let ar=0;ar<tr;++ar)nr[ar]/=sr;return nr}};function gauss(rr,er){return Math.exp(-(rr*rr)/(2*er*er))}class BloomPass extends Pass$1{constructor(er=1,tr=25,ir=4){super(),this.renderTargetX=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTargetX.texture.name="BloomPass.x",this.renderTargetY=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTargetY.texture.name="BloomPass.y",this.combineUniforms=UniformsUtils.clone(CombineShader.uniforms),this.combineUniforms.strength.value=er,this.materialCombine=new ShaderMaterial({name:CombineShader.name,uniforms:this.combineUniforms,vertexShader:CombineShader.vertexShader,fragmentShader:CombineShader.fragmentShader,blending:AdditiveBlending,transparent:!0});const nr=ConvolutionShader;this.convolutionUniforms=UniformsUtils.clone(nr.uniforms),this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,this.convolutionUniforms.cKernel.value=ConvolutionShader.buildKernel(ir),this.materialConvolution=new ShaderMaterial({name:nr.name,uniforms:this.convolutionUniforms,vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader,defines:{KERNEL_SIZE_FLOAT:tr.toFixed(1),KERNEL_SIZE_INT:tr.toFixed(0)}}),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(null)}render(er,tr,ir,nr,sr){sr&&er.state.buffers.stencil.setTest(!1),this.fsQuad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=ir.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurX,er.setRenderTarget(this.renderTargetX),er.clear(),this.fsQuad.render(er),this.convolutionUniforms.tDiffuse.value=this.renderTargetX.texture,this.convolutionUniforms.uImageIncrement.value=BloomPass.blurY,er.setRenderTarget(this.renderTargetY),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.materialCombine,this.combineUniforms.tDiffuse.value=this.renderTargetY.texture,sr&&er.state.buffers.stencil.setTest(!0),er.setRenderTarget(ir),this.clear&&er.clear(),this.fsQuad.render(er)}setSize(er,tr){this.renderTargetX.setSize(er,tr),this.renderTargetY.setSize(er,tr)}dispose(){this.renderTargetX.dispose(),this.renderTargetY.dispose(),this.materialCombine.dispose(),this.materialConvolution.dispose(),this.fsQuad.dispose()}}const CombineShader={name:"CombineShader",uniforms:{tDiffuse:{value:null},strength:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float strength;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = strength * texel;

		}`};BloomPass.blurX=new Vector2(.001953125,0);BloomPass.blurY=new Vector2(0,.001953125);const BokehShader$1={name:"BokehShader",defines:{DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},aspect:{value:1},aperture:{value:.025},maxblur:{value:.01},nearClip:{value:1},farClip:{value:1e3}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		uniform float maxblur; // max blur amount
		uniform float aperture; // aperture - bigger values for shallower depth of field

		uniform float nearClip;
		uniform float farClip;

		uniform float focus;
		uniform float aspect;

		#include <packing>

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, nearClip, farClip );
			#else
			return orthographicDepthToViewZ( depth, nearClip, farClip );
			#endif
		}


		void main() {

			vec2 aspectcorrect = vec2( 1.0, aspect );

			float viewZ = getViewZ( getDepth( vUv ) );

			float factor = ( focus + viewZ ); // viewZ is <= 0, so this is a difference equation

			vec2 dofblur = vec2 ( clamp( factor * aperture, -maxblur, maxblur ) );

			vec2 dofblur9 = dofblur * 0.9;
			vec2 dofblur7 = dofblur * 0.7;
			vec2 dofblur4 = dofblur * 0.4;

			vec4 col = vec4( 0.0 );

			col += texture2D( tColor, vUv.xy );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15, -0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.15,  0.37 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.37,  0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.37, -0.15 ) * aspectcorrect ) * dofblur9 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.15, -0.37 ) * aspectcorrect ) * dofblur9 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.40,  0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur7 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur7 );

			col += texture2D( tColor, vUv.xy + ( vec2(  0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,  -0.4  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29,  0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.4,   0.0  ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2( -0.29, -0.29 ) * aspectcorrect ) * dofblur4 );
			col += texture2D( tColor, vUv.xy + ( vec2(  0.0,   0.4  ) * aspectcorrect ) * dofblur4 );

			gl_FragColor = col / 41.0;
			gl_FragColor.a = 1.0;

		}`};class BokehPass extends Pass$1{constructor(er,tr,ir){super(),this.scene=er,this.camera=tr;const nr=ir.focus!==void 0?ir.focus:1,sr=ir.aperture!==void 0?ir.aperture:.025,ar=ir.maxblur!==void 0?ir.maxblur:1;this.renderTargetDepth=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.renderTargetDepth.texture.name="BokehPass.depth",this.materialDepth=new MeshDepthMaterial,this.materialDepth.depthPacking=RGBADepthPacking,this.materialDepth.blending=NoBlending;const or=BokehShader$1,lr=UniformsUtils.clone(or.uniforms);lr.tDepth.value=this.renderTargetDepth.texture,lr.focus.value=nr,lr.aspect.value=tr.aspect,lr.aperture.value=sr,lr.maxblur.value=ar,lr.nearClip.value=tr.near,lr.farClip.value=tr.far,this.materialBokeh=new ShaderMaterial({defines:Object.assign({},or.defines),uniforms:lr,vertexShader:or.vertexShader,fragmentShader:or.fragmentShader}),this.uniforms=lr,this.fsQuad=new FullScreenQuad(this.materialBokeh),this._oldClearColor=new Color}render(er,tr,ir){this.scene.overrideMaterial=this.materialDepth,er.getClearColor(this._oldClearColor);const nr=er.getClearAlpha(),sr=er.autoClear;er.autoClear=!1,er.setClearColor(16777215),er.setClearAlpha(1),er.setRenderTarget(this.renderTargetDepth),er.clear(),er.render(this.scene,this.camera),this.uniforms.tColor.value=ir.texture,this.uniforms.nearClip.value=this.camera.near,this.uniforms.farClip.value=this.camera.far,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),er.clear(),this.fsQuad.render(er)),this.scene.overrideMaterial=null,er.setClearColor(this._oldClearColor),er.setClearAlpha(nr),er.autoClear=sr}setSize(er,tr){this.materialBokeh.uniforms.aspect.value=er/tr,this.renderTargetDepth.setSize(er,tr)}dispose(){this.renderTargetDepth.dispose(),this.materialDepth.dispose(),this.materialBokeh.dispose(),this.fsQuad.dispose()}}let ClearPass$1=class extends Pass$1{constructor(er,tr){super(),this.needsSwap=!1,this.clearColor=er!==void 0?er:0,this.clearAlpha=tr!==void 0?tr:0,this._oldClearColor=new Color}render(er,tr,ir){let nr;this.clearColor&&(er.getClearColor(this._oldClearColor),nr=er.getClearAlpha(),er.setClearColor(this.clearColor,this.clearAlpha)),er.setRenderTarget(this.renderToScreen?null:ir),er.clear(),this.clearColor&&er.setClearColor(this._oldClearColor,nr)}};class CubeTexturePass extends Pass$1{constructor(er,tr,ir=1){super(),this.camera=er,this.needsSwap=!1,this.cubeShader=ShaderLib.cube,this.cubeMesh=new Mesh(new BoxGeometry(10,10,10),new ShaderMaterial({uniforms:UniformsUtils.clone(this.cubeShader.uniforms),vertexShader:this.cubeShader.vertexShader,fragmentShader:this.cubeShader.fragmentShader,depthTest:!1,depthWrite:!1,side:BackSide})),Object.defineProperty(this.cubeMesh.material,"envMap",{get:function(){return this.uniforms.tCube.value}}),this.tCube=tr,this.opacity=ir,this.cubeScene=new Scene,this.cubeCamera=new PerspectiveCamera,this.cubeScene.add(this.cubeMesh)}render(er,tr,ir){const nr=er.autoClear;er.autoClear=!1,this.cubeCamera.projectionMatrix.copy(this.camera.projectionMatrix),this.cubeCamera.quaternion.setFromRotationMatrix(this.camera.matrixWorld),this.cubeMesh.material.uniforms.tCube.value=this.tCube,this.cubeMesh.material.uniforms.tFlip.value=this.tCube.isCubeTexture&&this.tCube.isRenderTargetTexture===!1?-1:1,this.cubeMesh.material.uniforms.opacity.value=this.opacity,this.cubeMesh.material.transparent=this.opacity<1,er.setRenderTarget(this.renderToScreen?null:ir),this.clear&&er.clear(),er.render(this.cubeScene,this.cubeCamera),er.autoClear=nr}dispose(){this.cubeMesh.geometry.dispose(),this.cubeMesh.material.dispose()}}const DotScreenShader={name:"DotScreenShader",uniforms:{tDiffuse:{value:null},tSize:{value:new Vector2(256,256)},center:{value:new Vector2(.5,.5)},angle:{value:1.57},scale:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec2 center;
		uniform float angle;
		uniform float scale;
		uniform vec2 tSize;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		float pattern() {

			float s = sin( angle ), c = cos( angle );

			vec2 tex = vUv * tSize - center;
			vec2 point = vec2( c * tex.x - s * tex.y, s * tex.x + c * tex.y ) * scale;

			return ( sin( point.x ) * sin( point.y ) ) * 4.0;

		}

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );

			float average = ( color.r + color.g + color.b ) / 3.0;

			gl_FragColor = vec4( vec3( average * 10.0 - 5.0 + pattern() ), color.a );

		}`};class DotScreenPass extends Pass$1{constructor(er,tr,ir){super();const nr=DotScreenShader;this.uniforms=UniformsUtils.clone(nr.uniforms),er!==void 0&&this.uniforms.center.value.copy(er),tr!==void 0&&(this.uniforms.angle.value=tr),ir!==void 0&&(this.uniforms.scale.value=ir),this.material=new ShaderMaterial({name:nr.name,uniforms:this.uniforms,vertexShader:nr.vertexShader,fragmentShader:nr.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,ir){this.uniforms.tDiffuse.value=ir.texture,this.uniforms.tSize.value.set(ir.width,ir.height),this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}let ShaderPass$1=class extends Pass$1{constructor(er,tr){super(),this.textureID=tr!==void 0?tr:"tDiffuse",er instanceof ShaderMaterial?(this.uniforms=er.uniforms,this.material=er):er&&(this.uniforms=UniformsUtils.clone(er.uniforms),this.material=new ShaderMaterial({name:er.name!==void 0?er.name:"unspecified",defines:Object.assign({},er.defines),uniforms:this.uniforms,vertexShader:er.vertexShader,fragmentShader:er.fragmentShader})),this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,ir){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=ir.texture),this.fsQuad.material=this.material,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}},MaskPass$1=class extends Pass$1{constructor(er,tr){super(),this.scene=er,this.camera=tr,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(er,tr,ir){const nr=er.getContext(),sr=er.state;sr.buffers.color.setMask(!1),sr.buffers.depth.setMask(!1),sr.buffers.color.setLocked(!0),sr.buffers.depth.setLocked(!0);let ar,or;this.inverse?(ar=0,or=1):(ar=1,or=0),sr.buffers.stencil.setTest(!0),sr.buffers.stencil.setOp(nr.REPLACE,nr.REPLACE,nr.REPLACE),sr.buffers.stencil.setFunc(nr.ALWAYS,ar,4294967295),sr.buffers.stencil.setClear(or),sr.buffers.stencil.setLocked(!0),er.setRenderTarget(ir),this.clear&&er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(tr),this.clear&&er.clear(),er.render(this.scene,this.camera),sr.buffers.color.setLocked(!1),sr.buffers.depth.setLocked(!1),sr.buffers.color.setMask(!0),sr.buffers.depth.setMask(!0),sr.buffers.stencil.setLocked(!1),sr.buffers.stencil.setFunc(nr.EQUAL,1,4294967295),sr.buffers.stencil.setOp(nr.KEEP,nr.KEEP,nr.KEEP),sr.buffers.stencil.setLocked(!0)}},ClearMaskPass$1=class extends Pass$1{constructor(){super(),this.needsSwap=!1}render(er){er.state.buffers.stencil.setLocked(!1),er.state.buffers.stencil.setTest(!1)}},EffectComposer$1=class{constructor(er,tr){if(this.renderer=er,this._pixelRatio=er.getPixelRatio(),tr===void 0){const ir=er.getSize(new Vector2);this._width=ir.width,this._height=ir.height,tr=new WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:HalfFloatType}),tr.texture.name="EffectComposer.rt1"}else this._width=tr.width,this._height=tr.height;this.renderTarget1=tr,this.renderTarget2=tr.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],this.copyPass=new ShaderPass$1(CopyShader),this.copyPass.material.blending=NoBlending,this.clock=new Clock}swapBuffers(){const er=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=er}addPass(er){this.passes.push(er),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(er,tr){this.passes.splice(tr,0,er),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(er){const tr=this.passes.indexOf(er);tr!==-1&&this.passes.splice(tr,1)}isLastEnabledPass(er){for(let tr=er+1;tr<this.passes.length;tr++)if(this.passes[tr].enabled)return!1;return!0}render(er){er===void 0&&(er=this.clock.getDelta());const tr=this.renderer.getRenderTarget();let ir=!1;for(let nr=0,sr=this.passes.length;nr<sr;nr++){const ar=this.passes[nr];if(ar.enabled!==!1){if(ar.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(nr),ar.render(this.renderer,this.writeBuffer,this.readBuffer,er,ir),ar.needsSwap){if(ir){const or=this.renderer.getContext(),lr=this.renderer.state.buffers.stencil;lr.setFunc(or.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,er),lr.setFunc(or.EQUAL,1,4294967295)}this.swapBuffers()}MaskPass$1!==void 0&&(ar instanceof MaskPass$1?ir=!0:ar instanceof ClearMaskPass$1&&(ir=!1))}}this.renderer.setRenderTarget(tr)}reset(er){if(er===void 0){const tr=this.renderer.getSize(new Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=tr.width,this._height=tr.height,er=this.renderTarget1.clone(),er.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=er,this.renderTarget2=er.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(er,tr){this._width=er,this._height=tr;const ir=this._width*this._pixelRatio,nr=this._height*this._pixelRatio;this.renderTarget1.setSize(ir,nr),this.renderTarget2.setSize(ir,nr);for(let sr=0;sr<this.passes.length;sr++)this.passes[sr].setSize(ir,nr)}setPixelRatio(er){this._pixelRatio=er,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}};const FilmShader={name:"FilmShader",uniforms:{tDiffuse:{value:null},time:{value:0},intensity:{value:.5},grayscale:{value:!1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		uniform float intensity;
		uniform bool grayscale;
		uniform float time;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 base = texture2D( tDiffuse, vUv );

			float noise = rand( fract( vUv + time ) );

			vec3 color = base.rgb + base.rgb * clamp( 0.1 + noise, 0.0, 1.0 );

			color = mix( base.rgb, color, intensity );

			if ( grayscale ) {

				color = vec3( luminance( color ) ); // assuming linear-srgb

			}

			gl_FragColor = vec4( color, base.a );

		}`};class FilmPass extends Pass$1{constructor(er=.5,tr=!1){super();const ir=FilmShader;this.uniforms=UniformsUtils.clone(ir.uniforms),this.material=new ShaderMaterial({name:ir.name,uniforms:this.uniforms,vertexShader:ir.vertexShader,fragmentShader:ir.fragmentShader}),this.uniforms.intensity.value=er,this.uniforms.grayscale.value=tr,this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,ir,nr){this.uniforms.tDiffuse.value=ir.texture,this.uniforms.time.value+=nr,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const DigitalGlitch={uniforms:{tDiffuse:{value:null},tDisp:{value:null},byp:{value:0},amount:{value:.08},angle:{value:.02},seed:{value:.02},seed_x:{value:.02},seed_y:{value:.02},distortion_x:{value:.5},distortion_y:{value:.6},col_s:{value:.05}},vertexShader:`

		varying vec2 vUv;
		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		uniform int byp; //should we apply the glitch ?

		uniform sampler2D tDiffuse;
		uniform sampler2D tDisp;

		uniform float amount;
		uniform float angle;
		uniform float seed;
		uniform float seed_x;
		uniform float seed_y;
		uniform float distortion_x;
		uniform float distortion_y;
		uniform float col_s;

		varying vec2 vUv;


		float rand(vec2 co){
			return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
		}

		void main() {
			if(byp<1) {
				vec2 p = vUv;
				float xs = floor(gl_FragCoord.x / 0.5);
				float ys = floor(gl_FragCoord.y / 0.5);
				//based on staffantans glitch shader for unity https://github.com/staffantan/unityglitch
				float disp = texture2D(tDisp, p*seed*seed).r;
				if(p.y<distortion_x+col_s && p.y>distortion_x-col_s*seed) {
					if(seed_x>0.){
						p.y = 1. - (p.y + distortion_y);
					}
					else {
						p.y = distortion_y;
					}
				}
				if(p.x<distortion_y+col_s && p.x>distortion_y-col_s*seed) {
					if(seed_y>0.){
						p.x=distortion_x;
					}
					else {
						p.x = 1. - (p.x + distortion_x);
					}
				}
				p.x+=disp*seed_x*(seed/5.);
				p.y+=disp*seed_y*(seed/5.);
				//base from RGB shift shader
				vec2 offset = amount * vec2( cos(angle), sin(angle));
				vec4 cr = texture2D(tDiffuse, p + offset);
				vec4 cga = texture2D(tDiffuse, p);
				vec4 cb = texture2D(tDiffuse, p - offset);
				gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);
				//add noise
				vec4 snow = 200.*amount*vec4(rand(vec2(xs * seed,ys * seed*50.))*0.2);
				gl_FragColor = gl_FragColor+ snow;
			}
			else {
				gl_FragColor=texture2D (tDiffuse, vUv);
			}
		}`};class GlitchPass extends Pass$1{constructor(er=64){super();const tr=DigitalGlitch;this.uniforms=UniformsUtils.clone(tr.uniforms),this.heightMap=this.generateHeightmap(er),this.uniforms.tDisp.value=this.heightMap,this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material),this.goWild=!1,this.curF=0,this.generateTrigger()}render(er,tr,ir){this.uniforms.tDiffuse.value=ir.texture,this.uniforms.seed.value=Math.random(),this.uniforms.byp.value=0,this.curF%this.randX==0||this.goWild==!0?(this.uniforms.amount.value=Math.random()/30,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.seed_x.value=MathUtils.randFloat(-1,1),this.uniforms.seed_y.value=MathUtils.randFloat(-1,1),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.curF=0,this.generateTrigger()):this.curF%this.randX<this.randX/5?(this.uniforms.amount.value=Math.random()/90,this.uniforms.angle.value=MathUtils.randFloat(-Math.PI,Math.PI),this.uniforms.distortion_x.value=MathUtils.randFloat(0,1),this.uniforms.distortion_y.value=MathUtils.randFloat(0,1),this.uniforms.seed_x.value=MathUtils.randFloat(-.3,.3),this.uniforms.seed_y.value=MathUtils.randFloat(-.3,.3)):this.goWild==!1&&(this.uniforms.byp.value=1),this.curF++,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}generateTrigger(){this.randX=MathUtils.randInt(120,240)}generateHeightmap(er){const tr=new Float32Array(er*er),ir=er*er;for(let sr=0;sr<ir;sr++){const ar=MathUtils.randFloat(0,1);tr[sr]=ar}const nr=new DataTexture(tr,er,er,RedFormat,FloatType);return nr.needsUpdate=!0,nr}dispose(){this.material.dispose(),this.heightMap.dispose(),this.fsQuad.dispose()}}const GTAOShader={name:"GTAOShader",defines:{PERSPECTIVE_CAMERA:1,SAMPLES:16,NORMAL_VECTOR_TYPE:1,DEPTH_SWIZZLING:"x",SCREEN_SPACE_RADIUS:0,SCREEN_SPACE_RADIUS_SCALE:100,SCENE_CLIP_BOX:0},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new Vector2},cameraNear:{value:null},cameraFar:{value:null},cameraProjectionMatrix:{value:new Matrix4},cameraProjectionMatrixInverse:{value:new Matrix4},cameraWorldMatrix:{value:new Matrix4},radius:{value:.25},distanceExponent:{value:1},thickness:{value:1},distanceFallOff:{value:1},scale:{value:1},sceneBoxMin:{value:new Vector3$1(-1,-1,-1)},sceneBoxMax:{value:new Vector3$1(1,1,1)}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		varying vec2 vUv;
		uniform highp sampler2D tNormal;
		uniform highp sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraProjectionMatrixInverse;		
		uniform mat4 cameraWorldMatrix;
		uniform float radius;
		uniform float distanceExponent;
		uniform float thickness;
		uniform float distanceFallOff;
		uniform float scale;
		#if SCENE_CLIP_BOX == 1
			uniform vec3 sceneBoxMin;
			uniform vec3 sceneBoxMax;
		#endif
		
		#include <common>
		#include <packing>

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(vec3(ao), 1.)
		#endif

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}

		float getDepth(const vec2 uv) {  
			return textureLod(tDepth, uv.xy, 0.0).DEPTH_SWIZZLING;
		}

		float fetchDepth(const ivec2 uv) {   
			return texelFetch(tDepth, uv.xy, 0).DEPTH_SWIZZLING;
		}

		float getViewZ(const in float depth) {
			#if PERSPECTIVE_CAMERA == 1
				return perspectiveDepthToViewZ(depth, cameraNear, cameraFar);
			#else
				return orthographicDepthToViewZ(depth, cameraNear, cameraFar);
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ? ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz : -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ? ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz : -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
			#if NORMAL_VECTOR_TYPE == 2
				return normalize(textureLod(tNormal, uv, 0.).rgb);
			#elif NORMAL_VECTOR_TYPE == 1
				return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
			#else
				return computeNormalFromDepth(uv);
			#endif
		}

		vec3 getSceneUvAndDepth(vec3 sampleViewPos) {
			vec4 sampleClipPos = cameraProjectionMatrix * vec4(sampleViewPos, 1.);
			vec2 sampleUv = sampleClipPos.xy / sampleClipPos.w * 0.5 + 0.5;
			float sampleSceneDepth = getDepth(sampleUv);
			return vec3(sampleUv, sampleSceneDepth);
		}
		
		void main() {
			float depth = getDepth(vUv.xy);
			if (depth >= 1.0) {
				discard;
				return;
			}
			vec3 viewPos = getViewPosition(vUv, depth);
			vec3 viewNormal = getViewNormal(vUv);

			float radiusToUse = radius;
			float distanceFalloffToUse = thickness;
			#if SCREEN_SPACE_RADIUS == 1
				float radiusScale = getViewPosition(vec2(0.5 + float(SCREEN_SPACE_RADIUS_SCALE) / resolution.x, 0.0), depth).x;
				radiusToUse *= radiusScale;
				distanceFalloffToUse *= radiusScale;
			#endif

			#if SCENE_CLIP_BOX == 1
				vec3 worldPos = (cameraWorldMatrix * vec4(viewPos, 1.0)).xyz;
				float boxDistance = length(max(vec3(0.0), max(sceneBoxMin - worldPos, worldPos - sceneBoxMax)));
				if (boxDistance > radiusToUse) {
					discard;
					return;
				}
			#endif
			
			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
			vec3 randomVec = noiseTexel.xyz * 2.0 - 1.0;
			vec3 tangent = normalize(vec3(randomVec.xy, 0.));
			vec3 bitangent = vec3(-tangent.y, tangent.x, 0.);
			mat3 kernelMatrix = mat3(tangent, bitangent, vec3(0., 0., 1.));

			const int DIRECTIONS = SAMPLES < 30 ? 3 : 5;
			const int STEPS = (SAMPLES + DIRECTIONS - 1) / DIRECTIONS;
			float ao = 0.0;
			for (int i = 0; i < DIRECTIONS; ++i) {
				
				float angle = float(i) / float(DIRECTIONS) * PI;
				vec4 sampleDir = vec4(cos(angle), sin(angle), 0., 0.5 + 0.5 * noiseTexel.w); 
				sampleDir.xyz = normalize(kernelMatrix * sampleDir.xyz);

				vec3 viewDir = normalize(-viewPos.xyz);
				vec3 sliceBitangent = normalize(cross(sampleDir.xyz, viewDir));
				vec3 sliceTangent = cross(sliceBitangent, viewDir);
				vec3 normalInSlice = normalize(viewNormal - sliceBitangent * dot(viewNormal, sliceBitangent));
				
				vec3 tangentToNormalInSlice = cross(normalInSlice, sliceBitangent);
				vec2 cosHorizons = vec2(dot(viewDir, tangentToNormalInSlice), dot(viewDir, -tangentToNormalInSlice));
				
				for (int j = 0; j < STEPS; ++j) {
					vec3 sampleViewOffset = sampleDir.xyz * radiusToUse * sampleDir.w * pow(float(j + 1) / float(STEPS), distanceExponent);	

					vec3 sampleSceneUvDepth = getSceneUvAndDepth(viewPos + sampleViewOffset);
					vec3 sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					vec3 viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.x += max(0., (sampleCosHorizon - cosHorizons.x) * mix(1., 2. / float(j + 2), distanceFallOff));
					}		

					sampleSceneUvDepth = getSceneUvAndDepth(viewPos - sampleViewOffset);
					sampleSceneViewPos = getViewPosition(sampleSceneUvDepth.xy, sampleSceneUvDepth.z);
					viewDelta = sampleSceneViewPos - viewPos;
					if (abs(viewDelta.z) < thickness) {
						float sampleCosHorizon = dot(viewDir, normalize(viewDelta));
						cosHorizons.y += max(0., (sampleCosHorizon - cosHorizons.y) * mix(1., 2. / float(j + 2), distanceFallOff));
					}
				}

				vec2 sinHorizons = sqrt(1. - cosHorizons * cosHorizons);
				float nx = dot(normalInSlice, sliceTangent);
				float ny = dot(normalInSlice, viewDir);
				float nxb = 1. / 2. * (acos(cosHorizons.y) - acos(cosHorizons.x) + sinHorizons.x * cosHorizons.x - sinHorizons.y * cosHorizons.y);
				float nyb = 1. / 2. * (2. - cosHorizons.x * cosHorizons.x - cosHorizons.y * cosHorizons.y);
				float occlusion = nx * nxb + ny * nyb;
				ao += occlusion;
			}

			ao = clamp(ao / float(DIRECTIONS), 0., 1.);		
		#if SCENE_CLIP_BOX == 1
			ao = mix(ao, 1., smoothstep(0., radiusToUse, boxDistance));
		#endif
			ao = pow(ao, scale);

			gl_FragColor = FRAGMENT_OUTPUT;
		}`},GTAODepthShader={name:"GTAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform sampler2D tDepth;
		uniform float cameraNear;
		uniform float cameraFar;
		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 screenPosition ) {
			#if PERSPECTIVE_CAMERA == 1
				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );
			#else
				return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		void main() {
			float depth = getLinearDepth( vUv );
			gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );

		}`},GTAOBlendShader={name:"GTAOBlendShader",uniforms:{tDiffuse:{value:null},intensity:{value:1}},vertexShader:`
		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		uniform float intensity;
		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {
			vec4 texel = texture2D( tDiffuse, vUv );
			gl_FragColor = vec4(mix(vec3(1.), texel.rgb, intensity), texel.a);
		}`};function generateMagicSquareNoise(rr=5){const er=Math.floor(rr)%2===0?Math.floor(rr)+1:Math.floor(rr),tr=generateMagicSquare(er),ir=tr.length,nr=new Uint8Array(ir*4);for(let ar=0;ar<ir;++ar){const or=tr[ar],lr=2*Math.PI*or/ir,cr=new Vector3$1(Math.cos(lr),Math.sin(lr),0).normalize();nr[ar*4]=(cr.x*.5+.5)*255,nr[ar*4+1]=(cr.y*.5+.5)*255,nr[ar*4+2]=127,nr[ar*4+3]=255}const sr=new DataTexture(nr,er,er);return sr.wrapS=RepeatWrapping,sr.wrapT=RepeatWrapping,sr.needsUpdate=!0,sr}function generateMagicSquare(rr){const er=Math.floor(rr)%2===0?Math.floor(rr)+1:Math.floor(rr),tr=er*er,ir=Array(tr).fill(0);let nr=Math.floor(er/2),sr=er-1;for(let ar=1;ar<=tr;){if(nr===-1&&sr===er?(sr=er-2,nr=0):(sr===er&&(sr=0),nr<0&&(nr=er-1)),ir[nr*er+sr]!==0){sr-=2,nr++;continue}else ir[nr*er+sr]=ar++;sr++,nr--}return ir}const PoissonDenoiseShader={name:"PoissonDenoiseShader",defines:{SAMPLES:16,SAMPLE_VECTORS:generatePdSamplePointInitializer(16,2,1),NORMAL_VECTOR_TYPE:1,DEPTH_VALUE_SOURCE:0},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},resolution:{value:new Vector2},cameraProjectionMatrixInverse:{value:new Matrix4},lumaPhi:{value:5},depthPhi:{value:5},normalPhi:{value:5},radius:{value:4},index:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tDiffuse;
		uniform sampler2D tNormal;
		uniform sampler2D tDepth;
		uniform sampler2D tNoise;
		uniform vec2 resolution;
		uniform mat4 cameraProjectionMatrixInverse;
		uniform float lumaPhi;
		uniform float depthPhi;
		uniform float normalPhi;
		uniform float radius;
		uniform int index;
		
		#include <common>
		#include <packing>

		#ifndef SAMPLE_LUMINANCE
		#define SAMPLE_LUMINANCE dot(vec3(0.2125, 0.7154, 0.0721), a)
		#endif

		#ifndef FRAGMENT_OUTPUT
		#define FRAGMENT_OUTPUT vec4(denoised, 1.)
		#endif

		float getLuminance(const in vec3 a) {
			return SAMPLE_LUMINANCE;
		}

		const vec3 poissonDisk[SAMPLES] = SAMPLE_VECTORS;

		vec3 getViewPosition(const in vec2 screenPosition, const in float depth) {
			vec4 clipSpacePosition = vec4(vec3(screenPosition, depth) * 2.0 - 1.0, 1.0);
			vec4 viewSpacePosition = cameraProjectionMatrixInverse * clipSpacePosition;
			return viewSpacePosition.xyz / viewSpacePosition.w;
		}
		
		float getDepth(const vec2 uv) {
		#if DEPTH_VALUE_SOURCE == 1    
			return textureLod(tDepth, uv.xy, 0.0).a;
		#else
			return textureLod(tDepth, uv.xy, 0.0).r;
		#endif
		}

		float fetchDepth(const ivec2 uv) {
			#if DEPTH_VALUE_SOURCE == 1    
				return texelFetch(tDepth, uv.xy, 0).a;
			#else
				return texelFetch(tDepth, uv.xy, 0).r;
			#endif
		}

		vec3 computeNormalFromDepth(const vec2 uv) {
			vec2 size = vec2(textureSize(tDepth, 0));
			ivec2 p = ivec2(uv * size);
			float c0 = fetchDepth(p);
			float l2 = fetchDepth(p - ivec2(2, 0));
			float l1 = fetchDepth(p - ivec2(1, 0));
			float r1 = fetchDepth(p + ivec2(1, 0));
			float r2 = fetchDepth(p + ivec2(2, 0));
			float b2 = fetchDepth(p - ivec2(0, 2));
			float b1 = fetchDepth(p - ivec2(0, 1));
			float t1 = fetchDepth(p + ivec2(0, 1));
			float t2 = fetchDepth(p + ivec2(0, 2));
			float dl = abs((2.0 * l1 - l2) - c0);
			float dr = abs((2.0 * r1 - r2) - c0);
			float db = abs((2.0 * b1 - b2) - c0);
			float dt = abs((2.0 * t1 - t2) - c0);
			vec3 ce = getViewPosition(uv, c0).xyz;
			vec3 dpdx = (dl < dr) ?  ce - getViewPosition((uv - vec2(1.0 / size.x, 0.0)), l1).xyz
									: -ce + getViewPosition((uv + vec2(1.0 / size.x, 0.0)), r1).xyz;
			vec3 dpdy = (db < dt) ?  ce - getViewPosition((uv - vec2(0.0, 1.0 / size.y)), b1).xyz
									: -ce + getViewPosition((uv + vec2(0.0, 1.0 / size.y)), t1).xyz;
			return normalize(cross(dpdx, dpdy));
		}

		vec3 getViewNormal(const vec2 uv) {
		#if NORMAL_VECTOR_TYPE == 2
			return normalize(textureLod(tNormal, uv, 0.).rgb);
		#elif NORMAL_VECTOR_TYPE == 1
			return unpackRGBToNormal(textureLod(tNormal, uv, 0.).rgb);
		#else
			return computeNormalFromDepth(uv);
		#endif
		}

		void denoiseSample(in vec3 center, in vec3 viewNormal, in vec3 viewPos, in vec2 sampleUv, inout vec3 denoised, inout float totalWeight) {
			vec4 sampleTexel = textureLod(tDiffuse, sampleUv, 0.0);
			float sampleDepth = getDepth(sampleUv);
			vec3 sampleNormal = getViewNormal(sampleUv);
			vec3 neighborColor = sampleTexel.rgb;
			vec3 viewPosSample = getViewPosition(sampleUv, sampleDepth);
			
			float normalDiff = dot(viewNormal, sampleNormal);
			float normalSimilarity = pow(max(normalDiff, 0.), normalPhi);
			float lumaDiff = abs(getLuminance(neighborColor) - getLuminance(center));
			float lumaSimilarity = max(1.0 - lumaDiff / lumaPhi, 0.0);
			float depthDiff = abs(dot(viewPos - viewPosSample, viewNormal));
			float depthSimilarity = max(1. - depthDiff / depthPhi, 0.);
			float w = lumaSimilarity * depthSimilarity * normalSimilarity;
		
			denoised += w * neighborColor;
			totalWeight += w;
		}
		
		void main() {
			float depth = getDepth(vUv.xy);	
			vec3 viewNormal = getViewNormal(vUv);	
			if (depth == 1. || dot(viewNormal, viewNormal) == 0.) {
				discard;
				return;
			}
			vec4 texel = textureLod(tDiffuse, vUv, 0.0);
			vec3 center = texel.rgb;
			vec3 viewPos = getViewPosition(vUv, depth);

			vec2 noiseResolution = vec2(textureSize(tNoise, 0));
			vec2 noiseUv = vUv * resolution / noiseResolution;
			vec4 noiseTexel = textureLod(tNoise, noiseUv, 0.0);
      		vec2 noiseVec = vec2(sin(noiseTexel[index % 4] * 2. * PI), cos(noiseTexel[index % 4] * 2. * PI));
    		mat2 rotationMatrix = mat2(noiseVec.x, -noiseVec.y, noiseVec.x, noiseVec.y);
		
			float totalWeight = 1.0;
			vec3 denoised = texel.rgb;
			for (int i = 0; i < SAMPLES; i++) {
				vec3 sampleDir = poissonDisk[i];
				vec2 offset = rotationMatrix * (sampleDir.xy * (1. + sampleDir.z * (radius - 1.)) / resolution);
				vec2 sampleUv = vUv + offset;
				denoiseSample(center, viewNormal, viewPos, sampleUv, denoised, totalWeight);
			}
		
			if (totalWeight > 0.) { 
				denoised /= totalWeight;
			}
			gl_FragColor = FRAGMENT_OUTPUT;
		}`};function generatePdSamplePointInitializer(rr,er,tr){const ir=generateDenoiseSamples(rr,er,tr);let nr="vec3[SAMPLES](";for(let sr=0;sr<rr;sr++){const ar=ir[sr];nr+=`vec3(${ar.x}, ${ar.y}, ${ar.z})${sr<rr-1?",":")"}`}return nr}function generateDenoiseSamples(rr,er,tr){const ir=[];for(let nr=0;nr<rr;nr++){const sr=2*Math.PI*er*nr/rr,ar=Math.pow(nr/(rr-1),tr);ir.push(new Vector3$1(Math.cos(sr),Math.sin(sr),ar))}return ir}class GTAOPass extends Pass$1{constructor(er,tr,ir,nr,sr,ar,or){super(),this.width=ir!==void 0?ir:512,this.height=nr!==void 0?nr:512,this.clear=!0,this.camera=tr,this.scene=er,this.output=0,this._renderGBuffer=!0,this._visibilityCache=new Map,this.blendIntensity=1,this.pdRings=2,this.pdRadiusExponent=2,this.pdSamples=16,this.gtaoNoiseTexture=generateMagicSquareNoise(),this.pdNoiseTexture=this.generateNoise(),this.gtaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{type:HalfFloatType}),this.pdRenderTarget=this.gtaoRenderTarget.clone(),this.gtaoMaterial=new ShaderMaterial({defines:Object.assign({},GTAOShader.defines),uniforms:UniformsUtils.clone(GTAOShader.uniforms),vertexShader:GTAOShader.vertexShader,fragmentShader:GTAOShader.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.gtaoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.gtaoMaterial.uniforms.tNoise.value=this.gtaoNoiseTexture,this.gtaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.pdMaterial=new ShaderMaterial({defines:Object.assign({},PoissonDenoiseShader.defines),uniforms:UniformsUtils.clone(PoissonDenoiseShader.uniforms),vertexShader:PoissonDenoiseShader.vertexShader,fragmentShader:PoissonDenoiseShader.fragmentShader,depthTest:!1,depthWrite:!1}),this.pdMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.pdMaterial.uniforms.tNoise.value=this.pdNoiseTexture,this.pdMaterial.uniforms.resolution.value.set(this.width,this.height),this.pdMaterial.uniforms.lumaPhi.value=10,this.pdMaterial.uniforms.depthPhi.value=2,this.pdMaterial.uniforms.normalPhi.value=3,this.pdMaterial.uniforms.radius.value=8,this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},GTAODepthShader.defines),uniforms:UniformsUtils.clone(GTAODepthShader.uniforms),vertexShader:GTAODepthShader.vertexShader,fragmentShader:GTAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.blendMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(GTAOBlendShader.uniforms),vertexShader:GTAOBlendShader.vertexShader,fragmentShader:GTAOBlendShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blending:CustomBlending,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color,this.setGBuffer(sr?sr.depthTexture:void 0,sr?sr.normalTexture:void 0),ar!==void 0&&this.updateGtaoMaterial(ar),or!==void 0&&this.updatePdMaterial(or)}dispose(){this.gtaoNoiseTexture.dispose(),this.pdNoiseTexture.dispose(),this.normalRenderTarget.dispose(),this.gtaoRenderTarget.dispose(),this.pdRenderTarget.dispose(),this.normalMaterial.dispose(),this.pdMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}get gtaoMap(){return this.pdRenderTarget.texture}setGBuffer(er,tr){er!==void 0?(this.depthTexture=er,this.normalTexture=tr,this._renderGBuffer=!1):(this.depthTexture=new DepthTexture,this.depthTexture.format=DepthStencilFormat,this.depthTexture.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:this.depthTexture}),this.normalTexture=this.normalRenderTarget.texture,this._renderGBuffer=!0);const ir=this.normalTexture?1:0,nr=this.depthTexture===this.normalTexture?"w":"x";this.gtaoMaterial.defines.NORMAL_VECTOR_TYPE=ir,this.gtaoMaterial.defines.DEPTH_SWIZZLING=nr,this.gtaoMaterial.uniforms.tNormal.value=this.normalTexture,this.gtaoMaterial.uniforms.tDepth.value=this.depthTexture,this.pdMaterial.defines.NORMAL_VECTOR_TYPE=ir,this.pdMaterial.defines.DEPTH_SWIZZLING=nr,this.pdMaterial.uniforms.tNormal.value=this.normalTexture,this.pdMaterial.uniforms.tDepth.value=this.depthTexture,this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture}setSceneClipBox(er){er?(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX!==1,this.gtaoMaterial.defines.SCENE_CLIP_BOX=1,this.gtaoMaterial.uniforms.sceneBoxMin.value.copy(er.min),this.gtaoMaterial.uniforms.sceneBoxMax.value.copy(er.max)):(this.gtaoMaterial.needsUpdate=this.gtaoMaterial.defines.SCENE_CLIP_BOX===0,this.gtaoMaterial.defines.SCENE_CLIP_BOX=0)}updateGtaoMaterial(er){er.radius!==void 0&&(this.gtaoMaterial.uniforms.radius.value=er.radius),er.distanceExponent!==void 0&&(this.gtaoMaterial.uniforms.distanceExponent.value=er.distanceExponent),er.thickness!==void 0&&(this.gtaoMaterial.uniforms.thickness.value=er.thickness),er.distanceFallOff!==void 0&&(this.gtaoMaterial.uniforms.distanceFallOff.value=er.distanceFallOff,this.gtaoMaterial.needsUpdate=!0),er.scale!==void 0&&(this.gtaoMaterial.uniforms.scale.value=er.scale),er.samples!==void 0&&er.samples!==this.gtaoMaterial.defines.SAMPLES&&(this.gtaoMaterial.defines.SAMPLES=er.samples,this.gtaoMaterial.needsUpdate=!0),er.screenSpaceRadius!==void 0&&(er.screenSpaceRadius?1:0)!==this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS&&(this.gtaoMaterial.defines.SCREEN_SPACE_RADIUS=er.screenSpaceRadius?1:0,this.gtaoMaterial.needsUpdate=!0)}updatePdMaterial(er){let tr=!1;er.lumaPhi!==void 0&&(this.pdMaterial.uniforms.lumaPhi.value=er.lumaPhi),er.depthPhi!==void 0&&(this.pdMaterial.uniforms.depthPhi.value=er.depthPhi),er.normalPhi!==void 0&&(this.pdMaterial.uniforms.normalPhi.value=er.normalPhi),er.radius!==void 0&&er.radius!==this.radius&&(this.pdMaterial.uniforms.radius.value=er.radius),er.radiusExponent!==void 0&&er.radiusExponent!==this.pdRadiusExponent&&(this.pdRadiusExponent=er.radiusExponent,tr=!0),er.rings!==void 0&&er.rings!==this.pdRings&&(this.pdRings=er.rings,tr=!0),er.samples!==void 0&&er.samples!==this.pdSamples&&(this.pdSamples=er.samples,tr=!0),tr&&(this.pdMaterial.defines.SAMPLES=this.pdSamples,this.pdMaterial.defines.SAMPLE_VECTORS=generatePdSamplePointInitializer(this.pdSamples,this.pdRings,this.pdRadiusExponent),this.pdMaterial.needsUpdate=!0)}render(er,tr,ir){switch(this._renderGBuffer&&(this.overrideVisibility(),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility()),this.gtaoMaterial.uniforms.cameraNear.value=this.camera.near,this.gtaoMaterial.uniforms.cameraFar.value=this.camera.far,this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.gtaoMaterial.uniforms.cameraWorldMatrix.value.copy(this.camera.matrixWorld),this.renderPass(er,this.gtaoMaterial,this.gtaoRenderTarget,16777215,1),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.renderPass(er,this.pdMaterial,this.pdRenderTarget,16777215,1),this.output){case GTAOPass.OUTPUT.Off:break;case GTAOPass.OUTPUT.Diffuse:this.copyMaterial.uniforms.tDiffuse.value=ir.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.AO:this.copyMaterial.uniforms.tDiffuse.value=this.gtaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Denoise:this.copyMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Depth:this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case GTAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=ir.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.blendMaterial.uniforms.intensity.value=this.blendIntensity,this.blendMaterial.uniforms.tDiffuse.value=this.pdRenderTarget.texture,this.renderPass(er,this.blendMaterial,this.renderToScreen?null:tr);break;default:console.warn("THREE.GTAOPass: Unknown output type.")}}renderPass(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.width=er,this.height=tr,this.gtaoRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.pdRenderTarget.setSize(er,tr),this.gtaoMaterial.uniforms.resolution.value.set(er,tr),this.gtaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.gtaoMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse),this.pdMaterial.uniforms.resolution.value.set(er,tr),this.pdMaterial.uniforms.cameraProjectionMatrixInverse.value.copy(this.camera.projectionMatrixInverse)}overrideVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(ir){tr.set(ir,ir.visible),(ir.isPoints||ir.isLine)&&(ir.visible=!1)})}restoreVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(ir){const nr=tr.get(ir);ir.visible=nr}),tr.clear()}generateNoise(er=64){const tr=new SimplexNoise,ir=er*er*4,nr=new Uint8Array(ir);for(let ar=0;ar<er;ar++)for(let or=0;or<er;or++){const lr=ar,cr=or;nr[(ar*er+or)*4]=(tr.noise(lr,cr)*.5+.5)*255,nr[(ar*er+or)*4+1]=(tr.noise(lr+er,cr)*.5+.5)*255,nr[(ar*er+or)*4+2]=(tr.noise(lr,cr+er)*.5+.5)*255,nr[(ar*er+or)*4+3]=(tr.noise(lr+er,cr+er)*.5+.5)*255}const sr=new DataTexture(nr,er,er,RGBAFormat,UnsignedByteType);return sr.wrapS=RepeatWrapping,sr.wrapT=RepeatWrapping,sr.needsUpdate=!0,sr}}GTAOPass.OUTPUT={Off:-1,Default:0,Diffuse:1,Depth:2,Normal:3,AO:4,Denoise:5};const HalftoneShader={name:"HalftoneShader",uniforms:{tDiffuse:{value:null},shape:{value:1},radius:{value:4},rotateR:{value:Math.PI/12*1},rotateG:{value:Math.PI/12*2},rotateB:{value:Math.PI/12*3},scatter:{value:0},width:{value:1},height:{value:1},blending:{value:1},blendingMode:{value:1},greyscale:{value:!1},disable:{value:!1}},vertexShader:`

		varying vec2 vUV;

		void main() {

			vUV = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);

		}`,fragmentShader:`

		#define SQRT2_MINUS_ONE 0.41421356
		#define SQRT2_HALF_MINUS_ONE 0.20710678
		#define PI2 6.28318531
		#define SHAPE_DOT 1
		#define SHAPE_ELLIPSE 2
		#define SHAPE_LINE 3
		#define SHAPE_SQUARE 4
		#define BLENDING_LINEAR 1
		#define BLENDING_MULTIPLY 2
		#define BLENDING_ADD 3
		#define BLENDING_LIGHTER 4
		#define BLENDING_DARKER 5
		uniform sampler2D tDiffuse;
		uniform float radius;
		uniform float rotateR;
		uniform float rotateG;
		uniform float rotateB;
		uniform float scatter;
		uniform float width;
		uniform float height;
		uniform int shape;
		uniform bool disable;
		uniform float blending;
		uniform int blendingMode;
		varying vec2 vUV;
		uniform bool greyscale;
		const int samples = 8;

		float blend( float a, float b, float t ) {

		// linear blend
			return a * ( 1.0 - t ) + b * t;

		}

		float hypot( float x, float y ) {

		// vector magnitude
			return sqrt( x * x + y * y );

		}

		float rand( vec2 seed ){

		// get pseudo-random number
			return fract( sin( dot( seed.xy, vec2( 12.9898, 78.233 ) ) ) * 43758.5453 );

		}

		float distanceToDotRadius( float channel, vec2 coord, vec2 normal, vec2 p, float angle, float rad_max ) {

		// apply shape-specific transforms
			float dist = hypot( coord.x - p.x, coord.y - p.y );
			float rad = channel;

			if ( shape == SHAPE_DOT ) {

				rad = pow( abs( rad ), 1.125 ) * rad_max;

			} else if ( shape == SHAPE_ELLIPSE ) {

				rad = pow( abs( rad ), 1.125 ) * rad_max;

				if ( dist != 0.0 ) {
					float dot_p = abs( ( p.x - coord.x ) / dist * normal.x + ( p.y - coord.y ) / dist * normal.y );
					dist = ( dist * ( 1.0 - SQRT2_HALF_MINUS_ONE ) ) + dot_p * dist * SQRT2_MINUS_ONE;
				}

			} else if ( shape == SHAPE_LINE ) {

				rad = pow( abs( rad ), 1.5) * rad_max;
				float dot_p = ( p.x - coord.x ) * normal.x + ( p.y - coord.y ) * normal.y;
				dist = hypot( normal.x * dot_p, normal.y * dot_p );

			} else if ( shape == SHAPE_SQUARE ) {

				float theta = atan( p.y - coord.y, p.x - coord.x ) - angle;
				float sin_t = abs( sin( theta ) );
				float cos_t = abs( cos( theta ) );
				rad = pow( abs( rad ), 1.4 );
				rad = rad_max * ( rad + ( ( sin_t > cos_t ) ? rad - sin_t * rad : rad - cos_t * rad ) );

			}

			return rad - dist;

		}

		struct Cell {

		// grid sample positions
			vec2 normal;
			vec2 p1;
			vec2 p2;
			vec2 p3;
			vec2 p4;
			float samp2;
			float samp1;
			float samp3;
			float samp4;

		};

		vec4 getSample( vec2 point ) {

		// multi-sampled point
			vec4 tex = texture2D( tDiffuse, vec2( point.x / width, point.y / height ) );
			float base = rand( vec2( floor( point.x ), floor( point.y ) ) ) * PI2;
			float step = PI2 / float( samples );
			float dist = radius * 0.66;

			for ( int i = 0; i < samples; ++i ) {

				float r = base + step * float( i );
				vec2 coord = point + vec2( cos( r ) * dist, sin( r ) * dist );
				tex += texture2D( tDiffuse, vec2( coord.x / width, coord.y / height ) );

			}

			tex /= float( samples ) + 1.0;
			return tex;

		}

		float getDotColour( Cell c, vec2 p, int channel, float angle, float aa ) {

		// get colour for given point
			float dist_c_1, dist_c_2, dist_c_3, dist_c_4, res;

			if ( channel == 0 ) {

				c.samp1 = getSample( c.p1 ).r;
				c.samp2 = getSample( c.p2 ).r;
				c.samp3 = getSample( c.p3 ).r;
				c.samp4 = getSample( c.p4 ).r;

			} else if (channel == 1) {

				c.samp1 = getSample( c.p1 ).g;
				c.samp2 = getSample( c.p2 ).g;
				c.samp3 = getSample( c.p3 ).g;
				c.samp4 = getSample( c.p4 ).g;

			} else {

				c.samp1 = getSample( c.p1 ).b;
				c.samp3 = getSample( c.p3 ).b;
				c.samp2 = getSample( c.p2 ).b;
				c.samp4 = getSample( c.p4 ).b;

			}

			dist_c_1 = distanceToDotRadius( c.samp1, c.p1, c.normal, p, angle, radius );
			dist_c_2 = distanceToDotRadius( c.samp2, c.p2, c.normal, p, angle, radius );
			dist_c_3 = distanceToDotRadius( c.samp3, c.p3, c.normal, p, angle, radius );
			dist_c_4 = distanceToDotRadius( c.samp4, c.p4, c.normal, p, angle, radius );
			res = ( dist_c_1 > 0.0 ) ? clamp( dist_c_1 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_2 > 0.0 ) ? clamp( dist_c_2 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_3 > 0.0 ) ? clamp( dist_c_3 / aa, 0.0, 1.0 ) : 0.0;
			res += ( dist_c_4 > 0.0 ) ? clamp( dist_c_4 / aa, 0.0, 1.0 ) : 0.0;
			res = clamp( res, 0.0, 1.0 );

			return res;

		}

		Cell getReferenceCell( vec2 p, vec2 origin, float grid_angle, float step ) {

		// get containing cell
			Cell c;

		// calc grid
			vec2 n = vec2( cos( grid_angle ), sin( grid_angle ) );
			float threshold = step * 0.5;
			float dot_normal = n.x * ( p.x - origin.x ) + n.y * ( p.y - origin.y );
			float dot_line = -n.y * ( p.x - origin.x ) + n.x * ( p.y - origin.y );
			vec2 offset = vec2( n.x * dot_normal, n.y * dot_normal );
			float offset_normal = mod( hypot( offset.x, offset.y ), step );
			float normal_dir = ( dot_normal < 0.0 ) ? 1.0 : -1.0;
			float normal_scale = ( ( offset_normal < threshold ) ? -offset_normal : step - offset_normal ) * normal_dir;
			float offset_line = mod( hypot( ( p.x - offset.x ) - origin.x, ( p.y - offset.y ) - origin.y ), step );
			float line_dir = ( dot_line < 0.0 ) ? 1.0 : -1.0;
			float line_scale = ( ( offset_line < threshold ) ? -offset_line : step - offset_line ) * line_dir;

		// get closest corner
			c.normal = n;
			c.p1.x = p.x - n.x * normal_scale + n.y * line_scale;
			c.p1.y = p.y - n.y * normal_scale - n.x * line_scale;

		// scatter
			if ( scatter != 0.0 ) {

				float off_mag = scatter * threshold * 0.5;
				float off_angle = rand( vec2( floor( c.p1.x ), floor( c.p1.y ) ) ) * PI2;
				c.p1.x += cos( off_angle ) * off_mag;
				c.p1.y += sin( off_angle ) * off_mag;

			}

		// find corners
			float normal_step = normal_dir * ( ( offset_normal < threshold ) ? step : -step );
			float line_step = line_dir * ( ( offset_line < threshold ) ? step : -step );
			c.p2.x = c.p1.x - n.x * normal_step;
			c.p2.y = c.p1.y - n.y * normal_step;
			c.p3.x = c.p1.x + n.y * line_step;
			c.p3.y = c.p1.y - n.x * line_step;
			c.p4.x = c.p1.x - n.x * normal_step + n.y * line_step;
			c.p4.y = c.p1.y - n.y * normal_step - n.x * line_step;

			return c;

		}

		float blendColour( float a, float b, float t ) {

		// blend colours
			if ( blendingMode == BLENDING_LINEAR ) {
				return blend( a, b, 1.0 - t );
			} else if ( blendingMode == BLENDING_ADD ) {
				return blend( a, min( 1.0, a + b ), t );
			} else if ( blendingMode == BLENDING_MULTIPLY ) {
				return blend( a, max( 0.0, a * b ), t );
			} else if ( blendingMode == BLENDING_LIGHTER ) {
				return blend( a, max( a, b ), t );
			} else if ( blendingMode == BLENDING_DARKER ) {
				return blend( a, min( a, b ), t );
			} else {
				return blend( a, b, 1.0 - t );
			}

		}

		void main() {

			if ( ! disable ) {

		// setup
				vec2 p = vec2( vUV.x * width, vUV.y * height );
				vec2 origin = vec2( 0, 0 );
				float aa = ( radius < 2.5 ) ? radius * 0.5 : 1.25;

		// get channel samples
				Cell cell_r = getReferenceCell( p, origin, rotateR, radius );
				Cell cell_g = getReferenceCell( p, origin, rotateG, radius );
				Cell cell_b = getReferenceCell( p, origin, rotateB, radius );
				float r = getDotColour( cell_r, p, 0, rotateR, aa );
				float g = getDotColour( cell_g, p, 1, rotateG, aa );
				float b = getDotColour( cell_b, p, 2, rotateB, aa );

		// blend with original
				vec4 colour = texture2D( tDiffuse, vUV );
				r = blendColour( r, colour.r, blending );
				g = blendColour( g, colour.g, blending );
				b = blendColour( b, colour.b, blending );

				if ( greyscale ) {
					r = g = b = (r + b + g) / 3.0;
				}

				gl_FragColor = vec4( r, g, b, 1.0 );

			} else {

				gl_FragColor = texture2D( tDiffuse, vUV );

			}

		}`};class HalftonePass extends Pass$1{constructor(er,tr,ir){super(),this.uniforms=UniformsUtils.clone(HalftoneShader.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,fragmentShader:HalftoneShader.fragmentShader,vertexShader:HalftoneShader.vertexShader}),this.uniforms.width.value=er,this.uniforms.height.value=tr;for(const nr in ir)ir.hasOwnProperty(nr)&&this.uniforms.hasOwnProperty(nr)&&(this.uniforms[nr].value=ir[nr]);this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,ir){this.material.uniforms.tDiffuse.value=ir.texture,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}setSize(er,tr){this.uniforms.width.value=er,this.uniforms.height.value=tr}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const LUTShader={name:"LUTShader",uniforms:{lut:{value:null},lutSize:{value:0},tDiffuse:{value:null},intensity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform float lutSize;
		uniform sampler3D lut;

		varying vec2 vUv;
		uniform float intensity;
		uniform sampler2D tDiffuse;
		void main() {

			vec4 val = texture2D( tDiffuse, vUv );
			vec4 lutVal;

			// pull the sample in by half a pixel so the sample begins
			// at the center of the edge pixels.
			float pixelWidth = 1.0 / lutSize;
			float halfPixelWidth = 0.5 / lutSize;
			vec3 uvw = vec3( halfPixelWidth ) + val.rgb * ( 1.0 - pixelWidth );


			lutVal = vec4( texture( lut, uvw ).rgb, val.a );

			gl_FragColor = vec4( mix( val, lutVal, intensity ) );

		}

	`};class LUTPass extends ShaderPass$1{set lut(er){const tr=this.material;er!==this.lut&&(tr.uniforms.lut.value=null,er&&(tr.uniforms.lutSize.value=er.image.width,tr.uniforms.lut.value=er))}get lut(){return this.material.uniforms.lut.value}set intensity(er){this.material.uniforms.intensity.value=er}get intensity(){return this.material.uniforms.intensity.value}constructor(er={}){super(LUTShader),this.lut=er.lut||null,this.intensity="intensity"in er?er.intensity:1}}class OutlinePass extends Pass$1{constructor(er,tr,ir,nr){super(),this.renderScene=tr,this.renderCamera=ir,this.selectedObjects=nr!==void 0?nr:[],this.visibleEdgeColor=new Color(1,1,1),this.hiddenEdgeColor=new Color(.1,.04,.02),this.edgeGlow=0,this.usePatternTexture=!1,this.edgeThickness=1,this.edgeStrength=3,this.downSampleRatio=2,this.pulsePeriod=0,this._visibilityCache=new Map,this._selectionCache=new Set,this.resolution=er!==void 0?new Vector2(er.x,er.y):new Vector2(256,256);const sr=Math.round(this.resolution.x/this.downSampleRatio),ar=Math.round(this.resolution.y/this.downSampleRatio);this.renderTargetMaskBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y),this.renderTargetMaskBuffer.texture.name="OutlinePass.mask",this.renderTargetMaskBuffer.texture.generateMipmaps=!1,this.depthMaterial=new MeshDepthMaterial,this.depthMaterial.side=DoubleSide,this.depthMaterial.depthPacking=RGBADepthPacking,this.depthMaterial.blending=NoBlending,this.prepareMaskMaterial=this.getPrepareMaskMaterial(),this.prepareMaskMaterial.side=DoubleSide,this.prepareMaskMaterial.fragmentShader=ur(this.prepareMaskMaterial.fragmentShader,this.renderCamera),this.renderTargetDepthBuffer=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:HalfFloatType}),this.renderTargetDepthBuffer.texture.name="OutlinePass.depth",this.renderTargetDepthBuffer.texture.generateMipmaps=!1,this.renderTargetMaskDownSampleBuffer=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetMaskDownSampleBuffer.texture.name="OutlinePass.depthDownSample",this.renderTargetMaskDownSampleBuffer.texture.generateMipmaps=!1,this.renderTargetBlurBuffer1=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetBlurBuffer1.texture.name="OutlinePass.blur1",this.renderTargetBlurBuffer1.texture.generateMipmaps=!1,this.renderTargetBlurBuffer2=new WebGLRenderTarget(Math.round(sr/2),Math.round(ar/2),{type:HalfFloatType}),this.renderTargetBlurBuffer2.texture.name="OutlinePass.blur2",this.renderTargetBlurBuffer2.texture.generateMipmaps=!1,this.edgeDetectionMaterial=this.getEdgeDetectionMaterial(),this.renderTargetEdgeBuffer1=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetEdgeBuffer1.texture.name="OutlinePass.edge1",this.renderTargetEdgeBuffer1.texture.generateMipmaps=!1,this.renderTargetEdgeBuffer2=new WebGLRenderTarget(Math.round(sr/2),Math.round(ar/2),{type:HalfFloatType}),this.renderTargetEdgeBuffer2.texture.name="OutlinePass.edge2",this.renderTargetEdgeBuffer2.texture.generateMipmaps=!1;const or=4,lr=4;this.separableBlurMaterial1=this.getSeperableBlurMaterial(or),this.separableBlurMaterial1.uniforms.texSize.value.set(sr,ar),this.separableBlurMaterial1.uniforms.kernelRadius.value=1,this.separableBlurMaterial2=this.getSeperableBlurMaterial(lr),this.separableBlurMaterial2.uniforms.texSize.value.set(Math.round(sr/2),Math.round(ar/2)),this.separableBlurMaterial2.uniforms.kernelRadius.value=lr,this.overlayMaterial=this.getOverlayMaterial();const cr=CopyShader;this.copyUniforms=UniformsUtils.clone(cr.uniforms),this.materialCopy=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:cr.vertexShader,fragmentShader:cr.fragmentShader,blending:NoBlending,depthTest:!1,depthWrite:!1}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.fsQuad=new FullScreenQuad(null),this.tempPulseColor1=new Color,this.tempPulseColor2=new Color,this.textureMatrix=new Matrix4;function ur(dr,hr){const pr=hr.isPerspectiveCamera?"perspective":"orthographic";return dr.replace(/DEPTH_TO_VIEW_Z/g,pr+"DepthToViewZ")}}dispose(){this.renderTargetMaskBuffer.dispose(),this.renderTargetDepthBuffer.dispose(),this.renderTargetMaskDownSampleBuffer.dispose(),this.renderTargetBlurBuffer1.dispose(),this.renderTargetBlurBuffer2.dispose(),this.renderTargetEdgeBuffer1.dispose(),this.renderTargetEdgeBuffer2.dispose(),this.depthMaterial.dispose(),this.prepareMaskMaterial.dispose(),this.edgeDetectionMaterial.dispose(),this.separableBlurMaterial1.dispose(),this.separableBlurMaterial2.dispose(),this.overlayMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.renderTargetMaskBuffer.setSize(er,tr),this.renderTargetDepthBuffer.setSize(er,tr);let ir=Math.round(er/this.downSampleRatio),nr=Math.round(tr/this.downSampleRatio);this.renderTargetMaskDownSampleBuffer.setSize(ir,nr),this.renderTargetBlurBuffer1.setSize(ir,nr),this.renderTargetEdgeBuffer1.setSize(ir,nr),this.separableBlurMaterial1.uniforms.texSize.value.set(ir,nr),ir=Math.round(ir/2),nr=Math.round(nr/2),this.renderTargetBlurBuffer2.setSize(ir,nr),this.renderTargetEdgeBuffer2.setSize(ir,nr),this.separableBlurMaterial2.uniforms.texSize.value.set(ir,nr)}updateSelectionCache(){const er=this._selectionCache;function tr(ir){ir.isMesh&&er.add(ir)}er.clear();for(let ir=0;ir<this.selectedObjects.length;ir++)this.selectedObjects[ir].traverse(tr)}changeVisibilityOfSelectedObjects(er){const tr=this._visibilityCache;for(const ir of this._selectionCache)er===!0?ir.visible=tr.get(ir):(tr.set(ir,ir.visible),ir.visible=er)}changeVisibilityOfNonSelectedObjects(er){const tr=this._visibilityCache,ir=this._selectionCache;function nr(sr){if(sr.isMesh||sr.isSprite){if(!ir.has(sr)){const ar=sr.visible;(er===!1||tr.get(sr)===!0)&&(sr.visible=er),tr.set(sr,ar)}}else(sr.isPoints||sr.isLine)&&(er===!0?sr.visible=tr.get(sr):(tr.set(sr,sr.visible),sr.visible=er))}this.renderScene.traverse(nr)}updateTextureMatrix(){this.textureMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),this.textureMatrix.multiply(this.renderCamera.projectionMatrix),this.textureMatrix.multiply(this.renderCamera.matrixWorldInverse)}render(er,tr,ir,nr,sr){if(this.selectedObjects.length>0){er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const ar=er.autoClear;er.autoClear=!1,sr&&er.state.buffers.stencil.setTest(!1),er.setClearColor(16777215,1),this.updateSelectionCache(),this.changeVisibilityOfSelectedObjects(!1);const or=this.renderScene.background;if(this.renderScene.background=null,this.renderScene.overrideMaterial=this.depthMaterial,er.setRenderTarget(this.renderTargetDepthBuffer),er.clear(),er.render(this.renderScene,this.renderCamera),this.changeVisibilityOfSelectedObjects(!0),this._visibilityCache.clear(),this.updateTextureMatrix(),this.changeVisibilityOfNonSelectedObjects(!1),this.renderScene.overrideMaterial=this.prepareMaskMaterial,this.prepareMaskMaterial.uniforms.cameraNearFar.value.set(this.renderCamera.near,this.renderCamera.far),this.prepareMaskMaterial.uniforms.depthTexture.value=this.renderTargetDepthBuffer.texture,this.prepareMaskMaterial.uniforms.textureMatrix.value=this.textureMatrix,er.setRenderTarget(this.renderTargetMaskBuffer),er.clear(),er.render(this.renderScene,this.renderCamera),this.renderScene.overrideMaterial=null,this.changeVisibilityOfNonSelectedObjects(!0),this._visibilityCache.clear(),this._selectionCache.clear(),this.renderScene.background=or,this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetMaskBuffer.texture,er.setRenderTarget(this.renderTargetMaskDownSampleBuffer),er.clear(),this.fsQuad.render(er),this.tempPulseColor1.copy(this.visibleEdgeColor),this.tempPulseColor2.copy(this.hiddenEdgeColor),this.pulsePeriod>0){const lr=.625+Math.cos(performance.now()*.01/this.pulsePeriod)*.75/2;this.tempPulseColor1.multiplyScalar(lr),this.tempPulseColor2.multiplyScalar(lr)}this.fsQuad.material=this.edgeDetectionMaterial,this.edgeDetectionMaterial.uniforms.maskTexture.value=this.renderTargetMaskDownSampleBuffer.texture,this.edgeDetectionMaterial.uniforms.texSize.value.set(this.renderTargetMaskDownSampleBuffer.width,this.renderTargetMaskDownSampleBuffer.height),this.edgeDetectionMaterial.uniforms.visibleEdgeColor.value=this.tempPulseColor1,this.edgeDetectionMaterial.uniforms.hiddenEdgeColor.value=this.tempPulseColor2,er.setRenderTarget(this.renderTargetEdgeBuffer1),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.separableBlurMaterial1,this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionX,this.separableBlurMaterial1.uniforms.kernelRadius.value=this.edgeThickness,er.setRenderTarget(this.renderTargetBlurBuffer1),er.clear(),this.fsQuad.render(er),this.separableBlurMaterial1.uniforms.colorTexture.value=this.renderTargetBlurBuffer1.texture,this.separableBlurMaterial1.uniforms.direction.value=OutlinePass.BlurDirectionY,er.setRenderTarget(this.renderTargetEdgeBuffer1),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.separableBlurMaterial2,this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetEdgeBuffer1.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionX,er.setRenderTarget(this.renderTargetBlurBuffer2),er.clear(),this.fsQuad.render(er),this.separableBlurMaterial2.uniforms.colorTexture.value=this.renderTargetBlurBuffer2.texture,this.separableBlurMaterial2.uniforms.direction.value=OutlinePass.BlurDirectionY,er.setRenderTarget(this.renderTargetEdgeBuffer2),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.overlayMaterial,this.overlayMaterial.uniforms.maskTexture.value=this.renderTargetMaskBuffer.texture,this.overlayMaterial.uniforms.edgeTexture1.value=this.renderTargetEdgeBuffer1.texture,this.overlayMaterial.uniforms.edgeTexture2.value=this.renderTargetEdgeBuffer2.texture,this.overlayMaterial.uniforms.patternTexture.value=this.patternTexture,this.overlayMaterial.uniforms.edgeStrength.value=this.edgeStrength,this.overlayMaterial.uniforms.edgeGlow.value=this.edgeGlow,this.overlayMaterial.uniforms.usePatternTexture.value=this.usePatternTexture,sr&&er.state.buffers.stencil.setTest(!0),er.setRenderTarget(ir),this.fsQuad.render(er),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=ar}this.renderToScreen&&(this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=ir.texture,er.setRenderTarget(null),this.fsQuad.render(er))}getPrepareMaskMaterial(){return new ShaderMaterial({uniforms:{depthTexture:{value:null},cameraNearFar:{value:new Vector2(.5,.5)},textureMatrix:{value:null}},vertexShader:`#include <morphtarget_pars_vertex>
				#include <skinning_pars_vertex>

				varying vec4 projTexCoord;
				varying vec4 vPosition;
				uniform mat4 textureMatrix;

				void main() {

					#include <skinbase_vertex>
					#include <begin_vertex>
					#include <morphtarget_vertex>
					#include <skinning_vertex>
					#include <project_vertex>

					vPosition = mvPosition;

					vec4 worldPosition = vec4( transformed, 1.0 );

					#ifdef USE_INSTANCING

						worldPosition = instanceMatrix * worldPosition;

					#endif

					worldPosition = modelMatrix * worldPosition;

					projTexCoord = textureMatrix * worldPosition;

				}`,fragmentShader:`#include <packing>
				varying vec4 vPosition;
				varying vec4 projTexCoord;
				uniform sampler2D depthTexture;
				uniform vec2 cameraNearFar;

				void main() {

					float depth = unpackRGBAToDepth(texture2DProj( depthTexture, projTexCoord ));
					float viewZ = - DEPTH_TO_VIEW_Z( depth, cameraNearFar.x, cameraNearFar.y );
					float depthTest = (-vPosition.z > viewZ) ? 1.0 : 0.0;
					gl_FragColor = vec4(0.0, depthTest, 1.0, 1.0);

				}`})}getEdgeDetectionMaterial(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},texSize:{value:new Vector2(.5,.5)},visibleEdgeColor:{value:new Vector3$1(1,1,1)},hiddenEdgeColor:{value:new Vector3$1(1,1,1)}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform vec2 texSize;
				uniform vec3 visibleEdgeColor;
				uniform vec3 hiddenEdgeColor;

				void main() {
					vec2 invSize = 1.0 / texSize;
					vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize, invSize);
					vec4 c1 = texture2D( maskTexture, vUv + uvOffset.xy);
					vec4 c2 = texture2D( maskTexture, vUv - uvOffset.xy);
					vec4 c3 = texture2D( maskTexture, vUv + uvOffset.yw);
					vec4 c4 = texture2D( maskTexture, vUv - uvOffset.yw);
					float diff1 = (c1.r - c2.r)*0.5;
					float diff2 = (c3.r - c4.r)*0.5;
					float d = length( vec2(diff1, diff2) );
					float a1 = min(c1.g, c2.g);
					float a2 = min(c3.g, c4.g);
					float visibilityFactor = min(a1, a2);
					vec3 edgeColor = 1.0 - visibilityFactor > 0.001 ? visibleEdgeColor : hiddenEdgeColor;
					gl_FragColor = vec4(edgeColor, 1.0) * vec4(d);
				}`})}getSeperableBlurMaterial(er){return new ShaderMaterial({defines:{MAX_RADIUS:er},uniforms:{colorTexture:{value:null},texSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},kernelRadius:{value:1}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 texSize;
				uniform vec2 direction;
				uniform float kernelRadius;

				float gaussianPdf(in float x, in float sigma) {
					return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;
				}

				void main() {
					vec2 invSize = 1.0 / texSize;
					float sigma = kernelRadius/2.0;
					float weightSum = gaussianPdf(0.0, sigma);
					vec4 diffuseSum = texture2D( colorTexture, vUv) * weightSum;
					vec2 delta = direction * invSize * kernelRadius/float(MAX_RADIUS);
					vec2 uvOffset = delta;
					for( int i = 1; i <= MAX_RADIUS; i ++ ) {
						float x = kernelRadius * float(i) / float(MAX_RADIUS);
						float w = gaussianPdf(x, sigma);
						vec4 sample1 = texture2D( colorTexture, vUv + uvOffset);
						vec4 sample2 = texture2D( colorTexture, vUv - uvOffset);
						diffuseSum += ((sample1 + sample2) * w);
						weightSum += (2.0 * w);
						uvOffset += delta;
					}
					gl_FragColor = diffuseSum/weightSum;
				}`})}getOverlayMaterial(){return new ShaderMaterial({uniforms:{maskTexture:{value:null},edgeTexture1:{value:null},edgeTexture2:{value:null},patternTexture:{value:null},edgeStrength:{value:1},edgeGlow:{value:1},usePatternTexture:{value:0}},vertexShader:`varying vec2 vUv;

				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;

				uniform sampler2D maskTexture;
				uniform sampler2D edgeTexture1;
				uniform sampler2D edgeTexture2;
				uniform sampler2D patternTexture;
				uniform float edgeStrength;
				uniform float edgeGlow;
				uniform bool usePatternTexture;

				void main() {
					vec4 edgeValue1 = texture2D(edgeTexture1, vUv);
					vec4 edgeValue2 = texture2D(edgeTexture2, vUv);
					vec4 maskColor = texture2D(maskTexture, vUv);
					vec4 patternColor = texture2D(patternTexture, 6.0 * vUv);
					float visibilityFactor = 1.0 - maskColor.g > 0.0 ? 1.0 : 0.5;
					vec4 edgeValue = edgeValue1 + edgeValue2 * edgeGlow;
					vec4 finalColor = edgeStrength * maskColor.r * edgeValue;
					if(usePatternTexture)
						finalColor += + visibilityFactor * (1.0 - maskColor.r) * (1.0 - patternColor.r);
					gl_FragColor = finalColor;
				}`,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}}OutlinePass.BlurDirectionX=new Vector2(1,0);OutlinePass.BlurDirectionY=new Vector2(0,1);const OutputShader={name:"OutputShader",uniforms:{tDiffuse:{value:null},toneMappingExposure:{value:1}},vertexShader:`
		precision highp float;

		uniform mat4 modelViewMatrix;
		uniform mat4 projectionMatrix;

		attribute vec3 position;
		attribute vec2 uv;

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
	
		precision highp float;

		uniform sampler2D tDiffuse;

		#include <tonemapping_pars_fragment>
		#include <colorspace_pars_fragment>

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// tone mapping

			#ifdef LINEAR_TONE_MAPPING

				gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );

			#elif defined( REINHARD_TONE_MAPPING )

				gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );

			#elif defined( CINEON_TONE_MAPPING )

				gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );

			#elif defined( ACES_FILMIC_TONE_MAPPING )

				gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );

			#elif defined( AGX_TONE_MAPPING )

				gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );

			#elif defined( NEUTRAL_TONE_MAPPING )

				gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );

			#endif

			// color space

			#ifdef SRGB_TRANSFER

				gl_FragColor = sRGBTransferOETF( gl_FragColor );

			#endif

		}`};class OutputPass extends Pass$1{constructor(){super();const er=OutputShader;this.uniforms=UniformsUtils.clone(er.uniforms),this.material=new RawShaderMaterial({name:er.name,uniforms:this.uniforms,vertexShader:er.vertexShader,fragmentShader:er.fragmentShader}),this.fsQuad=new FullScreenQuad(this.material),this._outputColorSpace=null,this._toneMapping=null}render(er,tr,ir){this.uniforms.tDiffuse.value=ir.texture,this.uniforms.toneMappingExposure.value=er.toneMappingExposure,(this._outputColorSpace!==er.outputColorSpace||this._toneMapping!==er.toneMapping)&&(this._outputColorSpace=er.outputColorSpace,this._toneMapping=er.toneMapping,this.material.defines={},ColorManagement.getTransfer(this._outputColorSpace)===SRGBTransfer&&(this.material.defines.SRGB_TRANSFER=""),this._toneMapping===LinearToneMapping?this.material.defines.LINEAR_TONE_MAPPING="":this._toneMapping===ReinhardToneMapping?this.material.defines.REINHARD_TONE_MAPPING="":this._toneMapping===CineonToneMapping?this.material.defines.CINEON_TONE_MAPPING="":this._toneMapping===ACESFilmicToneMapping?this.material.defines.ACES_FILMIC_TONE_MAPPING="":this._toneMapping===AgXToneMapping?this.material.defines.AGX_TONE_MAPPING="":this._toneMapping===NeutralToneMapping&&(this.material.defines.NEUTRAL_TONE_MAPPING=""),this.material.needsUpdate=!0),this.renderToScreen===!0?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),this.fsQuad.render(er))}dispose(){this.material.dispose(),this.fsQuad.dispose()}}let RenderPass$1=class extends Pass$1{constructor(er,tr,ir=null,nr=null,sr=null){super(),this.scene=er,this.camera=tr,this.overrideMaterial=ir,this.clearColor=nr,this.clearAlpha=sr,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new Color}render(er,tr,ir){const nr=er.autoClear;er.autoClear=!1;let sr,ar;this.overrideMaterial!==null&&(ar=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor!==null&&(er.getClearColor(this._oldClearColor),er.setClearColor(this.clearColor,er.getClearAlpha())),this.clearAlpha!==null&&(sr=er.getClearAlpha(),er.setClearAlpha(this.clearAlpha)),this.clearDepth==!0&&er.clearDepth(),er.setRenderTarget(this.renderToScreen?null:ir),this.clear===!0&&er.clear(er.autoClearColor,er.autoClearDepth,er.autoClearStencil),er.render(this.scene,this.camera),this.clearColor!==null&&er.setClearColor(this._oldClearColor),this.clearAlpha!==null&&er.setClearAlpha(sr),this.overrideMaterial!==null&&(this.scene.overrideMaterial=ar),er.autoClear=nr}};class RenderPixelatedPass extends Pass$1{constructor(er,tr,ir,nr={}){super(),this.pixelSize=er,this.resolution=new Vector2,this.renderResolution=new Vector2,this.pixelatedMaterial=this.createPixelatedMaterial(),this.normalMaterial=new MeshNormalMaterial,this.fsQuad=new FullScreenQuad(this.pixelatedMaterial),this.scene=tr,this.camera=ir,this.normalEdgeStrength=nr.normalEdgeStrength||.3,this.depthEdgeStrength=nr.depthEdgeStrength||.4,this.beautyRenderTarget=new WebGLRenderTarget,this.beautyRenderTarget.texture.minFilter=NearestFilter,this.beautyRenderTarget.texture.magFilter=NearestFilter,this.beautyRenderTarget.texture.type=HalfFloatType,this.beautyRenderTarget.depthTexture=new DepthTexture,this.normalRenderTarget=new WebGLRenderTarget,this.normalRenderTarget.texture.minFilter=NearestFilter,this.normalRenderTarget.texture.magFilter=NearestFilter,this.normalRenderTarget.texture.type=HalfFloatType}dispose(){this.beautyRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.pixelatedMaterial.dispose(),this.normalMaterial.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.resolution.set(er,tr),this.renderResolution.set(er/this.pixelSize|0,tr/this.pixelSize|0);const{x:ir,y:nr}=this.renderResolution;this.beautyRenderTarget.setSize(ir,nr),this.normalRenderTarget.setSize(ir,nr),this.fsQuad.material.uniforms.resolution.value.set(ir,nr,1/ir,1/nr)}setPixelSize(er){this.pixelSize=er,this.setSize(this.resolution.x,this.resolution.y)}render(er,tr){const ir=this.fsQuad.material.uniforms;ir.normalEdgeStrength.value=this.normalEdgeStrength,ir.depthEdgeStrength.value=this.depthEdgeStrength,er.setRenderTarget(this.beautyRenderTarget),er.render(this.scene,this.camera);const nr=this.scene.overrideMaterial;er.setRenderTarget(this.normalRenderTarget),this.scene.overrideMaterial=this.normalMaterial,er.render(this.scene,this.camera),this.scene.overrideMaterial=nr,ir.tDiffuse.value=this.beautyRenderTarget.texture,ir.tDepth.value=this.beautyRenderTarget.depthTexture,ir.tNormal.value=this.normalRenderTarget.texture,this.renderToScreen?er.setRenderTarget(null):(er.setRenderTarget(tr),this.clear&&er.clear()),this.fsQuad.render(er)}createPixelatedMaterial(){return new ShaderMaterial({uniforms:{tDiffuse:{value:null},tDepth:{value:null},tNormal:{value:null},resolution:{value:new Vector4(this.renderResolution.x,this.renderResolution.y,1/this.renderResolution.x,1/this.renderResolution.y)},normalEdgeStrength:{value:0},depthEdgeStrength:{value:0}},vertexShader:`
				varying vec2 vUv;

				void main() {

					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

				}
			`,fragmentShader:`
				uniform sampler2D tDiffuse;
				uniform sampler2D tDepth;
				uniform sampler2D tNormal;
				uniform vec4 resolution;
				uniform float normalEdgeStrength;
				uniform float depthEdgeStrength;
				varying vec2 vUv;

				float getDepth(int x, int y) {

					return texture2D( tDepth, vUv + vec2(x, y) * resolution.zw ).r;

				}

				vec3 getNormal(int x, int y) {

					return texture2D( tNormal, vUv + vec2(x, y) * resolution.zw ).rgb * 2.0 - 1.0;

				}

				float depthEdgeIndicator(float depth, vec3 normal) {

					float diff = 0.0;
					diff += clamp(getDepth(1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(-1, 0) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, 1) - depth, 0.0, 1.0);
					diff += clamp(getDepth(0, -1) - depth, 0.0, 1.0);
					return floor(smoothstep(0.01, 0.02, diff) * 2.) / 2.;

				}

				float neighborNormalEdgeIndicator(int x, int y, float depth, vec3 normal) {

					float depthDiff = getDepth(x, y) - depth;
					vec3 neighborNormal = getNormal(x, y);

					// Edge pixels should yield to faces who's normals are closer to the bias normal.
					vec3 normalEdgeBias = vec3(1., 1., 1.); // This should probably be a parameter.
					float normalDiff = dot(normal - neighborNormal, normalEdgeBias);
					float normalIndicator = clamp(smoothstep(-.01, .01, normalDiff), 0.0, 1.0);

					// Only the shallower pixel should detect the normal edge.
					float depthIndicator = clamp(sign(depthDiff * .25 + .0025), 0.0, 1.0);

					return (1.0 - dot(normal, neighborNormal)) * depthIndicator * normalIndicator;

				}

				float normalEdgeIndicator(float depth, vec3 normal) {

					float indicator = 0.0;

					indicator += neighborNormalEdgeIndicator(0, -1, depth, normal);
					indicator += neighborNormalEdgeIndicator(0, 1, depth, normal);
					indicator += neighborNormalEdgeIndicator(-1, 0, depth, normal);
					indicator += neighborNormalEdgeIndicator(1, 0, depth, normal);

					return step(0.1, indicator);

				}

				void main() {

					vec4 texel = texture2D( tDiffuse, vUv );

					float depth = 0.0;
					vec3 normal = vec3(0.0);

					if (depthEdgeStrength > 0.0 || normalEdgeStrength > 0.0) {

						depth = getDepth(0, 0);
						normal = getNormal(0, 0);

					}

					float dei = 0.0;
					if (depthEdgeStrength > 0.0)
						dei = depthEdgeIndicator(depth, normal);

					float nei = 0.0;
					if (normalEdgeStrength > 0.0)
						nei = normalEdgeIndicator(depth, normal);

					float Strength = dei > 0.0 ? (1.0 - depthEdgeStrength * dei) : (1.0 + normalEdgeStrength * nei);

					gl_FragColor = texel * Strength;

				}
			`})}}const SAOShader={name:"SAOShader",defines:{NUM_SAMPLES:7,NUM_RINGS:4,DIFFUSE_TEXTURE:0,PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},tDiffuse:{value:null},tNormal:{value:null},size:{value:new Vector2(512,512)},cameraNear:{value:1},cameraFar:{value:100},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},scale:{value:1},intensity:{value:.1},bias:{value:.5},minResolution:{value:0},kernelRadius:{value:100},randomSeed:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {
			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`
		#include <common>

		varying vec2 vUv;

		#if DIFFUSE_TEXTURE == 1
		uniform sampler2D tDiffuse;
		#endif

		uniform highp sampler2D tDepth;
		uniform highp sampler2D tNormal;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float scale;
		uniform float intensity;
		uniform float bias;
		uniform float kernelRadius;
		uniform float minResolution;
		uniform vec2 size;
		uniform float randomSeed;

		// RGBA depth

		#include <packing>

		vec4 getDefaultColor( const in vec2 screenPosition ) {
			#if DIFFUSE_TEXTURE == 1
			return texture2D( tDiffuse, vUv );
			#else
			return vec4( 1.0 );
			#endif
		}

		float getDepth( const in vec2 screenPosition ) {
			return texture2D( tDepth, screenPosition ).x;
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {
			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];
			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );
			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;
		}

		vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPosition ) {
			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );
		}

		float scaleDividedByCameraFar;
		float minResolutionMultipliedByCameraFar;

		float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {
			vec3 viewDelta = sampleViewPosition - centerViewPosition;
			float viewDistance = length( viewDelta );
			float scaledScreenDistance = scaleDividedByCameraFar * viewDistance;

			return max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - bias) / (1.0 + pow2( scaledScreenDistance ) );
		}

		// moving costly divides into consts
		const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );
		const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );

		float getAmbientOcclusion( const in vec3 centerViewPosition ) {
			// precompute some variables require in getOcclusion.
			scaleDividedByCameraFar = scale / cameraFar;
			minResolutionMultipliedByCameraFar = minResolution * cameraFar;
			vec3 centerViewNormal = getViewNormal( centerViewPosition, vUv );

			// jsfiddle that shows sample pattern: https://jsfiddle.net/a16ff1p7/
			float angle = rand( vUv + randomSeed ) * PI2;
			vec2 radius = vec2( kernelRadius * INV_NUM_SAMPLES ) / size;
			vec2 radiusStep = radius;

			float occlusionSum = 0.0;
			float weightSum = 0.0;

			for( int i = 0; i < NUM_SAMPLES; i ++ ) {
				vec2 sampleUv = vUv + vec2( cos( angle ), sin( angle ) ) * radius;
				radius += radiusStep;
				angle += ANGLE_STEP;

				float sampleDepth = getDepth( sampleUv );
				if( sampleDepth >= ( 1.0 - EPSILON ) ) {
					continue;
				}

				float sampleViewZ = getViewZ( sampleDepth );
				vec3 sampleViewPosition = getViewPosition( sampleUv, sampleDepth, sampleViewZ );
				occlusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );
				weightSum += 1.0;
			}

			if( weightSum == 0.0 ) discard;

			return occlusionSum * ( intensity / weightSum );
		}

		void main() {
			float centerDepth = getDepth( vUv );
			if( centerDepth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = getViewZ( centerDepth );
			vec3 viewPosition = getViewPosition( vUv, centerDepth, centerViewZ );

			float ambientOcclusion = getAmbientOcclusion( viewPosition );

			gl_FragColor = getDefaultColor( vUv );
			gl_FragColor.xyz *=  1.0 - ambientOcclusion;
		}`},DepthLimitedBlurShader={name:"DepthLimitedBlurShader",defines:{KERNEL_RADIUS:4,DEPTH_PACKING:1,PERSPECTIVE_CAMERA:1},uniforms:{tDiffuse:{value:null},size:{value:new Vector2(512,512)},sampleUvOffsets:{value:[new Vector2(0,0)]},sampleWeights:{value:[1]},tDepth:{value:null},cameraNear:{value:10},cameraFar:{value:1e3},depthCutoff:{value:10}},vertexShader:`

		#include <common>

		uniform vec2 size;

		varying vec2 vUv;
		varying vec2 vInvSize;

		void main() {
			vUv = uv;
			vInvSize = 1.0 / size;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
		}`,fragmentShader:`

		#include <common>
		#include <packing>

		uniform sampler2D tDiffuse;
		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform float depthCutoff;

		uniform vec2 sampleUvOffsets[ KERNEL_RADIUS + 1 ];
		uniform float sampleWeights[ KERNEL_RADIUS + 1 ];

		varying vec2 vUv;
		varying vec2 vInvSize;

		float getDepth( const in vec2 screenPosition ) {
			#if DEPTH_PACKING == 1
			return unpackRGBAToDepth( texture2D( tDepth, screenPosition ) );
			#else
			return texture2D( tDepth, screenPosition ).x;
			#endif
		}

		float getViewZ( const in float depth ) {
			#if PERSPECTIVE_CAMERA == 1
			return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
			return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}

		void main() {
			float depth = getDepth( vUv );
			if( depth >= ( 1.0 - EPSILON ) ) {
				discard;
			}

			float centerViewZ = -getViewZ( depth );
			bool rBreak = false, lBreak = false;

			float weightSum = sampleWeights[0];
			vec4 diffuseSum = texture2D( tDiffuse, vUv ) * weightSum;

			for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {

				float sampleWeight = sampleWeights[i];
				vec2 sampleUvOffset = sampleUvOffsets[i] * vInvSize;

				vec2 sampleUv = vUv + sampleUvOffset;
				float viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) rBreak = true;

				if( ! rBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

				sampleUv = vUv - sampleUvOffset;
				viewZ = -getViewZ( getDepth( sampleUv ) );

				if( abs( viewZ - centerViewZ ) > depthCutoff ) lBreak = true;

				if( ! lBreak ) {
					diffuseSum += texture2D( tDiffuse, sampleUv ) * sampleWeight;
					weightSum += sampleWeight;
				}

			}

			gl_FragColor = diffuseSum / weightSum;
		}`},BlurShaderUtils={createSampleWeights:function(rr,er){const tr=[];for(let ir=0;ir<=rr;ir++)tr.push(gaussian(ir,er));return tr},createSampleOffsets:function(rr,er){const tr=[];for(let ir=0;ir<=rr;ir++)tr.push(er.clone().multiplyScalar(ir));return tr},configure:function(rr,er,tr,ir){rr.defines.KERNEL_RADIUS=er,rr.uniforms.sampleUvOffsets.value=BlurShaderUtils.createSampleOffsets(er,ir),rr.uniforms.sampleWeights.value=BlurShaderUtils.createSampleWeights(er,tr),rr.needsUpdate=!0}};function gaussian(rr,er){return Math.exp(-(rr*rr)/(2*(er*er)))/(Math.sqrt(2*Math.PI)*er)}class SAOPass extends Pass$1{constructor(er,tr,ir=new Vector2(256,256)){super(),this.scene=er,this.camera=tr,this.clear=!0,this.needsSwap=!1,this.originalClearColor=new Color,this._oldClearColor=new Color,this.oldClearAlpha=1,this.params={output:0,saoBias:.5,saoIntensity:.18,saoScale:1,saoKernelRadius:100,saoMinResolution:0,saoBlur:!0,saoBlurRadius:8,saoBlurStdDev:4,saoBlurDepthCutoff:.01},this.resolution=new Vector2(ir.x,ir.y),this.saoRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{type:HalfFloatType}),this.blurIntermediateRenderTarget=this.saoRenderTarget.clone();const nr=new DepthTexture;nr.format=DepthStencilFormat,nr.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.resolution.x,this.resolution.y,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:nr}),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.saoMaterial=new ShaderMaterial({defines:Object.assign({},SAOShader.defines),fragmentShader:SAOShader.fragmentShader,vertexShader:SAOShader.vertexShader,uniforms:UniformsUtils.clone(SAOShader.uniforms)}),this.saoMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.saoMaterial.uniforms.tDepth.value=nr,this.saoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.saoMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.blending=NoBlending,this.vBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.vBlurMaterial.defines.DEPTH_PACKING=0,this.vBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.vBlurMaterial.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.vBlurMaterial.uniforms.tDepth.value=nr,this.vBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.vBlurMaterial.blending=NoBlending,this.hBlurMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(DepthLimitedBlurShader.uniforms),defines:Object.assign({},DepthLimitedBlurShader.defines),vertexShader:DepthLimitedBlurShader.vertexShader,fragmentShader:DepthLimitedBlurShader.fragmentShader}),this.hBlurMaterial.defines.DEPTH_PACKING=0,this.hBlurMaterial.defines.PERSPECTIVE_CAMERA=this.camera.isPerspectiveCamera?1:0,this.hBlurMaterial.uniforms.tDiffuse.value=this.blurIntermediateRenderTarget.texture,this.hBlurMaterial.uniforms.tDepth.value=nr,this.hBlurMaterial.uniforms.size.value.set(this.resolution.x,this.resolution.y),this.hBlurMaterial.blending=NoBlending,this.materialCopy=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,blending:NoBlending}),this.materialCopy.transparent=!0,this.materialCopy.depthTest=!1,this.materialCopy.depthWrite=!1,this.materialCopy.blending=CustomBlending,this.materialCopy.blendSrc=DstColorFactor,this.materialCopy.blendDst=ZeroFactor,this.materialCopy.blendEquation=AddEquation,this.materialCopy.blendSrcAlpha=DstAlphaFactor,this.materialCopy.blendDstAlpha=ZeroFactor,this.materialCopy.blendEquationAlpha=AddEquation,this.fsQuad=new FullScreenQuad(null)}render(er,tr,ir){this.renderToScreen&&(this.materialCopy.blending=NoBlending,this.materialCopy.uniforms.tDiffuse.value=ir.texture,this.materialCopy.needsUpdate=!0,this.renderPass(er,this.materialCopy,null)),er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const nr=er.autoClear;er.autoClear=!1,this.saoMaterial.uniforms.bias.value=this.params.saoBias,this.saoMaterial.uniforms.intensity.value=this.params.saoIntensity,this.saoMaterial.uniforms.scale.value=this.params.saoScale,this.saoMaterial.uniforms.kernelRadius.value=this.params.saoKernelRadius,this.saoMaterial.uniforms.minResolution.value=this.params.saoMinResolution,this.saoMaterial.uniforms.cameraNear.value=this.camera.near,this.saoMaterial.uniforms.cameraFar.value=this.camera.far;const sr=this.params.saoBlurDepthCutoff*(this.camera.far-this.camera.near);this.vBlurMaterial.uniforms.depthCutoff.value=sr,this.hBlurMaterial.uniforms.depthCutoff.value=sr,this.vBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.vBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.hBlurMaterial.uniforms.cameraNear.value=this.camera.near,this.hBlurMaterial.uniforms.cameraFar.value=this.camera.far,this.params.saoBlurRadius=Math.floor(this.params.saoBlurRadius),(this.prevStdDev!==this.params.saoBlurStdDev||this.prevNumSamples!==this.params.saoBlurRadius)&&(BlurShaderUtils.configure(this.vBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(0,1)),BlurShaderUtils.configure(this.hBlurMaterial,this.params.saoBlurRadius,this.params.saoBlurStdDev,new Vector2(1,0)),this.prevStdDev=this.params.saoBlurStdDev,this.prevNumSamples=this.params.saoBlurRadius),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.renderPass(er,this.saoMaterial,this.saoRenderTarget,16777215,1),this.params.saoBlur&&(this.renderPass(er,this.vBlurMaterial,this.blurIntermediateRenderTarget,16777215,1),this.renderPass(er,this.hBlurMaterial,this.saoRenderTarget,16777215,1));const ar=this.materialCopy;this.params.output===SAOPass.OUTPUT.Normal?(this.materialCopy.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.materialCopy.needsUpdate=!0):(this.materialCopy.uniforms.tDiffuse.value=this.saoRenderTarget.texture,this.materialCopy.needsUpdate=!0),this.params.output===SAOPass.OUTPUT.Default?ar.blending=CustomBlending:ar.blending=NoBlending,this.renderPass(er,ar,this.renderToScreen?null:ir),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=nr}renderPass(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.saoRenderTarget.setSize(er,tr),this.blurIntermediateRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.saoMaterial.uniforms.size.value.set(er,tr),this.saoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.saoMaterial.uniforms.cameraProjectionMatrix.value=this.camera.projectionMatrix,this.saoMaterial.needsUpdate=!0,this.vBlurMaterial.uniforms.size.value.set(er,tr),this.vBlurMaterial.needsUpdate=!0,this.hBlurMaterial.uniforms.size.value.set(er,tr),this.hBlurMaterial.needsUpdate=!0}dispose(){this.saoRenderTarget.dispose(),this.blurIntermediateRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.normalMaterial.dispose(),this.saoMaterial.dispose(),this.vBlurMaterial.dispose(),this.hBlurMaterial.dispose(),this.materialCopy.dispose(),this.fsQuad.dispose()}}SAOPass.OUTPUT={Default:0,SAO:1,Normal:2};const SMAAEdgesShader={name:"SMAAEdgesShader",defines:{SMAA_THRESHOLD:"0.1"},uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		void SMAAEdgeDetectionVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 2 ] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAAEdgeDetectionVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];

		vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
			vec2 threshold = vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );

			// Calculate color deltas:
			vec4 delta;
			vec3 C = texture2D( colorTex, texcoord ).rgb;

			vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
			vec3 t = abs( C - Cleft );
			delta.x = max( max( t.r, t.g ), t.b );

			vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
			t = abs( C - Ctop );
			delta.y = max( max( t.r, t.g ), t.b );

			// We do the usual threshold:
			vec2 edges = step( threshold, delta.xy );

			// Then discard if there is no edge:
			if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
				discard;

			// Calculate right and bottom deltas:
			vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
			t = abs( C - Cright );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
			t = abs( C - Cbottom );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the maximum delta in the direct neighborhood:
			float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

			// Calculate left-left and top-top deltas:
			vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
			t = abs( C - Cleftleft );
			delta.z = max( max( t.r, t.g ), t.b );

			vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
			t = abs( C - Ctoptop );
			delta.w = max( max( t.r, t.g ), t.b );

			// Calculate the final maximum delta:
			maxDelta = max( max( maxDelta, delta.z ), delta.w );

			// Local contrast adaptation in action:
			edges.xy *= step( 0.5 * maxDelta, delta.xy );

			return vec4( edges, 0.0, 0.0 );
		}

		void main() {

			gl_FragColor = SMAAColorEdgeDetectionPS( vUv, vOffset, tDiffuse );

		}`},SMAAWeightsShader={name:"SMAAWeightsShader",defines:{SMAA_MAX_SEARCH_STEPS:"8",SMAA_AREATEX_MAX_DISTANCE:"16",SMAA_AREATEX_PIXEL_SIZE:"( 1.0 / vec2( 160.0, 560.0 ) )",SMAA_AREATEX_SUBTEX_SIZE:"( 1.0 / 7.0 )"},uniforms:{tDiffuse:{value:null},tArea:{value:null},tSearch:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 3 ];
		varying vec2 vPixcoord;

		void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
			vPixcoord = texcoord / resolution;

			// We will use these offsets for the searches later on (see @PSEUDO_GATHER4):
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 ); // WebGL port note: Changed sign in Y and W components
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 ); // WebGL port note: Changed sign in Y and W components

			// And these for the searches, they indicate the ends of the loops:
			vOffset[ 2 ] = vec4( vOffset[ 0 ].xz, vOffset[ 1 ].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );

		}

		void main() {

			vUv = uv;

			SMAABlendingWeightCalculationVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * resolution, 0.0 )

		uniform sampler2D tDiffuse;
		uniform sampler2D tArea;
		uniform sampler2D tSearch;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[3];
		varying vec2 vPixcoord;

		#if __VERSION__ == 100
		vec2 round( vec2 x ) {
			return sign( x ) * floor( abs( x ) + 0.5 );
		}
		#endif

		float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
			// Not required if searchTex accesses are set to point:
			// float2 SEARCH_TEX_PIXEL_SIZE = 1.0 / float2(66.0, 33.0);
			// e = float2(bias, 0.0) + 0.5 * SEARCH_TEX_PIXEL_SIZE +
			//     e * float2(scale, 1.0) * float2(64.0, 32.0) * SEARCH_TEX_PIXEL_SIZE;
			e.r = bias + e.r * scale;
			return 255.0 * texture2D( searchTex, e, 0.0 ).r;
		}

		float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			/**
				* @PSEUDO_GATHER4
				* This texcoord has been offset by (-0.25, -0.125) in the vertex shader to
				* sample between edge, thus fetching four edges in a row.
				* Sampling with different offsets in each direction allows to disambiguate
				* which edges are active from the four fetched ones.
				*/
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			// We correct the previous (-0.25, -0.125) offset we applied:
			texcoord.x += 0.25 * resolution.x;

			// The searches are bias by 1, so adjust the coords accordingly:
			texcoord.x += resolution.x;

			// Disambiguate the length added by the last step:
			texcoord.x += 2.0 * resolution.x; // Undo last step
			texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);

			return texcoord.x;
		}

		float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 0.0, 1.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 2.0, 0.0 ) * resolution;
				if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
			}

			texcoord.x -= 0.25 * resolution.x;
			texcoord.x -= resolution.x;
			texcoord.x -= 2.0 * resolution.x;
			texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );

			return texcoord.x;
		}

		float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord += vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y -= 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y; // WebGL port note: Changed sign
			texcoord.y -= 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
			vec2 e = vec2( 1.0, 0.0 );

			for ( int i = 0; i < SMAA_MAX_SEARCH_STEPS; i ++ ) { // WebGL port note: Changed while to for
				e = texture2D( edgesTex, texcoord, 0.0 ).rg;
				texcoord -= vec2( 0.0, 2.0 ) * resolution; // WebGL port note: Changed sign
				if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
			}

			texcoord.y += 0.25 * resolution.y; // WebGL port note: Changed sign
			texcoord.y += resolution.y; // WebGL port note: Changed sign
			texcoord.y += 2.0 * resolution.y; // WebGL port note: Changed sign
			texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 ); // WebGL port note: Changed sign

			return texcoord.y;
		}

		vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
			// Rounding prevents precision errors of bilinear filtering:
			vec2 texcoord = float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;

			// We do a scale and bias for mapping to texel space:
			texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );

			// Move to proper place, according to the subpixel offset:
			texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;

			return texture2D( areaTex, texcoord, 0.0 ).rg;
		}

		vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
			vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );

			vec2 e = texture2D( edgesTex, texcoord ).rg;

			if ( e.g > 0.0 ) { // Edge at north
				vec2 d;

				// Find the distance to the left:
				vec2 coords;
				coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
				coords.y = offset[ 1 ].y; // offset[1].y = texcoord.y - 0.25 * resolution.y (@CROSSING_OFFSET)
				d.x = coords.x;

				// Now fetch the left crossing edges, two at a time using bilinear
				// filtering. Sampling at -0.25 (see @CROSSING_OFFSET) enables to
				// discern what value each edge has:
				float e1 = texture2D( edgesTex, coords, 0.0 ).r;

				// Find the distance to the right:
				coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
				d.y = coords.x;

				// We want the distances to be in pixel units (doing this here allow to
				// better interleave arithmetic and memory accesses):
				d = d / resolution.x - pixcoord.x;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the right crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;

				// Ok, we know how this pattern looks like, now it is time for getting
				// the actual area:
				weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
			}

			if ( e.r > 0.0 ) { // Edge at west
				vec2 d;

				// Find the distance to the top:
				vec2 coords;

				coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
				coords.x = offset[ 0 ].x; // offset[1].x = texcoord.x - 0.25 * resolution.x;
				d.x = coords.y;

				// Fetch the top crossing edges:
				float e1 = texture2D( edgesTex, coords, 0.0 ).g;

				// Find the distance to the bottom:
				coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
				d.y = coords.y;

				// We want the distances to be in pixel units:
				d = d / resolution.y - pixcoord.y;

				// SMAAArea below needs a sqrt, as the areas texture is compressed
				// quadratically:
				vec2 sqrt_d = sqrt( abs( d ) );

				// Fetch the bottom crossing edges:
				coords.y -= 1.0 * resolution.y; // WebGL port note: Added
				float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;

				// Get the area for this direction:
				weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );
			}

			return weights;
		}

		void main() {

			gl_FragColor = SMAABlendingWeightCalculationPS( vUv, vPixcoord, vOffset, tDiffuse, tArea, tSearch, ivec4( 0.0 ) );

		}`},SMAABlendShader={name:"SMAABlendShader",uniforms:{tDiffuse:{value:null},tColor:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
			vOffset[ 0 ] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 ); // WebGL port note: Changed sign in W component
			vOffset[ 1 ] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component
		}

		void main() {

			vUv = uv;

			SMAANeighborhoodBlendingVS( vUv );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform sampler2D tColor;
		uniform vec2 resolution;

		varying vec2 vUv;
		varying vec4 vOffset[ 2 ];

		vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
			// Fetch the blending weights for current pixel:
			vec4 a;
			a.xz = texture2D( blendTex, texcoord ).xz;
			a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
			a.w = texture2D( blendTex, offset[ 1 ].xy ).a;

			// Is there any blending weight with a value greater than 0.0?
			if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
				return texture2D( colorTex, texcoord, 0.0 );
			} else {
				// Up to 4 lines can be crossing a pixel (one through each edge). We
				// favor blending by choosing the line with the maximum weight for each
				// direction:
				vec2 offset;
				offset.x = a.a > a.b ? a.a : -a.b; // left vs. right
				offset.y = a.g > a.r ? -a.g : a.r; // top vs. bottom // WebGL port note: Changed signs

				// Then we go in the direction that has the maximum weight:
				if ( abs( offset.x ) > abs( offset.y )) { // horizontal vs. vertical
					offset.y = 0.0;
				} else {
					offset.x = 0.0;
				}

				// Fetch the opposite color and lerp by hand:
				vec4 C = texture2D( colorTex, texcoord, 0.0 );
				texcoord += sign( offset ) * resolution;
				vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
				float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );

				// WebGL port note: Added gamma correction
				C.xyz = pow(C.xyz, vec3(2.2));
				Cop.xyz = pow(Cop.xyz, vec3(2.2));
				vec4 mixed = mix(C, Cop, s);
				mixed.xyz = pow(mixed.xyz, vec3(1.0 / 2.2));

				return mixed;
			}
		}

		void main() {

			gl_FragColor = SMAANeighborhoodBlendingPS( vUv, vOffset, tColor, tDiffuse );

		}`};class SMAAPass extends Pass$1{constructor(er,tr){super(),this.edgesRT=new WebGLRenderTarget(er,tr,{depthBuffer:!1,type:HalfFloatType}),this.edgesRT.texture.name="SMAAPass.edges",this.weightsRT=new WebGLRenderTarget(er,tr,{depthBuffer:!1,type:HalfFloatType}),this.weightsRT.texture.name="SMAAPass.weights";const ir=this,nr=new Image;nr.src=this.getAreaTexture(),nr.onload=function(){ir.areaTexture.needsUpdate=!0},this.areaTexture=new Texture,this.areaTexture.name="SMAAPass.area",this.areaTexture.image=nr,this.areaTexture.minFilter=LinearFilter,this.areaTexture.generateMipmaps=!1,this.areaTexture.flipY=!1;const sr=new Image;sr.src=this.getSearchTexture(),sr.onload=function(){ir.searchTexture.needsUpdate=!0},this.searchTexture=new Texture,this.searchTexture.name="SMAAPass.search",this.searchTexture.image=sr,this.searchTexture.magFilter=NearestFilter,this.searchTexture.minFilter=NearestFilter,this.searchTexture.generateMipmaps=!1,this.searchTexture.flipY=!1,this.uniformsEdges=UniformsUtils.clone(SMAAEdgesShader.uniforms),this.uniformsEdges.resolution.value.set(1/er,1/tr),this.materialEdges=new ShaderMaterial({defines:Object.assign({},SMAAEdgesShader.defines),uniforms:this.uniformsEdges,vertexShader:SMAAEdgesShader.vertexShader,fragmentShader:SMAAEdgesShader.fragmentShader}),this.uniformsWeights=UniformsUtils.clone(SMAAWeightsShader.uniforms),this.uniformsWeights.resolution.value.set(1/er,1/tr),this.uniformsWeights.tDiffuse.value=this.edgesRT.texture,this.uniformsWeights.tArea.value=this.areaTexture,this.uniformsWeights.tSearch.value=this.searchTexture,this.materialWeights=new ShaderMaterial({defines:Object.assign({},SMAAWeightsShader.defines),uniforms:this.uniformsWeights,vertexShader:SMAAWeightsShader.vertexShader,fragmentShader:SMAAWeightsShader.fragmentShader}),this.uniformsBlend=UniformsUtils.clone(SMAABlendShader.uniforms),this.uniformsBlend.resolution.value.set(1/er,1/tr),this.uniformsBlend.tDiffuse.value=this.weightsRT.texture,this.materialBlend=new ShaderMaterial({uniforms:this.uniformsBlend,vertexShader:SMAABlendShader.vertexShader,fragmentShader:SMAABlendShader.fragmentShader}),this.fsQuad=new FullScreenQuad(null)}render(er,tr,ir){this.uniformsEdges.tDiffuse.value=ir.texture,this.fsQuad.material=this.materialEdges,er.setRenderTarget(this.edgesRT),this.clear&&er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.materialWeights,er.setRenderTarget(this.weightsRT),this.clear&&er.clear(),this.fsQuad.render(er),this.uniformsBlend.tColor.value=ir.texture,this.fsQuad.material=this.materialBlend,this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(tr),this.clear&&er.clear(),this.fsQuad.render(er))}setSize(er,tr){this.edgesRT.setSize(er,tr),this.weightsRT.setSize(er,tr),this.materialEdges.uniforms.resolution.value.set(1/er,1/tr),this.materialWeights.uniforms.resolution.value.set(1/er,1/tr),this.materialBlend.uniforms.resolution.value.set(1/er,1/tr)}getAreaTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII="}getSearchTexture(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII="}dispose(){this.edgesRT.dispose(),this.weightsRT.dispose(),this.areaTexture.dispose(),this.searchTexture.dispose(),this.materialEdges.dispose(),this.materialWeights.dispose(),this.materialBlend.dispose(),this.fsQuad.dispose()}}class SSAARenderPass extends Pass$1{constructor(er,tr,ir,nr){super(),this.scene=er,this.camera=tr,this.sampleLevel=4,this.unbiased=!0,this.stencilBuffer=!1,this.clearColor=ir!==void 0?ir:0,this.clearAlpha=nr!==void 0?nr:0,this._oldClearColor=new Color;const sr=CopyShader;this.copyUniforms=UniformsUtils.clone(sr.uniforms),this.copyMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:sr.vertexShader,fragmentShader:sr.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0,blending:AdditiveBlending}),this.fsQuad=new FullScreenQuad(this.copyMaterial)}dispose(){this.sampleRenderTarget&&(this.sampleRenderTarget.dispose(),this.sampleRenderTarget=null),this.copyMaterial.dispose(),this.fsQuad.dispose()}setSize(er,tr){this.sampleRenderTarget&&this.sampleRenderTarget.setSize(er,tr)}render(er,tr,ir){this.sampleRenderTarget||(this.sampleRenderTarget=new WebGLRenderTarget(ir.width,ir.height,{type:HalfFloatType,stencilBuffer:this.stencilBuffer}),this.sampleRenderTarget.texture.name="SSAARenderPass.sample");const nr=_JitterVectors$1[Math.max(0,Math.min(this.sampleLevel,5))],sr=er.autoClear;er.autoClear=!1,er.getClearColor(this._oldClearColor);const ar=er.getClearAlpha(),or=1/nr.length,lr=1/32;this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture;const cr={fullWidth:ir.width,fullHeight:ir.height,offsetX:0,offsetY:0,width:ir.width,height:ir.height},ur=Object.assign({},this.camera.view);ur.enabled&&Object.assign(cr,ur);for(let dr=0;dr<nr.length;dr++){const hr=nr[dr];this.camera.setViewOffset&&this.camera.setViewOffset(cr.fullWidth,cr.fullHeight,cr.offsetX+hr[0]*.0625,cr.offsetY+hr[1]*.0625,cr.width,cr.height);let pr=or;if(this.unbiased){const gr=-.5+(dr+.5)/nr.length;pr+=lr*gr}this.copyUniforms.opacity.value=pr,er.setClearColor(this.clearColor,this.clearAlpha),er.setRenderTarget(this.sampleRenderTarget),er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(this.renderToScreen?null:tr),dr===0&&(er.setClearColor(0,0),er.clear()),this.fsQuad.render(er)}this.camera.setViewOffset&&ur.enabled?this.camera.setViewOffset(ur.fullWidth,ur.fullHeight,ur.offsetX,ur.offsetY,ur.width,ur.height):this.camera.clearViewOffset&&this.camera.clearViewOffset(),er.autoClear=sr,er.setClearColor(this._oldClearColor,ar)}}const _JitterVectors$1=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]],SSAOShader={name:"SSAOShader",defines:{PERSPECTIVE_CAMERA:1,KERNEL_SIZE:32},uniforms:{tNormal:{value:null},tDepth:{value:null},tNoise:{value:null},kernel:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},kernelRadius:{value:8},minDistance:{value:.005},maxDistance:{value:.05}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`
		uniform highp sampler2D tNormal;
		uniform highp sampler2D tDepth;
		uniform sampler2D tNoise;

		uniform vec3 kernel[ KERNEL_SIZE ];

		uniform vec2 resolution;

		uniform float cameraNear;
		uniform float cameraFar;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;

		uniform float kernelRadius;
		uniform float minDistance; // avoid artifacts caused by neighbour fragments with minimal depth difference
		uniform float maxDistance; // avoid the influence of fragments which are too far away

		varying vec2 vUv;

		#include <packing>

		float getDepth( const in vec2 screenPosition ) {

			return texture2D( tDepth, screenPosition ).x;

		}

		float getLinearDepth( const in vec2 screenPosition ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, screenPosition ).x;

			#endif

		}

		float getViewZ( const in float depth ) {

			#if PERSPECTIVE_CAMERA == 1

				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );

			#else

				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );

			#endif

		}

		vec3 getViewPosition( const in vec2 screenPosition, const in float depth, const in float viewZ ) {

			float clipW = cameraProjectionMatrix[2][3] * viewZ + cameraProjectionMatrix[3][3];

			vec4 clipPosition = vec4( ( vec3( screenPosition, depth ) - 0.5 ) * 2.0, 1.0 );

			clipPosition *= clipW; // unprojection.

			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;

		}

		vec3 getViewNormal( const in vec2 screenPosition ) {

			return unpackRGBToNormal( texture2D( tNormal, screenPosition ).xyz );

		}

		void main() {

			float depth = getDepth( vUv );

			if ( depth == 1.0 ) {

				gl_FragColor = vec4( 1.0 ); // don't influence background
				
			} else {

				float viewZ = getViewZ( depth );

				vec3 viewPosition = getViewPosition( vUv, depth, viewZ );
				vec3 viewNormal = getViewNormal( vUv );

				vec2 noiseScale = vec2( resolution.x / 4.0, resolution.y / 4.0 );
				vec3 random = vec3( texture2D( tNoise, vUv * noiseScale ).r );

				// compute matrix used to reorient a kernel vector

				vec3 tangent = normalize( random - viewNormal * dot( random, viewNormal ) );
				vec3 bitangent = cross( viewNormal, tangent );
				mat3 kernelMatrix = mat3( tangent, bitangent, viewNormal );

				float occlusion = 0.0;

				for ( int i = 0; i < KERNEL_SIZE; i ++ ) {

					vec3 sampleVector = kernelMatrix * kernel[ i ]; // reorient sample vector in view space
					vec3 samplePoint = viewPosition + ( sampleVector * kernelRadius ); // calculate sample point

					vec4 samplePointNDC = cameraProjectionMatrix * vec4( samplePoint, 1.0 ); // project point and calculate NDC
					samplePointNDC /= samplePointNDC.w;

					vec2 samplePointUv = samplePointNDC.xy * 0.5 + 0.5; // compute uv coordinates

					float realDepth = getLinearDepth( samplePointUv ); // get linear depth from depth texture
					float sampleDepth = viewZToOrthographicDepth( samplePoint.z, cameraNear, cameraFar ); // compute linear depth of the sample view Z value
					float delta = sampleDepth - realDepth;

					if ( delta > minDistance && delta < maxDistance ) { // if fragment is before sample point, increase occlusion

						occlusion += 1.0;

					}

				}

				occlusion = clamp( occlusion / float( KERNEL_SIZE ), 0.0, 1.0 );

				gl_FragColor = vec4( vec3( 1.0 - occlusion ), 1.0 );

			}

		}`},SSAODepthShader={name:"SSAODepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 screenPosition ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, screenPosition ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, screenPosition ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			gl_FragColor = vec4( vec3( 1.0 - depth ), 1.0 );

		}`},SSAOBlurShader={name:"SSAOBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:`varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`uniform sampler2D tDiffuse;

		uniform vec2 resolution;

		varying vec2 vUv;

		void main() {

			vec2 texelSize = ( 1.0 / resolution );
			float result = 0.0;

			for ( int i = - 2; i <= 2; i ++ ) {

				for ( int j = - 2; j <= 2; j ++ ) {

					vec2 offset = ( vec2( float( i ), float( j ) ) ) * texelSize;
					result += texture2D( tDiffuse, vUv + offset ).r;

				}

			}

			gl_FragColor = vec4( vec3( result / ( 5.0 * 5.0 ) ), 1.0 );

		}`};class SSAOPass extends Pass$1{constructor(er,tr,ir,nr,sr=32){super(),this.width=ir!==void 0?ir:512,this.height=nr!==void 0?nr:512,this.clear=!0,this.needsSwap=!1,this.camera=tr,this.scene=er,this.kernelRadius=8,this.kernel=[],this.noiseTexture=null,this.output=0,this.minDistance=.005,this.maxDistance=.1,this._visibilityCache=new Map,this.generateSampleKernel(sr),this.generateRandomKernelRotations();const ar=new DepthTexture;ar.format=DepthStencilFormat,ar.type=UnsignedInt248Type,this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:ar}),this.ssaoRenderTarget=new WebGLRenderTarget(this.width,this.height,{type:HalfFloatType}),this.blurRenderTarget=this.ssaoRenderTarget.clone(),this.ssaoMaterial=new ShaderMaterial({defines:Object.assign({},SSAOShader.defines),uniforms:UniformsUtils.clone(SSAOShader.uniforms),vertexShader:SSAOShader.vertexShader,fragmentShader:SSAOShader.fragmentShader,blending:NoBlending}),this.ssaoMaterial.defines.KERNEL_SIZE=sr,this.ssaoMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssaoMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.ssaoMaterial.uniforms.tNoise.value=this.noiseTexture,this.ssaoMaterial.uniforms.kernel.value=this.kernel,this.ssaoMaterial.uniforms.cameraNear.value=this.camera.near,this.ssaoMaterial.uniforms.cameraFar.value=this.camera.far,this.ssaoMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSAOBlurShader.defines),uniforms:UniformsUtils.clone(SSAOBlurShader.uniforms),vertexShader:SSAOBlurShader.vertexShader,fragmentShader:SSAOBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSAODepthShader.defines),uniforms:UniformsUtils.clone(SSAODepthShader.uniforms),vertexShader:SSAODepthShader.vertexShader,fragmentShader:SSAODepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.normalRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:DstColorFactor,blendDst:ZeroFactor,blendEquation:AddEquation,blendSrcAlpha:DstAlphaFactor,blendDstAlpha:ZeroFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color}dispose(){this.normalRenderTarget.dispose(),this.ssaoRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.normalMaterial.dispose(),this.blurMaterial.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(er,tr,ir){switch(this.overrideVisibility(),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,7829503,1),this.restoreVisibility(),this.ssaoMaterial.uniforms.kernelRadius.value=this.kernelRadius,this.ssaoMaterial.uniforms.minDistance.value=this.minDistance,this.ssaoMaterial.uniforms.maxDistance.value=this.maxDistance,this.renderPass(er,this.ssaoMaterial,this.ssaoRenderTarget),this.renderPass(er,this.blurMaterial,this.blurRenderTarget),this.output){case SSAOPass.OUTPUT.SSAO:this.copyMaterial.uniforms.tDiffuse.value=this.ssaoRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:ir);break;case SSAOPass.OUTPUT.Blur:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:ir);break;case SSAOPass.OUTPUT.Depth:this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:ir);break;case SSAOPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:ir);break;case SSAOPass.OUTPUT.Default:this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.copyMaterial.blending=CustomBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:ir);break;default:console.warn("THREE.SSAOPass: Unknown output type.")}}renderPass(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,ir,nr,sr){er.getClearColor(this.originalClearColor);const ar=er.getClearAlpha(),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}setSize(er,tr){this.width=er,this.height=tr,this.ssaoRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.blurRenderTarget.setSize(er,tr),this.ssaoMaterial.uniforms.resolution.value.set(er,tr),this.ssaoMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssaoMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(er,tr)}generateSampleKernel(er){const tr=this.kernel;for(let ir=0;ir<er;ir++){const nr=new Vector3$1;nr.x=Math.random()*2-1,nr.y=Math.random()*2-1,nr.z=Math.random(),nr.normalize();let sr=ir/er;sr=MathUtils.lerp(.1,1,sr*sr),nr.multiplyScalar(sr),tr.push(nr)}}generateRandomKernelRotations(){const ir=new SimplexNoise,nr=4*4,sr=new Float32Array(nr);for(let ar=0;ar<nr;ar++){const or=Math.random()*2-1,lr=Math.random()*2-1,cr=0;sr[ar]=ir.noise3d(or,lr,cr)}this.noiseTexture=new DataTexture(sr,4,4,RedFormat,FloatType),this.noiseTexture.wrapS=RepeatWrapping,this.noiseTexture.wrapT=RepeatWrapping,this.noiseTexture.needsUpdate=!0}overrideVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(ir){tr.set(ir,ir.visible),(ir.isPoints||ir.isLine)&&(ir.visible=!1)})}restoreVisibility(){const er=this.scene,tr=this._visibilityCache;er.traverse(function(ir){const nr=tr.get(ir);ir.visible=nr}),tr.clear()}}SSAOPass.OUTPUT={Default:0,SSAO:1,Blur:2,Depth:3,Normal:4};const SSRShader={name:"SSRShader",defines:{MAX_STEP:0,PERSPECTIVE_CAMERA:!0,DISTANCE_ATTENUATION:!0,FRESNEL:!0,INFINITE_THICK:!1,SELECTIVE:!1},uniforms:{tDiffuse:{value:null},tNormal:{value:null},tMetalness:{value:null},tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null},resolution:{value:new Vector2},cameraProjectionMatrix:{value:new Matrix4},cameraInverseProjectionMatrix:{value:new Matrix4},opacity:{value:.5},maxDistance:{value:180},cameraRange:{value:0},thickness:{value:.018}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`
		// precision highp float;
		precision highp sampler2D;
		varying vec2 vUv;
		uniform sampler2D tDepth;
		uniform sampler2D tNormal;
		uniform sampler2D tMetalness;
		uniform sampler2D tDiffuse;
		uniform float cameraRange;
		uniform vec2 resolution;
		uniform float opacity;
		uniform float cameraNear;
		uniform float cameraFar;
		uniform float maxDistance;
		uniform float thickness;
		uniform mat4 cameraProjectionMatrix;
		uniform mat4 cameraInverseProjectionMatrix;
		#include <packing>
		float pointToLineDistance(vec3 x0, vec3 x1, vec3 x2) {
			//x0: point, x1: linePointA, x2: linePointB
			//https://mathworld.wolfram.com/Point-LineDistance3-Dimensional.html
			return length(cross(x0-x1,x0-x2))/length(x2-x1);
		}
		float pointPlaneDistance(vec3 point,vec3 planePoint,vec3 planeNormal){
			// https://mathworld.wolfram.com/Point-PlaneDistance.html
			//// https://en.wikipedia.org/wiki/Plane_(geometry)
			//// http://paulbourke.net/geometry/pointlineplane/
			float a=planeNormal.x,b=planeNormal.y,c=planeNormal.z;
			float x0=point.x,y0=point.y,z0=point.z;
			float x=planePoint.x,y=planePoint.y,z=planePoint.z;
			float d=-(a*x+b*y+c*z);
			float distance=(a*x0+b*y0+c*z0+d)/sqrt(a*a+b*b+c*c);
			return distance;
		}
		float getDepth( const in vec2 uv ) {
			return texture2D( tDepth, uv ).x;
		}
		float getViewZ( const in float depth ) {
			#ifdef PERSPECTIVE_CAMERA
				return perspectiveDepthToViewZ( depth, cameraNear, cameraFar );
			#else
				return orthographicDepthToViewZ( depth, cameraNear, cameraFar );
			#endif
		}
		vec3 getViewPosition( const in vec2 uv, const in float depth/*clip space*/, const in float clipW ) {
			vec4 clipPosition = vec4( ( vec3( uv, depth ) - 0.5 ) * 2.0, 1.0 );//ndc
			clipPosition *= clipW; //clip
			return ( cameraInverseProjectionMatrix * clipPosition ).xyz;//view
		}
		vec3 getViewNormal( const in vec2 uv ) {
			return unpackRGBToNormal( texture2D( tNormal, uv ).xyz );
		}
		vec2 viewPositionToXY(vec3 viewPosition){
			vec2 xy;
			vec4 clip=cameraProjectionMatrix*vec4(viewPosition,1);
			xy=clip.xy;//clip
			float clipW=clip.w;
			xy/=clipW;//NDC
			xy=(xy+1.)/2.;//uv
			xy*=resolution;//screen
			return xy;
		}
		void main(){
			#ifdef SELECTIVE
				float metalness=texture2D(tMetalness,vUv).r;
				if(metalness==0.) return;
			#endif

			float depth = getDepth( vUv );
			float viewZ = getViewZ( depth );
			if(-viewZ>=cameraFar) return;

			float clipW = cameraProjectionMatrix[2][3] * viewZ+cameraProjectionMatrix[3][3];
			vec3 viewPosition=getViewPosition( vUv, depth, clipW );

			vec2 d0=gl_FragCoord.xy;
			vec2 d1;

			vec3 viewNormal=getViewNormal( vUv );

			#ifdef PERSPECTIVE_CAMERA
				vec3 viewIncidentDir=normalize(viewPosition);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#else
				vec3 viewIncidentDir=vec3(0,0,-1);
				vec3 viewReflectDir=reflect(viewIncidentDir,viewNormal);
			#endif

			float maxReflectRayLen=maxDistance/dot(-viewIncidentDir,viewNormal);
			// dot(a,b)==length(a)*length(b)*cos(theta) // https://www.mathsisfun.com/algebra/vectors-dot-product.html
			// if(a.isNormalized&&b.isNormalized) dot(a,b)==cos(theta)
			// maxDistance/maxReflectRayLen=cos(theta)
			// maxDistance/maxReflectRayLen==dot(a,b)
			// maxReflectRayLen==maxDistance/dot(a,b)

			vec3 d1viewPosition=viewPosition+viewReflectDir*maxReflectRayLen;
			#ifdef PERSPECTIVE_CAMERA
				if(d1viewPosition.z>-cameraNear){
					//https://tutorial.math.lamar.edu/Classes/CalcIII/EqnsOfLines.aspx
					float t=(-cameraNear-viewPosition.z)/viewReflectDir.z;
					d1viewPosition=viewPosition+viewReflectDir*t;
				}
			#endif
			d1=viewPositionToXY(d1viewPosition);

			float totalLen=length(d1-d0);
			float xLen=d1.x-d0.x;
			float yLen=d1.y-d0.y;
			float totalStep=max(abs(xLen),abs(yLen));
			float xSpan=xLen/totalStep;
			float ySpan=yLen/totalStep;
			for(float i=0.;i<float(MAX_STEP);i++){
				if(i>=totalStep) break;
				vec2 xy=vec2(d0.x+i*xSpan,d0.y+i*ySpan);
				if(xy.x<0.||xy.x>resolution.x||xy.y<0.||xy.y>resolution.y) break;
				float s=length(xy-d0)/totalLen;
				vec2 uv=xy/resolution;

				float d = getDepth(uv);
				float vZ = getViewZ( d );
				if(-vZ>=cameraFar) continue;
				float cW = cameraProjectionMatrix[2][3] * vZ+cameraProjectionMatrix[3][3];
				vec3 vP=getViewPosition( uv, d, cW );

				#ifdef PERSPECTIVE_CAMERA
					// https://comp.nus.edu.sg/~lowkl/publications/lowk_persp_interp_techrep.pdf
					float recipVPZ=1./viewPosition.z;
					float viewReflectRayZ=1./(recipVPZ+s*(1./d1viewPosition.z-recipVPZ));
				#else
					float viewReflectRayZ=viewPosition.z+s*(d1viewPosition.z-viewPosition.z);
				#endif

				// if(viewReflectRayZ>vZ) continue; // will cause "npm run make-screenshot webgl_postprocessing_ssr" high probability hang.
				// https://github.com/mrdoob/three.js/pull/21539#issuecomment-821061164
				if(viewReflectRayZ<=vZ){

					bool hit;
					#ifdef INFINITE_THICK
						hit=true;
					#else
						float away=pointToLineDistance(vP,viewPosition,d1viewPosition);

						float minThickness;
						vec2 xyNeighbor=xy;
						xyNeighbor.x+=1.;
						vec2 uvNeighbor=xyNeighbor/resolution;
						vec3 vPNeighbor=getViewPosition(uvNeighbor,d,cW);
						minThickness=vPNeighbor.x-vP.x;
						minThickness*=3.;
						float tk=max(minThickness,thickness);

						hit=away<=tk;
					#endif

					if(hit){
						vec3 vN=getViewNormal( uv );
						if(dot(viewReflectDir,vN)>=0.) continue;
						float distance=pointPlaneDistance(vP,viewPosition,viewNormal);
						if(distance>maxDistance) break;
						float op=opacity;
						#ifdef DISTANCE_ATTENUATION
							float ratio=1.-(distance/maxDistance);
							float attenuation=ratio*ratio;
							op=opacity*attenuation;
						#endif
						#ifdef FRESNEL
							float fresnelCoe=(dot(viewIncidentDir,viewReflectDir)+1.)/2.;
							op*=fresnelCoe;
						#endif
						vec4 reflectColor=texture2D(tDiffuse,uv);
						gl_FragColor.xyz=reflectColor.xyz;
						gl_FragColor.a=op;
						break;
					}
				}
			}
		}
	`},SSRDepthShader={name:"SSRDepthShader",defines:{PERSPECTIVE_CAMERA:1},uniforms:{tDepth:{value:null},cameraNear:{value:null},cameraFar:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDepth;

		uniform float cameraNear;
		uniform float cameraFar;

		varying vec2 vUv;

		#include <packing>

		float getLinearDepth( const in vec2 uv ) {

			#if PERSPECTIVE_CAMERA == 1

				float fragCoordZ = texture2D( tDepth, uv ).x;
				float viewZ = perspectiveDepthToViewZ( fragCoordZ, cameraNear, cameraFar );
				return viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );

			#else

				return texture2D( tDepth, uv ).x;

			#endif

		}

		void main() {

			float depth = getLinearDepth( vUv );
			float d = 1.0 - depth;
			// d=(d-.999)*1000.;
			gl_FragColor = vec4( vec3( d ), 1.0 );

		}

	`},SSRBlurShader={name:"SSRBlurShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2},opacity:{value:.5}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}

	`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;
		void main() {
			//reverse engineering from PhotoShop blur filter, then change coefficient

			vec2 texelSize = ( 1.0 / resolution );

			vec4 c=texture2D(tDiffuse,vUv);

			vec2 offset;

			offset=(vec2(-1,0))*texelSize;
			vec4 cl=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(1,0))*texelSize;
			vec4 cr=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,-1))*texelSize;
			vec4 cb=texture2D(tDiffuse,vUv+offset);

			offset=(vec2(0,1))*texelSize;
			vec4 ct=texture2D(tDiffuse,vUv+offset);

			// float coeCenter=.5;
			// float coeSide=.125;
			float coeCenter=.2;
			float coeSide=.2;
			float a=c.a*coeCenter+cl.a*coeSide+cr.a*coeSide+cb.a*coeSide+ct.a*coeSide;
			vec3 rgb=(c.rgb*c.a*coeCenter+cl.rgb*cl.a*coeSide+cr.rgb*cr.a*coeSide+cb.rgb*cb.a*coeSide+ct.rgb*ct.a*coeSide)/a;
			gl_FragColor=vec4(rgb,a);

		}
	`};class SSRPass extends Pass$1{constructor({renderer:er,scene:tr,camera:ir,width:nr,height:sr,selects:ar,bouncing:or=!1,groundReflector:lr}){super(),this.width=nr!==void 0?nr:512,this.height=sr!==void 0?sr:512,this.clear=!0,this.renderer=er,this.scene=tr,this.camera=ir,this.groundReflector=lr,this.opacity=SSRShader.uniforms.opacity.value,this.output=0,this.maxDistance=SSRShader.uniforms.maxDistance.value,this.thickness=SSRShader.uniforms.thickness.value,this.tempColor=new Color,this._selects=ar,this.selective=Array.isArray(this._selects),Object.defineProperty(this,"selects",{get(){return this._selects},set(ur){this._selects!==ur&&(this._selects=ur,Array.isArray(ur)?(this.selective=!0,this.ssrMaterial.defines.SELECTIVE=!0,this.ssrMaterial.needsUpdate=!0):(this.selective=!1,this.ssrMaterial.defines.SELECTIVE=!1,this.ssrMaterial.needsUpdate=!0))}}),this._bouncing=or,Object.defineProperty(this,"bouncing",{get(){return this._bouncing},set(ur){this._bouncing!==ur&&(this._bouncing=ur,ur?this.ssrMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture:this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture)}}),this.blur=!0,this._distanceAttenuation=SSRShader.defines.DISTANCE_ATTENUATION,Object.defineProperty(this,"distanceAttenuation",{get(){return this._distanceAttenuation},set(ur){this._distanceAttenuation!==ur&&(this._distanceAttenuation=ur,this.ssrMaterial.defines.DISTANCE_ATTENUATION=ur,this.ssrMaterial.needsUpdate=!0)}}),this._fresnel=SSRShader.defines.FRESNEL,Object.defineProperty(this,"fresnel",{get(){return this._fresnel},set(ur){this._fresnel!==ur&&(this._fresnel=ur,this.ssrMaterial.defines.FRESNEL=ur,this.ssrMaterial.needsUpdate=!0)}}),this._infiniteThick=SSRShader.defines.INFINITE_THICK,Object.defineProperty(this,"infiniteThick",{get(){return this._infiniteThick},set(ur){this._infiniteThick!==ur&&(this._infiniteThick=ur,this.ssrMaterial.defines.INFINITE_THICK=ur,this.ssrMaterial.needsUpdate=!0)}});const cr=new DepthTexture;cr.type=UnsignedShortType,cr.minFilter=NearestFilter,cr.magFilter=NearestFilter,this.beautyRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType,depthTexture:cr,depthBuffer:!0}),this.prevRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter}),this.normalRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.metalnessRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter,type:HalfFloatType}),this.ssrRenderTarget=new WebGLRenderTarget(this.width,this.height,{minFilter:NearestFilter,magFilter:NearestFilter}),this.blurRenderTarget=this.ssrRenderTarget.clone(),this.blurRenderTarget2=this.ssrRenderTarget.clone(),this.ssrMaterial=new ShaderMaterial({defines:Object.assign({},SSRShader.defines,{MAX_STEP:Math.sqrt(this.width*this.width+this.height*this.height)}),uniforms:UniformsUtils.clone(SSRShader.uniforms),vertexShader:SSRShader.vertexShader,fragmentShader:SSRShader.fragmentShader,blending:NoBlending}),this.ssrMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.ssrMaterial.uniforms.tNormal.value=this.normalRenderTarget.texture,this.ssrMaterial.defines.SELECTIVE=this.selective,this.ssrMaterial.needsUpdate=!0,this.ssrMaterial.uniforms.tMetalness.value=this.metalnessRenderTarget.texture,this.ssrMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.ssrMaterial.uniforms.cameraNear.value=this.camera.near,this.ssrMaterial.uniforms.cameraFar.value=this.camera.far,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.ssrMaterial.uniforms.resolution.value.set(this.width,this.height),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.normalMaterial=new MeshNormalMaterial,this.normalMaterial.blending=NoBlending,this.metalnessOnMaterial=new MeshBasicMaterial({color:"white"}),this.metalnessOffMaterial=new MeshBasicMaterial({color:"black"}),this.blurMaterial=new ShaderMaterial({defines:Object.assign({},SSRBlurShader.defines),uniforms:UniformsUtils.clone(SSRBlurShader.uniforms),vertexShader:SSRBlurShader.vertexShader,fragmentShader:SSRBlurShader.fragmentShader}),this.blurMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.blurMaterial.uniforms.resolution.value.set(this.width,this.height),this.blurMaterial2=new ShaderMaterial({defines:Object.assign({},SSRBlurShader.defines),uniforms:UniformsUtils.clone(SSRBlurShader.uniforms),vertexShader:SSRBlurShader.vertexShader,fragmentShader:SSRBlurShader.fragmentShader}),this.blurMaterial2.uniforms.tDiffuse.value=this.blurRenderTarget.texture,this.blurMaterial2.uniforms.resolution.value.set(this.width,this.height),this.depthRenderMaterial=new ShaderMaterial({defines:Object.assign({},SSRDepthShader.defines),uniforms:UniformsUtils.clone(SSRDepthShader.uniforms),vertexShader:SSRDepthShader.vertexShader,fragmentShader:SSRDepthShader.fragmentShader,blending:NoBlending}),this.depthRenderMaterial.uniforms.tDepth.value=this.beautyRenderTarget.depthTexture,this.depthRenderMaterial.uniforms.cameraNear.value=this.camera.near,this.depthRenderMaterial.uniforms.cameraFar.value=this.camera.far,this.copyMaterial=new ShaderMaterial({uniforms:UniformsUtils.clone(CopyShader.uniforms),vertexShader:CopyShader.vertexShader,fragmentShader:CopyShader.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1,blendSrc:SrcAlphaFactor,blendDst:OneMinusSrcAlphaFactor,blendEquation:AddEquation,blendSrcAlpha:SrcAlphaFactor,blendDstAlpha:OneMinusSrcAlphaFactor,blendEquationAlpha:AddEquation}),this.fsQuad=new FullScreenQuad(null),this.originalClearColor=new Color}dispose(){this.beautyRenderTarget.dispose(),this.prevRenderTarget.dispose(),this.normalRenderTarget.dispose(),this.metalnessRenderTarget.dispose(),this.ssrRenderTarget.dispose(),this.blurRenderTarget.dispose(),this.blurRenderTarget2.dispose(),this.normalMaterial.dispose(),this.metalnessOnMaterial.dispose(),this.metalnessOffMaterial.dispose(),this.blurMaterial.dispose(),this.blurMaterial2.dispose(),this.copyMaterial.dispose(),this.depthRenderMaterial.dispose(),this.fsQuad.dispose()}render(er,tr){switch(er.setRenderTarget(this.beautyRenderTarget),er.clear(),this.groundReflector&&(this.groundReflector.visible=!1,this.groundReflector.doRender(this.renderer,this.scene,this.camera),this.groundReflector.visible=!0),er.render(this.scene,this.camera),this.groundReflector&&(this.groundReflector.visible=!1),this.renderOverride(er,this.normalMaterial,this.normalRenderTarget,0,0),this.selective&&this.renderMetalness(er,this.metalnessOnMaterial,this.metalnessRenderTarget,0,0),this.ssrMaterial.uniforms.opacity.value=this.opacity,this.ssrMaterial.uniforms.maxDistance.value=this.maxDistance,this.ssrMaterial.uniforms.thickness.value=this.thickness,this.renderPass(er,this.ssrMaterial,this.ssrRenderTarget),this.blur&&(this.renderPass(er,this.blurMaterial,this.blurRenderTarget),this.renderPass(er,this.blurMaterial2,this.blurRenderTarget2)),this.output){case SSRPass.OUTPUT.Default:this.bouncing?(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.prevRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr)):(this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr));break;case SSRPass.OUTPUT.SSR:this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr),this.bouncing&&(this.blur?this.copyMaterial.uniforms.tDiffuse.value=this.blurRenderTarget2.texture:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget),this.copyMaterial.uniforms.tDiffuse.value=this.ssrRenderTarget.texture,this.copyMaterial.blending=NormalBlending,this.renderPass(er,this.copyMaterial,this.prevRenderTarget));break;case SSRPass.OUTPUT.Beauty:this.copyMaterial.uniforms.tDiffuse.value=this.beautyRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Depth:this.renderPass(er,this.depthRenderMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Normal:this.copyMaterial.uniforms.tDiffuse.value=this.normalRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;case SSRPass.OUTPUT.Metalness:this.copyMaterial.uniforms.tDiffuse.value=this.metalnessRenderTarget.texture,this.copyMaterial.blending=NoBlending,this.renderPass(er,this.copyMaterial,this.renderToScreen?null:tr);break;default:console.warn("THREE.SSRPass: Unknown output type.")}}renderPass(er,tr,ir,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.fsQuad.material=tr,this.fsQuad.render(er),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderOverride(er,tr,ir,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear;er.setRenderTarget(ir),er.autoClear=!1,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.overrideMaterial=tr,er.render(this.scene,this.camera),this.scene.overrideMaterial=null,er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar)}renderMetalness(er,tr,ir,nr,sr){this.originalClearColor.copy(er.getClearColor(this.tempColor));const ar=er.getClearAlpha(this.tempColor),or=er.autoClear,lr=this.scene.background,cr=this.scene.fog;er.setRenderTarget(ir),er.autoClear=!1,this.scene.background=null,this.scene.fog=null,nr=tr.clearColor||nr,sr=tr.clearAlpha||sr,nr!=null&&(er.setClearColor(nr),er.setClearAlpha(sr||0),er.clear()),this.scene.traverseVisible(ur=>{ur._SSRPassBackupMaterial=ur.material,this._selects.includes(ur)?ur.material=this.metalnessOnMaterial:ur.material=this.metalnessOffMaterial}),er.render(this.scene,this.camera),this.scene.traverseVisible(ur=>{ur.material=ur._SSRPassBackupMaterial}),er.autoClear=or,er.setClearColor(this.originalClearColor),er.setClearAlpha(ar),this.scene.background=lr,this.scene.fog=cr}setSize(er,tr){this.width=er,this.height=tr,this.ssrMaterial.defines.MAX_STEP=Math.sqrt(er*er+tr*tr),this.ssrMaterial.needsUpdate=!0,this.beautyRenderTarget.setSize(er,tr),this.prevRenderTarget.setSize(er,tr),this.ssrRenderTarget.setSize(er,tr),this.normalRenderTarget.setSize(er,tr),this.metalnessRenderTarget.setSize(er,tr),this.blurRenderTarget.setSize(er,tr),this.blurRenderTarget2.setSize(er,tr),this.ssrMaterial.uniforms.resolution.value.set(er,tr),this.ssrMaterial.uniforms.cameraProjectionMatrix.value.copy(this.camera.projectionMatrix),this.ssrMaterial.uniforms.cameraInverseProjectionMatrix.value.copy(this.camera.projectionMatrixInverse),this.blurMaterial.uniforms.resolution.value.set(er,tr),this.blurMaterial2.uniforms.resolution.value.set(er,tr)}}SSRPass.OUTPUT={Default:0,SSR:1,Beauty:3,Depth:4,Normal:5,Metalness:7};class SavePass extends Pass$1{constructor(er){super();const tr=CopyShader;this.textureID="tDiffuse",this.uniforms=UniformsUtils.clone(tr.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:tr.vertexShader,fragmentShader:tr.fragmentShader,blending:NoBlending}),this.renderTarget=er,this.renderTarget===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{type:HalfFloatType}),this.renderTarget.texture.name="SavePass.rt"),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(this.material)}render(er,tr,ir){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=ir.texture),er.setRenderTarget(this.renderTarget),this.clear&&er.clear(),this.fsQuad.render(er)}setSize(er,tr){this.renderTarget.setSize(er,tr)}dispose(){this.renderTarget.dispose(),this.material.dispose(),this.fsQuad.dispose()}}class TAARenderPass extends SSAARenderPass{constructor(er,tr,ir,nr){super(er,tr,ir,nr),this.sampleLevel=0,this.accumulate=!1,this.accumulateIndex=-1}render(er,tr,ir,nr){if(this.accumulate===!1){super.render(er,tr,ir,nr),this.accumulateIndex=-1;return}const sr=_JitterVectors[5];this.sampleRenderTarget===void 0&&(this.sampleRenderTarget=new WebGLRenderTarget(ir.width,ir.height,{type:HalfFloatType}),this.sampleRenderTarget.texture.name="TAARenderPass.sample"),this.holdRenderTarget===void 0&&(this.holdRenderTarget=new WebGLRenderTarget(ir.width,ir.height,{type:HalfFloatType}),this.holdRenderTarget.texture.name="TAARenderPass.hold"),this.accumulateIndex===-1&&(super.render(er,this.holdRenderTarget,ir,nr),this.accumulateIndex=0);const ar=er.autoClear;er.autoClear=!1,er.getClearColor(this._oldClearColor);const or=er.getClearAlpha(),lr=1/sr.length;if(this.accumulateIndex>=0&&this.accumulateIndex<sr.length){this.copyUniforms.opacity.value=lr,this.copyUniforms.tDiffuse.value=tr.texture;const ur=Math.pow(2,this.sampleLevel);for(let dr=0;dr<ur;dr++){const hr=this.accumulateIndex,pr=sr[hr];if(this.camera.setViewOffset&&this.camera.setViewOffset(ir.width,ir.height,pr[0]*.0625,pr[1]*.0625,ir.width,ir.height),er.setRenderTarget(tr),er.setClearColor(this.clearColor,this.clearAlpha),er.clear(),er.render(this.scene,this.camera),er.setRenderTarget(this.sampleRenderTarget),this.accumulateIndex===0&&(er.setClearColor(0,0),er.clear()),this.fsQuad.render(er),this.accumulateIndex++,this.accumulateIndex>=sr.length)break}this.camera.clearViewOffset&&this.camera.clearViewOffset()}er.setClearColor(this.clearColor,this.clearAlpha);const cr=this.accumulateIndex*lr;cr>0&&(this.copyUniforms.opacity.value=1,this.copyUniforms.tDiffuse.value=this.sampleRenderTarget.texture,er.setRenderTarget(tr),er.clear(),this.fsQuad.render(er)),cr<1&&(this.copyUniforms.opacity.value=1-cr,this.copyUniforms.tDiffuse.value=this.holdRenderTarget.texture,er.setRenderTarget(tr),this.fsQuad.render(er)),er.autoClear=ar,er.setClearColor(this._oldClearColor,or)}dispose(){super.dispose(),this.holdRenderTarget&&this.holdRenderTarget.dispose()}}const _JitterVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];class TexturePass extends Pass$1{constructor(er,tr){super();const ir=CopyShader;this.map=er,this.opacity=tr!==void 0?tr:1,this.uniforms=UniformsUtils.clone(ir.uniforms),this.material=new ShaderMaterial({uniforms:this.uniforms,vertexShader:ir.vertexShader,fragmentShader:ir.fragmentShader,depthTest:!1,depthWrite:!1,premultipliedAlpha:!0}),this.needsSwap=!1,this.fsQuad=new FullScreenQuad(null)}render(er,tr,ir){const nr=er.autoClear;er.autoClear=!1,this.fsQuad.material=this.material,this.uniforms.opacity.value=this.opacity,this.uniforms.tDiffuse.value=this.map,this.material.transparent=this.opacity<1,er.setRenderTarget(this.renderToScreen?null:ir),this.clear&&er.clear(),this.fsQuad.render(er),er.autoClear=nr}dispose(){this.material.dispose(),this.fsQuad.dispose()}}const LuminosityHighPassShader={name:"LuminosityHighPassShader",shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Color(0)},defaultOpacity:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 defaultColor;
		uniform float defaultOpacity;
		uniform float luminosityThreshold;
		uniform float smoothWidth;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );

			float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );

			gl_FragColor = mix( outputColor, texel, alpha );

		}`};class UnrealBloomPass extends Pass$1{constructor(er,tr,ir,nr){super(),this.strength=tr!==void 0?tr:1,this.radius=ir,this.threshold=nr,this.resolution=er!==void 0?new Vector2(er.x,er.y):new Vector2(256,256),this.clearColor=new Color(0,0,0),this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;let sr=Math.round(this.resolution.x/2),ar=Math.round(this.resolution.y/2);this.renderTargetBright=new WebGLRenderTarget(sr,ar,{type:HalfFloatType}),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(let dr=0;dr<this.nMips;dr++){const hr=new WebGLRenderTarget(sr,ar,{type:HalfFloatType});hr.texture.name="UnrealBloomPass.h"+dr,hr.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(hr);const pr=new WebGLRenderTarget(sr,ar,{type:HalfFloatType});pr.texture.name="UnrealBloomPass.v"+dr,pr.texture.generateMipmaps=!1,this.renderTargetsVertical.push(pr),sr=Math.round(sr/2),ar=Math.round(ar/2)}const or=LuminosityHighPassShader;this.highPassUniforms=UniformsUtils.clone(or.uniforms),this.highPassUniforms.luminosityThreshold.value=nr,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new ShaderMaterial({uniforms:this.highPassUniforms,vertexShader:or.vertexShader,fragmentShader:or.fragmentShader}),this.separableBlurMaterials=[];const lr=[3,5,7,9,11];sr=Math.round(this.resolution.x/2),ar=Math.round(this.resolution.y/2);for(let dr=0;dr<this.nMips;dr++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(lr[dr])),this.separableBlurMaterials[dr].uniforms.invSize.value=new Vector2(1/sr,1/ar),sr=Math.round(sr/2),ar=Math.round(ar/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=tr,this.compositeMaterial.uniforms.bloomRadius.value=.1;const cr=[1,.8,.6,.4,.2];this.compositeMaterial.uniforms.bloomFactors.value=cr,this.bloomTintColors=[new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1),new Vector3$1(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors;const ur=CopyShader;this.copyUniforms=UniformsUtils.clone(ur.uniforms),this.blendMaterial=new ShaderMaterial({uniforms:this.copyUniforms,vertexShader:ur.vertexShader,fragmentShader:ur.fragmentShader,blending:AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Color,this.oldClearAlpha=1,this.basic=new MeshBasicMaterial,this.fsQuad=new FullScreenQuad(null)}dispose(){for(let er=0;er<this.renderTargetsHorizontal.length;er++)this.renderTargetsHorizontal[er].dispose();for(let er=0;er<this.renderTargetsVertical.length;er++)this.renderTargetsVertical[er].dispose();this.renderTargetBright.dispose();for(let er=0;er<this.separableBlurMaterials.length;er++)this.separableBlurMaterials[er].dispose();this.compositeMaterial.dispose(),this.blendMaterial.dispose(),this.basic.dispose(),this.fsQuad.dispose()}setSize(er,tr){let ir=Math.round(er/2),nr=Math.round(tr/2);this.renderTargetBright.setSize(ir,nr);for(let sr=0;sr<this.nMips;sr++)this.renderTargetsHorizontal[sr].setSize(ir,nr),this.renderTargetsVertical[sr].setSize(ir,nr),this.separableBlurMaterials[sr].uniforms.invSize.value=new Vector2(1/ir,1/nr),ir=Math.round(ir/2),nr=Math.round(nr/2)}render(er,tr,ir,nr,sr){er.getClearColor(this._oldClearColor),this.oldClearAlpha=er.getClearAlpha();const ar=er.autoClear;er.autoClear=!1,er.setClearColor(this.clearColor,0),sr&&er.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=ir.texture,er.setRenderTarget(null),er.clear(),this.fsQuad.render(er)),this.highPassUniforms.tDiffuse.value=ir.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,er.setRenderTarget(this.renderTargetBright),er.clear(),this.fsQuad.render(er);let or=this.renderTargetBright;for(let lr=0;lr<this.nMips;lr++)this.fsQuad.material=this.separableBlurMaterials[lr],this.separableBlurMaterials[lr].uniforms.colorTexture.value=or.texture,this.separableBlurMaterials[lr].uniforms.direction.value=UnrealBloomPass.BlurDirectionX,er.setRenderTarget(this.renderTargetsHorizontal[lr]),er.clear(),this.fsQuad.render(er),this.separableBlurMaterials[lr].uniforms.colorTexture.value=this.renderTargetsHorizontal[lr].texture,this.separableBlurMaterials[lr].uniforms.direction.value=UnrealBloomPass.BlurDirectionY,er.setRenderTarget(this.renderTargetsVertical[lr]),er.clear(),this.fsQuad.render(er),or=this.renderTargetsVertical[lr];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,er.setRenderTarget(this.renderTargetsHorizontal[0]),er.clear(),this.fsQuad.render(er),this.fsQuad.material=this.blendMaterial,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,sr&&er.state.buffers.stencil.setTest(!0),this.renderToScreen?(er.setRenderTarget(null),this.fsQuad.render(er)):(er.setRenderTarget(ir),this.fsQuad.render(er)),er.setClearColor(this._oldClearColor,this.oldClearAlpha),er.autoClear=ar}getSeperableBlurMaterial(er){const tr=[];for(let ir=0;ir<er;ir++)tr.push(.39894*Math.exp(-.5*ir*ir/(er*er))/er);return new ShaderMaterial({defines:{KERNEL_RADIUS:er},uniforms:{colorTexture:{value:null},invSize:{value:new Vector2(.5,.5)},direction:{value:new Vector2(.5,.5)},gaussianCoefficients:{value:tr}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`#include <common>
				varying vec2 vUv;
				uniform sampler2D colorTexture;
				uniform vec2 invSize;
				uniform vec2 direction;
				uniform float gaussianCoefficients[KERNEL_RADIUS];

				void main() {
					float weightSum = gaussianCoefficients[0];
					vec3 diffuseSum = texture2D( colorTexture, vUv ).rgb * weightSum;
					for( int i = 1; i < KERNEL_RADIUS; i ++ ) {
						float x = float(i);
						float w = gaussianCoefficients[i];
						vec2 uvOffset = direction * invSize * x;
						vec3 sample1 = texture2D( colorTexture, vUv + uvOffset ).rgb;
						vec3 sample2 = texture2D( colorTexture, vUv - uvOffset ).rgb;
						diffuseSum += (sample1 + sample2) * w;
						weightSum += 2.0 * w;
					}
					gl_FragColor = vec4(diffuseSum/weightSum, 1.0);
				}`})}getCompositeMaterial(er){return new ShaderMaterial({defines:{NUM_MIPS:er},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:`varying vec2 vUv;
				void main() {
					vUv = uv;
					gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
				}`,fragmentShader:`varying vec2 vUv;
				uniform sampler2D blurTexture1;
				uniform sampler2D blurTexture2;
				uniform sampler2D blurTexture3;
				uniform sampler2D blurTexture4;
				uniform sampler2D blurTexture5;
				uniform float bloomStrength;
				uniform float bloomRadius;
				uniform float bloomFactors[NUM_MIPS];
				uniform vec3 bloomTintColors[NUM_MIPS];

				float lerpBloomFactor(const in float factor) {
					float mirrorFactor = 1.2 - factor;
					return mix(factor, mirrorFactor, bloomRadius);
				}

				void main() {
					gl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +
						lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +
						lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +
						lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +
						lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );
				}`})}}UnrealBloomPass.BlurDirectionX=new Vector2(1,0);UnrealBloomPass.BlurDirectionY=new Vector2(0,1);class CSS2DObject extends Object3D{constructor(er=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=er,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new Vector2(.5,.5),this.addEventListener("removed",function(){this.traverse(function(tr){tr.element instanceof tr.element.ownerDocument.defaultView.Element&&tr.element.parentNode!==null&&tr.element.remove()})})}copy(er,tr){return super.copy(er,tr),this.element=er.element.cloneNode(!0),this.center=er.center,this}}const _vector$1=new Vector3$1,_viewMatrix=new Matrix4,_viewProjectionMatrix=new Matrix4,_a=new Vector3$1,_b=new Vector3$1;class CSS2DRenderer{constructor(er={}){const tr=this;let ir,nr,sr,ar;const or={objects:new WeakMap},lr=er.element!==void 0?er.element:document.createElement("div");lr.style.overflow="hidden",this.domElement=lr,this.getSize=function(){return{width:ir,height:nr}},this.render=function(gr,vr){gr.matrixWorldAutoUpdate===!0&&gr.updateMatrixWorld(),vr.parent===null&&vr.matrixWorldAutoUpdate===!0&&vr.updateMatrixWorld(),_viewMatrix.copy(vr.matrixWorldInverse),_viewProjectionMatrix.multiplyMatrices(vr.projectionMatrix,_viewMatrix),ur(gr,gr,vr),pr(gr)},this.setSize=function(gr,vr){ir=gr,nr=vr,sr=ir/2,ar=nr/2,lr.style.width=gr+"px",lr.style.height=vr+"px"};function cr(gr){gr.isCSS2DObject&&(gr.element.style.display="none");for(let vr=0,mr=gr.children.length;vr<mr;vr++)cr(gr.children[vr])}function ur(gr,vr,mr){if(gr.visible===!1){cr(gr);return}if(gr.isCSS2DObject){_vector$1.setFromMatrixPosition(gr.matrixWorld),_vector$1.applyMatrix4(_viewProjectionMatrix);const fr=_vector$1.z>=-1&&_vector$1.z<=1&&gr.layers.test(mr.layers)===!0,_r=gr.element;_r.style.display=fr===!0?"":"none",fr===!0&&(gr.onBeforeRender(tr,vr,mr),_r.style.transform="translate("+-100*gr.center.x+"%,"+-100*gr.center.y+"%)translate("+(_vector$1.x*sr+sr)+"px,"+(-_vector$1.y*ar+ar)+"px)",_r.parentNode!==lr&&lr.appendChild(_r),gr.onAfterRender(tr,vr,mr));const Ar={distanceToCameraSquared:dr(mr,gr)};or.objects.set(gr,Ar)}for(let fr=0,_r=gr.children.length;fr<_r;fr++)ur(gr.children[fr],vr,mr)}function dr(gr,vr){return _a.setFromMatrixPosition(gr.matrixWorld),_b.setFromMatrixPosition(vr.matrixWorld),_a.distanceToSquared(_b)}function hr(gr){const vr=[];return gr.traverseVisible(function(mr){mr.isCSS2DObject&&vr.push(mr)}),vr}function pr(gr){const vr=hr(gr).sort(function(fr,_r){if(fr.renderOrder!==_r.renderOrder)return _r.renderOrder-fr.renderOrder;const Ar=or.objects.get(fr).distanceToCameraSquared,yr=or.objects.get(_r).distanceToCameraSquared;return Ar-yr}),mr=vr.length;for(let fr=0,_r=vr.length;fr<_r;fr++)vr[fr].element.style.zIndex=mr-fr}}}const _position$1=new Vector3$1,_quaternion=new Quaternion$1,_scale=new Vector3$1;class CSS3DObject extends Object3D{constructor(er=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=er,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(tr){tr.element instanceof tr.element.ownerDocument.defaultView.Element&&tr.element.parentNode!==null&&tr.element.remove()})})}copy(er,tr){return super.copy(er,tr),this.element=er.element.cloneNode(!0),this}}class CSS3DSprite extends CSS3DObject{constructor(er){super(er),this.isCSS3DSprite=!0,this.rotation2D=0}copy(er,tr){return super.copy(er,tr),this.rotation2D=er.rotation2D,this}}const _matrix$3=new Matrix4,_matrix2=new Matrix4;class CSS3DRenderer{constructor(er={}){const tr=this;let ir,nr,sr,ar;const or={camera:{style:""},objects:new WeakMap},lr=er.element!==void 0?er.element:document.createElement("div");lr.style.overflow="hidden",this.domElement=lr;const cr=document.createElement("div");cr.style.transformOrigin="0 0",cr.style.pointerEvents="none",lr.appendChild(cr);const ur=document.createElement("div");ur.style.transformStyle="preserve-3d",cr.appendChild(ur),this.getSize=function(){return{width:ir,height:nr}},this.render=function(mr,fr){const _r=fr.projectionMatrix.elements[5]*ar;fr.view&&fr.view.enabled?(cr.style.transform=`translate( ${-fr.view.offsetX*(ir/fr.view.width)}px, ${-fr.view.offsetY*(nr/fr.view.height)}px )`,cr.style.transform+=`scale( ${fr.view.fullWidth/fr.view.width}, ${fr.view.fullHeight/fr.view.height} )`):cr.style.transform="",mr.matrixWorldAutoUpdate===!0&&mr.updateMatrixWorld(),fr.parent===null&&fr.matrixWorldAutoUpdate===!0&&fr.updateMatrixWorld();let Ar,yr;fr.isOrthographicCamera&&(Ar=-(fr.right+fr.left)/2,yr=(fr.top+fr.bottom)/2);const wr=fr.view&&fr.view.enabled?fr.view.height/fr.view.fullHeight:1,xr=fr.isOrthographicCamera?`scale( ${wr} )scale(`+_r+")translate("+dr(Ar)+"px,"+dr(yr)+"px)"+hr(fr.matrixWorldInverse):`scale( ${wr} )translateZ(`+_r+"px)"+hr(fr.matrixWorldInverse),br=(fr.isPerspectiveCamera?"perspective("+_r+"px) ":"")+xr+"translate("+sr+"px,"+ar+"px)";or.camera.style!==br&&(ur.style.transform=br,or.camera.style=br),vr(mr,mr,fr,xr)},this.setSize=function(mr,fr){ir=mr,nr=fr,sr=ir/2,ar=nr/2,lr.style.width=mr+"px",lr.style.height=fr+"px",cr.style.width=mr+"px",cr.style.height=fr+"px",ur.style.width=mr+"px",ur.style.height=fr+"px"};function dr(mr){return Math.abs(mr)<1e-10?0:mr}function hr(mr){const fr=mr.elements;return"matrix3d("+dr(fr[0])+","+dr(-fr[1])+","+dr(fr[2])+","+dr(fr[3])+","+dr(fr[4])+","+dr(-fr[5])+","+dr(fr[6])+","+dr(fr[7])+","+dr(fr[8])+","+dr(-fr[9])+","+dr(fr[10])+","+dr(fr[11])+","+dr(fr[12])+","+dr(-fr[13])+","+dr(fr[14])+","+dr(fr[15])+")"}function pr(mr){const fr=mr.elements;return"translate(-50%,-50%)"+("matrix3d("+dr(fr[0])+","+dr(fr[1])+","+dr(fr[2])+","+dr(fr[3])+","+dr(-fr[4])+","+dr(-fr[5])+","+dr(-fr[6])+","+dr(-fr[7])+","+dr(fr[8])+","+dr(fr[9])+","+dr(fr[10])+","+dr(fr[11])+","+dr(fr[12])+","+dr(fr[13])+","+dr(fr[14])+","+dr(fr[15])+")")}function gr(mr){mr.isCSS3DObject&&(mr.element.style.display="none");for(let fr=0,_r=mr.children.length;fr<_r;fr++)gr(mr.children[fr])}function vr(mr,fr,_r,Ar){if(mr.visible===!1){gr(mr);return}if(mr.isCSS3DObject){const yr=mr.layers.test(_r.layers)===!0,wr=mr.element;if(wr.style.display=yr===!0?"":"none",yr===!0){mr.onBeforeRender(tr,fr,_r);let xr;mr.isCSS3DSprite?(_matrix$3.copy(_r.matrixWorldInverse),_matrix$3.transpose(),mr.rotation2D!==0&&_matrix$3.multiply(_matrix2.makeRotationZ(mr.rotation2D)),mr.matrixWorld.decompose(_position$1,_quaternion,_scale),_matrix$3.setPosition(_position$1),_matrix$3.scale(_scale),_matrix$3.elements[3]=0,_matrix$3.elements[7]=0,_matrix$3.elements[11]=0,_matrix$3.elements[15]=1,xr=pr(_matrix$3)):xr=pr(mr.matrixWorld);const Sr=or.objects.get(mr);if(Sr===void 0||Sr.style!==xr){wr.style.transform=xr;const br={style:xr};or.objects.set(mr,br)}wr.parentNode!==ur&&ur.appendChild(wr),mr.onAfterRender(tr,fr,_r)}}for(let yr=0,wr=mr.children.length;yr<wr;yr++)vr(mr.children[yr],fr,_r,Ar)}}}class RenderableObject{constructor(){this.id=0,this.object=null,this.z=0,this.renderOrder=0}}class RenderableFace{constructor(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.v3=new RenderableVertex,this.normalModel=new Vector3$1,this.vertexNormalsModel=[new Vector3$1,new Vector3$1,new Vector3$1],this.vertexNormalsLength=0,this.color=new Color,this.material=null,this.uvs=[new Vector2,new Vector2,new Vector2],this.z=0,this.renderOrder=0}}class RenderableVertex{constructor(){this.position=new Vector3$1,this.positionWorld=new Vector3$1,this.positionScreen=new Vector4,this.visible=!0}copy(er){this.positionWorld.copy(er.positionWorld),this.positionScreen.copy(er.positionScreen)}}class RenderableLine{constructor(){this.id=0,this.v1=new RenderableVertex,this.v2=new RenderableVertex,this.vertexColors=[new Color,new Color],this.material=null,this.z=0,this.renderOrder=0}}class RenderableSprite{constructor(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new Vector2,this.material=null,this.renderOrder=0}}class Projector{constructor(){let er,tr,ir=0,nr,sr,ar=0,or,lr,cr=0,ur,dr,hr=0,pr,gr,vr=0,mr;const fr={objects:[],lights:[],elements:[]},_r=new Vector3$1,Ar=new Vector4,yr=new Box3(new Vector3$1(-1,-1,-1),new Vector3$1(1,1,1)),wr=new Box3,xr=new Array(3),Sr=new Matrix4,br=new Matrix4,Cr=new Matrix4,Ir=new Frustum,Rr=[],Pr=[],Dr=[],Fr=[],Or=[];function Nr(){const qr=[],ji=[],Jr=[];let Ji=null;const Ki=new Matrix3;function Zi(Ni){Ji=Ni,Ki.getNormalMatrix(Ji.matrixWorld),qr.length=0,ji.length=0,Jr.length=0}function Zr(Ni){const Ri=Ni.position,qi=Ni.positionWorld,as=Ni.positionScreen;qi.copy(Ri).applyMatrix4(mr),as.copy(qi).applyMatrix4(br);const us=1/as.w;as.x*=us,as.y*=us,as.z*=us,Ni.visible=as.x>=-1&&as.x<=1&&as.y>=-1&&as.y<=1&&as.z>=-1&&as.z<=1}function is(Ni,Ri,qi){nr=Qi(),nr.position.set(Ni,Ri,qi),Zr(nr)}function os(Ni,Ri,qi){qr.push(Ni,Ri,qi)}function cs(Ni,Ri,qi){ji.push(Ni,Ri,qi)}function ss(Ni,Ri){Jr.push(Ni,Ri)}function es(Ni,Ri,qi){return Ni.visible===!0||Ri.visible===!0||qi.visible===!0?!0:(xr[0]=Ni.positionScreen,xr[1]=Ri.positionScreen,xr[2]=qi.positionScreen,yr.intersectsBox(wr.setFromPoints(xr)))}function ms(Ni,Ri,qi){return(qi.positionScreen.x-Ni.positionScreen.x)*(Ri.positionScreen.y-Ni.positionScreen.y)-(qi.positionScreen.y-Ni.positionScreen.y)*(Ri.positionScreen.x-Ni.positionScreen.x)<0}function Yi(Ni,Ri){const qi=Pr[Ni],as=Pr[Ri];qi.positionScreen.copy(qi.position).applyMatrix4(Cr),as.positionScreen.copy(as.position).applyMatrix4(Cr),Gr(qi.positionScreen,as.positionScreen)===!0&&(qi.positionScreen.multiplyScalar(1/qi.positionScreen.w),as.positionScreen.multiplyScalar(1/as.positionScreen.w),ur=Kr(),ur.id=Ji.id,ur.v1.copy(qi),ur.v2.copy(as),ur.z=Math.max(qi.positionScreen.z,as.positionScreen.z),ur.renderOrder=Ji.renderOrder,ur.material=Ji.material,Ji.material.vertexColors&&(ur.vertexColors[0].fromArray(ji,Ni*3),ur.vertexColors[1].fromArray(ji,Ri*3)),fr.elements.push(ur))}function Gi(Ni,Ri,qi,as){const us=Pr[Ni],gs=Pr[Ri],vs=Pr[qi];if(es(us,gs,vs)!==!1&&(as.side===DoubleSide||ms(us,gs,vs)===!0)){or=Xi(),or.id=Ji.id,or.v1.copy(us),or.v2.copy(gs),or.v3.copy(vs),or.z=(us.positionScreen.z+gs.positionScreen.z+vs.positionScreen.z)/3,or.renderOrder=Ji.renderOrder,_r.subVectors(vs.position,gs.position),Ar.subVectors(us.position,gs.position),_r.cross(Ar),or.normalModel.copy(_r),or.normalModel.applyMatrix3(Ki).normalize();for(let _s=0;_s<3;_s++){const As=or.vertexNormalsModel[_s];As.fromArray(qr,arguments[_s]*3),As.applyMatrix3(Ki).normalize(),or.uvs[_s].fromArray(Jr,arguments[_s]*2)}or.vertexNormalsLength=3,or.material=as,as.vertexColors&&or.color.fromArray(ji,Ni*3),fr.elements.push(or)}}return{setObject:Zi,projectVertex:Zr,checkTriangleVisibility:es,checkBackfaceCulling:ms,pushVertex:is,pushNormal:os,pushColor:cs,pushUv:ss,pushLine:Yi,pushTriangle:Gi}}const Ur=new Nr;function Br(qr){if(qr.visible===!1)return;if(qr.isLight)fr.lights.push(qr);else if(qr.isMesh||qr.isLine||qr.isPoints){if(qr.material.visible===!1||qr.frustumCulled===!0&&Ir.intersectsObject(qr)===!1)return;Wr(qr)}else if(qr.isSprite){if(qr.material.visible===!1||qr.frustumCulled===!0&&Ir.intersectsSprite(qr)===!1)return;Wr(qr)}const ji=qr.children;for(let Jr=0,Ji=ji.length;Jr<Ji;Jr++)Br(ji[Jr])}function Wr(qr){er=Yr(),er.id=qr.id,er.object=qr,_r.setFromMatrixPosition(qr.matrixWorld),_r.applyMatrix4(br),er.z=_r.z,er.renderOrder=qr.renderOrder,fr.objects.push(er)}this.projectScene=function(qr,ji,Jr,Ji){lr=0,dr=0,gr=0,fr.elements.length=0,qr.matrixWorldAutoUpdate===!0&&qr.updateMatrixWorld(),ji.parent===null&&ji.matrixWorldAutoUpdate===!0&&ji.updateMatrixWorld(),Sr.copy(ji.matrixWorldInverse),br.multiplyMatrices(ji.projectionMatrix,Sr),Ir.setFromProjectionMatrix(br),tr=0,fr.objects.length=0,fr.lights.length=0,Br(qr),Jr===!0&&fr.objects.sort(Vr);const Ki=fr.objects;for(let Zi=0,Zr=Ki.length;Zi<Zr;Zi++){const is=Ki[Zi].object,os=is.geometry;if(Ur.setObject(is),mr=is.matrixWorld,sr=0,is.isMesh){let cs=is.material;const ss=Array.isArray(cs),es=os.attributes,ms=os.groups;if(es.position===void 0)continue;const Yi=es.position.array;for(let Gi=0,Ni=Yi.length;Gi<Ni;Gi+=3){let Ri=Yi[Gi],qi=Yi[Gi+1],as=Yi[Gi+2];const us=os.morphAttributes.position;if(us!==void 0){const gs=os.morphTargetsRelative,vs=is.morphTargetInfluences;for(let _s=0,As=us.length;_s<As;_s++){const xs=vs[_s];if(xs===0)continue;const Es=us[_s];gs?(Ri+=Es.getX(Gi/3)*xs,qi+=Es.getY(Gi/3)*xs,as+=Es.getZ(Gi/3)*xs):(Ri+=(Es.getX(Gi/3)-Yi[Gi])*xs,qi+=(Es.getY(Gi/3)-Yi[Gi+1])*xs,as+=(Es.getZ(Gi/3)-Yi[Gi+2])*xs)}}Ur.pushVertex(Ri,qi,as)}if(es.normal!==void 0){const Gi=es.normal.array;for(let Ni=0,Ri=Gi.length;Ni<Ri;Ni+=3)Ur.pushNormal(Gi[Ni],Gi[Ni+1],Gi[Ni+2])}if(es.color!==void 0){const Gi=es.color.array;for(let Ni=0,Ri=Gi.length;Ni<Ri;Ni+=3)Ur.pushColor(Gi[Ni],Gi[Ni+1],Gi[Ni+2])}if(es.uv!==void 0){const Gi=es.uv.array;for(let Ni=0,Ri=Gi.length;Ni<Ri;Ni+=2)Ur.pushUv(Gi[Ni],Gi[Ni+1])}if(os.index!==null){const Gi=os.index.array;if(ms.length>0)for(let Ni=0;Ni<ms.length;Ni++){const Ri=ms[Ni];if(cs=ss===!0?is.material[Ri.materialIndex]:is.material,cs!==void 0)for(let qi=Ri.start,as=Ri.start+Ri.count;qi<as;qi+=3)Ur.pushTriangle(Gi[qi],Gi[qi+1],Gi[qi+2],cs)}else for(let Ni=0,Ri=Gi.length;Ni<Ri;Ni+=3)Ur.pushTriangle(Gi[Ni],Gi[Ni+1],Gi[Ni+2],cs)}else if(ms.length>0)for(let Gi=0;Gi<ms.length;Gi++){const Ni=ms[Gi];if(cs=ss===!0?is.material[Ni.materialIndex]:is.material,cs!==void 0)for(let Ri=Ni.start,qi=Ni.start+Ni.count;Ri<qi;Ri+=3)Ur.pushTriangle(Ri,Ri+1,Ri+2,cs)}else for(let Gi=0,Ni=Yi.length/3;Gi<Ni;Gi+=3)Ur.pushTriangle(Gi,Gi+1,Gi+2,cs)}else if(is.isLine){Cr.multiplyMatrices(br,mr);const cs=os.attributes;if(cs.position!==void 0){const ss=cs.position.array;for(let es=0,ms=ss.length;es<ms;es+=3)Ur.pushVertex(ss[es],ss[es+1],ss[es+2]);if(cs.color!==void 0){const es=cs.color.array;for(let ms=0,Yi=es.length;ms<Yi;ms+=3)Ur.pushColor(es[ms],es[ms+1],es[ms+2])}if(os.index!==null){const es=os.index.array;for(let ms=0,Yi=es.length;ms<Yi;ms+=2)Ur.pushLine(es[ms],es[ms+1])}else{const es=is.isLineSegments?2:1;for(let ms=0,Yi=ss.length/3-1;ms<Yi;ms+=es)Ur.pushLine(ms,ms+1)}}}else if(is.isPoints){Cr.multiplyMatrices(br,mr);const cs=os.attributes;if(cs.position!==void 0){const ss=cs.position.array;for(let es=0,ms=ss.length;es<ms;es+=3)Ar.set(ss[es],ss[es+1],ss[es+2],1),Ar.applyMatrix4(Cr),Xr(Ar,is,ji)}}else is.isSprite&&(is.modelViewMatrix.multiplyMatrices(ji.matrixWorldInverse,is.matrixWorld),Ar.set(mr.elements[12],mr.elements[13],mr.elements[14],1),Ar.applyMatrix4(br),Xr(Ar,is,ji))}return Ji===!0&&fr.elements.sort(Vr),fr};function Xr(qr,ji,Jr){const Ji=1/qr.w;qr.z*=Ji,qr.z>=-1&&qr.z<=1&&(pr=$r(),pr.id=ji.id,pr.x=qr.x*Ji,pr.y=qr.y*Ji,pr.z=qr.z,pr.renderOrder=ji.renderOrder,pr.object=ji,pr.rotation=ji.rotation,pr.scale.x=ji.scale.x*Math.abs(pr.x-(qr.x+Jr.projectionMatrix.elements[0])/(qr.w+Jr.projectionMatrix.elements[12])),pr.scale.y=ji.scale.y*Math.abs(pr.y-(qr.y+Jr.projectionMatrix.elements[5])/(qr.w+Jr.projectionMatrix.elements[13])),pr.material=ji.material,fr.elements.push(pr))}function Yr(){if(tr===ir){const qr=new RenderableObject;return Rr.push(qr),ir++,tr++,qr}return Rr[tr++]}function Qi(){if(sr===ar){const qr=new RenderableVertex;return Pr.push(qr),ar++,sr++,qr}return Pr[sr++]}function Xi(){if(lr===cr){const qr=new RenderableFace;return Dr.push(qr),cr++,lr++,qr}return Dr[lr++]}function Kr(){if(dr===hr){const qr=new RenderableLine;return Fr.push(qr),hr++,dr++,qr}return Fr[dr++]}function $r(){if(gr===vr){const qr=new RenderableSprite;return Or.push(qr),vr++,gr++,qr}return Or[gr++]}function Vr(qr,ji){return qr.renderOrder!==ji.renderOrder?qr.renderOrder-ji.renderOrder:qr.z!==ji.z?ji.z-qr.z:qr.id!==ji.id?qr.id-ji.id:0}function Gr(qr,ji){let Jr=0,Ji=1;const Ki=qr.z+qr.w,Zi=ji.z+ji.w,Zr=-qr.z+qr.w,is=-ji.z+ji.w;return Ki>=0&&Zi>=0&&Zr>=0&&is>=0?!0:Ki<0&&Zi<0||Zr<0&&is<0?!1:(Ki<0?Jr=Math.max(Jr,Ki/(Ki-Zi)):Zi<0&&(Ji=Math.min(Ji,Ki/(Ki-Zi))),Zr<0?Jr=Math.max(Jr,Zr/(Zr-is)):is<0&&(Ji=Math.min(Ji,Zr/(Zr-is))),Ji<Jr?!1:(qr.lerp(ji,Jr),ji.lerp(qr,1-Ji),!0))}}}class SVGObject extends Object3D{constructor(er){super(),this.isSVGObject=!0,this.node=er}}class SVGRenderer{constructor(){let er,tr,ir,nr,sr,ar,or,lr,cr,ur,dr,hr=0,pr=null,gr=1,vr,mr;const fr=this,_r=new Box2,Ar=new Box2,yr=new Color,wr=new Color,xr=new Color,Sr=new Color,br=new Color,Cr=new Color,Ir=new Vector3$1,Rr=new Vector3$1,Pr=new Vector3$1,Dr=new Matrix3,Fr=new Matrix4,Or=new Matrix4,Nr=[],Ur=new Projector,Br=document.createElementNS("http://www.w3.org/2000/svg","svg");this.domElement=Br,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.overdraw=.5,this.outputColorSpace=SRGBColorSpace,this.info={render:{vertices:0,faces:0}},this.setQuality=function(Jr){switch(Jr){case"high":gr=1;break;case"low":gr=0;break}},this.setClearColor=function(Jr){Cr.set(Jr)},this.setPixelRatio=function(){},this.setSize=function(Jr,Ji){nr=Jr,sr=Ji,ar=nr/2,or=sr/2,Br.setAttribute("viewBox",-ar+" "+-or+" "+nr+" "+sr),Br.setAttribute("width",nr),Br.setAttribute("height",sr),_r.min.set(-ar,-or),_r.max.set(ar,or)},this.getSize=function(){return{width:nr,height:sr}},this.setPrecision=function(Jr){pr=Jr};function Wr(){for(hr=0;Br.childNodes.length>0;)Br.removeChild(Br.childNodes[0])}function Xr(Jr){return pr!==null?Jr.toFixed(pr):Jr}this.clear=function(){Wr(),Br.style.backgroundColor=Cr.getStyle(fr.outputColorSpace)},this.render=function(Jr,Ji){if(!(Ji instanceof Camera)){console.error("THREE.SVGRenderer.render: camera is not an instance of Camera.");return}const Ki=Jr.background;Ki&&Ki.isColor?(Wr(),Br.style.backgroundColor=Ki.getStyle(fr.outputColorSpace)):this.autoClear===!0&&this.clear(),fr.info.render.vertices=0,fr.info.render.faces=0,Fr.copy(Ji.matrixWorldInverse),Or.multiplyMatrices(Ji.projectionMatrix,Fr),er=Ur.projectScene(Jr,Ji,this.sortObjects,this.sortElements),tr=er.elements,ir=er.lights,Dr.getNormalMatrix(Ji.matrixWorldInverse),Yr(ir),vr="",mr="";for(let Zi=0,Zr=tr.length;Zi<Zr;Zi++){const is=tr[Zi],os=is.material;if(!(os===void 0||os.opacity===0)){if(Ar.makeEmpty(),is instanceof RenderableSprite)lr=is,lr.x*=ar,lr.y*=-or,Xi(lr,is,os);else if(is instanceof RenderableLine)lr=is.v1,cr=is.v2,lr.positionScreen.x*=ar,lr.positionScreen.y*=-or,cr.positionScreen.x*=ar,cr.positionScreen.y*=-or,Ar.setFromPoints([lr.positionScreen,cr.positionScreen]),_r.intersectsBox(Ar)===!0&&Kr(lr,cr,os);else if(is instanceof RenderableFace){if(lr=is.v1,cr=is.v2,ur=is.v3,lr.positionScreen.z<-1||lr.positionScreen.z>1||cr.positionScreen.z<-1||cr.positionScreen.z>1||ur.positionScreen.z<-1||ur.positionScreen.z>1)continue;lr.positionScreen.x*=ar,lr.positionScreen.y*=-or,cr.positionScreen.x*=ar,cr.positionScreen.y*=-or,ur.positionScreen.x*=ar,ur.positionScreen.y*=-or,this.overdraw>0&&(Vr(lr.positionScreen,cr.positionScreen,this.overdraw),Vr(cr.positionScreen,ur.positionScreen,this.overdraw),Vr(ur.positionScreen,lr.positionScreen,this.overdraw)),Ar.setFromPoints([lr.positionScreen,cr.positionScreen,ur.positionScreen]),_r.intersectsBox(Ar)===!0&&$r(lr,cr,ur,is,os)}}}qr(),Jr.traverseVisible(function(Zi){if(Zi.isSVGObject){if(Ir.setFromMatrixPosition(Zi.matrixWorld),Ir.applyMatrix4(Or),Ir.z<-1||Ir.z>1)return;const Zr=Ir.x*ar,is=-Ir.y*or,os=Zi.node;os.setAttribute("transform","translate("+Zr+","+is+")"),Br.appendChild(os)}})};function Yr(Jr){xr.setRGB(0,0,0),Sr.setRGB(0,0,0),br.setRGB(0,0,0);for(let Ji=0,Ki=Jr.length;Ji<Ki;Ji++){const Zi=Jr[Ji],Zr=Zi.color;Zi.isAmbientLight?(xr.r+=Zr.r,xr.g+=Zr.g,xr.b+=Zr.b):Zi.isDirectionalLight?(Sr.r+=Zr.r,Sr.g+=Zr.g,Sr.b+=Zr.b):Zi.isPointLight&&(br.r+=Zr.r,br.g+=Zr.g,br.b+=Zr.b)}}function Qi(Jr,Ji,Ki,Zi){for(let Zr=0,is=Jr.length;Zr<is;Zr++){const os=Jr[Zr],cs=os.color;if(os.isDirectionalLight){const ss=Ir.setFromMatrixPosition(os.matrixWorld).normalize();let es=Ki.dot(ss);if(es<=0)continue;es*=os.intensity,Zi.r+=cs.r*es,Zi.g+=cs.g*es,Zi.b+=cs.b*es}else if(os.isPointLight){const ss=Ir.setFromMatrixPosition(os.matrixWorld);let es=Ki.dot(Ir.subVectors(ss,Ji).normalize());if(es<=0||(es*=os.distance==0?1:1-Math.min(Ji.distanceTo(ss)/os.distance,1),es==0))continue;es*=os.intensity,Zi.r+=cs.r*es,Zi.g+=cs.g*es,Zi.b+=cs.b*es}}}function Xi(Jr,Ji,Ki){let Zi=Ji.scale.x*ar,Zr=Ji.scale.y*or;Ki.isPointsMaterial&&(Zi*=Ki.size,Zr*=Ki.size);const is="M"+Xr(Jr.x-Zi*.5)+","+Xr(Jr.y-Zr*.5)+"h"+Xr(Zi)+"v"+Xr(Zr)+"h"+Xr(-Zi)+"z";let os="";(Ki.isSpriteMaterial||Ki.isPointsMaterial)&&(os="fill:"+Ki.color.getStyle(fr.outputColorSpace)+";fill-opacity:"+Ki.opacity),Gr(os,is)}function Kr(Jr,Ji,Ki){const Zi="M"+Xr(Jr.positionScreen.x)+","+Xr(Jr.positionScreen.y)+"L"+Xr(Ji.positionScreen.x)+","+Xr(Ji.positionScreen.y);if(Ki.isLineBasicMaterial){let Zr="fill:none;stroke:"+Ki.color.getStyle(fr.outputColorSpace)+";stroke-opacity:"+Ki.opacity+";stroke-width:"+Ki.linewidth+";stroke-linecap:"+Ki.linecap;Ki.isLineDashedMaterial&&(Zr=Zr+";stroke-dasharray:"+Ki.dashSize+","+Ki.gapSize),Gr(Zr,Zi)}}function $r(Jr,Ji,Ki,Zi,Zr){fr.info.render.vertices+=3,fr.info.render.faces++;const is="M"+Xr(Jr.positionScreen.x)+","+Xr(Jr.positionScreen.y)+"L"+Xr(Ji.positionScreen.x)+","+Xr(Ji.positionScreen.y)+"L"+Xr(Ki.positionScreen.x)+","+Xr(Ki.positionScreen.y)+"z";let os="";Zr.isMeshBasicMaterial?(yr.copy(Zr.color),Zr.vertexColors&&yr.multiply(Zi.color)):Zr.isMeshLambertMaterial||Zr.isMeshPhongMaterial||Zr.isMeshStandardMaterial?(wr.copy(Zr.color),Zr.vertexColors&&wr.multiply(Zi.color),yr.copy(xr),Rr.copy(Jr.positionWorld).add(Ji.positionWorld).add(Ki.positionWorld).divideScalar(3),Qi(ir,Rr,Zi.normalModel,yr),yr.multiply(wr).add(Zr.emissive)):Zr.isMeshNormalMaterial&&(Pr.copy(Zi.normalModel).applyMatrix3(Dr).normalize(),yr.setRGB(Pr.x,Pr.y,Pr.z).multiplyScalar(.5).addScalar(.5)),Zr.wireframe?os="fill:none;stroke:"+yr.getStyle(fr.outputColorSpace)+";stroke-opacity:"+Zr.opacity+";stroke-width:"+Zr.wireframeLinewidth+";stroke-linecap:"+Zr.wireframeLinecap+";stroke-linejoin:"+Zr.wireframeLinejoin:os="fill:"+yr.getStyle(fr.outputColorSpace)+";fill-opacity:"+Zr.opacity,Gr(os,is)}function Vr(Jr,Ji,Ki){let Zi=Ji.x-Jr.x,Zr=Ji.y-Jr.y;const is=Zi*Zi+Zr*Zr;if(is===0)return;const os=Ki/Math.sqrt(is);Zi*=os,Zr*=os,Ji.x+=Zi,Ji.y+=Zr,Jr.x-=Zi,Jr.y-=Zr}function Gr(Jr,Ji){mr===Jr?vr+=Ji:(qr(),mr=Jr,vr=Ji)}function qr(){vr&&(dr=ji(hr++),dr.setAttribute("d",vr),dr.setAttribute("style",mr),Br.appendChild(dr)),vr="",mr=""}function ji(Jr){return Nr[Jr]==null&&(Nr[Jr]=document.createElementNS("http://www.w3.org/2000/svg","path"),gr==0&&Nr[Jr].setAttribute("shape-rendering","crispEdges")),Nr[Jr]}}}const ACESFilmicToneMappingShader={name:"ACESFilmicToneMappingShader",uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#define saturate(a) clamp( a, 0.0, 1.0 )

		uniform sampler2D tDiffuse;

		uniform float exposure;

		varying vec2 vUv;

		vec3 RRTAndODTFit( vec3 v ) {

			vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
			vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
			return a / b;

		}

		vec3 ACESFilmicToneMapping( vec3 color ) {

		// sRGB => XYZ => D65_2_D60 => AP1 => RRT_SAT
			const mat3 ACESInputMat = mat3(
				vec3( 0.59719, 0.07600, 0.02840 ), // transposed from source
				vec3( 0.35458, 0.90834, 0.13383 ),
				vec3( 0.04823, 0.01566, 0.83777 )
			);

		// ODT_SAT => XYZ => D60_2_D65 => sRGB
			const mat3 ACESOutputMat = mat3(
				vec3(  1.60475, -0.10208, -0.00327 ), // transposed from source
				vec3( -0.53108,  1.10813, -0.07276 ),
				vec3( -0.07367, -0.00605,  1.07602 )
			);

			color = ACESInputMat * color;

		// Apply RRT and ODT
			color = RRTAndODTFit( color );

			color = ACESOutputMat * color;

		// Clamp to [0, 1]
			return saturate( color );

		}

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			tex.rgb *= exposure / 0.6; // pre-exposed, outside of the tone mapping function

			gl_FragColor = vec4( ACESFilmicToneMapping( tex.rgb ), tex.a );

		}`},BasicShader={name:"BasicShader",uniforms:{},vertexShader:`

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		void main() {

			gl_FragColor = vec4( 1.0, 0.0, 0.0, 0.5 );

		}`},BleachBypassShader={name:"BleachBypassShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 base = texture2D( tDiffuse, vUv );

			float lum = luminance( base.rgb );
			vec3 blend = vec3( lum );

			float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );

			vec3 result1 = 2.0 * base.rgb * blend;
			vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );

			vec3 newColor = mix( result1, result2, L );

			float A2 = opacity * base.a;
			vec3 mixRGB = A2 * newColor.rgb;
			mixRGB += ( ( 1.0 - A2 ) * base.rgb );

			gl_FragColor = vec4( mixRGB, base.a );

		}`},BlendShader={name:"BlendShader",uniforms:{tDiffuse1:{value:null},tDiffuse2:{value:null},mixRatio:{value:.5},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;
		uniform float mixRatio;

		uniform sampler2D tDiffuse1;
		uniform sampler2D tDiffuse2;

		varying vec2 vUv;

		void main() {

			vec4 texel1 = texture2D( tDiffuse1, vUv );
			vec4 texel2 = texture2D( tDiffuse2, vUv );
			gl_FragColor = opacity * mix( texel1, texel2, mixRatio );

		}`},BokehShader={name:"BokehShader",uniforms:{textureWidth:{value:1},textureHeight:{value:1},focalDepth:{value:1},focalLength:{value:24},fstop:{value:.9},tColor:{value:null},tDepth:{value:null},maxblur:{value:1},showFocus:{value:0},manualdof:{value:0},vignetting:{value:0},depthblur:{value:0},threshold:{value:.5},gain:{value:2},bias:{value:.5},fringe:{value:.7},znear:{value:.1},zfar:{value:100},noise:{value:1},dithering:{value:1e-4},pentagon:{value:0},shaderFocus:{value:1},focusCoords:{value:new Vector2}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		varying vec2 vUv;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;
		uniform float textureWidth;
		uniform float textureHeight;

		uniform float focalDepth;  //focal distance value in meters, but you may use autofocus option below
		uniform float focalLength; //focal length in mm
		uniform float fstop; //f-stop value
		uniform bool showFocus; //show debug focus point and focal range (red = focal point, green = focal range)

		/*
		make sure that these two values are the same for your camera, otherwise distances will be wrong.
		*/

		uniform float znear; // camera clipping start
		uniform float zfar; // camera clipping end

		//------------------------------------------
		//user variables

		const int samples = SAMPLES; //samples on the first ring
		const int rings = RINGS; //ring count

		const int maxringsamples = rings * samples;

		uniform bool manualdof; // manual dof calculation
		float ndofstart = 1.0; // near dof blur start
		float ndofdist = 2.0; // near dof blur falloff distance
		float fdofstart = 1.0; // far dof blur start
		float fdofdist = 3.0; // far dof blur falloff distance

		float CoC = 0.03; //circle of confusion size in mm (35mm film = 0.03mm)

		uniform bool vignetting; // use optical lens vignetting

		float vignout = 1.3; // vignetting outer border
		float vignin = 0.0; // vignetting inner border
		float vignfade = 22.0; // f-stops till vignete fades

		uniform bool shaderFocus;
		// disable if you use external focalDepth value

		uniform vec2 focusCoords;
		// autofocus point on screen (0.0,0.0 - left lower corner, 1.0,1.0 - upper right)
		// if center of screen use vec2(0.5, 0.5);

		uniform float maxblur;
		//clamp value of max blur (0.0 = no blur, 1.0 default)

		uniform float threshold; // highlight threshold;
		uniform float gain; // highlight gain;

		uniform float bias; // bokeh edge bias
		uniform float fringe; // bokeh chromatic aberration / fringing

		uniform bool noise; //use noise instead of pattern for sample dithering

		uniform float dithering;

		uniform bool depthblur; // blur the depth buffer
		float dbsize = 1.25; // depth blur size

		/*
		next part is experimental
		not looking good with small sample and ring count
		looks okay starting from samples = 4, rings = 4
		*/

		uniform bool pentagon; //use pentagon as bokeh shape?
		float feather = 0.4; //pentagon shape feather

		//------------------------------------------

		float penta(vec2 coords) {
			//pentagonal shape
			float scale = float(rings) - 1.3;
			vec4  HS0 = vec4( 1.0,         0.0,         0.0,  1.0);
			vec4  HS1 = vec4( 0.309016994, 0.951056516, 0.0,  1.0);
			vec4  HS2 = vec4(-0.809016994, 0.587785252, 0.0,  1.0);
			vec4  HS3 = vec4(-0.809016994,-0.587785252, 0.0,  1.0);
			vec4  HS4 = vec4( 0.309016994,-0.951056516, 0.0,  1.0);
			vec4  HS5 = vec4( 0.0        ,0.0         , 1.0,  1.0);

			vec4  one = vec4( 1.0 );

			vec4 P = vec4((coords),vec2(scale, scale));

			vec4 dist = vec4(0.0);
			float inorout = -4.0;

			dist.x = dot( P, HS0 );
			dist.y = dot( P, HS1 );
			dist.z = dot( P, HS2 );
			dist.w = dot( P, HS3 );

			dist = smoothstep( -feather, feather, dist );

			inorout += dot( dist, one );

			dist.x = dot( P, HS4 );
			dist.y = HS5.w - abs( P.z );

			dist = smoothstep( -feather, feather, dist );
			inorout += dist.x;

			return clamp( inorout, 0.0, 1.0 );
		}

		float bdepth(vec2 coords) {
			// Depth buffer blur
			float d = 0.0;
			float kernel[9];
			vec2 offset[9];

			vec2 wh = vec2(1.0/textureWidth,1.0/textureHeight) * dbsize;

			offset[0] = vec2(-wh.x,-wh.y);
			offset[1] = vec2( 0.0, -wh.y);
			offset[2] = vec2( wh.x -wh.y);

			offset[3] = vec2(-wh.x,  0.0);
			offset[4] = vec2( 0.0,   0.0);
			offset[5] = vec2( wh.x,  0.0);

			offset[6] = vec2(-wh.x, wh.y);
			offset[7] = vec2( 0.0,  wh.y);
			offset[8] = vec2( wh.x, wh.y);

			kernel[0] = 1.0/16.0;   kernel[1] = 2.0/16.0;   kernel[2] = 1.0/16.0;
			kernel[3] = 2.0/16.0;   kernel[4] = 4.0/16.0;   kernel[5] = 2.0/16.0;
			kernel[6] = 1.0/16.0;   kernel[7] = 2.0/16.0;   kernel[8] = 1.0/16.0;


			for( int i=0; i<9; i++ ) {
				float tmp = texture2D(tDepth, coords + offset[i]).r;
				d += tmp * kernel[i];
			}

			return d;
		}


		vec3 color(vec2 coords,float blur) {
			//processing the sample

			vec3 col = vec3(0.0);
			vec2 texel = vec2(1.0/textureWidth,1.0/textureHeight);

			col.r = texture2D(tColor,coords + vec2(0.0,1.0)*texel*fringe*blur).r;
			col.g = texture2D(tColor,coords + vec2(-0.866,-0.5)*texel*fringe*blur).g;
			col.b = texture2D(tColor,coords + vec2(0.866,-0.5)*texel*fringe*blur).b;

			vec3 lumcoeff = vec3(0.299,0.587,0.114);
			float lum = dot(col.rgb, lumcoeff);
			float thresh = max((lum-threshold)*gain, 0.0);
			return col+mix(vec3(0.0),col,thresh*blur);
		}

		vec3 debugFocus(vec3 col, float blur, float depth) {
			float edge = 0.002*depth; //distance based edge smoothing
			float m = clamp(smoothstep(0.0,edge,blur),0.0,1.0);
			float e = clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);

			col = mix(col,vec3(1.0,0.5,0.0),(1.0-m)*0.6);
			col = mix(col,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);

			return col;
		}

		float linearize(float depth) {
			return -zfar * znear / (depth * (zfar - znear) - zfar);
		}

		float vignette() {
			float dist = distance(vUv.xy, vec2(0.5,0.5));
			dist = smoothstep(vignout+(fstop/vignfade), vignin+(fstop/vignfade), dist);
			return clamp(dist,0.0,1.0);
		}

		float gather(float i, float j, int ringsamples, inout vec3 col, float w, float h, float blur) {
			float rings2 = float(rings);
			float step = PI*2.0 / float(ringsamples);
			float pw = cos(j*step)*i;
			float ph = sin(j*step)*i;
			float p = 1.0;
			if (pentagon) {
				p = penta(vec2(pw,ph));
			}
			col += color(vUv.xy + vec2(pw*w,ph*h), blur) * mix(1.0, i/rings2, bias) * p;
			return 1.0 * mix(1.0, i /rings2, bias) * p;
		}

		void main() {
			//scene depth calculation

			float depth = linearize(texture2D(tDepth,vUv.xy).x);

			// Blur depth?
			if ( depthblur ) {
				depth = linearize(bdepth(vUv.xy));
			}

			//focal plane calculation

			float fDepth = focalDepth;

			if (shaderFocus) {

				fDepth = linearize(texture2D(tDepth,focusCoords).x);

			}

			// dof blur factor calculation

			float blur = 0.0;

			if (manualdof) {
				float a = depth-fDepth; // Focal plane
				float b = (a-fdofstart)/fdofdist; // Far DoF
				float c = (-a-ndofstart)/ndofdist; // Near Dof
				blur = (a>0.0) ? b : c;
			} else {
				float f = focalLength; // focal length in mm
				float d = fDepth*1000.0; // focal plane in mm
				float o = depth*1000.0; // depth in mm

				float a = (o*f)/(o-f);
				float b = (d*f)/(d-f);
				float c = (d-f)/(d*fstop*CoC);

				blur = abs(a-b)*c;
			}

			blur = clamp(blur,0.0,1.0);

			// calculation of pattern for dithering

			vec2 noise = vec2(rand(vUv.xy), rand( vUv.xy + vec2( 0.4, 0.6 ) ) )*dithering*blur;

			// getting blur x and y step factor

			float w = (1.0/textureWidth)*blur*maxblur+noise.x;
			float h = (1.0/textureHeight)*blur*maxblur+noise.y;

			// calculation of final color

			vec3 col = vec3(0.0);

			if(blur < 0.05) {
				//some optimization thingy
				col = texture2D(tColor, vUv.xy).rgb;
			} else {
				col = texture2D(tColor, vUv.xy).rgb;
				float s = 1.0;
				int ringsamples;

				for (int i = 1; i <= rings; i++) {
					/*unboxstart*/
					ringsamples = i * samples;

					for (int j = 0 ; j < maxringsamples ; j++) {
						if (j >= ringsamples) break;
						s += gather(float(i), float(j), ringsamples, col, w, h, blur);
					}
					/*unboxend*/
				}

				col /= s; //divide by sample count
			}

			if (showFocus) {
				col = debugFocus(col, blur, depth);
			}

			if (vignetting) {
				col *= vignette();
			}

			gl_FragColor.rgb = col;
			gl_FragColor.a = 1.0;

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
		}`},BokehDepthShader={name:"BokehDepthShader",uniforms:{mNear:{value:1},mFar:{value:1e3}},vertexShader:`

		varying float vViewZDepth;

		void main() {

			#include <begin_vertex>
			#include <project_vertex>

			vViewZDepth = - mvPosition.z;

		}`,fragmentShader:`

		uniform float mNear;
		uniform float mFar;

		varying float vViewZDepth;

		void main() {

			float color = 1.0 - smoothstep( mNear, mFar, vViewZDepth );
			gl_FragColor = vec4( vec3( color ), 1.0 );

		}`},BrightnessContrastShader={name:"BrightnessContrastShader",uniforms:{tDiffuse:{value:null},brightness:{value:0},contrast:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float brightness;
		uniform float contrast;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			gl_FragColor.rgb += brightness;

			if (contrast > 0.0) {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - contrast) + 0.5;
			} else {
				gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + contrast) + 0.5;
			}

		}`},ColorCorrectionShader={name:"ColorCorrectionShader",uniforms:{tDiffuse:{value:null},powRGB:{value:new Vector3$1(2,2,2)},mulRGB:{value:new Vector3$1(1,1,1)},addRGB:{value:new Vector3$1(0,0,0)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec3 powRGB;
		uniform vec3 mulRGB;
		uniform vec3 addRGB;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.rgb = mulRGB * pow( ( gl_FragColor.rgb + addRGB ), powRGB );

		}`},ColorifyShader={name:"ColorifyShader",uniforms:{tDiffuse:{value:null},color:{value:new Color(16777215)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float v = luminance( texel.xyz );

			gl_FragColor = vec4( v * color, texel.w );

		}`},DOFMipMapShader={name:"DOFMipMapShader",uniforms:{tColor:{value:null},tDepth:{value:null},focus:{value:1},maxblur:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float focus;
		uniform float maxblur;

		uniform sampler2D tColor;
		uniform sampler2D tDepth;

		varying vec2 vUv;

		void main() {

			vec4 depth = texture2D( tDepth, vUv );

			float factor = depth.x - focus;

			vec4 col = texture2D( tColor, vUv, 2.0 * maxblur * abs( focus - depth.x ) );

			gl_FragColor = col;
			gl_FragColor.a = 1.0;

		}`},ExposureShader={name:"ExposureShader",uniforms:{tDiffuse:{value:null},exposure:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float exposure;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.rgb *= exposure;

		}`},FXAAShader={name:"FXAAShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2(1/1024,1/512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		// FXAA algorithm from NVIDIA, C# implementation by Jasper Flick, GLSL port by Dave Hoskins
		// http://developer.download.nvidia.com/assets/gamedev/files/sdk/11/FXAA_WhitePaper.pdf
		// https://catlikecoding.com/unity/tutorials/advanced-rendering/fxaa/

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		#define EDGE_STEP_COUNT 6
		#define EDGE_GUESS 8.0
		#define EDGE_STEPS 1.0, 1.5, 2.0, 2.0, 2.0, 4.0
		const float edgeSteps[EDGE_STEP_COUNT] = float[EDGE_STEP_COUNT]( EDGE_STEPS );

		float _ContrastThreshold = 0.0312;
		float _RelativeThreshold = 0.063;
		float _SubpixelBlending = 1.0;

		vec4 Sample( sampler2D  tex2D, vec2 uv ) {

			return texture( tex2D, uv );

		}

		float SampleLuminance( sampler2D tex2D, vec2 uv ) {

			return dot( Sample( tex2D, uv ).rgb, vec3( 0.3, 0.59, 0.11 ) );

		}

		float SampleLuminance( sampler2D tex2D, vec2 texSize, vec2 uv, float uOffset, float vOffset ) {

			uv += texSize * vec2(uOffset, vOffset);
			return SampleLuminance(tex2D, uv);

		}

		struct LuminanceData {

			float m, n, e, s, w;
			float ne, nw, se, sw;
			float highest, lowest, contrast;

		};

		LuminanceData SampleLuminanceNeighborhood( sampler2D tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData l;
			l.m = SampleLuminance( tex2D, uv );
			l.n = SampleLuminance( tex2D, texSize, uv,  0.0,  1.0 );
			l.e = SampleLuminance( tex2D, texSize, uv,  1.0,  0.0 );
			l.s = SampleLuminance( tex2D, texSize, uv,  0.0, -1.0 );
			l.w = SampleLuminance( tex2D, texSize, uv, -1.0,  0.0 );

			l.ne = SampleLuminance( tex2D, texSize, uv,  1.0,  1.0 );
			l.nw = SampleLuminance( tex2D, texSize, uv, -1.0,  1.0 );
			l.se = SampleLuminance( tex2D, texSize, uv,  1.0, -1.0 );
			l.sw = SampleLuminance( tex2D, texSize, uv, -1.0, -1.0 );

			l.highest = max( max( max( max( l.n, l.e ), l.s ), l.w ), l.m );
			l.lowest = min( min( min( min( l.n, l.e ), l.s ), l.w ), l.m );
			l.contrast = l.highest - l.lowest;
			return l;

		}

		bool ShouldSkipPixel( LuminanceData l ) {

			float threshold = max( _ContrastThreshold, _RelativeThreshold * l.highest );
			return l.contrast < threshold;

		}

		float DeterminePixelBlendFactor( LuminanceData l ) {

			float f = 2.0 * ( l.n + l.e + l.s + l.w );
			f += l.ne + l.nw + l.se + l.sw;
			f *= 1.0 / 12.0;
			f = abs( f - l.m );
			f = clamp( f / l.contrast, 0.0, 1.0 );

			float blendFactor = smoothstep( 0.0, 1.0, f );
			return blendFactor * blendFactor * _SubpixelBlending;

		}

		struct EdgeData {

			bool isHorizontal;
			float pixelStep;
			float oppositeLuminance, gradient;

		};

		EdgeData DetermineEdge( vec2 texSize, LuminanceData l ) {

			EdgeData e;
			float horizontal =
				abs( l.n + l.s - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.se - 2.0 * l.e ) +
				abs( l.nw + l.sw - 2.0 * l.w );
			float vertical =
				abs( l.e + l.w - 2.0 * l.m ) * 2.0 +
				abs( l.ne + l.nw - 2.0 * l.n ) +
				abs( l.se + l.sw - 2.0 * l.s );
			e.isHorizontal = horizontal >= vertical;

			float pLuminance = e.isHorizontal ? l.n : l.e;
			float nLuminance = e.isHorizontal ? l.s : l.w;
			float pGradient = abs( pLuminance - l.m );
			float nGradient = abs( nLuminance - l.m );

			e.pixelStep = e.isHorizontal ? texSize.y : texSize.x;
			
			if (pGradient < nGradient) {

				e.pixelStep = -e.pixelStep;
				e.oppositeLuminance = nLuminance;
				e.gradient = nGradient;

			} else {

				e.oppositeLuminance = pLuminance;
				e.gradient = pGradient;

			}

			return e;

		}

		float DetermineEdgeBlendFactor( sampler2D  tex2D, vec2 texSize, LuminanceData l, EdgeData e, vec2 uv ) {

			vec2 uvEdge = uv;
			vec2 edgeStep;
			if (e.isHorizontal) {

				uvEdge.y += e.pixelStep * 0.5;
				edgeStep = vec2( texSize.x, 0.0 );

			} else {

				uvEdge.x += e.pixelStep * 0.5;
				edgeStep = vec2( 0.0, texSize.y );

			}

			float edgeLuminance = ( l.m + e.oppositeLuminance ) * 0.5;
			float gradientThreshold = e.gradient * 0.25;

			vec2 puv = uvEdge + edgeStep * edgeSteps[0];
			float pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
			bool pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !pAtEnd; i++ ) {

				puv += edgeStep * edgeSteps[i];
				pLuminanceDelta = SampleLuminance( tex2D, puv ) - edgeLuminance;
				pAtEnd = abs( pLuminanceDelta ) >= gradientThreshold;

			}

			if ( !pAtEnd ) {

				puv += edgeStep * EDGE_GUESS;

			}

			vec2 nuv = uvEdge - edgeStep * edgeSteps[0];
			float nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
			bool nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			for ( int i = 1; i < EDGE_STEP_COUNT && !nAtEnd; i++ ) {

				nuv -= edgeStep * edgeSteps[i];
				nLuminanceDelta = SampleLuminance( tex2D, nuv ) - edgeLuminance;
				nAtEnd = abs( nLuminanceDelta ) >= gradientThreshold;

			}

			if ( !nAtEnd ) {

				nuv -= edgeStep * EDGE_GUESS;

			}

			float pDistance, nDistance;
			if ( e.isHorizontal ) {

				pDistance = puv.x - uv.x;
				nDistance = uv.x - nuv.x;

			} else {
				
				pDistance = puv.y - uv.y;
				nDistance = uv.y - nuv.y;

			}

			float shortestDistance;
			bool deltaSign;
			if ( pDistance <= nDistance ) {

				shortestDistance = pDistance;
				deltaSign = pLuminanceDelta >= 0.0;

			} else {

				shortestDistance = nDistance;
				deltaSign = nLuminanceDelta >= 0.0;

			}

			if ( deltaSign == ( l.m - edgeLuminance >= 0.0 ) ) {

				return 0.0;

			}

			return 0.5 - shortestDistance / ( pDistance + nDistance );

		}

		vec4 ApplyFXAA( sampler2D  tex2D, vec2 texSize, vec2 uv ) {

			LuminanceData luminance = SampleLuminanceNeighborhood( tex2D, texSize, uv );
			if ( ShouldSkipPixel( luminance ) ) {

				return Sample( tex2D, uv );

			}

			float pixelBlend = DeterminePixelBlendFactor( luminance );
			EdgeData edge = DetermineEdge( texSize, luminance );
			float edgeBlend = DetermineEdgeBlendFactor( tex2D, texSize, luminance, edge, uv );
			float finalBlend = max( pixelBlend, edgeBlend );

			if (edge.isHorizontal) {

				uv.y += edge.pixelStep * finalBlend;

			} else {

				uv.x += edge.pixelStep * finalBlend;

			}

			return Sample( tex2D, uv );

		}

		void main() {

			gl_FragColor = ApplyFXAA( tDiffuse, resolution.xy, vUv );
			
		}`},FocusShader={name:"FocusShader",uniforms:{tDiffuse:{value:null},screenWidth:{value:1024},screenHeight:{value:1024},sampleDistance:{value:.94},waveFactor:{value:.00125}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float screenWidth;
		uniform float screenHeight;
		uniform float sampleDistance;
		uniform float waveFactor;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 color, org, tmp, add;
			float sample_dist, f;
			vec2 vin;
			vec2 uv = vUv;

			add = color = org = texture2D( tDiffuse, uv );

			vin = ( uv - vec2( 0.5 ) ) * vec2( 1.4 );
			sample_dist = dot( vin, vin ) * 2.0;

			f = ( waveFactor * 100.0 + sample_dist ) * sampleDistance * 4.0;

			vec2 sampleSize = vec2(  1.0 / screenWidth, 1.0 / screenHeight ) * vec2( f );

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.111964, 0.993712 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.846724, 0.532032 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.943883, -0.330279 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( 0.330279, -0.943883 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.532032, -0.846724 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.993712, -0.111964 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			add += tmp = texture2D( tDiffuse, uv + vec2( -0.707107, 0.707107 ) * sampleSize );
			if( tmp.b < color.b ) color = tmp;

			color = color * vec4( 2.0 ) - ( add / vec4( 8.0 ) );
			color = color + ( add / vec4( 8.0 ) - color ) * ( vec4( 1.0 ) - vec4( sample_dist * 0.5 ) );

			gl_FragColor = vec4( color.rgb * color.rgb * vec3( 0.95 ) + color.rgb, 1.0 );

		}`},FreiChenShader={name:"FreiChenShader",uniforms:{tDiffuse:{value:null},aspect:{value:new Vector2(512,512)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		uniform vec2 aspect;

		vec2 texel = vec2( 1.0 / aspect.x, 1.0 / aspect.y );


		mat3 G[9];

		// hard coded matrix values!!!! as suggested in https://github.com/neilmendoza/ofxPostProcessing/blob/master/src/EdgePass.cpp#L45

		const mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );
		const mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );
		const mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );
		const mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );
		const mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );
		const mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );
		const mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );
		const mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );
		const mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );

		void main(void)
		{

			G[0] = g0,
			G[1] = g1,
			G[2] = g2,
			G[3] = g3,
			G[4] = g4,
			G[5] = g5,
			G[6] = g6,
			G[7] = g7,
			G[8] = g8;

			mat3 I;
			float cnv[9];
			vec3 sample;

		/* fetch the 3x3 neighbourhood and use the RGB vector's length as intensity value */
			for (float i=0.0; i<3.0; i++) {
				for (float j=0.0; j<3.0; j++) {
					sample = texture2D(tDiffuse, vUv + texel * vec2(i-1.0,j-1.0) ).rgb;
					I[int(i)][int(j)] = length(sample);
				}
			}

		/* calculate the convolution values for all the masks */
			for (int i=0; i<9; i++) {
				float dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);
				cnv[i] = dp3 * dp3;
			}

			float M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);
			float S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);

			gl_FragColor = vec4(vec3(sqrt(M/S)), 1.0);
		}`},GammaCorrectionShader={name:"GammaCorrectionShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vUv );

			gl_FragColor = sRGBTransferOETF( tex );

		}`},GodRaysDepthMaskShader={name:"GodRaysDepthMaskShader",uniforms:{tInput:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

		 vUv = uv;
		 gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

	 }`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tInput;

		void main() {

			gl_FragColor = vec4( 1.0 ) - texture2D( tInput, vUv );

		}`},GodRaysGenerateShader={name:"GodRaysGenerateShader",uniforms:{tInput:{value:null},fStepSize:{value:1},vSunPositionScreenSpace:{value:new Vector3$1}},vertexShader:`

		varying vec2 vUv;

		void main() {

		 vUv = uv;
		 gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

	 }`,fragmentShader:`

		#define TAPS_PER_PASS 6.0

		varying vec2 vUv;

		uniform sampler2D tInput;

		uniform vec3 vSunPositionScreenSpace;
		uniform float fStepSize; // filter step size

		void main() {

		// delta from current pixel to "sun" position

			vec2 delta = vSunPositionScreenSpace.xy - vUv;
			float dist = length( delta );

		// Step vector (uv space)

			vec2 stepv = fStepSize * delta / dist;

		// Number of iterations between pixel and sun

			float iters = dist/fStepSize;

			vec2 uv = vUv.xy;
			float col = 0.0;

		// This breaks ANGLE in Chrome 22
		//	- see http://code.google.com/p/chromium/issues/detail?id=153105

		/*
		// Unrolling didnt do much on my hardware (ATI Mobility Radeon 3450),
		// so i've just left the loop

		"for ( float i = 0.0; i < TAPS_PER_PASS; i += 1.0 ) {",

		// Accumulate samples, making sure we dont walk past the light source.

		// The check for uv.y < 1 would not be necessary with "border" UV wrap
		// mode, with a black border color. I don't think this is currently
		// exposed by three.js. As a result there might be artifacts when the
		// sun is to the left, right or bottom of screen as these cases are
		// not specifically handled.

		"	col += ( i <= iters && uv.y < 1.0 ? texture2D( tInput, uv ).r : 0.0 );",
		"	uv += stepv;",

		"}",
		*/

		// Unrolling loop manually makes it work in ANGLE

			float f = min( 1.0, max( vSunPositionScreenSpace.z / 1000.0, 0.0 ) ); // used to fade out godrays

			if ( 0.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 1.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 2.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 3.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 4.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

			if ( 5.0 <= iters && uv.y < 1.0 ) col += texture2D( tInput, uv ).r * f;
			uv += stepv;

		// Should technically be dividing by 'iters but 'TAPS_PER_PASS' smooths out
		// objectionable artifacts, in particular near the sun position. The side
		// effect is that the result is darker than it should be around the sun, as
		// TAPS_PER_PASS is greater than the number of samples actually accumulated.
		// When the result is inverted (in the shader 'godrays_combine this produces
		// a slight bright spot at the position of the sun, even when it is occluded.

			gl_FragColor = vec4( col/TAPS_PER_PASS );
			gl_FragColor.a = 1.0;

		}`},GodRaysCombineShader={name:"GodRaysCombineShader",uniforms:{tColors:{value:null},tGodRays:{value:null},fGodRayIntensity:{value:.69}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		varying vec2 vUv;

		uniform sampler2D tColors;
		uniform sampler2D tGodRays;

		uniform float fGodRayIntensity;

		void main() {

		// Since THREE.MeshDepthMaterial renders foreground objects white and background
		// objects black, the god-rays will be white streaks. Therefore value is inverted
		// before being combined with tColors

			gl_FragColor = texture2D( tColors, vUv ) + fGodRayIntensity * vec4( 1.0 - texture2D( tGodRays, vUv ).r );
			gl_FragColor.a = 1.0;

		}`},GodRaysFakeSunShader={name:"GodRaysFakeSunShader",uniforms:{vSunPositionScreenSpace:{value:new Vector3$1},fAspect:{value:1},sunColor:{value:new Color(16772608)},bgColor:{value:new Color(0)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		varying vec2 vUv;

		uniform vec3 vSunPositionScreenSpace;
		uniform float fAspect;

		uniform vec3 sunColor;
		uniform vec3 bgColor;

		void main() {

			vec2 diff = vUv - vSunPositionScreenSpace.xy;

		// Correct for aspect ratio

			diff.x *= fAspect;

			float prop = clamp( length( diff ) / 0.5, 0.0, 1.0 );
			prop = 0.35 * pow( 1.0 - prop, 3.0 );

			gl_FragColor.xyz = ( vSunPositionScreenSpace.z > 0.0 ) ? mix( sunColor, bgColor, 1.0 - prop ) : bgColor;
			gl_FragColor.w = 1.0;

		}`},HorizontalBlurShader={name:"HorizontalBlurShader",uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},HorizontalTiltShiftShader={name:"HorizontalTiltShiftShader",uniforms:{tDiffuse:{value:null},h:{value:1/512},r:{value:.35}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;
		uniform float r;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			float hh = h * abs( r - vUv.y );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * hh, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * hh, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * hh, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * hh, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * hh, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * hh, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * hh, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * hh, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`},HueSaturationShader={name:"HueSaturationShader",uniforms:{tDiffuse:{value:null},hue:{value:0},saturation:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float hue;
		uniform float saturation;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );

			// hue
			float angle = hue * 3.14159265;
			float s = sin(angle), c = cos(angle);
			vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;
			float len = length(gl_FragColor.rgb);
			gl_FragColor.rgb = vec3(
				dot(gl_FragColor.rgb, weights.xyz),
				dot(gl_FragColor.rgb, weights.zxy),
				dot(gl_FragColor.rgb, weights.yzx)
			);

			// saturation
			float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;
			if (saturation > 0.0) {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - saturation));
			} else {
				gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-saturation);
			}

		}`},KaleidoShader={name:"KaleidoShader",uniforms:{tDiffuse:{value:null},sides:{value:6},angle:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float sides;
		uniform float angle;

		varying vec2 vUv;

		void main() {

			vec2 p = vUv - 0.5;
			float r = length(p);
			float a = atan(p.y, p.x) + angle;
			float tau = 2. * 3.1416 ;
			a = mod(a, tau/sides);
			a = abs(a - tau/sides/2.) ;
			p = r * vec2(cos(a), sin(a));
			vec4 color = texture2D(tDiffuse, p + 0.5);
			gl_FragColor = color;

		}`},LuminosityShader={name:"LuminosityShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );

			float l = luminance( texel.rgb );

			gl_FragColor = vec4( l, l, l, texel.w );

		}`},MirrorShader={name:"MirrorShader",uniforms:{tDiffuse:{value:null},side:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform int side;

		varying vec2 vUv;

		void main() {

			vec2 p = vUv;
			if (side == 0){
				if (p.x > 0.5) p.x = 1.0 - p.x;
			}else if (side == 1){
				if (p.x < 0.5) p.x = 1.0 - p.x;
			}else if (side == 2){
				if (p.y < 0.5) p.y = 1.0 - p.y;
			}else if (side == 3){
				if (p.y > 0.5) p.y = 1.0 - p.y;
			}
			vec4 color = texture2D(tDiffuse, p);
			gl_FragColor = color;

		}`},NormalMapShader={name:"NormalMapShader",uniforms:{heightMap:{value:null},resolution:{value:new Vector2(512,512)},scale:{value:new Vector2(1,1)},height:{value:.05}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float height;
		uniform vec2 resolution;
		uniform sampler2D heightMap;

		varying vec2 vUv;

		void main() {

			float val = texture2D( heightMap, vUv ).x;

			float valU = texture2D( heightMap, vUv + vec2( 1.0 / resolution.x, 0.0 ) ).x;
			float valV = texture2D( heightMap, vUv + vec2( 0.0, 1.0 / resolution.y ) ).x;

			gl_FragColor = vec4( ( 0.5 * normalize( vec3( val - valU, val - valV, height  ) ) + 0.5 ), 1.0 );

		}`},RGBShiftShader={name:"RGBShiftShader",uniforms:{tDiffuse:{value:null},amount:{value:.005},angle:{value:0}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float amount;
		uniform float angle;

		varying vec2 vUv;

		void main() {

			vec2 offset = amount * vec2( cos(angle), sin(angle));
			vec4 cr = texture2D(tDiffuse, vUv + offset);
			vec4 cga = texture2D(tDiffuse, vUv);
			vec4 cb = texture2D(tDiffuse, vUv - offset);
			gl_FragColor = vec4(cr.r, cga.g, cb.b, cga.a);

		}`},SepiaShader={name:"SepiaShader",uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float amount;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 color = texture2D( tDiffuse, vUv );
			vec3 c = color.rgb;

			color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );
			color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );
			color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );

			gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );

		}`},SobelOperatorShader={name:"SobelOperatorShader",uniforms:{tDiffuse:{value:null},resolution:{value:new Vector2}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform vec2 resolution;
		varying vec2 vUv;

		void main() {

			vec2 texel = vec2( 1.0 / resolution.x, 1.0 / resolution.y );

		// kernel definition (in glsl matrices are filled in column-major order)

			const mat3 Gx = mat3( -1, -2, -1, 0, 0, 0, 1, 2, 1 ); // x direction kernel
			const mat3 Gy = mat3( -1, 0, 1, -2, 0, 2, -1, 0, 1 ); // y direction kernel

		// fetch the 3x3 neighbourhood of a fragment

		// first column

			float tx0y0 = texture2D( tDiffuse, vUv + texel * vec2( -1, -1 ) ).r;
			float tx0y1 = texture2D( tDiffuse, vUv + texel * vec2( -1,  0 ) ).r;
			float tx0y2 = texture2D( tDiffuse, vUv + texel * vec2( -1,  1 ) ).r;

		// second column

			float tx1y0 = texture2D( tDiffuse, vUv + texel * vec2(  0, -1 ) ).r;
			float tx1y1 = texture2D( tDiffuse, vUv + texel * vec2(  0,  0 ) ).r;
			float tx1y2 = texture2D( tDiffuse, vUv + texel * vec2(  0,  1 ) ).r;

		// third column

			float tx2y0 = texture2D( tDiffuse, vUv + texel * vec2(  1, -1 ) ).r;
			float tx2y1 = texture2D( tDiffuse, vUv + texel * vec2(  1,  0 ) ).r;
			float tx2y2 = texture2D( tDiffuse, vUv + texel * vec2(  1,  1 ) ).r;

		// gradient value in x direction

			float valueGx = Gx[0][0] * tx0y0 + Gx[1][0] * tx1y0 + Gx[2][0] * tx2y0 +
				Gx[0][1] * tx0y1 + Gx[1][1] * tx1y1 + Gx[2][1] * tx2y1 +
				Gx[0][2] * tx0y2 + Gx[1][2] * tx1y2 + Gx[2][2] * tx2y2;

		// gradient value in y direction

			float valueGy = Gy[0][0] * tx0y0 + Gy[1][0] * tx1y0 + Gy[2][0] * tx2y0 +
				Gy[0][1] * tx0y1 + Gy[1][1] * tx1y1 + Gy[2][1] * tx2y1 +
				Gy[0][2] * tx0y2 + Gy[1][2] * tx1y2 + Gy[2][2] * tx2y2;

		// magnitute of the total gradient

			float G = sqrt( ( valueGx * valueGx ) + ( valueGy * valueGy ) );

			gl_FragColor = vec4( vec3( G ), 1 );

		}`};function replaceAll(rr,er,tr){return rr.split(er).join(tr)}const meshphong_frag_head=ShaderChunk.meshphong_frag.slice(0,ShaderChunk.meshphong_frag.indexOf("void main() {")),meshphong_frag_body=ShaderChunk.meshphong_frag.slice(ShaderChunk.meshphong_frag.indexOf("void main() {")),SubsurfaceScatteringShader={name:"SubsurfaceScatteringShader",uniforms:UniformsUtils.merge([ShaderLib.phong.uniforms,{thicknessMap:{value:null},thicknessColor:{value:new Color(16777215)},thicknessDistortion:{value:.1},thicknessAmbient:{value:0},thicknessAttenuation:{value:.1},thicknessPower:{value:2},thicknessScale:{value:10}}]),vertexShader:["#define USE_UV",ShaderChunk.meshphong_vert].join(`
`),fragmentShader:["#define USE_UV","#define SUBSURFACE",meshphong_frag_head,"uniform sampler2D thicknessMap;","uniform float thicknessPower;","uniform float thicknessScale;","uniform float thicknessDistortion;","uniform float thicknessAmbient;","uniform float thicknessAttenuation;","uniform vec3 thicknessColor;","void RE_Direct_Scattering(const in IncidentLight directLight, const in vec2 uv, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, inout ReflectedLight reflectedLight) {","	vec3 thickness = thicknessColor * texture2D(thicknessMap, uv).r;","	vec3 scatteringHalf = normalize(directLight.direction + (geometryNormal * thicknessDistortion));","	float scatteringDot = pow(saturate(dot(geometryViewDir, -scatteringHalf)), thicknessPower) * thicknessScale;","	vec3 scatteringIllu = (scatteringDot + thicknessAmbient) * thickness;","	reflectedLight.directDiffuse += scatteringIllu * thicknessAttenuation * directLight.color;","}",meshphong_frag_body.replace("#include <lights_fragment_begin>",replaceAll(ShaderChunk.lights_fragment_begin,"RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );",["RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );","#if defined( SUBSURFACE ) && defined( USE_UV )"," RE_Direct_Scattering(directLight, vUv, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, reflectedLight);","#endif"].join(`
`)))].join(`
`)},TechnicolorShader={name:"TechnicolorShader",uniforms:{tDiffuse:{value:null}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		varying vec2 vUv;

		void main() {

			vec4 tex = texture2D( tDiffuse, vec2( vUv.x, vUv.y ) );
			vec4 newTex = vec4(tex.r, (tex.g + tex.b) * .5, (tex.g + tex.b) * .5, 1.0);

			gl_FragColor = newTex;

		}`},ToonShader1={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)}},vertexShader:`

		varying vec3 vNormal;
		varying vec3 vRefract;

		void main() {

			vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
			vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
			vec3 worldNormal = normalize ( mat3( modelMatrix[0].xyz, modelMatrix[1].xyz, modelMatrix[2].xyz ) * normal );

			vNormal = normalize( normalMatrix * normal );

			vec3 I = worldPosition.xyz - cameraPosition;
			vRefract = refract( normalize( I ), worldNormal, 1.02 );

			gl_Position = projectionMatrix * mvPosition;

		}`,fragmentShader:`

		uniform vec3 uBaseColor;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		varying vec3 vRefract;

		void main() {

			float directionalLightWeighting = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			float intensity = smoothstep( - 0.5, 1.0, pow( length(lightWeighting), 20.0 ) );
			intensity += length(lightWeighting) * 0.2;

			float cameraWeighting = dot( normalize( vNormal ), vRefract );
			intensity += pow( 1.0 - length( cameraWeighting ), 6.0 );
			intensity = intensity * 0.2 + 0.3;

			if ( intensity < 0.50 ) {

				gl_FragColor = vec4( 2.0 * intensity * uBaseColor, 1.0 );

			} else {

				gl_FragColor = vec4( 1.0 - 2.0 * ( 1.0 - intensity ) * ( 1.0 - uBaseColor ), 1.0 );

			}

			#include <colorspace_fragment>

		}`},ToonShader2={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(15658734)},uLineColor1:{value:new Color(8421504)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float camera = max( dot( normalize( vNormal ), vec3( 0.0, 0.0, 1.0 ) ), 0.4);
			float light = max( dot( normalize( vNormal ), uDirLightPos ), 0.0);

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(uAmbientLightColor + uDirLightColor * light) < 1.00 ) {

				gl_FragColor *= vec4( uLineColor1, 1.0 );

			}

			if ( length(uAmbientLightColor + uDirLightColor * camera) < 0.50 ) {

				gl_FragColor *= vec4( uLineColor2, 1.0 );

			}

			#include <colorspace_fragment>

		}`},ToonShaderHatching={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)},uLineColor2:{value:new Color(0)},uLineColor3:{value:new Color(0)},uLineColor4:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.75 ) {

				if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor2, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor3, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.3465 ) {

				if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {

					gl_FragColor = vec4( uLineColor4, 1.0 );

			}

			}

			#include <colorspace_fragment>

		}`},ToonShaderDotted={uniforms:{uDirLightPos:{value:new Vector3$1},uDirLightColor:{value:new Color(15658734)},uAmbientLightColor:{value:new Color(328965)},uBaseColor:{value:new Color(16777215)},uLineColor1:{value:new Color(0)}},vertexShader:`

		varying vec3 vNormal;

		void main() {

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			vNormal = normalize( normalMatrix * normal );

		}`,fragmentShader:`

		uniform vec3 uBaseColor;
		uniform vec3 uLineColor1;
		uniform vec3 uLineColor2;
		uniform vec3 uLineColor3;
		uniform vec3 uLineColor4;

		uniform vec3 uDirLightPos;
		uniform vec3 uDirLightColor;

		uniform vec3 uAmbientLightColor;

		varying vec3 vNormal;

		void main() {

			float directionalLightWeighting = max( dot( normalize(vNormal), uDirLightPos ), 0.0);
			vec3 lightWeighting = uAmbientLightColor + uDirLightColor * directionalLightWeighting;

			gl_FragColor = vec4( uBaseColor, 1.0 );

			if ( length(lightWeighting) < 1.00 ) {

				if ( ( mod(gl_FragCoord.x, 4.001) + mod(gl_FragCoord.y, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			if ( length(lightWeighting) < 0.50 ) {

				if ( ( mod(gl_FragCoord.x + 2.0, 4.001) + mod(gl_FragCoord.y + 2.0, 4.0) ) > 6.00 ) {

					gl_FragColor = vec4( uLineColor1, 1.0 );

				}

			}

			#include <colorspace_fragment>

		}`},TriangleBlurShader={name:"TriangleBlurShader",uniforms:{texture:{value:null},delta:{value:new Vector2(1,1)}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		#include <common>

		#define ITERATIONS 10.0

		uniform sampler2D texture;
		uniform vec2 delta;

		varying vec2 vUv;

		void main() {

			vec4 color = vec4( 0.0 );

			float total = 0.0;

		// randomize the lookup values to hide the fixed number of samples

			float offset = rand( vUv );

			for ( float t = -ITERATIONS; t <= ITERATIONS; t ++ ) {

				float percent = ( t + offset - 0.5 ) / ITERATIONS;
				float weight = 1.0 - abs( percent );

				color += texture2D( texture, vUv + delta * percent ) * weight;
				total += weight;

			}

			gl_FragColor = color / total;

		}`},UnpackDepthRGBAShader={name:"UnpackDepthRGBAShader",uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		#include <packing>

		void main() {

			float depth = 1.0 - unpackRGBAToDepth( texture2D( tDiffuse, vUv ) );
			gl_FragColor = vec4( vec3( depth ), opacity );

		}`},VelocityShader={name:"VelocityShader",uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap,{modelMatrixPrev:{value:new Matrix4},currentProjectionViewMatrix:{value:new Matrix4},previousProjectionViewMatrix:{value:new Matrix4}}]),vertexShader:`
#define NORMAL

#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )

	varying vec3 vViewPosition;

#endif

#include <common>
#include <packing>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

uniform mat4 previousProjectionViewMatrix;
uniform mat4 currentProjectionViewMatrix;

uniform mat4 modelMatrixPrev;

varying vec4 clipPositionCurrent;
varying vec4 clipPositionPrevious;

void main() {


	#include <uv_vertex>

	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>

	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <displacementmap_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>

#ifdef USE_SKINNING

	vec4 mvPosition = modelViewMatrix * skinned;
	clipPositionCurrent  = currentProjectionViewMatrix * modelMatrix * skinned;
	clipPositionPrevious = previousProjectionViewMatrix * modelMatrixPrev * skinned;

#else

	vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
	clipPositionCurrent  = currentProjectionViewMatrix * modelMatrix * vec4( transformed, 1.0 );
	clipPositionPrevious = previousProjectionViewMatrix * modelMatrixPrev * vec4( transformed, 1.0 );

#endif

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}
`,fragmentShader:`
#define NORMAL

uniform float opacity;

#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

varying vec4 clipPositionCurrent;
varying vec4 clipPositionPrevious;

void main() {

	vec4 diffuseColor = vec4( 1.0 );
	diffuseColor.a = opacity;

	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>

	vec2 ndcPositionCurrent  = clipPositionCurrent.xy/clipPositionCurrent.w;
	vec2 ndcPositionPrevious = clipPositionPrevious.xy/clipPositionPrevious.w;
	vec2 vel = ( ndcPositionCurrent - ndcPositionPrevious ) * 0.5;
	vel = vel * 0.5 + 0.5;
	vec2 v1 = packDepthToRG(vel.x);
	vec2 v2 = packDepthToRG(vel.y);
	gl_FragColor = vec4(v1.x, v1.y, v2.x, v2.y);

	#include <logdepthbuf_fragment>

}

`},VerticalBlurShader={name:"VerticalBlurShader",uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`},VerticalTiltShiftShader={name:"VerticalTiltShiftShader",uniforms:{tDiffuse:{value:null},v:{value:1/512},r:{value:.35}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;
		uniform float r;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			float vv = v * abs( r - vUv.y );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * vv ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * vv ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * vv ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * vv ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * vv ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * vv ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * vv ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * vv ) ) * 0.051;

			gl_FragColor = sum;

		}`},VignetteShader={name:"VignetteShader",uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float offset;
		uniform float darkness;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			// Eskil's vignette

			vec4 texel = texture2D( tDiffuse, vUv );
			vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );
			gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );

		}`},VolumeRenderShader1={uniforms:{u_size:{value:new Vector3$1(1,1,1)},u_renderstyle:{value:0},u_renderthreshold:{value:.5},u_clim:{value:new Vector2(1,1)},u_data:{value:null},u_cmdata:{value:null}},vertexShader:`

		varying vec4 v_nearpos;
		varying vec4 v_farpos;
		varying vec3 v_position;

		void main() {
				// Prepare transforms to map to "camera view". See also:
				// https://threejs.org/docs/#api/renderers/webgl/WebGLProgram
				mat4 viewtransformf = modelViewMatrix;
				mat4 viewtransformi = inverse(modelViewMatrix);

				// Project local vertex coordinate to camera position. Then do a step
				// backward (in cam coords) to the near clipping plane, and project back. Do
				// the same for the far clipping plane. This gives us all the information we
				// need to calculate the ray and truncate it to the viewing cone.
				vec4 position4 = vec4(position, 1.0);
				vec4 pos_in_cam = viewtransformf * position4;

				// Intersection of ray and near clipping plane (z = -1 in clip coords)
				pos_in_cam.z = -pos_in_cam.w;
				v_nearpos = viewtransformi * pos_in_cam;

				// Intersection of ray and far clipping plane (z = +1 in clip coords)
				pos_in_cam.z = pos_in_cam.w;
				v_farpos = viewtransformi * pos_in_cam;

				// Set varyings and output pos
				v_position = position;
				gl_Position = projectionMatrix * viewMatrix * modelMatrix * position4;
		}`,fragmentShader:`

				precision highp float;
				precision mediump sampler3D;

				uniform vec3 u_size;
				uniform int u_renderstyle;
				uniform float u_renderthreshold;
				uniform vec2 u_clim;

				uniform sampler3D u_data;
				uniform sampler2D u_cmdata;

				varying vec3 v_position;
				varying vec4 v_nearpos;
				varying vec4 v_farpos;

				// The maximum distance through our rendering volume is sqrt(3).
				const int MAX_STEPS = 887;	// 887 for 512^3, 1774 for 1024^3
				const int REFINEMENT_STEPS = 4;
				const float relative_step_size = 1.0;
				const vec4 ambient_color = vec4(0.2, 0.4, 0.2, 1.0);
				const vec4 diffuse_color = vec4(0.8, 0.2, 0.2, 1.0);
				const vec4 specular_color = vec4(1.0, 1.0, 1.0, 1.0);
				const float shininess = 40.0;

				void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);
				void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray);

				float sample1(vec3 texcoords);
				vec4 apply_colormap(float val);
				vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray);


				void main() {
						// Normalize clipping plane info
						vec3 farpos = v_farpos.xyz / v_farpos.w;
						vec3 nearpos = v_nearpos.xyz / v_nearpos.w;

						// Calculate unit vector pointing in the view direction through this fragment.
						vec3 view_ray = normalize(nearpos.xyz - farpos.xyz);

						// Compute the (negative) distance to the front surface or near clipping plane.
						// v_position is the back face of the cuboid, so the initial distance calculated in the dot
						// product below is the distance from near clip plane to the back of the cuboid
						float distance = dot(nearpos - v_position, view_ray);
						distance = max(distance, min((-0.5 - v_position.x) / view_ray.x,
																				(u_size.x - 0.5 - v_position.x) / view_ray.x));
						distance = max(distance, min((-0.5 - v_position.y) / view_ray.y,
																				(u_size.y - 0.5 - v_position.y) / view_ray.y));
						distance = max(distance, min((-0.5 - v_position.z) / view_ray.z,
																				(u_size.z - 0.5 - v_position.z) / view_ray.z));

						// Now we have the starting position on the front surface
						vec3 front = v_position + view_ray * distance;

						// Decide how many steps to take
						int nsteps = int(-distance / relative_step_size + 0.5);
						if ( nsteps < 1 )
								discard;

						// Get starting location and step vector in texture coordinates
						vec3 step = ((v_position - front) / u_size) / float(nsteps);
						vec3 start_loc = front / u_size;

						// For testing: show the number of steps. This helps to establish
						// whether the rays are correctly oriented
						//'gl_FragColor = vec4(0.0, float(nsteps) / 1.0 / u_size.x, 1.0, 1.0);
						//'return;

						if (u_renderstyle == 0)
								cast_mip(start_loc, step, nsteps, view_ray);
						else if (u_renderstyle == 1)
								cast_iso(start_loc, step, nsteps, view_ray);

						if (gl_FragColor.a < 0.05)
								discard;
				}


				float sample1(vec3 texcoords) {
						/* Sample float value from a 3D texture. Assumes intensity data. */
						return texture(u_data, texcoords.xyz).r;
				}


				vec4 apply_colormap(float val) {
						val = (val - u_clim[0]) / (u_clim[1] - u_clim[0]);
						return texture2D(u_cmdata, vec2(val, 0.5));
				}


				void cast_mip(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {

						float max_val = -1e6;
						int max_i = 100;
						vec3 loc = start_loc;

						// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with
						// non-constant expression. So we use a hard-coded max, and an additional condition
						// inside the loop.
						for (int iter=0; iter<MAX_STEPS; iter++) {
								if (iter >= nsteps)
										break;
								// Sample from the 3D texture
								float val = sample1(loc);
								// Apply MIP operation
								if (val > max_val) {
										max_val = val;
										max_i = iter;
								}
								// Advance location deeper into the volume
								loc += step;
						}

						// Refine location, gives crispier images
						vec3 iloc = start_loc + step * (float(max_i) - 0.5);
						vec3 istep = step / float(REFINEMENT_STEPS);
						for (int i=0; i<REFINEMENT_STEPS; i++) {
								max_val = max(max_val, sample1(iloc));
								iloc += istep;
						}

						// Resolve final color
						gl_FragColor = apply_colormap(max_val);
				}


				void cast_iso(vec3 start_loc, vec3 step, int nsteps, vec3 view_ray) {

						gl_FragColor = vec4(0.0);	// init transparent
						vec4 color3 = vec4(0.0);	// final color
						vec3 dstep = 1.5 / u_size;	// step to sample derivative
						vec3 loc = start_loc;

						float low_threshold = u_renderthreshold - 0.02 * (u_clim[1] - u_clim[0]);

						// Enter the raycasting loop. In WebGL 1 the loop index cannot be compared with
						// non-constant expression. So we use a hard-coded max, and an additional condition
						// inside the loop.
						for (int iter=0; iter<MAX_STEPS; iter++) {
								if (iter >= nsteps)
										break;

								// Sample from the 3D texture
								float val = sample1(loc);

								if (val > low_threshold) {
										// Take the last interval in smaller steps
										vec3 iloc = loc - 0.5 * step;
										vec3 istep = step / float(REFINEMENT_STEPS);
										for (int i=0; i<REFINEMENT_STEPS; i++) {
												val = sample1(iloc);
												if (val > u_renderthreshold) {
														gl_FragColor = add_lighting(val, iloc, dstep, view_ray);
														return;
												}
												iloc += istep;
										}
								}

								// Advance location deeper into the volume
								loc += step;
						}
				}


				vec4 add_lighting(float val, vec3 loc, vec3 step, vec3 view_ray)
				{
					// Calculate color by incorporating lighting

						// View direction
						vec3 V = normalize(view_ray);

						// calculate normal vector from gradient
						vec3 N;
						float val1, val2;
						val1 = sample1(loc + vec3(-step[0], 0.0, 0.0));
						val2 = sample1(loc + vec3(+step[0], 0.0, 0.0));
						N[0] = val1 - val2;
						val = max(max(val1, val2), val);
						val1 = sample1(loc + vec3(0.0, -step[1], 0.0));
						val2 = sample1(loc + vec3(0.0, +step[1], 0.0));
						N[1] = val1 - val2;
						val = max(max(val1, val2), val);
						val1 = sample1(loc + vec3(0.0, 0.0, -step[2]));
						val2 = sample1(loc + vec3(0.0, 0.0, +step[2]));
						N[2] = val1 - val2;
						val = max(max(val1, val2), val);

						float gm = length(N); // gradient magnitude
						N = normalize(N);

						// Flip normal so it points towards viewer
						float Nselect = float(dot(N, V) > 0.0);
						N = (2.0 * Nselect - 1.0) * N;	// ==	Nselect * N - (1.0-Nselect)*N;

						// Init colors
						vec4 ambient_color = vec4(0.0, 0.0, 0.0, 0.0);
						vec4 diffuse_color = vec4(0.0, 0.0, 0.0, 0.0);
						vec4 specular_color = vec4(0.0, 0.0, 0.0, 0.0);

						// note: could allow multiple lights
						for (int i=0; i<1; i++)
						{
								 // Get light direction (make sure to prevent zero devision)
								vec3 L = normalize(view_ray);	//lightDirs[i];
								float lightEnabled = float( length(L) > 0.0 );
								L = normalize(L + (1.0 - lightEnabled));

								// Calculate lighting properties
								float lambertTerm = clamp(dot(N, L), 0.0, 1.0);
								vec3 H = normalize(L+V); // Halfway vector
								float specularTerm = pow(max(dot(H, N), 0.0), shininess);

								// Calculate mask
								float mask1 = lightEnabled;

								// Calculate colors
								ambient_color +=	mask1 * ambient_color;	// * gl_LightSource[i].ambient;
								diffuse_color +=	mask1 * lambertTerm;
								specular_color += mask1 * specularTerm * specular_color;
						}

						// Calculate final color by componing different components
						vec4 final_color;
						vec4 color = apply_colormap(val);
						final_color = color * (ambient_color + diffuse_color) + specular_color;
						final_color.a = color.a;
						return final_color;
				}`},WaterRefractionShader={name:"WaterRefractionShader",uniforms:{color:{value:null},time:{value:0},tDiffuse:{value:null},tDudv:{value:null},textureMatrix:{value:null}},vertexShader:`

		uniform mat4 textureMatrix;

		varying vec2 vUv;
		varying vec4 vUvRefraction;

		void main() {

			vUv = uv;

			vUvRefraction = textureMatrix * vec4( position, 1.0 );

			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform vec3 color;
		uniform float time;
		uniform sampler2D tDiffuse;
		uniform sampler2D tDudv;

		varying vec2 vUv;
		varying vec4 vUvRefraction;

		float blendOverlay( float base, float blend ) {

			return( base < 0.5 ? ( 2.0 * base * blend ) : ( 1.0 - 2.0 * ( 1.0 - base ) * ( 1.0 - blend ) ) );

		}

		vec3 blendOverlay( vec3 base, vec3 blend ) {

			return vec3( blendOverlay( base.r, blend.r ), blendOverlay( base.g, blend.g ),blendOverlay( base.b, blend.b ) );

		}

		void main() {

		 float waveStrength = 0.5;
		 float waveSpeed = 0.03;

			// simple distortion (ripple) via dudv map (see https://www.youtube.com/watch?v=6B7IF6GOu7s)

			vec2 distortedUv = texture2D( tDudv, vec2( vUv.x + time * waveSpeed, vUv.y ) ).rg * waveStrength;
			distortedUv = vUv.xy + vec2( distortedUv.x, distortedUv.y + time * waveSpeed );
			vec2 distortion = ( texture2D( tDudv, distortedUv ).rg * 2.0 - 1.0 ) * waveStrength;

			// new uv coords

			vec4 uv = vec4( vUvRefraction );
			uv.xy += distortion;

			vec4 base = texture2DProj( tDiffuse, uv );

			gl_FragColor = vec4( blendOverlay( base.rgb, color ), 1.0 );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>

		}`};class FlakesTexture{constructor(er=512,tr=512){const ir=document.createElement("canvas");ir.width=er,ir.height=tr;const nr=ir.getContext("2d");nr.fillStyle="rgb(127,127,255)",nr.fillRect(0,0,er,tr);for(let sr=0;sr<4e3;sr++){const ar=Math.random()*er,or=Math.random()*tr,lr=Math.random()*3+3;let cr=Math.random()*2-1,ur=Math.random()*2-1,dr=1.5;const hr=Math.sqrt(cr*cr+ur*ur+dr*dr);cr/=hr,ur/=hr,dr/=hr,nr.fillStyle="rgb("+(cr*127+127)+","+(ur*127+127)+","+dr*255+")",nr.beginPath(),nr.arc(ar,or,lr,0,Math.PI*2),nr.fill()}return ir}}const _va=new Vector3$1,_vb=new Vector3$1,_vc=new Vector3$1,_vr=new Vector3$1,_vu=new Vector3$1,_vn=new Vector3$1,_vec$1=new Vector3$1,_quat=new Quaternion$1;function frameCorners(rr,er,tr,ir,nr=!1){const sr=er,ar=tr,or=ir,lr=rr.position,cr=rr.near,ur=rr.far;_vr.copy(ar).sub(sr).normalize(),_vu.copy(or).sub(sr).normalize(),_vn.crossVectors(_vr,_vu).normalize(),_va.copy(sr).sub(lr),_vb.copy(ar).sub(lr),_vc.copy(or).sub(lr);const dr=-_va.dot(_vn),hr=_vr.dot(_va)*cr/dr,pr=_vr.dot(_vb)*cr/dr,gr=_vu.dot(_va)*cr/dr,vr=_vu.dot(_vc)*cr/dr;_quat.setFromUnitVectors(_vec$1.set(0,1,0),_vu),rr.quaternion.setFromUnitVectors(_vec$1.set(0,0,1).applyQuaternion(_quat),_vn).multiply(_quat),rr.projectionMatrix.set(2*cr/(pr-hr),0,(pr+hr)/(pr-hr),0,0,2*cr/(vr-gr),(vr+gr)/(vr-gr),0,0,0,(ur+cr)/(cr-ur),2*ur*cr/(cr-ur),0,0,-1,0),rr.projectionMatrixInverse.copy(rr.projectionMatrix).invert(),nr&&(rr.fov=MathUtils.RAD2DEG/Math.min(1,rr.aspect)*Math.atan((_vec$1.copy(ar).sub(sr).length()+_vec$1.copy(or).sub(sr).length())/_va.length()))}const CameraUtils$1=Object.freeze(Object.defineProperty({__proto__:null,frameCorners},Symbol.toStringTag,{value:"Module"}));function compressNormals(rr,er){const tr=rr.attributes.normal;if(tr||console.error("Geometry must contain normal attribute. "),tr.isPacked)return;tr.itemSize!=3&&console.error("normal.itemSize is not 3, which cannot be encoded. ");const ir=tr.array,nr=tr.count;let sr;if(er=="DEFAULT"){sr=new Uint8Array(nr*3);for(let ar=0;ar<ir.length;ar+=3){const or=defaultEncode(ir[ar],ir[ar+1],ir[ar+2],1);sr[ar+0]=or[0],sr[ar+1]=or[1],sr[ar+2]=or[2]}rr.setAttribute("normal",new BufferAttribute(sr,3,!0)),rr.attributes.normal.bytes=sr.length*1}else if(er=="OCT1Byte"){sr=new Int8Array(nr*2);for(let ar=0;ar<ir.length;ar+=3){const or=octEncodeBest(ir[ar],ir[ar+1],ir[ar+2],1);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}rr.setAttribute("normal",new BufferAttribute(sr,2,!0)),rr.attributes.normal.bytes=sr.length*1}else if(er=="OCT2Byte"){sr=new Int16Array(nr*2);for(let ar=0;ar<ir.length;ar+=3){const or=octEncodeBest(ir[ar],ir[ar+1],ir[ar+2],2);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}rr.setAttribute("normal",new BufferAttribute(sr,2,!0)),rr.attributes.normal.bytes=sr.length*2}else if(er=="ANGLES"){sr=new Uint16Array(nr*2);for(let ar=0;ar<ir.length;ar+=3){const or=anglesEncode(ir[ar],ir[ar+1],ir[ar+2]);sr[ar/3*2+0]=or[0],sr[ar/3*2+1]=or[1]}rr.setAttribute("normal",new BufferAttribute(sr,2,!0)),rr.attributes.normal.bytes=sr.length*2}else console.error("Unrecognized encoding method, should be `DEFAULT` or `ANGLES` or `OCT`. ");rr.attributes.normal.needsUpdate=!0,rr.attributes.normal.isPacked=!0,rr.attributes.normal.packingMethod=er}function compressPositions(rr){const er=rr.attributes.position;if(er||console.error("Geometry must contain position attribute. "),er.isPacked)return;er.itemSize!=3&&console.error("position.itemSize is not 3, which cannot be packed. ");const tr=er.array,ir=2,sr=quantizedEncode(tr,ir).quantized;rr.boundingBox==null&&rr.computeBoundingBox(),rr.boundingSphere==null&&rr.computeBoundingSphere(),rr.setAttribute("position",new BufferAttribute(sr,3)),rr.attributes.position.isPacked=!0,rr.attributes.position.needsUpdate=!0,rr.attributes.position.bytes=sr.length*ir}function compressUvs(rr){const er=rr.attributes.uv;if(er||console.error("Geometry must contain uv attribute. "),er.isPacked)return;const tr={min:1/0,max:-1/0},ir=er.array;for(let sr=0;sr<ir.length;sr++)tr.min=Math.min(tr.min,ir[sr]),tr.max=Math.max(tr.max,ir[sr]);let nr;if(tr.min>=-1&&tr.max<=1){nr=new Uint16Array(ir.length);for(let sr=0;sr<ir.length;sr+=2){const ar=defaultEncode(ir[sr],ir[sr+1],0,2);nr[sr]=ar[0],nr[sr+1]=ar[1]}rr.setAttribute("uv",new BufferAttribute(nr,2,!0)),rr.attributes.uv.isPacked=!0,rr.attributes.uv.needsUpdate=!0,rr.attributes.uv.bytes=nr.length*2}else nr=quantizedEncodeUV(ir,2),rr.setAttribute("uv",new BufferAttribute(nr.quantized,2)),rr.attributes.uv.isPacked=!0,rr.attributes.uv.needsUpdate=!0,rr.attributes.uv.bytes=nr.quantized.length*2}function defaultEncode(rr,er,tr,ir){if(ir==1){const nr=Math.round((rr+1)*.5*255),sr=Math.round((er+1)*.5*255),ar=Math.round((tr+1)*.5*255);return new Uint8Array([nr,sr,ar])}else if(ir==2){const nr=Math.round((rr+1)*.5*65535),sr=Math.round((er+1)*.5*65535),ar=Math.round((tr+1)*.5*65535);return new Uint16Array([nr,sr,ar])}else console.error("number of bytes must be 1 or 2")}function anglesEncode(rr,er,tr){const ir=parseInt(.5*(1+Math.atan2(er,rr)/Math.PI)*65535),nr=parseInt(.5*(1+tr)*65535);return new Uint16Array([ir,nr])}function octEncodeBest(rr,er,tr,ir){let nr,sr,ar,or,lr;return ar=nr=cr(rr,er,tr,"floor","floor"),sr=ur(nr),lr=dr(rr,er,tr,sr),nr=cr(rr,er,tr,"ceil","floor"),sr=ur(nr),or=dr(rr,er,tr,sr),or>lr&&(ar=nr,lr=or),nr=cr(rr,er,tr,"floor","ceil"),sr=ur(nr),or=dr(rr,er,tr,sr),or>lr&&(ar=nr,lr=or),nr=cr(rr,er,tr,"ceil","ceil"),sr=ur(nr),or=dr(rr,er,tr,sr),or>lr&&(ar=nr),ar;function cr(hr,pr,gr,vr,mr){let fr=hr/(Math.abs(hr)+Math.abs(pr)+Math.abs(gr)),_r=pr/(Math.abs(hr)+Math.abs(pr)+Math.abs(gr));if(tr<0){const Ar=(1-Math.abs(_r))*(fr>=0?1:-1),yr=(1-Math.abs(fr))*(_r>=0?1:-1);fr=Ar,_r=yr;let wr=1-Math.abs(fr)-Math.abs(_r);wr>0&&(wr+=.001,fr+=fr>0?wr/2:-wr/2,_r+=_r>0?wr/2:-wr/2)}if(ir==1)return new Int8Array([Math[vr](fr*127.5+(fr<0?1:0)),Math[mr](_r*127.5+(_r<0?1:0))]);if(ir==2)return new Int16Array([Math[vr](fr*32767.5+(fr<0?1:0)),Math[mr](_r*32767.5+(_r<0?1:0))])}function ur(hr){let pr=hr[0],gr=hr[1];ir==1?(pr/=pr<0?127:128,gr/=gr<0?127:128):ir==2&&(pr/=pr<0?32767:32768,gr/=gr<0?32767:32768);const vr=1-Math.abs(pr)-Math.abs(gr);if(vr<0){const fr=pr;pr=(1-Math.abs(gr))*(pr>=0?1:-1),gr=(1-Math.abs(fr))*(gr>=0?1:-1)}const mr=Math.sqrt(pr*pr+gr*gr+vr*vr);return[pr/mr,gr/mr,vr/mr]}function dr(hr,pr,gr,vr){return hr*vr[0]+pr*vr[1]+gr*vr[2]}}function quantizedEncode(rr,er){let tr,ir;er==1?(tr=new Uint8Array(rr.length),ir=255):er==2?(tr=new Uint16Array(rr.length),ir=65535):console.error("number of bytes error! ");const nr=new Matrix4,sr=new Float32Array(3),ar=new Float32Array(3);sr[0]=sr[1]=sr[2]=Number.MAX_VALUE,ar[0]=ar[1]=ar[2]=-Number.MAX_VALUE;for(let lr=0;lr<rr.length;lr+=3)sr[0]=Math.min(sr[0],rr[lr+0]),sr[1]=Math.min(sr[1],rr[lr+1]),sr[2]=Math.min(sr[2],rr[lr+2]),ar[0]=Math.max(ar[0],rr[lr+0]),ar[1]=Math.max(ar[1],rr[lr+1]),ar[2]=Math.max(ar[2],rr[lr+2]);nr.scale(new Vector3$1((ar[0]-sr[0])/ir,(ar[1]-sr[1])/ir,(ar[2]-sr[2])/ir)),nr.elements[12]=sr[0],nr.elements[13]=sr[1],nr.elements[14]=sr[2],nr.transpose();const or=new Float32Array([ar[0]!==sr[0]?ir/(ar[0]-sr[0]):0,ar[1]!==sr[1]?ir/(ar[1]-sr[1]):0,ar[2]!==sr[2]?ir/(ar[2]-sr[2]):0]);for(let lr=0;lr<rr.length;lr+=3)tr[lr+0]=Math.floor((rr[lr+0]-sr[0])*or[0]),tr[lr+1]=Math.floor((rr[lr+1]-sr[1])*or[1]),tr[lr+2]=Math.floor((rr[lr+2]-sr[2])*or[2]);return{quantized:tr,decodeMat:nr}}function quantizedEncodeUV(rr,er){let tr,ir;er==1?(tr=new Uint8Array(rr.length),ir=255):er==2?(tr=new Uint16Array(rr.length),ir=65535):console.error("number of bytes error! ");const nr=new Matrix3,sr=new Float32Array(2),ar=new Float32Array(2);sr[0]=sr[1]=Number.MAX_VALUE,ar[0]=ar[1]=-Number.MAX_VALUE;for(let lr=0;lr<rr.length;lr+=2)sr[0]=Math.min(sr[0],rr[lr+0]),sr[1]=Math.min(sr[1],rr[lr+1]),ar[0]=Math.max(ar[0],rr[lr+0]),ar[1]=Math.max(ar[1],rr[lr+1]);nr.scale((ar[0]-sr[0])/ir,(ar[1]-sr[1])/ir),nr.elements[6]=sr[0],nr.elements[7]=sr[1],nr.transpose();const or=new Float32Array([ar[0]!==sr[0]?ir/(ar[0]-sr[0]):0,ar[1]!==sr[1]?ir/(ar[1]-sr[1]):0]);for(let lr=0;lr<rr.length;lr+=2)tr[lr+0]=Math.floor((rr[lr+0]-sr[0])*or[0]),tr[lr+1]=Math.floor((rr[lr+1]-sr[1])*or[1]);return{quantized:tr,decodeMat:nr}}const GeometryCompressionUtils$1=Object.freeze(Object.defineProperty({__proto__:null,compressNormals,compressPositions,compressUvs},Symbol.toStringTag,{value:"Module"}));function hilbert2D(rr=new Vector3$1(0,0,0),er=10,tr=1,ir=0,nr=1,sr=2,ar=3){const or=er/2,lr=[new Vector3$1(rr.x-or,rr.y,rr.z-or),new Vector3$1(rr.x-or,rr.y,rr.z+or),new Vector3$1(rr.x+or,rr.y,rr.z+or),new Vector3$1(rr.x+or,rr.y,rr.z-or)],cr=[lr[ir],lr[nr],lr[sr],lr[ar]];return 0<=--tr?[...hilbert2D(cr[0],or,tr,ir,ar,sr,nr),...hilbert2D(cr[1],or,tr,ir,nr,sr,ar),...hilbert2D(cr[2],or,tr,ir,nr,sr,ar),...hilbert2D(cr[3],or,tr,sr,nr,ir,ar)]:cr}function hilbert3D(rr=new Vector3$1(0,0,0),er=10,tr=1,ir=0,nr=1,sr=2,ar=3,or=4,lr=5,cr=6,ur=7){const dr=er/2,hr=[new Vector3$1(rr.x-dr,rr.y+dr,rr.z-dr),new Vector3$1(rr.x-dr,rr.y+dr,rr.z+dr),new Vector3$1(rr.x-dr,rr.y-dr,rr.z+dr),new Vector3$1(rr.x-dr,rr.y-dr,rr.z-dr),new Vector3$1(rr.x+dr,rr.y-dr,rr.z-dr),new Vector3$1(rr.x+dr,rr.y-dr,rr.z+dr),new Vector3$1(rr.x+dr,rr.y+dr,rr.z+dr),new Vector3$1(rr.x+dr,rr.y+dr,rr.z-dr)],pr=[hr[ir],hr[nr],hr[sr],hr[ar],hr[or],hr[lr],hr[cr],hr[ur]];return--tr>=0?[...hilbert3D(pr[0],dr,tr,ir,ar,or,ur,cr,lr,sr,nr),...hilbert3D(pr[1],dr,tr,ir,ur,cr,nr,sr,lr,or,ar),...hilbert3D(pr[2],dr,tr,ir,ur,cr,nr,sr,lr,or,ar),...hilbert3D(pr[3],dr,tr,sr,ar,ir,nr,cr,ur,or,lr),...hilbert3D(pr[4],dr,tr,sr,ar,ir,nr,cr,ur,or,lr),...hilbert3D(pr[5],dr,tr,or,ar,sr,lr,cr,nr,ir,ur),...hilbert3D(pr[6],dr,tr,or,ar,sr,lr,cr,nr,ir,ur),...hilbert3D(pr[7],dr,tr,cr,lr,sr,nr,ir,ar,or,ur)]:pr}function gosper(rr=1){function er(sr){let ar,or=sr.axiom;for(let lr=0,cr=sr.steps;0<=cr?lr<cr:lr>cr;0<=cr?lr++:lr--){ar="";for(let ur=0,dr=or.length;ur<dr;ur++){const hr=or[ur];hr in sr.rules?ar+=sr.rules[hr]:ar+=hr}or=ar}return ar}function tr(sr){let ar=0,or=0,lr=0;const cr=[0,0,0],ur=sr.fractal;for(let dr=0,hr=ur.length;dr<hr;dr++){const pr=ur[dr];pr==="+"?lr+=sr.angle:pr==="-"?lr-=sr.angle:pr==="F"&&(ar+=sr.size*Math.cos(lr),or+=-sr.size*Math.sin(lr),cr.push(ar,or,0))}return cr}const ir=er({axiom:"A",steps:4,rules:{A:"A+BF++BF-FA--FAFA-BF+",B:"-FA+BFBF++BF+FA--FA-B"}});return tr({fractal:ir,size:rr,angle:Math.PI/3})}const GeometryUtils$1=Object.freeze(Object.defineProperty({__proto__:null,gosper,hilbert2D,hilbert3D},Symbol.toStringTag,{value:"Module"}));class LDrawUtils{static mergeObject(er){function tr(pr,gr,vr,mr){const fr=new BufferGeometry,_r=pr.getAttribute("position").array,Ar=vr===3?pr.getAttribute("normal").array:null,yr=Math.min(gr.count,Math.floor(_r.length/3)-gr.start),wr=gr.start*3,xr=(gr.start+yr)*3,Sr=_r.subarray(wr,xr),br=Ar!==null?Ar.subarray(wr,xr):null;if(fr.setAttribute("position",new BufferAttribute(Sr,3)),br!==null&&fr.setAttribute("normal",new BufferAttribute(br,3)),mr){const Cr=pr.getAttribute("control0").array.subarray(wr,xr),Ir=pr.getAttribute("control1").array.subarray(wr,xr),Rr=pr.getAttribute("direction").array.subarray(wr,xr);fr.setAttribute("control0",new BufferAttribute(Cr,3,!1)),fr.setAttribute("control1",new BufferAttribute(Ir,3,!1)),fr.setAttribute("direction",new BufferAttribute(Rr,3,!1))}return fr}function ir(pr,gr,vr){const mr=vr[pr.uuid];mr?mr.arr.push(gr):vr[pr.uuid]={mat:pr,arr:[gr]}}function nr(pr,gr){if(!pr)return;const vr=pr.array,mr=Math.floor(vr.length/3);let fr=0;for(let _r=0;_r<mr;_r++){const Ar=vr[fr],yr=vr[fr+1],wr=vr[fr+2];vr[fr]=vr[fr+3],vr[fr+1]=vr[fr+4],vr[fr+2]=vr[fr+5],vr[fr+3]=Ar,vr[fr+4]=yr,vr[fr+5]=wr,fr+=gr*3}}const sr={},ar={},or={};er.updateMatrixWorld(!0);const lr=new Matrix3;er.traverse(pr=>{if(pr.isMesh|pr.isLineSegments){const gr=pr.isMesh?3:2,vr=pr.geometry.clone();pr.matrixWorld.determinant()<0&&(nr(vr.attributes.position,gr),nr(vr.attributes.normal,gr)),vr.applyMatrix4(pr.matrixWorld),pr.isConditionalLine&&(vr.attributes.control0.applyMatrix4(pr.matrixWorld),vr.attributes.control1.applyMatrix4(pr.matrixWorld),lr.getNormalMatrix(pr.matrixWorld),vr.attributes.direction.applyNormalMatrix(lr));const fr=pr.isMesh?sr:pr.isConditionalLine?or:ar;if(Array.isArray(pr.material))for(const _r in vr.groups){const Ar=vr.groups[_r],yr=pr.material[Ar.materialIndex],wr=tr(vr,Ar,gr,pr.isConditionalLine);ir(yr,wr,fr)}else ir(pr.material,vr,fr)}});const cr=new Group,ur=Object.keys(sr);for(const pr of ur){const gr=sr[pr],vr=mergeGeometries(gr.arr);cr.add(new Mesh(vr,gr.mat))}const dr=Object.keys(ar);for(const pr of dr){const gr=ar[pr],vr=mergeGeometries(gr.arr);cr.add(new LineSegments(vr,gr.mat))}const hr=Object.keys(or);for(const pr of hr){const gr=or[pr],vr=mergeGeometries(gr.arr),mr=new LineSegments(vr,gr.mat);mr.isConditionalLine=!0,cr.add(mr)}return cr.userData.constructionStep=0,cr.userData.numConstructionSteps=1,cr}}const _color$1=new Color,_matrix$2=new Matrix4;function createMeshesFromInstancedMesh(rr){const er=new Group,tr=rr.count,ir=rr.geometry,nr=rr.material;for(let sr=0;sr<tr;sr++){const ar=new Mesh(ir,nr);rr.getMatrixAt(sr,ar.matrix),ar.matrix.decompose(ar.position,ar.quaternion,ar.scale),er.add(ar)}return er.copy(rr),er.updateMatrixWorld(),er}function createMeshesFromMultiMaterialMesh(rr){if(Array.isArray(rr.material)===!1)return console.warn("THREE.SceneUtils.createMeshesFromMultiMaterialMesh(): The given mesh has no multiple materials."),rr;const er=new Group;er.copy(rr);const tr=mergeGroups(rr.geometry),ir=tr.index,nr=tr.groups,sr=Object.keys(tr.attributes);for(let ar=0;ar<nr.length;ar++){const or=nr[ar],lr=or.start,cr=lr+or.count,ur=new BufferGeometry,dr=rr.material[or.materialIndex];for(let pr=0;pr<sr.length;pr++){const gr=sr[pr],vr=tr.attributes[gr],mr=vr.itemSize,fr=or.count*mr,_r=vr.array.constructor,Ar=new _r(fr),yr=new BufferAttribute(Ar,mr);for(let wr=lr,xr=0;wr<cr;wr++,xr++){const Sr=ir.getX(wr);mr>=1&&yr.setX(xr,vr.getX(Sr)),mr>=2&&yr.setY(xr,vr.getY(Sr)),mr>=3&&yr.setZ(xr,vr.getZ(Sr)),mr>=4&&yr.setW(xr,vr.getW(Sr))}ur.setAttribute(gr,yr)}const hr=new Mesh(ur,dr);er.add(hr)}return er}function createMultiMaterialObject(rr,er){const tr=new Group;for(let ir=0,nr=er.length;ir<nr;ir++)tr.add(new Mesh(rr,er[ir]));return tr}function reduceVertices(rr,er,tr){let ir=tr;const nr=new Vector3$1;return rr.updateWorldMatrix(!0,!0),rr.traverseVisible(sr=>{const{geometry:ar}=sr;if(ar!==void 0){const{position:or}=ar.attributes;if(or!==void 0)for(let lr=0,cr=or.count;lr<cr;lr++)sr.isMesh?sr.getVertexPosition(lr,nr):nr.fromBufferAttribute(or,lr),sr.isSkinnedMesh||nr.applyMatrix4(sr.matrixWorld),ir=er(ir,nr)}}),ir}function sortInstancedMesh(rr,er){const tr=deepCloneAttribute(rr.instanceMatrix),ir=rr.instanceColor?deepCloneAttribute(rr.instanceColor):null,nr=new Map;for(const ar in rr.geometry.attributes){const or=rr.geometry.attributes[ar];or.isInstancedBufferAttribute&&nr.set(or,deepCloneAttribute(or))}const sr=[];for(let ar=0;ar<rr.count;ar++)sr.push(ar);sr.sort(er);for(let ar=0;ar<sr.length;ar++){const or=sr[ar];_matrix$2.fromArray(tr.array,or*rr.instanceMatrix.itemSize),_matrix$2.toArray(rr.instanceMatrix.array,ar*rr.instanceMatrix.itemSize),rr.instanceColor&&(_color$1.fromArray(ir.array,or*rr.instanceColor.itemSize),_color$1.toArray(rr.instanceColor.array,ar*rr.instanceColor.itemSize));for(const lr in rr.geometry.attributes){const cr=rr.geometry.attributes[lr];if(cr.isInstancedBufferAttribute){const ur=nr.get(cr);cr.setX(ar,ur.getX(or)),cr.itemSize>1&&cr.setY(ar,ur.getY(or)),cr.itemSize>2&&cr.setZ(ar,ur.getZ(or)),cr.itemSize>3&&cr.setW(ar,ur.getW(or))}}}}function*traverseGenerator(rr){yield rr;const er=rr.children;for(let tr=0,ir=er.length;tr<ir;tr++)yield*traverseGenerator(er[tr])}function*traverseVisibleGenerator(rr){if(rr.visible===!1)return;yield rr;const er=rr.children;for(let tr=0,ir=er.length;tr<ir;tr++)yield*traverseVisibleGenerator(er[tr])}function*traverseAncestorsGenerator(rr){const er=rr.parent;er!==null&&(yield er,yield*traverseAncestorsGenerator(er))}const SceneUtils$1=Object.freeze(Object.defineProperty({__proto__:null,createMeshesFromInstancedMesh,createMeshesFromMultiMaterialMesh,createMultiMaterialObject,reduceVertices,sortInstancedMesh,traverseAncestorsGenerator,traverseGenerator,traverseVisibleGenerator},Symbol.toStringTag,{value:"Module"}));class ShadowMapViewer{constructor(er){const tr=this,ir=er.name!==void 0&&er.name!=="";let nr;const sr={x:10,y:10,width:256,height:256},ar=new OrthographicCamera(window.innerWidth/-2,window.innerWidth/2,window.innerHeight/2,window.innerHeight/-2,1,10);ar.position.set(0,0,2);const or=new Scene,lr=UnpackDepthRGBAShader,cr=UniformsUtils.clone(lr.uniforms),ur=new ShaderMaterial({uniforms:cr,vertexShader:lr.vertexShader,fragmentShader:lr.fragmentShader}),dr=new PlaneGeometry(sr.width,sr.height),hr=new Mesh(dr,ur);or.add(hr);let pr,gr;if(ir){pr=document.createElement("canvas");const mr=pr.getContext("2d");mr.font="Bold 20px Arial";const fr=mr.measureText(er.name).width;pr.width=fr,pr.height=25,mr.font="Bold 20px Arial",mr.fillStyle="rgba( 255, 0, 0, 1 )",mr.fillText(er.name,0,20);const _r=new CanvasTexture(pr),Ar=new MeshBasicMaterial({map:_r,side:DoubleSide,transparent:!0}),yr=new PlaneGeometry(pr.width,pr.height);gr=new Mesh(yr,Ar),or.add(gr)}function vr(){tr.position.set(tr.position.x,tr.position.y)}this.enabled=!0,this.size={width:sr.width,height:sr.height,set:function(mr,fr){this.width=mr,this.height=fr,hr.scale.set(this.width/sr.width,this.height/sr.height,1),vr()}},this.position={x:sr.x,y:sr.y,set:function(mr,fr){this.x=mr,this.y=fr;const _r=tr.size.width,Ar=tr.size.height;hr.position.set(-window.innerWidth/2+_r/2+this.x,window.innerHeight/2-Ar/2-this.y,0),ir&&gr.position.set(hr.position.x,hr.position.y-tr.size.height/2+pr.height/2,0)}},this.render=function(mr){this.enabled&&(cr.tDiffuse.value=er.shadow.map.texture,nr=mr.autoClear,mr.autoClear=!1,mr.clearDepth(),mr.render(or,ar),mr.autoClear=nr)},this.updateForWindowResize=function(){this.enabled&&(ar.left=window.innerWidth/-2,ar.right=window.innerWidth/2,ar.top=window.innerHeight/2,ar.bottom=window.innerHeight/-2,ar.updateProjectionMatrix(),this.update())},this.update=function(){this.position.set(this.position.x,this.position.y),this.size.set(this.size.width,this.size.height)},this.update()}}function getBoneName(rr,er){return er.getBoneName!==void 0?er.getBoneName(rr):er.names[rr.name]}function retarget(rr,er,tr={}){const ir=new Quaternion$1,nr=new Vector3$1,sr=new Matrix4,ar=new Matrix4;tr.preserveBoneMatrix=tr.preserveBoneMatrix!==void 0?tr.preserveBoneMatrix:!0,tr.preserveBonePositions=tr.preserveBonePositions!==void 0?tr.preserveBonePositions:!0,tr.useTargetMatrix=tr.useTargetMatrix!==void 0?tr.useTargetMatrix:!1,tr.hip=tr.hip!==void 0?tr.hip:"hip",tr.hipInfluence=tr.hipInfluence!==void 0?tr.hipInfluence:new Vector3$1(1,1,1),tr.scale=tr.scale!==void 0?tr.scale:1,tr.names=tr.names||{};const or=er.isObject3D?er.skeleton.bones:getBones(er),lr=rr.isObject3D?rr.skeleton.bones:getBones(rr);let cr,ur,dr,hr;if(rr.isObject3D?rr.skeleton.pose():(tr.useTargetMatrix=!0,tr.preserveBoneMatrix=!1),tr.preserveBonePositions){hr=[];for(let pr=0;pr<lr.length;pr++)hr.push(lr[pr].position.clone())}if(tr.preserveBoneMatrix){rr.updateMatrixWorld(),rr.matrixWorld.identity();for(let pr=0;pr<rr.children.length;++pr)rr.children[pr].updateMatrixWorld(!0)}for(let pr=0;pr<lr.length;++pr)cr=lr[pr],ur=getBoneName(cr,tr),dr=getBoneByName(ur,or),ar.copy(cr.matrixWorld),dr&&(dr.updateMatrixWorld(),tr.useTargetMatrix?sr.copy(dr.matrixWorld):(sr.copy(rr.matrixWorld).invert(),sr.multiply(dr.matrixWorld)),nr.setFromMatrixScale(sr),sr.scale(nr.set(1/nr.x,1/nr.y,1/nr.z)),ar.makeRotationFromQuaternion(ir.setFromRotationMatrix(sr)),rr.isObject3D&&tr.localOffsets&&tr.localOffsets[cr.name]&&ar.multiply(tr.localOffsets[cr.name]),ar.copyPosition(sr)),ur===tr.hip&&(ar.elements[12]*=tr.scale*tr.hipInfluence.x,ar.elements[13]*=tr.scale*tr.hipInfluence.y,ar.elements[14]*=tr.scale*tr.hipInfluence.z,tr.hipPosition!==void 0&&(ar.elements[12]+=tr.hipPosition.x*tr.scale,ar.elements[13]+=tr.hipPosition.y*tr.scale,ar.elements[14]+=tr.hipPosition.z*tr.scale)),cr.parent?(cr.matrix.copy(cr.parent.matrixWorld).invert(),cr.matrix.multiply(ar)):cr.matrix.copy(ar),cr.matrix.decompose(cr.position,cr.quaternion,cr.scale),cr.updateMatrixWorld();if(tr.preserveBonePositions)for(let pr=0;pr<lr.length;++pr)cr=lr[pr],ur=getBoneName(cr,tr)||cr.name,ur!==tr.hip&&cr.position.copy(hr[pr]);tr.preserveBoneMatrix&&rr.updateMatrixWorld(!0)}function retargetClip(rr,er,tr,ir={}){ir.useFirstFramePosition=ir.useFirstFramePosition!==void 0?ir.useFirstFramePosition:!1,ir.fps=ir.fps!==void 0?ir.fps:Math.max(...tr.tracks.map(fr=>fr.times.length))/tr.duration,ir.names=ir.names||[],er.isObject3D||(er=getHelperFromSkeleton(er));const nr=Math.round(tr.duration*(ir.fps/1e3)*1e3),sr=tr.duration/(nr-1),ar=[],or=new AnimationMixer(er),lr=getBones(rr.skeleton),cr=[];let ur,dr,hr,pr,gr;or.clipAction(tr).play();let vr=0,mr=nr;ir.trim!==void 0?(vr=Math.round(ir.trim[0]*ir.fps),mr=Math.min(Math.round(ir.trim[1]*ir.fps),nr)-vr,or.update(ir.trim[0])):or.update(0),er.updateMatrixWorld();for(let fr=0;fr<mr;++fr){const _r=fr*sr;retarget(rr,er,ir);for(let Ar=0;Ar<lr.length;++Ar)dr=lr[Ar],gr=getBoneName(dr,ir)||dr.name,hr=getBoneByName(gr,er.skeleton),hr&&(pr=cr[Ar]=cr[Ar]||{bone:dr},ir.hip===gr&&(pr.pos||(pr.pos={times:new Float32Array(mr),values:new Float32Array(mr*3)}),ir.useFirstFramePosition&&(fr===0&&(ur=dr.position.clone()),dr.position.sub(ur)),pr.pos.times[fr]=_r,dr.position.toArray(pr.pos.values,fr*3)),pr.quat||(pr.quat={times:new Float32Array(mr),values:new Float32Array(mr*4)}),pr.quat.times[fr]=_r,dr.quaternion.toArray(pr.quat.values,fr*4));fr===mr-2?or.update(sr-1e-7):or.update(sr),er.updateMatrixWorld()}for(let fr=0;fr<cr.length;++fr)pr=cr[fr],pr&&(pr.pos&&ar.push(new VectorKeyframeTrack(".bones["+pr.bone.name+"].position",pr.pos.times,pr.pos.values)),ar.push(new QuaternionKeyframeTrack(".bones["+pr.bone.name+"].quaternion",pr.quat.times,pr.quat.values)));return or.uncacheAction(tr),new AnimationClip(tr.name,-1,ar)}function clone(rr){const er=new Map,tr=new Map,ir=rr.clone();return parallelTraverse(rr,ir,function(nr,sr){er.set(sr,nr),tr.set(nr,sr)}),ir.traverse(function(nr){if(!nr.isSkinnedMesh)return;const sr=nr,ar=er.get(nr),or=ar.skeleton.bones;sr.skeleton=ar.skeleton.clone(),sr.bindMatrix.copy(ar.bindMatrix),sr.skeleton.bones=or.map(function(lr){return tr.get(lr)}),sr.bind(sr.skeleton,sr.bindMatrix)}),ir}function getBoneByName(rr,er){for(let tr=0,ir=getBones(er);tr<ir.length;tr++)if(rr===ir[tr].name)return ir[tr]}function getBones(rr){return Array.isArray(rr)?rr:rr.bones}function getHelperFromSkeleton(rr){const er=new SkeletonHelper(rr.bones[0]);return er.skeleton=rr,er}function parallelTraverse(rr,er,tr){tr(rr,er);for(let ir=0;ir<rr.children.length;ir++)parallelTraverse(rr.children[ir],er.children[ir],tr)}const SkeletonUtils$1=Object.freeze(Object.defineProperty({__proto__:null,clone,retarget,retargetClip},Symbol.toStringTag,{value:"Module"})),POWER=3,BIT_MAX=32,BIN_BITS=1<<POWER,BIN_SIZE=1<<BIN_BITS,BIN_MAX=BIN_SIZE-1,ITERATIONS=BIT_MAX/BIN_BITS,bins=new Array(ITERATIONS),bins_buffer=new ArrayBuffer((ITERATIONS+1)*BIN_SIZE*4);let c$1=0;for(let rr=0;rr<ITERATIONS+1;rr++)bins[rr]=new Uint32Array(bins_buffer,c$1,BIN_SIZE),c$1+=BIN_SIZE*4;const defaultGet=rr=>rr,radixSort=(rr,er)=>{const tr=rr.length,ir=er||{},nr=ir.aux||new rr.constructor(tr),sr=ir.get||defaultGet,ar=[rr,nr];let or,lr,cr;ir.reversed?(or=(hr,pr)=>hr<pr,lr=hr=>{for(let pr=BIN_SIZE-2;pr>=0;pr--)hr[pr]+=hr[pr+1]},cr=(hr,pr,gr)=>{let vr=0;for(let mr=BIN_MAX;mr>=0;mr--){const fr=hr[mr],_r=fr-vr;_r!=0&&(_r>32?dr(pr+1,gr+vr,_r):ur(pr+1,gr+vr,_r),vr=fr)}}):(or=(hr,pr)=>hr>pr,lr=hr=>{for(let pr=1;pr<BIN_SIZE;pr++)hr[pr]+=hr[pr-1]},cr=(hr,pr,gr)=>{let vr=0;for(let mr=0;mr<BIN_SIZE;mr++){const fr=hr[mr],_r=fr-vr;_r!=0&&(_r>32?dr(pr+1,gr+vr,_r):ur(pr+1,gr+vr,_r),vr=fr)}});const ur=(hr,pr,gr)=>{const vr=ar[hr&1],mr=ar[hr+1&1];for(let fr=pr+1;fr<pr+gr;fr++){const _r=vr[fr],Ar=sr(_r)>>>0;let yr=fr;for(;yr>pr&&or(sr(vr[yr-1])>>>0,Ar);)vr[yr]=vr[--yr];vr[yr]=_r}if((hr&1)==1)for(let fr=pr;fr<pr+gr;fr++)mr[fr]=vr[fr]},dr=(hr,pr,gr)=>{const vr=ar[hr&1],mr=ar[hr+1&1],fr=3-hr<<POWER,_r=pr+gr,Ar=bins[hr],yr=bins[hr+1];yr.fill(0);for(let wr=pr;wr<_r;wr++)yr[sr(vr[wr])>>>fr&BIN_MAX]++;lr(yr),Ar.set(yr);for(let wr=_r-1;wr>=pr;wr--)mr[pr+--yr[sr(vr[wr])>>>fr&BIN_MAX]]=vr[wr];hr!=ITERATIONS-1&&cr(Ar,hr,pr)};dr(0,0,tr)},SortUtils$1=Object.freeze(Object.defineProperty({__proto__:null,radixSort},Symbol.toStringTag,{value:"Module"}));let _renderer,fullscreenQuadGeometry,fullscreenQuadMaterial,fullscreenQuad;function decompress(rr,er=1/0,tr=null){fullscreenQuadGeometry||(fullscreenQuadGeometry=new PlaneGeometry(2,2,1,1)),fullscreenQuadMaterial||(fullscreenQuadMaterial=new ShaderMaterial({uniforms:{blitTexture:new Uniform(rr)},vertexShader:`
			varying vec2 vUv;
			void main(){
				vUv = uv;
				gl_Position = vec4(position.xy * 1.0,0.,.999999);
			}`,fragmentShader:`
			uniform sampler2D blitTexture; 
			varying vec2 vUv;

			void main(){ 
				gl_FragColor = vec4(vUv.xy, 0, 1);
				
				#ifdef IS_SRGB
				gl_FragColor = sRGBTransferOETF( texture2D( blitTexture, vUv) );
				#else
				gl_FragColor = texture2D( blitTexture, vUv);
				#endif
			}`})),fullscreenQuadMaterial.uniforms.blitTexture.value=rr,fullscreenQuadMaterial.defines.IS_SRGB=rr.colorSpace==SRGBColorSpace,fullscreenQuadMaterial.needsUpdate=!0,fullscreenQuad||(fullscreenQuad=new Mesh(fullscreenQuadGeometry,fullscreenQuadMaterial),fullscreenQuad.frustumCulled=!1);const ir=new PerspectiveCamera,nr=new Scene;nr.add(fullscreenQuad),tr===null&&(tr=_renderer=new WebGLRenderer({antialias:!1}));const sr=Math.min(rr.image.width,er),ar=Math.min(rr.image.height,er);tr.setSize(sr,ar),tr.clear(),tr.render(nr,ir);const or=document.createElement("canvas"),lr=or.getContext("2d");or.width=sr,or.height=ar,lr.drawImage(tr.domElement,0,0,sr,ar);const cr=new CanvasTexture(or);return cr.minFilter=rr.minFilter,cr.magFilter=rr.magFilter,cr.wrapS=rr.wrapS,cr.wrapT=rr.wrapT,cr.colorSpace=rr.colorSpace,cr.name=rr.name,_renderer&&(_renderer.forceContextLoss(),_renderer.dispose(),_renderer=null),cr}function UVsDebug(rr,er=1024){const tr="abc",ir=new Vector2,nr=new Vector2,sr=[new Vector2,new Vector2,new Vector2],ar=[],or=document.createElement("canvas"),lr=er,cr=er;or.width=lr,or.height=cr;const ur=or.getContext("2d");ur.lineWidth=1,ur.strokeStyle="rgb( 63, 63, 63 )",ur.textAlign="center",ur.fillStyle="rgb( 255, 255, 255 )",ur.fillRect(0,0,lr,cr);const dr=rr.index,hr=rr.attributes.uv;if(dr)for(let gr=0,vr=dr.count;gr<vr;gr+=3)ar[0]=dr.getX(gr),ar[1]=dr.getX(gr+1),ar[2]=dr.getX(gr+2),sr[0].fromBufferAttribute(hr,ar[0]),sr[1].fromBufferAttribute(hr,ar[1]),sr[2].fromBufferAttribute(hr,ar[2]),pr(ar,sr,gr/3);else for(let gr=0,vr=hr.count;gr<vr;gr+=3)ar[0]=gr,ar[1]=gr+1,ar[2]=gr+2,sr[0].fromBufferAttribute(hr,ar[0]),sr[1].fromBufferAttribute(hr,ar[1]),sr[2].fromBufferAttribute(hr,ar[2]),pr(ar,sr,gr/3);return or;function pr(gr,vr,mr){ur.beginPath(),ir.set(0,0);for(let fr=0,_r=vr.length;fr<_r;fr++){const Ar=vr[fr];ir.x+=Ar.x,ir.y+=Ar.y,fr===0?ur.moveTo(Ar.x*(lr-2)+.5,(1-Ar.y)*(cr-2)+.5):ur.lineTo(Ar.x*(lr-2)+.5,(1-Ar.y)*(cr-2)+.5)}ur.closePath(),ur.stroke(),ir.divideScalar(vr.length),ur.font="18px Arial",ur.fillStyle="rgb( 63, 63, 63 )",ur.fillText(mr,ir.x*lr,(1-ir.y)*cr),ir.x>.95&&ur.fillText(mr,ir.x%1*lr,(1-ir.y)*cr),ur.font="12px Arial",ur.fillStyle="rgb( 191, 191, 191 )";for(let fr=0,_r=vr.length;fr<_r;fr++){const Ar=vr[fr];nr.addVectors(ir,Ar).divideScalar(2);const yr=gr[fr];ur.fillText(tr[fr]+yr,nr.x*lr,(1-nr.y)*cr),nr.x>.95&&ur.fillText(tr[fr]+yr,nr.x%1*lr,(1-nr.y)*cr)}}}class ARButton{static createButton(er,tr={}){const ir=document.createElement("button");function nr(){if(tr.domOverlay===void 0){const hr=document.createElement("div");hr.style.display="none",document.body.appendChild(hr);const pr=document.createElementNS("http://www.w3.org/2000/svg","svg");pr.setAttribute("width",38),pr.setAttribute("height",38),pr.style.position="absolute",pr.style.right="20px",pr.style.top="20px",pr.addEventListener("click",function(){cr.end()}),hr.appendChild(pr);const gr=document.createElementNS("http://www.w3.org/2000/svg","path");gr.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),gr.setAttribute("stroke","#fff"),gr.setAttribute("stroke-width",2),pr.appendChild(gr),tr.optionalFeatures===void 0&&(tr.optionalFeatures=[]),tr.optionalFeatures.push("dom-overlay"),tr.domOverlay={root:hr}}let cr=null;async function ur(hr){hr.addEventListener("end",dr),er.xr.setReferenceSpaceType("local"),await er.xr.setSession(hr),ir.textContent="STOP AR",tr.domOverlay.root.style.display="",cr=hr}function dr(){cr.removeEventListener("end",dr),ir.textContent="START AR",tr.domOverlay.root.style.display="none",cr=null}ir.style.display="",ir.style.cursor="pointer",ir.style.left="calc(50% - 50px)",ir.style.width="100px",ir.textContent="START AR",ir.onmouseenter=function(){ir.style.opacity="1.0"},ir.onmouseleave=function(){ir.style.opacity="0.5"},ir.onclick=function(){cr===null?navigator.xr.requestSession("immersive-ar",tr).then(ur):(cr.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-ar",tr).then(ur).catch(hr=>{console.warn(hr)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-ar",tr).then(ur).catch(hr=>{console.warn(hr)})}function sr(){ir.style.display="",ir.style.cursor="auto",ir.style.left="calc(50% - 75px)",ir.style.width="150px",ir.onmouseenter=null,ir.onmouseleave=null,ir.onclick=null}function ar(){sr(),ir.textContent="AR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),ir.textContent="AR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return ir.id="ARButton",ir.style.display="none",lr(ir),navigator.xr.isSessionSupported("immersive-ar").then(function(cr){cr?nr():ar()}).catch(or),ir;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}}const DEFAULT_HAND_PROFILE_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/";class XRHandMeshModel{constructor(er,tr,ir,nr,sr=null,ar=null){this.controller=tr,this.handModel=er,this.bones=[],sr===null&&(sr=new GLTFLoader,sr.setPath(ir||DEFAULT_HAND_PROFILE_PATH)),sr.load(`${nr}.glb`,or=>{const lr=or.scene.children[0];this.handModel.add(lr);const cr=lr.getObjectByProperty("type","SkinnedMesh");cr.frustumCulled=!1,cr.castShadow=!0,cr.receiveShadow=!0,["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach(dr=>{const hr=lr.getObjectByName(dr);hr!==void 0?hr.jointName=dr:console.warn(`Couldn't find ${dr} in ${nr} hand mesh`),this.bones.push(hr)}),ar&&ar(lr)})}updateMesh(){const er=this.controller.joints;for(let tr=0;tr<this.bones.length;tr++){const ir=this.bones[tr];if(ir){const nr=er[ir.jointName];if(nr.visible){const sr=nr.position;ir.position.copy(sr),ir.quaternion.copy(nr.quaternion)}}}}}const TOUCH_RADIUS=.01,POINTING_JOINT="index-finger-tip";class OculusHandModel extends Object3D{constructor(er,tr=null,ir=null){super(),this.controller=er,this.motionController=null,this.envMap=null,this.loader=tr,this.onLoad=ir,this.mesh=null,er.addEventListener("connected",nr=>{const sr=nr.data;sr.hand&&!this.motionController&&(this.xrInputSource=sr,this.motionController=new XRHandMeshModel(this,er,this.path,sr.handedness,this.loader,this.onLoad))}),er.addEventListener("disconnected",()=>{this.clear(),this.motionController=null})}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&this.motionController.updateMesh()}getPointerPosition(){const er=this.controller.joints[POINTING_JOINT];return er?er.position:null}intersectBoxObject(er){const tr=this.getPointerPosition();if(tr){const ir=new Sphere(tr,TOUCH_RADIUS),nr=new Box3().setFromObject(er);return ir.intersectsBox(nr)}else return!1}checkButton(er){this.intersectBoxObject(er)?er.onPress():er.onClear(),er.isPressed()&&er.whilePressed()}}const PINCH_MAX=.05,PINCH_THRESHOLD=.02,PINCH_MIN=.01,POINTER_ADVANCE_MAX=.02,POINTER_OPACITY_MAX=1,POINTER_OPACITY_MIN=.4,POINTER_FRONT_RADIUS=.002,POINTER_REAR_RADIUS=.01,POINTER_REAR_RADIUS_MIN=.003,POINTER_LENGTH=.035,POINTER_SEGMENTS=16,POINTER_RINGS=12,POINTER_HEMISPHERE_ANGLE=110,YAXIS=new Vector3$1(0,1,0),ZAXIS=new Vector3$1(0,0,1),CURSOR_RADIUS=.02,CURSOR_MAX_DISTANCE=1.5;class OculusHandPointerModel extends Object3D{constructor(er,tr){super(),this.hand=er,this.controller=tr,this.motionController=null,this.envMap=null,this.mesh=null,this.pointerGeometry=null,this.pointerMesh=null,this.pointerObject=null,this.pinched=!1,this.attached=!1,this.cursorObject=null,this.raycaster=null,this._onConnected=this._onConnected.bind(this),this._onDisconnected=this._onDisconnected.bind(this),this.hand.addEventListener("connected",this._onConnected),this.hand.addEventListener("disconnected",this._onDisconnected)}_onConnected(er){const tr=er.data;tr.hand&&(this.visible=!0,this.xrInputSource=tr,this.createPointer())}_onDisconnected(){this.visible=!1,this.xrInputSource=null,this.pointerGeometry&&this.pointerGeometry.dispose(),this.pointerMesh&&this.pointerMesh.material&&this.pointerMesh.material.dispose(),this.clear()}_drawVerticesRing(er,tr,ir){const nr=tr.clone();for(let sr=0;sr<POINTER_SEGMENTS;sr++){nr.applyAxisAngle(ZAXIS,Math.PI*2/POINTER_SEGMENTS);const ar=ir*POINTER_SEGMENTS+sr;er[3*ar]=nr.x,er[3*ar+1]=nr.y,er[3*ar+2]=nr.z}}_updatePointerVertices(er){const tr=this.pointerGeometry.attributes.position.array,ir=new Vector3$1(POINTER_FRONT_RADIUS,0,-1*(POINTER_LENGTH-er));this._drawVerticesRing(tr,ir,0);const nr=new Vector3$1(Math.sin(Math.PI*POINTER_HEMISPHERE_ANGLE/180)*er,Math.cos(Math.PI*POINTER_HEMISPHERE_ANGLE/180)*er,0);for(let cr=0;cr<POINTER_RINGS;cr++)this._drawVerticesRing(tr,nr,cr+1),nr.applyAxisAngle(YAXIS,Math.PI*POINTER_HEMISPHERE_ANGLE/180/(POINTER_RINGS*-2));const sr=POINTER_SEGMENTS*(1+POINTER_RINGS),ar=POINTER_SEGMENTS*(1+POINTER_RINGS)+1,or=new Vector3$1(0,0,-1*(POINTER_LENGTH-er));tr[sr*3]=or.x,tr[sr*3+1]=or.y,tr[sr*3+2]=or.z;const lr=new Vector3$1(0,0,er);tr[ar*3]=lr.x,tr[ar*3+1]=lr.y,tr[ar*3+2]=lr.z,this.pointerGeometry.setAttribute("position",new Float32BufferAttribute(tr,3))}createPointer(){let er,tr;const ir=new Array(((POINTER_RINGS+1)*POINTER_SEGMENTS+2)*3).fill(0),nr=[];for(this.pointerGeometry=new BufferGeometry,this.pointerGeometry.setAttribute("position",new Float32BufferAttribute(ir,3)),this._updatePointerVertices(POINTER_REAR_RADIUS),er=0;er<POINTER_RINGS;er++){for(tr=0;tr<POINTER_SEGMENTS-1;tr++)nr.push(er*POINTER_SEGMENTS+tr,er*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr),nr.push(er*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr+1,(er+1)*POINTER_SEGMENTS+tr);nr.push((er+1)*POINTER_SEGMENTS-1,er*POINTER_SEGMENTS,(er+2)*POINTER_SEGMENTS-1),nr.push(er*POINTER_SEGMENTS,(er+1)*POINTER_SEGMENTS,(er+2)*POINTER_SEGMENTS-1)}const sr=POINTER_SEGMENTS*(1+POINTER_RINGS),ar=POINTER_SEGMENTS*(1+POINTER_RINGS)+1;for(er=0;er<POINTER_SEGMENTS-1;er++)nr.push(sr,er+1,er),nr.push(ar,er+POINTER_SEGMENTS*POINTER_RINGS,er+POINTER_SEGMENTS*POINTER_RINGS+1);nr.push(sr,0,POINTER_SEGMENTS-1),nr.push(ar,POINTER_SEGMENTS*(POINTER_RINGS+1)-1,POINTER_SEGMENTS*POINTER_RINGS);const or=new MeshBasicMaterial;or.transparent=!0,or.opacity=POINTER_OPACITY_MIN,this.pointerGeometry.setIndex(nr),this.pointerMesh=new Mesh(this.pointerGeometry,or),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS),this.pointerObject=new Object3D,this.pointerObject.add(this.pointerMesh),this.raycaster=new Raycaster;const lr=new SphereGeometry(CURSOR_RADIUS,10,10),cr=new MeshBasicMaterial;cr.transparent=!0,cr.opacity=POINTER_OPACITY_MIN,this.cursorObject=new Mesh(lr,cr),this.pointerObject.add(this.cursorObject),this.add(this.pointerObject)}_updateRaycaster(){if(this.raycaster){const er=this.pointerObject.matrixWorld,tr=new Matrix4;tr.identity().extractRotation(er),this.raycaster.ray.origin.setFromMatrixPosition(er),this.raycaster.ray.direction.set(0,0,-1).applyMatrix4(tr)}}_updatePointer(){this.pointerObject.visible=this.controller.visible;const er=this.hand.joints["index-finger-tip"],tr=this.hand.joints["thumb-tip"],ir=er.position.distanceTo(tr.position),nr=er.position.clone().add(tr.position).multiplyScalar(.5);this.pointerObject.position.copy(nr),this.pointerObject.quaternion.copy(this.controller.quaternion),this.pinched=ir<=PINCH_THRESHOLD;const sr=(ir-PINCH_MIN)/(PINCH_MAX-PINCH_MIN),ar=(ir-PINCH_MIN)/(PINCH_THRESHOLD-PINCH_MIN);if(sr>1)this._updatePointerVertices(POINTER_REAR_RADIUS),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN;else if(sr>0){const or=(POINTER_REAR_RADIUS-POINTER_REAR_RADIUS_MIN)*sr+POINTER_REAR_RADIUS_MIN;this._updatePointerVertices(or),ar<1?(this.pointerMesh.position.set(0,0,-1*or-(1-ar)*POINTER_ADVANCE_MAX),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN+(1-ar)*(POINTER_OPACITY_MAX-POINTER_OPACITY_MIN)):(this.pointerMesh.position.set(0,0,-1*or),this.pointerMesh.material.opacity=POINTER_OPACITY_MIN)}else this._updatePointerVertices(POINTER_REAR_RADIUS_MIN),this.pointerMesh.position.set(0,0,-1*POINTER_REAR_RADIUS_MIN-POINTER_ADVANCE_MAX),this.pointerMesh.material.opacity=POINTER_OPACITY_MAX;this.cursorObject.material.opacity=this.pointerMesh.material.opacity}updateMatrixWorld(er){super.updateMatrixWorld(er),this.pointerGeometry&&(this._updatePointer(),this._updateRaycaster())}isPinched(){return this.pinched}setAttached(er){this.attached=er}isAttached(){return this.attached}intersectObject(er,tr=!0){if(this.raycaster)return this.raycaster.intersectObject(er,tr)}intersectObjects(er,tr=!0){if(this.raycaster)return this.raycaster.intersectObjects(er,tr)}checkIntersections(er,tr=!1){if(this.raycaster&&!this.attached){const ir=this.raycaster.intersectObjects(er,tr),nr=new Vector3$1(0,0,-1);if(ir.length>0){const ar=ir[0].distance;this.cursorObject.position.copy(nr.multiplyScalar(ar))}else this.cursorObject.position.copy(nr.multiplyScalar(CURSOR_MAX_DISTANCE))}}setCursor(er){const tr=new Vector3$1(0,0,-1);this.raycaster&&!this.attached&&this.cursorObject.position.copy(tr.multiplyScalar(er))}dispose(){this._onDisconnected(),this.hand.removeEventListener("connected",this._onConnected),this.hand.removeEventListener("disconnected",this._onDisconnected)}}function createText(rr,er){const tr=document.createElement("canvas"),ir=tr.getContext("2d");let nr=null;const sr=100;ir.font="normal "+sr+"px Arial",nr=ir.measureText(rr);const ar=nr.width;tr.width=ar,tr.height=sr,ir.font="normal "+sr+"px Arial",ir.textAlign="center",ir.textBaseline="middle",ir.fillStyle="#ffffff",ir.fillText(rr,ar/2,sr/2);const or=new Texture(tr);or.needsUpdate=!0;const lr=new MeshBasicMaterial({color:16777215,side:DoubleSide,map:or,transparent:!0}),cr=new PlaneGeometry(er*ar/sr,er);return new Mesh(cr,lr)}class VRButton{static createButton(er,tr={}){const ir=document.createElement("button");function nr(){let cr=null;async function ur(pr){pr.addEventListener("end",dr),await er.xr.setSession(pr),ir.textContent="EXIT VR",cr=pr}function dr(){cr.removeEventListener("end",dr),ir.textContent="ENTER VR",cr=null}ir.style.display="",ir.style.cursor="pointer",ir.style.left="calc(50% - 50px)",ir.style.width="100px",ir.textContent="ENTER VR";const hr={...tr,optionalFeatures:["local-floor","bounded-floor","layers",...tr.optionalFeatures||[]]};ir.onmouseenter=function(){ir.style.opacity="1.0"},ir.onmouseleave=function(){ir.style.opacity="0.5"},ir.onclick=function(){cr===null?navigator.xr.requestSession("immersive-vr",hr).then(ur):(cr.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",hr).then(ur).catch(pr=>{console.warn(pr)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",hr).then(ur).catch(pr=>{console.warn(pr)})}function sr(){ir.style.display="",ir.style.cursor="auto",ir.style.left="calc(50% - 75px)",ir.style.width="150px",ir.onmouseenter=null,ir.onmouseleave=null,ir.onclick=null}function ar(){sr(),ir.textContent="VR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),ir.textContent="VR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return ir.id="VRButton",ir.style.display="none",lr(ir),navigator.xr.isSessionSupported("immersive-vr").then(function(cr){cr?nr():ar(),cr&&VRButton.xrSessionIsGranted&&ir.click()}).catch(or),ir;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{VRButton.xrSessionIsGranted=!0})}}}VRButton.xrSessionIsGranted=!1;VRButton.registerSessionGrantedListener();class XRButton{static createButton(er,tr={}){const ir=document.createElement("button");function nr(cr){let ur=null;async function dr(gr){gr.addEventListener("end",hr),await er.xr.setSession(gr),ir.textContent="STOP XR",ur=gr}function hr(){ur.removeEventListener("end",hr),ir.textContent="START XR",ur=null}ir.style.display="",ir.style.cursor="pointer",ir.style.left="calc(50% - 50px)",ir.style.width="100px",ir.textContent="START XR";const pr={...tr,optionalFeatures:["local-floor","bounded-floor","layers",...tr.optionalFeatures||[]]};ir.onmouseenter=function(){ir.style.opacity="1.0"},ir.onmouseleave=function(){ir.style.opacity="0.5"},ir.onclick=function(){ur===null?navigator.xr.requestSession(cr,pr).then(dr):(ur.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(cr,pr).then(dr).catch(gr=>{console.warn(gr)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession(cr,pr).then(dr).catch(gr=>{console.warn(gr)})}function sr(){ir.style.display="",ir.style.cursor="auto",ir.style.left="calc(50% - 75px)",ir.style.width="150px",ir.onmouseenter=null,ir.onmouseleave=null,ir.onclick=null}function ar(){sr(),ir.textContent="XR NOT SUPPORTED"}function or(cr){sr(),console.warn("Exception when trying to call xr.isSessionSupported",cr),ir.textContent="XR NOT ALLOWED"}function lr(cr){cr.style.position="absolute",cr.style.bottom="20px",cr.style.padding="12px 6px",cr.style.border="1px solid #fff",cr.style.borderRadius="4px",cr.style.background="rgba(0,0,0,0.1)",cr.style.color="#fff",cr.style.font="normal 13px sans-serif",cr.style.textAlign="center",cr.style.opacity="0.5",cr.style.outline="none",cr.style.zIndex="999"}if("xr"in navigator)return ir.id="XRButton",ir.style.display="none",lr(ir),navigator.xr.isSessionSupported("immersive-ar").then(function(cr){cr?nr("immersive-ar"):navigator.xr.isSessionSupported("immersive-vr").then(function(ur){ur?nr("immersive-vr"):ar()}).catch(or)}).catch(or),ir;{const cr=document.createElement("a");return window.isSecureContext===!1?(cr.href=document.location.href.replace(/^http:/,"https:"),cr.innerHTML="WEBXR NEEDS HTTPS"):(cr.href="https://immersiveweb.dev/",cr.innerHTML="WEBXR NOT AVAILABLE"),cr.style.left="calc(50% - 90px)",cr.style.width="180px",cr.style.textDecoration="none",lr(cr),cr}}}const Constants={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function fetchJsonFile(rr){const er=await fetch(rr);if(er.ok)return er.json();throw new Error(er.statusText)}async function fetchProfilesList(rr){if(!rr)throw new Error("No basePath supplied");return await fetchJsonFile(`${rr}/profilesList.json`)}async function fetchProfile(rr,er,tr=null,ir=!0){if(!rr)throw new Error("No xrInputSource supplied");if(!er)throw new Error("No basePath supplied");const nr=await fetchProfilesList(er);let sr;if(rr.profiles.some(lr=>{const cr=nr[lr];return cr&&(sr={profileId:lr,profilePath:`${er}/${cr.path}`,deprecated:!!cr.deprecated}),!!sr}),!sr){if(!tr)throw new Error("No matching profile name found");const lr=nr[tr];if(!lr)throw new Error(`No matching profile name found and default profile "${tr}" missing.`);sr={profileId:tr,profilePath:`${er}/${lr.path}`,deprecated:!!lr.deprecated}}const ar=await fetchJsonFile(sr.profilePath);let or;if(ir){let lr;if(rr.handedness==="any"?lr=ar.layouts[Object.keys(ar.layouts)[0]]:lr=ar.layouts[rr.handedness],!lr)throw new Error(`No matching handedness, ${rr.handedness}, in profile ${sr.profileId}`);lr.assetPath&&(or=sr.profilePath.replace("profile.json",lr.assetPath))}return{profile:ar,assetPath:or}}const defaultComponentValues={xAxis:0,yAxis:0,button:0,state:Constants.ComponentState.DEFAULT};function normalizeAxes(rr=0,er=0){let tr=rr,ir=er;if(Math.sqrt(rr*rr+er*er)>1){const ar=Math.atan2(er,rr);tr=Math.cos(ar),ir=Math.sin(ar)}return{normalizedXAxis:tr*.5+.5,normalizedYAxis:ir*.5+.5}}class VisualResponse{constructor(er){this.componentProperty=er.componentProperty,this.states=er.states,this.valueNodeName=er.valueNodeName,this.valueNodeProperty=er.valueNodeProperty,this.valueNodeProperty===Constants.VisualResponseProperty.TRANSFORM&&(this.minNodeName=er.minNodeName,this.maxNodeName=er.maxNodeName),this.value=0,this.updateFromComponent(defaultComponentValues)}updateFromComponent({xAxis:er,yAxis:tr,button:ir,state:nr}){const{normalizedXAxis:sr,normalizedYAxis:ar}=normalizeAxes(er,tr);switch(this.componentProperty){case Constants.ComponentProperty.X_AXIS:this.value=this.states.includes(nr)?sr:.5;break;case Constants.ComponentProperty.Y_AXIS:this.value=this.states.includes(nr)?ar:.5;break;case Constants.ComponentProperty.BUTTON:this.value=this.states.includes(nr)?ir:0;break;case Constants.ComponentProperty.STATE:this.valueNodeProperty===Constants.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(nr):this.value=this.states.includes(nr)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Component{constructor(er,tr){if(!er||!tr||!tr.visualResponses||!tr.gamepadIndices||Object.keys(tr.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=er,this.type=tr.type,this.rootNodeName=tr.rootNodeName,this.touchPointNodeName=tr.touchPointNodeName,this.visualResponses={},Object.keys(tr.visualResponses).forEach(ir=>{const nr=new VisualResponse(tr.visualResponses[ir]);this.visualResponses[ir]=nr}),this.gamepadIndices=Object.assign({},tr.gamepadIndices),this.values={state:Constants.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(er){if(this.values.state=Constants.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&er.buttons.length>this.gamepadIndices.button){const tr=er.buttons[this.gamepadIndices.button];this.values.button=tr.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,tr.pressed||this.values.button===1?this.values.state=Constants.ComponentState.PRESSED:(tr.touched||this.values.button>Constants.ButtonTouchThreshold)&&(this.values.state=Constants.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&er.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=er.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&er.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=er.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(tr=>{tr.updateFromComponent(this.values)})}}class MotionController{constructor(er,tr,ir){if(!er)throw new Error("No xrInputSource supplied");if(!tr)throw new Error("No profile supplied");this.xrInputSource=er,this.assetUrl=ir,this.id=tr.profileId,this.layoutDescription=tr.layouts[er.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(nr=>{const sr=this.layoutDescription.components[nr];this.components[nr]=new Component(nr,sr)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const er=[];return Object.values(this.components).forEach(tr=>{er.push(tr.data)}),er}updateFromGamepad(){Object.values(this.components).forEach(er=>{er.updateFromGamepad(this.xrInputSource.gamepad)})}}const DEFAULT_PROFILES_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",DEFAULT_PROFILE="generic-trigger";class XRControllerModel extends Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(er){return this.envMap==er?this:(this.envMap=er,this.traverse(tr=>{tr.isMesh&&(tr.material.envMap=this.envMap,tr.material.needsUpdate=!0)}),this)}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(tr=>{Object.values(tr.visualResponses).forEach(ir=>{const{valueNode:nr,minNode:sr,maxNode:ar,value:or,valueNodeProperty:lr}=ir;nr&&(lr===Constants.VisualResponseProperty.VISIBILITY?nr.visible=or:lr===Constants.VisualResponseProperty.TRANSFORM&&(nr.quaternion.slerpQuaternions(sr.quaternion,ar.quaternion,or),nr.position.lerpVectors(sr.position,ar.position,or)))})}))}}function findNodes(rr,er){Object.values(rr.components).forEach(tr=>{const{type:ir,touchPointNodeName:nr,visualResponses:sr}=tr;if(ir===Constants.ComponentType.TOUCHPAD)if(tr.touchPointNode=er.getObjectByName(nr),tr.touchPointNode){const ar=new SphereGeometry(.001),or=new MeshBasicMaterial({color:255}),lr=new Mesh(ar,or);tr.touchPointNode.add(lr)}else console.warn(`Could not find touch dot, ${tr.touchPointNodeName}, in touchpad component ${tr.id}`);Object.values(sr).forEach(ar=>{const{valueNodeName:or,minNodeName:lr,maxNodeName:cr,valueNodeProperty:ur}=ar;if(ur===Constants.VisualResponseProperty.TRANSFORM){if(ar.minNode=er.getObjectByName(lr),ar.maxNode=er.getObjectByName(cr),!ar.minNode){console.warn(`Could not find ${lr} in the model`);return}if(!ar.maxNode){console.warn(`Could not find ${cr} in the model`);return}}ar.valueNode=er.getObjectByName(or),ar.valueNode||console.warn(`Could not find ${or} in the model`)})})}function addAssetSceneToControllerModel(rr,er){findNodes(rr.motionController,er),rr.envMap&&er.traverse(tr=>{tr.isMesh&&(tr.material.envMap=rr.envMap,tr.material.needsUpdate=!0)}),rr.add(er)}class XRControllerModelFactory{constructor(er=null,tr=null){this.gltfLoader=er,this.path=DEFAULT_PROFILES_PATH,this._assetCache={},this.onLoad=tr,this.gltfLoader||(this.gltfLoader=new GLTFLoader)}setPath(er){return this.path=er,this}createControllerModel(er){const tr=new XRControllerModel;let ir=null;return er.addEventListener("connected",nr=>{const sr=nr.data;sr.targetRayMode!=="tracked-pointer"||!sr.gamepad||sr.hand||fetchProfile(sr,this.path,DEFAULT_PROFILE).then(({profile:ar,assetPath:or})=>{tr.motionController=new MotionController(sr,ar,or);const lr=this._assetCache[tr.motionController.assetUrl];if(lr)ir=lr.scene.clone(),addAssetSceneToControllerModel(tr,ir),this.onLoad&&this.onLoad(ir);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(tr.motionController.assetUrl,cr=>{this._assetCache[tr.motionController.assetUrl]=cr,ir=cr.scene.clone(),addAssetSceneToControllerModel(tr,ir),this.onLoad&&this.onLoad(ir)},null,()=>{throw new Error(`Asset ${tr.motionController.assetUrl} missing or malformed.`)})}}).catch(ar=>{console.warn(ar)})}),er.addEventListener("disconnected",()=>{tr.motionController=null,tr.remove(ir),ir=null}),tr}}class SessionLightProbe{constructor(er,tr,ir,nr,sr){this.xrLight=er,this.renderer=tr,this.lightProbe=ir,this.xrWebGLBinding=null,this.estimationStartCallback=sr,this.frameCallback=this.onXRFrame.bind(this);const ar=tr.xr.getSession();if(nr&&"XRWebGLBinding"in window){const or=new WebGLCubeRenderTarget(16);er.environment=or.texture;const lr=tr.getContext();switch(ar.preferredReflectionFormat){case"srgba8":lr.getExtension("EXT_sRGB");break;case"rgba16f":lr.getExtension("OES_texture_half_float");break}this.xrWebGLBinding=new XRWebGLBinding(ar,lr),this.lightProbe.addEventListener("reflectionchange",()=>{this.updateReflection()})}ar.requestAnimationFrame(this.frameCallback)}updateReflection(){const er=this.renderer.properties.get(this.xrLight.environment);if(er){const tr=this.xrWebGLBinding.getReflectionCubeMap(this.lightProbe);tr&&(er.__webglTexture=tr,this.xrLight.environment.needsPMREMUpdate=!0)}}onXRFrame(er,tr){if(!this.xrLight)return;tr.session.requestAnimationFrame(this.frameCallback);const nr=tr.getLightEstimate(this.lightProbe);if(nr){this.xrLight.lightProbe.sh.fromArray(nr.sphericalHarmonicsCoefficients),this.xrLight.lightProbe.intensity=1;const sr=Math.max(1,Math.max(nr.primaryLightIntensity.x,Math.max(nr.primaryLightIntensity.y,nr.primaryLightIntensity.z)));this.xrLight.directionalLight.color.setRGB(nr.primaryLightIntensity.x/sr,nr.primaryLightIntensity.y/sr,nr.primaryLightIntensity.z/sr),this.xrLight.directionalLight.intensity=sr,this.xrLight.directionalLight.position.copy(nr.primaryLightDirection),this.estimationStartCallback&&(this.estimationStartCallback(),this.estimationStartCallback=null)}}dispose(){this.xrLight=null,this.renderer=null,this.lightProbe=null,this.xrWebGLBinding=null}}class XREstimatedLight extends Group{constructor(er,tr=!0){super(),this.lightProbe=new LightProbe,this.lightProbe.intensity=0,this.add(this.lightProbe),this.directionalLight=new DirectionalLight,this.directionalLight.intensity=0,this.add(this.directionalLight),this.environment=null;let ir=null,nr=!1;er.xr.addEventListener("sessionstart",()=>{const sr=er.xr.getSession();"requestLightProbe"in sr&&sr.requestLightProbe({reflectionFormat:sr.preferredReflectionFormat}).then(ar=>{ir=new SessionLightProbe(this,er,ar,tr,()=>{nr=!0,this.dispatchEvent({type:"estimationstart"})})})}),er.xr.addEventListener("sessionend",()=>{ir&&(ir.dispose(),ir=null),nr&&this.dispatchEvent({type:"estimationend"})}),this.dispose=()=>{ir&&(ir.dispose(),ir=null),this.remove(this.lightProbe),this.lightProbe=null,this.remove(this.directionalLight),this.directionalLight=null,this.environment=null}}}const _matrix$1=new Matrix4,_vector=new Vector3$1;class XRHandPrimitiveModel{constructor(er,tr,ir,nr,sr){this.controller=tr,this.handModel=er,this.envMap=null;let ar;!sr||!sr.primitive||sr.primitive==="sphere"?ar=new SphereGeometry(1,10,10):sr.primitive==="box"&&(ar=new BoxGeometry(1,1,1));const or=new MeshStandardMaterial;this.handMesh=new InstancedMesh(ar,or,30),this.handMesh.frustumCulled=!1,this.handMesh.instanceMatrix.setUsage(DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const tr=this.controller.joints;let ir=0;for(let nr=0;nr<this.joints.length;nr++){const sr=tr[this.joints[nr]];sr.visible&&(_vector.setScalar(sr.jointRadius||.008),_matrix$1.compose(sr.position,sr.quaternion,_vector),this.handMesh.setMatrixAt(nr,_matrix$1),ir++)}this.handMesh.count=ir,this.handMesh.instanceMatrix.needsUpdate=!0}}class XRHandModel extends Object3D{constructor(er){super(),this.controller=er,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(er){super.updateMatrixWorld(er),this.motionController&&this.motionController.updateMesh()}}class XRHandModelFactory{constructor(er=null,tr=null){this.gltfLoader=er,this.path=null,this.onLoad=tr}setPath(er){return this.path=er,this}createHandModel(er,tr){const ir=new XRHandModel(er);return er.addEventListener("connected",nr=>{const sr=nr.data;sr.hand&&!ir.motionController&&(ir.xrInputSource=sr,tr===void 0||tr==="spheres"?ir.motionController=new XRHandPrimitiveModel(ir,er,this.path,sr.handedness,{primitive:"sphere"}):tr==="boxes"?ir.motionController=new XRHandPrimitiveModel(ir,er,this.path,sr.handedness,{primitive:"box"}):tr==="mesh"&&(ir.motionController=new XRHandMeshModel(ir,er,this.path,sr.handedness,this.gltfLoader,this.onLoad))),er.visible=!0}),er.addEventListener("disconnected",()=>{er.visible=!1}),ir}}class XRPlanes extends Object3D{constructor(er){super();const tr=new Matrix4,ir=new Map,nr=er.xr;nr.addEventListener("planesdetected",sr=>{const ar=sr.data,or=ar.detectedPlanes,lr=nr.getReferenceSpace();let cr=!1;for(const[ur,dr]of ir)or.has(ur)===!1&&(dr.geometry.dispose(),dr.material.dispose(),this.remove(dr),ir.delete(ur),cr=!0);for(const ur of or)if(ir.has(ur)===!1){const dr=ar.getPose(ur.planeSpace,lr);tr.fromArray(dr.transform.matrix);const hr=ur.polygon;let pr=Number.MAX_SAFE_INTEGER,gr=Number.MIN_SAFE_INTEGER,vr=Number.MAX_SAFE_INTEGER,mr=Number.MIN_SAFE_INTEGER;for(const xr of hr)pr=Math.min(pr,xr.x),gr=Math.max(gr,xr.x),vr=Math.min(vr,xr.z),mr=Math.max(mr,xr.z);const fr=gr-pr,_r=mr-vr,Ar=new BoxGeometry(fr,.01,_r),yr=new MeshBasicMaterial({color:16777215*Math.random()}),wr=new Mesh(Ar,yr);wr.position.setFromMatrixPosition(tr),wr.quaternion.setFromRotationMatrix(tr),this.add(wr),ir.set(ur,wr),cr=!0}cr&&this.dispatchEvent({type:"planeschanged"})})}}class GameObject{constructor(){this.game=game$1}async init(){}lateinit(){}update(){}lateUpdate(){}pauseUpdate(){}beforeStart(){}reset(){}}let elem$1=document.getElementById("loading"),progress=[];function getLoadingFunc(rr){let er=!1,tr=-1;return ir=>{er==!1&&(tr=progress.push({name:rr,loaded:ir.loaded,total:ir.total,elem:document.createElement("div")})-1,progress[tr].elem.className="progress",progress[tr].elem.innerHTML=`<div class="progress-bar progress-bar-striped"
                    role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    ${rr}
                </div>`,er=!0,elem$1.append(progress[tr].elem)),progress[tr].loaded=ir.loaded,progress[tr].elem.children[0].ariaValueNow=(ir.loaded/ir.total*100).toFixed(0),progress[tr].elem.children[0].style.width=(ir.loaded/ir.total*100).toFixed(0)+"%"}}function removeProgess(rr){for(let er of progress)er.name==rr&&er.elem.parentNode?.removeChild(er.elem)}class Inventory{constructor(er,tr,ir,nr){this.elem=document.createElement("canvas"),this.ctx=this.elem.getContext("2d"),this.selected=0,this.items=["","","",""],this.aidkitImg=er,this.nightvisionImg=tr,this.teleportImg=ir,this.staminaImg=nr,this.elem.width=100,this.elem.height=400,this.elem.style.display="fixed",this.elem.style.top="40%",this.elem.style.left="2%",this.ctx.strokeStyle="#808080",this.ctx.fillStyle="rgba(80,80,80,0.5)",this.ctx.save(),this.draw(),this.ctx.restore(),window.addEventListener("keydown",sr=>{sr.key!="1"&&sr.key!="2"&&sr.key!="3"&&sr.key!="4"||(this.selected=Number(sr.key)-1,this.draw())})}update(er){this.items=er,this.draw()}draw(){this.ctx.clearRect(0,0,this.elem.width,this.elem.height);for(let er=0;er<4;er++)this.ctx.beginPath(),this.ctx.arc(40,40+80*er,30,0,2*Math.PI),this.ctx.lineWidth=4,this.ctx.strokeStyle="#808080",this.ctx.stroke(),this.ctx.fill(),er==this.selected&&(this.ctx.strokeStyle="#cccccc",this.ctx.stroke()),this.items[er]=="medicine"&&this.ctx.drawImage(this.aidkitImg,20,20+80*er,40,40),this.items[er]=="vision"&&this.ctx.drawImage(this.nightvisionImg,20,20+80*er,40,40),this.items[er]=="sprint"&&this.ctx.drawImage(this.staminaImg,20,20+80*er,40,40),this.items[er]=="transmit"&&this.ctx.drawImage(this.teleportImg,20,20+80*er,40,40),this.ctx.closePath()}get element(){return this.elem}}let elem=document.getElementById("hint");function createHint(rr){let er=document.createElement("div");return er.innerText=rr,er.style.opacity="0",er.animate({opacity:"1"},500).onfinish=()=>{er.style.opacity="1"},elem.appendChild(er),er}function removeHint(rr){rr.animate({opacity:"0"},500).onfinish=()=>{rr.remove()}}const instances=["Recast","Detour","DetourNavMeshBuilder","DetourTileCacheBuilder","NavMeshImporter","NavMeshExporter","CrowdUtils","ChunkyTriMeshUtils","RecastDebugDraw","DetourDebugDraw"],classes=["rcConfig","rcContext","dtNavMeshParams","dtNavMeshCreateParams","RecastLinearAllocator","RecastFastLZCompressor","rcChunkyTriMesh","dtTileCacheParams","dtTileCacheLayerHeader","Vec3","BoolRef","IntRef","UnsignedIntRef","UnsignedCharRef","UnsignedShortRef","FloatRef","IntArray","UnsignedIntArray","UnsignedCharArray","UnsignedShortArray","FloatArray"],Raw={isNull:rr=>Raw.Module.getPointer(rr)===0,destroy:rr=>{Raw.Module.destroy(rr)}},Recast={},Detour={},init=async rr=>{if(Raw.Module===void 0){if(rr)Raw.Module=await rr();else{const er=(await __vitePreload(async()=>{const{default:tr}=await import("./recast-navigation.wasm-compat-wIydRFaz.js");return{default:tr}},[])).default;Raw.Module=await er()}for(const er of instances)Raw[er]=new Raw.Module[er];for(const er of classes)Raw[er]=Raw.Module[er];Recast.RC_BORDER_REG=Raw.Recast.BORDER_REG,Recast.RC_MULTIPLE_REGS=Raw.Recast.MULTIPLE_REGS,Recast.RC_BORDER_VERTEX=Raw.Recast.BORDER_VERTEX,Recast.RC_AREA_BORDER=Raw.Recast.AREA_BORDER,Recast.RC_CONTOUR_REG_MASK=Raw.Recast.CONTOUR_REG_MASK,Recast.RC_MESH_NULL_IDX=Raw.Recast.MESH_NULL_IDX,Recast.RC_NULL_AREA=Raw.Recast.NULL_AREA,Recast.RC_WALKABLE_AREA=Raw.Recast.WALKABLE_AREA,Recast.RC_NOT_CONNECTED=Raw.Recast.NOT_CONNECTED,Recast.RC_CONTOUR_TESS_WALL_EDGES=Raw.Module.RC_CONTOUR_TESS_WALL_EDGES,Recast.RC_CONTOUR_TESS_AREA_EDGES=Raw.Module.RC_CONTOUR_TESS_AREA_EDGES,Recast.RC_LOG_PROGRESS=Raw.Module.RC_LOG_PROGRESS,Recast.RC_LOG_WARNING=Raw.Module.RC_LOG_WARNING,Recast.RC_LOG_ERROR=Raw.Module.RC_LOG_ERROR,Recast.RC_TIMER_TOTAL=Raw.Module.RC_TIMER_TOTAL,Recast.RC_TIMER_TEMP=Raw.Module.RC_TIMER_TEMP,Recast.RC_TIMER_RASTERIZE_TRIANGLES=Raw.Module.RC_TIMER_RASTERIZE_TRIANGLES,Recast.RC_TIMER_BUILD_COMPACTHEIGHTFIELD=Raw.Module.RC_TIMER_BUILD_COMPACTHEIGHTFIELD,Recast.RC_TIMER_BUILD_CONTOURS=Raw.Module.RC_TIMER_BUILD_CONTOURS,Recast.RC_TIMER_BUILD_CONTOURS_TRACE=Raw.Module.RC_TIMER_BUILD_CONTOURS_TRACE,Recast.RC_TIMER_BUILD_CONTOURS_SIMPLIFY=Raw.Module.RC_TIMER_BUILD_CONTOURS_SIMPLIFY,Recast.RC_TIMER_FILTER_BORDER=Raw.Module.RC_TIMER_FILTER_BORDER,Recast.RC_TIMER_FILTER_WALKABLE=Raw.Module.RC_TIMER_FILTER_WALKABLE,Recast.RC_TIMER_MEDIAN_AREA=Raw.Module.RC_TIMER_MEDIAN_AREA,Recast.RC_TIMER_FILTER_LOW_OBSTACLES=Raw.Module.RC_TIMER_FILTER_LOW_OBSTACLES,Recast.RC_TIMER_BUILD_POLYMESH=Raw.Module.RC_TIMER_BUILD_POLYMESH,Recast.RC_TIMER_MERGE_POLYMESH=Raw.Module.RC_TIMER_MERGE_POLYMESH,Recast.RC_TIMER_ERODE_AREA=Raw.Module.RC_TIMER_ERODE_AREA,Recast.RC_TIMER_MARK_BOX_AREA=Raw.Module.RC_TIMER_MARK_BOX_AREA,Recast.RC_TIMER_MARK_CYLINDER_AREA=Raw.Module.RC_TIMER_MARK_CYLINDER_AREA,Recast.RC_TIMER_MARK_CONVEXPOLY_AREA=Raw.Module.RC_TIMER_MARK_CONVEXPOLY_AREA,Recast.RC_TIMER_BUILD_DISTANCEFIELD=Raw.Module.RC_TIMER_BUILD_DISTANCEFIELD,Recast.RC_TIMER_BUILD_DISTANCEFIELD_DIST=Raw.Module.RC_TIMER_BUILD_DISTANCEFIELD_DIST,Recast.RC_TIMER_BUILD_DISTANCEFIELD_BLUR=Raw.Module.RC_TIMER_BUILD_DISTANCEFIELD_BLUR,Recast.RC_TIMER_BUILD_REGIONS=Raw.Module.RC_TIMER_BUILD_REGIONS,Recast.RC_TIMER_BUILD_REGIONS_WATERSHED=Raw.Module.RC_TIMER_BUILD_REGIONS_WATERSHED,Recast.RC_TIMER_BUILD_REGIONS_EXPAND=Raw.Module.RC_TIMER_BUILD_REGIONS_EXPAND,Recast.RC_TIMER_BUILD_REGIONS_FLOOD=Raw.Module.RC_TIMER_BUILD_REGIONS_FLOOD,Recast.RC_TIMER_BUILD_REGIONS_FILTER=Raw.Module.RC_TIMER_BUILD_REGIONS_FILTER,Recast.RC_TIMER_BUILD_LAYERS=Raw.Module.RC_TIMER_BUILD_LAYERS,Recast.RC_TIMER_BUILD_POLYMESHDETAIL=Raw.Module.RC_TIMER_BUILD_POLYMESHDETAIL,Recast.RC_TIMER_MERGE_POLYMESHDETAIL=Raw.Module.RC_TIMER_MERGE_POLYMESHDETAIL,Recast.RC_MAX_TIMERS=Raw.Module.RC_MAX_TIMERS,Detour.DT_FAILURE=Raw.Detour.FAILURE,Detour.DT_SUCCESS=Raw.Detour.SUCCESS,Detour.DT_IN_PROGRESS=Raw.Detour.IN_PROGRESS,Detour.DT_STATUS_DETAIL_MASK=Raw.Detour.STATUS_DETAIL_MASK,Detour.DT_WRONG_MAGIC=Raw.Detour.WRONG_MAGIC,Detour.DT_WRONG_VERSION=Raw.Detour.WRONG_VERSION,Detour.DT_OUT_OF_MEMORY=Raw.Detour.OUT_OF_MEMORY,Detour.DT_INVALID_PARAM=Raw.Detour.INVALID_PARAM,Detour.DT_BUFFER_TOO_SMALL=Raw.Detour.BUFFER_TOO_SMALL,Detour.DT_OUT_OF_NODES=Raw.Detour.OUT_OF_NODES,Detour.DT_PARTIAL_RESULT=Raw.Detour.PARTIAL_RESULT,Detour.DT_ALREADY_OCCUPIED=Raw.Detour.ALREADY_OCCUPIED,Detour.DT_VERTS_PER_POLYGON=Raw.Detour.VERTS_PER_POLYGON,Detour.DT_NAVMESH_MAGIC=Raw.Detour.NAVMESH_MAGIC,Detour.DT_NAVMESH_VERSION=Raw.Detour.NAVMESH_VERSION,Detour.DT_NAVMESH_STATE_MAGIC=Raw.Detour.NAVMESH_STATE_MAGIC,Detour.DT_NAVMESH_STATE_VERSION=Raw.Detour.NAVMESH_STATE_VERSION,Detour.DT_TILECACHE_MAGIC=Raw.Detour.TILECACHE_MAGIC,Detour.DT_TILECACHE_VERSION=Raw.Detour.TILECACHE_VERSION,Detour.DT_TILECACHE_NULL_AREA=Raw.Detour.TILECACHE_NULL_AREA,Detour.DT_TILECACHE_WALKABLE_AREA=Raw.Detour.TILECACHE_WALKABLE_AREA,Detour.DT_TILECACHE_NULL_IDX=Raw.Detour.TILECACHE_NULL_IDX,Detour.DT_NULL_LINK=Raw.Detour.NULL_LINK,Detour.DT_NULL_LINK=Raw.Detour.NULL_LINK,Detour.DT_EXT_LINK=Raw.Detour.EXT_LINK,Detour.DT_OFFMESH_CON_BIDIR=Raw.Detour.OFFMESH_CON_BIDIR,Detour.DT_STRAIGHTPATH_START=Raw.Module.DT_STRAIGHTPATH_START,Detour.DT_STRAIGHTPATH_END=Raw.Module.DT_STRAIGHTPATH_END,Detour.DT_STRAIGHTPATH_OFFMESH_CONNECTION=Raw.Module.DT_STRAIGHTPATH_OFFMESH_CONNECTION,Detour.DT_STRAIGHTPATH_AREA_CROSSINGS=Raw.Module.DT_STRAIGHTPATH_AREA_CROSSINGS,Detour.DT_STRAIGHTPATH_ALL_CROSSINGS=Raw.Module.DT_STRAIGHTPATH_ALL_CROSSINGS,Detour.DT_FINDPATH_ANY_ANGLE=Raw.Module.DT_FINDPATH_ANY_ANGLE,Detour.DT_RAYCAST_USE_COSTS=Raw.Module.DT_RAYCAST_USE_COSTS,Detour.DT_CROWDAGENT_STATE_INVALID=Raw.Module.DT_CROWDAGENT_STATE_INVALID,Detour.DT_CROWDAGENT_STATE_WALKING=Raw.Module.DT_CROWDAGENT_STATE_WALKING,Detour.DT_CROWDAGENT_STATE_OFFMESH=Raw.Module.DT_CROWDAGENT_STATE_OFFMESH,Detour.DT_CROWDAGENT_TARGET_NONE=Raw.Module.DT_CROWDAGENT_TARGET_NONE,Detour.DT_CROWDAGENT_TARGET_FAILED=Raw.Module.DT_CROWDAGENT_TARGET_FAILED,Detour.DT_CROWDAGENT_TARGET_VALID=Raw.Module.DT_CROWDAGENT_TARGET_VALID,Detour.DT_CROWDAGENT_TARGET_REQUESTING=Raw.Module.DT_CROWDAGENT_TARGET_REQUESTING,Detour.DT_CROWDAGENT_TARGET_WAITING_FOR_QUEUE=Raw.Module.DT_CROWDAGENT_TARGET_WAITING_FOR_QUEUE,Detour.DT_CROWDAGENT_TARGET_WAITING_FOR_PATH=Raw.Module.DT_CROWDAGENT_TARGET_WAITING_FOR_PATH,Detour.DT_CROWDAGENT_TARGET_VELOCITY=Raw.Module.DT_CROWDAGENT_TARGET_VELOCITY,Detour.DT_COMPRESSEDTILE_FREE_DATA=Raw.Module.DT_COMPRESSEDTILE_FREE_DATA,Detour.DT_TILE_FREE_DATA=Raw.Module.DT_TILE_FREE_DATA}};class BaseArray{get size(){return this.raw.size}constructor(er){this.raw=er}get(er){return this.raw.get(er)}set(er,tr){this.raw.set(er,tr)}resize(er){this.raw.resize(er)}copy(er){this.raw.resize(er.length),this.getHeapView().set(er)}destroy(){Raw.destroy(this.raw)}getHeapView(){const er=this.getHeap();return new this.typedArrayClass(er.buffer,this.raw.getDataPointer(),this.size)}toTypedArray(){const er=this.getHeapView(),tr=new this.typedArrayClass(this.size);return tr.set(er),tr}}class IntArray extends BaseArray{typedArrayClass=Int32Array;constructor(er){super(er??new Raw.Module.IntArray)}getHeap(){return Raw.Module.HEAP32}static fromRaw(er){return new this(er)}}class UnsignedIntArray extends BaseArray{typedArrayClass=Uint32Array;constructor(er){super(er??new Raw.Module.UnsignedIntArray)}getHeap(){return Raw.Module.HEAPU32}static fromRaw(er){return new this(er)}}class UnsignedCharArray extends BaseArray{typedArrayClass=Uint8Array;constructor(er){super(er??new Raw.Module.UnsignedCharArray)}getHeap(){return Raw.Module.HEAPU8}static fromRaw(er){return new this(er)}}class UnsignedShortArray extends BaseArray{typedArrayClass=Uint16Array;constructor(er){super(er??new Raw.Module.UnsignedShortArray)}getHeap(){return Raw.Module.HEAPU16}static fromRaw(er){return new this(er)}}class FloatArray extends BaseArray{typedArrayClass=Float32Array;constructor(er){super(er??new Raw.Module.FloatArray)}getHeap(){return Raw.Module.HEAPF32}static fromRaw(er){return new this(er)}}const VerticesArray=FloatArray,TrianglesArray=IntArray,TriangleAreasArray=UnsignedCharArray,ChunkIdsArray=IntArray,TileCacheData=UnsignedCharArray,vec3={toRaw:({x:rr,y:er,z:tr},ir)=>ir?(ir.x=rr,ir.y=er,ir.z=tr,ir):new Raw.Module.Vec3(rr,er,tr),fromRaw:rr=>{const{x:er,y:tr,z:ir}=rr;return{x:er,y:tr,z:ir}},fromArray:([rr,er,tr])=>({x:rr,y:er,z:tr}),toArray:({x:rr,y:er,z:tr})=>[rr,er,tr],lerp:(rr,er,tr,ir={x:0,y:0,z:0})=>{ir.x=rr.x+(er.x-rr.x)*tr,ir.y=rr.y+(er.y-rr.y)*tr,ir.z=rr.z+(er.z-rr.z)*tr},copy:(rr,er={x:0,y:0,z:0})=>{er.x=rr.x,er.y=rr.y,er.z=rr.z}},array=(rr,er)=>{const tr=[];for(let ir=0;ir<er;ir++)tr.push(rr(ir));return tr},statusSucceed=rr=>Raw.Detour.statusSucceed(rr),statusFailed=rr=>Raw.Detour.statusFailed(rr),statusInProgress=rr=>Raw.Detour.statusInProgress(rr),statusDetail=(rr,er)=>Raw.Detour.statusDetail(rr,er),statusToReadableString=rr=>{if(Raw.Detour.statusSucceed(rr))return"success";if(Raw.Detour.statusInProgress(rr))return"in progress";if(Raw.Detour.statusFailed(rr)){let er;const tr={DT_WRONG_MAGIC:Detour.DT_WRONG_MAGIC,DT_WRONG_VERSION:Detour.DT_WRONG_VERSION,DT_OUT_OF_MEMORY:Detour.DT_OUT_OF_MEMORY,DT_INVALID_PARAM:Detour.DT_INVALID_PARAM,DT_BUFFER_TOO_SMALL:Detour.DT_BUFFER_TOO_SMALL,DT_OUT_OF_NODES:Detour.DT_OUT_OF_NODES,DT_PARTIAL_RESULT:Detour.DT_PARTIAL_RESULT,DT_ALREADY_OCCUPIED:Detour.DT_ALREADY_OCCUPIED};for(const[ir,nr]of Object.entries(tr))if(Raw.Detour.statusDetail(rr,nr)){er=ir;break}return er?`failed - ${er}`:"failed - unknown"}return"unknown"};class DetourPolyDetail{constructor(er){this.raw=er}vertBase(){return this.raw.vertBase}triBase(){return this.raw.triBase}vertCount(){return this.raw.vertCount}triCount(){return this.raw.triCount}}class DetourLink{constructor(er){this.raw=er}ref(){return this.raw.ref}next(){return this.raw.next}edge(){return this.raw.edge}side(){return this.raw.side}bmin(){return this.raw.bmin}bmax(){return this.raw.bmax}}class DetourBVNode{constructor(er){this.raw=er}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}i(){return this.raw.i}}class DetourOffMeshConnection{constructor(er){this.raw=er}pos(er){return this.raw.get_pos(er)}rad(){return this.raw.rad}poly(){return this.raw.poly}flags(){return this.raw.flags}side(){return this.raw.side}userId(){return this.raw.userId}}class DetourMeshHeader{constructor(er){this.raw=er}magic(){return this.raw.magic}version(){return this.raw.version}x(){return this.raw.x}y(){return this.raw.y}layer(){return this.raw.layer}userId(){return this.raw.userId}polyCount(){return this.raw.polyCount}vertCount(){return this.raw.vertCount}maxLinkCount(){return this.raw.maxLinkCount}detailMeshCount(){return this.raw.detailMeshCount}detailVertCount(){return this.raw.detailVertCount}detailTriCount(){return this.raw.detailTriCount}bvNodeCount(){return this.raw.bvNodeCount}offMeshConCount(){return this.raw.offMeshConCount}offMeshBase(){return this.raw.offMeshBase}walkableHeight(){return this.raw.walkableHeight}walkableRadius(){return this.raw.walkableRadius}walkableClimb(){return this.raw.walkableClimb}bmin(er){return this.raw.get_bmin(er)}bmax(er){return this.raw.get_bmax(er)}bvQuantFactor(){return this.raw.bvQuantFactor}}class DetourPoly{constructor(er){this.raw=er}firstLink(){return this.raw.firstLink}verts(er){return this.raw.get_verts(er)}neis(er){return this.raw.get_neis(er)}flags(){return this.raw.flags}vertCount(){return this.raw.vertCount}areaAndType(){return this.raw.get_areaAndtype()}getType(){return this.raw.getType()}}class DetourMeshTile{constructor(er){this.raw=er}salt(){return this.raw.salt}linksFreeList(){return this.raw.linksFreeList}header(){return Raw.isNull(this.raw.header)?null:new DetourMeshHeader(this.raw.header)}polys(er){return new DetourPoly(this.raw.get_polys(er))}verts(er){return this.raw.get_verts(er)}links(er){return new DetourLink(this.raw.get_links(er))}detailMeshes(er){return new DetourPolyDetail(this.raw.get_detailMeshes(er))}detailVerts(er){return this.raw.get_detailVerts(er)}detailTris(er){return this.raw.get_detailTris(er)}bvTree(er){return new DetourBVNode(this.raw.get_bvTree(er))}offMeshCons(er){return new DetourOffMeshConnection(this.raw.get_offMeshCons(er))}data(er){return this.raw.get_data(er)}dataSize(){return this.raw.dataSize}flags(){return this.raw.flags}next(){return new DetourMeshTile(this.raw.next)}}const createNavMeshData=rr=>{const er=Raw.DetourNavMeshBuilder.createNavMeshData(rr.raw);return{success:er.success,navMeshData:UnsignedCharArray.fromRaw(er.navMeshData)}};class NavMeshCreateParams{constructor(er){this.raw=er??new Raw.Module.dtNavMeshCreateParams}setPolyMeshCreateParams(er){Raw.DetourNavMeshBuilder.setPolyMeshCreateParams(this.raw,er.raw)}setPolyMeshDetailCreateParams(er){Raw.DetourNavMeshBuilder.setPolyMeshDetailCreateParams(this.raw,er.raw)}setOffMeshConnections(er){if(er.length<=0)return;const tr=[],ir=[],nr=[],sr=[],ar=[],or=[];for(let lr=0;lr<er.length;lr++){const cr=er[lr];tr.push(cr.startPosition.x,cr.startPosition.y,cr.startPosition.z),tr.push(cr.endPosition.x,cr.endPosition.y,cr.endPosition.z),ir.push(cr.radius),nr.push(cr.bidirectional?1:0),sr.push(cr.area??0),ar.push(cr.flags??1),or.push(cr.userId??1e3+lr)}Raw.DetourNavMeshBuilder.setOffMeshConnections(this.raw,er.length,tr,ir,nr,sr,ar,or)}verts(er){return this.raw.get_verts(er)}setVerts(er,tr){this.raw.set_verts(er,tr)}vertCount(){return this.raw.vertCount}polys(er){return this.raw.get_polys(er)}setPolys(er,tr){this.raw.set_polys(er,tr)}polyAreas(er){return this.raw.get_polyAreas(er)}setPolyAreas(er,tr){this.raw.set_polyAreas(er,tr)}polyFlags(er){return this.raw.get_polyFlags(er)}setPolyFlags(er,tr){this.raw.set_polyFlags(er,tr)}polyCount(){return this.raw.polyCount}nvp(){return this.raw.nvp}setNvp(er){this.raw.nvp=er}detailMeshes(er){return this.raw.get_detailMeshes(er)}setDetailMeshes(er,tr){this.raw.set_detailMeshes(er,tr)}detailVerts(er){return this.raw.get_detailVerts(er)}setDetailVerts(er,tr){this.raw.set_detailVerts(er,tr)}detailVertsCount(){return this.raw.detailVertsCount}detailTris(er){return this.raw.get_detailTris(er)}setDetailTris(er,tr){this.raw.set_detailTris(er,tr)}detailTriCount(){return this.raw.detailTriCount}offMeshConVerts(er){return this.raw.get_offMeshConVerts(er)}offMeshConRad(er){return this.raw.get_offMeshConRad(er)}offMeshConDir(er){return this.raw.get_offMeshConDir(er)}offMeshConAreas(er){return this.raw.get_offMeshConAreas(er)}offMeshConFlags(er){return this.raw.get_offMeshConFlags(er)}offMeshConUserID(er){return this.raw.get_offMeshConUserID(er)}offMeshConCount(){return this.raw.offMeshConCount}userId(){return this.raw.userId}tileX(){return this.raw.tileX}setTileX(er){this.raw.tileX=er}tileY(){return this.raw.tileY}setTileY(er){this.raw.tileY=er}tileLayer(){return this.raw.tileLayer}setTileLayer(er){this.raw.tileLayer=er}boundsMin(){return array(er=>this.raw.get_bmin(er),3)}setBoundsMin(er){this.raw.set_bmin(0,er[0]),this.raw.set_bmin(1,er[1]),this.raw.set_bmin(2,er[2])}boundsMax(){return array(er=>this.raw.get_bmax(er),3)}setBoundsMax(er){this.raw.set_bmax(0,er[0]),this.raw.set_bmax(1,er[1]),this.raw.set_bmax(2,er[2])}walkableHeight(){return this.raw.walkableHeight}setWalkableHeight(er){this.raw.walkableHeight=er}walkableRadius(){return this.raw.walkableRadius}setWalkableRadius(er){this.raw.walkableRadius=er}walkableClimb(){return this.raw.walkableClimb}setWalkableClimb(er){this.raw.walkableClimb=er}cellSize(){return this.raw.cs}setCellSize(er){this.raw.cs=er}cellHeight(){return this.raw.ch}setCellHeight(er){this.raw.ch=er}buildBvTree(){return this.raw.buildBvTree}setBuildBvTree(er){this.raw.buildBvTree=er}}class QueryFilter{get includeFlags(){return this.raw.getIncludeFlags()}set includeFlags(er){this.raw.setIncludeFlags(er)}get excludeFlags(){return this.raw.getExcludeFlags()}set excludeFlags(er){this.raw.setExcludeFlags(er)}constructor(er){this.raw=er??new Raw.Module.dtQueryFilter}getAreaCost(er){return this.raw.getAreaCost(er)}setAreaCost(er,tr){return this.raw.setAreaCost(er,tr)}}class NavMeshQuery{defaultQueryHalfExtents={x:1,y:1,z:1};constructor(er,tr){er instanceof Raw.Module.NavMeshQuery?this.raw=er:(this.raw=new Raw.Module.NavMeshQuery,this.raw.init(er.raw,tr?.maxNodes??2048)),tr?.defaultQueryFilter?this.defaultFilter=tr.defaultQueryFilter:(this.defaultFilter=new QueryFilter,this.defaultFilter.includeFlags=65535,this.defaultFilter.excludeFlags=0)}findNearestPoly(er,tr){const ir=new Raw.UnsignedIntRef,nr=new Raw.Vec3,sr=new Raw.BoolRef,ar=this.raw.findNearestPoly(vec3.toArray(er),vec3.toArray(tr?.halfExtents??this.defaultQueryHalfExtents),tr?.filter?.raw??this.defaultFilter.raw,ir,nr,sr),or=vec3.fromRaw(nr);Raw.destroy(nr);const lr=ir.value;Raw.destroy(ir);const cr=sr.value;return Raw.destroy(sr),{success:statusSucceed(ar),status:ar,nearestRef:lr,nearestPoint:or,isOverPoly:cr}}findPolysAroundCircle(er,tr,ir,nr){const sr=nr?.filter??this.defaultFilter,ar=nr?.maxPolys??256,or=new UnsignedIntArray,lr=new UnsignedIntArray,cr=new FloatArray;or.resize(ar),lr.resize(ar),cr.resize(ar);const ur=new Raw.IntRef,dr=this.raw.findPolysAroundCircle(er,vec3.toArray(tr),ir,sr.raw,or.raw,lr.raw,cr.raw,ur,ar),hr=[...or.getHeapView()];or.destroy();const pr=[...lr.getHeapView()];lr.destroy();const gr=[...cr.getHeapView()];cr.destroy();const vr=ur.value;return Raw.destroy(ur),{success:statusSucceed(dr),status:dr,resultRefs:hr,resultParents:pr,resultCost:gr,resultCount:vr}}queryPolygons(er,tr,ir){const nr=ir?.filter??this.defaultFilter,sr=ir?.maxPolys??256,ar=new UnsignedIntArray;ar.resize(sr);const or=new Raw.IntRef,lr=this.raw.queryPolygons(vec3.toArray(er),vec3.toArray(tr),nr.raw,ar.raw,or,sr),cr=or.value;Raw.destroy(or);const ur=[...ar.getHeapView()];return ar.destroy(),{success:statusSucceed(lr),status:lr,polyRefs:ur,polyCount:cr}}closestPointOnPoly(er,tr){const ir=new Raw.Vec3,nr=new Raw.BoolRef,sr=this.raw.closestPointOnPoly(er,vec3.toArray(tr),ir,nr),ar=vec3.fromRaw(ir);Raw.destroy(ir);const or=nr.value;return Raw.destroy(nr),{success:statusSucceed(sr),status:sr,closestPoint:ar,isPointOverPoly:or}}findClosestPoint(er,tr){const ir=tr?.filter??this.defaultFilter,nr=tr?.halfExtents??this.defaultQueryHalfExtents,sr=new Raw.UnsignedIntRef,ar=new Raw.Vec3,or=new Raw.BoolRef,lr=this.raw.findClosestPoint(vec3.toArray(er),vec3.toArray(nr),ir.raw,sr,ar,or),cr=sr.value;Raw.destroy(sr);const ur=vec3.fromRaw(ar);Raw.destroy(ar);const dr=or.value;return Raw.destroy(or),{success:statusSucceed(lr),status:lr,polyRef:cr,point:ur,isPointOverPoly:dr}}findRandomPointAroundCircle(er,tr,ir){const nr=ir?.filter??this.defaultFilter,sr=ir?.halfExtents??this.defaultQueryHalfExtents;let ar;if(ir?.startRef)ar=ir.startRef;else{const hr=this.findNearestPoly(er,{filter:nr,halfExtents:sr});if(!hr.success)return{success:!1,status:hr.status,randomPolyRef:0,randomPoint:{x:0,y:0,z:0}};ar=hr.nearestRef}const or=new Raw.UnsignedIntRef,lr=new Raw.Vec3,cr=this.raw.findRandomPointAroundCircle(ar,vec3.toArray(er),tr,nr.raw,or,lr),ur=or.value;Raw.destroy(or);const dr=vec3.fromRaw(lr);return Raw.destroy(lr),{success:statusSucceed(cr),status:cr,randomPolyRef:ur,randomPoint:dr}}moveAlongSurface(er,tr,ir,nr){const sr=nr?.maxVisitedSize??256,ar=new Raw.Vec3,or=new UnsignedIntArray,lr=nr?.filter?.raw??this.defaultFilter.raw,cr=this.raw.moveAlongSurface(er,vec3.toArray(tr),vec3.toArray(ir),lr,ar,or.raw,sr),ur=vec3.fromRaw(ar);Raw.destroy(ar);const dr=[...or.getHeapView()];return or.destroy(),{success:statusSucceed(cr),status:cr,resultPosition:ur,visited:dr}}findRandomPoint(er){const tr=new Raw.UnsignedIntRef,ir=new Raw.Vec3,nr=this.raw.findRandomPoint(er?.filter?.raw??this.defaultFilter.raw,tr,ir),sr=tr.value;Raw.destroy(tr);const ar=vec3.fromRaw(ir);return Raw.destroy(ir),{success:statusSucceed(nr),status:nr,randomPolyRef:sr,randomPoint:ar}}getPolyHeight(er,tr){const ir=new Raw.FloatRef,nr=this.raw.getPolyHeight(er,vec3.toArray(tr),ir),sr=ir.value;return Raw.destroy(ir),{success:statusSucceed(nr),status:nr,height:sr}}computePath(er,tr,ir){const nr=ir?.filter??this.defaultFilter,sr=ir?.halfExtents??this.defaultQueryHalfExtents,ar=this.findNearestPoly(er,{filter:nr,halfExtents:sr});if(!ar.success)return{success:!1,error:{name:"findNearestPoly for start position failed",status:ar.status},path:[]};const or=this.findNearestPoly(tr,{filter:nr,halfExtents:sr});if(!or.success)return{success:!1,error:{name:"findNearestPoly for end position failed",status:or.status},path:[]};const lr=ar.nearestRef,cr=or.nearestRef,ur=ir?.maxPathPolys??256,dr=this.findPath(lr,cr,er,tr,{filter:nr,maxPathPolys:ur});if(!dr.success)return{success:!1,error:{name:"findPath unsuccessful",status:dr.status},path:[]};if(dr.polys.size<=0)return{success:!1,error:{name:"no polygon path found"},path:[]};const hr=dr.polys.get(dr.polys.size-1);let pr={x:tr.x,y:tr.y,z:tr.z};if(hr!==cr){const Ar=this.closestPointOnPoly(hr,tr);if(!Ar.success)return{success:!1,error:{name:"no closest point on last polygon found",status:Ar.status},path:[]};pr=Ar.closestPoint}const gr=ir?.maxStraightPathPoints,vr=this.findStraightPath(er,pr,dr.polys,{maxStraightPathPoints:gr});if(!vr.success)return{success:!1,error:{name:"findStraightPath unsuccessful",status:vr.status},path:[]};const{straightPath:mr,straightPathCount:fr}=vr,_r=[];for(let Ar=0;Ar<fr;Ar++)_r.push({x:mr.get(Ar*3),y:mr.get(Ar*3+1),z:mr.get(Ar*3+2)});return dr.polys.destroy(),vr.straightPath.destroy(),vr.straightPathFlags.destroy(),vr.straightPathRefs.destroy(),{success:!0,path:_r}}findPath(er,tr,ir,nr,sr){const ar=sr?.filter??this.defaultFilter,or=sr?.maxPathPolys??256,lr=new UnsignedIntArray;lr.resize(or);const cr=this.raw.findPath(er,tr,vec3.toArray(ir),vec3.toArray(nr),ar.raw,lr.raw,or);return{success:statusSucceed(cr),status:cr,polys:lr}}findStraightPath(er,tr,ir,nr){const sr=nr?.maxStraightPathPoints??256,ar=nr?.straightPathOptions??0;let or;Array.isArray(ir)?(or=new UnsignedIntArray,or.copy(ir)):or=ir;const lr=new FloatArray;lr.resize(sr*3);const cr=new UnsignedCharArray;cr.resize(sr);const ur=new UnsignedIntArray;ur.resize(sr);const dr=new Raw.IntRef,hr=this.raw.findStraightPath(vec3.toArray(er),vec3.toArray(tr),or.raw,lr.raw,cr.raw,ur.raw,dr,sr,ar),pr=dr.value;return Raw.destroy(dr),Array.isArray(ir)&&or.destroy(),{success:statusSucceed(hr),status:hr,straightPath:lr,straightPathFlags:cr,straightPathRefs:ur,straightPathCount:pr}}raycast(er,tr,ir,nr){const sr=new Raw.Module.dtRaycastHit,ar=nr?.raycastOptions??0,or=nr?.prevRef??0,lr=nr?.filter?.raw??this.defaultFilter.raw,cr=this.raw.raycast(er,vec3.toArray(tr),vec3.toArray(ir),lr,ar,sr,or),ur={success:statusSucceed(cr),status:cr,t:sr.t,hitNormal:vec3.fromArray(array(dr=>sr.get_hitNormal(dr),3)),hitEdgeIndex:sr.hitEdgeIndex,path:array(dr=>sr.get_path(dr),sr.pathCount),maxPath:sr.maxPath,pathCost:sr.pathCost};return Raw.destroy(sr),ur}destroy(){this.raw.destroy()}}const crowdAgentParamsDefaults={radius:.5,height:1,maxAcceleration:20,maxSpeed:6,collisionQueryRange:2.5,pathOptimizationRange:0,separationWeight:0,updateFlags:7,obstacleAvoidanceType:0,queryFilterType:0,userData:0};class CrowdAgent{get radius(){return this.raw.params.radius}set radius(er){this.raw.params.radius=er}get height(){return this.raw.params.height}set height(er){this.raw.params.height=er}get maxAcceleration(){return this.raw.params.maxAcceleration}set maxAcceleration(er){this.raw.params.maxAcceleration=er}get maxSpeed(){return this.raw.params.maxSpeed}set maxSpeed(er){this.raw.params.maxSpeed=er}get collisionQueryRange(){return this.raw.params.collisionQueryRange}set collisionQueryRange(er){this.raw.params.collisionQueryRange=er}get pathOptimizationRange(){return this.raw.params.pathOptimizationRange}set pathOptimizationRange(er){this.raw.params.pathOptimizationRange=er}get separationWeight(){return this.raw.params.separationWeight}set separationWeight(er){this.raw.params.separationWeight=er}get updateFlags(){return this.raw.params.updateFlags}set updateFlags(er){this.raw.params.updateFlags=er}get obstacleAvoidanceType(){return this.raw.params.obstacleAvoidanceType}set obstacleAvoidanceType(er){this.raw.params.obstacleAvoidanceType=er}get queryFilterType(){return this.raw.params.queryFilterType}set queryFilterType(er){this.raw.params.queryFilterType=er}get userData(){return this.raw.params.userData}set userData(er){this.raw.params.userData=er}interpolatedPosition={x:0,y:0,z:0};constructor(er,tr){this.crowd=er,this.agentIndex=tr,this.raw=er.raw.getEditableAgent(tr),this.interpolatedPosition=this.position()}requestMoveTarget(er){const{nearestPoint:tr,nearestRef:ir}=this.crowd.navMeshQuery.findNearestPoly(er,{halfExtents:this.crowd.navMeshQuery.defaultQueryHalfExtents,filter:this.crowd.navMeshQuery.defaultFilter});return this.crowd.raw.requestMoveTarget(this.agentIndex,ir,vec3.toArray(tr))}requestMoveVelocity(er){return this.crowd.raw.requestMoveVelocity(this.agentIndex,vec3.toArray(er))}resetMoveTarget(){this.crowd.raw.resetMoveTarget(this.agentIndex)}teleport(er){Raw.CrowdUtils.agentTeleport(this.crowd.raw,this.agentIndex,vec3.toArray(er),vec3.toArray(this.crowd.navMeshQuery.defaultQueryHalfExtents),this.crowd.navMeshQuery.defaultFilter.raw),vec3.copy(er,this.interpolatedPosition)}position(){return{x:this.raw.get_npos(0),y:this.raw.get_npos(1),z:this.raw.get_npos(2)}}velocity(){return{x:this.raw.get_vel(0),y:this.raw.get_vel(1),z:this.raw.get_vel(2)}}desiredVelocity(){return{x:this.raw.get_dvel(0),y:this.raw.get_dvel(1),z:this.raw.get_dvel(2)}}desiredVelocityObstacleAdjusted(){return{x:this.raw.get_nvel(0),y:this.raw.get_nvel(1),z:this.raw.get_nvel(2)}}state(){return this.raw.state}target(){return{x:this.raw.get_targetPos(0),y:this.raw.get_targetPos(1),z:this.raw.get_targetPos(2)}}nextTargetInPath(){return{x:this.raw.get_cornerVerts(0),y:this.raw.get_cornerVerts(1),z:this.raw.get_cornerVerts(2)}}corners(){const er=[];for(let tr=0;tr<this.raw.ncorners;tr++)er.push({x:this.raw.get_cornerVerts(tr*3),y:this.raw.get_cornerVerts(tr*3+1),z:this.raw.get_cornerVerts(tr*3+2)});return er}parameters(){const{params:er}=this.raw;return{radius:er.radius,height:er.height,maxAcceleration:er.maxAcceleration,maxSpeed:er.maxSpeed,collisionQueryRange:er.collisionQueryRange,pathOptimizationRange:er.pathOptimizationRange,separationWeight:er.separationWeight,updateFlags:er.updateFlags,obstacleAvoidanceType:er.obstacleAvoidanceType,queryFilterType:er.queryFilterType,userData:er.userData}}updateParameters(er){const tr={...this.parameters(),...er};this.setParameters(tr)}setParameters(er){const tr={...crowdAgentParamsDefaults,...er},ir=new Raw.Module.dtCrowdAgentParams;ir.radius=tr.radius,ir.height=tr.height,ir.maxAcceleration=tr.maxAcceleration,ir.maxSpeed=tr.maxSpeed,ir.collisionQueryRange=tr.collisionQueryRange,ir.pathOptimizationRange=tr.pathOptimizationRange,ir.separationWeight=tr.separationWeight,ir.updateFlags=tr.updateFlags,ir.obstacleAvoidanceType=tr.obstacleAvoidanceType,ir.queryFilterType=tr.queryFilterType,ir.userData=tr.userData,this.crowd.raw.updateAgentParameters(this.agentIndex,ir)}overOffMeshConnection(){return Raw.CrowdUtils.overOffMeshConnection(this.crowd.raw,this.agentIndex)}}class Crowd{agents={};accumulator=0;constructor(er,{maxAgents:tr,maxAgentRadius:ir}){this.navMesh=er,this.raw=Raw.Detour.allocCrowd(),this.raw.init(tr,ir,er.raw.getNavMesh()),this.navMeshQuery=new NavMeshQuery(new Raw.Module.NavMeshQuery(this.raw.getNavMeshQuery()))}update(er,tr,ir=10){if(tr===void 0)this.raw.update(er,void 0);else{this.accumulator+=tr;let nr=0;for(;this.accumulator>=er&&nr<ir;)this.raw.update(er,void 0),this.accumulator-=er,nr++;const sr=this.accumulator%er/er,ar=this.getAgents();for(const or of ar)vec3.lerp(or.interpolatedPosition,or.position(),sr,or.interpolatedPosition)}}addAgent(er,tr){const ir={...crowdAgentParamsDefaults,...tr},nr=new Raw.Module.dtCrowdAgentParams;nr.radius=ir.radius,nr.height=ir.height,nr.maxAcceleration=ir.maxAcceleration,nr.maxSpeed=ir.maxSpeed,nr.collisionQueryRange=ir.collisionQueryRange,nr.pathOptimizationRange=ir.pathOptimizationRange,nr.separationWeight=ir.separationWeight,nr.updateFlags=ir.updateFlags,nr.obstacleAvoidanceType=ir.obstacleAvoidanceType,nr.queryFilterType=ir.queryFilterType,nr.userData=ir.userData;const sr=this.raw.addAgent(vec3.toArray(er),nr),ar=new CrowdAgent(this,sr);return this.agents[sr]=ar,ar}getAgent(er){const tr=this.agents[er];return tr||null}removeAgent(er){const tr=typeof er=="number"?er:er.agentIndex;this.raw.removeAgent(tr),delete this.agents[tr]}getAgentCount(){return this.raw.getAgentCount()}getActiveAgentCount(){return Raw.CrowdUtils.getActiveAgentCount(this.raw)}getAgents(){return Object.values(this.agents)}getFilter(er){return new QueryFilter(this.raw.getEditableFilter(er))}destroy(){Raw.Detour.freeCrowd(this.raw)}}class DebugDrawerUtils{currentPrimitiveType=0;currentVertices=[];primitives=[];constructor(){this.debugDrawImpl=new Raw.Module.DebugDrawImpl,this.debugDrawImpl.handleBegin=(tr,ir)=>{this.currentPrimitiveType=tr,this.currentVertices=[]},this.debugDrawImpl.handleDepthMask=tr=>{},this.debugDrawImpl.handleTexture=tr=>{},this.debugDrawImpl.handleVertexWithColor=(tr,ir,nr,sr)=>{this.vertex(tr,ir,nr,sr)},this.debugDrawImpl.handleVertexWithColorAndUV=(tr,ir,nr,sr,ar,or)=>{this.vertex(tr,ir,nr,sr)};const er={[Raw.Module.DU_DRAW_LINES]:"lines",[Raw.Module.DU_DRAW_TRIS]:"tris",[Raw.Module.DU_DRAW_QUADS]:"quads",[Raw.Module.DU_DRAW_POINTS]:"points"};this.debugDrawImpl.handleEnd=()=>{const tr=er[this.currentPrimitiveType];this.primitives.push({type:tr,vertices:this.currentVertices})}}flush(){const er=this.primitives;return this.primitives=[],er}drawHeightfieldSolid(er){return Raw.RecastDebugDraw.debugDrawHeightfieldSolid(this.debugDrawImpl,er.raw),this.flush()}drawHeightfieldWalkable(er){return Raw.RecastDebugDraw.debugDrawHeightfieldWalkable(this.debugDrawImpl,er.raw),this.flush()}drawCompactHeightfieldSolid(er){return Raw.RecastDebugDraw.debugDrawCompactHeightfieldSolid(this.debugDrawImpl,er.raw),this.flush()}drawCompactHeightfieldRegions(er){return Raw.RecastDebugDraw.debugDrawCompactHeightfieldRegions(this.debugDrawImpl,er.raw),this.flush()}drawCompactHeightfieldDistance(er){return Raw.RecastDebugDraw.debugDrawCompactHeightfieldDistance(this.debugDrawImpl,er.raw),this.flush()}drawHeightfieldLayer(er,tr){return Raw.RecastDebugDraw.debugDrawHeightfieldLayer(this.debugDrawImpl,er.raw,tr),this.flush()}drawHeightfieldLayers(er){return Raw.RecastDebugDraw.debugDrawHeightfieldLayers(this.debugDrawImpl,er.raw),this.flush()}drawRegionConnections(er,tr=1){return Raw.RecastDebugDraw.debugDrawRegionConnections(this.debugDrawImpl,er.raw,tr),this.flush()}drawRawContours(er,tr=1){return Raw.RecastDebugDraw.debugDrawRawContours(this.debugDrawImpl,er.raw,tr),this.flush()}drawContours(er,tr=1){return Raw.RecastDebugDraw.debugDrawContours(this.debugDrawImpl,er.raw,tr),this.flush()}drawPolyMesh(er){return Raw.RecastDebugDraw.debugDrawPolyMesh(this.debugDrawImpl,er.raw),this.flush()}drawPolyMeshDetail(er){return Raw.RecastDebugDraw.debugDrawPolyMeshDetail(this.debugDrawImpl,er.raw),this.flush()}drawNavMesh(er,tr=0){return Raw.DetourDebugDraw.debugDrawNavMesh(this.debugDrawImpl,er.raw.getNavMesh(),tr),this.flush()}drawNavMeshWithClosedList(er,tr,ir=0){return Raw.DetourDebugDraw.debugDrawNavMeshWithClosedList(this.debugDrawImpl,er.raw.m_navMesh,tr.raw.m_navQuery,ir),this.flush()}drawNavMeshNodes(er){return Raw.DetourDebugDraw.debugDrawNavMeshNodes(this.debugDrawImpl,er.raw.m_navQuery),this.flush()}drawNavMeshBVTree(er){return Raw.DetourDebugDraw.debugDrawNavMeshBVTree(this.debugDrawImpl,er.raw.m_navMesh),this.flush()}drawNavMeshPortals(er){return Raw.DetourDebugDraw.debugDrawNavMeshPortals(this.debugDrawImpl,er.raw.m_navMesh),this.flush()}drawNavMeshPolysWithFlags(er,tr,ir){return Raw.DetourDebugDraw.debugDrawNavMeshPolysWithFlags(this.debugDrawImpl,er.raw.m_navMesh,tr,ir),this.flush()}drawNavMeshPoly(er,tr,ir){return Raw.DetourDebugDraw.debugDrawNavMeshPoly(this.debugDrawImpl,er.raw.m_navMesh,tr,ir),this.flush()}dispose(){Raw.Module.destroy(this.debugDrawImpl)}vertex(er,tr,ir,nr){const sr=(nr>>16&255)/255,ar=(nr>>8&255)/255,or=(nr&255)/255,lr=(nr>>24&255)/255;this.currentVertices.push([er,tr,ir,sr,ar,or,lr])}}class NavMeshGetTilesAtResult{constructor(er){this.raw=er}tiles(er){return new DetourMeshTile(this.raw.get_tiles(er))}tileCount(){return this.raw.tileCount}}class NavMeshRemoveTileResult{constructor(er){this.raw=er}data(){return array(er=>this.raw.get_data(er),this.raw.dataSize)}dataSize(){return this.raw.dataSize}}class NavMeshCalcTileLocResult{constructor(er){this.raw=er}tileX(){return this.raw.tileX}tileY(){return this.raw.tileY}}class NavMeshStoreTileStateResult{constructor(er){this.raw=er}data(){return array(er=>this.raw.get_data(er),this.raw.dataSize)}dataSize(){return this.raw.dataSize}}class NavMeshParams{constructor(er){this.raw=er}static create(er){const tr=new Raw.Module.dtNavMeshParams;return tr.set_orig(0,er.orig.x),tr.set_orig(1,er.orig.y),tr.set_orig(2,er.orig.z),tr.tileWidth=er.tileWidth,tr.tileHeight=er.tileHeight,tr.maxTiles=er.maxTiles,tr.maxPolys=er.maxPolys,new NavMeshParams(tr)}clone(){return NavMeshParams.create({orig:{x:this.raw.get_orig(0),y:this.raw.get_orig(1),z:this.raw.get_orig(2)},tileWidth:this.raw.tileWidth,tileHeight:this.raw.tileHeight,maxTiles:this.raw.maxTiles,maxPolys:this.raw.maxPolys})}}class NavMesh{constructor(er){this.raw=er??new Raw.Module.NavMesh}initSolo(er){return this.raw.initSolo(er.raw)}initTiled(er){return this.raw.initTiled(er.raw)}addTile(er,tr,ir){const nr=new Raw.UnsignedIntRef,sr=this.raw.addTile(er.raw,tr,ir,nr),ar=nr.value;return Raw.destroy(nr),{status:sr,tileRef:ar}}decodePolyId(er){const tr=new Raw.UnsignedIntRef,ir=new Raw.UnsignedIntRef,nr=new Raw.UnsignedIntRef;this.raw.decodePolyId(er,tr,ir,nr);const sr=tr.value;Raw.destroy(tr);const ar=ir.value;Raw.destroy(ir);const or=nr.value;return Raw.destroy(nr),{tileSalt:sr,tileIndex:ar,tilePolygonIndex:or}}encodePolyId(er,tr,ir){return this.raw.encodePolyId(er,tr,ir)}removeTile(er){return new NavMeshRemoveTileResult(this.raw.removeTile(er))}calcTileLoc(er){return new NavMeshCalcTileLocResult(this.raw.calcTileLoc(vec3.toArray(er)))}getTileAt(er,tr,ir){const nr=this.raw.getTileAt(er,tr,ir);return Raw.isNull(nr)?null:new DetourMeshTile(nr)}getTilesAt(er,tr,ir){return new NavMeshGetTilesAtResult(this.raw.getTilesAt(er,tr,ir))}getTileRefAt(er,tr,ir){return this.raw.getTileRefAt(er,tr,ir)}getTileRef(er){return this.raw.getTileRef(er.raw)}getTileByRef(er){const tr=this.raw.getTileByRef(er);return Raw.isNull(tr)?null:new DetourMeshTile(tr)}getMaxTiles(){return this.raw.getMaxTiles()}getTile(er){return new DetourMeshTile(this.raw.getTile(er))}getTileAndPolyByRef(er){const tr=this.raw.getTileAndPolyByRef(er),ir=new DetourMeshTile(tr.tile),nr=new DetourPoly(tr.poly);return{success:statusSucceed(tr.status),status:tr.status,tile:ir,poly:nr}}getTileAndPolyByRefUnsafe(er){const tr=this.raw.getTileAndPolyByRef(er),ir=new DetourMeshTile(tr.tile),nr=new DetourPoly(tr.poly);return{tile:ir,poly:nr}}isValidPolyRef(er){return this.raw.isValidPolyRef(er)}getPolyRefBase(er){return this.raw.getPolyRefBase(er.raw)}getOffMeshConnectionPolyEndPoints(er,tr){const ir=new Raw.Vec3,nr=new Raw.Vec3,sr=this.raw.getOffMeshConnectionPolyEndPoints(er,tr,ir,nr),ar=vec3.fromRaw(ir);Raw.destroy(ir);const or=vec3.fromRaw(nr);return Raw.destroy(nr),{success:statusSucceed(sr),status:sr,start:ar,end:or}}getOffMeshConnectionByRef(er){return new DetourOffMeshConnection(this.raw.getOffMeshConnectionByRef(er))}setPolyFlags(er,tr){return this.raw.setPolyFlags(er,tr)}getPolyFlags(er){const tr=new Raw.UnsignedShortRef,ir=this.raw.getPolyFlags(er,tr),nr=tr.value;return Raw.destroy(tr),{status:ir,flags:nr}}setPolyArea(er,tr){return this.raw.setPolyArea(er,tr)}getPolyArea(er){const tr=new Raw.UnsignedCharRef,ir=this.raw.getPolyArea(er,tr),nr=tr.value;return Raw.destroy(tr),{status:ir,area:nr}}getTileStateSize(er){return this.raw.getTileStateSize(er.raw)}storeTileState(er,tr){return new NavMeshStoreTileStateResult(this.raw.storeTileState(er.raw,tr))}restoreTileState(er,tr,ir){return this.raw.restoreTileState(er.raw,tr,ir)}getDebugNavMesh(){const er=[],tr=[];let ir=0;const nr=this.getMaxTiles();for(let sr=0;sr<nr;sr++){const ar=this.getTile(sr),or=ar.header();if(!or)continue;const lr=or.polyCount();for(let cr=0;cr<lr;++cr){const ur=ar.polys(cr);if(ur.getType()===1)continue;const dr=ur.vertCount(),hr=ar.detailMeshes(cr),pr=hr.triBase(),gr=hr.triCount();for(let vr=0;vr<gr;++vr){const mr=(pr+vr)*4;for(let fr=0;fr<3;++fr){if(ar.detailTris(mr+fr)<dr){const _r=ur.verts(ar.detailTris(mr+fr))*3;er.push(ar.verts(_r),ar.verts(_r+1),ar.verts(_r+2))}else{const _r=(hr.vertBase()+ar.detailTris(mr+fr)-ur.vertCount())*3;er.push(ar.detailVerts(_r),ar.detailVerts(_r+1),ar.detailVerts(_r+2))}tr.push(ir++)}}}}return[er,tr]}destroy(){this.raw.destroy(),Raw.Module.destroy(this.raw)}}const getRandomSeed=()=>Raw.Module.FastRand.prototype.getSeed(),setRandomSeed=rr=>{Raw.Module.FastRand.prototype.setSeed(rr)},recastConfigDefaults={borderSize:0,tileSize:0,cs:.2,ch:.2,walkableSlopeAngle:60,walkableHeight:2,walkableClimb:2,walkableRadius:.5,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:1},createRcConfig=rr=>{const er={...recastConfigDefaults,...rr},tr=new Raw.Module.rcConfig;return tr.borderSize=er.borderSize,tr.tileSize=er.tileSize,tr.cs=er.cs,tr.ch=er.ch,tr.walkableSlopeAngle=er.walkableSlopeAngle,tr.walkableHeight=er.walkableHeight,tr.walkableClimb=er.walkableClimb,tr.walkableRadius=er.walkableRadius,tr.maxEdgeLen=er.maxEdgeLen,tr.maxSimplificationError=er.maxSimplificationError,tr.minRegionArea=er.minRegionArea,tr.mergeRegionArea=er.mergeRegionArea,tr.maxVertsPerPoly=er.maxVertsPerPoly,tr.detailSampleDist=er.detailSampleDist,tr.detailSampleMaxError=er.detailSampleMaxError,tr},cloneRcConfig=rr=>{const er=new Raw.Module.rcConfig;return er.set_bmin(0,rr.get_bmin(0)),er.set_bmin(1,rr.get_bmin(1)),er.set_bmin(2,rr.get_bmin(2)),er.set_bmax(0,rr.get_bmax(0)),er.set_bmax(1,rr.get_bmax(1)),er.set_bmax(2,rr.get_bmax(2)),er.width=rr.width,er.height=rr.height,er.borderSize=rr.borderSize,er.tileSize=rr.tileSize,er.cs=rr.cs,er.ch=rr.ch,er.walkableSlopeAngle=rr.walkableSlopeAngle,er.walkableHeight=rr.walkableHeight,er.walkableClimb=rr.walkableClimb,er.walkableRadius=rr.walkableRadius,er.maxEdgeLen=rr.maxEdgeLen,er.maxSimplificationError=rr.maxSimplificationError,er.minRegionArea=rr.minRegionArea,er.mergeRegionArea=rr.mergeRegionArea,er.maxVertsPerPoly=rr.maxVertsPerPoly,er.detailSampleDist=rr.detailSampleDist,er.detailSampleMaxError=rr.detailSampleMaxError,er};class RecastBuildContext{logs=[];startTimes={};accumulatedTimes={};constructor(er=!0){const tr=new Raw.Module.RecastBuildContextImpl;tr.log=(ir,nr,sr)=>{if(!this.raw.logEnabled())return;const ar=nr,or=new Uint8Array(Raw.Module.HEAPU8.buffer,ar,sr),lr=new Uint8Array(sr);lr.set(or);const cr=new TextDecoder().decode(lr);this.log(ir,cr)},tr.resetLog=()=>{this.resetLog()},tr.startTimer=ir=>{this.raw.timerEnabled()&&this.startTimer(ir)},tr.stopTimer=ir=>{this.raw.timerEnabled()&&this.stopTimer(ir)},tr.getAccumulatedTime=ir=>this.raw.timerEnabled()?this.getAccumulatedTime(ir):-1,tr.resetTimers=()=>{this.raw.timerEnabled()&&(this.startTimes={},this.accumulatedTimes={})},this.raw=new Raw.Module.RecastBuildContext(tr),this.raw.enableTimer(er),this.raw.enableLog(er),this.resetTimers()}log(er,tr){this.logs.push({category:er,msg:tr})}resetLog(){this.logs=[]}startTimer(er){this.startTimes[er]=performance.now()}stopTimer(er){const ir=performance.now()-this.startTimes[er];this.accumulatedTimes[er]===-1?this.accumulatedTimes[er]=ir:this.accumulatedTimes[er]+=ir}getAccumulatedTime(er){return this.accumulatedTimes[er]}resetTimers(){for(let er=0;er<Recast.RC_MAX_TIMERS;er++)this.startTimes[er]=-1,this.accumulatedTimes[er]=-1}}class RecastChunkyTriMesh{constructor(er){this.raw=er??new Raw.rcChunkyTriMesh}init(er,tr,ir,nr){return Raw.ChunkyTriMeshUtils.createChunkyTriMesh(er.raw,tr.raw,ir,nr,this.raw)}getChunksOverlappingRect(er,tr,ir,nr){return Raw.ChunkyTriMeshUtils.getChunksOverlappingRect(this.raw,er,tr,ir.raw,nr)}getNodeTris(er){return IntArray.fromRaw(Raw.ChunkyTriMeshUtils.getChunkyTriMeshNodeTris(this.raw,er))}nodes(er){return this.raw.get_nodes(er)}maxTrisPerChunk(){return this.raw.maxTrisPerChunk}}class RecastSpan{constructor(er){this.raw=er}smin(){return this.raw.smin}smax(){return this.raw.smax}area(){return this.raw.area}next(){return Raw.isNull(this.raw.next)?null:new RecastSpan(this.raw.next)}}class RecastSpanPool{constructor(er){this.raw=er}next(){return Raw.isNull(this.raw.next)?null:new RecastSpanPool(this.raw.next)}items(er){return new RecastSpan(this.raw.get_items(er))}}class RecastHeightfield{constructor(er){this.raw=er}width(){return this.raw.width}height(){return this.raw.height}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}cs(){return this.raw.cs}ch(){return this.raw.ch}spans(er){return new RecastSpan(this.raw.get_spans(er))}pools(er){return new RecastSpanPool(this.raw.get_pools(er))}freelist(er){return new RecastSpan(this.raw.get_freelist(er))}}class RecastCompactCell{constructor(er){this.raw=er}index(){return this.raw.get_index()}count(){return this.raw.get_count()}}class RecastCompactSpan{constructor(er){this.raw=er}y(){return this.raw.get_y()}reg(){return this.raw.get_reg()}con(){return this.raw.get_con()}h(){return this.raw.get_h()}}class RecastCompactHeightfield{constructor(er){this.raw=er}width(){return this.raw.width}height(){return this.raw.height}spanCount(){return this.raw.spanCount}walkableHeight(){return this.raw.walkableHeight}walkableClimb(){return this.raw.walkableClimb}borderSize(){return this.raw.borderSize}maxDistance(){return this.raw.maxDistance}maxRegions(){return this.raw.maxRegions}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}cs(){return this.raw.cs}ch(){return this.raw.ch}cells(er){return new RecastCompactCell(this.raw.get_cells(er))}spans(er){return new RecastCompactSpan(this.raw.get_spans(er))}dist(er){return this.raw.get_dist(er)}areas(er){return this.raw.get_areas(er)}}class RecastContour{constructor(er){this.raw=er}verts(er){return this.raw.get_verts(er)}nverts(){return this.raw.nverts}rverts(er){return this.raw.get_rverts(er)}nrverts(){return this.raw.nrverts}reg(){return this.raw.reg}area(){return this.raw.area}}class RecastContourSet{constructor(er){this.raw=er}conts(er){return new RecastContour(this.raw.get_conts(er))}nconts(){return this.raw.nconts}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}cs(){return this.raw.cs}ch(){return this.raw.ch}width(){return this.raw.width}height(){return this.raw.height}borderSize(){return this.raw.borderSize}maxError(){return this.raw.maxError}}class RecastHeightfieldLayer{constructor(er){this.raw=er}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}cs(){return this.raw.cs}ch(){return this.raw.ch}width(){return this.raw.width}height(){return this.raw.height}minx(){return this.raw.minx}maxx(){return this.raw.maxx}miny(){return this.raw.miny}maxy(){return this.raw.maxy}hmin(){return this.raw.hmin}hmax(){return this.raw.hmax}heights(er){return this.raw.get_heights(er)}areas(er){return this.raw.get_areas(er)}cons(er){return this.raw.get_cons(er)}}class RecastHeightfieldLayerSet{constructor(er){this.raw=er}layers(er){return new RecastHeightfieldLayer(this.raw.get_layers(er))}nlayers(){return this.raw.nlayers}}class RecastPolyMesh{constructor(er){this.raw=er}verts(er){return this.raw.get_verts(er)}polys(er){return this.raw.get_polys(er)}regs(er){return this.raw.get_regs(er)}flags(er){return this.raw.get_flags(er)}setFlags(er,tr){this.raw.set_flags(er,tr)}areas(er){return this.raw.get_areas(er)}setAreas(er,tr){return this.raw.set_areas(er,tr)}nverts(){return this.raw.nverts}npolys(){return this.raw.npolys}maxpolys(){return this.raw.maxpolys}nvp(){return this.raw.nvp}bmin(){return vec3.fromArray(array(er=>this.raw.get_bmin(er),3))}bmax(){return vec3.fromArray(array(er=>this.raw.get_bmax(er),3))}cs(){return this.raw.cs}ch(){return this.raw.ch}borderSize(){return this.raw.borderSize}maxEdgeError(){return this.raw.maxEdgeError}}class RecastPolyMeshDetail{constructor(er){this.raw=er}meshes(er){return this.raw.get_meshes(er)}verts(er){return this.raw.get_verts(er)}tris(er){return this.raw.get_tris(er)}nmeshes(){return this.raw.nmeshes}nverts(){return this.raw.nverts}ntris(){return this.raw.ntris}}const calcBounds=(rr,er)=>Raw.Recast.calcBounds(rr.raw,er),calcGridSize=(rr,er,tr)=>Raw.Recast.calcGridSize(rr,er,tr),createHeightfield=(rr,er,tr,ir,nr,sr,ar,or)=>Raw.Recast.createHeightfield(rr.raw,er.raw,tr,ir,nr,sr,ar,or),markWalkableTriangles=(rr,er,tr,ir,nr,sr,ar)=>Raw.Recast.markWalkableTriangles(rr.raw,er,tr.raw,ir,nr.raw,sr,ar.raw),clearUnwalkableTriangles=(rr,er,tr,ir,nr,sr,ar)=>Raw.Recast.clearUnwalkableTriangles(rr.raw,er,tr.raw,ir,nr.raw,sr,ar.raw),rasterizeTriangles=(rr,er,tr,ir,nr,sr,ar,or=1)=>Raw.Recast.rasterizeTriangles(rr.raw,er.raw,tr,ir.raw,nr.raw,sr,ar.raw,or),filterLowHangingWalkableObstacles=(rr,er,tr)=>Raw.Recast.filterLowHangingWalkableObstacles(rr.raw,er,tr.raw),filterLedgeSpans=(rr,er,tr,ir)=>Raw.Recast.filterLedgeSpans(rr.raw,er,tr,ir.raw),filterWalkableLowHeightSpans=(rr,er,tr)=>Raw.Recast.filterWalkableLowHeightSpans(rr.raw,er,tr.raw),getHeightFieldSpanCount=(rr,er)=>Raw.Recast.getHeightFieldSpanCount(rr.raw,er.raw),buildCompactHeightfield=(rr,er,tr,ir,nr)=>Raw.Recast.buildCompactHeightfield(rr.raw,er,tr,ir.raw,nr.raw),erodeWalkableArea=(rr,er,tr)=>Raw.Recast.erodeWalkableArea(rr.raw,er,tr.raw),medianFilterWalkableArea=(rr,er)=>Raw.Recast.medianFilterWalkableArea(rr.raw,er.raw),markBoxArea=(rr,er,tr,ir,nr)=>Raw.Recast.markBoxArea(rr.raw,er,tr,ir,nr.raw),markConvexPolyArea=(rr,er,tr,ir,nr,sr,ar)=>Raw.Recast.markConvexPolyArea(rr.raw,er.raw,tr,ir,nr,sr,ar.raw),markCylinderArea=(rr,er,tr,ir,nr,sr)=>Raw.Recast.markCylinderArea(rr.raw,er,tr,ir,nr,sr.raw),buildDistanceField=(rr,er)=>Raw.Recast.buildDistanceField(rr.raw,er.raw),buildRegions=(rr,er,tr,ir,nr)=>Raw.Recast.buildRegions(rr.raw,er.raw,tr,ir,nr),buildLayerRegions=(rr,er,tr,ir)=>Raw.Recast.buildLayerRegions(rr.raw,er.raw,tr,ir),buildRegionsMonotone=(rr,er,tr,ir,nr)=>Raw.Recast.buildRegionsMonotone(rr.raw,er.raw,tr,ir,nr),setCon=(rr,er,tr)=>Raw.Recast.setCon(rr.raw,er,tr),getCon=(rr,er)=>Raw.Recast.getCon(rr.raw,er),getDirOffsetX=rr=>Raw.Recast.getDirOffsetX(rr),getDirOffsetY=rr=>Raw.Recast.getDirOffsetY(rr),getDirForOffset=(rr,er)=>Raw.Recast.getDirForOffset(rr,er),buildHeightfieldLayers=(rr,er,tr,ir,nr)=>Raw.Recast.buildHeightfieldLayers(rr.raw,er.raw,tr,ir,nr.raw),buildContours=(rr,er,tr,ir,nr,sr=Recast.RC_CONTOUR_TESS_WALL_EDGES)=>Raw.Recast.buildContours(rr.raw,er.raw,tr,ir,nr.raw,sr),buildPolyMesh=(rr,er,tr,ir)=>Raw.Recast.buildPolyMesh(rr.raw,er.raw,tr,ir.raw),mergePolyMeshes=(rr,er,tr)=>Raw.Recast.mergePolyMeshes(rr.raw,er.map(ir=>ir.raw),er.length,tr.raw),buildPolyMeshDetail=(rr,er,tr,ir,nr,sr)=>Raw.Recast.buildPolyMeshDetail(rr.raw,er.raw,tr.raw,ir,nr,sr.raw),copyPolyMesh=(rr,er,tr)=>Raw.Recast.copyPolyMesh(rr.raw,er.raw,tr.raw),mergePolyMeshDetails=(rr,er,tr)=>Raw.Recast.mergePolyMeshDetails(rr.raw,er.map(ir=>ir.raw),er.length,tr.raw),getHeightfieldLayerHeights=rr=>UnsignedCharArray.fromRaw(Raw.Recast.getHeightfieldLayerHeights(rr.raw)),getHeightfieldLayerAreas=rr=>UnsignedCharArray.fromRaw(Raw.Recast.getHeightfieldLayerAreas(rr.raw)),getHeightfieldLayerCons=rr=>UnsignedCharArray.fromRaw(Raw.Recast.getHeightfieldLayerCons(rr.raw)),allocHeightfield=()=>new RecastHeightfield(Raw.Recast.allocHeightfield()),freeHeightfield=rr=>Raw.Recast.freeHeightfield(rr.raw),allocCompactHeightfield=()=>new RecastCompactHeightfield(Raw.Recast.allocCompactHeightfield()),freeCompactHeightfield=rr=>Raw.Recast.freeCompactHeightfield(rr.raw),allocHeightfieldLayerSet=()=>new RecastHeightfieldLayerSet(Raw.Recast.allocHeightfieldLayerSet()),freeHeightfieldLayerSet=rr=>Raw.Recast.freeHeightfieldLayerSet(rr.raw),allocContourSet=()=>new RecastContourSet(Raw.Recast.allocContourSet()),freeContourSet=rr=>Raw.Recast.freeContourSet(rr.raw),allocPolyMesh=()=>new RecastPolyMesh(Raw.Recast.allocPolyMesh()),freePolyMesh=rr=>Raw.Recast.freePolyMesh(rr.raw),allocPolyMeshDetail=()=>new RecastPolyMeshDetail(Raw.Recast.allocPolyMeshDetail()),freePolyMeshDetail=rr=>Raw.Recast.freePolyMeshDetail(rr.raw),exportImpl=(rr,er)=>{const tr=Raw.NavMeshExporter.exportNavMesh(rr.raw,er?.raw),ir=new Uint8Array(Raw.Module.HEAPU8.buffer,tr.dataPointer,tr.size),nr=new Uint8Array(tr.size);return nr.set(ir),Raw.NavMeshExporter.freeNavMeshExport(tr),nr},exportNavMesh=rr=>exportImpl(rr),exportTileCache=(rr,er)=>exportImpl(rr,er);class DetourTileCacheParams{constructor(er){this.raw=er}static create(er){const tr=new Raw.Module.dtTileCacheParams;return tr.set_orig(0,er.orig[0]),tr.set_orig(1,er.orig[1]),tr.set_orig(2,er.orig[2]),tr.set_cs(er.cs),tr.set_ch(er.ch),tr.set_width(er.width),tr.set_height(er.height),tr.set_walkableHeight(er.walkableHeight),tr.set_walkableRadius(er.walkableRadius),tr.set_walkableClimb(er.walkableClimb),tr.set_maxSimplificationError(er.maxSimplificationError),tr.set_maxTiles(er.maxTiles),tr.set_maxObstacles(er.maxObstacles),new DetourTileCacheParams(tr)}}class TileCache{obstacles=new Map;constructor(er){this.raw=er??new Raw.Module.TileCache}init(er,tr,ir,nr){return this.raw.init(er.raw,tr,ir,nr.raw)}update(er){const{status:tr,upToDate:ir}=this.raw.update(er.raw);return{success:statusSucceed(tr),status:tr,upToDate:ir}}addCylinderObstacle(er,tr,ir){const nr=this.raw.addCylinderObstacle(vec3.toRaw(er),tr,ir);if(nr.status!==Detour.DT_SUCCESS)return{success:!1,status:nr.status};const sr=nr.ref,ar={type:"cylinder",ref:sr,position:er,radius:tr,height:ir};return this.obstacles.set(sr,ar),{success:!0,status:nr.status,obstacle:ar}}addBoxObstacle(er,tr,ir){const nr=vec3.toRaw(er),sr=vec3.toRaw(tr),ar=this.raw.addBoxObstacle(nr,sr,ir);if(Raw.destroy(nr),Raw.destroy(sr),ar.status!==Detour.DT_SUCCESS)return{success:!1,status:ar.status};const or=ar.ref,lr={type:"box",ref:or,position:er,halfExtents:tr,angle:ir};return this.obstacles.set(or,lr),{success:!0,status:ar.status,obstacle:lr}}removeObstacle(er){let tr;typeof er=="object"?tr=er.ref:tr=er,this.obstacles.delete(tr);const ir=this.raw.removeObstacle(tr);return{success:statusSucceed(ir),status:ir}}addTile(er,tr=Detour.DT_COMPRESSEDTILE_FREE_DATA){return this.raw.addTile(er.raw,tr)}buildNavMeshTile(er,tr){return this.raw.buildNavMeshTile(er,tr.raw)}buildNavMeshTilesAt(er,tr,ir){return this.raw.buildNavMeshTilesAt(er,tr,ir.raw)}destroy(){this.raw.destroy()}}class TileCacheMeshProcess{constructor(er){this.raw=new Raw.Module.TileCacheMeshProcess,this.raw.process=(tr,ir,nr)=>{const sr=new NavMeshCreateParams(Raw.Module.wrapPointer(tr,Raw.Module.dtNavMeshCreateParams)),ar=Raw.Module.wrapPointer(ir,Raw.Module.UnsignedCharArray),or=Raw.Module.wrapPointer(nr,Raw.Module.UnsignedShortArray);er(sr,UnsignedCharArray.fromRaw(ar),UnsignedShortArray.fromRaw(or))}}}const buildTileCacheLayer=(rr,er,tr,ir,nr,sr)=>Raw.DetourTileCacheBuilder.buildTileCacheLayer(rr,er,tr.raw,ir.raw,nr.raw,sr.raw),createNavMeshExport=rr=>{const er=rr.length*rr.BYTES_PER_ELEMENT,tr=Raw.Module._malloc(er),ir=new Uint8Array(Raw.Module.HEAPU8.buffer,tr,er);ir.set(rr);const nr=new Raw.Module.NavMeshExport;return nr.dataPointer=ir.byteOffset,nr.size=rr.length,{navMeshExport:nr,dataHeap:ir}},importNavMesh=rr=>{const{navMeshExport:er,dataHeap:tr}=createNavMeshExport(rr),ir=Raw.NavMeshImporter.importNavMesh(er,void 0);return Raw.Module._free(tr.byteOffset),{navMesh:new NavMesh(ir.navMesh)}},importTileCache=(rr,er)=>{const{navMeshExport:tr,dataHeap:ir}=createNavMeshExport(rr),nr=Raw.NavMeshImporter.importNavMesh(tr,er.raw);Raw.Module._free(ir.byteOffset);const sr=new NavMesh(nr.navMesh),ar=new TileCache(nr.tileCache),or=nr.allocator,lr=nr.compressor;return{navMesh:sr,tileCache:ar,allocator:or,compressor:lr}},getBoundingBox$1=(rr,er)=>{const tr={x:1/0,y:1/0,z:1/0},ir={x:-1/0,y:-1/0,z:-1/0};for(let nr=0;nr<er.length;nr++){const sr=er[nr],ar=rr[sr*3],or=rr[sr*3+1],lr=rr[sr*3+2];tr.x=Math.min(tr.x,ar),tr.y=Math.min(tr.y,or),tr.z=Math.min(tr.z,lr),ir.x=Math.max(ir.x,ar),ir.y=Math.max(ir.y,or),ir.z=Math.max(ir.z,lr)}return{bbMin:vec3.toArray(tr),bbMax:vec3.toArray(ir)}},dtIlog2=rr=>{let er=0,tr=0;return er=+(rr>65535)<<4,rr>>=er,tr=+(rr>255)<<3,rr>>=tr,er|=tr,tr=+(rr>15)<<2,rr>>=tr,er|=tr,tr=+(rr>3)<<1,rr>>=tr,er|=tr,er|=rr>>1,er},dtNextPow2=rr=>(rr--,rr|=rr>>1,rr|=rr>>2,rr|=rr>>4,rr|=rr>>8,rr|=rr>>16,rr++,rr),soloNavMeshGeneratorConfigDefaults={...recastConfigDefaults},generateSoloNavMesh=(rr,er,tr={},ir=!1)=>{if(!Raw.Module)throw new Error('"init" must be called before using any recast-navigation-js APIs. See: https://github.com/isaac-mason/recast-navigation-js?tab=readme-ov-file#initialization');const nr=new RecastBuildContext,sr={type:"solo",buildContext:nr},ar=new NavMesh,or=()=>{ir||(sr.heightfield&&(freeHeightfield(sr.heightfield),sr.heightfield=void 0),sr.compactHeightfield&&(freeCompactHeightfield(sr.compactHeightfield),sr.compactHeightfield=void 0),sr.contourSet&&(freeContourSet(sr.contourSet),sr.contourSet=void 0),sr.polyMesh&&(freePolyMesh(sr.polyMesh),sr.polyMesh=void 0),sr.polyMeshDetail&&(freePolyMeshDetail(sr.polyMeshDetail),sr.polyMeshDetail=void 0))},lr=Pr=>(or(),ar.destroy(),{navMesh:void 0,success:!1,intermediates:sr,error:Pr}),cr=rr,ur=er.length,dr=new VerticesArray;dr.copy(cr);const hr=er,pr=er.length/3,gr=new TrianglesArray;gr.copy(hr);const{bbMin:vr,bbMax:mr}=getBoundingBox$1(rr,er),fr=createRcConfig({...soloNavMeshGeneratorConfigDefaults,...tr});fr.minRegionArea=fr.minRegionArea*fr.minRegionArea,fr.mergeRegionArea=fr.mergeRegionArea*fr.mergeRegionArea,fr.detailSampleDist=fr.detailSampleDist<.9?0:fr.cs*fr.detailSampleDist,fr.detailSampleMaxError=fr.ch*fr.detailSampleMaxError;const _r=calcGridSize(vr,mr,fr.cs);fr.width=_r.width,fr.height=_r.height;const Ar=allocHeightfield();if(sr.heightfield=Ar,!createHeightfield(nr,Ar,fr.width,fr.height,vr,mr,fr.cs,fr.ch))return lr("Could not create heightfield");const yr=new TriangleAreasArray;if(yr.resize(pr),markWalkableTriangles(nr,fr.walkableSlopeAngle,dr,ur,gr,pr,yr),!rasterizeTriangles(nr,dr,ur,gr,yr,pr,Ar,fr.walkableClimb))return lr("Could not rasterize triangles");yr.destroy(),dr.destroy(),gr.destroy(),filterLowHangingWalkableObstacles(nr,fr.walkableClimb,Ar),filterLedgeSpans(nr,fr.walkableHeight,fr.walkableClimb,Ar),filterWalkableLowHeightSpans(nr,fr.walkableHeight,Ar);const wr=allocCompactHeightfield();if(sr.compactHeightfield=wr,!buildCompactHeightfield(nr,fr.walkableHeight,fr.walkableClimb,Ar,wr))return lr("Failed to build compact data");if(ir||(freeHeightfield(Ar),sr.heightfield=void 0),!erodeWalkableArea(nr,fr.walkableRadius,wr))return lr("Failed to erode walkable area");if(!buildDistanceField(nr,wr))return lr("Failed to build distance field");if(!buildRegions(nr,wr,fr.borderSize,fr.minRegionArea,fr.mergeRegionArea))return lr("Failed to build regions");const xr=allocContourSet();if(sr.contourSet=xr,!buildContours(nr,wr,fr.maxSimplificationError,fr.maxEdgeLen,xr,Recast.RC_CONTOUR_TESS_WALL_EDGES))return lr("Failed to create contours");const Sr=allocPolyMesh();if(sr.polyMesh=Sr,!buildPolyMesh(nr,xr,fr.maxVertsPerPoly,Sr))return lr("Failed to triangulate contours");const br=allocPolyMeshDetail();if(sr.polyMeshDetail=br,!buildPolyMeshDetail(nr,Sr,wr,fr.detailSampleDist,fr.detailSampleMaxError,br))return lr("Failed to build detail mesh");ir||(freeCompactHeightfield(wr),sr.compactHeightfield=void 0,freeContourSet(xr),sr.contourSet=void 0);for(let Pr=0;Pr<Sr.npolys();Pr++)Sr.areas(Pr)==Recast.RC_WALKABLE_AREA&&Sr.setAreas(Pr,0),Sr.areas(Pr)==0&&Sr.setFlags(Pr,1);const Cr=new NavMeshCreateParams;Cr.setPolyMeshCreateParams(Sr),Cr.setPolyMeshDetailCreateParams(br),Cr.setWalkableHeight(fr.walkableHeight),Cr.setWalkableRadius(fr.walkableRadius),Cr.setWalkableClimb(fr.walkableClimb),Cr.setCellSize(fr.cs),Cr.setCellHeight(fr.ch),Cr.setBuildBvTree(!0),tr.offMeshConnections&&Cr.setOffMeshConnections(tr.offMeshConnections);const Ir=createNavMeshData(Cr);if(!Ir.success)return lr("Failed to create Detour navmesh data");const{navMeshData:Rr}=Ir;return ar.initSolo(Rr)?{success:!0,navMesh:ar,intermediates:sr}:lr("Failed to create Detour navmesh")},tileCacheGeneratorConfigDefaults={...recastConfigDefaults,tileSize:32,expectedLayersPerTile:4,maxObstacles:128},createDefaultTileCacheMeshProcess=()=>new TileCacheMeshProcess((rr,er,tr)=>{for(let ir=0;ir<rr.polyCount();++ir)er.set(ir,0),tr.set(ir,1)}),generateTileCache=(rr,er,tr={},ir=!1)=>{if(!Raw.Module)throw new Error('"init" must be called before using any recast-navigation-js APIs. See: https://github.com/isaac-mason/recast-navigation-js?tab=readme-ov-file#initialization');const nr=new RecastBuildContext,sr={type:"tilecache",buildContext:nr,chunkyTriMesh:void 0,tileIntermediates:[]},ar=new TileCache,or=new NavMesh,lr=rr,cr=er.length,ur=new VerticesArray;ur.copy(lr);const dr=er,hr=er.length/3,pr=new TrianglesArray;pr.copy(dr);const{bbMin:gr,bbMax:vr}=getBoundingBox$1(rr,er),{expectedLayersPerTile:mr,maxObstacles:fr,..._r}={...tileCacheGeneratorConfigDefaults,...tr},Ar=()=>{if(ur.destroy(),pr.destroy(),!ir)for(let Qi=0;Qi<sr.tileIntermediates.length;Qi++){const Xi=sr.tileIntermediates[Qi];Xi.heightfield&&(freeHeightfield(Xi.heightfield),Xi.heightfield=void 0),Xi.compactHeightfield&&(freeCompactHeightfield(Xi.compactHeightfield),Xi.compactHeightfield=void 0),Xi.heightfieldLayerSet&&(freeHeightfieldLayerSet(Xi.heightfieldLayerSet),Xi.heightfieldLayerSet=void 0)}},yr=Qi=>(Ar(),ar.destroy(),or.destroy(),{success:!1,navMesh:void 0,tileCache:void 0,intermediates:sr,error:Qi}),wr=createRcConfig(_r),xr=calcGridSize(gr,vr,wr.cs);wr.width=xr.width,wr.height=xr.height,wr.minRegionArea=wr.minRegionArea*wr.minRegionArea,wr.mergeRegionArea=wr.mergeRegionArea*wr.mergeRegionArea,wr.detailSampleDist=wr.detailSampleDist<.9?0:wr.cs*wr.detailSampleDist,wr.detailSampleMaxError=wr.ch*wr.detailSampleMaxError;const Sr=Math.floor(wr.tileSize),br=Math.floor((wr.width+Sr-1)/Sr),Cr=Math.floor((wr.height+Sr-1)/Sr);wr.borderSize=wr.walkableRadius+3,wr.width=wr.tileSize+wr.borderSize*2,wr.height=wr.tileSize+wr.borderSize*2;const Ir=DetourTileCacheParams.create({orig:gr,cs:wr.cs,ch:wr.ch,width:wr.tileSize,height:wr.tileSize,walkableHeight:wr.walkableHeight,walkableRadius:wr.walkableRadius,walkableClimb:wr.walkableClimb,maxSimplificationError:wr.maxSimplificationError,maxTiles:br*Cr*mr,maxObstacles:fr}),Rr=new Raw.RecastLinearAllocator(32e3),Pr=new Raw.RecastFastLZCompressor,Dr=tr.tileCacheMeshProcess??createDefaultTileCacheMeshProcess();if(!ar.init(Ir,Rr,Pr,Dr))return yr("Failed to initialize tile cache");const Fr=vec3.fromArray(gr);let Or=Math.min(Math.floor(dtIlog2(dtNextPow2(br*Cr*mr))),14);Or>14&&(Or=14);const Nr=22-Or,Ur=1<<Or,Br=1<<Nr,Wr=NavMeshParams.create({orig:Fr,tileWidth:wr.tileSize*wr.cs,tileHeight:wr.tileSize*wr.cs,maxTiles:Ur,maxPolys:Br});if(!or.initTiled(Wr))return yr("Failed to initialize tiled navmesh");const Xr=new RecastChunkyTriMesh;if(sr.chunkyTriMesh=Xr,!Xr.init(ur,pr,hr,256))return yr("Failed to build chunky triangle mesh");const Yr=(Qi,Xi)=>{const Kr={tileX:Qi,tileY:Xi},$r=wr.tileSize*wr.cs,Vr=cloneRcConfig(wr),Gr=[gr[0]+Qi*$r,gr[1],gr[2]+Xi*$r],qr=[gr[0]+(Qi+1)*$r,vr[1],gr[2]+(Xi+1)*$r];Gr[0]-=Vr.borderSize*Vr.cs,Gr[2]-=Vr.borderSize*Vr.cs,qr[0]+=Vr.borderSize*Vr.cs,qr[2]+=Vr.borderSize*Vr.cs,Vr.set_bmin(0,Gr[0]),Vr.set_bmin(1,Gr[1]),Vr.set_bmin(2,Gr[2]),Vr.set_bmax(0,qr[0]),Vr.set_bmax(1,qr[1]),Vr.set_bmax(2,qr[2]);const ji=allocHeightfield();if(Kr.heightfield=ji,!createHeightfield(nr,ji,Vr.width,Vr.height,Gr,qr,Vr.cs,Vr.ch))return{n:0};const Jr=[Gr[0],Gr[2]],Ji=[qr[0],qr[2]],Ki=512,Zi=new ChunkIdsArray;Zi.resize(Ki);const Zr=Xr.getChunksOverlappingRect(Jr,Ji,Zi,Ki);if(Zr===0)return{n:0};for(let ss=0;ss<Zr;++ss){const es=Zi.get(ss),Yi=Xr.nodes(es).n,Gi=Xr.getNodeTris(es),Ni=new TriangleAreasArray;Ni.resize(Yi),markWalkableTriangles(nr,Vr.walkableSlopeAngle,ur,cr,Gi,Yi,Ni);const Ri=rasterizeTriangles(nr,ur,cr,Gi,Ni,Yi,ji,Vr.walkableClimb);if(Ni.destroy(),!Ri)return{n:0}}filterLowHangingWalkableObstacles(nr,wr.walkableClimb,ji),filterLedgeSpans(nr,wr.walkableHeight,wr.walkableClimb,ji),filterWalkableLowHeightSpans(nr,wr.walkableHeight,ji);const is=allocCompactHeightfield();if(!buildCompactHeightfield(nr,wr.walkableHeight,wr.walkableClimb,ji,is))return{n:0};if(ir||(freeHeightfield(Kr.heightfield),Kr.heightfield=void 0),!erodeWalkableArea(nr,wr.walkableRadius,is))return{n:0};const os=allocHeightfieldLayerSet();if(!buildHeightfieldLayers(nr,is,wr.borderSize,wr.walkableHeight,os))return{n:0};ir||(freeCompactHeightfield(is),Kr.compactHeightfield=void 0);const cs=[];for(let ss=0;ss<os.nlayers();ss++){const es=new TileCacheData,ms=os.layers(ss),Yi=new Raw.dtTileCacheLayerHeader;Yi.magic=Detour.DT_TILECACHE_MAGIC,Yi.version=Detour.DT_TILECACHE_VERSION,Yi.tx=Qi,Yi.ty=Xi,Yi.tlayer=ss;const Gi=ms.bmin(),Ni=ms.bmax();Yi.set_bmin(0,Gi.x),Yi.set_bmin(1,Gi.y),Yi.set_bmin(2,Gi.z),Yi.set_bmax(0,Ni.x),Yi.set_bmax(1,Ni.y),Yi.set_bmax(2,Ni.z),Yi.width=ms.width(),Yi.height=ms.height(),Yi.minx=ms.minx(),Yi.maxx=ms.maxx(),Yi.miny=ms.miny(),Yi.maxy=ms.maxy(),Yi.hmin=ms.hmin(),Yi.hmax=ms.hmax();const Ri=getHeightfieldLayerHeights(ms),qi=getHeightfieldLayerAreas(ms),as=getHeightfieldLayerCons(ms),us=buildTileCacheLayer(Pr,Yi,Ri,qi,as,es);if(statusFailed(us))return{n:0};cs.push(es)}return ir||(freeHeightfieldLayerSet(os),Kr.heightfieldLayerSet=void 0),sr.tileIntermediates.push(Kr),{n:cs.length,tiles:cs}};for(let Qi=0;Qi<Cr;++Qi)for(let Xi=0;Xi<br;++Xi){const{n:Kr,tiles:$r}=Yr(Xi,Qi);if(Kr>0&&$r)for(let Vr=0;Vr<Kr;Vr++){const Gr=$r[Vr],qr=ar.addTile(Gr);if(statusFailed(qr.status)){nr.log(Recast.RC_LOG_WARNING,`Failed to add tile to tile cache - tx: ${Xi}, ty: ${Qi}`);continue}}}for(let Qi=0;Qi<Cr;Qi++)for(let Xi=0;Xi<br;Xi++){const Kr=ar.buildNavMeshTilesAt(Xi,Qi,or);if(statusFailed(Kr))return yr(`Failed to build nav mesh tiles at ${Xi}, ${Qi}`)}return Ar(),{success:!0,tileCache:ar,navMesh:or,intermediates:sr}},tiledNavMeshGeneratorConfigDefaults={...recastConfigDefaults},generateTiledNavMesh=(rr,er,tr={},ir=!1)=>{if(!Raw.Module)throw new Error('"init" must be called before using any recast-navigation-js APIs. See: https://github.com/isaac-mason/recast-navigation-js?tab=readme-ov-file#initialization');const nr=new RecastBuildContext,sr={type:"tiled",buildContext:nr,chunkyTriMesh:void 0,tileIntermediates:[]},ar=new NavMesh,or=rr,lr=er.length,cr=new VerticesArray;cr.copy(or);const ur=er,dr=er.length/3,hr=new TrianglesArray;hr.copy(ur);const pr=()=>{if(cr.destroy(),hr.destroy(),!ir){for(let Ur=0;Ur<sr.tileIntermediates.length;Ur++){const Br=sr.tileIntermediates[Ur];Br.compactHeightfield&&(freeCompactHeightfield(Br.compactHeightfield),Br.compactHeightfield=void 0),Br.heightfield&&(freeHeightfield(Br.heightfield),Br.heightfield=void 0),Br.contourSet&&(freeContourSet(Br.contourSet),Br.contourSet=void 0),Br.polyMesh&&(freePolyMesh(Br.polyMesh),Br.polyMesh=void 0),Br.polyMeshDetail&&(freePolyMeshDetail(Br.polyMeshDetail),Br.polyMeshDetail=void 0)}sr.chunkyTriMesh&&(sr.chunkyTriMesh=void 0)}},gr=Ur=>(pr(),ar.destroy(),{success:!1,navMesh:void 0,intermediates:sr,error:Ur}),vr=createRcConfig({...tiledNavMeshGeneratorConfigDefaults,...tr}),{bbMin:mr,bbMax:fr}=getBoundingBox$1(rr,er),_r=calcGridSize(mr,fr,vr.cs);vr.width=_r.width,vr.height=_r.height,vr.minRegionArea=vr.minRegionArea*vr.minRegionArea,vr.mergeRegionArea=vr.mergeRegionArea*vr.mergeRegionArea,vr.tileSize=Math.floor(vr.tileSize),vr.borderSize=vr.walkableRadius+3,vr.width=vr.tileSize+vr.borderSize*2,vr.height=vr.tileSize+vr.borderSize*2,vr.detailSampleDist=vr.detailSampleDist<.9?0:vr.cs*vr.detailSampleDist,vr.detailSampleMaxError=vr.ch*vr.detailSampleMaxError;const Ar=Math.floor(vr.tileSize),yr=Math.floor((_r.width+Ar-1)/Ar),wr=Math.floor((_r.height+Ar-1)/Ar),xr=vr.tileSize*vr.cs,Sr=vec3.fromArray(mr);let br=Math.min(Math.floor(dtIlog2(dtNextPow2(yr*wr))),14);br>14&&(br=14);const Cr=22-br,Ir=1<<br,Rr=1<<Cr,Pr=NavMeshParams.create({orig:Sr,tileWidth:vr.tileSize*vr.cs,tileHeight:vr.tileSize*vr.cs,maxTiles:Ir,maxPolys:Rr});if(!ar.initTiled(Pr))return gr("Could not init nav mesh for tiled use");const Dr=new RecastChunkyTriMesh;if(sr.chunkyTriMesh=Dr,!Dr.init(cr,hr,dr,256))return gr("Failed to build chunky triangle mesh");const Fr=(Ur,Br,Wr,Xr)=>{const Yr=es=>(nr.log(Recast.RC_LOG_ERROR,es),{success:!1,error:es}),Qi={tileX:Ur,tileY:Br};sr.tileIntermediates.push(Qi);const Xi=cloneRcConfig(vr),Kr=[...Wr],$r=[...Xr];Kr[0]-=Xi.borderSize*Xi.cs,Kr[2]-=Xi.borderSize*Xi.cs,$r[0]+=Xi.borderSize*Xi.cs,$r[2]+=Xi.borderSize*Xi.cs,Xi.set_bmin(0,Kr[0]),Xi.set_bmin(1,Kr[1]),Xi.set_bmin(2,Kr[2]),Xi.set_bmax(0,$r[0]),Xi.set_bmax(1,$r[1]),Xi.set_bmax(2,$r[2]),nr.resetTimers(),nr.startTimer(Recast.RC_TIMER_TOTAL),nr.log(Recast.RC_LOG_PROGRESS,`Building tile ${sr.tileIntermediates.length} at x: ${Ur}, y: ${Br}`),nr.log(Recast.RC_LOG_PROGRESS,` - ${vr.width} x ${vr.height} cells`),nr.log(Recast.RC_LOG_PROGRESS,` - ${lr/1e3}fK verts, ${dr/1e3}K tris`);const Vr=allocHeightfield();if(Qi.heightfield=Vr,!createHeightfield(nr,Vr,Xi.width,Xi.height,Kr,$r,Xi.cs,Xi.ch))return Yr("Could not create heightfield");new TriangleAreasArray().resize(Dr.maxTrisPerChunk());const qr=[Kr[0],Kr[2]],ji=[$r[0],$r[2]],Jr=512,Ji=new ChunkIdsArray;Ji.resize(Jr);const Ki=Dr.getChunksOverlappingRect(qr,ji,Ji,Jr);if(Ki===0)return{success:!0};for(let es=0;es<Ki;++es){const ms=Ji.get(es),Gi=Dr.nodes(ms).n,Ni=Dr.getNodeTris(ms),Ri=new TriangleAreasArray;Ri.resize(Gi),markWalkableTriangles(nr,Xi.walkableSlopeAngle,cr,lr,Ni,Gi,Ri);const qi=rasterizeTriangles(nr,cr,lr,Ni,Ri,Gi,Vr,Xi.walkableClimb);if(Ri.destroy(),!qi)return Yr("Could not rasterize triangles")}filterLowHangingWalkableObstacles(nr,Xi.walkableClimb,Vr),filterLedgeSpans(nr,Xi.walkableHeight,Xi.walkableClimb,Vr),filterWalkableLowHeightSpans(nr,Xi.walkableHeight,Vr);const Zi=allocCompactHeightfield();if(Qi.compactHeightfield=Zi,!buildCompactHeightfield(nr,Xi.walkableHeight,Xi.walkableClimb,Vr,Zi))return Yr("Could not build compact heightfield");if(ir||(freeHeightfield(Qi.heightfield),Qi.heightfield=void 0),!erodeWalkableArea(nr,Xi.walkableRadius,Zi))return Yr("Could not erode walkable area");if(!buildDistanceField(nr,Zi))return Yr("Failed to build distance field");if(!buildRegions(nr,Zi,Xi.borderSize,Xi.minRegionArea,Xi.mergeRegionArea))return Yr("Failed to build regions");const Zr=allocContourSet();if(Qi.contourSet=Zr,!buildContours(nr,Zi,Xi.maxSimplificationError,Xi.maxEdgeLen,Zr,Recast.RC_CONTOUR_TESS_WALL_EDGES))return Yr("Failed to create contours");const is=allocPolyMesh();if(Qi.polyMesh=is,!buildPolyMesh(nr,Zr,Xi.maxVertsPerPoly,is))return Yr("Failed to triangulate contours");const os=allocPolyMeshDetail();if(Qi.polyMeshDetail=os,!buildPolyMeshDetail(nr,is,Zi,Xi.detailSampleDist,Xi.detailSampleMaxError,os))return Yr("Failed to build detail mesh");ir||(freeCompactHeightfield(Zi),Qi.compactHeightfield=void 0,freeContourSet(Zr),Qi.contourSet=void 0);for(let es=0;es<is.npolys();es++)is.areas(es)==Recast.RC_WALKABLE_AREA&&is.setAreas(es,0),is.areas(es)==0&&is.setFlags(es,1);const cs=new NavMeshCreateParams;cs.setPolyMeshCreateParams(is),cs.setPolyMeshDetailCreateParams(os),cs.setWalkableHeight(Xi.walkableHeight),cs.setWalkableRadius(Xi.walkableRadius),cs.setWalkableClimb(Xi.walkableClimb),cs.setCellSize(Xi.cs),cs.setCellHeight(Xi.ch),cs.setBuildBvTree(!0),tr.offMeshConnections&&cs.setOffMeshConnections(tr.offMeshConnections),cs.setTileX(Ur),cs.setTileY(Br);const ss=createNavMeshData(cs);return ss.success?(nr.log(Recast.RC_LOG_PROGRESS,`>> Polymesh: ${is.nverts()} vertices  ${is.npolys()} polygons`),{success:!0,data:ss.navMeshData}):Yr("Failed to create Detour navmesh data")};nr.startTimer(Recast.RC_TIMER_TEMP);const Or=[0,0,0],Nr=[0,0,0];for(let Ur=0;Ur<wr;Ur++)for(let Br=0;Br<yr;Br++){Or[0]=mr[0]+Br*xr,Or[1]=mr[1],Or[2]=mr[2]+Ur*xr,Nr[0]=mr[0]+(Br+1)*xr,Nr[1]=fr[1],Nr[2]=mr[2]+(Ur+1)*xr;const Wr=Fr(Br,Ur,Or,Nr);if(Wr.success&&Wr.data){ar.removeTile(ar.getTileRefAt(Br,Ur,0));const Xr=ar.addTile(Wr.data,Detour.DT_TILE_FREE_DATA,0);statusFailed(Xr.status)&&(nr.log(Recast.RC_LOG_WARNING,`Failed to add tile to nav mesh
	tx: ${Br}, ty: ${Ur},status: ${statusToReadableString(Xr.status)} (${Xr.status})`),Wr.data.destroy())}}return nr.stopTimer(Recast.RC_TIMER_TEMP),ir||pr(),{success:!0,navMesh:ar,intermediates:sr}},mergePositionsAndIndices=rr=>{const er=[],tr=[],ir={};let nr=0;for(const{positions:sr,indices:ar}of rr)for(let or=0;or<ar.length;or++){const lr=ar[or]*3,cr=sr[lr],ur=sr[lr+1],dr=sr[lr+2],hr=`${cr}_${ur}_${dr}`;let pr=ir[hr];pr||(ir[hr]=pr=nr,er.push(cr,ur,dr),nr++),tr.push(pr)}return[Float32Array.from(er),Uint32Array.from(tr)]},_color=new Color;class DebugDrawer extends Group{pointGeometry=new SphereGeometry(.02,32,32);constructor({triMaterial:er,pointMaterial:tr,lineMaterial:ir}={}){super(),this.debugDrawerUtils=new DebugDrawerUtils,this.triMaterial=er??new MeshBasicMaterial({vertexColors:!0,transparent:!0,opacity:.4,depthWrite:!1}),this.pointMaterial=tr??new MeshBasicMaterial,this.lineMaterial=ir??new LineMaterial({color:16777215,linewidth:2,vertexColors:!0,polygonOffset:!0,polygonOffsetFactor:-4,polygonOffsetUnits:-10})}drawPrimitives(er){for(const tr of er)switch(tr.type){case"points":this.drawPoints(tr);break;case"lines":this.drawLines(tr);break;case"tris":this.drawTris(tr);break;case"quads":this.drawQuads(tr);break}}drawHeightfieldSolid(er){const tr=this.debugDrawerUtils.drawHeightfieldSolid(er);this.drawPrimitives(tr)}drawHeightfieldWalkable(er){const tr=this.debugDrawerUtils.drawHeightfieldWalkable(er);this.drawPrimitives(tr)}drawCompactHeightfieldSolid(er){const tr=this.debugDrawerUtils.drawCompactHeightfieldSolid(er);this.drawPrimitives(tr)}drawCompactHeightfieldRegions(er){const tr=this.debugDrawerUtils.drawCompactHeightfieldRegions(er);this.drawPrimitives(tr)}drawCompactHeightfieldDistance(er){const tr=this.debugDrawerUtils.drawCompactHeightfieldDistance(er);this.drawPrimitives(tr)}drawHeightfieldLayer(er,tr){const ir=this.debugDrawerUtils.drawHeightfieldLayer(er,tr);this.drawPrimitives(ir)}drawHeightfieldLayers(er){const tr=this.debugDrawerUtils.drawHeightfieldLayers(er);this.drawPrimitives(tr)}drawRegionConnections(er,tr=1){const ir=this.debugDrawerUtils.drawRegionConnections(er,tr);this.drawPrimitives(ir)}drawRawContours(er,tr=1){const ir=this.debugDrawerUtils.drawRawContours(er,tr);this.drawPrimitives(ir)}drawContours(er,tr=1){const ir=this.debugDrawerUtils.drawContours(er,tr);this.drawPrimitives(ir)}drawPolyMesh(er){const tr=this.debugDrawerUtils.drawPolyMesh(er);this.drawPrimitives(tr)}drawPolyMeshDetail(er){const tr=this.debugDrawerUtils.drawPolyMeshDetail(er);this.drawPrimitives(tr)}drawNavMesh(er,tr=0){const ir=this.debugDrawerUtils.drawNavMesh(er,tr);this.drawPrimitives(ir)}drawNavMeshWithClosedList(er,tr,ir=0){const nr=this.debugDrawerUtils.drawNavMeshWithClosedList(er,tr,ir);this.drawPrimitives(nr)}drawNavMeshNodes(er){const tr=this.debugDrawerUtils.drawNavMeshNodes(er);this.drawPrimitives(tr)}drawNavMeshBVTree(er){const tr=this.debugDrawerUtils.drawNavMeshBVTree(er);this.drawPrimitives(tr)}drawNavMeshPortals(er){const tr=this.debugDrawerUtils.drawNavMeshPortals(er);this.drawPrimitives(tr)}drawNavMeshPolysWithFlags(er,tr,ir){const nr=this.debugDrawerUtils.drawNavMeshPolysWithFlags(er,tr,ir);this.drawPrimitives(nr)}drawNavMeshPoly(er,tr,ir){const nr=this.debugDrawerUtils.drawNavMeshPoly(er,tr,ir);this.drawPrimitives(nr)}reset(){for(const er of this.children)(er instanceof Mesh||er instanceof LineSegments2)&&er.geometry.dispose();this.clear()}dispose(){this.debugDrawerUtils.dispose(),this.reset(),this.pointGeometry.dispose(),this.triMaterial.dispose(),this.pointMaterial.dispose(),this.lineMaterial.dispose()}drawPoints(er){const tr=this.pointGeometry,ir=new InstancedMesh(tr,this.pointMaterial,er.vertices.length/3);for(let nr=0;nr<er.vertices.length/7;nr++){const[sr,ar,or,lr,cr,ur]=er.vertices[nr];ir.setMatrixAt(nr,new Matrix4().setPosition(sr,ar,or)),ir.setColorAt(nr,_color.setRGB(lr,cr,ur))}ir.instanceMatrix.needsUpdate=!0,this.add(ir)}drawLines(er){const tr=new LineSegmentsGeometry,ir=[],nr=[];for(let ar=0;ar<er.vertices.length;ar+=2){const[or,lr,cr,ur,dr,hr]=er.vertices[ar],[pr,gr,vr,mr,fr,_r]=er.vertices[ar+1];ir.push(or,lr,cr),ir.push(pr,gr,vr),nr.push(ur,dr,hr),nr.push(mr,fr,_r)}tr.setPositions(ir),tr.setColors(nr);const sr=new LineSegments2(tr,this.lineMaterial);this.add(sr)}drawTris(er){const tr=new BufferGeometry,ir=new Float32Array(er.vertices.length*3),nr=new Float32Array(er.vertices.length*3);for(let or=0;or<er.vertices.length;or++){const[lr,cr,ur,dr,hr,pr]=er.vertices[or];ir[or*3+0]=lr,ir[or*3+1]=cr,ir[or*3+2]=ur,nr[or*3+0]=dr,nr[or*3+1]=hr,nr[or*3+2]=pr}tr.setAttribute("position",new BufferAttribute(ir,3)),tr.setAttribute("color",new BufferAttribute(nr,3));const sr=this.triMaterial,ar=new Mesh(tr,sr);this.add(ar)}drawQuads(er){const tr=[],ir=[];for(let or=0;or<er.vertices.length;or+=4){const lr=[er.vertices[or],er.vertices[or+1],er.vertices[or+2],er.vertices[or],er.vertices[or+2],er.vertices[or+3]];for(const[cr,ur,dr,hr,pr,gr]of lr)tr.push(cr,ur,dr),ir.push(hr,pr,gr)}const nr=new BufferGeometry;nr.setAttribute("position",new BufferAttribute(new Float32Array(tr),3)),nr.setAttribute("color",new BufferAttribute(new Float32Array(ir),3));const sr=this.triMaterial,ar=new Mesh(nr,sr);this.add(ar)}}class CrowdHelper extends Object3D{agentMeshes=new Map;constructor(er,tr){super(),this.recastCrowd=er,this.agentMaterial=tr?.agentMaterial??new MeshBasicMaterial({color:"red"}),this.update()}update(){const er=this.recastCrowd.getAgents(),tr=new Set(this.agentMeshes.keys());for(const ir of er){tr.delete(ir.agentIndex);const nr=ir.position(),sr=ir.velocity();let ar=this.agentMeshes.get(ir.agentIndex);ar===void 0?(ar=this.createAgentMesh(ir),this.add(ar),this.agentMeshes.set(ir.agentIndex,ar)):this.updateAgentGeometry(ar,ir),ar.position.set(nr.x,nr.y+ir.height/2,nr.z),ar.lookAt(new Vector3$1().copy(ar.position).add(sr))}for(const ir of tr){const nr=this.agentMeshes.get(ir);nr&&(this.remove(nr),this.agentMeshes.delete(ir))}}createAgentMesh(er){const tr=new Mesh;return tr.material=this.agentMaterial,this.updateAgentGeometry(tr,er),tr.userData={radius:er.radius,height:er.height},tr}updateAgentGeometry(er,tr){if(er.userData.radius!==tr.radius||er.userData.height!==tr.height){const ir=new CylinderGeometry(tr.radius,tr.radius,tr.height);er.geometry.dispose(),er.geometry=ir,er.userData.radius=tr.radius,er.userData.height=tr.height}}}class NavMeshHelper extends Object3D{constructor(er,tr){super(),this.navMesh=er,this.navMeshGeometry=new BufferGeometry,this.navMeshMaterial=tr?.navMeshMaterial?tr.navMeshMaterial:new MeshBasicMaterial({color:"orange",transparent:!0,opacity:.7,depthWrite:!1}),this.update(),this.mesh=new Mesh(this.navMeshGeometry,this.navMeshMaterial),this.add(this.mesh)}update(){const[er,tr]=this.navMesh.getDebugNavMesh();this.navMeshGeometry.setAttribute("position",new BufferAttribute(Float32Array.from(er),3)),this.navMeshGeometry.setIndex(new BufferAttribute(Uint32Array.from(tr),1)),this.navMeshGeometry.computeVertexNormals()}}class OffMeshConnectionsHelper extends Object3D{constructor(er,tr){super(),this.offMeshConnections=er??[],this.entryCircleMaterial=tr?.entryCircleMaterial??new MeshBasicMaterial({color:"green"}),this.exitCircleMaterial=tr?.exitCircleMaterial??new MeshBasicMaterial({color:"blue"}),this.lineMaterial=tr?.lineMaterial??new LineBasicMaterial({color:"red"}),this.update()}update(){this.clear();for(const er of this.offMeshConnections){const tr=new CircleGeometry(er.radius,16),ir=new Mesh(tr,this.entryCircleMaterial);ir.position.copy(er.startPosition),ir.position.y+=.001,ir.rotation.x=-Math.PI/2,this.add(ir);const nr=new Mesh(tr,er.bidirectional?this.entryCircleMaterial:this.exitCircleMaterial);nr.position.copy(er.endPosition),nr.position.y+=.001,nr.rotation.x=-Math.PI/2,this.add(nr);const sr=new Vector3$1().copy(er.startPosition),ar=new Vector3$1().copy(er.endPosition),or=new Vector3$1().addVectors(sr,ar).multiplyScalar(.5);or.y*=1.2;const cr=new CatmullRomCurve3([sr,or,ar]).getPoints(50),ur=new BufferGeometry().setFromPoints(cr),dr=new Line(ur,this.lineMaterial);this.add(dr)}}}class TileCacheHelper extends Object3D{obstacleMeshes=new Map;constructor(er,tr){super(),this.tileCache=er,this.obstacleMaterial=tr?.obstacleMaterial?tr.obstacleMaterial:new MeshBasicMaterial({color:"red",wireframe:!0,wireframeLinewidth:2}),this.update()}update(){const er=new Set(this.obstacleMeshes.keys());for(const[,tr]of this.tileCache.obstacles){const ir=this.obstacleMeshes.get(tr);if(er.delete(tr),!ir){const{position:nr}=tr,sr=new Mesh(void 0,this.obstacleMaterial);if(sr.position.copy(nr),tr.type==="box"){const{halfExtents:ar,angle:or}=tr;sr.geometry=new BoxGeometry(ar.x*2,ar.y*2,ar.z*2),sr.rotation.y=or}else if(tr.type==="cylinder"){const{radius:ar,height:or}=tr;sr.geometry=new CylinderGeometry(ar,ar,or,16),sr.position.y+=or/2}else throw new Error(`Unknown obstacle type: ${tr}`);this.add(sr),this.obstacleMeshes.set(tr,sr)}}for(const tr of er){const ir=this.obstacleMeshes.get(tr);ir&&(this.remove(ir),this.obstacleMeshes.delete(tr))}}}const _position=new Vector3$1,getPositionsAndIndices=rr=>{const er=[];for(const tr of rr){const ir=tr.geometry.attributes.position;if(!ir||ir.itemSize!==3)continue;tr.updateMatrixWorld();const nr=new Float32Array(ir.array);for(let ar=0;ar<nr.length;ar+=3){const or=_position.set(nr[ar],nr[ar+1],nr[ar+2]);tr.localToWorld(or),nr[ar]=or.x,nr[ar+1]=or.y,nr[ar+2]=or.z}let sr=tr.geometry.getIndex()?.array;if(sr===void 0){const ar=[];for(let or=0;or<ir.count;or++)ar.push(or);sr=ar}er.push({positions:nr,indices:sr})}return mergePositionsAndIndices(er)},threeToSoloNavMesh=(rr,er={},tr=!1)=>{const[ir,nr]=getPositionsAndIndices(rr);return generateSoloNavMesh(ir,nr,er,tr)},threeToTiledNavMesh=(rr,er={},tr=!1)=>{const[ir,nr]=getPositionsAndIndices(rr);return generateTiledNavMesh(ir,nr,er,tr)},threeToTileCache=(rr,er={},tr=!1)=>{const[ir,nr]=getPositionsAndIndices(rr);return generateTileCache(ir,nr,er,tr)};await init();let navmesh,navq,navmesh_resolve,navmesh_reject,navmesh_loaded=new Promise((rr,er)=>{navmesh_resolve=rr,navmesh_reject=er});function constructNavmesh(rr){const{success:er,navMesh:tr}=threeToTiledNavMesh(rr,{tileSize:16,walkableRadius:2.15});er?(navmesh=tr,navq=new NavMeshQuery(navmesh),navmesh_resolve()):navmesh_reject()}async function navmeshHelper(rr){await navmesh_loaded,rr.add(new NavMeshHelper(navmesh))}async function getNavmesh(){return await navmesh_loaded,navmesh}async function getNavmeshQuery(){return await navmesh_loaded,navq}let maxProgess=1,game,Total=4;class Altar{constructor(er,tr,ir){this.progess=0,this.tottime=0,this.complete=0,this.mesh=er,this.crystal=tr,this.player=ir}get altarMesh(){return this.mesh}get position(){return this.mesh.position}get completeRatio(){return this.progess/maxProgess}update(er){this.crystal.material.emissiveIntensity=this.completeRatio/2,this.completeRatio==1&&this.crystal.rotateY(er),this.tottime+=er,this.crystal.position.y=.5+Math.sin(this.tottime)*.3}interact(){let er=this.player.del_MP(Math.min(maxProgess-this.progess,.05*game.deltatime)*1e3);this.progess+=er/1e3,this.progess==maxProgess&&this.complete==0&&(this.complete=1,this.player.audio_play("altars_complete"))}reset(){this.progess=this.tottime=0}}const AltarSpawnLocation=[[-88,16],[-73,87],[28,70],[70,0],[-70,0],[65,-50],[12,-44],[-75,57]];class Altars extends GameObject{constructor(){super(...arguments),this.altars=[],this.loader=new GLTFLoader,this.gate_openning=0}get finishedAltarCount(){return this.cnt}async init(){game=this.game,this.player=this.game.getGameObj(Player),this.gameScene=this.game.getGameObj(GameScene);let er=this.loader.loadAsync("model/scene/crystal.glb",getLoadingFunc("Crystal")),tr=await this.loader.loadAsync("model/scene/altar.glb",getLoadingFunc("Altar"));removeProgess("Altar"),this.altarMesh=tr.scene.children[0],this.crystalMesh=(await er).scene.children[0],removeProgess("Crystal");for(let ir=0;ir<AltarSpawnLocation.length;ir++){let nr=this.altarMesh.clone(),sr=this.crystalMesh.material.clone();sr.emissiveIntensity=0;let ar=new Mesh(this.crystalMesh.geometry,sr);nr.add(ar),nr.position.set(AltarSpawnLocation[ir][0],0,AltarSpawnLocation[ir][1]),ar.position.set(0,.5,0),nr.scale.set(.7,.7,.7),ar.scale.set(2,2,2),this.altars.push(new Altar(nr,ar,this.player)),this.game.scene.add(nr)}this.crystalMesh.geometry.dispose(),this.crystalMesh.material.dispose()}beforeStart(){this.game.difficulty===2&&(maxProgess=1.25),this.game.difficulty===3&&(maxProgess=1.5,Total=5)}reset(){this.cnt=0,this.gate_openning=0;for(let er of this.altars)er.reset()}getNearestAltar(er){let tr=this.altars[0],ir=1e8;for(let nr in this.altars)this.altars[nr].completeRatio!=1&&this.altars[nr].position.distanceToSquared(er)<ir&&(ir=this.altars[nr].position.distanceToSquared(er),tr=this.altars[nr]);return tr}update(){this.cnt=0;for(let ir in this.altars)this.altars[ir].update(this.game.deltatime),this.altars[ir].completeRatio==1&&++this.cnt,this.cnt>=Total&&(this.gameScene.gateOpening=!0);document.getElementById("top-status").innerText=Total-this.cnt+"/"+Total+" altars left",this.cnt==Total&&(this.gate_openning==0&&(this.gate_openning=1,this.player.audio_play("gate")),document.getElementById("top-status").innerText="EXIT THROUGH THE GATE LOCATED BEHIND THE GRAVEYARD");let er=this.getNearestAltar(this.player.get_mesh_position()),tr=document.getElementById("altar-status");er.position.distanceTo(this.player.get_mesh_position())-2<=24||this.game.difficulty<2?tr.innerText="Nearest altar distance: "+(er.position.distanceTo(this.player.get_mesh_position())-2).toFixed(1)+`m
Progress: `+(er.completeRatio*100).toFixed(1)+"%":tr.innerText="Nearest altar distance: >24m",tr.style.display="",er.position.distanceTo(this.player.get_mesh_position())<=3&&this.player.set_interact("Altar",er)}}const BoundingBoxAutoGen=["fence","bridge","wall","box","haystack","container","Cabin"];function getBoundingBox(rr,er,tr,ir){let nr=new Vector3$1((rr.max.x+rr.min.x)*ir.x/2,(rr.max.y+rr.min.y)*ir.y/2,(rr.max.z+rr.min.z)*ir.z/2).applyQuaternion(tr).add(er);return ColliderDesc.cuboid((rr.max.x-rr.min.x)*ir.x/2,(rr.max.y-rr.min.y)*ir.y/2,(rr.max.z-rr.min.z)*ir.z/2).setRotation(tr).setTranslation(nr.x,nr.y,nr.z)}function getMeshFromCollider(rr){if(rr.shape.type==ShapeType.Capsule){let er=rr.shape;return new Mesh(new CapsuleGeometry(er.radius,er.halfHeight*2,8,16))}else if(rr.shape.type==ShapeType.Cuboid){let er=rr.shape;return new Mesh(new BoxGeometry(er.halfExtents.x*2,er.halfExtents.y*2,er.halfExtents.z*2))}else throw TypeError("Unknown collider tyoe")}function getColliderDescFromMesh(rr){let er=new Vector3$1,tr=new Quaternion$1,ir=new Vector3$1;rr.getWorldPosition(er),rr.getWorldQuaternion(tr),rr.getWorldScale(ir);let nr=rr.geometry.getAttribute("position").array.slice();for(let ar=0;ar<nr.length;ar+=3){let or=new Vector3$1(nr[ar],nr[ar+1],nr[ar+2]);or.applyQuaternion(tr),or.multiply(ir),nr[ar]=or.x,nr[ar+1]=or.y,nr[ar+2]=or.z}let sr=ColliderDesc.trimesh(nr,Uint32Array.from(rr.geometry.getIndex()?.array));return sr.setTranslation(er.x,er.y,er.z),sr}class GameScene extends GameObject{constructor(){super(...arguments),this.ambientlight=new AmbientLight(11184810,.7),this.directionalLight=new DirectionalLight(16777215,1.3),this.light=new PointLight(16777215,100,100),this.gltfloader=new GLTFLoader,this.streetlight_colliderdesc=ColliderDesc.capsule(2,.2),this.windmill_colliderdesc=ColliderDesc.capsule(2,5),this.trash_colliderdesc=ColliderDesc.capsule(2,.5),this.granary_colliderdesc=ColliderDesc.capsule(2,1.4),this.windmill_fans=[],this.worker=new Worker(new URL("/assets/RayCasterWorker-DsKdbGoC.js",import.meta.url),{type:"module"}),this.gateOpening=!1,this.gateOpeningProgress=0}async init(){this.water=new Water$1(new PlaneGeometry(200,200),{textureWidth:512,textureHeight:512,waterNormals:new TextureLoader().load("image/waternormals.jpg",function(cr){cr.wrapS=cr.wrapT=RepeatWrapping}),sunDirection:new Vector3$1,sunColor:16777215,waterColor:7695,distortionScale:3.7}),this.water.rotation.x=-Math.PI/2,this.water.position.y=-1,this.game.scene.add(this.water);let er,tr,ir=new Promise((cr,ur)=>{tr=cr}),nr=0;await Promise.all([new Promise((cr,ur)=>{this.gltfloader.load("model/scene/scene.glb",dr=>{er=dr,removeProgess("Scene"),cr()},getLoadingFunc("Scene"),function(dr){console.error(dr),ur(dr)})}),new Promise((cr,ur)=>{this.gltfloader.load("model/scene/streetlamp.glb",dr=>{let hr=dr.scene.children[1].name=="lamp"?1:0;this.streetlight_light=new PointLight(16777215,1,20,4),this.streetlight_mesh=dr.scene.children[hr],this.streetlight_light.position.copy(dr.scene.children[1-hr].position),removeProgess("Streetlamp"),cr()},getLoadingFunc("Streetlamp"),function(dr){console.error(dr),ur(dr)})}),new Promise((cr,ur)=>{this.gltfloader.load("model/scene/corn.glb",dr=>{this.corn_mesh=dr.scene.children[0].children[0],removeProgess("Corn"),cr()},getLoadingFunc("Corn"),function(dr){console.error(dr),ur(dr)})})]).then(()=>{for(let gr in er.scene.children)if(er.scene.children[gr].name=="ground"){this.ground=er.scene.children[gr];break}er.scene.remove(this.ground);let cr=[],ur=[],dr=[this.ground],hr=[];er.scene.traverse(gr=>{let vr=new Vector3$1;if(gr.getWorldPosition(vr),gr.name.match("collider")!==null){let fr=gr;if(fr.visible=!1,fr.name.match("box")!==null){fr.geometry.computeBoundingBox();let _r=new Vector3$1,Ar=new Quaternion$1,yr=new Vector3$1;fr.getWorldPosition(_r),fr.getWorldQuaternion(Ar),fr.getWorldScale(yr);let wr=this.game.world.createCollider(getBoundingBox(fr.geometry.boundingBox,_r,Ar,yr)),xr=getMeshFromCollider(wr);xr.position.copy(wr.translation()),xr.quaternion.copy(Ar),dr.push(xr)}return}if(gr instanceof Mesh&&!gr.name.match("field")&&!gr.name.match("corn")&&!gr.name.match("grass")&&!gr.name.match("Biggrass")){gr.layers.enable(16);let fr=new Mesh(gr.geometry);this.worker.postMessage({type:"init",mesh:fr.toJSON(),transform:gr.matrixWorld.toArray()}),gr.geometry.computeBoundsTree(),++nr}if(gr.name.match("streetlight")){let fr=this.streetlight_colliderdesc,_r=this.game.world.createCollider(fr);_r.setTranslation(vr),cr.push(gr);let Ar=getMeshFromCollider(_r);Ar.position.copy(vr),dr.push(Ar)}if(gr.name.match("windmill")||gr.name.match("trash")||gr.name.match("granary")){let fr=gr.name.match("windmill")?this.windmill_colliderdesc:gr.name.match("trash")?this.trash_colliderdesc:this.granary_colliderdesc,_r=this.game.world.createCollider(fr);_r.setTranslation(vr);let Ar=getMeshFromCollider(_r);Ar.position.copy(vr),dr.push(Ar)}if((gr.name.match("Biggrass")||gr.name.match("grass"))&&gr.isMesh&&hr.push(gr),gr.name.match("tree")){let fr=ColliderDesc.capsule(2,.4*gr.scale.x),_r=this.game.world.createCollider(fr);_r.setTranslation(vr);let Ar=getMeshFromCollider(_r);Ar.position.copy(vr),dr.push(Ar)}(gr.name.match("graveyard_gate")||gr.name.match("graveyard_Gate")||gr.name.match("house")||gr.name.match("church")||gr.name.match("graveyard_stone")||gr.name.match("Frame"))&&gr.isMesh&&(this.game.world.createCollider(getColliderDescFromMesh(gr)),dr.push(gr)),gr.name.match("Gate")&&(this.gateCollider=this.game.world.createCollider(getColliderDescFromMesh(gr)),dr.push(gr.clone()),this.gate=gr),gr.name.match("fan")&&this.windmill_fans.push(gr),gr.name.match("corn")&&gr.isGroup&&ur.push(gr);let mr=!1;for(let fr in BoundingBoxAutoGen)gr.name.match(BoundingBoxAutoGen[fr])&&(mr=!0);if(mr&&gr.isMesh){let fr=gr;fr.geometry.computeBoundingBox();let _r=new Vector3$1,Ar=new Quaternion$1,yr=new Vector3$1;fr.getWorldPosition(_r),fr.getWorldQuaternion(Ar),fr.getWorldScale(yr);let wr=this.game.world.createCollider(getBoundingBox(fr.geometry.boundingBox,_r,Ar,yr)),xr=getMeshFromCollider(wr);xr.position.copy(wr.translation()),xr.quaternion.copy(Ar),dr.push(xr)}tr()});for(let gr of hr){const vr=gr.parent;gr.removeFromParent();let mr=new LOD;mr.position.copy(gr.position),gr.position.set(0,0,0),mr.addLevel(gr,0),mr.addLevel(new Object3D,45),vr?.add(mr)}for(let gr in AltarSpawnLocation){let vr=ColliderDesc.capsule(2,2),mr=this.game.world.createCollider(vr);mr.setTranslation(new Vector3$1(AltarSpawnLocation[gr][0],0,AltarSpawnLocation[gr][1]));let fr=getMeshFromCollider(mr);fr.position.copy(new Vector3$1(AltarSpawnLocation[gr][0],0,AltarSpawnLocation[gr][1])),dr.push(fr)}this.streetlight_insmesh=new InstancedMesh(this.streetlight_mesh.geometry,this.streetlight_mesh.material,cr.length);for(let gr in cr)cr[gr].add(this.streetlight_light.clone(!0)),this.streetlight_insmesh.setMatrixAt(Number(gr),cr[gr].matrixWorld);this.streetlight_insmesh.instanceMatrix.needsUpdate=!0,this.streetlight_insmesh.layers.enable(16),this.streetlight_insmesh.geometry.computeBoundsTree(),this.game.scene.add(this.streetlight_insmesh);let pr=new InstancedMesh(this.streetlight_insmesh.geometry,void 0,this.streetlight_insmesh.count);pr.instanceMatrix.copy(this.streetlight_insmesh.instanceMatrix),++nr,this.worker.postMessage({type:"init",mesh:pr.toJSON()}),this.corn_insmesh=new InstancedMesh(this.corn_mesh.geometry,this.corn_mesh.material,ur.length*64);for(let gr=0;gr<ur.length;gr++){let vr=ur[gr].matrixWorld.clone(),mr=new Vector3$1;ur[gr].getWorldPosition(mr);for(let fr=0;fr<8;fr++)for(let _r=0;_r<8;_r++)this.corn_insmesh.setMatrixAt(gr*64+fr*8+_r,vr.clone().setPosition(mr.clone().add(new Vector3$1(-fr*2.4,0,_r*2.4))));ur[gr].removeFromParent(),ur[gr].visible=!1}this.corn_insmesh.instanceMatrix.needsUpdate=!0,this.corn_insmesh.geometry.computeBoundsTree(),this.game.scene.add(this.corn_insmesh),pr=new InstancedMesh(this.corn_insmesh.geometry,void 0,this.corn_insmesh.count),pr.instanceMatrix.copy(this.corn_insmesh.instanceMatrix),++nr,this.worker.postMessage({type:"init",mesh:pr.toJSON()}),this.game.scene.add(er.scene),this.ground.receiveShadow=!0,this.game.scene.add(this.ground),constructNavmesh(dr)}),await ir;let sr,ar,or=new Promise((cr,ur)=>{sr=cr,ar=ur}),lr=()=>{this.worker.removeEventListener("message",lr),sr()};this.worker.addEventListener("message",lr),this.worker.postMessage({type:"init",total:nr}),await or,this.game.scene.add(this.ambientlight),this.game.scene.add(this.directionalLight),this.light.position.set(0,10,0),this.light.castShadow=!0,this.light.shadow.mapSize.width=2048,this.light.shadow.mapSize.height=2048,this.game.scene.add(this.light),this.game.scene.fog=new FogExp2(0,.023),this.ground.layers.enable(16),window.addEventListener("keypress",cr=>{cr.key=="Enter"&&(this.game.isPaused=!this.game.isPaused)}),window.addEventListener("blur",cr=>{this.game.isPaused=!0})}update(){this.water.material.uniforms.time.value+=this.game.deltatime;for(let er in this.windmill_fans)this.windmill_fans[er].skeleton.bones[0].rotateY(this.game.deltatime);if(this.gateOpening&&this.gateOpeningProgress<=20){let er=this.game.deltatime*.05;this.gateOpeningProgress+=er,this.gate.position.x+=er,this.gateCollider.setTranslation(this.gate.position)}}reset(){this.gateOpening=!1,this.gateOpeningProgress=0}}function dis2XZ$1(rr,er){return(rr.x-er.x)**2+(rr.z-er.z)**2}function toVec3$1(rr){return new Vector3$1(rr.x,rr.y,rr.z)}const AdditionalNumber=[0,1,1,2],AdditionalNumberAfterHalfway=[0,1,2,3],initialPositions=[new Vector3$1(95,0,-52),new Vector3$1(95,0,-52),new Vector3$1(95,0,-52),new Vector3$1(95,0,-52),new Vector3$1(95,0,-52)];class Doll extends GameObject{constructor(){super(...arguments),this.agent=[],this.target=[],this.raycaster=new Raycaster,this.lastInView=[],this.lastChecked=[],this.mesh=[],this.loader=new GLTFLoader,this.mixer=[],this.animations=[],this.lights=[],this.footprints=[],this.timestamp=0}addDoll(er=new Vector3$1(95,0,-52)){let tr=this.agent.length;if(this.agent.push(this.crowd.addAgent(er,{maxSpeed:3.3})),this.target.push(this.agent[tr].position()),this.lastChecked.push(0),this.lastInView.push(1e3),tr>0){let nr=clone(this.mesh[0]);this.mesh.push(nr),this.game.scene.add(nr);let sr=new AnimationMixer(nr);for(let ar=0;ar<this.animations.length;ar++){const or=this.animations[ar];sr.clipAction(or).play()}this.mixer.push(sr)}const ir=new Object3D;this.game.scene.add(ir),this.lights.push(new SpotLight(16711680,1,10)),this.lights[tr].target=ir,this.lights[tr].angle=Math.PI/4,this.lights[tr].penumbra=.5,this.lights[tr].power=100,this.game.scene.add(this.lights[tr])}reset(){this.agent[0].teleport(initialPositions[0]),this.mixer[0].setTime(0);for(let er=this.agent.length-1;er>0;--er)this.mesh[er].removeFromParent(),this.lights[er].removeFromParent(),this.lights[er].dispose(),this.crowd.removeAgent(this.agent[er]),this.mesh.pop(),this.agent.pop(),this.mixer.pop(),this.lights.pop(),this.target.pop(),this.lastChecked.pop(),this.lastInView.pop()}beforeStart(){for(let er=0;er<AdditionalNumber[this.game.difficulty];er++)this.addDoll()}async init(){this.altars=this.game.getGameObj(Altars),this.raycaster.layers.set(16),await new Promise((er,tr)=>{this.loader.load("model/monster/monster_walk.glb",ir=>{this.mesh.push(ir.scene.children[0]),this.game.scene.add(this.mesh[this.mesh.length-1]),this.animations=ir.animations;let nr=new AnimationMixer(this.mesh[this.mesh.length-1]);for(let sr=0;sr<this.animations.length;sr++){const ar=this.animations[sr];nr.clipAction(ar).play()}this.mixer.push(nr),removeProgess("Doll"),er()},getLoadingFunc("Doll"),function(ir){console.error(ir),tr(ir)})}),this.navmesh=await getNavmesh(),this.crowd=new Crowd(this.navmesh,{maxAgents:5,maxAgentRadius:.6}),this.crowdHelper=new CrowdHelper(this.crowd),this.navq=await getNavmeshQuery(),this.player=this.game.getGameObj(Player),this.addDoll()}lateinit(){this.worker=this.game.getGameObj(GameScene).worker,this.worker.addEventListener("message",er=>{this.lastChecked[er.data.id]=0,er.data.result||(this.lastInView[er.data.id]=0)})}updatemove(er,tr,ir,nr){let sr=toVec3$1(tr.position()),ar=new Vector3$1().subVectors(sr,er.position);er.position.x=sr.x,er.position.y=sr.y,er.position.z=sr.z,ar.normalize();const or=new Vector3$1,lr=new Vector3$1;lr.crossVectors(or,ar),er.getWorldDirection(or),or.normalize();let cr=or.angleTo(ar);cr=Math.min(cr,this.game.deltatime*5*Math.max(Math.PI/3,cr));const ur=new Quaternion$1;ur.setFromAxisAngle(lr,cr);const dr=or.clone().applyQuaternion(ur);let hr=1;cr!=0?dr.multiplyScalar(this.game.deltatime*2.5*hr):dr.multiplyScalar(this.game.deltatime*4*hr),or.z*ar.x-or.x*ar.z<0&&(cr=-cr),er.rotateY(cr),ir.update(this.game.deltatime),nr.position.copy(er.position),nr.position.y+=2,nr.position.add(or),nr.target.position.copy(nr.position),nr.target.position.add(or),nr.target.position.y=0}get_randomposition(){let{success:er,status:tr,randomPolyRef:ir,randomPoint:nr}=this.navq.findRandomPointAroundCircle(this.player.position,100);for(;!er||dis2XZ$1(this.player.position,nr)<=2e3;){let sr=this.navq.findRandomPointAroundCircle(this.player.position,100);nr=sr.randomPoint,er=sr.success}return nr}update(){for(this.timestamp+=this.game.deltatime,this.footprints.length>0&&this.footprints[0][1]<=this.timestamp-5&&this.footprints.shift(),(this.footprints.length===0||this.footprints[this.footprints.length-1][1]<=this.timestamp-.3)&&this.footprints.push([this.player.position.clone(),this.timestamp]);this.mesh.length<(this.altars.finishedAltarCount>=2?AdditionalNumber:AdditionalNumberAfterHalfway)[this.game.difficulty];){let{success:er,status:tr,randomPolyRef:ir,randomPoint:nr}=this.navq.findRandomPointAroundCircle(this.player.position,100);for(;!er||dis2XZ$1(this.player.position,nr)<=1e3;){let sr=this.navq.findRandomPointAroundCircle(this.player.position,100);nr=sr.randomPoint,er=sr.success}this.addDoll(nr)}for(let er of this.agent)er.maxSpeed=3.3+.1*this.game.difficulty;for(let er=0;er<this.mesh.length;er++){this.lastChecked[er]>=0&&(this.lastInView[er]+=this.game.deltatime);let tr=toVec3$1(this.agent[er].position());tr.y=1.5;let ir=toVec3$1(this.agent[er].position()).sub(this.player.position).negate();if(ir.y=0,dis2XZ$1(this.player.position,this.agent[er].position())<=.01)this.lastInView[er]=this.lastChecked[er]=0;else if(ir.lengthSq()>.01&&this.lastChecked[er]>=.2&&dis2XZ$1(this.player.position,this.agent[er].position())<=60*60){const lr=new Vector3$1;this.mesh[er].getWorldDirection(lr),ir.normalize(),ir.dot(lr)>=Math.cos(Math.PI/3)&&(this.raycaster.set(tr,ir),this.raycaster.far=Math.sqrt(dis2XZ$1(this.player.position,this.agent[er].position())),this.worker.postMessage({type:"raycast",eye:tr.toArray(),dir:ir.toArray(),far:Math.sqrt(dis2XZ$1(this.player.position,this.agent[er].position())),id:er}),this.lastChecked[er]=-1e5)}else this.lastChecked[er]+=this.game.deltatime;const{success:nr,error:sr,path:ar}=this.navq.computePath(this.agent[er].position(),this.target[er]);if(!nr||ar.length===0||dis2XZ$1(ar[ar.length-1],this.target[er])>.5)continue;let or=0;for(;or<ar.length-1&&(dis2XZ$1(this.agent[er].position(),ar[or])<=.1||ar[or].y>1);)++or;this.agent[er].requestMoveTarget(ar[or])}this.game.gameStarted&&this.crowd.update(this.game.deltatime),this.crowdHelper.update();for(let er=0;er<this.mesh.length;er++){if(dis2XZ$1(this.agent[er].position(),this.player.position)<=1**2&&this.player.dealDamage(),this.lastInView[er]<=.1)this.target[er]=this.player.position.clone();else if(dis2XZ$1(this.agent[er].position(),this.target[er])<=this.agent[er].radius**2){let tr=!1;for(let ir=this.footprints.length-1;ir>=0;--ir)if(dis2XZ$1(this.footprints[ir][0],this.agent[er].position())<=16){const{success:nr,error:sr,path:ar}=this.navq.computePath(this.agent[er].position(),this.target[er]);if(nr&&ar.length<=2){tr=!0,this.target[er]=this.footprints[ir][0];break}}if(!tr){let{success:ir,status:nr,randomPolyRef:sr,randomPoint:ar}=this.navq.findRandomPointAroundCircle(this.agent[er].position(),200);for(let or=0;or<5&&(!ir||dis2XZ$1(ar,this.agent[er].position())<=50*50);or++){let lr=this.navq.findRandomPointAroundCircle(this.agent[er].position(),200);ir=lr.success,ar=lr.randomPoint}ir&&(this.target[er]=ar)}}this.updatemove(this.mesh[er],this.agent[er],this.mixer[er],this.lights[er]),this.player.nearestMonsterDis=Math.min(this.player.nearestMonsterDis,Math.sqrt((this.agent[er].position().x-this.player.position.x)**2+(this.agent[er].position().z-this.player.position.z)**2))}}transmit_nearestMonster(){let er=1e6,tr=this.agent[0];for(let nr=0;nr<this.mesh.length;nr++){let sr=Math.sqrt((this.agent[nr].position().x-this.player.position.x)**2+(this.agent[nr].position().z-this.player.position.z)**2);sr<er&&(er=sr,tr=this.agent[nr])}let ir=this.get_randomposition();tr.teleport(ir)}}class Bag extends GameObject{constructor(){super(...arguments),this.sth=["","","",""]}async init(){this.player=this.game.getGameObj(Player);for(let er=0;er<=3;er++)this.sth[er]="miku"}reset(){for(let er=0;er<=3;er++)this.sth[er]="miku";this.player.inventory.selected=0,this.player.inventory.update(this.sth)}insert(er){console.log(er);for(let tr=0;tr<=3;tr++)if(this.sth[tr]=="miku"){this.sth[tr]=er;break}this.player.inventory.update(this.sth)}delete(){let er=this.player.get_inventory_activeItem();this.sth[er]!="miku"&&(this.sth[er]=="medicine"&&(this.player.add_HP(200),this.player.audio_play("healing")),this.sth[er]=="transmit"&&(this.game.getGameObj(Doll).transmit_nearestMonster(),this.player.audio_play("transmit")),this.sth[er]=="vision"&&(this.player.my_status.set_vision_time(30),this.player.audio_play("drink")),this.sth[er]=="sprint"&&(this.player.my_status.set_sprint_time(10),this.player.audio_play("drink")),console.log(this.sth[er]),this.sth[er]="miku",this.player.inventory.update(this.sth))}}let backupBones;function saveBones(rr){const er=rr.skeleton.bones;backupBones===void 0&&(backupBones=new Float32Array(er.length*7));for(let tr=0,ir=er.length;tr<ir;tr++){const nr=er[tr];nr.position.toArray(backupBones,tr*7),nr.quaternion.toArray(backupBones,tr*7+3)}}function restoreBones(rr){if(backupBones===void 0)return;const er=rr.skeleton.bones;for(let tr=0,ir=er.length;tr<ir;tr++){const nr=er[tr];nr.position.fromArray(backupBones,tr*7),nr.quaternion.fromArray(backupBones,tr*7+3)}}class Status extends GameObject{constructor(er,tr=1e3){super(),this.MPlim=800,this.vision_time=0,this.sprint_time=0,this.player=er,this.health=this.max_value=this.stamina=tr,this.MP=0}addMP(er){this.MP=Math.min(this.MP+er,this.MPlim)}addHP(er){this.health=Math.min(this.health+er,this.max_value),this.health=Math.max(this.health,0),this.health/this.max_value<=.5?this.game.scene.fog=new FogExp2(0,.06):this.game.scene.fog=new FogExp2(0,.04)}set_vision_time(er){this.vision_time=er}set_sprint_time(er){this.sprint_time=er}addstamina(er){this.sprint_time>0&&(er=this.max_value-this.stamina),this.stamina+=er,this.stamina=Math.min(this.stamina,this.max_value),this.stamina=Math.max(this.stamina,0)}delMP(er){return er=Math.min(er,this.MP),this.MP-=er,er}late_update(){this.vision_time-=this.game.deltatime,this.vision_time=Math.max(this.vision_time,0),this.vision_time>0?this.game.scene.fog=new FogExp2(0,0):this.addHP(0),this.sprint_time-=this.game.deltatime,this.sprint_time=Math.max(this.sprint_time,0)}}class Audio{constructor(er){this.ip=new Map,this.audioLoader=new AudioLoader,this.listener=er}add(er,tr){if(this.ip.has(tr))return;let ir=new Audio$1(this.listener),nr=this.ip;this.audioLoader.load(er,function(sr){ir.setBuffer(sr),ir.setLoop(!0),ir.setVolume(.3),nr[tr]=ir})}reset(){for(let er in this.ip)this.ip[er].stop()}}class d_mode{constructor(er){this.probability=.1,this.v_attack=1.6-er*.1,this.v_health=.1+er*.1,this.probability=.3-er*.05}}class Player extends GameObject{constructor(){super(...arguments),this.loader=new MMDLoader,this.controls_delta=0,this.keyMap={},this.nowact=-1,this.ip=new Map,this.actions={},this.clips={},this.charctrl=this.game.world.createCharacterController(.01),this.invincibleTime=0,this.my_status=new Status(this),this.listener=new AudioListener,this.interacting=!1,this.raycastIntersects=[],this.init_camera_rotate=5,this.nearestMonsterDis=1e3,this.actiontime=new Map,this.actionlist=new Map,this.camera_R=0,this.actionlen=1}static{this.COLLIDER_HEIGHT=1.5}get mana(){return this.my_status.MP}async init(){this.controls=new OrbitControls(this.game.camera,document.getElementsByTagName("canvas")[0]),this.controls.panSpeed=0,this.game.camera.position.z=-2,this.game.camera.position.y=2,this.controls.enabled=!1,this.controls.update(),this.controls.minPolarAngle=Math.PI*.15,this.controls.maxPolarAngle=Math.PI*.5,this.controls.maxDistance=2.5*1,this.controls.minDistance=.4,this.game.camera.add(this.listener),this.my_audio=new Audio(this.listener),this.collider=this.game.world.createCollider(ColliderDesc.capsule(Player.COLLIDER_HEIGHT/2,.5).setTranslation(0,Player.COLLIDER_HEIGHT/2,0)),await new Promise((sr,ar)=>{this.loader.load("model/stelle/stelle/2.pmx",or=>{or.scale.x*=.08,or.scale.y*=.08,or.scale.z*=.08,this.mesh=or,this.mesh.castShadow=!0,this.game.scene.add(this.mesh),this.ip.walk=0,this.ip.Idle=1,this.ip.run=2,removeProgess("Player Model"),sr()},getLoadingFunc("Player Model"),function(or){console.error(or),ar(or)})});let er,tr,ir,nr;await Promise.all([new Promise((sr,ar)=>{this.loader.loadAnimation("model/stelle/motion/Idle.vmd",this.mesh,or=>{this.clips.Idle=or,removeProgess("Idle motion"),sr()},getLoadingFunc("Idle motion"),function(or){console.error(or),ar(or)})}),new Promise((sr,ar)=>{this.loader.loadAnimation("model/stelle/motion/walk.vmd",this.mesh,or=>{this.clips.walk=or,removeProgess("Walking motion"),sr()},getLoadingFunc("Walking motion"),function(or){console.error(or),ar(or)})}),new Promise((sr,ar)=>{this.loader.loadAnimation("model/stelle/motion/run.vmd",this.mesh,or=>{this.clips.run=or,removeProgess("Running motion"),sr()},getLoadingFunc("Running motion"),function(or){console.error(or),ar(or)})}),new Promise((sr,ar)=>{er=document.createElement("img"),er.src="image/firstaid.png",er.onload=()=>{sr()}}),new Promise((sr,ar)=>{tr=document.createElement("img"),tr.src="image/nightvision.png",tr.onload=()=>{sr()}}),new Promise((sr,ar)=>{ir=document.createElement("img"),ir.src="image/teleport.png",ir.onload=()=>{sr()}}),new Promise((sr,ar)=>{nr=document.createElement("img"),nr.src="image/stamina.png",nr.onload=()=>{sr()}})]),this.inventory=new Inventory(er,tr,ir,nr),await new Promise((sr,ar)=>{this.my_audio.add("audio/heartbeat.mp3","heartbeat"),this.my_audio.add("audio/attack.mp3","attack"),this.my_audio.add("audio/running.mp3","running"),this.my_audio.add("audio/background.mp3","background"),this.my_audio.add("audio/altars_complete.mp3","altars_complete"),this.my_audio.add("audio/drink.mp3","drink"),this.my_audio.add("audio/ding.mp3","ding"),this.my_audio.add("audio/transmit.mp3","transmit"),this.my_audio.add("audio/gate.mp3","gate"),this.my_audio.add("audio/healing.mp3","healing"),sr()}),this.iksolver=new CCDIKSolver(this.mesh,this.mesh.geometry.userData.MMD.iks),this.mesh.name="Player",this.mixer=new AnimationMixer(this.mesh),this.actions[this.ip.Idle]=this.mixer.clipAction(this.clips.Idle),this.actions[this.ip.walk]=this.mixer.clipAction(this.clips.walk),this.actions[this.ip.run]=this.mixer.clipAction(this.clips.run),document.addEventListener("keydown",sr=>{sr.key=="Enter"||this.game.isPaused||(sr.key=="f"?(this.keyMap[sr.key]==!1&&(this.interacting=!0),this.keyMap[sr.key]=!0):sr.key=="e"?this.game.getGameObj(Bag).delete():this.keyMap[sr.key]=!0)}),document.addEventListener("keyup",sr=>{this.keyMap[sr.key]=!1}),this.keyMap.w=this.keyMap.a=this.keyMap.s=this.keyMap.d=this.keyMap[" "]=!1,this.mesh.scale.set(1,1,1),this.physics=new MMDPhysics(this.mesh,this.mesh.geometry.userData.MMD.rigidBodies,this.mesh.geometry.userData.MMD.constraints,{unitStep:1/35,maxStepNum:3,gravity:new Vector3$1(0,-9.8/.08,0)}),this.mesh.scale.set(.08,.08,.08)}reset(){this.my_audio.reset(),this.mesh.position.set(0,0,0),this.mesh.quaternion.copy(new Quaternion$1),this.game.camera.position.set(0,2,-2),this.controls.enabled=!1,this.controls.update(0),this.mesh.scale.set(1,1,1),this.mesh.skeleton.pose(),this.physics.reset(),this.mesh.scale.set(.08,.08,.08),this.init_camera_rotate=5,this.my_status=new Status(this),this.collider.setTranslation(new Vector3(0,Player.COLLIDER_HEIGHT/2,0)),this.nowact=-1,this.controls_delta=0,this.mixer.setTime(0),this.camera_R=0,this.hintElem&&removeHint(this.hintElem)}set_interact(er,tr){this.interact_object=tr,this.q_interact=er}lateinit(){document.body.appendChild(this.inventory.element),this.game.scene.traverse(er=>{er.layers.isEnabled(16)&&!er.name.match("tree")&&er.isMesh&&!er.isInstancedMesh&&this.raycastIntersects.push(er)})}updateAnimation(er){restoreBones(this.mesh),er!=this.nowact&&(this.actions[er].reset(),this.actions[er].play(),this.actions[er].setEffectiveWeight(1).crossFadeFrom(this.actions[this.nowact],.3,!1),this.nowact=er),this.mixer.update(this.game.deltatime),saveBones(this.mesh),this.iksolver.update();const tr=this.mesh.geometry.userData.MMD.grants;let ir=new Quaternion$1;for(let nr=0,sr=tr.length;nr<sr;nr++)if(!tr[nr].isLocal&&tr[nr].affectRotation){const ar=this.mesh.skeleton.bones,or=ar[tr[nr].index],lr=ar[tr[nr].parentIndex];ir.set(0,0,0,1),ir.slerp(lr.quaternion,tr[nr].ratio),or.quaternion.multiply(ir)}this.game.deltatime>0&&this.physics.update(this.game.deltatime)}beforeStart(){this.my_audio.ip.attack.setLoop(!1),this.my_audio.ip.healing.setLoop(!1),this.my_audio.ip.altars_complete.setLoop(!1),this.my_audio.ip.drink.setLoop(!1),this.my_audio.ip.ding.setLoop(!1),this.my_audio.ip.transmit.setLoop(!1),this.my_audio.ip.gate.setLoop(!1),this.my_audio.ip.heartbeat.setVolume(0),this.my_audio.ip.gate.setVolume(.2),this.my_audio.ip.heartbeat.play(),this.my_audio.ip.background.setVolume(.4),this.my_audio.ip.background.play(),this.my_mode=new d_mode(this.game.difficulty)}updateUI(){const er=document.getElementById("health-ui"),tr=document.getElementById("stamina-ui"),ir=document.getElementById("MP-ui"),nr=this.my_status;er.children[0].style.width=(nr.health/nr.max_value*100).toFixed(0)+"%",tr.children[0].style.width=(nr.stamina/nr.max_value*100).toFixed(0)+"%",ir.children[0].style.width=(nr.MP/nr.MPlim*100).toFixed(0)+"%"}get_mesh_position(){return this.mesh.position}updateStatus(){let er=this.my_status;this.keyMap[" "]?(er.addstamina(-this.game.deltatime*800/10),er.last_running=0):(er.last_running+=this.game.deltatime,er.last_running>=3&&er.addstamina(this.game.deltatime*50*Math.min(er.last_running**2/16,10))),this.my_audio.ip.running.setVolume(Math.max(0,1-er.stamina/er.max_value/.3)),er.stamina/er.max_value<=.4&&this.my_audio.ip.running.isPlaying==!1&&this.my_audio.ip.running.play(),er.stamina/er.max_value>.35&&this.my_audio.ip.running.isPlaying==!0&&this.my_audio.ip.running.stop(),this.updateUI()}computeVelocity(){let er=new Vector3$1;this.game.camera.getWorldDirection(er),er.y=0,er.normalize();let tr=er.clone(),ir=tr.x;if(tr.x=-tr.z,tr.z=ir,this.game.isPaused)for(let nr in this.keyMap)this.keyMap[nr]=!1;return er.multiplyScalar(Number(this.keyMap.w)-Number(this.keyMap.s)),tr.multiplyScalar(Number(this.keyMap.d)-Number(this.keyMap.a)),er.add(tr),er}update(){this.init_camera_rotate-=this.game.deltatime,this.init_camera_rotate<=3.7&&this.init_camera_rotate>=0&&(this.controls.autoRotate=!0,this.controls.autoRotateSpeed=10,this.controls.update()),this.init_camera_rotate<0&&!this.game.gameStarted&&(this.controls.enabled=!0,this.game.gameStarted=!0,this.controls.autoRotate=!1,this.controls.update());let er=this.game.camera.up;if(er.applyAxisAngle(new Vector3$1(0,1,0),Math.min(this.game.deltatime,this.camera_R)*30),this.game.camera.up.set(er.x,er.y,er.z),this.camera_R=Math.max(this.camera_R-this.game.deltatime,0),this.camera_R<=this.game.deltatime&&this.game.camera.up.set(0,1,0),this.nowact==-1){this.nowact=this.ip.Idle;for(let nr=0;nr<this.actionlen;nr++)this.actionlist[nr]=this.ip.Idle;this.actions[this.ip.Idle].play(),this.actions[this.ip.Idle].setEffectiveWeight(1).fadeIn(.5)}let tr=this.computeVelocity(),ir;if(tr.lengthSq()!=0&&this.init_camera_rotate<=0){ir=this.ip.walk,this.keyMap[" "]&&this.my_status.stamina&&(ir=this.ip.run),tr.normalize();const nr=new Vector3$1,sr=new Vector3$1;sr.crossVectors(nr,tr),this.mesh.getWorldDirection(nr),nr.normalize();let ar=nr.angleTo(tr),or=nr.dot(tr);ar=Math.min(ar,this.game.deltatime*5*Math.max(Math.PI/3,ar));const lr=new Quaternion$1;lr.setFromAxisAngle(sr,ar);const cr=nr.clone().applyQuaternion(lr);let ur=0;ir==this.ip.walk&&(ur=1),ir==this.ip.run&&(ur=1.5),this.invincibleTime>0&&(ur=ur*this.my_mode.v_attack),ur=ur*(1-this.my_mode.v_health+this.my_mode.v_health*(this.my_status.health/this.my_status.max_value));let dr=ar==0?this.game.deltatime*3.7*ur:this.game.deltatime*2.5*ur;nr.z*tr.x-nr.x*tr.z<0&&(ar=-ar),this.mesh.rotateY(ar);let hr=cr;for(let gr=0;gr<3;gr++){let vr=hr.x**2+hr.y**2+hr.z**2;if(vr<=1e-4&&gr>0)break;vr=Math.sqrt(vr),vr/=dr,hr=new Vector3(hr.x/vr,hr.y/vr,hr.z/vr),this.charctrl.computeColliderMovement(this.collider,hr),hr=this.charctrl.computedMovement()}this.mesh.position.add(hr),this.game.camera.position.add(hr);let pr=this.mesh.position.clone();pr.y+=Player.COLLIDER_HEIGHT/2,this.collider.setTranslation(pr)}else ir=this.ip.Idle;this.updateAnimation(ir),this.updateStatus()}dealDamage(){if(this.invincibleTime>0)return;if(this.interacting=!1,this.camera_R=2*Math.PI/30,this.game.camera.up.set(-Math.sin(.05),Math.cos(.05),0),this.my_audio.ip.attack.play(),this.my_status.addHP(-200),this.invincibleTime=5,this.my_status.health<=0){let tr=document.getElementById("invincible-ui");tr.style.display="none",this.my_audio.ip.heartbeat.stop(),setTimeout(()=>{this.game.endGame()},1e3);return}let er=document.getElementById("invincible-ui");er.style.display="",er.children[0].ariaValueNow="10",er.children[0].style.width="100%",this.invincibleAnimation=er.children[0].animate({width:"0%"},this.invincibleTime*1e3),this.invincibleAnimation.onfinish=()=>{er.style.display="none"}}update_interact(){if(this.q_interact=="miku"){this.hintElem!=null&&(removeHint(this.hintElem),this.hintElem=void 0),this.interacting=!1;return}this.q_interact!="miku"&&this.hintElem===void 0&&!this.interacting&&(this.hintElem=createHint("Press F Key to interact")),this.q_interact=="Trash"&&this.interact_object.cooldown>0&&(this.hintElem||(this.hintElem=createHint("")),this.hintElem.innerText="Trash bin cooldown: "+this.interact_object.cooldown.toFixed(0)+"s"),this.interacting==!0&&(this.interact_object.interact(),this.hintElem!=null&&this.q_interact=="Altar"&&(removeHint(this.hintElem),this.hintElem=void 0)),this.q_interact="miku"}updateCameraPosition(){this.controls.update(0);let er=new Vector3$1().subVectors(this.game.camera.position,this.controls.target),tr=er.length();er.normalize(),tr+=this.controls_delta/7,this.game.camera.position.addScaledVector(er,this.controls_delta/7),this.controls_delta*=6/7;let ir=new Raycaster(this.controls.target,er,0,tr);ir.layers.set(16),ir.firstHitOnly=!0;let nr=[],sr=new Vector3$1;for(let or of this.raycastIntersects)or.getWorldPosition(sr),sr.distanceToSquared(this.mesh.position)<=20*20&&nr.push(or);let ar=ir.intersectObjects(nr);if(ar.length>0)for(let or of ar)or.point.distanceToSquared(this.controls.target)<this.game.camera.position.distanceToSquared(this.controls.target)&&this.game.camera.position.copy(or.point);this.controls_delta+=tr-this.controls.getDistance(),this.controls.update(this.game.deltatime)}pauseUpdate(){for(let tr in this.keyMap)this.keyMap[tr]=!1;let er=document.getElementById("invincible-ui");this.invincibleAnimation&&(er.children[0].style.width=er.children[0].clientWidth.toString()+"px",this.invincibleAnimation.cancel(),this.invincibleAnimation=void 0)}lateUpdate(){let er=document.getElementById("invincible-ui");if(!this.invincibleAnimation&&this.invincibleTime>0&&(this.invincibleAnimation=er.children[0].animate({width:"0%"},this.invincibleTime*1e3),this.invincibleAnimation.onfinish=()=>{er.style.display="none"}),this.controls.target.copy(this.mesh.position),this.controls.target.y+=2,this.updateCameraPosition(),this.invincibleTime>0){this.invincibleTime-=this.game.deltatime;let tr=document.getElementById("invincible-ui");tr.children[0].ariaValueNow=this.invincibleTime.toFixed(1)}else if(this.invincibleTime<0){this.invincibleTime=0;let tr=document.getElementById("invincible-ui");tr.style.display="none",this.invincibleAnimation=void 0}this.nearestMonsterDis=Math.max(this.nearestMonsterDis/2,1),this.nearestMonsterDis>=20?this.my_audio.ip.heartbeat.setVolume(0):this.my_audio.ip.heartbeat.setVolume(1/this.nearestMonsterDis/this.nearestMonsterDis),this.nearestMonsterDis=1e3,this.update_interact(),this.my_status.late_update(),(this.mesh.position.z<=-100||this.mesh.position.z<=-90&&Math.abs(this.mesh.position.x)>=20)&&this.game.victory()}add_MP(er){this.my_status.addMP(er)}add_HP(er){this.my_status.addHP(er)}del_MP(er){return this.my_status.delMP(er)}get_inventory_activeItem(){return this.inventory.selected}get position(){return this.mesh.position}get_probability(){return this.my_mode.probability}audio_play(er){this.my_audio.ip[er].play()}}function dis2XZ(rr,er){return(rr.x-er.x)**2+(rr.z-er.z)**2}function toVec3(rr){return new Vector3$1(rr.x,rr.y,rr.z)}const initialPosition=new Vector3$1(-32,0,45);class Ghost extends GameObject{constructor(){super(...arguments),this.mesh=[],this.light=new SpotLight(16711680,1,10),this.loader=new GLTFLoader}async init(){this.game.scene.add(this.light),await new Promise((tr,ir)=>{this.loader.load("model/monster/ghost.glb",nr=>{this.mesh.push(nr.scene.children[0]),this.game.scene.add(this.mesh[this.mesh.length-1]),removeProgess("Ghost"),tr()},getLoadingFunc("Ghost"),function(nr){console.error(nr),ir(nr)})}),this.navmesh=await getNavmesh(),this.crowd=new Crowd(this.navmesh,{maxAgents:1,maxAgentRadius:.6}),this.agent=this.crowd.addAgent(initialPosition,{maxSpeed:2.2}),this.crowdHelper=new CrowdHelper(this.crowd),this.navq=await getNavmeshQuery(),this.player=this.game.getGameObj(Player);const er=new Object3D;this.game.scene.add(er),this.light.target=er,this.light.angle=Math.PI/4,this.light.penumbra=.5,this.light.power=100}updatemove(er,tr){let ir=toVec3(tr.position()),nr=new Vector3$1().subVectors(ir,er.position);er.position.x=ir.x,er.position.y=ir.y,er.position.z=ir.z,nr.normalize();const sr=new Vector3$1,ar=new Vector3$1;ar.crossVectors(sr,nr),er.getWorldDirection(sr),sr.normalize();let or=sr.angleTo(nr);or=Math.min(or,this.game.deltatime*5*Math.max(Math.PI/3,or)),new Quaternion$1().setFromAxisAngle(ar,or),sr.z*nr.x-sr.x*nr.z<0&&(or=-or),er.rotateY(or),this.light.position.copy(er.position),this.light.position.y+=2,this.light.position.add(sr),this.light.target.position.copy(this.light.position),this.light.target.position.add(sr),this.light.target.position.y=0}update(){const{success:er,error:tr,path:ir}=this.navq.computePath(this.agent.position(),this.player.position);if(ir.length>0&&dis2XZ(ir[ir.length-1],this.player.position)<=.5){let nr=0;for(;nr<ir.length-1&&(this.agent.position().x-ir[nr].x)**2+(this.agent.position().z-ir[nr].z)**2<=.01;)++nr;this.agent.requestMoveTarget(ir[nr])}this.game.gameStarted&&this.crowd.update(this.game.deltatime),this.updatemove(this.mesh[0],this.agent),this.crowdHelper.update(),(this.agent.position().x-this.player.position.x)**2+(this.agent.position().z-this.player.position.z)**2<=1**2&&this.player.dealDamage(),this.player.nearestMonsterDis=Math.min(this.player.nearestMonsterDis,Math.sqrt((this.agent.position().x-this.player.position.x)**2+(this.agent.position().z-this.player.position.z)**2))}reset(){this.agent.teleport(initialPosition)}}/**
 * postprocessing v6.36.4 build Tue Nov 05 2024
 * https://github.com/pmndrs/postprocessing
 * Copyright 2015-2024 Raoul van Rschen
 * @license Zlib
 */var version="6.36.4",Disposable=class{dispose(){}},MILLISECONDS_TO_SECONDS=1/1e3,SECONDS_TO_MILLISECONDS=1e3,Timer=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(rr){typeof document<"u"&&document.hidden!==void 0&&(rr?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=rr)}get delta(){return this._delta*MILLISECONDS_TO_SECONDS}get fixedDelta(){return this._fixedDelta*MILLISECONDS_TO_SECONDS}set fixedDelta(rr){this._fixedDelta=rr*SECONDS_TO_MILLISECONDS}get elapsed(){return this._elapsed*MILLISECONDS_TO_SECONDS}update(rr){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(rr!==void 0?rr:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(rr){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},fullscreenGeometry=(()=>{const rr=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),er=new Float32Array([0,0,2,0,0,2]),tr=new BufferGeometry;return tr.setAttribute("position",new BufferAttribute(rr,3)),tr.setAttribute("uv",new BufferAttribute(er,2)),tr})(),Pass=class oo{static get fullscreenGeometry(){return fullscreenGeometry}constructor(er="Pass",tr=new Scene,ir=new Camera){this.name=er,this.renderer=null,this.scene=tr,this.camera=ir,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(er){if(this.rtt===er){const tr=this.fullscreenMaterial;tr!==null&&(tr.needsUpdate=!0),this.rtt=!er}}set mainScene(er){}set mainCamera(er){}setRenderer(er){this.renderer=er}isEnabled(){return this.enabled}setEnabled(er){this.enabled=er}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(er){let tr=this.screen;tr!==null?tr.material=er:(tr=new Mesh(oo.fullscreenGeometry,er),tr.frustumCulled=!1,this.scene===null&&(this.scene=new Scene),this.scene.add(tr),this.screen=tr)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(er){this.fullscreenMaterial=er}getDepthTexture(){return null}setDepthTexture(er,tr=BasicDepthPacking){}render(er,tr,ir,nr,sr){throw new Error("Render method not implemented!")}setSize(er,tr){}initialize(er,tr,ir){}dispose(){for(const er of Object.keys(this)){const tr=this[er];(tr instanceof WebGLRenderTarget||tr instanceof Material||tr instanceof Texture||tr instanceof oo)&&this[er].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},ClearMaskPass=class extends Pass{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(rr,er,tr,ir,nr){const sr=rr.state.buffers.stencil;sr.setLocked(!1),sr.setTest(!1)}},copy_default=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform float opacity;varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=opacity*texel;
#include <colorspace_fragment>
#include <dithering_fragment>
}`,common_default="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",CopyMaterial=class extends ShaderMaterial{constructor(){super({name:"CopyMaterial",uniforms:{inputBuffer:new Uniform(null),opacity:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:copy_default,vertexShader:common_default})}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}getOpacity(rr){return this.uniforms.opacity.value}setOpacity(rr){this.uniforms.opacity.value=rr}},CopyPass=class extends Pass{constructor(rr,er=!0){super("CopyPass"),this.fullscreenMaterial=new CopyMaterial,this.needsSwap=!1,this.renderTarget=rr,rr===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{minFilter:LinearFilter,magFilter:LinearFilter,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=er}get resize(){return this.autoResize}set resize(rr){this.autoResize=rr}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(rr){this.autoResize=rr}render(rr,er,tr,ir,nr){this.fullscreenMaterial.inputBuffer=er.texture,rr.setRenderTarget(this.renderToScreen?null:this.renderTarget),rr.render(this.scene,this.camera)}setSize(rr,er){this.autoResize&&this.renderTarget.setSize(rr,er)}initialize(rr,er,tr){tr!==void 0&&(this.renderTarget.texture.type=tr,tr!==UnsignedByteType?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTarget.texture.colorSpace=SRGBColorSpace))}},color=new Color,ClearPass=class extends Pass{constructor(rr=!0,er=!0,tr=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=rr,this.depth=er,this.stencil=tr,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(rr,er,tr){this.color=rr,this.depth=er,this.stencil=tr}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(rr){this.overrideClearColor=rr}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(rr){this.overrideClearAlpha=rr}render(rr,er,tr,ir,nr){const sr=this.overrideClearColor,ar=this.overrideClearAlpha,or=rr.getClearAlpha(),lr=sr!==null,cr=ar>=0;lr?(rr.getClearColor(color),rr.setClearColor(sr,cr?ar:or)):cr&&rr.setClearAlpha(ar),rr.setRenderTarget(this.renderToScreen?null:er),rr.clear(this.color,this.depth,this.stencil),lr?rr.setClearColor(color,or):cr&&rr.setClearAlpha(or)}},MaskPass=class extends Pass{constructor(rr,er){super("MaskPass",rr,er),this.needsSwap=!1,this.clearPass=new ClearPass(!1,!1,!0),this.inverse=!1}set mainScene(rr){this.scene=rr}set mainCamera(rr){this.camera=rr}get inverted(){return this.inverse}set inverted(rr){this.inverse=rr}get clear(){return this.clearPass.enabled}set clear(rr){this.clearPass.enabled=rr}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(rr){this.inverted=rr}render(rr,er,tr,ir,nr){const sr=rr.getContext(),ar=rr.state.buffers,or=this.scene,lr=this.camera,cr=this.clearPass,ur=this.inverted?0:1,dr=1-ur;ar.color.setMask(!1),ar.depth.setMask(!1),ar.color.setLocked(!0),ar.depth.setLocked(!0),ar.stencil.setTest(!0),ar.stencil.setOp(sr.REPLACE,sr.REPLACE,sr.REPLACE),ar.stencil.setFunc(sr.ALWAYS,ur,4294967295),ar.stencil.setClear(dr),ar.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?cr.render(rr,null):(cr.render(rr,er),cr.render(rr,tr))),this.renderToScreen?(rr.setRenderTarget(null),rr.render(or,lr)):(rr.setRenderTarget(er),rr.render(or,lr),rr.setRenderTarget(tr),rr.render(or,lr)),ar.color.setLocked(!1),ar.depth.setLocked(!1),ar.stencil.setLocked(!1),ar.stencil.setFunc(sr.EQUAL,1,4294967295),ar.stencil.setOp(sr.KEEP,sr.KEEP,sr.KEEP),ar.stencil.setLocked(!0)}},EffectComposer=class{constructor(rr=null,{depthBuffer:er=!0,stencilBuffer:tr=!1,multisampling:ir=0,frameBufferType:nr}={}){this.renderer=null,this.inputBuffer=this.createBuffer(er,tr,nr,ir),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new CopyPass,this.depthTexture=null,this.passes=[],this.timer=new Timer,this.autoRenderToScreen=!0,this.setRenderer(rr)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(rr){const er=this.inputBuffer,tr=this.multisampling;tr>0&&rr>0?(this.inputBuffer.samples=rr,this.outputBuffer.samples=rr,this.inputBuffer.dispose(),this.outputBuffer.dispose()):tr!==rr&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(er.depthBuffer,er.stencilBuffer,er.texture.type,rr),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(rr){if(this.renderer=rr,rr!==null){const er=rr.getSize(new Vector2),tr=rr.getContext().getContextAttributes().alpha,ir=this.inputBuffer.texture.type;ir===UnsignedByteType&&rr.outputColorSpace===SRGBColorSpace&&(this.inputBuffer.texture.colorSpace=SRGBColorSpace,this.outputBuffer.texture.colorSpace=SRGBColorSpace,this.inputBuffer.dispose(),this.outputBuffer.dispose()),rr.autoClear=!1,this.setSize(er.width,er.height);for(const nr of this.passes)nr.initialize(rr,tr,ir)}}replaceRenderer(rr,er=!0){const tr=this.renderer,ir=tr.domElement.parentNode;return this.setRenderer(rr),er&&ir!==null&&(ir.removeChild(tr.domElement),ir.appendChild(rr.domElement)),tr}createDepthTexture(){const rr=this.depthTexture=new DepthTexture;return this.inputBuffer.depthTexture=rr,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(rr.format=DepthStencilFormat,rr.type=UnsignedInt248Type):rr.type=UnsignedIntType,rr}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const rr of this.passes)rr.setDepthTexture(null)}}createBuffer(rr,er,tr,ir){const nr=this.renderer,sr=nr===null?new Vector2:nr.getDrawingBufferSize(new Vector2),ar={minFilter:LinearFilter,magFilter:LinearFilter,stencilBuffer:er,depthBuffer:rr,type:tr},or=new WebGLRenderTarget(sr.width,sr.height,ar);return ir>0&&(or.ignoreDepthForMultisampleCopy=!1,or.samples=ir),tr===UnsignedByteType&&nr!==null&&nr.outputColorSpace===SRGBColorSpace&&(or.texture.colorSpace=SRGBColorSpace),or.texture.name="EffectComposer.Buffer",or.texture.generateMipmaps=!1,or}setMainScene(rr){for(const er of this.passes)er.mainScene=rr}setMainCamera(rr){for(const er of this.passes)er.mainCamera=rr}addPass(rr,er){const tr=this.passes,ir=this.renderer,nr=ir.getDrawingBufferSize(new Vector2),sr=ir.getContext().getContextAttributes().alpha,ar=this.inputBuffer.texture.type;if(rr.setRenderer(ir),rr.setSize(nr.width,nr.height),rr.initialize(ir,sr,ar),this.autoRenderToScreen&&(tr.length>0&&(tr[tr.length-1].renderToScreen=!1),rr.renderToScreen&&(this.autoRenderToScreen=!1)),er!==void 0?tr.splice(er,0,rr):tr.push(rr),this.autoRenderToScreen&&(tr[tr.length-1].renderToScreen=!0),rr.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const or=this.createDepthTexture();for(rr of tr)rr.setDepthTexture(or)}else rr.setDepthTexture(this.depthTexture)}removePass(rr){const er=this.passes,tr=er.indexOf(rr);if(tr!==-1&&er.splice(tr,1).length>0){if(this.depthTexture!==null){const sr=(or,lr)=>or||lr.needsDepthTexture;er.reduce(sr,!1)||(rr.getDepthTexture()===this.depthTexture&&rr.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&tr===er.length&&(rr.renderToScreen=!1,er.length>0&&(er[er.length-1].renderToScreen=!0))}}removeAllPasses(){const rr=this.passes;this.deleteDepthTexture(),rr.length>0&&(this.autoRenderToScreen&&(rr[rr.length-1].renderToScreen=!1),this.passes=[])}render(rr){const er=this.renderer,tr=this.copyPass;let ir=this.inputBuffer,nr=this.outputBuffer,sr=!1,ar,or,lr;rr===void 0&&(this.timer.update(),rr=this.timer.getDelta());for(const cr of this.passes)cr.enabled&&(cr.render(er,ir,nr,rr,sr),cr.needsSwap&&(sr&&(tr.renderToScreen=cr.renderToScreen,ar=er.getContext(),or=er.state.buffers.stencil,or.setFunc(ar.NOTEQUAL,1,4294967295),tr.render(er,ir,nr,rr,sr),or.setFunc(ar.EQUAL,1,4294967295)),lr=ir,ir=nr,nr=lr),cr instanceof MaskPass?sr=!0:cr instanceof ClearMaskPass&&(sr=!1))}setSize(rr,er,tr){const ir=this.renderer,nr=ir.getSize(new Vector2);(rr===void 0||er===void 0)&&(rr=nr.width,er=nr.height),(nr.width!==rr||nr.height!==er)&&ir.setSize(rr,er,tr);const sr=ir.getDrawingBufferSize(new Vector2);this.inputBuffer.setSize(sr.width,sr.height),this.outputBuffer.setSize(sr.width,sr.height);for(const ar of this.passes)ar.setSize(sr.width,sr.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const rr of this.passes)rr.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Pass.fullscreenGeometry.dispose()}},EffectAttribute={NONE:0,DEPTH:1,CONVOLUTION:2},EffectShaderSection={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},EffectShaderData=class{constructor(){this.shaderParts=new Map([[EffectShaderSection.FRAGMENT_HEAD,null],[EffectShaderSection.FRAGMENT_MAIN_UV,null],[EffectShaderSection.FRAGMENT_MAIN_IMAGE,null],[EffectShaderSection.VERTEX_HEAD,null],[EffectShaderSection.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=EffectAttribute.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=LinearSRGBColorSpace}};function getCoefficients(rr){let er;if(rr===0)er=new Float64Array(0);else if(rr===1)er=new Float64Array([1]);else if(rr>1){let tr=new Float64Array(rr),ir=new Float64Array(rr);for(let nr=1;nr<=rr;++nr){for(let sr=0;sr<nr;++sr)ir[sr]=sr===0||sr===nr-1?1:tr[sr-1]+tr[sr];er=ir,ir=tr,tr=er}}return er}var GaussKernel=class{constructor(rr,er=2){this.weights=null,this.offsets=null,this.linearWeights=null,this.linearOffsets=null,this.generate(rr,er)}get steps(){return this.offsets===null?0:this.offsets.length}get linearSteps(){return this.linearOffsets===null?0:this.linearOffsets.length}generate(rr,er){if(rr<3||rr>1020)throw new Error("The kernel size must be in the range [3, 1020]");const tr=rr+er*2,ir=er>0?getCoefficients(tr).slice(er,-er):getCoefficients(tr),nr=Math.floor((ir.length-1)/2),sr=ir.reduce((dr,hr)=>dr+hr,0),ar=ir.slice(nr),or=[...Array(nr+1).keys()],lr=new Float64Array(Math.floor(or.length/2)),cr=new Float64Array(lr.length);lr[0]=ar[0]/sr;for(let dr=1,hr=1,pr=or.length-1;dr<pr;dr+=2,++hr){const gr=or[dr],vr=or[dr+1],mr=ar[dr],fr=ar[dr+1],_r=mr+fr,Ar=(gr*mr+vr*fr)/_r;lr[hr]=_r/sr,cr[hr]=Ar}for(let dr=0,hr=ar.length,pr=1/sr;dr<hr;++dr)ar[dr]*=pr;const ur=(lr.reduce((dr,hr)=>dr+hr,0)-lr[0]*.5)*2;if(ur!==0)for(let dr=0,hr=lr.length,pr=1/ur;dr<hr;++dr)lr[dr]*=pr;this.offsets=or,this.weights=ar,this.linearOffsets=cr,this.linearWeights=lr}},ImmutableTimer=class{getDelta(){return NaN}getElapsed(){return NaN}},Initializable=class{initialize(rr,er,tr){}},workaroundEnabled=!1,OverrideMaterialManager=class{constructor(rr=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(rr),this.meshCount=0,this.replaceMaterial=er=>{if(er.isMesh){let tr;if(er.material.flatShading)switch(er.material.side){case DoubleSide:tr=this.materialsFlatShadedDoubleSide;break;case BackSide:tr=this.materialsFlatShadedBackSide;break;default:tr=this.materialsFlatShaded;break}else switch(er.material.side){case DoubleSide:tr=this.materialsDoubleSide;break;case BackSide:tr=this.materialsBackSide;break;default:tr=this.materials;break}this.originalMaterials.set(er,er.material),er.isSkinnedMesh?er.material=tr[2]:er.isInstancedMesh?er.material=tr[1]:er.material=tr[0],++this.meshCount}}}cloneMaterial(rr){if(!(rr instanceof ShaderMaterial))return rr.clone();const er=rr.uniforms,tr=new Map;for(const nr in er){const sr=er[nr].value;sr.isRenderTargetTexture&&(er[nr].value=null,tr.set(nr,sr))}const ir=rr.clone();for(const nr of tr)er[nr[0]].value=nr[1],ir.uniforms[nr[0]].value=nr[1];return ir}setMaterial(rr){if(this.disposeMaterials(),this.material=rr,rr!==null){const er=this.materials=[this.cloneMaterial(rr),this.cloneMaterial(rr),this.cloneMaterial(rr)];for(const tr of er)tr.uniforms=Object.assign({},rr.uniforms),tr.side=FrontSide;er[2].skinning=!0,this.materialsBackSide=er.map(tr=>{const ir=this.cloneMaterial(tr);return ir.uniforms=Object.assign({},rr.uniforms),ir.side=BackSide,ir}),this.materialsDoubleSide=er.map(tr=>{const ir=this.cloneMaterial(tr);return ir.uniforms=Object.assign({},rr.uniforms),ir.side=DoubleSide,ir}),this.materialsFlatShaded=er.map(tr=>{const ir=this.cloneMaterial(tr);return ir.uniforms=Object.assign({},rr.uniforms),ir.flatShading=!0,ir}),this.materialsFlatShadedBackSide=er.map(tr=>{const ir=this.cloneMaterial(tr);return ir.uniforms=Object.assign({},rr.uniforms),ir.flatShading=!0,ir.side=BackSide,ir}),this.materialsFlatShadedDoubleSide=er.map(tr=>{const ir=this.cloneMaterial(tr);return ir.uniforms=Object.assign({},rr.uniforms),ir.flatShading=!0,ir.side=DoubleSide,ir})}}render(rr,er,tr){const ir=rr.shadowMap.enabled;if(rr.shadowMap.enabled=!1,workaroundEnabled){const nr=this.originalMaterials;this.meshCount=0,er.traverse(this.replaceMaterial),rr.render(er,tr);for(const sr of nr)sr[0].material=sr[1];this.meshCount!==nr.size&&nr.clear()}else{const nr=er.overrideMaterial;er.overrideMaterial=this.material,rr.render(er,tr),er.overrideMaterial=nr}rr.shadowMap.enabled=ir}disposeMaterials(){if(this.material!==null){const rr=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const er of rr)er.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return workaroundEnabled}static set workaroundEnabled(rr){workaroundEnabled=rr}},Resizable=class{setSize(rr,er){}},AUTO_SIZE=-1,Resolution=class extends EventDispatcher{constructor(rr,er=AUTO_SIZE,tr=AUTO_SIZE,ir=1){super(),this.resizable=rr,this.baseSize=new Vector2(1,1),this.preferredSize=new Vector2(er,tr),this.target=this.preferredSize,this.s=ir,this.effectiveSize=new Vector2,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const rr=this.baseSize,er=this.preferredSize,tr=this.effectiveSize,ir=this.scale;er.width!==AUTO_SIZE?tr.width=er.width:er.height!==AUTO_SIZE?tr.width=Math.round(er.height*(rr.width/Math.max(rr.height,1))):tr.width=Math.round(rr.width*ir),er.height!==AUTO_SIZE?tr.height=er.height:er.width!==AUTO_SIZE?tr.height=Math.round(er.width/Math.max(rr.width/Math.max(rr.height,1),1)):tr.height=Math.round(rr.height*ir)}get width(){return this.effectiveSize.width}set width(rr){this.preferredWidth=rr}get height(){return this.effectiveSize.height}set height(rr){this.preferredHeight=rr}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(rr){this.s!==rr&&(this.s=rr,this.preferredSize.setScalar(AUTO_SIZE),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(rr){this.scale=rr}get baseWidth(){return this.baseSize.width}set baseWidth(rr){this.baseSize.width!==rr&&(this.baseSize.width=rr,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(rr){this.baseWidth=rr}get baseHeight(){return this.baseSize.height}set baseHeight(rr){this.baseSize.height!==rr&&(this.baseSize.height=rr,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(rr){this.baseHeight=rr}setBaseSize(rr,er){(this.baseSize.width!==rr||this.baseSize.height!==er)&&(this.baseSize.set(rr,er),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(rr){this.preferredSize.width!==rr&&(this.preferredSize.width=rr,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(rr){this.preferredWidth=rr}get preferredHeight(){return this.preferredSize.height}set preferredHeight(rr){this.preferredSize.height!==rr&&(this.preferredSize.height=rr,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(rr){this.preferredHeight=rr}setPreferredSize(rr,er){(this.preferredSize.width!==rr||this.preferredSize.height!==er)&&(this.preferredSize.set(rr,er),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(rr){this.s=rr.scale,this.baseSize.set(rr.baseWidth,rr.baseHeight),this.preferredSize.set(rr.preferredWidth,rr.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return AUTO_SIZE}},IdManager=class{constructor(rr=0){this.nextId=rr}getNextId(){return this.nextId++}reset(rr=0){return this.nextId=rr,this}},idManager=new IdManager(2),Selection=class extends Set{constructor(rr,er=idManager.getNextId()){super(),this.exclusive=!1,this._layer=er,(this._layer<1||this._layer>31)&&(console.warn("Layer out of range, resetting to 2"),idManager.reset(2),this._layer=idManager.getNextId()),rr!==void 0&&this.set(rr)}get layer(){return this._layer}set layer(rr){const er=this._layer;for(const tr of this)tr.layers.disable(er),tr.layers.enable(rr);this._layer=rr}getLayer(){return this.layer}setLayer(rr){this.layer=rr}isExclusive(){return this.exclusive}setExclusive(rr){this.exclusive=rr}clear(){const rr=this.layer;for(const er of this)er.layers.disable(rr);return super.clear()}set(rr){this.clear();for(const er of rr)this.add(er);return this}indexOf(rr){return this.has(rr)?0:-1}add(rr){return this.exclusive?rr.layers.set(this.layer):rr.layers.enable(this.layer),super.add(rr)}delete(rr){return this.has(rr)&&rr.layers.disable(this.layer),super.delete(rr)}toggle(rr){let er;return this.has(rr)?(this.delete(rr),er=!1):(this.add(rr),er=!0),er}setVisible(rr){for(const er of this)rr?er.layers.enable(0):er.layers.disable(0);return this}},BlendFunction={SKIP:9,SET:30,ADD:0,ALPHA:1,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},add_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y,opacity);}",alpha_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,min(y.a,opacity));}",average_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y)*0.5,opacity);}",color_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.rg,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",color_burn_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(step(0.0,y)*(1.0-min(vec4(1.0),(1.0-x)/y)),vec4(1.0),step(1.0,x));return mix(x,z,opacity);}",color_dodge_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=step(0.0,x)*mix(min(vec4(1.0),x/max(1.0-y,1e-9)),vec4(1.0),step(1.0,y));return mix(x,z,opacity);}",darken_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x,y),opacity);}",difference_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,abs(x-y),opacity);}",divide_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x/max(y,1e-12),opacity);}",exclusion_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,(x+y-2.0*x*y),opacity);}",hard_light_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 a=min(x,1.0),b=min(y,1.0);vec4 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,y));return mix(x,z,opacity);}",hard_mix_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,step(1.0,x+y),opacity);}",hue_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.r,xHSL.gb));return vec4(mix(x.rgb,z,opacity),y.a);}",invert_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-y,opacity);}",invert_rgb_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y*(1.0-x),opacity);}",lighten_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x,y),opacity);}",linear_burn_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(y+x-1.0,0.0,1.0),opacity);}",linear_dodge_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,min(x+y,1.0),opacity);}",linear_light_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,clamp(2.0*y+x-1.0,0.0,1.0),opacity);}",luminosity_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.rg,yHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",multiply_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x*y,opacity);}",negation_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,1.0-abs(1.0-x-y),opacity);}",normal_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,opacity);}",overlay_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(2.0*y*x,1.0-2.0*(1.0-y)*(1.0-x),step(0.5,x));return mix(x,z,opacity);}",pin_light_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 z=mix(mix(y2,x,step(0.5*x,y)),max(vec4(0.0),y2-1.0),step(x,(y2-1.0)));return mix(x,z,opacity);}",reflect_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(min(x*x/max(1.0-y,1e-12),1.0),y,step(1.0,y));return mix(x,z,opacity);}",saturation_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.r,yHSL.g,xHSL.b));return vec4(mix(x.rgb,z,opacity),y.a);}",screen_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,x+y-min(x*y,1.0),opacity);}",soft_light_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 y2=2.0*y;vec4 w=step(0.5,y);vec4 z=mix(x-(1.0-y2)*x*(1.0-x),mix(x+(y2-1.0)*(sqrt(x)-x),x+(y2-1.0)*x*((16.0*x-12.0)*x+3.0),w*(1.0-step(0.25,x))),w);return mix(x,z,opacity);}",src_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",subtract_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,max(x+y-1.0,0.0),opacity);}",vivid_light_default="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec4 z=mix(max(1.0-min((1.0-x)/(2.0*y),1.0),0.0),min(x/(2.0*(1.0-y)),1.0),step(0.5,y));return mix(x,z,opacity);}",blendFunctions=new Map([[BlendFunction.ADD,add_default],[BlendFunction.ALPHA,alpha_default],[BlendFunction.AVERAGE,average_default],[BlendFunction.COLOR,color_default],[BlendFunction.COLOR_BURN,color_burn_default],[BlendFunction.COLOR_DODGE,color_dodge_default],[BlendFunction.DARKEN,darken_default],[BlendFunction.DIFFERENCE,difference_default],[BlendFunction.DIVIDE,divide_default],[BlendFunction.DST,null],[BlendFunction.EXCLUSION,exclusion_default],[BlendFunction.HARD_LIGHT,hard_light_default],[BlendFunction.HARD_MIX,hard_mix_default],[BlendFunction.HUE,hue_default],[BlendFunction.INVERT,invert_default],[BlendFunction.INVERT_RGB,invert_rgb_default],[BlendFunction.LIGHTEN,lighten_default],[BlendFunction.LINEAR_BURN,linear_burn_default],[BlendFunction.LINEAR_DODGE,linear_dodge_default],[BlendFunction.LINEAR_LIGHT,linear_light_default],[BlendFunction.LUMINOSITY,luminosity_default],[BlendFunction.MULTIPLY,multiply_default],[BlendFunction.NEGATION,negation_default],[BlendFunction.NORMAL,normal_default],[BlendFunction.OVERLAY,overlay_default],[BlendFunction.PIN_LIGHT,pin_light_default],[BlendFunction.REFLECT,reflect_default],[BlendFunction.SATURATION,saturation_default],[BlendFunction.SCREEN,screen_default],[BlendFunction.SOFT_LIGHT,soft_light_default],[BlendFunction.SRC,src_default],[BlendFunction.SUBTRACT,subtract_default],[BlendFunction.VIVID_LIGHT,vivid_light_default]]),BlendMode=class extends EventDispatcher{constructor(rr,er=1){super(),this._blendFunction=rr,this.opacity=new Uniform(er)}getOpacity(){return this.opacity.value}setOpacity(rr){this.opacity.value=rr}get blendFunction(){return this._blendFunction}set blendFunction(rr){this._blendFunction=rr,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(rr){this.blendFunction=rr}getShaderCode(){return blendFunctions.get(this.blendFunction)}},KernelSize={VERY_SMALL:0,SMALL:1,MEDIUM:2,LARGE:3,VERY_LARGE:4,HUGE:5},convolution_kawase_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,convolution_kawase_default2="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",kernelPresets=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],KawaseBlurMaterial=class extends ShaderMaterial{constructor(rr=new Vector4){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new Uniform(null),texelSize:new Uniform(new Vector4),scale:new Uniform(1),kernel:new Uniform(0)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_kawase_default,vertexShader:convolution_kawase_default2}),this.setTexelSize(rr.x,rr.y),this.kernelSize=KernelSize.MEDIUM}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.inputBuffer=rr}get kernelSequence(){return kernelPresets[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(rr){this.uniforms.scale.value=rr}getScale(){return this.uniforms.scale.value}setScale(rr){this.uniforms.scale.value=rr}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(rr){this.uniforms.kernel.value=rr}setKernel(rr){this.kernel=rr}setTexelSize(rr,er){this.uniforms.texelSize.value.set(rr,er,rr*.5,er*.5)}setSize(rr,er){const tr=1/rr,ir=1/er;this.uniforms.texelSize.value.set(tr,ir,tr*.5,ir*.5)}},KawaseBlurPass=class extends Pass{constructor({kernelSize:rr=KernelSize.MEDIUM,resolutionScale:er=.5,width:tr=Resolution.AUTO_SIZE,height:ir=Resolution.AUTO_SIZE,resolutionX:nr=tr,resolutionY:sr=ir}={}){super("KawaseBlurPass"),this.renderTargetA=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const ar=this.resolution=new Resolution(this,nr,sr,er);ar.addEventListener("change",or=>this.setSize(ar.baseWidth,ar.baseHeight)),this._blurMaterial=new KawaseBlurMaterial,this._blurMaterial.kernelSize=rr,this.copyMaterial=new CopyMaterial}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(rr){this._blurMaterial=rr}get dithering(){return this.copyMaterial.dithering}set dithering(rr){this.copyMaterial.dithering=rr}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(rr){this.blurMaterial.kernelSize=rr}get width(){return this.resolution.width}set width(rr){this.resolution.preferredWidth=rr}get height(){return this.resolution.height}set height(rr){this.resolution.preferredHeight=rr}get scale(){return this.blurMaterial.scale}set scale(rr){this.blurMaterial.scale=rr}getScale(){return this.blurMaterial.scale}setScale(rr){this.blurMaterial.scale=rr}getKernelSize(){return this.kernelSize}setKernelSize(rr){this.kernelSize=rr}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}render(rr,er,tr,ir,nr){const sr=this.scene,ar=this.camera,or=this.renderTargetA,lr=this.renderTargetB,cr=this.blurMaterial,ur=cr.kernelSequence;let dr=er;this.fullscreenMaterial=cr;for(let hr=0,pr=ur.length;hr<pr;++hr){const gr=hr&1?lr:or;cr.kernel=ur[hr],cr.inputBuffer=dr.texture,rr.setRenderTarget(gr),rr.render(sr,ar),dr=gr}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=dr.texture,rr.setRenderTarget(this.renderToScreen?null:tr),rr.render(sr,ar)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.renderTargetA.setSize(ir,nr),this.renderTargetB.setSize(ir,nr),this.blurMaterial.setSize(rr,er)}initialize(rr,er,tr){tr!==void 0&&(this.renderTargetA.texture.type=tr,this.renderTargetB.texture.type=tr,tr!==UnsignedByteType?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=SRGBColorSpace,this.renderTargetB.texture.colorSpace=SRGBColorSpace))}static get AUTO_SIZE(){return Resolution.AUTO_SIZE}},luminance_default=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);l*=low*high;
#elif defined(THRESHOLD)
l=smoothstep(threshold,threshold+smoothing,l)*l;
#endif
#ifdef COLOR
gl_FragColor=vec4(texel.rgb*clamp(l,0.0,1.0),l);
#else
gl_FragColor=vec4(l);
#endif
}`,LuminanceMaterial=class extends ShaderMaterial{constructor(rr=!1,er=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:REVISION.replace(/\D+/g,"")},uniforms:{inputBuffer:new Uniform(null),threshold:new Uniform(0),smoothing:new Uniform(1),range:new Uniform(null)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:luminance_default,vertexShader:common_default}),this.colorOutput=rr,this.luminanceRange=er}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}get threshold(){return this.uniforms.threshold.value}set threshold(rr){this.smoothing>0||rr>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=rr}getThreshold(){return this.threshold}setThreshold(rr){this.threshold=rr}get smoothing(){return this.uniforms.smoothing.value}set smoothing(rr){this.threshold>0||rr>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=rr}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(rr){this.smoothing=rr}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(rr){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(rr){rr?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(rr){return this.colorOutput}setColorOutputEnabled(rr){this.colorOutput=rr}get useRange(){return this.luminanceRange!==null}set useRange(rr){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(rr){rr!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=rr,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(rr){this.luminanceRange=rr}},LuminancePass=class extends Pass{constructor({renderTarget:rr,luminanceRange:er,colorOutput:tr,resolutionScale:ir=1,width:nr=Resolution.AUTO_SIZE,height:sr=Resolution.AUTO_SIZE,resolutionX:ar=nr,resolutionY:or=sr}={}){super("LuminancePass"),this.fullscreenMaterial=new LuminanceMaterial(tr,er),this.needsSwap=!1,this.renderTarget=rr,this.renderTarget===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const lr=this.resolution=new Resolution(this,ar,or,ir);lr.addEventListener("change",cr=>this.setSize(lr.baseWidth,lr.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(rr,er,tr,ir,nr){const sr=this.fullscreenMaterial;sr.inputBuffer=er.texture,rr.setRenderTarget(this.renderToScreen?null:this.renderTarget),rr.render(this.scene,this.camera)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height)}initialize(rr,er,tr){tr!==void 0&&tr!==UnsignedByteType&&(this.renderTarget.texture.type=tr,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},convolution_downsampling_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,convolution_downsampling_default2="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",DownsamplingMaterial=class extends ShaderMaterial{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new Uniform(null),texelSize:new Uniform(new Vector2)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_downsampling_default,vertexShader:convolution_downsampling_default2})}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},convolution_upsampling_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,convolution_upsampling_default2="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",UpsamplingMaterial=class extends ShaderMaterial{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new Uniform(null),supportBuffer:new Uniform(null),texelSize:new Uniform(new Vector2),radius:new Uniform(.85)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_upsampling_default,vertexShader:convolution_upsampling_default2})}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}set supportBuffer(rr){this.uniforms.supportBuffer.value=rr}get radius(){return this.uniforms.radius.value}set radius(rr){this.uniforms.radius.value=rr}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},MipmapBlurPass=class extends Pass{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new DownsamplingMaterial,this.upsamplingMaterial=new UpsamplingMaterial,this.resolution=new Vector2}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(rr){if(this.levels!==rr){const er=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let tr=0;tr<rr;++tr){const ir=er.clone();ir.texture.name="Downsampling.Mipmap"+tr,this.downsamplingMipmaps.push(ir)}this.upsamplingMipmaps.push(er);for(let tr=1,ir=rr-1;tr<ir;++tr){const nr=er.clone();nr.texture.name="Upsampling.Mipmap"+tr,this.upsamplingMipmaps.push(nr)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(rr){this.upsamplingMaterial.radius=rr}render(rr,er,tr,ir,nr){const{scene:sr,camera:ar}=this,{downsamplingMaterial:or,upsamplingMaterial:lr}=this,{downsamplingMipmaps:cr,upsamplingMipmaps:ur}=this;let dr=er;this.fullscreenMaterial=or;for(let hr=0,pr=cr.length;hr<pr;++hr){const gr=cr[hr];or.setSize(dr.width,dr.height),or.inputBuffer=dr.texture,rr.setRenderTarget(gr),rr.render(sr,ar),dr=gr}this.fullscreenMaterial=lr;for(let hr=ur.length-1;hr>=0;--hr){const pr=ur[hr];lr.setSize(dr.width,dr.height),lr.inputBuffer=dr.texture,lr.supportBuffer=cr[hr].texture,rr.setRenderTarget(pr),rr.render(sr,ar),dr=pr}}setSize(rr,er){const tr=this.resolution;tr.set(rr,er);let ir=tr.width,nr=tr.height;for(let sr=0,ar=this.downsamplingMipmaps.length;sr<ar;++sr)ir=Math.round(ir*.5),nr=Math.round(nr*.5),this.downsamplingMipmaps[sr].setSize(ir,nr),sr<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[sr].setSize(ir,nr)}initialize(rr,er,tr){if(tr!==void 0){const ir=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const nr of ir)nr.texture.type=tr;if(tr!==UnsignedByteType)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(rr!==null&&rr.outputColorSpace===SRGBColorSpace)for(const nr of ir)nr.texture.colorSpace=SRGBColorSpace}}dispose(){super.dispose();for(const rr of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))rr.dispose()}},Effect=class extends EventDispatcher{constructor(rr,er,{attributes:tr=EffectAttribute.NONE,blendFunction:ir=BlendFunction.NORMAL,defines:nr=new Map,uniforms:sr=new Map,extensions:ar=null,vertexShader:or=null}={}){super(),this.name=rr,this.renderer=null,this.attributes=tr,this.fragmentShader=er,this.vertexShader=or,this.defines=nr,this.uniforms=sr,this.extensions=ar,this.blendMode=new BlendMode(ir),this.blendMode.addEventListener("change",lr=>this.setChanged()),this._inputColorSpace=LinearSRGBColorSpace,this._outputColorSpace=NoColorSpace}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(rr){this._inputColorSpace=rr,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(rr){this._outputColorSpace=rr,this.setChanged()}set mainScene(rr){}set mainCamera(rr){}getName(){return this.name}setRenderer(rr){this.renderer=rr}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(rr){this.attributes=rr,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(rr){this.fragmentShader=rr,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(rr){this.vertexShader=rr,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(rr,er=BasicDepthPacking){}update(rr,er,tr){}setSize(rr,er){}initialize(rr,er,tr){}dispose(){for(const rr of Object.keys(this)){const er=this[rr];(er instanceof WebGLRenderTarget||er instanceof Material||er instanceof Texture||er instanceof Pass)&&this[rr].dispose()}}},bloom_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,texel.a);}`,BloomEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SCREEN,luminanceThreshold:er=.9,luminanceSmoothing:tr=.025,mipmapBlur:ir=!1,intensity:nr=1,radius:sr=.85,levels:ar=8,kernelSize:or=KernelSize.LARGE,resolutionScale:lr=.5,width:cr=Resolution.AUTO_SIZE,height:ur=Resolution.AUTO_SIZE,resolutionX:dr=cr,resolutionY:hr=ur}={}){super("BloomEffect",bloom_default,{blendFunction:rr,uniforms:new Map([["map",new Uniform(null)],["intensity",new Uniform(nr)]])}),this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new KawaseBlurPass({kernelSize:or}),this.luminancePass=new LuminancePass({colorOutput:!0}),this.luminanceMaterial.threshold=er,this.luminanceMaterial.smoothing=tr,this.mipmapBlurPass=new MipmapBlurPass,this.mipmapBlurPass.enabled=ir,this.mipmapBlurPass.radius=sr,this.mipmapBlurPass.levels=ar,this.uniforms.get("map").value=ir?this.mipmapBlurPass.texture:this.renderTarget.texture;const pr=this.resolution=new Resolution(this,dr,hr,lr);pr.addEventListener("change",gr=>this.setSize(pr.baseWidth,pr.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(rr){this.resolution.preferredWidth=rr}get height(){return this.resolution.height}set height(rr){this.resolution.preferredHeight=rr}get dithering(){return this.blurPass.dithering}set dithering(rr){this.blurPass.dithering=rr}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(rr){this.blurPass.kernelSize=rr}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(rr){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(rr){this.uniforms.get("intensity").value=rr}getIntensity(){return this.intensity}setIntensity(rr){this.intensity=rr}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}update(rr,er,tr){const ir=this.renderTarget,nr=this.luminancePass;nr.enabled?(nr.render(rr,er),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(rr,nr.renderTarget):this.blurPass.render(rr,nr.renderTarget,ir)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(rr,er):this.blurPass.render(rr,er,ir)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height),this.blurPass.resolution.copy(tr),this.luminancePass.setSize(rr,er),this.mipmapBlurPass.setSize(rr,er)}initialize(rr,er,tr){this.blurPass.initialize(rr,er,tr),this.luminancePass.initialize(rr,er,tr),this.mipmapBlurPass.initialize(rr,er,tr),tr!==void 0&&(this.renderTarget.texture.type=tr,rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTarget.texture.colorSpace=SRGBColorSpace))}},bokeh_default=`uniform float focus;uniform float dof;uniform float aperture;uniform float maxBlur;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec2 aspectCorrection=vec2(1.0,aspect);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float focusNear=clamp(focus-dof,0.0,1.0);float focusFar=clamp(focus+dof,0.0,1.0);float low=step(linearDepth,focusNear);float high=step(focusFar,linearDepth);float factor=(linearDepth-focusNear)*low+(linearDepth-focusFar)*high;vec2 dofBlur=vec2(clamp(factor*aperture,-maxBlur,maxBlur));vec2 dofblur9=dofBlur*0.9;vec2 dofblur7=dofBlur*0.7;vec2 dofblur4=dofBlur*0.4;vec4 color=inputColor;color+=texture2D(inputBuffer,uv+(vec2(0.0,0.4)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.15,0.37)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.29,0.29)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.37,0.15)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.40,0.0)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.37,-0.15)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.29,-0.29)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.15,-0.37)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.0,-0.4)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.15,0.37)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.29,0.29)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.37,0.15)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.4,0.0)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.37,-0.15)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(-0.29,-0.29)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.15,-0.37)*aspectCorrection)*dofBlur);color+=texture2D(inputBuffer,uv+(vec2(0.15,0.37)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(-0.37,0.15)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(0.37,-0.15)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(-0.15,-0.37)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(-0.15,0.37)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(0.37,0.15)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(-0.37,-0.15)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(0.15,-0.37)*aspectCorrection)*dofblur9);color+=texture2D(inputBuffer,uv+(vec2(0.29,0.29)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(0.40,0.0)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(0.29,-0.29)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(0.0,-0.4)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(-0.29,0.29)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(-0.4,0.0)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(-0.29,-0.29)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(0.0,0.4)*aspectCorrection)*dofblur7);color+=texture2D(inputBuffer,uv+(vec2(0.29,0.29)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(0.4,0.0)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(0.29,-0.29)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(0.0,-0.4)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(-0.29,0.29)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(-0.4,0.0)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(-0.29,-0.29)*aspectCorrection)*dofblur4);color+=texture2D(inputBuffer,uv+(vec2(0.0,0.4)*aspectCorrection)*dofblur4);outputColor=color/41.0;}`,BokehEffect=class extends Effect{constructor({blendFunction:rr,focus:er=.5,dof:tr=.02,aperture:ir=.015,maxBlur:nr=1}={}){super("BokehEffect",bokeh_default,{blendFunction:rr,attributes:EffectAttribute.CONVOLUTION|EffectAttribute.DEPTH,uniforms:new Map([["focus",new Uniform(er)],["dof",new Uniform(tr)],["aperture",new Uniform(ir)],["maxBlur",new Uniform(nr)]])})}},brightness_contrast_default="uniform float brightness;uniform float contrast;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=inputColor.rgb+vec3(brightness-0.5);if(contrast>0.0){color/=vec3(1.0-contrast);}else{color*=vec3(1.0+contrast);}outputColor=vec4(color+vec3(0.5),inputColor.a);}",BrightnessContrastEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,brightness:er=0,contrast:tr=0}={}){super("BrightnessContrastEffect",brightness_contrast_default,{blendFunction:rr,uniforms:new Map([["brightness",new Uniform(er)],["contrast",new Uniform(tr)]])}),this.inputColorSpace=SRGBColorSpace}get brightness(){return this.uniforms.get("brightness").value}set brightness(rr){this.uniforms.get("brightness").value=rr}getBrightness(){return this.brightness}setBrightness(rr){this.brightness=rr}get contrast(){return this.uniforms.get("contrast").value}set contrast(rr){this.uniforms.get("contrast").value=rr}getContrast(){return this.contrast}setContrast(rr){this.contrast=rr}},color_average_default="void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(vec3(average(inputColor.rgb)),inputColor.a);}",ColorAverageEffect=class extends Effect{constructor(rr){super("ColorAverageEffect",color_average_default,{blendFunction:rr})}},color_depth_default="uniform float factor;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(floor(inputColor.rgb*factor+0.5)/factor,inputColor.a);}",ColorDepthEffect=class extends Effect{constructor({blendFunction:rr,bits:er=16}={}){super("ColorDepthEffect",color_depth_default,{blendFunction:rr,uniforms:new Map([["factor",new Uniform(1)]])}),this.bits=0,this.bitDepth=er}get bitDepth(){return this.bits}set bitDepth(rr){this.bits=rr,this.uniforms.get("factor").value=Math.pow(2,rr/3)}getBitDepth(){return this.bitDepth}setBitDepth(rr){this.bitDepth=rr}},chromatic_aberration_default=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,chromatic_aberration_default2="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",ChromaticAberrationEffect=class extends Effect{constructor({offset:rr=new Vector2(.001,5e-4),radialModulation:er=!1,modulationOffset:tr=.15}={}){super("ChromaticAberrationEffect",chromatic_aberration_default,{vertexShader:chromatic_aberration_default2,attributes:EffectAttribute.CONVOLUTION,uniforms:new Map([["offset",new Uniform(rr)],["modulationOffset",new Uniform(tr)]])}),this.radialModulation=er}get offset(){return this.uniforms.get("offset").value}set offset(rr){this.uniforms.get("offset").value=rr}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(rr){rr?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(rr){this.uniforms.get("modulationOffset").value=rr}getOffset(){return this.offset}setOffset(rr){this.offset=rr}},depth_default=`void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){
#ifdef INVERTED
vec3 color=vec3(1.0-depth);
#else
vec3 color=vec3(depth);
#endif
outputColor=vec4(color,inputColor.a);}`,DepthEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,inverted:er=!1}={}){super("DepthEffect",depth_default,{blendFunction:rr,attributes:EffectAttribute.DEPTH}),this.inverted=er}get inverted(){return this.defines.has("INVERTED")}set inverted(rr){this.inverted!==rr&&(rr?this.defines.set("INVERTED","1"):this.defines.delete("INVERTED"),this.setChanged())}isInverted(){return this.inverted}setInverted(rr){this.inverted=rr}},ColorChannel={RED:0,GREEN:1,BLUE:2,ALPHA:3},MaskFunction={DISCARD:0,MULTIPLY:1,MULTIPLY_RGB_SET_ALPHA:2,MULTIPLY_RGB:3},convolution_bokeh_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if PASS == 1
uniform vec4 kernel64[32];
#else
uniform vec4 kernel16[8];
#endif
uniform lowp sampler2D cocBuffer;uniform vec2 texelSize;uniform float scale;varying vec2 vUv;void main(){
#ifdef FOREGROUND
vec2 cocNearFar=texture2D(cocBuffer,vUv).rg*scale;float coc=cocNearFar.x;
#else
float coc=texture2D(cocBuffer,vUv).g*scale;
#endif
if(coc==0.0){gl_FragColor=texture2D(inputBuffer,vUv);}else{
#ifdef FOREGROUND
vec2 step=texelSize*max(cocNearFar.x,cocNearFar.y);
#else
vec2 step=texelSize*coc;
#endif
#if PASS == 1
vec4 acc=vec4(0.0);for(int i=0;i<32;++i){vec4 kernel=kernel64[i];vec2 uv=step*kernel.xy+vUv;acc+=texture2D(inputBuffer,uv);uv=step*kernel.zw+vUv;acc+=texture2D(inputBuffer,uv);}gl_FragColor=acc/64.0;
#else
vec4 maxValue=texture2D(inputBuffer,vUv);for(int i=0;i<8;++i){vec4 kernel=kernel16[i];vec2 uv=step*kernel.xy+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);uv=step*kernel.zw+vUv;maxValue=max(texture2D(inputBuffer,uv),maxValue);}gl_FragColor=maxValue;
#endif
}}`,BokehMaterial=class extends ShaderMaterial{constructor(rr=!1,er=!1){super({name:"BokehMaterial",defines:{PASS:rr?"2":"1"},uniforms:{inputBuffer:new Uniform(null),cocBuffer:new Uniform(null),texelSize:new Uniform(new Vector2),kernel64:new Uniform(null),kernel16:new Uniform(null),scale:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_bokeh_default,vertexShader:common_default}),er&&(this.defines.FOREGROUND="1"),this.generateKernel()}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}set cocBuffer(rr){this.uniforms.cocBuffer.value=rr}setCoCBuffer(rr){this.uniforms.cocBuffer.value=rr}get scale(){return this.uniforms.scale.value}set scale(rr){this.uniforms.scale.value=rr}getScale(rr){return this.scale}setScale(rr){this.scale=rr}generateKernel(){const rr=2.39996323,er=new Float64Array(128),tr=new Float64Array(32);let ir=0,nr=0;for(let sr=0,ar=Math.sqrt(80);sr<80;++sr){const or=sr*rr,lr=Math.sqrt(sr)/ar,cr=lr*Math.cos(or),ur=lr*Math.sin(or);sr%5===0?(tr[nr++]=cr,tr[nr++]=ur):(er[ir++]=cr,er[ir++]=ur)}this.uniforms.kernel64.value=er,this.uniforms.kernel16.value=tr}setTexelSize(rr,er){this.uniforms.texelSize.value.set(rr,er)}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}};function orthographicDepthToViewZ(rr,er,tr){return rr*(er-tr)-er}function viewZToOrthographicDepth(rr,er,tr){return Math.min(Math.max((rr+er)/(er-tr),0),1)}var circle_of_confusion_default=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float focusDistance;uniform float focusRange;uniform float cameraNear;uniform float cameraFar;varying vec2 vUv;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#ifdef LOG_DEPTH
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#endif
return depth;}void main(){float depth=readDepth(vUv);
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
float signedDistance=linearDepth-focusDistance;float magnitude=smoothstep(0.0,focusRange,abs(signedDistance));gl_FragColor.rg=magnitude*vec2(step(signedDistance,0.0),step(0.0,signedDistance));}`,CircleOfConfusionMaterial=class extends ShaderMaterial{constructor(rr){super({name:"CircleOfConfusionMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Uniform(null),focusDistance:new Uniform(0),focusRange:new Uniform(0),cameraNear:new Uniform(.3),cameraFar:new Uniform(1e3)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:circle_of_confusion_default,vertexShader:common_default}),this.uniforms.focalLength=this.uniforms.focusRange,this.copyCameraSettings(rr)}get near(){return this.uniforms.cameraNear.value}get far(){return this.uniforms.cameraFar.value}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.depthPacking=er}get focusDistance(){return this.uniforms.focusDistance.value}set focusDistance(rr){this.uniforms.focusDistance.value=rr}get worldFocusDistance(){return-orthographicDepthToViewZ(this.focusDistance,this.near,this.far)}set worldFocusDistance(rr){this.focusDistance=viewZToOrthographicDepth(-rr,this.near,this.far)}getFocusDistance(rr){this.uniforms.focusDistance.value=rr}setFocusDistance(rr){this.uniforms.focusDistance.value=rr}get focalLength(){return this.focusRange}set focalLength(rr){this.focusRange=rr}get focusRange(){return this.uniforms.focusRange.value}set focusRange(rr){this.uniforms.focusRange.value=rr}get worldFocusRange(){return-orthographicDepthToViewZ(this.focusRange,this.near,this.far)}set worldFocusRange(rr){this.focusRange=viewZToOrthographicDepth(-rr,this.near,this.far)}getFocalLength(rr){return this.focusRange}setFocalLength(rr){this.focusRange=rr}adoptCameraSettings(rr){this.copyCameraSettings(rr)}copyCameraSettings(rr){rr&&(this.uniforms.cameraNear.value=rr.near,this.uniforms.cameraFar.value=rr.far,rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},mask_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef MASK_PRECISION_HIGH
uniform mediump sampler2D maskTexture;
#else
uniform lowp sampler2D maskTexture;
#endif
#if MASK_FUNCTION != 0
uniform float strength;
#endif
varying vec2 vUv;void main(){
#if COLOR_CHANNEL == 0
float mask=texture2D(maskTexture,vUv).r;
#elif COLOR_CHANNEL == 1
float mask=texture2D(maskTexture,vUv).g;
#elif COLOR_CHANNEL == 2
float mask=texture2D(maskTexture,vUv).b;
#else
float mask=texture2D(maskTexture,vUv).a;
#endif
#if MASK_FUNCTION == 0
#ifdef INVERTED
mask=step(mask,0.0);
#else
mask=1.0-step(mask,0.0);
#endif
#else
mask=clamp(mask*strength,0.0,1.0);
#ifdef INVERTED
mask=1.0-mask;
#endif
#endif
#if MASK_FUNCTION == 3
vec4 texel=texture2D(inputBuffer,vUv);gl_FragColor=vec4(mask*texel.rgb,texel.a);
#elif MASK_FUNCTION == 2
gl_FragColor=vec4(mask*texture2D(inputBuffer,vUv).rgb,mask);
#else
gl_FragColor=mask*texture2D(inputBuffer,vUv);
#endif
}`,MaskMaterial=class extends ShaderMaterial{constructor(rr=null){super({name:"MaskMaterial",uniforms:{maskTexture:new Uniform(rr),inputBuffer:new Uniform(null),strength:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:mask_default,vertexShader:common_default}),this.colorChannel=ColorChannel.RED,this.maskFunction=MaskFunction.DISCARD}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}set maskTexture(rr){this.uniforms.maskTexture.value=rr,delete this.defines.MASK_PRECISION_HIGH,rr.type!==UnsignedByteType&&(this.defines.MASK_PRECISION_HIGH="1"),this.needsUpdate=!0}setMaskTexture(rr){this.maskTexture=rr}set colorChannel(rr){this.defines.COLOR_CHANNEL=rr.toFixed(0),this.needsUpdate=!0}setColorChannel(rr){this.colorChannel=rr}set maskFunction(rr){this.defines.MASK_FUNCTION=rr.toFixed(0),this.needsUpdate=!0}setMaskFunction(rr){this.maskFunction=rr}get inverted(){return this.defines.INVERTED!==void 0}set inverted(rr){this.inverted&&!rr?delete this.defines.INVERTED:rr&&(this.defines.INVERTED="1"),this.needsUpdate=!0}isInverted(){return this.inverted}setInverted(rr){this.inverted=rr}get strength(){return this.uniforms.strength.value}set strength(rr){this.uniforms.strength.value=rr}getStrength(){return this.strength}setStrength(rr){this.strength=rr}},ShaderPass=class extends Pass{constructor(rr,er="inputBuffer"){super("ShaderPass"),this.fullscreenMaterial=rr,this.input=er}setInput(rr){this.input=rr}render(rr,er,tr,ir,nr){const sr=this.fullscreenMaterial.uniforms;er!==null&&sr!==void 0&&sr[this.input]!==void 0&&(sr[this.input].value=er.texture),rr.setRenderTarget(this.renderToScreen?null:tr),rr.render(this.scene,this.camera)}initialize(rr,er,tr){tr!==void 0&&tr!==UnsignedByteType&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},depth_of_field_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D nearColorBuffer;uniform mediump sampler2D farColorBuffer;
#else
uniform lowp sampler2D nearColorBuffer;uniform lowp sampler2D farColorBuffer;
#endif
uniform lowp sampler2D nearCoCBuffer;uniform lowp sampler2D farCoCBuffer;uniform float scale;void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){vec4 colorNear=texture2D(nearColorBuffer,uv);vec4 colorFar=texture2D(farColorBuffer,uv);
#if MASK_FUNCTION == 1
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,colorFar.a);cocNearFar.x=min(cocNearFar.x*scale,1.0);
#else
vec2 cocNearFar=vec2(texture2D(nearCoCBuffer,uv).r,texture2D(farCoCBuffer,uv).g);cocNearFar=min(cocNearFar*scale,1.0);
#endif
vec4 result=inputColor*(1.0-cocNearFar.y)+colorFar;result=mix(result,colorNear,cocNearFar.x);outputColor=result;}`,DepthOfFieldEffect=class extends Effect{constructor(rr,{blendFunction:er,worldFocusDistance:tr,worldFocusRange:ir,focusDistance:nr=0,focalLength:sr=.1,focusRange:ar=sr,bokehScale:or=1,resolutionScale:lr=1,width:cr=Resolution.AUTO_SIZE,height:ur=Resolution.AUTO_SIZE,resolutionX:dr=cr,resolutionY:hr=ur}={}){super("DepthOfFieldEffect",depth_of_field_default,{blendFunction:er,attributes:EffectAttribute.DEPTH,uniforms:new Map([["nearColorBuffer",new Uniform(null)],["farColorBuffer",new Uniform(null)],["nearCoCBuffer",new Uniform(null)],["farCoCBuffer",new Uniform(null)],["scale",new Uniform(1)]])}),this.camera=rr,this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="DoF.Intermediate",this.renderTargetMasked=this.renderTarget.clone(),this.renderTargetMasked.texture.name="DoF.Masked.Far",this.renderTargetNear=this.renderTarget.clone(),this.renderTargetNear.texture.name="DoF.Bokeh.Near",this.uniforms.get("nearColorBuffer").value=this.renderTargetNear.texture,this.renderTargetFar=this.renderTarget.clone(),this.renderTargetFar.texture.name="DoF.Bokeh.Far",this.uniforms.get("farColorBuffer").value=this.renderTargetFar.texture,this.renderTargetCoC=this.renderTarget.clone(),this.renderTargetCoC.texture.name="DoF.CoC",this.uniforms.get("farCoCBuffer").value=this.renderTargetCoC.texture,this.renderTargetCoCBlurred=this.renderTargetCoC.clone(),this.renderTargetCoCBlurred.texture.name="DoF.CoC.Blurred",this.uniforms.get("nearCoCBuffer").value=this.renderTargetCoCBlurred.texture,this.cocPass=new ShaderPass(new CircleOfConfusionMaterial(rr));const pr=this.cocMaterial;pr.focusDistance=nr,pr.focusRange=ar,tr!==void 0&&(pr.worldFocusDistance=tr),ir!==void 0&&(pr.worldFocusRange=ir),this.blurPass=new KawaseBlurPass({resolutionScale:lr,resolutionX:dr,resolutionY:hr,kernelSize:KernelSize.MEDIUM}),this.maskPass=new ShaderPass(new MaskMaterial(this.renderTargetCoC.texture));const gr=this.maskPass.fullscreenMaterial;gr.colorChannel=ColorChannel.GREEN,this.maskFunction=MaskFunction.MULTIPLY_RGB,this.bokehNearBasePass=new ShaderPass(new BokehMaterial(!1,!0)),this.bokehNearBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehNearFillPass=new ShaderPass(new BokehMaterial(!0,!0)),this.bokehNearFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoCBlurred.texture,this.bokehFarBasePass=new ShaderPass(new BokehMaterial(!1,!1)),this.bokehFarBasePass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.bokehFarFillPass=new ShaderPass(new BokehMaterial(!0,!1)),this.bokehFarFillPass.fullscreenMaterial.cocBuffer=this.renderTargetCoC.texture,this.target=null;const vr=this.resolution=new Resolution(this,dr,hr,lr);vr.addEventListener("change",mr=>this.setSize(vr.baseWidth,vr.baseHeight)),this.bokehScale=or}set mainCamera(rr){this.camera=rr,this.cocMaterial.copyCameraSettings(rr)}get cocTexture(){return this.renderTargetCoC.texture}get maskFunction(){return this.maskPass.fullscreenMaterial.maskFunction}set maskFunction(rr){this.maskFunction!==rr&&(this.defines.set("MASK_FUNCTION",rr.toFixed(0)),this.maskPass.fullscreenMaterial.maskFunction=rr,this.setChanged())}get cocMaterial(){return this.cocPass.fullscreenMaterial}get circleOfConfusionMaterial(){return this.cocMaterial}getCircleOfConfusionMaterial(){return this.cocMaterial}getBlurPass(){return this.blurPass}getResolution(){return this.resolution}get bokehScale(){return this.uniforms.get("scale").value}set bokehScale(rr){this.bokehNearBasePass.fullscreenMaterial.scale=rr,this.bokehNearFillPass.fullscreenMaterial.scale=rr,this.bokehFarBasePass.fullscreenMaterial.scale=rr,this.bokehFarFillPass.fullscreenMaterial.scale=rr,this.maskPass.fullscreenMaterial.strength=rr,this.uniforms.get("scale").value=rr}getBokehScale(){return this.bokehScale}setBokehScale(rr){this.bokehScale=rr}getTarget(){return this.target}setTarget(rr){this.target=rr}calculateFocusDistance(rr){const er=this.camera,tr=er.position.distanceTo(rr);return viewZToOrthographicDepth(-tr,er.near,er.far)}setDepthTexture(rr,er=BasicDepthPacking){this.cocMaterial.depthBuffer=rr,this.cocMaterial.depthPacking=er}update(rr,er,tr){const ir=this.renderTarget,nr=this.renderTargetCoC,sr=this.renderTargetCoCBlurred,ar=this.renderTargetMasked;if(this.target!==null){const or=this.calculateFocusDistance(this.target);this.cocMaterial.focusDistance=or}this.cocPass.render(rr,null,nr),this.blurPass.render(rr,nr,sr),this.maskPass.render(rr,er,ar),this.bokehFarBasePass.render(rr,ar,ir),this.bokehFarFillPass.render(rr,ir,this.renderTargetFar),this.bokehNearBasePass.render(rr,er,ir),this.bokehNearFillPass.render(rr,ir,this.renderTargetNear)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.cocPass.setSize(rr,er),this.blurPass.setSize(rr,er),this.maskPass.setSize(rr,er),this.renderTargetFar.setSize(rr,er),this.renderTargetCoC.setSize(rr,er),this.renderTargetMasked.setSize(rr,er),this.renderTarget.setSize(ir,nr),this.renderTargetNear.setSize(ir,nr),this.renderTargetCoCBlurred.setSize(ir,nr),this.bokehNearBasePass.fullscreenMaterial.setSize(rr,er),this.bokehNearFillPass.fullscreenMaterial.setSize(rr,er),this.bokehFarBasePass.fullscreenMaterial.setSize(rr,er),this.bokehFarFillPass.fullscreenMaterial.setSize(rr,er)}initialize(rr,er,tr){this.cocPass.initialize(rr,er,tr),this.maskPass.initialize(rr,er,tr),this.bokehNearBasePass.initialize(rr,er,tr),this.bokehNearFillPass.initialize(rr,er,tr),this.bokehFarBasePass.initialize(rr,er,tr),this.bokehFarFillPass.initialize(rr,er,tr),this.blurPass.initialize(rr,er,UnsignedByteType),rr.capabilities.logarithmicDepthBuffer&&(this.cocPass.fullscreenMaterial.defines.LOG_DEPTH="1"),tr!==void 0&&(this.renderTarget.texture.type=tr,this.renderTargetNear.texture.type=tr,this.renderTargetFar.texture.type=tr,this.renderTargetMasked.texture.type=tr,rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTarget.texture.colorSpace=SRGBColorSpace,this.renderTargetNear.texture.colorSpace=SRGBColorSpace,this.renderTargetFar.texture.colorSpace=SRGBColorSpace,this.renderTargetMasked.texture.colorSpace=SRGBColorSpace))}},dot_screen_default="uniform vec2 angle;uniform float scale;float pattern(const in vec2 uv){vec2 point=scale*vec2(dot(angle.yx,vec2(uv.x,-uv.y)),dot(angle,uv));return(sin(point.x)*sin(point.y))*4.0;}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(inputColor.rgb*10.0-5.0+pattern(uv*resolution));outputColor=vec4(color,inputColor.a);}",DotScreenEffect=class extends Effect{constructor({blendFunction:rr,angle:er=Math.PI*.5,scale:tr=1}={}){super("DotScreenEffect",dot_screen_default,{blendFunction:rr,uniforms:new Map([["angle",new Uniform(new Vector2)],["scale",new Uniform(tr)]])}),this.angle=er}get angle(){return Math.acos(this.uniforms.get("angle").value.y)}set angle(rr){this.uniforms.get("angle").value.set(Math.sin(rr),Math.cos(rr))}getAngle(){return this.angle}setAngle(rr){this.angle=rr}get scale(){return this.uniforms.get("scale").value}set scale(rr){this.uniforms.get("scale").value=rr}},fxaa_default=`#define QUALITY(q) ((q) < 5 ? 1.0 : ((q) > 5 ? ((q) < 10 ? 2.0 : ((q) < 11 ? 4.0 : 8.0)) : 1.5))
#define ONE_OVER_TWELVE 0.08333333333333333
varying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;vec4 fxaa(const in vec4 inputColor,const in vec2 uv){float lumaCenter=luminance(inputColor.rgb);float lumaDown=luminance(texture2D(inputBuffer,vUvDown).rgb);float lumaUp=luminance(texture2D(inputBuffer,vUvUp).rgb);float lumaLeft=luminance(texture2D(inputBuffer,vUvLeft).rgb);float lumaRight=luminance(texture2D(inputBuffer,vUvRight).rgb);float lumaMin=min(lumaCenter,min(min(lumaDown,lumaUp),min(lumaLeft,lumaRight)));float lumaMax=max(lumaCenter,max(max(lumaDown,lumaUp),max(lumaLeft,lumaRight)));float lumaRange=lumaMax-lumaMin;if(lumaRange<max(EDGE_THRESHOLD_MIN,lumaMax*EDGE_THRESHOLD_MAX)){return inputColor;}float lumaDownLeft=luminance(texture2D(inputBuffer,vUvDownLeft).rgb);float lumaUpRight=luminance(texture2D(inputBuffer,vUvUpRight).rgb);float lumaUpLeft=luminance(texture2D(inputBuffer,vUvUpLeft).rgb);float lumaDownRight=luminance(texture2D(inputBuffer,vUvDownRight).rgb);float lumaDownUp=lumaDown+lumaUp;float lumaLeftRight=lumaLeft+lumaRight;float lumaLeftCorners=lumaDownLeft+lumaUpLeft;float lumaDownCorners=lumaDownLeft+lumaDownRight;float lumaRightCorners=lumaDownRight+lumaUpRight;float lumaUpCorners=lumaUpRight+lumaUpLeft;float edgeHorizontal=(abs(-2.0*lumaLeft+lumaLeftCorners)+abs(-2.0*lumaCenter+lumaDownUp)*2.0+abs(-2.0*lumaRight+lumaRightCorners));float edgeVertical=(abs(-2.0*lumaUp+lumaUpCorners)+abs(-2.0*lumaCenter+lumaLeftRight)*2.0+abs(-2.0*lumaDown+lumaDownCorners));bool isHorizontal=(edgeHorizontal>=edgeVertical);float stepLength=isHorizontal?texelSize.y:texelSize.x;float luma1=isHorizontal?lumaDown:lumaLeft;float luma2=isHorizontal?lumaUp:lumaRight;float gradient1=abs(luma1-lumaCenter);float gradient2=abs(luma2-lumaCenter);bool is1Steepest=gradient1>=gradient2;float gradientScaled=0.25*max(gradient1,gradient2);float lumaLocalAverage=0.0;if(is1Steepest){stepLength=-stepLength;lumaLocalAverage=0.5*(luma1+lumaCenter);}else{lumaLocalAverage=0.5*(luma2+lumaCenter);}vec2 currentUv=uv;if(isHorizontal){currentUv.y+=stepLength*0.5;}else{currentUv.x+=stepLength*0.5;}vec2 offset=isHorizontal?vec2(texelSize.x,0.0):vec2(0.0,texelSize.y);vec2 uv1=currentUv-offset*QUALITY(0);vec2 uv2=currentUv+offset*QUALITY(0);float lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);float lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd1-=lumaLocalAverage;lumaEnd2-=lumaLocalAverage;bool reached1=abs(lumaEnd1)>=gradientScaled;bool reached2=abs(lumaEnd2)>=gradientScaled;bool reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(1);}if(!reached2){uv2+=offset*QUALITY(1);}if(!reachedBoth){for(int i=2;i<SAMPLES;++i){if(!reached1){lumaEnd1=luminance(texture2D(inputBuffer,uv1).rgb);lumaEnd1=lumaEnd1-lumaLocalAverage;}if(!reached2){lumaEnd2=luminance(texture2D(inputBuffer,uv2).rgb);lumaEnd2=lumaEnd2-lumaLocalAverage;}reached1=abs(lumaEnd1)>=gradientScaled;reached2=abs(lumaEnd2)>=gradientScaled;reachedBoth=reached1&&reached2;if(!reached1){uv1-=offset*QUALITY(i);}if(!reached2){uv2+=offset*QUALITY(i);}if(reachedBoth){break;}}}float distance1=isHorizontal?(uv.x-uv1.x):(uv.y-uv1.y);float distance2=isHorizontal?(uv2.x-uv.x):(uv2.y-uv.y);bool isDirection1=distance1<distance2;float distanceFinal=min(distance1,distance2);float edgeThickness=(distance1+distance2);bool isLumaCenterSmaller=lumaCenter<lumaLocalAverage;bool correctVariation1=(lumaEnd1<0.0)!=isLumaCenterSmaller;bool correctVariation2=(lumaEnd2<0.0)!=isLumaCenterSmaller;bool correctVariation=isDirection1?correctVariation1:correctVariation2;float pixelOffset=-distanceFinal/edgeThickness+0.5;float finalOffset=correctVariation?pixelOffset:0.0;float lumaAverage=ONE_OVER_TWELVE*(2.0*(lumaDownUp+lumaLeftRight)+lumaLeftCorners+lumaRightCorners);float subPixelOffset1=clamp(abs(lumaAverage-lumaCenter)/lumaRange,0.0,1.0);float subPixelOffset2=(-2.0*subPixelOffset1+3.0)*subPixelOffset1*subPixelOffset1;float subPixelOffsetFinal=subPixelOffset2*subPixelOffset2*SUBPIXEL_QUALITY;finalOffset=max(finalOffset,subPixelOffsetFinal);vec2 finalUv=uv;if(isHorizontal){finalUv.y+=finalOffset*stepLength;}else{finalUv.x+=finalOffset*stepLength;}return texture2D(inputBuffer,finalUv);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=fxaa(inputColor,uv);}`,fxaa_default2="varying vec2 vUvDown;varying vec2 vUvUp;varying vec2 vUvLeft;varying vec2 vUvRight;varying vec2 vUvDownLeft;varying vec2 vUvUpRight;varying vec2 vUvUpLeft;varying vec2 vUvDownRight;void mainSupport(const in vec2 uv){vUvDown=uv+vec2(0.0,-1.0)*texelSize;vUvUp=uv+vec2(0.0,1.0)*texelSize;vUvRight=uv+vec2(1.0,0.0)*texelSize;vUvLeft=uv+vec2(-1.0,0.0)*texelSize;vUvDownLeft=uv+vec2(-1.0,-1.0)*texelSize;vUvUpRight=uv+vec2(1.0,1.0)*texelSize;vUvUpLeft=uv+vec2(-1.0,1.0)*texelSize;vUvDownRight=uv+vec2(1.0,-1.0)*texelSize;}",FXAAEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC}={}){super("FXAAEffect",fxaa_default,{vertexShader:fxaa_default2,blendFunction:rr,defines:new Map([["EDGE_THRESHOLD_MIN","0.0312"],["EDGE_THRESHOLD_MAX","0.125"],["SUBPIXEL_QUALITY","0.75"],["SAMPLES","12"]])})}get minEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MIN"))}set minEdgeThreshold(rr){this.defines.set("EDGE_THRESHOLD_MIN",rr.toFixed(12)),this.setChanged()}get maxEdgeThreshold(){return Number(this.defines.get("EDGE_THRESHOLD_MAX"))}set maxEdgeThreshold(rr){this.defines.set("EDGE_THRESHOLD_MAX",rr.toFixed(12)),this.setChanged()}get subpixelQuality(){return Number(this.defines.get("SUBPIXEL_QUALITY"))}set subpixelQuality(rr){this.defines.set("SUBPIXEL_QUALITY",rr.toFixed(12)),this.setChanged()}get samples(){return Number(this.defines.get("SAMPLES"))}set samples(rr){this.defines.set("SAMPLES",rr.toFixed(0)),this.setChanged()}},gamma_correction_default="uniform float gamma;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=LinearToGamma(max(inputColor,0.0),gamma);}",GammaCorrectionEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,gamma:er=2}={}){super("GammaCorrectionEffect",gamma_correction_default,{blendFunction:rr,uniforms:new Map([["gamma",new Uniform(er)]])})}},GlitchMode={DISABLED:0,SPORADIC:1,CONSTANT_MILD:2,CONSTANT_WILD:3};function getNoise(rr,er,tr){const ir=new Map([[LuminanceFormat,1],[RedFormat,1],[RGFormat,2],[RGBAFormat,4]]);let nr;if(ir.has(er)||console.error("Invalid noise texture format"),tr===UnsignedByteType){nr=new Uint8Array(rr*ir.get(er));for(let sr=0,ar=nr.length;sr<ar;++sr)nr[sr]=Math.random()*255+.5}else{nr=new Float32Array(rr*ir.get(er));for(let sr=0,ar=nr.length;sr<ar;++sr)nr[sr]=Math.random()}return nr}var NoiseTexture=class extends DataTexture{constructor(rr,er,tr=LuminanceFormat,ir=UnsignedByteType){super(getNoise(rr*er,tr,ir),rr,er,tr,ir),this.needsUpdate=!0}},glitch_default="uniform lowp sampler2D perturbationMap;uniform bool active;uniform float columns;uniform float random;uniform vec2 seeds;uniform vec2 distortion;void mainUv(inout vec2 uv){if(active){if(uv.y<distortion.x+columns&&uv.y>distortion.x-columns*random){float sx=clamp(ceil(seeds.x),0.0,1.0);uv.y=sx*(1.0-(uv.y+distortion.y))+(1.0-sx)*distortion.y;}if(uv.x<distortion.y+columns&&uv.x>distortion.y-columns*random){float sy=clamp(ceil(seeds.y),0.0,1.0);uv.x=sy*distortion.x+(1.0-sy)*(1.0-(uv.x+distortion.x));}vec2 normal=texture2D(perturbationMap,uv*random*random).rg;uv+=normal*seeds*(random*0.2);}}",textureTag="Glitch.Generated";function randomFloat(rr,er){return rr+Math.random()*(er-rr)}var GlitchEffect=class extends Effect{constructor({chromaticAberrationOffset:rr=null,delay:er=new Vector2(1.5,3.5),duration:tr=new Vector2(.6,1),strength:ir=new Vector2(.3,1),columns:nr=.05,ratio:sr=.85,perturbationMap:ar=null,dtSize:or=64}={}){if(super("GlitchEffect",glitch_default,{uniforms:new Map([["perturbationMap",new Uniform(null)],["columns",new Uniform(nr)],["active",new Uniform(!1)],["random",new Uniform(1)],["seeds",new Uniform(new Vector2)],["distortion",new Uniform(new Vector2)]])}),ar===null){const lr=new NoiseTexture(or,or,RGBAFormat);lr.name=textureTag,this.perturbationMap=lr}else this.perturbationMap=ar;this.time=0,this.distortion=this.uniforms.get("distortion").value,this.delay=er,this.duration=tr,this.breakPoint=new Vector2(randomFloat(this.delay.x,this.delay.y),randomFloat(this.duration.x,this.duration.y)),this.strength=ir,this.mode=GlitchMode.SPORADIC,this.ratio=sr,this.chromaticAberrationOffset=rr}get seeds(){return this.uniforms.get("seeds").value}get active(){return this.uniforms.get("active").value}isActive(){return this.active}get minDelay(){return this.delay.x}set minDelay(rr){this.delay.x=rr}getMinDelay(){return this.delay.x}setMinDelay(rr){this.delay.x=rr}get maxDelay(){return this.delay.y}set maxDelay(rr){this.delay.y=rr}getMaxDelay(){return this.delay.y}setMaxDelay(rr){this.delay.y=rr}get minDuration(){return this.duration.x}set minDuration(rr){this.duration.x=rr}getMinDuration(){return this.duration.x}setMinDuration(rr){this.duration.x=rr}get maxDuration(){return this.duration.y}set maxDuration(rr){this.duration.y=rr}getMaxDuration(){return this.duration.y}setMaxDuration(rr){this.duration.y=rr}get minStrength(){return this.strength.x}set minStrength(rr){this.strength.x=rr}getMinStrength(){return this.strength.x}setMinStrength(rr){this.strength.x=rr}get maxStrength(){return this.strength.y}set maxStrength(rr){this.strength.y=rr}getMaxStrength(){return this.strength.y}setMaxStrength(rr){this.strength.y=rr}getMode(){return this.mode}setMode(rr){this.mode=rr}getGlitchRatio(){return 1-this.ratio}setGlitchRatio(rr){this.ratio=Math.min(Math.max(1-rr,0),1)}get columns(){return this.uniforms.get("columns").value}set columns(rr){this.uniforms.get("columns").value=rr}getGlitchColumns(){return this.columns}setGlitchColumns(rr){this.columns=rr}getChromaticAberrationOffset(){return this.chromaticAberrationOffset}setChromaticAberrationOffset(rr){this.chromaticAberrationOffset=rr}get perturbationMap(){return this.uniforms.get("perturbationMap").value}set perturbationMap(rr){const er=this.perturbationMap;er!==null&&er.name===textureTag&&er.dispose(),rr.minFilter=rr.magFilter=NearestFilter,rr.wrapS=rr.wrapT=RepeatWrapping,rr.generateMipmaps=!1,this.uniforms.get("perturbationMap").value=rr}getPerturbationMap(){return this.perturbationMap}setPerturbationMap(rr){this.perturbationMap=rr}generatePerturbationMap(rr=64){const er=new NoiseTexture(rr,rr,RGBAFormat);return er.name=textureTag,er}update(rr,er,tr){const ir=this.mode,nr=this.breakPoint,sr=this.chromaticAberrationOffset,ar=this.strength;let or=this.time,lr=!1,cr=0,ur=0,dr;ir!==GlitchMode.DISABLED&&(ir===GlitchMode.SPORADIC&&(or+=tr,dr=or>nr.x,or>=nr.x+nr.y&&(nr.set(randomFloat(this.delay.x,this.delay.y),randomFloat(this.duration.x,this.duration.y)),or=0)),cr=Math.random(),this.uniforms.get("random").value=cr,dr&&cr>this.ratio||ir===GlitchMode.CONSTANT_WILD?(lr=!0,cr*=ar.y*.03,ur=randomFloat(-Math.PI,Math.PI),this.seeds.set(randomFloat(-ar.y,ar.y),randomFloat(-ar.y,ar.y)),this.distortion.set(randomFloat(0,1),randomFloat(0,1))):(dr||ir===GlitchMode.CONSTANT_MILD)&&(lr=!0,cr*=ar.x*.03,ur=randomFloat(-Math.PI,Math.PI),this.seeds.set(randomFloat(-ar.x,ar.x),randomFloat(-ar.x,ar.x)),this.distortion.set(randomFloat(0,1),randomFloat(0,1))),this.time=or),sr!==null&&(lr?sr.set(Math.cos(ur),Math.sin(ur)).multiplyScalar(cr):sr.set(0,0)),this.uniforms.get("active").value=lr}dispose(){const rr=this.perturbationMap;rr!==null&&rr.name===textureTag&&rr.dispose()}},DepthTestStrategy={DEFAULT:0,KEEP_MAX_DEPTH:1,DISCARD_MAX_DEPTH:2},depth_mask_default=`#include <common>
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer0;uniform highp sampler2D depthBuffer1;
#else
uniform mediump sampler2D depthBuffer0;uniform mediump sampler2D depthBuffer1;
#endif
uniform sampler2D inputBuffer;uniform vec2 cameraNearFar;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}varying vec2 vUv;void main(){vec2 depth;
#if DEPTH_PACKING_0 == 3201
depth.x=unpackRGBAToDepth(texture2D(depthBuffer0,vUv));
#else
depth.x=texture2D(depthBuffer0,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.x*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.x=a+b/d;
#endif
#endif
#if DEPTH_PACKING_1 == 3201
depth.y=unpackRGBAToDepth(texture2D(depthBuffer1,vUv));
#else
depth.y=texture2D(depthBuffer1,vUv).r;
#ifdef LOG_DEPTH
float d=pow(2.0,depth.y*log2(cameraNearFar.y+1.0))-1.0;float a=cameraNearFar.y/(cameraNearFar.y-cameraNearFar.x);float b=cameraNearFar.y*cameraNearFar.x/(cameraNearFar.x-cameraNearFar.y);depth.y=a+b/d;
#endif
#endif
bool isMaxDepth=(depth.x==1.0);
#ifdef PERSPECTIVE_CAMERA
depth.x=viewZToOrthographicDepth(getViewZ(depth.x),cameraNearFar.x,cameraNearFar.y);depth.y=viewZToOrthographicDepth(getViewZ(depth.y),cameraNearFar.x,cameraNearFar.y);
#endif
#if DEPTH_TEST_STRATEGY == 0
bool keep=depthTest(depth.x,depth.y);
#elif DEPTH_TEST_STRATEGY == 1
bool keep=isMaxDepth||depthTest(depth.x,depth.y);
#else
bool keep=!isMaxDepth&&depthTest(depth.x,depth.y);
#endif
if(keep){gl_FragColor=texture2D(inputBuffer,vUv);}else{discard;}}`,DepthMaskMaterial=class extends ShaderMaterial{constructor(){super({name:"DepthMaskMaterial",defines:{DEPTH_EPSILON:"0.0001",DEPTH_PACKING_0:"0",DEPTH_PACKING_1:"0",DEPTH_TEST_STRATEGY:DepthTestStrategy.KEEP_MAX_DEPTH},uniforms:{inputBuffer:new Uniform(null),depthBuffer0:new Uniform(null),depthBuffer1:new Uniform(null),cameraNearFar:new Uniform(new Vector2(1,1))},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:depth_mask_default,vertexShader:common_default}),this.depthMode=LessDepth}set depthBuffer0(rr){this.uniforms.depthBuffer0.value=rr}set depthPacking0(rr){this.defines.DEPTH_PACKING_0=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer0(rr,er=BasicDepthPacking){this.depthBuffer0=rr,this.depthPacking0=er}set depthBuffer1(rr){this.uniforms.depthBuffer1.value=rr}set depthPacking1(rr){this.defines.DEPTH_PACKING_1=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer1(rr,er=BasicDepthPacking){this.depthBuffer1=rr,this.depthPacking1=er}get maxDepthStrategy(){return Number(this.defines.DEPTH_TEST_STRATEGY)}set maxDepthStrategy(rr){this.defines.DEPTH_TEST_STRATEGY=rr.toFixed(0),this.needsUpdate=!0}get keepFar(){return this.maxDepthStrategy}set keepFar(rr){this.maxDepthStrategy=rr?DepthTestStrategy.KEEP_MAX_DEPTH:DepthTestStrategy.DISCARD_MAX_DEPTH}getMaxDepthStrategy(){return this.maxDepthStrategy}setMaxDepthStrategy(rr){this.maxDepthStrategy=rr}get epsilon(){return Number(this.defines.DEPTH_EPSILON)}set epsilon(rr){this.defines.DEPTH_EPSILON=rr.toFixed(16),this.needsUpdate=!0}getEpsilon(){return this.epsilon}setEpsilon(rr){this.epsilon=rr}get depthMode(){return Number(this.defines.DEPTH_MODE)}set depthMode(rr){let er;switch(rr){case NeverDepth:er="false";break;case AlwaysDepth:er="true";break;case EqualDepth:er="abs(d1 - d0) <= DEPTH_EPSILON";break;case NotEqualDepth:er="abs(d1 - d0) > DEPTH_EPSILON";break;case LessDepth:er="d0 > d1";break;case LessEqualDepth:er="d0 >= d1";break;case GreaterEqualDepth:er="d0 <= d1";break;case GreaterDepth:default:er="d0 < d1";break}this.defines.DEPTH_MODE=rr.toFixed(0),this.defines["depthTest(d0, d1)"]=er,this.needsUpdate=!0}getDepthMode(){return this.depthMode}setDepthMode(rr){this.depthMode=rr}adoptCameraSettings(rr){this.copyCameraSettings(rr)}copyCameraSettings(rr){rr&&(this.uniforms.cameraNearFar.value.set(rr.near,rr.far),rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},convolution_god_rays_default=`#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec2 lightPosition;uniform float exposure;uniform float decay;uniform float density;uniform float weight;uniform float clampMax;varying vec2 vUv;void main(){vec2 coord=vUv;vec2 delta=lightPosition-coord;delta*=1.0/SAMPLES_FLOAT*density;float illuminationDecay=1.0;vec4 color=vec4(0.0);for(int i=0;i<SAMPLES_INT;++i){coord+=delta;vec4 texel=texture2D(inputBuffer,coord);texel*=illuminationDecay*weight;color+=texel;illuminationDecay*=decay;}gl_FragColor=clamp(color*exposure,0.0,clampMax);
#include <dithering_fragment>
}`,GodRaysMaterial=class extends ShaderMaterial{constructor(rr){super({name:"GodRaysMaterial",defines:{SAMPLES_INT:"60",SAMPLES_FLOAT:"60.0"},uniforms:{inputBuffer:new Uniform(null),lightPosition:new Uniform(rr),density:new Uniform(1),decay:new Uniform(1),weight:new Uniform(1),exposure:new Uniform(1),clampMax:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_god_rays_default,vertexShader:common_default})}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}get lightPosition(){return this.uniforms.lightPosition.value}getLightPosition(){return this.uniforms.lightPosition.value}setLightPosition(rr){this.uniforms.lightPosition.value=rr}get density(){return this.uniforms.density.value}set density(rr){this.uniforms.density.value=rr}getDensity(){return this.uniforms.density.value}setDensity(rr){this.uniforms.density.value=rr}get decay(){return this.uniforms.decay.value}set decay(rr){this.uniforms.decay.value=rr}getDecay(){return this.uniforms.decay.value}setDecay(rr){this.uniforms.decay.value=rr}get weight(){return this.uniforms.weight.value}set weight(rr){this.uniforms.weight.value=rr}getWeight(){return this.uniforms.weight.value}setWeight(rr){this.uniforms.weight.value=rr}get exposure(){return this.uniforms.exposure.value}set exposure(rr){this.uniforms.exposure.value=rr}getExposure(){return this.uniforms.exposure.value}setExposure(rr){this.uniforms.exposure.value=rr}get maxIntensity(){return this.uniforms.clampMax.value}set maxIntensity(rr){this.uniforms.clampMax.value=rr}getMaxIntensity(){return this.uniforms.clampMax.value}setMaxIntensity(rr){this.uniforms.clampMax.value=rr}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(rr){const er=Math.floor(rr);this.defines.SAMPLES_INT=er.toFixed(0),this.defines.SAMPLES_FLOAT=er.toFixed(1),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(rr){this.samples=rr}},RenderPass=class extends Pass{constructor(rr,er,tr=null){super("RenderPass",rr,er),this.needsSwap=!1,this.clearPass=new ClearPass,this.overrideMaterialManager=tr===null?null:new OverrideMaterialManager(tr),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(rr){this.scene=rr}set mainCamera(rr){this.camera=rr}get renderToScreen(){return super.renderToScreen}set renderToScreen(rr){super.renderToScreen=rr,this.clearPass.renderToScreen=rr}get overrideMaterial(){const rr=this.overrideMaterialManager;return rr!==null?rr.material:null}set overrideMaterial(rr){const er=this.overrideMaterialManager;rr!==null?er!==null?er.setMaterial(rr):this.overrideMaterialManager=new OverrideMaterialManager(rr):er!==null&&(er.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(rr){this.overrideMaterial=rr}get clear(){return this.clearPass.enabled}set clear(rr){this.clearPass.enabled=rr}getSelection(){return this.selection}setSelection(rr){this.selection=rr}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(rr){this.ignoreBackground=rr}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(rr){this.skipShadowMapUpdate=rr}getClearPass(){return this.clearPass}render(rr,er,tr,ir,nr){const sr=this.scene,ar=this.camera,or=this.selection,lr=ar.layers.mask,cr=sr.background,ur=rr.shadowMap.autoUpdate,dr=this.renderToScreen?null:er;or!==null&&ar.layers.set(or.getLayer()),this.skipShadowMapUpdate&&(rr.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(sr.background=null),this.clearPass.enabled&&this.clearPass.render(rr,er),rr.setRenderTarget(dr),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(rr,sr,ar):rr.render(sr,ar),ar.layers.mask=lr,sr.background=cr,rr.shadowMap.autoUpdate=ur}},god_rays_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=texture2D(map,uv);}`,v=new Vector3$1,m=new Matrix4,GodRaysEffect=class extends Effect{constructor(rr,er,{blendFunction:tr=BlendFunction.SCREEN,samples:ir=60,density:nr=.96,decay:sr=.9,weight:ar=.4,exposure:or=.6,clampMax:lr=1,blur:cr=!0,kernelSize:ur=KernelSize.SMALL,resolutionScale:dr=.5,width:hr=Resolution.AUTO_SIZE,height:pr=Resolution.AUTO_SIZE,resolutionX:gr=hr,resolutionY:vr=pr}={}){super("GodRaysEffect",god_rays_default,{blendFunction:tr,attributes:EffectAttribute.DEPTH,uniforms:new Map([["map",new Uniform(null)]])}),this.camera=rr,this._lightSource=er,this.lightSource=er,this.lightScene=new Scene,this.screenPosition=new Vector2,this.renderTargetA=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="GodRays.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="GodRays.Target.B",this.uniforms.get("map").value=this.renderTargetB.texture,this.renderTargetLight=new WebGLRenderTarget(1,1),this.renderTargetLight.texture.name="GodRays.Light",this.renderTargetLight.depthTexture=new DepthTexture,this.renderPassLight=new RenderPass(this.lightScene,rr),this.renderPassLight.clearPass.overrideClearColor=new Color(0),this.clearPass=new ClearPass(!0,!1,!1),this.clearPass.overrideClearColor=new Color(0),this.blurPass=new KawaseBlurPass({kernelSize:ur}),this.blurPass.enabled=cr,this.depthMaskPass=new ShaderPass(new DepthMaskMaterial);const mr=this.depthMaskMaterial;mr.depthBuffer1=this.renderTargetLight.depthTexture,mr.copyCameraSettings(rr),this.godRaysPass=new ShaderPass(new GodRaysMaterial(this.screenPosition));const fr=this.godRaysMaterial;fr.density=nr,fr.decay=sr,fr.weight=ar,fr.exposure=or,fr.maxIntensity=lr,fr.samples=ir;const _r=this.resolution=new Resolution(this,gr,vr,dr);_r.addEventListener("change",Ar=>this.setSize(_r.baseWidth,_r.baseHeight))}set mainCamera(rr){this.camera=rr,this.renderPassLight.mainCamera=rr,this.depthMaskMaterial.copyCameraSettings(rr)}get lightSource(){return this._lightSource}set lightSource(rr){this._lightSource=rr,rr!==null&&(rr.material.depthWrite=!1,rr.material.transparent=!0)}getBlurPass(){return this.blurPass}get texture(){return this.renderTargetB.texture}getTexture(){return this.texture}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get godRaysMaterial(){return this.godRaysPass.fullscreenMaterial}getGodRaysMaterial(){return this.godRaysMaterial}getResolution(){return this.resolution}get width(){return this.resolution.width}set width(rr){this.resolution.preferredWidth=rr}get height(){return this.resolution.height}set height(rr){this.resolution.preferredHeight=rr}get dithering(){return this.godRaysMaterial.dithering}set dithering(rr){const er=this.godRaysMaterial;er.dithering=rr,er.needsUpdate=!0}get blur(){return this.blurPass.enabled}set blur(rr){this.blurPass.enabled=rr}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(rr){this.blurPass.kernelSize=rr}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}get samples(){return this.godRaysMaterial.samples}set samples(rr){this.godRaysMaterial.samples=rr}setDepthTexture(rr,er=BasicDepthPacking){this.depthMaskPass.fullscreenMaterial.depthBuffer0=rr,this.depthMaskPass.fullscreenMaterial.depthPacking0=er}update(rr,er,tr){const ir=this.lightSource,nr=ir.parent,sr=ir.matrixAutoUpdate,ar=this.renderTargetA,or=this.renderTargetLight;ir.material.depthWrite=!0,ir.matrixAutoUpdate=!1,ir.updateWorldMatrix(!0,!1),nr!==null&&(sr||m.copy(ir.matrix),ir.matrix.copy(ir.matrixWorld)),this.lightScene.add(ir),this.renderPassLight.render(rr,or),this.clearPass.render(rr,ar),this.depthMaskPass.render(rr,or,ar),ir.material.depthWrite=!1,ir.matrixAutoUpdate=sr,nr!==null&&(sr||ir.matrix.copy(m),nr.add(ir)),v.setFromMatrixPosition(ir.matrixWorld).project(this.camera),this.screenPosition.set(Math.min(Math.max((v.x+1)*.5,-1),2),Math.min(Math.max((v.y+1)*.5,-1),2)),this.blurPass.enabled&&this.blurPass.render(rr,ar,ar),this.godRaysPass.render(rr,ar,this.renderTargetB)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.renderTargetA.setSize(ir,nr),this.renderTargetB.setSize(ir,nr),this.renderTargetLight.setSize(ir,nr),this.blurPass.resolution.copy(tr)}initialize(rr,er,tr){this.blurPass.initialize(rr,er,tr),this.renderPassLight.initialize(rr,er,tr),this.depthMaskPass.initialize(rr,er,tr),this.godRaysPass.initialize(rr,er,tr),tr!==void 0&&(this.renderTargetA.texture.type=tr,this.renderTargetB.texture.type=tr,this.renderTargetLight.texture.type=tr,rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=SRGBColorSpace,this.renderTargetB.texture.colorSpace=SRGBColorSpace,this.renderTargetLight.texture.colorSpace=SRGBColorSpace))}},grid_default="uniform vec2 scale;uniform float lineWidth;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float grid=0.5-max(abs(mod(uv.x*scale.x,1.0)-0.5),abs(mod(uv.y*scale.y,1.0)-0.5));outputColor=vec4(vec3(smoothstep(0.0,lineWidth,grid)),inputColor.a);}",GridEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.OVERLAY,scale:er=1,lineWidth:tr=0}={}){super("GridEffect",grid_default,{blendFunction:rr,uniforms:new Map([["scale",new Uniform(new Vector2)],["lineWidth",new Uniform(tr)]])}),this.resolution=new Vector2,this.s=0,this.scale=er,this.l=0,this.lineWidth=tr}get scale(){return this.s}set scale(rr){this.s=Math.max(rr,1e-6),this.setSize(this.resolution.width,this.resolution.height)}getScale(){return this.scale}setScale(rr){this.scale=rr}get lineWidth(){return this.l}set lineWidth(rr){this.l=rr,this.setSize(this.resolution.width,this.resolution.height)}getLineWidth(){return this.lineWidth}setLineWidth(rr){this.lineWidth=rr}setSize(rr,er){this.resolution.set(rr,er);const tr=rr/er,ir=this.scale*(er*.125);this.uniforms.get("scale").value.set(tr*ir,ir),this.uniforms.get("lineWidth").value=ir/er+this.lineWidth}},hue_saturation_default="uniform vec3 hue;uniform float saturation;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,hue.xyz),dot(inputColor.rgb,hue.zxy),dot(inputColor.rgb,hue.yzx));float average=(color.r+color.g+color.b)/3.0;vec3 diff=average-color;if(saturation>0.0){color+=diff*(1.0-1.0/(1.001-saturation));}else{color+=diff*-saturation;}outputColor=vec4(min(color,1.0),inputColor.a);}",HueSaturationEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,hue:er=0,saturation:tr=0}={}){super("HueSaturationEffect",hue_saturation_default,{blendFunction:rr,uniforms:new Map([["hue",new Uniform(new Vector3$1)],["saturation",new Uniform(tr)]])}),this.hue=er}get saturation(){return this.uniforms.get("saturation").value}set saturation(rr){this.uniforms.get("saturation").value=rr}getSaturation(){return this.saturation}setSaturation(rr){this.saturation=rr}get hue(){const rr=this.uniforms.get("hue").value;return Math.acos((rr.x*3-1)/2)}set hue(rr){const er=Math.sin(rr),tr=Math.cos(rr);this.uniforms.get("hue").value.set((2*tr+1)/3,(-Math.sqrt(3)*er-tr+1)/3,(Math.sqrt(3)*er-tr+1)/3)}getHue(){return this.hue}setHue(rr){this.hue=rr}},lens_distortion_default="uniform vec2 distortion;uniform vec2 principalPoint;uniform vec2 focalLength;uniform float skew;float mask(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void mainUv(inout vec2 uv){vec2 xn=2.0*(uv.st-0.5);vec3 xDistorted=vec3((1.0+distortion*dot(xn,xn))*xn,1.0);mat3 kk=mat3(vec3(focalLength.x,0.0,0.0),vec3(skew*focalLength.x,focalLength.y,0.0),vec3(principalPoint.x,principalPoint.y,1.0));uv=(kk*xDistorted).xy*0.5+0.5;}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=mask(uv)*inputColor;}",LensDistortionEffect=class extends Effect{constructor({distortion:rr=new Vector2(0,0),principalPoint:er=new Vector2(0,0),focalLength:tr=new Vector2(1,1),skew:ir=0}={}){super("LensDistortionEffect",lens_distortion_default,{uniforms:new Map([["distortion",new Uniform(rr)],["principalPoint",new Uniform(er)],["focalLength",new Uniform(tr)],["skew",new Uniform(ir)]])})}get distortion(){return this.uniforms.get("distortion").value}set distortion(rr){this.uniforms.get("distortion").value=rr}get principalPoint(){return this.uniforms.get("principalPoint").value}set principalPoint(rr){this.uniforms.get("principalPoint").value=rr}get focalLength(){return this.uniforms.get("focalLength").value}set focalLength(rr){this.uniforms.get("focalLength").value=rr}get skew(){return this.uniforms.get("skew").value}set skew(rr){this.uniforms.get("skew").value=rr}},lut_1d_default=`#ifdef LUT_PRECISION_HIGH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D lut;
#else
uniform mediump sampler2D lut;
#endif
#else
uniform lowp sampler2D lut;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){outputColor=vec4(texture2D(lut,vec2(inputColor.r,0.5)).r,texture2D(lut,vec2(inputColor.g,0.5)).r,texture2D(lut,vec2(inputColor.b,0.5)).r,inputColor.a);}`,LUT1DEffect=class extends Effect{constructor(rr,{blendFunction:er=BlendFunction.SRC}={}){super("LUT1DEffect",lut_1d_default,{blendFunction:er,uniforms:new Map([["lut",new Uniform(null)]])}),this.lut=rr}get lut(){return this.uniforms.get("lut").value}set lut(rr){this.uniforms.get("lut").value=rr,rr!==null&&(rr.type===FloatType||rr.type===HalfFloatType)&&this.defines.set("LUT_PRECISION_HIGH","1")}},LUTOperation={SCALE_UP:"lut.scaleup"};function createCanvas(rr,er,tr){const ir=document.createElement("canvas"),nr=ir.getContext("2d");if(ir.width=rr,ir.height=er,tr instanceof Image)nr.drawImage(tr,0,0);else{const sr=nr.createImageData(rr,er);sr.data.set(tr),nr.putImageData(sr,0,0)}return ir}var RawImageData=class fo{constructor(er=0,tr=0,ir=null){this.width=er,this.height=tr,this.data=ir}toCanvas(){return typeof document>"u"?null:createCanvas(this.width,this.height,this.data)}static from(er){const{width:tr,height:ir}=er;let nr;if(er instanceof Image){const sr=createCanvas(tr,ir,er);sr!==null&&(nr=sr.getContext("2d").getImageData(0,0,tr,ir).data)}else nr=er.data;return new fo(tr,ir,nr)}},worker_default=`"use strict";(()=>{var O={SCALE_UP:"lut.scaleup"};var _=[new Float32Array(3),new Float32Array(3)],n=[new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3)],Z=[[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1])]];function d(a,t,r,m){let i=r[0]-t[0],e=r[1]-t[1],y=r[2]-t[2],h=a[0]-t[0],A=a[1]-t[1],w=a[2]-t[2],c=e*w-y*A,l=y*h-i*w,x=i*A-e*h,u=Math.sqrt(c*c+l*l+x*x),b=u*.5,s=c/u,F=l/u,f=x/u,p=-(a[0]*s+a[1]*F+a[2]*f),M=m[0]*s+m[1]*F+m[2]*f;return Math.abs(M+p)*b/3}function V(a,t,r,m,i,e){let y=(r+m*t+i*t*t)*4;e[0]=a[y+0],e[1]=a[y+1],e[2]=a[y+2]}function k(a,t,r,m,i,e){let y=r*(t-1),h=m*(t-1),A=i*(t-1),w=Math.floor(y),c=Math.floor(h),l=Math.floor(A),x=Math.ceil(y),u=Math.ceil(h),b=Math.ceil(A),s=y-w,F=h-c,f=A-l;if(w===y&&c===h&&l===A)V(a,t,y,h,A,e);else{let p;s>=F&&F>=f?p=Z[0]:s>=f&&f>=F?p=Z[1]:f>=s&&s>=F?p=Z[2]:F>=s&&s>=f?p=Z[3]:F>=f&&f>=s?p=Z[4]:f>=F&&F>=s&&(p=Z[5]);let[M,g,X,Y]=p,P=_[0];P[0]=s,P[1]=F,P[2]=f;let o=_[1],L=x-w,S=u-c,U=b-l;o[0]=L*M[0]+w,o[1]=S*M[1]+c,o[2]=U*M[2]+l,V(a,t,o[0],o[1],o[2],n[0]),o[0]=L*g[0]+w,o[1]=S*g[1]+c,o[2]=U*g[2]+l,V(a,t,o[0],o[1],o[2],n[1]),o[0]=L*X[0]+w,o[1]=S*X[1]+c,o[2]=U*X[2]+l,V(a,t,o[0],o[1],o[2],n[2]),o[0]=L*Y[0]+w,o[1]=S*Y[1]+c,o[2]=U*Y[2]+l,V(a,t,o[0],o[1],o[2],n[3]);let T=d(g,X,Y,P)*6,q=d(M,X,Y,P)*6,C=d(M,g,Y,P)*6,E=d(M,g,X,P)*6;n[0][0]*=T,n[0][1]*=T,n[0][2]*=T,n[1][0]*=q,n[1][1]*=q,n[1][2]*=q,n[2][0]*=C,n[2][1]*=C,n[2][2]*=C,n[3][0]*=E,n[3][1]*=E,n[3][2]*=E,e[0]=n[0][0]+n[1][0]+n[2][0]+n[3][0],e[1]=n[0][1]+n[1][1]+n[2][1]+n[3][1],e[2]=n[0][2]+n[1][2]+n[2][2]+n[3][2]}}var v=class{static expand(t,r){let m=Math.cbrt(t.length/4),i=new Float32Array(3),e=new t.constructor(r**3*4),y=t instanceof Uint8Array?255:1,h=r**2,A=1/(r-1);for(let w=0;w<r;++w)for(let c=0;c<r;++c)for(let l=0;l<r;++l){let x=l*A,u=c*A,b=w*A,s=Math.round(l+c*r+w*h)*4;k(t,m,x,u,b,i),e[s+0]=i[0],e[s+1]=i[1],e[s+2]=i[2],e[s+3]=y}return e}};self.addEventListener("message",a=>{let t=a.data,r=t.data;switch(t.operation){case O.SCALE_UP:r=v.expand(r,t.size);break}postMessage(r,[r.buffer]),close()});})();
`,c=new Color,LookupTexture=class ao extends Data3DTexture{constructor(er,tr){super(er,tr,tr,tr),this.type=FloatType,this.format=RGBAFormat,this.minFilter=LinearFilter,this.magFilter=LinearFilter,this.wrapS=ClampToEdgeWrapping,this.wrapT=ClampToEdgeWrapping,this.wrapR=ClampToEdgeWrapping,this.unpackAlignment=1,this.needsUpdate=!0,this.colorSpace=LinearSRGBColorSpace,this.domainMin=new Vector3$1(0,0,0),this.domainMax=new Vector3$1(1,1,1)}get isLookupTexture3D(){return!0}scaleUp(er,tr=!0){const ir=this.image;let nr;return er<=ir.width?nr=Promise.reject(new Error("The target size must be greater than the current size")):nr=new Promise((sr,ar)=>{const or=URL.createObjectURL(new Blob([worker_default],{type:"text/javascript"})),lr=new Worker(or);lr.addEventListener("error",ur=>ar(ur.error)),lr.addEventListener("message",ur=>{const dr=new ao(ur.data,er);this.colorSpace=dr.colorSpace,dr.type=this.type,dr.name=this.name,URL.revokeObjectURL(or),sr(dr)});const cr=tr?[ir.data.buffer]:[];lr.postMessage({operation:LUTOperation.SCALE_UP,data:ir.data,size:er},cr)}),nr}applyLUT(er){const tr=this.image,ir=er.image,nr=Math.min(tr.width,tr.height,tr.depth),sr=Math.min(ir.width,ir.height,ir.depth);if(nr!==sr)console.error("Size mismatch");else if(er.type!==FloatType||this.type!==FloatType)console.error("Both LUTs must be FloatType textures");else if(er.format!==RGBAFormat||this.format!==RGBAFormat)console.error("Both LUTs must be RGBA textures");else{const ar=tr.data,or=ir.data,lr=nr,cr=lr**2,ur=lr-1;for(let dr=0,hr=lr**3;dr<hr;++dr){const pr=dr*4,gr=ar[pr+0]*ur,vr=ar[pr+1]*ur,mr=ar[pr+2]*ur,fr=Math.round(gr+vr*lr+mr*cr)*4;ar[pr+0]=or[fr+0],ar[pr+1]=or[fr+1],ar[pr+2]=or[fr+2]}this.needsUpdate=!0}return this}convertToUint8(){if(this.type===FloatType){const er=this.image.data,tr=new Uint8Array(er.length);for(let ir=0,nr=er.length;ir<nr;++ir)tr[ir]=er[ir]*255+.5;this.image.data=tr,this.type=UnsignedByteType,this.needsUpdate=!0}return this}convertToFloat(){if(this.type===UnsignedByteType){const er=this.image.data,tr=new Float32Array(er.length);for(let ir=0,nr=er.length;ir<nr;++ir)tr[ir]=er[ir]/255;this.image.data=tr,this.type=FloatType,this.needsUpdate=!0}return this}convertToRGBA(){return console.warn("LookupTexture","convertToRGBA() is deprecated, LUTs are now RGBA by default"),this}convertLinearToSRGB(){const er=this.image.data;if(this.type===FloatType){for(let tr=0,ir=er.length;tr<ir;tr+=4)c.fromArray(er,tr).convertLinearToSRGB().toArray(er,tr);this.colorSpace=SRGBColorSpace,this.needsUpdate=!0}else console.error("Color space conversion requires FloatType data");return this}convertSRGBToLinear(){const er=this.image.data;if(this.type===FloatType){for(let tr=0,ir=er.length;tr<ir;tr+=4)c.fromArray(er,tr).convertSRGBToLinear().toArray(er,tr);this.colorSpace=LinearSRGBColorSpace,this.needsUpdate=!0}else console.error("Color space conversion requires FloatType data");return this}toDataTexture(){const er=this.image.width,tr=this.image.height*this.image.depth,ir=new DataTexture(this.image.data,er,tr);return ir.name=this.name,ir.type=this.type,ir.format=this.format,ir.minFilter=LinearFilter,ir.magFilter=LinearFilter,ir.wrapS=this.wrapS,ir.wrapT=this.wrapT,ir.generateMipmaps=!1,ir.needsUpdate=!0,this.colorSpace=ir.colorSpace,ir}static from(er){const tr=er.image,{width:ir,height:nr}=tr,sr=Math.min(ir,nr);let ar;if(tr instanceof Image){const cr=RawImageData.from(tr).data;if(ir>nr){ar=new Uint8Array(cr.length);for(let ur=0;ur<sr;++ur)for(let dr=0;dr<sr;++dr)for(let hr=0;hr<sr;++hr){const pr=(hr+ur*sr+dr*sr*sr)*4,gr=(hr+dr*sr+ur*sr*sr)*4;ar[gr+0]=cr[pr+0],ar[gr+1]=cr[pr+1],ar[gr+2]=cr[pr+2],ar[gr+3]=cr[pr+3]}}else ar=new Uint8Array(cr.buffer)}else ar=tr.data.slice();const or=new ao(ar,sr);return or.type=er.type,or.name=er.name,er.colorSpace=or.colorSpace,or}static createNeutral(er){const tr=new Float32Array(er**3*4),ir=er**2,nr=1/(er-1);for(let ar=0;ar<er;++ar)for(let or=0;or<er;++or)for(let lr=0;lr<er;++lr){const cr=(ar+or*er+lr*ir)*4;tr[cr+0]=ar*nr,tr[cr+1]=or*nr,tr[cr+2]=lr*nr,tr[cr+3]=1}const sr=new ao(tr,er);return sr.name="neutral",sr}},lut_3d_default=`uniform vec3 scale;uniform vec3 offset;
#ifdef CUSTOM_INPUT_DOMAIN
uniform vec3 domainMin;uniform vec3 domainMax;
#endif
#ifdef LUT_3D
#ifdef LUT_PRECISION_HIGH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler3D lut;
#else
uniform mediump sampler3D lut;
#endif
#else
uniform lowp sampler3D lut;
#endif
vec4 applyLUT(const in vec3 rgb){
#ifdef TETRAHEDRAL_INTERPOLATION
vec3 p=floor(rgb);vec3 f=rgb-p;vec3 v1=(p+0.5)*LUT_TEXEL_WIDTH;vec3 v4=(p+1.5)*LUT_TEXEL_WIDTH;vec3 v2,v3;vec3 frac;if(f.r>=f.g){if(f.g>f.b){frac=f.rgb;v2=vec3(v4.x,v1.y,v1.z);v3=vec3(v4.x,v4.y,v1.z);}else if(f.r>=f.b){frac=f.rbg;v2=vec3(v4.x,v1.y,v1.z);v3=vec3(v4.x,v1.y,v4.z);}else{frac=f.brg;v2=vec3(v1.x,v1.y,v4.z);v3=vec3(v4.x,v1.y,v4.z);}}else{if(f.b>f.g){frac=f.bgr;v2=vec3(v1.x,v1.y,v4.z);v3=vec3(v1.x,v4.y,v4.z);}else if(f.r>=f.b){frac=f.grb;v2=vec3(v1.x,v4.y,v1.z);v3=vec3(v4.x,v4.y,v1.z);}else{frac=f.gbr;v2=vec3(v1.x,v4.y,v1.z);v3=vec3(v1.x,v4.y,v4.z);}}vec4 n1=texture(lut,v1);vec4 n2=texture(lut,v2);vec4 n3=texture(lut,v3);vec4 n4=texture(lut,v4);vec4 weights=vec4(1.0-frac.x,frac.x-frac.y,frac.y-frac.z,frac.z);vec4 result=weights*mat4(vec4(n1.r,n2.r,n3.r,n4.r),vec4(n1.g,n2.g,n3.g,n4.g),vec4(n1.b,n2.b,n3.b,n4.b),vec4(1.0));return vec4(result.rgb,1.0);
#else
return texture(lut,rgb);
#endif
}
#else
#ifdef LUT_PRECISION_HIGH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D lut;
#else
uniform mediump sampler2D lut;
#endif
#else
uniform lowp sampler2D lut;
#endif
vec4 applyLUT(const in vec3 rgb){float slice=rgb.b*LUT_SIZE;float slice0=floor(slice);float interp=slice-slice0;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);
#ifdef LUT_STRIP_HORIZONTAL
float xOffset=clamp(rgb.r*LUT_TEXEL_HEIGHT,LUT_TEXEL_WIDTH*0.5,LUT_TEXEL_HEIGHT-LUT_TEXEL_WIDTH*0.5);vec2 uv0=vec2(slice0*LUT_TEXEL_HEIGHT+xOffset,rgb.g);vec2 uv1=vec2(slice1*LUT_TEXEL_HEIGHT+xOffset,rgb.g);
#else
float yOffset=clamp(rgb.g*LUT_TEXEL_WIDTH,LUT_TEXEL_HEIGHT*0.5,LUT_TEXEL_WIDTH-LUT_TEXEL_HEIGHT*0.5);vec2 uv0=vec2(rgb.r,slice0*LUT_TEXEL_WIDTH+yOffset);vec2 uv1=vec2(rgb.r,slice1*LUT_TEXEL_WIDTH+yOffset);
#endif
vec4 sample0=texture2D(lut,uv0);vec4 sample1=texture2D(lut,uv1);return mix(sample0,sample1,abs(centeredInterp));}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 c=inputColor.rgb;
#ifdef CUSTOM_INPUT_DOMAIN
if(c.r>=domainMin.r&&c.g>=domainMin.g&&c.b>=domainMin.b&&c.r<=domainMax.r&&c.g<=domainMax.g&&c.b<=domainMax.b){c=applyLUT(scale*c+offset).rgb;}else{c=inputColor.rgb;}
#else
#if !defined(LUT_3D) || defined(TETRAHEDRAL_INTERPOLATION)
c=clamp(c,0.0,1.0);
#endif
c=applyLUT(scale*c+offset).rgb;
#endif
outputColor=vec4(c,inputColor.a);}`,LUT3DEffect=class extends Effect{constructor(rr,{blendFunction:er=BlendFunction.SRC,tetrahedralInterpolation:tr=!1,inputColorSpace:ir=SRGBColorSpace}={}){super("LUT3DEffect",lut_3d_default,{blendFunction:er,uniforms:new Map([["lut",new Uniform(null)],["scale",new Uniform(new Vector3$1)],["offset",new Uniform(new Vector3$1)],["domainMin",new Uniform(null)],["domainMax",new Uniform(null)]])}),this.tetrahedralInterpolation=tr,this.inputColorSpace=ir,this.lut=rr}get lut(){return this.uniforms.get("lut").value}set lut(rr){const er=this.defines,tr=this.uniforms;if(this.lut!==rr&&(tr.get("lut").value=rr,rr!==null)){const ir=rr.image,nr=this.tetrahedralInterpolation;if(er.clear(),er.set("LUT_SIZE",Math.min(ir.width,ir.height).toFixed(16)),er.set("LUT_TEXEL_WIDTH",(1/ir.width).toFixed(16)),er.set("LUT_TEXEL_HEIGHT",(1/ir.height).toFixed(16)),tr.get("domainMin").value=null,tr.get("domainMax").value=null,(rr.type===FloatType||rr.type===HalfFloatType)&&er.set("LUT_PRECISION_HIGH","1"),ir.width>ir.height?er.set("LUT_STRIP_HORIZONTAL","1"):rr instanceof Data3DTexture&&er.set("LUT_3D","1"),rr instanceof LookupTexture){const sr=rr.domainMin,ar=rr.domainMax;(sr.x!==0||sr.y!==0||sr.z!==0||ar.x!==1||ar.y!==1||ar.z!==1)&&(er.set("CUSTOM_INPUT_DOMAIN","1"),tr.get("domainMin").value=sr.clone(),tr.get("domainMax").value=ar.clone())}this.tetrahedralInterpolation=nr}}getLUT(){return this.lut}setLUT(rr){this.lut=rr}updateScaleOffset(){const rr=this.lut;if(rr!==null){const er=Math.min(rr.image.width,rr.image.height),tr=this.uniforms.get("scale").value,ir=this.uniforms.get("offset").value;if(this.tetrahedralInterpolation&&rr instanceof Data3DTexture)if(this.defines.has("CUSTOM_INPUT_DOMAIN")){const nr=rr.domainMax.clone().sub(rr.domainMin);tr.setScalar(er-1).divide(nr),ir.copy(rr.domainMin).negate().multiply(tr)}else tr.setScalar(er-1),ir.setScalar(0);else if(this.defines.has("CUSTOM_INPUT_DOMAIN")){const nr=rr.domainMax.clone().sub(rr.domainMin).multiplyScalar(er);tr.setScalar(er-1).divide(nr),ir.copy(rr.domainMin).negate().multiply(tr).addScalar(1/(2*er))}else tr.setScalar((er-1)/er),ir.setScalar(1/(2*er))}}configureTetrahedralInterpolation(){const rr=this.lut;rr!==null&&(rr.minFilter=LinearFilter,rr.magFilter=LinearFilter,this.tetrahedralInterpolation&&(rr instanceof Data3DTexture?(rr.minFilter=NearestFilter,rr.magFilter=NearestFilter):console.warn("Tetrahedral interpolation requires a 3D texture")),rr.needsUpdate=!0)}get tetrahedralInterpolation(){return this.defines.has("TETRAHEDRAL_INTERPOLATION")}set tetrahedralInterpolation(rr){rr?this.defines.set("TETRAHEDRAL_INTERPOLATION","1"):this.defines.delete("TETRAHEDRAL_INTERPOLATION"),this.configureTetrahedralInterpolation(),this.updateScaleOffset(),this.setChanged()}setTetrahedralInterpolationEnabled(rr){this.tetrahedralInterpolation=rr}},DepthCopyMode={FULL:0,SINGLE:1},EdgeDetectionMode={DEPTH:0,LUMA:1,COLOR:2},PredicationMode={DISABLED:0,DEPTH:1,CUSTOM:2},SMAAPreset={LOW:0,MEDIUM:1,HIGH:2,ULTRA:3},ToneMappingMode={LINEAR:0,REINHARD:1,REINHARD2:2,REINHARD2_ADAPTIVE:3,UNCHARTED2:4,OPTIMIZED_CINEON:5,CINEON:5,ACES_FILMIC:6,AGX:7,NEUTRAL:8},VignetteTechnique={DEFAULT:0,ESKIL:1},WebGLExtension={DERIVATIVES:"derivatives",FRAG_DEPTH:"fragDepth",DRAW_BUFFERS:"drawBuffers",SHADER_TEXTURE_LOD:"shaderTextureLOD"},noise_default=`void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 noise=vec3(rand(uv*(1.0+time)));
#ifdef PREMULTIPLY
outputColor=vec4(min(inputColor.rgb*noise,vec3(1.0)),inputColor.a);
#else
outputColor=vec4(noise,inputColor.a);
#endif
}`,NoiseEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SCREEN,premultiply:er=!1}={}){super("NoiseEffect",noise_default,{blendFunction:rr}),this.premultiply=er}get premultiply(){return this.defines.has("PREMULTIPLY")}set premultiply(rr){this.premultiply!==rr&&(rr?this.defines.set("PREMULTIPLY","1"):this.defines.delete("PREMULTIPLY"),this.setChanged())}isPremultiplied(){return this.premultiply}setPremultiplied(rr){this.premultiply=rr}},depth_comparison_default=`#include <packing>
#include <clipping_planes_pars_fragment>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform float cameraNear;uniform float cameraFar;centroid varying float vViewZ;centroid varying vec4 vProjTexCoord;void main(){
#include <clipping_planes_fragment>
vec2 projTexCoord=(vProjTexCoord.xy/vProjTexCoord.w)*0.5+0.5;projTexCoord=clamp(projTexCoord,0.002,0.998);
#if DEPTH_PACKING == 3201
float fragCoordZ=unpackRGBAToDepth(texture2D(depthBuffer,projTexCoord));
#else
float fragCoordZ=texture2D(depthBuffer,projTexCoord).r;
#endif
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#else
float viewZ=orthographicDepthToViewZ(fragCoordZ,cameraNear,cameraFar);
#endif
float depthTest=(-vViewZ>-viewZ)?1.0:0.0;gl_FragColor.rg=vec2(0.0,depthTest);}`,depth_comparison_default2=`#include <common>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
varying float vViewZ;varying vec4 vProjTexCoord;void main(){
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <project_vertex>
vViewZ=mvPosition.z;vProjTexCoord=gl_Position;
#include <clipping_planes_vertex>
}`,DepthComparisonMaterial=class extends ShaderMaterial{constructor(rr=null,er){super({name:"DepthComparisonMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Uniform(null),cameraNear:new Uniform(.3),cameraFar:new Uniform(1e3)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:depth_comparison_default,vertexShader:depth_comparison_default2}),this.depthBuffer=rr,this.depthPacking=RGBADepthPacking,this.copyCameraSettings(er)}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=RGBADepthPacking){this.depthBuffer=rr,this.depthPacking=er}adoptCameraSettings(rr){this.copyCameraSettings(rr)}copyCameraSettings(rr){rr&&(this.uniforms.cameraNear.value=rr.near,this.uniforms.cameraFar.value=rr.far,rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}},outline_default="uniform lowp sampler2D inputBuffer;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 c0=texture2D(inputBuffer,vUv0).rg;vec2 c1=texture2D(inputBuffer,vUv1).rg;vec2 c2=texture2D(inputBuffer,vUv2).rg;vec2 c3=texture2D(inputBuffer,vUv3).rg;float d0=(c0.x-c1.x)*0.5;float d1=(c2.x-c3.x)*0.5;float d=length(vec2(d0,d1));float a0=min(c0.y,c1.y);float a1=min(c2.y,c3.y);float visibilityFactor=min(a0,a1);gl_FragColor.rg=(1.0-visibilityFactor>0.001)?vec2(d,0.0):vec2(0.0,d);}",outline_default2="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=vec2(uv.x+texelSize.x,uv.y);vUv1=vec2(uv.x-texelSize.x,uv.y);vUv2=vec2(uv.x,uv.y+texelSize.y);vUv3=vec2(uv.x,uv.y-texelSize.y);gl_Position=vec4(position.xy,1.0,1.0);}",OutlineMaterial=class extends ShaderMaterial{constructor(rr=new Vector2){super({name:"OutlineMaterial",uniforms:{inputBuffer:new Uniform(null),texelSize:new Uniform(new Vector2)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:outline_default,vertexShader:outline_default2}),this.uniforms.texelSize.value.set(rr.x,rr.y),this.uniforms.maskTexture=this.uniforms.inputBuffer}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}setTexelSize(rr,er){this.uniforms.texelSize.value.set(rr,er)}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},DepthPass=class extends Pass{constructor(rr,er,{renderTarget:tr,resolutionScale:ir=1,width:nr=Resolution.AUTO_SIZE,height:sr=Resolution.AUTO_SIZE,resolutionX:ar=nr,resolutionY:or=sr}={}){super("DepthPass"),this.needsSwap=!1,this.renderPass=new RenderPass(rr,er,new MeshDepthMaterial({depthPacking:RGBADepthPacking}));const lr=this.renderPass;lr.skipShadowMapUpdate=!0,lr.ignoreBackground=!0;const cr=lr.clearPass;cr.overrideClearColor=new Color(16777215),cr.overrideClearAlpha=1,this.renderTarget=tr,this.renderTarget===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter}),this.renderTarget.texture.name="DepthPass.Target");const ur=this.resolution=new Resolution(this,ar,or,ir);ur.addEventListener("change",dr=>this.setSize(ur.baseWidth,ur.baseHeight))}set mainScene(rr){this.renderPass.mainScene=rr}set mainCamera(rr){this.renderPass.mainCamera=rr}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}render(rr,er,tr,ir,nr){const sr=this.renderToScreen?null:this.renderTarget;this.renderPass.render(rr,sr)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height)}},outline_default3=`uniform lowp sampler2D edgeTexture;uniform lowp sampler2D maskTexture;uniform vec3 visibleEdgeColor;uniform vec3 hiddenEdgeColor;uniform float pulse;uniform float edgeStrength;
#ifdef USE_PATTERN
uniform lowp sampler2D patternTexture;varying vec2 vUvPattern;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 edge=texture2D(edgeTexture,uv).rg;vec2 mask=texture2D(maskTexture,uv).rg;
#ifndef X_RAY
edge.y=0.0;
#endif
edge*=(edgeStrength*mask.x*pulse);vec3 color=edge.x*visibleEdgeColor+edge.y*hiddenEdgeColor;float visibilityFactor=0.0;
#ifdef USE_PATTERN
vec4 patternColor=texture2D(patternTexture,vUvPattern);
#ifdef X_RAY
float hiddenFactor=0.5;
#else
float hiddenFactor=0.0;
#endif
visibilityFactor=(1.0-mask.y>0.0)?1.0:hiddenFactor;visibilityFactor*=(1.0-mask.x)*patternColor.a;color+=visibilityFactor*patternColor.rgb;
#endif
float alpha=max(max(edge.x,edge.y),visibilityFactor);
#ifdef ALPHA
outputColor=vec4(color,alpha);
#else
outputColor=vec4(color,max(alpha,inputColor.a));
#endif
}`,outline_default4="uniform float patternScale;varying vec2 vUvPattern;void mainSupport(const in vec2 uv){vUvPattern=uv*vec2(aspect,1.0)*patternScale;}",OutlineEffect=class extends Effect{constructor(rr,er,{blendFunction:tr=BlendFunction.SCREEN,patternTexture:ir=null,patternScale:nr=1,edgeStrength:sr=1,pulseSpeed:ar=0,visibleEdgeColor:or=16777215,hiddenEdgeColor:lr=2230538,kernelSize:cr=KernelSize.VERY_SMALL,blur:ur=!1,xRay:dr=!0,multisampling:hr=0,resolutionScale:pr=.5,width:gr=Resolution.AUTO_SIZE,height:vr=Resolution.AUTO_SIZE,resolutionX:mr=gr,resolutionY:fr=vr}={}){super("OutlineEffect",outline_default3,{uniforms:new Map([["maskTexture",new Uniform(null)],["edgeTexture",new Uniform(null)],["edgeStrength",new Uniform(sr)],["visibleEdgeColor",new Uniform(new Color(or))],["hiddenEdgeColor",new Uniform(new Color(lr))],["pulse",new Uniform(1)],["patternScale",new Uniform(nr)],["patternTexture",new Uniform(null)]])}),this.blendMode.addEventListener("change",wr=>{this.blendMode.blendFunction===BlendFunction.ALPHA?this.defines.set("ALPHA","1"):this.defines.delete("ALPHA"),this.setChanged()}),this.blendMode.blendFunction=tr,this.patternTexture=ir,this.xRay=dr,this.scene=rr,this.camera=er,this.renderTargetMask=new WebGLRenderTarget(1,1),this.renderTargetMask.samples=hr,this.renderTargetMask.texture.name="Outline.Mask",this.uniforms.get("maskTexture").value=this.renderTargetMask.texture,this.renderTargetOutline=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetOutline.texture.name="Outline.Edges",this.uniforms.get("edgeTexture").value=this.renderTargetOutline.texture,this.clearPass=new ClearPass,this.clearPass.overrideClearColor=new Color(0),this.clearPass.overrideClearAlpha=1,this.depthPass=new DepthPass(rr,er),this.maskPass=new RenderPass(rr,er,new DepthComparisonMaterial(this.depthPass.texture,er));const _r=this.maskPass.clearPass;_r.overrideClearColor=new Color(16777215),_r.overrideClearAlpha=1,this.blurPass=new KawaseBlurPass({resolutionScale:pr,resolutionX:mr,resolutionY:fr,kernelSize:cr}),this.blurPass.enabled=ur;const Ar=this.blurPass.resolution;Ar.addEventListener("change",wr=>this.setSize(Ar.baseWidth,Ar.baseHeight)),this.outlinePass=new ShaderPass(new OutlineMaterial);const yr=this.outlinePass.fullscreenMaterial;yr.inputBuffer=this.renderTargetMask.texture,this.time=0,this.forceUpdate=!0,this.selection=new Selection,this.pulseSpeed=ar}set mainScene(rr){this.scene=rr,this.depthPass.mainScene=rr,this.maskPass.mainScene=rr}set mainCamera(rr){this.camera=rr,this.depthPass.mainCamera=rr,this.maskPass.mainCamera=rr,this.maskPass.overrideMaterial.copyCameraSettings(rr)}get resolution(){return this.blurPass.resolution}getResolution(){return this.blurPass.getResolution()}get multisampling(){return this.renderTargetMask.samples}set multisampling(rr){this.renderTargetMask.samples=rr,this.renderTargetMask.dispose()}get patternScale(){return this.uniforms.get("patternScale").value}set patternScale(rr){this.uniforms.get("patternScale").value=rr}get edgeStrength(){return this.uniforms.get("edgeStrength").value}set edgeStrength(rr){this.uniforms.get("edgeStrength").value=rr}get visibleEdgeColor(){return this.uniforms.get("visibleEdgeColor").value}set visibleEdgeColor(rr){this.uniforms.get("visibleEdgeColor").value=rr}get hiddenEdgeColor(){return this.uniforms.get("hiddenEdgeColor").value}set hiddenEdgeColor(rr){this.uniforms.get("hiddenEdgeColor").value=rr}getBlurPass(){return this.blurPass}getSelection(){return this.selection}getPulseSpeed(){return this.pulseSpeed}setPulseSpeed(rr){this.pulseSpeed=rr}get width(){return this.resolution.width}set width(rr){this.resolution.preferredWidth=rr}get height(){return this.resolution.height}set height(rr){this.resolution.preferredHeight=rr}get selectionLayer(){return this.selection.layer}set selectionLayer(rr){this.selection.layer=rr}get dithering(){return this.blurPass.dithering}set dithering(rr){this.blurPass.dithering=rr}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(rr){this.blurPass.kernelSize=rr}get blur(){return this.blurPass.enabled}set blur(rr){this.blurPass.enabled=rr}get xRay(){return this.defines.has("X_RAY")}set xRay(rr){this.xRay!==rr&&(rr?this.defines.set("X_RAY","1"):this.defines.delete("X_RAY"),this.setChanged())}isXRayEnabled(){return this.xRay}setXRayEnabled(rr){this.xRay=rr}get patternTexture(){return this.uniforms.get("patternTexture").value}set patternTexture(rr){rr!==null?(rr.wrapS=rr.wrapT=RepeatWrapping,this.defines.set("USE_PATTERN","1"),this.setVertexShader(outline_default4)):(this.defines.delete("USE_PATTERN"),this.setVertexShader(null)),this.uniforms.get("patternTexture").value=rr,this.setChanged()}setPatternTexture(rr){this.patternTexture=rr}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}setSelection(rr){return this.selection.set(rr),this}clearSelection(){return this.selection.clear(),this}selectObject(rr){return this.selection.add(rr),this}deselectObject(rr){return this.selection.delete(rr),this}update(rr,er,tr){const ir=this.scene,nr=this.camera,sr=this.selection,or=this.uniforms.get("pulse"),lr=ir.background,cr=nr.layers.mask;(this.forceUpdate||sr.size>0)&&(ir.background=null,or.value=1,this.pulseSpeed>0&&(or.value=Math.cos(this.time*this.pulseSpeed*10)*.375+.625),this.time+=tr,sr.setVisible(!1),this.depthPass.render(rr),sr.setVisible(!0),nr.layers.set(sr.layer),this.maskPass.render(rr,this.renderTargetMask),nr.layers.mask=cr,ir.background=lr,this.outlinePass.render(rr,null,this.renderTargetOutline),this.blurPass.enabled&&this.blurPass.render(rr,this.renderTargetOutline,this.renderTargetOutline)),this.forceUpdate=sr.size>0}setSize(rr,er){this.blurPass.setSize(rr,er),this.renderTargetMask.setSize(rr,er);const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.depthPass.setSize(ir,nr),this.renderTargetOutline.setSize(ir,nr),this.outlinePass.fullscreenMaterial.setSize(ir,nr)}initialize(rr,er,tr){this.blurPass.initialize(rr,er,UnsignedByteType),tr!==void 0&&(this.depthPass.initialize(rr,er,tr),this.maskPass.initialize(rr,er,tr),this.outlinePass.initialize(rr,er,tr))}},pixelation_default="uniform bool active;uniform vec4 d;void mainUv(inout vec2 uv){if(active){uv=d.xy*(floor(uv*d.zw)+0.5);}}",PixelationEffect=class extends Effect{constructor(rr=30){super("PixelationEffect",pixelation_default,{uniforms:new Map([["active",new Uniform(!1)],["d",new Uniform(new Vector4)]])}),this.resolution=new Vector2,this._granularity=0,this.granularity=rr}get granularity(){return this._granularity}set granularity(rr){let er=Math.floor(rr);er%2>0&&(er+=1),this._granularity=er,this.uniforms.get("active").value=er>0,this.setSize(this.resolution.width,this.resolution.height)}getGranularity(){return this.granularity}setGranularity(rr){this.granularity=rr}setSize(rr,er){const tr=this.resolution;tr.set(rr,er);const ir=this.granularity,nr=ir/tr.x,sr=ir/tr.y;this.uniforms.get("d").value.set(nr,sr,1/nr,1/sr)}},realistic_bokeh_default=`uniform float focus;uniform float focalLength;uniform float fStop;uniform float maxBlur;uniform float luminanceThreshold;uniform float luminanceGain;uniform float bias;uniform float fringe;
#ifdef MANUAL_DOF
uniform vec4 dof;
#endif
#ifdef PENTAGON
float pentagon(const in vec2 coords){const vec4 HS0=vec4(1.0,0.0,0.0,1.0);const vec4 HS1=vec4(0.309016994,0.951056516,0.0,1.0);const vec4 HS2=vec4(-0.809016994,0.587785252,0.0,1.0);const vec4 HS3=vec4(-0.809016994,-0.587785252,0.0,1.0);const vec4 HS4=vec4(0.309016994,-0.951056516,0.0,1.0);const vec4 HS5=vec4(0.0,0.0,1.0,1.0);const vec4 ONE=vec4(1.0);const float P_FEATHER=0.4;const float N_FEATHER=-P_FEATHER;float inOrOut=-4.0;vec4 P=vec4(coords,vec2(RINGS_FLOAT-1.3));vec4 dist=vec4(dot(P,HS0),dot(P,HS1),dot(P,HS2),dot(P,HS3));dist=smoothstep(N_FEATHER,P_FEATHER,dist);inOrOut+=dot(dist,ONE);dist.x=dot(P,HS4);dist.y=HS5.w-abs(P.z);dist=smoothstep(N_FEATHER,P_FEATHER,dist);inOrOut+=dist.x;return clamp(inOrOut,0.0,1.0);}
#endif
vec3 processTexel(const in vec2 coords,const in float blur){vec2 scale=texelSize*fringe*blur;vec3 c=vec3(texture2D(inputBuffer,coords+vec2(0.0,1.0)*scale).r,texture2D(inputBuffer,coords+vec2(-0.866,-0.5)*scale).g,texture2D(inputBuffer,coords+vec2(0.866,-0.5)*scale).b);float luminance=linearToRelativeLuminance(c);float threshold=max((luminance-luminanceThreshold)*luminanceGain,0.0);return c+mix(vec3(0.0),c,threshold*blur);}float gather(const in float i,const in float j,const in float ringSamples,const in vec2 uv,const in vec2 blurFactor,const in float blur,inout vec3 color){float step=PI2/ringSamples;vec2 wh=vec2(cos(j*step)*i,sin(j*step)*i);
#ifdef PENTAGON
float p=pentagon(wh);
#else
float p=1.0;
#endif
color+=processTexel(wh*blurFactor+uv,blur)*mix(1.0,i/RINGS_FLOAT,bias)*p;return mix(1.0,i/RINGS_FLOAT,bias)*p;}void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){
#ifdef PERSPECTIVE_CAMERA
float viewZ=perspectiveDepthToViewZ(depth,cameraNear,cameraFar);float linearDepth=viewZToOrthographicDepth(viewZ,cameraNear,cameraFar);
#else
float linearDepth=depth;
#endif
#ifdef MANUAL_DOF
float focalPlane=linearDepth-focus;float farDoF=(focalPlane-dof.z)/dof.w;float nearDoF=(-focalPlane-dof.x)/dof.y;float blur=(focalPlane>0.0)?farDoF:nearDoF;
#else
const float CIRCLE_OF_CONFUSION=0.03;float focalPlaneMM=focus*1000.0;float depthMM=linearDepth*1000.0;float focalPlane=(depthMM*focalLength)/(depthMM-focalLength);float farDoF=(focalPlaneMM*focalLength)/(focalPlaneMM-focalLength);float nearDoF=(focalPlaneMM-focalLength)/(focalPlaneMM*fStop*CIRCLE_OF_CONFUSION);float blur=abs(focalPlane-farDoF)*nearDoF;
#endif
const int MAX_RING_SAMPLES=RINGS_INT*SAMPLES_INT;blur=clamp(blur,0.0,1.0);vec3 color=inputColor.rgb;if(blur>=0.05){vec2 blurFactor=blur*maxBlur*texelSize;float s=1.0;int ringSamples;for(int i=1;i<=RINGS_INT;i++){ringSamples=i*SAMPLES_INT;for(int j=0;j<MAX_RING_SAMPLES;j++){if(j>=ringSamples){break;}s+=gather(float(i),float(j),float(ringSamples),uv,blurFactor,blur,color);}}color/=s;}
#ifdef SHOW_FOCUS
float edge=0.002*linearDepth;float m=clamp(smoothstep(0.0,edge,blur),0.0,1.0);float e=clamp(smoothstep(1.0-edge,1.0,blur),0.0,1.0);color=mix(color,vec3(1.0,0.5,0.0),(1.0-m)*0.6);color=mix(color,vec3(0.0,0.5,1.0),((1.0-e)-(1.0-m))*0.2);
#endif
outputColor=vec4(color,inputColor.a);}`,RealisticBokehEffect=class extends Effect{constructor({blendFunction:rr,focus:er=1,focalLength:tr=24,fStop:ir=.9,luminanceThreshold:nr=.5,luminanceGain:sr=2,bias:ar=.5,fringe:or=.7,maxBlur:lr=1,rings:cr=3,samples:ur=2,showFocus:dr=!1,manualDoF:hr=!1,pentagon:pr=!1}={}){super("RealisticBokehEffect",realistic_bokeh_default,{blendFunction:rr,attributes:EffectAttribute.CONVOLUTION|EffectAttribute.DEPTH,uniforms:new Map([["focus",new Uniform(er)],["focalLength",new Uniform(tr)],["fStop",new Uniform(ir)],["luminanceThreshold",new Uniform(nr)],["luminanceGain",new Uniform(sr)],["bias",new Uniform(ar)],["fringe",new Uniform(or)],["maxBlur",new Uniform(lr)],["dof",new Uniform(null)]])}),this.rings=cr,this.samples=ur,this.showFocus=dr,this.manualDoF=hr,this.pentagon=pr}get rings(){return Number.parseInt(this.defines.get("RINGS_INT"))}set rings(rr){const er=Math.floor(rr);this.defines.set("RINGS_INT",er.toFixed(0)),this.defines.set("RINGS_FLOAT",er.toFixed(1)),this.setChanged()}get samples(){return Number.parseInt(this.defines.get("SAMPLES_INT"))}set samples(rr){const er=Math.floor(rr);this.defines.set("SAMPLES_INT",er.toFixed(0)),this.defines.set("SAMPLES_FLOAT",er.toFixed(1)),this.setChanged()}get showFocus(){return this.defines.has("SHOW_FOCUS")}set showFocus(rr){this.showFocus!==rr&&(rr?this.defines.set("SHOW_FOCUS","1"):this.defines.delete("SHOW_FOCUS"),this.setChanged())}get manualDoF(){return this.defines.has("MANUAL_DOF")}set manualDoF(rr){this.manualDoF!==rr&&(rr?(this.defines.set("MANUAL_DOF","1"),this.uniforms.get("dof").value=new Vector4(.2,1,.2,2)):(this.defines.delete("MANUAL_DOF"),this.uniforms.get("dof").value=null),this.setChanged())}get pentagon(){return this.defines.has("PENTAGON")}set pentagon(rr){this.pentagon!==rr&&(rr?this.defines.set("PENTAGON","1"):this.defines.delete("PENTAGON"),this.setChanged())}},scanlines_default=`uniform float count;
#ifdef SCROLL
uniform float scrollSpeed;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float y=uv.y;
#ifdef SCROLL
y+=time*scrollSpeed;
#endif
vec2 sl=vec2(sin(y*count),cos(y*count));outputColor=vec4(sl.xyx,inputColor.a);}`,ScanlineEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.OVERLAY,density:er=1.25,scrollSpeed:tr=0}={}){super("ScanlineEffect",scanlines_default,{blendFunction:rr,uniforms:new Map([["count",new Uniform(0)],["scrollSpeed",new Uniform(0)]])}),this.resolution=new Vector2,this.d=er,this.scrollSpeed=tr}get density(){return this.d}set density(rr){this.d=rr,this.setSize(this.resolution.width,this.resolution.height)}getDensity(){return this.density}setDensity(rr){this.density=rr}get scrollSpeed(){return this.uniforms.get("scrollSpeed").value}set scrollSpeed(rr){this.uniforms.get("scrollSpeed").value=rr,rr===0?this.defines.delete("SCROLL")&&this.setChanged():this.defines.has("SCROLL")||(this.defines.set("SCROLL","1"),this.setChanged())}setSize(rr,er){this.resolution.set(rr,er),this.uniforms.get("count").value=Math.round(er*this.density)}},shock_wave_default="uniform bool active;uniform vec2 center;uniform float waveSize;uniform float radius;uniform float maxRadius;uniform float amplitude;varying float vSize;void mainUv(inout vec2 uv){if(active){vec2 aspectCorrection=vec2(aspect,1.0);vec2 difference=uv*aspectCorrection-center*aspectCorrection;float distance=sqrt(dot(difference,difference))*vSize;if(distance>radius){if(distance<radius+waveSize){float angle=(distance-radius)*PI2/waveSize;float cosSin=(1.0-cos(angle))*0.5;float extent=maxRadius+waveSize;float decay=max(extent-distance*distance,0.0)/extent;uv-=((cosSin*amplitude*difference)/distance)*decay;}}}}",shock_wave_default2="uniform float size;uniform float cameraDistance;varying float vSize;void mainSupport(){vSize=(0.1*cameraDistance)/size;}",HALF_PI=Math.PI*.5,v2=new Vector3$1,ab=new Vector3$1,ShockWaveEffect=class extends Effect{constructor(rr,er=new Vector3$1,{speed:tr=2,maxRadius:ir=1,waveSize:nr=.2,amplitude:sr=.05}={}){super("ShockWaveEffect",shock_wave_default,{vertexShader:shock_wave_default2,uniforms:new Map([["active",new Uniform(!1)],["center",new Uniform(new Vector2(.5,.5))],["cameraDistance",new Uniform(1)],["size",new Uniform(1)],["radius",new Uniform(-nr)],["maxRadius",new Uniform(ir)],["waveSize",new Uniform(nr)],["amplitude",new Uniform(sr)]])}),this.position=er,this.speed=tr,this.camera=rr,this.screenPosition=this.uniforms.get("center").value,this.time=0,this.active=!1}set mainCamera(rr){this.camera=rr}get amplitude(){return this.uniforms.get("amplitude").value}set amplitude(rr){this.uniforms.get("amplitude").value=rr}get waveSize(){return this.uniforms.get("waveSize").value}set waveSize(rr){this.uniforms.get("waveSize").value=rr}get maxRadius(){return this.uniforms.get("maxRadius").value}set maxRadius(rr){this.uniforms.get("maxRadius").value=rr}get epicenter(){return this.position}set epicenter(rr){this.position=rr}getPosition(){return this.position}setPosition(rr){this.position=rr}getSpeed(){return this.speed}setSpeed(rr){this.speed=rr}explode(){this.time=0,this.active=!0,this.uniforms.get("active").value=!0}update(rr,er,tr){const ir=this.position,nr=this.camera,sr=this.uniforms,ar=sr.get("active");if(this.active){const or=sr.get("waveSize").value;nr.getWorldDirection(v2),ab.copy(nr.position).sub(ir),ar.value=v2.angleTo(ab)>HALF_PI,ar.value&&(sr.get("cameraDistance").value=nr.position.distanceTo(ir),v2.copy(ir).project(nr),this.screenPosition.set((v2.x+1)*.5,(v2.y+1)*.5)),this.time+=tr*this.speed;const lr=this.time-or;sr.get("radius").value=lr,lr>=(sr.get("maxRadius").value+or)*2&&(this.active=!1,ar.value=!1)}}},SelectiveBloomEffect=class extends BloomEffect{constructor(rr,er,tr){super(tr),this.setAttributes(this.getAttributes()|EffectAttribute.DEPTH),this.camera=er,this.depthPass=new DepthPass(rr,er),this.clearPass=new ClearPass(!0,!1,!1),this.clearPass.overrideClearColor=new Color(0),this.depthMaskPass=new ShaderPass(new DepthMaskMaterial);const ir=this.depthMaskMaterial;ir.copyCameraSettings(er),ir.depthBuffer1=this.depthPass.texture,ir.depthPacking1=RGBADepthPacking,ir.depthMode=EqualDepth,this.renderTargetMasked=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetMasked.texture.name="Bloom.Masked",this.selection=new Selection,this._inverted=!1,this._ignoreBackground=!1}set mainScene(rr){this.depthPass.mainScene=rr}set mainCamera(rr){this.camera=rr,this.depthPass.mainCamera=rr,this.depthMaskMaterial.copyCameraSettings(rr)}getSelection(){return this.selection}get depthMaskMaterial(){return this.depthMaskPass.fullscreenMaterial}get inverted(){return this._inverted}set inverted(rr){this._inverted=rr,this.depthMaskMaterial.depthMode=rr?NotEqualDepth:EqualDepth}isInverted(){return this.inverted}setInverted(rr){this.inverted=rr}get ignoreBackground(){return this._ignoreBackground}set ignoreBackground(rr){this._ignoreBackground=rr,this.depthMaskMaterial.maxDepthStrategy=rr?DepthTestStrategy.DISCARD_MAX_DEPTH:DepthTestStrategy.KEEP_MAX_DEPTH}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(rr){this.ignoreBackground=rr}setDepthTexture(rr,er=BasicDepthPacking){this.depthMaskMaterial.depthBuffer0=rr,this.depthMaskMaterial.depthPacking0=er}update(rr,er,tr){const ir=this.camera,nr=this.selection,sr=this.inverted;let ar=er;if(this.ignoreBackground||!sr||nr.size>0){const or=ir.layers.mask;ir.layers.set(nr.layer),this.depthPass.render(rr),ir.layers.mask=or,ar=this.renderTargetMasked,this.clearPass.render(rr,ar),this.depthMaskPass.render(rr,er,ar)}super.update(rr,ar,tr)}setSize(rr,er){super.setSize(rr,er),this.renderTargetMasked.setSize(rr,er),this.depthPass.setSize(rr,er)}initialize(rr,er,tr){super.initialize(rr,er,tr),this.clearPass.initialize(rr,er,tr),this.depthPass.initialize(rr,er,tr),this.depthMaskPass.initialize(rr,er,tr),rr!==null&&rr.capabilities.logarithmicDepthBuffer&&(this.depthMaskPass.fullscreenMaterial.defines.LOG_DEPTH="1"),tr!==void 0&&(this.renderTargetMasked.texture.type=tr,rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTargetMasked.texture.colorSpace=SRGBColorSpace))}},sepia_default="uniform vec3 weightsR;uniform vec3 weightsG;uniform vec3 weightsB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec3 color=vec3(dot(inputColor.rgb,weightsR),dot(inputColor.rgb,weightsG),dot(inputColor.rgb,weightsB));outputColor=vec4(color,inputColor.a);}",SepiaEffect=class extends Effect{constructor({blendFunction:rr,intensity:er=1}={}){super("SepiaEffect",sepia_default,{blendFunction:rr,uniforms:new Map([["weightsR",new Uniform(new Vector3$1(.393,.769,.189))],["weightsG",new Uniform(new Vector3$1(.349,.686,.168))],["weightsB",new Uniform(new Vector3$1(.272,.534,.131))]])})}get intensity(){return this.blendMode.opacity.value}set intensity(rr){this.blendMode.opacity.value=rr}getIntensity(){return this.intensity}setIntensity(rr){this.intensity=rr}get weightsR(){return this.uniforms.get("weightsR").value}get weightsG(){return this.uniforms.get("weightsG").value}get weightsB(){return this.uniforms.get("weightsB").value}},edge_detection_default=`varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
#if EDGE_DETECTION_MODE == 1
#include <common>
#endif
#if EDGE_DETECTION_MODE == 0 || PREDICATION_MODE == 1
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}vec3 gatherNeighbors(){float p=readDepth(vUv);float pLeft=readDepth(vUv0);float pTop=readDepth(vUv1);return vec3(p,pLeft,pTop);}
#elif PREDICATION_MODE == 2
uniform sampler2D predicationBuffer;vec3 gatherNeighbors(){float p=texture2D(predicationBuffer,vUv).r;float pLeft=texture2D(predicationBuffer,vUv0).r;float pTop=texture2D(predicationBuffer,vUv1).r;return vec3(p,pLeft,pTop);}
#endif
#if PREDICATION_MODE != 0
vec2 calculatePredicatedThreshold(){vec3 neighbours=gatherNeighbors();vec2 delta=abs(neighbours.xx-neighbours.yz);vec2 edges=step(PREDICATION_THRESHOLD,delta);return PREDICATION_SCALE*EDGE_THRESHOLD*(1.0-PREDICATION_STRENGTH*edges);}
#endif
#if EDGE_DETECTION_MODE != 0
uniform sampler2D inputBuffer;
#endif
void main(){
#if EDGE_DETECTION_MODE == 0
const vec2 threshold=vec2(DEPTH_THRESHOLD);
#elif PREDICATION_MODE != 0
vec2 threshold=calculatePredicatedThreshold();
#else
const vec2 threshold=vec2(EDGE_THRESHOLD);
#endif
#if EDGE_DETECTION_MODE == 0
vec3 neighbors=gatherNeighbors();vec2 delta=abs(neighbors.xx-vec2(neighbors.y,neighbors.z));vec2 edges=step(threshold,delta);if(dot(edges,vec2(1.0))==0.0){discard;}gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 1
float l=luminance(texture2D(inputBuffer,vUv).rgb);float lLeft=luminance(texture2D(inputBuffer,vUv0).rgb);float lTop=luminance(texture2D(inputBuffer,vUv1).rgb);vec4 delta;delta.xy=abs(l-vec2(lLeft,lTop));vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}float lRight=luminance(texture2D(inputBuffer,vUv2).rgb);float lBottom=luminance(texture2D(inputBuffer,vUv3).rgb);delta.zw=abs(l-vec2(lRight,lBottom));vec2 maxDelta=max(delta.xy,delta.zw);float lLeftLeft=luminance(texture2D(inputBuffer,vUv4).rgb);float lTopTop=luminance(texture2D(inputBuffer,vUv5).rgb);delta.zw=abs(vec2(lLeft,lTop)-vec2(lLeftLeft,lTopTop));maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges.xy*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#elif EDGE_DETECTION_MODE == 2
vec4 delta;vec3 c=texture2D(inputBuffer,vUv).rgb;vec3 cLeft=texture2D(inputBuffer,vUv0).rgb;vec3 t=abs(c-cLeft);delta.x=max(max(t.r,t.g),t.b);vec3 cTop=texture2D(inputBuffer,vUv1).rgb;t=abs(c-cTop);delta.y=max(max(t.r,t.g),t.b);vec2 edges=step(threshold,delta.xy);if(dot(edges,vec2(1.0))==0.0){discard;}vec3 cRight=texture2D(inputBuffer,vUv2).rgb;t=abs(c-cRight);delta.z=max(max(t.r,t.g),t.b);vec3 cBottom=texture2D(inputBuffer,vUv3).rgb;t=abs(c-cBottom);delta.w=max(max(t.r,t.g),t.b);vec2 maxDelta=max(delta.xy,delta.zw);vec3 cLeftLeft=texture2D(inputBuffer,vUv4).rgb;t=abs(c-cLeftLeft);delta.z=max(max(t.r,t.g),t.b);vec3 cTopTop=texture2D(inputBuffer,vUv5).rgb;t=abs(c-cTopTop);delta.w=max(max(t.r,t.g),t.b);maxDelta=max(maxDelta.xy,delta.zw);float finalDelta=max(maxDelta.x,maxDelta.y);edges*=step(finalDelta,LOCAL_CONTRAST_ADAPTATION_FACTOR*delta.xy);gl_FragColor=vec4(edges,0.0,1.0);
#endif
}`,edge_detection_default2=`uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;
#if EDGE_DETECTION_MODE != 0
varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;
#endif
void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,0.0);vUv1=vUv+texelSize*vec2(0.0,-1.0);
#if EDGE_DETECTION_MODE != 0
vUv2=vUv+texelSize*vec2(1.0,0.0);vUv3=vUv+texelSize*vec2(0.0,1.0);vUv4=vUv+texelSize*vec2(-2.0,0.0);vUv5=vUv+texelSize*vec2(0.0,-2.0);
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,EdgeDetectionMaterial=class extends ShaderMaterial{constructor(rr=new Vector2,er=EdgeDetectionMode.COLOR){super({name:"EdgeDetectionMaterial",defines:{THREE_REVISION:REVISION.replace(/\D+/g,""),LOCAL_CONTRAST_ADAPTATION_FACTOR:"2.0",EDGE_THRESHOLD:"0.1",DEPTH_THRESHOLD:"0.01",PREDICATION_MODE:"0",PREDICATION_THRESHOLD:"0.01",PREDICATION_SCALE:"2.0",PREDICATION_STRENGTH:"1.0",DEPTH_PACKING:"0"},uniforms:{inputBuffer:new Uniform(null),depthBuffer:new Uniform(null),predicationBuffer:new Uniform(null),texelSize:new Uniform(rr)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:edge_detection_default,vertexShader:edge_detection_default2}),this.edgeDetectionMode=er}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.depthPacking=er}get edgeDetectionMode(){return Number(this.defines.EDGE_DETECTION_MODE)}set edgeDetectionMode(rr){this.defines.EDGE_DETECTION_MODE=rr.toFixed(0),this.needsUpdate=!0}getEdgeDetectionMode(){return this.edgeDetectionMode}setEdgeDetectionMode(rr){this.edgeDetectionMode=rr}get localContrastAdaptationFactor(){return Number(this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR)}set localContrastAdaptationFactor(rr){this.defines.LOCAL_CONTRAST_ADAPTATION_FACTOR=rr.toFixed("6"),this.needsUpdate=!0}getLocalContrastAdaptationFactor(){return this.localContrastAdaptationFactor}setLocalContrastAdaptationFactor(rr){this.localContrastAdaptationFactor=rr}get edgeDetectionThreshold(){return Number(this.defines.EDGE_THRESHOLD)}set edgeDetectionThreshold(rr){this.defines.EDGE_THRESHOLD=rr.toFixed("6"),this.defines.DEPTH_THRESHOLD=(rr*.1).toFixed("6"),this.needsUpdate=!0}getEdgeDetectionThreshold(){return this.edgeDetectionThreshold}setEdgeDetectionThreshold(rr){this.edgeDetectionThreshold=rr}get predicationMode(){return Number(this.defines.PREDICATION_MODE)}set predicationMode(rr){this.defines.PREDICATION_MODE=rr.toFixed(0),this.needsUpdate=!0}getPredicationMode(){return this.predicationMode}setPredicationMode(rr){this.predicationMode=rr}set predicationBuffer(rr){this.uniforms.predicationBuffer.value=rr}setPredicationBuffer(rr){this.uniforms.predicationBuffer.value=rr}get predicationThreshold(){return Number(this.defines.PREDICATION_THRESHOLD)}set predicationThreshold(rr){this.defines.PREDICATION_THRESHOLD=rr.toFixed("6"),this.needsUpdate=!0}getPredicationThreshold(){return this.predicationThreshold}setPredicationThreshold(rr){this.predicationThreshold=rr}get predicationScale(){return Number(this.defines.PREDICATION_SCALE)}set predicationScale(rr){this.defines.PREDICATION_SCALE=rr.toFixed("6"),this.needsUpdate=!0}getPredicationScale(){return this.predicationScale}setPredicationScale(rr){this.predicationScale=rr}get predicationStrength(){return Number(this.defines.PREDICATION_STRENGTH)}set predicationStrength(rr){this.defines.PREDICATION_STRENGTH=rr.toFixed("6"),this.needsUpdate=!0}getPredicationStrength(){return this.predicationStrength}setPredicationStrength(rr){this.predicationStrength=rr}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},smaa_weights_default=`#define sampleLevelZeroOffset(t, coord, offset) texture2D(t, coord + offset * texelSize)
#if __VERSION__ < 300
#define round(v) floor(v + 0.5)
#endif
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform lowp sampler2D areaTexture;uniform lowp sampler2D searchTexture;uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}vec2 decodeDiagBilinearAccess(in vec2 e){e.r=e.r*abs(5.0*e.r-5.0*0.75);return round(e);}vec4 decodeDiagBilinearAccess(in vec4 e){e.rb=e.rb*abs(5.0*e.rb-5.0*0.75);return round(e);}vec2 searchDiag1(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 searchDiag2(const in vec2 texCoord,const in vec2 dir,out vec2 e){vec4 coord=vec4(texCoord,-1.0,1.0);coord.x+=0.25*texelSize.x;vec3 t=vec3(texelSize,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(coord.z<float(MAX_SEARCH_STEPS_DIAG_INT-1)&&coord.w>0.9)){break;}coord.xyz=t*vec3(dir,1.0)+coord.xyz;e=texture2D(inputBuffer,coord.xy).rg;e=decodeDiagBilinearAccess(e);coord.w=dot(e,vec2(0.5));}return coord.zw;}vec2 areaDiag(const in vec2 dist,const in vec2 e,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE_DIAG,AREATEX_MAX_DISTANCE_DIAG)*e+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.x+=0.5;texCoord.y+=AREATEX_SUBTEX_SIZE*offset;return texture2D(areaTexture,texCoord).rg;}vec2 calculateDiagWeights(const in vec2 texCoord,const in vec2 e,const in vec4 subsampleIndices){vec2 weights=vec2(0.0);vec4 d;vec2 end;if(e.r>0.0){d.xz=searchDiag1(texCoord,vec2(-1.0,1.0),end);d.x+=float(end.y>0.9);}else{d.xz=vec2(0.0);}d.yw=searchDiag1(texCoord,vec2(1.0,-1.0),end);if(d.x+d.y>2.0){vec4 coords=vec4(-d.x+0.25,d.x,d.y,-d.y-0.25)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.xy=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).rg;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).rg;c.yxwz=decodeDiagBilinearAccess(c.xyzw);vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.z);}d.xz=searchDiag2(texCoord,vec2(-1.0,-1.0),end);if(sampleLevelZeroOffset(inputBuffer,texCoord,vec2(1,0)).r>0.0){d.yw=searchDiag2(texCoord,vec2(1.0),end);d.y+=float(end.y>0.9);}else{d.yw=vec2(0.0);}if(d.x+d.y>2.0){vec4 coords=vec4(-d.x,-d.x,d.y,d.y)*texelSize.xyxy+texCoord.xyxy;vec4 c;c.x=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(-1,0)).g;c.y=sampleLevelZeroOffset(inputBuffer,coords.xy,vec2(0,-1)).r;c.zw=sampleLevelZeroOffset(inputBuffer,coords.zw,vec2(1,0)).gr;vec2 cc=vec2(2.0)*c.xz+c.yw;movec(bvec2(step(0.9,d.zw)),cc,vec2(0.0));weights+=areaDiag(d.xy,cc,subsampleIndices.w).gr;}return weights;}float searchLength(const in vec2 e,const in float offset){vec2 scale=SEARCHTEX_SIZE*vec2(0.5,-1.0);vec2 bias=SEARCHTEX_SIZE*vec2(offset,1.0);scale+=vec2(-1.0,1.0);bias+=vec2(0.5,-0.5);scale*=1.0/SEARCHTEX_PACKED_SIZE;bias*=1.0/SEARCHTEX_PACKED_SIZE;return texture2D(searchTexture,scale*e+bias).r;}float searchXLeft(in vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x>end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(-2.0,0.0)*texelSize+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.0)+3.25;return texelSize.x*offset+texCoord.x;}float searchXRight(vec2 texCoord,const in float end){vec2 e=vec2(0.0,1.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.x<end&&e.g>0.8281&&e.r==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(2.0,0.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e,0.5)+3.25;return-texelSize.x*offset+texCoord.x;}float searchYUp(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;++i){if(!(texCoord.y>end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=-vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.0)+3.25;return texelSize.y*offset+texCoord.y;}float searchYDown(vec2 texCoord,const in float end){vec2 e=vec2(1.0,0.0);for(int i=0;i<MAX_SEARCH_STEPS_INT;i++){if(!(texCoord.y<end&&e.r>0.8281&&e.g==0.0)){break;}e=texture2D(inputBuffer,texCoord).rg;texCoord=vec2(0.0,2.0)*texelSize.xy+texCoord;}float offset=-(255.0/127.0)*searchLength(e.gr,0.5)+3.25;return-texelSize.y*offset+texCoord.y;}vec2 area(const in vec2 dist,const in float e1,const in float e2,const in float offset){vec2 texCoord=vec2(AREATEX_MAX_DISTANCE)*round(4.0*vec2(e1,e2))+dist;texCoord=AREATEX_PIXEL_SIZE*texCoord+0.5*AREATEX_PIXEL_SIZE;texCoord.y=AREATEX_SUBTEX_SIZE*offset+texCoord.y;return texture2D(areaTexture,texCoord).rg;}void detectHorizontalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,1)).r;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).r;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(0,-2)).r;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,-2)).r;weights*=clamp(factor,0.0,1.0);
#endif
}void detectVerticalCornerPattern(inout vec2 weights,const in vec4 texCoord,const in vec2 d){
#if !defined(DISABLE_CORNER_DETECTION)
vec2 leftRight=step(d.xy,d.yx);vec2 rounding=(1.0-CORNER_ROUNDING_NORM)*leftRight;rounding/=leftRight.x+leftRight.y;vec2 factor=vec2(1.0);factor.x-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(1,0)).g;factor.x-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(1,1)).g;factor.y-=rounding.x*sampleLevelZeroOffset(inputBuffer,texCoord.xy,vec2(-2,0)).g;factor.y-=rounding.y*sampleLevelZeroOffset(inputBuffer,texCoord.zw,vec2(-2,1)).g;weights*=clamp(factor,0.0,1.0);
#endif
}void main(){vec4 weights=vec4(0.0);vec4 subsampleIndices=vec4(0.0);vec2 e=texture2D(inputBuffer,vUv).rg;if(e.g>0.0){
#if !defined(DISABLE_DIAG_DETECTION)
weights.rg=calculateDiagWeights(vUv,e,subsampleIndices);if(weights.r==-weights.g){
#endif
vec2 d;vec3 coords;coords.x=searchXLeft(vOffset[0].xy,vOffset[2].x);coords.y=vOffset[1].y;d.x=coords.x;float e1=texture2D(inputBuffer,coords.xy).r;coords.z=searchXRight(vOffset[0].zw,vOffset[2].y);d.y=coords.z;d=round(resolution.xx*d+-vPixCoord.xx);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.zy,vec2(1,0)).r;weights.rg=area(sqrtD,e1,e2,subsampleIndices.y);coords.y=vUv.y;detectHorizontalCornerPattern(weights.rg,coords.xyzy,d);
#if !defined(DISABLE_DIAG_DETECTION)
}else{e.r=0.0;}
#endif
}if(e.r>0.0){vec2 d;vec3 coords;coords.y=searchYUp(vOffset[1].xy,vOffset[2].z);coords.x=vOffset[0].x;d.x=coords.y;float e1=texture2D(inputBuffer,coords.xy).g;coords.z=searchYDown(vOffset[1].zw,vOffset[2].w);d.y=coords.z;d=round(resolution.yy*d-vPixCoord.yy);vec2 sqrtD=sqrt(abs(d));float e2=sampleLevelZeroOffset(inputBuffer,coords.xz,vec2(0,1)).g;weights.ba=area(sqrtD,e1,e2,subsampleIndices.x);coords.x=vUv.x;detectVerticalCornerPattern(weights.ba,coords.xyxz,d);}gl_FragColor=weights;}`,smaa_weights_default2="uniform vec2 texelSize;uniform vec2 resolution;varying vec2 vUv;varying vec4 vOffset[3];varying vec2 vPixCoord;void main(){vUv=position.xy*0.5+0.5;vPixCoord=vUv*resolution;vOffset[0]=vUv.xyxy+texelSize.xyxy*vec4(-0.25,-0.125,1.25,-0.125);vOffset[1]=vUv.xyxy+texelSize.xyxy*vec4(-0.125,-0.25,-0.125,1.25);vOffset[2]=vec4(vOffset[0].xz,vOffset[1].yw)+vec4(-2.0,2.0,-2.0,2.0)*texelSize.xxyy*MAX_SEARCH_STEPS_FLOAT;gl_Position=vec4(position.xy,1.0,1.0);}",SMAAWeightsMaterial=class extends ShaderMaterial{constructor(rr=new Vector2,er=new Vector2){super({name:"SMAAWeightsMaterial",defines:{MAX_SEARCH_STEPS_INT:"16",MAX_SEARCH_STEPS_FLOAT:"16.0",MAX_SEARCH_STEPS_DIAG_INT:"8",MAX_SEARCH_STEPS_DIAG_FLOAT:"8.0",CORNER_ROUNDING:"25",CORNER_ROUNDING_NORM:"0.25",AREATEX_MAX_DISTANCE:"16.0",AREATEX_MAX_DISTANCE_DIAG:"20.0",AREATEX_PIXEL_SIZE:"(1.0 / vec2(160.0, 560.0))",AREATEX_SUBTEX_SIZE:"(1.0 / 7.0)",SEARCHTEX_SIZE:"vec2(66.0, 33.0)",SEARCHTEX_PACKED_SIZE:"vec2(64.0, 16.0)"},uniforms:{inputBuffer:new Uniform(null),searchTexture:new Uniform(null),areaTexture:new Uniform(null),resolution:new Uniform(er),texelSize:new Uniform(rr)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:smaa_weights_default,vertexShader:smaa_weights_default2})}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}get searchTexture(){return this.uniforms.searchTexture.value}set searchTexture(rr){this.uniforms.searchTexture.value=rr}get areaTexture(){return this.uniforms.areaTexture.value}set areaTexture(rr){this.uniforms.areaTexture.value=rr}setLookupTextures(rr,er){this.searchTexture=rr,this.areaTexture=er}get orthogonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_INT)}set orthogonalSearchSteps(rr){const er=Math.min(Math.max(rr,0),112);this.defines.MAX_SEARCH_STEPS_INT=er.toFixed("0"),this.defines.MAX_SEARCH_STEPS_FLOAT=er.toFixed("1"),this.needsUpdate=!0}setOrthogonalSearchSteps(rr){this.orthogonalSearchSteps=rr}get diagonalSearchSteps(){return Number(this.defines.MAX_SEARCH_STEPS_DIAG_INT)}set diagonalSearchSteps(rr){const er=Math.min(Math.max(rr,0),20);this.defines.MAX_SEARCH_STEPS_DIAG_INT=er.toFixed("0"),this.defines.MAX_SEARCH_STEPS_DIAG_FLOAT=er.toFixed("1"),this.needsUpdate=!0}setDiagonalSearchSteps(rr){this.diagonalSearchSteps=rr}get diagonalDetection(){return this.defines.DISABLE_DIAG_DETECTION===void 0}set diagonalDetection(rr){rr?delete this.defines.DISABLE_DIAG_DETECTION:this.defines.DISABLE_DIAG_DETECTION="1",this.needsUpdate=!0}isDiagonalDetectionEnabled(){return this.diagonalDetection}setDiagonalDetectionEnabled(rr){this.diagonalDetection=rr}get cornerRounding(){return Number(this.defines.CORNER_ROUNDING)}set cornerRounding(rr){const er=Math.min(Math.max(rr,0),100);this.defines.CORNER_ROUNDING=er.toFixed("4"),this.defines.CORNER_ROUNDING_NORM=(er/100).toFixed("4"),this.needsUpdate=!0}setCornerRounding(rr){this.cornerRounding=rr}get cornerDetection(){return this.defines.DISABLE_CORNER_DETECTION===void 0}set cornerDetection(rr){rr?delete this.defines.DISABLE_CORNER_DETECTION:this.defines.DISABLE_CORNER_DETECTION="1",this.needsUpdate=!0}isCornerRoundingEnabled(){return this.cornerDetection}setCornerRoundingEnabled(rr){this.cornerDetection=rr}setSize(rr,er){const tr=this.uniforms;tr.texelSize.value.set(1/rr,1/er),tr.resolution.value.set(rr,er)}},searchImageDataURL_default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAACm53kpAAAAeElEQVRYR+2XSwqAMAxEJ168ePEqwRSKhIIiuHjJqiU0gWE+1CQdApcVAMUAuARaMGCX1MIL/Ow13++9lW2s3mW9MWvsnWc/2fvGygwPAN4E8QzAA4CXAB6AHjG4JTHYI1ey3pcx6FHnEfhLDOIBKAmUBK6/ANUDTlROXAHd9EC1AAAAAElFTkSuQmCC",areaImageDataURL_default="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAYAAAABNmBHAAAgAElEQVR4Xuy9CbhlV1ktOvbpq09DkiIkUBI6kxASIH0DlAQiIK1wRfSJTx+i4JX7vKIigs8HXpXvqVcvrcC9agQ7IDTSSWgqCQQliDRBJKkkhDSkqVPNqVOnP+8b//rH3P+eZ+199tlznVTlvVrft7+1T7OaueZY42/m37QALKNk2wHg1pITlB17mC+Pp11W3X/LHyT32vhg48/5SOv+PnwpsHA70JoGlueB1iKApeqzvOzn44GatTB76Xzhd7suBR7+WWADgDEAwwCG/L54b/poDLrHuvvm70Z2Avhsc+PVcxscBU8F8C8ADg5+ipIjD/PlGwfgju8B924E5seARUfLsiNmqQW0IjL8+7L2NYD/7COBzfcCm+aB8SVgdAkYIRCXKyDax4EdAanL5PuNPllNvXDlAHwFgP8AcC2AhRIoDXbsYb48dl5WkVFTE3LGDcC9m4CZCWBuFFgeAZaGAYJQQCRqDHT+McJrVb8zwATUXH02MHYfMHEIGFsAxgjApQqACYQORjtd/B7Axt/z79sC0+cMPgjjlwPwVwHcA+DfAHzTxcVgWBroqMN8+cYBeM71wH0TwKExYHYUWCIAHYRLTlkCYgcIBcAgU/n3qy8GRu4HRgnAOWBkERhddPAJhGJDBxkvw7cqimr+zFM/ZLnZF64cgL8BYD+AWwB8x/dlWuWagHiYL984AJ/0RWBy1AE4AizyM1yxYAcTigW55xMbAkxEiwEdkJ/ZCQxPAiOHgBECcKEC4TBZcKkSv+mTieNcNPNC26mLNsj45QD8LQDTAO4GcJt/7iw2bfoG4WG+vAGwm9ExiEg69zpg/wgwPQLMjgALzn4E4aIzoJjQ9g4024uygkj+pyuAoX0VAIfngOH5NgCHMhAm8Sv2y3XDZeBhNIp8OzJE8OsBzAKYBHAXgDt8/4O+MVT0j4f58o0D8Pxrgf3DwMwIMEPQEYRkNwfgsuuDZLskip0No0gWMD/9HGDoADAkAC4Aw/wsAgZAgs2Z0ABI0GU6IVmKv+f28KDnHxkA/G0A8y6G73N9kOCjXnh/Ebb6OvgwX75xAF5wLTA1VIHPADgMLDj4yIA5AAm6aCUnv4oz46eeDwxNAUMzwJAz4BABSNDFTwSfg7DDKHE23MG5PqIY8A1u/dINs9dBdy8AgnGPM2NfUBrsnw7z5RsH4IXXAAcJviFgluAbygBINnSLWOAjGxJ4pgOKDV0v/OSLKp8iGXBovhLBBOCQM2ACoTOhnYrAdItYbCij5JFzRyIAqRccAnDAQUjg6UNQ7hsMXP0cRQAexss3DsCLCECCLwCQzMcPwUi2MwAScAKbfnY/YRLFQ8DHX+IAJAMSfDkAF13kLvleIjhjQQHxUVS3jjgGpKeeNzYVQEjgUS8k+PghONdhIwAP4+XXBYCHKIJbwJyDTgaIAdCBJx3Q2M8tYAHP9m4df/ylQOsQ0JqtRLCx30K1wtLBggScQOgsKBGcWHAJeOwRC0BSM1mQIKRbhh+Bj98JQP6t4U0APEyXXxcAEnxkQAFwoVUxID9kvQg+c1C7vidRbIDkc24B//hTQGumDcCWA5DgMxASdNIFBUI5pCML8v8API5zfEQx4BudgqiczviSnJhQwCP4BMCGl+wO8+U7AJi/W4O4YS6+pmK/2ciADsAOBhTIIiAJnPB7AvNjP+0AnANaYkAHX2JBAc+tYaJXOqBZv24Vc386XW5dtkHGW+4HFAJonpOe+YYQZAShgKjv3PNvPQaxVoI8zJdfFwASfPzMUwS3Kt1v0UFIlos6oDFdAGFcliMAP/ryAEAGNwQRnDOgLbdlIEwrIs6AZ/QgkMMHQF6ZAKQcJAsSYPwIeAIk9wJgoPK1gi7+PwF4GC/fOAAvIQPSs0URTPBJ/Pp3GSEGRHfBCIQ0xowBtUbcAj7ys5X4Jfu1HIAGQrIgQRXEsAFQIORDFhiDY/rMHmrU4QUgR08AkgUjCAW6CD6CkwBsAIQC4GG6fPMA3OXiNzCg2I9gNCMksmAAoemDzoimFwL48M85AKkiuQVMAAp8CYRRDAt8GQiJ67N6GJODAXAHlsGguscA2AJg1IPGYmxOpBxFWkRN9LsATgIwXnNs/v/5z/9XCf8BO3YAtxbc/46/KDt+5+ea1Yku2VUxHz/z0v24FwMGK1gWsK2OUUxHHdCBeRUB6OxHABr4ZICIBd0QWSF+XRdMTAjgCdTrG9cBNwE4F8CpDkICyYLGsuhFt6zs+gISwUen8zEAjgMw4cfx2H6O/90yAFo84Cbg4ID3/9TfLTt+5+ebnRABkODjx0SwPi5ec/FrYpmqSAxM8Dn60CsqAFI6GfhqAMiDE/gokmvEr0C4PgDkBQm40wE8zMFEUDKEVoxIMLl/KS73mE7H9d+vcKHQQcjwW0Yu9nP8m8sAmOIBuWY6wP2/4s0ezjjg8TuvaR6ABJ70vxUApGrm7EbGE+i472BAB+WHfqHS/eoAaEwY2E9+wLSXTqhI7CXgnB6LCoOJ4BiST+hTnG0HcCwAglCx3ARoZEVFXnBPp/O/A/hXACc7CPs9/i1lAOyIB+RDX+P9/+pbQjjjAMfv/PL6AFDs1wFAgs/9fgKfgdE/ZEpuiQlbwAde6QAMBgiRmsSwA9BY0JfjovGRDBMH4TlcXGhcBOc6HkF0gjPhZgchxTLZMAci/04W/B6Ab3t09EPXcPyflgFwRTwgJ2MN9/8bf5qFM67x+B/aW4XQz42FeL0YrRyikztUFw0704mf9kXgxhOAqc3AAsPyRxxQCs/PdXOFY0W1KHy3QIUGtx+6vdnx1vsB+dsTncm2AogglFgVEAlUWrOMB2RyEmMCGQ/Y7/HvKns6tfGAnJQ+r/9b76oJZ1zD8WdyQjYBh8aBhVEHjELouQ8ukQ7VRSCJAALwkr+sALhnGzDD3JAJYJHg9uhoi4bx8ytkWUtvHT/7+Zc4dw1uZ3612fH2dkQf7yxIEEockwkJQn4IQoq8unhAhmPRKKFx0uv4K8ueTs94wD7u//VX9ghn7OP4c+4G7h8HpseB+dF2AKlFLwuAIZ8jD6NPrOhAffmfA9/ZBuzZCkyRWSeqBCWyoYGQ5yQrBpDbum/ME1HoPo0XEkSD2zlfbna8q6+EUJcTCxKEtHL5EQjP6BEPyIgYAZBvYt3xHyx7OqvGA65y/7/9wVXCGVc5/sl7qxD66dEqiYgRzAqhN1A4CBNAAlDyAFI+iZ9/N3DLJuC+jcDUBmCWyUnOrmTYCMIOkNclLg0B8/RsNLg9+UvNjnd1APLmmQpFHyEBROuWACQT8nN+H/GAvY7/VNnT6SsesMf13/CpahGnZzhjj+PPmwX2MYdDIfQexWyBAwEUOQDrRDN/98p3A7dvAO6fAA5sqHJDBEAyoUVGkwEd6HR12XU4kwzfl6fCXTZzjy57vvnR513X7Hj7AyDvggAUi9EyFgiZqNxPQF6345nOWbD1HQ/Y5fpvuLa/2+82/vNHgAPDFQDnhoF5j2C2qBWCI8bw1eRw5CL5l94L3DEOTI4DB8Y9OWmsEu/zBJ3rgsaybqBob/7A4C7jtWcooRrczr+u2fH2D0AOQgAUCxKEP7aGgLy64+m6KdjWFA9Yc/03/Osa4glrjr+AupqHz1sEs0cxG0BC9HIePLoit9eNkVf9L+DuUWByDJgaq4ybGYLPAWgiXmLedUE7dwC7saL7CqfPKXi4NYdaykCD410bAHlDEsNiwZ9wAPYbkJcfz6T2gm3N8YDZ9d/wHxUA+739fPwXPrSKYGb+BuP3jAFDElFH9HIWwbzCIGkBr/or4J4RYO8oMOW6ZVcAuvi1Cgoha04BCwT5gfMKHm7NoRde2+x41w5A3hQZkADk5+cGiAeMx3+/7AENFA8Yrv/G71cAXFM4Yzj+otOAaQLQA0gZxaIIZtMDFTigKJV8H9Iq6aZ59ZXAvSPAvpEKgBTtBODcSCWCZeRYtpzrmLyeGNCAyFl1v+Hei8qeb370Rdc2O97BAMi7EgB/2QG41nhAHU9LuWAbOB7Qr//GPRUA13r7Gv9FZwIMoVcEswEwfDoimEP0shKKtIphaZQAXv1+YM+wA3DEdcvRKkGJADQQEsQuhi1Tjt95vBsh5nx2IO59SsHDrTmUOStNjndwAAqEry0IyCMICkOyiuIBNwBvPFQQT7gBuPjc9oRYAIHyOEL4vIFEYVNaOou5vCGE/tV/A0wOVcnpzI47NOri3QFIBpSeaSDUdYLOSWvYImSGgftpJDa4MWJbAGxivGUA5MAOc0Be6eVLj7/4Mk+hzCOYPYpZDBiNkLh+G/M3yFyv/ltgL3W3YQfgcFUhgRY2PwY+Z7/EhAR1SFyXCOb57r28QfQBsJQBMn5D4y0HYLPje9Cd7RIC0PM3EiMofF4gVCBp1P840ix/gyz56r+vAMjk9Gl375iB4+CzveuZdLkkEPJ8ZEfX/6R73vOjzT5Si9hucLxHAVg4PwJgRwh9CKOXK8YA4ZEqKZXSQWh5P+5AftXfA/uGKvYjCKn72cctbFrZNECka5L5CPwIPtMH3TVz17MLB5gdLgA2Nd6jACycHwLQxFEUSR5ASvARDB0h9AQb9bXIgCGk6lUfAPYTgEPAITKgg1BObk58srTJgG58WMkWMaAbQQT1nc8rHGANAJsc71EAFs4PAagQestgC1lsBJ4BMCSOK6dDUcwqqaFiQr/0QeAAAdjy+jBiQQeeMSBZT3nCPUDIa9z+/MIB1gCwyfEeBWDh/BCAeQSzgkjFfGLBBD5nxQ4DxN0wv3hVxX5TBGDwL5obxvVA5YqYL5BeMLd66YYxJpRB0gK+96LCAdYAsMnxHgVg4fwIgMrhUPKQ2C+Bz0PmBTqBMQehAbDlIjj4F80KJguSVZ0FuXpjoCOgXawLjALhbT9eOMAuAGxqvEcBWDg/l1IE05Ed0ygZnyHdz0VwCqEPIfNyx0QQvvLDFQCp+8nfZk5und8tXwIgWcHSNX0N2CJmnAl3v6RwgNnhl17T7HiPArBwfghAS7mV/hey2JS9FvM3BLpUUi1YwDRMXvkRYJoAlAh2l0dcZ04s6JUTDIjyBcrl4yDc/dLCAdYAsMnxHgVg4fxwKVwJgGEJNmWtxpQMpX9on2eRhVA+O56AjMfnP+e3Xvf3NwG4xIPTleiY55bpGh6UbafNU0l0z0p+5Jh5HqYJ6b51nP6XP8cx12XNHQVgIQB/bFPVg2OC7Q+WgVFWng/FvtWLI06uWh5oguKEcXVS/9sEAF//VGD7t4ETDgJbF4CNi8CGZWBs2fPL/H6Vwp2KEtVk4fJ+v/EIYPN9wKa5qu+IncfPwXHVZe/aOL3EbwS7xv8A1rQvnO0j8PArTgTGZ4BxFv9mIxhOCGsv+0OPYDRghcLfkWkEuq0+G00x4OtfDGz+d2DbHmDLjL8si8AYP/7CGIAiEEMTG92zXqSbH+d9R2aA0XnvO+JjthiIrOVDHHPOkBrzUQAWAPsZp3oPDpa/Xag6EVkLBK+5rAnJC3/nYk/APD704WiEAV8OTHwX2LQH2DgFbJgFNrBhjd8r79deGoEwsllgNBOzy8CdjweG9wBj08AIAci2D6HafmyAk4/Z7SJ72hGYRwFYAMDLTwOGp4FRFgD3HhzqRGQiyeurqOdG6r0Rm8IEZjzRlkiqCWoEgK8Axm4BJu4HJhyAbFhDxmbDGnZO4j0SgLGDkpibgEq66TJw/1nA0F5gdLpq+zDqFfd5LMeWqu5HNST0uJOIllg+qgMWgI+HPv0xwLA3gWHpW2sC441gCECbmKziaGrnUdMO4aHeh6MxAP4SMHI7ML4HGD8AjHvHJGNAgpDgY/ck3stipRemvVhc+uASMPUEYGh/9dIRgGx8Y+MNbR/00uVtH0wEx94j/v0oAxaA8Ed+GBieAYZZg5kADC0QWGOFzGJlcGPzl1BxNLXD8sk4xftwNAbA/wwM3wGMUmxOOQBnHXzetIYvibonmSiuYTNjriVg7glAiwBk0fNZH6+PmX9P6kfNmCXGpftJ7TgKwBIAnln14BAAYxMYm5C6RjCyCoOyr0qkD/c+HI0B8DXA8N3AyCQwesD1VQKH7EcASm1Q+y4CkN9pUKiVF5nLvy+fBbTUd8QBaH1HvNBROiZvfsNnrF4kcvPwpdsBLBeU18Nf7AB23Dp4ecHC8oBgUlJJecLS+7+WOpE3gbE+HKw+yoevCYkMGKqPJrdEKARutaFYRs1fiEZ0wP8CDN8LDO8FRqYq3W10pgKgfYLaYCzootgA6KXaTA90y374TKB1sBozy77xHFZ536utRgAmEaw6g5kUSFZwSXnA330qsOlfgHMPDlZesLA8IOjoLypPWHj/11EnCiVwkz7kAExtsGraYUWdSDX5TmsagL8KDBGA7Bd30JsW0oWivnEOQNP7yGTSBR101AlZSUtGyfgZDkCWY1HnJdcBVe6325hTvelg2CQjZNDygG/2An0j1wKnL6y9vGBheUC8prQ8YeH9X39OVQSc7Mc6fCaKvAeHdCIVf4yMYCynTpX+nb97NJmlSQb8r8DQHm9YOFUZTKOzoXGhs6AxF0HIexcLBvWBuiHN8s2ne98R3qc6L4Vyb2oBVjfm9MIFHbjDCh6kPOBbQoG+oW8CO5bWVl6wsDwgfr20PGHh/X/1iaEIuDcCTIW/1Q4rFv8OnYiW3c+W2iKwUjKbyjQNwL1uuR6sAEgDgq1brXOmV81PxhNB6DUDBSYzQJwFtz623XcktX1Q1VWKaTF/zZhVazBVYA1tX5MazsGvobwe/jQr0Ne6BTh5uf/ygoXlAfG60vKEhff/rSe1i4DnTWDUACY1guFTDqLYdCBvf6DJYSMYATBfOx1kLfj1v1axH10nQ3Sd0GUkBnTfpemtBJgseIKQAHLQcVxa2TnuMW0Aqui5es8xBIegVdVVE8VhzHnLh65WMB9An+X18K6aAn2tO4ETl6vqbKuVFywsDwhevqg8YeH93/Rk70JE90nowxZbIJjvS3WYNSGUwGHJTpPxwwcbBuBrgRYBeKACn7VtpdUu/c0NJxO9BIxcKu4TTODzbkonPLoaL0vyUQRb2y8HsL1ckfWzMeuFi40Qezqi+yiPhyt7FOjr6/gCFwgP7Xb5vssTFt7/nQRg6MGRWmDRoeyTlpgw68GRTwgZgo1gGmXAX6/8dtaylSKY/koyID9BhzML3q1gAos2AcOrZYSoq/pJp1VtODRm9Z3LS/7WjVkvXOzEtOpKyGrlAT+4SoG+VY8vBGCvy/dVnrDw/vee65NBJiAjBIVcAJQjOm+DkCZEeiGAMw6sAwDZsJrAdhFM9rPGhd4904Co5oVuCZPV6kD40Ec6+9W8dBTBsfdc3nkpvnB82fp2RPcs79dHgb51LA9ofsDV6vut5/3PnxcAmLVBiDqgevDaJLkYrpuQxzcNwN8AWgIgRbB8loEBzXDwl4cGiDGft58SCOWGedgjvOJ+bPvgRkiuA+ZjzhnQQOiFNVbloa7l/fos0LdO5QENgEXlCfs8Qbf7HyMA3QVjYihYhLENgjX9y/qwxQmRU/asfd0ZcLU2CHVGyusJQLKfVi98CS12T5f7iECkHpsMkAhCF8+nshWH2I/jXsOYO144GV/9ApAIrS3vt4YCfetQHtAA2G+/4PW4/2PPbzMgmUMi2NoeSCRxIt2/FvuxWURIWCXg357gfTjEDNIHnTRXRCpH5ugKwGl3HpMBXQc0v6WLYVm/5limj04rG762K2uYY9jBkr9+rI03NL5ZbczS/dJ+LQyoga4o77fGAn0NlwdMAOy3vl/T938KAcj121z8Bn+Y9eWQJRz8Y6kNagDh2ey5EvxjxQD8TWdAuneCCO4An1vw5vdzQMmdktwq7pLZQR+dM34+ZumAxvY1Y04uqOAJ6FsExzeto7zfAAX6GiwPaLWR1lrfr8n7f/Rl3QGzmsis+/uO71V9OFgP2gpPhgr7TGRqRUT6dyvr4aIs/pm/2zVUNbBSv6G8e5pEv0Cvec7Po7+bTtjlBRlkvAMBkDeQyvsNWKCvofKACYBrre/X1P0/oWEAnnFD1YdjhtXxR73mX10FfCHHE9pVWcGAI/S0gKsfA2y+twrFZw6Hxf/F0Pk8Ri/kpGSnMuDx5T0iACgQHioo0NdAecBUHW6QdsV2/cL7v/Cyqr5gnc42CCOcfX1VIZ/V8We9IDmTzVXwPDJiXuKXPxtDBma8+lzP4WAgKkPxCUAPE4v5GzEuMX0PYJPLhB6FJsc7MAMmkVxaYC/K9gG+F1++8AQ7Gwbgk78I7GFpXgIwFiRXOwaJZPUbiR0yCUDRk+cHf+YpwMj9HgfI8ClGPyvsSiH0WSKRuYlitLb/zHM/JOSs5C/YIC9cMQDZr/dwxgOW9gtGYUBi0wA8l304vDQvAchilFbpIBQhZ7Ejq6ZQ0/Yhil8y4j89Axie9DAsD6FX9HOK3QtROTFkviN83kG4felIY8DCeLrSeMDSfsEovAECUFsTjHD+tcB+tkFgcXKvBRir7qtFl9owmO4Xy/1G3bAFfPrZHorFNWBFwHjQAFctIghj2kBarw06If/+MM9ZqTN6DgsDojCerjQesLRfMApvoGkAWh8Ob/tgAPSKWCp8ngNQtadjmTdltvNvn3peFYhgQQgh+iUmEaUAUoXM1yRLmWuFLaE9Z+XIAWBhPF1pPGBpv2AU3kDTALzwmqo6qtVh9kJErAudABia38TC5wJgS2xIhAwBn3yhByL4EhzXfRXxYsDTJ4IvrNN2JFMxZcBzVo4cABbG05XGA5b2C0bhDTQNQLZBYH1AVsQSAAU+imI1obHyblnjG/kJk3U8BHz8xVUQAhnQIl5CyNgKAGp5LKSSCoAySh5Jj79vTagcxUaIBeRNe79g9gq+DXig4wGzy+PONfT7RWFA4noAkGXZVAhcBckJQgNgrLiaNb3paIDo1vHHX+oA9LQBi4DxJcOUPJUnTgU2NJUyROs8irGARxQAC+PpCtsFd40H/AEf0gMQkLgeACT41PiGoLOKqyrJq3K/Ya9mNyr5FusN/uPLPIeDa8Bc+w3rtyl4VFHaMZc3i9RWBM9jjzgAFsbTFbYLRmm/YBTeQNMAtD4cBKDXBTQGdAB2MGBo8SCLmEuS1AFVAJ3A/NhPt0PoCcA8bSDG76XI7aySg6JYuGfKwJHFgH0E5B3ueMCe/Y4L+xVHAOZ+9EHcEgQgwbeiEYx6jwTdz4qfu7EhEJqxGqruf/RnHIAEnxgwBM0aC8aUAYWNBRCmoIll4HTqO122QcZbrgMWxtMVtgvuOx6wa7/jwhtoGoDWh4MBJ16WN4lfr8AqI0TVV1O1fa9BbQzovkAy4Ed+NgCQUSxZCFWvCOaOFREXyUwZOPIA2GdA3uGOB6wPaOz+QPv5S+MA3OXiN9aclghW+d3IgupBF2pPqxcxGenDPxfSRh2ASiKKiVP2PaZScvAKoA0VDc6cOlIB2GdA3uGOB1zR77iwX/F6AFB9ONSOQW0frA50sILVcckWJyIDSgwPAVcJgFbYuZ3FJvAlEHbJ3IsgJLGedeBIA+AAAXmHOx6wo99xYb/i9QKg2iAIfDJEJHqj4SExbEty0gkdhB/6P9oZbBZIGiKYVb9GKaN50lRHBLOvhDxh/5EKwDUG5B3ueMB2QGM/grb7/6wHAPNGMAY+GSGUjC52VX2f2CD4+HO0gqkZfegXKgBaHkcWtS0AWii9xG1ImrLlN5XR8L8fmQD05BVrmEENmpYSP9QX+KHiqj2/82+HqqDWwnbBRfGATdzAegGwru2DpRq7Mzq2fpAf0Nq0Rl2wBXzglZ4yUAPAmDSVWDBPHQjLcgTqOZ6zUvdKHh4ruDCerox/Dnu7YqwXAC1NI/QcEQuK6WK/kdgCTGC0PYAP/KIDMBgglq+hIkrOfsaCviLSofcJgJ5AdM7kkSaCj/HqQKVIGvD4swF8bcBjmzjsaQ2H5D/6acBd9wALB4DFWWB5AVherMp4GKIYEOp7+26UF0aSfT/xYuDG7wDjrIpAERytXf2vajj7ueryQXSFl10K/ON3gIWDwCLvjfGB8Z54O+Ee4ve6513uB2R1yzsqC+twbC8HcNVhfAeaBuDP/TvwtS3A/ePAIfYFVlPq2HHTuyulZCTlhbjhETF5yxTQGgPGhoHhIWC4VSXGD3n0tLkMHXHxu+YyB+MlPwDuZs5K6FlsbCzdVO9DuKfkHM8AEkP7B8fOkwDcD+B7np42+JkGOvKdAL4E4K8P0zvQdET0b14D3DgB3D0B7B8HZka9WzrD88N6sFm+YcUjrn7E1ZDvMtF9DBgeAYaHgSGB0PNHCD4BLwLRsByAyX/ij0/dDUxuqlIG5hix7eFhvLcOVUAtyPSydAFmOQNe6EYGV/9ZESiKgIEgtbaD/gHALQC4ovY5r5KwtjOU/XfTAHzzLuCmIeDuMWDvKHBwpMoN0WQzNtAaYSs0K4ZlOSAjGG9kPjCBRwZ0ABKEBJexYAZEAU3A7Oi1BeDym4EDnjQ1TwCGWMW8MXcKks0YOyZNlQOQjcgYIUHllEzYQ0ktm+r6oz8G4F4AXwXwRd8/kO9A0wB8y65KmPxgGJgcqYJTKYpTv2CCzyddQJRDOjKivn+Deh8BF8BnwBtaCUA+YYEyAU8h+c6Az9gNHHRmrgOgmDA3jHQ+iWupCeUAvNSrA9HNwqx+muk9nJVNg/CTfrmbAPwbgK8D+PcHkIibjob5o13A3XypWsAkG1cPA9PDFQDZM1id0i1KxsWfOrKnAFXlifCFFMMRcASigOcs2MGAIfE9iWXplS6On7UbmPaUUTXQrgsVMzcRj5Folg2V5ayUA5BWYKwOxKUafnosWjcJwk+7W5F2EKvlE3xcXaNYfiCYsGkA/smuqug6hcleAnAImPbO6YwRpMgjCAVAm/yQmKTv5hNsAf/i7SyNBSl2a8Qv/4/M1yF+BZSYlNQCnnVrpbC+mToAACAASURBVJcaI7sOSEY2NpaDXLqpR+vE/OVksDgImgGgghHoYJbTWc7oJtFWc65/cg2AYvh2ALsB3AzgVv95nS/f4QdsIkT9T3cBrGtITWZfC5hqtQHInsEGQn3UDDvEDEY/ICf7SxMOrAg8T+c00JGkvHGd2DABUYZIAONzCUDppCFhSukCBsLQrFtZe/IixYQpSyEoJoqnuPWrVRAubQh83HNlZB23z7j1ywmj6CIIqUPxw2Xeu9bx2jx10wz4Z7sqTYZaDD8EIDuoE3hMVEphWg66JIp90k0sBxBcy+iPIIaT1RtEsHS/yIAqw+VSNPWQfe5tlVEk8auXgVa5BUsEJuT5uoliAbE5AGotmIAjCPnR9xDG3TQernYAUupTdBGEFMf83OkApHG+XlvTAPwfuyrgSZOhas3u6cwTsUBVn2gTwyFMi8wjHZAA1M9fYGHDULJD1m8Cpa8fRxDad+l+Ykf/3XNvd11U+qiL39SxXevSsshdDFvgbI1O2AwAtRZMZzTBRuDFjxe1Xg8QEIB8yyj5yYIUxfQIkfkIRnmHCM712JoG4FsdgHHp3ACoMH2G6jM4lWzoQarSvwQ6MSB/vporVaFkh+mCLlpVR8Z+dqDZLoDOpHSiQeAFDkBjPrlgCHgCUaFifg67H/9uYjn4Ai1vpTERTAASBaoQJBAKeNqHlL6mwPDZYAOROag/EYRkPX34MwHIvzW9rQcA+TLpI22G7EcQKlJGsYIJhC6ClUMiXfBTbFUQAej6nPS/OuAl9pOOqIc2BLzg++3VmWgIEUz82cRuCAtLIHQQm0gO52uOAb22sC3JEWgRfPpZf2sQBQIgLydPEIFGwPEj8MlF2bSbsulghLftqsCXq9HGgHysznrGgi5qzTUTFH8FLhAUn3hIJwCN0HLncw37qaF2zoYvuKNivmQIuUNc7GvWt6sHNs26twA6vhyq8NEMAHlyntFrDCcQehyaPTl+FwAbXDcmAKMRThakEk8Q8kPg8SPL0qzLBl+A9QCgR6uZGs3vfHz8TtBZvkgGQrEPBVAUg2Sij50QAOjiVKI3saADJRm7dSLYWfSFDkCem/dhZeMy9pPY5QvSDYQyUJoDIK8qMezh3wY6fSL49PcGgCAA8pScJLIgAUYQEmz8RPA17StvGoBv39W24eREiBoNQSgWNI1HBkdgxJSw1AI+dFIbgOYmkjimQ1r6XXC3rAbCHycAgytohf8vsB/r2KRaRq7zpZ+D37HMX0s3DDcCUGLYaw53MJ4YUODzusqlGCQAOQCejuxA8UULUkxIwAmMAp8Wa3qkN/R9W+sBwOhIEPjk5SLr8HeKFbTQfb77csPIMHGl/4MPbReslPhNe4+MiTpi9AFGV4nI7MfvagNQLh/pfrYnDAS8aJQ42A2w4em2cAyWQUuJVQTGWLs1uL7DG9J1RjhA+jvYk4t3KXeMqijpzrud4At9z3XtP16yGfjKZmCGooYh1tZzvv8xXPFl4PoJYC97k9FlwZWD+Azi/deMZWeP13eQCGEyoERudChIjbb3mJYwH7V0QIKuCwj/gfMj0asn2I0FXRSHXfL/iRkNgLyeVj8ccMY//J1fyxzTAXT2+xoQViKYD/1hDqLxPiYxTgSvQrphphG97tz4Slqafnj7uk1kIQDZrvWTw8B3jwEW+RLxPgSiCERdPwPR7+wCPg/gulFgfruDkOMQkFc5x84e708JAMmCuRNBXi4TIg5CGRzGiBGE/D4E/C2r2vcAYJoify62i0aJSMhB+2IHoNwu0fkcjQ85pu3ack5nIBREqneYFyWLkAXIJHESe00Cyx5QyeL6F/tyEcDcrOW2n7fX8df0mME+/vQ/PQjhoy3gzo3AISYf80MQaQx1peH9wb7v2mrtmCBkIMMejp3jIJD1MsaxaMZ8v5N/67INAsB3BAYU4JL4DSo1J15AFPAEwuQHZJzkKfUAtOHLJSOQRWndBYQvCQA01cfnNopfsaCJaD2baBn79QjSTiOEP1EcawIpkq2kegBTNgHWEpOKF8Uwq2NRFPM4AqCf46/rA2U9/uVDvurB01zvAJpiiwOl3fEeciCGF+Ij11f+QkbSfMPfIzqw57mEFZ9Dl3Ps5HXWAYByHJAJKV7N+s0cCQQhwSlfm4lGZ0KB8C/rABgZUS6ZHITBSEhCowUYAAksF7cStWREyxRwtuPpOlgw+5s9sq6OaIJIIlUgEhA1edoTgHxa9HVw5jibZNF+j/9yGQA/7pbujZ4bwv2+cWB6tFo0NzYnkxFA+cvEAo43VBoEo2e+48EMXEOmD9F6xhCE8RwZEJ80VblKvDlmzwicfqy93/o+8K8TwB2jVSgW138FrJQTXBNlnJgmrjZwanow9CBP/rL9wF0jwAGWDtFyoN9PHutnIHT05mPXz93dMGQAPniJsjiBXiTbxDZFMF9NLUPQxKR5qezz1Y6/YZDH0D6GkdAkYJIvRalAdHAMmPZoYhb6NhDWvEyf/ma737CXN7R1ZC7hUbPgcFgqt/ZZjADnM1xqEVhYBpb4CUk5UsL7jQvj///5buDrLeCOEeD+YQchYwG9VIfyg1NaZszFiCH6DkRGLze5/dgk8IMWcMCjdCiCzR8od1B8OTwvJM8JEShFut1fzMhi+eRJr6LI7hYP2M/xVLwKNoZjUTwRMAQQmYyhWGQxsSADOflZ4kukj7PhZ75bETjBpkAGahMkcrGgwhsXeCyBHBj1wmOBQwvAwqKzoFeRV8ZaerjKYAuirmPY/o9X7q5Cyr7fAvYMAftCPGAEoYlBiVtFwLjtp2U4irj7yOANbi+crHyrfCbTquJV44O0F1FrwQGIMZFqdQDyP/gGSZ8TC0ZRRsOlVzzgasd/u+zpMByLehAfCgMQCDyGZJHFCCgLZ2f8mgI5qauEcVx9e5vACTgCTwEMWr5TdIpWKJb5MvrnoocDswvAPAG4VLGg6UKeqmi4iuDz4er30oX0FP7u5moMvIf7W8B+jwlUNAzFnlZCIhvGFRCeWzrgXSSIBreXTFZSgVLHAp4UHOFuociEEsn2PJwl/XEk0dzfSojeerFg1IOo5BKAveIBex1P67lgUzgWQaJwLAKRH04i14ItgDKEtGsRnWx49b2Vkk9wUefTGrKCF7R0JxZMqxN8cmPAxWcAcxGABKEAKPA5u9lEaAbCmKMI+sDN1X3z+ro24wEZFc0VEE64ABgT180PF9ZdBcDb6JpqcPtPk+1ACbmKjJnllwyuILunEAWjZHkBsrsRUnfD0qEiC5IJfyisgMhzWhcP2O14Ro4WbASgAMQJ48SJwchmBCDFa8qpyBbSP7OvU4PQ0p2W7+LSnSJUFOrI4V7w5IoBTQQTfJ6oTSYk2mQcpGRyH2syGjIF6EM3V/fM++C1CfwUExhCsmzCaQT43lZC3e1hBpEHh36XEqrB7Scmq5dV0XZxmV8WuDFzAF9iwhow9seAGoBcGtKjqAc+1l9rLb/1igesO55ysmCrC8ei6IxRMAKTWNBi6Xw98xNTFUi0jEcmpYgRAPhddpVi9OIEPP5cYD4CcLkCooHPwaW9kV+iwWrQHT8uA1fd3F7DFvgUHUP2k8jTiogAqLoxFpDgbMj9jXSuN7i9dLIdaxzBp5XVBMIMgFEnFAPKT9qPd6A9BIGI7MfPmf4U+40HzI8nWgq2PBxL4FEkjKJixGRRFyQQPzzd1iAUzCAQas1YOmAEoFjwkecDC/PAwhKw6CxIkCXwOdVJLxTobMjBdyIgfvimNvNJ7Evf4jWtdnRYD1YNGVuG93VWuWs4Jf+mlZCCZxwP/cnJ6mXVKk2+tK8lQQVHRTGc64SDAZB3Ey3JcxyACkToJx4wHl+YwqloGDICmYmTFgMQFBET8yyYzyAG/AfWX8mCGQg0BTRoHwt9KVaPE/HQ890AIfgWK+CRAaMRYnVdxHbhdY8Wslw1V93UDsmPIj9GxgiAioRRMIJNvoti+SW/Ikd0gwAU8+XxJcbGITJPDvI6XdCFREFSknTB83xka40H1PGF9dnycCxFwygkK0bASJQSVAbAYeD98xUAe5U3jKIwBosSgNsuABYogl3/IwgFPrOIg1Xc4ZrpAsSrvruykl2ucykapkMMh4CExD5DwJfWAYAxwk4MKPAJgOIjGSEGwuCakRhemw6Yv0UUwRf7L00L9pnsNx6Qx4feY4O8pDEcixOjsoTKKpMYjSFYYjOC8Eq3Wnnr0YYS+0Tmi2HysrPGLqwASNYzBnT2Mz2QD91laxLB0gs12GAh81cf/o/OcHyJ+qj0S/zxnhUZbSyYWaL8+Rq2S29wowiWkJPan4MvgrDDGAlRe7KIywDIgR3meEDWg9HbJgApNTkXo8o0i7oVgxnEgFr8F7jEdnU5GvqfJQKQKyEOPlsNIQvyvupAGHS/Okv4qv9oh+PHxMLk8ggBCRxvAmEN+AiEzz2iQfQBeNmkh4K52hJBKOaNe/FSLobLRXCz43rQnu2yi9oMSMDxs2jo8303ERz1wsCGZECF4kd3DwEYYwJjhoNlQrgIjlYodbBPrwMAZfEmyzcIv27gs6XDzC/IR1DOgA9a6DRz4wZAsZ+LYXvQYsHoD4ziOFklna6YD3+nnU6dZ7bGDAcBUImIAmEUw/zbJ1i/scGNDJiLXmle3RhQ+l/aq57gUQCWzwwBKPeLsZ/LFrGg/ShRXAe64Ajkv30kALAjF8R11Dy3K7KRwJcsUTaqWScARou3w/INVnCH+A36n8RvM3nB5XP4oD6DATBYwGb5ajlOLOh6X8JaBKRG77+7ygGYp1bn+V25/01AzBnwQ1ypanD7KWfA1QDYC3zJIj7KgOUzc9nFbetX/r+O5biwNhyX5uSEDr5o0xsJwLp8/m4A7GaJUv/j3/5+HQFYJ3oFPPkho/hNeqBcMkcB2BAA6XrxmMBkfFAci/m0JpwzXw0TXvXtzrz+PKc/Ml/ugzM9MDqCAbz/keVjjGcQA/YLvjoguo1mRslRI6RwfsiA5nqhL5D6nscF8gfTdfxpS+/hLzvWfzMQCoB1Fq/8b3VWaPIDZqsRV64DALsZHVHs1gEvsqFAeBSApQC8pHK90Oql4UEAyvCwNeGcBXNLOPMLftgZsI75ouUr9ousp2TEyIJ/sU4AzC1e+WIFshyAHPZREVwItrrD3wGAhibTYBhxVpe/xePyrNBuWaoNp3DgFwC81O+RAepK/a5Lfe51jxr7JwA83nPXYgq1asl0yX5N48+f4VEGLATlK1vAo5YB1gBSRmsM+NFE57lcfPD5pPFWCJImtyvGgGfOAacBYO59zFglgHgPefZsXV6/gPXBYeC0RVgyJNOGYuJjPka9eHWgjL9bWzhWk0/n/wPn+k8bgFNmgYcsVflZnBRmIShtJM/m7JGibGBoOIIez9wKPP4AcNpylfbNlGfdI+9NjBjz8JVzppckZuJ+dBw4aQ44drk6j1LIY9JkPD7P4s2lwVEGLHwJnncscNIh4Nh5YMsSsHm5ndOu1BGFThJ8/K6JrZtoslST2+XHA6ftB05ZAE5crgAups5TfaL6EF+UyIif3gAcOwtsXep82eIYY9JkXpMgMp/AeZQBC2b8OduBYw8C2+aALQvARgJwGZhY7swEzbNa88IRvAVO1qkF91J36DNOBE7eD2yfB45fqphLnevzdGeBKBfL8UX5/CZgyyyweRHYsFwxYHzRNK6oetSBMDLjUQAWTPqPngpsnQK2zgKbCMAlYMMSME4ALrcnR6JYQIwsoUnjpDRstOLy7cBJB4CHUGwuAtuW2nUDVH1EFUhycSwWjGD64mZg0xywcaECoI0z5P3X5P6nWlHdgHgUgAUAfOYOYMtBYNMssHEe2LgITBCADkIzSJZXpCOnIg25uPrhgnupO/TyhwLHHwSOmwW2LVSik2pCrDsQskzNIBGIpBdGI+VfNgMb5oENCxX4yPRjPj4xaJ0+WGeEHRXBDUz2Mx4FbDoIbJypADixUAFwzAFI8KUJChMV2SUaAGc1cE/xFJef3FYRti64nkqWDrqqEhbrsm5zvZCdPCd8nHzJOLZuABRz9hTHZwPL7LnLnoNMIY2VyaKcjtZLHOAbNgNPngKe4BacfGF1pnydD+hphQ/8XV5UiEueLGnDN1tWXj/3/4cTwAUzwGPcRcFJiDpPt3FLmf5vjwE2HAQ2zPrEzDv7OQg5OSM+ScYQy5Xbo8465u/ZfLTJ7fKHAdumKxVh8wKwealSE6inEoSy2MWCdbUHIghv3AqMzwHji9VLZuDzD8cXxxWZs5c7apmW0fMBnIHKn5X7d6I5npvRz94O7LgXuGIReJSb+Xl1tzqflybwRwqf9i97BQRWomWJQ7oZVFtJoqDX/b/oGODsvcBTATB9gsfGqmzdjtVz+G+PAyamgYmZCoDjFE2anCVg1CeJwOMnTRB/DmUINVkkgia3y08BtkwDW+YqAFJFMD1VAAw6XG61R31O9/fdrcDYPDDmY0zjc1UjivBuAMx1QdMB+WAYXU8dhEU16dOSkppbcHFSrng8MHwnsGMPcN5ypURHp2xMIa7zDz2z8Gn/kVe0YomO0wEwBYKujL7v/zHA6C3AxfOVh58g5AsZxx4fZM7sf3h6BcDxWWeGBZ+cMEFiwGEHHRnDzun7ONHs/djkRgBunql0VDOSHIDU3cxSD4aEajhFXS4H4S1bgVGN0V8we7E0Fh9jVDG6Obr1LJMRwn+kOCaTEYT0dsfqZHXl/p7PrLi9wIY7gO0H2yAgCAWCWCowKrYE8nMLn/a7PQn9X7zIJPPkCcK+758y7x7guNsB6l98gZjLLYet3Ay5n0sv4R+fCYxPA2MOwLEAQLIDPyP8uBg2cRYmzFweAYilKkn+OC8/Fdh0CNhEA4nGA40kd6FES13WLO8v1qHKAfh9B+DoYjU2Ak/js/8NAIwg7OUb7LCC+WAfB4CpBJoIiTRNRmS1l13kqWh3Adv2A8cdqqp1MB+aIOSxWv6pq5D2kkIAvt8rF7BLJksN/jMqfa7v+7/Ak4B3A6ceqpasKMq5akAmlLWY37t8ZW97PDB2qALg2BxgAFwANEGcnI5JcrDZRPlkaXL4u1KJUAfAjbTQ59x6dSvdLPXAgGYshZWR6JIRaXB/NwFI8C1WwLMXzMeSwLfcXuKrA2G+wrLCDcN/IIg4ERRn0qvyySAQX6mG1XuA4fuAbTOVwktRRr2MLCoQyvEZ/UY/WwjAj3jtFJZkU79g1ghkgEBf98+0Umb/3A2M3lkBl/fOcdMok2EjkZyv8773LAfgHDDKjwNwxEUw9yailpwdxBAEYhBbAuGzG3aKkQEJwAkCkOCjlb7Y6SYyf2UwlAS+vKYnAXjfNmDEX7DEfA5CjUcsnzvbu1nDtUMmCDkRZEEyGdlAk6G6lQTSa6m0MP6HuY73AxNTlcJLZ6WOJYC5/CNxLpHMgdKIKNl69Qvu6/75AjHOiTU87gKOOViJb748BKCWrnK/maTA+58AjM0Ao7PA6Lx/xBAupoYDC9okBRAmPdBZ47lNA/DhwMRsxX7mPgl+SrmK5EaRNRslXFQ9CKB9DkADn79cZtkHFkysJ103eBbqlh97DpmTQTYgk9VNxu+xYbXKU3lhFoJPOgdFGY+lPkgQxokkgF9Xgj4AvfoFs84eX4Ke9x9fIC+tRfDxvvniif358sSir2LCj5wNjBKAc8CIi2AxxLCzIAGY9L7AhGIKgpATw4l8wToB0JjPrfTkp+SLQbHrOqm5jNyajS6VCMIpApDAWwQ4LrGgXqzIfnq5cv0vN0ZXHTInME5GBNLb1DGdOYQsI7AfGKFjlgqve8wJwG4T+fuFAFytXzCLb+VgWnH/fIGYfc46Hs7iHC8ZkPcdXx4VfVXJw8+cA4wIgM6AHSLKWZCTESfLfg7WsIyRF3ckiRQ+HACXkwHptyP4KHrpJvKVGnOhRF9eBF9wE0mUEogz2wC+WGI/vVxiQQIxAs9+rmHA6E1YFYB8DJwQMZl0OrLZ++i7sfT8zroYHLS9df4RACWKxSZvLXzG/fQLZqk2gqn2/vUCUQ9UZaM9wDaPeSPrC4A5C1KV+NITKwCS/SiCR/jRBDlLmP7nHynsxno1IPwJSyRpbiMADXzuPDYfZfBTEoAmcuVQdiaW0zwXwQsCYDYmMaDA1wG8TBSvaoR0G77EcGSET6hjOvVApfRPAUN0zjr45JzVcSqiTxD+VeGzXku/4Nr7JwDJOkxFIwt6j6+RqUrlkO4bXzp1gCAAv04AzgLDDsBhKugLFUvQUhTwCEKbnKCw14HwJ9cDgGQ9WegRgDI8XEcVEDvAl7lVlglAgi+I4CR+Zf1mLGgMmDFhBGFfDCicRJFERviSABjLS7FC0MFKMU+07wOPE0kGvaoQgGvtF9z1/iODkwn3VWoEXxres5ib9xx1wZufBAwLgAQexbAD0JiQwJOuJBA68/H3Zhk6+3CifqqwWNMKN8wjKgbk6gWJgC+FMaBb5vJVmsUbV2vCqo3cRWZcCIACoax53+ulkqNd7iqOcU1WcC9cxEm5kQBUdZ+sTnSL/jEtTWngi21jhJNJBivZBukXvOL+yYBkcOqxKjJ4AGgxzMrBVwdAMmHrZOAYF2l6y/mwV6xD17zmWo6MbRyeWtOHwxJ91IIhr6rqZS70DPPLXDVUrfBwzHKr1EUp6/h0T/6L/GcCqslt4IhoTcwdAqDSs7I60WQH6R329pHuFyuXDJmEjuOSbdB+wSvuP5bGUjmsA5XoUvcvBXKKAQnApUdXwah0b8jXR2YzJTsC0ZHB33FL+2yiX3h/1YeD1fFZGT81g/H6yqkVa9YEpqMhTADle8erHA6t7Mh6j4ZBXdBGjFyO4CSIm9wGBiBvgqxwIAJQlXIyEJLyI/i0SkAG/FbhaEr6BXfcv+5dLKhCg4z1C1HEBJ8+BODQGZXfk/quAZC6ketAZEQCTWAU8PIJt0fgwHzZvVWNaKqi7JLOmtDWFy42g1FxH/XfqGkII0C+a0tnDkfsGxQjn3VPsk7tXmuy+Xp0JhtoJosAaFcUAJUYKiYJxcqHqKAH9rPlG2cMrmCUbMX9guMLpGTcCMKDlZGhMK8IPnPIn1X5PA2AwegwEEYmDGBMjOI5whGQP3NPBT7VJlRNaKvF4t2IWHbDErtDlSk1p4lJ7/zd246tglGZryIfrFhQ7pU8WCAX0ZENG+57U14Z4YrCeLrSxXdev6TfLwrbxT7znMrfKQXfHLQCnyvmRIv0Q3430ezMmL98P393G3wqz6am1NYzzoGn+svqRmTAU2citctqAX/2EI8F9ACEmLHXLZGoFxtSl2xyK2bAYwrj6Xr12+1noL/jUTCD9vvFrn6u0v1/nvGkaoVBAQi0eummMAuXQHMWJAA7gCixG8U0gFfcXdlBKk4Z6zELgAJfZEKrxpC1xOIl/+Sk7jkcdYlSco90y9+gK6vJrRiADD0piad7RuFo3udNCgft94vCdrGXn+tujgV3QAcHLcFnroelivHkchEL8ue0uQ74S3eubAITS3IQhKkMRjBMokgWG3L//2z3VSnP4VDgQWxUEEUxAZFHL0eR3HDfm3IRbDHkBfF0zy4EIKNhSvr9goGEBdvTz/MIYQLQdVsTwRTFDj5jQmdArRDYJQNDSs961R3tPhx5NXoVgoxleHnarjohgLec3D2HI492yQNvIwvqO9fJm9zKGbAwnu6FhaP5pFuMg/b7tTbpBdvTz68cz/zI8azVj8iAHTqgmFHXDUB89R2dtaC7tUGw4kDOgFb0R2wYRDGZ8g9O8aU4XwPOczhiwGlMjqqLWiFYGu570wADFsbTvaxg8nkow7E8nM/atfKzln6/1mS4YHv6BQ4+Z0BbqHcd0NwwYbVD3+1yWhXJxPBrbq8AqE/XApSqAxiBV2MZ/54DMOZwKE00rnDUWcR5KiV/brjtSAMALIyn+/mCyeehjIYp6fdrvVELth8RAClyHXxmhPi6r1m8FM0ucgk8+y4RHC1kAK/5XgW+2hZYofafWcPq1B5AqDqEYsQ3nepR2gqhV2yiol1COkD0C+aOaoGx4aL7DQCwMJ7uVwomn4fm7VrX2u/XAlELth+5sHPtN+l/Ap6sX2dCsZ/phZkIJgv9l++1wbcq+2WFv2NXIjNKAPzuw7MUAV8DTuynFIEsQy83RgTAhiv+NgBABaQOGE/3mwWTLwAqHnaQfr9GnwUbARgDNBUlkpzQboyYCyYDYdILdf0l4NduW9kGoa4geNdazLElKoA3Prx7DofiETtC6XvE7hGEzJlpcis3Qgrj6d5UOJoYDcMglrX2+y0NPtl5UZUjkfx/Hqbecoe0OZzdF1gHQrln9Bhee4s3f3Zxm4MvAk9VSFdUIw0i+Q2PaBtISiBSSFgCYMjMW00MP7pwvvLDmwFgQTzdHxcOSGvBg/b7ZRZByWYAlOERluKM3Ra9CKWc0q73dTBhMFT4ZwIw9l5Lrpes+HjeBiGCUOKXeuBvPcKTiEIOR0f+RhDBMYi0Lhea4GTaa5NbOQAVDzhgPB1La5RssV3rIP1+7yy5OAADoAchEHBkFbKfGRpiweAPtMs5IFNokyOGk/7rAYC9OhBFwNXVY1at5tftCBHaWVS2AJdEcEinrDNC+Lumiyc1B8AB4+muLARAXTDCWvr93lR4/Z0Xt6ODFQkj8WtumEwHTKDLQejAfN3uds/dfjoQdatGLxb8jQBAYz6/boxiFgAVudzNIc2/s3xLk1szAORoB4yn+2DhaATAGJCtbpkCYq9+v4V+aBgAQ4i66XtaC85YkDog/zdZvzUgfN1N7a633Xqv6fe9msDIHfNaB6Ay2JRE1AHAEDIfI5nzZCLeN4Nbm9yaA+CA8XSsul6yqV0rJ2WQfr+splCyCYBR/HJyKX4phs0PKBZ0lqOYTpvniAiUAmAd+HKjo1cvDjHgr+3wPJQsVCymUZrPMuRsRBDG4AQCsunyJtFGHwAAIABJREFUcc0BUJlxQoH62q8ST8cggpKNAFRGwCD9fkuvbwAkyGgJE3C+Nz1P1q9/T3F1EZBxvZh50s6AEYC5yyUHXt5/Q8zI5/KrAmAIkkipkyGPYwXz1aRT8v5ZO6jJrRyAvKOvNXlLazsXs9bo/ztc29Pohgotp5J49Rcj/pzfIwGS//3OM4CNd1dpntQpFUmjEH4LYIgnyn/OLjL8FeDGhwJbNgFjI8DIEDA8BAy1PFK7FSKf43cNKrvHx+8C/vmxwMgmYHgEaA35J0StpvvzL/nP8RbLAfhyT207TChgDRiu/ZL9DsfWNABvYzbhCDBKoBAk/pEobGWTqp819hzQ1/0k0PoaMDEJbJjxVZFgDad0SaUO5LksWVj+XScDmw5UEUDJ6U4d0nVbC91S3ovfVHp5al64cgC+k7mZAP768KCA0WD3A/ieLz090CDceVmlAuhBljLgrfcAw6PAyDAwPFwBkCAbItM4a/FiNtERjBl76W9ffD2AbwJDdwFj+6syImRXrd5Y2FjIYcnzWPLEqnsfC0zsr6qBMQmfIDR/pyJ6xMhKyMrSDiKD2xja6TADTt0/AGAs1KcAUCFrOLF6tbtiRVFavT/wuMCa7MfVTlH098YBeBcwNAIMEYAUlS4uBULOmK3LCnwOPANlEIOSoF9+C4DvVoWXhvdWZVOYqWgi3vOXDUQhgieB0EElViMYJ08HxqeqnG8D4IIDkAzo51DKQQJvBKUmKACzbM4+5hUivwrgiwC4LzvjmgCh6nBcgiMTcv9Abo0D8E6g5eCjfpUA6AxoQIzgi8ALmWwC4z//DxcPPwBak8DQFDB8yJPpPZHeGCyC0KN5DFCByfh9/+OAsekKgEzCTwD047X0SCPM1IYQjCv2E/MJoGVwUUQoPboq0MdqkWVn7RtDDMahB4g+P6qhXFpjVtkDtRGA2nKjos7IyOyHFUbIrXe0FXsTuzIYfNb4O2M3ATGIYQOmPn6hG6gi3eUkQQAeAIYOAUOzALMVh2pAlESqGFBAXAYOMQVjxll03iO/yYKRAT0FQXkwZkjp1pz51LO2XAT3KtD3AIAwj4Wg05kfiuUHYlsXAJLVnP0INLM0OYFx78AzcRySeTsw2AJueI+Dj2Fne4EWKz5MA0MzDkCCkAByUWqsJzarEanzj2zXwjEGFHuGY+pYsMojzZL1G9EBexXou339IRBrC3lJGmNDuSHX+w7WC4Cm6wWxm8DngLTImgC8pBcGBuTXf/1fXnyTugnFwxTQOgi0CECyIFlsvvJfEnh0mhsYI/s5uxFYi1xZof7oOqSAawwYjRGBzYGXbtWXaCIrlvHUagX6SP/ruMVYCEbEqECXAMjfree2HgA0ESur1/0vtnNwGSsG0RsZME20/+/XWH6Mugk/yngPAGy5GDYALjiIHIgRUIrsZjM7Ax+BSx1S4pfffQVIep8dL7dMDsTGjJB+CvQxTHmdtrw4l0CovFruC2NOe975egDQsCXRK/eK634JhBK90q2C7I1i+Gt0jxF40k1cPJAB7UP2m3MGJAAFQrGei9iUTH9yBUDTHfU3B5+BOIKQ43BWtNtPcWIOzEZE8FoK9K0DCGNxLi3FqaKA9gTgeoFwPQAoI0OulWT11oEwiFz7cwbErzNxWtEYBB+VY76Vh4DWrH8IOoGQ7Ocg1CqMRLPltmxvs1/SHaP4dcAJePYyyUCRIzrTB8tE8FoL9DUMwl61kQQ87Rmy2PS2rgB0a1ci18RudEJH57OsY02y/+83/sZdBKr4FXQTApBvprGgQCg9UEAM+h9F6ugJDkC3gJPBEvRGrYoYCBX9IxEcS5K4i6cZAHIw8oXQ4mLBb35YH5d7OekadtTV1UZSjaEIPH4nQzYNwgjAHNwDuWGYpZc7lzPfX1cQur5oBorfzDf+zi0yVTuSkuxBI2Q+PhQDIUEnMLo1TBCZLufGw/ixbQa0KB8CTODjPohdY78IQmfDjmW7Yo/doAX6GqIiAtDHaYswSmeMubV81kp11L6hy2PdAcgblfslOKC1IiKRmyRxZgV/8++DS8BFrxXi5Hd/U6MeSKdqEsEKhpBRsgRMbAtuG4KU/+9ry5brzP/lPVMv1EPOQegharrVcgZUhVHFxNPcp9VFtlOWkL437C0WABWypFRGsV0sb5Hn2zYBwvUGoKl10v1knDgo0y7XA8Pfv0UACnjaK33Co9gJQAOe64FkNvtZAHQdjz9v2Nz2GSa3jYej2W3KGuZ9ixGdIVSoKT13B2s5AHkGheST6qn0erHv5AIgAAU+LVfw/wq3CEAV7clBKDDGZG9/5oVXx/oyYARczcqH5GyH8eFplTawFvAtrtXLGpNrQDGbejupB3omlIHQGc/ErzOcGSRs8zrhAbbuL1Tco/JfbLlNwHOmi2kIcs3owbdwNpYtynDQhsFcgvuG9/YapGFvYX22zZcAU0/GwA2LJ/4AmGF9mwEbBu98Y3cMF+uAGQCj2HVp3BbPuo3IlqxAy5wHAq4OfARmEBXGfNIBa0BIsG0ecwC67merHgRpZLwocrWaovuTxew/V0txJQ2DWeae3WAGbdhb2DB4+wRw7w5g8Qpv88liyGtoWHzMi4C9fAEHbBi8kwUKu2xNAdBxaGBLbJdZux1LwAGECYAEm6wyfpelJrEgFnRDxESwgyUxIUsVMwjVy5AYO0bG89Auu1/5BF38KqjBHlUAYXsteNCGwTeWNuwtk4JMkrlzGNizA1hm69g1Nix+zDOBW0aBeRZZGqBh8M4emfWNADDT+zqMjQyESdQFHfDbZECCLRgdHeCTe8CBaKJY1rDnBRCIAuGW4TYAZeFG8ZuMkGiQ1IEwGCJtHZBmy1obBsvVMnDD3jIAerti3LEBOMjGcOpa3WfD4ic9t6oveDtLfw7QMHjnH6wPAybW6yaG4+8D4HIQfvtDIVtLejpBFsVvUI7NIBHw3DUjRzL3rDVtsYPOkAScuX3coNDynT2VYJCkn+PjqvUD8hVbS8NgjphGxcANe8sAGNoVY/824BCBtIaGxRe8pLKZdpMkTvXiJ2toGHzSNHDPScAyq3er4qPyGaNc7JCRXWLT2TjwGmCOeQashq6+qSpZmp8vojQpheF58ncdZVjLnjWPHr4VWKTKxrHGUqq97qXu3jp0wPy+eEC/DYNZsZAO6IEb9pY9lNCuGPcNV830ZmkM9dmw+OKfbdcXvJMPdY0Ng0/7GnDXKcDMccBS7MwdKz8KCAKQIgY0MWGCtr4TOHAasMwOkTqf6unyuLykfd254nkb7qsw/iVg7jhgmSX31Vpd9yRHeLx+zRhjEGRbB6wDYT8NdymyubzDzCCGfpMJWfSRYfr9HP/aMgBm7YoxNQHMbQHm+ID6aFh8yS93tAvGQb7da2gYfPoXgbtPAqaPA+a3AEubgGU1RM6B060fgkRoCzj+TcD+04CFE4BldZdRc4/YxlxgjJMewSiwN1zWfsOngdljq3EmY08vm5i/7j5yIMqpvupKyGoNg9lngYosl9wY/0dZdrMzYl8Ne8sAWNOu2MA3zw/F2CoNiy99XbvftrcLriz6PhsGn3U9cM9xMODObQYWCMANwPJ49UliuW6SaqqBn/gGYP8pwPyJwNIxwDK76ahDeN6uXYCuYyABkEza4LbpY5WEWdSLxjF26/dQB0SJ6r4ByAN6NQxmkWcqrnQ00x1DEDJFjR8CcNWGvWVPp6ZdMQ6OVOCb3wAscPJ6NCy+7PerkP5Q3tBY1PrT9tEw+JwbgPu2AlNbgVkCcCOwtAFYcgAuiwWlM/XqDjMEbP9t4MB2YO54YJFMo/5gHIcALV1TRZ17FXOhPtvgtvkqf9H4kvHDlyKK4l6VzvVSBF22uwjOb7pbw+CfcwBSkyeFEHAUx/yw9JTyEbo27C17Ol3aFWNuAlgIn9QxO2tYfNlbK6MvaxeMRYquvL9rTcPgJ30TuH8LcHAzMOugX3QALo21WXBZLEHwRF1OgHS2eOgbgIPHA7PHAezNu7QFWFZ7JnXJ5rnqxHEulvlzwyVNN3+wern5Yovl7SXLGwvn4riLWO4fgMRJXcPd/+pmOymELEhRzBxJAo9gVL4kwVnbsLccgHEpWi3epocCAMeBRU5eTcPiy/6qtl0wpvhA+2gYfO7NwOQm4OBGYGaDs+5ExYDGgqP+ccAkINaVpB8GTv4d4OBxwNw2YGFrxYCmV0YxLNYheCXau7EhV3ga3Lb8g4+R45uoGLADgHWqhsBXA8K1AZADyRvuvtkBSArh+i9DsQhCOtf0UUgW/7aiYW/Z0+nRrhizoxXwFhyAi5y4rGHxU66qAFhT3rDSIVdpGHzencDejcDBDcDsBDBP1uX1CMJRwFiQIBzxieL3KIY1YW5MPOxNwLRb8gs0aghAss1GZ1O+SFHsdRPt0i/PLHu++dFb/x4mXfhcbWxhfCtYMFr/uWvKxfDaAcg7ipPCvFOVpuo3HrCjYW/ZA+rRrti6TS6MVQ+L4NPH2nx698GnXF0BsKa8Iab4dFZpGHz+JLBvApieqAA4J8CPOQuOBBAOV0CUYbIskRkAecrvAdNbXc/aDCxSpyT4CEIyTgRgneiLIp3nP6fs+a4A4N8B8/48CUC+ZGJA29fpuLmxJW+5h5kNFg2jiWHSi0r0Uv4pCoZsxw8DUfnhd4Vk0XGdGvaWPaBV2hVjdjgA0BlpkQ/K9bmn/HOVqtClvKEBqlfD4AtmgP3jDsBxB6DA7tdbcvYzJvQJkii2n4NOeMpbgJktbYPGACiF3wFoEx1ZMNe/4jnPLXu+KwD4t/5SO/iMBcXuesHylyACMBPDgzGg7opM8mEHIGdwrfGA1rC37AH10a64Yr4APvvOSdwEPOVbKxu+K2pdKRTmdI3dqkPPVgbSTBGAY8AsATjWniBdx0QxJylOFCcr6HBiw1P/CDgU3EgEIMW52M8YkLolQRddIN1AyKWiBretf9MJQN6HsaCPxe4rvgDdHOcOxDIAcmDFDXvLnk4f7Yqt63gEIB/Yoj+4p9xaAbBHeUPM8qF2aRh84QQwNQYcGgdmx4C50WqCFngNsgSvQ+Dxu4MuiawhwIAXVk1O+e/A7CZgThY1dcno1nHL2oDIyZULpBsAFTBZ9pjT0QQgn2V6ufRicS8QRgbs5ZYpEsENDejBfpoLrwAOjgIzZMBRZ0AHoUC+SOA56xJwNlEyTFw5FxBPeWvlzpnbANCdQ1eSGTRybMuydgMggVBsKmtYoC6Mt8znZxsZMLzAxoAOvsh+ydDqtXx4FIDl8L/omQ7A0QqA82S/ERdTI22mNfaTuBIIxR4BhKe+y61punQC+MytI/Zz/c9EuvyBeetLAfGZ5WOMZ9j2/gqABB1fMLsHAVBqhfTcyH5d9MByEdzs+B50Z7voGZX+NzNSsd8cwUcG5ASRKYbdHRNYwhhDIHRgGmO0gFP+HJh15jOXjnyKblVT5Cbfoq+yJOszF8P8+VnNPlICkMAzds/YLxlYznrJwIpO6egTPMqA5ZNDAB6iCCYAyYBcBqTRQ0e4630SxZyQJQIvMJ8mSeLrYe+p/GzGfnTpEIBy6US/out+K1wg+brs88rHmDOgAVCMnrEfxxMte1Mt6j7u9zzKgIXzczEBOJIB0BnCJoqgIfDEhM58SWzJEPGJe9hfVH42un/Mfxl9bgSiBySIBWnAJBDGEDAB8QWFA8wO3/a+wH4+rg4RLPYLul8tCI8CsJmJMQAOuwFC9qMI9g9Z0CxhZz65K0wfFBPqu7PEyVdWAOTHVlTcpxhXHZLz1w0ZA6EDLhkCskRf0sw4dRYC0PQ/vVSRAYPo7QCdj7GqVOSMeBSAzUzMxZcDMwLgcKX/zbv45SQlHXDIgagJc+bjZBqAWhUoH/Y+B2D0J7rFa6LYDRmzomsAaOeKqxEvbWacHQB08JkRIteSXiSBLYJOLB+X4xrzAzY7vgfd2S4RAKkDDgPzNEAIxMASSWF38WsgkuXLyXTRSRCe/DduSZMBMwe6ObTd8JBj24Aot07uDObPP9XsIzUGFPs5+JJ/M6oT4buxHv9X7BeY8KgOWDg/Z58GTC9Xq5FxTXOw9c3Cm6k5fPcjgbHbgAlvVG2tH1T3Oavoq6BlniZ+12n5u/2sDbOvasqoFg8x2Lnbcd1GdhSAhXN+7qMrAC4sA8sORJ6yHwD28z+Ft4fdv8UyqUDrDmCEBcpZ39kLS6aq9l4D2rLb/KYsFTPWdfbvh86vQu2s1K/K+zIjTsXIVQ9a59Egs4Y6sZfIA/EcSp/jEXv8BWcAhxaA+SVgSQAkGAMICcwVlNLlqTc9Gbv/HAA7MrL4+f1VlXwrUq7SvCoyGcrrWpGhuur2fNGYwM8YT67hT3s1LaZvqn5MLM0bzmHMmIFSgdFNj/mIBct63NhFZwEzDsBFgpDPeanNgATfCtGsX9TIKwNrg9tuVkhlng7TI/YArX1VkXKrEe1l2SynN1RCsFJsqnQv3UIMxhwIRjU5AGN9QUteVz3BUAvahuNgjC3HxLAND7nBp/cgONXF5wCz8xUDGgCjKPbvevlzcKUHH2ag6cnYzepYBB9Zi2FxDJdjoXJv1WDFiLJ6MKqKZUzoQFTfj2HmwTKcTpVWvcxHKm6kKgoORAEvVclPD6NdzLXpMT8IYNPcLV7yJGB2AVhYrAC4SNA5AxKM9ryDPE5fs6eeVKWGZ2M3S3MQfEyJUKV8L1ZpJXpVJ9pLilmlAxWkVJHKwIhjjD9TtVXVm1HdOy/pJiaMFRWM+bo0rWl4yM1N7oPhTJecC8wRgAttBjQWdBBGESwgSiV0Pb9DRgu0TY19N+M1mRKh8niqFx3rRDsLqjgl9yaGXT80vcL1wnE252PAZCzAHQCoiqoW3yYWFIt664fUpKaREr1NPakH6XkuOQ+YDwy4FMSwgU8GSRSz0UJx3Vx/5vFNbrs/EiLRY+v4ACITww6iJEodQKwBIyBRv9vwhKzUW6z66TUGEwhDS3ezqusAyNxnJn8xa1KRPSFts9YfFB/QDZcAm78CnDBT5U8rCqjfc3yh8Gn/hGd/MsKf1+QzYJ4891Jye13iy1cAE9cDJ+6FpYrEkidxDN3OtXR+FwBGMezoMmxJLOumAuD4J4rxJrfdH/XCoLGFVKiUbw+LAPQqWWaMMLrd6/+JycSIm85w9lOpt1j1MwAwFTiqAWEUxeYH5ENn/jInUVHeMXQ/f/jRePvCa4DhTwLHfBc4frGqqaNJzLPw6iZxV+HTplFGvZrXZT45N39+HW3TujlZv8D6fp8HRq8Dts9XIOR5YtakgBgdrrrt5Qsq8Ssd0BhQ4HMwmVitAWHAY/LbLDQNQDaTVJ8Q6W4qVB51OOqDZDPVB3TLOBepW5jmqaLbec3jGgBGMSxvvemDYkQ9GoKF1ShUCSKCqBeQrvmfVZPC1keBjXcCmw911tTJ8q5XgOLaQgA+x/OdWA2EGZ98gbjleTHdQHQN+2iwls3nK3/Zhj3VeQhovYzdxmArSwQgDRA3QiSCJUrTnjfl4KozRCSCCeYmt90EoJJbVCk/1+FiCwFZxLk4dRfLFia6x8LbYkD9v9cXtLG6+O4AYQRfrgPygVIcqyhTXcWFOJH8fh3rz7EKwnUArq8mcGwK2MCC1i7WY7Zenh56feHT/jE3yliE4TZncd636gPFCKWavGhcRx2J+cvs9MlSw0Ty3cCm+c7n0G0MExdW4BMIbTXE9UCynvyCCX+Ovm4gbByA/xisVgJPpXrzLj4EoRJjJIZrWHArS9iprK+KcefgiyB0XVKGjOmCmW9xhRVMUSyRFnNeFGEdI2q+/HFXclkp9WsAbgTG9wGj08CI64WxRk/OTDcUAvBHXSLQxcVCDMQSWbzv+1e7WVbz+k5w2tJtsbcCYV6WJY7hmAsDA7r1Sz3OgOgoM+KTOJbcjSI5yGIaNE1uuwlAAU/MF+tF5/0sIghVLdVdM2S0bSzHx2Mi+FTxXf8X925NC4BycK8QwfmgVX1LlcFiykEMcL2BndJJ7aQfijKfxLGDwAhByM7aC5U4qwPzNwufNnNuOH4VZaCPlPo2AahqFqoPVFc14ga2m+WEEL0cAz9kdPrOmMu8r1o/rTsXz7f9oswFs+jO6LAqkvC3Ggg5Fg6mwW03CUI6X12h8lyfcz3QHqr3DIl64DbqaQKc9mI87QXACD6vpJqY0EVxz2CEyCI5eMSGX2e7VtI5J4yTRyZhscrvt1nQuivOAaNLlYESwcySgiVbr37Bfd0/u31yEgg2FVaiPCeVOguqAfGov0iR0R9JABJ0bnwk9nMxw+fOh55EbgRhzozrBUA1polN9CLwok5HEEUQBjFMQB7D+j656PW+IrJ8O/bBCo4sGFdGejqiyYCx3mKe9/JtTiBvmI5OFiTisg9LtJFF7gZGDrUbHKs79+hyu5hSaUvh1foFr3r/6vZJCiXgCDwVVFJ7MVmRLsrGltuFCc68yFdACMDAflwR4QM3HPoKgIExt4gz42SuaQb8hBOE2oZmlu+KFlKR3QSssMJxDPWbbjpfLoJrxG8CYT8MKGZSVTCxYFTIb84nkCxCIPLDiby30gXFghaF4c2ReR466Uu2fvoFr3r/fKAEFxvpqMcd9yonIrkuK5LLV7MVCM+/uDJCyIC2J8a0z1iwqyESgMl15Sa33QKgmtPEBnp11mwuXgO70Ud4DHWzfgDYC3zBEOk7HlA6XKyHQzb8HgGoCSQLqsxorIy1Bxie7Wx0rFaf+wr9Xv32C+56/7HbJ5VHtRYT+GJrsehHcya57PyKAQk6+vBkBZPpjPEExlwU59awg3C24W6KBsC6tqHR+MidyVG3i3rdAnAsH2T093XT+zLr197MTA80h3SfsZP2UqpCrPQ46oF317VrpeiKXTJ9MhMLkgGdCacKG/mupV9w1/vnwyGgCDCKWzJe3lqsyzLWZWe6/kc/oKzgKH4jC7oolhdC4jiuzM0WPo+cPQ2AsX1obFCTO5Jzn566PwbReiwnfTWjI4KvDoh1juh+aT+WKSYD3i8Aql2rJk+VsVQly5kkddv2FvHT61icqO7Fr71/IkLNXOi0FQjV0046oBy6wZ922Q95ICqDEaL4XWw3COcf9Mw73DFB9AqE6wZAAS8XuzGQIDKf+oVkqxt00ttAc+YT0PJ9qRFSB8xoye5Xu1ZVeCSgCLbYLVNswoncHxoeLwCzBGjBNki/4BX3z9lXgUCyIIGmhova83cRgO5Te9yLgP3MfmsBS8xs8/U67ePQOqy9umBUruDchqo8sHSd3PMfT5ifo+ack8eFHI6QEcnT5GvdOnVdXof+ptJ+BVPWceiaRHA8Us/nkACo8mzqlqmWrbFDppT5A5UIZm7CPA2Vgm3QfsEd909kKIqB1qJAKCBG8ZstZz3xHOAAiwmpDIdng1maZQAkZzsHZ537YfQrwNyxoQ+HakrnS0h1mUA1C96TdJTmORyhC3oeqdwROi+GDhkFI6bYNrcNDEDeAkXwQizPRpmnIs3OdqZPSaRFUcbchHlgie6agq2kX7Dd/+d8lUJVXuUzk8ERmS+2vfd4uvN2VOV5rSwb0y3JhgIh9wJeN3YMQCIgR78Q+nDEVYBYZUrUpbXFnM7COSdf7N4IPvtDnT2BY/h8Chh10MXQeYGS+7GGjaQiABpuNIFiECnzdWJMIUHcazLptC7YivsF8/7FgLFMqpiQL5TuNbKfA/DC46rqqAbAwIKWK+timRUBEiNGsOQsyQm+Gpjd4n046hbT84KPuYjOmHHyp92gcgDS2OoIuVIeh/xyUkaVwyEWdLrewHE3uBUDcKIwnq40HpDXL+n3CzbaKdguel5VnFJl2awaghLQBTzteZ0cjLq2A2n0M6EPh2pC57Wg41poLzZsAZNso0Hw6eVR/J8bF9YjWGmVCpGKwQLBRCcrbiSxNLgVAxCF8XSl8YDHHFPW7xeFBRwv/rGqOKUBkODzqgdWPYAM53vTASMQu4Bx9J+69OHIF+N71F1O1gUB+AsBfFqKC+4Wi4BWX+CYgOTAU36wdMVNVKka3MoBWBhPxyiuko3xkSX9fvGMkqsDlzzHC1N6SQ4DoINOe7KelWWTheziObeKCdARApD1AdVnRH048gKUAmAEYi6Oh4DJV4VoGDWqjq4XLbO5o1jBoimEPhPJmwu9FvnTLgdgYTwd2wyXbMyRKen3i2eXXB245FlVYUpVxUpGiLtmGBlrTEhVUwV8dEkVKAq3MHJ1uzRbRx+OOgDWFX6MsXJU/36lJoEoA2AKvw8+uwTEDIBbStdOs8ddDsDCeDom7ZdszBIs6fcL9ror2C75US9IxJJsEsHdGFBil4yYuUwknofJgF4XcEUfjrz+X7fKo4EJJ//PkMORO6FrVjQMeL5kJhZMMXzLwNZCt1nzDFgYT8cQwpLt4hDON0i/X7ys5OrAJVe0S/ISgFY7j9ZvnQ7I3+lyqpYaL98CWp/N+nDkZdhi6bW8An1kP3fRTLKVWlwF6RZCH2L4zDDR0k1IqeTNb2OQSYNbOQMWxtMxeqtkY6I+ny9VEz6btfb7xc+XXB249AoXv85+tIBVgJJ6n4lf6oV+mfjdDJNMH0wAVFX90GMk1f5TxlS3Fggh92DyN0IORy5665KIfCktsl+K3VsGtpVOWOMiuDCerlSnjQ2rB+n3C+pIBdulz8wqonrNPLKgwKaC5B3s53qhXVq6oDNg6sOhqvqhEr3V2VNLBjmnSSNdrOLJ1zkAu6VPRjFcFz4fXDJ8i45hG94Gt3IGjOFYA8TTlQZ/qGH1oP1+8ZtlT1MAtHK8mQg25zOZUSCLIliWcbw8wfW5Ln04ssqnHX04euiCk6/3de66MPpuAQVZAEFkw2MKFw6a1wEL4+lSBvmAOMhD8vkOkFX77feLNw14YT/ssmc4A6oOdHBEkwXlgjH2k4Nal6wB4fIuX9LzZjAmorNeHMo5Tc0OewHwDTUh9HXxfGJsYkAbAAAgAElEQVS/uvCpoAcew6zBBrdyBlQwwoDxdLZWXLDFkHyF8xGE/fb7xR8XXByAAVC1oB18HQYIT+8uGfP75SCUs1o64he8v4j6cIQ+IqkPhxrBCHjdjBH6AblQkAeY1ondukSiELmsUPpjbyp7XuvDgAXxdNZVvWCLIfmKg6Bbhrjup98v3lVwcQLw8gqA5v9zC9jErutltg8gMxDWWMBaMVkmANWFyEV6R0uH2I1IzW7ypbkQOTP5f2ch9KsFkwp0kQlDAOmxzHpscGuGAQvi6VD4RgmAg/b7xZVlT5MATNXwqQc6KGwf2U2uGV2uzg3D4ua7fDnPwZcKgIdq9GaIBPZb0YdD7hgyIFWMXiH0eQ5vXS5HcMkc++9lz2t9GLAgns7KxxZsCkgdtN8vWD+vYDMAUpcja7lOR9eLVcIP4tcuob/3AOHCdW02VTX62ApB4Mv1v24gnPy9HiH03fJ366KYHYTHsgBBg1s5AxbG0+HLZaOp65i+ln6/YM5EwdYBwGj1cmUkE7+8THLNdAHhwrUOXtcrO/pwhF4cct2oN68BMDCfmsJM/n6PEPoYPp8bH3kCkbtjji2tJJA962YAWBBPZ0WBCrbYsFoOf9pDAiENk179fkuvf9nTXewKcBSjsn7ldonWbgQpx+26otaLIwAlfi2QQSJY3Yjy5i9dmsFM/oEDMM/Z7Uf0RiYUA7J+ToNbOQC3e0WBBm9qLad6HICG1ZK1XB5PoxnuOOIcxSXe/Of8xHV/P+FpwN47gKUpYHmuSve0pKZgCKSq5wqniWE1WZz/xouBm74KTMwBI17lVBXwtWSs+8/vL45Ff3vhpcAnvwos8d48DZX3M2hx9XIAnu0IIO0chu35AOgLL0yuG/jOmwbg028G/mNz1YWdETbm4I5BrFlov+EtD2wIo7l+Atg8D2xY7iw3V5diEqO54mnj6XdMAYcU+6gon7A3NSO2qFjlyZYDkAX6uD5Iam44YaUfVNDNxaJcLIPXcGGpfi6PnZdVD1wPspQBX/wl4OaNwN6Jqg+xwrxslcVFuYJblehkcYYZGPS3L20BxueBcS8nwg5H5kZkx6TQSbXFZcCQKadx5Cz5mPurAFxrRaa17pAR2PFC+ElSHKQ/0QjQcgCyGyM9v3SnsDBRJgL6msWCf6IfWeUJac8UFlpY8500DcCfvgb43hiwZwyYVhd2D/VSrKGAmIDnBkiafEcN9cprHgKMzgNjS1V7rRjRlceyrqif6KAkMgXIM+6tAnDl+zSL36O9+U8p9jGHQo285/2XA/AnXeNnKAorDXH/AILwbSvLEz6Ql2+cAf/3XcCdw8DkKHBwpOpFbE2wadzIdyh3jjNQirYWEwYq+/zJwMh8pf+xKNSwM6DZMmzNRRbM2K+2Ii6TlFrAWfd5V3i/F7IgT2LBF5LbIdkqxLPWvtzlAGQ3RpU3Y7AiixMxLOUB2t7pKQ8M0qCTnp8HkojJgNqaMEJesQv4AR3Iw8DB4QqAs+6SWRiqgJgY0HVDAdBA4Ba4xN7ndlSFAAjAYX4IPO5dBDMAdS2i+Jx7XTf1eEdTDfgAQnR34p/wQkRmjNAoByDT/ugFphXAmjAEn8qaPQAgZCs0lSckCNmVigEbFMsPBBE3DcBX7gLuawH7hoAD7EM8DMw48AhATrjtQwiXoqkTEwWd7LOneXNCbz6Tiq/TInb2M8ZzIFrTQbGiy92oGz7pXl/7jvdAJnb2470IbB3T77Sai+hyAP5voTqW6sKwFAc/TAdc5+3dvcsTrvPVYSK4SQb8xV3+6IaAqSHg0FDVh3iOIFTIFxtit9orL5Z/LD1Q4s+B8OnHVuXwhhdd5DoLGsgCCJ04q66X/Ju/vSaeAxDPvbdtmdtKDV90gVEPIl/xySkviOhmAEjrlzSkwj40SlQZYZ39I+8JBMx8mZryhOsKwqYB+KpdVSDFvhYwPVR9BD7uyX4SwRS59nNI+bRck/DzJ05v12M0nY8fAk8iWL5BB5qASPGRCi8EVjzv3mqpkC9ACrrwhKukB67GhpqRRowQMqCiYbj8oOoHeUWpdYIBAUj8c8WjrjyhNIJ1unzjDPjqXdUjJAAP8TMEzLYq9uOHICQALe/EwWe+QgddAqCzzD8+vgIgg0qp+5nYjaDzCgjmnCYone0klqP4JSgvvK+6LoFPoFMlkPGh+0rPWta4RHTNJJQz4M8EAGoNTPVU8opS64CC9zoAWTFChcq7lCdch6s3L4J/2QFIEBKA1P9mHIBmhPh3Ai354RyAAmWsR/PRs6vOR8Z8FMPS97yxtIlYgVB/I7jC0rIKSfLXF1EEB+BFFjQ3jCLA49OWsRTTEPzvzQEwry7VrZ5KwzAQAPssT9jw1dcHgCrORQCS/bgn+1HsCYQSveaHkzvGv1scgU/6R55Y1YIxhvOm1EZekQWl8wVDxJgwc88QiJc6AKX/meHDawX9z16M/Em7bO8Q08GBP/jEkAEVjMBoAFWXUjRA3KtNwOBXW3EkAZhrALktpC6lKtTV4OU7RHB+3kHWgv/zrnYZl2kCkF4uF8MGQGc+MqEYUCA0n1tkwxbw4ScHAHr71Q7W4++c8czwcBAmHVB/c7Bcek9b3FuwbdD/kjGWgzJjQ3thGmVA3jhfOyU+RxB6FamOFp8NrhsTgLy8Cpzm5QlVptAU+6CiNgXCaIQ0BcDYV8b0P4pi30vfIxD5+w72C9aliegW8MHzqrmh/meuFhYi0pKbs6D9fsh/n1XFMrYMbPgUByCZz6J+uEknDA9AornWFRb01WZEsACoHhOqyC7wdetT0QAK2KqOb5MCUvPyhLE0oQxzqaYNXL5xBvyVXe12vByLADjXAvgxBvSPGFGMIjCmJbEW8HfntxtQmxT0cmxp9UPAdKAZ1upA6EB7qgDo6oCUxXRtPVSpAwJpnUhuxAqWCCYK1MBExZljY5S8SYr+pxAFAuBayhNG26jw8usCQLX0SAAkwwcAEngyQizaXoziIli+Oe7/9kJvNk1LmBMe9ECO3XRB7aPeF0EYHNVPdT8gj016YBcWtBfBVYJuz7mF7VgGY/pO8f5WdQ1/7U67nIKNS7j0wIbDPFZsyNHHY7od/xdlEHj8CcC3TgCWHgGAPSxiSdt4312u/8SPAl8/Dlh4pDeZW2PD4J1c9+uyDaIDkgEJQKnTfG/N8nUAmu5HUnMW5ARbPfEuIHy/ACjRK7FL5pOR4RaxgTHofKl8r/S1ZWBnAGDKefbn3AFIPRPXB7sFiVQimKVgGdl5ooNwLQ1/1U+DQGSXQ9r5Evy1q9rZbP1lGQDZsPpzI8APHgXgod7qUx11YtBbFzC+/C+BL7SAWwhgdoLkONSLqy5oLogYft3ZI1F7EAC+phsAnekokhP4HIzml/PvthQWmPB9LJ7jxkcSr14jWj4/0wFlgJD5eoDw6fe4DzAYPHokWhHJZ3TFSkn4h7YOSOBwEtiMTv1aY0uktFYTmI2/43EMQmCuAJmUE0gmVD8EFdPpdnxhVhqzDr8F4NMtYM9Jfg98EVTeNu9Q2OFZBX7vr9vtgm/lcezczZ61ZNN8DCvilYCdPXqNDQpAlfGTKm0M6AA0PTAyoMSx64cRfPQHXsniOTI+fEWDFGp+Qb9BeySRBV2kpl0QxxGAlHDmkI56X6z+EP7UDYSdRgh/IouwIZ36lHabBE0GJ0r10Rgb/xA/tt/j/6aMAf+7R4CxzuBXWRGULwBfIrY6UNfpvLae7n0I+LO/reoLMqiVMbW38oUhkNkQIzZO7tIweGePcmWlAFTjAYHPVGwXxWoLYblEDkLuTT8MDPhXLJ4jALpaJB+ggU6xfgJknT7IKXIQXh4Y0FZCog+wxiUTwSkXUbSMV1rB/A31OXWuFpPUda/mRHKi1e6U+hA7Zq7l+A+UAfDtHg/LrptkQpZ727cRWOL9542Pa3rOvuOqagUltgtmJM08j4/PILbIDKz6w5PAHsbraTnMGdZWIwIzxIfeK0rn578J3LAVuH8CODRahV/FFQ/1IumIvXP1QudNfyNT8oVqcHviPcBd48A0g2RDuoDqHdb2SalZAdG9dnfDkAE0gXnH5ijWCDbKCq5/MRiV0QD8HgHQ63jG0hdsLGxA3x9Bw1Asli7hO3BwApgng/Gjvq01IHrXJ7q3Cz7E++YziF2rs1ZLZ+8H9jJsSoECWXj6igmR87aLgfbGq4GvbgLu2gjsHwdmCEIPSI1h+SkCRjpfUC3iNWcpoRrcnrYbuGsUOMBo7QBCxSTG/igxVcBIVGPWM1h1JYQPnyKNExGZMDIJ9b66eEBGxPDY1Y5nv+GCjfGAxD+DDpiawphABWZPjwNzNLAEIH4XCH0M7/5c93bBfI8Yk2cgVAdvdT10ifDkBWC/r9lGH51NhIsnsWHOfPmEUKT94WeAG8eAO8aAfWPAwVEHISNQlKQUglJjJExqC+H6Nq93kOpUg9szbwLuHa66QzFWkaFieXxi6hgVHOMCYGRuJ+5V4jYJIDKI9KlsAvFDq8QDrnb8NWVPh9EwdFkQ79TlSMIsN0Mi5s9MoOGno4U6f3YAvefL7Y7rvdoFLxOANSA8f7xSgWmd0kCQbmZ6mTLEnJ0UqWLhUkxlrBn6n3wWuGkYuGukCsufGq2iojnRFpafsU7MDxErJuZhYCsJosHtWTcBe1oeq+hxigJgXBrMmTBPnJKLrr+VED54ibHYvZos8sO+DNcrHrDX8YVVyglAKud0LtMjFPtNMz6QLDY7VomLJd671AEH4Xu+3g7nWq28ISvX58/hguOBg8vtFQvV/hEzxfqOevuTfpjri8vAWz8L3NYCfjBc6ZYHmBcitnFd06pxyb8W4gPlgonBqffTtdTg9pybqiVNBssyUsdUD7eGO9amnf3sXtxQipl7Wg/sD4A8AwHIyZMYky50Tp/xgN2OL8y051qw2hXzwRCEdT2nmck1RxHG+w5jeO9NFQBpR6ldMIMXlFWgVndqF2dVFsJzuOgRwMElB6DcI6rznemD0RnbwQiSRS3g7Z+tVIl7PC9kahiYZm6IizuLigliT/VoUog+p8P9l3wJ7qGEanB77k3VczroUToWLCsABud4ypaLCUoxf9i/9w9ADiICULrQRWuIB6w7nuZrwaZwLBGwClSqSyz3AhHbaRGEFGOmC44D72UVgjW2C2Z4lIF4ArjodODQcqUGqAxfcpG4mJVuVqcL5tbs2z/veV0tYK/nhTAqesYNHdO5PCJZos+WuzxHJIViuXFyJxupNLg976ZK2lizUKodilGUgzyGhokF8yw5Mf+qRkjdjfuDtwkkm7DTkNaBaQ2ox1q3eMD8+B6O3H6em8Kx1Ccx9ptWl9iYIUAAWrI3I3nHgPdOtsO5eOuxXXBdj0V1vOL/so3Cxef60tlSpYwveKf0pAu6ohfdJ8k4CUqgvr5jV6VGTBKALeCAh+VbZLTnh5gu6D44A6H8cVlkNK95O1WkBrfn31R5HSy+JCwPplAxRegE/2T+AloGncNmbQyogUQx/KwB4gHj8YWNTwRAOW0FIIIndoqNkTAxz/bd09XDGLBdMM6/pLKi5whAX60gCK2ujxzEAqGL2pQ1Jis5AJEAFHvTujYAKjRf+SEugm1d2COQLU/DAwQ44caEw8AtZzSIPgAvuKkdrWMM6M7xCMBoiBn4YpCE2NCfxWAA5MEuwvCCEICwlnhAHV+YORfDsWJGgPpMKwg1b9QpFnzHbD2BK2JGul9s8KkYW17vLALQRTCBpzXZpS4gtCXXMAkduuAy8E7PijPWprXJ5CR38ygw1fJDohh2BlRAgq2OeN7uTWc1D0AFNtmL54ESBsCaJcLkDajxj5ZXRiCIGA0waDwgjy8sk5+HY+X9ppUbJSCp6TnFCMXwny1WAFQ8rUAc2wUrRL6mXTAefWnFfnz3FpbagQKLAqAzoZjAKkkpXkNO5GCEvOMLFXOnnC4xIKOjnQGNdWSM+GqHQGd7JSsxUf+JzQLwhTdV4je1nQvr1MkPGtlf9yP2Dy+gAqZ6rQytfvdHSDxgLwBF8AmAYjHWluEDiKGMiqOVvtejXTBOuRSYJwDJAARgZAGWL9Nk+IM3SzgTydE4eec1nZHbtDaNAf1Dpd/SMx2END6kD0oXtFhBXmcY+OY6AFChnKnzl7NfdMR3qCAae2B+VVMYXASvDs3/X/zHJZcB84vuiqABEo0QPnhnwqQLyRURmZBPytnwHde0M1vN2lR6picoKULaxHDIEdHkW2iWg4/7b5zb7DSQAVd0/griV2JYojfpwRGEYsGBrOBmx/OgP5sAKANkcbFzNWTRnX/GSGImMYH/LYlk+gGvdT+bW+SWH+Ig1GqL5QeTtR2EYj5LVHfjw/ZDwL8yJ6TB7UU3VVoTjTYxYDK+Ivv7dzNAZIxpZSiU8jjKgIWTcykZkBawDBBnQdMr5QeTKI5iWCB09AmEb7+ucnOQ/aTPWn6wuzyS4u+R0Ob6CUGqJpIDA97AdqINbgRgBJ69CG4Jp6q/ckjXqB/RKla4WpkO2ODgHoynigA0JiLwaNiEt95YQKJ4FRC+7brKzRH9jZbN6iJYuSHm9I5iOAOhHNJfZkh+gxsBKPbLu3+JgaWDdojhMO5kkDWSlNTg4B6MpyIAjf3IggJgMD4MCARjFMU9QCgAykhSKnUCYHB9JB0wy5aTRUxmup4h+Q1uAmDs+hpXgFLnB6ULONOn5xACNJqxghsc3IPxVBGAiQG9aLeilWUJW1FvVXEN0TKp1C6At19TMSCBpz1dHtT/JH7N9yaxp6QkF73KBxYIr10nAMproB44qQGTj6sjUrtOFPtLeFQHLES9AdDFrq1E6M13MaxVCTNAXNFThIylLcor40zxtgDAPKuVwDMrOKw+SBTbtR2MND7sZwC7Qvm4wqHa4T/uIrhb+7n0EgbQdTijoyg+agWXT8llDsAFWr/B8qP1K7bT0pvtVwHhW6+t2C/m8svvZlawi2CKe37nhFtapkDnILRqBQA+v04AjMyn79EIkXO/DnzyCBwVweX4wxs9B4rRZgyPVFqykgDd+5JSpBU5r0vHyHz+jsc3ub0KABsZMCyQgeExKyFPVIz3lmcM6OfPAGCADYPE67Jfs6h7G0o+xvi7oyK4cLZfOgpsXwC2Lq9MwuuVERonKn4nSJrcXnQKcM7dwMMXgYcsVxkSebJgzOWPqdB1ad2f3gpsnwK2LXWeR9m3danUIV1lBSCPArBwtp+7DThuBti6UDWDmWA/DvXk8LRptfPtNUlihYZTOPCi04GH3wFsnwGOW6iAs5n3GeJJ+KLoE+9VDClQ8R6vOQHYegDYwuY3S6H/iJ8jb11ck0q9Qhoc9QMWgPBZJwFbpoFN88DGRWBiqQIgWyJY3lPozaGJ1KTEPh36zpTkJrcXPRE44S7g+Cng2DlgyyKwaclfFoIwvCwx9Zn3Q1DmIPx/2/sSaMuusszvjfXq1ZRUElJkKsBEGQyYhJCBSkUqAW1tsBdpuxEVaBzowXZqe1g90G2LotjQdmMjKqtBxQERdAWUAkUlZNBGkQRNyIAEMAkxpFKpqjfUG3t9//m/c/+737njPq9uVeqcte66b7jnnn32/s6///3v//++Tz0dmD0KzC4DM6vAFpd/0L3Gh6yTDgnvLwKzAWDGiH/ThcC2OWDrErB1pRgQisIQhAa+AED+HEEY6uNLyrRnZLSl6tSbrgLOeBQ44yiw8ziwfaV4UGbdegmA5QMTLFlqsfn7XecDW+eAmePAltXiXnkuZSBkRcm4UGXtU2uo3xsAZgz6y54JzMwDWzkgBOAqMMVBCSAUObh8QuN/CiTgcWAuyWhL1amvvBbY+VgxbW477paa7gIBqCnUrbUBiQuhAKDUot13IbBlDtiyBEyvtO5VDxvvVfxW/JkWNFrCeK8NAGsY7BsvKQC4hQCkJNaKy2LRIsg6SJ3IQSe1onKKC2CsOYMeN+0Dtj0ObDsGbFsEZmWp5S74g2Ir2uA22BScAJGA+dJFwPQ8ML0ETAUAkgDTPq9zdK/+sMWpPF19NxYwA4g3PtsHxAE4SQC6FdSgmGWRRIJLZJll8EGKjHiX1jwaN10HzD4BbD0GzC4WrsKMW2pNobZoCu6CLCDfCTqzgg6sr+wFphaAKQfgZHKvpRSYg7HN5XCL2AbAZwPrZGaj6ippXhgn0kqmU1woxnHedg5AATuWHig2FE1uVRwoxoX+Wcbg89S3AqCKPONcCi8oPtVP+9++G3j+oSK2xRBFDElUxbTS+3nvc4FpDsjxllXQoJg8FgdCQoGJJTTicLcQ6vPL6wbg9cDM4cJv27oAzFA5ky9/UOSvmg8oP86n0dICBn25JwjARWDSAUgBHN6vfdbv10AbARh8X91vDM2ss+NvAECKPVLCsHoyUgRqrlbnRwB933OBc+4DXrIC0IEmiLnE75di8HsyAcjzWUVGUi6uICMpVwwJVMXdeOk3XAxc+Hng+vV2esAYw+sWoP31r3eLcLwQBeQUrEHh4Jo2h4vDmJPuAyMLGAeEn7uqbgB+I7DlSWBGCwe31Gb9aL20kGDb/EGRxY6WTz8f2wtM8l4pgL1SgM8esHCvsuylME4nn9cfQLtldg6TZ0kUKorAfij23vAPCmqp3fcCl60XFINid1PlZrf41/dnApB6wSQjutUfIDJR8CGIQOwWEH7DywpKrWc8CFzqRLHkVYrB2jS2FQH5vkuBycXCAlIUUAAkCM2iRBA6+ARCe7DjYmQduLYTleiQ/XTTS4DpI+6nLhZW2nzVCEBaMLd+soIGqjD1ampdugiYWCpeBKA9bBJC9ActAk8LES26SqsftInLZ44dQif4Igdhym5WLrPDyuYH/7HTCNwDnPko8LXrBccjQaioe6BiKad3+QY/MGTH6rS3OBvCnQDuAIyqhiDkQ9RX+29yE3on8IwjxQPI8zkTiApGU3oVkD/4fGDieAuAdMw5MFQjEgg1DYsUku+a3uI0TGBfV7PotwHwaOEmbHEATvuDIutni6UAQoFRIFRYhfe/dhEw7tbe9Of0Si1g8HkrwRcevDajz07gIJ7n05rYyWIpb4ya/7vv8PRdFpj/LXDmkQLAnA4jCCOlTBRN/rFMAJKgkkVHpGUjySSBSFeg7/azqk8EgbSEq8UDRACLKDXSyaQ7Br//DcA4LSCtwnKhTEkQcmAIQhtM+Uaajl0uS9NatITXWzpzfcdNB4DpY+6nBgDaCtanYLN6fCj4u1ay0QIqtML/EYC61wSA9tAJeP6eWsAoDysFpg1eB0HIQRCIIkVeCqQf/05P3WCB+UPA+CPAzvmCaFWDKEuYcl1yMN+Y2dckqGTeHPEvvWDSNhOAfbefX0A6rS8CUw8X9066bFIfdqMHJID++DJgLACQumyc3gyAEYRRKFCLD1eu5ODLF6QvXedx0w3A1BwwxdAJLTXjd8seQnGrZ9bPFxLyA7WIKON63tYtCQBN/sv9QPm6BkLp0vl9t/m6ietR6fbyBA4gnXtORwRRpNnTtPpW6gWLH83lKqcOFTEnDiKtoHwy8RNFhrefyeztbnrBfbWfgttsP+kIyO32ELD1cHHvInrlvWs6TsnB7qAUlg/suFtAWkE55zYQ0QpqcALoNCXTEt7A3KoaDwGQfqoAOEUBa7fUbKctltwCajVbxvSiyvoasM0BaBKwwdKb9fN7NfcqBWGiSWykWXER0umeacUEonQgCKRfIgDFjya5yq8Wfsfs8dYgiuMxgpAg/vnMzu6mF0z6Zj5APdvPQec0TEosnvQosGOhaLuIYvnwEYSithE52F1XFAA0p5yigD4otCqygFKnpHUpLYP0OcKURYv6Mj4MNR433QhM0gL6QongawOg+6rl9CswKoSkEIxPyTsuAPigCYBmAXVfYcVf+n0SRYw6dP1YwNgHsgSajiJP429RrpWOM6cxDiJB6NINM4w7LbUGMQUwB/M9mZ3dSy+YVG0EoBiDBST5ddZ+PkCsAiIlQZDa3LVatJ0WXG2PbL98AB+4omB3oP/HgTUhmGgBfRqWf2TTrUSjExDSP/qWzQDgfAFAWyzR8rkFtDAKX75jo6nUguZxZ8NByHbvvqBQ36T1swcsBaBAGGRg40Ir+rt9WUDhQ5ZAU7Es2e9LLzglqHRxNkbeuW+oQRRls5jaMjnK0a9ecNf2R4LAwO829kQB3LTtEYQPUwzQAWgW0AGo8AQH0ljp/V17pm0KRcEifGuNOnocO1rACQbKPXhs8TtNwVr5uh+n6Zf3wDgu29g2FdMtOc8B6PdpFj08ZFrplw+ZA5FTvAQQ0/BT36FPDkRqBT9Jag7xYlQItY0f88j78sZzCcKPZlrAQfSCK9uvB4h577SCotUiEJ8opq8IQFl/PUBPEoBLxbRE62LSqG4dFB8r5bHcOtiOQSqT5T7RKzYDgJx+BUCCTxZQCwhaQc9oKcEnEBKknj5FsJ1LAPo9xoWWPWDy+6IIoqbeaO0VA+zHB0zxIQDKkn1GgtXiRxMIAx0Vn0Db+lkuFjLRCt5WEwD71Qvu2H5OfekD5FaciQay/GIbFgBXriwAyGmJADR1ck3DwTE3TQ4B0LetzBJErTYAr2BBSI3HTS8tLKBZPo/fWQDZp197Z3scjGb5BDp/L3+njMweB6B83Gj9wj3atOsPWin9WgXCFlVO/3ctf4iD8XkBkH5USlAZlNPZAQqARr5vxu1yjmH0givbX0UQKI63o0Wun/xHuR8E4VnPK5JQLd4VNttTBvK2uoiKOUf/f+GjwMNBh0NMV6J0c0NpcRv7mrYv3kh8/uHxYp+bVpwLp3R7sts2YzouSq3KGa+q7+x7Co4nazAerRKsVlV1QitF59dyyFZaYY0HMu9mWL3gtvZXMbymBIFMZ1ov2h0B+LTLisxgW+Eq5uU92iZ72ud9vvR+4JFp4NjkRh2ONi0OB1/UBCkvEYRhfuNs4OmhhiPKnFQlx6aAjMnSXJUAACAASURBVPjmz1w41nnwO4cCIBvBwZgTAOUHRq3gyDExD4zRGVYEnpm5LqmQc0M5esFt7acFl0SlHiBxuTkYxxdaihUC4QVXFu5FCUD5QtJl85sjGA0ziQxqeu/fem+hw0F2fLLQGxFlYMRvo7v1WmIVtpt1DFkXvOR7LwJ2HSkyoZmEypoVVe8p7b6qEMnidGG/Vl/L2aPOIwuA1pAIQE3DAmFa4j9f7CPaFpCHKujr5xzZesGdHqAqKz5X+FLRAl58le+jui+kTBALMcgZ73CDBkpN2/7+bfcWOhwUyCEAjQTcAVhKdjkPc2RajewKyu/n1//qJcA2uhBMRGXQOcn9U6JIOjXHQqSYOsVoQp1HNgAvz8yny80H5PVz9H6RqVd849WtXQ/zA0Ow2ayGLJ474L0G79vvbulwkJi8BGCg4S01SKqofoNvSIC+5zkhFUupV8rUTpJN06KpaBkFQm5M1HlkA3AyM5/u9Zl38zrk6f0iU6/4hmscgK5ISUtCTowyDqb7UxwsqFJW3fo/vbuIBJEZ1YRgyHwQKNi0KEl1OKTCZJdxtPDn//v8ooaDaVgqFyiTD2IKfcjZS4Fo+7g+HXOPv84jG4DIzKfLzQf8KVfI/FNKrQ6h94tfz+vOA9cGAAbrpylY2SDlVTTt+uCnV3/V3a7DQQAysJAwobZJgUXi78Qayhd812WeiOAZzEyUiAkHMeu5BF5FwZQAWLPwknkLQy9CrPMy8+lIHZFzvN3T+YbV+8X7c64OHHix74V6zIxB+RJ0wQ+UU992tYoFy3fcXcTDxQkoPsCUhFIczKVCegSg5B8A/PILN9ZwxBSxtiKiUAOi7JW0dLTustF8AGbm0/1o3vjjnSGdj+lYlGwdRO8XN+c1wABIoHk6k61yuSCJITq3jDY9Vx0BqK++uwAfX6JkI/hME0SC1EGguiQ+isqcQRLrF6/0jO2w+6FMnZhyZYsQ1W50qOHgPX1NXndtODsfgMwHzMin+0+ZN0S9YOllMzWfLwKQSS396P3iY3kNOLDPM1y065H4gOW3p4uTDkB8zWdb7FgbdDhEgJkCUDRvogTmd/vPv3BVAUBuvylNzAAYi4hisVQnEHoIqWblrxqm4Mx8ujfljT+YjsWBYgIOc0oJPsq1slCpH71fKybJOEoAuuVTRSCnYlmU6P/Z4iSJEcbLv+Yu9/1EAh7JKEXDKxq4ChUiKymRbwjgHdcUWTARgLYXHSr2LOU+BV7MVwzxwOfkOWybYAGZD5iRT0edjpxD6VhcOQ6j94tP51wdOHBdMeXa9OqWRcmWXA1XLUIUH6zyCwlAs3z+YBkfs1u+VIejJEF3ckrjI9T0y/aMA2+/tgAg08VURKT8vbKMUgAMIGzzAcOi5HknHQAz8+l+MW/829KxhtH7tTz+jIMAJPCYMULAWd6fvi+EY9ouoZBM/Kx/4LUBgFLgNC5o16FrE8JJVJgkiFhaQQBv3+dVbMrWVsC8UxFRkjjaVsW2DtRdOJ/vAyohVYK7A+bTvTdj8HlqTMcaRu/XxHkzjgNkIOWuDr8jnYYDKDutgpUhra0uAlAyCCUAK8BXcjBXgLCk/h0D/hcByDxFAdAzoFUqUBYRJTUcMWdPP7ONL6i5bLQeALJRQ+bT/W7G4AuAOXq/lsGdcRgAY+glLkYclJVTsa6ptCX3uQjAKINQstFrAZKIwWxQIhIJuovB/Nx+r2LzFCwlj8Y0evl/MYk0kieVtcvrwGUnHQCVjjVkPl3mItQsIPuElx9G79dOzDgMgGkAWlNyBJn8xKprBRC+zgEo4LWRgcdVcOCjjlNvmx84DrzNAahaFZWLygKWxUNibIhTcPD9BMLLa65bzreAMSGVoXvJ/Cgh1WUfO+XTZS5CDYDs9GH1fnOrIDcAkABTTDCCLYK0Cwi/586WcKJUiEpC8CCBYDsiiSplqUIUmOjf+o2tIiKVUJbgU5uSWl4DWwX4+PcXnrQATBNS+8yny1yEopdcay+930y5YhgAg+9n2OoUeI5TdQer+32fdhmGoOBZanBo+g1yEKU4dYgFSvqB//vZBIBt9RshkTbW8ZZZ2hUgvDL3iU3uux4LSBM0ZD7dPRnTH08VAIfV+2XAOucQAMuVcKfFSD/+IAABsEoGwYAoHZIKEEYxRIHwLS8pUuhjFVs6/ZZhIVWyxVKBBIRXnbQATBNS+8ynI4tBzkEACv+chlUVIKE/5cRGsWmlKfIzudc3APLQSlg3E2OCyVRc1kpU3DgBmKoQsWtlBcswjPu+nfTYtBL+GQdgOf16GCZW6pXlBCqWSgqJypoOAFfXXDifbwFJLvi5HAjlnUsiIe6AjOp4iQNQHRlT2PlgJCUbbc2s+v/hFwFb/q7gm6HlYpBbmTV2sscQyy/qFBj2v0/cAdz/HGD7NDA1AUyOOU+1CwWOewNjKj6/O03F1/WuugW4/XJgfBoYmwDGdH7IxB5kLPIB+I8AfNwZgga5ck2fJbEm8V9zNWPfrasbgMuPAcuseJ8Exsb9FdBhA+7gaQNKB6TfcgCYug+YJT+g89aoBDMmIMScP12uTKj13uDv8zsKig/uJ1uQOsnojm3qB5P5ACRBH3OhPuzzRN9DV88HqQLEWPJnvTy5nm/t/1s4BcuSpRZtGAu4fi+wtBVYEyccrYwn6hF8/FkJp9bKxAKVFsn/d8urgbHPA9NPOEOWl4+2cfoFHhfVrJTZPKHSj5daOtup6JyCpPx8rHWRVQ7WOlrYCMx8AHIzlxkALPD9c0VB+x/A3E/+E2fUYHXdF7KTGwdvTd0AHP9r4PgWYG0KWBdfsBdsMPfPrKKsoL9XAVLAvO2fFylCE4cKliyrDVZNcGS1CqEYhWFiAZV+XntaURdTLmpCEbpchTYLqi6NrkMCzLzt5Xc4HwyJmmkJ+Z73jQOh4NWeDUZiK1K08f0EXt7CMHVawIk7gaVpYJUA9LI1Ao8bzKX1cytoFtFfpdCIWz7rgzHgth8u0oPGDwETc8CEMySUzFaikgtlpW1Ta8JqNba7lVljSRgW+Q6ZP/57WQvj6fydBjXfAjKbgEvMLwWCvhNoipgNpnQshlS4IGFWzIk6ylWwAz93ETLxGWB5ClidLABoIOS7pmGfG+33YAG5mND0G8F4678vkiPJczNOAC4UyQm2N8w94kirFlfIAl7i402d6dbPWWAtrsjOFiuCvAJZOQE0pHTFsckHYDeCvhNgipQNxoAz8/8IPr5nbvH2jd+6AThJAE4AqwTdZKEBLDoDgU4+YVkPHIBoPwareOt/BkDexsMFAFnbzNJYm0IDnVwbt4uyur1kwL7Tp+iZM/08WT9Rc7DHUmuYTr/x+6o4ovvu9fjBbgR9JyA+omwwxvZI5ULg6ZW7y9FPf9QNwKm/CgCcKABovh8ByVy/UCtJq2f+X1yYJPGU27lIZLbuEWDsWBHesZeDz4iURLUWa1TE47LqK12fZmd3OXidFctqm92KatVs1jAEsNv6sdymaa2g8+xUL4I+Pn2beCgbLGWHI/h8G3oTr45iK86POlbBU9yKI/AcfLR+ouQwH9BfmmbLlTHboOnZ/T9+5vaf8FUaAThXsFOQ45mUcgZCWTAxe0UQ+urYMO1/37GtxQmoLCBtRSp30LrDp2SFdzYMgk/R+VNwvwR9mwQDsaspGSfJgYDYNTbp8psCQFJxEIBkQjDrxt8dXCUIY+COH5MVFPi8SOn2n/QYLZ9Gp0cxANIP5IvAkzVzxivRydnKNzBa8fddM84b6AFyAriMF2pajk9kYIeoClXmA3AQgr5NQEHMBqMVFMNaIOayNRL/vhlH3RZwmhbQQUcAasrVVGz4EtjCu/3dfb/ID3PbT7uKAZ/MhcIC0vqRTo4W0IBIEAmEtFwCYqjW03bcmdwBYeoWgetUbrR8snrloiR2drpACf+rD4D9EvTVjIJu7HBV+781X752Czj9lwUZkTEgcPoNPp5Nv4oBRhCG6dd+1DkMz1JIhR1BAHJ7zwqO3fIRRM5tmDK5CoQKsSgOeBYBKFZULTqcB9r6Ni5KYmd3WKDUA0BlhNLM8EbT1QBXBU72aI5ZjUcVOxz7WLkQ8d37vsart/uA6RcPsxNSAtAXHDYNC1AEpf9s01kKwuBwGU7HgVt/1jtD1e60fgQigSe/j5bQp+KYpGB+H62jT7P8/ZypBIC8Dhcx8eY9wF015abhmnoAyJ5WSrKeNgKO9SHxnT/LSasJBim5lRjWBEIVeROInKL1qunybRawLgASdEy74qjaNNzJCgqEEYzBGvK0297mAFSHEIB6ebKDgc8J1ksmV8t29f1en6L5v6cxIK5iK6Xne/5jCTiFcTqVn/r/tWDPWwXnEPTVgIKUHU7ljASawKefIwDpMdRxRB+wFgD+RREDJABpwSzz2c0LfxczVjkVKwaYgtBBezu3SvX08d39P5uO3QKahXMQciourZRAGKZWar/YZ1xXRPe8wQr2AUK7TvbOVTZBXx4MBECRnConUBSFEXT6mf/TK+/qmzAF/0UBOPqBZYF52HrTFCw2LH5G8UCzJEko5nZqmRnPh/uCXmpnVpDTsIPPwKApOaSA2QLDLSHf97iPx0tpISLfz7bl4iFfsUsnj+HZWEeOYDCDnDmCvZkEgedcCjxGseIhBYt3vx049HwMLRh8gA9gh2MoH9ABqKJzxf0McO7XlSAU4HzhYYFq+5D7hwBu/98OQLlIBCKnW39SlXNY+nqeiq2dkQg+gnGPb9/ZpT0lq6MV5D96gLCwgDmCwbdnCvZmCgY/dxy47xxg5SWuUjigYPHFbwA+fyGwfr2rXrMvPB+vp3L3GHCgi9JOHQCkRVPppeUBigXLFymyejYTB4YsgfA20ofRAlYB0FfAlvQqP0/TsX5PLOB5DNu471cmIwiBaRww/F01J+mz2pqChxUMZvpJlmBv3iTocsW4dzewfhkGFix+2febXDAeJO/YEILBB7pU1g8LQFo98QASVGYNQ6DZfEG3fnEqrgLhbf/HV15anbkFNCvohWSl9XPQ2XTM/2s3I4DwPIZwBEDfgitH0Ek6N6x+u/iD7T4g/YdBBYPpWHEaHlqwNw+AQa4Yj54JrJO+aQDB4pt+oCAyYvOPEIQDCgYfeF/9U3AbAMX7ItAlVtAspKZdz5SOlvA2pstxjES3wJ+92NgAGK2gwi78QoVfEhBeQACqNNP1RdoA18kKdgDhxkUI/zKIYDCnqyzB3jwAJnLFOEIW7QEEi1/1Y21ywVglCAcQDD5/Efj7M4CVrZ5AKlkhxeQUaxBI4nvFzxf8IfCVC4HV7cC6ZEX5nen3VX1vAGLZq8ysrvHY+QBwbGfI2E6JpLvdX+ksthpUvQrmX/sVDGZVUJZgb17vJHLFeGQcmCdVb5+Cxd/5xjZ6QzzMLOQBBIOfTV2Ps4HFHQ7CLQUQmUrV0rgKJMsCjsxGAqTn/hzw0EXA4tnAyg5gbTYBorKkUyLnkB9YVhTxu+kT13iccwtwdBewPAus+b2ar9xJAafqfgMQO4dh+J9+BHe5gqZZZzYok1JJUcpaR6bp93P+W/N6p0KuGIemgEWKgPQhWPxdP7NBLhiHKYHUp2DwpZ8rLOD8tmJQVplOLxAqmbRKC6EDYC7/CeCRPcCx3cDSrsISrs04CPm9ArZk55UvKAspYLqPaPdR4/H0g8DRHcDyVr/X6VabLHk2PhjpPVZY7d5xwF6CwS9y/4LbbVyQsEKIufGiKe0p2JvXOx3kinF0GjhOQY+oNRtljji9TQPf/fOV9IZY4Gq4D8Hgy/4W+Oo2YG5bUUy04vUcLCqSJVRWszJbNgxSmMau+q/Ao2cBR88EjtOqbgNWWaTkIFz3YiWrF4nAjtN0nBZrJnU+/8PA3CxwfMYB6LUra3oglL0tps6wlVha5rLiqd9AdDfB4Je6U0s/0BXTDYh80Sr2FOzNA2AXuWIszABL1JaKWq1R+nwGeM17OsoFY5XTVw/B4Cv+Djg0C8xvLYqJCECzgsxmZlq9T8e0XGUyaUizavPtxoFr/zvw2BnA0Z3A8e2FVV3x6c4sqwObckeyhiXAowUSADhD1XhceDMwx37lvU4XxVN2n3rJIocygkr/Vbs7fe+EdBLcfaXXQ3IPWIrpBB6XlnwpR76jYG9e7/SQKzarxM7qJFj8mg8UarMV9IZ4gvNDD8HgKx8HDs8A8zMFAFnPYQPDl0Co2g4fpDZLqKCxT0/7fhJ4fCdwbFvhRiwRgJruCOwUgCpeCvUjZmEFxhfk9W969kW/B8xvKQqnVgg+B6CB0MsI7P70AHgmd2n1NQ0rv7FvALIlVYK73MnQCDLThSGZoDpuP7uCeuX5n8zroB5yxThGnQ0CgyBMxY63Aq/5aBHG6EBviDlOLV0Eg1+0AByZLgbl+HRxnZXJoqqttA4ODovlJZVuSjTQFtq+NwNPbHMAzramdVpVs6wEoPtdNg37wJfvsYiJP9NFqvHY+7vAwjSwxAeNxVO8T6aNVRRRlT6hHrJ0Ovaw0WDJCKng7g86APvNB9wg2JvXO33IFWOBgn8EIf2nRLD4tbe1+AU7yAWbZeskGHwVdd2mgAUCcNKnJgLQrZ/V9/Jnn5JUYmnAE3hCmv3+t8AWQfSzyPK/POOgJgDdsgqA5nfJAvLdLV+bz0kK4RqPZ3wQWJxyAPqDVhZQyQr7gyaXI9axWCFVAGLvRUhV46PgLnUWBs0HbBPszeudPuWKsTRZAJDTo8l8ui/42juL5veQC7ZpsEow+OrZQlqVVuH4FLA8WVyDAOTAmHUQCAWQkOlsQAwDt/9/AE8SgPQpNa07+AhAA6HLXbb5Xr4IaAMfv/eGvP5NzyYA7UGjBWTWjh40v9fSyscHLtaxhJWxFVsNNAXH1khw983+DYPmA5aCvXkdNIBccemfceooAfhAAcA+6A2xLuAGucxrzgKOMexDfV9OwbS2BB/BEoqLSrBoYGgJ3E8qLcIEsP/ngCPuUy7S13L3wb6PU56/m/Xj4Ps0TKCXQA6AXuNeZY3HMz5QANAeND1kwcKXlj6wOZQ+b7R+Pi0PD0DeFAfk590CKg8qncfoFzIRVWVqfFfBhgn25vXOAHLFWCDbvPstBsJZ4LUPt+jdesgFg+qVptWq11bg2gtgfuLiRAAgQeg+oEmsOujsXb5SsAoCIN/3vx04OlNM6Yv0tdx1MKvK7/TFjVmeCD4HQQQhf159eV7/pmc/kwCcKABoeYvR0oept7SEoZQ0Tr1lPuPQFlAtO0nyAcWhpzw/FSjFzGjLx+RGvxzoSeC1hwsA9klvaFN5FAy+9mJgnhaQ0qqagglADo4c9AhCDpJPl5ZommQ8738HcGw6AJBW1VecZv0cePwOY0/wl1lAD/WUCx0mMlDLr8bjmb+Dwp3x4nkDYbD0thIO5aNtfmDi/xGEeRawxhs7Vb/q2huABQJwAlhyy2cC0xoggjAAUCWWAkksOiIY978TmOOqeqqwqAx3WGhHK06n7TDwOcAV/iipPAKjwgrZm2o8nkUA0gKmAHTrp+o9MTrEYvq44o9pZIOtgmu8mafCV72YAKT/RwAy5OPOuVlAAk9Oule6xQRTWUKlWtkU/IvAHAHti5oIwDK841ZPFtCmdr0U8PaC9hVultd4CIC8P2Ztt/m5/qC11TJXlJDGGpfGAmYODgFoCxACkLpuWh3KCgqE8gNVZK4KtxgjJAB/2X1Krao1rfN7CWZf3LSBT4uAEIyWBVpipL7GgwA0AW25GbGENBTRx3rm1M2w39mmrFVwjTd1Kn+VAZALEE5LtIDyMWUBvbLNLGHgd5H/V07BDp7r3uU+Jadgn3ptxekA5MBri0/Wp4wzBjDbCnkMWMqVpE8GJwLQqvfc0pqbkVj5aNk7gbCxgJno30cAjntowtXNaZ1suvSKNhsYTcVKmw9F5xGE+94dfEoP+JYhD/8OC8eIPUsUHokVVKB78XszbzAF4Pvd//PCKVGIpOAr78mn4DZOm8YC1jco+w6EFTDDPJqeCEBZBa5GffVbhmQ8DtZW5TYOvPhXip0GTuu22lTMLSw+aAVl9QhEWjurI/aQiLJkTMLsX9R3r/ymZ73fp1+37OU9hunXSkdl7T3QrhKCtlCM59k2i5CMMSIAGdqxEIwrmptzTsCEut5yilKoJLAcxCq3fe8tLCDBFwO+tKjyuxSCMdYEXoeDrHcHvu0tTwLzmwHA4N/Gh6zNCqqeOSxC2lb8tQSiMwbuqXIqAcjFh2JjBKGJyShQG6ygVbfJegULWBYcMR3rvb6oCRaQwFPgl1M5rR7/JtBZOIZWx/0+s4QeY5z/1/X2tFnAxPpFELaVkdLN8MWGVr4pCBsfMHN8bmTKfCjZ0Ncp456/x58zLzfw6Qf3ABd8pUgEYmqk5bGyek06IQl1bkXScnlN/u8L24Gdx1qVq91KQvrpgwaAAw9p+wnXPw1YjyWMGtDo2ASOFGMU7SIEUzdYD34vMPmXwLbHgdkFYAtlGiim6DpxJtvq9LtlVr/aWKEB8pUXAOOPAFPzwBTZ9r04vdQ9Ts4pAZ3cd+yHxgfMAOH+vcA69/9Uxijmz/AerYpdar1lNSMYzV+vWY/34I8DY58Gph8Bpo8A04vAFEFIknIHohGVR62QhFRSYjQE6qFri2z3iaPAhHNNlxKwArI0Q1IAxwfReacbC5gBPp66/5ICgLKCtqnsrKKlrFZUFPKOr7osMTtdsxzqQRZ93Q1MPARMPllohUxRqkEK6gShOP0S+dY2hlRv99y+ovRi7IiTnTvLqmg6xDPYpqAUgRgsoR7MxgJmgHD/c4E1FXu7FRRbvEgd7evXWlbPpp9EgUjiJpwe6zwOMlvpAWCMVusJYPIYMOlSDZRpoGiNxKzbdIQlXONMWJbGtw4svdgz3El47nzTRvPrrKptAJT6ZrzfintvAJgx4vsvdQvIXK5VYF3sUZxmJUvgA1FOvwF8spKyBtM1y6EepI4LqVMedbEaTp0EIKdPKh5FqYYqSxgo2jgFr13j6XXHnOiSZOeBVSvyC8qC2r05FVvVw9cAMAOA178AWPMp2LJaaekiCPXExwHw660n1oB/niGQazwOkkSepbJ/72I1x4CJ+cJ6lYI1riccrVicUuVSmIW82pkwnHHVOKbFsOozQGkFkwewnBES37ABYMaAX39ZAUCCb82nIlo+40p2gNnvsoKunxH1xGwA/LOzdQOQJPIuHzV2GBg7Cow7AI0l33XfjOsv6oVodes6ISbBsAZMX+kJxU56KY7pkmFVhOciuvTzSt05v0+ryuT/9gDrZNe4wPMsI7VJP3GcP7gUOOdvgL1rRYJ0ZI5IV3hV4/wrGYPPU3/AiRhYusy2K7mU999P+z90ObD7LuBZK0Xdkeq9NSX2+o4HLwfWlopFCC0fgciBMtAFC8CGrYXVoVjnU2G7rTXrzh4kfRzLY1kyGwBoeiGcPiXb5eAzdXWnazPCSScb4j3xfmav8Cx2p50lAMW0VXINitCogl2r9H2dcctWwQxQsn6ZTBbMNtcgdKIbiZj51VcBk38CXPxoQcfCUg8pjcYgZScw/momACnXyr4leBhs5QaBTHpf7X8dMPYJYO8XgAv9e8QJlAZZq8D4xSuANYKPJQn0AR2AHKy1MACKe9nfFI6IEqduEWoHIJ9wlsVKLekoMCa9EAegSTYQeM4TXco2SEMkAHEbBZoj4bbYtdyCVrFqGXgTSxgXYTZeHLi9AMjEQRCVUXP/n4KUaaT8vVTi+Rtg7GPAuYcAWlMCgUVkQfJ2Q12yBvPXMwHImhDWwf81imsTiLSEvHZkr+jY/p9CQRD4p8DOBwteItai05qn31FFdfLlFxYWgCDUIkRkj/TxbCEi/89jfPZ3X2VqYSJQbmUNQY3HQT7hbv2sLoerVwKQHNEEoCsm8R4MhPRjXUGzVEIKIoY7yaEYuY4dgGb5RXruoSgtSCLLarkICQ9f6QNykGjFdjsIBaI4kGlt8W+Rg5g0HJ8qAp47nihAzFpuWtPIMBZJlASILvR6fQ0DCVbJCkJOJCqnk4pGpb99tZ8MopyiKDX7WWDiwYKXiEQOehCrgKh+eJQ+EQHo1Lby/zRlyf8TIbf9XS5ftIb8I92YugH4ay2pLusorl7dAoonWtMwQSTdOFuQSLTGHyIC8kxSIQuA4hwU2WUAoO4/grBcDbsfWElSzg+JCoYDoEGM1ixSkHzgF/wG7y8sIa3J7JPAGWuFJSQIaU01iJHUiYP4e33BrPOHmG/JMaOfTZVYRhwGav87vWKPJ9/rSH4IOGO5sITqg/ggxXs4TOaBAECbeoOsgfl+DrQShFqcEIhyyt0MbMusEkx76iAZXKM8BvXiZAGlF+KaIbaadYpem4aDgpJZQz6YJABV5VcHAJZ0v4FxX6KG5UpYs0KnqjhRuagEVgPglYAl9ciHf8mdUrJh0Qx9vkDBzBywfbkYQIGwahA/kglATsHsDzKA0BATiPyZ4NEDwIeoa/uFYKKXL2f24nQoIgd9R3yQCMTFqwIAfdBWI7+yB5ZLECYLETd85YJl+2YAUNosLIel/xYlu4Jsl6bhNhD6it4WJCvA2Zc4Gxo73RcgJeOqFmGR6rcChLYACyGojmEYdj59KnZ+tIQRhH9IvWA2hiREjDeRI9Cly7fMF3EtWRFawhQIf5IJwE56wdTIYdt7tp9ys1K8JnoJvod9Wn682PNkP4hUy1ndWgstAtBDMLYN5/6PAc5DGNoF4SrZfN+4+IhT8jqwg2Cp8ThIJ5vfSWBXAVCrWN9SMxDK+skaOvhoAc8me654pmUB3f0wyt+E8FyRAGmPlOEoiSD2qgvmAKoOm52fAuiTDHSyIRxx+lI0QxxADubfF5vffMmSajrWlP7nmZ3dSy+4r/ZzAUEHnQ8R70HsXlK+PgJsW68G4XYGZj0EY2EYATCAT6tAhmE0DXcC4faapcwMgAIfLb0kuzT9Qmw5uwAAIABJREFUSi+EfeALkSrpBovbrQDnkm8wAo8/E3i+CCsZ98NCpAp8cUekZyBavI4ET/TnaAk/RQCyAXy6uNSPA0i+wMeB6ePA5HFgZq2wpNGK3FUDAHmv3fSCe7afX8CB4UNEEOolVi/3obastNwJ9cO5BOBKEQMsAcifHWzRAigWWAlCn5K2bQYAOe1KMjTIR2kRUhKVS7IrLia0v+3xwHMZMCbYNP0KfG79zAqK5DxOvyEuWu6VD5KSHy2YAEQAfpaRdl5UkuUctIpBnCIIl4psD03FtIIP1ADAlBuJM47EqqUX3LX9kSBQcuuyftK78xUkHyQ+RLqHZ3Fv1KcgLj5kAQ1s0Qo6IA1nHhNLQzA8ZxvBXuNx8DcS5UYpNnoYxsCnUIqvZo0F3wPTMa7Hv53HOJVbS/l+5bumX7d+5WLE44hxIRJB2NMCqj9ixwuE90svWCaIA6bAp959EKeWChAyA0PTOV2unGMQveCO7bfqHbcS4rJR7Ewqnw5AWhLuImg2uFQAXAVs8RGmntW4+g2hB3P79L/EJ9zGvqrxOPibiVihAOgrWQOf/EBfBcsPNBBqW9Hv6zzGqFzmoXz3B9AePgXiq6bgiv4YOB9QHS8AfpkAFMMjrWAcQA0iO9XJiQyAnos2vV7ESHOOQfWCO7Zf7F40mZFQScRKAYBaSU6vAVcTgN7xXHiUFpDTMK2dFh56912BTiDcvpkATIXzCL4g3WXTZ4jpGfjoF/oihL+fx+0yWUABLwIwtYKKIabgCzHQvi2ggBKn0McEQDaKT5cGkIOo6SuyYzEfjQB0EM5nZgAPoxe8of3sgSqCQM3jkdFLvpRvR13+7UVRuhUFSavNO6otwp88ZZ3+t4M6HLtch6OT9AG/q9cmtf//gV1JDYcnQ2zY6/YakfSrU+Pg1M45NqPt3IEtoM7WFHokyrWKkooglCMWLYjiUXMtK3g8Uzd1WL3gDe3vRRCoUEYCwGtYFxxqgA2E/jI20F5hhmQod98BHNnlxOTig1aGiDanO21yV4DygWuB8YeB6fnC9WEtiKVVKeE0ZGiXWczeJoWMIig5a9V5DA1ANoKDeDylZ9NSXxyAsiKawrQqmCv2HVf5e8aRoxfc1n7xs+khItAUvojvyWryxVcWJZksVSyZoQRA3dcAoHzax4Gj2wtu6FVKM7gMgti02jbV476oUJJs1j/AbA1mQ3Pm8eTRsoZDtR+xZKCiEKmMXTIeXHPGdhYArX8FwG4DGMEnAHIK4yvT58nWC2b73cexaZgWWaEKgU1gjNbPP7PvOYGsUSBkv3hBtmRWNzxjTk9RWktvxp6POj0vARjY9sWkFel8RWxegjIF4RjwAOnZWMPBTGjqvHmszxJOBUD3xyznL2bqROvoP3N3q84jG4C7M/PpcvMBef0cvV9k6hXv+2Yno5QfGArRbaCC0mWv2YtF3ecerNDhkNZIIsXQRv5dlTtGADJSz2gEE1EJQM//026HdIEZLC8B6A0tk0g1Ja8DuzJdphS82QBEZj5dbj7gxZN5er/IZI+67pscgE7QaDOUMyC0Wb8+gXjuR4F5J6YsaXnFhBoAGEVvUhb60jISgCQnoh/OLBgvIrL8v7DdFkEYM5dtNg97tvz5zJqzdfIBmJlPl5sP+DJP5xtW7xffnzeh7H+Z+3+RpkyWT1YxuURJYVtx6T0fCTocouQV85VkHRIGegEuEv/YKpkA/JceVmL8kv6t5/9pu62tfiPWcFQVEa0DZ9WcLJEPwMx8uvfnjT9IgZyj94t/ldeA/S9tMaGa9SNdmsIxbvVscVJ1GScoMt4UPwhAsmMZ0aXzQBsvdGRBjQz0FUpEJRAJQOq4KAnBdz+sfiPJ3bOYn8fsykyVWMfiN3BOzckS+QDMzKe7OW/88aqQzsfE5kH1fvGjeQ0wADodmVGwOeiMsUqHrGOnS4UFy9P/wAEojkEnI+IqOIJQNLgpCXhcmLAtD/D+kgQE235L93tj+YBqgTX9BiCeW/NedT4AmQ+YkU/3sbzxBymQuZhm8g1T+QbV+wWFdjKO/Te2mEFNlCb6gPF708VJ1TXHgKd91GnZpDfi1k/gM2vqU3DUnCuBmNQe3P9vw6pe229KOvB0K1k+ZS+rnrfM2AlA3JMZtah/EZKZT3drxuDz1O/yxAwu9JgJxr3lQfR+8aa8Buy/wdWQZAVl+ZzCrG3q9c/YrkmHy3IRYryAAqAkEBIlopJxNNUbER+fA/H+/+AAdP9PmS9dazicJybm7mlB8nR2dI1HvgVkOlZGPt2nM29GCamcGZjAwlQ+vvrV+8X/zGsAAUiLVPp/wd+zaTMFWw+/kAA0GQQnpCw5mDsAMIrcRB5mC/+MAffTwgfwKY2KfmCZ6ZIkUShrxXxBX4yYaV8Hzmcn13jUA8CMfDqWYeQcSkhVOl8U6uxH7xekrsg49h8oiCENgC5TUG5vKxxT8f2aRtOtcAKQ1s8soPuOVUIwpchNlEEIOyNSIrrvv3hwnckWIZPZsnbcDyzTpvg3lU8mpZQqozyfK74aj3wAKh1LgrsD5tMxiz/nkGD1sHq/YNFOxkEAcuW7oqmXlisuQOT7VV2jwi/kTgj1RkoZhBje8Z83SCAEEJZW0C3gff8tADCt4VASaWIBK0HI9q8BF5yUAMzIp8tNx5Jg9bB6v/jdDPSRns0BWIZeUitIo9IhHmhXTvzCPQddccnZ76U1V/IvC4SBCFyg26DFNg7c++Mhhb6qiCikT7WVUmr6lYn2nRKyrdZ51GMBlZIc07GUBdMjny6XCiUmpA6j94vMZbgBMFo552pu27PXAqXTyAUQcitOQjAm9xX0N9pIwIPmSCmH5QuPqER0L4kDYgp9zOUL6fYxkbZcFceyAreAF3GlV+NRDwAz8uksnT3jiILVSmpWNlhMze+k94vMZfgGAPJeHDjpCrgM01Tdry9OzvmYAzAqLVWIwEShwzbRwwSEn+MqP6bQK5tZlWyhjCCCsC19Xv7gOnBRbgp7cu/5AOyVjqVMmA75dJZ9nHF0yohWNlhMxKnS+0XmMtwAmFq4imnYbrEqNJPc+9kfd62RKh0On8qV9hXZ9askEPgAfI56ziocUgVbzGT28lEtRMoKtg7lBHtznfZNA+CQ+XQWM8k4uglWK/NLYKzS+8U9GReXD0g/Tyvh4Ne17Yb4Zbr6g6y7/aNWcoPpjKRTsJIags5IJwkEAv6en05S6GUBfRWsUExZyVZVQCQwrgN7Wfdd41GPBczIp8ODeXfTSbBa6YYxlY8/p3q/udc3C+jTbtvqt2oadnB2m4oNgMn0W0p+hYWHWbwg9yU/0Kb9EIy+5y2hiCit4UgKyTeAkN8Valk4Le/ldlONRz4AWWBRM6fdIPfHstw/G+SE5rMnVQ/kA5AkLHS0ak7V7reXfhgACaBqDtD3e/nmc5k9kA/A80JReq+U38zGVp3ObJo/BvAOD3dtwiWar9zEHsgHIGlFubqSx7+Jja36anLLcDvvgwA+NDpDfILv+qlzuXwAXuSjrkKemlO2e3U1uWUYnL8dwB/5e2apca9LNv+vsQfyAUheX4VguB+mzIsaG9ntqxhF4Xbe3QD+n7/uHLAW9wQ1tblMRQ/UA0CaHC7plXEh+q4T0OWcfhleYTSHBK0EH/mi+fcRuKQn4I6fWpeoB4AevCz3HOOm9yb3F5mBlZBNclYCj1aRfyfrbgPCTR6AzK+vD4CyglX7jpmN7HY66d1E0ctdIrEEE4wEIMlam+Pk7YF6AMj7EwAVbU82vTerCwhAXopJN9zVI+AYrOeULLZgErY2x8nZA/kAJGWr0naUWdFpy2cT+oCWjpdjLFxE5UzYIBBpEUX5nLnlvAktb76SPVAfAOUHpiAMm96bsVtCAMaKALICMyxDq6cXfycA+b/mOLl6oF4AiqBRIEzBp7/X2Af0+fi1XIioMIlAI+AIPIGPmeROWV3j1Zuvyu2B+gHoFfZiDS2lC0LiY52WUADkQoTTMH1BFSYRdHoRfKSu5v9qrizMHYPT+vx6ARhSuDcAzzmDo5ZGHT1PAKYMwQxME2jiSo/gEwBrrq+u41ZOy++oD4BaCcsXTPiSI3ey8s4KGoG8QwCMFM+0ggQhLR0BF19SXuD/ayakz7uR0/TsMcxg3SjfqWNA0hsrga/ojaq/8WPcC+YIk4Ke4CMSuB2XVht1Oj8zIfXlU8BtU8DhmYRXWdfrdF1fgr3+S8At48CD04DVjXQSDO70PTUnaJ5uOCwsIIFHSSFy1pKPWCDsZxCpw8UVgKSPxLXM937OzxxAljzcPAbcswU4Qh4V3UN8mKoeKm/bu78IfKJQa8VD48CylHQiL3O3/qg5Rf30BKACMtJXjXKQcfBSK8Dfqc3KVCwuN2VFGRnm/yKZtq4Re5ifyQQgM2A+BeB3GHaZBo5MAIue0l7Kt3cC4xhw+5eL7TuCkJk1jBtyerbUfYG5ExjZ/pqrxE5fAOrOq5SmowVIrRp1IyT2R6+fg0bgVYG4CsyZe2UsaiOGKXr4Sfp9k8CxCYAFSKyvXeY1o1BxQux91yMtfsHPutgnnyUuUvhc0ZsgUXib+nVkq6+ZKaABIHsgVZnuwD9sVo66rrR4ImdhLGSQ8zPL/JgBQxeU1ouWkO9PTgDzbgmXxrzMkatl3keivfG5x4r4IRcz5BfkO5vEZ0kgpIfBZ8yKjlL17syy0tMNcOn9dl4Fy6dLFabj1Mpvow9Ify+I4Nlo9Xt+ZqU9VdJpqZh4QDDyxUyYOYJwHDg+DhgI/WUVZl7aSEt93+GO9Ia2iuZKOfA7lhp9JpvAVy61w2mOwO5hmCgMHC1H9O24gu6UD9jP+ZmbtLRaSsei9SL4XDPbAEh/kGQ/pSUcc0lbApFWb67lQUhpVnLBsoKqqZclFMmUtrxPcwxl3X7vOCAtYLSCcugFQmqhdssH7HU+RznjiOlYXA8wqkOfkItTAom+oKygca4ES8jY+N3z7fSG4hfUtp3ihUHruVSsFy1iRvNP+1N7A5BdJACmVpAgZPhGOyCigEjlPLudn7kvFtOxuB4g6OjD8UWLRkCZFRwrLCEXJQQhp2K+37lQeBCRX1A7KPQto1prFEmSYn2mB9EAsO+kYfk8KQhZF8yjVz5gp/MztyOUjiW9bCUhEBhKRCCgSis45uQ/PhX/xfFWMgOnWu2gxB0TF/o0kEZ/kCDM1Ts+3RHYnwVUL6XhDFrAswfIB6w6P1MrTulY0sum1VICglKwCEACqvQFCUK3gHcsFQCM/ILayqP1k9JshVqrncMalOYYvgcGAyCvIwuod8YBJQmZpmGJeyRwkGw4n8jJOJQNw3idLFhMRNB0SgASTJyKoy/4ieXCeFfJBUeV2SoAclFyR0bbm1OHTUiN0/DTAwD7zQeM52dqj8VsGEkVE2jKetG7AEhQ0frJAv6RC0trC1skl+IWlNinGLbSaZg7Mc0xfA8MbgF1LQV1z08A2G8+oM7PVF9Ms2GUE0gQyp+Lwu2yagLgR9ZaYpkSypQ6a6Q2DCqzpkvietXIFdoZfuieGmcOD0DeP0HEbBhNwYPmA/L8zJQsATAKnguEqS+XTqkE4YfWWwCUFZTksYAYwZfIBeN9Tw0cjOwu8gDIZqsoSSvhEeQDiiGYFoyWiSDRypWgi69UP5sc5fIcquSCNeXqe2X9ZAHfM7Khe2pcOB+AT41+aO5iRD3QAHBEHd9ctuiBBoANEkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cvAFgg4GR9kADwJF2f3PxBoANBkbaAw0AR9r9zcUbADYYGGkPNAAcafc3F28A2GBgpD3QAHCk3d9cfOxqYJ2au9RdPtdp/khoEOlglDYT39V1PzQFXLsMXAlgt9PCxJKPbufyf8/KHIPfBPAZABf79Xc5XQ0ZQ1Q7360NbxoHrlsDvs5ZRsgo0une06by6X1mZvtP99PNAp4F4LsBXA5gjw8EGTeqaGF4QhzQF80CX7cAvGIdeDYAfhdZ2sTKUcVrpE7nd31N5gj8e2dIo2osk7NZpMdK0Z19tv+bJ4F9K8D1ACj8yfNSikHeg+5Z969m57Y/8/ZP+dPLKZhP/rcA+AYAF7g1oRUhEMUzFMt6eSJfX78b2DkPfM0i8GIAX+uWlAMppreUUErn8p2gzTl+2flg/sDbTkvIOik+CP20//mzwAXzwDcCuNTPJeFXpEpM6QEjIHm/zTF8D7T5gATYNQCe69aAloRTGulfBESBSYNyxR5g/Bhw7hKwZwl4vk9LnM5JmsBzUyDGAX3B8G23Mz/g9BuUa/0IiutfMkj7zwKmngAuXSvOpUvAWYBtF4BTnspIj/O8zPaf7qdvWITw6eZA0JLQEhKEGgxZhUj/dz3NzSKwbR44exnYvVKcy+mM5Km0JhxInUtrGkmzCPicg3W5LMGkQiZZTm9xS9Z3+4m2o8C5c4X15pTKW2Lb+fCx7WLtjYxzqiql29Icw/dA5SqYf6RTTilg+lYCIXmICKQ4IK9wxfSJY8AZK8CuFWDnanEua9ZTAMsaCog3Dt92O/MvnRGBtGwkqKRmMEkqCaa+2k+0LQDTh4rP88UHj74kF1WaATo9QHQ7mmP4HugYhtEKj4PB6ZQ+FS0hQahpldPya1kXTOqNY8DscgG+HavAttUCvBxInitrkgL4lcO33c7spBdM3kAuSnq2nx9gQfAh4JyVwvrxwel2z3p4aMlzH6DM2z/lT+8aB+Q/OT4EEqckWQSBkGD6EQKQnDCLwBSnYgcf32fXioGUFawC4esyu7CXXnDP9tOCsyD4KLB1rmgvX7zfbu2WG/Jtme0/3U/vKxBNAMoi0KcjkATCN3HOEr3UAjDrwOP71rXixYEkeKMFlSX8ocwR6KUXTJ7AaNE2tF8WfA4Ye7Kw1mwvX/yZn+eKnvcrfzC6IK/ObP/pfnpfAGQnySoISBqUXyAASS1AK0JfagWYcRDOrAF66TxZQU7jBOEbM0egH71gcgXSFZAV54NQtj9YcNIpbONCyh8Ygi8CVospApDuB63g92W2/3Q/vW8AsqM4gLIKBBIH8bcJwMCNMX68BTqBb8s6sGWtsIA6jwDk662ZI9CvXjA5A6NVa2t/IAicnC/aGV+8T74IQPm/AmGuBc+8/VP+9IEAyLslAKMV/LgAyIUInfnjwPQqMOOgI/DstQ5Mr7UAqMF8V2YXDqoXXNl+EQQ6N9v29aKdesUpWJZbAPyPme0/3U8fGIDssDid/pUASCvCaXgJmFguAEfgEXT27gDkuwaUg/nbmSMwjF7whvbLhSDL5TwwvdRqo9oqHzACkCB8U2b7T/fThwIgO01T1IMCoAZxGRhbKoAXQUcQTjkI+a4B5e5FzjGsXvCG9gdqrLGFYrpVG/UuHzBOw2/LaXxzbh43DKeoJwlAHqLndSs4udoCoIBHQE45EPk3DuitmYOQoxdctp8+rFwIWsGFYiFFoLGNchcEQC6e+OJC5J2Z7T/dTx/aApYdJ37AyJK/DIwvFxYvWr0IwEn/H1Opco5sveDUhSAAF4HJpQJkWixp6k2n4IYfMGf0amDHev2I8+l4/UbvNw8Eozw72wJePOJ8und7EkKj9ztKGA1/7WwATo44n45pWI3e7/AAGPWZ2QBkYHCU+XTMfGGQmYIxjd7vqOE0+PXzATjifDrKtTZ6v4MP/MlyRj4AR5xPF+VaqZLJF1UzKdPV6P2eLDDr3I58AI44n07ZMARbo/d78gMubWE+AEecT8e9YOn2Uheu0fs9tUCYD8AR59MpG6bR+z21gKfW1gNAz4geRT5dTEZo9H5PPRDmAzBmRM8BJzqfLiYjSKKr0fs9dYBYDwBHmE9XtRfMsIz04aQZ1+j9npygrA+Akqs8wfl0BCCTWRq935MTYL1aVQ8Ao1zlAnAi8+kEQGZTNXq/vYb75Pt/fQAcUT5dBGCj93vyAaxXi+oDoFLyT3A+3Rcavd9eY3xS/z8fgCQX/LPR3SOzkon55jg1eyAfgD8M4NcAPD6aDmBtB1e4NMDNcer1QD4AbwbwxwDe4UvRE9wHZG1gNSXDLlwLNcep1QP5APxzzwj9IIAPnXhT5ORc5EYCA9HNcWr1QD4AmRH6FQBMTSZZH98ZmD5Bh5g1FopiNns1x6nTA/kAvAfAEwDudnI+EvQxPfkEzYfaCXRSBluQMB7YHKdGD+QDsBNBH/9+AkAobqTADGK7Inw1x8nfA/kA7EXQt8kgrGAGMfBxZ5Cv5ji5eyAfgL0I+r68uR0QmUFoBQU8vfNvzXHy9kA9AORoMw7CdGQCjoUZDwL4kv/+8OZ1gJhBIjGDgMh3vTavBc035/RAPgD7JegjODfhiMwgoqeJwNPPTaB6Ezq/hq+sB4AcXeXEP+ZhGVo9vRimIQD5v5oPAZCupgDI9wg8/qz/1Xz55usyeyAfgMMQ9GU2Op4eAchpOIJQQEz/VuPlm6/K7IH6AMjgGzdl6QtyX5jWjpQFevF3lq3xf6yhrOlIAUgQCojR8gmE+l9Nl2++JrMH6gEgR5UA5KYsc+AZmCbQCDi+IvgEQMob1XBEAHIajgBMLV+0kCdws6aGu3zqfkV9AGTwjftg3JRVVRAtHQEXX/wbAcoXP5d5CID8GoJKvqDAloKOoIz/y7x8c3pmD4zhaqwjRzCYyQg5gr2ZgsFTLweWr8XQgsXjbwLWrnNtMlKgNoLBmZAa7PTCAuYIBlMvlWQswwr2UlUw45jdDSx8HbD+Ctd+HVCwePKbgJV9aASDM8Yg59TWFDysYPBtmYK91IbNOHaPA/M7gUXKXA4hWDz79cA8+W0aweCMURj+1HYfcBjBYO54MMY3tGDv8I3nmWSHOzYOLJ0LLPGXAQWLz3oB8MQUsEa16kYwOG8whjh74yJkUMFgbsNlCfYO0epwissVY34bsHw2sEIRkAEEi/dcU0SP5qhF1ggG5w3GEGdXr4L5134Fg4kAjuDQgr1DtDqcUmZETwArZwAru4BVqsv0KVh8/o3F4v0QXZBGMDhvMIY4u3MYhv95Zh+Cu1xBcxuOU/HfeDIq5cv7FuwdotXhlCBXjOXZAnyrO4BV6in0IVh8wStLuWCsUAyvEQzOG5ABz+4eB+R/ewnu/kOP/3G/l4kJTERlljQtIot2e53/IwO2OPl4FLtcnCqAp9cahT56CBZf+LpSLhhz1N5qBIPzBmTAs/sLRHcTDKbiNHdBGGymOC/3hglEvgjAnoK9A7Y4+XgiV4zVWYDAs/etxaubYPFFP1QkLtCIP8neaASD8wZkwLP7AyC/tJNg8L/xLNBu+YBdBXsHbHEFAINcMVamgdWZAoRrfPdXm8KitLdmgYveWAq+2y7iMqfuRjA4b1AGOLt/APJLqwSD3+y5T1yI0AoSbAxMMzGV1o8/My2ro2DvAK2t+GgiV4zj4+3AIwDXtwBrVJeuECze+9aW4Dut4PxkIhYsdetGMDhvoDqcPRgA+SWp4O4veQ5Uv/mAGwR78+6rQq4Yq9PAOi2fA4/vBkKudKVU7VZw77uKvWFuZbtcMNb5v0YwOG9g+jx7cADyi6Pg7gccgIxlcA5TKhaD01yYKBmVFpBZMfx/m2Bvny3t8LGqoqTliZbVI+gMgHwnMAnCIFi897cLAAZ6QyzFzzSCwXkD1OPs4QDIL5XgLmk5JHk/SD5gKdibd38VcsVYGmuBTaAzEHLHgyCcaokB7/1IkUET5IKxwF5pBIPzBqbPs4cHIC/AaeqvPL9pmHxAE+zts6VdLCD/lcgVY3UyWD0Bj1ZwqgCggXA7sPfWAoAJvaEtZBrB4Lyx6efsPADyCtmCvf00s/NnOsgVY3m8BTRZPZuGBUACdArY+5lWDqGmYbIrLHEx0ggG5w1OH2fnA7CPizQfaXqgUw80AGywMdIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0BxoAjrT7m4s3AGwwMNIeaAA40u5vLt4AsMHASHugAeBIu7+5eAPABgMj7YEGgCPt/ubiDQAbDIy0B8ZYNMbkX+ZekpuIiOQrPar+xs889HJg6jZg5jAwvVZ8B+ll9PlO5/Fc/o+ECjnHfi8zYfkvM5ulmp4qJXVqx5deD4zfAkw/CGxdAZgoHfuh131QkaI5hu8Bs4Ds8B0AWLnIRGCBsFfn87JffDMwdjOw5R5g8giwZa34jnQQUwDo99wBfJ4TM7COiNdlaj2rA/jeV/vfDeATAP4UGH8I2Lrc6gc+SHqY4oMZ74VSKM0xfA+UUzB/oBUUCKMl6zSQ/PsXqZD5KQC/A0w/DEwcAcYXgYnVwppwADuBkefnCim90FmBWXwnK87Uen53BI8sbuwqaz9p5UgnQhBS+ZN1zE8Ak0utviCwq8DI8/nx5hi+Bzb4gJzKZE1SEFZZgS9/2pWR/gTAJ4HJQ8DEMWB8ARhfBsaWCwDquwQKvvNgHXvOcYVbPFJPkw+dDxC/W1Y4tWDpw/Rlgo4lo1T4/KxTihDNpJwj3/UiMLXemprjffC7eWpzDN8DlYsQDiKtVxzEqoHkyX9HRizW+nIgaQnvAiaeBCbmC0s4tgSMu2rMePAR9X252jXklaTFU108K0MHav/nvJ6ZxVVk9OI7GR2IZoGQNc/HgbHgIwqILIVujuF7oOMqWFawCoRxkfEIB5CWgkREBCNf9wMTc8A4QciBWyoGz16rwNgaML5eWKpctYZL3N+TWLX0gvtuP0HHk2n16JDyxXmVhfU0qywbJbr5GSuXKxA/sV5Y9UYWdnjwyS3qKKgarWA69Wg6fjQOIK0HadnIjPVFB+AiME4AuiUkCFnESyCSkmAuU7Cjm15wX+2X2ifBRn9A8mKcW2UFjULVQcgVDl80u40SYh763FfvquhLCxitoBYUsoJfjXKttByMq9CKcHn4sPuCbgXNJwyWkECcz5Q376UX3LNncZyQAAADEklEQVT9fFgIJs6lBBwtn3Tt6FpIz4RWnuQxPh2XIGzm4CwQ9hWIFgBTK0gQHiIAJddKq0ELQh+KL1qUR4MvSEsoENIKrgALHNiMox+94K7tl9qnnMio8MSf6SNwGpYVjCDk/Ju7isq496fCqX0BkDeqlWwKwic1gAQSpzGREnFgREz01eALLvvq2Kfi45m6cf3qBXdsfxRbJMho8dimqOhEK8cXQRr9QVpvPoDNMXQP9A3ACELFxPh+jACkP0fLIKFCCRRqKuPUdqjlC9o07JZwKVNHeBC94DQcZO0XAAkmgotAk9QYrR9f/BvByYfMSATDVMzwTXMM3QMDAVAgVHCZ7/MaQK4QZUHiNCbBQlqUw74YCb7gcmYkelC9YFlwvVv7RRAorTuBkECU9asCID9/x9B935zYzyKkqpfiNHxcA0gLQgvBAaPVkCqm3h2AtC5m/RyEqzw/4xhGL3hD++MmslgqCbgUfLKAcRrmTlBzDN0DA1tAXUlWcDm1IOIIJAjlT/Fd05lbFQFwjdtgGcewesFt7Rc/Gx8iWjUCjGCT1YvWT1MwgUqrf3NG45tTbcu0aximWx9xENcEQHGbcYAEwtSXSqY0gnCdgeuMI0cvuGx/FUGgFhwEYrR80QckWN+X0fjm1DwAWv8RgJFilJZBznz0pQg+AZAAlVWh1GvGka0XzB0cCQi30aSGVa9AF62fLOB7MhrfnJoPwPER59Px+o3e76mL5Kwp2G57xPl0kxc3er+nLvyKtLmhfUC78RHn081ONnq/pzcAR5xPR9mRRu/31IVgvgUccT4dNaobvd/TGYAjzqejumqj93s6A3DE+XRUg2VSCjdaGr3fUw+I+VPwiPPpqJjO8J1Nw43e7ymHwHoAKMFd7QErAeEE5NNJMb3R+z3lsGcNzgfgiPPpomJ6o/d76oGwPgCOKJ8uKqY3er+nKwBHmE+noqRG7/fUA199U/AI8+kEwEbv93QHoEhZTnA+nYqSGr3fBoAtaiqBUImdm5hPJwA2er+nKwBHnE+X1gUzSbnR+z11wPj/AeCpPDD3t7rvAAAAAElFTkSuQmCC",smaa_default="uniform sampler2D weightMap;varying vec2 vOffset0;varying vec2 vOffset1;void movec(const in bvec2 c,inout vec2 variable,const in vec2 value){if(c.x){variable.x=value.x;}if(c.y){variable.y=value.y;}}void movec(const in bvec4 c,inout vec4 variable,const in vec4 value){movec(c.xy,variable.xy,value.xy);movec(c.zw,variable.zw,value.zw);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 a;a.x=texture2D(weightMap,vOffset0).a;a.y=texture2D(weightMap,vOffset1).g;a.wz=texture2D(weightMap,uv).rb;vec4 color=inputColor;if(dot(a,vec4(1.0))>=1e-5){bool h=max(a.x,a.z)>max(a.y,a.w);vec4 blendingOffset=vec4(0.0,a.y,0.0,a.w);vec2 blendingWeight=a.yw;movec(bvec4(h),blendingOffset,vec4(a.x,0.0,a.z,0.0));movec(bvec2(h),blendingWeight,a.xz);blendingWeight/=dot(blendingWeight,vec2(1.0));vec4 blendingCoord=blendingOffset*vec4(texelSize,-texelSize)+uv.xyxy;color=blendingWeight.x*texture2D(inputBuffer,blendingCoord.xy);color+=blendingWeight.y*texture2D(inputBuffer,blendingCoord.zw);}outputColor=color;}",smaa_default2="varying vec2 vOffset0;varying vec2 vOffset1;void mainSupport(const in vec2 uv){vOffset0=uv+texelSize*vec2(1.0,0.0);vOffset1=uv+texelSize*vec2(0.0,1.0);}",SMAAEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,preset:er=SMAAPreset.MEDIUM,edgeDetectionMode:tr=EdgeDetectionMode.COLOR,predicationMode:ir=PredicationMode.DISABLED}={}){super("SMAAEffect",smaa_default,{vertexShader:smaa_default2,blendFunction:rr,attributes:EffectAttribute.CONVOLUTION|EffectAttribute.DEPTH,uniforms:new Map([["weightMap",new Uniform(null)]])});let nr,sr;arguments.length>1&&(nr=arguments[0],sr=arguments[1],arguments.length>2&&(er=arguments[2]),arguments.length>3&&(tr=arguments[3])),this.renderTargetEdges=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetEdges.texture.name="SMAA.Edges",this.renderTargetWeights=this.renderTargetEdges.clone(),this.renderTargetWeights.texture.name="SMAA.Weights",this.uniforms.get("weightMap").value=this.renderTargetWeights.texture,this.clearPass=new ClearPass(!0,!1,!1),this.clearPass.overrideClearColor=new Color(0),this.clearPass.overrideClearAlpha=1,this.edgeDetectionPass=new ShaderPass(new EdgeDetectionMaterial),this.edgeDetectionMaterial.edgeDetectionMode=tr,this.edgeDetectionMaterial.predicationMode=ir,this.weightsPass=new ShaderPass(new SMAAWeightsMaterial);const ar=new LoadingManager;ar.onLoad=()=>{const or=new Texture(nr);or.name="SMAA.Search",or.magFilter=NearestFilter,or.minFilter=NearestFilter,or.generateMipmaps=!1,or.needsUpdate=!0,or.flipY=!0,this.weightsMaterial.searchTexture=or;const lr=new Texture(sr);lr.name="SMAA.Area",lr.magFilter=LinearFilter,lr.minFilter=LinearFilter,lr.generateMipmaps=!1,lr.needsUpdate=!0,lr.flipY=!1,this.weightsMaterial.areaTexture=lr,this.dispatchEvent({type:"load"})},ar.itemStart("search"),ar.itemStart("area"),nr!==void 0&&sr!==void 0?(ar.itemEnd("search"),ar.itemEnd("area")):typeof Image<"u"&&(nr=new Image,sr=new Image,nr.addEventListener("load",()=>ar.itemEnd("search")),sr.addEventListener("load",()=>ar.itemEnd("area")),nr.src=searchImageDataURL_default,sr.src=areaImageDataURL_default),this.applyPreset(er)}get edgesTexture(){return this.renderTargetEdges.texture}getEdgesTexture(){return this.edgesTexture}get weightsTexture(){return this.renderTargetWeights.texture}getWeightsTexture(){return this.weightsTexture}get edgeDetectionMaterial(){return this.edgeDetectionPass.fullscreenMaterial}get colorEdgesMaterial(){return this.edgeDetectionMaterial}getEdgeDetectionMaterial(){return this.edgeDetectionMaterial}get weightsMaterial(){return this.weightsPass.fullscreenMaterial}getWeightsMaterial(){return this.weightsMaterial}setEdgeDetectionThreshold(rr){this.edgeDetectionMaterial.edgeDetectionThreshold=rr}setOrthogonalSearchSteps(rr){this.weightsMaterial.orthogonalSearchSteps=rr}applyPreset(rr){const er=this.edgeDetectionMaterial,tr=this.weightsMaterial;switch(rr){case SMAAPreset.LOW:er.edgeDetectionThreshold=.15,tr.orthogonalSearchSteps=4,tr.diagonalDetection=!1,tr.cornerDetection=!1;break;case SMAAPreset.MEDIUM:er.edgeDetectionThreshold=.1,tr.orthogonalSearchSteps=8,tr.diagonalDetection=!1,tr.cornerDetection=!1;break;case SMAAPreset.HIGH:er.edgeDetectionThreshold=.1,tr.orthogonalSearchSteps=16,tr.diagonalSearchSteps=8,tr.cornerRounding=25,tr.diagonalDetection=!0,tr.cornerDetection=!0;break;case SMAAPreset.ULTRA:er.edgeDetectionThreshold=.05,tr.orthogonalSearchSteps=32,tr.diagonalSearchSteps=16,tr.cornerRounding=25,tr.diagonalDetection=!0,tr.cornerDetection=!0;break}}setDepthTexture(rr,er=BasicDepthPacking){this.edgeDetectionMaterial.depthBuffer=rr,this.edgeDetectionMaterial.depthPacking=er}update(rr,er,tr){this.clearPass.render(rr,this.renderTargetEdges),this.edgeDetectionPass.render(rr,er,this.renderTargetEdges),this.weightsPass.render(rr,this.renderTargetEdges,this.renderTargetWeights)}setSize(rr,er){this.edgeDetectionMaterial.setSize(rr,er),this.weightsMaterial.setSize(rr,er),this.renderTargetEdges.setSize(rr,er),this.renderTargetWeights.setSize(rr,er)}dispose(){const{searchTexture:rr,areaTexture:er}=this.weightsMaterial;rr!==null&&er!==null&&(rr.dispose(),er.dispose()),super.dispose()}static get searchImageDataURL(){return searchImageDataURL_default}static get areaImageDataURL(){return areaImageDataURL_default}},ssao_default=`#include <common>
#include <packing>
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
uniform lowp sampler2D normalBuffer;
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
uniform lowp sampler2D noiseTexture;uniform mat4 inverseProjectionMatrix;uniform mat4 projectionMatrix;uniform vec2 texelSize;uniform vec2 cameraNearFar;uniform float intensity;uniform float minRadiusScale;uniform float fade;uniform float bias;uniform vec2 distanceCutoff;uniform vec2 proximityCutoff;varying vec2 vUv;varying vec2 vUv2;float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 getViewPosition(const in vec2 screenPosition,const in float depth,const in float viewZ){vec4 clipPosition=vec4(vec3(screenPosition,depth)*2.0-1.0,1.0);float clipW=projectionMatrix[2][3]*viewZ+projectionMatrix[3][3];clipPosition*=clipW;return(inverseProjectionMatrix*clipPosition).xyz;}float getAmbientOcclusion(const in vec3 p,const in vec3 n,const in float depth,const in vec2 uv){float radiusScale=1.0-smoothstep(0.0,distanceCutoff.y,depth);radiusScale=radiusScale*(1.0-minRadiusScale)+minRadiusScale;float radius=RADIUS*radiusScale;float noise=texture2D(noiseTexture,vUv2).r;float baseAngle=noise*PI2;float rings=SPIRAL_TURNS*PI2;float occlusion=0.0;int taps=0;for(int i=0;i<SAMPLES_INT;++i){float alpha=(float(i)+0.5)*INV_SAMPLES_FLOAT;float angle=alpha*rings+baseAngle;vec2 rotation=vec2(cos(angle),sin(angle));vec2 coords=alpha*radius*rotation*texelSize+uv;if(coords.s<0.0||coords.s>1.0||coords.t<0.0||coords.t>1.0){continue;}float sampleDepth=readDepth(coords);float viewZ=getViewZ(sampleDepth);
#ifdef PERSPECTIVE_CAMERA
float linearSampleDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearSampleDepth=sampleDepth;
#endif
float proximity=abs(depth-linearSampleDepth);if(proximity<proximityCutoff.y){float falloff=1.0-smoothstep(proximityCutoff.x,proximityCutoff.y,proximity);vec3 Q=getViewPosition(coords,sampleDepth,viewZ);vec3 v=Q-p;float vv=dot(v,v);float vn=dot(v,n)-bias;float f=max(RADIUS_SQ-vv,0.0)/RADIUS_SQ;occlusion+=(f*f*f*max(vn/(fade+vv),0.0))*falloff;}++taps;}return occlusion/(4.0*max(float(taps),1.0));}void main(){
#ifdef NORMAL_DEPTH
vec4 normalDepth=texture2D(normalDepthBuffer,vUv);
#else
vec4 normalDepth=vec4(texture2D(normalBuffer,vUv).xyz,readDepth(vUv));
#endif
float ao=0.0;float depth=normalDepth.a;float viewZ=getViewZ(depth);
#ifdef PERSPECTIVE_CAMERA
float linearDepth=viewZToOrthographicDepth(viewZ,cameraNearFar.x,cameraNearFar.y);
#else
float linearDepth=depth;
#endif
if(linearDepth<distanceCutoff.y){vec3 viewPosition=getViewPosition(vUv,depth,viewZ);vec3 viewNormal=unpackRGBToNormal(normalDepth.rgb);ao+=getAmbientOcclusion(viewPosition,viewNormal,linearDepth,vUv);float d=smoothstep(distanceCutoff.x,distanceCutoff.y,linearDepth);ao=mix(ao,0.0,d);
#ifdef LEGACY_INTENSITY
ao=clamp(1.0-pow(1.0-ao,abs(intensity)),0.0,1.0);
#endif
}gl_FragColor.r=ao;}`,ssao_default2="uniform vec2 noiseScale;varying vec2 vUv;varying vec2 vUv2;void main(){vUv=position.xy*0.5+0.5;vUv2=vUv*noiseScale;gl_Position=vec4(position.xy,1.0,1.0);}",SSAOMaterial=class extends ShaderMaterial{constructor(rr){super({name:"SSAOMaterial",defines:{SAMPLES_INT:"0",INV_SAMPLES_FLOAT:"0.0",SPIRAL_TURNS:"0.0",RADIUS:"1.0",RADIUS_SQ:"1.0",DISTANCE_SCALING:"1",DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Uniform(null),normalBuffer:new Uniform(null),normalDepthBuffer:new Uniform(null),noiseTexture:new Uniform(null),inverseProjectionMatrix:new Uniform(new Matrix4),projectionMatrix:new Uniform(new Matrix4),texelSize:new Uniform(new Vector2),cameraNearFar:new Uniform(new Vector2),distanceCutoff:new Uniform(new Vector2),proximityCutoff:new Uniform(new Vector2),noiseScale:new Uniform(new Vector2),minRadiusScale:new Uniform(.33),intensity:new Uniform(1),fade:new Uniform(.01),bias:new Uniform(0)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ssao_default,vertexShader:ssao_default2}),this.copyCameraSettings(rr),this.resolution=new Vector2,this.r=1}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set normalDepthBuffer(rr){this.uniforms.normalDepthBuffer.value=rr,rr!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}setNormalDepthBuffer(rr){this.normalDepthBuffer=rr}set normalBuffer(rr){this.uniforms.normalBuffer.value=rr}setNormalBuffer(rr){this.uniforms.normalBuffer.value=rr}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.depthPacking=er}set noiseTexture(rr){this.uniforms.noiseTexture.value=rr}setNoiseTexture(rr){this.uniforms.noiseTexture.value=rr}get samples(){return Number(this.defines.SAMPLES_INT)}set samples(rr){this.defines.SAMPLES_INT=rr.toFixed(0),this.defines.INV_SAMPLES_FLOAT=(1/rr).toFixed(9),this.needsUpdate=!0}getSamples(){return this.samples}setSamples(rr){this.samples=rr}get rings(){return Number(this.defines.SPIRAL_TURNS)}set rings(rr){this.defines.SPIRAL_TURNS=rr.toFixed(1),this.needsUpdate=!0}getRings(){return this.rings}setRings(rr){this.rings=rr}get intensity(){return this.uniforms.intensity.value}set intensity(rr){this.uniforms.intensity.value=rr,this.defines.LEGACY_INTENSITY===void 0&&(this.defines.LEGACY_INTENSITY="1",this.needsUpdate=!0)}getIntensity(){return this.uniforms.intensity.value}setIntensity(rr){this.uniforms.intensity.value=rr}get fade(){return this.uniforms.fade.value}set fade(rr){this.uniforms.fade.value=rr}getFade(){return this.uniforms.fade.value}setFade(rr){this.uniforms.fade.value=rr}get bias(){return this.uniforms.bias.value}set bias(rr){this.uniforms.bias.value=rr}getBias(){return this.uniforms.bias.value}setBias(rr){this.uniforms.bias.value=rr}get minRadiusScale(){return this.uniforms.minRadiusScale.value}set minRadiusScale(rr){this.uniforms.minRadiusScale.value=rr}getMinRadiusScale(){return this.uniforms.minRadiusScale.value}setMinRadiusScale(rr){this.uniforms.minRadiusScale.value=rr}updateRadius(){const rr=this.r*this.resolution.height;this.defines.RADIUS=rr.toFixed(11),this.defines.RADIUS_SQ=(rr*rr).toFixed(11),this.needsUpdate=!0}get radius(){return this.r}set radius(rr){this.r=Math.min(Math.max(rr,1e-6),1),this.updateRadius()}getRadius(){return this.radius}setRadius(rr){this.radius=rr}get distanceScaling(){return!0}set distanceScaling(rr){}isDistanceScalingEnabled(){return this.distanceScaling}setDistanceScalingEnabled(rr){this.distanceScaling=rr}get distanceThreshold(){return this.uniforms.distanceCutoff.value.x}set distanceThreshold(rr){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(rr,0),1),Math.min(Math.max(rr+this.distanceFalloff,0),1))}get worldDistanceThreshold(){return-orthographicDepthToViewZ(this.distanceThreshold,this.near,this.far)}set worldDistanceThreshold(rr){this.distanceThreshold=viewZToOrthographicDepth(-rr,this.near,this.far)}get distanceFalloff(){return this.uniforms.distanceCutoff.value.y-this.distanceThreshold}set distanceFalloff(rr){this.uniforms.distanceCutoff.value.y=Math.min(Math.max(this.distanceThreshold+rr,0),1)}get worldDistanceFalloff(){return-orthographicDepthToViewZ(this.distanceFalloff,this.near,this.far)}set worldDistanceFalloff(rr){this.distanceFalloff=viewZToOrthographicDepth(-rr,this.near,this.far)}setDistanceCutoff(rr,er){this.uniforms.distanceCutoff.value.set(Math.min(Math.max(rr,0),1),Math.min(Math.max(rr+er,0),1))}get proximityThreshold(){return this.uniforms.proximityCutoff.value.x}set proximityThreshold(rr){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(rr,0),1),Math.min(Math.max(rr+this.proximityFalloff,0),1))}get worldProximityThreshold(){return-orthographicDepthToViewZ(this.proximityThreshold,this.near,this.far)}set worldProximityThreshold(rr){this.proximityThreshold=viewZToOrthographicDepth(-rr,this.near,this.far)}get proximityFalloff(){return this.uniforms.proximityCutoff.value.y-this.proximityThreshold}set proximityFalloff(rr){this.uniforms.proximityCutoff.value.y=Math.min(Math.max(this.proximityThreshold+rr,0),1)}get worldProximityFalloff(){return-orthographicDepthToViewZ(this.proximityFalloff,this.near,this.far)}set worldProximityFalloff(rr){this.proximityFalloff=viewZToOrthographicDepth(-rr,this.near,this.far)}setProximityCutoff(rr,er){this.uniforms.proximityCutoff.value.set(Math.min(Math.max(rr,0),1),Math.min(Math.max(rr+er,0),1))}setTexelSize(rr,er){this.uniforms.texelSize.value.set(rr,er)}adoptCameraSettings(rr){this.copyCameraSettings(rr)}copyCameraSettings(rr){rr&&(this.uniforms.cameraNearFar.value.set(rr.near,rr.far),this.uniforms.projectionMatrix.value.copy(rr.projectionMatrix),this.uniforms.inverseProjectionMatrix.value.copy(rr.projectionMatrix).invert(),rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(rr,er){const tr=this.uniforms,ir=tr.noiseTexture.value;ir!==null&&tr.noiseScale.value.set(rr/ir.image.width,er/ir.image.height),tr.texelSize.value.set(1/rr,1/er),this.resolution.set(rr,er),this.updateRadius()}},depth_downsampling_default=`#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
#ifdef DOWNSAMPLE_NORMALS
uniform lowp sampler2D normalBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}int findBestDepth(const in float samples[4]){float c=(samples[0]+samples[1]+samples[2]+samples[3])*0.25;float distances[4];distances[0]=abs(c-samples[0]);distances[1]=abs(c-samples[1]);distances[2]=abs(c-samples[2]);distances[3]=abs(c-samples[3]);float maxDistance=max(max(distances[0],distances[1]),max(distances[2],distances[3]));int remaining[3];int rejected[3];int i,j,k;for(i=0,j=0,k=0;i<4;++i){if(distances[i]<maxDistance){remaining[j++]=i;}else{rejected[k++]=i;}}for(;j<3;++j){remaining[j]=rejected[--k];}vec3 s=vec3(samples[remaining[0]],samples[remaining[1]],samples[remaining[2]]);c=(s.x+s.y+s.z)/3.0;distances[0]=abs(c-s.x);distances[1]=abs(c-s.y);distances[2]=abs(c-s.z);float minDistance=min(distances[0],min(distances[1],distances[2]));for(i=0;i<3;++i){if(distances[i]==minDistance){break;}}return remaining[i];}void main(){float d[4];d[0]=readDepth(vUv0);d[1]=readDepth(vUv1);d[2]=readDepth(vUv2);d[3]=readDepth(vUv3);int index=findBestDepth(d);
#ifdef DOWNSAMPLE_NORMALS
vec3 n[4];n[0]=texture2D(normalBuffer,vUv0).rgb;n[1]=texture2D(normalBuffer,vUv1).rgb;n[2]=texture2D(normalBuffer,vUv2).rgb;n[3]=texture2D(normalBuffer,vUv3).rgb;
#else
vec3 n[4];n[0]=vec3(0.0);n[1]=vec3(0.0);n[2]=vec3(0.0);n[3]=vec3(0.0);
#endif
gl_FragColor=vec4(n[index],d[index]);}`,depth_downsampling_default2="uniform vec2 texelSize;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vUv0=uv;vUv1=vec2(uv.x,uv.y+texelSize.y);vUv2=vec2(uv.x+texelSize.x,uv.y);vUv3=uv+texelSize;gl_Position=vec4(position.xy,1.0,1.0);}",DepthDownsamplingMaterial=class extends ShaderMaterial{constructor(){super({name:"DepthDownsamplingMaterial",defines:{DEPTH_PACKING:"0"},uniforms:{depthBuffer:new Uniform(null),normalBuffer:new Uniform(null),texelSize:new Uniform(new Vector2)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:depth_downsampling_default,vertexShader:depth_downsampling_default2})}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.depthPacking=er}set normalBuffer(rr){this.uniforms.normalBuffer.value=rr,rr!==null?this.defines.DOWNSAMPLE_NORMALS="1":delete this.defines.DOWNSAMPLE_NORMALS,this.needsUpdate=!0}setNormalBuffer(rr){this.normalBuffer=rr}setTexelSize(rr,er){this.uniforms.texelSize.value.set(rr,er)}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},DepthDownsamplingPass=class extends Pass{constructor({normalBuffer:rr=null,resolutionScale:er=.5,width:tr=Resolution.AUTO_SIZE,height:ir=Resolution.AUTO_SIZE,resolutionX:nr=tr,resolutionY:sr=ir}={}){super("DepthDownsamplingPass");const ar=new DepthDownsamplingMaterial;ar.normalBuffer=rr,this.fullscreenMaterial=ar,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,depthBuffer:!1,type:FloatType}),this.renderTarget.texture.name="DepthDownsamplingPass.Target",this.renderTarget.texture.generateMipmaps=!1;const or=this.resolution=new Resolution(this,nr,sr,er);or.addEventListener("change",lr=>this.setSize(or.baseWidth,or.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}setDepthTexture(rr,er=BasicDepthPacking){this.fullscreenMaterial.depthBuffer=rr,this.fullscreenMaterial.depthPacking=er}render(rr,er,tr,ir,nr){rr.setRenderTarget(this.renderToScreen?null:this.renderTarget),rr.render(this.scene,this.camera)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height),this.fullscreenMaterial.setSize(rr,er)}initialize(rr,er,tr){const ir=rr.getContext();if(!(ir.getExtension("EXT_color_buffer_float")||ir.getExtension("EXT_color_buffer_half_float")))throw new Error("Rendering to float texture is not supported.")}},ssao_default3=`uniform lowp sampler2D aoBuffer;uniform float luminanceInfluence;uniform float intensity;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH)
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
#endif
#ifdef COLORIZE
uniform vec3 color;
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,const in float depth,out vec4 outputColor){float aoLinear=texture2D(aoBuffer,uv).r;
#if defined(DEPTH_AWARE_UPSAMPLING) && defined(NORMAL_DEPTH) && __VERSION__ == 300
vec4 normalDepth[4];normalDepth[0]=textureOffset(normalDepthBuffer,uv,ivec2(0,0));normalDepth[1]=textureOffset(normalDepthBuffer,uv,ivec2(0,1));normalDepth[2]=textureOffset(normalDepthBuffer,uv,ivec2(1,0));normalDepth[3]=textureOffset(normalDepthBuffer,uv,ivec2(1,1));float dot01=dot(normalDepth[0].rgb,normalDepth[1].rgb);float dot02=dot(normalDepth[0].rgb,normalDepth[2].rgb);float dot03=dot(normalDepth[0].rgb,normalDepth[3].rgb);float minDot=min(dot01,min(dot02,dot03));float s=step(THRESHOLD,minDot);float smallestDistance=1.0;int index;for(int i=0;i<4;++i){float distance=abs(depth-normalDepth[i].a);if(distance<smallestDistance){smallestDistance=distance;index=i;}}ivec2 offsets[4];offsets[0]=ivec2(0,0);offsets[1]=ivec2(0,1);offsets[2]=ivec2(1,0);offsets[3]=ivec2(1,1);ivec2 coord=ivec2(uv*vec2(textureSize(aoBuffer,0)))+offsets[index];float aoNearest=texelFetch(aoBuffer,coord,0).r;float ao=mix(aoNearest,aoLinear,s);
#else
float ao=aoLinear;
#endif
float l=luminance(inputColor.rgb);ao=mix(ao,0.0,l*luminanceInfluence);ao=clamp(ao*intensity,0.0,1.0);
#ifdef COLORIZE
outputColor=vec4(1.0-ao*(1.0-color),inputColor.a);
#else
outputColor=vec4(vec3(1.0-ao),inputColor.a);
#endif
}`,NOISE_TEXTURE_SIZE=64,SSAOEffect=class extends Effect{constructor(rr,er,{blendFunction:tr=BlendFunction.MULTIPLY,samples:ir=9,rings:nr=7,normalDepthBuffer:sr=null,depthAwareUpsampling:ar=!0,worldDistanceThreshold:or,worldDistanceFalloff:lr,worldProximityThreshold:cr,worldProximityFalloff:ur,distanceThreshold:dr=.97,distanceFalloff:hr=.03,rangeThreshold:pr=5e-4,rangeFalloff:gr=.001,minRadiusScale:vr=.1,luminanceInfluence:mr=.7,radius:fr=.1825,intensity:_r=1,bias:Ar=.025,fade:yr=.01,color:wr=null,resolutionScale:xr=1,width:Sr=Resolution.AUTO_SIZE,height:br=Resolution.AUTO_SIZE,resolutionX:Cr=Sr,resolutionY:Ir=br}={}){super("SSAOEffect",ssao_default3,{blendFunction:tr,attributes:EffectAttribute.DEPTH,defines:new Map([["THRESHOLD","0.997"]]),uniforms:new Map([["aoBuffer",new Uniform(null)],["normalDepthBuffer",new Uniform(sr)],["luminanceInfluence",new Uniform(mr)],["color",new Uniform(null)],["intensity",new Uniform(_r)],["scale",new Uniform(0)]])}),this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="AO.Target",this.uniforms.get("aoBuffer").value=this.renderTarget.texture;const Rr=this.resolution=new Resolution(this,Cr,Ir,xr);Rr.addEventListener("change",Fr=>this.setSize(Rr.baseWidth,Rr.baseHeight)),this.camera=rr,this.depthDownsamplingPass=new DepthDownsamplingPass({normalBuffer:er,resolutionScale:xr}),this.depthDownsamplingPass.enabled=sr===null,this.ssaoPass=new ShaderPass(new SSAOMaterial(rr));const Pr=new NoiseTexture(NOISE_TEXTURE_SIZE,NOISE_TEXTURE_SIZE,RGBAFormat);Pr.wrapS=Pr.wrapT=RepeatWrapping;const Dr=this.ssaoMaterial;Dr.normalBuffer=er,Dr.noiseTexture=Pr,Dr.minRadiusScale=vr,Dr.samples=ir,Dr.radius=fr,Dr.rings=nr,Dr.fade=yr,Dr.bias=Ar,Dr.distanceThreshold=dr,Dr.distanceFalloff=hr,Dr.proximityThreshold=pr,Dr.proximityFalloff=gr,or!==void 0&&(Dr.worldDistanceThreshold=or),lr!==void 0&&(Dr.worldDistanceFalloff=lr),cr!==void 0&&(Dr.worldProximityThreshold=cr),ur!==void 0&&(Dr.worldProximityFalloff=ur),sr!==null&&(this.ssaoMaterial.normalDepthBuffer=sr,this.defines.set("NORMAL_DEPTH","1")),this.depthAwareUpsampling=ar,this.color=wr}set mainCamera(rr){this.camera=rr,this.ssaoMaterial.copyCameraSettings(rr)}get normalBuffer(){return this.ssaoMaterial.normalBuffer}set normalBuffer(rr){this.ssaoMaterial.normalBuffer=rr,this.depthDownsamplingPass.fullscreenMaterial.normalBuffer=rr}getResolution(){return this.resolution}get ssaoMaterial(){return this.ssaoPass.fullscreenMaterial}getSSAOMaterial(){return this.ssaoMaterial}get samples(){return this.ssaoMaterial.samples}set samples(rr){this.ssaoMaterial.samples=rr}get rings(){return this.ssaoMaterial.rings}set rings(rr){this.ssaoMaterial.rings=rr}get radius(){return this.ssaoMaterial.radius}set radius(rr){this.ssaoMaterial.radius=rr}get depthAwareUpsampling(){return this.defines.has("DEPTH_AWARE_UPSAMPLING")}set depthAwareUpsampling(rr){this.depthAwareUpsampling!==rr&&(rr?this.defines.set("DEPTH_AWARE_UPSAMPLING","1"):this.defines.delete("DEPTH_AWARE_UPSAMPLING"),this.setChanged())}isDepthAwareUpsamplingEnabled(){return this.depthAwareUpsampling}setDepthAwareUpsamplingEnabled(rr){this.depthAwareUpsampling=rr}get distanceScaling(){return!0}set distanceScaling(rr){}get color(){return this.uniforms.get("color").value}set color(rr){const er=this.uniforms,tr=this.defines;rr!==null?tr.has("COLORIZE")?er.get("color").value.set(rr):(tr.set("COLORIZE","1"),er.get("color").value=new Color(rr),this.setChanged()):tr.has("COLORIZE")&&(tr.delete("COLORIZE"),er.get("color").value=null,this.setChanged())}get luminanceInfluence(){return this.uniforms.get("luminanceInfluence").value}set luminanceInfluence(rr){this.uniforms.get("luminanceInfluence").value=rr}get intensity(){return this.uniforms.get("intensity").value}set intensity(rr){this.uniforms.get("intensity").value=rr}getColor(){return this.color}setColor(rr){this.color=rr}setDistanceCutoff(rr,er){this.ssaoMaterial.distanceThreshold=rr,this.ssaoMaterial.distanceFalloff=er}setProximityCutoff(rr,er){this.ssaoMaterial.proximityThreshold=rr,this.ssaoMaterial.proximityFalloff=er}setDepthTexture(rr,er=BasicDepthPacking){this.depthDownsamplingPass.setDepthTexture(rr,er),this.ssaoMaterial.depthBuffer=rr,this.ssaoMaterial.depthPacking=er}update(rr,er,tr){const ir=this.renderTarget;this.depthDownsamplingPass.enabled&&this.depthDownsamplingPass.render(rr),this.ssaoPass.render(rr,null,ir)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.ssaoMaterial.copyCameraSettings(this.camera),this.ssaoMaterial.setSize(ir,nr),this.renderTarget.setSize(ir,nr),this.depthDownsamplingPass.resolution.scale=tr.scale,this.depthDownsamplingPass.setSize(rr,er)}initialize(rr,er,tr){try{let ir=this.uniforms.get("normalDepthBuffer").value;ir===null&&(this.depthDownsamplingPass.initialize(rr,er,tr),ir=this.depthDownsamplingPass.texture,this.uniforms.get("normalDepthBuffer").value=ir,this.ssaoMaterial.normalDepthBuffer=ir,this.defines.set("NORMAL_DEPTH","1"))}catch{this.depthDownsamplingPass.enabled=!1}}},texture_default=`#ifdef TEXTURE_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
varying vec2 vUv2;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#ifdef UV_TRANSFORM
vec4 texel=texture2D(map,vUv2);
#else
vec4 texel=texture2D(map,uv);
#endif
outputColor=TEXEL;}`,texture_default2=`#ifdef ASPECT_CORRECTION
uniform float scale;
#else
uniform mat3 uvTransform;
#endif
varying vec2 vUv2;void mainSupport(const in vec2 uv){
#ifdef ASPECT_CORRECTION
vUv2=uv*vec2(aspect,1.0)*scale;
#else
vUv2=(uvTransform*vec3(uv,1.0)).xy;
#endif
}`,TextureEffect=class extends Effect{constructor({blendFunction:rr,texture:er=null,aspectCorrection:tr=!1}={}){super("TextureEffect",texture_default,{blendFunction:rr,defines:new Map([["TEXEL","texel"]]),uniforms:new Map([["map",new Uniform(null)],["scale",new Uniform(1)],["uvTransform",new Uniform(null)]])}),this.texture=er,this.aspectCorrection=tr}get texture(){return this.uniforms.get("map").value}set texture(rr){const er=this.texture,tr=this.uniforms,ir=this.defines;er!==rr&&(tr.get("map").value=rr,tr.get("uvTransform").value=rr.matrix,ir.delete("TEXTURE_PRECISION_HIGH"),rr!==null&&(rr.matrixAutoUpdate?(ir.set("UV_TRANSFORM","1"),this.setVertexShader(texture_default2)):(ir.delete("UV_TRANSFORM"),this.setVertexShader(null)),rr.type!==UnsignedByteType&&ir.set("TEXTURE_PRECISION_HIGH","1"),(er===null||er.type!==rr.type||er.encoding!==rr.encoding)&&this.setChanged()))}getTexture(){return this.texture}setTexture(rr){this.texture=rr}get aspectCorrection(){return this.defines.has("ASPECT_CORRECTION")}set aspectCorrection(rr){this.aspectCorrection!==rr&&(rr?this.defines.set("ASPECT_CORRECTION","1"):this.defines.delete("ASPECT_CORRECTION"),this.setChanged())}get uvTransform(){const rr=this.texture;return rr!==null&&rr.matrixAutoUpdate}set uvTransform(rr){const er=this.texture;er!==null&&(er.matrixAutoUpdate=rr)}setTextureSwizzleRGBA(rr,er=rr,tr=rr,ir=rr){const nr="rgba";let sr="";(rr!==ColorChannel.RED||er!==ColorChannel.GREEN||tr!==ColorChannel.BLUE||ir!==ColorChannel.ALPHA)&&(sr=[".",nr[rr],nr[er],nr[tr],nr[ir]].join("")),this.defines.set("TEXEL","texel"+sr),this.setChanged()}update(rr,er,tr){this.texture.matrixAutoUpdate&&this.texture.updateMatrix()}},convolution_tilt_shift_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec4 maskParams;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;float linearGradientMask(const in float x){return smoothstep(maskParams.x,maskParams.y,x)-smoothstep(maskParams.w,maskParams.z,x);}void main(){vec2 dUv=vOffset*(1.0-linearGradientMask(vUv2.y));vec4 sum=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y+dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x+dUv.x,vUv.y-dUv.y));sum+=texture2D(inputBuffer,vec2(vUv.x-dUv.x,vUv.y-dUv.y));gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,convolution_tilt_shift_default2="uniform vec4 texelSize;uniform float kernel;uniform float scale;uniform float aspect;uniform vec2 rotation;varying vec2 vUv;varying vec2 vUv2;varying vec2 vOffset;void main(){vec2 uv=position.xy*0.5+0.5;vUv=uv;vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));vOffset=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;gl_Position=vec4(position.xy,1.0,1.0);}",TiltShiftBlurMaterial=class extends KawaseBlurMaterial{constructor({kernelSize:rr=KernelSize.MEDIUM,offset:er=0,rotation:tr=0,focusArea:ir=.4,feather:nr=.3}={}){super(),this.fragmentShader=convolution_tilt_shift_default,this.vertexShader=convolution_tilt_shift_default2,this.kernelSize=rr,this.uniforms.aspect=new Uniform(1),this.uniforms.rotation=new Uniform(new Vector2),this.uniforms.maskParams=new Uniform(new Vector4),this._offset=er,this._focusArea=ir,this._feather=nr,this.rotation=tr,this.updateParams()}updateParams(){const rr=this.uniforms.maskParams.value,er=Math.max(this.focusArea,0),tr=Math.max(er-this.feather,0);rr.set(this.offset-er,this.offset-tr,this.offset+er,this.offset+tr)}get rotation(){return Math.acos(this.uniforms.rotation.value.x)}set rotation(rr){this.uniforms.rotation.value.set(Math.cos(rr),Math.sin(rr))}get offset(){return this._offset}set offset(rr){this._offset=rr,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(rr){this._focusArea=rr,this.updateParams()}get feather(){return this._feather}set feather(rr){this._feather=rr,this.updateParams()}setSize(rr,er){super.setSize(rr,er),this.uniforms.aspect.value=rr/er}},TiltShiftBlurPass=class extends KawaseBlurPass{constructor({offset:rr=0,rotation:er=0,focusArea:tr=.4,feather:ir=.3,kernelSize:nr=KernelSize.MEDIUM,resolutionScale:sr=.5,resolutionX:ar=Resolution.AUTO_SIZE,resolutionY:or=Resolution.AUTO_SIZE}={}){super({kernelSize:nr,resolutionScale:sr,resolutionX:ar,resolutionY:or}),this.blurMaterial=new TiltShiftBlurMaterial({kernelSize:nr,offset:rr,rotation:er,focusArea:tr,feather:ir})}},tilt_shift_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform vec2 maskParams;varying vec2 vUv2;float linearGradientMask(const in float x){return step(maskParams.x,x)-step(maskParams.y,x);}void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){float mask=linearGradientMask(vUv2.y);vec4 texel=texture2D(map,uv);outputColor=mix(texel,inputColor,mask);}`,tilt_shift_default2="uniform vec2 rotation;varying vec2 vUv2;void mainSupport(const in vec2 uv){vUv2=(uv-0.5)*2.0*vec2(aspect,1.0);vUv2=vec2(dot(rotation,vUv2),dot(rotation,vec2(vUv2.y,-vUv2.x)));}",TiltShiftEffect=class extends Effect{constructor({blendFunction:rr,offset:er=0,rotation:tr=0,focusArea:ir=.4,feather:nr=.3,kernelSize:sr=KernelSize.MEDIUM,resolutionScale:ar=.5,resolutionX:or=Resolution.AUTO_SIZE,resolutionY:lr=Resolution.AUTO_SIZE}={}){super("TiltShiftEffect",tilt_shift_default,{vertexShader:tilt_shift_default2,blendFunction:rr,uniforms:new Map([["rotation",new Uniform(new Vector2)],["maskParams",new Uniform(new Vector2)],["map",new Uniform(null)]])}),this._offset=er,this._focusArea=ir,this._feather=nr,this.renderTarget=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="TiltShift.Target",this.uniforms.get("map").value=this.renderTarget.texture,this.blurPass=new TiltShiftBlurPass({kernelSize:sr,resolutionScale:ar,resolutionX:or,resolutionY:lr,offset:er,rotation:tr,focusArea:ir,feather:nr});const cr=this.resolution=new Resolution(this,or,lr,ar);cr.addEventListener("change",ur=>this.setSize(cr.baseWidth,cr.baseHeight)),this.rotation=tr,this.updateParams()}updateParams(){const rr=this.uniforms.get("maskParams").value,er=Math.max(this.focusArea-this.feather,0);rr.set(this.offset-er,this.offset+er)}get rotation(){return Math.acos(this.uniforms.get("rotation").value.x)}set rotation(rr){this.uniforms.get("rotation").value.set(Math.cos(rr),Math.sin(rr)),this.blurPass.blurMaterial.rotation=rr}get offset(){return this._offset}set offset(rr){this._offset=rr,this.blurPass.blurMaterial.offset=rr,this.updateParams()}get focusArea(){return this._focusArea}set focusArea(rr){this._focusArea=rr,this.blurPass.blurMaterial.focusArea=rr,this.updateParams()}get feather(){return this._feather}set feather(rr){this._feather=rr,this.blurPass.blurMaterial.feather=rr,this.updateParams()}get bias(){return 0}set bias(rr){}update(rr,er,tr){this.blurPass.render(rr,er,this.renderTarget)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height),this.blurPass.resolution.copy(tr)}initialize(rr,er,tr){this.blurPass.initialize(rr,er,tr),tr!==void 0&&(this.renderTarget.texture.type=tr,rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTarget.texture.colorSpace=SRGBColorSpace))}},adaptive_luminance_default=`#include <packing>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
uniform lowp sampler2D luminanceBuffer0;uniform lowp sampler2D luminanceBuffer1;uniform float minLuminance;uniform float deltaTime;uniform float tau;varying vec2 vUv;void main(){float l0=unpackRGBAToFloat(texture2D(luminanceBuffer0,vUv));
#if __VERSION__ < 300
float l1=texture2DLodEXT(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#else
float l1=textureLod(luminanceBuffer1,vUv,MIP_LEVEL_1X1).r;
#endif
l0=max(minLuminance,l0);l1=max(minLuminance,l1);float adaptedLum=l0+(l1-l0)*(1.0-exp(-deltaTime*tau));gl_FragColor=(adaptedLum==1.0)?vec4(1.0):packFloatToRGBA(adaptedLum);}`,AdaptiveLuminanceMaterial=class extends ShaderMaterial{constructor(){super({name:"AdaptiveLuminanceMaterial",defines:{MIP_LEVEL_1X1:"0.0"},uniforms:{luminanceBuffer0:new Uniform(null),luminanceBuffer1:new Uniform(null),minLuminance:new Uniform(.01),deltaTime:new Uniform(0),tau:new Uniform(1)},extensions:{shaderTextureLOD:!0},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:adaptive_luminance_default,vertexShader:common_default})}set luminanceBuffer0(rr){this.uniforms.luminanceBuffer0.value=rr}setLuminanceBuffer0(rr){this.uniforms.luminanceBuffer0.value=rr}set luminanceBuffer1(rr){this.uniforms.luminanceBuffer1.value=rr}setLuminanceBuffer1(rr){this.uniforms.luminanceBuffer1.value=rr}set mipLevel1x1(rr){this.defines.MIP_LEVEL_1X1=rr.toFixed(1),this.needsUpdate=!0}setMipLevel1x1(rr){this.mipLevel1x1=rr}set deltaTime(rr){this.uniforms.deltaTime.value=rr}setDeltaTime(rr){this.uniforms.deltaTime.value=rr}get minLuminance(){return this.uniforms.minLuminance.value}set minLuminance(rr){this.uniforms.minLuminance.value=rr}getMinLuminance(){return this.uniforms.minLuminance.value}setMinLuminance(rr){this.uniforms.minLuminance.value=rr}get adaptationRate(){return this.uniforms.tau.value}set adaptationRate(rr){this.uniforms.tau.value=rr}getAdaptationRate(){return this.uniforms.tau.value}setAdaptationRate(rr){this.uniforms.tau.value=rr}},AdaptiveLuminancePass=class extends Pass{constructor(rr,{minLuminance:er=.01,adaptationRate:tr=1}={}){super("AdaptiveLuminancePass"),this.fullscreenMaterial=new AdaptiveLuminanceMaterial,this.needsSwap=!1,this.renderTargetPrevious=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter,depthBuffer:!1}),this.renderTargetPrevious.texture.name="Luminance.Previous";const ir=this.fullscreenMaterial;ir.luminanceBuffer0=this.renderTargetPrevious.texture,ir.luminanceBuffer1=rr,ir.minLuminance=er,ir.adaptationRate=tr,this.renderTargetAdapted=this.renderTargetPrevious.clone(),this.renderTargetAdapted.texture.name="Luminance.Adapted",this.copyPass=new CopyPass(this.renderTargetPrevious,!1)}get texture(){return this.renderTargetAdapted.texture}getTexture(){return this.renderTargetAdapted.texture}set mipLevel1x1(rr){this.fullscreenMaterial.mipLevel1x1=rr}get adaptationRate(){return this.fullscreenMaterial.adaptationRate}set adaptationRate(rr){this.fullscreenMaterial.adaptationRate=rr}render(rr,er,tr,ir,nr){this.fullscreenMaterial.deltaTime=ir,rr.setRenderTarget(this.renderToScreen?null:this.renderTargetAdapted),rr.render(this.scene,this.camera),this.copyPass.render(rr,this.renderTargetAdapted)}},tone_mapping_default=`#include <tonemapping_pars_fragment>
uniform float whitePoint;
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
uniform float middleGrey;
#if TONE_MAPPING_MODE == 3
uniform lowp sampler2D luminanceBuffer;
#else
uniform float averageLuminance;
#endif
vec3 Reinhard2ToneMapping(vec3 color){color*=toneMappingExposure;float l=luminance(color);
#if TONE_MAPPING_MODE == 3
float lumAvg=unpackRGBAToFloat(texture2D(luminanceBuffer,vec2(0.5)));
#else
float lumAvg=averageLuminance;
#endif
float lumScaled=(l*middleGrey)/max(lumAvg,1e-6);float lumCompressed=lumScaled*(1.0+lumScaled/(whitePoint*whitePoint));lumCompressed/=(1.0+lumScaled);return clamp(lumCompressed*color,0.0,1.0);}
#elif TONE_MAPPING_MODE == 4
#define A 0.15
#define B 0.50
#define C 0.10
#define D 0.20
#define E 0.02
#define F 0.30
vec3 Uncharted2Helper(const in vec3 x){return((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}vec3 Uncharted2ToneMapping(vec3 color){color*=toneMappingExposure;return clamp(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitePoint)),0.0,1.0);}
#endif
void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){
#if TONE_MAPPING_MODE == 2 || TONE_MAPPING_MODE == 3
outputColor=vec4(Reinhard2ToneMapping(inputColor.rgb),inputColor.a);
#elif TONE_MAPPING_MODE == 4
outputColor=vec4(Uncharted2ToneMapping(inputColor.rgb),inputColor.a);
#else
outputColor=vec4(toneMapping(inputColor.rgb),inputColor.a);
#endif
}`,ToneMappingEffect=class extends Effect{constructor({blendFunction:rr=BlendFunction.SRC,adaptive:er=!1,mode:tr=er?ToneMappingMode.REINHARD2_ADAPTIVE:ToneMappingMode.AGX,resolution:ir=256,maxLuminance:nr=4,whitePoint:sr=nr,middleGrey:ar=.6,minLuminance:or=.01,averageLuminance:lr=1,adaptationRate:cr=1}={}){super("ToneMappingEffect",tone_mapping_default,{blendFunction:rr,uniforms:new Map([["luminanceBuffer",new Uniform(null)],["maxLuminance",new Uniform(nr)],["whitePoint",new Uniform(sr)],["middleGrey",new Uniform(ar)],["averageLuminance",new Uniform(lr)]])}),this.renderTargetLuminance=new WebGLRenderTarget(1,1,{minFilter:LinearMipmapLinearFilter,depthBuffer:!1}),this.renderTargetLuminance.texture.generateMipmaps=!0,this.renderTargetLuminance.texture.name="Luminance",this.luminancePass=new LuminancePass({renderTarget:this.renderTargetLuminance}),this.adaptiveLuminancePass=new AdaptiveLuminancePass(this.luminancePass.texture,{minLuminance:or,adaptationRate:cr}),this.uniforms.get("luminanceBuffer").value=this.adaptiveLuminancePass.texture,this.resolution=ir,this.mode=tr}get mode(){return Number(this.defines.get("TONE_MAPPING_MODE"))}set mode(rr){if(this.mode===rr)return;const tr=REVISION.replace(/\D+/g,"")>=168?"CineonToneMapping(texel)":"OptimizedCineonToneMapping(texel)";switch(this.defines.clear(),this.defines.set("TONE_MAPPING_MODE",rr.toFixed(0)),rr){case ToneMappingMode.LINEAR:this.defines.set("toneMapping(texel)","LinearToneMapping(texel)");break;case ToneMappingMode.REINHARD:this.defines.set("toneMapping(texel)","ReinhardToneMapping(texel)");break;case ToneMappingMode.CINEON:case ToneMappingMode.OPTIMIZED_CINEON:this.defines.set("toneMapping(texel)",tr);break;case ToneMappingMode.ACES_FILMIC:this.defines.set("toneMapping(texel)","ACESFilmicToneMapping(texel)");break;case ToneMappingMode.AGX:this.defines.set("toneMapping(texel)","AgXToneMapping(texel)");break;case ToneMappingMode.NEUTRAL:this.defines.set("toneMapping(texel)","NeutralToneMapping(texel)");break;default:this.defines.set("toneMapping(texel)","texel");break}this.adaptiveLuminancePass.enabled=rr===ToneMappingMode.REINHARD2_ADAPTIVE,this.setChanged()}getMode(){return this.mode}setMode(rr){this.mode=rr}get whitePoint(){return this.uniforms.get("whitePoint").value}set whitePoint(rr){this.uniforms.get("whitePoint").value=rr}get middleGrey(){return this.uniforms.get("middleGrey").value}set middleGrey(rr){this.uniforms.get("middleGrey").value=rr}get averageLuminance(){return this.uniforms.get("averageLuminance").value}set averageLuminance(rr){this.uniforms.get("averageLuminance").value=rr}get adaptiveLuminanceMaterial(){return this.adaptiveLuminancePass.fullscreenMaterial}getAdaptiveLuminanceMaterial(){return this.adaptiveLuminanceMaterial}get resolution(){return this.luminancePass.resolution.width}set resolution(rr){const er=Math.max(0,Math.ceil(Math.log2(rr))),tr=Math.pow(2,er);this.luminancePass.resolution.setPreferredSize(tr,tr),this.adaptiveLuminanceMaterial.mipLevel1x1=er}getResolution(){return this.resolution}setResolution(rr){this.resolution=rr}get adaptive(){return this.mode===ToneMappingMode.REINHARD2_ADAPTIVE}set adaptive(rr){this.mode=rr?ToneMappingMode.REINHARD2_ADAPTIVE:ToneMappingMode.REINHARD2}get adaptationRate(){return this.adaptiveLuminanceMaterial.adaptationRate}set adaptationRate(rr){this.adaptiveLuminanceMaterial.adaptationRate=rr}get distinction(){return console.warn(this.name,"distinction was removed."),1}set distinction(rr){console.warn(this.name,"distinction was removed.")}update(rr,er,tr){this.adaptiveLuminancePass.enabled&&(this.luminancePass.render(rr,er),this.adaptiveLuminancePass.render(rr,null,null,tr))}initialize(rr,er,tr){this.adaptiveLuminancePass.initialize(rr,er,tr)}},vignette_default=`uniform float offset;uniform float darkness;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){const vec2 center=vec2(0.5);vec3 color=inputColor.rgb;
#if VIGNETTE_TECHNIQUE == 0
float d=distance(uv,center);color*=smoothstep(0.8,offset*0.799,d*(darkness+offset));
#else
vec2 coord=(uv-center)*vec2(offset);color=mix(color,vec3(1.0-darkness),dot(coord,coord));
#endif
outputColor=vec4(color,inputColor.a);}`,VignetteEffect=class extends Effect{constructor({blendFunction:rr,eskil:er=!1,technique:tr=er?VignetteTechnique.ESKIL:VignetteTechnique.DEFAULT,offset:ir=.5,darkness:nr=.5}={}){super("VignetteEffect",vignette_default,{blendFunction:rr,defines:new Map([["VIGNETTE_TECHNIQUE",tr.toFixed(0)]]),uniforms:new Map([["offset",new Uniform(ir)],["darkness",new Uniform(nr)]])})}get technique(){return Number(this.defines.get("VIGNETTE_TECHNIQUE"))}set technique(rr){this.technique!==rr&&(this.defines.set("VIGNETTE_TECHNIQUE",rr.toFixed(0)),this.setChanged())}get eskil(){return this.technique===VignetteTechnique.ESKIL}set eskil(rr){this.technique=rr?VignetteTechnique.ESKIL:VignetteTechnique.DEFAULT}getTechnique(){return this.technique}setTechnique(rr){this.technique=rr}get offset(){return this.uniforms.get("offset").value}set offset(rr){this.uniforms.get("offset").value=rr}getOffset(){return this.offset}setOffset(rr){this.offset=rr}get darkness(){return this.uniforms.get("darkness").value}set darkness(rr){this.uniforms.get("darkness").value=rr}getDarkness(){return this.darkness}setDarkness(rr){this.darkness=rr}},LUT3dlLoader=class extends Loader{load(rr,er=()=>{},tr=()=>{},ir=null){const nr=this.manager,sr=new LoadingManager,ar=new FileLoader(sr);return ar.setPath(this.path),ar.setResponseType("text"),new Promise((or,lr)=>{sr.onError=cr=>{nr.itemError(cr),ir!==null?(ir(`Failed to load ${cr}`),or()):lr(`Failed to load ${cr}`)},nr.itemStart(rr),ar.load(rr,cr=>{try{const ur=this.parse(cr);nr.itemEnd(rr),er(ur),or(ur)}catch(ur){console.error(ur),sr.onError(rr)}},tr)})}parse(rr){const er=/^[\d ]+$/m,tr=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let ir=er.exec(rr);if(ir===null)throw new Error("Missing grid information");const nr=ir[0].trim().split(/\s+/g).map(pr=>Number(pr)),sr=nr[1]-nr[0],ar=nr.length,or=ar**2;for(let pr=1,gr=nr.length;pr<gr;++pr)if(sr!==nr[pr]-nr[pr-1])throw new Error("Inconsistent grid size");const lr=new Float32Array(ar**3*4);let cr=0,ur=0;for(;(ir=tr.exec(rr))!==null;){const pr=Number(ir[1]),gr=Number(ir[2]),vr=Number(ir[3]);cr=Math.max(cr,pr,gr,vr);const mr=ur%ar,fr=Math.floor(ur/ar)%ar,_r=Math.floor(ur/or)%ar,Ar=(mr*or+fr*ar+_r)*4;lr[Ar+0]=pr,lr[Ar+1]=gr,lr[Ar+2]=vr,lr[Ar+3]=1,++ur}const dr=Math.ceil(Math.log2(cr)),hr=Math.pow(2,dr);for(let pr=0,gr=lr.length;pr<gr;pr+=4)lr[pr+0]/=hr,lr[pr+1]/=hr,lr[pr+2]/=hr;return new LookupTexture(lr,ar)}},LUTCubeLoader=class extends Loader{load(rr,er=()=>{},tr=()=>{},ir=null){const nr=this.manager,sr=new LoadingManager,ar=new FileLoader(sr);return ar.setPath(this.path),ar.setResponseType("text"),new Promise((or,lr)=>{sr.onError=cr=>{nr.itemError(cr),ir!==null?(ir(`Failed to load ${cr}`),or()):lr(`Failed to load ${cr}`)},nr.itemStart(rr),ar.load(rr,cr=>{try{const ur=this.parse(cr);nr.itemEnd(rr),er(ur),or(ur)}catch(ur){console.error(ur),sr.onError(rr)}},tr)})}parse(rr){const er=/TITLE +"([^"]*)"/,tr=/LUT_3D_SIZE +(\d+)/,ir=/DOMAIN_MIN +([\d.]+) +([\d.]+) +([\d.]+)/,nr=/DOMAIN_MAX +([\d.]+) +([\d.]+) +([\d.]+)/,sr=/^([\d.e+-]+) +([\d.e+-]+) +([\d.e+-]+) *$/gm;let ar=er.exec(rr);const or=ar!==null?ar[1]:null;if(ar=tr.exec(rr),ar===null)throw new Error("Missing LUT_3D_SIZE information");const lr=Number(ar[1]),cr=new Float32Array(lr**3*4),ur=new Vector3$1(0,0,0),dr=new Vector3$1(1,1,1);if(ar=ir.exec(rr),ar!==null&&ur.set(Number(ar[1]),Number(ar[2]),Number(ar[3])),ar=nr.exec(rr),ar!==null&&dr.set(Number(ar[1]),Number(ar[2]),Number(ar[3])),ur.x>dr.x||ur.y>dr.y||ur.z>dr.z)throw ur.set(0,0,0),dr.set(1,1,1),new Error("Invalid input domain");let hr=0;for(;(ar=sr.exec(rr))!==null;)cr[hr++]=Number(ar[1]),cr[hr++]=Number(ar[2]),cr[hr++]=Number(ar[3]),cr[hr++]=1;const pr=new LookupTexture(cr,lr);return pr.domainMin.copy(ur),pr.domainMax.copy(dr),or!==null&&(pr.name=or),pr}},SMAAImageLoader=class extends Loader{load(rr=()=>{},er=null){arguments.length===4?(rr=arguments[1],er=arguments[3]):(arguments.length===3||typeof arguments[0]!="function")&&(rr=arguments[1],er=null);const tr=this.manager,ir=new LoadingManager;return new Promise((nr,sr)=>{const ar=new Image,or=new Image;ir.onError=lr=>{tr.itemError(lr),er!==null?(er(`Failed to load ${lr}`),nr()):sr(`Failed to load ${lr}`)},ir.onLoad=()=>{const lr=[ar,or];rr(lr),nr(lr)},ar.addEventListener("error",lr=>{ir.itemError("smaa-search")}),or.addEventListener("error",lr=>{ir.itemError("smaa-area")}),ar.addEventListener("load",()=>{tr.itemEnd("smaa-search"),ir.itemEnd("smaa-search")}),or.addEventListener("load",()=>{tr.itemEnd("smaa-area"),ir.itemEnd("smaa-area")}),tr.itemStart("smaa-search"),tr.itemStart("smaa-area"),ir.itemStart("smaa-search"),ir.itemStart("smaa-area"),ar.src=searchImageDataURL_default,or.src=areaImageDataURL_default})}},convolution_box_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef BILATERAL
#include <packing>
uniform vec2 cameraNearFar;
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}
#ifdef PERSPECTIVE_CAMERA
#define linearDepth(v) viewZToOrthographicDepth(getViewZ(readDepth(v)), cameraNearFar.x, cameraNearFar.y)
#else
#define linearDepth(v) readDepth(v)
#endif
#endif
#define getTexel(v) texture2D(inputBuffer, v)
#if KERNEL_SIZE == 3
varying vec2 vUv00,vUv01,vUv02;varying vec2 vUv03,vUv04,vUv05;varying vec2 vUv06,vUv07,vUv08;
#elif KERNEL_SIZE == 5 && MAX_VARYING_VECTORS >= 13
varying vec2 vUv00,vUv01,vUv02,vUv03,vUv04;varying vec2 vUv05,vUv06,vUv07,vUv08,vUv09;varying vec2 vUv10,vUv11,vUv12,vUv13,vUv14;varying vec2 vUv15,vUv16,vUv17,vUv18,vUv19;varying vec2 vUv20,vUv21,vUv22,vUv23,vUv24;
#else
uniform vec2 texelSize;uniform float scale;varying vec2 vUv;
#endif
void main(){
#if KERNEL_SIZE == 3
vec4 c[]=vec4[KERNEL_SIZE_SQ](getTexel(vUv00),getTexel(vUv01),getTexel(vUv02),getTexel(vUv03),getTexel(vUv04),getTexel(vUv05),getTexel(vUv06),getTexel(vUv07),getTexel(vUv08));
#ifdef BILATERAL
float z[]=float[KERNEL_SIZE_SQ](linearDepth(vUv00),linearDepth(vUv01),linearDepth(vUv02),linearDepth(vUv03),linearDepth(vUv04),linearDepth(vUv05),linearDepth(vUv06),linearDepth(vUv07),linearDepth(vUv08));
#endif
#elif KERNEL_SIZE == 5 && MAX_VARYING_VECTORS >= 13
vec4 c[]=vec4[KERNEL_SIZE_SQ](getTexel(vUv00),getTexel(vUv01),getTexel(vUv02),getTexel(vUv03),getTexel(vUv04),getTexel(vUv05),getTexel(vUv06),getTexel(vUv07),getTexel(vUv08),getTexel(vUv09),getTexel(vUv10),getTexel(vUv11),getTexel(vUv12),getTexel(vUv13),getTexel(vUv14),getTexel(vUv15),getTexel(vUv16),getTexel(vUv17),getTexel(vUv18),getTexel(vUv19),getTexel(vUv20),getTexel(vUv21),getTexel(vUv22),getTexel(vUv23),getTexel(vUv24));
#ifdef BILATERAL
float z[]=float[KERNEL_SIZE_SQ](linearDepth(vUv00),linearDepth(vUv01),linearDepth(vUv02),linearDepth(vUv03),linearDepth(vUv04),linearDepth(vUv05),linearDepth(vUv06),linearDepth(vUv07),linearDepth(vUv08),linearDepth(vUv09),linearDepth(vUv10),linearDepth(vUv11),linearDepth(vUv12),linearDepth(vUv13),linearDepth(vUv14),linearDepth(vUv15),linearDepth(vUv16),linearDepth(vUv17),linearDepth(vUv18),linearDepth(vUv19),linearDepth(vUv20),linearDepth(vUv21),linearDepth(vUv22),linearDepth(vUv23),linearDepth(vUv24));
#endif
#endif
vec4 result=vec4(0.0);
#ifdef BILATERAL
float w=0.0;
#if KERNEL_SIZE == 3 || (KERNEL_SIZE == 5 && MAX_VARYING_VECTORS >= 13)
float centerDepth=z[KERNEL_SIZE_SQ_HALF];for(int i=0;i<KERNEL_SIZE_SQ;++i){float d=step(abs(z[i]-centerDepth),DISTANCE_THRESHOLD);result+=c[i]*d;w+=d;}
#else
float centerDepth=linearDepth(vUv);vec2 s=texelSize*scale;for(int x=-KERNEL_SIZE_HALF;x<=KERNEL_SIZE_HALF;++x){for(int y=-KERNEL_SIZE_HALF;y<=KERNEL_SIZE_HALF;++y){vec2 coords=vUv+vec2(x,y)*s;vec4 c=getTexel(coords);float z=(x==0&&y==0)?centerDepth:linearDepth(coords);float d=step(abs(z-centerDepth),DISTANCE_THRESHOLD);result+=c*d;w+=d;}}
#endif
gl_FragColor=result/max(w,1.0);
#else
#if KERNEL_SIZE == 3 || (KERNEL_SIZE == 5 && MAX_VARYING_VECTORS >= 13)
for(int i=0;i<KERNEL_SIZE_SQ;++i){result+=c[i];}
#else
vec2 s=texelSize*scale;for(int x=-KERNEL_SIZE_HALF;x<=KERNEL_SIZE_HALF;++x){for(int y=-KERNEL_SIZE_HALF;y<=KERNEL_SIZE_HALF;++y){result+=getTexel(uv+vec2(x,y)*s);}}
#endif
gl_FragColor=result*INV_KERNEL_SIZE_SQ;
#endif
}`,convolution_box_default2=`uniform vec2 texelSize;uniform float scale;
#if KERNEL_SIZE == 3
varying vec2 vUv00,vUv01,vUv02;varying vec2 vUv03,vUv04,vUv05;varying vec2 vUv06,vUv07,vUv08;
#elif KERNEL_SIZE == 5 && MAX_VARYING_VECTORS >= 13
varying vec2 vUv00,vUv01,vUv02,vUv03,vUv04;varying vec2 vUv05,vUv06,vUv07,vUv08,vUv09;varying vec2 vUv10,vUv11,vUv12,vUv13,vUv14;varying vec2 vUv15,vUv16,vUv17,vUv18,vUv19;varying vec2 vUv20,vUv21,vUv22,vUv23,vUv24;
#else
varying vec2 vUv;
#endif
void main(){vec2 uv=position.xy*0.5+0.5;
#if KERNEL_SIZE == 3
vec2 s=texelSize*scale;vUv00=uv+s*vec2(-1.0,-1.0);vUv01=uv+s*vec2(0.0,-1.0);vUv02=uv+s*vec2(1.0,-1.0);vUv03=uv+s*vec2(-1.0,0.0);vUv04=uv;vUv05=uv+s*vec2(1.0,0.0);vUv06=uv+s*vec2(-1.0,1.0);vUv07=uv+s*vec2(0.0,1.0);vUv08=uv+s*vec2(1.0,1.0);
#elif KERNEL_SIZE == 5
vec2 s=texelSize*scale;vUv00=uv+s*vec2(-2.0,-2.0);vUv01=uv+s*vec2(-1.0,-2.0);vUv02=uv+s*vec2(0.0,-2.0);vUv03=uv+s*vec2(1.0,-2.0);vUv04=uv+s*vec2(2.0,-2.0);vUv05=uv+s*vec2(-2.0,-1.0);vUv06=uv+s*vec2(-1.0,-1.0);vUv07=uv+s*vec2(0.0,-1.0);vUv08=uv+s*vec2(1.0,-1.0);vUv09=uv+s*vec2(2.0,-1.0);vUv10=uv+s*vec2(-2.0,0.0);vUv11=uv+s*vec2(-1.0,0.0);vUv12=uv;vUv13=uv+s*vec2(1.0,0.0);vUv14=uv+s*vec2(2.0,0.0);vUv15=uv+s*vec2(-2.0,1.0);vUv16=uv+s*vec2(-1.0,1.0);vUv17=uv+s*vec2(0.0,1.0);vUv18=uv+s*vec2(1.0,1.0);vUv19=uv+s*vec2(2.0,1.0);vUv20=uv+s*vec2(-2.0,2.0);vUv21=uv+s*vec2(-1.0,2.0);vUv22=uv+s*vec2(0.0,2.0);vUv23=uv+s*vec2(1.0,2.0);vUv24=uv+s*vec2(2.0,2.0);
#else
vUv=uv;
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,BoxBlurMaterial=class extends ShaderMaterial{constructor({bilateral:rr=!1,kernelSize:er=5}={}){super({name:"BoxBlurMaterial",defines:{DEPTH_PACKING:"0",DISTANCE_THRESHOLD:"0.1"},uniforms:{inputBuffer:new Uniform(null),depthBuffer:new Uniform(null),normalDepthBuffer:new Uniform(null),texelSize:new Uniform(new Vector2),cameraNearFar:new Uniform(new Vector2),scale:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_box_default,vertexShader:convolution_box_default2}),this.bilateral=rr,this.kernelSize=er,this.maxVaryingVectors=8}set maxVaryingVectors(rr){this.defines.MAX_VARYING_VECTORS=rr.toFixed(0)}get kernelSize(){return Number(this.defines.KERNEL_SIZE)}set kernelSize(rr){if(rr%2===0)throw new Error("The kernel size must be an odd number");this.defines.KERNEL_SIZE=rr.toFixed(0),this.defines.KERNEL_SIZE_HALF=Math.floor(rr/2).toFixed(0),this.defines.KERNEL_SIZE_SQ=(rr**2).toFixed(0),this.defines.KERNEL_SIZE_SQ_HALF=Math.floor(rr**2/2).toFixed(0),this.defines.INV_KERNEL_SIZE_SQ=(1/rr**2).toFixed(6),this.needsUpdate=!0}get scale(){return this.uniforms.scale.value}set scale(rr){this.uniforms.scale.value=rr}get near(){return this.uniforms.cameraNearFar.value.x}get far(){return this.uniforms.cameraNearFar.value.y}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set normalDepthBuffer(rr){this.uniforms.normalDepthBuffer.value=rr,rr!==null?this.defines.NORMAL_DEPTH="1":delete this.defines.NORMAL_DEPTH,this.needsUpdate=!0}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}get bilateral(){return this.defines.BILATERAL!==void 0}set bilateral(rr){rr!==null?this.defines.BILATERAL="1":delete this.defines.BILATERAL,this.needsUpdate=!0}get worldDistanceThreshold(){return-orthographicDepthToViewZ(Number(this.defines.DISTANCE_THRESHOLD),this.near,this.far)}set worldDistanceThreshold(rr){const er=viewZToOrthographicDepth(-rr,this.near,this.far);this.defines.DISTANCE_THRESHOLD=er.toFixed(12),this.needsUpdate=!0}copyCameraSettings(rr){rr&&(this.uniforms.cameraNearFar.value.set(rr.near,rr.far),rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},depth_copy_default=`#include <packing>
varying vec2 vUv;
#ifdef NORMAL_DEPTH
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D normalDepthBuffer;
#else
uniform mediump sampler2D normalDepthBuffer;
#endif
float readDepth(const in vec2 uv){return texture2D(normalDepthBuffer,uv).a;}
#else
#if INPUT_DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if INPUT_DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
void main(){
#if INPUT_DEPTH_PACKING == OUTPUT_DEPTH_PACKING
gl_FragColor=texture2D(depthBuffer,vUv);
#else
float depth=readDepth(vUv);
#if OUTPUT_DEPTH_PACKING == 3201
gl_FragColor=(depth==1.0)?vec4(1.0):packDepthToRGBA(depth);
#else
gl_FragColor=vec4(vec3(depth),1.0);
#endif
#endif
}`,depth_copy_default2=`varying vec2 vUv;
#if DEPTH_COPY_MODE == 1
uniform vec2 texelPosition;
#endif
void main(){
#if DEPTH_COPY_MODE == 1
vUv=texelPosition;
#else
vUv=position.xy*0.5+0.5;
#endif
gl_Position=vec4(position.xy,1.0,1.0);}`,DepthCopyMaterial=class extends ShaderMaterial{constructor(){super({name:"DepthCopyMaterial",defines:{INPUT_DEPTH_PACKING:"0",OUTPUT_DEPTH_PACKING:"0",DEPTH_COPY_MODE:"0"},uniforms:{depthBuffer:new Uniform(null),texelPosition:new Uniform(new Vector2)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:depth_copy_default,vertexShader:depth_copy_default2}),this.depthCopyMode=DepthCopyMode.FULL}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}set inputDepthPacking(rr){this.defines.INPUT_DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}get outputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}set outputDepthPacking(rr){this.defines.OUTPUT_DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.inputDepthPacking=er}getInputDepthPacking(){return Number(this.defines.INPUT_DEPTH_PACKING)}setInputDepthPacking(rr){this.defines.INPUT_DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}getOutputDepthPacking(){return Number(this.defines.OUTPUT_DEPTH_PACKING)}setOutputDepthPacking(rr){this.defines.OUTPUT_DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}get texelPosition(){return this.uniforms.texelPosition.value}getTexelPosition(){return this.uniforms.texelPosition.value}setTexelPosition(rr){this.uniforms.texelPosition.value=rr}get mode(){return this.depthCopyMode}set mode(rr){this.depthCopyMode=rr,this.defines.DEPTH_COPY_MODE=rr.toFixed(0),this.needsUpdate=!0}getMode(){return this.mode}setMode(rr){this.mode=rr}},effect_default=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,effect_default2="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",EffectMaterial=class extends ShaderMaterial{constructor(rr,er,tr,ir,nr=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:REVISION.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new Uniform(null),depthBuffer:new Uniform(null),resolution:new Uniform(new Vector2),texelSize:new Uniform(new Vector2),cameraNear:new Uniform(.3),cameraFar:new Uniform(1e3),aspect:new Uniform(1),time:new Uniform(0)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:nr}),rr&&this.setShaderParts(rr),er&&this.setDefines(er),tr&&this.setUniforms(tr),this.copyCameraSettings(ir)}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}setInputBuffer(rr){this.uniforms.inputBuffer.value=rr}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(rr){this.uniforms.depthBuffer.value=rr}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(rr){this.defines.DEPTH_PACKING=rr.toFixed(0),this.needsUpdate=!0}setDepthBuffer(rr,er=BasicDepthPacking){this.depthBuffer=rr,this.depthPacking=er}setShaderData(rr){this.setShaderParts(rr.shaderParts),this.setDefines(rr.defines),this.setUniforms(rr.uniforms),this.setExtensions(rr.extensions)}setShaderParts(rr){return this.fragmentShader=effect_default.replace(EffectShaderSection.FRAGMENT_HEAD,rr.get(EffectShaderSection.FRAGMENT_HEAD)||"").replace(EffectShaderSection.FRAGMENT_MAIN_UV,rr.get(EffectShaderSection.FRAGMENT_MAIN_UV)||"").replace(EffectShaderSection.FRAGMENT_MAIN_IMAGE,rr.get(EffectShaderSection.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=effect_default2.replace(EffectShaderSection.VERTEX_HEAD,rr.get(EffectShaderSection.VERTEX_HEAD)||"").replace(EffectShaderSection.VERTEX_MAIN_SUPPORT,rr.get(EffectShaderSection.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(rr){for(const er of rr.entries())this.defines[er[0]]=er[1];return this.needsUpdate=!0,this}setUniforms(rr){for(const er of rr.entries())this.uniforms[er[0]]=er[1];return this}setExtensions(rr){this.extensions={};for(const er of rr)this.extensions[er]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(rr){this.encodeOutput!==rr&&(rr?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(rr){return this.encodeOutput}setOutputEncodingEnabled(rr){this.encodeOutput=rr}get time(){return this.uniforms.time.value}set time(rr){this.uniforms.time.value=rr}setDeltaTime(rr){this.uniforms.time.value+=rr}adoptCameraSettings(rr){this.copyCameraSettings(rr)}copyCameraSettings(rr){rr&&(this.uniforms.cameraNear.value=rr.near,this.uniforms.cameraFar.value=rr.far,rr instanceof PerspectiveCamera?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(rr,er){const tr=this.uniforms;tr.resolution.value.set(rr,er),tr.texelSize.value.set(1/rr,1/er),tr.aspect.value=rr/er}static get Section(){return EffectShaderSection}},convolution_gaussian_default=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
uniform vec2 kernel[STEPS];varying vec2 vOffset;varying vec2 vUv;void main(){vec4 result=texture2D(inputBuffer,vUv)*kernel[0].y;for(int i=1;i<STEPS;++i){vec2 offset=kernel[i].x*vOffset;vec4 c0=texture2D(inputBuffer,vUv+offset);vec4 c1=texture2D(inputBuffer,vUv-offset);result+=(c0+c1)*kernel[i].y;}gl_FragColor=result;
#include <colorspace_fragment>
}`,convolution_gaussian_default2="uniform vec2 texelSize;uniform vec2 direction;uniform float scale;varying vec2 vOffset;varying vec2 vUv;void main(){vOffset=direction*texelSize*scale;vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",GaussianBlurMaterial=class extends ShaderMaterial{constructor({kernelSize:rr=35}={}){super({name:"GaussianBlurMaterial",uniforms:{inputBuffer:new Uniform(null),texelSize:new Uniform(new Vector2),direction:new Uniform(new Vector2),kernel:new Uniform(null),scale:new Uniform(1)},blending:NoBlending,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:convolution_gaussian_default,vertexShader:convolution_gaussian_default2}),this._kernelSize=0,this.kernelSize=rr}set inputBuffer(rr){this.uniforms.inputBuffer.value=rr}get kernelSize(){return this._kernelSize}set kernelSize(rr){this._kernelSize=rr,this.generateKernel(rr)}get direction(){return this.uniforms.direction.value}get scale(){return this.uniforms.scale.value}set scale(rr){this.uniforms.scale.value=rr}generateKernel(rr){const er=new GaussKernel(rr),tr=er.linearSteps,ir=new Float64Array(tr*2);for(let nr=0,sr=0;nr<tr;++nr)ir[sr++]=er.linearOffsets[nr],ir[sr++]=er.linearWeights[nr];this.uniforms.kernel.value=ir,this.defines.STEPS=tr.toFixed(0),this.needsUpdate=!0}setSize(rr,er){this.uniforms.texelSize.value.set(1/rr,1/er)}},BoxBlurPass=class extends Pass{constructor({kernelSize:rr=5,iterations:er=1,bilateral:tr=!1,resolutionScale:ir=1,resolutionX:nr=Resolution.AUTO_SIZE,resolutionY:sr=Resolution.AUTO_SIZE}={}){super("BoxBlurPass"),this.needsDepthTexture=tr,this.renderTargetA=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetB.texture.name="Blur.Target.B",this.blurMaterial=new BoxBlurMaterial({bilateral:tr,kernelSize:rr}),this.copyMaterial=new CopyMaterial;const ar=this.resolution=new Resolution(this,nr,sr,ir);ar.addEventListener("change",or=>this.setSize(ar.baseWidth,ar.baseHeight)),this.iterations=er}set mainCamera(rr){this.blurMaterial.copyCameraSettings(rr)}setDepthTexture(rr,er=BasicDepthPacking){this.blurMaterial.depthBuffer=rr,this.blurMaterial.depthPacking=er}render(rr,er,tr,ir,nr){const sr=this.scene,ar=this.camera,or=this.renderTargetA,lr=this.renderTargetB,cr=this.blurMaterial;this.fullscreenMaterial=cr;let ur=er;for(let dr=0,hr=Math.max(this.iterations,1);dr<hr;++dr){const pr=dr&1?lr:or;cr.inputBuffer=ur.texture,rr.setRenderTarget(pr),rr.render(sr,ar),ur=pr}this.copyMaterial.inputBuffer=ur.texture,this.fullscreenMaterial=this.copyMaterial,rr.setRenderTarget(this.renderToScreen?null:tr),rr.render(sr,ar)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.renderTargetA.setSize(ir,nr),this.renderTargetB.setSize(ir,nr),this.blurMaterial.setSize(rr,er)}initialize(rr,er,tr){rr!==null&&(this.blurMaterial.maxVaryingVectors=rr.capabilities.maxVaryings),tr!==void 0&&(this.renderTargetA.texture.type=tr,this.renderTargetB.texture.type=tr,tr!==UnsignedByteType?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=SRGBColorSpace,this.renderTargetB.texture.colorSpace=SRGBColorSpace))}},DepthCopyPass=class extends Pass{constructor({depthPacking:rr=RGBADepthPacking}={}){super("DepthCopyPass");const er=new DepthCopyMaterial;er.outputDepthPacking=rr,this.fullscreenMaterial=er,this.needsDepthTexture=!0,this.needsSwap=!1,this.renderTarget=new WebGLRenderTarget(1,1,{type:rr===RGBADepthPacking?UnsignedByteType:FloatType,minFilter:NearestFilter,magFilter:NearestFilter,depthBuffer:!1}),this.renderTarget.texture.name="DepthCopyPass.Target"}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}get depthPacking(){return this.fullscreenMaterial.outputDepthPacking}getDepthPacking(){return this.fullscreenMaterial.outputDepthPacking}setDepthTexture(rr,er=BasicDepthPacking){this.fullscreenMaterial.depthBuffer=rr,this.fullscreenMaterial.inputDepthPacking=er}render(rr,er,tr,ir,nr){rr.setRenderTarget(this.renderToScreen?null:this.renderTarget),rr.render(this.scene,this.camera)}setSize(rr,er){this.renderTarget.setSize(rr,er)}},threeRevision=Number(REVISION.replace(/\D+/g,"")),unpackDownscale=255/256,unpackFactorsLegacy=new Float32Array([unpackDownscale/256**3,unpackDownscale/256**2,unpackDownscale/256,unpackDownscale]),unpackFactors=new Float32Array([unpackDownscale,unpackDownscale/256,unpackDownscale/256**2,1/256**3]);function unpackRGBAToDepth(rr){const er=threeRevision>=167?unpackFactors:unpackFactorsLegacy;return(rr[0]*er[0]+rr[1]*er[1]+rr[2]*er[2]+rr[3]*er[3])/255}var DepthPickingPass=class extends DepthCopyPass{constructor({depthPacking:rr=RGBADepthPacking,mode:er=DepthCopyMode.SINGLE}={}){if(rr!==RGBADepthPacking&&rr!==BasicDepthPacking)throw new Error(`Unsupported depth packing: ${rr}`);super({depthPacking:rr}),this.name="DepthPickingPass",this.fullscreenMaterial.mode=er,this.pixelBuffer=rr===RGBADepthPacking?new Uint8Array(4):new Float32Array(4),this.callback=null}readDepth(rr){return this.fullscreenMaterial.texelPosition.set(rr.x*.5+.5,rr.y*.5+.5),new Promise(er=>{this.callback=er})}render(rr,er,tr,ir,nr){const sr=this.fullscreenMaterial,ar=sr.mode;if(ar===DepthCopyMode.FULL&&super.render(rr),this.callback!==null){const or=this.renderTarget,lr=this.pixelBuffer,cr=or.texture.type!==FloatType;let ur=0,dr=0;if(ar===DepthCopyMode.SINGLE)super.render(rr);else{const hr=sr.texelPosition;ur=Math.round(hr.x*or.width),dr=Math.round(hr.y*or.height)}rr.readRenderTargetPixels(or,ur,dr,1,1,lr),this.callback(cr?unpackRGBAToDepth(lr):lr[0]),this.callback=null}}setSize(rr,er){this.fullscreenMaterial.mode===DepthCopyMode.FULL&&super.setSize(rr,er)}};function prefixSubstrings(rr,er,tr){for(const ir of er){const nr="$1"+rr+ir.charAt(0).toUpperCase()+ir.slice(1),sr=new RegExp("([^\\.])(\\b"+ir+"\\b)","g");for(const ar of tr.entries())ar[1]!==null&&tr.set(ar[0],ar[1].replace(sr,nr))}}function integrateEffect(rr,er,tr){let ir=er.getFragmentShader(),nr=er.getVertexShader();const sr=ir!==void 0&&/mainImage/.test(ir),ar=ir!==void 0&&/mainUv/.test(ir);if(tr.attributes|=er.getAttributes(),ir===void 0)throw new Error(`Missing fragment shader (${er.name})`);if(ar&&tr.attributes&EffectAttribute.CONVOLUTION)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${er.name})`);if(!sr&&!ar)throw new Error(`Could not find mainImage or mainUv function (${er.name})`);{const or=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,lr=tr.shaderParts;let cr=lr.get(EffectShaderSection.FRAGMENT_HEAD)||"",ur=lr.get(EffectShaderSection.FRAGMENT_MAIN_UV)||"",dr=lr.get(EffectShaderSection.FRAGMENT_MAIN_IMAGE)||"",hr=lr.get(EffectShaderSection.VERTEX_HEAD)||"",pr=lr.get(EffectShaderSection.VERTEX_MAIN_SUPPORT)||"";const gr=new Set,vr=new Set;if(ar&&(ur+=`	${rr}MainUv(UV);
`,tr.uvTransformation=!0),nr!==null&&/mainSupport/.test(nr)){const _r=/mainSupport *\([\w\s]*?uv\s*?\)/.test(nr);pr+=`	${rr}MainSupport(`,pr+=_r?`vUv);
`:`);
`;for(const Ar of nr.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const yr of Ar[1].split(/\s*,\s*/))tr.varyings.add(yr),gr.add(yr),vr.add(yr);for(const Ar of nr.matchAll(or))vr.add(Ar[1])}for(const _r of ir.matchAll(or))vr.add(_r[1]);for(const _r of er.defines.keys())vr.add(_r.replace(/\([\w\s,]*\)/g,""));for(const _r of er.uniforms.keys())vr.add(_r);vr.delete("while"),vr.delete("for"),vr.delete("if"),er.uniforms.forEach((_r,Ar)=>tr.uniforms.set(rr+Ar.charAt(0).toUpperCase()+Ar.slice(1),_r)),er.defines.forEach((_r,Ar)=>tr.defines.set(rr+Ar.charAt(0).toUpperCase()+Ar.slice(1),_r));const mr=new Map([["fragment",ir],["vertex",nr]]);prefixSubstrings(rr,vr,tr.defines),prefixSubstrings(rr,vr,mr),ir=mr.get("fragment"),nr=mr.get("vertex");const fr=er.blendMode;if(tr.blendModes.set(fr.blendFunction,fr),sr){er.inputColorSpace!==null&&er.inputColorSpace!==tr.colorSpace&&(dr+=er.inputColorSpace===SRGBColorSpace?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),er.outputColorSpace!==NoColorSpace?tr.colorSpace=er.outputColorSpace:er.inputColorSpace!==null&&(tr.colorSpace=er.inputColorSpace);const _r=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;dr+=`${rr}MainImage(color0, UV, `,tr.attributes&EffectAttribute.DEPTH&&_r.test(ir)&&(dr+="depth, ",tr.readDepth=!0),dr+=`color1);
	`;const Ar=rr+"BlendOpacity";tr.uniforms.set(Ar,fr.opacity),dr+=`color0 = blend${fr.blendFunction}(color0, color1, ${Ar});

	`,cr+=`uniform float ${Ar};

`}if(cr+=ir+`
`,nr!==null&&(hr+=nr+`
`),lr.set(EffectShaderSection.FRAGMENT_HEAD,cr),lr.set(EffectShaderSection.FRAGMENT_MAIN_UV,ur),lr.set(EffectShaderSection.FRAGMENT_MAIN_IMAGE,dr),lr.set(EffectShaderSection.VERTEX_HEAD,hr),lr.set(EffectShaderSection.VERTEX_MAIN_SUPPORT,pr),er.extensions!==null)for(const _r of er.extensions)tr.extensions.add(_r)}}var EffectPass=class extends Pass{constructor(rr,...er){super("EffectPass"),this.fullscreenMaterial=new EffectMaterial(null,null,null,rr),this.listener=tr=>this.handleEvent(tr),this.effects=[],this.setEffects(er),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(rr){for(const er of this.effects)er.mainScene=rr}set mainCamera(rr){this.fullscreenMaterial.copyCameraSettings(rr);for(const er of this.effects)er.mainCamera=rr}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(rr){this.fullscreenMaterial.encodeOutput=rr}get dithering(){return this.fullscreenMaterial.dithering}set dithering(rr){const er=this.fullscreenMaterial;er.dithering=rr,er.needsUpdate=!0}setEffects(rr){for(const er of this.effects)er.removeEventListener("change",this.listener);this.effects=rr.sort((er,tr)=>tr.attributes-er.attributes);for(const er of this.effects)er.addEventListener("change",this.listener)}updateMaterial(){const rr=new EffectShaderData;let er=0;for(const ar of this.effects)if(ar.blendMode.blendFunction===BlendFunction.DST)rr.attributes|=ar.getAttributes()&EffectAttribute.DEPTH;else{if(rr.attributes&ar.getAttributes()&EffectAttribute.CONVOLUTION)throw new Error(`Convolution effects cannot be merged (${ar.name})`);integrateEffect("e"+er++,ar,rr)}let tr=rr.shaderParts.get(EffectShaderSection.FRAGMENT_HEAD),ir=rr.shaderParts.get(EffectShaderSection.FRAGMENT_MAIN_IMAGE),nr=rr.shaderParts.get(EffectShaderSection.FRAGMENT_MAIN_UV);const sr=/\bblend\b/g;for(const ar of rr.blendModes.values())tr+=ar.getShaderCode().replace(sr,`blend${ar.blendFunction}`)+`
`;rr.attributes&EffectAttribute.DEPTH?(rr.readDepth&&(ir=`float depth = readDepth(UV);

	`+ir),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,rr.colorSpace===SRGBColorSpace&&(ir+=`color0 = sRGBToLinear(color0);
	`),rr.uvTransformation?(nr=`vec2 transformedUv = vUv;
`+nr,rr.defines.set("UV","transformedUv")):rr.defines.set("UV","vUv"),rr.shaderParts.set(EffectShaderSection.FRAGMENT_HEAD,tr),rr.shaderParts.set(EffectShaderSection.FRAGMENT_MAIN_IMAGE,ir),rr.shaderParts.set(EffectShaderSection.FRAGMENT_MAIN_UV,nr);for(const[ar,or]of rr.shaderParts)or!==null&&rr.shaderParts.set(ar,or.trim().replace(/^#/,`
#`));this.skipRendering=er===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(rr)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(rr,er=BasicDepthPacking){this.fullscreenMaterial.depthBuffer=rr,this.fullscreenMaterial.depthPacking=er;for(const tr of this.effects)tr.setDepthTexture(rr,er)}render(rr,er,tr,ir,nr){for(const sr of this.effects)sr.update(rr,er,ir);if(!this.skipRendering||this.renderToScreen){const sr=this.fullscreenMaterial;sr.inputBuffer=er.texture,sr.time+=ir*this.timeScale,rr.setRenderTarget(this.renderToScreen?null:tr),rr.render(this.scene,this.camera)}}setSize(rr,er){this.fullscreenMaterial.setSize(rr,er);for(const tr of this.effects)tr.setSize(rr,er)}initialize(rr,er,tr){this.renderer=rr;for(const ir of this.effects)ir.initialize(rr,er,tr);this.updateMaterial(),tr!==void 0&&tr!==UnsignedByteType&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const rr of this.effects)rr.removeEventListener("change",this.listener),rr.dispose()}handleEvent(rr){switch(rr.type){case"change":this.recompile();break}}},GaussianBlurPass=class extends Pass{constructor({kernelSize:rr=35,iterations:er=1,resolutionScale:tr=1,resolutionX:ir=Resolution.AUTO_SIZE,resolutionY:nr=Resolution.AUTO_SIZE}={}){super("GaussianBlurPass"),this.renderTargetA=new WebGLRenderTarget(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B",this.blurMaterial=new GaussianBlurMaterial({kernelSize:rr}),this.copyMaterial=new CopyMaterial,this.copyMaterial.inputBuffer=this.renderTargetB.texture;const sr=this.resolution=new Resolution(this,ir,nr,tr);sr.addEventListener("change",ar=>this.setSize(sr.baseWidth,sr.baseHeight)),this.iterations=er}render(rr,er,tr,ir,nr){const sr=this.scene,ar=this.camera,or=this.renderTargetA,lr=this.renderTargetB,cr=this.blurMaterial;this.fullscreenMaterial=cr;let ur=er;for(let dr=0,hr=Math.max(this.iterations,1);dr<hr;++dr)cr.direction.set(1,0),cr.inputBuffer=ur.texture,rr.setRenderTarget(or),rr.render(sr,ar),cr.direction.set(0,1),cr.inputBuffer=or.texture,rr.setRenderTarget(lr),rr.render(sr,ar),dr===0&&hr>1&&(ur=lr);this.fullscreenMaterial=this.copyMaterial,rr.setRenderTarget(this.renderToScreen?null:tr),rr.render(sr,ar)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er);const ir=tr.width,nr=tr.height;this.renderTargetA.setSize(ir,nr),this.renderTargetB.setSize(ir,nr),this.blurMaterial.setSize(rr,er)}initialize(rr,er,tr){tr!==void 0&&(this.renderTargetA.texture.type=tr,this.renderTargetB.texture.type=tr,tr!==UnsignedByteType?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):rr!==null&&rr.outputColorSpace===SRGBColorSpace&&(this.renderTargetA.texture.colorSpace=SRGBColorSpace,this.renderTargetB.texture.colorSpace=SRGBColorSpace))}},LambdaPass=class extends Pass{constructor(rr){super("LambdaPass",null,null),this.needsSwap=!1,this.f=rr}render(rr,er,tr,ir,nr){this.f()}},NormalPass=class extends Pass{constructor(rr,er,{renderTarget:tr,resolutionScale:ir=1,width:nr=Resolution.AUTO_SIZE,height:sr=Resolution.AUTO_SIZE,resolutionX:ar=nr,resolutionY:or=sr}={}){super("NormalPass"),this.needsSwap=!1,this.renderPass=new RenderPass(rr,er,new MeshNormalMaterial);const lr=this.renderPass;lr.ignoreBackground=!0,lr.skipShadowMapUpdate=!0;const cr=lr.getClearPass();cr.overrideClearColor=new Color(7829503),cr.overrideClearAlpha=1,this.renderTarget=tr,this.renderTarget===void 0&&(this.renderTarget=new WebGLRenderTarget(1,1,{minFilter:NearestFilter,magFilter:NearestFilter}),this.renderTarget.texture.name="NormalPass.Target");const ur=this.resolution=new Resolution(this,ar,or,ir);ur.addEventListener("change",dr=>this.setSize(ur.baseWidth,ur.baseHeight))}set mainScene(rr){this.renderPass.mainScene=rr}set mainCamera(rr){this.renderPass.mainCamera=rr}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}getResolutionScale(){return this.resolution.scale}setResolutionScale(rr){this.resolution.scale=rr}render(rr,er,tr,ir,nr){const sr=this.renderToScreen?null:this.renderTarget;this.renderPass.render(rr,sr,sr)}setSize(rr,er){const tr=this.resolution;tr.setBaseSize(rr,er),this.renderTarget.setSize(tr.width,tr.height)}},P=[new Float32Array(3),new Float32Array(3)],C=[new Float32Array(3),new Float32Array(3),new Float32Array(3),new Float32Array(3)],T=[[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([1,0,0]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([1,0,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([1,1,0]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,1,0]),new Float32Array([0,1,1]),new Float32Array([1,1,1])],[new Float32Array([0,0,0]),new Float32Array([0,0,1]),new Float32Array([0,1,1]),new Float32Array([1,1,1])]];function calculateTetrahedronVolume(rr,er,tr,ir){const nr=tr[0]-er[0],sr=tr[1]-er[1],ar=tr[2]-er[2],or=rr[0]-er[0],lr=rr[1]-er[1],cr=rr[2]-er[2],ur=sr*cr-ar*lr,dr=ar*or-nr*cr,hr=nr*lr-sr*or,pr=Math.sqrt(ur*ur+dr*dr+hr*hr),gr=pr*.5,vr=ur/pr,mr=dr/pr,fr=hr/pr,_r=-(rr[0]*vr+rr[1]*mr+rr[2]*fr),Ar=ir[0]*vr+ir[1]*mr+ir[2]*fr;return Math.abs(Ar+_r)*gr/3}function sample(rr,er,tr,ir,nr,sr){const ar=(tr+ir*er+nr*er*er)*4;sr[0]=rr[ar+0],sr[1]=rr[ar+1],sr[2]=rr[ar+2]}function tetrahedralSample(rr,er,tr,ir,nr,sr){const ar=tr*(er-1),or=ir*(er-1),lr=nr*(er-1),cr=Math.floor(ar),ur=Math.floor(or),dr=Math.floor(lr),hr=Math.ceil(ar),pr=Math.ceil(or),gr=Math.ceil(lr),vr=ar-cr,mr=or-ur,fr=lr-dr;if(cr===ar&&ur===or&&dr===lr)sample(rr,er,ar,or,lr,sr);else{let _r;vr>=mr&&mr>=fr?_r=T[0]:vr>=fr&&fr>=mr?_r=T[1]:fr>=vr&&vr>=mr?_r=T[2]:mr>=vr&&vr>=fr?_r=T[3]:mr>=fr&&fr>=vr?_r=T[4]:fr>=mr&&mr>=vr&&(_r=T[5]);const[Ar,yr,wr,xr]=_r,Sr=P[0];Sr[0]=vr,Sr[1]=mr,Sr[2]=fr;const br=P[1],Cr=hr-cr,Ir=pr-ur,Rr=gr-dr;br[0]=Cr*Ar[0]+cr,br[1]=Ir*Ar[1]+ur,br[2]=Rr*Ar[2]+dr,sample(rr,er,br[0],br[1],br[2],C[0]),br[0]=Cr*yr[0]+cr,br[1]=Ir*yr[1]+ur,br[2]=Rr*yr[2]+dr,sample(rr,er,br[0],br[1],br[2],C[1]),br[0]=Cr*wr[0]+cr,br[1]=Ir*wr[1]+ur,br[2]=Rr*wr[2]+dr,sample(rr,er,br[0],br[1],br[2],C[2]),br[0]=Cr*xr[0]+cr,br[1]=Ir*xr[1]+ur,br[2]=Rr*xr[2]+dr,sample(rr,er,br[0],br[1],br[2],C[3]);const Pr=calculateTetrahedronVolume(yr,wr,xr,Sr)*6,Dr=calculateTetrahedronVolume(Ar,wr,xr,Sr)*6,Fr=calculateTetrahedronVolume(Ar,yr,xr,Sr)*6,Or=calculateTetrahedronVolume(Ar,yr,wr,Sr)*6;C[0][0]*=Pr,C[0][1]*=Pr,C[0][2]*=Pr,C[1][0]*=Dr,C[1][1]*=Dr,C[1][2]*=Dr,C[2][0]*=Fr,C[2][1]*=Fr,C[2][2]*=Fr,C[3][0]*=Or,C[3][1]*=Or,C[3][2]*=Or,sr[0]=C[0][0]+C[1][0]+C[2][0]+C[3][0],sr[1]=C[0][1]+C[1][1]+C[2][1]+C[3][1],sr[2]=C[0][2]+C[1][2]+C[2][2]+C[3][2]}}var TetrahedralUpscaler=class{static expand(rr,er){const tr=Math.cbrt(rr.length/4),ir=new Float32Array(3),nr=new rr.constructor(er**3*4),sr=rr instanceof Uint8Array?255:1,ar=er**2,or=1/(er-1);for(let lr=0;lr<er;++lr)for(let cr=0;cr<er;++cr)for(let ur=0;ur<er;++ur){const dr=ur*or,hr=cr*or,pr=lr*or,gr=Math.round(ur+cr*er+lr*ar)*4;tetrahedralSample(rr,tr,dr,hr,pr,ir),nr[gr+0]=ir[0],nr[gr+1]=ir[1],nr[gr+2]=ir[2],nr[gr+3]=sr}return nr}},area=[new Float32Array(2),new Float32Array(2)],ORTHOGONAL_SIZE=16,DIAGONAL_SIZE=20,DIAGONAL_SAMPLES=30,SMOOTH_MAX_DISTANCE=32,orthogonalSubsamplingOffsets=new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),diagonalSubsamplingOffsets=[new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125])],orthogonalEdges=[new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4])],diagonalEdges=[new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3])];function lerp(rr,er,tr){return rr+(er-rr)*tr}function saturate(rr){return Math.min(Math.max(rr,0),1)}function smoothArea(rr){const er=area[0],tr=area[1],ir=Math.sqrt(er[0]*2)*.5,nr=Math.sqrt(er[1]*2)*.5,sr=Math.sqrt(tr[0]*2)*.5,ar=Math.sqrt(tr[1]*2)*.5,or=saturate(rr/SMOOTH_MAX_DISTANCE);er[0]=lerp(ir,er[0],or),er[1]=lerp(nr,er[1],or),tr[0]=lerp(sr,tr[0],or),tr[1]=lerp(ar,tr[1],or)}function getOrthArea(rr,er,tr,ir,nr,sr){const ar=tr-rr,or=ir-er,lr=nr,cr=nr+1,ur=er+or*(lr-rr)/ar,dr=er+or*(cr-rr)/ar;if(lr>=rr&&lr<tr||cr>rr&&cr<=tr)if(Math.sign(ur)===Math.sign(dr)||Math.abs(ur)<1e-4||Math.abs(dr)<1e-4){const hr=(ur+dr)/2;hr<0?(sr[0]=Math.abs(hr),sr[1]=0):(sr[0]=0,sr[1]=Math.abs(hr))}else{const hr=-er*ar/or+rr,pr=Math.trunc(hr),gr=hr>rr?ur*(hr-pr)/2:0,vr=hr<tr?dr*(1-(hr-pr))/2:0;(Math.abs(gr)>Math.abs(vr)?gr:-vr)<0?(sr[0]=Math.abs(gr),sr[1]=Math.abs(vr)):(sr[0]=Math.abs(vr),sr[1]=Math.abs(gr))}else sr[0]=0,sr[1]=0;return sr}function getOrthAreaForPattern(rr,er,tr,ir,nr){const sr=area[0],ar=area[1],or=.5+ir,lr=.5+ir-1,cr=er+tr+1;switch(rr){case 0:{nr[0]=0,nr[1]=0;break}case 1:{er<=tr?getOrthArea(0,lr,cr/2,0,er,nr):(nr[0]=0,nr[1]=0);break}case 2:{er>=tr?getOrthArea(cr/2,0,cr,lr,er,nr):(nr[0]=0,nr[1]=0);break}case 3:{getOrthArea(0,lr,cr/2,0,er,sr),getOrthArea(cr/2,0,cr,lr,er,ar),smoothArea(cr,area),nr[0]=sr[0]+ar[0],nr[1]=sr[1]+ar[1];break}case 4:{er<=tr?getOrthArea(0,or,cr/2,0,er,nr):(nr[0]=0,nr[1]=0);break}case 5:{nr[0]=0,nr[1]=0;break}case 6:{Math.abs(ir)>0?(getOrthArea(0,or,cr,lr,er,sr),getOrthArea(0,or,cr/2,0,er,ar),getOrthArea(cr/2,0,cr,lr,er,nr),ar[0]=ar[0]+nr[0],ar[1]=ar[1]+nr[1],nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2):getOrthArea(0,or,cr,lr,er,nr);break}case 7:{getOrthArea(0,or,cr,lr,er,nr);break}case 8:{er>=tr?getOrthArea(cr/2,0,cr,or,er,nr):(nr[0]=0,nr[1]=0);break}case 9:{Math.abs(ir)>0?(getOrthArea(0,lr,cr,or,er,sr),getOrthArea(0,lr,cr/2,0,er,ar),getOrthArea(cr/2,0,cr,or,er,nr),ar[0]=ar[0]+nr[0],ar[1]=ar[1]+nr[1],nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2):getOrthArea(0,lr,cr,or,er,nr);break}case 10:{nr[0]=0,nr[1]=0;break}case 11:{getOrthArea(0,lr,cr,or,er,nr);break}case 12:{getOrthArea(0,or,cr/2,0,er,sr),getOrthArea(cr/2,0,cr,or,er,ar),smoothArea(cr,area),nr[0]=sr[0]+ar[0],nr[1]=sr[1]+ar[1];break}case 13:{getOrthArea(0,lr,cr,or,er,nr);break}case 14:{getOrthArea(0,or,cr,lr,er,nr);break}case 15:{nr[0]=0,nr[1]=0;break}}return nr}function isInsideArea(rr,er,tr,ir,nr,sr){let ar=rr===tr&&er===ir;if(!ar){const or=(rr+tr)/2,lr=(er+ir)/2,cr=ir-er,ur=rr-tr;ar=cr*(nr-or)+ur*(sr-lr)>0}return ar}function getDiagAreaForPixel(rr,er,tr,ir,nr,sr){let ar=0;for(let or=0;or<DIAGONAL_SAMPLES;++or)for(let lr=0;lr<DIAGONAL_SAMPLES;++lr){const cr=lr/(DIAGONAL_SAMPLES-1),ur=or/(DIAGONAL_SAMPLES-1);isInsideArea(rr,er,tr,ir,nr+cr,sr+ur)&&++ar}return ar/(DIAGONAL_SAMPLES*DIAGONAL_SAMPLES)}function getDiagArea(rr,er,tr,ir,nr,sr,ar,or){const lr=diagonalEdges[rr],cr=lr[0],ur=lr[1];return cr>0&&(er+=ar[0],tr+=ar[1]),ur>0&&(ir+=ar[0],nr+=ar[1]),or[0]=1-getDiagAreaForPixel(er,tr,ir,nr,1+sr,0+sr),or[1]=getDiagAreaForPixel(er,tr,ir,nr,1+sr,1+sr),or}function getDiagAreaForPattern(rr,er,tr,ir,nr){const sr=area[0],ar=area[1],or=er+tr+1;switch(rr){case 0:{getDiagArea(rr,1,1,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 1:{getDiagArea(rr,1,0,0+or,0+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 2:{getDiagArea(rr,0,0,1+or,0+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 3:{getDiagArea(rr,1,0,1+or,0+or,er,ir,nr);break}case 4:{getDiagArea(rr,1,1,0+or,0+or,er,ir,sr),getDiagArea(rr,1,1,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 5:{getDiagArea(rr,1,1,0+or,0+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 6:{getDiagArea(rr,1,1,1+or,0+or,er,ir,nr);break}case 7:{getDiagArea(rr,1,1,1+or,0+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 8:{getDiagArea(rr,0,0,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,1+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 9:{getDiagArea(rr,1,0,1+or,1+or,er,ir,nr),getDiagArea(rr,1,0,1+or,1+or,er,ir,nr);break}case 10:{getDiagArea(rr,0,0,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 11:{getDiagArea(rr,1,0,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 12:{getDiagArea(rr,1,1,1+or,1+or,er,ir,nr);break}case 13:{getDiagArea(rr,1,1,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,1+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 14:{getDiagArea(rr,1,1,1+or,1+or,er,ir,sr),getDiagArea(rr,1,1,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}case 15:{getDiagArea(rr,1,1,1+or,1+or,er,ir,sr),getDiagArea(rr,1,0,1+or,0+or,er,ir,ar),nr[0]=(sr[0]+ar[0])/2,nr[1]=(sr[1]+ar[1])/2;break}}return nr}function generatePatterns(rr,er,tr){const ir=new Float32Array(2);for(let nr=0,sr=rr.length;nr<sr;++nr){const ar=rr[nr],or=ar.data,lr=ar.width;for(let cr=0;cr<lr;++cr)for(let ur=0;ur<lr;++ur){tr?getOrthAreaForPattern(nr,ur,cr,er,ir):getDiagAreaForPattern(nr,ur,cr,er,ir);const dr=(cr*lr+ur)*2;or[dr]=ir[0]*255,or[dr+1]=ir[1]*255}}}function assemble(rr,er,tr,ir,nr,sr,ar){const or=ar.data,lr=ar.width;for(let cr=0,ur=tr.length;cr<ur;++cr){const dr=ir[cr],hr=tr[cr],pr=hr.data,gr=hr.width;for(let vr=0;vr<nr;++vr)for(let mr=0;mr<nr;++mr){const fr=dr[0]*nr+rr+mr,Ar=((dr[1]*nr+er+vr)*lr+fr)*4,yr=sr?(vr*vr*gr+mr*mr)*2:(vr*gr+mr)*2;or[Ar]=pr[yr],or[Ar+1]=pr[yr+1],or[Ar+2]=0,or[Ar+3]=255}}}var SMAAAreaImageData=class{static generate(){const rr=10*ORTHOGONAL_SIZE,er=orthogonalSubsamplingOffsets.length*5*ORTHOGONAL_SIZE,tr=new Uint8ClampedArray(rr*er*4),ir=new RawImageData(rr,er,tr),nr=Math.pow(ORTHOGONAL_SIZE-1,2)+1,sr=DIAGONAL_SIZE,ar=[],or=[];for(let lr=3,cr=tr.length;lr<cr;lr+=4)tr[lr]=255;for(let lr=0;lr<16;++lr)ar.push(new RawImageData(nr,nr,new Uint8ClampedArray(nr*nr*2),2)),or.push(new RawImageData(sr,sr,new Uint8ClampedArray(sr*sr*2),2));for(let lr=0,cr=orthogonalSubsamplingOffsets.length;lr<cr;++lr)generatePatterns(ar,orthogonalSubsamplingOffsets[lr],!0),assemble(0,5*ORTHOGONAL_SIZE*lr,ar,orthogonalEdges,ORTHOGONAL_SIZE,!0,ir);for(let lr=0,cr=diagonalSubsamplingOffsets.length;lr<cr;++lr)generatePatterns(or,diagonalSubsamplingOffsets[lr],!1),assemble(5*ORTHOGONAL_SIZE,4*DIAGONAL_SIZE*lr,or,diagonalEdges,DIAGONAL_SIZE,!1,ir);return ir}},worker_default2=`"use strict";(()=>{function q(t,a,s){let e=document.createElement("canvas"),n=e.getContext("2d");if(e.width=t,e.height=a,s instanceof Image)n.drawImage(s,0,0);else{let r=n.createImageData(t,a);r.data.set(s),n.putImageData(r,0,0)}return e}var F=class t{constructor(a=0,s=0,e=null){this.width=a,this.height=s,this.data=e}toCanvas(){return typeof document=="undefined"?null:q(this.width,this.height,this.data)}static from(a){let{width:s,height:e}=a,n;if(a instanceof Image){let r=q(s,e,a);r!==null&&(n=r.getContext("2d").getImageData(0,0,s,e).data)}else n=a.data;return new t(s,e,n)}};var M=[new Float32Array(2),new Float32Array(2)],D=16,W=20,I=30,j=32,v=new Float32Array([0,-.25,.25,-.125,.125,-.375,.375]),N=[new Float32Array([0,0]),new Float32Array([.25,-.25]),new Float32Array([-.25,.25]),new Float32Array([.125,-.125]),new Float32Array([-.125,.125])],z=[new Uint8Array([0,0]),new Uint8Array([3,0]),new Uint8Array([0,3]),new Uint8Array([3,3]),new Uint8Array([1,0]),new Uint8Array([4,0]),new Uint8Array([1,3]),new Uint8Array([4,3]),new Uint8Array([0,1]),new Uint8Array([3,1]),new Uint8Array([0,4]),new Uint8Array([3,4]),new Uint8Array([1,1]),new Uint8Array([4,1]),new Uint8Array([1,4]),new Uint8Array([4,4])],p=[new Uint8Array([0,0]),new Uint8Array([1,0]),new Uint8Array([0,2]),new Uint8Array([1,2]),new Uint8Array([2,0]),new Uint8Array([3,0]),new Uint8Array([2,2]),new Uint8Array([3,2]),new Uint8Array([0,1]),new Uint8Array([1,1]),new Uint8Array([0,3]),new Uint8Array([1,3]),new Uint8Array([2,1]),new Uint8Array([3,1]),new Uint8Array([2,3]),new Uint8Array([3,3])];function C(t,a,s){return t+(a-t)*s}function B(t){return Math.min(Math.max(t,0),1)}function _(t){let a=M[0],s=M[1],e=Math.sqrt(a[0]*2)*.5,n=Math.sqrt(a[1]*2)*.5,r=Math.sqrt(s[0]*2)*.5,o=Math.sqrt(s[1]*2)*.5,c=B(t/j);a[0]=C(e,a[0],c),a[1]=C(n,a[1],c),s[0]=C(r,s[0],c),s[1]=C(o,s[1],c)}function d(t,a,s,e,n,r){let o=s-t,c=e-a,h=n,i=n+1,w=a+c*(h-t)/o,b=a+c*(i-t)/o;if(h>=t&&h<s||i>t&&i<=s)if(Math.sign(w)===Math.sign(b)||Math.abs(w)<1e-4||Math.abs(b)<1e-4){let g=(w+b)/2;g<0?(r[0]=Math.abs(g),r[1]=0):(r[0]=0,r[1]=Math.abs(g))}else{let g=-a*o/c+t,k=Math.trunc(g),m=g>t?w*(g-k)/2:0,U=g<s?b*(1-(g-k))/2:0;(Math.abs(m)>Math.abs(U)?m:-U)<0?(r[0]=Math.abs(m),r[1]=Math.abs(U)):(r[0]=Math.abs(U),r[1]=Math.abs(m))}else r[0]=0,r[1]=0;return r}function J(t,a,s,e,n){let r=M[0],o=M[1],c=.5+e,h=.5+e-1,i=a+s+1;switch(t){case 0:{n[0]=0,n[1]=0;break}case 1:{a<=s?d(0,h,i/2,0,a,n):(n[0]=0,n[1]=0);break}case 2:{a>=s?d(i/2,0,i,h,a,n):(n[0]=0,n[1]=0);break}case 3:{d(0,h,i/2,0,a,r),d(i/2,0,i,h,a,o),_(i,M),n[0]=r[0]+o[0],n[1]=r[1]+o[1];break}case 4:{a<=s?d(0,c,i/2,0,a,n):(n[0]=0,n[1]=0);break}case 5:{n[0]=0,n[1]=0;break}case 6:{Math.abs(e)>0?(d(0,c,i,h,a,r),d(0,c,i/2,0,a,o),d(i/2,0,i,h,a,n),o[0]=o[0]+n[0],o[1]=o[1]+n[1],n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2):d(0,c,i,h,a,n);break}case 7:{d(0,c,i,h,a,n);break}case 8:{a>=s?d(i/2,0,i,c,a,n):(n[0]=0,n[1]=0);break}case 9:{Math.abs(e)>0?(d(0,h,i,c,a,r),d(0,h,i/2,0,a,o),d(i/2,0,i,c,a,n),o[0]=o[0]+n[0],o[1]=o[1]+n[1],n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2):d(0,h,i,c,a,n);break}case 10:{n[0]=0,n[1]=0;break}case 11:{d(0,h,i,c,a,n);break}case 12:{d(0,c,i/2,0,a,r),d(i/2,0,i,c,a,o),_(i,M),n[0]=r[0]+o[0],n[1]=r[1]+o[1];break}case 13:{d(0,h,i,c,a,n);break}case 14:{d(0,c,i,h,a,n);break}case 15:{n[0]=0,n[1]=0;break}}return n}function K(t,a,s,e,n,r){let o=t===s&&a===e;if(!o){let c=(t+s)/2,h=(a+e)/2,i=e-a,w=t-s;o=i*(n-c)+w*(r-h)>0}return o}function G(t,a,s,e,n,r){let o=0;for(let c=0;c<I;++c)for(let h=0;h<I;++h){let i=h/(I-1),w=c/(I-1);K(t,a,s,e,n+i,r+w)&&++o}return o/(I*I)}function A(t,a,s,e,n,r,o,c){let h=p[t],i=h[0],w=h[1];return i>0&&(a+=o[0],s+=o[1]),w>0&&(e+=o[0],n+=o[1]),c[0]=1-G(a,s,e,n,1+r,0+r),c[1]=G(a,s,e,n,1+r,1+r),c}function Q(t,a,s,e,n){let r=M[0],o=M[1],c=a+s+1;switch(t){case 0:{A(t,1,1,1+c,1+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 1:{A(t,1,0,0+c,0+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 2:{A(t,0,0,1+c,0+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 3:{A(t,1,0,1+c,0+c,a,e,n);break}case 4:{A(t,1,1,0+c,0+c,a,e,r),A(t,1,1,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 5:{A(t,1,1,0+c,0+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 6:{A(t,1,1,1+c,0+c,a,e,n);break}case 7:{A(t,1,1,1+c,0+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 8:{A(t,0,0,1+c,1+c,a,e,r),A(t,1,0,1+c,1+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 9:{A(t,1,0,1+c,1+c,a,e,n),A(t,1,0,1+c,1+c,a,e,n);break}case 10:{A(t,0,0,1+c,1+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 11:{A(t,1,0,1+c,1+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 12:{A(t,1,1,1+c,1+c,a,e,n);break}case 13:{A(t,1,1,1+c,1+c,a,e,r),A(t,1,0,1+c,1+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 14:{A(t,1,1,1+c,1+c,a,e,r),A(t,1,1,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}case 15:{A(t,1,1,1+c,1+c,a,e,r),A(t,1,0,1+c,0+c,a,e,o),n[0]=(r[0]+o[0])/2,n[1]=(r[1]+o[1])/2;break}}return n}function R(t,a,s){let e=new Float32Array(2);for(let n=0,r=t.length;n<r;++n){let o=t[n],c=o.data,h=o.width;for(let i=0;i<h;++i)for(let w=0;w<h;++w){s?J(n,w,i,a,e):Q(n,w,i,a,e);let b=(i*h+w)*2;c[b]=e[0]*255,c[b+1]=e[1]*255}}}function T(t,a,s,e,n,r,o){let c=o.data,h=o.width;for(let i=0,w=s.length;i<w;++i){let b=e[i],g=s[i],k=g.data,m=g.width;for(let U=0;U<n;++U)for(let x=0;x<n;++x){let Z=b[0]*n+t+x,O=((b[1]*n+a+U)*h+Z)*4,L=r?(U*U*m+x*x)*2:(U*m+x)*2;c[O]=k[L],c[O+1]=k[L+1],c[O+2]=0,c[O+3]=255}}}var S=class{static generate(){let a=10*D,s=v.length*5*D,e=new Uint8ClampedArray(a*s*4),n=new F(a,s,e),r=Math.pow(D-1,2)+1,o=W,c=[],h=[];for(let i=3,w=e.length;i<w;i+=4)e[i]=255;for(let i=0;i<16;++i)c.push(new F(r,r,new Uint8ClampedArray(r*r*2),2)),h.push(new F(o,o,new Uint8ClampedArray(o*o*2),2));for(let i=0,w=v.length;i<w;++i)R(c,v[i],!0),T(0,5*D*i,c,z,D,!0,n);for(let i=0,w=N.length;i<w;++i)R(h,N[i],!1),T(5*D,4*W*i,h,p,W,!1,n);return n}};var P=new Map([[y(0,0,0,0),new Float32Array([0,0,0,0])],[y(0,0,0,1),new Float32Array([0,0,0,1])],[y(0,0,1,0),new Float32Array([0,0,1,0])],[y(0,0,1,1),new Float32Array([0,0,1,1])],[y(0,1,0,0),new Float32Array([0,1,0,0])],[y(0,1,0,1),new Float32Array([0,1,0,1])],[y(0,1,1,0),new Float32Array([0,1,1,0])],[y(0,1,1,1),new Float32Array([0,1,1,1])],[y(1,0,0,0),new Float32Array([1,0,0,0])],[y(1,0,0,1),new Float32Array([1,0,0,1])],[y(1,0,1,0),new Float32Array([1,0,1,0])],[y(1,0,1,1),new Float32Array([1,0,1,1])],[y(1,1,0,0),new Float32Array([1,1,0,0])],[y(1,1,0,1),new Float32Array([1,1,0,1])],[y(1,1,1,0),new Float32Array([1,1,1,0])],[y(1,1,1,1),new Float32Array([1,1,1,1])]]);function H(t,a,s){return t+(a-t)*s}function y(t,a,s,e){let n=H(t,a,.75),r=H(s,e,1-.25);return H(n,r,1-.125)}function V(t,a){let s=0;return a[3]===1&&(s+=1),s===1&&a[2]===1&&t[1]!==1&&t[3]!==1&&(s+=1),s}function $(t,a){let s=0;return a[3]===1&&t[1]!==1&&t[3]!==1&&(s+=1),s===1&&a[2]===1&&t[0]!==1&&t[2]!==1&&(s+=1),s}var E=class{static generate(){let o=new Uint8ClampedArray(2178),c=new Uint8ClampedArray(64*16*4);for(let h=0;h<33;++h)for(let i=0;i<66;++i){let w=.03125*i,b=.03125*h;if(P.has(w)&&P.has(b)){let g=P.get(w),k=P.get(b),m=h*66+i;o[m]=127*V(g,k),o[m+33]=127*$(g,k)}}for(let h=0,i=17;i<33;++i)for(let w=0;w<64;++w,h+=4)c[h]=o[i*66+w],c[h+3]=255;return new F(64,16,c)}};self.addEventListener("message",t=>{let a=S.generate(),s=E.generate();postMessage({areaImageData:a,searchImageData:s},[a.data.buffer,s.data.buffer]),close()});})();
`;function generate(rr=!0){const er=URL.createObjectURL(new Blob([worker_default2],{type:"text/javascript"})),tr=new Worker(er);return URL.revokeObjectURL(er),new Promise((ir,nr)=>{tr.addEventListener("error",sr=>nr(sr.error)),tr.addEventListener("message",sr=>{const ar=RawImageData.from(sr.data.searchImageData),or=RawImageData.from(sr.data.areaImageData),lr=[ar.toCanvas().toDataURL("image/png",1),or.toCanvas().toDataURL("image/png",1)];rr&&(localStorage.setItem("smaa-search",lr[0]),localStorage.setItem("smaa-area",lr[1])),ir(lr)}),tr.postMessage(null)})}var SMAAImageGenerator=class{constructor(){this.disableCache=!1}setCacheEnabled(rr){this.disableCache=!rr}generate(){const rr=!this.disableCache&&window.localStorage!==void 0,er=rr?[localStorage.getItem("smaa-search"),localStorage.getItem("smaa-area")]:[null,null];return(er[0]!==null&&er[1]!==null?Promise.resolve(er):generate(rr)).then(ir=>new Promise((nr,sr)=>{const ar=new Image,or=new Image,lr=new LoadingManager;lr.onLoad=()=>nr([ar,or]),lr.onError=sr,ar.addEventListener("error",cr=>lr.itemError("smaa-search")),or.addEventListener("error",cr=>lr.itemError("smaa-area")),ar.addEventListener("load",()=>lr.itemEnd("smaa-search")),or.addEventListener("load",()=>lr.itemEnd("smaa-area")),lr.itemStart("smaa-search"),lr.itemStart("smaa-area"),ar.src=ir[0],or.src=ir[1]}))}},edges=new Map([[bilinear(0,0,0,0),new Float32Array([0,0,0,0])],[bilinear(0,0,0,1),new Float32Array([0,0,0,1])],[bilinear(0,0,1,0),new Float32Array([0,0,1,0])],[bilinear(0,0,1,1),new Float32Array([0,0,1,1])],[bilinear(0,1,0,0),new Float32Array([0,1,0,0])],[bilinear(0,1,0,1),new Float32Array([0,1,0,1])],[bilinear(0,1,1,0),new Float32Array([0,1,1,0])],[bilinear(0,1,1,1),new Float32Array([0,1,1,1])],[bilinear(1,0,0,0),new Float32Array([1,0,0,0])],[bilinear(1,0,0,1),new Float32Array([1,0,0,1])],[bilinear(1,0,1,0),new Float32Array([1,0,1,0])],[bilinear(1,0,1,1),new Float32Array([1,0,1,1])],[bilinear(1,1,0,0),new Float32Array([1,1,0,0])],[bilinear(1,1,0,1),new Float32Array([1,1,0,1])],[bilinear(1,1,1,0),new Float32Array([1,1,1,0])],[bilinear(1,1,1,1),new Float32Array([1,1,1,1])]]);function lerp2(rr,er,tr){return rr+(er-rr)*tr}function bilinear(rr,er,tr,ir){const nr=lerp2(rr,er,.75),sr=lerp2(tr,ir,1-.25);return lerp2(nr,sr,1-.125)}function deltaLeft(rr,er){let tr=0;return er[3]===1&&(tr+=1),tr===1&&er[2]===1&&rr[1]!==1&&rr[3]!==1&&(tr+=1),tr}function deltaRight(rr,er){let tr=0;return er[3]===1&&rr[1]!==1&&rr[3]!==1&&(tr+=1),tr===1&&er[2]===1&&rr[0]!==1&&rr[2]!==1&&(tr+=1),tr}var SMAASearchImageData=class{static generate(){const sr=new Uint8ClampedArray(2178),ar=new Uint8ClampedArray(64*16*4);for(let or=0;or<33;++or)for(let lr=0;lr<66;++lr){const cr=.03125*lr,ur=.03125*or;if(edges.has(cr)&&edges.has(ur)){const dr=edges.get(cr),hr=edges.get(ur),pr=or*66+lr;sr[pr]=127*deltaLeft(dr,hr),sr[pr+33]=127*deltaRight(dr,hr)}}for(let or=0,lr=17;lr<33;++lr)for(let cr=0;cr<64;++cr,or+=4)ar[or]=sr[lr*66+cr],ar[or+3]=255;return new RawImageData(64,16,ar)}},Stats=function(){var rr=0,er=document.createElement("div");er.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",er.addEventListener("click",function(ur){ur.preventDefault(),ir(++rr%er.children.length)},!1);function tr(ur){return er.appendChild(ur.dom),ur}function ir(ur){for(var dr=0;dr<er.children.length;dr++)er.children[dr].style.display=dr===ur?"block":"none";rr=ur}var nr=(performance||Date).now(),sr=nr,ar=0,or=tr(new Stats.Panel("FPS","#0ff","#002")),lr=tr(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var cr=tr(new Stats.Panel("MB","#f08","#201"));return ir(0),{REVISION:16,dom:er,addPanel:tr,showPanel:ir,begin:function(){nr=(performance||Date).now()},end:function(){ar++;var ur=(performance||Date).now();if(lr.update(ur-nr,200),ur>=sr+1e3&&(or.update(ar*1e3/(ur-sr),100),sr=ur,ar=0,cr)){var dr=performance.memory;cr.update(dr.usedJSHeapSize/1048576,dr.jsHeapSizeLimit/1048576)}return ur},update:function(){nr=this.end()},domElement:er,setMode:ir}};Stats.Panel=function(rr,er,tr){var ir=1/0,nr=0,sr=Math.round,ar=sr(window.devicePixelRatio||1),or=80*ar,lr=48*ar,cr=3*ar,ur=2*ar,dr=3*ar,hr=15*ar,pr=74*ar,gr=30*ar,vr=document.createElement("canvas");vr.width=or,vr.height=lr,vr.style.cssText="width:80px;height:48px";var mr=vr.getContext("2d");return mr.font="bold "+9*ar+"px Helvetica,Arial,sans-serif",mr.textBaseline="top",mr.fillStyle=tr,mr.fillRect(0,0,or,lr),mr.fillStyle=er,mr.fillText(rr,cr,ur),mr.fillRect(dr,hr,pr,gr),mr.fillStyle=tr,mr.globalAlpha=.9,mr.fillRect(dr,hr,pr,gr),{dom:vr,update:function(fr,_r){ir=Math.min(ir,fr),nr=Math.max(nr,fr),mr.fillStyle=tr,mr.globalAlpha=1,mr.fillRect(0,0,or,hr),mr.fillStyle=er,mr.fillText(sr(fr)+" "+rr+" ("+sr(ir)+"-"+sr(nr)+")",cr,ur),mr.drawImage(vr,dr+ar,hr,pr-ar,gr,dr,hr,pr-ar,gr),mr.fillRect(dr+pr-ar,hr,ar,gr),mr.fillStyle=tr,mr.globalAlpha=.9,mr.fillRect(dr+pr-ar,hr,ar,sr((1-fr/_r)*gr))}}};const COOLDOWN=60;let bag,player$1;class TrashBin{constructor(er){this.cooldown=0,this.tools=["medicine","vision","vision","transmit","sprint","sprint"],this.probability_add=0,this.mesh=er}get position(){return this.mesh.position}interact(){if(this.cooldown>0)return;console.log("here"),player$1.audio_play("ding");let er=Math.random();er<=.7?player$1.add_MP(100):er<=.9?player$1.add_MP(150):player$1.add_MP(200),er=Math.random(),er<=player$1.get_probability()+this.probability_add?(this.probability_add=0,er=Math.random(),er=er*this.tools.length,er=Math.floor(er),er<this.tools.length&&bag.insert(this.tools[er])):this.probability_add+=player$1.get_probability()*.5,this.cooldown=COOLDOWN}update(er){this.cooldown-=er,this.cooldown<0&&(this.cooldown=0)}reset(){this.cooldown=0}}class Trash extends GameObject{constructor(){super(...arguments),this.trashbin=[],this.closeTrash=[]}async init(){player$1=this.game.getGameObj(Player),bag=this.game.getGameObj(Bag)}lateinit(){this.game.scene.traverse(er=>{er.isMesh&&er.name.match("trash")&&this.trashbin.push(new TrashBin(er))})}reset(){for(let er of this.trashbin)er.reset()}update(){this.closeTrash=[];for(let er of this.trashbin){er.update(this.game.deltatime);let tr=er.position.distanceTo(player$1.get_mesh_position());tr<=1.5&&player$1.set_interact("Trash",er),tr<=10&&er.cooldown<=0&&this.closeTrash.push(er.mesh)}}}let moveHint,hint2,hint3,curMP,player;class Tutorial extends GameObject{constructor(){super(...arguments),this.enabled=!0}beforeStart(){player=this.game.getGameObj(Player),this.initPos=player.position.clone()}update(){if(this.enabled){if(moveHint===void 0&&(moveHint=createHint(`Hold WASD to move, space to sprint. Drag screen and scroll to adjust view.
 Press 1~4 to switch item and press E to use.`)),moveHint!==null&&player.position.distanceTo(this.initPos)>.1&&(removeHint(moveHint),moveHint=null,hint2=[createHint("The goal is to ignite some of the altars and then escape from the gate."),createHint(`To ignite altars, first collect mana from trash bin(?)
  Go and search for a trash bin nearby.`),createHint("PS: Press Enter to pause/resume the game")]),hint2&&player.mana>0){for(let er of hint2)removeHint(er);hint2=null,hint3=createHint("Use mana to ignite altars. You can find two altars on the bridges."),curMP=player.mana}if(hint3&&player.mana<curMP){removeHint(hint3),hint3=null;let er=createHint("Tutorial is over.Good Luck!");setTimeout(()=>{removeHint(er)},5e3)}}}reset(){if(moveHint&&removeHint(moveHint),hint2)for(let er of hint2)removeHint(er);hint3&&removeHint(hint3),moveHint=hint2=hint3=curMP=void 0,this.enabled=!0}}class GameMap extends GameObject{constructor(){super(...arguments),this.elem=document.getElementById("smallmap"),this.renderer=new WebGLRenderer({antialias:!0,canvas:this.elem}),this.camera=new PerspectiveCamera(20),this.light=new DirectionalLight(16777215,10),this.mesh=new Mesh(new CylinderGeometry(.5,.5,1.5),new MeshPhongMaterial({color:16711680}))}async init(){this.camera.layers.set(16),this.camera.layers.enable(20),this.mesh.layers.set(20),this.light.layers.set(20),this.game.scene.add(this.mesh),this.game.scene.add(this.light),this.player=this.game.getGameObj(Player),this.camera.position.set(0,80,0),this.camera.rotateX(-Math.PI/2),this.camera.rotateZ(Math.PI),this.renderer.setSize(window.innerHeight/4,window.innerHeight/4),window.addEventListener("resize",()=>{this.renderer.setSize(window.innerHeight/4,window.innerHeight/4)})}lateUpdate(){this.camera.position.x=this.player.position.x,this.camera.position.z=this.player.position.z,this.mesh.position.copy(this.player.position);let er=this.game.scene.fog;this.game.scene.fog=null,this.renderer.render(this.game.scene,this.camera),this.game.scene.fog=er}}const CENTER=0,AVERAGE=1,SAH=2,NOT_INTERSECTED=0,INTERSECTED=1,CONTAINED=2,TRIANGLE_INTERSECT_COST=1.25,TRAVERSAL_COST=1,BYTES_PER_NODE=6*4+4+4,IS_LEAFNODE_FLAG=65535,FLOAT32_EPSILON=Math.pow(2,-24),SKIP_GENERATION=Symbol("SKIP_GENERATION");function getVertexCount(rr){return rr.index?rr.index.count:rr.attributes.position.count}function getTriCount(rr){return getVertexCount(rr)/3}function getIndexArray(rr,er=ArrayBuffer){return rr>65535?new Uint32Array(new er(4*rr)):new Uint16Array(new er(2*rr))}function ensureIndex(rr,er){if(!rr.index){const tr=rr.attributes.position.count,ir=er.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,nr=getIndexArray(tr,ir);rr.setIndex(new BufferAttribute(nr,1));for(let sr=0;sr<tr;sr++)nr[sr]=sr}}function getFullGeometryRange(rr,er){const tr=getTriCount(rr),ir=er||rr.drawRange,nr=ir.start/3,sr=(ir.start+ir.count)/3,ar=Math.max(0,nr),or=Math.min(tr,sr)-ar;return[{offset:Math.floor(ar),count:Math.floor(or)}]}function getRootIndexRanges(rr,er){if(!rr.groups||!rr.groups.length)return getFullGeometryRange(rr,er);const tr=[],ir=new Set,nr=er||rr.drawRange,sr=nr.start/3,ar=(nr.start+nr.count)/3;for(const lr of rr.groups){const cr=lr.start/3,ur=(lr.start+lr.count)/3;ir.add(Math.max(sr,cr)),ir.add(Math.min(ar,ur))}const or=Array.from(ir.values()).sort((lr,cr)=>lr-cr);for(let lr=0;lr<or.length-1;lr++){const cr=or[lr],ur=or[lr+1];tr.push({offset:Math.floor(cr),count:Math.floor(ur-cr)})}return tr}function hasGroupGaps(rr,er){const tr=getTriCount(rr),ir=getRootIndexRanges(rr,er).sort((ar,or)=>ar.offset-or.offset),nr=ir[ir.length-1];nr.count=Math.min(tr-nr.offset,nr.count);let sr=0;return ir.forEach(({count:ar})=>sr+=ar),tr!==sr}function getBounds(rr,er,tr,ir,nr){let sr=1/0,ar=1/0,or=1/0,lr=-1/0,cr=-1/0,ur=-1/0,dr=1/0,hr=1/0,pr=1/0,gr=-1/0,vr=-1/0,mr=-1/0;for(let fr=er*6,_r=(er+tr)*6;fr<_r;fr+=6){const Ar=rr[fr+0],yr=rr[fr+1],wr=Ar-yr,xr=Ar+yr;wr<sr&&(sr=wr),xr>lr&&(lr=xr),Ar<dr&&(dr=Ar),Ar>gr&&(gr=Ar);const Sr=rr[fr+2],br=rr[fr+3],Cr=Sr-br,Ir=Sr+br;Cr<ar&&(ar=Cr),Ir>cr&&(cr=Ir),Sr<hr&&(hr=Sr),Sr>vr&&(vr=Sr);const Rr=rr[fr+4],Pr=rr[fr+5],Dr=Rr-Pr,Fr=Rr+Pr;Dr<or&&(or=Dr),Fr>ur&&(ur=Fr),Rr<pr&&(pr=Rr),Rr>mr&&(mr=Rr)}ir[0]=sr,ir[1]=ar,ir[2]=or,ir[3]=lr,ir[4]=cr,ir[5]=ur,nr[0]=dr,nr[1]=hr,nr[2]=pr,nr[3]=gr,nr[4]=vr,nr[5]=mr}function computeTriangleBounds(rr,er=null,tr=null,ir=null){const nr=rr.attributes.position,sr=rr.index?rr.index.array:null,ar=getTriCount(rr),or=nr.normalized;let lr;er===null?(lr=new Float32Array(ar*6),tr=0,ir=ar):(lr=er,tr=tr||0,ir=ir||ar);const cr=nr.array,ur=nr.offset||0;let dr=3;nr.isInterleavedBufferAttribute&&(dr=nr.data.stride);const hr=["getX","getY","getZ"];for(let pr=tr;pr<tr+ir;pr++){const gr=pr*3,vr=pr*6;let mr=gr+0,fr=gr+1,_r=gr+2;sr&&(mr=sr[mr],fr=sr[fr],_r=sr[_r]),or||(mr=mr*dr+ur,fr=fr*dr+ur,_r=_r*dr+ur);for(let Ar=0;Ar<3;Ar++){let yr,wr,xr;or?(yr=nr[hr[Ar]](mr),wr=nr[hr[Ar]](fr),xr=nr[hr[Ar]](_r)):(yr=cr[mr+Ar],wr=cr[fr+Ar],xr=cr[_r+Ar]);let Sr=yr;wr<Sr&&(Sr=wr),xr<Sr&&(Sr=xr);let br=yr;wr>br&&(br=wr),xr>br&&(br=xr);const Cr=(br-Sr)/2,Ir=Ar*2;lr[vr+Ir+0]=Sr+Cr,lr[vr+Ir+1]=Cr+(Math.abs(Sr)+Cr)*FLOAT32_EPSILON}}return lr}function arrayToBox(rr,er,tr){return tr.min.x=er[rr],tr.min.y=er[rr+1],tr.min.z=er[rr+2],tr.max.x=er[rr+3],tr.max.y=er[rr+4],tr.max.z=er[rr+5],tr}function makeEmptyBounds(rr){rr[0]=rr[1]=rr[2]=1/0,rr[3]=rr[4]=rr[5]=-1/0}function getLongestEdgeIndex(rr){let er=-1,tr=-1/0;for(let ir=0;ir<3;ir++){const nr=rr[ir+3]-rr[ir];nr>tr&&(tr=nr,er=ir)}return er}function copyBounds(rr,er){er.set(rr)}function unionBounds(rr,er,tr){let ir,nr;for(let sr=0;sr<3;sr++){const ar=sr+3;ir=rr[sr],nr=er[sr],tr[sr]=ir<nr?ir:nr,ir=rr[ar],nr=er[ar],tr[ar]=ir>nr?ir:nr}}function expandByTriangleBounds(rr,er,tr){for(let ir=0;ir<3;ir++){const nr=er[rr+2*ir],sr=er[rr+2*ir+1],ar=nr-sr,or=nr+sr;ar<tr[ir]&&(tr[ir]=ar),or>tr[ir+3]&&(tr[ir+3]=or)}}function computeSurfaceArea(rr){const er=rr[3]-rr[0],tr=rr[4]-rr[1],ir=rr[5]-rr[2];return 2*(er*tr+tr*ir+ir*er)}const BIN_COUNT=32,binsSort=(rr,er)=>rr.candidate-er.candidate,sahBins=new Array(BIN_COUNT).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),leftBounds=new Float32Array(6);function getOptimalSplit(rr,er,tr,ir,nr,sr){let ar=-1,or=0;if(sr===CENTER)ar=getLongestEdgeIndex(er),ar!==-1&&(or=(er[ar]+er[ar+3])/2);else if(sr===AVERAGE)ar=getLongestEdgeIndex(rr),ar!==-1&&(or=getAverage(tr,ir,nr,ar));else if(sr===SAH){const lr=computeSurfaceArea(rr);let cr=TRIANGLE_INTERSECT_COST*nr;const ur=ir*6,dr=(ir+nr)*6;for(let hr=0;hr<3;hr++){const pr=er[hr],mr=(er[hr+3]-pr)/BIN_COUNT;if(nr<BIN_COUNT/4){const fr=[...sahBins];fr.length=nr;let _r=0;for(let yr=ur;yr<dr;yr+=6,_r++){const wr=fr[_r];wr.candidate=tr[yr+2*hr],wr.count=0;const{bounds:xr,leftCacheBounds:Sr,rightCacheBounds:br}=wr;for(let Cr=0;Cr<3;Cr++)br[Cr]=1/0,br[Cr+3]=-1/0,Sr[Cr]=1/0,Sr[Cr+3]=-1/0,xr[Cr]=1/0,xr[Cr+3]=-1/0;expandByTriangleBounds(yr,tr,xr)}fr.sort(binsSort);let Ar=nr;for(let yr=0;yr<Ar;yr++){const wr=fr[yr];for(;yr+1<Ar&&fr[yr+1].candidate===wr.candidate;)fr.splice(yr+1,1),Ar--}for(let yr=ur;yr<dr;yr+=6){const wr=tr[yr+2*hr];for(let xr=0;xr<Ar;xr++){const Sr=fr[xr];wr>=Sr.candidate?expandByTriangleBounds(yr,tr,Sr.rightCacheBounds):(expandByTriangleBounds(yr,tr,Sr.leftCacheBounds),Sr.count++)}}for(let yr=0;yr<Ar;yr++){const wr=fr[yr],xr=wr.count,Sr=nr-wr.count,br=wr.leftCacheBounds,Cr=wr.rightCacheBounds;let Ir=0;xr!==0&&(Ir=computeSurfaceArea(br)/lr);let Rr=0;Sr!==0&&(Rr=computeSurfaceArea(Cr)/lr);const Pr=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(Ir*xr+Rr*Sr);Pr<cr&&(ar=hr,cr=Pr,or=wr.candidate)}}else{for(let Ar=0;Ar<BIN_COUNT;Ar++){const yr=sahBins[Ar];yr.count=0,yr.candidate=pr+mr+Ar*mr;const wr=yr.bounds;for(let xr=0;xr<3;xr++)wr[xr]=1/0,wr[xr+3]=-1/0}for(let Ar=ur;Ar<dr;Ar+=6){let xr=~~((tr[Ar+2*hr]-pr)/mr);xr>=BIN_COUNT&&(xr=BIN_COUNT-1);const Sr=sahBins[xr];Sr.count++,expandByTriangleBounds(Ar,tr,Sr.bounds)}const fr=sahBins[BIN_COUNT-1];copyBounds(fr.bounds,fr.rightCacheBounds);for(let Ar=BIN_COUNT-2;Ar>=0;Ar--){const yr=sahBins[Ar],wr=sahBins[Ar+1];unionBounds(yr.bounds,wr.rightCacheBounds,yr.rightCacheBounds)}let _r=0;for(let Ar=0;Ar<BIN_COUNT-1;Ar++){const yr=sahBins[Ar],wr=yr.count,xr=yr.bounds,br=sahBins[Ar+1].rightCacheBounds;wr!==0&&(_r===0?copyBounds(xr,leftBounds):unionBounds(xr,leftBounds,leftBounds)),_r+=wr;let Cr=0,Ir=0;_r!==0&&(Cr=computeSurfaceArea(leftBounds)/lr);const Rr=nr-_r;Rr!==0&&(Ir=computeSurfaceArea(br)/lr);const Pr=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(Cr*_r+Ir*Rr);Pr<cr&&(ar=hr,cr=Pr,or=yr.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${sr} used.`);return{axis:ar,pos:or}}function getAverage(rr,er,tr,ir){let nr=0;for(let sr=er,ar=er+tr;sr<ar;sr++)nr+=rr[sr*6+ir*2];return nr/tr}class MeshBVHNode{constructor(){this.boundingData=new Float32Array(6)}}function partition(rr,er,tr,ir,nr,sr){let ar=ir,or=ir+nr-1;const lr=sr.pos,cr=sr.axis*2;for(;;){for(;ar<=or&&tr[ar*6+cr]<lr;)ar++;for(;ar<=or&&tr[or*6+cr]>=lr;)or--;if(ar<or){for(let ur=0;ur<3;ur++){let dr=er[ar*3+ur];er[ar*3+ur]=er[or*3+ur],er[or*3+ur]=dr}for(let ur=0;ur<6;ur++){let dr=tr[ar*6+ur];tr[ar*6+ur]=tr[or*6+ur],tr[or*6+ur]=dr}ar++,or--}else return ar}}function partition_indirect(rr,er,tr,ir,nr,sr){let ar=ir,or=ir+nr-1;const lr=sr.pos,cr=sr.axis*2;for(;;){for(;ar<=or&&tr[ar*6+cr]<lr;)ar++;for(;ar<=or&&tr[or*6+cr]>=lr;)or--;if(ar<or){let ur=rr[ar];rr[ar]=rr[or],rr[or]=ur;for(let dr=0;dr<6;dr++){let hr=tr[ar*6+dr];tr[ar*6+dr]=tr[or*6+dr],tr[or*6+dr]=hr}ar++,or--}else return ar}}function IS_LEAF(rr,er){return er[rr+15]===65535}function OFFSET(rr,er){return er[rr+6]}function COUNT(rr,er){return er[rr+14]}function LEFT_NODE(rr){return rr+8}function RIGHT_NODE(rr,er){return er[rr+6]}function SPLIT_AXIS(rr,er){return er[rr+7]}function BOUNDING_DATA_INDEX(rr){return rr}let float32Array,uint32Array,uint16Array,uint8Array;const MAX_POINTER=Math.pow(2,32);function countNodes(rr){return"count"in rr?1:1+countNodes(rr.left)+countNodes(rr.right)}function populateBuffer(rr,er,tr){return float32Array=new Float32Array(tr),uint32Array=new Uint32Array(tr),uint16Array=new Uint16Array(tr),uint8Array=new Uint8Array(tr),_populateBuffer(rr,er)}function _populateBuffer(rr,er){const tr=rr/4,ir=rr/2,nr="count"in er,sr=er.boundingData;for(let ar=0;ar<6;ar++)float32Array[tr+ar]=sr[ar];if(nr)if(er.buffer){const ar=er.buffer;uint8Array.set(new Uint8Array(ar),rr);for(let or=rr,lr=rr+ar.byteLength;or<lr;or+=BYTES_PER_NODE){const cr=or/2;IS_LEAF(cr,uint16Array)||(uint32Array[or/4+6]+=tr)}return rr+ar.byteLength}else{const ar=er.offset,or=er.count;return uint32Array[tr+6]=ar,uint16Array[ir+14]=or,uint16Array[ir+15]=IS_LEAFNODE_FLAG,rr+BYTES_PER_NODE}else{const ar=er.left,or=er.right,lr=er.splitAxis;let cr;if(cr=_populateBuffer(rr+BYTES_PER_NODE,ar),cr/4>MAX_POINTER)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return uint32Array[tr+6]=cr/4,cr=_populateBuffer(cr,or),uint32Array[tr+7]=lr,cr}}function generateIndirectBuffer(rr,er){const tr=(rr.index?rr.index.count:rr.attributes.position.count)/3,ir=tr>2**16,nr=ir?4:2,sr=er?new SharedArrayBuffer(tr*nr):new ArrayBuffer(tr*nr),ar=ir?new Uint32Array(sr):new Uint16Array(sr);for(let or=0,lr=ar.length;or<lr;or++)ar[or]=or;return ar}function buildTree(rr,er,tr,ir,nr){const{maxDepth:sr,verbose:ar,maxLeafTris:or,strategy:lr,onProgress:cr,indirect:ur}=nr,dr=rr._indirectBuffer,hr=rr.geometry,pr=hr.index?hr.index.array:null,gr=ur?partition_indirect:partition,vr=getTriCount(hr),mr=new Float32Array(6);let fr=!1;const _r=new MeshBVHNode;return getBounds(er,tr,ir,_r.boundingData,mr),yr(_r,tr,ir,mr),_r;function Ar(wr){cr&&cr(wr/vr)}function yr(wr,xr,Sr,br=null,Cr=0){if(!fr&&Cr>=sr&&(fr=!0,ar&&(console.warn(`MeshBVH: Max depth of ${sr} reached when generating BVH. Consider increasing maxDepth.`),console.warn(hr))),Sr<=or||Cr>=sr)return Ar(xr+Sr),wr.offset=xr,wr.count=Sr,wr;const Ir=getOptimalSplit(wr.boundingData,br,er,xr,Sr,lr);if(Ir.axis===-1)return Ar(xr+Sr),wr.offset=xr,wr.count=Sr,wr;const Rr=gr(dr,pr,er,xr,Sr,Ir);if(Rr===xr||Rr===xr+Sr)Ar(xr+Sr),wr.offset=xr,wr.count=Sr;else{wr.splitAxis=Ir.axis;const Pr=new MeshBVHNode,Dr=xr,Fr=Rr-xr;wr.left=Pr,getBounds(er,Dr,Fr,Pr.boundingData,mr),yr(Pr,Dr,Fr,mr,Cr+1);const Or=new MeshBVHNode,Nr=Rr,Ur=Sr-Fr;wr.right=Or,getBounds(er,Nr,Ur,Or.boundingData,mr),yr(Or,Nr,Ur,mr,Cr+1)}return wr}}function buildPackedTree(rr,er){const tr=rr.geometry;er.indirect&&(rr._indirectBuffer=generateIndirectBuffer(tr,er.useSharedArrayBuffer),hasGroupGaps(tr,er.range)&&!er.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),rr._indirectBuffer||ensureIndex(tr,er);const ir=er.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,nr=computeTriangleBounds(tr),sr=er.indirect?getFullGeometryRange(tr,er.range):getRootIndexRanges(tr,er.range);rr._roots=sr.map(ar=>{const or=buildTree(rr,nr,ar.offset,ar.count,er),lr=countNodes(or),cr=new ir(BYTES_PER_NODE*lr);return populateBuffer(0,or,cr),cr})}class SeparatingAxisBounds{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(er,tr){let ir=1/0,nr=-1/0;for(let sr=0,ar=er.length;sr<ar;sr++){const lr=er[sr][tr];ir=lr<ir?lr:ir,nr=lr>nr?lr:nr}this.min=ir,this.max=nr}setFromPoints(er,tr){let ir=1/0,nr=-1/0;for(let sr=0,ar=tr.length;sr<ar;sr++){const or=tr[sr],lr=er.dot(or);ir=lr<ir?lr:ir,nr=lr>nr?lr:nr}this.min=ir,this.max=nr}isSeparated(er){return this.min>er.max||er.min>this.max}}SeparatingAxisBounds.prototype.setFromBox=function(){const rr=new Vector3$1;return function(tr,ir){const nr=ir.min,sr=ir.max;let ar=1/0,or=-1/0;for(let lr=0;lr<=1;lr++)for(let cr=0;cr<=1;cr++)for(let ur=0;ur<=1;ur++){rr.x=nr.x*lr+sr.x*(1-lr),rr.y=nr.y*cr+sr.y*(1-cr),rr.z=nr.z*ur+sr.z*(1-ur);const dr=tr.dot(rr);ar=Math.min(dr,ar),or=Math.max(dr,or)}this.min=ar,this.max=or}}();const areIntersecting=function(){const rr=new SeparatingAxisBounds;return function(tr,ir){const nr=tr.points,sr=tr.satAxes,ar=tr.satBounds,or=ir.points,lr=ir.satAxes,cr=ir.satBounds;for(let ur=0;ur<3;ur++){const dr=ar[ur],hr=sr[ur];if(rr.setFromPoints(hr,or),dr.isSeparated(rr))return!1}for(let ur=0;ur<3;ur++){const dr=cr[ur],hr=lr[ur];if(rr.setFromPoints(hr,nr),dr.isSeparated(rr))return!1}}}(),closestPointLineToLine=function(){const rr=new Vector3$1,er=new Vector3$1,tr=new Vector3$1;return function(nr,sr,ar){const or=nr.start,lr=rr,cr=sr.start,ur=er;tr.subVectors(or,cr),rr.subVectors(nr.end,nr.start),er.subVectors(sr.end,sr.start);const dr=tr.dot(ur),hr=ur.dot(lr),pr=ur.dot(ur),gr=tr.dot(lr),mr=lr.dot(lr)*pr-hr*hr;let fr,_r;mr!==0?fr=(dr*hr-gr*pr)/mr:fr=0,_r=(dr+fr*hr)/pr,ar.x=fr,ar.y=_r}}(),closestPointsSegmentToSegment=function(){const rr=new Vector2,er=new Vector3$1,tr=new Vector3$1;return function(nr,sr,ar,or){closestPointLineToLine(nr,sr,rr);let lr=rr.x,cr=rr.y;if(lr>=0&&lr<=1&&cr>=0&&cr<=1){nr.at(lr,ar),sr.at(cr,or);return}else if(lr>=0&&lr<=1){cr<0?sr.at(0,or):sr.at(1,or),nr.closestPointToPoint(or,!0,ar);return}else if(cr>=0&&cr<=1){lr<0?nr.at(0,ar):nr.at(1,ar),sr.closestPointToPoint(ar,!0,or);return}else{let ur;lr<0?ur=nr.start:ur=nr.end;let dr;cr<0?dr=sr.start:dr=sr.end;const hr=er,pr=tr;if(nr.closestPointToPoint(dr,!0,er),sr.closestPointToPoint(ur,!0,tr),hr.distanceToSquared(dr)<=pr.distanceToSquared(ur)){ar.copy(hr),or.copy(dr);return}else{ar.copy(ur),or.copy(pr);return}}}}(),sphereIntersectTriangle=function(){const rr=new Vector3$1,er=new Vector3$1,tr=new Plane,ir=new Line3;return function(sr,ar){const{radius:or,center:lr}=sr,{a:cr,b:ur,c:dr}=ar;if(ir.start=cr,ir.end=ur,ir.closestPointToPoint(lr,!0,rr).distanceTo(lr)<=or||(ir.start=cr,ir.end=dr,ir.closestPointToPoint(lr,!0,rr).distanceTo(lr)<=or)||(ir.start=ur,ir.end=dr,ir.closestPointToPoint(lr,!0,rr).distanceTo(lr)<=or))return!0;const vr=ar.getPlane(tr);if(Math.abs(vr.distanceToPoint(lr))<=or){const fr=vr.projectPoint(lr,er);if(ar.containsPoint(fr))return!0}return!1}}(),ZERO_EPSILON=1e-15;function isNearZero(rr){return Math.abs(rr)<ZERO_EPSILON}class ExtendedTriangle extends Triangle$2{constructor(...er){super(...er),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Vector3$1),this.satBounds=new Array(4).fill().map(()=>new SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new Sphere,this.plane=new Plane,this.needsUpdate=!0}intersectsSphere(er){return sphereIntersectTriangle(er,this)}update(){const er=this.a,tr=this.b,ir=this.c,nr=this.points,sr=this.satAxes,ar=this.satBounds,or=sr[0],lr=ar[0];this.getNormal(or),lr.setFromPoints(or,nr);const cr=sr[1],ur=ar[1];cr.subVectors(er,tr),ur.setFromPoints(cr,nr);const dr=sr[2],hr=ar[2];dr.subVectors(tr,ir),hr.setFromPoints(dr,nr);const pr=sr[3],gr=ar[3];pr.subVectors(ir,er),gr.setFromPoints(pr,nr),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(or,er),this.needsUpdate=!1}}ExtendedTriangle.prototype.closestPointToSegment=function(){const rr=new Vector3$1,er=new Vector3$1,tr=new Line3;return function(nr,sr=null,ar=null){const{start:or,end:lr}=nr,cr=this.points;let ur,dr=1/0;for(let hr=0;hr<3;hr++){const pr=(hr+1)%3;tr.start.copy(cr[hr]),tr.end.copy(cr[pr]),closestPointsSegmentToSegment(tr,nr,rr,er),ur=rr.distanceToSquared(er),ur<dr&&(dr=ur,sr&&sr.copy(rr),ar&&ar.copy(er))}return this.closestPointToPoint(or,rr),ur=or.distanceToSquared(rr),ur<dr&&(dr=ur,sr&&sr.copy(rr),ar&&ar.copy(or)),this.closestPointToPoint(lr,rr),ur=lr.distanceToSquared(rr),ur<dr&&(dr=ur,sr&&sr.copy(rr),ar&&ar.copy(lr)),Math.sqrt(dr)}}();ExtendedTriangle.prototype.intersectsTriangle=function(){const rr=new ExtendedTriangle,er=new Array(3),tr=new Array(3),ir=new SeparatingAxisBounds,nr=new SeparatingAxisBounds,sr=new Vector3$1,ar=new Vector3$1,or=new Vector3$1,lr=new Vector3$1,cr=new Vector3$1,ur=new Line3,dr=new Line3,hr=new Line3,pr=new Vector3$1;function gr(vr,mr,fr){const _r=vr.points;let Ar=0,yr=-1;for(let wr=0;wr<3;wr++){const{start:xr,end:Sr}=ur;xr.copy(_r[wr]),Sr.copy(_r[(wr+1)%3]),ur.delta(ar);const br=isNearZero(mr.distanceToPoint(xr));if(isNearZero(mr.normal.dot(ar))&&br){fr.copy(ur),Ar=2;break}const Cr=mr.intersectLine(ur,pr);if(!Cr&&br&&pr.copy(xr),(Cr||br)&&!isNearZero(pr.distanceTo(Sr))){if(Ar<=1)(Ar===1?fr.start:fr.end).copy(pr),br&&(yr=Ar);else if(Ar>=2){(yr===1?fr.start:fr.end).copy(pr),Ar=2;break}if(Ar++,Ar===2&&yr===-1)break}}return Ar}return function(mr,fr=null,_r=!1){this.needsUpdate&&this.update(),mr.isExtendedTriangle?mr.needsUpdate&&mr.update():(rr.copy(mr),rr.update(),mr=rr);const Ar=this.plane,yr=mr.plane;if(Math.abs(Ar.normal.dot(yr.normal))>1-1e-10){const wr=this.satBounds,xr=this.satAxes;tr[0]=mr.a,tr[1]=mr.b,tr[2]=mr.c;for(let Cr=0;Cr<4;Cr++){const Ir=wr[Cr],Rr=xr[Cr];if(ir.setFromPoints(Rr,tr),Ir.isSeparated(ir))return!1}const Sr=mr.satBounds,br=mr.satAxes;er[0]=this.a,er[1]=this.b,er[2]=this.c;for(let Cr=0;Cr<4;Cr++){const Ir=Sr[Cr],Rr=br[Cr];if(ir.setFromPoints(Rr,er),Ir.isSeparated(ir))return!1}for(let Cr=0;Cr<4;Cr++){const Ir=xr[Cr];for(let Rr=0;Rr<4;Rr++){const Pr=br[Rr];if(sr.crossVectors(Ir,Pr),ir.setFromPoints(sr,er),nr.setFromPoints(sr,tr),ir.isSeparated(nr))return!1}}return fr&&(_r||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),fr.start.set(0,0,0),fr.end.set(0,0,0)),!0}else{const wr=gr(this,yr,dr);if(wr===1&&mr.containsPoint(dr.end))return fr&&(fr.start.copy(dr.end),fr.end.copy(dr.end)),!0;if(wr!==2)return!1;const xr=gr(mr,Ar,hr);if(xr===1&&this.containsPoint(hr.end))return fr&&(fr.start.copy(hr.end),fr.end.copy(hr.end)),!0;if(xr!==2)return!1;if(dr.delta(or),hr.delta(lr),or.dot(lr)<0){let Dr=hr.start;hr.start=hr.end,hr.end=Dr}const Sr=dr.start.dot(or),br=dr.end.dot(or),Cr=hr.start.dot(or),Ir=hr.end.dot(or),Rr=br<Cr,Pr=Sr<Ir;return Sr!==Ir&&Cr!==br&&Rr===Pr?!1:(fr&&(cr.subVectors(dr.start,hr.start),cr.dot(or)>0?fr.start.copy(dr.start):fr.start.copy(hr.start),cr.subVectors(dr.end,hr.end),cr.dot(or)<0?fr.end.copy(dr.end):fr.end.copy(hr.end)),!0)}}}();ExtendedTriangle.prototype.distanceToPoint=function(){const rr=new Vector3$1;return function(tr){return this.closestPointToPoint(tr,rr),tr.distanceTo(rr)}}();ExtendedTriangle.prototype.distanceToTriangle=function(){const rr=new Vector3$1,er=new Vector3$1,tr=["a","b","c"],ir=new Line3,nr=new Line3;return function(ar,or=null,lr=null){const cr=or||lr?ir:null;if(this.intersectsTriangle(ar,cr))return(or||lr)&&(or&&cr.getCenter(or),lr&&cr.getCenter(lr)),0;let ur=1/0;for(let dr=0;dr<3;dr++){let hr;const pr=tr[dr],gr=ar[pr];this.closestPointToPoint(gr,rr),hr=gr.distanceToSquared(rr),hr<ur&&(ur=hr,or&&or.copy(rr),lr&&lr.copy(gr));const vr=this[pr];ar.closestPointToPoint(vr,rr),hr=vr.distanceToSquared(rr),hr<ur&&(ur=hr,or&&or.copy(vr),lr&&lr.copy(rr))}for(let dr=0;dr<3;dr++){const hr=tr[dr],pr=tr[(dr+1)%3];ir.set(this[hr],this[pr]);for(let gr=0;gr<3;gr++){const vr=tr[gr],mr=tr[(gr+1)%3];nr.set(ar[vr],ar[mr]),closestPointsSegmentToSegment(ir,nr,rr,er);const fr=rr.distanceToSquared(er);fr<ur&&(ur=fr,or&&or.copy(rr),lr&&lr.copy(er))}}return Math.sqrt(ur)}}();class OrientedBox{constructor(er,tr,ir){this.isOrientedBox=!0,this.min=new Vector3$1,this.max=new Vector3$1,this.matrix=new Matrix4,this.invMatrix=new Matrix4,this.points=new Array(8).fill().map(()=>new Vector3$1),this.satAxes=new Array(3).fill().map(()=>new Vector3$1),this.satBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.alignedSatBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.needsUpdate=!1,er&&this.min.copy(er),tr&&this.max.copy(tr),ir&&this.matrix.copy(ir)}set(er,tr,ir){this.min.copy(er),this.max.copy(tr),this.matrix.copy(ir),this.needsUpdate=!0}copy(er){this.min.copy(er.min),this.max.copy(er.max),this.matrix.copy(er.matrix),this.needsUpdate=!0}}OrientedBox.prototype.update=function(){return function(){const er=this.matrix,tr=this.min,ir=this.max,nr=this.points;for(let cr=0;cr<=1;cr++)for(let ur=0;ur<=1;ur++)for(let dr=0;dr<=1;dr++){const hr=1*cr|2*ur|4*dr,pr=nr[hr];pr.x=cr?ir.x:tr.x,pr.y=ur?ir.y:tr.y,pr.z=dr?ir.z:tr.z,pr.applyMatrix4(er)}const sr=this.satBounds,ar=this.satAxes,or=nr[0];for(let cr=0;cr<3;cr++){const ur=ar[cr],dr=sr[cr],hr=1<<cr,pr=nr[hr];ur.subVectors(or,pr),dr.setFromPoints(ur,nr)}const lr=this.alignedSatBounds;lr[0].setFromPointsField(nr,"x"),lr[1].setFromPointsField(nr,"y"),lr[2].setFromPointsField(nr,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();OrientedBox.prototype.intersectsBox=function(){const rr=new SeparatingAxisBounds;return function(tr){this.needsUpdate&&this.update();const ir=tr.min,nr=tr.max,sr=this.satBounds,ar=this.satAxes,or=this.alignedSatBounds;if(rr.min=ir.x,rr.max=nr.x,or[0].isSeparated(rr)||(rr.min=ir.y,rr.max=nr.y,or[1].isSeparated(rr))||(rr.min=ir.z,rr.max=nr.z,or[2].isSeparated(rr)))return!1;for(let lr=0;lr<3;lr++){const cr=ar[lr],ur=sr[lr];if(rr.setFromBox(cr,tr),ur.isSeparated(rr))return!1}return!0}}();OrientedBox.prototype.intersectsTriangle=function(){const rr=new ExtendedTriangle,er=new Array(3),tr=new SeparatingAxisBounds,ir=new SeparatingAxisBounds,nr=new Vector3$1;return function(ar){this.needsUpdate&&this.update(),ar.isExtendedTriangle?ar.needsUpdate&&ar.update():(rr.copy(ar),rr.update(),ar=rr);const or=this.satBounds,lr=this.satAxes;er[0]=ar.a,er[1]=ar.b,er[2]=ar.c;for(let hr=0;hr<3;hr++){const pr=or[hr],gr=lr[hr];if(tr.setFromPoints(gr,er),pr.isSeparated(tr))return!1}const cr=ar.satBounds,ur=ar.satAxes,dr=this.points;for(let hr=0;hr<3;hr++){const pr=cr[hr],gr=ur[hr];if(tr.setFromPoints(gr,dr),pr.isSeparated(tr))return!1}for(let hr=0;hr<3;hr++){const pr=lr[hr];for(let gr=0;gr<4;gr++){const vr=ur[gr];if(nr.crossVectors(pr,vr),tr.setFromPoints(nr,er),ir.setFromPoints(nr,dr),tr.isSeparated(ir))return!1}}return!0}}();OrientedBox.prototype.closestPointToPoint=function(){return function(er,tr){return this.needsUpdate&&this.update(),tr.copy(er).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),tr}}();OrientedBox.prototype.distanceToPoint=function(){const rr=new Vector3$1;return function(tr){return this.closestPointToPoint(tr,rr),tr.distanceTo(rr)}}();OrientedBox.prototype.distanceToBox=function(){const rr=["x","y","z"],er=new Array(12).fill().map(()=>new Line3),tr=new Array(12).fill().map(()=>new Line3),ir=new Vector3$1,nr=new Vector3$1;return function(ar,or=0,lr=null,cr=null){if(this.needsUpdate&&this.update(),this.intersectsBox(ar))return(lr||cr)&&(ar.getCenter(nr),this.closestPointToPoint(nr,ir),ar.closestPointToPoint(ir,nr),lr&&lr.copy(ir),cr&&cr.copy(nr)),0;const ur=or*or,dr=ar.min,hr=ar.max,pr=this.points;let gr=1/0;for(let mr=0;mr<8;mr++){const fr=pr[mr];nr.copy(fr).clamp(dr,hr);const _r=fr.distanceToSquared(nr);if(_r<gr&&(gr=_r,lr&&lr.copy(fr),cr&&cr.copy(nr),_r<ur))return Math.sqrt(_r)}let vr=0;for(let mr=0;mr<3;mr++)for(let fr=0;fr<=1;fr++)for(let _r=0;_r<=1;_r++){const Ar=(mr+1)%3,yr=(mr+2)%3,wr=fr<<Ar|_r<<yr,xr=1<<mr|fr<<Ar|_r<<yr,Sr=pr[wr],br=pr[xr];er[vr].set(Sr,br);const Ir=rr[mr],Rr=rr[Ar],Pr=rr[yr],Dr=tr[vr],Fr=Dr.start,Or=Dr.end;Fr[Ir]=dr[Ir],Fr[Rr]=fr?dr[Rr]:hr[Rr],Fr[Pr]=_r?dr[Pr]:hr[Rr],Or[Ir]=hr[Ir],Or[Rr]=fr?dr[Rr]:hr[Rr],Or[Pr]=_r?dr[Pr]:hr[Rr],vr++}for(let mr=0;mr<=1;mr++)for(let fr=0;fr<=1;fr++)for(let _r=0;_r<=1;_r++){nr.x=mr?hr.x:dr.x,nr.y=fr?hr.y:dr.y,nr.z=_r?hr.z:dr.z,this.closestPointToPoint(nr,ir);const Ar=nr.distanceToSquared(ir);if(Ar<gr&&(gr=Ar,lr&&lr.copy(ir),cr&&cr.copy(nr),Ar<ur))return Math.sqrt(Ar)}for(let mr=0;mr<12;mr++){const fr=er[mr];for(let _r=0;_r<12;_r++){const Ar=tr[_r];closestPointsSegmentToSegment(fr,Ar,ir,nr);const yr=ir.distanceToSquared(nr);if(yr<gr&&(gr=yr,lr&&lr.copy(ir),cr&&cr.copy(nr),yr<ur))return Math.sqrt(yr)}}return Math.sqrt(gr)}}();class PrimitivePool{constructor(er){this._getNewPrimitive=er,this._primitives=[]}getPrimitive(){const er=this._primitives;return er.length===0?this._getNewPrimitive():er.pop()}releasePrimitive(er){this._primitives.push(er)}}class ExtendedTrianglePoolBase extends PrimitivePool{constructor(){super(()=>new ExtendedTriangle)}}const ExtendedTrianglePool=new ExtendedTrianglePoolBase;class _BufferStack{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const er=[];let tr=null;this.setBuffer=ir=>{tr&&er.push(tr),tr=ir,this.float32Array=new Float32Array(ir),this.uint16Array=new Uint16Array(ir),this.uint32Array=new Uint32Array(ir)},this.clearBuffer=()=>{tr=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,er.length!==0&&this.setBuffer(er.pop())}}}const BufferStack=new _BufferStack;let _box1$1,_box2$1;const boxStack=[],boxPool=new PrimitivePool(()=>new Box3);function shapecast(rr,er,tr,ir,nr,sr){_box1$1=boxPool.getPrimitive(),_box2$1=boxPool.getPrimitive(),boxStack.push(_box1$1,_box2$1),BufferStack.setBuffer(rr._roots[er]);const ar=shapecastTraverse(0,rr.geometry,tr,ir,nr,sr);BufferStack.clearBuffer(),boxPool.releasePrimitive(_box1$1),boxPool.releasePrimitive(_box2$1),boxStack.pop(),boxStack.pop();const or=boxStack.length;return or>0&&(_box2$1=boxStack[or-1],_box1$1=boxStack[or-2]),ar}function shapecastTraverse(rr,er,tr,ir,nr=null,sr=0,ar=0){const{float32Array:or,uint16Array:lr,uint32Array:cr}=BufferStack;let ur=rr*2;if(IS_LEAF(ur,lr)){const hr=OFFSET(rr,cr),pr=COUNT(ur,lr);return arrayToBox(rr,or,_box1$1),ir(hr,pr,!1,ar,sr+rr,_box1$1)}else{let Ir=function(Pr){const{uint16Array:Dr,uint32Array:Fr}=BufferStack;let Or=Pr*2;for(;!IS_LEAF(Or,Dr);)Pr=LEFT_NODE(Pr),Or=Pr*2;return OFFSET(Pr,Fr)},Rr=function(Pr){const{uint16Array:Dr,uint32Array:Fr}=BufferStack;let Or=Pr*2;for(;!IS_LEAF(Or,Dr);)Pr=RIGHT_NODE(Pr,Fr),Or=Pr*2;return OFFSET(Pr,Fr)+COUNT(Or,Dr)};const hr=LEFT_NODE(rr),pr=RIGHT_NODE(rr,cr);let gr=hr,vr=pr,mr,fr,_r,Ar;if(nr&&(_r=_box1$1,Ar=_box2$1,arrayToBox(gr,or,_r),arrayToBox(vr,or,Ar),mr=nr(_r),fr=nr(Ar),fr<mr)){gr=pr,vr=hr;const Pr=mr;mr=fr,fr=Pr,_r=Ar}_r||(_r=_box1$1,arrayToBox(gr,or,_r));const yr=IS_LEAF(gr*2,lr),wr=tr(_r,yr,mr,ar+1,sr+gr);let xr;if(wr===CONTAINED){const Pr=Ir(gr),Fr=Rr(gr)-Pr;xr=ir(Pr,Fr,!0,ar+1,sr+gr,_r)}else xr=wr&&shapecastTraverse(gr,er,tr,ir,nr,sr,ar+1);if(xr)return!0;Ar=_box2$1,arrayToBox(vr,or,Ar);const Sr=IS_LEAF(vr*2,lr),br=tr(Ar,Sr,fr,ar+1,sr+vr);let Cr;if(br===CONTAINED){const Pr=Ir(vr),Fr=Rr(vr)-Pr;Cr=ir(Pr,Fr,!0,ar+1,sr+vr,Ar)}else Cr=br&&shapecastTraverse(vr,er,tr,ir,nr,sr,ar+1);return!!Cr}}const temp=new Vector3$1,temp1$2=new Vector3$1;function closestPointToPoint(rr,er,tr={},ir=0,nr=1/0){const sr=ir*ir,ar=nr*nr;let or=1/0,lr=null;if(rr.shapecast({boundsTraverseOrder:ur=>(temp.copy(er).clamp(ur.min,ur.max),temp.distanceToSquared(er)),intersectsBounds:(ur,dr,hr)=>hr<or&&hr<ar,intersectsTriangle:(ur,dr)=>{ur.closestPointToPoint(er,temp);const hr=er.distanceToSquared(temp);return hr<or&&(temp1$2.copy(temp),or=hr,lr=dr),hr<sr}}),or===1/0)return null;const cr=Math.sqrt(or);return tr.point?tr.point.copy(temp1$2):tr.point=temp1$2.clone(),tr.distance=cr,tr.faceIndex=lr,tr}const IS_GT_REVISION_169=parseInt(REVISION)>=169,_vA=new Vector3$1,_vB=new Vector3$1,_vC=new Vector3$1,_uvA=new Vector2,_uvB=new Vector2,_uvC=new Vector2,_normalA=new Vector3$1,_normalB=new Vector3$1,_normalC=new Vector3$1,_intersectionPoint=new Vector3$1;function checkIntersection(rr,er,tr,ir,nr,sr,ar,or){let lr;if(sr===BackSide?lr=rr.intersectTriangle(ir,tr,er,!0,nr):lr=rr.intersectTriangle(er,tr,ir,sr!==DoubleSide,nr),lr===null)return null;const cr=rr.origin.distanceTo(nr);return cr<ar||cr>or?null:{distance:cr,point:nr.clone()}}function checkBufferGeometryIntersection(rr,er,tr,ir,nr,sr,ar,or,lr,cr,ur){_vA.fromBufferAttribute(er,sr),_vB.fromBufferAttribute(er,ar),_vC.fromBufferAttribute(er,or);const dr=checkIntersection(rr,_vA,_vB,_vC,_intersectionPoint,lr,cr,ur);if(dr){const hr=new Vector3$1;Triangle$2.getBarycoord(_intersectionPoint,_vA,_vB,_vC,hr),ir&&(_uvA.fromBufferAttribute(ir,sr),_uvB.fromBufferAttribute(ir,ar),_uvC.fromBufferAttribute(ir,or),dr.uv=Triangle$2.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),nr&&(_uvA.fromBufferAttribute(nr,sr),_uvB.fromBufferAttribute(nr,ar),_uvC.fromBufferAttribute(nr,or),dr.uv1=Triangle$2.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2)),tr&&(_normalA.fromBufferAttribute(tr,sr),_normalB.fromBufferAttribute(tr,ar),_normalC.fromBufferAttribute(tr,or),dr.normal=Triangle$2.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_normalA,_normalB,_normalC,new Vector3$1),dr.normal.dot(rr.direction)>0&&dr.normal.multiplyScalar(-1));const pr={a:sr,b:ar,c:or,normal:new Vector3$1,materialIndex:0};Triangle$2.getNormal(_vA,_vB,_vC,pr.normal),dr.face=pr,dr.faceIndex=sr,IS_GT_REVISION_169&&(dr.barycoord=hr)}return dr}function intersectTri(rr,er,tr,ir,nr,sr,ar){const or=ir*3;let lr=or+0,cr=or+1,ur=or+2;const dr=rr.index;rr.index&&(lr=dr.getX(lr),cr=dr.getX(cr),ur=dr.getX(ur));const{position:hr,normal:pr,uv:gr,uv1:vr}=rr.attributes,mr=checkBufferGeometryIntersection(tr,hr,pr,gr,vr,lr,cr,ur,er,sr,ar);return mr?(mr.faceIndex=ir,nr&&nr.push(mr),mr):null}function setTriangle(rr,er,tr,ir){const nr=rr.a,sr=rr.b,ar=rr.c;let or=er,lr=er+1,cr=er+2;tr&&(or=tr.getX(or),lr=tr.getX(lr),cr=tr.getX(cr)),nr.x=ir.getX(or),nr.y=ir.getY(or),nr.z=ir.getZ(or),sr.x=ir.getX(lr),sr.y=ir.getY(lr),sr.z=ir.getZ(lr),ar.x=ir.getX(cr),ar.y=ir.getY(cr),ar.z=ir.getZ(cr)}const tempV1=new Vector3$1,tempV2=new Vector3$1,tempV3=new Vector3$1,tempUV1=new Vector2,tempUV2=new Vector2,tempUV3=new Vector2;function getTriangleHitPointInfo(rr,er,tr,ir){const nr=er.getIndex().array,sr=er.getAttribute("position"),ar=er.getAttribute("uv"),or=nr[tr*3],lr=nr[tr*3+1],cr=nr[tr*3+2];tempV1.fromBufferAttribute(sr,or),tempV2.fromBufferAttribute(sr,lr),tempV3.fromBufferAttribute(sr,cr);let ur=0;const dr=er.groups,hr=tr*3;for(let vr=0,mr=dr.length;vr<mr;vr++){const fr=dr[vr],{start:_r,count:Ar}=fr;if(hr>=_r&&hr<_r+Ar){ur=fr.materialIndex;break}}const pr=ir&&ir.barycoord?ir.barycoord:new Vector3$1;Triangle$2.getBarycoord(rr,tempV1,tempV2,tempV3,pr);let gr=null;return ar&&(tempUV1.fromBufferAttribute(ar,or),tempUV2.fromBufferAttribute(ar,lr),tempUV3.fromBufferAttribute(ar,cr),ir&&ir.uv?gr=ir.uv:gr=new Vector2,Triangle$2.getInterpolation(rr,tempV1,tempV2,tempV3,tempUV1,tempUV2,tempUV3,gr)),ir?(ir.face||(ir.face={}),ir.face.a=or,ir.face.b=lr,ir.face.c=cr,ir.face.materialIndex=ur,ir.face.normal||(ir.face.normal=new Vector3$1),Triangle$2.getNormal(tempV1,tempV2,tempV3,ir.face.normal),gr&&(ir.uv=gr),ir.barycoord=pr,ir):{face:{a:or,b:lr,c:cr,materialIndex:ur,normal:Triangle$2.getNormal(tempV1,tempV2,tempV3,new Vector3$1)},uv:gr,barycoord:pr}}function intersectTris(rr,er,tr,ir,nr,sr,ar,or){const{geometry:lr,_indirectBuffer:cr}=rr;for(let ur=ir,dr=ir+nr;ur<dr;ur++)intersectTri(lr,er,tr,ur,sr,ar,or)}function intersectClosestTri(rr,er,tr,ir,nr,sr,ar){const{geometry:or,_indirectBuffer:lr}=rr;let cr=1/0,ur=null;for(let dr=ir,hr=ir+nr;dr<hr;dr++){let pr;pr=intersectTri(or,er,tr,dr,null,sr,ar),pr&&pr.distance<cr&&(ur=pr,cr=pr.distance)}return ur}function iterateOverTriangles(rr,er,tr,ir,nr,sr,ar){const{geometry:or}=tr,{index:lr}=or,cr=or.attributes.position;for(let ur=rr,dr=er+rr;ur<dr;ur++){let hr;if(hr=ur,setTriangle(ar,hr*3,lr,cr),ar.needsUpdate=!0,ir(ar,hr,nr,sr))return!0}return!1}function refit(rr,er=null){er&&Array.isArray(er)&&(er=new Set(er));const tr=rr.geometry,ir=tr.index?tr.index.array:null,nr=tr.attributes.position;let sr,ar,or,lr,cr=0;const ur=rr._roots;for(let hr=0,pr=ur.length;hr<pr;hr++)sr=ur[hr],ar=new Uint32Array(sr),or=new Uint16Array(sr),lr=new Float32Array(sr),dr(0,cr),cr+=sr.byteLength;function dr(hr,pr,gr=!1){const vr=hr*2;if(or[vr+15]===IS_LEAFNODE_FLAG){const fr=ar[hr+6],_r=or[vr+14];let Ar=1/0,yr=1/0,wr=1/0,xr=-1/0,Sr=-1/0,br=-1/0;for(let Cr=3*fr,Ir=3*(fr+_r);Cr<Ir;Cr++){let Rr=ir[Cr];const Pr=nr.getX(Rr),Dr=nr.getY(Rr),Fr=nr.getZ(Rr);Pr<Ar&&(Ar=Pr),Pr>xr&&(xr=Pr),Dr<yr&&(yr=Dr),Dr>Sr&&(Sr=Dr),Fr<wr&&(wr=Fr),Fr>br&&(br=Fr)}return lr[hr+0]!==Ar||lr[hr+1]!==yr||lr[hr+2]!==wr||lr[hr+3]!==xr||lr[hr+4]!==Sr||lr[hr+5]!==br?(lr[hr+0]=Ar,lr[hr+1]=yr,lr[hr+2]=wr,lr[hr+3]=xr,lr[hr+4]=Sr,lr[hr+5]=br,!0):!1}else{const fr=hr+8,_r=ar[hr+6],Ar=fr+pr,yr=_r+pr;let wr=gr,xr=!1,Sr=!1;er?wr||(xr=er.has(Ar),Sr=er.has(yr),wr=!xr&&!Sr):(xr=!0,Sr=!0);const br=wr||xr,Cr=wr||Sr;let Ir=!1;br&&(Ir=dr(fr,pr,wr));let Rr=!1;Cr&&(Rr=dr(_r,pr,wr));const Pr=Ir||Rr;if(Pr)for(let Dr=0;Dr<3;Dr++){const Fr=fr+Dr,Or=_r+Dr,Nr=lr[Fr],Ur=lr[Fr+3],Br=lr[Or],Wr=lr[Or+3];lr[hr+Dr]=Nr<Br?Nr:Br,lr[hr+Dr+3]=Ur>Wr?Ur:Wr}return Pr}}}function intersectRay(rr,er,tr,ir,nr){let sr,ar,or,lr,cr,ur;const dr=1/tr.direction.x,hr=1/tr.direction.y,pr=1/tr.direction.z,gr=tr.origin.x,vr=tr.origin.y,mr=tr.origin.z;let fr=er[rr],_r=er[rr+3],Ar=er[rr+1],yr=er[rr+3+1],wr=er[rr+2],xr=er[rr+3+2];return dr>=0?(sr=(fr-gr)*dr,ar=(_r-gr)*dr):(sr=(_r-gr)*dr,ar=(fr-gr)*dr),hr>=0?(or=(Ar-vr)*hr,lr=(yr-vr)*hr):(or=(yr-vr)*hr,lr=(Ar-vr)*hr),sr>lr||or>ar||((or>sr||isNaN(sr))&&(sr=or),(lr<ar||isNaN(ar))&&(ar=lr),pr>=0?(cr=(wr-mr)*pr,ur=(xr-mr)*pr):(cr=(xr-mr)*pr,ur=(wr-mr)*pr),sr>ur||cr>ar)?!1:((cr>sr||sr!==sr)&&(sr=cr),(ur<ar||ar!==ar)&&(ar=ur),sr<=nr&&ar>=ir)}function intersectTris_indirect(rr,er,tr,ir,nr,sr,ar,or){const{geometry:lr,_indirectBuffer:cr}=rr;for(let ur=ir,dr=ir+nr;ur<dr;ur++){let hr=cr?cr[ur]:ur;intersectTri(lr,er,tr,hr,sr,ar,or)}}function intersectClosestTri_indirect(rr,er,tr,ir,nr,sr,ar){const{geometry:or,_indirectBuffer:lr}=rr;let cr=1/0,ur=null;for(let dr=ir,hr=ir+nr;dr<hr;dr++){let pr;pr=intersectTri(or,er,tr,lr?lr[dr]:dr,null,sr,ar),pr&&pr.distance<cr&&(ur=pr,cr=pr.distance)}return ur}function iterateOverTriangles_indirect(rr,er,tr,ir,nr,sr,ar){const{geometry:or}=tr,{index:lr}=or,cr=or.attributes.position;for(let ur=rr,dr=er+rr;ur<dr;ur++){let hr;if(hr=tr.resolveTriangleIndex(ur),setTriangle(ar,hr*3,lr,cr),ar.needsUpdate=!0,ir(ar,hr,nr,sr))return!0}return!1}function raycast(rr,er,tr,ir,nr,sr,ar){BufferStack.setBuffer(rr._roots[er]),_raycast$1(0,rr,tr,ir,nr,sr,ar),BufferStack.clearBuffer()}function _raycast$1(rr,er,tr,ir,nr,sr,ar){const{float32Array:or,uint16Array:lr,uint32Array:cr}=BufferStack,ur=rr*2;if(IS_LEAF(ur,lr)){const hr=OFFSET(rr,cr),pr=COUNT(ur,lr);intersectTris(er,tr,ir,hr,pr,nr,sr,ar)}else{const hr=LEFT_NODE(rr);intersectRay(hr,or,ir,sr,ar)&&_raycast$1(hr,er,tr,ir,nr,sr,ar);const pr=RIGHT_NODE(rr,cr);intersectRay(pr,or,ir,sr,ar)&&_raycast$1(pr,er,tr,ir,nr,sr,ar)}}const _xyzFields$1=["x","y","z"];function raycastFirst(rr,er,tr,ir,nr,sr){BufferStack.setBuffer(rr._roots[er]);const ar=_raycastFirst$1(0,rr,tr,ir,nr,sr);return BufferStack.clearBuffer(),ar}function _raycastFirst$1(rr,er,tr,ir,nr,sr){const{float32Array:ar,uint16Array:or,uint32Array:lr}=BufferStack;let cr=rr*2;if(IS_LEAF(cr,or)){const dr=OFFSET(rr,lr),hr=COUNT(cr,or);return intersectClosestTri(er,tr,ir,dr,hr,nr,sr)}else{const dr=SPLIT_AXIS(rr,lr),hr=_xyzFields$1[dr],gr=ir.direction[hr]>=0;let vr,mr;gr?(vr=LEFT_NODE(rr),mr=RIGHT_NODE(rr,lr)):(vr=RIGHT_NODE(rr,lr),mr=LEFT_NODE(rr));const _r=intersectRay(vr,ar,ir,nr,sr)?_raycastFirst$1(vr,er,tr,ir,nr,sr):null;if(_r){const wr=_r.point[hr];if(gr?wr<=ar[mr+dr]:wr>=ar[mr+dr+3])return _r}const yr=intersectRay(mr,ar,ir,nr,sr)?_raycastFirst$1(mr,er,tr,ir,nr,sr):null;return _r&&yr?_r.distance<=yr.distance?_r:yr:_r||yr||null}}const boundingBox$2=new Box3,triangle$1=new ExtendedTriangle,triangle2$1=new ExtendedTriangle,invertedMat$1=new Matrix4,obb$4=new OrientedBox,obb2$3=new OrientedBox;function intersectsGeometry(rr,er,tr,ir){BufferStack.setBuffer(rr._roots[er]);const nr=_intersectsGeometry$1(0,rr,tr,ir);return BufferStack.clearBuffer(),nr}function _intersectsGeometry$1(rr,er,tr,ir,nr=null){const{float32Array:sr,uint16Array:ar,uint32Array:or}=BufferStack;let lr=rr*2;if(nr===null&&(tr.boundingBox||tr.computeBoundingBox(),obb$4.set(tr.boundingBox.min,tr.boundingBox.max,ir),nr=obb$4),IS_LEAF(lr,ar)){const ur=er.geometry,dr=ur.index,hr=ur.attributes.position,pr=tr.index,gr=tr.attributes.position,vr=OFFSET(rr,or),mr=COUNT(lr,ar);if(invertedMat$1.copy(ir).invert(),tr.boundsTree)return arrayToBox(rr,sr,obb2$3),obb2$3.matrix.copy(invertedMat$1),obb2$3.needsUpdate=!0,tr.boundsTree.shapecast({intersectsBounds:_r=>obb2$3.intersectsBox(_r),intersectsTriangle:_r=>{_r.a.applyMatrix4(ir),_r.b.applyMatrix4(ir),_r.c.applyMatrix4(ir),_r.needsUpdate=!0;for(let Ar=vr*3,yr=(mr+vr)*3;Ar<yr;Ar+=3)if(setTriangle(triangle2$1,Ar,dr,hr),triangle2$1.needsUpdate=!0,_r.intersectsTriangle(triangle2$1))return!0;return!1}});for(let fr=vr*3,_r=(mr+vr)*3;fr<_r;fr+=3){setTriangle(triangle$1,fr,dr,hr),triangle$1.a.applyMatrix4(invertedMat$1),triangle$1.b.applyMatrix4(invertedMat$1),triangle$1.c.applyMatrix4(invertedMat$1),triangle$1.needsUpdate=!0;for(let Ar=0,yr=pr.count;Ar<yr;Ar+=3)if(setTriangle(triangle2$1,Ar,pr,gr),triangle2$1.needsUpdate=!0,triangle$1.intersectsTriangle(triangle2$1))return!0}}else{const ur=rr+8,dr=or[rr+6];return arrayToBox(ur,sr,boundingBox$2),!!(nr.intersectsBox(boundingBox$2)&&_intersectsGeometry$1(ur,er,tr,ir,nr)||(arrayToBox(dr,sr,boundingBox$2),nr.intersectsBox(boundingBox$2)&&_intersectsGeometry$1(dr,er,tr,ir,nr)))}}const tempMatrix$1=new Matrix4,obb$3=new OrientedBox,obb2$2=new OrientedBox,temp1$1=new Vector3$1,temp2$1=new Vector3$1,temp3$1=new Vector3$1,temp4$1=new Vector3$1;function closestPointToGeometry(rr,er,tr,ir={},nr={},sr=0,ar=1/0){er.boundingBox||er.computeBoundingBox(),obb$3.set(er.boundingBox.min,er.boundingBox.max,tr),obb$3.needsUpdate=!0;const or=rr.geometry,lr=or.attributes.position,cr=or.index,ur=er.attributes.position,dr=er.index,hr=ExtendedTrianglePool.getPrimitive(),pr=ExtendedTrianglePool.getPrimitive();let gr=temp1$1,vr=temp2$1,mr=null,fr=null;nr&&(mr=temp3$1,fr=temp4$1);let _r=1/0,Ar=null,yr=null;return tempMatrix$1.copy(tr).invert(),obb2$2.matrix.copy(tempMatrix$1),rr.shapecast({boundsTraverseOrder:wr=>obb$3.distanceToBox(wr),intersectsBounds:(wr,xr,Sr)=>Sr<_r&&Sr<ar?(xr&&(obb2$2.min.copy(wr.min),obb2$2.max.copy(wr.max),obb2$2.needsUpdate=!0),!0):!1,intersectsRange:(wr,xr)=>{if(er.boundsTree)return er.boundsTree.shapecast({boundsTraverseOrder:br=>obb2$2.distanceToBox(br),intersectsBounds:(br,Cr,Ir)=>Ir<_r&&Ir<ar,intersectsRange:(br,Cr)=>{for(let Ir=br,Rr=br+Cr;Ir<Rr;Ir++){setTriangle(pr,3*Ir,dr,ur),pr.a.applyMatrix4(tr),pr.b.applyMatrix4(tr),pr.c.applyMatrix4(tr),pr.needsUpdate=!0;for(let Pr=wr,Dr=wr+xr;Pr<Dr;Pr++){setTriangle(hr,3*Pr,cr,lr),hr.needsUpdate=!0;const Fr=hr.distanceToTriangle(pr,gr,mr);if(Fr<_r&&(vr.copy(gr),fr&&fr.copy(mr),_r=Fr,Ar=Pr,yr=Ir),Fr<sr)return!0}}}});{const Sr=getTriCount(er);for(let br=0,Cr=Sr;br<Cr;br++){setTriangle(pr,3*br,dr,ur),pr.a.applyMatrix4(tr),pr.b.applyMatrix4(tr),pr.c.applyMatrix4(tr),pr.needsUpdate=!0;for(let Ir=wr,Rr=wr+xr;Ir<Rr;Ir++){setTriangle(hr,3*Ir,cr,lr),hr.needsUpdate=!0;const Pr=hr.distanceToTriangle(pr,gr,mr);if(Pr<_r&&(vr.copy(gr),fr&&fr.copy(mr),_r=Pr,Ar=Ir,yr=br),Pr<sr)return!0}}}}}),ExtendedTrianglePool.releasePrimitive(hr),ExtendedTrianglePool.releasePrimitive(pr),_r===1/0?null:(ir.point?ir.point.copy(vr):ir.point=vr.clone(),ir.distance=_r,ir.faceIndex=Ar,nr&&(nr.point?nr.point.copy(fr):nr.point=fr.clone(),nr.point.applyMatrix4(tempMatrix$1),vr.applyMatrix4(tempMatrix$1),nr.distance=vr.sub(nr.point).length(),nr.faceIndex=yr),ir)}function refit_indirect(rr,er=null){er&&Array.isArray(er)&&(er=new Set(er));const tr=rr.geometry,ir=tr.index?tr.index.array:null,nr=tr.attributes.position;let sr,ar,or,lr,cr=0;const ur=rr._roots;for(let hr=0,pr=ur.length;hr<pr;hr++)sr=ur[hr],ar=new Uint32Array(sr),or=new Uint16Array(sr),lr=new Float32Array(sr),dr(0,cr),cr+=sr.byteLength;function dr(hr,pr,gr=!1){const vr=hr*2;if(or[vr+15]===IS_LEAFNODE_FLAG){const fr=ar[hr+6],_r=or[vr+14];let Ar=1/0,yr=1/0,wr=1/0,xr=-1/0,Sr=-1/0,br=-1/0;for(let Cr=fr,Ir=fr+_r;Cr<Ir;Cr++){const Rr=3*rr.resolveTriangleIndex(Cr);for(let Pr=0;Pr<3;Pr++){let Dr=Rr+Pr;Dr=ir?ir[Dr]:Dr;const Fr=nr.getX(Dr),Or=nr.getY(Dr),Nr=nr.getZ(Dr);Fr<Ar&&(Ar=Fr),Fr>xr&&(xr=Fr),Or<yr&&(yr=Or),Or>Sr&&(Sr=Or),Nr<wr&&(wr=Nr),Nr>br&&(br=Nr)}}return lr[hr+0]!==Ar||lr[hr+1]!==yr||lr[hr+2]!==wr||lr[hr+3]!==xr||lr[hr+4]!==Sr||lr[hr+5]!==br?(lr[hr+0]=Ar,lr[hr+1]=yr,lr[hr+2]=wr,lr[hr+3]=xr,lr[hr+4]=Sr,lr[hr+5]=br,!0):!1}else{const fr=hr+8,_r=ar[hr+6],Ar=fr+pr,yr=_r+pr;let wr=gr,xr=!1,Sr=!1;er?wr||(xr=er.has(Ar),Sr=er.has(yr),wr=!xr&&!Sr):(xr=!0,Sr=!0);const br=wr||xr,Cr=wr||Sr;let Ir=!1;br&&(Ir=dr(fr,pr,wr));let Rr=!1;Cr&&(Rr=dr(_r,pr,wr));const Pr=Ir||Rr;if(Pr)for(let Dr=0;Dr<3;Dr++){const Fr=fr+Dr,Or=_r+Dr,Nr=lr[Fr],Ur=lr[Fr+3],Br=lr[Or],Wr=lr[Or+3];lr[hr+Dr]=Nr<Br?Nr:Br,lr[hr+Dr+3]=Ur>Wr?Ur:Wr}return Pr}}}function raycast_indirect(rr,er,tr,ir,nr,sr,ar){BufferStack.setBuffer(rr._roots[er]),_raycast(0,rr,tr,ir,nr,sr,ar),BufferStack.clearBuffer()}function _raycast(rr,er,tr,ir,nr,sr,ar){const{float32Array:or,uint16Array:lr,uint32Array:cr}=BufferStack,ur=rr*2;if(IS_LEAF(ur,lr)){const hr=OFFSET(rr,cr),pr=COUNT(ur,lr);intersectTris_indirect(er,tr,ir,hr,pr,nr,sr,ar)}else{const hr=LEFT_NODE(rr);intersectRay(hr,or,ir,sr,ar)&&_raycast(hr,er,tr,ir,nr,sr,ar);const pr=RIGHT_NODE(rr,cr);intersectRay(pr,or,ir,sr,ar)&&_raycast(pr,er,tr,ir,nr,sr,ar)}}const _xyzFields=["x","y","z"];function raycastFirst_indirect(rr,er,tr,ir,nr,sr){BufferStack.setBuffer(rr._roots[er]);const ar=_raycastFirst(0,rr,tr,ir,nr,sr);return BufferStack.clearBuffer(),ar}function _raycastFirst(rr,er,tr,ir,nr,sr){const{float32Array:ar,uint16Array:or,uint32Array:lr}=BufferStack;let cr=rr*2;if(IS_LEAF(cr,or)){const dr=OFFSET(rr,lr),hr=COUNT(cr,or);return intersectClosestTri_indirect(er,tr,ir,dr,hr,nr,sr)}else{const dr=SPLIT_AXIS(rr,lr),hr=_xyzFields[dr],gr=ir.direction[hr]>=0;let vr,mr;gr?(vr=LEFT_NODE(rr),mr=RIGHT_NODE(rr,lr)):(vr=RIGHT_NODE(rr,lr),mr=LEFT_NODE(rr));const _r=intersectRay(vr,ar,ir,nr,sr)?_raycastFirst(vr,er,tr,ir,nr,sr):null;if(_r){const wr=_r.point[hr];if(gr?wr<=ar[mr+dr]:wr>=ar[mr+dr+3])return _r}const yr=intersectRay(mr,ar,ir,nr,sr)?_raycastFirst(mr,er,tr,ir,nr,sr):null;return _r&&yr?_r.distance<=yr.distance?_r:yr:_r||yr||null}}const boundingBox$1=new Box3,triangle=new ExtendedTriangle,triangle2=new ExtendedTriangle,invertedMat=new Matrix4,obb$2=new OrientedBox,obb2$1=new OrientedBox;function intersectsGeometry_indirect(rr,er,tr,ir){BufferStack.setBuffer(rr._roots[er]);const nr=_intersectsGeometry(0,rr,tr,ir);return BufferStack.clearBuffer(),nr}function _intersectsGeometry(rr,er,tr,ir,nr=null){const{float32Array:sr,uint16Array:ar,uint32Array:or}=BufferStack;let lr=rr*2;if(nr===null&&(tr.boundingBox||tr.computeBoundingBox(),obb$2.set(tr.boundingBox.min,tr.boundingBox.max,ir),nr=obb$2),IS_LEAF(lr,ar)){const ur=er.geometry,dr=ur.index,hr=ur.attributes.position,pr=tr.index,gr=tr.attributes.position,vr=OFFSET(rr,or),mr=COUNT(lr,ar);if(invertedMat.copy(ir).invert(),tr.boundsTree)return arrayToBox(rr,sr,obb2$1),obb2$1.matrix.copy(invertedMat),obb2$1.needsUpdate=!0,tr.boundsTree.shapecast({intersectsBounds:_r=>obb2$1.intersectsBox(_r),intersectsTriangle:_r=>{_r.a.applyMatrix4(ir),_r.b.applyMatrix4(ir),_r.c.applyMatrix4(ir),_r.needsUpdate=!0;for(let Ar=vr,yr=mr+vr;Ar<yr;Ar++)if(setTriangle(triangle2,3*er.resolveTriangleIndex(Ar),dr,hr),triangle2.needsUpdate=!0,_r.intersectsTriangle(triangle2))return!0;return!1}});for(let fr=vr,_r=mr+vr;fr<_r;fr++){const Ar=er.resolveTriangleIndex(fr);setTriangle(triangle,3*Ar,dr,hr),triangle.a.applyMatrix4(invertedMat),triangle.b.applyMatrix4(invertedMat),triangle.c.applyMatrix4(invertedMat),triangle.needsUpdate=!0;for(let yr=0,wr=pr.count;yr<wr;yr+=3)if(setTriangle(triangle2,yr,pr,gr),triangle2.needsUpdate=!0,triangle.intersectsTriangle(triangle2))return!0}}else{const ur=rr+8,dr=or[rr+6];return arrayToBox(ur,sr,boundingBox$1),!!(nr.intersectsBox(boundingBox$1)&&_intersectsGeometry(ur,er,tr,ir,nr)||(arrayToBox(dr,sr,boundingBox$1),nr.intersectsBox(boundingBox$1)&&_intersectsGeometry(dr,er,tr,ir,nr)))}}const tempMatrix=new Matrix4,obb$1=new OrientedBox,obb2=new OrientedBox,temp1=new Vector3$1,temp2=new Vector3$1,temp3=new Vector3$1,temp4=new Vector3$1;function closestPointToGeometry_indirect(rr,er,tr,ir={},nr={},sr=0,ar=1/0){er.boundingBox||er.computeBoundingBox(),obb$1.set(er.boundingBox.min,er.boundingBox.max,tr),obb$1.needsUpdate=!0;const or=rr.geometry,lr=or.attributes.position,cr=or.index,ur=er.attributes.position,dr=er.index,hr=ExtendedTrianglePool.getPrimitive(),pr=ExtendedTrianglePool.getPrimitive();let gr=temp1,vr=temp2,mr=null,fr=null;nr&&(mr=temp3,fr=temp4);let _r=1/0,Ar=null,yr=null;return tempMatrix.copy(tr).invert(),obb2.matrix.copy(tempMatrix),rr.shapecast({boundsTraverseOrder:wr=>obb$1.distanceToBox(wr),intersectsBounds:(wr,xr,Sr)=>Sr<_r&&Sr<ar?(xr&&(obb2.min.copy(wr.min),obb2.max.copy(wr.max),obb2.needsUpdate=!0),!0):!1,intersectsRange:(wr,xr)=>{if(er.boundsTree){const Sr=er.boundsTree;return Sr.shapecast({boundsTraverseOrder:br=>obb2.distanceToBox(br),intersectsBounds:(br,Cr,Ir)=>Ir<_r&&Ir<ar,intersectsRange:(br,Cr)=>{for(let Ir=br,Rr=br+Cr;Ir<Rr;Ir++){const Pr=Sr.resolveTriangleIndex(Ir);setTriangle(pr,3*Pr,dr,ur),pr.a.applyMatrix4(tr),pr.b.applyMatrix4(tr),pr.c.applyMatrix4(tr),pr.needsUpdate=!0;for(let Dr=wr,Fr=wr+xr;Dr<Fr;Dr++){const Or=rr.resolveTriangleIndex(Dr);setTriangle(hr,3*Or,cr,lr),hr.needsUpdate=!0;const Nr=hr.distanceToTriangle(pr,gr,mr);if(Nr<_r&&(vr.copy(gr),fr&&fr.copy(mr),_r=Nr,Ar=Dr,yr=Ir),Nr<sr)return!0}}}})}else{const Sr=getTriCount(er);for(let br=0,Cr=Sr;br<Cr;br++){setTriangle(pr,3*br,dr,ur),pr.a.applyMatrix4(tr),pr.b.applyMatrix4(tr),pr.c.applyMatrix4(tr),pr.needsUpdate=!0;for(let Ir=wr,Rr=wr+xr;Ir<Rr;Ir++){const Pr=rr.resolveTriangleIndex(Ir);setTriangle(hr,3*Pr,cr,lr),hr.needsUpdate=!0;const Dr=hr.distanceToTriangle(pr,gr,mr);if(Dr<_r&&(vr.copy(gr),fr&&fr.copy(mr),_r=Dr,Ar=Ir,yr=br),Dr<sr)return!0}}}}}),ExtendedTrianglePool.releasePrimitive(hr),ExtendedTrianglePool.releasePrimitive(pr),_r===1/0?null:(ir.point?ir.point.copy(vr):ir.point=vr.clone(),ir.distance=_r,ir.faceIndex=Ar,nr&&(nr.point?nr.point.copy(fr):nr.point=fr.clone(),nr.point.applyMatrix4(tempMatrix),vr.applyMatrix4(tempMatrix),nr.distance=vr.sub(nr.point).length(),nr.faceIndex=yr),ir)}function isSharedArrayBufferSupported(){return typeof SharedArrayBuffer<"u"}function convertToBufferType(rr,er){if(rr===null)return rr;if(rr.buffer){const tr=rr.buffer;if(tr.constructor===er)return rr;const ir=rr.constructor,nr=new ir(new er(tr.byteLength));return nr.set(rr),nr}else{if(rr.constructor===er)return rr;const tr=new er(rr.byteLength);return new Uint8Array(tr).set(new Uint8Array(rr)),tr}}const _bufferStack1=new BufferStack.constructor,_bufferStack2=new BufferStack.constructor,_boxPool=new PrimitivePool(()=>new Box3),_leftBox1=new Box3,_rightBox1=new Box3,_leftBox2=new Box3,_rightBox2=new Box3;let _active=!1;function bvhcast(rr,er,tr,ir){if(_active)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");_active=!0;const nr=rr._roots,sr=er._roots;let ar,or=0,lr=0;const cr=new Matrix4().copy(tr).invert();for(let ur=0,dr=nr.length;ur<dr;ur++){_bufferStack1.setBuffer(nr[ur]),lr=0;const hr=_boxPool.getPrimitive();arrayToBox(0,_bufferStack1.float32Array,hr),hr.applyMatrix4(cr);for(let pr=0,gr=sr.length;pr<gr&&(_bufferStack2.setBuffer(sr[pr]),ar=_traverse(0,0,tr,cr,ir,or,lr,0,0,hr),_bufferStack2.clearBuffer(),lr+=sr[pr].length,!ar);pr++);if(_boxPool.releasePrimitive(hr),_bufferStack1.clearBuffer(),or+=nr[ur].length,ar)break}return _active=!1,ar}function _traverse(rr,er,tr,ir,nr,sr=0,ar=0,or=0,lr=0,cr=null,ur=!1){let dr,hr;ur?(dr=_bufferStack2,hr=_bufferStack1):(dr=_bufferStack1,hr=_bufferStack2);const pr=dr.float32Array,gr=dr.uint32Array,vr=dr.uint16Array,mr=hr.float32Array,fr=hr.uint32Array,_r=hr.uint16Array,Ar=rr*2,yr=er*2,wr=IS_LEAF(Ar,vr),xr=IS_LEAF(yr,_r);let Sr=!1;if(xr&&wr)ur?Sr=nr(OFFSET(er,fr),COUNT(er*2,_r),OFFSET(rr,gr),COUNT(rr*2,vr),lr,ar+er,or,sr+rr):Sr=nr(OFFSET(rr,gr),COUNT(rr*2,vr),OFFSET(er,fr),COUNT(er*2,_r),or,sr+rr,lr,ar+er);else if(xr){const br=_boxPool.getPrimitive();arrayToBox(er,mr,br),br.applyMatrix4(tr);const Cr=LEFT_NODE(rr),Ir=RIGHT_NODE(rr,gr);arrayToBox(Cr,pr,_leftBox1),arrayToBox(Ir,pr,_rightBox1);const Rr=br.intersectsBox(_leftBox1),Pr=br.intersectsBox(_rightBox1);Sr=Rr&&_traverse(er,Cr,ir,tr,nr,ar,sr,lr,or+1,br,!ur)||Pr&&_traverse(er,Ir,ir,tr,nr,ar,sr,lr,or+1,br,!ur),_boxPool.releasePrimitive(br)}else{const br=LEFT_NODE(er),Cr=RIGHT_NODE(er,fr);arrayToBox(br,mr,_leftBox2),arrayToBox(Cr,mr,_rightBox2);const Ir=cr.intersectsBox(_leftBox2),Rr=cr.intersectsBox(_rightBox2);if(Ir&&Rr)Sr=_traverse(rr,br,tr,ir,nr,sr,ar,or,lr+1,cr,ur)||_traverse(rr,Cr,tr,ir,nr,sr,ar,or,lr+1,cr,ur);else if(Ir)if(wr)Sr=_traverse(rr,br,tr,ir,nr,sr,ar,or,lr+1,cr,ur);else{const Pr=_boxPool.getPrimitive();Pr.copy(_leftBox2).applyMatrix4(tr);const Dr=LEFT_NODE(rr),Fr=RIGHT_NODE(rr,gr);arrayToBox(Dr,pr,_leftBox1),arrayToBox(Fr,pr,_rightBox1);const Or=Pr.intersectsBox(_leftBox1),Nr=Pr.intersectsBox(_rightBox1);Sr=Or&&_traverse(br,Dr,ir,tr,nr,ar,sr,lr,or+1,Pr,!ur)||Nr&&_traverse(br,Fr,ir,tr,nr,ar,sr,lr,or+1,Pr,!ur),_boxPool.releasePrimitive(Pr)}else if(Rr)if(wr)Sr=_traverse(rr,Cr,tr,ir,nr,sr,ar,or,lr+1,cr,ur);else{const Pr=_boxPool.getPrimitive();Pr.copy(_rightBox2).applyMatrix4(tr);const Dr=LEFT_NODE(rr),Fr=RIGHT_NODE(rr,gr);arrayToBox(Dr,pr,_leftBox1),arrayToBox(Fr,pr,_rightBox1);const Or=Pr.intersectsBox(_leftBox1),Nr=Pr.intersectsBox(_rightBox1);Sr=Or&&_traverse(Cr,Dr,ir,tr,nr,ar,sr,lr,or+1,Pr,!ur)||Nr&&_traverse(Cr,Fr,ir,tr,nr,ar,sr,lr,or+1,Pr,!ur),_boxPool.releasePrimitive(Pr)}}return Sr}const obb=new OrientedBox,tempBox=new Box3,DEFAULT_OPTIONS={strategy:CENTER,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class MeshBVH{static serialize(er,tr={}){tr={cloneBuffers:!0,...tr};const ir=er.geometry,nr=er._roots,sr=er._indirectBuffer,ar=ir.getIndex();let or;return tr.cloneBuffers?or={roots:nr.map(lr=>lr.slice()),index:ar?ar.array.slice():null,indirectBuffer:sr?sr.slice():null}:or={roots:nr,index:ar?ar.array:null,indirectBuffer:sr},or}static deserialize(er,tr,ir={}){ir={setIndex:!0,indirect:!!er.indirectBuffer,...ir};const{index:nr,roots:sr,indirectBuffer:ar}=er,or=new MeshBVH(tr,{...ir,[SKIP_GENERATION]:!0});if(or._roots=sr,or._indirectBuffer=ar||null,ir.setIndex){const lr=tr.getIndex();if(lr===null){const cr=new BufferAttribute(er.index,1,!1);tr.setIndex(cr)}else lr.array!==nr&&(lr.array.set(nr),lr.needsUpdate=!0)}return or}get indirect(){return!!this._indirectBuffer}constructor(er,tr={}){if(er.isBufferGeometry){if(er.index&&er.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(tr=Object.assign({...DEFAULT_OPTIONS,[SKIP_GENERATION]:!1},tr),tr.useSharedArrayBuffer&&!isSharedArrayBufferSupported())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=er,this._roots=null,this._indirectBuffer=null,tr[SKIP_GENERATION]||(buildPackedTree(this,tr),!er.boundingBox&&tr.setBoundingBox&&(er.boundingBox=this.getBoundingBox(new Box3))),this.resolveTriangleIndex=tr.indirect?ir=>this._indirectBuffer[ir]:ir=>ir}refit(er=null){return(this.indirect?refit_indirect:refit)(this,er)}traverse(er,tr=0){const ir=this._roots[tr],nr=new Uint32Array(ir),sr=new Uint16Array(ir);ar(0);function ar(or,lr=0){const cr=or*2,ur=sr[cr+15]===IS_LEAFNODE_FLAG;if(ur){const dr=nr[or+6],hr=sr[cr+14];er(lr,ur,new Float32Array(ir,or*4,6),dr,hr)}else{const dr=or+BYTES_PER_NODE/4,hr=nr[or+6],pr=nr[or+7];er(lr,ur,new Float32Array(ir,or*4,6),pr)||(ar(dr,lr+1),ar(hr,lr+1))}}}raycast(er,tr=FrontSide,ir=0,nr=1/0){const sr=this._roots,ar=this.geometry,or=[],lr=tr.isMaterial,cr=Array.isArray(tr),ur=ar.groups,dr=lr?tr.side:tr,hr=this.indirect?raycast_indirect:raycast;for(let pr=0,gr=sr.length;pr<gr;pr++){const vr=cr?tr[ur[pr].materialIndex].side:dr,mr=or.length;if(hr(this,pr,vr,er,or,ir,nr),cr){const fr=ur[pr].materialIndex;for(let _r=mr,Ar=or.length;_r<Ar;_r++)or[_r].face.materialIndex=fr}}return or}raycastFirst(er,tr=FrontSide,ir=0,nr=1/0){const sr=this._roots,ar=this.geometry,or=tr.isMaterial,lr=Array.isArray(tr);let cr=null;const ur=ar.groups,dr=or?tr.side:tr,hr=this.indirect?raycastFirst_indirect:raycastFirst;for(let pr=0,gr=sr.length;pr<gr;pr++){const vr=lr?tr[ur[pr].materialIndex].side:dr,mr=hr(this,pr,vr,er,ir,nr);mr!=null&&(cr==null||mr.distance<cr.distance)&&(cr=mr,lr&&(mr.face.materialIndex=ur[pr].materialIndex))}return cr}intersectsGeometry(er,tr){let ir=!1;const nr=this._roots,sr=this.indirect?intersectsGeometry_indirect:intersectsGeometry;for(let ar=0,or=nr.length;ar<or&&(ir=sr(this,ar,er,tr),!ir);ar++);return ir}shapecast(er){const tr=ExtendedTrianglePool.getPrimitive(),ir=this.indirect?iterateOverTriangles_indirect:iterateOverTriangles;let{boundsTraverseOrder:nr,intersectsBounds:sr,intersectsRange:ar,intersectsTriangle:or}=er;if(ar&&or){const dr=ar;ar=(hr,pr,gr,vr,mr)=>dr(hr,pr,gr,vr,mr)?!0:ir(hr,pr,this,or,gr,vr,tr)}else ar||(or?ar=(dr,hr,pr,gr)=>ir(dr,hr,this,or,pr,gr,tr):ar=(dr,hr,pr)=>pr);let lr=!1,cr=0;const ur=this._roots;for(let dr=0,hr=ur.length;dr<hr;dr++){const pr=ur[dr];if(lr=shapecast(this,dr,sr,ar,nr,cr),lr)break;cr+=pr.byteLength}return ExtendedTrianglePool.releasePrimitive(tr),lr}bvhcast(er,tr,ir){let{intersectsRanges:nr,intersectsTriangles:sr}=ir;const ar=ExtendedTrianglePool.getPrimitive(),or=this.geometry.index,lr=this.geometry.attributes.position,cr=this.indirect?gr=>{const vr=this.resolveTriangleIndex(gr);setTriangle(ar,vr*3,or,lr)}:gr=>{setTriangle(ar,gr*3,or,lr)},ur=ExtendedTrianglePool.getPrimitive(),dr=er.geometry.index,hr=er.geometry.attributes.position,pr=er.indirect?gr=>{const vr=er.resolveTriangleIndex(gr);setTriangle(ur,vr*3,dr,hr)}:gr=>{setTriangle(ur,gr*3,dr,hr)};if(sr){const gr=(vr,mr,fr,_r,Ar,yr,wr,xr)=>{for(let Sr=fr,br=fr+_r;Sr<br;Sr++){pr(Sr),ur.a.applyMatrix4(tr),ur.b.applyMatrix4(tr),ur.c.applyMatrix4(tr),ur.needsUpdate=!0;for(let Cr=vr,Ir=vr+mr;Cr<Ir;Cr++)if(cr(Cr),ar.needsUpdate=!0,sr(ar,ur,Cr,Sr,Ar,yr,wr,xr))return!0}return!1};if(nr){const vr=nr;nr=function(mr,fr,_r,Ar,yr,wr,xr,Sr){return vr(mr,fr,_r,Ar,yr,wr,xr,Sr)?!0:gr(mr,fr,_r,Ar,yr,wr,xr,Sr)}}else nr=gr}return bvhcast(this,er,tr,nr)}intersectsBox(er,tr){return obb.set(er.min,er.max,tr),obb.needsUpdate=!0,this.shapecast({intersectsBounds:ir=>obb.intersectsBox(ir),intersectsTriangle:ir=>obb.intersectsTriangle(ir)})}intersectsSphere(er){return this.shapecast({intersectsBounds:tr=>er.intersectsBox(tr),intersectsTriangle:tr=>tr.intersectsSphere(er)})}closestPointToGeometry(er,tr,ir={},nr={},sr=0,ar=1/0){return(this.indirect?closestPointToGeometry_indirect:closestPointToGeometry)(this,er,tr,ir,nr,sr,ar)}closestPointToPoint(er,tr={},ir=0,nr=1/0){return closestPointToPoint(this,er,tr,ir,nr)}getBoundingBox(er){return er.makeEmpty(),this._roots.forEach(ir=>{arrayToBox(0,new Float32Array(ir),tempBox),er.union(tempBox)}),er}}const boundingBox=new Box3,matrix=new Matrix4;class MeshBVHRootHelper extends Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}getVertexPosition(...er){return Mesh.prototype.getVertexPosition.call(this,...er)}constructor(er,tr,ir=10,nr=0){super(),this.material=tr,this.geometry=new BufferGeometry,this.name="MeshBVHRootHelper",this.depth=ir,this.displayParents=!1,this.bvh=er,this.displayEdges=!0,this._group=nr}raycast(){}update(){const er=this.geometry,tr=this.bvh,ir=this._group;if(er.dispose(),this.visible=!1,tr){const nr=this.depth-1,sr=this.displayParents;let ar=0;tr.traverse((hr,pr)=>{if(hr>=nr||pr)return ar++,!0;sr&&ar++},ir);let or=0;const lr=new Float32Array(8*3*ar);tr.traverse((hr,pr,gr)=>{const vr=hr>=nr||pr;if(vr||sr){arrayToBox(0,gr,boundingBox);const{min:mr,max:fr}=boundingBox;for(let _r=-1;_r<=1;_r+=2){const Ar=_r<0?mr.x:fr.x;for(let yr=-1;yr<=1;yr+=2){const wr=yr<0?mr.y:fr.y;for(let xr=-1;xr<=1;xr+=2){const Sr=xr<0?mr.z:fr.z;lr[or+0]=Ar,lr[or+1]=wr,lr[or+2]=Sr,or+=3}}}return vr}},ir);let cr,ur;this.displayEdges?ur=new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):ur=new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),lr.length>65535?cr=new Uint32Array(ur.length*ar):cr=new Uint16Array(ur.length*ar);const dr=ur.length;for(let hr=0;hr<ar;hr++){const pr=hr*8,gr=hr*dr;for(let vr=0;vr<dr;vr++)cr[gr+vr]=pr+ur[vr]}er.setIndex(new BufferAttribute(cr,1,!1)),er.setAttribute("position",new BufferAttribute(lr,3,!1)),this.visible=!0}}}class MeshBVHHelper extends Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(er){this.edgeMaterial.opacity=er,this.meshMaterial.opacity=er}constructor(er=null,tr=null,ir=10){er instanceof MeshBVH&&(ir=tr||10,tr=er,er=null),typeof tr=="number"&&(ir=tr,tr=null),super(),this.name="MeshBVHHelper",this.depth=ir,this.mesh=er,this.bvh=tr,this.displayParents=!1,this.displayEdges=!0,this.objectIndex=0,this._roots=[];const nr=new LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1}),sr=new MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});sr.color=nr.color,this.edgeMaterial=nr,this.meshMaterial=sr,this.update()}update(){const er=this.mesh;let tr=this.bvh||er.geometry.boundsTree||null;if(er.isBatchedMesh&&er.boundsTrees&&!tr){const nr=er._drawInfo[this.objectIndex];nr&&(tr=er.boundsTrees[nr.geometryIndex]||tr)}const ir=tr?tr._roots.length:0;for(;this._roots.length>ir;){const nr=this._roots.pop();nr.geometry.dispose(),this.remove(nr)}for(let nr=0;nr<ir;nr++){const{depth:sr,edgeMaterial:ar,meshMaterial:or,displayParents:lr,displayEdges:cr}=this;if(nr>=this._roots.length){const dr=new MeshBVHRootHelper(tr,ar,sr,nr);this.add(dr),this._roots.push(dr)}const ur=this._roots[nr];ur.bvh=tr,ur.depth=sr,ur.displayParents=lr,ur.displayEdges=cr,ur.material=cr?ar:or,ur.update()}}updateMatrixWorld(...er){const tr=this.mesh,ir=this.parent;tr!==null&&(tr.updateWorldMatrix(!0,!1),ir?this.matrix.copy(ir.matrixWorld).invert().multiply(tr.matrixWorld):this.matrix.copy(tr.matrixWorld),(tr.isInstancedMesh||tr.isBatchedMesh)&&(tr.getMatrixAt(this.objectIndex,matrix),this.matrix.multiply(matrix)),this.matrix.decompose(this.position,this.quaternion,this.scale)),super.updateMatrixWorld(...er)}copy(er){this.depth=er.depth,this.mesh=er.mesh,this.bvh=er.bvh,this.opacity=er.opacity,this.color.copy(er.color)}clone(){return new MeshBVHHelper(this.mesh,this.bvh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const er=this.children;for(let tr=0,ir=er.length;tr<ir;tr++)er[tr].geometry.dispose()}}class MeshBVHVisualizer extends MeshBVHHelper{constructor(...er){super(...er),console.warn("MeshBVHVisualizer: MeshBVHVisualizer has been deprecated. Use MeshBVHHelper, instead.")}}const _box1=new Box3,_box2=new Box3,_vec=new Vector3$1;function getPrimitiveSize(rr){switch(typeof rr){case"number":return 8;case"string":return rr.length*2;case"boolean":return 4;default:return 0}}function isTypedArray(rr){return/(Uint|Int|Float)(8|16|32)Array/.test(rr.constructor.name)}function getRootExtremes(rr,er){const tr={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return rr.traverse((ir,nr,sr,ar,or)=>{const lr=sr[3]-sr[0],cr=sr[4]-sr[1],ur=sr[5]-sr[2],dr=2*(lr*cr+cr*ur+ur*lr);tr.nodeCount++,nr?(tr.leafNodeCount++,tr.depth.min=Math.min(ir,tr.depth.min),tr.depth.max=Math.max(ir,tr.depth.max),tr.tris.min=Math.min(or,tr.tris.min),tr.tris.max=Math.max(or,tr.tris.max),tr.surfaceAreaScore+=dr*TRIANGLE_INTERSECT_COST*or):(tr.splits[ar]++,tr.surfaceAreaScore+=dr*TRAVERSAL_COST)},er),tr.tris.min===1/0&&(tr.tris.min=0,tr.tris.max=0),tr.depth.min===1/0&&(tr.depth.min=0,tr.depth.max=0),tr}function getBVHExtremes(rr){return rr._roots.map((er,tr)=>getRootExtremes(rr,tr))}function estimateMemoryInBytes(rr){const er=new Set,tr=[rr];let ir=0;for(;tr.length;){const nr=tr.pop();if(!er.has(nr)){er.add(nr);for(let sr in nr){if(!Object.hasOwn(nr,sr))continue;ir+=getPrimitiveSize(sr);const ar=nr[sr];ar&&(typeof ar=="object"||typeof ar=="function")?isTypedArray(ar)||isSharedArrayBufferSupported()&&ar instanceof SharedArrayBuffer||ar instanceof ArrayBuffer?ir+=ar.byteLength:tr.push(ar):ir+=getPrimitiveSize(ar)}}}return ir}function validateBounds(rr){const er=rr.geometry,tr=[],ir=er.index,nr=er.getAttribute("position");let sr=!0;return rr.traverse((ar,or,lr,cr,ur)=>{const dr={depth:ar,isLeaf:or,boundingData:lr,offset:cr,count:ur};tr[ar]=dr,arrayToBox(0,lr,_box1);const hr=tr[ar-1];if(or)for(let pr=cr,gr=cr+ur;pr<gr;pr++){const vr=rr.resolveTriangleIndex(pr);let mr=3*vr,fr=3*vr+1,_r=3*vr+2;ir&&(mr=ir.getX(mr),fr=ir.getX(fr),_r=ir.getX(_r));let Ar;_vec.fromBufferAttribute(nr,mr),Ar=_box1.containsPoint(_vec),_vec.fromBufferAttribute(nr,fr),Ar=Ar&&_box1.containsPoint(_vec),_vec.fromBufferAttribute(nr,_r),Ar=Ar&&_box1.containsPoint(_vec),console.assert(Ar,"Leaf bounds does not fully contain triangle."),sr=sr&&Ar}if(hr){arrayToBox(0,lr,_box2);const pr=_box2.containsBox(_box1);console.assert(pr,"Parent bounds does not fully contain child."),sr=sr&&pr}}),sr}function getJSONStructure(rr){const er=[];return rr.traverse((tr,ir,nr,sr,ar)=>{const or={bounds:arrayToBox(0,nr,new Box3)};ir?(or.count=ar,or.offset=sr):(or.left=null,or.right=null),er[tr]=or;const lr=er[tr-1];lr&&(lr.left===null?lr.left=or:lr.right=or)}),er[0]}function convertRaycastIntersect(rr,er,tr){return rr===null?null:(rr.point.applyMatrix4(er.matrixWorld),rr.distance=rr.point.distanceTo(tr.ray.origin),rr.object=er,rr)}const IS_REVISION_166=parseInt(REVISION)>=166,ray=new Ray$1,direction=new Vector3$1,tmpInverseMatrix=new Matrix4,origMeshRaycastFunc=Mesh.prototype.raycast,origBatchedRaycastFunc=BatchedMesh.prototype.raycast,_worldScale=new Vector3$1,_mesh=new Mesh,_batchIntersects=[];function acceleratedRaycast(rr,er){this.isBatchedMesh?acceleratedBatchedMeshRaycast.call(this,rr,er):acceleratedMeshRaycast.call(this,rr,er)}function acceleratedBatchedMeshRaycast(rr,er){if(this.boundsTrees){const tr=this.boundsTrees,ir=this._drawInfo||this._instanceInfo,nr=this._drawRanges||this._geometryInfo,sr=this.matrixWorld;_mesh.material=this.material,_mesh.geometry=this.geometry;const ar=_mesh.geometry.boundsTree,or=_mesh.geometry.drawRange;_mesh.geometry.boundingSphere===null&&(_mesh.geometry.boundingSphere=new Sphere);for(let lr=0,cr=ir.length;lr<cr;lr++){if(!this.getVisibleAt(lr))continue;const ur=ir[lr].geometryIndex;if(_mesh.geometry.boundsTree=tr[ur],this.getMatrixAt(lr,_mesh.matrixWorld).premultiply(sr),!_mesh.geometry.boundsTree){this.getBoundingBoxAt(ur,_mesh.geometry.boundingBox),this.getBoundingSphereAt(ur,_mesh.geometry.boundingSphere);const dr=nr[ur];_mesh.geometry.setDrawRange(dr.start,dr.count)}_mesh.raycast(rr,_batchIntersects);for(let dr=0,hr=_batchIntersects.length;dr<hr;dr++){const pr=_batchIntersects[dr];pr.object=this,pr.batchId=lr,er.push(pr)}_batchIntersects.length=0}_mesh.geometry.boundsTree=ar,_mesh.geometry.drawRange=or,_mesh.material=null,_mesh.geometry=null}else origBatchedRaycastFunc.call(this,rr,er)}function acceleratedMeshRaycast(rr,er){if(this.geometry.boundsTree){if(this.material===void 0)return;tmpInverseMatrix.copy(this.matrixWorld).invert(),ray.copy(rr.ray).applyMatrix4(tmpInverseMatrix),_worldScale.setFromMatrixScale(this.matrixWorld),direction.copy(ray.direction).multiply(_worldScale);const tr=direction.length(),ir=rr.near/tr,nr=rr.far/tr,sr=this.geometry.boundsTree;if(rr.firstHitOnly===!0){const ar=convertRaycastIntersect(sr.raycastFirst(ray,this.material,ir,nr),this,rr);ar&&er.push(ar)}else{const ar=sr.raycast(ray,this.material,ir,nr);for(let or=0,lr=ar.length;or<lr;or++){const cr=convertRaycastIntersect(ar[or],this,rr);cr&&er.push(cr)}}}else origMeshRaycastFunc.call(this,rr,er)}function computeBoundsTree(rr={}){return this.boundsTree=new MeshBVH(this,rr),this.boundsTree}function disposeBoundsTree(){this.boundsTree=null}function computeBatchedBoundsTree(rr=-1,er={}){if(!IS_REVISION_166)throw new Error("BatchedMesh: Three r166+ is required to compute bounds trees.");er.indirect&&console.warn('"Indirect" is set to false because it is not supported for BatchedMesh.'),er={...er,indirect:!1,range:null};const tr=this._drawRanges||this._geometryInfo,ir=this._geometryCount;this.boundsTrees||(this.boundsTrees=new Array(ir).fill(null));const nr=this.boundsTrees;for(;nr.length<ir;)nr.push(null);if(rr<0){for(let sr=0;sr<ir;sr++)er.range=tr[sr],nr[sr]=new MeshBVH(this.geometry,er);return nr}else return rr<tr.length&&(er.range=tr[rr],nr[rr]=new MeshBVH(this.geometry,er)),nr[rr]||null}function disposeBatchedBoundsTree(rr=-1){rr<0?this.boundsTrees.fill(null):rr<this.boundsTree.length&&(this.boundsTrees[rr]=null)}function countToStringFormat(rr){switch(rr){case 1:return"R";case 2:return"RG";case 3:return"RGBA";case 4:return"RGBA"}throw new Error}function countToFormat(rr){switch(rr){case 1:return RedFormat;case 2:return RGFormat;case 3:return RGBAFormat;case 4:return RGBAFormat}}function countToIntFormat(rr){switch(rr){case 1:return RedIntegerFormat;case 2:return RGIntegerFormat;case 3:return RGBAIntegerFormat;case 4:return RGBAIntegerFormat}}class VertexAttributeTexture extends DataTexture{constructor(){super(),this.minFilter=NearestFilter,this.magFilter=NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(er){const tr=this.overrideItemSize,ir=er.itemSize,nr=er.count;if(tr!==null){if(ir*nr%tr!==0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");er.itemSize=tr,er.count=nr*ir/tr}const sr=er.itemSize,ar=er.count,or=er.normalized,lr=er.array.constructor,cr=lr.BYTES_PER_ELEMENT;let ur=this._forcedType,dr=sr;if(ur===null)switch(lr){case Float32Array:ur=FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:ur=UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:ur=IntType;break}let hr,pr,gr,vr,mr=countToStringFormat(sr);switch(ur){case FloatType:gr=1,pr=countToFormat(sr),or&&cr===1?(vr=lr,mr+="8",lr===Uint8Array?hr=UnsignedByteType:(hr=ByteType,mr+="_SNORM")):(vr=Float32Array,mr+="32F",hr=FloatType);break;case IntType:mr+=cr*8+"I",gr=or?Math.pow(2,lr.BYTES_PER_ELEMENT*8-1):1,pr=countToIntFormat(sr),cr===1?(vr=Int8Array,hr=ByteType):cr===2?(vr=Int16Array,hr=ShortType):(vr=Int32Array,hr=IntType);break;case UnsignedIntType:mr+=cr*8+"UI",gr=or?Math.pow(2,lr.BYTES_PER_ELEMENT*8-1):1,pr=countToIntFormat(sr),cr===1?(vr=Uint8Array,hr=UnsignedByteType):cr===2?(vr=Uint16Array,hr=UnsignedShortType):(vr=Uint32Array,hr=UnsignedIntType);break}dr===3&&(pr===RGBAFormat||pr===RGBAIntegerFormat)&&(dr=4);const fr=Math.ceil(Math.sqrt(ar))||1,_r=dr*fr*fr,Ar=new vr(_r),yr=er.normalized;er.normalized=!1;for(let wr=0;wr<ar;wr++){const xr=dr*wr;Ar[xr]=er.getX(wr)/gr,sr>=2&&(Ar[xr+1]=er.getY(wr)/gr),sr>=3&&(Ar[xr+2]=er.getZ(wr)/gr,dr===4&&(Ar[xr+3]=1)),sr>=4&&(Ar[xr+3]=er.getW(wr)/gr)}er.normalized=yr,this.internalFormat=mr,this.format=pr,this.type=hr,this.image.width=fr,this.image.height=fr,this.image.data=Ar,this.needsUpdate=!0,this.dispose(),er.itemSize=ir,er.count=nr}}class UIntVertexAttributeTexture extends VertexAttributeTexture{constructor(){super(),this._forcedType=UnsignedIntType}}class IntVertexAttributeTexture extends VertexAttributeTexture{constructor(){super(),this._forcedType=IntType}}class FloatVertexAttributeTexture extends VertexAttributeTexture{constructor(){super(),this._forcedType=FloatType}}class MeshBVHUniformStruct{constructor(){this.index=new UIntVertexAttributeTexture,this.position=new FloatVertexAttributeTexture,this.bvhBounds=new DataTexture,this.bvhContents=new DataTexture,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(er){const{geometry:tr}=er;if(bvhToTextures(er,this.bvhBounds,this.bvhContents),this.position.updateFrom(tr.attributes.position),er.indirect){const ir=er._indirectBuffer;if(this._cachedIndexAttr===null||this._cachedIndexAttr.count!==ir.length)if(tr.index)this._cachedIndexAttr=tr.index.clone();else{const nr=getIndexArray(getVertexCount(tr));this._cachedIndexAttr=new BufferAttribute(nr,1,!1)}dereferenceIndex(tr,ir,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(tr.index)}dispose(){const{index:er,position:tr,bvhBounds:ir,bvhContents:nr}=this;er&&er.dispose(),tr&&tr.dispose(),ir&&ir.dispose(),nr&&nr.dispose()}}function dereferenceIndex(rr,er,tr){const ir=tr.array,nr=rr.index?rr.index.array:null;for(let sr=0,ar=er.length;sr<ar;sr++){const or=3*sr,lr=3*er[sr];for(let cr=0;cr<3;cr++)ir[or+cr]=nr?nr[lr+cr]:lr+cr}}function bvhToTextures(rr,er,tr){const ir=rr._roots;if(ir.length!==1)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");const nr=ir[0],sr=new Uint16Array(nr),ar=new Uint32Array(nr),or=new Float32Array(nr),lr=nr.byteLength/BYTES_PER_NODE,cr=2*Math.ceil(Math.sqrt(lr/2)),ur=new Float32Array(4*cr*cr),dr=Math.ceil(Math.sqrt(lr)),hr=new Uint32Array(2*dr*dr);for(let pr=0;pr<lr;pr++){const gr=pr*BYTES_PER_NODE/4,vr=gr*2,mr=gr;for(let fr=0;fr<3;fr++)ur[8*pr+0+fr]=or[mr+0+fr],ur[8*pr+4+fr]=or[mr+3+fr];if(IS_LEAF(vr,sr)){const fr=COUNT(vr,sr),_r=OFFSET(gr,ar),Ar=4294901760|fr;hr[pr*2+0]=Ar,hr[pr*2+1]=_r}else{const fr=4*RIGHT_NODE(gr,ar)/BYTES_PER_NODE,_r=SPLIT_AXIS(gr,ar);hr[pr*2+0]=_r,hr[pr*2+1]=fr}}er.image.data=ur,er.image.width=cr,er.image.height=cr,er.format=RGBAFormat,er.type=FloatType,er.internalFormat="RGBA32F",er.minFilter=NearestFilter,er.magFilter=NearestFilter,er.generateMipmaps=!1,er.needsUpdate=!0,er.dispose(),tr.image.data=hr,tr.image.width=dr,tr.image.height=dr,tr.format=RGIntegerFormat,tr.type=UnsignedIntType,tr.internalFormat="RG32UI",tr.minFilter=NearestFilter,tr.magFilter=NearestFilter,tr.generateMipmaps=!1,tr.needsUpdate=!0,tr.dispose()}const _positionVector=new Vector3$1,_normalVector=new Vector3$1,_tangentVector=new Vector3$1,_tangentVector4=new Vector4,_morphVector=new Vector3$1,_temp=new Vector3$1,_skinIndex=new Vector4,_skinWeight=new Vector4,_matrix=new Matrix4,_boneMatrix=new Matrix4;function validateAttributes(rr,er){if(!rr&&!er)return;const tr=rr.count===er.count,ir=rr.normalized===er.normalized,nr=rr.array.constructor===er.array.constructor,sr=rr.itemSize===er.itemSize;if(!tr||!ir||!nr||!sr)throw new Error}function createAttributeClone(rr,er=null){const tr=rr.array.constructor,ir=rr.normalized,nr=rr.itemSize,sr=er===null?rr.count:er;return new BufferAttribute(new tr(nr*sr),nr,ir)}function copyAttributeContents(rr,er,tr=0){if(rr.isInterleavedBufferAttribute){const ir=rr.itemSize;for(let nr=0,sr=rr.count;nr<sr;nr++){const ar=nr+tr;er.setX(ar,rr.getX(nr)),ir>=2&&er.setY(ar,rr.getY(nr)),ir>=3&&er.setZ(ar,rr.getZ(nr)),ir>=4&&er.setW(ar,rr.getW(nr))}}else{const ir=er.array,nr=ir.constructor,sr=ir.BYTES_PER_ELEMENT*rr.itemSize*tr;new nr(ir.buffer,sr,rr.array.length).set(rr.array)}}function addScaledMatrix(rr,er,tr){const ir=rr.elements,nr=er.elements;for(let sr=0,ar=nr.length;sr<ar;sr++)ir[sr]+=nr[sr]*tr}function boneNormalTransform(rr,er,tr){const ir=rr.skeleton,nr=rr.geometry,sr=ir.bones,ar=ir.boneInverses;_skinIndex.fromBufferAttribute(nr.attributes.skinIndex,er),_skinWeight.fromBufferAttribute(nr.attributes.skinWeight,er),_matrix.elements.fill(0);for(let or=0;or<4;or++){const lr=_skinWeight.getComponent(or);if(lr!==0){const cr=_skinIndex.getComponent(or);_boneMatrix.multiplyMatrices(sr[cr].matrixWorld,ar[cr]),addScaledMatrix(_matrix,_boneMatrix,lr)}}return _matrix.multiply(rr.bindMatrix).premultiply(rr.bindMatrixInverse),tr.transformDirection(_matrix),tr}function applyMorphTarget(rr,er,tr,ir,nr){_morphVector.set(0,0,0);for(let sr=0,ar=rr.length;sr<ar;sr++){const or=er[sr],lr=rr[sr];or!==0&&(_temp.fromBufferAttribute(lr,ir),tr?_morphVector.addScaledVector(_temp,or):_morphVector.addScaledVector(_temp.sub(nr),or))}nr.add(_morphVector)}function mergeBufferGeometries(rr,er={useGroups:!1,updateIndex:!1,skipAttributes:[]},tr=new BufferGeometry){const ir=rr[0].index!==null,{useGroups:nr=!1,updateIndex:sr=!1,skipAttributes:ar=[]}=er,or=new Set(Object.keys(rr[0].attributes)),lr={};let cr=0;tr.clearGroups();for(let ur=0;ur<rr.length;++ur){const dr=rr[ur];let hr=0;if(ir!==(dr.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const pr in dr.attributes){if(!or.has(pr))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+pr+'" attribute exists among all geometries, or in none of them.');lr[pr]===void 0&&(lr[pr]=[]),lr[pr].push(dr.attributes[pr]),hr++}if(hr!==or.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(nr){let pr;if(ir)pr=dr.index.count;else if(dr.attributes.position!==void 0)pr=dr.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");tr.addGroup(cr,pr,ur),cr+=pr}}if(ir){let ur=!1;if(!tr.index){let dr=0;for(let hr=0;hr<rr.length;++hr)dr+=rr[hr].index.count;tr.setIndex(new BufferAttribute(new Uint32Array(dr),1,!1)),ur=!0}if(sr||ur){const dr=tr.index;let hr=0,pr=0;for(let gr=0;gr<rr.length;++gr){const vr=rr[gr],mr=vr.index;if(ar[gr]!==!0)for(let fr=0;fr<mr.count;++fr)dr.setX(hr,mr.getX(fr)+pr),hr++;pr+=vr.attributes.position.count}}}for(const ur in lr){const dr=lr[ur];if(!(ur in tr.attributes)){let gr=0;for(const vr in dr)gr+=dr[vr].count;tr.setAttribute(ur,createAttributeClone(lr[ur][0],gr))}const hr=tr.attributes[ur];let pr=0;for(let gr=0,vr=dr.length;gr<vr;gr++){const mr=dr[gr];ar[gr]!==!0&&copyAttributeContents(mr,hr,pr),pr+=mr.count}}return tr}function checkTypedArrayEquality(rr,er){if(rr===null||er===null)return rr===er;if(rr.length!==er.length)return!1;for(let tr=0,ir=rr.length;tr<ir;tr++)if(rr[tr]!==er[tr])return!1;return!0}function invertGeometry(rr){const{index:er,attributes:tr}=rr;if(er)for(let ir=0,nr=er.count;ir<nr;ir+=3){const sr=er.getX(ir),ar=er.getX(ir+2);er.setX(ir,ar),er.setX(ir+2,sr)}else for(const ir in tr){const nr=tr[ir],sr=nr.itemSize;for(let ar=0,or=nr.count;ar<or;ar+=3)for(let lr=0;lr<sr;lr++){const cr=nr.getComponent(ar,lr),ur=nr.getComponent(ar+2,lr);nr.setComponent(ar,lr,ur),nr.setComponent(ar+2,lr,cr)}}return rr}class GeometryDiff{constructor(er){this.matrixWorld=new Matrix4,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=er,this.update()}update(){const er=this.mesh,tr=er.geometry,ir=er.skeleton,nr=(tr.index?tr.index.count:tr.attributes.position.count)/3;if(this.matrixWorld.copy(er.matrixWorld),this.geometryHash=tr.attributes.position.version,this.primitiveCount=nr,ir){ir.boneTexture||ir.computeBoneTexture(),ir.update();const sr=ir.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==sr.length?this.boneMatrices=sr.slice():this.boneMatrices.set(sr)}else this.boneMatrices=null}didChange(){const er=this.mesh,tr=er.geometry,ir=(tr.index?tr.index.count:tr.attributes.position.count)/3;return!(this.matrixWorld.equals(er.matrixWorld)&&this.geometryHash===tr.attributes.position.version&&checkTypedArrayEquality(er.skeleton&&er.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===ir)}}class StaticGeometryGenerator{constructor(er){Array.isArray(er)||(er=[er]);const tr=[];er.forEach(ir=>{ir.traverseVisible(nr=>{nr.isMesh&&tr.push(nr)})}),this.meshes=tr,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(tr.length).fill().map(()=>new BufferGeometry),this._diffMap=new WeakMap}getMaterials(){const er=[];return this.meshes.forEach(tr=>{Array.isArray(tr.material)?er.push(...tr.material):er.push(tr.material)}),er}generate(er=new BufferGeometry){let tr=[];const{meshes:ir,useGroups:nr,_intermediateGeometry:sr,_diffMap:ar}=this;for(let or=0,lr=ir.length;or<lr;or++){const cr=ir[or],ur=sr[or],dr=ar.get(cr);!dr||dr.didChange(cr)?(this._convertToStaticGeometry(cr,ur),tr.push(!1),dr?dr.update():ar.set(cr,new GeometryDiff(cr))):tr.push(!0)}if(sr.length===0){er.setIndex(null);const or=er.attributes;for(const lr in or)er.deleteAttribute(lr);for(const lr in this.attributes)er.setAttribute(this.attributes[lr],new BufferAttribute(new Float32Array(0),4,!1))}else mergeBufferGeometries(sr,{useGroups:nr,skipAttributes:tr},er);for(const or in er.attributes)er.attributes[or].needsUpdate=!0;return er}_convertToStaticGeometry(er,tr=new BufferGeometry){const ir=er.geometry,nr=this.applyWorldTransforms,sr=this.attributes.includes("normal"),ar=this.attributes.includes("tangent"),or=ir.attributes,lr=tr.attributes;!tr.index&&ir.index&&(tr.index=ir.index.clone()),lr.position||tr.setAttribute("position",createAttributeClone(or.position)),sr&&!lr.normal&&or.normal&&tr.setAttribute("normal",createAttributeClone(or.normal)),ar&&!lr.tangent&&or.tangent&&tr.setAttribute("tangent",createAttributeClone(or.tangent)),validateAttributes(ir.index,tr.index),validateAttributes(or.position,lr.position),sr&&validateAttributes(or.normal,lr.normal),ar&&validateAttributes(or.tangent,lr.tangent);const cr=or.position,ur=sr?or.normal:null,dr=ar?or.tangent:null,hr=ir.morphAttributes.position,pr=ir.morphAttributes.normal,gr=ir.morphAttributes.tangent,vr=ir.morphTargetsRelative,mr=er.morphTargetInfluences,fr=new Matrix3;fr.getNormalMatrix(er.matrixWorld),ir.index&&tr.index.array.set(ir.index.array);for(let _r=0,Ar=or.position.count;_r<Ar;_r++)_positionVector.fromBufferAttribute(cr,_r),ur&&_normalVector.fromBufferAttribute(ur,_r),dr&&(_tangentVector4.fromBufferAttribute(dr,_r),_tangentVector.fromBufferAttribute(dr,_r)),mr&&(hr&&applyMorphTarget(hr,mr,vr,_r,_positionVector),pr&&applyMorphTarget(pr,mr,vr,_r,_normalVector),gr&&applyMorphTarget(gr,mr,vr,_r,_tangentVector)),er.isSkinnedMesh&&(er.applyBoneTransform(_r,_positionVector),ur&&boneNormalTransform(er,_r,_normalVector),dr&&boneNormalTransform(er,_r,_tangentVector)),nr&&_positionVector.applyMatrix4(er.matrixWorld),lr.position.setXYZ(_r,_positionVector.x,_positionVector.y,_positionVector.z),ur&&(nr&&_normalVector.applyNormalMatrix(fr),lr.normal.setXYZ(_r,_normalVector.x,_normalVector.y,_normalVector.z)),dr&&(nr&&_tangentVector.transformDirection(er.matrixWorld),lr.tangent.setXYZW(_r,_tangentVector.x,_tangentVector.y,_tangentVector.z,_tangentVector4.w));for(const _r in this.attributes){const Ar=this.attributes[_r];Ar==="position"||Ar==="tangent"||Ar==="normal"||!(Ar in or)||(lr[Ar]||tr.setAttribute(Ar,createAttributeClone(or[Ar])),validateAttributes(or[Ar],lr[Ar]),copyAttributeContents(or[Ar],lr[Ar]))}return er.matrixWorld.determinant()<0&&invertGeometry(tr),tr}}const common_functions=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,bvh_distance_functions=`

float dot2( vec3 v ) {

	return dot( v, v );

}

// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// point and cut off range
	vec3 point, float closestDistanceSquared,

	// outputs
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord, inout float side, inout vec3 outPoint
) {

	bool found = false;
	vec3 localBarycoord;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, sampler2D bvhBounds, uint currNodeIndex ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhClosestPointToPoint(		bvh,		point, faceIndices, faceNormal, barycoord, side, outPoint	)	_bvhClosestPointToPoint(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		point, faceIndices, faceNormal, barycoord, side, outPoint	)

float _bvhClosestPointToPoint(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// point to check
	vec3 point,

	// output variables
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh_position, bvh_index, offset, count, point, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh_bvhBounds, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`,bvh_ray_functions=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define	bvhIntersectFirstHit(		bvh,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)	_bvhIntersectFirstHit(		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,bvh_struct_definitions=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,BVHShaderGLSL=Object.freeze(Object.defineProperty({__proto__:null,bvh_distance_functions,bvh_ray_functions,bvh_struct_definitions,common_functions},Symbol.toStringTag,{value:"Module"})),shaderStructs=bvh_struct_definitions,shaderDistanceFunction=bvh_distance_functions,shaderIntersectFunction=`
	${common_functions}
	${bvh_ray_functions}
`;BufferGeometry.prototype.computeBoundsTree=computeBoundsTree;BufferGeometry.prototype.disposeBoundsTree=disposeBoundsTree;Mesh.prototype.raycast=acceleratedRaycast;BatchedMesh.prototype.computeBoundsTree=computeBatchedBoundsTree;BatchedMesh.prototype.disposeBoundsTree=disposeBatchedBoundsTree;BatchedMesh.prototype.raycast=acceleratedRaycast;game$1.registerGameObj(Player);game$1.registerGameObj(GameScene);game$1.registerGameObj(Ghost);game$1.registerGameObj(Doll);game$1.registerGameObj(Bag);game$1.registerGameObj(Altars);game$1.registerGameObj(Trash);game$1.registerGameObj(Tutorial);game$1.registerGameObj(GameMap);let trashObj=game$1.getGameObj(Trash),gameScene=game$1.getGameObj(GameScene),tutorial=game$1.getGameObj(Tutorial);const renderer=new WebGLRenderer({antialias:!0,canvas:document.getElementById("canvas")});renderer.outputColorSpace=SRGBColorSpace;renderer.setSize(window.innerWidth,window.innerHeight);renderer.shadowMap.enabled=!0;renderer.shadowMap.type=PCFSoftShadowMap;let gl=renderer.getContext(),samples=gl.getParameter(gl.SAMPLES);const composer=new EffectComposer(renderer,{multisampling:samples});let outlineEffect=new OutlineEffect(game$1.scene,game$1.camera,{visibleEdgeColor:16777215,hiddenEdgeColor:16777215,multisampling:samples}),dofEffect=new DepthOfFieldEffect(game$1.camera,{worldFocusDistance:3,worldFocusRange:1e3});const effectPass=new EffectPass(game$1.camera,outlineEffect,dofEffect);game$1.dof=dofEffect;const renderPass=new RenderPass(game$1.scene,game$1.camera);composer.addPass(renderPass);composer.addPass(effectPass);let stats=new Stats;function animate(){game$1.update(),game$1.lateUpdate(),game$1.difficulty!=3?(outlineEffect.selection.set(trashObj.closeTrash),gameScene.gateOpening&&outlineEffect.selection.add(gameScene.gate)):outlineEffect.selection.clear(),composer.render(game$1.deltatime),stats.update()}window.addEventListener("resize",rr=>{game$1.camera.aspect=window.innerWidth/window.innerHeight,game$1.camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight),composer.setSize(window.innerWidth,window.innerHeight)});await game$1.init();document.getElementById("canvas-lefttop").style.display="";document.getElementById("loading").style.display="none";document.getElementById("pyramid-loader").style.display="none";document.getElementById("altar-status").style.display="";document.getElementById("top-status").style.display="";let difficultyButton=document.getElementById("difficulty"),tutorialRequired=!0,tutorialButton=document.getElementById("tutorial"),manualButton=document.getElementById("manual"),manual=document.getElementById("usermanual");difficultyButton.onclick=()=>{game$1.difficulty=(game$1.difficulty+1)%4,difficultyButton.innerText="Difficulty: "+["Casual","Normal","Brutal","Mega Brutal"][game$1.difficulty],game$1.difficulty>1&&(tutorialRequired=!1,tutorialButton.innerHTML="Tutorial: "+(tutorialRequired?"Enabled":"Disabled"))};tutorialButton.onclick=()=>{tutorialRequired=!tutorialRequired&&game$1.difficulty<=1,tutorialButton.innerHTML="Tutorial: "+(tutorialRequired?"Enabled":"Disabled")};manualButton.onclick=()=>{manual.style.display=""};let startbtnClick=()=>{document.getElementById("startbtn").onclick=null,document.getElementById("startbtn").innerText="Loading...",setTimeout(()=>{document.getElementById("startgame").style.display="none",tutorial.enabled=tutorialRequired,game$1.beforeStart(),renderer.setAnimationLoop(animate)},1e3)},startbtn=document.getElementById("startbtn");startbtn.onclick=startbtnClick;for(;;){game$1.reset(),document.getElementById("startgame").style.display="",await game$1.gameEnded,console.log("Game End"),renderer.setAnimationLoop(null);let rr=document.getElementById("endgame");rr.style.display="";let er=document.createElement("a");er.style.display="block",er.style.fontSize="0.2em",er.innerText="Play Again",rr.appendChild(er),await new Promise((ir,nr)=>{let sr=()=>{rr.removeChild(er),er.removeEventListener("click",sr),rr.style.display="none",startbtn.innerText="Play",startbtn.onclick=startbtnClick,ir()};er.addEventListener("click",sr)})}
